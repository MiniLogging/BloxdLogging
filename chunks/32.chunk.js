/*! For license information please see 6bgy3s.32.d667c2ae.chunk.js.LICENSE.txt */
(self.dwifukwnts=self.dwifukwnts||[]).push([[32],{13558:(U,X,b)=>{"use strict";var F=b(13567),E=b(13569),w=b(13576);b.g.__TYPEDARRAY_POOL||(b.g.__TYPEDARRAY_POOL={UINT8:E([32,0]),UINT16:E([32,0]),UINT32:E([32,0]),INT8:E([32,0]),INT16:E([32,0]),INT32:E([32,0]),FLOAT:E([32,0]),DOUBLE:E([32,0]),DATA:E([32,0]),UINT8C:E([32,0]),BUFFER:E([32,0])});var Q="undefined"!==typeof Uint8ClampedArray,z=b.g.__TYPEDARRAY_POOL;z.UINT8C||(z.UINT8C=E([32,0])),z.BUFFER||(z.BUFFER=E([32,0]));var q=z.DATA,p=z.BUFFER;function S(U){if(U){var X=U.length||U.byteLength,b=F.log2(X);q[b].push(U)}}function R(U){U=F.nextPow2(U);var X=F.log2(U),b=q[X];return b.length>0?b.pop():new ArrayBuffer(U)}function n(U){return new Uint8Array(R(U),0,U)}function a(U){return new Uint16Array(R(2*U),0,U)}function J(U){return new Uint32Array(R(4*U),0,U)}function m(U){return new Int8Array(R(U),0,U)}function x(U){return new Int16Array(R(2*U),0,U)}function I(U){return new Int32Array(R(4*U),0,U)}function O(U){return new Float32Array(R(4*U),0,U)}function N(U){return new Float64Array(R(8*U),0,U)}function u(U){return Q?new Uint8ClampedArray(R(U),0,U):n(U)}function i(U){return new DataView(R(U),0,U)}X.free=function(U){if(w(U))p[F.log2(U.length)].push(U);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(U)&&(U=U.buffer),!U)return;var X=U.length||U.byteLength,b=0|F.log2(X);q[b].push(U)}},X.freeUint8=X.freeUint16=X.freeUint32=X.freeInt8=X.freeInt16=X.freeInt32=X.freeFloat32=X.freeFloat=X.freeFloat64=X.freeDouble=X.freeUint8Clamped=X.freeDataView=function(U){S(U.buffer)},X.freeArrayBuffer=S,X.freeBuffer=function(U){p[F.log2(U.length)].push(U)},X.malloc=function(U,X){if(void 0===X||"arraybuffer"===X)return R(U);switch(X){case"uint8":return n(U);case"uint16":return a(U);case"uint32":return J(U);case"int8":return m(U);case"int16":return x(U);case"int32":return I(U);case"float":case"float32":return O(U);case"double":case"float64":return N(U);case"uint8_clamped":return u(U);case"buffer":throw"Buffer not supported";case"data":case"dataview":return i(U);default:return null}return null},X.mallocArrayBuffer=R,X.mallocUint8=n,X.mallocUint16=a,X.mallocUint32=J,X.mallocInt8=m,X.mallocInt16=x,X.mallocInt32=I,X.mallocFloat32=X.mallocFloat=O,X.mallocFloat64=X.mallocDouble=N,X.mallocUint8Clamped=u,X.mallocDataView=i,X.clearCache=function(){for(var U=0;U<32;++U)z.UINT8[U].length=0,z.UINT16[U].length=0,z.UINT32[U].length=0,z.INT8[U].length=0,z.INT16[U].length=0,z.INT32[U].length=0,z.FLOAT[U].length=0,z.DOUBLE[U].length=0,z.UINT8C[U].length=0,q[U].length=0,p[U].length=0}},13677:(U,X,b)=>{U.exports=E;var F=b(12411);function E(U,X){if(!(this instanceof E))return new E(U,X);var b=F.create();F.add(b,U,X),this.base=F.min(F.create(),U,b),this.zS=F.clone(X),this.max=F.max(F.create(),U,b),this.mag=F.length(this.zS)}var w=E.prototype;w.width=function(){return this.zS[0]},w.height=function(){return this.zS[1]},w.depth=function(){return this.zS[2]},w.x0=function(){return this.base[0]},w.y0=function(){return this.base[1]},w.z0=function(){return this.base[2]},w.x1=function(){return this.max[0]},w.y1=function(){return this.max[1]},w.z1=function(){return this.max[2]},w.translate=function(U){return F.add(this.max,this.max,U),F.add(this.base,this.base,U),this},w.setPosition=function(U){return F.add(this.max,U,this.zS),F.k(this.base,U),this},w.expand=function(U){var X=F.create(),b=F.create();return F.max(X,U.max,this.max),F.min(b,U.base,this.base),F.mX(X,X,b),new E(b,X)},w.intersects=function(U){return!(U.base[0]>this.max[0])&&(!(U.base[1]>this.max[1])&&(!(U.base[2]>this.max[2])&&(!(U.max[0]<this.base[0])&&(!(U.max[1]<this.base[1])&&!(U.max[2]<this.base[2])))))},w.touches=function(U){var X=this.union(U);return null!==X&&(0==X.width()||0==X.height()||0==X.depth())},w.union=function(U){if(!this.intersects(U))return null;var X=Math.max(U.base[0],this.base[0]),b=Math.max(U.base[1],this.base[1]),F=Math.max(U.base[2],this.base[2]);return new E([X,b,F],[Math.min(U.max[0],this.max[0])-X,Math.min(U.max[1],this.max[1])-b,Math.min(U.max[2],this.max[2])-F])}},13567:(U,X)=>{"use strict";function b(U){var X=32;return(U&=-U)&&X--,65535&U&&(X-=16),16711935&U&&(X-=8),252645135&U&&(X-=4),858993459&U&&(X-=2),1431655765&U&&(X-=1),X}X.INT_BITS=32,X.INT_MAX=2147483647,X.INT_MIN=-1<<31,X.sign=function(U){return(U>0)-(U<0)},X.abs=function(U){var X=U>>31;return(U^X)-X},X.min=function(U,X){return X^(U^X)&-(U<X)},X.max=function(U,X){return U^(U^X)&-(U<X)},X.isPow2=function(U){return!(U&U-1)&&!!U},X.log2=function(U){var X,b;return X=(U>65535)<<4,X|=b=((U>>>=X)>255)<<3,X|=b=((U>>>=b)>15)<<2,(X|=b=((U>>>=b)>3)<<1)|(U>>>=b)>>1},X.log10=function(U){return U>=1e9?9:U>=1e8?8:U>=1e7?7:U>=1e6?6:U>=1e5?5:U>=1e4?4:U>=1e3?3:U>=100?2:U>=10?1:0},X.popCount=function(U){return 16843009*((U=(858993459&(U-=U>>>1&1431655765))+(U>>>2&858993459))+(U>>>4)&252645135)>>>24},X.countTrailingZeros=b,X.nextPow2=function(U){return U+=0===U,--U,U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)+1},X.prevPow2=function(U){return U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)-(U>>>1)},X.parity=function(U){return U^=U>>>16,U^=U>>>8,U^=U>>>4,27030>>>(U&=15)&1};var F=new Array(256);!function(U){for(var X=0;X<256;++X){var b=X,F=X,E=7;for(b>>>=1;b;b>>>=1)F<<=1,F|=1&b,--E;U[X]=F<<E&255}}(F),X.reverse=function(U){return F[255&U]<<24|F[U>>>8&255]<<16|F[U>>>16&255]<<8|F[U>>>24&255]},X.interleave2=function(U,X){return(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))|(X=1431655765&((X=858993459&((X=252645135&((X=16711935&((X&=65535)|X<<8))|X<<4))|X<<2))|X<<1))<<1},X.deinterleave2=function(U,X){return(U=65535&((U=16711935&((U=252645135&((U=858993459&((U=U>>>X&1431655765)|U>>>1))|U>>>2))|U>>>4))|U>>>16))<<16>>16},X.interleave3=function(U,X,b){return U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2),(U|=(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},X.deinterleave3=function(U,X){return(U=1023&((U=4278190335&((U=251719695&((U=3272356035&((U=U>>>X&1227133513)|U>>>2))|U>>>4))|U>>>8))|U>>>16))<<22>>22},X.nextCombination=function(U){var X=U|U-1;return X+1|(~X&-~X)-1>>>b(U)+1}},13552:(U,X,b)=>{"use strict";U.exports=function(U,X,b){switch(arguments.length){case 1:return F=[],p(E=U,E,S,!0),F;case 2:return"function"===typeof X?p(U,U,X,!0):function(U,X){return F=[],p(U,X,S,!1),F}(U,X);case 3:return p(U,X,b,!1);default:throw new Error("box-intersect: Invalid arguments")}var E};var F,E=b(13558),w=b(13584),Q=b(13599);function z(U,X){for(var b=0;b<U;++b)if(!(X[b]<=X[b+U]))return!0;return!1}function q(U,X,b,F){for(var E=0,w=0,Q=0,q=U.length;Q<q;++Q){var p=U[Q];if(!z(X,p)){for(var S=0;S<2*X;++S)b[E++]=p[S];F[w++]=Q}}return w}function p(U,X,b,F){var z=U.length,p=X.length;if(!(z<=0||p<=0)){var S=U[0].length>>>1;if(!(S<=0)){var R,n=E.mallocDouble(2*S*z),a=E.mallocInt32(z);if((z=q(U,S,n,a))>0){if(1===S&&F)w.init(z),R=w.sweepComplete(S,b,0,z,n,a,0,z,n,a);else{var J=E.mallocDouble(2*S*p),m=E.mallocInt32(p);(p=q(X,S,J,m))>0&&(w.init(z+p),R=1===S?w.sweepBipartite(S,b,0,z,n,a,0,p,J,m):Q(S,b,F,z,n,a,p,J,m),E.free(J),E.free(m))}E.free(n),E.free(a)}return R}}}function S(U,X){F.push([U,X])}},13605:(U,X)=>{"use strict";var b="d",F="ax",E="fp",w="es",Q="rs",z="re",q="rb",p="bs",S="be",R="bb",n=[b,F,"vv",Q,z,q,"ri",p,S,R,"bi"];function a(U){var X="bruteForce"+(U?"Full":"Partial"),F=[],Q=n.slice();U||Q.splice(3,0,E);var z=["function "+X+"("+Q.join()+"){"];function q(X,E){var Q=function(U,X,F){var E="bruteForce"+(U?"Red":"Blue")+(X?"Flip":"")+(F?"Full":""),Q=["function ",E,"(",n.join(),"){","var ",w,"=2*",b,";"],z="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",q="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(F?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return U?Q.push(z,"Q",":",q):Q.push(q,"Q",":",z),F?Q.push("if(y1<x0||x1<y0)continue;"):X?Q.push("if(y0<=x0||x1<y0)continue;"):Q.push("if(y0<x0||x1<y0)continue;"),Q.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),X?Q.push("yi,xi"):Q.push("xi,yi"),Q.push(");if(rv!==void 0)return rv;}}}"),{name:E,code:Q.join("")}}(X,E,U);F.push(Q.code),z.push("return "+Q.name+"("+n.join()+");")}z.push("if(re-rs>be-bs){"),U?(q(!0,!1),z.push("}else{"),q(!1,!1)):(z.push("if(fp){"),q(!0,!0),z.push("}else{"),q(!0,!1),z.push("}}else{if(fp){"),q(!1,!0),z.push("}else{"),q(!1,!1),z.push("}")),z.push("}}return "+X);var p=F.join("")+z.join("");return new Function(p)()}X.partial=a(!1),X.full=a(!0)},13599:(U,X,b)=>{"use strict";U.exports=function(U,X,b,w,S,d,k,v,A){!function(U,X){var b=8*E.log2(X+1)*(U+1)|0,w=E.nextPow2(u*b);P.length<w&&(F.free(P),P=F.mallocInt32(w));var Q=E.nextPow2(i*b);f.length<Q&&(F.free(f),f=F.mallocDouble(Q))}(U,w+k);var s,h=0,B=2*U;j(h++,0,0,w,0,k,b?16:0,-1/0,1/0),b||j(h++,0,0,k,0,w,1,-1/0,1/0);for(;h>0;){var o=(h-=1)*u,y=P[o],t=P[o+1],W=P[o+2],Y=P[o+3],K=P[o+4],V=P[o+5],g=h*i,L=f[g],D=f[g+1],G=1&V,Z=!!(16&V),c=S,r=d,M=v,H=A;if(G&&(c=v,r=A,M=S,H=d),!(2&V&&t>=(W=x(U,y,t,W,c,r,D)))&&!(4&V&&(t=I(U,y,t,W,c,r,L))>=W)){var T=W-t,C=K-Y;if(Z){if(U*T*(T+C)<a){if(void 0!==(s=q.scanComplete(U,y,X,t,W,c,r,Y,K,M,H)))return s;continue}}else{if(U*Math.min(T,C)<R){if(void 0!==(s=Q(U,y,X,G,t,W,c,r,Y,K,M,H)))return s;continue}if(U*T*C<n){if(void 0!==(s=q.scanBipartite(U,y,X,G,t,W,c,r,Y,K,M,H)))return s;continue}}var UU=J(U,y,t,W,c,r,L,D);if(t<UU)if(U*(UU-t)<R){if(void 0!==(s=z(U,y+1,X,t,UU,c,r,Y,K,M,H)))return s}else if(y===U-2){if(void 0!==(s=G?q.sweepBipartite(U,X,Y,K,M,H,t,UU,c,r):q.sweepBipartite(U,X,t,UU,c,r,Y,K,M,H)))return s}else j(h++,y+1,t,UU,Y,K,G,-1/0,1/0),j(h++,y+1,Y,K,t,UU,1^G,-1/0,1/0);if(UU<W){var XU=p(U,y,Y,K,M,H),bU=M[B*XU+y],FU=m(U,y,XU,K,M,H,bU);if(FU<K&&j(h++,y,UU,W,FU,K,(4|G)+(Z?16:0),bU,D),Y<XU&&j(h++,y,UU,W,Y,XU,(2|G)+(Z?16:0),L,bU),XU+1===FU){if(void 0!==(s=Z?l(U,y,X,UU,W,c,r,XU,M,H[XU]):e(U,y,X,G,UU,W,c,r,XU,M,H[XU])))return s}else if(XU<FU){var EU;if(Z){if(UU<(EU=O(U,y,UU,W,c,r,bU))){var wU=m(U,y,UU,EU,c,r,bU);if(y===U-2){if(UU<wU&&void 0!==(s=q.sweepComplete(U,X,UU,wU,c,r,XU,FU,M,H)))return s;if(wU<EU&&void 0!==(s=q.sweepBipartite(U,X,wU,EU,c,r,XU,FU,M,H)))return s}else UU<wU&&j(h++,y+1,UU,wU,XU,FU,16,-1/0,1/0),wU<EU&&(j(h++,y+1,wU,EU,XU,FU,0,-1/0,1/0),j(h++,y+1,XU,FU,wU,EU,1,-1/0,1/0))}}else UU<(EU=G?N(U,y,UU,W,c,r,bU):O(U,y,UU,W,c,r,bU))&&(y===U-2?s=G?q.sweepBipartite(U,X,XU,FU,M,H,UU,EU,c,r):q.sweepBipartite(U,X,UU,EU,c,r,XU,FU,M,H):(j(h++,y+1,UU,EU,XU,FU,G,-1/0,1/0),j(h++,y+1,XU,FU,UU,EU,1^G,-1/0,1/0)))}}}}};var F=b(13558),E=b(13567),w=b(13605),Q=w.partial,z=w.full,q=b(13584),p=b(13614),S=b(13622),R=128,n=1<<22,a=1<<22,J=S("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),m=S("lo===p0",["p0"]),x=S("lo<p0",["p0"]),I=S("hi<=p0",["p0"]),O=S("lo<=p0&&p0<=hi",["p0"]),N=S("lo<p0&&p0<=hi",["p0"]),u=6,i=2,P=F.mallocInt32(1024),f=F.mallocDouble(1024);function j(U,X,b,F,E,w,Q,z,q){var p=u*U;P[p]=X,P[p+1]=b,P[p+2]=F,P[p+3]=E,P[p+4]=w,P[p+5]=Q;var S=i*U;f[S]=z,f[S+1]=q}function e(U,X,b,F,E,w,Q,z,q,p,S){var R=2*U,n=q*R,a=p[n+X];U:for(var J=E,m=E*R;J<w;++J,m+=R){var x=Q[m+X],I=Q[m+X+U];if(!(a<x||I<a)&&(!F||a!==x)){for(var O,N=z[J],u=X+1;u<U;++u){x=Q[m+u],I=Q[m+u+U];var i=p[n+u],P=p[n+u+U];if(I<i||P<x)continue U}if(void 0!==(O=F?b(S,N):b(N,S)))return O}}}function l(U,X,b,F,E,w,Q,z,q,p){var S=2*U,R=z*S,n=q[R+X];U:for(var a=F,J=F*S;a<E;++a,J+=S){var m=Q[a];if(m!==p){var x=w[J+X],I=w[J+X+U];if(!(n<x||I<n)){for(var O=X+1;O<U;++O){x=w[J+O],I=w[J+O+U];var N=q[R+O],u=q[R+O+U];if(I<N||u<x)continue U}var i=b(m,p);if(void 0!==i)return i}}}}},13614:(U,X,b)=>{"use strict";U.exports=function(U,X,b,Q,z,q){if(Q<=b+1)return b;var p=b,S=Q,R=Q+b>>>1,n=2*U,a=R,J=z[n*R+X];for(;p<S;){if(S-p<E){w(U,X,p,S,z,q),J=z[n*R+X];break}var m=S-p,x=Math.random()*m+p|0,I=z[n*x+X],O=Math.random()*m+p|0,N=z[n*O+X],u=Math.random()*m+p|0,i=z[n*u+X];I<=N?i>=N?(a=O,J=N):I>=i?(a=x,J=I):(a=u,J=i):N>=i?(a=O,J=N):i>=I?(a=x,J=I):(a=u,J=i);for(var P=n*(S-1),f=n*a,j=0;j<n;++j,++P,++f){var e=z[P];z[P]=z[f],z[f]=e}var l=q[S-1];q[S-1]=q[a],q[a]=l;for(P=n*(S-1),f=n*(a=F(U,X,p,S-1,z,q,J)),j=0;j<n;++j,++P,++f){e=z[P];z[P]=z[f],z[f]=e}l=q[S-1];if(q[S-1]=q[a],q[a]=l,R<a){for(S=a-1;p<S&&z[n*(S-1)+X]===J;)S-=1;S+=1}else{if(!(a<R))break;for(p=a+1;p<S&&z[n*p+X]===J;)p+=1}}return F(U,X,b,R,z,q,z[n*R+X])};var F=b(13622)("lo<p0",["p0"]),E=8;function w(U,X,b,F,E,w){for(var Q=2*U,z=Q*(b+1)+X,q=b+1;q<F;++q,z+=Q)for(var p=E[z],S=q,R=Q*(q-1);S>b&&E[R+X]>p;--S,R-=Q){for(var n=R,a=R+Q,J=0;J<Q;++J,++n,++a){var m=E[n];E[n]=E[a],E[a]=m}var x=w[S];w[S]=w[S-1],w[S-1]=x}}},13622:U=>{"use strict";U.exports=function(U,b){var F="abcdef".split("").concat(b),E=[];U.indexOf("lo")>=0&&E.push("lo=e[k+n]");U.indexOf("hi")>=0&&E.push("hi=e[k+o]");return F.push(X.replace("_",E.join()).replace("$",U)),Function.apply(void 0,F)};var X="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13590:U=>{"use strict";U.exports=function(U,F){F<=4*X?b(0,F-1,U):p(0,F-1,U)};var X=32;function b(U,X,b){for(var F=2*(U+1),E=U+1;E<=X;++E){for(var w=b[F++],Q=b[F++],z=E,q=F-2;z-- >U;){var p=b[q-2],S=b[q-1];if(p<w)break;if(p===w&&S<Q)break;b[q]=p,b[q+1]=S,q-=2}b[q]=w,b[q+1]=Q}}function F(U,X,b){X*=2;var F=b[U*=2],E=b[U+1];b[U]=b[X],b[U+1]=b[X+1],b[X]=F,b[X+1]=E}function E(U,X,b){X*=2,b[U*=2]=b[X],b[U+1]=b[X+1]}function w(U,X,b,F){X*=2,b*=2;var E=F[U*=2],w=F[U+1];F[U]=F[X],F[U+1]=F[X+1],F[X]=F[b],F[X+1]=F[b+1],F[b]=E,F[b+1]=w}function Q(U,X,b,F,E){X*=2,E[U*=2]=E[X],E[X]=b,E[U+1]=E[X+1],E[X+1]=F}function z(U,X,b){X*=2;var F=b[U*=2],E=b[X];return!(F<E)&&(F!==E||b[U+1]>b[X+1])}function q(U,X,b,F){var E=F[U*=2];return E<X||E===X&&F[U+1]<b}function p(U,S,R){var n=(S-U+1)/6|0,a=U+n,J=S-n,m=U+S>>1,x=m-n,I=m+n,O=a,N=x,u=m,i=I,P=J,f=U+1,j=S-1,e=0;z(O,N,R)&&(e=O,O=N,N=e),z(i,P,R)&&(e=i,i=P,P=e),z(O,u,R)&&(e=O,O=u,u=e),z(N,u,R)&&(e=N,N=u,u=e),z(O,i,R)&&(e=O,O=i,i=e),z(u,i,R)&&(e=u,u=i,i=e),z(N,P,R)&&(e=N,N=P,P=e),z(N,u,R)&&(e=N,N=u,u=e),z(i,P,R)&&(e=i,i=P,P=e);for(var l=R[2*N],d=R[2*N+1],k=R[2*i],v=R[2*i+1],A=2*O,s=2*u,h=2*P,B=2*a,o=2*m,y=2*J,t=0;t<2;++t){var W=R[A+t],Y=R[s+t],K=R[h+t];R[B+t]=W,R[o+t]=Y,R[y+t]=K}E(x,U,R),E(I,S,R);for(var V=f;V<=j;++V)if(q(V,l,d,R))V!==f&&F(V,f,R),++f;else if(!q(V,k,v,R))for(;;){if(q(j,k,v,R)){q(j,l,d,R)?(w(V,f,j,R),++f,--j):(F(V,j,R),--j);break}if(--j<V)break}Q(U,f-1,l,d,R),Q(S,j+1,k,v,R),f-2-U<=X?b(U,f-2,R):p(U,f-2,R),S-(j+2)<=X?b(j+2,S,R):p(j+2,S,R),j-f<=X?b(f,j,R):p(f,j,R)}},13584:(U,X,b)=>{"use strict";U.exports={init:function(U){var X=E.nextPow2(U);q.length<X&&(F.free(q),q=F.mallocInt32(X));p.length<X&&(F.free(p),p=F.mallocInt32(X));S.length<X&&(F.free(S),S=F.mallocInt32(X));R.length<X&&(F.free(R),R=F.mallocInt32(X));n.length<X&&(F.free(n),n=F.mallocInt32(X));a.length<X&&(F.free(a),a=F.mallocInt32(X));var b=8*X;J.length<b&&(F.free(J),J=F.mallocDouble(b))},sweepBipartite:function(U,X,b,F,E,z,n,a,I,O){for(var N=0,u=2*U,i=U-1,P=u-1,f=b;f<F;++f){var j=z[f],e=u*f;J[N++]=E[e+i],J[N++]=-(j+1),J[N++]=E[e+P],J[N++]=j}for(f=n;f<a;++f){j=O[f]+Q;var l=u*f;J[N++]=I[l+i],J[N++]=-j,J[N++]=I[l+P],J[N++]=j}var d=N>>>1;w(J,d);var k=0,v=0;for(f=0;f<d;++f){var A=0|J[2*f+1];if(A>=Q)m(S,R,v--,A=A-Q|0);else if(A>=0)m(q,p,k--,A);else if(A<=-Q){A=-A-Q|0;for(var s=0;s<k;++s){if(void 0!==(h=X(q[s],A)))return h}x(S,R,v++,A)}else{A=-A-1|0;for(s=0;s<v;++s){var h;if(void 0!==(h=X(A,S[s])))return h}x(q,p,k++,A)}}},sweepComplete:function(U,X,b,F,E,Q,z,I,O,N){for(var u=0,i=2*U,P=U-1,f=i-1,j=b;j<F;++j){var e=Q[j]+1<<1,l=i*j;J[u++]=E[l+P],J[u++]=-e,J[u++]=E[l+f],J[u++]=e}for(j=z;j<I;++j){e=N[j]+1<<1;var d=i*j;J[u++]=O[d+P],J[u++]=1|-e,J[u++]=O[d+f],J[u++]=1|e}var k=u>>>1;w(J,k);var v=0,A=0,s=0;for(j=0;j<k;++j){var h=0|J[2*j+1],B=1&h;if(j<k-1&&h>>1===J[2*j+3]>>1&&(B=2,j+=1),h<0){for(var o=-(h>>1)-1,y=0;y<s;++y){if(void 0!==(t=X(n[y],o)))return t}if(0!==B)for(y=0;y<v;++y){if(void 0!==(t=X(q[y],o)))return t}if(1!==B)for(y=0;y<A;++y){var t;if(void 0!==(t=X(S[y],o)))return t}0===B?x(q,p,v++,o):1===B?x(S,R,A++,o):2===B&&x(n,a,s++,o)}else{o=(h>>1)-1;0===B?m(q,p,v--,o):1===B?m(S,R,A--,o):2===B&&m(n,a,s--,o)}}},scanBipartite:function(U,X,b,F,E,z,S,R,n,a,I,O){var N=0,u=2*U,i=X,P=X+U,f=1,j=1;F?j=Q:f=Q;for(var e=E;e<z;++e){var l=e+f,d=u*e;J[N++]=S[d+i],J[N++]=-l,J[N++]=S[d+P],J[N++]=l}for(e=n;e<a;++e){l=e+j;var k=u*e;J[N++]=I[k+i],J[N++]=-l}var v=N>>>1;w(J,v);var A=0;for(e=0;e<v;++e){var s=0|J[2*e+1];if(s<0){var h=!1;if((l=-s)>=Q?(h=!F,l-=Q):(h=!!F,l-=1),h)x(q,p,A++,l);else{var B=O[l],o=u*l,y=I[o+X+1],t=I[o+X+1+U];U:for(var W=0;W<A;++W){var Y=q[W],K=u*Y;if(!(t<S[K+X+1]||S[K+X+1+U]<y)){for(var V=X+2;V<U;++V)if(I[o+V+U]<S[K+V]||S[K+V+U]<I[o+V])continue U;var g,L=R[Y];if(void 0!==(g=F?b(B,L):b(L,B)))return g}}}}else m(q,p,A--,s-f)}},scanComplete:function(U,X,b,F,E,z,p,S,R,n,a){for(var m=0,x=2*U,I=X,O=X+U,N=F;N<E;++N){var u=N+Q,i=x*N;J[m++]=z[i+I],J[m++]=-u,J[m++]=z[i+O],J[m++]=u}for(N=S;N<R;++N){u=N+1;var P=x*N;J[m++]=n[P+I],J[m++]=-u}var f=m>>>1;w(J,f);var j=0;for(N=0;N<f;++N){var e=0|J[2*N+1];if(e<0){if((u=-e)>=Q)q[j++]=u-Q;else{var l=a[u-=1],d=x*u,k=n[d+X+1],v=n[d+X+1+U];U:for(var A=0;A<j;++A){var s=q[A],h=p[s];if(h===l)break;var B=x*s;if(!(v<z[B+X+1]||z[B+X+1+U]<k)){for(var o=X+2;o<U;++o)if(n[d+o+U]<z[B+o]||z[B+o+U]<n[d+o])continue U;var y=b(h,l);if(void 0!==y)return y}}}}else{for(u=e-Q,A=j-1;A>=0;--A)if(q[A]===u){for(o=A+1;o<j;++o)q[o-1]=q[o];break}--j}}}};var F=b(13558),E=b(13567),w=b(13590),Q=1<<28,z=1024,q=F.mallocInt32(z),p=F.mallocInt32(z),S=F.mallocInt32(z),R=F.mallocInt32(z),n=F.mallocInt32(z),a=F.mallocInt32(z),J=F.mallocDouble(8192);function m(U,X,b,F){var E=X[F],w=U[b-1];U[E]=w,X[w]=E}function x(U,X,b,F){U[b]=F,X[F]=b}},13569:U=>{"use strict";function X(U,b,F){var E=0|U[F];if(E<=0)return[];var w,Q=new Array(E);if(F===U.length-1)for(w=0;w<E;++w)Q[w]=b;else for(w=0;w<E;++w)Q[w]=X(U,b,F+1);return Q}U.exports=function(U,b){switch("undefined"===typeof b&&(b=0),typeof U){case"number":if(U>0)return function(U,X){var b,F;for(b=new Array(U),F=0;F<U;++F)b[F]=X;return b}(0|U,b);break;case"object":if("number"===typeof U.length)return X(U,b,0)}return[]}},13529:(U,X,b)=>{U.exports=function(){var U=this;this.components={},this.comps=this.components;var X=this.components,b=1,E={},w=[],Q=[],z={timeout:!1,removals:[],multiComps:[]};function q(U,b){var F=X[b],w=E[b],Q=w.hash[U];Q&&(w.remove(U),F.IX&&(F.multi?(Q.forEach((X=>{X&&F.IX(U,X)})),Q.length=0):F.IX(U,Q)),z.removals.push(w),p())}function p(){z.timeout||(z.timeout=!0,setTimeout(S,1))}function S(){z.timeout=!1,R()}function R(){z.multiComps.length&&function(U){for(var X=0;X<U.length;X++){var{entID:b,data:F}=U[X],E=F.hash[b];if(E){for(var w=0;w<E.length;w++)E[w]||(E.splice(w,1),w--);0===E.length&&(F.remove(b),z.removals.push(F))}}U.length=0}(z.multiComps),z.removals.length&&function(U){for(var X=0;X<U.length;X++){U[X].flush()}U.length=0}(z.removals)}this.iR=E,this._systems=w,this._renderSystems=Q,this.SS=function(X){var F=b++;return Array.isArray(X)&&X.forEach((X=>U.Zq(F,X))),F},this.deleteEntity=function(X){return Object.keys(E).forEach((U=>{E[U].hash[X]&&q(X,U)})),U},this.eS=function(U){if(!U)throw new Error("Missing component definition");var b=U.name;if(!b)throw new Error("Component definition must have a name property.");if("string"!==typeof b)throw new Error("Component name must be a string.");if(""===b)throw new Error("Component name must be a non-empty string.");if(E[b])throw new Error(`Component ${b} already exists.`);var z={};return z.name=b,z.multi=!!U.multi,z.order=isNaN(U.order)?99:U.order,z.stateConstructor=U.stateConstructor||null,z.state=U.state||{},z.Lz=U.Lz||null,z.IX=U.IX||null,z.system=U.system||null,z.Mz=U.Mz||null,X[b]=z,E[b]=new F,E[b]._pendingMultiCleanup=!1,E[b]._multiCleanupIDs=z.multi?[]:null,z.system&&(w.push(b),w.sort(((U,b)=>X[U].order-X[b].order))),z.Mz&&(Q.push(b),Q.sort(((U,b)=>X[U].order-X[b].order))),b},this.overwriteComponent=function(U,b){var F=X[U];if(!F)throw new Error(`Unknown component: ${U}`);if(!b)throw new Error("Missing component definition");if(F.name!==b.name)throw new Error("Overwriting component must use the same name property.");var z={};z.name=U,z.multi=!!b.multi,z.order=isNaN(b.order)?99:b.order,z.state=b.state||{},z.Lz=b.Lz||null,z.IX=b.IX||null,z.system=b.system||null,z.Mz=b.Mz||null,X[U]=z,E[U]._pendingMultiCleanup=!1,E[U]._multiCleanupIDs=z.multi?[]:null;var q=w.indexOf(U);z.system&&q<0&&w.push(U),!z.system&&q>=0&&w.splice(q,1),w.sort(((U,b)=>X[U].order-X[b].order));var p=Q.indexOf(U);z.Mz&&p<0&&Q.push(U),!z.Mz&&p>=0&&Q.splice(p,1),Q.sort(((U,b)=>X[U].order-X[b].order));var S=z.state;return this.Gp(U).forEach((U=>{for(var X in S)X in U||(U[X]=S[X]);z.Lz&&z.Lz(U.cz,U)})),U},this.deleteComponent=function(b){var F=E[b];if(!F)throw new Error(`Unknown component: ${b}`);F.flush(),F.list.forEach((U=>{U&&q(U.cz||U[0].cz,b)}));var z=w.indexOf(b),p=Q.indexOf(b);return z>-1&&w.splice(z,1),p>-1&&Q.splice(p,1),E[b].dispose(),delete E[b],delete X[b],U},this.Zq=function(U,b,F){var w,Q=X[b],z=E[b];if(!z)throw new Error(`Unknown component: ${b}.`);if(z.hash[U]&&!Q.multi)throw new Error(`Entity ${U} already has component: ${b}.`);if(Q.stateConstructor){if(!(w=new Q.stateConstructor).hasOwnProperty("cz"))throw new Error(`Component ${Q.name} stateConstructor type does not have property __id`)}else w=Object.assign({},{cz:U},Q.state,F);if(w.cz=U,Q.multi){var q=z.hash[U];q||(q=[],z.add(U,q)),q.push(w)}else z.add(U,w);return Q.Lz&&Q.Lz(U,w),this},this.Fp=function(U,X){var b=E[X];if(!b)throw new Error(`Unknown component: ${X}.`);return!!b.hash[U]},this.Hq=function(X,b){if(!E[b])throw new Error(`Unknown component: ${b}.`);return q(X,b),U},this.getState=function(U,X){var b=E[X];if(!b)throw new Error(`Unknown component: ${X}.`);return b.hash[U]},this.Gp=function(U){var X=E[U];if(!X)throw new Error(`Unknown component: ${U}.`);return R(),X.list},this.Ra=function(U){if(!E[U])throw new Error(`Unknown component: ${U}.`);var X=E[U].hash;return U=>X[U]},this.Ja=function(U){if(!E[U])throw new Error(`Unknown component: ${U}.`);var X=E[U].hash;return U=>!!X[U]},this.Vz=function(b){R();for(var F=0;F<w.length;F++){var Q=w[F],z=X[Q],q=E[Q];z.system(b,q.list),R()}return U},this.render=function(b){R();for(var F=0;F<Q.length;F++){var w=Q[F],z=X[w],q=E[w];z.Mz(b,q.list),R()}return U},this.removeMultiComponent=function(b,F,w){var Q=X[F],q=E[F];if(!q)throw new Error(`Unknown component: ${F}.`);if(!Q.multi)throw new Error("removeMultiComponent called on non-multi component");return function(U,X,b,F){var E=b.hash[U];if(E){var w=E[F];w&&(E[F]=null,X.IX&&X.IX(U,w),z.multiComps.push({entID:U,data:b}),p())}}(b,Q,q,w),U}};var F=b(13532)},13532:U=>{function X(U,X){var b=U._map[X];if(delete U.hash[X],delete U._map[X],b===U.list.length-1)U.list.pop();else{var F=U.list.pop();if(U.list[b]=F,null===F||null===F[0]){var E=U.list.length;for(var w in U._map)if(U._map[w]===E)return void(U._map[w]=b)}else{var Q=F.cz||F[0].cz;U._map[Q]=b}}}U.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(U,X){if("number"===typeof this._map[U]){var b=this._map[U];this.hash[U]=X,this.list[b]=X}else this._map[U]=this.list.length,this.hash[U]=X,this.list.push(X)}remove(U){var X=this._map[U];this.hash[U]=null,this.list[X]=null,this._pendingRemovals.push(U)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var U=0;U<this._pendingRemovals.length;U++){var b=this._pendingRemovals[U];null===this.hash[b]&&X(this,b)}this._pendingRemovals.length=0}}},13489:U=>{"use strict";var X,b="object"===typeof Reflect?Reflect:null,F=function(U,X,b){return Function.prototype.apply.call(U,X,b)};X=b&&"function"===typeof b.ownKeys?b.ownKeys:Object.getOwnPropertySymbols?function(U){return Object.getOwnPropertyNames(U).concat(Object.getOwnPropertySymbols(U))}:function(U){return Object.getOwnPropertyNames(U)};var E=Number.isNaN||function(U){return U!==U};function w(){w.init.call(this)}U.exports=w,U.exports.once=function(U,X){return new Promise((function(b,F){function E(b){U.removeListener(X,w),F(b)}function w(){"function"===typeof U.removeListener&&U.removeListener("error",E),b([].slice.call(arguments))}m(U,X,w,{once:!0}),"error"!==X&&function(U,X,b){"function"===typeof U.on&&m(U,"error",X,b)}(U,E,{once:!0})}))},w.EventEmitter=w,w.prototype._events=void 0,w.prototype._eventsCount=0,w.prototype._maxListeners=void 0;var Q=10;function z(U){if("function"!==typeof U)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof U)}function q(U){return void 0===U._maxListeners?w.defaultMaxListeners:U._maxListeners}function p(U,X,b,F){var E,w,Q,p;if(z(b),void 0===(w=U._events)?(w=U._events=Object.create(null),U._eventsCount=0):(void 0!==w.newListener&&(U.emit("newListener",X,b.listener?b.listener:b),w=U._events),Q=w[X]),void 0===Q)Q=w[X]=b,++U._eventsCount;else if("function"===typeof Q?Q=w[X]=F?[b,Q]:[Q,b]:F?Q.unshift(b):Q.push(b),(E=q(U))>0&&Q.length>E&&!Q.warned){Q.warned=!0;var S=new Error("Possible EventEmitter memory leak detected. "+Q.length+" "+String(X)+" listeners added. Use emitter.setMaxListeners() to increase limit");S.name="MaxListenersExceededWarning",S.FX=U,S.type=X,S.count=Q.length,p=S,console&&console.warn&&console.warn(p)}return U}function S(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function R(U,X,b){var F={fired:!1,wrapFn:void 0,target:U,type:X,listener:b},E=S.bind(F);return E.listener=b,F.wrapFn=E,E}function n(U,X,b){var F=U._events;if(void 0===F)return[];var E=F[X];return void 0===E?[]:"function"===typeof E?b?[E.listener||E]:[E]:b?function(U){for(var X=new Array(U.length),b=0;b<X.length;++b)X[b]=U[b].listener||U[b];return X}(E):J(E,E.length)}function a(U){var X=this._events;if(void 0!==X){var b=X[U];if("function"===typeof b)return 1;if(void 0!==b)return b.length}return 0}function J(U,X){for(var b=new Array(X),F=0;F<X;++F)b[F]=U[F];return b}function m(U,X,b,F){if("function"===typeof U.on)F.once?U.once(X,b):U.on(X,b);else{if("function"!==typeof U.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof U);U.addEventListener(X,(function E(w){F.once&&U.removeEventListener(X,E),b(w)}))}}Object.defineProperty(w,"defaultMaxListeners",{enumerable:!0,get:function(){return Q},set:function(U){if("number"!==typeof U||U<0||E(U))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+U+".");Q=U}}),w.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},w.prototype.setMaxListeners=function(U){if("number"!==typeof U||U<0||E(U))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+U+".");return this._maxListeners=U,this},w.prototype.getMaxListeners=function(){return q(this)},w.prototype.emit=function(U){for(var X=[],b=1;b<arguments.length;b++)X.push(arguments[b]);var E="error"===U,w=this._events;if(void 0!==w)E=E&&void 0===w.error;else if(!E)return!1;if(E){var Q;if(X.length>0&&(Q=X[0]),Q instanceof Error)throw Q;var z=new Error("Unhandled error."+(Q?" ("+Q.message+")":""));throw z.context=Q,z}var q=w[U];if(void 0===q)return!1;if("function"===typeof q)F(q,this,X);else{var p=q.length,S=J(q,p);for(b=0;b<p;++b)F(S[b],this,X)}return!0},w.prototype.addListener=function(U,X){return p(this,U,X,!1)},w.prototype.on=w.prototype.addListener,w.prototype.prependListener=function(U,X){return p(this,U,X,!0)},w.prototype.once=function(U,X){return z(X),this.on(U,R(this,U,X)),this},w.prototype.prependOnceListener=function(U,X){return z(X),this.prependListener(U,R(this,U,X)),this},w.prototype.removeListener=function(U,X){var b,F,E,w,Q;if(z(X),void 0===(F=this._events))return this;if(void 0===(b=F[U]))return this;if(b===X||b.listener===X)0===--this._eventsCount?this._events=Object.create(null):(delete F[U],F.removeListener&&this.emit("removeListener",U,b.listener||X));else if("function"!==typeof b){for(E=-1,w=b.length-1;w>=0;w--)if(b[w]===X||b[w].listener===X){Q=b[w].listener,E=w;break}if(E<0)return this;0===E?b.shift():function(U,X){for(;X+1<U.length;X++)U[X]=U[X+1];U.pop()}(b,E),1===b.length&&(F[U]=b[0]),void 0!==F.removeListener&&this.emit("removeListener",U,Q||X)}return this},w.prototype.off=w.prototype.removeListener,w.prototype.EX=function(U){var X,b,F;if(void 0===(b=this._events))return this;if(void 0===b.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==b[U]&&(0===--this._eventsCount?this._events=Object.create(null):delete b[U]),this;if(0===arguments.length){var E,w=Object.keys(b);for(F=0;F<w.length;++F)"removeListener"!==(E=w[F])&&this.EX(E);return this.EX("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(X=b[U]))this.removeListener(U,X);else if(void 0!==X)for(F=X.length-1;F>=0;F--)this.removeListener(U,X[F]);return this},w.prototype.listeners=function(U){return n(this,U,!0)},w.prototype.rawListeners=function(U){return n(this,U,!1)},w.listenerCount=function(U,X){return"function"===typeof U.listenerCount?U.listenerCount(X):a.call(U,X)},w.prototype.listenerCount=a,w.prototype.eventNames=function(){return this._eventsCount>0?X(this._events):[]}},13819:U=>{"use strict";U.exports=function(U,X,b,F,E,w){var Q=+X[0],z=+X[1],q=+X[2],p=+b[0],S=+b[1],R=+b[2],n=Math.sqrt(p*p+S*S+R*R);if(0===n)throw new Error("Can't raycast along a zero vector");return function(U,X,b,F,E,w,Q,z,q,p){for(var S=0,R=Math.floor,n=0|R(X),a=0|R(b),J=0|R(F),m=E>0?1:-1,x=w>0?1:-1,I=Q>0?1:-1,O=Math.abs(1/E),N=Math.abs(1/w),u=Math.abs(1/Q),i=O<1/0?O*(m>0?n+1-X:X-n):1/0,P=N<1/0?N*(x>0?a+1-b:b-a):1/0,f=u<1/0?u*(I>0?J+1-F:F-J):1/0,j=-1;S<=z;){var e=U(n,a,J);if(e)return q&&(q[0]=X+S*E,q[1]=b+S*w,q[2]=F+S*Q),p&&(p[0]=p[1]=p[2]=0,0===j&&(p[0]=-m),1===j&&(p[1]=-x),2===j&&(p[2]=-I)),e;i<P?i<f?(n+=m,S=i,i+=O,j=0):(J+=I,S=f,f+=u,j=2):P<f?(a+=x,S=P,P+=N,j=1):(J+=I,S=f,f+=u,j=2)}return q&&(q[0]=X+S*E,q[1]=b+S*w,q[2]=F+S*Q),p&&(p[0]=p[1]=p[2]=0),0}(U,Q,z,q,p/=n,S/=n,R/=n,F="undefined"===typeof F?64:+F,E,w)}},13843:(U,X,b)=>{"use strict";b.d(X,{d:()=>w});var F=b(13489);function E(){this.Sn=!1,this.stopPropagation=!1,this.Rn=!1,this.disabled=!1}class w{constructor(U,X){this.version="0.7.0";var b=Object.assign({},new E,X||{});this.element=U||document,this.Sn=!!b.Sn,this.stopPropagation=!!b.stopPropagation,this.Rn=!!b.Rn,this.disabled=!!b.disabled,this.filterEvents=(U,X)=>!0,this.down=new F.EventEmitter,this.up=new F.EventEmitter,this.state={},this.Yp={dx:0,dy:0,ba:0,Wp:0,Fa:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?z(this):document.addEventListener("DOMContentLoaded",(U=>{z(this)}),{once:!0})}bind(U){for(var X=arguments.length,b=new Array(X>1?X-1:0),F=1;F<X;F++)b[F-1]=arguments[F];b.forEach((X=>{var b=this._keyBindmap[X]||[];b.includes(U)||(b.push(U),this._keyBindmap[X]=b)})),this.state[U]=!!this.state[U],this.pressCount[U]=this.pressCount[U]||0,this.releaseCount[U]=this.releaseCount[U]||0}unbind(U){for(var X in this._keyBindmap){var b=this._keyBindmap[X],F=b.indexOf(U);F>-1&&b.splice(F,1)}}getBindings(){var U={};for(var X in this._keyBindmap){this._keyBindmap[X].forEach((b=>{U[b]=U[b]||[],U[b].push(X)}))}return U}Vz(){Q(this.Yp),Q(this.pressCount),Q(this.releaseCount)}}function Q(U){for(var X in U)U[X]=0}function z(U){window.addEventListener("keydown",J.bind(null,U,!0),!1),window.addEventListener("keyup",J.bind(null,U,!1),!1);var X={passive:!0};U.element.addEventListener("touchstart",R.bind(void 0,U),{passive:!1}),U.element.addEventListener("touchend",a.bind(void 0,U),X),U.element.addEventListener("mousedown",m.bind(null,U,!0),X),window.document.addEventListener("mouseup",m.bind(null,U,!1),X),U.element.addEventListener("touchmove",x.bind(null,U),X),U.element.addEventListener("mousemove",x.bind(null,U),X),window.PointerEvent,U.element.addEventListener("wheel",I.bind(null,U),X),U.element.addEventListener("contextmenu",O.bind(null,U),!1),window.addEventListener("blur",N.bind(null,U),!1)}var q=0,p=0,S=null;function R(U,X){X.preventDefault(),n(X)}function n(U){let X=!1;for(let b=0;b<U.touches.length;++b)if(U.touches[b].identifier===S){X=!0;break}if(!X){const X=U.changedTouches[0];q=X.clientX,p=X.clientY,S=X.identifier}}function a(U,X){for(var b=X.changedTouches,F=0;F<b.length;++F)b[F].identifier===S&&(S=null)}function J(U,X,b){u(b.code,X,U,b)}function m(U,X,b){if("pointerId"in b)if(X){if(null!==U._touches.currID)return;U._touches.currID=b.pointerId}else{if(U._touches.currID!==b.pointerId)return;U._touches.currID=null}return u("Mouse"+("button"in b?b.button+1:1),X,U,b),!1}function x(U,X){var b=X.movementX||X.mozMovementX||0,F=X.movementY||X.mozMovementY||0;if(X.touches&&0===(b|F)){var E=function(U){n(U);for(let X=0;X<U.changedTouches.length;++X)if(U.changedTouches[X].identifier==S){const b=U.changedTouches[X],F=[b.clientX-q,b.clientY-p];return q=b.clientX,p=b.clientY,F}return console.error(`Did not find touch id ${S}`),[0,0]}(X);b=E[0],F=E[1]}U.Yp.dx+=b,U.Yp.dy+=F}function I(U,X){var b=1;switch(X.deltaMode){case 0:b=1;break;case 1:b=12;break;case 2:b=U.element.clientHeight||window.innerHeight}U.Yp.ba+=(X.deltaX||0)*b,U.Yp.Wp+=(X.deltaY||0)*b,U.Yp.Fa+=(X.deltaZ||0)*b}function O(U,X){if(!U.Rn)return X.preventDefault(),!1}function N(U){for(var X in U._keyStates)U._keyStates[X]&&(/^Mouse\d/.test(X)||u(X,!1,U,{code:X,note:"80e0shx7njg",preventDefault:()=>{},stopPropagation:()=>{}}))}function u(U,X,b,F){var E=b._keyBindmap[U];E&&(i(b._keyStates[U],X)&&(b._keyStates[U]=X,E.forEach((U=>{(!b.filterEvents||b.filterEvents(F,U))&&function(U,X,b,F){var E=X?b.pressCount:b.releaseCount;E[U]=(E[U]||0)+1;var w=b._bindPressCount[U]||0;(w+=X?1:-1)<0&&(w=0);b._bindPressCount[U]=w;var Q=b.state[U];if(i(Q,w)){b.state[U]=w>0;var z=X?b.down:b.up;b.disabled||z.emit(U,F)}}(U,X,b,F)}))),"button"in F||(b.Sn&&!F.defaultPrevented&&F.preventDefault(),b.stopPropagation&&F.stopPropagation()))}function i(U,X){return U?!X:X}},12493:U=>{U.exports=function(U,X,b){return U[0]=X[0]+b[0],U[1]=X[1]+b[1],U[2]=X[2]+b[2],U}},12440:(U,X,b)=>{U.exports=function(U,X){var b=F(U[0],U[1],U[2]),Q=F(X[0],X[1],X[2]);E(b,b),E(Q,Q);var z=w(b,Q);return z>1?0:Math.acos(z)};var F=b(12447),E=b(12453),w=b(12461)},12551:U=>{U.exports=function(U,X){return U[0]=Math.ceil(X[0]),U[1]=Math.ceil(X[1]),U[2]=Math.ceil(X[2]),U}},12432:U=>{U.exports=function(U){var X=new Float32Array(3);return X[0]=U[0],X[1]=U[1],X[2]=U[2],X}},12468:U=>{U.exports=function(U,X){return U[0]=X[0],U[1]=X[1],U[2]=X[2],U}},12429:U=>{U.exports=function(){var U=new Float32Array(3);return U[0]=0,U[1]=0,U[2]=0,U}},12618:U=>{U.exports=function(U,X,b){var F=X[0],E=X[1],w=X[2],Q=b[0],z=b[1],q=b[2];return U[0]=E*q-w*z,U[1]=w*Q-F*q,U[2]=F*z-E*Q,U}},12577:(U,X,b)=>{U.exports=b(12574)},12574:U=>{U.exports=function(U,X){var b=X[0]-U[0],F=X[1]-U[1],E=X[2]-U[2];return Math.sqrt(b*b+F*F+E*E)}},12526:(U,X,b)=>{U.exports=b(12522)},12522:U=>{U.exports=function(U,X,b){return U[0]=X[0]/b[0],U[1]=X[1]/b[1],U[2]=X[2]/b[2],U}},12461:U=>{U.exports=function(U,X){return U[0]*X[0]+U[1]*X[1]+U[2]*X[2]}},12420:U=>{U.exports=1e-6},12480:(U,X,b)=>{U.exports=function(U,X){var b=U[0],E=U[1],w=U[2],Q=X[0],z=X[1],q=X[2];return Math.abs(b-Q)<=F*Math.max(1,Math.abs(b),Math.abs(Q))&&Math.abs(E-z)<=F*Math.max(1,Math.abs(E),Math.abs(z))&&Math.abs(w-q)<=F*Math.max(1,Math.abs(w),Math.abs(q))};var F=b(12420)},12487:U=>{U.exports=function(U,X){return U[0]===X[0]&&U[1]===X[1]&&U[2]===X[2]}},12545:U=>{U.exports=function(U,X){return U[0]=Math.floor(X[0]),U[1]=Math.floor(X[1]),U[2]=Math.floor(X[2]),U}},12663:(U,X,b)=>{U.exports=function(U,X,b,E,w,Q){var z,q;X||(X=3);b||(b=0);q=E?Math.min(E*X+b,U.length):U.length;for(z=b;z<q;z+=X)F[0]=U[z],F[1]=U[z+1],F[2]=U[z+2],w(F,F,Q),U[z]=F[0],U[z+1]=F[1],U[z+2]=F[2];return U};var F=b(12429)()},12447:U=>{U.exports=function(U,X,b){var F=new Float32Array(3);return F[0]=U,F[1]=X,F[2]=b,F}},12411:(U,X,b)=>{U.exports={EPSILON:b(12420),create:b(12429),clone:b(12432),angle:b(12440),Az:b(12447),k:b(12468),set:b(12477),equals:b(12480),exactEquals:b(12487),add:b(12493),mX:b(12502),sub:b(12508),multiply:b(12513),mul:b(12519),divide:b(12522),div:b(12526),min:b(12532),max:b(12537),floor:b(12545),ceil:b(12551),round:b(12560),scale:b(12562),sz:b(12567),distance:b(12574),i:b(12577),squaredDistance:b(12583),sqrDist:b(12585),length:b(12587),len:b(12589),squaredLength:b(12591),hz:b(12598),negate:b(12607),inverse:b(12610),normalize:b(12453),dot:b(12461),cross:b(12618),dz:b(12620),random:b(12626),transformMat4:b(12628),transformMat3:b(12632),transformQuat:b(12637),Bz:b(12639),oz:b(12647),yz:b(12655),forEach:b(12663)}},12610:U=>{U.exports=function(U,X){return U[0]=1/X[0],U[1]=1/X[1],U[2]=1/X[2],U}},12589:(U,X,b)=>{U.exports=b(12587)},12587:U=>{U.exports=function(U){var X=U[0],b=U[1],F=U[2];return Math.sqrt(X*X+b*b+F*F)}},12620:U=>{U.exports=function(U,X,b,F){var E=X[0],w=X[1],Q=X[2];return U[0]=E+F*(b[0]-E),U[1]=w+F*(b[1]-w),U[2]=Q+F*(b[2]-Q),U}},12537:U=>{U.exports=function(U,X,b){return U[0]=Math.max(X[0],b[0]),U[1]=Math.max(X[1],b[1]),U[2]=Math.max(X[2],b[2]),U}},12532:U=>{U.exports=function(U,X,b){return U[0]=Math.min(X[0],b[0]),U[1]=Math.min(X[1],b[1]),U[2]=Math.min(X[2],b[2]),U}},12519:(U,X,b)=>{U.exports=b(12513)},12513:U=>{U.exports=function(U,X,b){return U[0]=X[0]*b[0],U[1]=X[1]*b[1],U[2]=X[2]*b[2],U}},12607:U=>{U.exports=function(U,X){return U[0]=-X[0],U[1]=-X[1],U[2]=-X[2],U}},12453:U=>{U.exports=function(U,X){var b=X[0],F=X[1],E=X[2],w=b*b+F*F+E*E;w>0&&(w=1/Math.sqrt(w),U[0]=X[0]*w,U[1]=X[1]*w,U[2]=X[2]*w);return U}},12626:U=>{U.exports=function(U,X){X=X||1;var b=2*Math.random()*Math.PI,F=2*Math.random()-1,E=Math.sqrt(1-F*F)*X;return U[0]=Math.cos(b)*E,U[1]=Math.sin(b)*E,U[2]=F*X,U}},12639:U=>{U.exports=function(U,X,b,F){var E=b[1],w=b[2],Q=X[1]-E,z=X[2]-w,q=Math.sin(F),p=Math.cos(F);return U[0]=X[0],U[1]=E+Q*p-z*q,U[2]=w+Q*q+z*p,U}},12647:U=>{U.exports=function(U,X,b,F){var E=b[0],w=b[2],Q=X[0]-E,z=X[2]-w,q=Math.sin(F),p=Math.cos(F);return U[0]=E+z*q+Q*p,U[1]=X[1],U[2]=w+z*p-Q*q,U}},12655:U=>{U.exports=function(U,X,b,F){var E=b[0],w=b[1],Q=X[0]-E,z=X[1]-w,q=Math.sin(F),p=Math.cos(F);return U[0]=E+Q*p-z*q,U[1]=w+Q*q+z*p,U[2]=X[2],U}},12560:U=>{U.exports=function(U,X){return U[0]=Math.round(X[0]),U[1]=Math.round(X[1]),U[2]=Math.round(X[2]),U}},12562:U=>{U.exports=function(U,X,b){return U[0]=X[0]*b,U[1]=X[1]*b,U[2]=X[2]*b,U}},12567:U=>{U.exports=function(U,X,b,F){return U[0]=X[0]+b[0]*F,U[1]=X[1]+b[1]*F,U[2]=X[2]+b[2]*F,U}},12477:U=>{U.exports=function(U,X,b,F){return U[0]=X,U[1]=b,U[2]=F,U}},12585:(U,X,b)=>{U.exports=b(12583)},12598:(U,X,b)=>{U.exports=b(12591)},12583:U=>{U.exports=function(U,X){var b=X[0]-U[0],F=X[1]-U[1],E=X[2]-U[2];return b*b+F*F+E*E}},12591:U=>{U.exports=function(U){var X=U[0],b=U[1],F=U[2];return X*X+b*b+F*F}},12508:(U,X,b)=>{U.exports=b(12502)},12502:U=>{U.exports=function(U,X,b){return U[0]=X[0]-b[0],U[1]=X[1]-b[1],U[2]=X[2]-b[2],U}},12632:U=>{U.exports=function(U,X,b){var F=X[0],E=X[1],w=X[2];return U[0]=F*b[0]+E*b[3]+w*b[6],U[1]=F*b[1]+E*b[4]+w*b[7],U[2]=F*b[2]+E*b[5]+w*b[8],U}},12628:U=>{U.exports=function(U,X,b){var F=X[0],E=X[1],w=X[2],Q=b[3]*F+b[7]*E+b[11]*w+b[15];return Q=Q||1,U[0]=(b[0]*F+b[4]*E+b[8]*w+b[12])/Q,U[1]=(b[1]*F+b[5]*E+b[9]*w+b[13])/Q,U[2]=(b[2]*F+b[6]*E+b[10]*w+b[14])/Q,U}},12637:U=>{U.exports=function(U,X,b){var F=X[0],E=X[1],w=X[2],Q=b[0],z=b[1],q=b[2],p=b[3],S=p*F+z*w-q*E,R=p*E+q*F-Q*w,n=p*w+Q*E-z*F,a=-Q*F-z*E-q*w;return U[0]=S*p+a*-Q+R*-q-n*-z,U[1]=R*p+a*-z+n*-Q-S*-q,U[2]=n*p+a*-q+S*-z-R*-Q,U}},13511:U=>{"use strict";U.exports=function(U){for(var X=new Array(U),b=0;b<U;++b)X[b]=b;return X}},13576:U=>{U.exports=function(U){return null!=U&&null!=U.constructor&&"function"===typeof U.constructor.isBuffer&&U.constructor.isBuffer(U)}},13821:(U,X,b)=>{"use strict";b.d(X,{c:()=>F});class F{constructor(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ZS=!1,this.cS=!1,this.DS=30,this.GS=0,this.bR=!1,this.fullscreen=!1,this.MS=function(U){},this.HS=function(){},this.UR=function(){},this.Ub=function(){},this.TS=function(U){},this.onFullscreenChanged=function(U){},p((()=>{!function(U,X){U._nowObject=performance||Date,U._lastTick=0,U._renderAccum=0,U._rt=0,U._frameCB=z.bind(null,U),requestAnimationFrame(U._frameCB),X>0&&(U._intervalCB=Q.bind(null,U),U._interval=setInterval(U._intervalCB,Math.max(X,1e3/U.DS/2)))}(this,X),function(U,X){if(!X)return;var b=!1,F=!1;document.addEventListener("pointerlockchange",(F=>{b=document.pointerLockElement===X,U.TS(b)})),document.addEventListener("fullscreenchange",(b=>{F=document.fullscreenElement===X,U.onFullscreenChanged(F)})),Object.defineProperty(U,"bR",{get:()=>b,set:U=>{U&&!b?q(X):b&&!U&&function(U){U.exitPointerLock&&U.exitPointerLock()}(document)}}),Object.defineProperty(U,"fullscreen",{get:()=>F,set:U=>{U&&!F?X.requestFullscreen():F&&!U&&document.exitFullscreen()}}),X.addEventListener("click",(E=>{U.ZS&&!b&&q(X),U.cS&&!F&&X.requestFullscreen()}));var E=()=>U.Ub();if(window.ResizeObserver){new ResizeObserver(E).observe(X)}else window.addEventListener("resize",E)}(this,U),this.UR()}))}}var E=3,w=20;function Q(U){for(var X=1e3/U.DS,b=U._nowObject.now()+w,F=0;U._nowObject.now()>=U._lastTick+X&&U._nowObject.now()<b&&++F<=E;)U.MS(X),U._lastTick+=X;var Q=5*(X+5),z=U._nowObject.now();if(z-U._lastTick>Q)for(;z>=U._lastTick+X;)U._lastTick+=X}function z(U){requestAnimationFrame(U._frameCB),Q(U);var X=U._nowObject.now(),b=X-U._rt;if(U._rt=X,U.GS>0){U._renderAccum+=b;var F=1e3/U.GS;if(U._renderAccum<F)return;U._renderAccum=Math.min(U._renderAccum-F,F)}var E=1e3/U.DS,w=(X-U._lastTick)/E;U.HS(b,w,E)}function q(U){U.requestPointerLock&&U.requestPointerLock()}var p=U=>{if("loading"===document.readyState){var X=()=>{document.removeEventListener("readystatechange",X),U()};document.addEventListener("readystatechange",X)}else setTimeout(U,1)}},13504:(U,X,b)=>{var F=b(13511),E=b(13516),w="undefined"!==typeof Float64Array;function Q(U,X){return U[0]-X[0]}function z(){var U,X=this.stride,b=new Array(X.length);for(U=0;U<b.length;++U)b[U]=[Math.abs(X[U]),U];b.sort(Q);var F=new Array(b.length);for(U=0;U<F.length;++U)F[U]=b[U][1];return F}function q(U,X){var b=["View",X,"d",U].join("");X<0&&(b="View_Nil"+U);var E="generic"===U;if(-1===X){var w="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+U+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(w)()}if(0===X){w="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+U+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",w)(p[U][0])}w=["'use strict'"];var Q=F(X),q=Q.map((function(U){return"i"+U})),S="this.offset+"+Q.map((function(U){return"this.stride["+U+"]*i"+U})).join("+"),R=Q.map((function(U){return"b"+U})).join(","),n=Q.map((function(U){return"c"+U})).join(",");w.push("function "+b+"(a,"+R+","+n+",d){this.data=a","this.shape=["+R+"]","this.stride=["+n+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+U+"'","proto.dimension="+X),w.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+Q.map((function(U){return"this.shape["+U+"]"})).join("*"),"}})"),1===X?w.push("proto.order=[0]"):(w.push("Object.defineProperty(proto,'order',{get:"),X<4?(w.push("function "+b+"_order(){"),2===X?w.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===X&&w.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):w.push("ORDER})")),w.push("proto.set=function "+b+"_set("+q.join(",")+",v){"),E?w.push("return this.data.set("+S+",v)}"):w.push("return this.data["+S+"]=v}"),w.push("proto.get=function "+b+"_get("+q.join(",")+"){"),E?w.push("return this.data.get("+S+")}"):w.push("return this.data["+S+"]}"),w.push("proto.index=function "+b+"_index(",q.join(),"){return "+S+"}"),w.push("proto.hi=function "+b+"_hi("+q.join(",")+"){return new "+b+"(this.data,"+Q.map((function(U){return["(typeof i",U,"!=='number'||i",U,"<0)?this.shape[",U,"]:i",U,"|0"].join("")})).join(",")+","+Q.map((function(U){return"this.stride["+U+"]"})).join(",")+",this.offset)}");var a=Q.map((function(U){return"a"+U+"=this.shape["+U+"]"})),J=Q.map((function(U){return"c"+U+"=this.stride["+U+"]"}));w.push("proto.lo=function "+b+"_lo("+q.join(",")+"){var b=this.offset,d=0,"+a.join(",")+","+J.join(","));for(var m=0;m<X;++m)w.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");w.push("return new "+b+"(this.data,"+Q.map((function(U){return"a"+U})).join(",")+","+Q.map((function(U){return"c"+U})).join(",")+",b)}"),w.push("proto.step=function "+b+"_step("+q.join(",")+"){var "+Q.map((function(U){return"a"+U+"=this.shape["+U+"]"})).join(",")+","+Q.map((function(U){return"b"+U+"=this.stride["+U+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(m=0;m<X;++m)w.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");w.push("return new "+b+"(this.data,"+Q.map((function(U){return"a"+U})).join(",")+","+Q.map((function(U){return"b"+U})).join(",")+",c)}");var x=new Array(X),I=new Array(X);for(m=0;m<X;++m)x[m]="a[i"+m+"]",I[m]="b[i"+m+"]";w.push("proto.transpose=function "+b+"_transpose("+q+"){"+q.map((function(U,X){return U+"=("+U+"===undefined?"+X+":"+U+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+x.join(",")+","+I.join(",")+",this.offset)}"),w.push("proto.pick=function "+b+"_pick("+q+"){var a=[],b=[],c=this.offset");for(m=0;m<X;++m)w.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return w.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),w.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+Q.map((function(U){return"shape["+U+"]"})).join(",")+","+Q.map((function(U){return"stride["+U+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",w.join("\n"))(p[U],z)}var p={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};U.exports=function(U,X,b,F){if(void 0===U)return(0,p.array[0])([]);"number"===typeof U&&(U=[U]),void 0===X&&(X=[U.length]);var Q=X.length;if(void 0===b){b=new Array(Q);for(var z=Q-1,S=1;z>=0;--z)b[z]=S,S*=X[z]}if(void 0===F){F=0;for(z=0;z<Q;++z)b[z]<0&&(F-=(X[z]-1)*b[z])}for(var R=function(U){if(E(U))return"buffer";if(w)switch(Object.prototype.toString.call(U)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(U)?"array":"generic"}(U),n=p[R];n.length<=Q+1;)n.push(q(R,n.length-1));return(0,n[Q+1])(U,X,b,F)}},13516:U=>{function X(U){return!!U.constructor&&"function"===typeof U.constructor.isBuffer&&U.constructor.isBuffer(U)}U.exports=function(U){return null!=U&&(X(U)||function(U){return"function"===typeof U.readFloatLE&&"function"===typeof U.slice&&X(U.slice(0,0))}(U)||!!U._isBuffer)}},13683:U=>{"use strict";var X=[],b=[],F=[],E=[],w=[],Q=[],z=[],q=[],p=[],S=[],R=[],n=[];U.exports=function(U,a,J,m,x,I){for(var O=z,N=p,u=S,i=n,P=0;P<3;P++)O[P]=+J[P],u[P]=+a.max[P],N[P]=+a.base[P];I||(I=1e-10);var f=function(U,z,p,S,n,a){var J=X,m=b,x=F,I=E,O=w,N=Q,u=q,i=Math.floor,P=0,f=0,j=0,e=0,l=0;if(d(),0===j)return 0;for(e=A();f<=j;){if(k(e)&&v())return P;e=A()}for(P+=j,l=0;l<3;l++)S[l]+=p[l],n[l]+=p[l];return P;function d(){if(f=0,0!==(j=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])))for(var U=0;U<3;U++){var X=p[U]>=0;I[U]=X?1:-1;var b=X?n[U]:S[U];J[U]=X?S[U]:n[U],m[U]=s(b,I[U]),x[U]=h(J[U],I[U]),u[U]=p[U]/j,O[U]=Math.abs(1/u[U]);var F=X?m[U]+1-b:b-m[U];N[U]=O[U]<1/0?O[U]*F:1/0}}function k(X){for(var b=I[0],F=0===X?m[0]:x[0],E=m[0]+b,w=I[1],Q=1===X?m[1]:x[1],z=m[1]+w,q=I[2],p=2===X?m[2]:x[2],S=m[2]+q,R=F;R!=E;R+=b)for(var n=Q;n!=z;n+=w)for(var a=p;a!=S;a+=q)if(U(R,n,a))return!0;return!1}function v(){P+=f;var U=I[e],X=f/j,b=R;for(l=0;l<3;l++){var F=p[l]*X;S[l]+=F,n[l]+=F,b[l]=p[l]-F}if(U>0?n[e]=Math.round(n[e]):S[e]=Math.round(S[e]),z(P,e,U,b))return!0;for(l=0;l<3;l++)p[l]=b[l];return d(),0===j}function A(){var U=N[0]<N[1]?N[0]<N[2]?0:2:N[1]<N[2]?1:2,X=N[U]-f;for(f=N[U],m[U]+=I[U],N[U]+=O[U],l=0;l<3;l++)J[l]+=X*u[l],x[l]=h(J[l],I[l]);return U}function s(U,X){return i(U-X*a)}function h(U,X){return i(U+X*a)}}(U,m,O,N,u,I);if(!x){for(P=0;P<3;P++)i[P]=J[P]>0?u[P]-a.max[P]:N[P]-a.base[P];a.translate(i)}return f}},13847:(U,X,b)=>{"use strict";b.d(X,{e:()=>R});var F=b(13677),E=b(12411);class w{constructor(U,X,b,w,Q,z,q){this.Dp=new F(U.base,U.zS),this.sw=X,this.friction=b,this.restitution=w,this.uz=Q,this.fa=z,this.iz=!!q,this.QS=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.SJ=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Op=E.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=E.create(),this._impulses=E.create(),this._sleepFrameCount=10}loadFromCopy(U){E.k(this.Dp.base,U.Dp.base),E.k(this.Dp.zS,U.Dp.zS),E.k(this.Dp.max,U.Dp.max),this.Dp.mag=U.Dp.mag,this.sw=U.sw,this.friction=U.friction,this.restitution=U.restitution,this.uz=U.uz,this.fa=U.fa,this.iz=U.iz,this.QS=U.QS,this.fluidDrag=U.fluidDrag,this.SJ=U.SJ,this.preventFallOffEdge=U.preventFallOffEdge,this.rolledBackLastTick=U.rolledBackLastTick,E.k(this.Op,U.Op),E.k(this.resting,U.resting),this.inFluid=U.inFluid,this._ratioInFluid=U._ratioInFluid,E.k(this._forces,U._forces),E.k(this._impulses,U._impulses),this._sleepFrameCount=U._sleepFrameCount}setPosition(U){Q(U),E.mX(U,U,this.Dp.base),this.Dp.translate(U),this.Pp()}Xb(){return E.clone(this.Dp.base)}applyForce(U){Q(U),E.add(this._forces,this._forces,U),this.Pp()}applyImpulse(U){Q(U),E.add(this._impulses,this._impulses,U),this.Pp()}Pp(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Q=U=>{};var z=b(13677),q=b(12411),p=b(13683);function S(){this.QS=.1,this.fluidDrag=.4,this.lz=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function R(U,X,b){U=Object.assign(new S,U),this.gravity=U.gravity||[0,-10,0],this.QS=U.QS||.1,this.lz=U.lz||2,this.fluidDrag=U.fluidDrag||.4,this.minBounceImpulse=U.minBounceImpulse,this.bodies=[],this.Gn=U.Gn,this.testSolid=X,this.testFluid=b}R.prototype.Aa=function(U,X,b,F,E,Q){U=U||new z([0,0,0],[1,1,1]),"undefined"==typeof X&&(X=1),"undefined"==typeof b&&(b=1),"undefined"==typeof F&&(F=0),"undefined"==typeof E&&(E=1);var q=new w(U,X,b,F,E,Q);return this.bodies.push(q),q},R.prototype.sa=function(U){var X=this.bodies.indexOf(U);X<0||(this.bodies.splice(X,1),U.Dp=U.fa=null)};var n=q.create(),a=q.create(),J=q.create(),m=q.create(),x=q.create(),I=q.create(),O=q.create(),N=new z([0,0,0],[1,1,1]),u=new w(N,1,1,0,1,(()=>{}),!1);function i(U,X,b){return X=b,X*=1-(1-U.ratioInFluid)**2}R.prototype.Vz=function(U){U/=1e3;var X=W(0,q.squaredLength(this.gravity));this.bodies.forEach((b=>function(U,X,b,F){q.k(x,X.resting),U.Gn&&u.loadFromCopy(X);if(X.sw<=0)return q.set(X.Op,0,0,0),q.set(X._forces,0,0,0),void q.set(X._impulses,0,0,0);var E=F||0===X.uz;if(function(U,X,b,F){if(X._sleepFrameCount>0)return!1;if(F)return!0;var E=!1,w=.5*b*b*X.uz;return q.scale(t,U.gravity,w),p(U.testSolid,X.Dp,t,(function(){return E=!0,!0}),!0),E}(U,X,b,E))return;X._sleepFrameCount--,function(U,X){var b=X.Dp,F=Math.floor(b.base[0]),E=Math.floor(b.base[2]),w=Math.floor(b.base[1]),Q=Math.floor(b.max[1]);if(!U.testFluid(F,w,E))return X.inFluid=!1,void(X.ratioInFluid=0);var z=1,p=w+1;for(;p<=Q&&U.testFluid(F,p,E);)z++,p++;var S=(w+z-b.base[1])/b.zS[1];S>1&&(S=1);var R=b.zS[0]*b.zS[1]*b.zS[2]*S,n=f;q.scale(n,U.gravity,-U.lz*R*X.uz),X.applyForce(n),X.inFluid=!0,X.ratioInFluid=S}(U,X),K(X._forces),K(X._impulses),K(X.Op),K(X.resting),q.scale(n,X._forces,1/X.sw),q.sz(n,n,U.gravity,X.uz),q.scale(a,X._impulses,1/X.sw),q.sz(a,a,n,b),q.add(X.Op,X.Op,a),X.friction&&(j(U,0,X,a,b),j(U,1,X,a,b),j(U,2,X,a,b));var w=X.fluidDrag>=0?X.fluidDrag:U.fluidDrag,Q=X.QS>=0?X.QS:U.QS,z=Q,S=Q;X.inFluid&&(z=i(X,z,X.fluidDragHoriz>=0?X.fluidDragHoriz:w),S=i(X,S,X.fluidDragVert>=0?X.fluidDragVert:w));z=Math.max(1-z*b/X.sw,0),S=Math.max(1-S*b/X.sw,0),q.set(P,z,S,z),q.multiply(X.Op,X.Op,P),q.scale(J,X.Op,b),q.set(X._forces,0,0,0),q.set(X._impulses,0,0,0),X.iz&&Y(d,X.Dp);q.k(I,J),q.set(O,0,0,0),X.preventFallOffEdge&&function(U,X,b,F){if(!X.resting[1]||b[1]>0)return;var E=B;Y(E,X.Dp);for(var w=0;w<3;w+=2){q.set(h,0,0,0),h[w]=b[w];var Q=!0;(Q=(Q=(Q=(Q=Q&&!y(U,E.base[0]+h[0]+1e-5,E.base[1],E.base[2]+h[2]+1e-5))&&!y(U,E.max[0]+h[0]-1e-5,E.base[1],E.base[2]+h[2]+1e-5))&&!y(U,E.base[0]+h[0]+1e-5,E.base[1],E.max[2]+h[2]-1e-5))&&!y(U,E.max[0]+h[0]-1e-5,E.base[1],E.max[2]+h[2]-1e-5))?(F[w]=b[w]>0?1:-1,b[w]=0):0===w&&(q.set(o,b[0],0,0),l(U,E,o,F,X.slideOnCollision))}}(U,X,J,O);l(U,X.Dp,J,X.resting,X.slideOnCollision),X.iz&&function(U,X,b,F){if(X.resting[1]>=0&&!X.inFluid)return;var E=0!==X.resting[0],w=0!==X.resting[2];if(!E&&!w)return;var Q=Math.abs(F[0]/F[2]),z=4;if(!E&&Q>z)return;if(!w&&Q<1/z)return;q.add(v,b.base,F);var S=U.testSolid;p(S,b,F,(function(U,X,b,F){if(1!==X)return!0;F[X]=0}));var R=b.base[1],n=X.inFluid?1.951:1.001,a=Math.floor(R+n)-R;q.set(A,0,a,0);var J=!1;if(p(S,b,A,(function(U,X,b,F){return J=!0,!0})),J)return;q.mX(s,v,b.base),s[1]=0,l(U,b,s,k,!0);var m=W(b.base[0],v[0]),x=W(b.base[2],v[2]);if(E&&!m&&(!x||!w))return;if(w&&(!m||!E)&&!x)return;var I=!0;if(I=I&&!y(U,b.base[0]+1e-5,b.base[1],b.base[2]+1e-5),I=I&&!y(U,b.max[0]-1e-5,b.base[1],b.base[2]+1e-5),I=I&&!y(U,b.base[0]+1e-5,b.base[1],b.max[2]-1e-5),I=I&&!y(U,b.max[0]-1e-5,b.base[1],b.max[2]-1e-5),I)return;Y(X.Dp,b),X.resting[0]=k[0],X.resting[2]=k[2],X.SJ&&X.SJ()}(U,X,d,I);for(var R=0;R<3;++R)X.resting[R]=X.resting[R]||O[R],m[R]=0,X.resting[R]&&(x[R]||(m[R]=-X.Op[R]),X.Op[R]=0);var N=q.length(m);N>.001&&(q.scale(m,m,X.sw),X.fa&&X.fa(m),X.restitution>0&&N>U.minBounceImpulse&&(q.scale(m,m,X.restitution),X.applyImpulse(m)));var e=q.squaredLength(X.Op);e>1e-5&&X.Pp();U.Gn&&U.Gn(X)?(X.loadFromCopy(u),X.rolledBackLastTick=!0):X.rolledBackLastTick=!1}(this,b,U,X)))};var P=q.create([0,0,0]);var f=q.create();function j(U,X,b,F,E){var w=b.resting[X],Q=F[X];if(!b.alwaysApplyHorizFriction||1!==X){if(0===w)return;if(w*Q<=0)return}q.k(e,b.Op),e[X]=0;var z=q.length(e);if(!W(z,0)){var p=Math.abs(b.friction*U.gravity[X]*E),S=z>p?(z-p)/z:0;b.Op[(X+1)%3]*=S,b.Op[(X+2)%3]*=S}}var e=q.create();function l(U,X,b,F,E){return q.set(F,0,0,0),p(U.testSolid,X,b,(function(U,X,b,w){F[X]=b,w[X]=0,E||(w[0]=0,w[1]=0,w[2]=0)}))}var d=new z([],[]),k=q.create(),v=q.create(),A=q.create(),s=q.create();var h=q.create(),B=new z([],[]),o=q.create();function y(U,X,b,F){return U.testSolid(Math.floor(X),Math.floor(b-1),Math.floor(F))}var t=q.create();function W(U,X){return Math.abs(U-X)<1e-5}function Y(U,X){for(var b=0;b<3;b++)U.base[b]=X.base[b],U.max[b]=X.max[b],U.zS[b]=X.zS[b]}var K=function(U){}},12282:function(U,X){!function(U){"use strict";var X=function(U,b){return X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(U,X){U.__proto__=X}||function(U,X){for(var b in X)Object.prototype.hasOwnProperty.call(X,b)&&(U[b]=X[b])},X(U,b)};function b(U,b){if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function F(){this.constructor=U}X(U,b),U.prototype=null===b?Object.create(b):(F.prototype=b.prototype,new F)}function F(U,X,b,F){var E,w=arguments.length,Q=w<3?X:null===F?F=Object.getOwnPropertyDescriptor(X,b):F;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Q=Reflect.decorate(U,X,b,F);else for(var z=U.length-1;z>=0;z--)(E=U[z])&&(Q=(w<3?E(Q):w>3?E(X,b,Q):E(X,b))||Q);return w>3&&Q&&Object.defineProperty(X,b,Q),Q}function E(U,X,b){if(b||2===arguments.length)for(var F,E=0,w=X.length;E<w;E++)!F&&E in X||(F||(F=Array.prototype.slice.call(X,0,E)),F[E]=X[E]);return U.concat(F||Array.prototype.slice.call(X))}var w,Q=255,z=213;U.OPERATION=void 0,(w=U.OPERATION||(U.OPERATION={}))[w.ADD=128]="ADD",w[w.REPLACE=0]="REPLACE",w[w.DELETE=64]="DELETE",w[w.DELETE_AND_ADD=192]="DELETE_AND_ADD",w[w.TOUCH=1]="TOUCH",w[w.CLEAR=10]="CLEAR";var q=function(){function X(U,X,b){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=U,this.setParent(X,b)}return X.prototype.setParent=function(U,X,b){var F=this;if(this.indexes||(this.indexes=this.ref instanceof sU?this.ref._definition.indexes:{}),this.parent=U,this.parentIndex=b,X)if(this.root=X,this.ref instanceof sU){var E=this.ref._definition;for(var w in E.schema){var Q=this.ref[w];if(Q&&Q.$changes){var z=E.indexes[w];Q.$changes.setParent(this.ref,X,z)}}}else"object"===typeof this.ref&&this.ref.forEach((function(U,X){if(U instanceof sU){var b=U.$changes,E=F.ref.$changes.indexes[X];b.setParent(F.ref,F.root,E)}}))},X.prototype.operation=function(U){this.changes.set(--this.currentCustomOperation,U)},X.prototype.change=function(X,b){void 0===b&&(b=U.OPERATION.ADD);var F="number"===typeof X?X:this.indexes[X];this.assertValidIndex(F,X);var E=this.changes.get(F);E&&E.op!==U.OPERATION.DELETE&&E.op!==U.OPERATION.TOUCH||this.changes.set(F,{op:E&&E.op===U.OPERATION.DELETE?U.OPERATION.DELETE_AND_ADD:b,index:F}),this.allChanges.add(F),this.changed=!0,this.touchParents()},X.prototype.touch=function(X){var b="number"===typeof X?X:this.indexes[X];this.assertValidIndex(b,X),this.changes.has(b)||this.changes.set(b,{op:U.OPERATION.TOUCH,index:b}),this.allChanges.add(b),this.touchParents()},X.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},X.prototype.getType=function(U){if(this.ref._definition)return(X=this.ref._definition).schema[X.fieldsByIndex[U]];var X,b=(X=this.parent._definition).schema[X.fieldsByIndex[this.parentIndex]];return Object.values(b)[0]},X.prototype.getChildrenFilter=function(){var U=this.parent._definition.childFilters;return U&&U[this.parentIndex]},X.prototype.getValue=function(U){return this.ref.getByIndex(U)},X.prototype.delete=function(X){var b="number"===typeof X?X:this.indexes[X];if(void 0!==b){var F=this.getValue(b);this.changes.set(b,{op:U.OPERATION.DELETE,index:b}),this.allChanges.delete(b),delete this.caches[b],F&&F.$changes&&(F.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(X," (").concat(b,")"))},X.prototype.discard=function(X,b){var F=this;void 0===X&&(X=!1),void 0===b&&(b=!1),this.ref instanceof sU||this.changes.forEach((function(X){if(X.op===U.OPERATION.DELETE){var b=F.ref.getIndex(X.index);delete F.indexes[b]}})),this.changes.clear(),this.changed=X,b&&this.allChanges.clear(),this.currentCustomOperation=0},X.prototype.discardAll=function(){var U=this;this.changes.forEach((function(X){var b=U.getValue(X.index);b&&b.$changes&&b.$changes.discardAll()})),this.discard()},X.prototype.cache=function(U,X){this.caches[U]=X},X.prototype.clone=function(){return new X(this.ref,this.parent,this.root)},X.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},X.prototype.assertValidIndex=function(U,X){if(void 0===U)throw new Error('ChangeTree: missing index for field "'.concat(X,'"'))},X}();function p(U,X,b,F){return U[X]||(U[X]=[]),U[X].push(b),null===F||void 0===F||F.forEach((function(U,X){return b(U,X)})),function(){return R(U[X],U[X].indexOf(b))}}function S(X){var b=this,F="string"!==typeof this.$changes.getType();this.$items.forEach((function(E,w){X.push({refId:b.$changes.refId,op:U.OPERATION.DELETE,field:w,value:void 0,previousValue:E}),F&&b.$changes.root.removeRef(E.$changes.refId)}))}function R(U,X){if(-1===X||X>=U.length)return!1;for(var b=U.length-1,F=X;F<b;F++)U[F]=U[F+1];return U.length=b,!0}var n=function(U,X){var b=U.toString(),F=X.toString();return b<F?-1:b>F?1:0};function a(U){return U.$proxy=!0,U=new Proxy(U,{get:function(U,X){return"symbol"===typeof X||isNaN(X)?U[X]:U.at(X)},set:function(U,X,b){if("symbol"===typeof X||isNaN(X))U[X]=b;else{var F=Array.from(U.$items.keys()),E=parseInt(F[X]||X);void 0===b||null===b?U.deleteAt(E):U.setAt(E,b)}return!0},deleteProperty:function(U,X){return"number"===typeof X?U.deleteAt(X):delete U[X],!0}})}var J=function(){function X(){for(var U=[],X=0;X<arguments.length;X++)U[X]=arguments[X];this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,U)}return X.prototype.Lz=function(X,b){return void 0===b&&(b=!0),p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,X,b?this.$items:void 0)},X.prototype.IX=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,X)},X.is=function(U){return Array.isArray(U)||void 0!==U.array},Object.defineProperty(X.prototype,"length",{get:function(){return this.$items.size},set:function(U){0===U?this.clear():this.splice(U,this.length-U)},enumerable:!1,configurable:!0}),X.prototype.push=function(){for(var U,X=this,b=[],F=0;F<arguments.length;F++)b[F]=arguments[F];return b.forEach((function(b){U=X.$refId++,X.setAt(U,b)})),U},X.prototype.pop=function(){var U=Array.from(this.$indexes.values()).pop();if(void 0!==U){this.$changes.delete(U),this.$indexes.delete(U);var X=this.$items.get(U);return this.$items.delete(U),X}},X.prototype.at=function(U){var X=Array.from(this.$items.keys())[U];return this.$items.get(X)},X.prototype.setAt=function(X,b){var F,E;if(void 0!==b&&null!==b){if(this.$items.get(X)!==b){void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,X);var w=null!==(E=null===(F=this.$changes.indexes[X])||void 0===F?void 0:F.op)&&void 0!==E?E:U.OPERATION.ADD;this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,b),this.$changes.change(X,w)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},X.prototype.deleteAt=function(U){var X=Array.from(this.$items.keys())[U];return void 0!==X&&this.$deleteAt(X)},X.prototype.$deleteAt=function(U){return this.$changes.delete(U),this.$indexes.delete(U),this.$items.delete(U)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&S.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.concat=function(){for(var U,b=[],F=0;F<arguments.length;F++)b[F]=arguments[F];return new(X.bind.apply(X,E([void 0],(U=Array.from(this.$items.values())).concat.apply(U,b),!1)))},X.prototype.join=function(U){return Array.from(this.$items.values()).join(U)},X.prototype.reverse=function(){var U=this,X=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(b,F){U.setAt(X[F],b)})),this},X.prototype.shift=function(){var U=Array.from(this.$items.keys()).shift();if(void 0!==U){var X=this.$items.get(U);return this.$deleteAt(U),X}},X.prototype.slice=function(U,b){var F=new X;return F.push.apply(F,Array.from(this.$items.values()).slice(U,b)),F},X.prototype.sort=function(U){var X=this;void 0===U&&(U=n);var b=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(U).forEach((function(U,F){X.setAt(b[F],U)})),this},X.prototype.splice=function(U,X){void 0===X&&(X=this.length-U);for(var b=Array.from(this.$items.keys()),F=[],E=U;E<U+X;E++)F.push(this.$items.get(b[E])),this.$deleteAt(b[E]);return F},X.prototype.unshift=function(){for(var U=this,X=[],b=0;b<arguments.length;b++)X[b]=arguments[b];var F=this.length,E=X.length,w=Array.from(this.$items.values());return X.forEach((function(X,b){U.setAt(b,X)})),w.forEach((function(X,b){U.setAt(E+b,X)})),F+E},X.prototype.indexOf=function(U,X){return Array.from(this.$items.values()).indexOf(U,X)},X.prototype.lastIndexOf=function(U,X){return void 0===X&&(X=this.length-1),Array.from(this.$items.values()).lastIndexOf(U,X)},X.prototype.every=function(U,X){return Array.from(this.$items.values()).every(U,X)},X.prototype.some=function(U,X){return Array.from(this.$items.values()).some(U,X)},X.prototype.forEach=function(U,X){Array.from(this.$items.values()).forEach(U,X)},X.prototype.map=function(U,X){return Array.from(this.$items.values()).map(U,X)},X.prototype.filter=function(U,X){return Array.from(this.$items.values()).filter(U,X)},X.prototype.reduce=function(U,X){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},X.prototype.reduceRight=function(U,X){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},X.prototype.find=function(U,X){return Array.from(this.$items.values()).find(U,X)},X.prototype.findIndex=function(U,X){return Array.from(this.$items.values()).findIndex(U,X)},X.prototype.fill=function(U,X,b){throw new Error("ArraySchema#fill() not implemented")},X.prototype.copyWithin=function(U,X,b){throw new Error("ArraySchema#copyWithin() not implemented")},X.prototype.toString=function(){return this.$items.toString()},X.prototype.toLocaleString=function(){return this.$items.toLocaleString()},X.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},X.prototype.includes=function(U,X){return Array.from(this.$items.values()).includes(U,X)},X.prototype.flatMap=function(U,X){throw new Error("ArraySchema#flatMap() is not supported.")},X.prototype.flat=function(U){throw new Error("ArraySchema#flat() is not supported.")},X.prototype.findLast=function(){var U=Array.from(this.$items.values());return U.findLast.apply(U,arguments)},X.prototype.findLastIndex=function(){var U=Array.from(this.$items.values());return U.findLastIndex.apply(U,arguments)},X.prototype.setIndex=function(U,X){this.$indexes.set(U,X)},X.prototype.getIndex=function(U){return this.$indexes.get(U)},X.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},X.prototype.deleteByIndex=function(U){var X=this.$indexes.get(U);this.$items.delete(X),this.$indexes.delete(U)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){return this.toArray().map((function(U){return"function"===typeof U.toJSON?U.toJSON():U}))},X.prototype.clone=function(U){return U?new(X.bind.apply(X,E([void 0],Array.from(this.$items.values()),!1))):new(X.bind.apply(X,E([void 0],this.map((function(U){return U.$changes?U.clone():U})),!1)))},X}();function m(U){return U.$proxy=!0,U=new Proxy(U,{get:function(U,X){return"symbol"!==typeof X&&"undefined"===typeof U[X]?U.get(X):U[X]},set:function(U,X,b){return"symbol"!==typeof X&&-1===X.indexOf("$")&&"Lz"!==X&&"IX"!==X&&"onChange"!==X?U.set(X,b):U[X]=b,!0},deleteProperty:function(U,X){return U.delete(X),!0}})}var x=function(){function X(U){var b=this;if(this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U)if(U instanceof Map||U instanceof X)U.forEach((function(U,X){return b.set(X,U)}));else for(var F in U)this.set(F,U[F])}return X.prototype.Lz=function(X,b){return void 0===b&&(b=!0),p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,X,b?this.$items:void 0)},X.prototype.IX=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,X)},X.is=function(U){return void 0!==U.map},X.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(X.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(X,Symbol.species,{get:function(){return X},enumerable:!1,configurable:!0}),X.prototype.set=function(X,b){if(void 0===b||null===b)throw new Error("MapSchema#set('".concat(X,"', ").concat(b,"): trying to set ").concat(b," value on '").concat(X,"'."));X=X.toString();var F="undefined"!==typeof this.$changes.indexes[X],E=F?this.$changes.indexes[X]:this.$refId++,w=F?U.OPERATION.REPLACE:U.OPERATION.ADD,Q=void 0!==b.$changes;if(Q&&b.$changes.setParent(this,this.$changes.root,E),F){if(!Q&&this.$items.get(X)===b)return;Q&&this.$items.get(X)!==b&&(w=U.OPERATION.ADD)}else this.$changes.indexes[X]=E,this.$indexes.set(E,X);return this.$items.set(X,b),this.$changes.change(X,w),this},X.prototype.get=function(U){return this.$items.get(U)},X.prototype.delete=function(U){return this.$changes.delete(U),this.$items.delete(U)},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&S.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(U){return this.$items.has(U)},X.prototype.forEach=function(U){this.$items.forEach(U)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.keys=function(){return this.$items.keys()},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(U,X){this.$indexes.set(U,X)},X.prototype.getIndex=function(U){return this.$indexes.get(U)},X.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},X.prototype.deleteByIndex=function(U){var X=this.$indexes.get(U);this.$items.delete(X),this.$indexes.delete(U)},X.prototype.toJSON=function(){var U={};return this.forEach((function(X,b){U[b]="function"===typeof X.toJSON?X.toJSON():X})),U},X.prototype.clone=function(U){var b;return U?b=Object.assign(new X,this):(b=new X,this.forEach((function(U,X){U.$changes?b.set(X,U.clone()):b.set(X,U)}))),b},X}(),I={};function O(U,X){I[U]=X}function N(U){return I[U]}var u=function(){function U(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return U.create=function(X){var b=new U;return b.schema=Object.assign({},X&&X.schema||{}),b.indexes=Object.assign({},X&&X.indexes||{}),b.fieldsByIndex=Object.assign({},X&&X.fieldsByIndex||{}),b.descriptors=Object.assign({},X&&X.descriptors||{}),b.deprecated=Object.assign({},X&&X.deprecated||{}),b},U.prototype.addField=function(U,X){var b=this.getNextFieldIndex();this.fieldsByIndex[b]=U,this.indexes[U]=b,this.schema[U]=Array.isArray(X)?{array:X[0]}:X},U.prototype.hasField=function(U){return void 0!==this.indexes[U]},U.prototype.addFilter=function(U,X){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[U]]=X,this.indexesWithFilters.push(this.indexes[U]),!0},U.prototype.addChildrenFilter=function(U,X){var b=this.indexes[U],F=this.schema[U];if(N(Object.keys(F)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[b]=X,!0;console.warn("@filterChildren: field '".concat(U,"' can't have children. Ignoring filter."))},U.prototype.getChildrenFilter=function(U){return this.childFilters&&this.childFilters[this.indexes[U]]},U.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},U}();function i(U){return U._context&&U._context.useFilters}var P=function(){function U(){this.types={},this.schemas=new Map,this.useFilters=!1}return U.prototype.has=function(U){return this.schemas.has(U)},U.prototype.get=function(U){return this.types[U]},U.prototype.add=function(U,X){void 0===X&&(X=this.schemas.size),U._definition=u.create(U._definition),U._typeid=X,this.types[X]=U,this.schemas.set(U,X)},U.create=function(X){return void 0===X&&(X={}),function(b){return X.context||(X.context=new U),j(b,X)}},U}(),f=new P;function j(U,X){return void 0===X&&(X={}),function(b,F){var w=X.context||f,Q=b.constructor;if(Q._context=w,!U)throw new Error("".concat(Q.name,': @type() reference provided for "').concat(F,"\" is undefined. Make sure you don't have any circular dependencies."));w.has(Q)||w.add(Q);var z=Q._definition;if(z.addField(F,U),z.descriptors[F]){if(z.deprecated[F])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(F,"' definition on '").concat(Q.name,"'.\nCheck @type() annotation"))}catch(I){var q=I.stack.split("\n")[4].trim();throw new Error("".concat(I.message," ").concat(q))}}var p=J.is(U),S=!p&&x.is(U);if("string"!==typeof U&&!sU.is(U)){var R=Object.values(U)[0];"string"===typeof R||w.has(R)||w.add(R)}if(X.manual)z.descriptors[F]={enumerable:!0,configurable:!0,writable:!0};else{var n="_".concat(F);z.descriptors[n]={enumerable:!1,configurable:!1,writable:!0},z.descriptors[F]={get:function(){return this[n]},set:function(U){U!==this[n]&&(void 0!==U&&null!==U?(!p||U instanceof J||(U=new(J.bind.apply(J,E([void 0],U,!1)))),!S||U instanceof x||(U=new x(U)),void 0===U.$proxy&&(S?U=m(U):p&&(U=a(U))),this.$changes.change(F),U.$changes&&U.$changes.setParent(this,this.$changes.root,this._definition.indexes[F])):this[n]&&this.$changes.delete(F),this[n]=U)},enumerable:!0,configurable:!0}}}}function e(U){return function(X,b){var F=X.constructor;F._definition.addFilter(b,U)&&(F._context.useFilters=!0)}}function l(U){return function(X,b){var F=X.constructor;F._definition.addChildrenFilter(b,U)&&(F._context.useFilters=!0)}}function d(U){return void 0===U&&(U=!0),function(X,b){var F=X.constructor._definition;F.deprecated[b]=!0,U&&(F.descriptors[b]={get:function(){throw new Error("".concat(b," is deprecated."))},set:function(U){},enumerable:!1,configurable:!0})}}function k(U,X,b){for(var F in void 0===b&&(b={}),b.context||(b.context=U._context||b.context||f),X)j(X[F],b)(U.prototype,F);return U}function v(U){for(var X=0,b=0,F=0,E=U.length;F<E;F++)(X=U.charCodeAt(F))<128?b+=1:X<2048?b+=2:X<55296||X>=57344?b+=3:(F++,b+=4);return b}function A(U,X,b){for(var F=0,E=0,w=b.length;E<w;E++)(F=b.charCodeAt(E))<128?U[X++]=F:F<2048?(U[X++]=192|F>>6,U[X++]=128|63&F):F<55296||F>=57344?(U[X++]=224|F>>12,U[X++]=128|F>>6&63,U[X++]=128|63&F):(E++,F=65536+((1023&F)<<10|1023&b.charCodeAt(E)),U[X++]=240|F>>18,U[X++]=128|F>>12&63,U[X++]=128|F>>6&63,U[X++]=128|63&F)}function s(U,X){U.push(255&X)}function h(U,X){U.push(255&X)}function B(U,X){U.push(255&X),U.push(X>>8&255)}function o(U,X){U.push(255&X),U.push(X>>8&255)}function y(U,X){U.push(255&X),U.push(X>>8&255),U.push(X>>16&255),U.push(X>>24&255)}function t(U,X){var b=X>>24,F=X>>16,E=X>>8,w=X;U.push(255&w),U.push(255&E),U.push(255&F),U.push(255&b)}function W(U,X){var b=Math.floor(X/Math.pow(2,32));t(U,X>>>0),t(U,b)}function Y(U,X){var b=X/Math.pow(2,32)|0;t(U,X>>>0),t(U,b)}function K(U,X){G(U,X)}function V(U,X){Z(U,X)}var g=new Int32Array(2),L=new Float32Array(g.buffer),D=new Float64Array(g.buffer);function G(U,X){L[0]=X,y(U,g[0])}function Z(U,X){D[0]=X,y(U,g[0]),y(U,g[1])}function c(U,X){return h(U,X?1:0)}function r(U,X){X||(X="");var b=v(X),F=0;if(b<32)U.push(160|b),F=1;else if(b<256)U.push(217),h(U,b),F=2;else if(b<65536)U.push(218),o(U,b),F=3;else{if(!(b<4294967296))throw new Error("String too long");U.push(219),t(U,b),F=5}return A(U,U.length,X),F+b}function M(U,X){return isNaN(X)?M(U,0):isFinite(X)?X!==(0|X)?(U.push(203),Z(U,X),9):X>=0?X<128?(h(U,X),1):X<256?(U.push(204),h(U,X),2):X<65536?(U.push(205),o(U,X),3):X<4294967296?(U.push(206),t(U,X),5):(U.push(207),Y(U,X),9):X>=-32?(U.push(224|X+32),1):X>=-128?(U.push(208),s(U,X),2):X>=-32768?(U.push(209),B(U,X),3):X>=-2147483648?(U.push(210),y(U,X),5):(U.push(211),W(U,X),9):M(U,X>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var H=Object.freeze({__proto__:null,utf8Write:A,int8:s,uint8:h,int16:B,uint16:o,int32:y,uint32:t,int64:W,uint64:Y,float32:K,float64:V,writeFloat32:G,writeFloat64:Z,boolean:c,string:r,number:M});function T(U,X,b){for(var F="",E=0,w=X,Q=X+b;w<Q;w++){var z=U[w];0!==(128&z)?192!==(224&z)?224!==(240&z)?240!==(248&z)?console.error("Invalid byte "+z.toString(16)):(E=(7&z)<<18|(63&U[++w])<<12|(63&U[++w])<<6|63&U[++w])>=65536?(E-=65536,F+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):F+=String.fromCharCode(E):F+=String.fromCharCode((15&z)<<12|(63&U[++w])<<6|63&U[++w]):F+=String.fromCharCode((31&z)<<6|63&U[++w]):F+=String.fromCharCode(z)}return F}function C(U,X){return UU(U,X)<<24>>24}function UU(U,X){return U[X.offset++]}function XU(U,X){return bU(U,X)<<16>>16}function bU(U,X){return U[X.offset++]|U[X.offset++]<<8}function FU(U,X){return U[X.offset++]|U[X.offset++]<<8|U[X.offset++]<<16|U[X.offset++]<<24}function EU(U,X){return FU(U,X)>>>0}function wU(U,X){return nU(U,X)}function QU(U,X){return aU(U,X)}function zU(U,X){var b=EU(U,X);return FU(U,X)*Math.pow(2,32)+b}function qU(U,X){var b=EU(U,X);return EU(U,X)*Math.pow(2,32)+b}var pU=new Int32Array(2),SU=new Float32Array(pU.buffer),RU=new Float64Array(pU.buffer);function nU(U,X){return pU[0]=FU(U,X),SU[0]}function aU(U,X){return pU[0]=FU(U,X),pU[1]=FU(U,X),RU[0]}function JU(U,X){return UU(U,X)>0}function mU(U,X){var b,F=U[X.offset++];F<192?b=31&F:217===F?b=UU(U,X):218===F?b=bU(U,X):219===F&&(b=EU(U,X));var E=T(U,X.offset,b);return X.offset+=b,E}function xU(U,X){var b=U[X.offset];return b<192&&b>160||217===b||218===b||219===b}function IU(U,X){var b=U[X.offset++];return b<128?b:202===b?nU(U,X):203===b?aU(U,X):204===b?UU(U,X):205===b?bU(U,X):206===b?EU(U,X):207===b?qU(U,X):208===b?C(U,X):209===b?XU(U,X):210===b?FU(U,X):211===b?zU(U,X):b>223?-1*(255-b+1):void 0}function OU(U,X){var b=U[X.offset];return b<128||b>=202&&b<=211}function NU(U,X){return U[X.offset]<160}function uU(U,X){return U[X.offset-1]===Q&&(U[X.offset]<128||U[X.offset]>=202&&U[X.offset]<=211)}var iU=Object.freeze({__proto__:null,int8:C,uint8:UU,int16:XU,uint16:bU,int32:FU,uint32:EU,float32:wU,float64:QU,int64:zU,uint64:qU,readFloat32:nU,readFloat64:aU,boolean:JU,string:mU,stringCheck:xU,number:IU,numberCheck:OU,arrayCheck:NU,switchStructureCheck:uU}),PU=function(){function X(U){var X=this;this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U&&U.forEach((function(U){return X.add(U)}))}return X.prototype.Lz=function(X,b){return void 0===b&&(b=!0),p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,X,b?this.$items:void 0)},X.prototype.IX=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,X)},X.is=function(U){return void 0!==U.collection},X.prototype.add=function(U){var X=this.$refId++;return void 0!==U.$changes&&U.$changes.setParent(this,this.$changes.root,X),this.$changes.indexes[X]=X,this.$indexes.set(X,X),this.$items.set(X,U),this.$changes.change(X),X},X.prototype.at=function(U){var X=Array.from(this.$items.keys())[U];return this.$items.get(X)},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(U){for(var X,b,F=this.$items.entries();(b=F.next())&&!b.done;)if(U===b.value[1]){X=b.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&S.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(U){return Array.from(this.$items.values()).some((function(X){return X===U}))},X.prototype.forEach=function(U){var X=this;this.$items.forEach((function(b,F,E){return U(b,F,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(U,X){this.$indexes.set(U,X)},X.prototype.getIndex=function(U){return this.$indexes.get(U)},X.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},X.prototype.deleteByIndex=function(U){var X=this.$indexes.get(U);this.$items.delete(X),this.$indexes.delete(U)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var U=[];return this.forEach((function(X,b){U.push("function"===typeof X.toJSON?X.toJSON():X)})),U},X.prototype.clone=function(U){var b;return U?b=Object.assign(new X,this):(b=new X,this.forEach((function(U){U.$changes?b.add(U.clone()):b.add(U)}))),b},X}(),fU=function(){function X(U){var X=this;this.$changes=new q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,U&&U.forEach((function(U){return X.add(U)}))}return X.prototype.Lz=function(X,b){return void 0===b&&(b=!0),p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.ADD,X,b?this.$items:void 0)},X.prototype.IX=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,X)},X.prototype.onChange=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,X)},X.is=function(U){return void 0!==U.set},X.prototype.add=function(X){var b,F;if(this.has(X))return!1;var E=this.$refId++;void 0!==X.$changes&&X.$changes.setParent(this,this.$changes.root,E);var w=null!==(F=null===(b=this.$changes.indexes[E])||void 0===b?void 0:b.op)&&void 0!==F?F:U.OPERATION.ADD;return this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,X),this.$changes.change(E,w),E},X.prototype.entries=function(){return this.$items.entries()},X.prototype.delete=function(U){for(var X,b,F=this.$items.entries();(b=F.next())&&!b.done;)if(U===b.value[1]){X=b.value[0];break}return void 0!==X&&(this.$changes.delete(X),this.$indexes.delete(X),this.$items.delete(X))},X.prototype.clear=function(X){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),X&&S.call(this,X),this.$items.clear(),this.$changes.operation({index:0,op:U.OPERATION.CLEAR}),this.$changes.touchParents()},X.prototype.has=function(U){for(var X,b=this.$items.values(),F=!1;(X=b.next())&&!X.done;)if(U===X.value){F=!0;break}return F},X.prototype.forEach=function(U){var X=this;this.$items.forEach((function(b,F,E){return U(b,F,X)}))},X.prototype.values=function(){return this.$items.values()},Object.defineProperty(X.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),X.prototype.setIndex=function(U,X){this.$indexes.set(U,X)},X.prototype.getIndex=function(U){return this.$indexes.get(U)},X.prototype.getByIndex=function(U){return this.$items.get(this.$indexes.get(U))},X.prototype.deleteByIndex=function(U){var X=this.$indexes.get(U);this.$items.delete(X),this.$indexes.delete(U)},X.prototype.toArray=function(){return Array.from(this.$items.values())},X.prototype.toJSON=function(){var U=[];return this.forEach((function(X,b){U.push("function"===typeof X.toJSON?X.toJSON():X)})),U},X.prototype.clone=function(U){var b;return U?b=Object.assign(new X,this):(b=new X,this.forEach((function(U){U.$changes?b.add(U.clone()):b.add(U)}))),b},X}(),jU=function(){function U(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return U.prototype.addRefId=function(U){this.refIds.has(U)||(this.refIds.add(U),this.containerIndexes.set(U,new Set))},U.get=function(X){return void 0===X.$filterState&&(X.$filterState=new U),X.$filterState},U}(),eU=function(){function U(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return U.prototype.getNextUniqueId=function(){return this.nextUniqueId++},U.prototype.addRef=function(U,X,b){void 0===b&&(b=!0),this.refs.set(U,X),b&&(this.refCounts[U]=(this.refCounts[U]||0)+1)},U.prototype.removeRef=function(U){this.refCounts[U]=this.refCounts[U]-1,this.deletedRefs.add(U)},U.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},U.prototype.garbageCollectDeletedRefs=function(){var U=this;this.deletedRefs.forEach((function(X){if(!(U.refCounts[X]>0)){var b=U.refs.get(X);if(b instanceof sU)for(var F in b._definition.schema)"string"!==typeof b._definition.schema[F]&&b[F]&&b[F].$changes&&U.removeRef(b[F].$changes.refId);else{var E=b.$changes.parent._definition,w=E.schema[E.fieldsByIndex[b.$changes.parentIndex]];"function"===typeof Object.values(w)[0]&&Array.from(b.values()).forEach((function(X){return U.removeRef(X.$changes.refId)}))}U.refs.delete(X),delete U.refCounts[X]}})),this.deletedRefs.clear()},U}(),lU=function(U){function X(){return null!==U&&U.apply(this,arguments)||this}return b(X,U),X}(Error);function dU(U,X,b,F){var E,w=!1;switch(X){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":E="number",isNaN(U)&&console.log('trying to encode "NaN" in '.concat(b.constructor.name,"#").concat(F));break;case"string":E="string",w=!0;break;case"boolean":return}if(typeof U!==E&&(!w||w&&null!==U)){var Q="'".concat(JSON.stringify(U),"'").concat(U&&U.constructor&&" (".concat(U.constructor.name,")")||"");throw new lU("a '".concat(E,"' was expected, but ").concat(Q," was provided in ").concat(b.constructor.name,"#").concat(F))}}function kU(U,X,b,F){if(!(U instanceof X))throw new lU("a '".concat(X.name,"' was expected, but '").concat(U.constructor.name,"' was provided in ").concat(b.constructor.name,"#").concat(F))}function vU(U,X,b,F,E){dU(b,U,F,E);var w=H[U];if(!w)throw new lU("a '".concat(U,"' was expected, but ").concat(b," was provided in ").concat(F.constructor.name,"#").concat(E));w(X,b)}function AU(U,X,b){return iU[U](X,b)}var sU=function(){function X(){for(var U=[],X=0;X<arguments.length;X++)U[X]=arguments[X];Object.defineProperties(this,{$changes:{value:new q(this,void 0,new eU),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var b=this._definition.descriptors;b&&Object.defineProperties(this,b),U[0]&&this.assign(U[0])}return X.onError=function(U){console.error(U)},X.is=function(U){return U._definition&&void 0!==U._definition.schema},X.prototype.onChange=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.REPLACE,X)},X.prototype.IX=function(X){return p(this.$callbacks||(this.$callbacks=[]),U.OPERATION.DELETE,X)},X.prototype.assign=function(U){return Object.assign(this,U),this},Object.defineProperty(X.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),X.prototype.setDirty=function(U,X){this.$changes.change(U,X)},X.prototype.listen=function(U,X,b){var F=this;return void 0===b&&(b=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[U]||(this.$callbacks[U]=[]),this.$callbacks[U].push(X),b&&void 0!==this[U]&&X(this[U],void 0),function(){return R(F.$callbacks[U],F.$callbacks[U].indexOf(X))}},X.prototype.decode=function(b,F,E){var w;void 0===F&&(F={offset:0}),void 0===E&&(E=this);var z=[],q=this.$changes.root,p=b.length,S=0;for(q.refs.set(S,this);F.offset<p;){var R=b[F.offset++];if(R!=Q){var n=E.$changes,a=void 0!==E._definition,m=a?R>>6<<6:R;if(m!==U.OPERATION.CLEAR){var I=a?R%(m||255):IU(b,F),O=a?E._definition.fieldsByIndex[I]:"",u=n.getType(I),i=void 0,P=void 0,f=void 0;if(a?P=E["_".concat(O)]:(P=E.getByIndex(I),(m&U.OPERATION.ADD)===U.OPERATION.ADD?(f=E instanceof x?mU(b,F):I,E.setIndex(I,f)):f=E.getIndex(I)),(m&U.OPERATION.DELETE)===U.OPERATION.DELETE&&(m!==U.OPERATION.DELETE_AND_ADD&&E.deleteByIndex(I),P&&P.$changes&&q.removeRef(P.$changes.refId),i=null),void 0!==O){if(m===U.OPERATION.DELETE);else if(X.is(u)){var j=IU(b,F);if(i=q.refs.get(j),m!==U.OPERATION.REPLACE){var e=this.getSchemaType(b,F,u);i||((i=this.createTypeInstance(e)).$changes.refId=j,P&&(i.$callbacks=P.$callbacks,P.$changes.refId&&j!==P.$changes.refId&&q.removeRef(P.$changes.refId))),q.addRef(j,i,i!==P)}}else if("string"===typeof u)i=AU(u,b,F);else{var l=N(Object.keys(u)[0]),d=IU(b,F),k=q.refs.has(d)?P||q.refs.get(d):new l.constructor;if((i=k.clone(!0)).$changes.refId=d,P&&(i.$callbacks=P.$callbacks,P.$changes.refId&&d!==P.$changes.refId)){q.removeRef(P.$changes.refId);for(var v=P.entries(),A=void 0;(A=v.next())&&!A.done;){var s=(w=A.value)[0],h=w[1];z.push({refId:d,op:U.OPERATION.DELETE,field:s,value:void 0,previousValue:h})}}q.addRef(d,i,k!==P)}if(null!==i&&void 0!==i)if(i.$changes&&i.$changes.setParent(n.ref,n.root,I),E instanceof X)E[O]=i;else if(E instanceof x)s=f,E.$items.set(s,i),E.$changes.allChanges.add(I);else if(E instanceof J)E.setAt(I,i);else if(E instanceof PU){var B=E.add(i);E.setIndex(I,B)}else E instanceof fU&&!1!==(B=E.add(i))&&E.setIndex(I,B);P!==i&&z.push({refId:S,op:m,field:O,dynamicIndex:f,value:i,previousValue:P})}else{console.warn("@colyseus/schema: definition mismatch");for(var o={offset:F.offset};F.offset<p&&(!uU(b,F)||(o.offset=F.offset+1,!q.refs.has(IU(b,o))));)F.offset++}}else E.clear(z)}else{S=IU(b,F);var y=q.refs.get(S);if(!y)throw new Error('"refId" not found: '.concat(S));E=y}}return this._triggerChanges(z),q.garbageCollectDeletedRefs(),z},X.prototype.encode=function(b,F,E){void 0===b&&(b=!1),void 0===F&&(F=[]),void 0===E&&(E=!1);for(var w=this.$changes,z=new WeakSet,q=[w],p=1,S=0;S<p;S++){var R=q[S],n=R.ref,a=n instanceof X;R.ensureRefId(),z.add(R),R!==w&&(R.changed||b)&&(h(F,Q),M(F,R.refId));for(var J=b?Array.from(R.allChanges):Array.from(R.changes.values()),m=0,I=J.length;m<I;m++){var O=b?{op:U.OPERATION.ADD,index:J[m]}:J[m],u=O.index,i=a?n._definition.fieldsByIndex&&n._definition.fieldsByIndex[u]:u,P=F.length;if(O.op!==U.OPERATION.TOUCH)if(a)h(F,u|O.op);else{if(h(F,O.op),O.op===U.OPERATION.CLEAR)continue;M(F,u)}if(a||(O.op&U.OPERATION.ADD)!=U.OPERATION.ADD||n instanceof x&&r(F,R.ref.$indexes.get(u)),O.op!==U.OPERATION.DELETE){var f=R.getType(u),j=R.getValue(u);if(j&&j.$changes&&!z.has(j.$changes)&&(q.push(j.$changes),j.$changes.ensureRefId(),p++),O.op!==U.OPERATION.TOUCH){if(X.is(f))kU(j,f,n,i),M(F,j.$changes.refId),(O.op&U.OPERATION.ADD)===U.OPERATION.ADD&&this.tryEncodeTypeId(F,f,j.constructor);else if("string"===typeof f)vU(f,F,j,n,i);else{var e=N(Object.keys(f)[0]);kU(n["_".concat(i)],e.constructor,n,i),M(F,j.$changes.refId)}E&&R.cache(u,F.slice(P))}}}b||E||R.discard()}return F},X.prototype.encodeAll=function(U){return this.encode(!0,[],U)},X.prototype.applyFilters=function(b,F){var E,w;void 0===F&&(F=!1);for(var z=this,q=new Set,p=jU.get(b),S=[this.$changes],R=1,n=[],a=function(a){var J=S[a];if(q.has(J.refId))return"continue";var m=J.ref,I=m instanceof X;h(n,Q),M(n,J.refId);var O=p.refIds.has(J),N=F||!O;p.addRefId(J);var u=p.containerIndexes.get(J),i=N?Array.from(J.allChanges):Array.from(J.changes.values());!F&&I&&m._definition.indexesWithFilters&&m._definition.indexesWithFilters.forEach((function(X){!u.has(X)&&J.allChanges.has(X)&&(N?i.push(X):i.push({op:U.OPERATION.ADD,index:X}))}));for(var P=0,f=i.length;P<f;P++){var j=N?{op:U.OPERATION.ADD,index:i[P]}:i[P];if(j.op!==U.OPERATION.CLEAR){var e=j.index;if(j.op!==U.OPERATION.DELETE){var l=J.getValue(e),d=J.getType(e);if(I){if((k=m._definition.filters&&m._definition.filters[e])&&!k.call(m,b,l,z)){l&&l.$changes&&q.add(l.$changes.refId);continue}}else{var k,v=J.parent;if((k=J.getChildrenFilter())&&!k.call(v,b,m.$indexes.get(e),l,z)){l&&l.$changes&&q.add(l.$changes.refId);continue}}if(l.$changes&&(S.push(l.$changes),R++),j.op!==U.OPERATION.TOUCH)if(j.op===U.OPERATION.ADD||I)n.push.apply(n,null!==(E=J.caches[e])&&void 0!==E?E:[]),u.add(e);else if(u.has(e))n.push.apply(n,null!==(w=J.caches[e])&&void 0!==w?w:[]);else{if(u.add(e),h(n,U.OPERATION.ADD),M(n,e),m instanceof x){var A=J.ref.$indexes.get(e);r(n,A)}l.$changes?M(n,l.$changes.refId):H[d](n,l)}else l.$changes&&!I&&(h(n,U.OPERATION.ADD),M(n,e),m instanceof x&&(A=J.ref.$indexes.get(e),r(n,A)),M(n,l.$changes.refId))}else I?h(n,j.op|e):(h(n,j.op),M(n,e))}else h(n,j.op)}},J=0;J<R;J++)a(J);return n},X.prototype.clone=function(){var U,X=new this.constructor,b=this._definition.schema;for(var F in b)"object"===typeof this[F]&&"function"===typeof(null===(U=this[F])||void 0===U?void 0:U.clone)?X[F]=this[F].clone():X[F]=this[F];return X},X.prototype.toJSON=function(){var U=this._definition.schema,X=this._definition.deprecated,b={};for(var F in U)X[F]||null===this[F]||"undefined"===typeof this[F]||(b[F]="function"===typeof this[F].toJSON?this[F].toJSON():this["_".concat(F)]);return b},X.prototype.discardAllChanges=function(){this.$changes.discardAll()},X.prototype.getByIndex=function(U){return this[this._definition.fieldsByIndex[U]]},X.prototype.deleteByIndex=function(U){this[this._definition.fieldsByIndex[U]]=void 0},X.prototype.tryEncodeTypeId=function(U,X,b){X._typeid!==b._typeid&&(h(U,z),M(U,b._typeid))},X.prototype.getSchemaType=function(U,X,b){var F;return U[X.offset]===z&&(X.offset++,F=this.constructor._context.get(IU(U,X))),F||b},X.prototype.createTypeInstance=function(U){var X=new U;return X.$changes.root=this.$changes.root,X},X.prototype._triggerChanges=function(b){for(var F,E,w,Q,z,q,p,S,R,n=new Set,a=this.$changes.root.refs,J=function(J){var m=b[J],x=m.refId,I=a.get(x),O=I.$callbacks;if((m.op&U.OPERATION.DELETE)===U.OPERATION.DELETE&&m.previousValue instanceof X&&(null===(E=null===(F=m.previousValue.$callbacks)||void 0===F?void 0:F[U.OPERATION.DELETE])||void 0===E||E.forEach((function(U){return U()}))),!O)return"continue";if(I instanceof X){if(!n.has(x))try{null===(w=null===O||void 0===O?void 0:O[U.OPERATION.REPLACE])||void 0===w||w.forEach((function(U){return U()}))}catch(N){X.onError(N)}try{O.hasOwnProperty(m.field)&&(null===(Q=O[m.field])||void 0===Q||Q.forEach((function(U){return U(m.value,m.previousValue)})))}catch(N){X.onError(N)}}else m.op===U.OPERATION.ADD&&void 0===m.previousValue?null===(z=O[U.OPERATION.ADD])||void 0===z||z.forEach((function(U){var X;return U(m.value,null!==(X=m.dynamicIndex)&&void 0!==X?X:m.field)})):m.op===U.OPERATION.DELETE?void 0!==m.previousValue&&(null===(q=O[U.OPERATION.DELETE])||void 0===q||q.forEach((function(U){var X;return U(m.previousValue,null!==(X=m.dynamicIndex)&&void 0!==X?X:m.field)}))):m.op===U.OPERATION.DELETE_AND_ADD&&(void 0!==m.previousValue&&(null===(p=O[U.OPERATION.DELETE])||void 0===p||p.forEach((function(U){var X;return U(m.previousValue,null!==(X=m.dynamicIndex)&&void 0!==X?X:m.field)}))),null===(S=O[U.OPERATION.ADD])||void 0===S||S.forEach((function(U){var X;return U(m.value,null!==(X=m.dynamicIndex)&&void 0!==X?X:m.field)}))),m.value!==m.previousValue&&(null===(R=O[U.OPERATION.REPLACE])||void 0===R||R.forEach((function(U){var X;return U(m.value,null!==(X=m.dynamicIndex)&&void 0!==X?X:m.field)})));n.add(x)},m=0;m<b.length;m++)J(m)},X._definition=u.create(),X}();function hU(U){for(var X=[U.$changes],b=1,F={},E=F,w=function(U){var b=X[U];b.changes.forEach((function(U){var X=b.ref,F=U.index,w=X._definition?X._definition.fieldsByIndex[F]:X.$indexes.get(F);E[w]=b.getValue(F)}))},Q=0;Q<b;Q++)w(Q);return F}var BU={context:new P},oU=function(U){function X(){return null!==U&&U.apply(this,arguments)||this}return b(X,U),F([j("string",BU)],X.prototype,"name",void 0),F([j("string",BU)],X.prototype,"type",void 0),F([j("number",BU)],X.prototype,"referencedType",void 0),X}(sU),yU=function(U){function X(){var X=null!==U&&U.apply(this,arguments)||this;return X.fields=new J,X}return b(X,U),F([j("number",BU)],X.prototype,"id",void 0),F([j([oU],BU)],X.prototype,"fields",void 0),X}(sU),tU=function(U){function X(){var X=null!==U&&U.apply(this,arguments)||this;return X.types=new J,X}return b(X,U),X.encode=function(U){var b=U.constructor,F=new X;F.rootType=b._typeid;var E=function(U,X){for(var b in X){var E=new oU;E.name=b;var w=void 0;if("string"===typeof X[b])w=X[b];else{var Q=X[b],z=void 0;sU.is(Q)?(w="ref",z=X[b]):"string"===typeof Q[w=Object.keys(Q)[0]]?w+=":"+Q[w]:z=Q[w],E.referencedType=z?z._typeid:-1}E.type=w,U.fields.push(E)}F.types.push(U)},w=b._context.types;for(var Q in w){var z=new yU;z.id=Number(Q),E(z,w[Q]._definition.schema)}return F.encodeAll()},X.decode=function(U,F){var E=new P,w=new X;w.decode(U,F);var Q=w.types.reduce((function(U,X){var F=function(U){function X(){return null!==U&&U.apply(this,arguments)||this}return b(X,U),X}(sU),w=X.id;return U[w]=F,E.add(F,w),U}),{});w.types.forEach((function(U){var X=Q[U.id];U.fields.forEach((function(U){var b;if(void 0!==U.referencedType){var F=U.type,w=Q[U.referencedType];if(!w){var z=U.type.split(":");F=z[0],w=z[1]}"ref"===F?j(w,{context:E})(X.prototype,U.name):j(((b={})[F]=w,b),{context:E})(X.prototype,U.name)}else j(U.type,{context:E})(X.prototype,U.name)}))}));var z=Q[w.rootType],q=new z;for(var p in z._definition.schema){var S=z._definition.schema[p];"string"!==typeof S&&(q[p]="function"===typeof S?new S:new(N(Object.keys(S)[0]).constructor))}return q},F([j([yU],BU)],X.prototype,"types",void 0),F([j("number",BU)],X.prototype,"rootType",void 0),X}(sU);O("map",{constructor:x}),O("array",{constructor:J}),O("set",{constructor:fU}),O("collection",{constructor:PU}),U.ArraySchema=J,U.CollectionSchema=PU,U.Context=P,U.MapSchema=x,U.Reflection=tU,U.ReflectionField=oU,U.ReflectionType=yU,U.Schema=sU,U.SchemaDefinition=u,U.SetSchema=fU,U.decode=iU,U.defineTypes=k,U.deprecated=d,U.dumpChanges=hU,U.encode=H,U.filter=e,U.filterChildren=l,U.hasFilter=i,U.registerType=O,U.type=j,Object.defineProperty(U,"__esModule",{value:!0})}(X)},13727:U=>{"use strict";U.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13721:(U,X,b)=>{var F=b(13727),E=b(13734),w=Object.hasOwnProperty,Q=Object.create(null);for(var z in F)w.call(F,z)&&(Q[F[z]]=z);var q=U.exports={to:{},get:{}};function p(U,X,b){return Math.min(Math.max(X,U),b)}function S(U){var X=Math.round(U).toString(16).toUpperCase();return X.length<2?"0"+X:X}q.get=function(U){var X,b;switch(U.substring(0,3).toLowerCase()){case"hsl":X=q.get.hsl(U),b="hsl";break;case"hwb":X=q.get.hwb(U),b="hwb";break;default:X=q.get.rgb(U),b="rgb"}return X?{model:b,value:X}:null},q.get.rgb=function(U){if(!U)return null;var X,b,E,Q=[0,0,0,1];if(X=U.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(E=X[2],X=X[1],b=0;b<3;b++){var z=2*b;Q[b]=parseInt(X.slice(z,z+2),16)}E&&(Q[3]=parseInt(E,16)/255)}else if(X=U.match(/^#([a-f0-9]{3,4})$/i)){for(E=(X=X[1])[3],b=0;b<3;b++)Q[b]=parseInt(X[b]+X[b],16);E&&(Q[3]=parseInt(E+E,16)/255)}else if(X=U.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(b=0;b<3;b++)Q[b]=parseInt(X[b+1],0);X[4]&&(X[5]?Q[3]=.01*parseFloat(X[4]):Q[3]=parseFloat(X[4]))}else{if(!(X=U.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(X=U.match(/^(\w+)$/))?"transparent"===X[1]?[0,0,0,0]:w.call(F,X[1])?((Q=F[X[1]])[3]=1,Q):null:null;for(b=0;b<3;b++)Q[b]=Math.round(2.55*parseFloat(X[b+1]));X[4]&&(X[5]?Q[3]=.01*parseFloat(X[4]):Q[3]=parseFloat(X[4]))}for(b=0;b<3;b++)Q[b]=p(Q[b],0,255);return Q[3]=p(Q[3],0,1),Q},q.get.hsl=function(U){if(!U)return null;var X=U.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var b=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,p(parseFloat(X[2]),0,100),p(parseFloat(X[3]),0,100),p(isNaN(b)?1:b,0,1)]}return null},q.get.hwb=function(U){if(!U)return null;var X=U.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(X){var b=parseFloat(X[4]);return[(parseFloat(X[1])%360+360)%360,p(parseFloat(X[2]),0,100),p(parseFloat(X[3]),0,100),p(isNaN(b)?1:b,0,1)]}return null},q.to.hex=function(){var U=E(arguments);return"#"+S(U[0])+S(U[1])+S(U[2])+(U[3]<1?S(Math.round(255*U[3])):"")},q.to.rgb=function(){var U=E(arguments);return U.length<4||1===U[3]?"rgb("+Math.round(U[0])+", "+Math.round(U[1])+", "+Math.round(U[2])+")":"rgba("+Math.round(U[0])+", "+Math.round(U[1])+", "+Math.round(U[2])+", "+U[3]+")"},q.to.rgb.percent=function(){var U=E(arguments),X=Math.round(U[0]/255*100),b=Math.round(U[1]/255*100),F=Math.round(U[2]/255*100);return U.length<4||1===U[3]?"rgb("+X+"%, "+b+"%, "+F+"%)":"rgba("+X+"%, "+b+"%, "+F+"%, "+U[3]+")"},q.to.hsl=function(){var U=E(arguments);return U.length<4||1===U[3]?"hsl("+U[0]+", "+U[1]+"%, "+U[2]+"%)":"hsla("+U[0]+", "+U[1]+"%, "+U[2]+"%, "+U[3]+")"},q.to.hwb=function(){var U=E(arguments),X="";return U.length>=4&&1!==U[3]&&(X=", "+U[3]),"hwb("+U[0]+", "+U[1]+"%, "+U[2]+"%"+X+")"},q.to.keyword=function(U){return Q[U.slice(0,3)]}},13712:(U,X,b)=>{const F=b(13721),E=b(13744),w=["keyword","gray","hex"],Q={};for(const a of Object.keys(E))Q[[...E[a].labels].sort().join("")]=a;const z={};function q(U,X){if(!(this instanceof q))return new q(U,X);if(X&&X in w&&(X=null),X&&!(X in E))throw new Error("Unknown model: "+X);let b,p;if(null==U)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(U instanceof q)this.model=U.model,this.color=[...U.color],this.valpha=U.valpha;else if("string"===typeof U){const X=F.get(U);if(null===X)throw new Error("Unable to parse color from string: "+U);this.model=X.model,p=E[this.model].channels,this.color=X.value.slice(0,p),this.valpha="number"===typeof X.value[p]?X.value[p]:1}else if(U.length>0){this.model=X||"rgb",p=E[this.model].channels;const b=Array.prototype.slice.call(U,0,p);this.color=n(b,p),this.valpha="number"===typeof U[p]?U[p]:1}else if("number"===typeof U)this.model="rgb",this.color=[U>>16&255,U>>8&255,255&U],this.valpha=1;else{this.valpha=1;const X=Object.keys(U);"alpha"in U&&(X.splice(X.indexOf("alpha"),1),this.valpha="number"===typeof U.alpha?U.alpha:0);const F=X.sort().join("");if(!(F in Q))throw new Error("Unable to parse color from object: "+JSON.stringify(U));this.model=Q[F];const{labels:w}=E[this.model],z=[];for(b=0;b<w.length;b++)z.push(U[w[b]]);this.color=n(z)}if(z[this.model])for(p=E[this.model].channels,b=0;b<p;b++){const U=z[this.model][b];U&&(this.color[b]=U(this.color[b]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}q.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(U){let X=this.model in F.to?this:this.rgb();X=X.round("number"===typeof U?U:1);const b=1===X.valpha?X.color:[...X.color,this.valpha];return F.to[X.model](b)},percentString(U){const X=this.rgb().round("number"===typeof U?U:1),b=1===X.valpha?X.color:[...X.color,this.valpha];return F.to.rgb.percent(b)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const U={},{channels:X}=E[this.model],{labels:b}=E[this.model];for(let F=0;F<X;F++)U[b[F]]=this.color[F];return 1!==this.valpha&&(U.alpha=this.valpha),U},unitArray(){const U=this.rgb().color;return U[0]/=255,U[1]/=255,U[2]/=255,1!==this.valpha&&U.push(this.valpha),U},unitObject(){const U=this.rgb().object();return U.r/=255,U.g/=255,U.b/=255,1!==this.valpha&&(U.alpha=this.valpha),U},round(U){return U=Math.max(U||0,0),new q([...this.color.map(p(U)),this.valpha],this.model)},alpha(U){return void 0!==U?new q([...this.color,Math.max(0,Math.min(1,U))],this.model):this.valpha},red:S("rgb",0,R(255)),green:S("rgb",1,R(255)),blue:S("rgb",2,R(255)),hue:S(["hsl","hsv","hsl","hwb","hcg"],0,(U=>(U%360+360)%360)),saturationl:S("hsl",1,R(100)),lightness:S("hsl",2,R(100)),saturationv:S("hsv",1,R(100)),value:S("hsv",2,R(100)),chroma:S("hcg",1,R(100)),gray:S("hcg",2,R(100)),white:S("hwb",1,R(100)),wblack:S("hwb",2,R(100)),cyan:S("cmyk",0,R(100)),magenta:S("cmyk",1,R(100)),yellow:S("cmyk",2,R(100)),black:S("cmyk",3,R(100)),x:S("xyz",0,R(95.047)),y:S("xyz",1,R(100)),z:S("xyz",2,R(108.833)),l:S("lab",0,R(100)),a:S("lab",1),b:S("lab",2),keyword(U){return void 0!==U?new q(U):E[this.model].keyword(this.color)},hex(U){return void 0!==U?new q(U):F.to.hex(this.rgb().round().color)},hexa(U){if(void 0!==U)return new q(U);const X=this.rgb().round().color;let b=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===b.length&&(b="0"+b),F.to.hex(X)+b},rgbNumber(){const U=this.rgb().color;return(255&U[0])<<16|(255&U[1])<<8|255&U[2]},luminosity(){const U=this.rgb().color,X=[];for(const[b,F]of U.entries()){const U=F/255;X[b]=U<=.04045?U/12.92:((U+.055)/1.055)**2.4}return.2126*X[0]+.7152*X[1]+.0722*X[2]},contrast(U){const X=this.luminosity(),b=U.luminosity();return X>b?(X+.05)/(b+.05):(b+.05)/(X+.05)},level(U){const X=this.contrast(U);return X>=7?"AAA":X>=4.5?"AA":""},isDark(){const U=this.rgb().color;return(2126*U[0]+7152*U[1]+722*U[2])/1e4<128},isLight(){return!this.isDark()},negate(){const U=this.rgb();for(let X=0;X<3;X++)U.color[X]=255-U.color[X];return U},lighten(U){const X=this.hsl();return X.color[2]+=X.color[2]*U,X},darken(U){const X=this.hsl();return X.color[2]-=X.color[2]*U,X},saturate(U){const X=this.hsl();return X.color[1]+=X.color[1]*U,X},desaturate(U){const X=this.hsl();return X.color[1]-=X.color[1]*U,X},whiten(U){const X=this.hwb();return X.color[1]+=X.color[1]*U,X},blacken(U){const X=this.hwb();return X.color[2]+=X.color[2]*U,X},grayscale(){const U=this.rgb().color,X=.3*U[0]+.59*U[1]+.11*U[2];return q.rgb(X,X,X)},fade(U){return this.alpha(this.valpha-this.valpha*U)},opaquer(U){return this.alpha(this.valpha+this.valpha*U)},rotate(U){const X=this.hsl();let b=X.color[0];return b=(b+U)%360,b=b<0?360+b:b,X.color[0]=b,X},mix(U,X){if(!U||!U.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof U);const b=U.rgb(),F=this.rgb(),E=void 0===X?.5:X,w=2*E-1,Q=b.alpha()-F.alpha(),z=((w*Q===-1?w:(w+Q)/(1+w*Q))+1)/2,p=1-z;return q.rgb(z*b.red()+p*F.red(),z*b.green()+p*F.green(),z*b.blue()+p*F.blue(),b.alpha()*E+F.alpha()*(1-E))}};for(const a of Object.keys(E)){if(w.includes(a))continue;const{channels:U}=E[a];q.prototype[a]=function(){if(this.model===a)return new q(this);for(var U=arguments.length,X=new Array(U),b=0;b<U;b++)X[b]=arguments[b];return X.length>0?new q(X,a):new q([...(F=E[this.model][a].raw(this.color),Array.isArray(F)?F:[F]),this.valpha],a);var F},q[a]=function(){for(var X=arguments.length,b=new Array(X),F=0;F<X;F++)b[F]=arguments[F];let E=b[0];return"number"===typeof E&&(E=n(b,U)),new q(E,a)}}function p(U){return function(X){return function(U,X){return Number(U.toFixed(X))}(X,U)}}function S(U,X,b){U=Array.isArray(U)?U:[U];for(const F of U)(z[F]||(z[F]=[]))[X]=b;return U=U[0],function(F){let E;return void 0!==F?(b&&(F=b(F)),E=this[U](),E.color[X]=F,E):(E=this[U]().color[X],b&&(E=b(E)),E)}}function R(U){return function(X){return Math.max(0,Math.min(U,X))}}function n(U,X){for(let b=0;b<X;b++)"number"!==typeof U[b]&&(U[b]=0);return U}U.exports=q},13751:(U,X,b)=>{const F=b(13755),E={};for(const Q of Object.keys(F))E[F[Q]]=Q;const w={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};U.exports=w;for(const Q of Object.keys(w)){if(!("channels"in w[Q]))throw new Error("missing channels property: "+Q);if(!("labels"in w[Q]))throw new Error("missing channel labels property: "+Q);if(w[Q].labels.length!==w[Q].channels)throw new Error("channel and label counts mismatch: "+Q);const{channels:U,labels:X}=w[Q];delete w[Q].channels,delete w[Q].labels,Object.defineProperty(w[Q],"channels",{value:U}),Object.defineProperty(w[Q],"labels",{value:X})}w.rgb.hsl=function(U){const X=U[0]/255,b=U[1]/255,F=U[2]/255,E=Math.min(X,b,F),w=Math.max(X,b,F),Q=w-E;let z,q;w===E?z=0:X===w?z=(b-F)/Q:b===w?z=2+(F-X)/Q:F===w&&(z=4+(X-b)/Q),z=Math.min(60*z,360),z<0&&(z+=360);const p=(E+w)/2;return q=w===E?0:p<=.5?Q/(w+E):Q/(2-w-E),[z,100*q,100*p]},w.rgb.hsv=function(U){let X,b,F,E,w;const Q=U[0]/255,z=U[1]/255,q=U[2]/255,p=Math.max(Q,z,q),S=p-Math.min(Q,z,q),R=function(U){return(p-U)/6/S+.5};return 0===S?(E=0,w=0):(w=S/p,X=R(Q),b=R(z),F=R(q),Q===p?E=F-b:z===p?E=1/3+X-F:q===p&&(E=2/3+b-X),E<0?E+=1:E>1&&(E-=1)),[360*E,100*w,100*p]},w.rgb.hwb=function(U){const X=U[0],b=U[1];let F=U[2];const E=w.rgb.hsl(U)[0],Q=1/255*Math.min(X,Math.min(b,F));return F=1-1/255*Math.max(X,Math.max(b,F)),[E,100*Q,100*F]},w.rgb.cmyk=function(U){const X=U[0]/255,b=U[1]/255,F=U[2]/255,E=Math.min(1-X,1-b,1-F);return[100*((1-X-E)/(1-E)||0),100*((1-b-E)/(1-E)||0),100*((1-F-E)/(1-E)||0),100*E]},w.rgb.keyword=function(U){const X=E[U];if(X)return X;let b,w=1/0;for(const E of Object.keys(F)){const X=F[E],q=(z=X,((Q=U)[0]-z[0])**2+(Q[1]-z[1])**2+(Q[2]-z[2])**2);q<w&&(w=q,b=E)}var Q,z;return b},w.keyword.rgb=function(U){return F[U]},w.rgb.xyz=function(U){let X=U[0]/255,b=U[1]/255,F=U[2]/255;X=X>.04045?((X+.055)/1.055)**2.4:X/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,F=F>.04045?((F+.055)/1.055)**2.4:F/12.92;return[100*(.4124*X+.3576*b+.1805*F),100*(.2126*X+.7152*b+.0722*F),100*(.0193*X+.1192*b+.9505*F)]},w.rgb.lab=function(U){const X=w.rgb.xyz(U);let b=X[0],F=X[1],E=X[2];b/=95.047,F/=100,E/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,F=F>.008856?F**(1/3):7.787*F+16/116,E=E>.008856?E**(1/3):7.787*E+16/116;return[116*F-16,500*(b-F),200*(F-E)]},w.hsl.rgb=function(U){const X=U[0]/360,b=U[1]/100,F=U[2]/100;let E,w,Q;if(0===b)return Q=255*F,[Q,Q,Q];E=F<.5?F*(1+b):F+b-F*b;const z=2*F-E,q=[0,0,0];for(let p=0;p<3;p++)w=X+1/3*-(p-1),w<0&&w++,w>1&&w--,Q=6*w<1?z+6*(E-z)*w:2*w<1?E:3*w<2?z+(E-z)*(2/3-w)*6:z,q[p]=255*Q;return q},w.hsl.hsv=function(U){const X=U[0];let b=U[1]/100,F=U[2]/100,E=b;const w=Math.max(F,.01);F*=2,b*=F<=1?F:2-F,E*=w<=1?w:2-w;return[X,100*(0===F?2*E/(w+E):2*b/(F+b)),100*((F+b)/2)]},w.hsv.rgb=function(U){const X=U[0]/60,b=U[1]/100;let F=U[2]/100;const E=Math.floor(X)%6,w=X-Math.floor(X),Q=255*F*(1-b),z=255*F*(1-b*w),q=255*F*(1-b*(1-w));switch(F*=255,E){case 0:return[F,q,Q];case 1:return[z,F,Q];case 2:return[Q,F,q];case 3:return[Q,z,F];case 4:return[q,Q,F];case 5:return[F,Q,z]}},w.hsv.hsl=function(U){const X=U[0],b=U[1]/100,F=U[2]/100,E=Math.max(F,.01);let w,Q;Q=(2-b)*F;const z=(2-b)*E;return w=b*E,w/=z<=1?z:2-z,w=w||0,Q/=2,[X,100*w,100*Q]},w.hwb.rgb=function(U){const X=U[0]/360;let b=U[1]/100,F=U[2]/100;const E=b+F;let w;E>1&&(b/=E,F/=E);const Q=Math.floor(6*X),z=1-F;w=6*X-Q,0!==(1&Q)&&(w=1-w);const q=b+w*(z-b);let p,S,R;switch(Q){default:case 6:case 0:p=z,S=q,R=b;break;case 1:p=q,S=z,R=b;break;case 2:p=b,S=z,R=q;break;case 3:p=b,S=q,R=z;break;case 4:p=q,S=b,R=z;break;case 5:p=z,S=b,R=q}return[255*p,255*S,255*R]},w.cmyk.rgb=function(U){const X=U[0]/100,b=U[1]/100,F=U[2]/100,E=U[3]/100;return[255*(1-Math.min(1,X*(1-E)+E)),255*(1-Math.min(1,b*(1-E)+E)),255*(1-Math.min(1,F*(1-E)+E))]},w.xyz.rgb=function(U){const X=U[0]/100,b=U[1]/100,F=U[2]/100;let E,w,Q;return E=3.2406*X+-1.5372*b+-.4986*F,w=-.9689*X+1.8758*b+.0415*F,Q=.0557*X+-.204*b+1.057*F,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,w=w>.0031308?1.055*w**(1/2.4)-.055:12.92*w,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:12.92*Q,E=Math.min(Math.max(0,E),1),w=Math.min(Math.max(0,w),1),Q=Math.min(Math.max(0,Q),1),[255*E,255*w,255*Q]},w.xyz.lab=function(U){let X=U[0],b=U[1],F=U[2];X/=95.047,b/=100,F/=108.883,X=X>.008856?X**(1/3):7.787*X+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,F=F>.008856?F**(1/3):7.787*F+16/116;return[116*b-16,500*(X-b),200*(b-F)]},w.lab.xyz=function(U){let X,b,F;b=(U[0]+16)/116,X=U[1]/500+b,F=b-U[2]/200;const E=b**3,w=X**3,Q=F**3;return b=E>.008856?E:(b-16/116)/7.787,X=w>.008856?w:(X-16/116)/7.787,F=Q>.008856?Q:(F-16/116)/7.787,X*=95.047,b*=100,F*=108.883,[X,b,F]},w.lab.lch=function(U){const X=U[0],b=U[1],F=U[2];let E;E=360*Math.atan2(F,b)/2/Math.PI,E<0&&(E+=360);return[X,Math.sqrt(b*b+F*F),E]},w.lch.lab=function(U){const X=U[0],b=U[1],F=U[2]/360*2*Math.PI;return[X,b*Math.cos(F),b*Math.sin(F)]},w.rgb.ansi16=function(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[b,F,E]=U;let Q=null===X?w.rgb.hsv(U)[2]:X;if(Q=Math.round(Q/50),0===Q)return 30;let z=30+(Math.round(E/255)<<2|Math.round(F/255)<<1|Math.round(b/255));return 2===Q&&(z+=60),z},w.hsv.ansi16=function(U){return w.rgb.ansi16(w.hsv.rgb(U),U[2])},w.rgb.ansi256=function(U){const X=U[0],b=U[1],F=U[2];if(X===b&&b===F)return X<8?16:X>248?231:Math.round((X-8)/247*24)+232;return 16+36*Math.round(X/255*5)+6*Math.round(b/255*5)+Math.round(F/255*5)},w.ansi16.rgb=function(U){let X=U%10;if(0===X||7===X)return U>50&&(X+=3.5),X=X/10.5*255,[X,X,X];const b=.5*(1+~~(U>50));return[(1&X)*b*255,(X>>1&1)*b*255,(X>>2&1)*b*255]},w.ansi256.rgb=function(U){if(U>=232){const X=10*(U-232)+8;return[X,X,X]}let X;U-=16;return[Math.floor(U/36)/5*255,Math.floor((X=U%36)/6)/5*255,X%6/5*255]},w.rgb.hex=function(U){const X=(((255&Math.round(U[0]))<<16)+((255&Math.round(U[1]))<<8)+(255&Math.round(U[2]))).toString(16).toUpperCase();return"000000".substring(X.length)+X},w.hex.rgb=function(U){const X=U.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!X)return[0,0,0];let b=X[0];3===X[0].length&&(b=b.split("").map((U=>U+U)).join(""));const F=parseInt(b,16);return[F>>16&255,F>>8&255,255&F]},w.rgb.hcg=function(U){const X=U[0]/255,b=U[1]/255,F=U[2]/255,E=Math.max(Math.max(X,b),F),w=Math.min(Math.min(X,b),F),Q=E-w;let z,q;return z=Q<1?w/(1-Q):0,q=Q<=0?0:E===X?(b-F)/Q%6:E===b?2+(F-X)/Q:4+(X-b)/Q,q/=6,q%=1,[360*q,100*Q,100*z]},w.hsl.hcg=function(U){const X=U[1]/100,b=U[2]/100,F=b<.5?2*X*b:2*X*(1-b);let E=0;return F<1&&(E=(b-.5*F)/(1-F)),[U[0],100*F,100*E]},w.hsv.hcg=function(U){const X=U[1]/100,b=U[2]/100,F=X*b;let E=0;return F<1&&(E=(b-F)/(1-F)),[U[0],100*F,100*E]},w.hcg.rgb=function(U){const X=U[0]/360,b=U[1]/100,F=U[2]/100;if(0===b)return[255*F,255*F,255*F];const E=[0,0,0],w=X%1*6,Q=w%1,z=1-Q;let q=0;switch(Math.floor(w)){case 0:E[0]=1,E[1]=Q,E[2]=0;break;case 1:E[0]=z,E[1]=1,E[2]=0;break;case 2:E[0]=0,E[1]=1,E[2]=Q;break;case 3:E[0]=0,E[1]=z,E[2]=1;break;case 4:E[0]=Q,E[1]=0,E[2]=1;break;default:E[0]=1,E[1]=0,E[2]=z}return q=(1-b)*F,[255*(b*E[0]+q),255*(b*E[1]+q),255*(b*E[2]+q)]},w.hcg.hsv=function(U){const X=U[1]/100,b=X+U[2]/100*(1-X);let F=0;return b>0&&(F=X/b),[U[0],100*F,100*b]},w.hcg.hsl=function(U){const X=U[1]/100,b=U[2]/100*(1-X)+.5*X;let F=0;return b>0&&b<.5?F=X/(2*b):b>=.5&&b<1&&(F=X/(2*(1-b))),[U[0],100*F,100*b]},w.hcg.hwb=function(U){const X=U[1]/100,b=X+U[2]/100*(1-X);return[U[0],100*(b-X),100*(1-b)]},w.hwb.hcg=function(U){const X=U[1]/100,b=1-U[2]/100,F=b-X;let E=0;return F<1&&(E=(b-F)/(1-F)),[U[0],100*F,100*E]},w.apple.rgb=function(U){return[U[0]/65535*255,U[1]/65535*255,U[2]/65535*255]},w.rgb.apple=function(U){return[U[0]/255*65535,U[1]/255*65535,U[2]/255*65535]},w.gray.rgb=function(U){return[U[0]/100*255,U[0]/100*255,U[0]/100*255]},w.gray.hsl=function(U){return[0,0,U[0]]},w.gray.hsv=w.gray.hsl,w.gray.hwb=function(U){return[0,100,U[0]]},w.gray.cmyk=function(U){return[0,0,0,U[0]]},w.gray.lab=function(U){return[U[0],0,0]},w.gray.hex=function(U){const X=255&Math.round(U[0]/100*255),b=((X<<16)+(X<<8)+X).toString(16).toUpperCase();return"000000".substring(b.length)+b},w.rgb.gray=function(U){return[(U[0]+U[1]+U[2])/3/255*100]}},13744:(U,X,b)=>{const F=b(13751),E=b(13760),w={};Object.keys(F).forEach((U=>{w[U]={},Object.defineProperty(w[U],"channels",{value:F[U].channels}),Object.defineProperty(w[U],"labels",{value:F[U].labels});const X=E(U);Object.keys(X).forEach((b=>{const F=X[b];w[U][b]=function(U){const X=function(){for(var X=arguments.length,b=new Array(X),F=0;F<X;F++)b[F]=arguments[F];const E=b[0];if(void 0===E||null===E)return E;E.length>1&&(b=E);const w=U(b);if("object"===typeof w)for(let U=w.length,Q=0;Q<U;Q++)w[Q]=Math.round(w[Q]);return w};return"conversion"in U&&(X.conversion=U.conversion),X}(F),w[U][b].raw=function(U){const X=function(){for(var X=arguments.length,b=new Array(X),F=0;F<X;F++)b[F]=arguments[F];const E=b[0];return void 0===E||null===E?E:(E.length>1&&(b=E),U(b))};return"conversion"in U&&(X.conversion=U.conversion),X}(F)}))})),U.exports=w},13760:(U,X,b)=>{const F=b(13751);function E(U){const X=function(){const U={},X=Object.keys(F);for(let b=X.length,F=0;F<b;F++)U[X[F]]={distance:-1,parent:null};return U}(),b=[U];for(X[U].distance=0;b.length;){const U=b.pop(),E=Object.keys(F[U]);for(let F=E.length,w=0;w<F;w++){const F=E[w],Q=X[F];-1===Q.distance&&(Q.distance=X[U].distance+1,Q.parent=U,b.unshift(F))}}return X}function w(U,X){return function(b){return X(U(b))}}function Q(U,X){const b=[X[U].parent,U];let E=F[X[U].parent][U],Q=X[U].parent;for(;X[Q].parent;)b.unshift(X[Q].parent),E=w(F[X[Q].parent][Q],E),Q=X[Q].parent;return E.conversion=b,E}U.exports=function(U){const X=E(U),b={},F=Object.keys(X);for(let E=F.length,w=0;w<E;w++){const U=F[w];null!==X[U].parent&&(b[U]=Q(U,X))}return b}},13755:U=>{"use strict";U.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12314:(U,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.discordURLBuilder=void 0,X.discordURLBuilder=function(U){var X;const b=(null===(X=null===window||void 0===window?void 0:window.location)||void 0===X?void 0:X.hostname)||"localhost",F=U.hostname.split("."),E=!U.hostname.includes("trycloudflare.com")&&!U.hostname.includes("discordsays.com")&&F.length>2?`/${F[0]}`:"";return U.pathname.startsWith("/.proxy")?`${U.protocol}//${b}${E}${U.pathname}${U.search}`:`${U.protocol}//${b}/.proxy/colyseus${E}${U.pathname}${U.search}`}},12302:function(U,X,b){"use strict";var F,E,w,Q,z=this&&this.__awaiter||function(U,X,b,F){return new(b||(b=Promise))((function(E,w){function Q(U){try{q(F.next(U))}catch(X){w(X)}}function z(U){try{q(F.throw(U))}catch(X){w(X)}}function q(U){var X;U.done?E(U.value):(X=U.value,X instanceof b?X:new b((function(U){U(X)}))).then(Q,z)}q((F=F.apply(U,X||[])).next())}))},q=this&&this.__classPrivateFieldGet||function(U,X,b,F){if("a"===b&&!F)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof X?U!==X||!F:!X.has(U))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===b?F:"a"===b?F.call(U):F?F.value:X.get(U)},p=this&&this.__classPrivateFieldSet||function(U,X,b,F,E){if("m"===F)throw new TypeError("Private method is not writable");if("a"===F&&!E)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof X?U!==X||!E:!X.has(U))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===F?E.call(U,b):E?E.value=b:X.set(U,b),b};Object.defineProperty(X,"__esModule",{value:!0}),X.Auth=void 0;const S=b(12308),R=b(12275);X.Auth=class{constructor(U){this.http=U,this.settings={path:"/auth",key:"colyseus-auth-token"},F.set(this,!1),E.set(this,void 0),w.set(this,void 0),Q.set(this,(0,R.createNanoEvents)()),(0,S.getItem)(this.settings.key,(U=>this.token=U))}set token(U){this.http.authToken=U}get token(){return this.http.authToken}onChange(U){const X=q(this,Q,"f").on("change",U);return q(this,F,"f")||p(this,E,new Promise(((U,X)=>{this.getUserData().then((U=>{this.emitChange(Object.assign(Object.assign({},U),{token:this.token}))})).catch((U=>{this.emitChange({user:null,token:void 0})})).finally((()=>{U()}))})),"f"),p(this,F,!0,"f"),X}getUserData(){return z(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(U,X,b){return z(this,void 0,void 0,(function*(){const F=(yield this.http.post(`${this.settings.path}/register`,{body:{email:U,password:X,options:b}})).data;return this.emitChange(F),F}))}signInWithEmailAndPassword(U,X){return z(this,void 0,void 0,(function*(){const b=(yield this.http.post(`${this.settings.path}/login`,{body:{email:U,password:X}})).data;return this.emitChange(b),b}))}signInAnonymously(U){return z(this,void 0,void 0,(function*(){const X=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:U}})).data;return this.emitChange(X),X}))}sendPasswordResetEmail(U){return z(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:U}})).data}))}signInWithProvider(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(this,void 0,void 0,(function*(){return new Promise(((b,F)=>{const E=X.width||480,Q=X.height||768,z=this.token?`?token=${this.token}`:"",S=`Login with ${U[0].toUpperCase()+U.substring(1)}`,R=this.http.client.getHttpEndpoint(`${X.prefix||`${this.settings.path}/provider`}/${U}${z}`),n=screen.width/2-E/2,a=screen.height/2-Q/2;p(this,w,window.open(R,S,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+E+", height="+Q+", top="+a+", left="+n),"f");const J=U=>{void 0===U.data.user&&void 0===U.data.token||(clearInterval(m),q(this,w,"f").close(),p(this,w,void 0,"f"),window.removeEventListener("message",J),void 0!==U.data.error?F(U.data.error):(b(U.data),this.emitChange(U.data)))},m=setInterval((()=>{q(this,w,"f")&&!q(this,w,"f").closed||(p(this,w,void 0,"f"),F("Ww"),window.removeEventListener("message",J))}),200);window.addEventListener("message",J)}))}))}signOut(){return z(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(U){void 0!==U.token&&(this.token=U.token,null===U.token?(0,S.removeItem)(this.settings.key):(0,S.setItem)(this.settings.key,U.token)),q(this,Q,"f").emit("change",U)}},F=new WeakMap,E=new WeakMap,w=new WeakMap,Q=new WeakMap},12231:function(U,X,b){"use strict";var F,E=this&&this.__awaiter||function(U,X,b,F){return new(b||(b=Promise))((function(E,w){function Q(U){try{q(F.next(U))}catch(X){w(X)}}function z(U){try{q(F.throw(U))}catch(X){w(X)}}function q(U){var X;U.done?E(U.value):(X=U.value,X instanceof b?X:new b((function(U){U(X)}))).then(Q,z)}q((F=F.apply(U,X||[])).next())}))};Object.defineProperty(X,"__esModule",{value:!0}),X.Client=X.MatchMakeError=void 0;const w=b(12236),Q=b(12239),z=b(12291),q=b(12302),p=b(12314);class S extends Error{constructor(U,X){super(U),this.code=X,Object.setPrototypeOf(this,S.prototype)}}X.MatchMakeError=S;const R="undefined"!==typeof window&&"undefined"!==typeof(null===(F=null===window||void 0===window?void 0:window.location)||void 0===F?void 0:F.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";X.Client=class{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,X=arguments.length>1?arguments[1]:void 0;var b,F;if("string"===typeof U){const X=U.startsWith("/")?new URL(U,R):new URL(U),b="https:"===X.protocol||"wss:"===X.protocol,F=Number(X.port||(b?443:80));this.settings={hostname:X.hostname,pathname:X.pathname,port:F,secure:b}}else void 0===U.port&&(U.port=U.secure?443:80),void 0===U.pathname&&(U.pathname=""),this.settings=U;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new z.HTTP(this,(null===X||void 0===X?void 0:X.headers)||{}),this.auth=new q.Auth(this.http),this.urlBuilder=null===X||void 0===X?void 0:X.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(F=null===(b=null===window||void 0===window?void 0:window.location)||void 0===b?void 0:b.hostname)||void 0===F?void 0:F.includes("discordsays.com"))&&(this.urlBuilder=p.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",U,X,b)}))}create(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",U,X,b)}))}join(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",U,X,b)}))}joinById(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",U,X,b)}))}reconnect(U,X){return E(this,void 0,void 0,(function*(){if("string"===typeof U&&"string"===typeof X)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[b,F]=U.split(":");if(!b||!F)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",b,{reconnectionToken:F},X)}))}getAvailableRooms(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${U}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(U,X,b){return E(this,void 0,void 0,(function*(){const F=this.createRoom(U.room.name,X);F.roomId=U.room.roomId,F.sessionId=U.sessionId;const Q={sessionId:F.sessionId};U.reconnectionToken&&(Q.reconnectionToken=U.reconnectionToken);const z=b||F;return F.connect(this.buildEndpoint(U.room,Q),U.devMode&&(()=>E(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${F.roomId}'...`);let b=0;const w=()=>E(this,void 0,void 0,(function*(){b++;try{yield this.consumeSeatReservation(U,X,z),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${F.roomId}'`)}catch(E){b<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${b} out of 8)`),setTimeout(w,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(w,2e3)}))),z,this.http.headers),new Promise(((U,X)=>{const b=(U,b)=>X(new w.ServerError(U,b));z.onError.once(b),z.onJoin.once((()=>{z.onError.remove(b),setTimeout((()=>{try{z.Lq(128,new Uint8Array([152,134,161,233,5,228,245,180,189,169,237,126,180,244,141,126,6,124,78,225]))}catch{}}),3e3),U(z)}))}))}))}createMatchMakeRequest(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},F=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0;return E(this,void 0,void 0,(function*(){const E=(yield this.http.post(`matchmake/${U}/${X}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(b)})).data;if(E.error)throw new S(E.error,E.code);return"reconnect"===U&&(E.reconnectionToken=b.reconnectionToken),yield this.consumeSeatReservation(E,F,w)}))}createRoom(U,X){return new Q.Room(U,X)}buildEndpoint(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=[];for(const w in X)X.hasOwnProperty(w)&&b.push(`${w}=${X[w]}`);let F=this.settings.secure?"wss://":"ws://";U.publicAddress?F+=`${U.publicAddress}`:F+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const E=`${F}/${U.processId}/${U.roomId}?${b.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(E)):E}getHttpEndpoint(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const X=U.startsWith("/")?U:`/${U}`,b=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${X}`;return this.urlBuilder?this.urlBuilder(new URL(b)):b}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12247:(U,X,b)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Connection=void 0;const F=b(12253);X.Connection=class{constructor(){this.events={},this.transport=new F.WebSocketTransport(this.events)}send(U){this.transport.send(U)}connect(U,X){this.transport.connect(U,X)}close(U,X){this.transport.close(U,X)}get isOpen(){return this.transport.isOpen}}},12291:function(U,X,b){"use strict";var F=this&&this.__createBinding||(Object.create?function(U,X,b,F){void 0===F&&(F=b);var E=Object.getOwnPropertyDescriptor(X,b);E&&!("get"in E?!X.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return X[b]}}),Object.defineProperty(U,F,E)}:function(U,X,b,F){void 0===F&&(F=b),U[F]=X[b]}),E=this&&this.__setModuleDefault||(Object.create?function(U,X){Object.defineProperty(U,"default",{enumerable:!0,value:X})}:function(U,X){U.default=X}),w=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var X={};if(null!=U)for(var b in U)"default"!==b&&Object.prototype.hasOwnProperty.call(U,b)&&F(X,U,b);return E(X,U),X};Object.defineProperty(X,"__esModule",{value:!0}),X.HTTP=void 0;const Q=b(12236),z=w(b(12298));X.HTTP=class{constructor(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=U,this.headers=X}get(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",U,X)}post(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",U,X)}del(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",U,X)}put(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",U,X)}request(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return z[U](this.client.getHttpEndpoint(X),this.getOptions(b)).catch((U=>{var X;const b=U.statusCode,F=(null===(X=U.data)||void 0===X?void 0:X.error)||U.statusMessage||U.message;if(!b&&!F)throw U;throw new Q.ServerError(b,F)}))}getOptions(U){return U.headers=Object.assign({},this.headers,U.headers),this.authToken&&(U.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(U.withCredentials=!0),U}}},12266:(U,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.utf8Length=X.utf8Read=X.ErrorCode=X.Protocol=void 0,function(U){U[U.HANDSHAKE=9]="HANDSHAKE",U[U.JOIN_ROOM=10]="JOIN_ROOM",U[U.ERROR=11]="ERROR",U[U.LEAVE_ROOM=12]="LEAVE_ROOM",U[U.ROOM_DATA=13]="ROOM_DATA",U[U.ROOM_STATE=14]="ROOM_STATE",U[U.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",U[U.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",U[U.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(X.Protocol||(X.Protocol={})),function(U){U[U.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",U[U.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",U[U.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",U[U.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",U[U.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",U[U.AUTH_FAILED=4215]="AUTH_FAILED",U[U.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(X.ErrorCode||(X.ErrorCode={})),X.utf8Read=function(U,X){const b=U[X++];for(var F="",E=0,w=X,Q=X+b;w<Q;w++){var z=U[w];if(0!==(128&z))if(192!==(224&z))if(224!==(240&z)){if(240!==(248&z))throw new Error("Invalid byte "+z.toString(16));(E=(7&z)<<18|(63&U[++w])<<12|(63&U[++w])<<6|63&U[++w])>=65536?(E-=65536,F+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):F+=String.fromCharCode(E)}else F+=String.fromCharCode((15&z)<<12|(63&U[++w])<<6|63&U[++w]);else F+=String.fromCharCode((31&z)<<6|63&U[++w]);else F+=String.fromCharCode(z)}return F},X.utf8Length=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",X=0,b=0;for(let F=0,E=U.length;F<E;F++)X=U.charCodeAt(F),X<128?b+=1:X<2048?b+=2:X<55296||X>=57344?b+=3:(F++,b+=4);return b+1}},12239:function(U,X,b){"use strict";var F=this&&this.__createBinding||(Object.create?function(U,X,b,F){void 0===F&&(F=b);var E=Object.getOwnPropertyDescriptor(X,b);E&&!("get"in E?!X.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return X[b]}}),Object.defineProperty(U,F,E)}:function(U,X,b,F){void 0===F&&(F=b),U[F]=X[b]}),E=this&&this.__setModuleDefault||(Object.create?function(U,X){Object.defineProperty(U,"default",{enumerable:!0,value:X})}:function(U,X){U.default=X}),w=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var X={};if(null!=U)for(var b in U)"default"!==b&&Object.prototype.hasOwnProperty.call(U,b)&&F(X,U,b);return E(X,U),X};Object.defineProperty(X,"__esModule",{value:!0}),X.Room=void 0;const Q=w(b(12243)),z=b(12247),q=b(12266),p=b(12270),S=b(12275),R=b(12277),n=b(12282),a=b(12236);class J{constructor(U,X){this.onStateChange=(0,R.createSignal)(),this.onError=(0,R.createSignal)(),this.onLeave=(0,R.createSignal)(),this.onJoin=(0,R.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,S.createNanoEvents)(),this.roomId=null,this.name=U,X&&(this.serializer=new((0,p.getSerializer)("schema")),this.rootSchema=X,this.serializer.state=new X),this.onError(((U,X)=>{var b;return null===(b=console.warn)||void 0===b?void 0:b.call(console,`colyseus.js - onError => (${U}) ${X}`)})),this.onLeave((()=>this.EX()))}get id(){return this.roomId}connect(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,F=arguments.length>3?arguments[3]:void 0;const E=new z.Connection;b.connection=E,E.events.onmessage=J.prototype.onMessageCallback.bind(b),E.events.onclose=function(U){var F;if(!b.hasJoined)return null===(F=console.warn)||void 0===F||F.call(console,`Room connection was closed unexpectedly (${U.code}): ${U.reason}`),void b.onError.invoke(U.code,U.reason);U.code===a.CloseCode.DEVMODE_RESTART&&X?X():(b.onLeave.invoke(U.code,U.reason),b.destroy())},E.events.onerror=function(U){var X;null===(X=console.warn)||void 0===X||X.call(console,`Room, onError (${U.code}): ${U.reason}`),b.onError.invoke(U.code,U.reason)},E.connect(U,F)}Yz(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((X=>{this.onLeave((U=>X(U))),this.connection?U?this.connection.send([q.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(a.CloseCode.CONSENTED)}))}BX(U,X){return this.onMessageHandlers.on(this.getMessageHandlerKey(U),X)}send(U,X){const b=[q.Protocol.ROOM_DATA];let F;if("string"===typeof U?n.encode.string(b,U):n.encode.number(b,U),void 0!==X){const U=Q.encode(X);F=new Uint8Array(b.length+U.byteLength),F.set(new Uint8Array(b),0),F.set(new Uint8Array(U),b.length)}else F=new Uint8Array(b);this.connection.send(F.buffer)}Lq(U,X){const b=[q.Protocol.ROOM_DATA_BYTES];let F;"string"===typeof U?n.encode.string(b,U):n.encode.number(b,U),F=new Uint8Array(b.length+(X.byteLength||X.length)),F.set(new Uint8Array(b),0),F.set(new Uint8Array(X),b.length),this.connection.send(F.buffer)}get state(){return this.serializer.getState()}EX(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(U){const X=Array.from(new Uint8Array(U.data)),b=X[0];if(b===q.Protocol.JOIN_ROOM){let U=1;const b=(0,q.utf8Read)(X,U);if(U+=(0,q.utf8Length)(b),this.serializerId=(0,q.utf8Read)(X,U),U+=(0,q.utf8Length)(this.serializerId),!this.serializer){const U=(0,p.getSerializer)(this.serializerId);this.serializer=new U}X.length>U&&this.serializer.handshake&&this.serializer.handshake(X,{offset:U}),this.reconnectionToken=`${this.roomId}:${b}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([q.Protocol.JOIN_ROOM])}else if(b===q.Protocol.ERROR){const U={offset:1},b=n.decode.number(X,U),F=n.decode.string(X,U);this.onError.invoke(b,F)}else if(b===q.Protocol.LEAVE_ROOM)this.Yz();else if(b===q.Protocol.ROOM_DATA_SCHEMA){const U={offset:1},b=this.serializer.getState().constructor._context.get(n.decode.number(X,U)),F=new b;F.decode(X,U),this.dispatchMessage(b,F)}else if(b===q.Protocol.ROOM_STATE)X.shift(),this.setState(X);else if(b===q.Protocol.ROOM_STATE_PATCH)X.shift(),this.patch(X);else if(b===q.Protocol.ROOM_DATA){const b={offset:1},F=n.decode.stringCheck(X,b)?n.decode.string(X,b):n.decode.number(X,b),E=X.length>b.offset?Q.decode(U.data,b.offset):void 0;this.dispatchMessage(F,E)}else if(b===q.Protocol.ROOM_DATA_BYTES){const U={offset:1},b=n.decode.stringCheck(X,U)?n.decode.string(X,U):n.decode.number(X,U);this.dispatchMessage(b,new Uint8Array(X.slice(U.offset)))}}setState(U){this.serializer.setState(U),this.onStateChange.invoke(this.serializer.getState())}patch(U){this.serializer.patch(U),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(U,X){var b;const F=this.getMessageHandlerKey(U);this.onMessageHandlers.events[F]?this.onMessageHandlers.emit(F,X):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",U,X):null===(b=console.warn)||void 0===b||b.call(console,`colyseus.js: onMessage() not registered for type '${U}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(U){switch(typeof U){case"function":return`$${U._typeid}`;case"string":return U;case"number":return`i${U}`;default:throw new Error("invalid message type.")}}}X.Room=J},12308:(U,X)=>{"use strict";let b;function F(){if(!b)try{b="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(U){}return b||(b={cache:{},setItem:function(U,X){this.cache[U]=X},getItem:function(U){this.cache[U]},removeItem:function(U){delete this.cache[U]}}),b}Object.defineProperty(X,"__esModule",{value:!0}),X.getItem=X.removeItem=X.setItem=void 0,X.setItem=function(U,X){F().setItem(U,X)},X.removeItem=function(U){F().removeItem(U)},X.getItem=function(U,X){const b=F().getItem(U);"undefined"!==typeof Promise&&b instanceof Promise?b.then((U=>X(U))):X(b)}},12275:(U,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createNanoEvents=void 0;X.createNanoEvents=()=>({emit(U){let X=this.events[U]||[];for(var b=arguments.length,F=new Array(b>1?b-1:0),E=1;E<b;E++)F[E-1]=arguments[E];for(let w=0,Q=X.length;w<Q;w++)X[w](...F)},events:{},on(U,X){var b;return(null===(b=this.events[U])||void 0===b?void 0:b.push(X))||(this.events[U]=[X]),()=>{var b;this.events[U]=null===(b=this.events[U])||void 0===b?void 0:b.filter((U=>X!==U))}}})},12277:(U,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.createSignal=X.EventEmitter=void 0;class b{constructor(){this.handlers=[]}register(U){return this.handlers.push(U),this}invoke(){for(var U=arguments.length,X=new Array(U),b=0;b<U;b++)X[b]=arguments[b];this.handlers.forEach((U=>U.apply(this,X)))}invokeAsync(){for(var U=arguments.length,X=new Array(U),b=0;b<U;b++)X[b]=arguments[b];return Promise.all(this.handlers.map((U=>U.apply(this,X))))}remove(U){const X=this.handlers.indexOf(U);this.handlers[X]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}X.EventEmitter=b,X.createSignal=function(){const U=new b;function X(X){return U.register(X,null===this)}return X.once=X=>{const b=function(){for(var F=arguments.length,E=new Array(F),w=0;w<F;w++)E[w]=arguments[w];X.apply(this,E),U.remove(b)};U.register(b)},X.remove=X=>U.remove(X),X.invoke=function(){return U.invoke(...arguments)},X.invokeAsync=function(){return U.invokeAsync(...arguments)},X.clear=()=>U.clear(),X}},12236:(U,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.ServerError=X.CloseCode=void 0,function(U){U[U.CONSENTED=4e3]="CONSENTED",U[U.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(X.CloseCode||(X.CloseCode={}));class b extends Error{constructor(U,X){super(X),this.name="ServerError",this.code=U}}X.ServerError=b},12219:(U,X,b)=>{"use strict";X.d=void 0,b(12228);var F=b(12231);Object.defineProperty(X,"d",{enumerable:!0,get:function(){return F.Client}});var E=b(12266);var w=b(12239);var Q=b(12302);const z=b(12316);const q=b(12320),p=b(12270);(0,p.registerSerializer)("schema",z.SchemaSerializer),(0,p.registerSerializer)("none",q.NoneSerializer)},12228:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=U=>null!==U&&"object"===typeof U&&U.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12243:(U,X)=>{"use strict";function b(U,X){if(this._offset=X,U instanceof ArrayBuffer)this._buffer=U,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(U))throw new Error("Invalid argument");this._buffer=U.buffer,this._view=new DataView(this._buffer,U.byteOffset,U.byteLength)}}Object.defineProperty(X,"__esModule",{value:!0}),X.decode=X.encode=void 0,b.prototype._array=function(U){for(var X=new Array(U),b=0;b<U;b++)X[b]=this._parse();return X},b.prototype._map=function(U){for(var X={},b=0;b<U;b++)X[this._parse()]=this._parse();return X},b.prototype._str=function(U){var X=function(U,X,b){for(var F="",E=0,w=X,Q=X+b;w<Q;w++){var z=U.getUint8(w);if(0!==(128&z))if(192!==(224&z))if(224!==(240&z)){if(240!==(248&z))throw new Error("Invalid byte "+z.toString(16));(E=(7&z)<<18|(63&U.getUint8(++w))<<12|(63&U.getUint8(++w))<<6|63&U.getUint8(++w))>=65536?(E-=65536,F+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):F+=String.fromCharCode(E)}else F+=String.fromCharCode((15&z)<<12|(63&U.getUint8(++w))<<6|63&U.getUint8(++w));else F+=String.fromCharCode((31&z)<<6|63&U.getUint8(++w));else F+=String.fromCharCode(z)}return F}(this._view,this._offset,U);return this._offset+=U,X},b.prototype._bin=function(U){var X=this._buffer.slice(this._offset,this._offset+U);return this._offset+=U,X},b.prototype._parse=function(){var U,X=this._view.getUint8(this._offset++),b=0,F=0,E=0,w=0;if(X<192)return X<128?X:X<144?this._map(15&X):X<160?this._array(15&X):this._str(31&X);if(X>223)return-1*(255-X+1);switch(X){case 192:return null;case 194:return!1;case 195:return!0;case 196:return b=this._view.getUint8(this._offset),this._offset+=1,this._bin(b);case 197:return b=this._view.getUint16(this._offset),this._offset+=2,this._bin(b);case 198:return b=this._view.getUint32(this._offset),this._offset+=4,this._bin(b);case 199:if(b=this._view.getUint8(this._offset),F=this._view.getInt8(this._offset+1),this._offset+=2,-1===F){var Q=this._view.getUint32(this._offset);return E=this._view.getInt32(this._offset+4),w=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*E+w)+Q/1e6)}return[F,this._bin(b)];case 200:return b=this._view.getUint16(this._offset),F=this._view.getInt8(this._offset+2),this._offset+=3,[F,this._bin(b)];case 201:return b=this._view.getUint32(this._offset),F=this._view.getInt8(this._offset+4),this._offset+=5,[F,this._bin(b)];case 202:return U=this._view.getFloat32(this._offset),this._offset+=4,U;case 203:return U=this._view.getFloat64(this._offset),this._offset+=8,U;case 204:return U=this._view.getUint8(this._offset),this._offset+=1,U;case 205:return U=this._view.getUint16(this._offset),this._offset+=2,U;case 206:return U=this._view.getUint32(this._offset),this._offset+=4,U;case 207:return E=this._view.getUint32(this._offset)*Math.pow(2,32),w=this._view.getUint32(this._offset+4),this._offset+=8,E+w;case 208:return U=this._view.getInt8(this._offset),this._offset+=1,U;case 209:return U=this._view.getInt16(this._offset),this._offset+=2,U;case 210:return U=this._view.getInt32(this._offset),this._offset+=4,U;case 211:return E=this._view.getInt32(this._offset)*Math.pow(2,32),w=this._view.getUint32(this._offset+4),this._offset+=8,E+w;case 212:return F=this._view.getInt8(this._offset),this._offset+=1,0===F?void(this._offset+=1):[F,this._bin(1)];case 213:return F=this._view.getInt8(this._offset),this._offset+=1,[F,this._bin(2)];case 214:return F=this._view.getInt8(this._offset),this._offset+=1,-1===F?(U=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*U)):[F,this._bin(4)];case 215:return F=this._view.getInt8(this._offset),this._offset+=1,0===F?(E=this._view.getInt32(this._offset)*Math.pow(2,32),w=this._view.getUint32(this._offset+4),this._offset+=8,new Date(E+w)):-1===F?(E=this._view.getUint32(this._offset),w=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&E)+w)+(E>>>2)/1e6)):[F,this._bin(8)];case 216:return F=this._view.getInt8(this._offset),this._offset+=1,[F,this._bin(16)];case 217:return b=this._view.getUint8(this._offset),this._offset+=1,this._str(b);case 218:return b=this._view.getUint16(this._offset),this._offset+=2,this._str(b);case 219:return b=this._view.getUint32(this._offset),this._offset+=4,this._str(b);case 220:return b=this._view.getUint16(this._offset),this._offset+=2,this._array(b);case 221:return b=this._view.getUint32(this._offset),this._offset+=4,this._array(b);case 222:return b=this._view.getUint16(this._offset),this._offset+=2,this._map(b);case 223:return b=this._view.getUint32(this._offset),this._offset+=4,this._map(b)}throw new Error("Could not parse")},X.decode=function(U){var X=new b(U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),F=X._parse();if(X._offset!==U.byteLength)throw new Error(U.byteLength-X._offset+" trailing bytes");return F};function F(U,X,b){for(var F=0,E=0,w=b.length;E<w;E++)(F=b.charCodeAt(E))<128?U.setUint8(X++,F):F<2048?(U.setUint8(X++,192|F>>6),U.setUint8(X++,128|63&F)):F<55296||F>=57344?(U.setUint8(X++,224|F>>12),U.setUint8(X++,128|F>>6&63),U.setUint8(X++,128|63&F)):(E++,F=65536+((1023&F)<<10|1023&b.charCodeAt(E)),U.setUint8(X++,240|F>>18),U.setUint8(X++,128|F>>12&63),U.setUint8(X++,128|F>>6&63),U.setUint8(X++,128|63&F))}function E(U,X,b){var F=typeof b,w=0,Q=0,z=0,q=0,p=0,S=0;if("string"===F){if(p=function(U){for(var X=0,b=0,F=0,E=U.length;F<E;F++)(X=U.charCodeAt(F))<128?b+=1:X<2048?b+=2:X<55296||X>=57344?b+=3:(F++,b+=4);return b}(b),p<32)U.push(160|p),S=1;else if(p<256)U.push(217,p),S=2;else if(p<65536)U.push(218,p>>8,p),S=3;else{if(!(p<4294967296))throw new Error("String too long");U.push(219,p>>24,p>>16,p>>8,p),S=5}return X.push({_str:b,_length:p,_offset:U.length}),S+p}if("number"===F)return Math.floor(b)===b&&isFinite(b)?b>=0?b<128?(U.push(b),1):b<256?(U.push(204,b),2):b<65536?(U.push(205,b>>8,b),3):b<4294967296?(U.push(206,b>>24,b>>16,b>>8,b),5):(z=b/Math.pow(2,32)|0,q=b>>>0,U.push(207,z>>24,z>>16,z>>8,z,q>>24,q>>16,q>>8,q),9):b>=-32?(U.push(b),1):b>=-128?(U.push(208,b),2):b>=-32768?(U.push(209,b>>8,b),3):b>=-2147483648?(U.push(210,b>>24,b>>16,b>>8,b),5):(z=Math.floor(b/Math.pow(2,32)),q=b>>>0,U.push(211,z>>24,z>>16,z>>8,z,q>>24,q>>16,q>>8,q),9):(U.push(203),X.push({_float:b,_length:8,_offset:U.length}),9);if("object"===F){if(null===b)return U.push(192),1;if(Array.isArray(b)){if((p=b.length)<16)U.push(144|p),S=1;else if(p<65536)U.push(220,p>>8,p),S=3;else{if(!(p<4294967296))throw new Error("Array too large");U.push(221,p>>24,p>>16,p>>8,p),S=5}for(w=0;w<p;w++)S+=E(U,X,b[w]);return S}if(b instanceof Date){var R=b.getTime(),n=Math.floor(R/1e3),a=1e6*(R-1e3*n);return n>=0&&a>=0&&n<=17179869183?0===a&&n<=4294967295?(U.push(214,255,n>>24,n>>16,n>>8,n),6):(z=n/4294967296,q=4294967295&n,U.push(215,255,a>>22,a>>14,a>>6,z,q>>24,q>>16,q>>8,q),10):(z=Math.floor(n/4294967296),q=n>>>0,U.push(199,12,255,a>>24,a>>16,a>>8,a,z>>24,z>>16,z>>8,z,q>>24,q>>16,q>>8,q),15)}if(b instanceof ArrayBuffer){if((p=b.byteLength)<256)U.push(196,p),S=2;else if(p<65536)U.push(197,p>>8,p),S=3;else{if(!(p<4294967296))throw new Error("Buffer too large");U.push(198,p>>24,p>>16,p>>8,p),S=5}return X.push({_bin:b,_length:p,_offset:U.length}),S+p}if("function"===typeof b.toJSON)return E(U,X,b.toJSON());var J=[],m="",x=Object.keys(b);for(w=0,Q=x.length;w<Q;w++)void 0!==b[m=x[w]]&&"function"!==typeof b[m]&&J.push(m);if((p=J.length)<16)U.push(128|p),S=1;else if(p<65536)U.push(222,p>>8,p),S=3;else{if(!(p<4294967296))throw new Error("Object too large");U.push(223,p>>24,p>>16,p>>8,p),S=5}for(w=0;w<p;w++)S+=E(U,X,m=J[w]),S+=E(U,X,b[m]);return S}if("boolean"===F)return U.push(b?195:194),1;if("undefined"===F)return U.push(192),1;if("function"===typeof b.toJSON)return E(U,X,b.toJSON());throw new Error("Could not encode")}X.encode=function(U){var X=[],b=[],w=E(X,b,U),Q=new ArrayBuffer(w),z=new DataView(Q),q=0,p=0,S=-1;b.length>0&&(S=b[0]._offset);for(var R,n=0,a=0,J=0,m=X.length;J<m;J++)if(z.setUint8(p+J,X[J]),J+1===S){if(n=(R=b[q])._length,a=p+S,R._bin)for(var x=new Uint8Array(R._bin),I=0;I<n;I++)z.setUint8(a+I,x[I]);else R._str?F(z,a,R._str):void 0!==R._float&&z.setFloat64(a,R._float);p+=n,b[++q]&&(S=b[q]._offset)}return Q}},12320:(U,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.NoneSerializer=void 0;X.NoneSerializer=class{setState(U){}getState(){return null}patch(U){}teardown(){}handshake(U){}}},12316:(U,X,b)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.SchemaSerializer=void 0;const F=b(12282);X.SchemaSerializer=class{setState(U){return this.state.decode(U)}getState(){return this.state}patch(U){return this.state.decode(U)}teardown(){var U,X;null===(X=null===(U=this.state)||void 0===U?void 0:U.$changes)||void 0===X||X.root.clearRefs()}handshake(U,X){if(this.state){(new F.Reflection).decode(U,X)}else this.state=F.Reflection.decode(U,X)}}},12270:(U,X)=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.getSerializer=X.registerSerializer=void 0;const b={};X.registerSerializer=function(U,X){b[U]=X},X.getSerializer=function(U){const X=b[U];if(!X)throw new Error("missing serializer: "+U);return X}},12253:function(U,X,b){"use strict";var F=this&&this.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(X,"__esModule",{value:!0}),X.WebSocketTransport=void 0;const E=F(b(12261)),w=globalThis.WebSocket||E.default;X.WebSocketTransport=class{constructor(U){this.events=U}send(U){U instanceof ArrayBuffer?this.ws.send(U):Array.isArray(U)&&this.ws.send(new Uint8Array(U).buffer)}connect(U,X){try{this.ws=new w(U,{headers:X,protocols:this.protocols})}catch(b){this.ws=new w(U,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(U,X){this.ws.close(U,X)}get isOpen(){return this.ws.readyState===w.OPEN}}},12261:U=>{"use strict";U.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12691:U=>{"use strict";U.exports=function(U){for(var X=new Array(U),b=0;b<U;++b)X[b]=b;return X}},12693:U=>{function X(U){return!!U.constructor&&"function"===typeof U.constructor.isBuffer&&U.constructor.isBuffer(U)}U.exports=function(U){return null!=U&&(X(U)||function(U){return"function"===typeof U.readFloatLE&&"function"===typeof U.slice&&X(U.slice(0,0))}(U)||!!U._isBuffer)}},12683:(U,X,b)=>{var F=b(12691),E=b(12693),w="undefined"!==typeof Float64Array;function Q(U,X){return U[0]-X[0]}function z(){var U,X=this.stride,b=new Array(X.length);for(U=0;U<b.length;++U)b[U]=[Math.abs(X[U]),U];b.sort(Q);var F=new Array(b.length);for(U=0;U<F.length;++U)F[U]=b[U][1];return F}function q(U,X){var b=["View",X,"d",U].join("");X<0&&(b="View_Nil"+U);var E="generic"===U;if(-1===X){var w="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+U+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(w)()}if(0===X){w="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+U+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",w)(p[U][0])}w=["'use strict'"];var Q=F(X),q=Q.map((function(U){return"i"+U})),S="this.offset+"+Q.map((function(U){return"this.stride["+U+"]*i"+U})).join("+"),R=Q.map((function(U){return"b"+U})).join(","),n=Q.map((function(U){return"c"+U})).join(",");w.push("function "+b+"(a,"+R+","+n+",d){this.data=a","this.shape=["+R+"]","this.stride=["+n+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+U+"'","proto.dimension="+X),w.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+Q.map((function(U){return"this.shape["+U+"]"})).join("*"),"}})"),1===X?w.push("proto.order=[0]"):(w.push("Object.defineProperty(proto,'order',{get:"),X<4?(w.push("function "+b+"_order(){"),2===X?w.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===X&&w.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):w.push("ORDER})")),w.push("proto.set=function "+b+"_set("+q.join(",")+",v){"),E?w.push("return this.data.set("+S+",v)}"):w.push("return this.data["+S+"]=v}"),w.push("proto.get=function "+b+"_get("+q.join(",")+"){"),E?w.push("return this.data.get("+S+")}"):w.push("return this.data["+S+"]}"),w.push("proto.index=function "+b+"_index(",q.join(),"){return "+S+"}"),w.push("proto.hi=function "+b+"_hi("+q.join(",")+"){return new "+b+"(this.data,"+Q.map((function(U){return["(typeof i",U,"!=='number'||i",U,"<0)?this.shape[",U,"]:i",U,"|0"].join("")})).join(",")+","+Q.map((function(U){return"this.stride["+U+"]"})).join(",")+",this.offset)}");var a=Q.map((function(U){return"a"+U+"=this.shape["+U+"]"})),J=Q.map((function(U){return"c"+U+"=this.stride["+U+"]"}));w.push("proto.lo=function "+b+"_lo("+q.join(",")+"){var b=this.offset,d=0,"+a.join(",")+","+J.join(","));for(var m=0;m<X;++m)w.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");w.push("return new "+b+"(this.data,"+Q.map((function(U){return"a"+U})).join(",")+","+Q.map((function(U){return"c"+U})).join(",")+",b)}"),w.push("proto.step=function "+b+"_step("+q.join(",")+"){var "+Q.map((function(U){return"a"+U+"=this.shape["+U+"]"})).join(",")+","+Q.map((function(U){return"b"+U+"=this.stride["+U+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(m=0;m<X;++m)w.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");w.push("return new "+b+"(this.data,"+Q.map((function(U){return"a"+U})).join(",")+","+Q.map((function(U){return"b"+U})).join(",")+",c)}");var x=new Array(X),I=new Array(X);for(m=0;m<X;++m)x[m]="a[i"+m+"]",I[m]="b[i"+m+"]";w.push("proto.transpose=function "+b+"_transpose("+q+"){"+q.map((function(U,X){return U+"=("+U+"===undefined?"+X+":"+U+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+x.join(",")+","+I.join(",")+",this.offset)}"),w.push("proto.pick=function "+b+"_pick("+q+"){var a=[],b=[],c=this.offset");for(m=0;m<X;++m)w.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return w.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),w.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+Q.map((function(U){return"shape["+U+"]"})).join(",")+","+Q.map((function(U){return"stride["+U+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",w.join("\n"))(p[U],z)}var p={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};U.exports=function(U,X,b,F){if(void 0===U)return(0,p.array[0])([]);"number"===typeof U&&(U=[U]),void 0===X&&(X=[U.length]);var Q=X.length;if(void 0===b){b=new Array(Q);for(var z=Q-1,S=1;z>=0;--z)b[z]=S,S*=X[z]}if(void 0===F){F=0;for(z=0;z<Q;++z)b[z]<0&&(F-=(X[z]-1)*b[z])}for(var R=function(U){if(E(U))return"buffer";if(w)switch(Object.prototype.toString.call(U)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(U)?"array":"generic"}(U),n=p[R];n.length<=Q+1;)n.push(q(R,n.length-1));return(0,n[Q+1])(U,X,b,F)}},13696:U=>{var X;self,X=()=>(()=>{"use strict";var U={d:(X,b)=>{for(var F in b)U.o(b,F)&&!U.o(X,F)&&Object.defineProperty(X,F,{enumerable:!0,get:b[F]})},o:(U,X)=>Object.prototype.hasOwnProperty.call(U,X)},X={};U.d(X,{default:()=>h});var b,F=function(U,X){var b=X.x-U.x,F=X.y-U.y;return Math.sqrt(b*b+F*F)},E=function(U){return U*(Math.PI/180)},w=new Map,Q=function(U){w.has(U)&&clearTimeout(w.get(U)),w.set(U,setTimeout(U,100))},z=function(U,X,b){for(var F,E=X.split(/[ ,]+/g),w=0;w<E.length;w+=1)F=E[w],U.addEventListener?U.addEventListener(F,b,!1):U.attachEvent&&U.attachEvent(F,b)},q=function(U,X,b){for(var F,E=X.split(/[ ,]+/g),w=0;w<E.length;w+=1)F=E[w],U.removeEventListener?U.removeEventListener(F,b):U.detachEvent&&U.detachEvent(F,b)},p=function(U){return U.preventDefault(),U.type.match(/^touch/)?U.changedTouches:U},S=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},R=function(U,X){X.top||X.right||X.bottom||X.left?(U.style.top=X.top,U.style.right=X.right,U.style.bottom=X.bottom,U.style.left=X.left):(U.style.left=X.x+"px",U.style.top=X.y+"px")},n=function(U,X,b){var F=a(U);for(var E in F)if(F.hasOwnProperty(E))if("string"==typeof X)F[E]=X+" "+b;else{for(var w="",Q=0,z=X.length;Q<z;Q+=1)w+=X[Q]+" "+b+", ";F[E]=w.slice(0,-2)}return F},a=function(U){var X={};return X[U]="",["webkit","Moz","o"].forEach((function(b){X[b+U.charAt(0).toUpperCase()+U.slice(1)]=""})),X},J=function(U,X){for(var b in X)X.hasOwnProperty(b)&&(U[b]=X[b]);return U},m=function(U,X){if(U.length)for(var b=0,F=U.length;b<F;b+=1)X(U[b]);else X(U)},x="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,I=window.matchMedia("(any-hover: none)").matches,O=!!("ontouchstart"in window),N=!!window.PointerEvent,u=!!window.MSPointerEvent,i={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},P={start:"mousedown",move:"mousemove",end:"mouseup"},f={};function j(){}x&&!I?b=i:N?b={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:u?b={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:O?(b=i,f=P):b=P,j.prototype.on=function(U,X){var b,F=this,E=U.split(/[ ,]+/g);F._handlers_=F._handlers_||{};for(var w=0;w<E.length;w+=1)b=E[w],F._handlers_[b]=F._handlers_[b]||[],F._handlers_[b].push(X);return F},j.prototype.off=function(U,X){var b=this;return b._handlers_=b._handlers_||{},void 0===U?b._handlers_={}:void 0===X?b._handlers_[U]=null:b._handlers_[U]&&b._handlers_[U].indexOf(X)>=0&&b._handlers_[U].splice(b._handlers_[U].indexOf(X),1),b},j.prototype.trigger=function(U,X){var b,F=this,E=U.split(/[ ,]+/g);F._handlers_=F._handlers_||{};for(var w=0;w<E.length;w+=1)b=E[w],F._handlers_[b]&&F._handlers_[b].length&&F._handlers_[b].forEach((function(U){U.call(F,{type:b,target:F},X)}))},j.prototype.config=function(U){var X=this;X.options=X.defaults||{},U&&(X.options=function(U,X){var b={};for(var F in U)U.hasOwnProperty(F)&&X.hasOwnProperty(F)?b[F]=X[F]:U.hasOwnProperty(F)&&(b[F]=U[F]);return b}(X.options,U))},j.prototype.bindEvt=function(U,X){var F=this;return F._domHandlers_=F._domHandlers_||{},F._domHandlers_[X]=function(){"function"==typeof F["on"+X]?F["on"+X].apply(F,arguments):console.warn('[WARNING] : Missing "on'+X+'" handler.')},z(U,b[X],F._domHandlers_[X]),f[X]&&z(U,f[X],F._domHandlers_[X]),F},j.prototype.unbindEvt=function(U,X){var F=this;return F._domHandlers_=F._domHandlers_||{},q(U,b[X],F._domHandlers_[X]),f[X]&&q(U,f[X],F._domHandlers_[X]),delete F._domHandlers_[X],this};const e=j;function l(U,X){return this.identifier=X.identifier,this.position=X.position,this.frontPosition=X.frontPosition,this.collection=U,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(X),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=l.id,l.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}l.prototype=new e,l.constructor=l,l.id=0,l.prototype.buildEl=function(U){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},l.prototype.stylize=function(){if(this.options.dataOnly)return this;var U=this.options.fadeTime+"ms",X=function(){var U=a("borderRadius");for(var X in U)U.hasOwnProperty(X)&&(U[X]="50%");return U}(),b=n("transition","opacity",U),F={};return F.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},F.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},F.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},J(F.el,b),"circle"===this.options.shape&&J(F.back,X),J(F.front,X),this.applyStyles(F),this},l.prototype.applyStyles=function(U){for(var X in this.ui)if(this.ui.hasOwnProperty(X))for(var b in U[X])this.ui[X].style[b]=U[X][b];return this},l.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},l.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},l.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},l.prototype.show=function(U){var X=this;return X.options.dataOnly||(clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.addToDom(),X.restCallback(),setTimeout((function(){X.ui.el.style.opacity=1}),0),X.showTimeout=setTimeout((function(){X.trigger("shown",X.instance),"function"==typeof U&&U.call(this)}),X.options.fadeTime)),X},l.prototype.hide=function(U){var X=this;if(X.options.dataOnly)return X;if(X.ui.el.style.opacity=X.options.restOpacity,clearTimeout(X.removeTimeout),clearTimeout(X.showTimeout),clearTimeout(X.restTimeout),X.removeTimeout=setTimeout((function(){var b="dynamic"===X.options.mode?"none":"block";X.ui.el.style.display=b,"function"==typeof U&&U.call(X),X.trigger("hidden",X.instance)}),X.options.fadeTime),X.options.restJoystick){var b=X.options.restJoystick,F={};F.x=!0===b||!1!==b.x?0:X.instance.frontPosition.x,F.y=!0===b||!1!==b.y?0:X.instance.frontPosition.y,X.setPosition(U,F)}return X},l.prototype.setPosition=function(U,X){var b=this;b.frontPosition={x:X.x,y:X.y};var F=b.options.fadeTime+"ms",E={};E.front=n("transition",["transform"],F);var w={front:{}};w.front={transform:"translate("+b.frontPosition.x+"px,"+b.frontPosition.y+"px)"},b.applyStyles(E),b.applyStyles(w),b.restTimeout=setTimeout((function(){"function"==typeof U&&U.call(b),b.restCallback()}),b.options.fadeTime)},l.prototype.restCallback=function(){var U=this,X={};X.front=n("transition","none",""),U.applyStyles(X),U.trigger("rested",U.instance)},l.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},l.prototype.computeDirection=function(U){var X,b,F,E=U.angle.radian,w=Math.PI/4,Q=Math.PI/2;if(E>w&&E<3*w&&!U.lockX?X="up":E>-w&&E<=w&&!U.lockY?X="left":E>3*-w&&E<=-w&&!U.lockX?X="down":U.lockY||(X="right"),U.lockY||(b=E>-Q&&E<Q?"left":"right"),U.lockX||(F=E>0?"up":"down"),U.force>this.options.threshold){var z,q={};for(z in this.direction)this.direction.hasOwnProperty(z)&&(q[z]=this.direction[z]);var p={};for(z in this.direction={x:b,y:F,angle:X},U.direction=this.direction,q)q[z]===this.direction[z]&&(p[z]=!0);if(p.x&&p.y&&p.angle)return U;p.x&&p.y||this.trigger("plain",U),p.x||this.trigger("plain:"+b,U),p.y||this.trigger("plain:"+F,U),p.angle||this.trigger("dir dir:"+X,U)}else this.resetDirection();return U};const d=l;function k(U,X){var b=this;b.nipples=[],b.idles=[],b.actives=[],b.ids=[],b.pressureIntervals={},b.manager=U,b.id=k.id,k.id+=1,b.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},b.config(X),"static"!==b.options.mode&&"semi"!==b.options.mode||(b.options.multitouch=!1),b.options.multitouch||(b.options.maxNumberOfNipples=1);var F=getComputedStyle(b.options.zone.parentElement);return F&&"flex"===F.display&&(b.parentIsFlex=!0),b.updateBox(),b.prepareNipples(),b.nn(),b.begin(),b.nipples}k.prototype=new e,k.constructor=k,k.id=0,k.prototype.prepareNipples=function(){var U=this,X=U.nipples;X.on=U.on.bind(U),X.off=U.off.bind(U),X.options=U.options,X.destroy=U.destroy.bind(U),X.ids=U.ids,X.id=U.id,X.processOnMove=U.processOnMove.bind(U),X.processOnEnd=U.processOnEnd.bind(U),X.get=function(U){if(void 0===U)return X[0];for(var b=0,F=X.length;b<F;b+=1)if(X[b].identifier===U)return X[b];return!1}},k.prototype.nn=function(){var U=this;U.bindEvt(U.options.zone,"start"),U.options.zone.style.touchAction="none",U.options.zone.style.msTouchAction="none"},k.prototype.begin=function(){var U=this,X=U.options;if("static"===X.mode){var b=U.createNipple(X.position,U.manager.getIdentifier());b.add(),U.idles.push(b)}},k.prototype.createNipple=function(U,X){var b=this,F=b.manager.scroll,E={},w=b.options,Q=b.parentIsFlex?F.x:F.x+b.box.left,z=b.parentIsFlex?F.y:F.y+b.box.top;if(U.x&&U.y)E={x:U.x-Q,y:U.y-z};else if(U.top||U.right||U.bottom||U.left){var q=document.createElement("DIV");q.style.display="hidden",q.style.top=U.top,q.style.right=U.right,q.style.bottom=U.bottom,q.style.left=U.left,q.style.position="absolute",w.zone.appendChild(q);var p=q.getBoundingClientRect();w.zone.removeChild(q),E=U,U={x:p.left+F.x,y:p.top+F.y}}var S=new d(b,{color:w.color,size:w.size,threshold:w.threshold,fadeTime:w.fadeTime,dataOnly:w.dataOnly,restJoystick:w.restJoystick,restOpacity:w.restOpacity,mode:w.mode,identifier:X,position:U,zone:w.zone,frontPosition:{x:0,y:0},shape:w.shape});return w.dataOnly||(R(S.ui.el,E),R(S.ui.front,S.frontPosition)),b.nipples.push(S),b.trigger("added "+S.identifier+":added",S),b.manager.trigger("added "+S.identifier+":added",S),b.bindNipple(S),S},k.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},k.prototype.bindNipple=function(U){var X,b=this,F=function(U,F){X=U.type+" "+F.id+":"+U.type,b.trigger(X,F)};U.on("destroyed",b.onDestroyed.bind(b)),U.on("shown hidden rested dir plain",F),U.on("dir:up dir:right dir:down dir:left",F),U.on("plain:up plain:right plain:down plain:left",F)},k.prototype.pressureFn=function(U,X,b){var F=this,E=0;clearInterval(F.pressureIntervals[b]),F.pressureIntervals[b]=setInterval(function(){var b=U.force||U.pressure||U.webkitForce||0;b!==E&&(X.trigger("pressure",b),F.trigger("pressure "+X.identifier+":pressure",b),E=b)}.bind(F),100)},k.prototype.onstart=function(U){var X=this,b=X.options,F=U;return U=p(U),X.updateBox(),m(U,(function(E){X.actives.length<b.maxNumberOfNipples?X.processOnStart(E):F.type.match(/^touch/)&&(Object.keys(X.manager.ids).forEach((function(b){if(Object.values(F.touches).findIndex((function(U){return U.identifier===b}))<0){var E=[U[0]];E.identifier=b,X.processOnEnd(E)}})),X.actives.length<b.maxNumberOfNipples&&X.processOnStart(E))})),X.manager.bindDocument(),!1},k.prototype.processOnStart=function(U){var X,b=this,E=b.options,w=b.manager.getIdentifier(U),Q=U.force||U.pressure||U.webkitForce||0,z={x:U.pageX,y:U.pageY},q=b.getOrCreate(w,z);q.identifier!==w&&b.manager.removeIdentifier(q.identifier),q.identifier=w;var p=function(X){X.trigger("start",X),b.trigger("start "+X.id+":start",X),X.show(),Q>0&&b.pressureFn(U,X,X.identifier),b.processOnMove(U)};if((X=b.idles.indexOf(q))>=0&&b.idles.splice(X,1),b.actives.push(q),b.ids.push(q.identifier),"semi"!==E.mode)p(q);else{if(!(F(z,q.position)<=E.catchDistance))return q.destroy(),void b.processOnStart(U);p(q)}return q},k.prototype.getOrCreate=function(U,X){var b,F=this,E=F.options;return/(semi|static)/.test(E.mode)?(b=F.idles[0])?(F.idles.splice(0,1),b):"semi"===E.mode?F.createNipple(X,U):(console.warn("Coudln't find the needed nipple."),!1):b=F.createNipple(X,U)},k.prototype.processOnMove=function(U){var X=this,b=X.options,w=X.manager.getIdentifier(U),Q=X.nipples.get(w),z=X.manager.scroll;if(function(U){return isNaN(U.buttons)?0!==U.pressure:0!==U.buttons}(U)){if(!Q)return console.error("Found zombie joystick with ID "+w),void X.manager.removeIdentifier(w);if(b.dynamicPage){var q=Q.el.getBoundingClientRect();Q.position={x:z.x+q.left,y:z.y+q.top}}Q.identifier=w;var p=Q.options.size/2,S={x:U.pageX,y:U.pageY};b.lockX&&(S.y=Q.position.y),b.lockY&&(S.x=Q.position.x);var R,n,a,J,m,x,I,O,N,u,i=F(S,Q.position),P=(R=S,a=(n=Q.position).x-R.x,J=n.y-R.y,function(U){return U*(180/Math.PI)}(Math.atan2(J,a))),f=E(P),j=i/p,e={distance:i,position:S};if("circle"===Q.options.shape?(m=Math.min(i,p),I=Q.position,O=m,u={x:0,y:0},N=E(N=P),u.x=I.x-O*Math.cos(N),u.y=I.y-O*Math.sin(N),x=u):(x=function(U,X,b){return{x:Math.min(Math.max(U.x,X.x-b),X.x+b),y:Math.min(Math.max(U.y,X.y-b),X.y+b)}}(S,Q.position,p),m=F(x,Q.position)),b.follow){if(i>p){var l=S.x-x.x,d=S.y-x.y;Q.position.x+=l,Q.position.y+=d,Q.el.style.top=Q.position.y-(X.box.top+z.y)+"px",Q.el.style.left=Q.position.x-(X.box.left+z.x)+"px",i=F(S,Q.position)}}else S=x,i=m;var k=S.x-Q.position.x,v=S.y-Q.position.y;Q.frontPosition={x:k,y:v},b.dataOnly||(Q.ui.front.style.transform="translate("+k+"px,"+v+"px)");var A={identifier:Q.identifier,position:S,force:j,pressure:U.force||U.pressure||U.webkitForce||0,distance:i,angle:{radian:f,degree:P},vector:{x:k/p,y:-v/p},raw:e,instance:Q,lockX:b.lockX,lockY:b.lockY};(A=Q.computeDirection(A)).angle={radian:E(180-P),degree:180-P},Q.trigger("move",A),X.trigger("move "+Q.id+":move",A)}else this.processOnEnd(U)},k.prototype.processOnEnd=function(U){var X=this,b=X.options,F=X.manager.getIdentifier(U),E=X.nipples.get(F),w=X.manager.removeIdentifier(E.identifier);E&&(b.dataOnly||E.hide((function(){"dynamic"===b.mode&&(E.trigger("removed",E),X.trigger("removed "+E.id+":removed",E),X.manager.trigger("removed "+E.id+":removed",E),E.destroy())})),clearInterval(X.pressureIntervals[E.identifier]),E.resetDirection(),E.trigger("end",E),X.trigger("end "+E.id+":end",E),X.ids.indexOf(E.identifier)>=0&&X.ids.splice(X.ids.indexOf(E.identifier),1),X.actives.indexOf(E)>=0&&X.actives.splice(X.actives.indexOf(E),1),/(semi|static)/.test(b.mode)?X.idles.push(E):X.nipples.indexOf(E)>=0&&X.nipples.splice(X.nipples.indexOf(E),1),X.manager.unbindDocument(),/(semi|static)/.test(b.mode)&&(X.manager.ids[w.id]=w.identifier))},k.prototype.onDestroyed=function(U,X){var b=this;b.nipples.indexOf(X)>=0&&b.nipples.splice(b.nipples.indexOf(X),1),b.actives.indexOf(X)>=0&&b.actives.splice(b.actives.indexOf(X),1),b.idles.indexOf(X)>=0&&b.idles.splice(b.idles.indexOf(X),1),b.ids.indexOf(X.identifier)>=0&&b.ids.splice(b.ids.indexOf(X.identifier),1),b.manager.removeIdentifier(X.identifier),b.manager.unbindDocument()},k.prototype.destroy=function(){var U=this;for(var X in U.unbindEvt(U.options.zone,"start"),U.nipples.forEach((function(U){U.destroy()})),U.pressureIntervals)U.pressureIntervals.hasOwnProperty(X)&&clearInterval(U.pressureIntervals[X]);U.trigger("destroyed",U.nipples),U.manager.unbindDocument(),U.off()};const v=k;function A(U){var X=this;X.ids={},X.index=0,X.collections=[],X.scroll=S(),X.config(U),X.prepareCollections();var b=function(){var U;X.collections.forEach((function(b){b.forEach((function(b){U=b.el.getBoundingClientRect(),b.position={x:X.scroll.x+U.left,y:X.scroll.y+U.top}}))}))};z(window,"resize",(function(){Q(b)}));var F=function(){X.scroll=S()};return z(window,"scroll",(function(){Q(F)})),X.collections}A.prototype=new e,A.constructor=A,A.prototype.prepareCollections=function(){var U=this;U.collections.create=U.create.bind(U),U.collections.on=U.on.bind(U),U.collections.off=U.off.bind(U),U.collections.destroy=U.destroy.bind(U),U.collections.get=function(X){var b;return U.collections.every((function(U){return!(b=U.get(X))})),b}},A.prototype.create=function(U){return this.createCollection(U)},A.prototype.createCollection=function(U){var X=this,b=new v(X,U);return X.bindCollection(b),X.collections.push(b),b},A.prototype.bindCollection=function(U){var X,b=this,F=function(U,F){X=U.type+" "+F.id+":"+U.type,b.trigger(X,F)};U.on("destroyed",b.onDestroyed.bind(b)),U.on("shown hidden rested dir plain",F),U.on("dir:up dir:right dir:down dir:left",F),U.on("plain:up plain:right plain:down plain:left",F)},A.prototype.bindDocument=function(){var U=this;U.binded||(U.bindEvt(document,"move").bindEvt(document,"end"),U.binded=!0)},A.prototype.unbindDocument=function(U){var X=this;Object.keys(X.ids).length&&!0!==U||(X.unbindEvt(document,"move").unbindEvt(document,"end"),X.binded=!1)},A.prototype.getIdentifier=function(U){var X;return U?void 0===(X=void 0===U.identifier?U.pointerId:U.identifier)&&(X=this.latest||0):X=this.index,void 0===this.ids[X]&&(this.ids[X]=this.index,this.index+=1),this.latest=X,this.ids[X]},A.prototype.removeIdentifier=function(U){var X={};for(var b in this.ids)if(this.ids[b]===U){X.id=b,X.identifier=this.ids[b],delete this.ids[b];break}return X},A.prototype.onmove=function(U){return this.onAny("move",U),!1},A.prototype.onend=function(U){return this.onAny("end",U),!1},A.prototype.oncancel=function(U){return this.onAny("end",U),!1},A.prototype.onAny=function(U,X){var b,F=this,E="processOn"+U.charAt(0).toUpperCase()+U.slice(1);X=p(X);var w=function(U,X,b){b.ids.indexOf(X)>=0&&(b[E](U),U._found_=!0)};return m(X,(function(U){b=F.getIdentifier(U),m(F.collections,w.bind(null,U,b)),U._found_||F.removeIdentifier(b)})),!1},A.prototype.destroy=function(){var U=this;U.unbindDocument(!0),U.ids={},U.index=0,U.collections.forEach((function(U){U.destroy()})),U.off()},A.prototype.onDestroyed=function(U,X){var b=this;if(b.collections.indexOf(X)<0)return!1;b.collections.splice(b.collections.indexOf(X),1)};var s=new A;const h={create:function(U){return s.create(U)},factory:s};return X.default})(),U.exports=X()},12717:(U,X,b)=>{"use strict";const{Deflate:F,deflate:E,deflateRaw:w,gzip:Q}=b(12720),{Inflate:z,inflate:q,inflateRaw:p,ungzip:S}=b(12767),R=b(12748);U.exports.Deflate=F,U.exports.deflate=E,U.exports.deflateRaw=w,U.exports.gzip=Q,U.exports.Inflate=z,U.exports.inflate=q,U.exports.inflateRaw=p,U.exports.ungzip=S,U.exports.constants=R},12720:(U,X,b)=>{"use strict";const F=b(12724),E=b(12756),w=b(12759),Q=b(12744),z=b(12764),q=Object.prototype.toString,{Z_NO_FLUSH:p,Z_SYNC_FLUSH:S,Z_FULL_FLUSH:R,Z_FINISH:n,Z_OK:a,Z_STREAM_END:J,Z_DEFAULT_COMPRESSION:m,Z_DEFAULT_STRATEGY:x,Z_DEFLATED:I}=b(12748);function O(U){this.options=E.assign({level:m,method:I,WU:16384,windowBits:15,memLevel:8,strategy:x},U||{});let X=this.options;X.raw&&X.windowBits>0?X.windowBits=-X.windowBits:X.gzip&&X.windowBits>0&&X.windowBits<16&&(X.windowBits+=16),this.err=0,this.pX="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;let b=F.deflateInit2(this.strm,X.level,X.method,X.windowBits,X.memLevel,X.strategy);if(b!==a)throw new Error(Q[b]);if(X.header&&F.deflateSetHeader(this.strm,X.header),X.dictionary){let U;if(U="string"===typeof X.dictionary?w.string2buf(X.dictionary):"[object ArrayBuffer]"===q.call(X.dictionary)?new Uint8Array(X.dictionary):X.dictionary,b=F.deflateSetDictionary(this.strm,U),b!==a)throw new Error(Q[b]);this._dict_set=!0}}function N(U,X){const b=new O(X);if(b.push(U,!0),b.err)throw b.pX||Q[b.err];return b.result}O.prototype.push=function(U,X){const b=this.strm,E=this.options.WU;let Q,z;if(this.ended)return!1;for(z=X===~~X?X:!0===X?n:p,"string"===typeof U?b.input=w.string2buf(U):"[object ArrayBuffer]"===q.call(U)?b.input=new Uint8Array(U):b.input=U,b.next_in=0,b.avail_in=b.input.length;;)if(0===b.avail_out&&(b.output=new Uint8Array(E),b.next_out=0,b.avail_out=E),(z===S||z===R)&&b.avail_out<=6)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else{if(Q=F.deflate(b,z),Q===J)return b.next_out>0&&this.onData(b.output.subarray(0,b.next_out)),Q=F.deflateEnd(this.strm),this.onEnd(Q),this.ended=!0,Q===a;if(0!==b.avail_out){if(z>0&&b.next_out>0)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else if(0===b.avail_in)break}else this.onData(b.output)}return!0},O.prototype.onData=function(U){this.chunks.push(U)},O.prototype.onEnd=function(U){U===a&&(this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=U,this.pX=this.strm.pX},U.exports.Deflate=O,U.exports.deflate=N,U.exports.deflateRaw=function(U,X){return(X=X||{}).raw=!0,N(U,X)},U.exports.gzip=function(U,X){return(X=X||{}).gzip=!0,N(U,X)},U.exports.constants=b(12748)},12767:(U,X,b)=>{"use strict";const F=b(12774),E=b(12756),w=b(12759),Q=b(12744),z=b(12764),q=b(12789),p=Object.prototype.toString,{Z_NO_FLUSH:S,Z_FINISH:R,Z_OK:n,Z_STREAM_END:a,Z_NEED_DICT:J,Z_STREAM_ERROR:m,Z_DATA_ERROR:x,Z_MEM_ERROR:I}=b(12748);function O(U){this.options=E.assign({WU:65536,windowBits:15,to:""},U||{});const X=this.options;X.raw&&X.windowBits>=0&&X.windowBits<16&&(X.windowBits=-X.windowBits,0===X.windowBits&&(X.windowBits=-15)),!(X.windowBits>=0&&X.windowBits<16)||U&&U.windowBits||(X.windowBits+=32),X.windowBits>15&&X.windowBits<48&&0===(15&X.windowBits)&&(X.windowBits|=15),this.err=0,this.pX="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;let b=F.inflateInit2(this.strm,X.windowBits);if(b!==n)throw new Error(Q[b]);if(this.header=new q,F.inflateGetHeader(this.strm,this.header),X.dictionary&&("string"===typeof X.dictionary?X.dictionary=w.string2buf(X.dictionary):"[object ArrayBuffer]"===p.call(X.dictionary)&&(X.dictionary=new Uint8Array(X.dictionary)),X.raw&&(b=F.inflateSetDictionary(this.strm,X.dictionary),b!==n)))throw new Error(Q[b])}function N(U,X){const b=new O(X);if(b.push(U),b.err)throw b.pX||Q[b.err];return b.result}O.prototype.push=function(U,X){const b=this.strm,E=this.options.WU,Q=this.options.dictionary;let z,q,O;if(this.ended)return!1;for(q=X===~~X?X:!0===X?R:S,"[object ArrayBuffer]"===p.call(U)?b.input=new Uint8Array(U):b.input=U,b.next_in=0,b.avail_in=b.input.length;;){for(0===b.avail_out&&(b.output=new Uint8Array(E),b.next_out=0,b.avail_out=E),z=F.inflate(b,q),z===J&&Q&&(z=F.inflateSetDictionary(b,Q),z===n?z=F.inflate(b,q):z===x&&(z=J));b.avail_in>0&&z===a&&b.state.wrap>0&&0!==U[b.next_in];)F.inflateReset(b),z=F.inflate(b,q);switch(z){case m:case x:case J:case I:return this.onEnd(z),this.ended=!0,!1}if(O=b.avail_out,b.next_out&&(0===b.avail_out||z===a))if("string"===this.options.to){let U=w.utf8border(b.output,b.next_out),X=b.next_out-U,F=w.buf2string(b.output,U);b.next_out=X,b.avail_out=E-X,X&&b.output.set(b.output.subarray(U,U+X),0),this.onData(F)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(z!==n||0!==O){if(z===a)return z=F.inflateEnd(this.strm),this.onEnd(z),this.ended=!0,!0;if(0===b.avail_in)break}}return!0},O.prototype.onData=function(U){this.chunks.push(U)},O.prototype.onEnd=function(U){U===n&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=U,this.pX=this.strm.pX},U.exports.Inflate=O,U.exports.inflate=N,U.exports.inflateRaw=function(U,X){return(X=X||{}).raw=!0,N(U,X)},U.exports.ungzip=N,U.exports.constants=b(12748)},12756:U=>{"use strict";const X=(U,X)=>Object.prototype.hasOwnProperty.call(U,X);U.exports.assign=function(U){const b=Array.prototype.slice.call(arguments,1);for(;b.length;){const F=b.shift();if(F){if("object"!==typeof F)throw new TypeError(F+"must be non-object");for(const b in F)X(F,b)&&(U[b]=F[b])}}return U},U.exports.flattenChunks=U=>{let X=0;for(let F=0,E=U.length;F<E;F++)X+=U[F].length;const b=new Uint8Array(X);for(let F=0,E=0,w=U.length;F<w;F++){let X=U[F];b.set(X,E),E+=X.length}return b}},12759:U=>{"use strict";let X=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(F){X=!1}const b=new Uint8Array(256);for(let E=0;E<256;E++)b[E]=E>=252?6:E>=248?5:E>=240?4:E>=224?3:E>=192?2:1;b[254]=b[254]=1,U.exports.string2buf=U=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(U);let X,b,F,E,w,Q=U.length,z=0;for(E=0;E<Q;E++)b=U.charCodeAt(E),55296===(64512&b)&&E+1<Q&&(F=U.charCodeAt(E+1),56320===(64512&F)&&(b=65536+(b-55296<<10)+(F-56320),E++)),z+=b<128?1:b<2048?2:b<65536?3:4;for(X=new Uint8Array(z),w=0,E=0;w<z;E++)b=U.charCodeAt(E),55296===(64512&b)&&E+1<Q&&(F=U.charCodeAt(E+1),56320===(64512&F)&&(b=65536+(b-55296<<10)+(F-56320),E++)),b<128?X[w++]=b:b<2048?(X[w++]=192|b>>>6,X[w++]=128|63&b):b<65536?(X[w++]=224|b>>>12,X[w++]=128|b>>>6&63,X[w++]=128|63&b):(X[w++]=240|b>>>18,X[w++]=128|b>>>12&63,X[w++]=128|b>>>6&63,X[w++]=128|63&b);return X};U.exports.buf2string=(U,F)=>{const E=F||U.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(U.subarray(0,F));let w,Q;const z=new Array(2*E);for(Q=0,w=0;w<E;){let X=U[w++];if(X<128){z[Q++]=X;continue}let F=b[X];if(F>4)z[Q++]=65533,w+=F-1;else{for(X&=2===F?31:3===F?15:7;F>1&&w<E;)X=X<<6|63&U[w++],F--;F>1?z[Q++]=65533:X<65536?z[Q++]=X:(X-=65536,z[Q++]=55296|X>>10&1023,z[Q++]=56320|1023&X)}}return((U,b)=>{if(b<65534&&U.subarray&&X)return String.fromCharCode.apply(null,U.length===b?U:U.subarray(0,b));let F="";for(let X=0;X<b;X++)F+=String.fromCharCode(U[X]);return F})(z,Q)},U.exports.utf8border=(U,X)=>{(X=X||U.length)>U.length&&(X=U.length);let F=X-1;for(;F>=0&&128===(192&U[F]);)F--;return F<0||0===F?X:F+b[U[F]]>X?F:X}},12735:U=>{"use strict";U.exports=(U,X,b,F)=>{let E=65535&U,w=U>>>16&65535,Q=0;for(;0!==b;){Q=b>2e3?2e3:b,b-=Q;do{E=E+X[F++]|0,w=w+E|0}while(--Q);E%=65521,w%=65521}return E|w<<16}},12748:U=>{"use strict";U.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12740:U=>{"use strict";const X=new Uint32Array((()=>{let U,X=[];for(var b=0;b<256;b++){U=b;for(var F=0;F<8;F++)U=1&U?3988292384^U>>>1:U>>>1;X[b]=U}return X})());U.exports=(U,b,F,E)=>{const w=X,Q=E+F;U^=-1;for(let X=E;X<Q;X++)U=U>>>8^w[255&(U^b[X])];return~U}},12724:(U,X,b)=>{"use strict";const{_tr_init:F,_tr_stored_block:E,_tr_flush_block:w,_tr_tally:Q,_tr_align:z}=b(12727),q=b(12735),p=b(12740),S=b(12744),{Z_NO_FLUSH:R,Z_PARTIAL_FLUSH:n,Z_FULL_FLUSH:a,Z_FINISH:J,Z_BLOCK:m,Z_OK:x,Z_STREAM_END:I,Z_STREAM_ERROR:O,Z_DATA_ERROR:N,Z_BUF_ERROR:u,Z_DEFAULT_COMPRESSION:i,Z_FILTERED:P,Z_HUFFMAN_ONLY:f,Z_RLE:j,Z_FIXED:e,Z_DEFAULT_STRATEGY:l,Z_UNKNOWN:d,Z_DEFLATED:k}=b(12748),v=258,A=262,s=103,h=113,B=666,o=(U,X)=>(U.pX=S[X],X),y=U=>(U<<1)-(U>4?9:0),t=U=>{let X=U.length;for(;--X>=0;)U[X]=0};let W=(U,X,b)=>(X<<U.hash_shift^b)&U.hash_mask;const Y=U=>{const X=U.state;let b=X.pending;b>U.avail_out&&(b=U.avail_out),0!==b&&(U.output.set(X.pending_buf.subarray(X.pending_out,X.pending_out+b),U.next_out),U.next_out+=b,X.pending_out+=b,U.total_out+=b,U.avail_out-=b,X.pending-=b,0===X.pending&&(X.pending_out=0))},K=(U,X)=>{w(U,U.block_start>=0?U.block_start:-1,U.strstart-U.block_start,X),U.block_start=U.strstart,Y(U.strm)},V=(U,X)=>{U.pending_buf[U.pending++]=X},g=(U,X)=>{U.pending_buf[U.pending++]=X>>>8&255,U.pending_buf[U.pending++]=255&X},L=(U,X,b,F)=>{let E=U.avail_in;return E>F&&(E=F),0===E?0:(U.avail_in-=E,X.set(U.input.subarray(U.next_in,U.next_in+E),b),1===U.state.wrap?U.adler=q(U.adler,X,E,b):2===U.state.wrap&&(U.adler=p(U.adler,X,E,b)),U.next_in+=E,U.total_in+=E,E)},D=(U,X)=>{let b,F,E=U.max_chain_length,w=U.strstart,Q=U.prev_length,z=U.nice_match;const q=U.strstart>U.w_size-A?U.strstart-(U.w_size-A):0,p=U.window,S=U.w_mask,R=U.prev,n=U.strstart+v;let a=p[w+Q-1],J=p[w+Q];U.prev_length>=U.good_match&&(E>>=2),z>U.lookahead&&(z=U.lookahead);do{if(b=X,p[b+Q]===J&&p[b+Q-1]===a&&p[b]===p[w]&&p[++b]===p[w+1]){w+=2,b++;do{}while(p[++w]===p[++b]&&p[++w]===p[++b]&&p[++w]===p[++b]&&p[++w]===p[++b]&&p[++w]===p[++b]&&p[++w]===p[++b]&&p[++w]===p[++b]&&p[++w]===p[++b]&&w<n);if(F=v-(n-w),w=n-v,F>Q){if(U.match_start=X,Q=F,F>=z)break;a=p[w+Q-1],J=p[w+Q]}}}while((X=R[X&S])>q&&0!==--E);return Q<=U.lookahead?Q:U.lookahead},G=U=>{const X=U.w_size;let b,F,E,w,Q;do{if(w=U.window_size-U.lookahead-U.strstart,U.strstart>=X+(X-A)){U.window.set(U.window.subarray(X,X+X),0),U.match_start-=X,U.strstart-=X,U.block_start-=X,F=U.hash_size,b=F;do{E=U.head[--b],U.head[b]=E>=X?E-X:0}while(--F);F=X,b=F;do{E=U.prev[--b],U.prev[b]=E>=X?E-X:0}while(--F);w+=X}if(0===U.strm.avail_in)break;if(F=L(U.strm,U.window,U.strstart+U.lookahead,w),U.lookahead+=F,U.lookahead+U.insert>=3)for(Q=U.strstart-U.insert,U.ins_h=U.window[Q],U.ins_h=W(U,U.ins_h,U.window[Q+1]);U.insert&&(U.ins_h=W(U,U.ins_h,U.window[Q+3-1]),U.prev[Q&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=Q,Q++,U.insert--,!(U.lookahead+U.insert<3)););}while(U.lookahead<A&&0!==U.strm.avail_in)},Z=(U,X)=>{let b,F;for(;;){if(U.lookahead<A){if(G(U),U.lookahead<A&&X===R)return 1;if(0===U.lookahead)break}if(b=0,U.lookahead>=3&&(U.ins_h=W(U,U.ins_h,U.window[U.strstart+3-1]),b=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),0!==b&&U.strstart-b<=U.w_size-A&&(U.match_length=D(U,b)),U.match_length>=3)if(F=Q(U,U.strstart-U.match_start,U.match_length-3),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=3){U.match_length--;do{U.strstart++,U.ins_h=W(U,U.ins_h,U.window[U.strstart+3-1]),b=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart}while(0!==--U.match_length);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=W(U,U.ins_h,U.window[U.strstart+1]);else F=Q(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if(F&&(K(U,!1),0===U.strm.avail_out))return 1}return U.insert=U.strstart<2?U.strstart:2,X===J?(K(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(K(U,!1),0===U.strm.avail_out)?1:2},c=(U,X)=>{let b,F,E;for(;;){if(U.lookahead<A){if(G(U),U.lookahead<A&&X===R)return 1;if(0===U.lookahead)break}if(b=0,U.lookahead>=3&&(U.ins_h=W(U,U.ins_h,U.window[U.strstart+3-1]),b=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=2,0!==b&&U.prev_length<U.max_lazy_match&&U.strstart-b<=U.w_size-A&&(U.match_length=D(U,b),U.match_length<=5&&(U.strategy===P||3===U.match_length&&U.strstart-U.match_start>4096)&&(U.match_length=2)),U.prev_length>=3&&U.match_length<=U.prev_length){E=U.strstart+U.lookahead-3,F=Q(U,U.strstart-1-U.prev_match,U.prev_length-3),U.lookahead-=U.prev_length-1,U.prev_length-=2;do{++U.strstart<=E&&(U.ins_h=W(U,U.ins_h,U.window[U.strstart+3-1]),b=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart)}while(0!==--U.prev_length);if(U.match_available=0,U.match_length=2,U.strstart++,F&&(K(U,!1),0===U.strm.avail_out))return 1}else if(U.match_available){if(F=Q(U,0,U.window[U.strstart-1]),F&&K(U,!1),U.strstart++,U.lookahead--,0===U.strm.avail_out)return 1}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&(F=Q(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<2?U.strstart:2,X===J?(K(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(K(U,!1),0===U.strm.avail_out)?1:2};function r(U,X,b,F,E){this.good_length=U,this.max_lazy=X,this.nice_length=b,this.max_chain=F,this.func=E}const M=[new r(0,0,0,0,((U,X)=>{let b=65535;for(b>U.pending_buf_size-5&&(b=U.pending_buf_size-5);;){if(U.lookahead<=1){if(G(U),0===U.lookahead&&X===R)return 1;if(0===U.lookahead)break}U.strstart+=U.lookahead,U.lookahead=0;const F=U.block_start+b;if((0===U.strstart||U.strstart>=F)&&(U.lookahead=U.strstart-F,U.strstart=F,K(U,!1),0===U.strm.avail_out))return 1;if(U.strstart-U.block_start>=U.w_size-A&&(K(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,X===J?(K(U,!0),0===U.strm.avail_out?3:4):(U.strstart>U.block_start&&(K(U,!1),U.strm.avail_out),1)})),new r(4,4,8,4,Z),new r(4,5,16,8,Z),new r(4,6,32,32,Z),new r(4,4,16,16,c),new r(8,16,32,32,c),new r(8,16,128,128,c),new r(8,32,128,256,c),new r(32,128,258,1024,c),new r(32,258,258,4096,c)];function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),t(this.dyn_ltree),t(this.dyn_dtree),t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),t(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const T=U=>{if(!U||!U.state)return o(U,O);U.total_in=U.total_out=0,U.data_type=d;const X=U.state;return X.pending=0,X.pending_out=0,X.wrap<0&&(X.wrap=-X.wrap),X.status=X.wrap?42:h,U.adler=2===X.wrap?0:1,X.last_flush=R,F(X),x},C=U=>{const X=T(U);var b;return X===x&&((b=U.state).window_size=2*b.w_size,t(b.head),b.max_lazy_match=M[b.level].max_lazy,b.good_match=M[b.level].good_length,b.nice_match=M[b.level].nice_length,b.max_chain_length=M[b.level].max_chain,b.strstart=0,b.block_start=0,b.lookahead=0,b.insert=0,b.match_length=b.prev_length=2,b.match_available=0,b.ins_h=0),X},UU=(U,X,b,F,E,w)=>{if(!U)return O;let Q=1;if(X===i&&(X=6),F<0?(Q=0,F=-F):F>15&&(Q=2,F-=16),E<1||E>9||b!==k||F<8||F>15||X<0||X>9||w<0||w>e)return o(U,O);8===F&&(F=9);const z=new H;return U.state=z,z.strm=U,z.wrap=Q,z.gzhead=null,z.w_bits=F,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=E+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+3-1)/3),z.window=new Uint8Array(2*z.w_size),z.head=new Uint16Array(z.hash_size),z.prev=new Uint16Array(z.w_size),z.lit_bufsize=1<<E+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new Uint8Array(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=X,z.strategy=w,z.method=b,C(U)};U.exports.deflateInit=(U,X)=>UU(U,X,k,15,8,l),U.exports.deflateInit2=UU,U.exports.deflateReset=C,U.exports.deflateResetKeep=T,U.exports.deflateSetHeader=(U,X)=>U&&U.state?2!==U.state.wrap?O:(U.state.gzhead=X,x):O,U.exports.deflate=(U,X)=>{let b,F;if(!U||!U.state||X>m||X<0)return U?o(U,O):O;const w=U.state;if(!U.output||!U.input&&0!==U.avail_in||w.status===B&&X!==J)return o(U,0===U.avail_out?u:O);w.strm=U;const q=w.last_flush;if(w.last_flush=X,42===w.status)if(2===w.wrap)U.adler=0,V(w,31),V(w,139),V(w,8),w.gzhead?(V(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),V(w,255&w.gzhead.time),V(w,w.gzhead.time>>8&255),V(w,w.gzhead.time>>16&255),V(w,w.gzhead.time>>24&255),V(w,9===w.level?2:w.strategy>=f||w.level<2?4:0),V(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(V(w,255&w.gzhead.extra.length),V(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(U.adler=p(U.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(V(w,0),V(w,0),V(w,0),V(w,0),V(w,0),V(w,9===w.level?2:w.strategy>=f||w.level<2?4:0),V(w,3),w.status=h);else{let X=k+(w.w_bits-8<<4)<<8,b=-1;b=w.strategy>=f||w.level<2?0:w.level<6?1:6===w.level?2:3,X|=b<<6,0!==w.strstart&&(X|=32),X+=31-X%31,w.status=h,g(w,X),0!==w.strstart&&(g(w,U.adler>>>16),g(w,65535&U.adler)),U.adler=1}if(69===w.status)if(w.gzhead.extra){for(b=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>b&&(U.adler=p(U.adler,w.pending_buf,w.pending-b,b)),Y(U),b=w.pending,w.pending!==w.pending_buf_size));)V(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>b&&(U.adler=p(U.adler,w.pending_buf,w.pending-b,b)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(73===w.status)if(w.gzhead.name){b=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>b&&(U.adler=p(U.adler,w.pending_buf,w.pending-b,b)),Y(U),b=w.pending,w.pending===w.pending_buf_size)){F=1;break}F=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,V(w,F)}while(0!==F);w.gzhead.hcrc&&w.pending>b&&(U.adler=p(U.adler,w.pending_buf,w.pending-b,b)),0===F&&(w.gzindex=0,w.status=91)}else w.status=91;if(91===w.status)if(w.gzhead.comment){b=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>b&&(U.adler=p(U.adler,w.pending_buf,w.pending-b,b)),Y(U),b=w.pending,w.pending===w.pending_buf_size)){F=1;break}F=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,V(w,F)}while(0!==F);w.gzhead.hcrc&&w.pending>b&&(U.adler=p(U.adler,w.pending_buf,w.pending-b,b)),0===F&&(w.status=s)}else w.status=s;if(w.status===s&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&Y(U),w.pending+2<=w.pending_buf_size&&(V(w,255&U.adler),V(w,U.adler>>8&255),U.adler=0,w.status=h)):w.status=h),0!==w.pending){if(Y(U),0===U.avail_out)return w.last_flush=-1,x}else if(0===U.avail_in&&y(X)<=y(q)&&X!==J)return o(U,u);if(w.status===B&&0!==U.avail_in)return o(U,u);if(0!==U.avail_in||0!==w.lookahead||X!==R&&w.status!==B){let b=w.strategy===f?((U,X)=>{let b;for(;;){if(0===U.lookahead&&(G(U),0===U.lookahead)){if(X===R)return 1;break}if(U.match_length=0,b=Q(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,b&&(K(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,X===J?(K(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(K(U,!1),0===U.strm.avail_out)?1:2})(w,X):w.strategy===j?((U,X)=>{let b,F,E,w;const z=U.window;for(;;){if(U.lookahead<=v){if(G(U),U.lookahead<=v&&X===R)return 1;if(0===U.lookahead)break}if(U.match_length=0,U.lookahead>=3&&U.strstart>0&&(E=U.strstart-1,F=z[E],F===z[++E]&&F===z[++E]&&F===z[++E])){w=U.strstart+v;do{}while(F===z[++E]&&F===z[++E]&&F===z[++E]&&F===z[++E]&&F===z[++E]&&F===z[++E]&&F===z[++E]&&F===z[++E]&&E<w);U.match_length=v-(w-E),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=3?(b=Q(U,1,U.match_length-3),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(b=Q(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),b&&(K(U,!1),0===U.strm.avail_out))return 1}return U.insert=0,X===J?(K(U,!0),0===U.strm.avail_out?3:4):U.last_lit&&(K(U,!1),0===U.strm.avail_out)?1:2})(w,X):M[w.level].func(w,X);if(3!==b&&4!==b||(w.status=B),1===b||3===b)return 0===U.avail_out&&(w.last_flush=-1),x;if(2===b&&(X===n?z(w):X!==m&&(E(w,0,0,!1),X===a&&(t(w.head),0===w.lookahead&&(w.strstart=0,w.block_start=0,w.insert=0))),Y(U),0===U.avail_out))return w.last_flush=-1,x}return X!==J?x:w.wrap<=0?I:(2===w.wrap?(V(w,255&U.adler),V(w,U.adler>>8&255),V(w,U.adler>>16&255),V(w,U.adler>>24&255),V(w,255&U.total_in),V(w,U.total_in>>8&255),V(w,U.total_in>>16&255),V(w,U.total_in>>24&255)):(g(w,U.adler>>>16),g(w,65535&U.adler)),Y(U),w.wrap>0&&(w.wrap=-w.wrap),0!==w.pending?x:I)},U.exports.deflateEnd=U=>{if(!U||!U.state)return O;const X=U.state.status;return 42!==X&&69!==X&&73!==X&&91!==X&&X!==s&&X!==h&&X!==B?o(U,O):(U.state=null,X===h?o(U,N):x)},U.exports.deflateSetDictionary=(U,X)=>{let b=X.length;if(!U||!U.state)return O;const F=U.state,E=F.wrap;if(2===E||1===E&&42!==F.status||F.lookahead)return O;if(1===E&&(U.adler=q(U.adler,X,b,0)),F.wrap=0,b>=F.w_size){0===E&&(t(F.head),F.strstart=0,F.block_start=0,F.insert=0);let U=new Uint8Array(F.w_size);U.set(X.subarray(b-F.w_size,b),0),X=U,b=F.w_size}const w=U.avail_in,Q=U.next_in,z=U.input;for(U.avail_in=b,U.next_in=0,U.input=X,G(F);F.lookahead>=3;){let U=F.strstart,X=F.lookahead-2;do{F.ins_h=W(F,F.ins_h,F.window[U+3-1]),F.prev[U&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=U,U++}while(--X);F.strstart=U,F.lookahead=2,G(F)}return F.strstart+=F.lookahead,F.block_start=F.strstart,F.insert=F.lookahead,F.lookahead=0,F.match_length=F.prev_length=2,F.match_available=0,U.next_in=Q,U.input=z,U.avail_in=w,F.wrap=E,x},U.exports.deflateInfo="pako deflate (from Nodeca project)"},12789:U=>{"use strict";U.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12782:U=>{"use strict";U.exports=function(U,X){let b,F,E,w,Q,z,q,p,S,R,n,a,J,m,x,I,O,N,u,i,P,f,j,e;const l=U.state;b=U.next_in,j=U.input,F=b+(U.avail_in-5),E=U.next_out,e=U.output,w=E-(X-U.avail_out),Q=E+(U.avail_out-257),z=l.dmax,q=l.wsize,p=l.whave,S=l.wnext,R=l.window,n=l.hold,a=l.bits,J=l.lencode,m=l.distcode,x=(1<<l.lenbits)-1,I=(1<<l.distbits)-1;U:do{a<15&&(n+=j[b++]<<a,a+=8,n+=j[b++]<<a,a+=8),O=J[n&x];X:for(;;){if(N=O>>>24,n>>>=N,a-=N,N=O>>>16&255,0===N)e[E++]=65535&O;else{if(!(16&N)){if(0===(64&N)){O=J[(65535&O)+(n&(1<<N)-1)];continue X}if(32&N){l.mode=12;break U}U.pX="invalid literal/length code",l.mode=30;break U}u=65535&O,N&=15,N&&(a<N&&(n+=j[b++]<<a,a+=8),u+=n&(1<<N)-1,n>>>=N,a-=N),a<15&&(n+=j[b++]<<a,a+=8,n+=j[b++]<<a,a+=8),O=m[n&I];b:for(;;){if(N=O>>>24,n>>>=N,a-=N,N=O>>>16&255,!(16&N)){if(0===(64&N)){O=m[(65535&O)+(n&(1<<N)-1)];continue b}U.pX="invalid distance code",l.mode=30;break U}if(i=65535&O,N&=15,a<N&&(n+=j[b++]<<a,a+=8,a<N&&(n+=j[b++]<<a,a+=8)),i+=n&(1<<N)-1,i>z){U.pX="invalid distance too far back",l.mode=30;break U}if(n>>>=N,a-=N,N=E-w,i>N){if(N=i-N,N>p&&l.sane){U.pX="invalid distance too far back",l.mode=30;break U}if(P=0,f=R,0===S){if(P+=q-N,N<u){u-=N;do{e[E++]=R[P++]}while(--N);P=E-i,f=e}}else if(S<N){if(P+=q+S-N,N-=S,N<u){u-=N;do{e[E++]=R[P++]}while(--N);if(P=0,S<u){N=S,u-=N;do{e[E++]=R[P++]}while(--N);P=E-i,f=e}}}else if(P+=S-N,N<u){u-=N;do{e[E++]=R[P++]}while(--N);P=E-i,f=e}for(;u>2;)e[E++]=f[P++],e[E++]=f[P++],e[E++]=f[P++],u-=3;u&&(e[E++]=f[P++],u>1&&(e[E++]=f[P++]))}else{P=E-i;do{e[E++]=e[P++],e[E++]=e[P++],e[E++]=e[P++],u-=3}while(u>2);u&&(e[E++]=e[P++],u>1&&(e[E++]=e[P++]))}break}}break}}while(b<F&&E<Q);u=a>>3,b-=u,a-=u<<3,n&=(1<<a)-1,U.next_in=b,U.next_out=E,U.avail_in=b<F?F-b+5:5-(b-F),U.avail_out=E<Q?Q-E+257:257-(E-Q),l.hold=n,l.bits=a}},12774:(U,X,b)=>{"use strict";const F=b(12735),E=b(12740),w=b(12782),Q=b(12786),{Z_FINISH:z,Z_BLOCK:q,Z_TREES:p,Z_OK:S,Z_STREAM_END:R,Z_NEED_DICT:n,Z_STREAM_ERROR:a,Z_DATA_ERROR:J,Z_MEM_ERROR:m,Z_BUF_ERROR:x,Z_DEFLATED:I}=b(12748),O=12,N=30,u=U=>(U>>>24&255)+(U>>>8&65280)+((65280&U)<<8)+((255&U)<<24);function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const P=U=>{if(!U||!U.state)return a;const X=U.state;return U.total_in=U.total_out=X.total=0,U.pX="",X.wrap&&(U.adler=1&X.wrap),X.mode=1,X.last=0,X.havedict=0,X.dmax=32768,X.head=null,X.hold=0,X.bits=0,X.lencode=X.lendyn=new Int32Array(852),X.distcode=X.distdyn=new Int32Array(592),X.sane=1,X.back=-1,S},f=U=>{if(!U||!U.state)return a;const X=U.state;return X.wsize=0,X.whave=0,X.wnext=0,P(U)},j=(U,X)=>{let b;if(!U||!U.state)return a;const F=U.state;return X<0?(b=0,X=-X):(b=1+(X>>4),X<48&&(X&=15)),X&&(X<8||X>15)?a:(null!==F.window&&F.wbits!==X&&(F.window=null),F.wrap=b,F.wbits=X,f(U))},e=(U,X)=>{if(!U)return a;const b=new i;U.state=b,b.window=null;const F=j(U,X);return F!==S&&(U.state=null),F};let l,d,k=!0;const v=U=>{if(k){l=new Int32Array(512),d=new Int32Array(32);let X=0;for(;X<144;)U.lens[X++]=8;for(;X<256;)U.lens[X++]=9;for(;X<280;)U.lens[X++]=7;for(;X<288;)U.lens[X++]=8;for(Q(1,U.lens,0,288,l,0,U.work,{bits:9}),X=0;X<32;)U.lens[X++]=5;Q(2,U.lens,0,32,d,0,U.work,{bits:5}),k=!1}U.lencode=l,U.lenbits=9,U.distcode=d,U.distbits=5},A=(U,X,b,F)=>{let E;const w=U.state;return null===w.window&&(w.wsize=1<<w.wbits,w.wnext=0,w.whave=0,w.window=new Uint8Array(w.wsize)),F>=w.wsize?(w.window.set(X.subarray(b-w.wsize,b),0),w.wnext=0,w.whave=w.wsize):(E=w.wsize-w.wnext,E>F&&(E=F),w.window.set(X.subarray(b-F,b-F+E),w.wnext),(F-=E)?(w.window.set(X.subarray(b-F,b),0),w.wnext=F,w.whave=w.wsize):(w.wnext+=E,w.wnext===w.wsize&&(w.wnext=0),w.whave<w.wsize&&(w.whave+=E))),0};U.exports.inflateReset=f,U.exports.inflateReset2=j,U.exports.inflateResetKeep=P,U.exports.inflateInit=U=>e(U,15),U.exports.inflateInit2=e,U.exports.inflate=(U,X)=>{let b,i,P,f,j,e,l,d,k,s,h,B,o,y,t,W,Y,K,V,g,L,D,G=0;const Z=new Uint8Array(4);let c,r;const M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!U||!U.state||!U.output||!U.input&&0!==U.avail_in)return a;b=U.state,b.mode===O&&(b.mode=13),j=U.next_out,P=U.output,l=U.avail_out,f=U.next_in,i=U.input,e=U.avail_in,d=b.hold,k=b.bits,s=e,h=l,D=S;U:for(;;)switch(b.mode){case 1:if(0===b.wrap){b.mode=13;break}for(;k<16;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if(2&b.wrap&&35615===d){b.check=0,Z[0]=255&d,Z[1]=d>>>8&255,b.check=E(b.check,Z,2,0),d=0,k=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&d)<<8)+(d>>8))%31){U.pX="incorrect header check",b.mode=N;break}if((15&d)!==I){U.pX="unknown compression method",b.mode=N;break}if(d>>>=4,k-=4,L=8+(15&d),0===b.wbits)b.wbits=L;else if(L>b.wbits){U.pX="invalid window size",b.mode=N;break}b.dmax=1<<b.wbits,U.adler=b.check=1,b.mode=512&d?10:O,d=0,k=0;break;case 2:for(;k<16;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if(b.flags=d,(255&b.flags)!==I){U.pX="unknown compression method",b.mode=N;break}if(57344&b.flags){U.pX="unknown header flags set",b.mode=N;break}b.head&&(b.head.text=d>>8&1),512&b.flags&&(Z[0]=255&d,Z[1]=d>>>8&255,b.check=E(b.check,Z,2,0)),d=0,k=0,b.mode=3;case 3:for(;k<32;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}b.head&&(b.head.time=d),512&b.flags&&(Z[0]=255&d,Z[1]=d>>>8&255,Z[2]=d>>>16&255,Z[3]=d>>>24&255,b.check=E(b.check,Z,4,0)),d=0,k=0,b.mode=4;case 4:for(;k<16;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}b.head&&(b.head.xflags=255&d,b.head.os=d>>8),512&b.flags&&(Z[0]=255&d,Z[1]=d>>>8&255,b.check=E(b.check,Z,2,0)),d=0,k=0,b.mode=5;case 5:if(1024&b.flags){for(;k<16;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}b.length=d,b.head&&(b.head.extra_len=d),512&b.flags&&(Z[0]=255&d,Z[1]=d>>>8&255,b.check=E(b.check,Z,2,0)),d=0,k=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(B=b.length,B>e&&(B=e),B&&(b.head&&(L=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Uint8Array(b.head.extra_len)),b.head.extra.set(i.subarray(f,f+B),L)),512&b.flags&&(b.check=E(b.check,i,B,f)),e-=B,f+=B,b.length-=B),b.length))break U;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(0===e)break U;B=0;do{L=i[f+B++],b.head&&L&&b.length<65536&&(b.head.name+=String.fromCharCode(L))}while(L&&B<e);if(512&b.flags&&(b.check=E(b.check,i,B,f)),e-=B,f+=B,L)break U}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(0===e)break U;B=0;do{L=i[f+B++],b.head&&L&&b.length<65536&&(b.head.comment+=String.fromCharCode(L))}while(L&&B<e);if(512&b.flags&&(b.check=E(b.check,i,B,f)),e-=B,f+=B,L)break U}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;k<16;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if(d!==(65535&b.check)){U.pX="header crc mismatch",b.mode=N;break}d=0,k=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),U.adler=b.check=0,b.mode=O;break;case 10:for(;k<32;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}U.adler=b.check=u(d),d=0,k=0,b.mode=11;case 11:if(0===b.havedict)return U.next_out=j,U.avail_out=l,U.next_in=f,U.avail_in=e,b.hold=d,b.bits=k,n;U.adler=b.check=1,b.mode=O;case O:if(X===q||X===p)break U;case 13:if(b.last){d>>>=7&k,k-=7&k,b.mode=27;break}for(;k<3;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}switch(b.last=1&d,d>>>=1,k-=1,3&d){case 0:b.mode=14;break;case 1:if(v(b),b.mode=20,X===p){d>>>=2,k-=2;break U}break;case 2:b.mode=17;break;case 3:U.pX="invalid block type",b.mode=N}d>>>=2,k-=2;break;case 14:for(d>>>=7&k,k-=7&k;k<32;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if((65535&d)!==(d>>>16^65535)){U.pX="invalid stored block lengths",b.mode=N;break}if(b.length=65535&d,d=0,k=0,b.mode=15,X===p)break U;case 15:b.mode=16;case 16:if(B=b.length,B){if(B>e&&(B=e),B>l&&(B=l),0===B)break U;P.set(i.subarray(f,f+B),j),e-=B,f+=B,l-=B,j+=B,b.length-=B;break}b.mode=O;break;case 17:for(;k<14;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if(b.nlen=257+(31&d),d>>>=5,k-=5,b.ndist=1+(31&d),d>>>=5,k-=5,b.ncode=4+(15&d),d>>>=4,k-=4,b.nlen>286||b.ndist>30){U.pX="too many length or distance symbols",b.mode=N;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;k<3;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}b.lens[M[b.have++]]=7&d,d>>>=3,k-=3}for(;b.have<19;)b.lens[M[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,c={bits:b.lenbits},D=Q(0,b.lens,0,19,b.lencode,0,b.work,c),b.lenbits=c.bits,D){U.pX="invalid code lengths set",b.mode=N;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;G=b.lencode[d&(1<<b.lenbits)-1],t=G>>>24,W=G>>>16&255,Y=65535&G,!(t<=k);){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if(Y<16)d>>>=t,k-=t,b.lens[b.have++]=Y;else{if(16===Y){for(r=t+2;k<r;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if(d>>>=t,k-=t,0===b.have){U.pX="invalid bit length repeat",b.mode=N;break}L=b.lens[b.have-1],B=3+(3&d),d>>>=2,k-=2}else if(17===Y){for(r=t+3;k<r;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}d>>>=t,k-=t,L=0,B=3+(7&d),d>>>=3,k-=3}else{for(r=t+7;k<r;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}d>>>=t,k-=t,L=0,B=11+(127&d),d>>>=7,k-=7}if(b.have+B>b.nlen+b.ndist){U.pX="invalid bit length repeat",b.mode=N;break}for(;B--;)b.lens[b.have++]=L}}if(b.mode===N)break;if(0===b.lens[256]){U.pX="invalid code -- missing end-of-block",b.mode=N;break}if(b.lenbits=9,c={bits:b.lenbits},D=Q(1,b.lens,0,b.nlen,b.lencode,0,b.work,c),b.lenbits=c.bits,D){U.pX="invalid literal/lengths set",b.mode=N;break}if(b.distbits=6,b.distcode=b.distdyn,c={bits:b.distbits},D=Q(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,c),b.distbits=c.bits,D){U.pX="invalid distances set",b.mode=N;break}if(b.mode=20,X===p)break U;case 20:b.mode=21;case 21:if(e>=6&&l>=258){U.next_out=j,U.avail_out=l,U.next_in=f,U.avail_in=e,b.hold=d,b.bits=k,w(U,h),j=U.next_out,P=U.output,l=U.avail_out,f=U.next_in,i=U.input,e=U.avail_in,d=b.hold,k=b.bits,b.mode===O&&(b.back=-1);break}for(b.back=0;G=b.lencode[d&(1<<b.lenbits)-1],t=G>>>24,W=G>>>16&255,Y=65535&G,!(t<=k);){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if(W&&0===(240&W)){for(K=t,V=W,g=Y;G=b.lencode[g+((d&(1<<K+V)-1)>>K)],t=G>>>24,W=G>>>16&255,Y=65535&G,!(K+t<=k);){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}d>>>=K,k-=K,b.back+=K}if(d>>>=t,k-=t,b.back+=t,b.length=Y,0===W){b.mode=26;break}if(32&W){b.back=-1,b.mode=O;break}if(64&W){U.pX="invalid literal/length code",b.mode=N;break}b.extra=15&W,b.mode=22;case 22:if(b.extra){for(r=b.extra;k<r;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}b.length+=d&(1<<b.extra)-1,d>>>=b.extra,k-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;G=b.distcode[d&(1<<b.distbits)-1],t=G>>>24,W=G>>>16&255,Y=65535&G,!(t<=k);){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if(0===(240&W)){for(K=t,V=W,g=Y;G=b.distcode[g+((d&(1<<K+V)-1)>>K)],t=G>>>24,W=G>>>16&255,Y=65535&G,!(K+t<=k);){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}d>>>=K,k-=K,b.back+=K}if(d>>>=t,k-=t,b.back+=t,64&W){U.pX="invalid distance code",b.mode=N;break}b.offset=Y,b.extra=15&W,b.mode=24;case 24:if(b.extra){for(r=b.extra;k<r;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}b.offset+=d&(1<<b.extra)-1,d>>>=b.extra,k-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){U.pX="invalid distance too far back",b.mode=N;break}b.mode=25;case 25:if(0===l)break U;if(B=h-l,b.offset>B){if(B=b.offset-B,B>b.whave&&b.sane){U.pX="invalid distance too far back",b.mode=N;break}B>b.wnext?(B-=b.wnext,o=b.wsize-B):o=b.wnext-B,B>b.length&&(B=b.length),y=b.window}else y=P,o=j-b.offset,B=b.length;B>l&&(B=l),l-=B,b.length-=B;do{P[j++]=y[o++]}while(--B);0===b.length&&(b.mode=21);break;case 26:if(0===l)break U;P[j++]=b.length,l--,b.mode=21;break;case 27:if(b.wrap){for(;k<32;){if(0===e)break U;e--,d|=i[f++]<<k,k+=8}if(h-=l,U.total_out+=h,b.total+=h,h&&(U.adler=b.check=b.flags?E(b.check,P,h,j-h):F(b.check,P,h,j-h)),h=l,(b.flags?d:u(d))!==b.check){U.pX="incorrect data check",b.mode=N;break}d=0,k=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;k<32;){if(0===e)break U;e--,d+=i[f++]<<k,k+=8}if(d!==(4294967295&b.total)){U.pX="incorrect length check",b.mode=N;break}d=0,k=0}b.mode=29;case 29:D=R;break U;case N:D=J;break U;case 31:return m;default:return a}return U.next_out=j,U.avail_out=l,U.next_in=f,U.avail_in=e,b.hold=d,b.bits=k,(b.wsize||h!==U.avail_out&&b.mode<N&&(b.mode<27||X!==z))&&A(U,U.output,U.next_out,h-U.avail_out)?(b.mode=31,m):(s-=U.avail_in,h-=U.avail_out,U.total_in+=s,U.total_out+=h,b.total+=h,b.wrap&&h&&(U.adler=b.check=b.flags?E(b.check,P,h,U.next_out-h):F(b.check,P,h,U.next_out-h)),U.data_type=b.bits+(b.last?64:0)+(b.mode===O?128:0)+(20===b.mode||15===b.mode?256:0),(0===s&&0===h||X===z)&&D===S&&(D=x),D)},U.exports.inflateEnd=U=>{if(!U||!U.state)return a;let X=U.state;return X.window&&(X.window=null),U.state=null,S},U.exports.inflateGetHeader=(U,X)=>{if(!U||!U.state)return a;const b=U.state;return 0===(2&b.wrap)?a:(b.head=X,X.done=!1,S)},U.exports.inflateSetDictionary=(U,X)=>{const b=X.length;let E,w,Q;return U&&U.state?(E=U.state,0!==E.wrap&&11!==E.mode?a:11===E.mode&&(w=1,w=F(w,X,b,0),w!==E.check)?J:(Q=A(U,X,b,b),Q?(E.mode=31,m):(E.havedict=1,S))):a},U.exports.inflateInfo="pako inflate (from Nodeca project)"},12786:U=>{"use strict";const X=15,b=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),F=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),E=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),w=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);U.exports=(U,Q,z,q,p,S,R,n)=>{const a=n.bits;let J,m,x,I,O,N,u=0,i=0,P=0,f=0,j=0,e=0,l=0,d=0,k=0,v=0,A=null,s=0;const h=new Uint16Array(16),B=new Uint16Array(16);let o,y,t,W=null,Y=0;for(u=0;u<=X;u++)h[u]=0;for(i=0;i<q;i++)h[Q[z+i]]++;for(j=a,f=X;f>=1&&0===h[f];f--);if(j>f&&(j=f),0===f)return p[S++]=20971520,p[S++]=20971520,n.bits=1,0;for(P=1;P<f&&0===h[P];P++);for(j<P&&(j=P),d=1,u=1;u<=X;u++)if(d<<=1,d-=h[u],d<0)return-1;if(d>0&&(0===U||1!==f))return-1;for(B[1]=0,u=1;u<X;u++)B[u+1]=B[u]+h[u];for(i=0;i<q;i++)0!==Q[z+i]&&(R[B[Q[z+i]]++]=i);if(0===U?(A=W=R,N=19):1===U?(A=b,s-=257,W=F,Y-=257,N=256):(A=E,W=w,N=-1),v=0,i=0,u=P,O=S,e=j,l=0,x=-1,k=1<<j,I=k-1,1===U&&k>852||2===U&&k>592)return 1;for(;;){o=u-l,R[i]<N?(y=0,t=R[i]):R[i]>N?(y=W[Y+R[i]],t=A[s+R[i]]):(y=96,t=0),J=1<<u-l,m=1<<e,P=m;do{m-=J,p[O+(v>>l)+m]=o<<24|y<<16|t}while(0!==m);for(J=1<<u-1;v&J;)J>>=1;if(0!==J?(v&=J-1,v+=J):v=0,i++,0===--h[u]){if(u===f)break;u=Q[z+R[i]]}if(u>j&&(v&I)!==x){for(0===l&&(l=j),O+=P,e=u-l,d=1<<e;e+l<f&&(d-=h[e+l],!(d<=0));)e++,d<<=1;if(k+=1<<e,1===U&&k>852||2===U&&k>592)return 1;x=v&I,p[x]=j<<24|e<<16|O-S}}return 0!==v&&(p[O+v]=u-l<<24|64<<16),n.bits=j,0}},12744:U=>{"use strict";U.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12727:U=>{"use strict";function X(U){let X=U.length;for(;--X>=0;)U[X]=0}const b=256,F=286,E=30,w=15,Q=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),z=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),q=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),S=new Array(576);X(S);const R=new Array(60);X(R);const n=new Array(512);X(n);const a=new Array(256);X(a);const J=new Array(29);X(J);const m=new Array(E);function x(U,X,b,F,E){this.static_tree=U,this.extra_bits=X,this.extra_base=b,this.elems=F,this.max_length=E,this.has_stree=U&&U.length}let I,O,N;function u(U,X){this.dyn_tree=U,this.max_code=0,this.stat_desc=X}X(m);const i=U=>U<256?n[U]:n[256+(U>>>7)],P=(U,X)=>{U.pending_buf[U.pending++]=255&X,U.pending_buf[U.pending++]=X>>>8&255},f=(U,X,b)=>{U.bi_valid>16-b?(U.bi_buf|=X<<U.bi_valid&65535,P(U,U.bi_buf),U.bi_buf=X>>16-U.bi_valid,U.bi_valid+=b-16):(U.bi_buf|=X<<U.bi_valid&65535,U.bi_valid+=b)},j=(U,X,b)=>{f(U,b[2*X],b[2*X+1])},e=(U,X)=>{let b=0;do{b|=1&U,U>>>=1,b<<=1}while(--X>0);return b>>>1},l=(U,X,b)=>{const F=new Array(16);let E,Q,z=0;for(E=1;E<=w;E++)F[E]=z=z+b[E-1]<<1;for(Q=0;Q<=X;Q++){let X=U[2*Q+1];0!==X&&(U[2*Q]=e(F[X]++,X))}},d=U=>{let X;for(X=0;X<F;X++)U.dyn_ltree[2*X]=0;for(X=0;X<E;X++)U.dyn_dtree[2*X]=0;for(X=0;X<19;X++)U.bl_tree[2*X]=0;U.dyn_ltree[512]=1,U.opt_len=U.static_len=0,U.last_lit=U.matches=0},k=U=>{U.bi_valid>8?P(U,U.bi_buf):U.bi_valid>0&&(U.pending_buf[U.pending++]=U.bi_buf),U.bi_buf=0,U.bi_valid=0},v=(U,X,b,F)=>{const E=2*X,w=2*b;return U[E]<U[w]||U[E]===U[w]&&F[X]<=F[b]},A=(U,X,b)=>{const F=U.heap[b];let E=b<<1;for(;E<=U.heap_len&&(E<U.heap_len&&v(X,U.heap[E+1],U.heap[E],U.depth)&&E++,!v(X,F,U.heap[E],U.depth));)U.heap[b]=U.heap[E],b=E,E<<=1;U.heap[b]=F},s=(U,X,F)=>{let E,w,q,p,S=0;if(0!==U.last_lit)do{E=U.pending_buf[U.d_buf+2*S]<<8|U.pending_buf[U.d_buf+2*S+1],w=U.pending_buf[U.l_buf+S],S++,0===E?j(U,w,X):(q=a[w],j(U,q+b+1,X),p=Q[q],0!==p&&(w-=J[q],f(U,w,p)),E--,q=i(E),j(U,q,F),p=z[q],0!==p&&(E-=m[q],f(U,E,p)))}while(S<U.last_lit);j(U,256,X)},h=(U,X)=>{const b=X.dyn_tree,F=X.stat_desc.static_tree,E=X.stat_desc.has_stree,Q=X.stat_desc.elems;let z,q,p,S=-1;for(U.heap_len=0,U.heap_max=573,z=0;z<Q;z++)0!==b[2*z]?(U.heap[++U.heap_len]=S=z,U.depth[z]=0):b[2*z+1]=0;for(;U.heap_len<2;)p=U.heap[++U.heap_len]=S<2?++S:0,b[2*p]=1,U.depth[p]=0,U.opt_len--,E&&(U.static_len-=F[2*p+1]);for(X.max_code=S,z=U.heap_len>>1;z>=1;z--)A(U,b,z);p=Q;do{z=U.heap[1],U.heap[1]=U.heap[U.heap_len--],A(U,b,1),q=U.heap[1],U.heap[--U.heap_max]=z,U.heap[--U.heap_max]=q,b[2*p]=b[2*z]+b[2*q],U.depth[p]=(U.depth[z]>=U.depth[q]?U.depth[z]:U.depth[q])+1,b[2*z+1]=b[2*q+1]=p,U.heap[1]=p++,A(U,b,1)}while(U.heap_len>=2);U.heap[--U.heap_max]=U.heap[1],((U,X)=>{const b=X.dyn_tree,F=X.max_code,E=X.stat_desc.static_tree,Q=X.stat_desc.has_stree,z=X.stat_desc.extra_bits,q=X.stat_desc.extra_base,p=X.stat_desc.max_length;let S,R,n,a,J,m,x=0;for(a=0;a<=w;a++)U.bl_count[a]=0;for(b[2*U.heap[U.heap_max]+1]=0,S=U.heap_max+1;S<573;S++)R=U.heap[S],a=b[2*b[2*R+1]+1]+1,a>p&&(a=p,x++),b[2*R+1]=a,R>F||(U.bl_count[a]++,J=0,R>=q&&(J=z[R-q]),m=b[2*R],U.opt_len+=m*(a+J),Q&&(U.static_len+=m*(E[2*R+1]+J)));if(0!==x){do{for(a=p-1;0===U.bl_count[a];)a--;U.bl_count[a]--,U.bl_count[a+1]+=2,U.bl_count[p]--,x-=2}while(x>0);for(a=p;0!==a;a--)for(R=U.bl_count[a];0!==R;)n=U.heap[--S],n>F||(b[2*n+1]!==a&&(U.opt_len+=(a-b[2*n+1])*b[2*n],b[2*n+1]=a),R--)}})(U,X),l(b,S,U.bl_count)},B=(U,X,b)=>{let F,E,w=-1,Q=X[1],z=0,q=7,p=4;for(0===Q&&(q=138,p=3),X[2*(b+1)+1]=65535,F=0;F<=b;F++)E=Q,Q=X[2*(F+1)+1],++z<q&&E===Q||(z<p?U.bl_tree[2*E]+=z:0!==E?(E!==w&&U.bl_tree[2*E]++,U.bl_tree[32]++):z<=10?U.bl_tree[34]++:U.bl_tree[36]++,z=0,w=E,0===Q?(q=138,p=3):E===Q?(q=6,p=3):(q=7,p=4))},o=(U,X,b)=>{let F,E,w=-1,Q=X[1],z=0,q=7,p=4;for(0===Q&&(q=138,p=3),F=0;F<=b;F++)if(E=Q,Q=X[2*(F+1)+1],!(++z<q&&E===Q)){if(z<p)do{j(U,E,U.bl_tree)}while(0!==--z);else 0!==E?(E!==w&&(j(U,E,U.bl_tree),z--),j(U,16,U.bl_tree),f(U,z-3,2)):z<=10?(j(U,17,U.bl_tree),f(U,z-3,3)):(j(U,18,U.bl_tree),f(U,z-11,7));z=0,w=E,0===Q?(q=138,p=3):E===Q?(q=6,p=3):(q=7,p=4)}};let y=!1;const t=(U,X,b,F)=>{f(U,0+(F?1:0),3),((U,X,b,F)=>{k(U),F&&(P(U,b),P(U,~b)),U.pending_buf.set(U.window.subarray(X,X+b),U.pending),U.pending+=b})(U,X,b,!0)};U.exports._tr_init=U=>{y||((()=>{let U,X,b,p,u;const i=new Array(16);for(b=0,p=0;p<28;p++)for(J[p]=b,U=0;U<1<<Q[p];U++)a[b++]=p;for(a[b-1]=p,u=0,p=0;p<16;p++)for(m[p]=u,U=0;U<1<<z[p];U++)n[u++]=p;for(u>>=7;p<E;p++)for(m[p]=u<<7,U=0;U<1<<z[p]-7;U++)n[256+u++]=p;for(X=0;X<=w;X++)i[X]=0;for(U=0;U<=143;)S[2*U+1]=8,U++,i[8]++;for(;U<=255;)S[2*U+1]=9,U++,i[9]++;for(;U<=279;)S[2*U+1]=7,U++,i[7]++;for(;U<=287;)S[2*U+1]=8,U++,i[8]++;for(l(S,287,i),U=0;U<E;U++)R[2*U+1]=5,R[2*U]=e(U,5);I=new x(S,Q,257,F,w),O=new x(R,z,0,E,w),N=new x(new Array(0),q,0,19,7)})(),y=!0),U.l_desc=new u(U.dyn_ltree,I),U.d_desc=new u(U.dyn_dtree,O),U.bl_desc=new u(U.bl_tree,N),U.bi_buf=0,U.bi_valid=0,d(U)},U.exports._tr_stored_block=t,U.exports._tr_flush_block=(U,X,F,E)=>{let w,Q,z=0;U.level>0?(2===U.strm.data_type&&(U.strm.data_type=(U=>{let X,F=4093624447;for(X=0;X<=31;X++,F>>>=1)if(1&F&&0!==U.dyn_ltree[2*X])return 0;if(0!==U.dyn_ltree[18]||0!==U.dyn_ltree[20]||0!==U.dyn_ltree[26])return 1;for(X=32;X<b;X++)if(0!==U.dyn_ltree[2*X])return 1;return 0})(U)),h(U,U.l_desc),h(U,U.d_desc),z=(U=>{let X;for(B(U,U.dyn_ltree,U.l_desc.max_code),B(U,U.dyn_dtree,U.d_desc.max_code),h(U,U.bl_desc),X=18;X>=3&&0===U.bl_tree[2*p[X]+1];X--);return U.opt_len+=3*(X+1)+5+5+4,X})(U),w=U.opt_len+3+7>>>3,Q=U.static_len+3+7>>>3,Q<=w&&(w=Q)):w=Q=F+5,F+4<=w&&-1!==X?t(U,X,F,E):4===U.strategy||Q===w?(f(U,2+(E?1:0),3),s(U,S,R)):(f(U,4+(E?1:0),3),((U,X,b,F)=>{let E;for(f(U,X-257,5),f(U,b-1,5),f(U,F-4,4),E=0;E<F;E++)f(U,U.bl_tree[2*p[E]+1],3);o(U,U.dyn_ltree,X-1),o(U,U.dyn_dtree,b-1)})(U,U.l_desc.max_code+1,U.d_desc.max_code+1,z+1),s(U,U.dyn_ltree,U.dyn_dtree)),d(U),E&&k(U)},U.exports._tr_tally=(U,X,F)=>(U.pending_buf[U.d_buf+2*U.last_lit]=X>>>8&255,U.pending_buf[U.d_buf+2*U.last_lit+1]=255&X,U.pending_buf[U.l_buf+U.last_lit]=255&F,U.last_lit++,0===X?U.dyn_ltree[2*F]++:(U.matches++,X--,U.dyn_ltree[2*(a[F]+b+1)]++,U.dyn_dtree[2*i(X)]++),U.last_lit===U.lit_bufsize-1),U.exports._tr_align=U=>{f(U,2,3),j(U,256,S),(U=>{16===U.bi_valid?(P(U,U.bi_buf),U.bi_buf=0,U.bi_valid=0):U.bi_valid>=8&&(U.pending_buf[U.pending++]=255&U.bi_buf,U.bi_buf>>=8,U.bi_valid-=8)})(U)}},12764:U=>{"use strict";U.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.pX="",this.state=null,this.data_type=2,this.adler=0}},12403:U=>{function X(U,X,b){for(var F=U.length,E=-1/0,w=1/0,Q=0;Q<F;Q++){var z=(b[0][Q]-U[Q])/X[Q],q=(b[1][Q]-U[Q])/X[Q];if(z>q){var p=z;z=q,q=p}if(q<E||z>w)return 1/0;z>E&&(E=z),q<w&&(w=q)}return E>w?1/0:E}U.exports=function(U,b,F,E){var w=X(b,F,E);if(w===1/0)U=null;else{U=U||[];for(var Q=0;Q<b.length;Q++)U[Q]=b[Q]+F[Q]*w}return U},U.exports.distance=X},13790:(U,X,b)=>{"use strict";b.d(X,{e:()=>Q});var F=b(42);const E=F.useLayoutEffect;const w=function(U){var X=(0,F.useRef)(U);return E((function(){X.current=U})),X};var Q=function(U){var X=w(U);(0,F.QX)((function(){var U=function(U){var b;if(null!=X.current&&(b=X.current(U)),U.defaultPrevented&&(U.returnValue=""),"string"===typeof b)return U.returnValue=b,b};return window.addEventListener("beforeunload",U),function(){window.removeEventListener("beforeunload",U)}}),[])}},13734:(U,X,b)=>{"use strict";var F=b(13741),E=Array.prototype.concat,w=Array.prototype.slice,Q=U.exports=function(U){for(var X=[],b=0,Q=U.length;b<Q;b++){var z=U[b];F(z)?X=E.call(X,w.call(z)):X.push(z)}return X};Q.wrap=function(U){return function(){return U(Q(arguments))}}},13741:U=>{U.exports=function(U){return!(!U||"string"===typeof U)&&(U instanceof Array||Array.isArray(U)||U.length>=0&&(U.splice instanceof Function||Object.getOwnPropertyDescriptor(U,U.length-1)&&"String"!==U.constructor.name))}},12676:(U,X,b)=>{var F=b(12681);function E(U){for(var X,b,E=0,w=U.length,Q=0;Q<U.length;){for(X=U[Q],b=0;Q<w&&U[Q]===X;)++Q,++b;E+=F.log2(b)/7|0,E+=F.log2(X>>>0)/7|0,E+=2}return E}X.size=E,X.encode=function(U,X){X||(X=new Uint8Array(E(U)));for(var b,F,w=0,Q=X.length,z=0;z<U.length;){for(b=U[z],F=0;z<U.length&&U[z]===b;)++z,++F;for(;w<Q&&F>=128;)X[w++]=128+(127&F),F>>>=7;if(w>=Q)throw new Error("RLE buffer overflow");for(X[w++]=F,b>>>=0;w<Q&&b>=128;)X[w++]=128+(127&b),b>>>=7;if(w>=Q)throw new Error("RLE buffer overflow");X[w++]=b}return X},X.decode=function(U,X){for(var b,F,E,w,Q=X.length,z=U.length,q=0,p=0;p<z;){for(b=0,F=0;p<z&&U[p]>=128;)b+=(127&U[p++])<<F,F+=7;if(b+=U[p++]<<F,p>=z)throw new Error("RLE buffer underrun");if(q+b>Q)throw new Error("Chunk buffer overflow");for(E=0,F=0;p<z&&U[p]>=128;)E+=(127&U[p++])<<F,F+=7;if(p>=z)throw new Error("RLE buffer underrun");for(E+=U[p++]<<F,w=0;w<b;++w)X[q++]=E}return X}},12681:(U,X)=>{"use strict";function b(U){var X=32;return(U&=-U)&&X--,65535&U&&(X-=16),16711935&U&&(X-=8),252645135&U&&(X-=4),858993459&U&&(X-=2),1431655765&U&&(X-=1),X}X.INT_BITS=32,X.INT_MAX=2147483647,X.INT_MIN=-1<<31,X.sign=function(U){return(U>0)-(U<0)},X.abs=function(U){var X=U>>31;return(U^X)-X},X.min=function(U,X){return X^(U^X)&-(U<X)},X.max=function(U,X){return U^(U^X)&-(U<X)},X.isPow2=function(U){return!(U&U-1)&&!!U},X.log2=function(U){var X,b;return X=(U>65535)<<4,X|=b=((U>>>=X)>255)<<3,X|=b=((U>>>=b)>15)<<2,(X|=b=((U>>>=b)>3)<<1)|(U>>>=b)>>1},X.log10=function(U){return U>=1e9?9:U>=1e8?8:U>=1e7?7:U>=1e6?6:U>=1e5?5:U>=1e4?4:U>=1e3?3:U>=100?2:U>=10?1:0},X.popCount=function(U){return 16843009*((U=(858993459&(U-=U>>>1&1431655765))+(U>>>2&858993459))+(U>>>4)&252645135)>>>24},X.countTrailingZeros=b,X.nextPow2=function(U){return U+=0===U,--U,U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)+1},X.prevPow2=function(U){return U|=U>>>1,U|=U>>>2,U|=U>>>4,U|=U>>>8,(U|=U>>>16)-(U>>>1)},X.parity=function(U){return U^=U>>>16,U^=U>>>8,U^=U>>>4,27030>>>(U&=15)&1};var F=new Array(256);!function(U){for(var X=0;X<256;++X){var b=X,F=X,E=7;for(b>>>=1;b;b>>>=1)F<<=1,F|=1&b,--E;U[X]=F<<E&255}}(F),X.reverse=function(U){return F[255&U]<<24|F[U>>>8&255]<<16|F[U>>>16&255]<<8|F[U>>>24&255]},X.interleave2=function(U,X){return(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U&=65535)|U<<8))|U<<4))|U<<2))|U<<1))|(X=1431655765&((X=858993459&((X=252645135&((X=16711935&((X&=65535)|X<<8))|X<<4))|X<<2))|X<<1))<<1},X.deinterleave2=function(U,X){return(U=65535&((U=16711935&((U=252645135&((U=858993459&((U=U>>>X&1431655765)|U>>>1))|U>>>2))|U>>>4))|U>>>16))<<16>>16},X.interleave3=function(U,X,b){return U=1227133513&((U=3272356035&((U=251719695&((U=4278190335&((U&=1023)|U<<16))|U<<8))|U<<4))|U<<2),(U|=(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},X.deinterleave3=function(U,X){return(U=1023&((U=4278190335&((U=251719695&((U=3272356035&((U=U>>>X&1227133513)|U>>>2))|U>>>4))|U>>>8))|U>>>16))<<22>>22},X.nextCombination=function(U){var X=U|U-1;return X+1|(~X&-~X)-1>>>b(U)+1}},12708:U=>{"use strict";U.exports=function(U,X,b,F){var E=self||window;try{try{var w;try{w=new E.Blob([U])}catch(p){(w=new(E.BlobBuilder||E.WebKitBlobBuilder||E.MozBlobBuilder||E.MSBlobBuilder)).append(U),w=w.getBlob()}var Q=E.URL||E.webkitURL,z=Q.createObjectURL(w),q=new E[X](z,b);return Q.revokeObjectURL(z),q}catch(p){return new E[X]("data:application/javascript,".concat(encodeURIComponent(U)),b)}}catch(p){if(!F)throw Error("Inline worker is not supported");return new E[X](F,b)}}},12385:(U,X,b)=>{"use strict";function F(U,X,b,F,E){var w={};return Object.keys(F).forEach((function(U){w[U]=F[U]})),w.enumerable=!!w.enumerable,w.configurable=!!w.configurable,("value"in w||w.initializer)&&(w.writable=!0),w=b.slice().reverse().reduce((function(b,F){return F(U,X,b)||b}),w),E&&void 0!==w.initializer&&(w.value=w.initializer?w.initializer.call(E):void 0,w.initializer=void 0),void 0===w.initializer&&(Object.defineProperty(U,X,w),w=null),w}b.d(X,{d:()=>F})},12378:(U,X,b)=>{"use strict";function F(U,X,b,F){b&&Object.defineProperty(U,X,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(F):void 0})}b.d(X,{c:()=>F})},13777:(U,X,b)=>{"use strict";b.d(X,{e:()=>Q,h:()=>R,j:()=>z,m:()=>w,p:()=>q,q:()=>E,u:()=>p,w:()=>S});var F=b(11803);class E{constructor(){this._easingMode=E.EASINGMODE_EASEIN}setEasingMode(U){const X=Math.min(Math.max(U,0),2);this._easingMode=X}getEasingMode(){return this._easingMode}easeInCore(U){throw new Error("You must implement this method")}ease(U){switch(this._easingMode){case E.EASINGMODE_EASEIN:return this.easeInCore(U);case E.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-U)}return U>=.5?.5*(1-this.easeInCore(2*(1-U)))+.5:.5*this.easeInCore(2*U)}}E.EASINGMODE_EASEIN=0,E.EASINGMODE_EASEOUT=1,E.EASINGMODE_EASEINOUT=2;class w extends E{easeInCore(U){return U=Math.max(0,Math.min(1,U)),1-Math.sqrt(1-U*U)}}class Q extends E{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=U}easeInCore(U){const X=Math.max(0,this.amplitude);return Math.pow(U,3)-U*X*Math.sin(3.141592653589793*U)}}class z extends E{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=U,this.bounciness=X}easeInCore(U){const X=Math.max(0,this.bounces);let b=this.bounciness;b<=1&&(b=1.001);const F=Math.pow(b,X),E=1-b,w=(1-F)/E+.5*F,Q=U*w,z=Math.log(-Q*(1-b)+1)/Math.log(b),q=Math.floor(z),p=q+1,S=(1-Math.pow(b,q))/(E*w),R=.5*(S+(1-Math.pow(b,p))/(E*w)),n=U-R,a=R-S;return-Math.pow(1/b,X-q)/(a*a)*(n-a)*(n+a)}}class q extends E{easeInCore(U){return U*U*U}}class p extends E{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=U,this.springiness=X}easeInCore(U){let X;const b=Math.max(0,this.oscillations),F=Math.max(0,this.springiness);return X=0==F?U:(Math.exp(F*U)-1)/(Math.exp(F)-1),X*Math.sin((6.283185307179586*b+1.5707963267948966)*U)}}class S extends E{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=U}easeInCore(U){return this.exponent<=0?U:(Math.exp(this.exponent*U)-1)/(Math.exp(this.exponent)-1)}}class R extends E{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=U,this.y1=X,this.x2=b,this.y2=F}easeInCore(U){return F.e.Interpolate(U,this.x1,this.y1,this.x2,this.y2)}}},13199:(U,X,b)=>{"use strict";b.d(X,{e:()=>Q});var F=b(11593),E=b(11600),w=b(12034);class Q extends w.c{get _matrix(){return this._compose(),this.kn}set _matrix(U){(U.updateFlag!==this.kn.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.kn.q(U),this._markAsDirtyAndDecompose())}constructor(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(U,X.fU(),!1),this.name=U,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=X,this.kn=(null===E||void 0===E?void 0:E.clone())??F.Matrix.Identity(),this._restMatrix=w??this.kn.clone(),this._bindMatrix=Q??this.kn.clone(),this._index=z,this._absoluteMatrix=new F.Matrix,this._absoluteBindMatrix=new F.Matrix,this._absoluteInverseBindMatrix=new F.Matrix,this._finalMatrix=new F.Matrix,X.bones.push(this),this.setParent(b,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(U){this.setParent(U)}setParent(U){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==U){if(this.parent){const U=this.parent.children.indexOf(this);-1!==U&&this.parent.children.splice(U,1)}this._parentNode=U,this.parent&&this.parent.children.push(this),X&&this._updateAbsoluteBindMatrices(),this.Cp()}}getLocalMatrix(){return this._compose(),this.kn}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(U){this._restMatrix.q(U)}setRestPose(U){this.setRestMatrix(U)}getBindPose(){return this.getBindMatrix()}setBindMatrix(U){this.Ib(U)}setBindPose(U){this.setBindMatrix(U)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const U=F.TmpVectors.JX[0],X=F.TmpVectors.Quaternion[0],b=F.TmpVectors.JX[1];this.getRestMatrix().decompose(U,X,b),this._linkedTransformNode.position.q(b),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??F.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.q(X),this._linkedTransformNode.fb.q(U)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(U){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=U,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Fq}set position(U){this._decompose(),this.Fq.q(U),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(U){this.setRotation(U)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(U){this.setRotationQuaternion(U)}get fb(){return this.getScale()}set fb(U){this.setScale(U)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=F.JX.Zero(),this._localRotation=F.Quaternion.Zero(),this.Fq=F.JX.Zero()),this.kn.decompose(this._localScaling,this._localRotation,this.Fq))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,F.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Fq,this.kn)):this._needToCompose=!1)}Ib(U){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.q(U),X&&this._updateAbsoluteBindMatrices(),b?this._matrix=U:this.Cp()}_updateAbsoluteBindMatrices(U){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(U||(U=this._bindMatrix),this.parent?U.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.q(U),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),X)for(let b=0;b<this.children.length;b++)this.children[b]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Cp(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Cp(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Cp(),this._needToDecompose=!0}_updatePosition(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0,E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=this.getLocalMatrix();if(0==X)E?(w.addAtIndex(12,U.x),w.addAtIndex(13,U.y),w.addAtIndex(14,U.z)):w.setTranslationFromFloats(U.x,U.y,U.z);else{let X=null;b&&(X=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=Q._TmpMats[0],q=Q._TmpVecs[0];this.parent?b&&X?(z.q(this.parent.getAbsoluteMatrix()),z.multiplyToRef(X,z)):z.q(this.parent.getAbsoluteMatrix()):F.Matrix.IdentityToRef(z),E&&z.setTranslationFromFloats(0,0,0),z.invert(),F.JX.TransformCoordinatesToRef(U,z,q),E?(w.addAtIndex(12,q.x),w.addAtIndex(13,q.y),w.addAtIndex(14,q.z)):w.setTranslationFromFloats(q.x,q.y,q.z)}this._markAsDirtyAndDecompose()}translate(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(U,X,b,!0)}setPosition(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(U,X,b,!1)}setAbsolutePosition(U,X){this.setPosition(U,1,X)}scale(U,X,b){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const w=this.getLocalMatrix(),z=Q._TmpMats[0];F.Matrix.ScalingToRef(U,X,b,z),z.multiplyToRef(w,w),z.invert();for(const F of this.children){const E=F.getLocalMatrix();E.multiplyToRef(z,E),E.multiplyAtIndex(12,U),E.multiplyAtIndex(13,X),E.multiplyAtIndex(14,b),F._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),E)for(const F of this.children)F.scale(U,X,b,E)}setScale(U){this._decompose(),this._localScaling.q(U),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(U){this._decompose(),U.q(this._localScaling)}setYawPitchRoll(U,X,b){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=arguments.length>4?arguments[4]:void 0;if(0===E){const z=Q._TmpQuat;return F.Quaternion.RotationYawPitchRollToRef(U,X,b,z),void this.setRotationQuaternion(z,E,w)}const z=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,w))return;const q=Q._TmpMats[1];F.Matrix.RotationYawPitchRollToRef(U,X,b,q),z.multiplyToRef(q,q),this._rotateWithMatrix(q,E,w)}rotate(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;const w=Q._TmpMats[0];w.setTranslationFromFloats(0,0,0),F.Matrix.RotationAxisToRef(U,X,w),this._rotateWithMatrix(w,b,E)}setAxisAngle(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;if(0===b){const w=Q._TmpQuat;return F.Quaternion.RotationAxisToRef(U,X,w),void this.setRotationQuaternion(w,b,E)}const w=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,E))return;const z=Q._TmpMats[1];F.Matrix.RotationAxisToRef(U,X,z),w.multiplyToRef(z,z),this._rotateWithMatrix(z,b,E)}setRotation(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(U.y,U.x,U.z,X,b)}setRotationQuaternion(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===X)return this._decompose(),this._localRotation.q(U),void this._markAsDirtyAndCompose();const E=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,b))return;const w=Q._TmpMats[1];F.Matrix.FromQuaternionToRef(U,w),E.multiplyToRef(w,w),this._rotateWithMatrix(w,X,b)}setRotationMatrix(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===X){const E=Q._TmpQuat;return F.Quaternion.FromRotationMatrixToRef(U,E),void this.setRotationQuaternion(E,X,b)}const E=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,b))return;const w=Q._TmpMats[1];w.q(U),E.multiplyToRef(U,w),this._rotateWithMatrix(w,X,b)}_rotateWithMatrix(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const F=this.getLocalMatrix(),E=F.m[12],w=F.m[13],z=F.m[14],q=this.getParent(),p=Q._TmpMats[3],S=Q._TmpMats[4];q&&1==X?(b?(p.q(b.getWorldMatrix()),q.getAbsoluteMatrix().multiplyToRef(p,p)):p.q(q.getAbsoluteMatrix()),S.q(p),S.invert(),F.multiplyToRef(p,F),F.multiplyToRef(U,F),F.multiplyToRef(S,F)):1==X&&b?(p.q(b.getWorldMatrix()),S.q(p),S.invert(),F.multiplyToRef(p,F),F.multiplyToRef(U,F),F.multiplyToRef(S,F)):F.multiplyToRef(U,F),F.setTranslationFromFloats(E,w,z),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(U,X){const b=Q._TmpMats[2];return U.q(this.getAbsoluteMatrix()),X?(U.multiplyToRef(X.getWorldMatrix(),U),F.Matrix.ScalingToRef(X.fb.x,X.fb.y,X.fb.z,b)):F.Matrix.IdentityToRef(b),U.invert(),!isNaN(U.m[0])&&(b.multiplyAtIndex(0,this._scalingDeterminant),U.multiplyToRef(b,U),!0)}Xb(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=F.JX.Zero();return this.getPositionToRef(U,X,b),b}getPositionToRef(){let U=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const U=this.getLocalMatrix();X.x=U.m[12],X.y=U.m[13],X.z=U.m[14]}else{let b=null;U&&(b=U.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let F=Q._TmpMats[0];U&&b?(F.q(this.getAbsoluteMatrix()),F.multiplyToRef(b,F)):F=this.getAbsoluteMatrix(),X.x=F.m[12],X.y=F.m[13],X.z=F.m[14]}}getAbsolutePosition(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=F.JX.Zero();return this.getPositionToRef(1,U,X),X}getAbsolutePositionToRef(U,X){this.getPositionToRef(1,U,X)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.kn.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.q(this.kn);const U=this._skeleton.getPoseMatrix();U&&this._absoluteMatrix.multiplyToRef(U,this._absoluteMatrix)}const U=this.children,X=U.length;for(let b=0;b<X;b++)U[b].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Aq(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=F.JX.Zero();return this.getDirectionToRef(U,X,b),b}getDirectionToRef(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,E=null;X&&(E=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=Q._TmpMats[0];w.q(this.getAbsoluteMatrix()),X&&E&&w.multiplyToRef(E,w),F.JX.TransformNormalToRef(U,w,b),b.normalize()}getRotation(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=F.JX.Zero();return this.getRotationToRef(U,X,b),b}getRotationToRef(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const F=Q._TmpQuat;this.getRotationQuaternionToRef(U,X,F),F.toEulerAnglesToRef(b)}getRotationQuaternion(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=F.Quaternion.Identity();return this.getRotationQuaternionToRef(U,X,b),b}getRotationQuaternionToRef(){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),X.q(this._localRotation);else{const b=Q._TmpMats[0],F=this.getAbsoluteMatrix();U?F.multiplyToRef(U.getWorldMatrix(),b):b.q(F),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.decompose(void 0,X,void 0)}}getRotationMatrix(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1?arguments[1]:void 0;const b=F.Matrix.Identity();return this.getRotationMatrixToRef(U,X,b),b}getRotationMatrixToRef(){let U=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(X);else{const b=Q._TmpMats[0],F=this.getAbsoluteMatrix();U?F.multiplyToRef(U.getWorldMatrix(),b):b.q(F),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.getRotationMatrixToRef(X)}}getAbsolutePositionFromLocal(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=F.JX.Zero();return this.getAbsolutePositionFromLocalToRef(U,X,b),b}getAbsolutePositionFromLocalToRef(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,E=null;X&&(E=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=Q._TmpMats[0];w.q(this.getAbsoluteMatrix()),X&&E&&w.multiplyToRef(E,w),F.JX.TransformCoordinatesToRef(U,w,b)}getLocalPositionFromAbsolute(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=F.JX.Zero();return this.getLocalPositionFromAbsoluteToRef(U,X,b),b}getLocalPositionFromAbsoluteToRef(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,E=null;X&&(E=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=Q._TmpMats[0];w.q(this.getAbsoluteMatrix()),X&&E&&w.multiplyToRef(E,w),w.invert(),F.JX.TransformCoordinatesToRef(U,w,b)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const U=this._skeleton.bones.indexOf(this);if(-1!==U&&this._skeleton.bones.splice(U,1),this._parentNode&&this._parentNode.children){const U=this._parentNode.children,X=U.indexOf(this);-1!==X&&U.splice(X,1)}super.dispose()}}Q._TmpVecs=(0,E.e)(2,F.JX.Zero),Q._TmpQuat=F.Quaternion.Identity(),Q._TmpMats=(0,E.e)(5,F.Matrix.Identity)},13768:(U,X,b)=>{"use strict";b.d(X,{b:()=>h});var F=b(11576),E=b(11583),w=b(11392),Q=b(11593),z=b(11608),q=b(12034),p=b(12067),S=b(11881),R=b(11421),n=b(11597);class a{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(U){this._zoomStopsAnimation=U}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(U){this._idleRotationSpeed=U}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(U){this._idleRotationWaitTime=U}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(U){this._idleRotationSpinupTime=U}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(U){this._attachedCamera=U;const X=this._attachedCamera.fU();this._onPrePointerObservableObserver=X.onPrePointerObservable.add((U=>{U.type!==S.b.POINTERDOWN?U.type===S.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const U=R.e.Now;let X=0;null!=this._lastFrameTime&&(X=U-this._lastFrameTime),this._lastFrameTime=U,this._applyUserInteraction();const b=U-this._lastInteractionTime-this._idleRotationWaitTime,F=Math.max(Math.min(b/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*F,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(X/1e3))}))}detach(){if(!this._attachedCamera)return;const U=this._attachedCamera.fU();this._onPrePointerObservableObserver&&U.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(U){this._lastInteractionTime=U??R.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<n.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let U=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(U=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?U:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=R.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var J=b(13777),m=b(12142);class x{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(U){if(this._autoTransitionRange===U)return;this._autoTransitionRange=U;const X=this._attachedCamera;X&&(U?this._onMeshTargetChangedObserver=X.onMeshTargetChangedObservable.add((U=>{if(U&&(U.Ob(!0),U.getBoundingInfo)){const X=U.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*X,this.upperRadiusTransitionRange=.05*X}})):this._onMeshTargetChangedObserver&&X.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(U){this._attachedCamera=U,this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(U){return!!this._attachedCamera&&(this._attachedCamera.radius===U&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(U){if(!this._attachedCamera)return;this._radiusBounceTransition||(x.EasingFunction.setEasingMode(x.EasingMode),this._radiusBounceTransition=m.e.CreateAnimation("radius",m.e.ANIMATIONTYPE_FLOAT,60,x.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const X=m.e.TransitionTo("radius",this._attachedCamera.radius+U,this._attachedCamera,this._attachedCamera.fU(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));X&&this._animatables.push(X)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}x.EasingFunction=new J.e(.3),x.EasingMode=J.q.EASINGMODE_EASEOUT;class I{constructor(){this.onTargetFramingAnimationEndObservable=new w.e,this._mode=I.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(U){this._mode=U}get mode(){return this._mode}set radiusScale(U){this._radiusScale=U}get radiusScale(){return this._radiusScale}set positionScale(U){this._positionScale=U}get positionScale(){return this._positionScale}set defaultElevation(U){this._defaultElevation=U}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(U){this._elevationReturnTime=U}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(U){this._elevationReturnWaitTime=U}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(U){this._zoomStopsAnimation=U}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(U){this._framingTime=U}get framingTime(){return this._framingTime}init(){}attach(U){this._attachedCamera=U;const X=this._attachedCamera.fU();I.EasingFunction.setEasingMode(I.EasingMode),this._onPrePointerObservableObserver=X.onPrePointerObservable.add((U=>{U.type!==S.b.POINTERDOWN?U.type===S.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=U.onMeshTargetChangedObservable.add((U=>{U&&U.getBoundingInfo&&this.zoomOnMesh(U,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=U.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const U=this._attachedCamera.fU();this._onPrePointerObservableObserver&&U.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U.Ob(!0);const F=U.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(F.minimumWorld,F.maximumWorld,X,b)}zoomOnMeshHierarchy(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U.Ob(!0);const F=U.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(F.min,F.max,X,b)}zoomOnMeshesHierarchy(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new Q.JX(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new Q.JX(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let w=0;w<U.length;w++){const X=U[w].getHierarchyBoundingVectors(!0);Q.JX.CheckExtends(X.min,F,E),Q.JX.CheckExtends(X.max,F,E)}this.zoomOnBoundingInfo(F,E,X,b)}zoomOnBoundingInfo(U,X){let b,F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const w=U.y,z=w+(X.y-w)*this._positionScale,q=X.mX(U).scale(.5);if(!isFinite(z))return!1;if(F)b=new Q.JX(0,z,0);else{const X=U.add(q);b=new Q.JX(X.x,z,X.z)}this._vectorTransition||(this._vectorTransition=m.e.CreateAnimation("target",m.e.ANIMATIONTYPE_VECTOR3,60,I.EasingFunction)),this._betaIsAnimating=!0;let p=m.e.TransitionTo("target",b,this._attachedCamera,this._attachedCamera.fU(),60,this._vectorTransition,this._framingTime);p&&this._animatables.push(p);let S=0;if(this._mode===I.FitFrustumSidesMode){const b=this._calculateLowerRadiusFromModelBoundingSphere(U,X);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=q.length()+this._attachedCamera.xb),S=b}else this._mode===I.IgnoreBoundsSizeMode&&(S=this._calculateLowerRadiusFromModelBoundingSphere(U,X),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.xb));if(this.autoCorrectCameraLimitsAndSensibility){const b=X.mX(U).length();this._attachedCamera.panningSensibility=5e3/b,this._attachedCamera.wheelPrecision=100/S}return this._radiusTransition||(this._radiusTransition=m.e.CreateAnimation("radius",m.e.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),p=m.e.TransitionTo("radius",S,this._attachedCamera,this._attachedCamera.fU(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),E&&E(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),p&&this._animatables.push(p),!0}_calculateLowerRadiusFromModelBoundingSphere(U,X){const b=this._attachedCamera;if(!b)return 0;let F=b._calculateLowerRadiusFromModelBoundingSphere(U,X,this._radiusScale);return b.lowerRadiusLimit&&this._mode===I.IgnoreBoundsSizeMode&&(F=F<b.lowerRadiusLimit?b.lowerRadiusLimit:F),b.upperRadiusLimit&&(F=F>b.upperRadiusLimit?b.upperRadiusLimit:F),F}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const U=R.e.Now-this._lastInteractionTime,X=.5*Math.PI-this._defaultElevation,b=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>b&&U>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=m.e.CreateAnimation("beta",m.e.ANIMATIONTYPE_FLOAT,60,I.EasingFunction));const U=m.e.TransitionTo("beta",X,this._attachedCamera,this._attachedCamera.fU(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));U&&this._animatables.push(U)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=R.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}I.EasingFunction=new J.w,I.EasingMode=J.q.EASINGMODE_EASEINOUT,I.IgnoreBoundsSizeMode=0,I.FitFrustumSidesMode=1;var O=b(12075),N=b(12111),u=b(13197),i=b(11385);class P{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(U){U=i.Tools.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),b=X.getInputElement();let F=0,E=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=w=>{var Q,z;const q=w.event,p="touch"===q.pointerType;if(w.type!==S.b.POINTERMOVE&&-1===this.buttons.indexOf(q.button))return;const R=q.target;if(this._altKey=q.altKey,this._ctrlKey=q.ctrlKey,this._metaKey=q.metaKey,this._shiftKey=q.shiftKey,this._buttonsPressed=q.buttons,X.isPointerLock){const U=q.movementX,X=q.movementY;this.onTouch(null,U,X),this._pointA=null,this._pointB=null}else{if(w.type!==S.b.POINTERDOWN&&w.type!==S.b.POINTERDOUBLETAP&&p&&(null===(Q=this._pointA)||void 0===Q?void 0:Q.pointerId)!==q.pointerId&&(null===(z=this._pointB)||void 0===z?void 0:z.pointerId)!==q.pointerId)return;if(w.type!==S.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!p)if(w.type===S.b.POINTERDOUBLETAP)this.onDoubleTap(q.pointerType);else if(w.type!==S.b.POINTERUP||this._currentMousePointerIdDown!==q.pointerId&&!p){if(w.type===S.b.POINTERMOVE)if(U||q.preventDefault(),this._pointA&&null===this._pointB){const U=q.clientX-this._pointA.x,X=q.clientY-this._pointA.y;this._pointA.x=q.clientX,this._pointA.y=q.clientY,this.onTouch(this._pointA,U,X)}else if(this._pointA&&this._pointB){const U=this._pointA.pointerId===q.pointerId?this._pointA:this._pointB;U.x=q.clientX,U.y=q.clientY;const X=this._pointA.x-this._pointB.x,b=this._pointA.y-this._pointB.y,Q=X*X+b*b,z={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:q.pointerId,type:w.type};this.onMultiTouch(this._pointA,this._pointB,F,Q,E,z),E=z,F=Q}}else{try{null===R||void 0===R||R.releasePointerCapture(q.pointerId)}catch(n){}p||(this._pointB=null),X._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==q.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==q.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==F||E)&&(this.onMultiTouch(this._pointA,this._pointB,F,0,E,null),F=0,E=null),this._currentMousePointerIdDown=-1,this.onButtonUp(q),U||q.preventDefault()}else{try{null===R||void 0===R||R.setPointerCapture(q.pointerId)}catch(n){}if(null===this._pointA)this._pointA={x:q.clientX,y:q.clientY,pointerId:q.pointerId,type:q.pointerType};else{if(null!==this._pointB)return;this._pointB={x:q.clientX,y:q.clientY,pointerId:q.pointerId,type:q.pointerType}}-1!==this._currentMousePointerIdDown||p||(this._currentMousePointerIdDown=q.pointerId),this.onButtonDown(q),U||(q.preventDefault(),b&&b.focus())}}},this._observer=this.camera.fU()._inputManager._addCameraPointerObserver(this._pointerInput,S.b.POINTERDOWN|S.b.POINTERUP|S.b.POINTERMOVE|S.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,F=0,E=null,this.onLostFocus()},this._contextMenuBind=U=>this.onContextMenu(U),b&&b.addEventListener("contextmenu",this._contextMenuBind,!1);const w=this.camera.fU().getEngine().getHostWindow();w&&i.Tools.RegisterTopRootEvents(w,[{name:"blur",handler:this._onLostFocus}])}YR(){if(this._onLostFocus){const U=this.camera.fU().getEngine().getHostWindow();U&&i.Tools.UnregisterTopRootEvents(U,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.fU()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const U=this.camera.fU().getEngine().getInputElement();U&&U.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(U){}onTouch(U,X,b){}onMultiTouch(U,X,b,F,E,w){}onContextMenu(U){U.preventDefault()}onButtonDown(U){}onButtonUp(U){}onLostFocus(){}}(0,F.c)([(0,E.J)()],P.prototype,"buttons",void 0);class f extends P{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(U,X){if(0!==this.panningSensibility&&U&&X){const b=X.x-U.x,F=X.y-U.y;this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=F/this.panningSensibility}}_computePinchZoom(U,X){const b=this.camera.radius||f.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=b*Math.sqrt(U)/Math.sqrt(X):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(X-U)*b*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(X-U)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(U,X,b){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-X/this.panningSensibility,this.camera.inertialPanningY+=b/this.panningSensibility):(this.camera.inertialAlphaOffset-=X/this.angularSensibilityX,this.camera.inertialBetaOffset-=b/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(U,X,b,F,E,w){0===b&&null===E||0===F&&null===w||(this.multiTouchPanAndZoom?(this._computePinchZoom(b,F),this._computeMultiTouchPanning(E,w)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(F)-Math.sqrt(b))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(b,F),this._isPinching=!0):this._computeMultiTouchPanning(E,w)):this.multiTouchPanning?this._computeMultiTouchPanning(E,w):this.pinchZoom&&this._computePinchZoom(b,F))}onButtonDown(U){this._isPanClick=U.button===this.camera._panningMouseButton}onButtonUp(U){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}f.MinimumRadiusForPinch=.001,(0,F.c)([(0,E.J)()],f.prototype,"buttons",void 0),(0,F.c)([(0,E.J)()],f.prototype,"angularSensibilityX",void 0),(0,F.c)([(0,E.J)()],f.prototype,"angularSensibilityY",void 0),(0,F.c)([(0,E.J)()],f.prototype,"pinchPrecision",void 0),(0,F.c)([(0,E.J)()],f.prototype,"pinchDeltaPercentage",void 0),(0,F.c)([(0,E.J)()],f.prototype,"useNaturalPinchZoom",void 0),(0,F.c)([(0,E.J)()],f.prototype,"pinchZoom",void 0),(0,F.c)([(0,E.J)()],f.prototype,"panningSensibility",void 0),(0,F.c)([(0,E.J)()],f.prototype,"multiTouchPanning",void 0),(0,F.c)([(0,E.J)()],f.prototype,"multiTouchPanAndZoom",void 0),u.e.ArcRotateCameraPointersInput=f;var j=b(11883);class e{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(U){U=i.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.fU(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const b=X.event;if(!b.metaKey)if(X.type===j.b.KEYDOWN){if(this._ctrlPressed=b.ctrlKey,this._altPressed=b.altKey,-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),b.preventDefault&&(U||b.preventDefault())}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){const X=this._keys.indexOf(b.keyCode);X>=0&&this._keys.splice(X,1),b.preventDefault&&(U||b.preventDefault())}})))}YR(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const U=this.camera;for(let X=0;X<this._keys.length;X++){const b=this._keys[X];-1!==this.keysLeft.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningX-=1/this.panningSensibility:U.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?U.inertialRadiusOffset+=1/this.zoomingSensibility:U.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningX+=1/this.panningSensibility:U.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?U.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?U.inertialRadiusOffset-=1/this.zoomingSensibility:U.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(b)&&U.useInputToRestoreState&&U.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,F.c)([(0,E.J)()],e.prototype,"keysUp",void 0),(0,F.c)([(0,E.J)()],e.prototype,"keysDown",void 0),(0,F.c)([(0,E.J)()],e.prototype,"keysLeft",void 0),(0,F.c)([(0,E.J)()],e.prototype,"keysRight",void 0),(0,F.c)([(0,E.J)()],e.prototype,"keysReset",void 0),(0,F.c)([(0,E.J)()],e.prototype,"panningSensibility",void 0),(0,F.c)([(0,E.J)()],e.prototype,"zoomingSensibility",void 0),(0,F.c)([(0,E.J)()],e.prototype,"useAltToZoom",void 0),(0,F.c)([(0,E.J)()],e.prototype,"angularSpeed",void 0),u.e.ArcRotateCameraKeyboardMoveInput=e;var l=b(11644),d=b(11892);class k{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Q.JX(0,0,0),this._globalOffset=new Q.JX(0,0,0),this._inertialPanning=Q.JX.Zero()}_computeDeltaFromMouseWheelLegacyEvent(U,X){let b=0;const F=.01*U*this.wheelDeltaPercentage*X;return b=U>0?F/(1+this.wheelDeltaPercentage):F*(1+this.wheelDeltaPercentage),b}attachControl(U){U=i.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==S.b.POINTERWHEEL)return;const b=X.event;let F=0;const E=b.deltaMode===d.c.DOM_DELTA_LINE?40:1,w=-b.deltaY*E;if(this.customComputeDeltaFromMouseWheel)F=this.customComputeDeltaFromMouseWheel(w,this,b);else if(this.wheelDeltaPercentage){if(F=this._computeDeltaFromMouseWheelLegacyEvent(w,this.camera.radius),F>0){let U=this.camera.radius,X=this.camera.inertialRadiusOffset+F;for(let b=0;b<20&&!(U<=X)&&!(Math.abs(X*this.camera.inertia)<.001);b++)U-=X,X*=this.camera.inertia;U=(0,z.Clamp)(U,0,Number.MAX_VALUE),F=this._computeDeltaFromMouseWheelLegacyEvent(w,U)}}else F=w/(40*this.wheelPrecision);F&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(F)):this.camera.inertialRadiusOffset+=F),b.preventDefault&&(U||b.preventDefault())},this._observer=this.camera.fU()._inputManager._addCameraPointerObserver(this._wheel,S.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.jb(0)}YR(){this._observer&&(this.camera.fU()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const U=this.camera;0+U.inertialAlphaOffset+U.inertialBetaOffset+U.inertialRadiusOffset&&(this._updateHitPlane(),U.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(U.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const U=this.camera,X=U.target.mX(U.position);this._hitPlane=l.c.FromPositionAndNormal(U.target,X)}_getPosition(){const U=this.camera,X=U.fU(),b=X.createPickingRay(X.pointerX,X.pointerY,Q.Matrix.Identity(),U,!1);0===U.targetScreenOffset.x&&0===U.targetScreenOffset.y||(this._viewOffset.set(U.targetScreenOffset.x,U.targetScreenOffset.y,0),U.getViewMatrix().invertToRef(U._cameraTransformMatrix),this._globalOffset=Q.JX.TransformNormal(this._viewOffset,U._cameraTransformMatrix),b.origin.addInPlace(this._globalOffset));let F=0;return this._hitPlane&&(F=b.intersectsPlane(this._hitPlane)??0),b.origin.addInPlace(b.direction.scaleInPlace(F))}_zoomToMouse(U){const X=this.camera,b=1-X.inertia;if(X.lowerRadiusLimit){const F=X.lowerRadiusLimit??0;X.radius-(X.inertialRadiusOffset+U)/b<F&&(U=(X.radius-F)*b-X.inertialRadiusOffset)}if(X.upperRadiusLimit){const F=X.upperRadiusLimit??0;X.radius-(X.inertialRadiusOffset+U)/b>F&&(U=(X.radius-F)*b-X.inertialRadiusOffset)}const F=U/b/X.radius,E=this._getPosition(),w=Q.TmpVectors.JX[6];E.subtractToRef(X.target,w),w.scaleInPlace(F),w.scaleInPlace(b),this._inertialPanning.addInPlace(w),X.inertialRadiusOffset+=U}_zeroIfClose(U){Math.abs(U.x)<n.d&&(U.x=0),Math.abs(U.y)<n.d&&(U.y=0),Math.abs(U.z)<n.d&&(U.z=0)}}(0,F.c)([(0,E.J)()],k.prototype,"wheelPrecision",void 0),(0,F.c)([(0,E.J)()],k.prototype,"zoomToMouseLocation",void 0),(0,F.c)([(0,E.J)()],k.prototype,"wheelDeltaPercentage",void 0),u.e.ArcRotateCameraMouseWheelInput=k;class v extends u.f{constructor(U){super(U)}addMouseWheel(){return this.add(new k),this}addPointers(){return this.add(new f),this}addKeyboard(){return this.add(new e),this}}var A=b(11551);function s(U,X){return isNaN(U)?X:U}q.c.AddNodeConstructor("ArcRotateCamera",((U,X)=>()=>new h(U,0,0,1,Q.JX.Zero(),X)));class h extends N.e{get target(){return this._target}set target(U){this.setTarget(U)}get targetHost(){return this._targetHost}set targetHost(U){U&&this.setTarget(U)}getTarget(){return this.target}get position(){return this._position}set position(U){this.setPosition(U)}set upVector(U){this._upToYMatrix||(this._yToUpMatrix=new Q.Matrix,this._upToYMatrix=new Q.Matrix,this._upVector=Q.JX.Zero()),U.normalize(),this._upVector.q(U),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Q.Matrix.RotationAlignToRef(Q.JX.UpReadOnly,this._upVector,this._yToUpMatrix),Q.Matrix.RotationAlignToRef(this._upVector,Q.JX.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const U=this.inputs.attached.pointers;return U?U.angularSensibilityX:0}set angularSensibilityX(U){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityX=U)}get angularSensibilityY(){const U=this.inputs.attached.pointers;return U?U.angularSensibilityY:0}set angularSensibilityY(U){const X=this.inputs.attached.pointers;X&&(X.angularSensibilityY=U)}get pinchPrecision(){const U=this.inputs.attached.pointers;return U?U.pinchPrecision:0}set pinchPrecision(U){const X=this.inputs.attached.pointers;X&&(X.pinchPrecision=U)}get pinchDeltaPercentage(){const U=this.inputs.attached.pointers;return U?U.pinchDeltaPercentage:0}set pinchDeltaPercentage(U){const X=this.inputs.attached.pointers;X&&(X.pinchDeltaPercentage=U)}get useNaturalPinchZoom(){const U=this.inputs.attached.pointers;return!!U&&U.useNaturalPinchZoom}set useNaturalPinchZoom(U){const X=this.inputs.attached.pointers;X&&(X.useNaturalPinchZoom=U)}get panningSensibility(){const U=this.inputs.attached.pointers;return U?U.panningSensibility:0}set panningSensibility(U){const X=this.inputs.attached.pointers;X&&(X.panningSensibility=U)}get keysUp(){const U=this.inputs.attached.keyboard;return U?U.keysUp:[]}set keysUp(U){const X=this.inputs.attached.keyboard;X&&(X.keysUp=U)}get keysDown(){const U=this.inputs.attached.keyboard;return U?U.keysDown:[]}set keysDown(U){const X=this.inputs.attached.keyboard;X&&(X.keysDown=U)}get keysLeft(){const U=this.inputs.attached.keyboard;return U?U.keysLeft:[]}set keysLeft(U){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=U)}get keysRight(){const U=this.inputs.attached.keyboard;return U?U.keysRight:[]}set keysRight(U){const X=this.inputs.attached.keyboard;X&&(X.keysRight=U)}get wheelPrecision(){const U=this.inputs.attached.mousewheel;return U?U.wheelPrecision:0}set wheelPrecision(U){const X=this.inputs.attached.mousewheel;X&&(X.wheelPrecision=U)}get zoomToMouseLocation(){const U=this.inputs.attached.mousewheel;return!!U&&U.zoomToMouseLocation}set zoomToMouseLocation(U){const X=this.inputs.attached.mousewheel;X&&(X.zoomToMouseLocation=U)}get wheelDeltaPercentage(){const U=this.inputs.attached.mousewheel;return U?U.wheelDeltaPercentage:0}set wheelDeltaPercentage(U){const X=this.inputs.attached.mousewheel;X&&(X.wheelDeltaPercentage=U)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(U){U!==this.useBouncingBehavior&&(U?(this._bouncingBehavior=new x,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(U){U!==this.useFramingBehavior&&(U?(this._framingBehavior=new I,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(U){U!==this.useAutoRotationBehavior&&(U?(this._autoRotationBehavior=new a,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(U,X,b,F,E,z){var q;let p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(U,Q.JX.Zero(),z,p),q=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Q.JX.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Q.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Q.Matrix,this.panningAxis=new Q.JX(1,1,0),this._transformedDirection=new Q.JX,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new w.e,this.checkCollisions=!1,this.collisionRadius=new Q.JX(.5,.5,.5),this._previousPosition=Q.JX.Zero(),this._collisionVelocity=Q.JX.Zero(),this._newPosition=Q.JX.Zero(),this._computationVector=Q.JX.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Q.JX(NaN,NaN,NaN),this._goalTargetScreenOffset=new Q.Vector2(NaN,NaN),this._onCollisionPositionChange=function(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b?(q.setPosition(X),q.fa&&q.fa(b)):q._previousPosition.q(q._position);const F=Math.cos(q.alpha),E=Math.sin(q.alpha),w=Math.cos(q.beta);let Q=Math.sin(q.beta);0===Q&&(Q=1e-4);const z=q._getTargetPosition();q._computationVector.Pb(q.radius*F*Q,q.radius*w,q.radius*E*Q),z.addToRef(q._computationVector,q._newPosition),q._position.q(q._newPosition);let p=q.upVector;q.allowUpsideDown&&q.beta<0&&(p=p.clone(),p=p.negate()),q._computeViewMatrix(q._position,z,p),q._viewMatrix.addAtIndex(12,q.targetScreenOffset.x),q._viewMatrix.addAtIndex(13,q.targetScreenOffset.y),q._collisionTriggered=!1},this._target=Q.JX.Zero(),E&&this.setTarget(E),this.alpha=X,this.beta=b,this.radius=F,this.getViewMatrix(),this.inputs=new v(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Q.JX(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Q.Vector2.Zero()}_updateCache(U){U||super._updateCache(),this._cache._target.q(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.q(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const U=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?U.addToRef(this._targetBoundingCenter,this._target):this._target.q(U)}const U=this._getLockedTargetPosition();return U||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>n.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,w=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=w?this._currentInterpolationFactor=w:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=s(U,this._goalAlpha),this._goalBeta=s(X,this._goalBeta),this._goalRadius=s(b,this._goalRadius),this._goalTarget.set(s(F.x,this._goalTarget.x),s(F.y,this._goalTarget.y),s(F.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(s(E.x,this._goalTargetScreenOffset.x),s(E.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,z.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,z.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,z.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,z.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(U,X){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const E=arguments;X=i.Tools.BackCompatCameraNoPreventDefault(E),this._useCtrlForPanning=b,this._panningMouseButton=F,"boolean"===typeof E[0]&&(E.length>1&&(this._useCtrlForPanning=E[1]),E.length>2&&(this._panningMouseButton=E[2])),this.inputs.attachElement(X),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}YR(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let U=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){U=!0;const X=this.invertRotation?-1:1,b=this._calculateHandednessMultiplier();let F=this.inertialAlphaOffset*b;this.beta<0&&(F*=-1),this.alpha+=F*X,this.beta+=this.inertialBetaOffset*X,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<n.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<n.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*n.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){U=!0;const X=new Q.JX(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),X.multiplyInPlace(this.panningAxis),Q.JX.TransformNormalToRef(X,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const U=this.upVector,X=Q.JX.CrossToRef(this._transformedDirection,U,this._transformedDirection);Q.JX.CrossToRef(U,X,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Q.JX.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.q(this._transformedDirection)}else{if(this.parent){const U=Q.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(U),U.transposeToRef(U),Q.JX.TransformCoordinatesToRef(this._transformedDirection,U,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*n.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*n.d&&(this.inertialPanningY=0)}if(U)this.stopInterpolation();else if(this._isInterpolating){let U=!1;const X=this._scene.getEngine().getDeltaTime()/1e3,b=1-Math.pow(2,-X/this._currentInterpolationFactor),F=s(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const X=Q.TmpVectors.JX[0].set(s(this._goalTarget.x,this._target.x),s(this._goalTarget.y,this._target.y),s(this._goalTarget.z,this._target.z));Q.JX.LerpToRef(this.target,X,b,this._target),10*Q.JX.Distance(this.target,X)/F<n.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.q(X),this.setTarget(this.target,!1,!0,!0)):U=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const X=Q.Quaternion.RotationAlphaBetaGammaToRef(s(this._goalAlpha,this.alpha),s(this._goalBeta,this.beta),0,Q.TmpVectors.Quaternion[0]),F=Q.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Q.TmpVectors.Quaternion[1]),E=Q.Quaternion.SlerpToRef(F,X,b,Q.TmpVectors.Quaternion[2]);E.normalize();const w=E.toAlphaBetaGammaToRef(Q.TmpVectors.JX[0]);if(this.alpha=w.x,this.beta=w.y,E.isApprox(X,n.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const U=X.toAlphaBetaGammaToRef(Q.TmpVectors.JX[0]);this.alpha=U.x,this.beta=U.y}else U=!0}if(isNaN(this._goalRadius)||(this.radius+=(F-this.radius)*b,Math.abs(F/this.radius-1)<n.d?(this._goalRadius=NaN,this.radius=F):U=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const X=Q.TmpVectors.Vector2[0].set(s(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),s(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Q.Vector2.LerpToRef(this.targetScreenOffset,X,b,this.targetScreenOffset),Q.Vector2.Distance(this.targetScreenOffset,X)<n.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.q(X)):U=!0}this._isInterpolating=U}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Q.JX.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const U=this.alpha;var X,b;this.alpha=function(U){let X=Math.PI/2;return 0===U.x&&0===U.z||(X=Math.acos(U.x/Math.sqrt(Math.pow(U.x,2)+Math.pow(U.z,2)))),U.z<0&&(X=2*Math.PI-X),X}(this._computationVector),this.beta=(X=this._computationVector.y,b=this.radius,Math.acos(X/b));const F=Math.round((U-this.alpha)/(2*Math.PI));this.alpha+=2*F*Math.PI,this._checkLimits()}setPosition(U){this._position.equals(U)||(this._position.q(U),this.rebuildAnglesAndRadius())}setTarget(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(F=this.overrideCloneAlphaBetaRadius??F,U.Ob)X&&U.getBoundingInfo?this._targetBoundingCenter=U.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,U.Ob(),this._targetHost=U,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const X=U,F=this._getTargetPosition();if(F&&!b&&F.equals(X))return;this._targetHost=null,this._target=X,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}F||this.rebuildAnglesAndRadius()}_getViewMatrix(){const U=Math.cos(this.alpha),X=Math.sin(this.alpha),b=Math.cos(this.beta);let F=Math.sin(this.beta);0===F&&(F=1e-4),0===this.radius&&(this.radius=1e-4);const E=this._getTargetPosition();if(this._computationVector.Pb(this.radius*U*F,this.radius*b,this.radius*X*F),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Q.JX.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),E.addToRef(this._computationVector,this._newPosition),this.fU().collisionsEnabled&&this.checkCollisions){const U=this.fU().collisionCoordinator;this._collider||(this._collider=U.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,U.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.q(this._newPosition);let U=this.upVector;this.allowUpsideDown&&F<0&&(U=U.negate()),this._computeViewMatrix(this._position,E,U),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.q(E),this._viewMatrix}zoomOn(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U=U||this.fU().meshes;const b=p.e.MinMax(U);let F=this._calculateLowerRadiusFromModelBoundingSphere(b.min,b.max);if(F=Math.max(Math.min(F,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=F*this.zoomOnFactor,this.mode===O.e.ORTHOGRAPHIC_CAMERA){const U=this.fU().getEngine().getAspectRatio(this),X=F*this.zoomOnFactor/2;this.orthoLeft=-X*U,this.orthoRight=X*U,this.orthoBottom=-X,this.orthoTop=X}this.focusOn({min:b.min,max:b.max,distance:F},X)}focusOn(U){let X,b,F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===U.min){const F=U||this.fU().meshes;X=p.e.MinMax(F),b=Q.JX.Distance(X.min,X.max)}else{X=U,b=U.distance}this._target=p.e.Center(X),F||(this.maxZ=2*b)}createRigCamera(U,X){let b=0;switch(this.cameraRigMode){case O.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.e.RIG_MODE_VR:b=this._cameraRigParams.stereoHalfAngle*(0===X?1:-1);break;case O.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b=this._cameraRigParams.stereoHalfAngle*(0===X?-1:1)}const F=new h(U,this.alpha+b,this.beta,this.radius,this._target,this.fU());return F._cameraRigParams={},F.isRigCamera=!0,F.rigParent=this,F.upVector=this.upVector,F.mode=this.mode,F.orthoLeft=this.orthoLeft,F.orthoRight=this.orthoRight,F.orthoBottom=this.orthoBottom,F.orthoTop=this.orthoTop,F}_updateRigCameras(){const U=this._rigCameras[0],X=this._rigCameras[1];switch(U.beta=X.beta=this.beta,this.cameraRigMode){case O.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case O.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case O.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case O.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case O.e.RIG_MODE_VR:U.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case O.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:U.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,X.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const F=Q.JX.Distance(U,X),E=this.fU().getEngine().getAspectRatio(this),w=Math.tan(this.fov/2),z=w*E,q=.5*F*b,p=q*Math.sqrt(1+1/(z*z)),S=q*Math.sqrt(1+1/(w*w));return Math.max(p,S)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,F.c)([(0,E.J)()],h.prototype,"alpha",void 0),(0,F.c)([(0,E.J)()],h.prototype,"beta",void 0),(0,F.c)([(0,E.J)()],h.prototype,"radius",void 0),(0,F.c)([(0,E.J)()],h.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,F.c)([(0,E.F)("target")],h.prototype,"_target",void 0),(0,F.c)([(0,E.t)("targetHost")],h.prototype,"_targetHost",void 0),(0,F.c)([(0,E.J)()],h.prototype,"inertialAlphaOffset",void 0),(0,F.c)([(0,E.J)()],h.prototype,"inertialBetaOffset",void 0),(0,F.c)([(0,E.J)()],h.prototype,"inertialRadiusOffset",void 0),(0,F.c)([(0,E.J)()],h.prototype,"lowerAlphaLimit",void 0),(0,F.c)([(0,E.J)()],h.prototype,"upperAlphaLimit",void 0),(0,F.c)([(0,E.J)()],h.prototype,"lowerBetaLimit",void 0),(0,F.c)([(0,E.J)()],h.prototype,"upperBetaLimit",void 0),(0,F.c)([(0,E.J)()],h.prototype,"lowerRadiusLimit",void 0),(0,F.c)([(0,E.J)()],h.prototype,"upperRadiusLimit",void 0),(0,F.c)([(0,E.J)()],h.prototype,"lowerTargetYLimit",void 0),(0,F.c)([(0,E.J)()],h.prototype,"inertialPanningX",void 0),(0,F.c)([(0,E.J)()],h.prototype,"inertialPanningY",void 0),(0,F.c)([(0,E.J)()],h.prototype,"pinchToPanMaxDistance",void 0),(0,F.c)([(0,E.J)()],h.prototype,"panningDistanceLimit",void 0),(0,F.c)([(0,E.F)()],h.prototype,"panningOriginTarget",void 0),(0,F.c)([(0,E.J)()],h.prototype,"panningInertia",void 0),(0,F.c)([(0,E.J)()],h.prototype,"zoomToMouseLocation",null),(0,F.c)([(0,E.J)()],h.prototype,"zoomOnFactor",void 0),(0,F.c)([(0,E.D)()],h.prototype,"targetScreenOffset",void 0),(0,F.c)([(0,E.J)()],h.prototype,"allowUpsideDown",void 0),(0,F.c)([(0,E.J)()],h.prototype,"useInputToRestoreState",void 0),(0,F.c)([(0,E.J)()],h.prototype,"restoreStateInterpolationFactor",void 0),(0,A.f)("BABYLON.ArcRotateCamera",h)},13197:(U,X,b)=>{"use strict";b.d(X,{e:()=>Q,f:()=>z});var F=b(11408),E=b(11623),w=b(12075),Q={};class z{constructor(U){this.attachedToElement=!1,this.attached={},this.camera=U,this.checkInputs=()=>{}}add(U){const X=U.getSimpleName();this.attached[X]?F.e.Warn("camera input of type "+X+" already exists on camera"):(this.attached[X]=U,U.camera=this.camera,U.checkInputs&&(this.checkInputs=this._addCheckInputs(U.checkInputs.bind(U))),this.attachedToElement&&U.attachControl(this.noPreventDefault))}remove(U){for(const X in this.attached){const b=this.attached[X];if(b===U)return b.YR(),b.camera=null,delete this.attached[X],void this.rebuildInputCheck()}}removeByType(U){for(const X in this.attached){const b=this.attached[X];b.getClassName()===U&&(b.YR(),b.camera=null,delete this.attached[X],this.rebuildInputCheck())}}_addCheckInputs(U){const X=this.checkInputs;return()=>{X(),U()}}attachInput(U){this.attachedToElement&&U.attachControl(this.noPreventDefault)}attachElement(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){U=!w.e.ForceAttachControlToAlwaysPreventDefault&&U,this.attachedToElement=!0,this.noPreventDefault=U;for(const X in this.attached)this.attached[X].attachControl(U)}}detachElement(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const X in this.attached)this.attached[X].YR(),U&&(this.attached[X].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const U in this.attached){const X=this.attached[U];X.checkInputs&&(this.checkInputs=this._addCheckInputs(X.checkInputs.bind(X)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(U){const X={};for(const b in this.attached){const U=this.attached[b],F=E.d.Serialize(U);X[U.getClassName()]=F}U.inputsmgr=X}parse(U){const X=U.inputsmgr;if(X){this.clear();for(const U in X){const b=Q[U];if(b){const F=X[U],w=E.d.Parse((()=>new b),F,null);this.add(w)}}}else for(const b in this.attached){const X=Q[this.attached[b].getClassName()];if(X){const F=E.d.Parse((()=>new X),U,null);this.remove(this.attached[b]),this.add(F)}}}}},13192:(U,X,b)=>{"use strict";b.d(X,{c:()=>P});var F=b(11576),E=b(11583),w=b(11593),Q=b(12111),z=b(13197),q=b(11883),p=b(11385);class S{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(U){U=p.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.fU(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((X=>{const b=X.event;if(!b.metaKey)if(X.type===q.b.KEYDOWN){if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),U||b.preventDefault()}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){const X=this._keys.indexOf(b.keyCode);X>=0&&this._keys.splice(X,1),U||b.preventDefault()}})))}YR(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const U=this.camera;for(let X=0;X<this._keys.length;X++){const b=this._keys[X],F=U._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(b)?U._localDirection.Pb(-F,0,0):-1!==this.keysUp.indexOf(b)?U._localDirection.Pb(0,0,F):-1!==this.keysRight.indexOf(b)?U._localDirection.Pb(F,0,0):-1!==this.keysDown.indexOf(b)?U._localDirection.Pb(0,0,-F):-1!==this.keysUpward.indexOf(b)?U._localDirection.Pb(0,F,0):-1!==this.keysDownward.indexOf(b)?U._localDirection.Pb(0,-F,0):-1!==this.keysRotateLeft.indexOf(b)?(U._localDirection.Pb(0,0,0),U.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(b)?(U._localDirection.Pb(0,0,0),U.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(b)?(U._localDirection.Pb(0,0,0),U.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(b)&&(U._localDirection.Pb(0,0,0),U.cameraRotation.x+=this._getLocalRotation()),U.fU().useRightHandedSystem&&(U._localDirection.z*=-1),U.getViewMatrix().invertToRef(U._cameraTransformMatrix),w.JX.TransformNormalToRef(U._localDirection,U._cameraTransformMatrix,U._transformedDirection),U.cameraDirection.addInPlace(U._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const U=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*U}}(0,F.c)([(0,E.J)()],S.prototype,"keysUp",void 0),(0,F.c)([(0,E.J)()],S.prototype,"keysUpward",void 0),(0,F.c)([(0,E.J)()],S.prototype,"keysDown",void 0),(0,F.c)([(0,E.J)()],S.prototype,"keysDownward",void 0),(0,F.c)([(0,E.J)()],S.prototype,"keysLeft",void 0),(0,F.c)([(0,E.J)()],S.prototype,"keysRight",void 0),(0,F.c)([(0,E.J)()],S.prototype,"rotationSpeed",void 0),(0,F.c)([(0,E.J)()],S.prototype,"keysRotateLeft",void 0),(0,F.c)([(0,E.J)()],S.prototype,"keysRotateRight",void 0),(0,F.c)([(0,E.J)()],S.prototype,"keysRotateUp",void 0),(0,F.c)([(0,E.J)()],S.prototype,"keysRotateDown",void 0),z.e.FreeCameraKeyboardMoveInput=S;var R=b(11392),n=b(11881);class a{constructor(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=U,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new R.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(U){U=p.Tools.BackCompatCameraNoPreventDefault(arguments);const X=this.camera.getEngine(),b=X.getInputElement();this._pointerInput||(this._pointerInput=F=>{const E=F.event,w="touch"===E.pointerType;if(!this.touchEnabled&&w)return;if(F.type!==n.b.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const Q=E.target;if(F.type===n.b.POINTERDOWN){if(w&&-1!==this._activePointerId||!w&&-1!==this._currentActiveButton)return;this._activePointerId=E.pointerId;try{null===Q||void 0===Q||Q.setPointerCapture(E.pointerId)}catch(z){}-1===this._currentActiveButton&&(this._currentActiveButton=E.button),this._previousPosition={x:E.clientX,y:E.clientY},U||(E.preventDefault(),b&&b.focus()),X.isPointerLock&&this._onMouseMove&&this._onMouseMove(F.event)}else if(F.type===n.b.POINTERUP){if(w&&this._activePointerId!==E.pointerId||!w&&this._currentActiveButton!==E.button)return;try{null===Q||void 0===Q||Q.releasePointerCapture(E.pointerId)}catch(z){}this._currentActiveButton=-1,this._previousPosition=null,U||E.preventDefault(),this._activePointerId=-1}else if(F.type===n.b.POINTERMOVE&&(this._activePointerId===E.pointerId||!w))if(X.isPointerLock&&this._onMouseMove)this._onMouseMove(F.event);else if(this._previousPosition){const X=this.camera._calculateHandednessMultiplier(),b=(E.clientX-this._previousPosition.x)*X,F=E.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=b/this.angularSensibility,this.camera.cameraRotation.x+=F/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:b,offsetY:F}),this._previousPosition={x:E.clientX,y:E.clientY},U||E.preventDefault()}}),this._onMouseMove=b=>{if(!X.isPointerLock)return;const F=this.camera._calculateHandednessMultiplier(),E=b.movementX*F;this.camera.cameraRotation.y+=E/this.angularSensibility;const w=b.movementY;this.camera.cameraRotation.x+=w/this.angularSensibility,this._previousPosition=null,U||b.preventDefault()},this._observer=this.camera.fU()._inputManager._addCameraPointerObserver(this._pointerInput,n.b.POINTERDOWN|n.b.POINTERUP|n.b.POINTERMOVE),b&&(this._contextMenuBind=U=>this.onContextMenu(U),b.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(U){U.preventDefault()}YR(){if(this._observer){if(this.camera.fU()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const U=this.camera.getEngine().getInputElement();U&&U.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,F.c)([(0,E.J)()],a.prototype,"buttons",void 0),(0,F.c)([(0,E.J)()],a.prototype,"angularSensibility",void 0),z.e.FreeCameraMouseInput=a;var J,m=b(11892);class x{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new R.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(U){U=p.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=X=>{if(X.type!==n.b.POINTERWHEEL)return;const b=X.event,F=b.deltaMode===m.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*F*b.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*F*b.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*F*b.deltaZ/this._normalize,b.preventDefault&&(U||b.preventDefault())},this._observer=this.camera.fU()._inputManager._addCameraPointerObserver(this._wheel,n.b.POINTERWHEEL)}YR(){this._observer&&(this.camera.fU()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,F.c)([(0,E.J)()],x.prototype,"wheelPrecisionX",void 0),(0,F.c)([(0,E.J)()],x.prototype,"wheelPrecisionY",void 0),(0,F.c)([(0,E.J)()],x.prototype,"wheelPrecisionZ",void 0),function(U){U[U.MoveRelative=0]="MoveRelative",U[U.RotateRelative=1]="RotateRelative",U[U.MoveScene=2]="MoveScene"}(J||(J={}));class I extends x{constructor(){super(...arguments),this._moveRelative=w.JX.Zero(),this._rotateRelative=w.JX.Zero(),this._moveScene=w.JX.Zero(),this._wheelXAction=J.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=J.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(U){null===U&&this._wheelXAction!==J.MoveRelative||(this._wheelXAction=J.MoveRelative,this._wheelXActionCoordinate=U)}get wheelXMoveRelative(){return this._wheelXAction!==J.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(U){null===U&&this._wheelYAction!==J.MoveRelative||(this._wheelYAction=J.MoveRelative,this._wheelYActionCoordinate=U)}get wheelYMoveRelative(){return this._wheelYAction!==J.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(U){null===U&&this._wheelZAction!==J.MoveRelative||(this._wheelZAction=J.MoveRelative,this._wheelZActionCoordinate=U)}get wheelZMoveRelative(){return this._wheelZAction!==J.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(U){null===U&&this._wheelXAction!==J.RotateRelative||(this._wheelXAction=J.RotateRelative,this._wheelXActionCoordinate=U)}get wheelXRotateRelative(){return this._wheelXAction!==J.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(U){null===U&&this._wheelYAction!==J.RotateRelative||(this._wheelYAction=J.RotateRelative,this._wheelYActionCoordinate=U)}get wheelYRotateRelative(){return this._wheelYAction!==J.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(U){null===U&&this._wheelZAction!==J.RotateRelative||(this._wheelZAction=J.RotateRelative,this._wheelZActionCoordinate=U)}get wheelZRotateRelative(){return this._wheelZAction!==J.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(U){null===U&&this._wheelXAction!==J.MoveScene||(this._wheelXAction=J.MoveScene,this._wheelXActionCoordinate=U)}get wheelXMoveScene(){return this._wheelXAction!==J.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(U){null===U&&this._wheelYAction!==J.MoveScene||(this._wheelYAction=J.MoveScene,this._wheelYActionCoordinate=U)}get wheelYMoveScene(){return this._wheelYAction!==J.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(U){null===U&&this._wheelZAction!==J.MoveScene||(this._wheelZAction=J.MoveScene,this._wheelZActionCoordinate=U)}get wheelZMoveScene(){return this._wheelZAction!==J.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.jb(0),this._rotateRelative.jb(0),this._moveScene.jb(0),this._updateCamera(),this.camera.fU().useRightHandedSystem&&(this._moveRelative.z*=-1);const U=w.Matrix.Zero();this.camera.getViewMatrix().invertToRef(U);const X=w.JX.Zero();w.JX.TransformNormalToRef(this._moveRelative,U,X),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(X),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(U,X,b){if(0===U)return;if(null===X||null===b)return;let F=null;switch(X){case J.MoveRelative:F=this._moveRelative;break;case J.RotateRelative:F=this._rotateRelative;break;case J.MoveScene:F=this._moveScene}switch(b){case 0:F.set(U,0,0);break;case 1:F.set(0,U,0);break;case 2:F.set(0,0,U)}}}(0,F.c)([(0,E.J)()],I.prototype,"wheelXMoveRelative",null),(0,F.c)([(0,E.J)()],I.prototype,"wheelYMoveRelative",null),(0,F.c)([(0,E.J)()],I.prototype,"wheelZMoveRelative",null),(0,F.c)([(0,E.J)()],I.prototype,"wheelXRotateRelative",null),(0,F.c)([(0,E.J)()],I.prototype,"wheelYRotateRelative",null),(0,F.c)([(0,E.J)()],I.prototype,"wheelZRotateRelative",null),(0,F.c)([(0,E.J)()],I.prototype,"wheelXMoveScene",null),(0,F.c)([(0,E.J)()],I.prototype,"wheelYMoveScene",null),(0,F.c)([(0,E.J)()],I.prototype,"wheelZMoveScene",null),z.e.FreeCameraMouseWheelInput=I;class O{constructor(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=U,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=p.Tools.IsSafari()}attachControl(U){U=p.Tools.BackCompatCameraNoPreventDefault(arguments);let X=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=b=>{const F=b.event,E="mouse"===F.pointerType||this._isSafari&&"undefined"===typeof F.pointerType;if(this.allowMouse||!E)if(b.type===n.b.POINTERDOWN){if(U||F.preventDefault(),this._pointerPressed.push(F.pointerId),1!==this._pointerPressed.length)return;X={x:F.clientX,y:F.clientY}}else if(b.type===n.b.POINTERUP){U||F.preventDefault();const b=this._pointerPressed.indexOf(F.pointerId);if(-1===b)return;if(this._pointerPressed.splice(b,1),0!=b)return;X=null,this._offsetX=null,this._offsetY=null}else if(b.type===n.b.POINTERMOVE){if(U||F.preventDefault(),!X)return;if(0!=this._pointerPressed.indexOf(F.pointerId))return;this._offsetX=F.clientX-X.x,this._offsetY=-(F.clientY-X.y)}}),this._observer=this.camera.fU()._inputManager._addCameraPointerObserver(this._pointerInput,n.b.POINTERDOWN|n.b.POINTERUP|n.b.POINTERMOVE),this._onLostFocus){const U=this.camera.getEngine().getInputElement();U&&U.addEventListener("blur",this._onLostFocus)}}YR(){if(this._pointerInput){if(this._observer&&(this.camera.fU()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const U=this.camera.getEngine().getInputElement();U&&U.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const U=this.camera,X=U._calculateHandednessMultiplier();U.cameraRotation.y=X*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)U.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const X=U._computeLocalCameraSpeed(),b=new w.JX(0,0,0!==this.touchMoveSensibility?X*this._offsetY/this.touchMoveSensibility:0);w.Matrix.RotationYawPitchRollToRef(U.rotation.y,U.rotation.x,0,U._cameraRotationMatrix),U.cameraDirection.addInPlace(w.JX.TransformCoordinates(b,U._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,F.c)([(0,E.J)()],O.prototype,"touchAngularSensibility",void 0),(0,F.c)([(0,E.J)()],O.prototype,"touchMoveSensibility",void 0),z.e.FreeCameraTouchInput=O;class N extends z.f{constructor(U){super(U),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new S),this}addMouse(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new a(U),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new I,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new O),this}clear(){super.clear(),this._mouseInput=null}}var u=b(11551),i=b(11487);class P extends Q.e{get angularSensibility(){const U=this.inputs.attached.mouse;return U?U.angularSensibility:0}set angularSensibility(U){const X=this.inputs.attached.mouse;X&&(X.angularSensibility=U)}get keysUp(){const U=this.inputs.attached.keyboard;return U?U.keysUp:[]}set keysUp(U){const X=this.inputs.attached.keyboard;X&&(X.keysUp=U)}get keysUpward(){const U=this.inputs.attached.keyboard;return U?U.keysUpward:[]}set keysUpward(U){const X=this.inputs.attached.keyboard;X&&(X.keysUpward=U)}get keysDown(){const U=this.inputs.attached.keyboard;return U?U.keysDown:[]}set keysDown(U){const X=this.inputs.attached.keyboard;X&&(X.keysDown=U)}get keysDownward(){const U=this.inputs.attached.keyboard;return U?U.keysDownward:[]}set keysDownward(U){const X=this.inputs.attached.keyboard;X&&(X.keysDownward=U)}get keysLeft(){const U=this.inputs.attached.keyboard;return U?U.keysLeft:[]}set keysLeft(U){const X=this.inputs.attached.keyboard;X&&(X.keysLeft=U)}get keysRight(){const U=this.inputs.attached.keyboard;return U?U.keysRight:[]}set keysRight(U){const X=this.inputs.attached.keyboard;X&&(X.keysRight=U)}get keysRotateLeft(){const U=this.inputs.attached.keyboard;return U?U.keysRotateLeft:[]}set keysRotateLeft(U){const X=this.inputs.attached.keyboard;X&&(X.keysRotateLeft=U)}get keysRotateRight(){const U=this.inputs.attached.keyboard;return U?U.keysRotateRight:[]}set keysRotateRight(U){const X=this.inputs.attached.keyboard;X&&(X.keysRotateRight=U)}get keysRotateUp(){const U=this.inputs.attached.keyboard;return U?U.keysRotateUp:[]}set keysRotateUp(U){const X=this.inputs.attached.keyboard;X&&(X.keysRotateUp=U)}get keysRotateDown(){const U=this.inputs.attached.keyboard;return U?U.keysRotateDown:[]}set keysRotateDown(U){const X=this.inputs.attached.keyboard;X&&(X.keysRotateDown=U)}constructor(U,X,b){var F;super(U,X,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),F=this,this.ellipsoid=new w.JX(.5,1,.5),this.ellipsoidOffset=new w.JX(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=w.JX.Zero(),this._diffPosition=w.JX.Zero(),this._newPosition=w.JX.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;F._newPosition.q(X),F._newPosition.subtractToRef(F._oldPosition,F._diffPosition),F._diffPosition.length()>i.e.CollisionsEpsilon&&(F.position.addToRef(F._diffPosition,F._deferredPositionUpdate),F._deferOnly?F._deferredUpdated=!0:F.position.q(F._deferredPositionUpdate),F.fa&&b&&F.fa(b))},this.inputs=new N(this),this.inputs.addKeyboard().addMouse()}attachControl(U,X){X=p.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(X)}YR(){this.inputs.detachElement(),this.cameraDirection=new w.JX(0,0,0),this.cameraRotation=new w.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(U){this._collisionMask=isNaN(U)?-1:U}_collideWithWorld(U){let X;X=this.parent?w.JX.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,X.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const b=this.fU().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let F=U;this.applyGravity&&(F=U.add(this.fU().gravity)),b.getNewPosition(this._oldPosition,F,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=w.JX.Zero(),this._transformedDirection=w.JX.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(U){this._needMoveForGravity=U}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.fU().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"tb"}}(0,F.c)([(0,E.F)()],P.prototype,"ellipsoid",void 0),(0,F.c)([(0,E.F)()],P.prototype,"ellipsoidOffset",void 0),(0,F.c)([(0,E.J)()],P.prototype,"checkCollisions",void 0),(0,F.c)([(0,E.J)()],P.prototype,"applyGravity",void 0),(0,u.f)("BABYLON.FreeCamera",P)},13823:(U,X,b)=>{"use strict";b.d(X,{e:()=>w});var F=b(11679),E=b(13828);class w{constructor(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=b,this.wR=[],this._maxBlockCapacity=X||64,this._selectionContent=new F.c(1024),this._creationFunc=U}update(U,X,b){E.c._CreateBlocks(U,X,b,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}nS(U){for(let X=0;X<this.jS.length;X++){this.jS[X].addEntry(U)}}RS(U){for(let X=0;X<this.jS.length;X++){this.jS[X].removeEntry(U)}}select(U,X){this._selectionContent.reset();for(let b=0;b<this.jS.length;b++){this.jS[b].select(U,this._selectionContent,X)}return X?this._selectionContent.concat(this.wR):this._selectionContent.concatWithNoDuplicate(this.wR),this._selectionContent}intersects(U,X,b){this._selectionContent.reset();for(let F=0;F<this.jS.length;F++){this.jS[F].intersects(U,X,this._selectionContent,b)}return b?this._selectionContent.concat(this.wR):this._selectionContent.concatWithNoDuplicate(this.wR),this._selectionContent}intersectsRay(U){this._selectionContent.reset();for(let X=0;X<this.jS.length;X++){this.jS[X].intersectsRay(U,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.wR),this._selectionContent}}w.CreationFuncForMeshes=(U,X)=>{const b=U.getBoundingInfo();!U.isBlocked&&b.boundingBox.intersectsMinMax(X.SR,X.RR)&&X.entries.push(U)},w.CreationFuncForSubMeshes=(U,X)=>{U.getBoundingInfo().boundingBox.intersectsMinMax(X.SR,X.RR)&&X.entries.push(U)}},13828:(U,X,b)=>{"use strict";b.d(X,{c:()=>w});var F=b(11593),E=b(11954);class w{constructor(U,X,b,F,E,w){this.entries=[],this.nR=new Array,this._capacity=b,this._depth=F,this._maxDepth=E,this._creationFunc=w,this._minPoint=U,this._maxPoint=X,this.nR.push(U.clone()),this.nR.push(X.clone()),this.nR.push(U.clone()),this.nR[2].x=X.x,this.nR.push(U.clone()),this.nR[3].y=X.y,this.nR.push(U.clone()),this.nR[4].z=X.z,this.nR.push(X.clone()),this.nR[5].z=U.z,this.nR.push(X.clone()),this.nR[6].x=U.x,this.nR.push(X.clone()),this.nR[7].y=U.y}get tX(){return this._capacity}get SR(){return this._minPoint}get RR(){return this._maxPoint}addEntry(U){if(this.jS)for(let X=0;X<this.jS.length;X++){this.jS[X].addEntry(U)}else this._creationFunc(U,this),this.entries.length>this.tX&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(U){if(this.jS){for(let X=0;X<this.jS.length;X++){this.jS[X].removeEntry(U)}return}const X=this.entries.indexOf(U);X>-1&&this.entries.splice(X,1)}addEntries(U){for(let X=0;X<U.length;X++){const b=U[X];this.addEntry(b)}}select(U,X,b){if(E.d.IsInFrustum(this.nR,U)){if(this.jS){for(let F=0;F<this.jS.length;F++){this.jS[F].select(U,X,b)}return}b?X.concat(this.entries):X.concatWithNoDuplicate(this.entries)}}intersects(U,X,b,F){if(E.d.IntersectsSphere(this._minPoint,this._maxPoint,U,X)){if(this.jS){for(let E=0;E<this.jS.length;E++){this.jS[E].intersects(U,X,b,F)}return}F?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersectsRay(U,X){if(U.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.jS){for(let b=0;b<this.jS.length;b++){this.jS[b].intersectsRay(U,X)}return}X.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){w._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(U,X,b,E,Q,z,q,p){q.jS=new Array;const S=new F.JX((X.x-U.x)/2,(X.y-U.y)/2,(X.z-U.z)/2);for(let F=0;F<2;F++)for(let X=0;X<2;X++)for(let R=0;R<2;R++){const n=U.add(S.multiplyByFloats(F,X,R)),a=U.add(S.multiplyByFloats(F+1,X+1,R+1)),J=new w(n,a,E,Q+1,z,p);J.addEntries(b),q.jS.push(J)}}}},13833:(U,X,b)=>{"use strict";b.d(X,{b:()=>S});var F=b(11833),E=b(11593),w=b(12038),Q=b(12972),z=b(11874),q=b(13823),p=b(11442);F.c.prototype.createOrUpdateSelectionOctree=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,b=this._getComponent(z.e.NAME_OCTREE);b||(b=new S(this),this.o(b)),this.FR||(this.FR=new q.e(q.e.CreationFuncForMeshes,U,X));const F=this.getWorldExtends();return this.FR.update(F.min,F.max,this.meshes),this.FR},Object.defineProperty(F.c.prototype,"selectionOctree",{get:function(){return this.FR},enumerable:!0,configurable:!0}),w.b.prototype.createOrUpdateSubmeshesOctree=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=this.fU();let F=b._getComponent(z.e.NAME_OCTREE);F||(F=new S(b),b.o(F)),this._submeshesOctree||(this._submeshesOctree=new q.e(q.e.CreationFuncForSubMeshes,U,X)),this.Ob(!0);const E=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(E.minimumWorld,E.maximumWorld,this.ab),this._submeshesOctree};class S{constructor(U){this.name=z.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Q.c(E.JX.Zero(),new E.JX(1,1,1)),(U=U||p.c.LastCreatedScene)&&(this.xX=U,this.xX.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.xX.getActiveSubMeshCandidates=U=>this.getActiveSubMeshCandidates(U),this.xX.getCollidingSubMeshCandidates=(U,X)=>this.getCollidingSubMeshCandidates(U,X),this.xX.getIntersectingSubMeshCandidates=(U,X)=>this.getIntersectingSubMeshCandidates(U,X))}register(){this.xX.onMeshRemovedObservable.add((U=>{const X=this.xX.selectionOctree;if(void 0!==X&&null!==X){const b=X.wR.indexOf(U);-1!==b&&X.wR.splice(b,1)}})),this.xX.onMeshImportedObservable.add((U=>{const X=this.xX.selectionOctree;void 0!==X&&null!==X&&X.nS(U)}))}getActiveMeshCandidates(){var U;return(null===(U=this.xX.FR)||void 0===U?void 0:U.select(this.xX.frustumPlanes))||this.xX._getDefaultMeshCandidates()}getActiveSubMeshCandidates(U){if(U._submeshesOctree&&U.useOctreeForRenderingSelection){return U._submeshesOctree.select(this.xX.frustumPlanes)}return this.xX._getDefaultSubMeshCandidates(U)}getIntersectingSubMeshCandidates(U,X){if(U._submeshesOctree&&U.useOctreeForPicking){Q.c.TransformToRef(X,U.getWorldMatrix(),this._tempRay);return U._submeshesOctree.intersectsRay(this._tempRay)}return this.xX._getDefaultSubMeshCandidates(U)}getCollidingSubMeshCandidates(U,X){if(U._submeshesOctree&&U.useOctreeForCollisions){const b=X._velocityWorldLength+Math.max(X._radius.x,X._radius.y,X._radius.z);return U._submeshesOctree.intersects(X._basePointWorld,b)}return this.xX._getDefaultSubMeshCandidates(U)}rebuild(){}dispose(){}}},12972:(U,X,b)=>{"use strict";b.d(X,{c:()=>a});var F=b(11833),E=b(12075),w=b(11597),Q=b(11593),z=b(11600),q=b(11940),p=b(11866),S=b(11442),R=b(11899);const n={internalPickerForMesh:void 0};class a{constructor(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.d;this.origin=U,this.direction=X,this.length=b,this.epsilon=F}clone(){return new a(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const F=a._TmpVector3[0].Pb(U.x-b,U.y-b,U.z-b),E=a._TmpVector3[1].Pb(X.x+b,X.y+b,X.z+b);let w,Q,z,q,p=0,S=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<F.x||this.origin.x>E.x)return!1}else if(w=1/this.direction.x,Q=(F.x-this.origin.x)*w,z=(E.x-this.origin.x)*w,z===-1/0&&(z=1/0),Q>z&&(q=Q,Q=z,z=q),p=Math.max(Q,p),S=Math.min(z,S),p>S)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<F.y||this.origin.y>E.y)return!1}else if(w=1/this.direction.y,Q=(F.y-this.origin.y)*w,z=(E.y-this.origin.y)*w,z===-1/0&&(z=1/0),Q>z&&(q=Q,Q=z,z=q),p=Math.max(Q,p),S=Math.min(z,S),p>S)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<F.z||this.origin.z>E.z)return!1}else if(w=1/this.direction.z,Q=(F.z-this.origin.z)*w,z=(E.z-this.origin.z)*w,z===-1/0&&(z=1/0),Q>z&&(q=Q,Q=z,z=q),p=Math.max(Q,p),S=Math.min(z,S),p>S)return!1;return!0}intersectsBox(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(U.minimum,U.maximum,X)}intersectsSphere(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=U.center.x-this.origin.x,F=U.center.y-this.origin.y,E=U.center.z-this.origin.z,w=b*b+F*F+E*E,Q=U.radius+X,z=Q*Q;if(w<=z)return!0;const q=b*this.direction.x+F*this.direction.y+E*this.direction.z;if(q<0)return!1;return w-q*q<=z}intersectsTriangle(U,X,b){const F=a._TmpVector3[0],E=a._TmpVector3[1],w=a._TmpVector3[2],z=a._TmpVector3[3],p=a._TmpVector3[4];X.subtractToRef(U,F),b.subtractToRef(U,E),Q.JX.CrossToRef(this.direction,E,w);const S=Q.JX.Dot(F,w);if(0===S)return null;const R=1/S;this.origin.subtractToRef(U,z);const n=Q.JX.Dot(z,w)*R;if(n<-this.epsilon||n>1+this.epsilon)return null;Q.JX.CrossToRef(z,F,p);const J=Q.JX.Dot(this.direction,p)*R;if(J<-this.epsilon||n+J>1+this.epsilon)return null;const m=Q.JX.Dot(E,p)*R;return m>this.length?null:new q.c(1-n-J,n,m)}intersectsPlane(U){let X;const b=Q.JX.Dot(U.normal,this.direction);if(Math.abs(b)<9.99999997475243e-7)return null;{const F=Q.JX.Dot(U.normal,this.origin);return X=(-U.d-F)/b,X<0?X<-9.99999997475243e-7?null:0:X}}intersectsAxis(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(U){case"y":{const U=(this.origin.y-X)/this.direction.y;return U>0?null:new Q.JX(this.origin.x+this.direction.x*-U,X,this.origin.z+this.direction.z*-U)}case"x":{const U=(this.origin.x-X)/this.direction.x;return U>0?null:new Q.JX(X,this.origin.y+this.direction.y*-U,this.origin.z+this.direction.z*-U)}case"z":{const U=(this.origin.z-X)/this.direction.z;return U>0?null:new Q.JX(this.origin.x+this.direction.x*-U,this.origin.y+this.direction.y*-U,X)}default:return null}}intersectsMesh(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=Q.TmpVectors.Matrix[0];return U.getWorldMatrix().invertToRef(z),this._tmpRay?a.TransformToRef(this,z,this._tmpRay):this._tmpRay=a.Transform(this,z),U.intersects(this._tmpRay,X,b,F,E,w)}intersectsMeshes(U,X,b){b?b.length=0:b=[];for(let F=0;F<U.length;F++){const E=this.intersectsMesh(U[F],X);E.hit&&b.push(E)}return b.sort(this._comparePickingInfo),b}_comparePickingInfo(U,X){return U.distance<X.distance?-1:U.distance>X.distance?1:0}intersectionSegment(U,X,b){const F=this.origin,E=Q.TmpVectors.JX[0],w=Q.TmpVectors.JX[1],z=Q.TmpVectors.JX[2],q=Q.TmpVectors.JX[3];X.subtractToRef(U,E),this.direction.scaleToRef(a._Rayl,z),F.addToRef(z,w),U.subtractToRef(F,q);const p=Q.JX.Dot(E,E),S=Q.JX.Dot(E,z),R=Q.JX.Dot(z,z),n=Q.JX.Dot(E,q),J=Q.JX.Dot(z,q),m=p*R-S*S;let x,I,O=m,N=m;m<a._Smallnum?(x=0,O=1,I=J,N=R):(x=S*J-R*n,I=p*J-S*n,x<0?(x=0,I=J,N=R):x>O&&(x=O,I=J+S,N=R)),I<0?(I=0,-n<0?x=0:-n>p?x=O:(x=-n,O=p)):I>N&&(I=N,-n+S<0?x=0:-n+S>p?x=O:(x=-n+S,O=p));const u=Math.abs(x)<a._Smallnum?0:x/O,i=Math.abs(I)<a._Smallnum?0:I/N,P=Q.TmpVectors.JX[4];z.scaleToRef(i,P);const f=Q.TmpVectors.JX[5];E.scaleToRef(u,f),f.addInPlace(q);const j=Q.TmpVectors.JX[6];f.subtractToRef(P,j);return i>0&&i<=this.length&&j.lengthSquared()<b*b?f.length():-1}update(U,X,b,F,E,w,z){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){a._RayDistant||(a._RayDistant=a.Zero()),a._RayDistant.unprojectRayToRef(U,X,b,F,Q.Matrix.IdentityReadOnly,w,z);const q=Q.TmpVectors.Matrix[0];E.invertToRef(q),a.TransformToRef(a._RayDistant,q,this)}else this.unprojectRayToRef(U,X,b,F,E,w,z);return this}static Zero(){return new a(Q.JX.Zero(),Q.JX.Zero())}static CreateNew(U,X,b,F,E,w,Q){return a.Zero().update(U,X,b,F,E,w,Q)}static CreateNewFromTo(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.Matrix.IdentityReadOnly;const F=new a(new Q.JX(0,0,0),new Q.JX(0,0,0));return a.CreateFromToToRef(U,X,F,b)}static CreateFromToToRef(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Q.Matrix.IdentityReadOnly;b.origin.q(U);const E=X.subtractToRef(U,b.direction),w=Math.sqrt(E.x*E.x+E.y*E.y+E.z*E.z);return b.length=w,b.direction.normalize(),a.TransformToRef(b,F,b)}static Transform(U,X){const b=new a(new Q.JX(0,0,0),new Q.JX(0,0,0));return a.TransformToRef(U,X,b),b}static TransformToRef(U,X,b){Q.JX.TransformCoordinatesToRef(U.origin,X,b.origin),Q.JX.TransformNormalToRef(U.direction,X,b.direction),b.length=U.length,b.epsilon=U.epsilon;const F=b.direction,E=F.length();if(0!==E&&1!==E){const U=1/E;F.x*=U,F.y*=U,F.z*=U,b.length*=E}return b}unprojectRayToRef(U,X,b,F,E,w,z){const q=Q.TmpVectors.Matrix[0];E.multiplyToRef(w,q),q.multiplyToRef(z,q),q.invert();const p=S.c.LastCreatedEngine,R=Q.TmpVectors.JX[0];R.x=U/b*2-1,R.y=-(X/F*2-1),R.z=null!==p&&void 0!==p&&p.useReverseDepthBuffer?1:null!==p&&void 0!==p&&p.isNDCHalfZRange?0:-1;const n=Q.TmpVectors.JX[1].Pb(R.x,R.y,1-1e-8),a=Q.TmpVectors.JX[2],J=Q.TmpVectors.JX[3];Q.JX._UnprojectFromInvertedMatrixToRef(R,q,a),Q.JX._UnprojectFromInvertedMatrixToRef(n,q,J),this.origin.q(a),J.subtractToRef(a,this.direction),this.direction.normalize()}}function J(U,X,b,F,E){let w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Q=a.Zero();return m(U,X,b,F,Q,E,w),Q}function m(U,X,b,F,E,w){let z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const p=U.getEngine();if(!w&&!(w=U.activeCamera))return U;const S=w.viewport,R=p.getRenderHeight(),{x:n,y:a,width:J,height:m}=S.toGlobal(p.getRenderWidth(),R),x=1/p.getHardwareScalingLevel();return X=X*x-n,b=b*x-(R-a-m),E.update(X,b,J,m,F||Q.Matrix.IdentityReadOnly,z?Q.Matrix.IdentityReadOnly:w.getViewMatrix(),w.getProjectionMatrix(),q),U}function x(U,X,b,F,E){if(!p.c)return U;const w=U.getEngine();if(!E&&!(E=U.activeCamera))throw new Error("Active camera not set");const z=E.viewport,q=w.getRenderHeight(),{x:S,y:R,width:n,height:a}=z.toGlobal(w.getRenderWidth(),q),J=Q.Matrix.Identity(),m=1/w.getHardwareScalingLevel();return X=X*m-S,b=b*m-(q-R-a),F.update(X,b,n,a,J,J,E.getProjectionMatrix()),U}function I(U,X,b,F,E,w,Q,z){const q=X(F,b.enableDistantPicking),p=b.intersects(q,E,Q,w,F,z);return p&&p.hit?!E&&null!=U&&p.distance>=U.distance?null:p:null}function O(U,X,b,F,E,w){let z=null;const q=!!(U.activeCameras&&U.activeCameras.length>1&&U.cameraToUseForPointers!==U.activeCamera),S=U.cameraToUseForPointers||U.activeCamera,R=n.internalPickerForMesh||I;for(let p=0;p<U.meshes.length;p++){const n=U.meshes[p];if(b){if(!b(n,-1))continue}else if(!n.isEnabled()||!n.isVisible||!n.rq)continue;const a=q&&n.isWorldMatrixCameraDependent(),J=n.Ob(a,S);if(n.hasThinInstances&&n.kp){const U=R(z,X,n,J,!0,!0,w);if(U){if(E)return U;const q=Q.TmpVectors.Matrix[1],p=n.thinInstanceGetWorldMatrices();for(let U=0;U<p.length;U++){if(b&&!b(n,U))continue;p[U].multiplyToRef(J,q);const Q=R(z,X,n,q,F,E,w,!0);if(Q&&(z=Q,z.thinInstanceIndex=U,F))return z}}}else{const U=R(z,X,n,J,F,E,w);if(U&&(z=U,F))return z}}return z||new p.c}function N(U,X,b,F){if(!p.c)return null;const E=[],w=!!(U.activeCameras&&U.activeCameras.length>1&&U.cameraToUseForPointers!==U.activeCamera),z=U.cameraToUseForPointers||U.activeCamera,q=n.internalPickerForMesh||I;for(let p=0;p<U.meshes.length;p++){const S=U.meshes[p];if(b){if(!b(S,-1))continue}else if(!S.isEnabled()||!S.isVisible||!S.rq)continue;const R=w&&S.isWorldMatrixCameraDependent(),n=S.Ob(R,z);if(S.hasThinInstances&&S.kp){if(q(null,X,S,n,!0,!0,F)){const U=Q.TmpVectors.Matrix[1],w=S.thinInstanceGetWorldMatrices();for(let Q=0;Q<w.length;Q++){if(b&&!b(S,Q))continue;w[Q].multiplyToRef(n,U);const z=q(null,X,S,U,!1,!1,F,!0);z&&(z.thinInstanceIndex=Q,E.push(z))}}}else{const U=q(null,X,S,n,!1,!1,F);U&&E.push(U)}}return E}function u(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,F=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;F||(F=U.getWorldMatrix()),X.length=b,E?X.origin.q(E):X.origin.q(U.position);const w=Q.TmpVectors.JX[2];w.set(0,0,U._scene.useRightHandedSystem?-1:1);const z=Q.TmpVectors.JX[3];return Q.JX.TransformNormalToRef(w,F,z),Q.JX.NormalizeToRef(z,X.direction),X}var i,P;a._TmpVector3=(0,z.e)(6,Q.JX.Zero),a._RayDistant=a.Zero(),a._Smallnum=1e-8,a._Rayl=1e9,i=F.c,(P=E.e)&&(P.prototype.getForwardRay=function(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,X=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;return u(this,new a(Q.JX.Zero(),Q.JX.Zero(),U),U,X,b)},P.prototype.getForwardRayToRef=function(U){return u(this,U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),i&&(R.b._IsPickingAvailable=!0,i.prototype.createPickingRay=function(U,X,b,F){return J(this,U,X,b,F,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),F.c.prototype.createPickingRayToRef=function(U,X,b,F,E){return m(this,U,X,b,F,E,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},F.c.prototype.createPickingRayInCameraSpace=function(U,X,b){return function(U,X,b,F){const E=a.Zero();return x(U,X,b,E,F),E}(this,U,X,b)},F.c.prototype.createPickingRayInCameraSpaceToRef=function(U,X,b,F){return x(this,U,X,b,F)},F.c.prototype.pickWithBoundingInfo=function(U,X,b,F,E){return function(U,X,b,F,E,w){if(!p.c)return null;const z=O(U,(F=>(U._tempPickingRay||(U._tempPickingRay=a.Zero()),m(U,X,b,F,U._tempPickingRay,w||null),U._tempPickingRay)),F,E,!0);return z&&(z.ray=J(U,X,b,Q.Matrix.Identity(),w||null)),z}(this,U,X,b,F,E)},F.c.prototype.zF=function(U,X,b,F,E,w){return function(U,X,b,F,E,w,z){const q=O(U,((F,E)=>(U._tempPickingRay||(U._tempPickingRay=a.Zero()),m(U,X,b,F,U._tempPickingRay,w||null,!1,E),U._tempPickingRay)),F,E,!1,z);return q&&(q.ray=J(U,X,b,Q.Matrix.Identity(),w||null)),q}(this,U,X,b,F,E,w)},F.c.prototype.pickWithRay=function(U,X,b,F){return function(U,X,b,F,E){const w=O(U,(b=>(U._pickWithRayInverseMatrix||(U._pickWithRayInverseMatrix=Q.Matrix.Identity()),b.invertToRef(U._pickWithRayInverseMatrix),U._cachedRayForTransform||(U._cachedRayForTransform=a.Zero()),a.TransformToRef(X,U._pickWithRayInverseMatrix,U._cachedRayForTransform),U._cachedRayForTransform)),b,F,!1,E);return w&&(w.ray=X),w}(this,U,X,b,F)},F.c.prototype.multiPick=function(U,X,b,F,E){return function(U,X,b,F,E,w){return N(U,(F=>J(U,X,b,F,E||null)),F,w)}(this,U,X,b,F,E)},F.c.prototype.multiPickWithRay=function(U,X,b){return function(U,X,b,F){return N(U,(b=>(U._pickWithRayInverseMatrix||(U._pickWithRayInverseMatrix=Q.Matrix.Identity()),b.invertToRef(U._pickWithRayInverseMatrix),U._cachedRayForTransform||(U._cachedRayForTransform=a.Zero()),a.TransformToRef(X,U._pickWithRayInverseMatrix,U._cachedRayForTransform),U._cachedRayForTransform)),b,F)}(this,U,X,b)}},13250:(U,X,b)=>{"use strict";var F=b(11528),E=b(11408),w=b(11448),Q=b(11555),z=b(11487),q=b(11543);z.e.prototype._partialLoadFile=function(U,X,b,F){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(U,(U=>{b[X]=U,b._internalCount++,6===b._internalCount&&F(b)}),void 0,void 0,!0,((U,X)=>{E&&U&&E(U.status+" "+U.statusText,X)}))},z.e.prototype._cascadeLoadFiles=function(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=[];E._internalCount=0;for(let w=0;w<6;w++)this._partialLoadFile(b[w],w,E,X,F)},z.e.prototype._cascadeLoadImgs=function(U,X,b,F){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5?arguments[5]:void 0;const Q=[];Q._internalCount=0;for(let z=0;z<6;z++)this._partialLoadImg(F[z],z,Q,U,X,b,E,w)},z.e.prototype._partialLoadImg=function(U,X,b,F,E,z){let q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7?arguments[7]:void 0;const S=(0,Q.c)();(0,w.p)(U,(U=>{b[X]=U,b._internalCount++,F&&F.removePendingData(S),6===b._internalCount&&z&&z(E,b)}),((U,X)=>{F&&F.removePendingData(S),q&&q(U,X)}),F?F.offlineProvider:null,p),F&&F.addPendingData(S)},z.e.prototype.createCubeTextureBase=function(U,X,b,w){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]&&arguments[8],n=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,a=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,m=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,x=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,I=arguments.length>14&&void 0!==arguments[14]&&arguments[14],O=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const N=J||new F.e(this,7);N.isCube=!0,N.url=U,N.generateMipMaps=!w,N._lodGenerationScale=n,N._lodGenerationOffset=a,N._useSRGBBuffer=!!I&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!w),N!==J&&(N.label=U.substring(0,60)),this._doNotHandleContextLost||(N._extension=S,N._files=b,N._buffer=O);const u=U;this._transformTextureUrl&&!J&&(U=this._transformTextureUrl(U));const i=S??function(U){const X=U.split("?")[0],b=X.lastIndexOf(".");return b>-1?X.substring(b).toLowerCase():""}(U),P=(0,q.e)(i),f=(U,X)=>{N.dispose(),z?z(U,X):U&&E.e.Warn(U)},j=(F,z)=>{U===u?F&&f(F.status+" "+F.statusText,z):(E.e.Warn(`Failed to load ${U}, falling back to the ${u}`),this.createCubeTextureBase(u,X,b,!!w,Q,f,p,S,R,n,a,N,m,x,I,O))};if(P)P.then((F=>{const E=U=>{m&&m(N,U),F.loadCubeData(U,N,R,Q,((U,X)=>{f(U,X)}))};O?E(O):b&&6===b.length?F.supportCascades?this._cascadeLoadFiles(X,(U=>E(U.map((U=>new Uint8Array(U))))),b,f):f("Textures type does not support cascades."):this._loadFile(U,(U=>E(new Uint8Array(U))),void 0,void 0,!0,j)}));else{if(!b||0===b.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(X,N,((U,X)=>{x&&x(U,X)}),b,f)}return this._internalTexturesCache.push(N),N}},13836:(U,X,b)=>{"use strict";b(11408);var F=b(11717);b(11528),b(11667),b(11519),b(11766),b(11728);F.e},13276:(U,X,b)=>{"use strict";b.d(X,{e:()=>E});var F=b(11551);class E{constructor(U){this.value=this._toInt(U)}_toInt(U){return 0|U}add(U){return new E(this.value+U.value)}mX(U){return new E(this.value-U.value)}multiply(U){return new E(Math.imul(this.value,U.value))}divide(U){return new E(this.value/U.value)}getClassName(){return E.ClassName}equals(U){return this.value===U.value}static FromValue(U){return new E(U)}toString(){return this.value.toString()}}E.ClassName="FlowGraphInteger",(0,F.f)("FlowGraphInteger",E)},13287:(U,X,b)=>{"use strict";b.d(X,{b:()=>E,c:()=>w});var F=b(11593);class E{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.zb=U}get m(){return this.zb}transformVector(U){return this.transformVectorToRef(U,new F.Vector2)}transformVectorToRef(U,X){return X.x=U.x*this.zb[0]+U.y*this.zb[1],X.y=U.x*this.zb[2]+U.y*this.zb[3],X}Jb(){return this.toArray()}toArray(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let X=0;X<4;X++)U[X]=this.zb[X];return U}qF(U){for(let X=0;X<4;X++)this.zb[X]=U[X];return this}multiplyToRef(U,X){const b=U.zb,F=this.zb,E=X.zb;return E[0]=b[0]*F[0]+b[1]*F[2],E[1]=b[0]*F[1]+b[1]*F[3],E[2]=b[2]*F[0]+b[3]*F[2],E[3]=b[2]*F[1]+b[3]*F[3],X}multiply(U){return this.multiplyToRef(U,new E)}divideToRef(U,X){const b=this.zb,F=U.zb,E=X.zb;return E[0]=b[0]/F[0],E[1]=b[1]/F[1],E[2]=b[2]/F[2],E[3]=b[3]/F[3],X}divide(U){return this.divideToRef(U,new E)}addToRef(U,X){const b=this.zb,F=U.m,E=X.m;return E[0]=b[0]+F[0],E[1]=b[1]+F[1],E[2]=b[2]+F[2],E[3]=b[3]+F[3],X}add(U){return this.addToRef(U,new E)}subtractToRef(U,X){const b=this.zb,F=U.m,E=X.m;return E[0]=b[0]-F[0],E[1]=b[1]-F[1],E[2]=b[2]-F[2],E[3]=b[3]-F[3],X}mX(U){return this.subtractToRef(U,new E)}transpose(){const U=this.zb;return new E([U[0],U[2],U[1],U[3]])}determinant(){const U=this.zb;return U[0]*U[3]-U[1]*U[2]}inverse(){const U=this.determinant();if(0===U)throw new Error("Matrix is not invertible");const X=this.zb,b=1/U;return new E([X[3]*b,-X[1]*b,-X[2]*b,X[0]*b])}equals(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.zb,F=U.m;return 0===X?b[0]===F[0]&&b[1]===F[1]&&b[2]===F[2]&&b[3]===F[3]:Math.abs(b[0]-F[0])<X&&Math.abs(b[1]-F[1])<X&&Math.abs(b[2]-F[2])<X&&Math.abs(b[3]-F[3])<X}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.zb.join(", ")})`}}class w{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.zb=U}get m(){return this.zb}transformVector(U){return this.transformVectorToRef(U,new F.JX)}transformVectorToRef(U,X){const b=this.zb;return X.x=U.x*b[0]+U.y*b[1]+U.z*b[2],X.y=U.x*b[3]+U.y*b[4]+U.z*b[5],X.z=U.x*b[6]+U.y*b[7]+U.z*b[8],X}multiplyToRef(U,X){const b=U.zb,F=this.zb,E=X.m;return E[0]=b[0]*F[0]+b[1]*F[3]+b[2]*F[6],E[1]=b[0]*F[1]+b[1]*F[4]+b[2]*F[7],E[2]=b[0]*F[2]+b[1]*F[5]+b[2]*F[8],E[3]=b[3]*F[0]+b[4]*F[3]+b[5]*F[6],E[4]=b[3]*F[1]+b[4]*F[4]+b[5]*F[7],E[5]=b[3]*F[2]+b[4]*F[5]+b[5]*F[8],E[6]=b[6]*F[0]+b[7]*F[3]+b[8]*F[6],E[7]=b[6]*F[1]+b[7]*F[4]+b[8]*F[7],E[8]=b[6]*F[2]+b[7]*F[5]+b[8]*F[8],X}multiply(U){return this.multiplyToRef(U,new w)}divideToRef(U,X){const b=this.zb,F=U.m,E=X.m;return E[0]=b[0]/F[0],E[1]=b[1]/F[1],E[2]=b[2]/F[2],E[3]=b[3]/F[3],E[4]=b[4]/F[4],E[5]=b[5]/F[5],E[6]=b[6]/F[6],E[7]=b[7]/F[7],E[8]=b[8]/F[8],X}divide(U){return this.divideToRef(U,new w)}addToRef(U,X){const b=this.zb,F=U.m,E=X.m;return E[0]=b[0]+F[0],E[1]=b[1]+F[1],E[2]=b[2]+F[2],E[3]=b[3]+F[3],E[4]=b[4]+F[4],E[5]=b[5]+F[5],E[6]=b[6]+F[6],E[7]=b[7]+F[7],E[8]=b[8]+F[8],X}add(U){return this.addToRef(U,new w)}subtractToRef(U,X){const b=this.zb,F=U.m,E=X.m;return E[0]=b[0]-F[0],E[1]=b[1]-F[1],E[2]=b[2]-F[2],E[3]=b[3]-F[3],E[4]=b[4]-F[4],E[5]=b[5]-F[5],E[6]=b[6]-F[6],E[7]=b[7]-F[7],E[8]=b[8]-F[8],X}mX(U){return this.subtractToRef(U,new w)}toArray(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let X=0;X<9;X++)U[X]=this.zb[X];return U}Jb(){return this.toArray()}qF(U){for(let X=0;X<9;X++)this.zb[X]=U[X];return this}transpose(){const U=this.zb;return new w([U[0],U[3],U[6],U[1],U[4],U[7],U[2],U[5],U[8]])}determinant(){const U=this.zb;return U[0]*(U[4]*U[8]-U[5]*U[7])-U[1]*(U[3]*U[8]-U[5]*U[6])+U[2]*(U[3]*U[7]-U[4]*U[6])}inverse(){const U=this.determinant();if(0===U)throw new Error("Matrix is not invertible");const X=this.zb,b=1/U;return new w([(X[4]*X[8]-X[5]*X[7])*b,(X[2]*X[7]-X[1]*X[8])*b,(X[1]*X[5]-X[2]*X[4])*b,(X[5]*X[6]-X[3]*X[8])*b,(X[0]*X[8]-X[2]*X[6])*b,(X[2]*X[3]-X[0]*X[5])*b,(X[3]*X[7]-X[4]*X[6])*b,(X[1]*X[6]-X[0]*X[7])*b,(X[0]*X[4]-X[1]*X[3])*b])}equals(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.zb,F=U.m;return 0===X?b[0]===F[0]&&b[1]===F[1]&&b[2]===F[2]&&b[3]===F[3]&&b[4]===F[4]&&b[5]===F[5]&&b[6]===F[6]&&b[7]===F[7]&&b[8]===F[8]:Math.abs(b[0]-F[0])<X&&Math.abs(b[1]-F[1])<X&&Math.abs(b[2]-F[2])<X&&Math.abs(b[3]-F[3])<X&&Math.abs(b[4]-F[4])<X&&Math.abs(b[5]-F[5])<X&&Math.abs(b[6]-F[6])<X&&Math.abs(b[7]-F[7])<X&&Math.abs(b[8]-F[8])<X}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.zb.join(", ")})`}}},13296:(U,X,b)=>{"use strict";var F;function E(U,X,b,F){switch(X){case"Animation":return F?U.animations.find((U=>U.uniqueId===b))??null:U.animations[b]??null;case"AnimationGroup":return F?U.animationGroups.find((U=>U.uniqueId===b))??null:U.animationGroups[b]??null;case"Mesh":return F?U.meshes.find((U=>U.uniqueId===b))??null:U.meshes[b]??null;case"Material":return F?U.materials.find((U=>U.uniqueId===b))??null:U.materials[b]??null;case"uS":return F?U.cameras.find((U=>U.uniqueId===b))??null:U.cameras[b]??null;case"Light":return F?U.lights.find((U=>U.uniqueId===b))??null:U.lights[b]??null;default:return null}}b.d(X,{e:()=>E}),function(U){U.Animation="Animation",U.AnimationGroup="AnimationGroup",U.Mesh="Mesh",U.Material="Material",U.uS="uS",U.Light="Light"}(F||(F={}))},13330:(U,X,b)=>{"use strict";b.d(X,{e:()=>E});var F=b(13333);class E extends F.d{constructor(U,X){if(super(U),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),X)for(const b of X)this._eventsSignalOutputs[b]=this._registerSignalOutput(b+"Event")}_executeOnTick(U){}_startPendingTasks(U){U._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(U),this._resetAfterCanceled(U)),this._preparePendingTasks(U),U._addPendingBlock(this),this.out._activateSignal(U),U._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(U){U._deleteExecutionVariable(this,"_initialized"),U._removePendingBlock(this)}}},13308:(U,X,b)=>{"use strict";b.d(X,{d:()=>p});var F=b(11555),E=b(11551),w=b(13310),Q=b(11392),z=b(13272);class q extends w.e{constructor(U,X,b,F){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:F.defaultValue,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(U,X,b),this.richType=F,this._defaultValue=E,this._optional=w,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Q.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(U){this._isDisabled!==U&&(this._isDisabled=U,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(U,X){X._getConnectionValue(this)!==U&&(X._setConnectionValue(this,U),this.onValueChangedObservable.notifyObservers(U))}resetToDefaultValue(U){U._setConnectionValue(this,this._defaultValue)}connectTo(U){this._isDisabled||super.connectTo(U)}_getValueOrDefault(U){const X=U._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(X):X}getValue(U){if(1===this.connectionType){U._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(U);const X=this._getValueOrDefault(U);return this._lastValue=X,this.richType.typeTransformer?this.richType.typeTransformer(X):X}const X=this.isConnected()?this._connectedPoint[0].getValue(U):this._getValueOrDefault(U);return this._lastValue=X,this.richType.typeTransformer?this.richType.typeTransformer(X):X}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(U),U.richType={},this.richType.serialize(U.richType),U.optional=this._optional,(0,z.h)("defaultValue",this._defaultValue,U)}}(0,E.f)("FlowGraphDataConnection",q);class p{constructor(U){var X;this.config=U,this.uniqueId=(0,F.c)(),this.name=(null===(X=this.config)||void 0===X?void 0:X.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(U){}registerDataInput(U,X,b){const F=new q(U,0,this,X,b);return this.dataInputs.push(F),F}registerDataOutput(U,X,b){const F=new q(U,1,this,X,b);return this.dataOutputs.push(F),F}getDataInput(U){return this.dataInputs.find((X=>X.name===U))}getDataOutput(U){return this.dataOutputs.find((X=>X.name===U))}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.h;if(U.uniqueId=this.uniqueId,U.config={},this.config){const b=this.config,F=Object.keys(b);for(const E of F)X(E,b[E],U.config)}U.dataInputs=[],U.dataOutputs=[],U.className=this.getClassName();for(const b of this.dataInputs){const X={};b.serialize(X),U.dataInputs.push(X)}for(const b of this.dataOutputs){const X={};b.serialize(X),U.dataOutputs.push(X)}}deserialize(U){}_log(U,X,b){var F;null===(F=U.logger)||void 0===F||F.addLogItem({action:X,pF:b,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13310:(U,X,b)=>{"use strict";b.d(X,{e:()=>w});var F,E=b(11555);!function(U){U[U.Input=0]="Input",U[U.Output=1]="Output"}(F||(F={}));class w{constructor(U,X,b){this._ownerBlock=b,this._connectedPoint=[],this.uniqueId=(0,E.c)(),this.connectedPointIds=[],this.name=U,this._connectionType=X}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(U){if(this._connectionType===U._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||U._isSingularConnection()&&U._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(U),U._connectedPoint.push(this)}disconnectFrom(U){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this._connectedPoint.indexOf(U),F=U._connectedPoint.indexOf(this);-1!==b&&-1!==F&&(X&&this._connectedPoint.splice(b,1),U._connectedPoint.splice(F,1))}disconnectFromAll(){for(const U of this._connectedPoint)this.disconnectFrom(U,!1);this._connectedPoint.length=0}dispose(){for(const U of this._connectedPoint)this.disconnectFrom(U)}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U.uniqueId=this.uniqueId,U.name=this.name,U._connectionType=this._connectionType,U.connectedPointIds=[],U.className=this.getClassName();for(const X of this._connectedPoint)U.connectedPointIds.push(X.uniqueId)}getClassName(){return"FGConnection"}deserialize(U){this.uniqueId=U.uniqueId,this.name=U.name,this._connectionType=U._connectionType,this.connectedPointIds=U.connectedPointIds}}},13268:(U,X,b)=>{"use strict";b.d(X,{c:()=>N});var F,E=b(11392),w=b(11576),Q=b(11583),z=b(11555),q=b(13272),p=b(13296),S=b(11408);!function(U){U.ExecuteBlock="ExecuteBlock",U.ExecuteEvent="ExecuteEvent",U.TriggerConnection="TriggerConnection",U.ContextVariableSet="ContextVariableSet",U.GlobalVariableSet="GlobalVariableSet",U.GlobalVariableDelete="GlobalVariableDelete",U.GlobalVariableGet="GlobalVariableGet",U.AddConnection="AddConnection",U.GetConnectionValue="GetConnectionValue",U.SetConnectionValue="SetConnectionValue",U.ActivateSignal="ActivateSignal",U.ContextVariableGet="ContextVariableGet"}(F||(F={}));class R{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(U){if(U.time||(U.time=Date.now()),this.log.push(U),this.logToConsole){var X;const b=null===(X=U.pF)||void 0===X?void 0:X.value;"object"===typeof b&&b.getClassName?S.e.Log(`[FGLog] ${U.className}:${U.uniqueId.split("-")[0]} ${U.action} - ${JSON.stringify(b.getClassName())}: ${b.toString()}`):S.e.Log(`[FGLog] ${U.className}:${U.uniqueId.split("-")[0]} ${U.action} - ${JSON.stringify(U.pF)}`)}}getItemsOfType(U){return this.log.filter((X=>X.action===U))}}class n{get enableLogging(){return this._enableLogging}set enableLogging(U){this._enableLogging!==U&&(this._enableLogging=U,this._enableLogging?(this.logger=new R,this.logger.logToConsole=!0):this.logger=null)}constructor(U){this.uniqueId=(0,z.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new E.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=U,this.assetsContext=U.assetsContext??U.xX}hasVariable(U){return U in this._userVariables}setVariable(U,X){var b;this._userVariables[U]=X,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",pF:{name:U,value:X}})}getAsset(U,X){return(0,p.e)(this.assetsContext,U,X)}getVariable(U){var X;return null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",pF:{name:U,value:this._userVariables[U]}}),this._userVariables[U]}get userVariables(){return this._userVariables}fU(){return this._configuration.xX}_getUniqueIdPrefixedName(U,X){return`${U.uniqueId}_${X}`}_getGlobalContextVariable(U,X){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",pF:{name:U,defaultValue:X,possibleValue:this._globalContextVariables[U]}}),this._hasGlobalContextVariable(U)?this._globalContextVariables[U]:X}_setGlobalContextVariable(U,X){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",pF:{name:U,value:X}}),this._globalContextVariables[U]=X}_deleteGlobalContextVariable(U){var X;null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",pF:{name:U}}),delete this._globalContextVariables[U]}_hasGlobalContextVariable(U){return U in this._globalContextVariables}_setExecutionVariable(U,X,b){this._executionVariables[this._getUniqueIdPrefixedName(U,X)]=b}_getExecutionVariable(U,X,b){return this._hasExecutionVariable(U,X)?this._executionVariables[this._getUniqueIdPrefixedName(U,X)]:b}_deleteExecutionVariable(U,X){delete this._executionVariables[this._getUniqueIdPrefixedName(U,X)]}_hasExecutionVariable(U,X){return this._getUniqueIdPrefixedName(U,X)in this._executionVariables}_hasConnectionValue(U){return U.uniqueId in this._connectionValues}_setConnectionValue(U,X){var b;this._connectionValues[U.uniqueId]=X,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",pF:{connectionPointId:U.uniqueId,value:X}})}_setConnectionValueByKey(U,X){this._connectionValues[U]=X}_getConnectionValue(U){var X;return null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",pF:{connectionPointId:U.uniqueId,value:this._connectionValues[U.uniqueId]}}),this._connectionValues[U.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(U){this._pendingBlocks.includes(U)||(this._pendingBlocks.push(U),this._pendingBlocks.sort(((U,X)=>U.priority-X.priority)))}_removePendingBlock(U){const X=this._pendingBlocks.indexOf(U);-1!==X&&this._pendingBlocks.splice(X,1)}_clearPendingBlocks(){for(const U of this._pendingBlocks)U._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(U){var X;this.onNodeExecutedObservable.notifyObservers(U),null===(X=this.logger)||void 0===X||X.addLogItem({time:Date.now(),className:U.getClassName(),uniqueId:U.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(U){this._setGlobalContextVariable("timeSinceStart",U.timeSinceStart),this._setGlobalContextVariable("deltaTime",U.deltaTime);for(const b of this._pendingBlocks){var X;null===(X=b._executeOnTick)||void 0===X||X.call(b,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.h;U.uniqueId=this.uniqueId,U._userVariables={};for(const F in this._userVariables)X(F,this._userVariables[F],U._userVariables);U._connectionValues={};for(const F in this._connectionValues)X(F,this._connectionValues[F],U._connectionValues);var b;this.assetsContext!==this.fU()&&(U._assetsContext={meshes:this.assetsContext.meshes.map((U=>U.id)),materials:this.assetsContext.materials.map((U=>U.id)),textures:this.assetsContext.textures.map((U=>U.name)),animations:this.assetsContext.animations.map((U=>U.name)),lights:this.assetsContext.lights.map((U=>U.id)),cameras:this.assetsContext.cameras.map((U=>U.id)),Vn:null===(b=this.assetsContext.Vn)||void 0===b?void 0:b.map((U=>U.name)),skeletons:this.assetsContext.skeletons.map((U=>U.id)),wn:this.assetsContext.wn.map((U=>U.name)),geometries:this.assetsContext.geometries.map((U=>U.id)),multiMaterials:this.assetsContext.multiMaterials.map((U=>U.id)),transformNodes:this.assetsContext.transformNodes.map((U=>U.id))})}getClassName(){return"FlowGraphContext"}}(0,w.c)([(0,Q.J)()],n.prototype,"uniqueId",void 0);var a=b(13303),J=b(11881);class m{constructor(U){this.onEventTriggeredObservable=new E.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=U,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.wb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const U=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",pF:{timeSinceStart:this._startingTime,deltaTime:U}}),this._startingTime+=U})),this._meshPickedObserver=this._scene.onPointerObservable.add((U=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",pF:U})}),J.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((U=>{const X=U.pointerId,b=U.mesh,F=this._pointerUnderMeshState[X];!F&&b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",pF:{pointerId:X,mesh:b}}):F&&!b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",pF:{pointerId:X,mesh:F}}):F&&b&&F!==b&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",pF:{pointerId:X,mesh:F,over:b}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",pF:{pointerId:X,mesh:b,out:F}})),this._pointerUnderMeshState[X]=b}),J.b.POINTERMOVE)}dispose(){var U,X,b,F,E;null===(U=this._sceneDisposeObserver)||void 0===U||U.remove(),null===(X=this._sceneReadyObserver)||void 0===X||X.remove(),null===(b=this._sceneOnBeforeRenderObserver)||void 0===b||b.remove(),null===(F=this._meshPickedObserver)||void 0===F||F.remove(),null===(E=this._meshUnderPointerObserver)||void 0===E||E.remove(),this.onEventTriggeredObservable.clear()}}var x,I=b(13315);!function(U){U[U.Stopped=0]="Stopped",U[U.Started=1]="Started"}(x||(x={}));class O{get state(){return this._state}set state(U){this._state=U,this.onStateChangedObservable.notifyObservers(U)}constructor(U){this.onStateChangedObservable=new E.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=U.xX,this._sceneEventCoordinator=new m(this._scene),this._coordinator=U.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((U=>{for(const X of this._executionContexts){const b=this._getContextualOrder(U.type,X);for(const F of b)if(!F._executeEvent(X,U.pF))break}switch(U.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const X of this._executionContexts)X._notifyOnTick(U.pF);break;case"SceneDispose":this.dispose()}}))}createContext(){const U=new n({xX:this._scene,coordinator:this._coordinator});return this._executionContexts.push(U),U}getContext(U){return this._executionContexts[U]}addEventBlock(U){if("PointerOver"!==U.type&&"PointerOut"!==U.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==U.type&&this._eventBlocks[U.type].push(U),1===this.state)for(const X of this._executionContexts)U._startPendingTasks(X);else this.onStateChangedObservable.addOnce((X=>{if(1===X)for(const b of this._executionContexts)U._startPendingTasks(b)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((U=>{1===U&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const U of this._executionContexts)for(const X in this._eventBlocks){const b=this._getContextualOrder(X,U);for(const X of b)X._startPendingTasks(U)}}_getContextualOrder(U,X){const b=this._eventBlocks[U].sort(((U,X)=>X.initPriority-U.initPriority));if("MeshPick"===U){const U=[];for(const F of b){const E=F.asset.getValue(X);let w=0;for(;w<b.length;w++){const U=b[w].asset.getValue(X);if(E&&U&&(0,I.l)(E,U))break}U.splice(w,0,F)}return U}return b}dispose(){var U;if(0!==this.state){this.state=0;for(const U of this._executionContexts)U._clearPendingBlocks();this._executionContexts.length=0;for(const U in this._eventBlocks)this._eventBlocks[U].length=0;null===(U=this._eventObserver)||void 0===U||U.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(U){const X=[],b=new Set;for(const F in this._eventBlocks)for(const U of this._eventBlocks[F])X.push(U),b.add(U.uniqueId);for(;X.length>0;){const F=X.pop();U(F);for(const U of F.dataInputs)for(const F of U._connectedPoint)b.has(F._ownerBlock.uniqueId)||(X.push(F._ownerBlock),b.add(F._ownerBlock.uniqueId));if(F instanceof a.d)for(const U of F.signalOutputs)for(const F of U._connectedPoint)b.has(F._ownerBlock.uniqueId)||(X.push(F._ownerBlock),b.add(F._ownerBlock.uniqueId))}}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},X=arguments.length>1?arguments[1]:void 0;U.allBlocks=[],this.visitAllBlocks((X=>{const b={};X.serialize(b),U.allBlocks.push(b)})),U.executionContexts=[];for(const b of this._executionContexts){const F={};b.serialize(F,X),U.executionContexts.push(F)}}}class N{constructor(U){this.config=U,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.xX.wb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.xX.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const U=this._executeOnNextFrame.slice(0);if(U.length)for(const X of U){this.notifyCustomEvent(X.id,X.data,!1);const U=this._executeOnNextFrame.findIndex((U=>U.uniqueId===X.uniqueId));-1!==U&&this._executeOnNextFrame.splice(U,1)}}));(N.SceneCoordinators.get(this.config.xX)??[]).push(this)}createGraph(){const U=new O({xX:this.config.xX,coordinator:this});return this._flowGraphs.push(U),U}removeGraph(U){const X=this._flowGraphs.indexOf(U);-1!==X&&(U.dispose(),this._flowGraphs.splice(X,1))}start(){for(const U of this._flowGraphs)U.start()}dispose(){var U,X;for(const E of this._flowGraphs)E.dispose();this._flowGraphs.length=0,null===(U=this._disposeObserver)||void 0===U||U.remove(),null===(X=this._onBeforeRenderObserver)||void 0===X||X.remove();const b=N.SceneCoordinators.get(this.config.xX)??[],F=b.indexOf(this);-1!==F&&b.splice(F,1)}serialize(U,X){U._flowGraphs=[];for(const b of this._flowGraphs){const F={};b.serialize(F,X),U._flowGraphs.push(F)}U.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(U){let X=this._customEventsMap.get(U);return X||(X=new E.e,this._customEventsMap.set(U,X)),X}notifyCustomEvent(U,X){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:U,data:X,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(U)){const X=this._eventExecutionCounter.get(U);if(this._eventExecutionCounter.set(U,X+1),X>=N.MaxEventTypeExecutionPerFrame)return void(X===N.MaxEventTypeExecutionPerFrame&&S.e.Warn(`FlowGraphCoordinator: Too many executions of event "${U}".`))}else this._eventExecutionCounter.set(U,1);const b=this._customEventsMap.get(U);b&&b.notifyObservers(X)}}N.MaxEventsPerType=30,N.MaxEventTypeExecutionPerFrame=30,N.SceneCoordinators=new Map},13323:(U,X,b)=>{"use strict";b.d(X,{e:()=>E});var F=b(13330);class E extends F.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(U){U._notifyExecuteNode(this),this.done._activateSignal(U)}}},13303:(U,X,b)=>{"use strict";b.d(X,{d:()=>z});var F=b(13308),E=b(13310),w=b(11551);class Q extends E.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(U){super.connectTo(U),this._connectedPoint.sort(((U,X)=>X.priority-U.priority))}_activateSignal(U){var X;if(null===(X=U.logger)||void 0===X||X.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,pF:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)U._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(U,this),U._increaseExecutionId();else for(const b of this._connectedPoint)b._activateSignal(U)}}(0,w.f)("FlowGraphSignalConnection",Q);class z extends F.d{constructor(U){super(U),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(U){const X=new Q(U,0,this);return this.signalInputs.push(X),X}_registerSignalOutput(U){const X=new Q(U,1,this);return this.signalOutputs.push(X),X}_unregisterSignalInput(U){const X=this.signalInputs.findIndex((X=>X.name===U));-1!==X&&(this.signalInputs[X].dispose(),this.signalInputs.splice(X,1))}_unregisterSignalOutput(U){const X=this.signalOutputs.findIndex((X=>X.name===U));-1!==X&&(this.signalOutputs[X].dispose(),this.signalOutputs.splice(X,1))}_reportError(U,X){this.error.pF="string"===typeof X?new Error(X):X,this.error._activateSignal(U)}getSignalInput(U){return this.signalInputs.find((X=>X.name===U))}getSignalOutput(U){return this.signalOutputs.find((X=>X.name===U))}serialize(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(U),U.signalInputs=[],U.signalOutputs=[];for(const X of this.signalInputs){const b={};X.serialize(b),U.signalInputs.push(b)}for(const X of this.signalOutputs){const b={};X.serialize(b),U.signalOutputs.push(b)}}deserialize(U){for(let X=0;X<U.signalInputs.length;X++){const b=this.getSignalInput(U.signalInputs[X].name);if(!b)throw new Error("Could not find signal input with name "+U.signalInputs[X].name+" in block "+U.className);b.deserialize(U.signalInputs[X])}for(let X=0;X<U.signalOutputs.length;X++){const b=this.getSignalOutput(U.signalOutputs[X].name);if(!b)throw new Error("Could not find signal output with name "+U.signalOutputs[X].name+" in block "+U.className);b.deserialize(U.signalOutputs[X])}}getClassName(){return"FlowGraphExecutionBlock"}}},13333:(U,X,b)=>{"use strict";b.d(X,{d:()=>E});var F=b(13303);class E extends F.d{constructor(U){super(U),this.out=this._registerSignalOutput("out")}}},13281:(U,X,b)=>{"use strict";b.d(X,{A:()=>a,C:()=>J,E:()=>m,F:()=>e,J:()=>l,L:()=>j,N:()=>f,b:()=>p,e:()=>n,h:()=>P,l:()=>x,n:()=>I,p:()=>O,s:()=>R,w:()=>i,z:()=>S});var F,E=b(11593),w=b(11636),Q=b(13276),z=b(13287);!function(U){U.Any="any",U.String="string",U.Number="number",U.Boolean="boolean",U.Object="object",U.Integer="FlowGraphInteger",U.Vector2="Vector2",U.JX="JX",U.Vector4="Vector4",U.Quaternion="Quaternion",U.Matrix="Matrix",U.Matrix2D="Matrix2D",U.Matrix3D="Matrix3D",U.NX="NX",U.eb="eb"}(F||(F={}));class q{constructor(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=U,this.defaultValue=X,this.animationType=b}serialize(U){U.typeName=this.typeName,U.defaultValue=this.defaultValue}}const p=new q("any",void 0),S=new q("string",""),R=new q("number",0,0),n=new q("boolean",!1),a=new q("Vector2",E.Vector2.Zero(),5),J=new q("JX",E.JX.Zero(),1),m=new q("Vector4",E.Vector4.Zero()),x=new q("Matrix",E.Matrix.Identity(),3),I=new q("Matrix2D",new z.b),O=new q("Matrix3D",new z.c),N=new q("NX",w.NX.Black(),4),u=new q("eb",new w.eb(0,0,0,0),7),i=new q("Quaternion",E.Quaternion.Identity(),2);i.typeTransformer=U=>{if(U.getClassName){if("Vector4"===U.getClassName())return E.Quaternion.uX(U.Jb());if("JX"===U.getClassName())return E.Quaternion.FromEulerVector(U);if("Matrix"===U.getClassName())return E.Quaternion.FromRotationMatrix(U)}return U};const P=new q("FlowGraphInteger",new Q.e(0),0);function f(U){const X=U;switch(typeof U){case"string":return S;case"number":return R;case"boolean":return n;case"object":if(X.getClassName)switch(X.getClassName()){case"Vector2":return a;case"JX":return J;case"Vector4":return m;case"Matrix":return x;case"NX":return N;case"eb":return u;case"Quaternion":return i;case"FlowGraphInteger":return P;case"Matrix2D":return I;case"Matrix3D":return O}return p;default:return p}}function j(U){switch(U){case"string":return S;case"number":return R;case"boolean":return n;case"Vector2":return a;case"JX":return J;case"Vector4":return m;case"Matrix":return x;case"NX":return N;case"eb":return u;case"Quaternion":return i;case"FlowGraphInteger":return P;case"Matrix2D":return I;case"Matrix3D":return O;default:return p}}function e(U){switch(U){case"number":default:return 0;case"Vector2":return 5;case"JX":return 1;case"Matrix":return 3;case"NX":return 4;case"eb":return 7;case"Quaternion":return 2}}function l(U){switch(U){case 0:return R;case 5:return a;case 1:return J;case 3:return x;case 4:return N;case 7:return u;case 2:return i;default:return p}}},13272:(U,X,b)=>{"use strict";b.d(X,{d:()=>S,h:()=>p,l:()=>R});var F=b(11636),E=b(11593),w=b(13276),Q=b(13281),z=b(13287);function q(U){return"Vector2"===U||"JX"===U||"Vector4"===U||"Quaternion"===U||"NX"===U||"eb"===U}function p(U,X,b){var F;const E=(null===X||void 0===X||null===(F=X.getClassName)||void 0===F?void 0:F.call(X))??"";if(q(E)||function(U){return"Matrix"===U||"Matrix2D"===U||"Matrix3D"===U}(E))b[U]={value:X.Jb(),className:E};else if("FlowGraphInteger"===E)b[U]={value:X.value,className:E};else if(E&&(X.id||X.name))b[U]={id:X.id,name:X.name,className:E};else{if("object"===typeof X)throw new Error(`Could not serialize value ${X}`);b[U]=X}}function S(U,X,b,p){const R=X[U];let n;const a=(null===R||void 0===R?void 0:R.type)??(null===R||void 0===R?void 0:R.className);if(function(U){return"Mesh"===U||"AbstractMesh"===U||"GroundMesh"===U||"InstanceMesh"===U||"LinesMesh"===U||"GoldbergMesh"===U||"GreasedLineMesh"===U||"TrailMesh"===U}(a)){let U=p.meshes.filter((U=>R.id?U.id===R.id:U.name===R.name));0===U.length&&(U=p.transformNodes.filter((U=>R.id?U.id===R.id:U.name===R.name))),n=R.uniqueId?U.find((U=>U.uniqueId===R.uniqueId)):U[0]}else if(q(a))n=function(U,X){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===U)return E.Vector2.uX(X);if("JX"===U)return b&&(X[2]*=-1),E.JX.uX(X);if("Vector4"===U)return E.Vector4.uX(X);if("Quaternion"===U)return b&&(X[2]*=-1,X[3]*=-1),E.Quaternion.uX(X);if("NX"===U)return new F.NX(X[0],X[1],X[2]);if("eb"===U)return new F.eb(X[0],X[1],X[2],X[3]);throw new Error(`Unknown vector class name ${U}`)}(a,R.value);else if(function(U){return"AnimationGroup"===U}(a)){const U=p.animationGroups.filter((U=>U.name===R.name));n=1===U.length?U[0]:U.find((U=>U.uniqueId===R.uniqueId))}else n="Matrix"===a?E.Matrix.uX(R.value):"Matrix2D"===a?new z.b(R.value):"Matrix3D"===a?new z.c(R.value):"FlowGraphInteger"===a?w.e.FromValue(R.value):"number"===a||"string"===a||"boolean"===a?R.value[0]:R&&void 0!==R.value?R.value:Array.isArray(R)?R.reduce(((U,X)=>X.eventData?(U[X.id]={type:(0,Q.L)(X.type)},"undefined"!==typeof X.value&&(U[X.id].value=S("value",X,b,p)),U):U),{}):R;return n}function R(U){return"FlowGraphJsonPointerParserBlock"===U}},13315:(U,X,b)=>{"use strict";function F(U,X){return!(!U.parent||U.parent!==X&&!F(U.parent,X))}function E(U){if(U.getClassName)return U.getClassName()}function w(U,X){return U===X&&("Vector2"===U||"JX"===U||"Vector4"===U||"Quaternion"===U)}function Q(U,X){return U===X&&("Matrix"===U||"Matrix2D"===U||"Matrix3D"===U)}function z(U,X){return"FlowGraphInteger"===U&&"FlowGraphInteger"===X}function q(U,X){const b="number"===typeof U||"number"===typeof(null===U||void 0===U?void 0:U.value);return b&&!X?!isNaN(p(U)):b}function p(U){return"number"===typeof U?U:U.value}b.d(X,{b:()=>z,e:()=>Q,g:()=>w,j:()=>E,l:()=>F,m:()=>p,p:()=>q})},12699:(U,X,b)=>{"use strict";b.r(X),b.d(X,{SceneInstrumentation:()=>w});var F=b(11385),E=b(11812);class w{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(U){U!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=U,U?(this._onBeforeActiveMeshesEvaluationObserver=this.xX.onBeforeActiveMeshesEvaluationObservable.add((()=>{F.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.xX.onAfterActiveMeshesEvaluationObservable.add((()=>{F.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.xX.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.xX.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(U){U!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=U,U?(this._onBeforeRenderTargetsRenderObserver=this.xX.onBeforeRenderTargetsRenderObservable.add((()=>{F.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.xX.onAfterRenderTargetsRenderObservable.add((()=>{F.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.xX.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.xX.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(U){U!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=U,U?(this._onBeforeParticlesRenderingObserver=this.xX.onBeforeParticlesRenderingObservable.add((()=>{F.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.xX.onAfterParticlesRenderingObservable.add((()=>{F.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.xX.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.xX.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(U){U!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=U,this.xX.spriteManagers&&(U?(this._onBeforeSpritesRenderingObserver=this.xX.onBeforeSpritesRenderingObservable.add((()=>{F.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.xX.onAfterSpritesRenderingObservable.add((()=>{F.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.xX.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.xX.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(U){U!==this._capturePhysicsTime&&this.xX.onBeforePhysicsObservable&&(this._capturePhysicsTime=U,U?(this._onBeforePhysicsObserver=this.xX.onBeforePhysicsObservable.add((()=>{F.Tools.StartPerformanceCounter("Yb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.xX.onAfterPhysicsObservable.add((()=>{F.Tools.EndPerformanceCounter("Yb"),this._physicsTime.endMonitoring()}))):(this.xX.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.xX.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(U){U!==this._captureAnimationsTime&&(this._captureAnimationsTime=U,U?this._onAfterAnimationsObserver=this.xX.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.xX.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(U){this._captureFrameTime=U}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(U){this._captureInterFrameTime=U}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(U){U!==this._captureRenderTime&&(this._captureRenderTime=U,U?(this._onBeforeDrawPhaseObserver=this.xX.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),F.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.xX.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),F.Tools.EndPerformanceCounter("Main render")}))):(this.xX.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.xX.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(U){U!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=U,U?(this._onBeforeCameraRenderObserver=this.xX.onBeforeCameraRenderObservable.add((U=>{this._cameraRenderTime.beginMonitoring(),F.Tools.StartPerformanceCounter(`Rendering camera ${U.name}`)})),this._onAfterCameraRenderObserver=this.xX.onAfterCameraRenderObservable.add((U=>{this._cameraRenderTime.endMonitoring(!1),F.Tools.EndPerformanceCounter(`Rendering camera ${U.name}`)}))):(this.xX.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.xX.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.xX.getEngine()._drawCalls}constructor(U){this.xX=U,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new E.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new E.e,this._captureFrameTime=!1,this._frameTime=new E.e,this._captureRenderTime=!1,this._renderTime=new E.e,this._captureInterFrameTime=!1,this._interFrameTime=new E.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new E.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new E.e,this._capturePhysicsTime=!1,this._physicsTime=new E.e,this._captureAnimationsTime=!1,this._animationsTime=new E.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new E.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=U.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(F.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.xX.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=U.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(F.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Eb(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Eb(),this._captureParticlesRenderTime&&this._particlesRenderTime.Eb(),this._captureSpritesRenderTime&&this._spritesRenderTime.Eb(),this._captureRenderTime&&this._renderTime.Eb(),this._captureCameraRenderTime&&this._cameraRenderTime.Eb()}))}dispose(){this._disposed||(this.xX.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.xX.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.xX.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.xX.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.xX.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.xX.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.xX.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.xX.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.xX.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.xX.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.xX.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.xX.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.xX.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.xX.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.xX.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.xX.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.xX.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.xX=null,this._disposed=!0)}}},13263:(U,X,b)=>{"use strict";b.d(X,{c:()=>S});var F=b(11576),E=b(11583),w=b(11593),Q=b(12034),z=b(12158),q=b(12210),p=b(11551);Q.c.AddNodeConstructor("Light_Type_1",((U,X)=>()=>new S(U,w.JX.Zero(),X)));class S extends q.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(U){this._shadowFrustumSize=U,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(U){this._shadowOrthoScale=U,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(U){this._orthoLeft=U}get orthoRight(){return this._orthoRight}set orthoRight(U){this._orthoRight=U}get orthoTop(){return this._orthoTop}set orthoTop(U){this._orthoTop=U}get orthoBottom(){return this._orthoBottom}set orthoBottom(U){this._orthoBottom=U}constructor(U,X,b){super(U,b),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=X.scale(-1),this.direction=X}getClassName(){return"Kb"}getTypeID(){return z.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(U,X,b){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(U):this._setDefaultAutoExtendShadowProjectionMatrix(U,X,b)}_setDefaultFixedFrustumShadowProjectionMatrix(U){const X=this.fU().activeCamera;X&&w.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:X.xb,void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,U,this.fU().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(U,X,b){const F=this.fU().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const U=w.JX.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let F=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let Q=0;Q<b.length;Q++){const z=b[Q];if(!z)continue;const q=z.getBoundingInfo().boundingBox;for(let b=0;b<q.vectorsWorld.length;b++)w.JX.TransformCoordinatesToRef(q.vectorsWorld[b],X,U),U.x<this._orthoLeft&&(this._orthoLeft=U.x),U.y<this._orthoBottom&&(this._orthoBottom=U.y),U.x>this._orthoRight&&(this._orthoRight=U.x),U.y>this._orthoTop&&(this._orthoTop=U.y),this.autoCalcShadowZBounds&&(U.z<F&&(F=U.z),U.z>E&&(E=U.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=F,this._shadowMaxZ=E)}const E=this._orthoRight-this._orthoLeft,Q=this._orthoTop-this._orthoBottom,z=void 0!==this.shadowMinZ?this.shadowMinZ:(null===F||void 0===F?void 0:F.xb)||0,q=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===F||void 0===F?void 0:F.maxZ)||1e4,p=this.fU().getEngine().useReverseDepthBuffer;w.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-E*this.shadowOrthoScale,this._orthoRight+E*this.shadowOrthoScale,this._orthoBottom-Q*this.shadowOrthoScale,this._orthoTop+Q*this.shadowOrthoScale,p?q:z,p?z:q,U,this.fU().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(U,X){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,X),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,X),this)}transferToNodeMaterialEffect(U,X){return this.computeTransformedInformation()?(U.setFloat3(X,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(U.setFloat3(X,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(U){const X=this._scene.getEngine();return!X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}getDepthMaxZ(U){const X=this._scene.getEngine();return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:1}prepareLightSpecificDefines(U,X){U["DIRLIGHT"+X]=!0}}(0,F.c)([(0,E.J)()],S.prototype,"shadowFrustumSize",null),(0,F.c)([(0,E.J)()],S.prototype,"shadowOrthoScale",null),(0,F.c)([(0,E.J)()],S.prototype,"autoUpdateExtends",void 0),(0,F.c)([(0,E.J)()],S.prototype,"autoCalcShadowZBounds",void 0),(0,F.c)([(0,E.J)("orthoLeft")],S.prototype,"_orthoLeft",void 0),(0,F.c)([(0,E.J)("orthoRight")],S.prototype,"_orthoRight",void 0),(0,F.c)([(0,E.J)("orthoTop")],S.prototype,"_orthoTop",void 0),(0,F.c)([(0,E.J)("orthoBottom")],S.prototype,"_orthoBottom",void 0),(0,p.f)("BABYLON.DirectionalLight",S)},13781:(U,X,b)=>{"use strict";b.d(X,{c:()=>S});var F=b(11576),E=b(11583),w=b(11593),Q=b(11636),z=b(12034),q=b(12158),p=b(11551);z.c.AddNodeConstructor("Light_Type_3",((U,X)=>()=>new S(U,w.JX.Zero(),X)));class S extends q.c{constructor(U,X,b){super(U,b),this.groundColor=new Q.NX(0,0,0),this.direction=X||w.JX.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Vb"}setDirectionToTarget(U){return this.direction=w.JX.Normalize(U.mX(w.JX.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(U,X){const b=w.JX.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",b.x,b.y,b.z,0,X),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.sb),X),this}transferToNodeMaterialEffect(U,X){const b=w.JX.Normalize(this.direction);return U.setFloat3(X,b.x,b.y,b.z),this}Ob(){return this._worldMatrix||(this._worldMatrix=w.Matrix.Identity()),this._worldMatrix}getTypeID(){return q.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(U,X){U["HEMILIGHT"+X]=!0}}(0,F.c)([(0,E.h)()],S.prototype,"groundColor",void 0),(0,F.c)([(0,E.F)()],S.prototype,"direction",void 0),(0,p.f)("BABYLON.HemisphericLight",S)},13227:(U,X,b)=>{"use strict";b.d(X,{c:()=>R});var F=b(11576),E=b(11583),w=b(11593),Q=b(12034),z=b(12158),q=b(12210),p=b(11570),S=b(11551);Q.c.AddNodeConstructor("Light_Type_2",((U,X)=>()=>new R(U,w.JX.Zero(),w.JX.Zero(),0,0,X)));class R extends q.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(U){this._iesProfileTexture!==U&&(this._iesProfileTexture=U,this._iesProfileTexture&&R._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(U){this._angle=U,this._cosHalfAngle=Math.cos(.5*U),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(U){this._innerAngle=U,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(U){this._shadowAngleScale=U,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(U){this._projectionTextureLightNear=U,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(U){this._projectionTextureLightFar=U,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(U){this._projectionTextureUpDirection=U,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(U){this._projectionTexture!==U&&(this._projectionTexture=U,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(R._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):R._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(U){return void 0!==U.onGeneratedObservable}static _IsTexture(U){return void 0!==U.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(U){this._projectionTextureProjectionLightMatrix=U,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(U,X,b,F,E,Q){super(U,Q),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=w.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=w.JX.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=w.JX.Zero(),this._projectionTextureViewLightMatrix=w.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=w.Matrix.Zero(),this._projectionTextureScalingMatrix=w.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=X,this.direction=b,this.angle=F,this.exponent=E}getClassName(){return"SpotLight"}getTypeID(){return z.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(U){super._setDirection(U),this._projectionTextureViewLightDirty=!0}_setPosition(U){super._setPosition(U),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(U,X,b){const F=this.fU().activeCamera;if(!F)return;this._shadowAngleScale=this._shadowAngleScale||1;const E=this._shadowAngleScale*this._angle,Q=void 0!==this.shadowMinZ?this.shadowMinZ:F.xb,z=void 0!==this.shadowMaxZ?this.shadowMaxZ:F.maxZ,q=this.fU().getEngine().useReverseDepthBuffer;w.Matrix.PerspectiveFovLHToRef(E,1,q?z:Q,q?Q:z,U,!0,this._scene.getEngine().isNDCHalfZRange,void 0,q)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),w.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const U=this.projectionTextureLightFar,X=this.projectionTextureLightNear,b=U/(U-X),F=-b*X,E=1/Math.tan(this._angle/2);w.Matrix.FromValuesToRef(E/1,0,0,0,0,E,0,0,0,0,b,1,0,0,F,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof p.c){const U=this._projectionTexture.uScale/2,X=this._projectionTexture.vScale/2;w.Matrix.FromValuesToRef(U,0,0,0,0,X,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(U,X){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),U.setMatrix("textureProjectionMatrix"+X,this._projectionTextureMatrix),U.setTexture("projectionLightTexture"+X,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&U.setTexture("iesLightTexture"+X,this._iesProfileTexture),this}transferToEffect(U,X){let b;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,X),b=w.JX.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,X),b=w.JX.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",b.x,b.y,b.z,this._cosHalfAngle,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,X),this}transferToNodeMaterialEffect(U,X){let b;return b=this.computeTransformedInformation()?w.JX.Normalize(this.transformedDirection):w.JX.Normalize(this.direction),this.fU().useRightHandedSystem?U.setFloat3(X,-b.x,-b.y,-b.z):U.setFloat3(X,b.x,b.y,b.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(U){const X=this._scene.getEngine(),b=void 0!==this.shadowMinZ?this.shadowMinZ:(null===U||void 0===U?void 0:U.xb)??0;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?b:this._scene.getEngine().isNDCHalfZRange?0:b}getDepthMaxZ(U){const X=this._scene.getEngine(),b=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===U||void 0===U?void 0:U.maxZ)??1e4;return X.useReverseDepthBuffer&&X.isNDCHalfZRange?0:b}prepareLightSpecificDefines(U,X){U["SPOTLIGHT"+X]=!0,U["PROJECTEDLIGHTTEXTURE"+X]=!(!this.projectionTexture||!this.projectionTexture.isReady()),U["IESLIGHTTEXTURE"+X]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,F.c)([(0,E.J)()],R.prototype,"angle",null),(0,F.c)([(0,E.J)()],R.prototype,"innerAngle",null),(0,F.c)([(0,E.J)()],R.prototype,"shadowAngleScale",null),(0,F.c)([(0,E.J)()],R.prototype,"exponent",void 0),(0,F.c)([(0,E.J)()],R.prototype,"projectionTextureLightNear",null),(0,F.c)([(0,E.J)()],R.prototype,"projectionTextureLightFar",null),(0,F.c)([(0,E.J)()],R.prototype,"projectionTextureUpDirection",null),(0,F.c)([(0,E.A)("projectedLightTexture")],R.prototype,"_projectionTexture",void 0),(0,S.f)("BABYLON.SpotLight",R)},12957:(U,X,b)=>{"use strict";b.d(X,{b:()=>Q,f:()=>w,g:()=>z});const F={},E={};function w(U,X){F[U]=X}function Q(U,X){E[U]=X}function z(U){return E[U]?E[U]:null}},12865:(U,X,b)=>{"use strict";b.d(X,{c:()=>f,e:()=>o});var F,E=b(11385),w=b(11392),Q=b(11833),z=b(11442),q=b(11408),p=b(12090),S=b(11448),R=b(11454),n=b(11555),a=b(11487),J=b(11436);!function(U){U[U.Clean=0]="Clean",U[U.Stop=1]="Stop",U[U.Sync=2]="Sync",U[U.NoSync=3]="NoSync"}(F||(F={}));const m=new w.e,x={};let I=!1;function O(){return x[".babylon"]}function N(U,X){const b=x[U];return b||(q.e.Warn("Unable to find a plugin to load "+U+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),X?O():void 0)}function u(U,X,b){let F="Unable to load from "+(U.rawData?"binary data":U.url);return X?F+=`: ${X}`:b&&(F+=`: ${b}`),F}async function i(U,X,b,F,E,w,Q,z,q){var p;const R="data:"===(n=U.url).substring(0,5)?n.substring(5):null;var n;if(U.rawData&&!Q)throw"When using ArrayBufferView to load data the file extension must be provided.";const I=R||Q?"":function(U){const X=U.indexOf("?");-1!==X&&(U=U.substring(0,X));const b=U.lastIndexOf(".");return U.substring(b,U.length).toLowerCase()}(U.url);let u=Q?N(Q,!0):R?function(U){for(const X in x){const b=x[X].plugin;if(b.canDirectLoad&&b.canDirectLoad(U))return x[X]}return O()}(U.url):N(I,!1);if(!u&&I){if(U.url&&!U.url.startsWith("blob:")){const X=await async function(U,X){const b=X.method||"GET";return await new Promise(((F,E)=>{const w=new J.b;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const U={};if(X.responseHeaders)for(const b of X.responseHeaders)U[b]=w.getResponseHeader(b)||"";F({response:w.response,headerValues:U})}else E(`Unable to fetch data from ${U}. Error code: ${w.status}`)})),w.open(b,U),w.send()}))}(U.url,{method:"HEAD",responseHeaders:["Content-Type"]}),b=X.headerValues?X.headerValues["Content-Type"]:"";b&&(u=function(U){for(const X in x){const b=x[X];if(b.mimeType===U)return b}}(b))}u||(u=O())}if(!u)throw new Error(`No plugin or fallback for ${Q??U.url}`);if(!1===(null===q||void 0===q||null===(p=q[u.plugin.name])||void 0===p?void 0:p.enabled))throw new Error(`The '${u.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(U.rawData&&!u.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(U=>{if(u.plugin.createPlugin){const X=u.plugin.createPlugin(q??{});return X instanceof Promise?(X.then(U).catch((U=>{E("Error instantiating plugin.",U)})),null):(U(X),X)}return U(u.plugin),u.plugin})((q=>{var p;if(!q)throw`The loader plugin corresponding to the '${Q}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(m.notifyObservers(q),R&&(q.canDirectLoad&&q.canDirectLoad(U.url)||!(0,S.k)(U.url))){if(q.directLoad){const U=q.directLoad(X,R);U instanceof Promise?U.then((U=>{b(q,U)})).catch((U=>{E("Error in directLoad of _loadData: "+U,U)})):b(q,U)}else b(q,R);return}const n=u.isBinary,J=(U,F)=>{X.R?E("Scene has been disposed"):b(q,U,F)};let x=null,I=!1;null===(p=q.wb)||void 0===p||p.add((()=>{I=!0,x&&(x.abort(),x=null),w()}));const O=()=>{if(I)return;const b=(U,X)=>{E(null===U||void 0===U?void 0:U.statusText,X)};if(!q.loadFile&&U.rawData)throw"Plugin does not support loading ArrayBufferView.";x=q.loadFile?q.loadFile(X,U.rawData||U.file||U.url,U.rootUrl,J,F,n,b,z):X._loadFile(U.file||U.url,J,F,!0,n,b)},N=X.getEngine();let i=N.enableOfflineSupport;if(i){let b=!1;for(const F of X.disableOfflineSupportExceptionRules)if(F.test(U.url)){b=!0;break}i=!b}i&&a.e.OfflineProviderFactory?X.offlineProvider=a.e.OfflineProviderFactory(U.url,O,N.disableManifestCheck):O()}))}function P(U,X){let b,F,w=null,Q=null;if(X)if(X.name)b=`file:${X.name}`,F=X.name,w=X;else if(ArrayBuffer.isView(X))b="",F=(0,n.c)(),Q=X;else if(X.startsWith("data:"))b=X,F="";else if(U){const w=X;if("/"===w.substring(0,1))return E.Tools.Error("Wrong sceneFilename parameter"),null;b=U+w,F=w}else b=X,F=E.Tools.GetFilename(X),U=E.Tools.GetFolderPath(X);else b=U,F=E.Tools.GetFilename(U),U=E.Tools.GetFolderPath(U);return{url:b,rootUrl:U,name:F,file:w,rawData:Q}}function f(U){if("string"===typeof U.extensions){const X=U.extensions;x[X.toLowerCase()]={plugin:U,isBinary:!1}}else{const X=U.extensions,b=Object.keys(X);for(const F of b)x[F.toLowerCase()]={plugin:U,isBinary:X[F].isBinary,mimeType:X[F].mimeType}}}async function j(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.c.LastCreatedScene,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",n=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!F)return q.e.Error("No scene available to import mesh to"),null;const a=P(X,b);if(!a)return null;const J={};F.addPendingData(J);const m=()=>{F.removePendingData(J)},x=(U,X)=>{const b=u(a,U,X);Q?Q(F,b,new R.g(b,R.f.SceneLoaderError,X)):q.e.Error(b),m()},I=w?U=>{try{w(U)}catch(X){x("Error in onProgress callback: "+X,X)}}:void 0,O=(U,X,b,w,Q,z,q,p)=>{if(F.importedMeshesFiles.push(a.url),E)try{E(U,X,b,w,Q,z,q,p)}catch(S){x("Error in onSuccess callback: "+S,S)}F.removePendingData(J)};return await i(a,F,((X,b,E)=>{if(X.rewriteRootURL&&(a.rootUrl=X.rewriteRootURL(a.rootUrl,E)),X.importMesh){const E=[],w=[],Q=[];if(!X.importMesh(U,F,b,a.rootUrl,E,w,Q,x))return;F.loadingPluginName=X.name,O(E,w,Q,[],[],[],[],[])}else{X.importMeshAsync(U,F,b,a.rootUrl,I,a.name).then((U=>{F.loadingPluginName=X.name,O(U.meshes,U.wn,U.skeletons,U.animationGroups,U.transformNodes,U.geometries,U.lights,U.spriteManagers)})).catch((U=>{x(U.message,U)}))}}),I,x,m,p,S,n)}async function e(U,X,b,F,E,w,Q,z){return await new Promise(((q,p)=>{try{j(U,X,b,F,((U,X,b,F,E,w,Q,z)=>{q({meshes:U,wn:X,skeletons:b,animationGroups:F,transformNodes:E,geometries:w,lights:Q,spriteManagers:z})}),E,((U,X,b)=>{p(b||new Error(X))}),w,Q,z).catch(p)}catch(R){p(R)}}))}async function l(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedEngine,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};b?await k(U,X,new Q.c(b),F,w,q,p,S,R):E.Tools.Error("No engine available")}async function d(U,X,b,F,E,w,Q){return await new Promise(((z,q)=>{l(U,X,b,(U=>{z(U)}),F,((U,X,b)=>{q(b||new Error(X))}),E,w,Q)}))}async function k(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedScene,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return q.e.Error("No scene available to append to"),null;const a=P(U,X);if(!a)return null;const J={};b.addPendingData(J);const m=()=>{b.removePendingData(J)};p.b.ShowLoadingScreen&&!I&&(I=!0,b.getEngine().displayLoadingUI(),b.executeWhenReady((()=>{b.getEngine().hideLoadingUI(),I=!1})));const x=(U,X)=>{const F=u(a,U,X);w?w(b,F,new R.g(F,R.f.SceneLoaderError,X)):q.e.Error(F),m()},O=E?U=>{try{E(U)}catch(X){x("Error in onProgress callback",X)}}:void 0,N=()=>{if(F)try{F(b)}catch(U){x("Error in onSuccess callback",U)}b.removePendingData(J)};return await i(a,b,((U,X)=>{if(U.load){if(!U.load(b,X,a.rootUrl,x))return;b.loadingPluginName=U.name,N()}else{U.loadAsync(b,X,a.rootUrl,O,a.name).then((()=>{b.loadingPluginName=U.name,N()})).catch((U=>{x(U.message,U)}))}}),O,x,m,Q,S,n)}async function v(U,X,b,F,E,w,Q){return await new Promise(((z,q)=>{try{k(U,X,b,(U=>{z(U)}),F,((U,X,b)=>{q(b||new Error(X))}),E,w,Q).catch(q)}catch(R){q(R)}}))}async function A(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedScene,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return q.e.Error("No scene available to load asset container to"),null;const n=P(U,X);if(!n)return null;const a={};b.addPendingData(a);const J=()=>{b.removePendingData(a)},m=(U,X)=>{const F=u(n,U,X);w?w(b,F,new R.g(F,R.f.SceneLoaderError,X)):q.e.Error(F),J()},x=E?U=>{try{E(U)}catch(X){m("Error in onProgress callback",X)}}:void 0,I=U=>{if(F)try{F(U)}catch(X){m("Error in onSuccess callback",X)}b.removePendingData(a)};return await i(n,b,((U,X)=>{if(U.loadAssetContainer){const F=U.loadAssetContainer(b,X,n.rootUrl,m);if(!F)return;F.populateRootNodes(),b.loadingPluginName=U.name,I(F)}else if(U.loadAssetContainerAsync){U.loadAssetContainerAsync(b,X,n.rootUrl,x,n.name).then((X=>{X.populateRootNodes(),b.loadingPluginName=U.name,I(X)})).catch((U=>{m(U.message,U)}))}else m("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),x,m,J,Q,p,S)}async function s(U,X,b,F,E,w,Q){return await new Promise(((z,q)=>{try{A(U,X,b,(U=>{z(U)}),F,((U,X,b)=>{q(b||new Error(X))}),E,w,Q).catch(q)}catch(R){q(R)}}))}async function h(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.c.LastCreatedScene,F=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,n=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",a=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!b)return void q.e.Error("No scene available to load animations to");if(F){for(const F of b.animatables)F.reset();b.stopAllAnimations();const U=b.animationGroups.slice();for(const b of U)b.dispose();const X=b.getNodes();for(const b of X)b.animations&&(b.animations=[])}else switch(E){case 0:const U=b.animationGroups.slice();for(const X of U)X.dispose();break;case 1:for(const X of b.animationGroups)X.stop();break;case 2:for(const X of b.animationGroups)X.reset(),X.restart();break;case 3:break;default:return void q.e.Error("Unknown animation group loading mode value '"+E+"'")}const J=b.animatables.length;await A(U,X,b,(U=>{U.mergeAnimationsTo(b,b.animatables.slice(J),w),U.dispose(),b.onAnimationFileImportedObservable.notifyObservers(b),Q&&Q(b)}),p,S,R,n,a)}async function B(U,X,b,F,E,w,Q,z,q,p){return await new Promise(((S,n)=>{try{h(U,X,b,F,E,w,(U=>{S(U)}),Q,((U,X,b)=>{n(b||new Error(X))}),z,q,p).catch(n)}catch(R){n(R)}}))}class o{static get ForceFullSceneLoadingForIncremental(){return p.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(U){p.b.ForceFullSceneLoadingForIncremental=U}static get ShowLoadingScreen(){return p.b.ShowLoadingScreen}static set ShowLoadingScreen(U){p.b.ShowLoadingScreen=U}static get loggingLevel(){return p.b.loggingLevel}static set loggingLevel(U){p.b.loggingLevel=U}static get CleanBoneMatrixWeights(){return p.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(U){p.b.CleanBoneMatrixWeights=U}static GetDefaultPlugin(){return O()}static GetPluginForExtension(U){var X;return null===(X=N(U,!0))||void 0===X?void 0:X.plugin}static IsPluginForExtensionAvailable(U){return function(U){return!!x[U]}(U)}static RegisterPlugin(U){f(U)}static ImportMesh(U,X,b,F,E,w,Q,q,p){j(U,X,b,F,E,w,Q,q,p).catch((U=>null===Q||void 0===Q?void 0:Q(z.c.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async ImportMeshAsync(U,X,b,F,E,w,Q){return await e(U,X,b,F,E,w,Q)}static Load(U,X,b,F,E,w,Q,q){l(U,X,b,F,E,w,Q,q).catch((U=>null===w||void 0===w?void 0:w(z.c.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async LoadAsync(U,X,b,F,E,w){return await d(U,X,b,F,E,w)}static Append(U,X,b,F,E,w,Q,q){k(U,X,b,F,E,w,Q,q).catch((U=>null===w||void 0===w?void 0:w(b??z.c.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async AppendAsync(U,X,b,F,E,w){return await v(U,X,b,F,E,w)}static LoadAssetContainer(U,X,b,F,E,w,Q,q){A(U,X,b,F,E,w,Q,q).catch((U=>null===w||void 0===w?void 0:w(b??z.c.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async LoadAssetContainerAsync(U,X,b,F,E,w){return await s(U,X,b,F,E,w)}static ImportAnimations(U,X,b,F,E,w,Q,q,p,S,R){h(U,X,b,F,E,w,Q,q,p,S,R).catch((U=>null===p||void 0===p?void 0:p(b??z.c.LastCreatedScene,null===U||void 0===U?void 0:U.message,U)))}static async ImportAnimationsAsync(U,X,b,F,E,w,Q,z,q,p,S){return await B(U,X,b,F,E,w,z,p,S)}}o.NO_LOGGING=0,o.MINIMAL_LOGGING=1,o.SUMMARY_LOGGING=2,o.DETAILED_LOGGING=3,o.OnPluginActivatedObservable=m},13243:(U,X,b)=>{"use strict";b.d(X,{d:()=>n});var F=b(11576),E=b(11583),w=b(11385),Q=b(11593),z=b(11612),q=b(11570),p=b(11551),S=b(11392),R=b(11623);b(13250);class n extends z.b{set boundingBoxSize(U){if(this._boundingBoxSize&&this._boundingBoxSize.equals(U))return;this._boundingBoxSize=U;const X=this.fU();X&&X.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(U){this._rotationY=U,this.setReflectionTextureMatrix(Q.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(U,X,b){let F="";for(const E of U)F+=E;return new n(F,X,null,b,U)}static CreateFromPrefilteredData(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=X.useDelayedTextureLoading;X.useDelayedTextureLoading=!1;const w=new n(U,X,null,!1,null,null,null,void 0,!0,b,F);return X.useDelayedTextureLoading=E,w}constructor(U,X){var b;let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,J=arguments.length>10&&void 0!==arguments[10]&&arguments[10],m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,x=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,I=arguments.length>13?arguments[13]:void 0,O=arguments.length>14?arguments[14]:void 0;super(X),this.onLoadObservable=new S.e,this.boundingBoxPosition=Q.JX.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Q.Matrix,this._buffer=null,this.name=U,this.url=U,this._noMipmap=E,this.mb=!1,this.isCube=!0,this._textureMatrix=Q.Matrix.Identity(),this.coordinatesMode=q.c.CUBIC_MODE;let N=null,u=null;null===F||Array.isArray(F)?(this._noMipmap=E,this._format=R,this._createPolynomials=J,N=F,this._loaderOptions=I,this._useSRGBBuffer=O,this._lodScale=m,this._lodOffset=x):(N=F.extensions??null,this._noMipmap=F.noMipmap??!1,w=F.files??null,u=F.buffer??null,this._format=F.format??5,n=F.prefiltered??!1,a=F.forcedExtension??null,this._createPolynomials=F.createPolynomials??!1,this._lodScale=F.lodScale??.8,this._lodOffset=F.lodOffset??0,this._loaderOptions=F.loaderOptions,this._useSRGBBuffer=F.useSRGBBuffer,z=F.H??null,p=F.onError??null),(U||w)&&this.updateURL(U,a,z,n,p,N,null===(b=this.fU())||void 0===b?void 0:b.useDelayedTextureLoading,w,u)}getClassName(){return"CubeTexture"}updateURL(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=U),this.url=U,X&&(this._forcedExtension=X);const p=U.lastIndexOf("."),S=X||(p>-1?U.substring(p).toLowerCase():""),R=0===S.indexOf(".dds"),n=0===S.indexOf(".env"),a=0===S.indexOf(".basis");if(n?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=F,F&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),z)this._files=z;else if(a||n||R||w||(w=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,w){for(let X=0;X<w.length;X++)this._files.push(U+w[X]);this._extensions=w}this._buffer=q,Q?(this.delayLoadState=4,this._delayedOnLoad=b,this._delayedOnError=E):this._loadTexture(b,E)}delayLoad(U){4===this.delayLoadState&&(U&&(this._forcedExtension=U),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(U){var X,b;if(U.updateFlag===this._textureMatrix.updateFlag)return;U.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(b=this.fU())||void 0===b||b.markAllMaterialsAsDirty(1,(U=>-1!==U.getActiveTextures().indexOf(this))));if(this._textureMatrix=U,null===(X=this.fU())||void 0===X||!X.useRightHandedSystem)return;const F=Q.TmpVectors.JX[0],E=Q.TmpVectors.Quaternion[0],w=Q.TmpVectors.JX[1];this._textureMatrix.decompose(F,E,w),E.z*=-1,E.w*=-1,Q.Matrix.ComposeToRef(F,E,w,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var U;return null!==(U=this.fU())&&void 0!==U&&U.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this.fU(),F=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const E=()=>{var X;(this.onLoadObservable.notifyObservers(this),F)&&(F.dispose(),null===(X=this.fU())||void 0===X||X.markAllMaterialsAsDirty(1));U&&U()},Q=(U,b)=>{this._loadingError=!0,this._errorObject={message:U,exception:b},X&&X(U,b),q.c.OnTextureLoadErrorObservable.notifyObservers(this)};var z;this._texture?this._texture.isReady?w.Tools.SetImmediate((()=>E())):this._texture.onLoadedObservable.add((()=>E())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,b,this._lodScale,this._lodOffset,U,Q,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,b,this._files,this._noMipmap,U,Q,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(z=this._texture)||void 0===z||z.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(U,X,b){const F=R.d.Parse((()=>{let F=!1;return U.prefiltered&&(F=U.prefiltered),new n(b+(U.url??U.name),X,U.extensions,!1,U.files||null,null,null,void 0,F,U.forcedExtension)}),U,X);if(U.boundingBoxPosition&&(F.boundingBoxPosition=Q.JX.uX(U.boundingBoxPosition)),U.boundingBoxSize&&(F.boundingBoxSize=Q.JX.uX(U.boundingBoxSize)),U.animations)for(let E=0;E<U.animations.length;E++){const X=U.animations[E],b=(0,p.c)("BABYLON.Animation");b&&F.animations.push(b.Parse(X))}return F}clone(){let U=0;const X=R.d.Clone((()=>{const X=new n(this.url,this.fU()||this._getEngine(),this._extensions,this._noMipmap,this._files);return U=X.uniqueId,X}),this);return X.uniqueId=U,X}}(0,F.c)([(0,E.J)()],n.prototype,"url",void 0),(0,F.c)([(0,E.F)()],n.prototype,"boundingBoxPosition",void 0),(0,F.c)([(0,E.F)()],n.prototype,"boundingBoxSize",null),(0,F.c)([(0,E.J)("rotationY")],n.prototype,"rotationY",null),(0,F.c)([(0,E.J)("files")],n.prototype,"_files",void 0),(0,F.c)([(0,E.J)("forcedExtension")],n.prototype,"_forcedExtension",void 0),(0,F.c)([(0,E.J)("extensions")],n.prototype,"_extensions",void 0),(0,F.c)([(0,E.p)("textureMatrix")],n.prototype,"_textureMatrix",void 0),(0,F.c)([(0,E.p)("textureMatrixRefraction")],n.prototype,"_textureMatrixRefraction",void 0),q.c._CubeTextureParser=n.Parse,(0,p.f)("BABYLON.CubeTexture",n)},13796:(U,X,b)=>{"use strict";b.d(X,{b:()=>q});var F=b(11408),E=b(11570),w=b(11561),Q=b(11726),z=b(11528);Q.ThinEngine.prototype.createDynamicTexture=function(U,X,b,F){const E=new z.e(this,4);return E.baseWidth=U,E.baseHeight=X,b&&(U=this.needPOTTextures?(0,w.d)(U,this._caps.maxTextureSize):U,X=this.needPOTTextures?(0,w.d)(X,this._caps.maxTextureSize):X),E.width=U,E.height=X,E.isReady=!1,E.generateMipMaps=b,E.samplingMode=F,this.updateTextureSamplingMode(F,E),this._internalTexturesCache.push(E),E},Q.ThinEngine.prototype.updateDynamicTexture=function(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!U)return;const Q=this._gl,z=Q.TEXTURE_2D,q=this._bindTextureDirectly(z,U,!0,w);this._unpackFlipY(void 0===b?U.invertY:b),F&&Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const p=this._getWebGLTextureType(U.type),S=this._getInternalFormat(E||U.format),R=this._getRGBABufferInternalSizedFormat(U.type,S);Q.texImage2D(z,0,R,S,p,X),U.generateMipMaps&&Q.generateMipmap(z),q||this._bindTextureDirectly(z,null),F&&Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),E&&(U.format=E),U._dynamicTextureSource=X,U._premulAlpha=F,U.invertY=b||!1,U.isReady=!0};class q extends E.c{constructor(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,z=arguments.length>6?arguments[6]:void 0;const q=!b||b._isScene;super(null,q?b:null===b||void 0===b?void 0:b.xX,q?!F:b,z,w,void 0,void 0,void 0,void 0,Q),this.name=U,this.wrapU=E.c.CLAMP_ADDRESSMODE,this.wrapV=E.c.CLAMP_ADDRESSMODE,this._generateMipMaps=F;const p=this._getEngine();if(!p)return;if(X.getContext)this._canvas=X,this._ownCanvas=!1,this._texture=p.createDynamicTexture(this._canvas.width,this._canvas.height,F,w);else{this._canvas=p.createCanvas(1,1),this._ownCanvas=!0;const U=X;U.width||0===U.width?this._texture=p.createDynamicTexture(U.width,U.height,F,w):this._texture=p.createDynamicTexture(X,X,F,w)}const S=this.getSize();this._canvas.width!==S.width&&(this._canvas.width=S.width),this._canvas.height!==S.height&&(this._canvas.height=S.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(U){this._canvas.width=U.width,this._canvas.height=U.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(U.width,U.height,this._generateMipMaps,this.samplingMode)}scale(U){const X=this.getSize();X.width*=U,X.height*=U,this._recreate(X)}scaleTo(U,X){const b=this.getSize();b.width=U,b.height=X,this._recreate(b)}getContext(){return this._context}clear(U){const X=this.getSize();U&&(this._context.fillStyle=U),this._context.clearRect(0,0,X.width,X.height)}update(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===U||U,X,this._format||void 0,void 0,b)}drawText(U,X,b,F,E,w,Q){let z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const q=this.getSize();if(w&&(this._context.fillStyle=w,this._context.fillRect(0,0,q.width,q.height)),this._context.font=F,null===X||void 0===X){const b=this._context.measureText(U);X=(q.width-b.width)/2}if(null===b||void 0===b){const U=parseInt(F.replace(/\D/g,""));b=q.height/2+U/3.65}this._context.fillStyle=E||"",this._context.fillText(U,X,b),z&&this.update(Q)}dispose(){var U,X;(super.dispose(),this._ownCanvas)&&(null===(U=this._canvas)||void 0===U||null===(X=U.remove)||void 0===X||X.call(U));this._canvas=null,this._context=null}clone(){const U=this.fU();if(!U)return this;const X=this.getSize(),b=new q(this.name,X,U,this._generateMipMaps);return b.mb=this.mb,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b}serialize(){const U=this.fU();U&&!U.isReady()&&F.e.Warn("The scene must be ready before serializing the dynamic texture");const X=super.serialize();return q._IsCanvasElement(this._canvas)&&(X.base64String=this._canvas.toDataURL()),X.invertY=this._invertY,X.samplingMode=this.samplingMode,X}static _IsCanvasElement(U){return void 0!==U.toDataURL}_rebuild(){this.update()}}},13147:(U,X,b)=>{"use strict";b.d(X,{b:()=>E});var F=b(11570);class E extends F.c{get depth(){return this._depth}constructor(U,X,b,E,w,Q){let z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:F.c.TRILINEAR_SAMPLINGMODE,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,R=arguments.length>10?arguments[10]:void 0;super(null,Q,!z,q),this.format=w,this._texture=Q.getEngine().createRawTexture2DArray(U,X,b,E,w,z,q,p,null,S,R),this._depth=E,this.is2DArray=!0}update(U){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,U,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(U,X,b,F,w){return new E(U,X,b,F,5,w,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12976:(U,X,b)=>{"use strict";b.d(X,{b:()=>z,c:()=>q,e:()=>w,f:()=>Q});var F=b(11608),E=b(11593);function w(U,X){return`{X: ${U.x.toFixed(X)} Y: ${U.y.toFixed(X)}}`}function Q(U,X){return`{X: ${U._x.toFixed(X)} Y: ${U._y.toFixed(X)} Z: ${U._z.toFixed(X)}}`}function z(U,X){return 2*Math.acos((0,F.Clamp)(E.Quaternion.Dot(U,X)))}function q(U,X){const b=new E.Quaternion;return function(U,X,b){const w=E.JX.Cross(U,X),Q=Math.acos((0,F.Clamp)(E.JX.Dot(U,X),-1,1));E.Quaternion.RotationAxisToRef(w,Q,b)}(U,X,b),b}},12822:(U,X,b)=>{"use strict";b.d(X,{e:()=>p});var F=b(11593),E=b(11636),w=b(12067),Q=b(12047),z=b(11650);b(12827);function q(U){let X=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],w=[];let q=[];const p=U.width||U.size||1,S=U.height||U.size||1,R=U.depth||U.size||1,n=U.wrap||!1;let a=void 0===U.topBaseAt?1:U.topBaseAt,J=void 0===U.bottomBaseAt?0:U.bottomBaseAt;a=(a+4)%4,J=(J+4)%4;let m=[2,0,3,1][a],x=[2,0,1,3][J],I=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(n){X=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],I=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let U=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],b=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const F=[17,18,19,16],E=[22,23,20,21];for(;m>0;)U.unshift(U.pop()),F.unshift(F.pop()),m--;for(;x>0;)b.unshift(b.pop()),E.unshift(E.pop()),x--;U=U.flat(),b=b.flat(),I=I.concat(U).concat(b),X.push(F[0],F[2],F[3],F[0],F[1],F[2]),X.push(E[0],E[2],E[3],E[0],E[1],E[2])}const O=[p/2,S/2,R/2];q=I.reduce(((U,X,b)=>U.concat(X*O[b%3])),[]);const N=0===U.sideOrientation?0:U.sideOrientation||Q.d.DEFAULTSIDE,u=U.faceUV||new Array(6),i=U.faceColors,P=[];for(let Q=0;Q<6;Q++)void 0===u[Q]&&(u[Q]=new F.Vector4(0,0,1,1)),i&&void 0===i[Q]&&(i[Q]=new E.eb(1,1,1,1));for(let F=0;F<6;F++)if(w.push(u[F].z,z.b?1-u[F].w:u[F].w),w.push(u[F].x,z.b?1-u[F].w:u[F].w),w.push(u[F].x,z.b?1-u[F].y:u[F].y),w.push(u[F].z,z.b?1-u[F].y:u[F].y),i)for(let U=0;U<4;U++)P.push(i[F].r,i[F].g,i[F].b,i[F].a);Q.d._ComputeSides(N,q,X,b,w,U.frontUVs,U.backUVs);const f=new Q.d;if(f.indices=X,f.eU=q,f.lU=b,f.kU=w,i){const U=N===Q.d.DOUBLESIDE?P.concat(P):P;f.dU=U}return f}function p(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new w.e(U,b);X.sideOrientation=w.e._GetDefaultSideOrientation(X.sideOrientation),F._originalBuilderSideOrientation=X.sideOrientation;return q(X).AU(F,X.updatable),F}Q.d.CreateBox=q,w.e.CreateBox=function(U,X){return p(U,{size:X,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12966:(U,X,b)=>{"use strict";b.d(X,{b:()=>z});var F=b(12067),E=b(12047),w=b(11650);function Q(U){const X=[],b=[],F=[],Q=[],z=U.radius||.5,q=U.tessellation||64,p=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,S=0===U.sideOrientation?0:U.sideOrientation||E.d.DEFAULTSIDE;X.push(0,0,0),Q.push(.5,.5);const R=2*Math.PI*p,n=1===p?R/q:R/(q-1);let a=0;for(let E=0;E<q;E++){const U=Math.cos(a),b=Math.sin(a),F=(U+1)/2,E=(1-b)/2;X.push(z*U,z*b,0),Q.push(F,w.b?1-E:E),a+=n}1===p&&(X.push(X[3],X[4],X[5]),Q.push(Q[2],w.b?1-Q[3]:Q[3]));const J=X.length/3;for(let E=1;E<J-1;E++)b.push(E+1,0,E);E.d.ComputeNormals(X,b,F),E.d._ComputeSides(S,X,b,F,Q,U.frontUVs,U.backUVs);const m=new E.d;return m.indices=b,m.eU=X,m.lU=F,m.kU=Q,m}function z(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new F.e(U,b);X.sideOrientation=F.e._GetDefaultSideOrientation(X.sideOrientation),E._originalBuilderSideOrientation=X.sideOrientation;return Q(X).AU(E,X.updatable),E}E.d.CreateDisc=Q,F.e.CreateDisc=function(U,X,b){return z(U,{radius:X,tessellation:b,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12827:(U,X,b)=>{"use strict";b.d(X,{c:()=>x,b:()=>O,g:()=>I});var F=b(11593),E=b(11636),w=b(12067),Q=b(12047),z=b(11664);w.e._GroundMeshParser=(U,X)=>q.Parse(U,X);class q extends w.e{constructor(U,X){super(U,X),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=U,this._subdivisionsY=U,this.subdivide(U);const b=this;b.createOrUpdateSubmeshesOctree&&b.createOrUpdateSubmeshesOctree(X)}getHeightAtCoordinates(U,X){const b=this.getWorldMatrix(),E=F.TmpVectors.Matrix[5];b.invertToRef(E);const w=F.TmpVectors.JX[8];if(F.JX.TransformCoordinatesFromFloatsToRef(U,0,X,E,w),U=w.x,X=w.z,U<this._minX||U>=this._maxX||X<=this._minZ||X>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Q=this._getFacetAt(U,X),z=-(Q.x*U+Q.z*X+Q.w)/Q.y;return F.JX.TransformCoordinatesFromFloatsToRef(0,z,0,b,w),w.y}getNormalAtCoordinates(U,X){const b=new F.JX(0,1,0);return this.getNormalAtCoordinatesToRef(U,X,b),b}getNormalAtCoordinatesToRef(U,X,b){const E=this.getWorldMatrix(),w=F.TmpVectors.Matrix[5];E.invertToRef(w);const Q=F.TmpVectors.JX[8];if(F.JX.TransformCoordinatesFromFloatsToRef(U,0,X,w,Q),U=Q.x,X=Q.z,U<this._minX||U>this._maxX||X<this._minZ||X>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const z=this._getFacetAt(U,X);return F.JX.TransformNormalFromFloatsToRef(z.x,z.y,z.z,E,b),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(U,X){const b=Math.floor((U+this._maxX)*this._subdivisionsX/this._width),F=Math.floor(-(X+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),E=this._heightQuads[F*this._subdivisionsX+b];let w;return w=X<E.slope.x*U+E.slope.y?E.facet1:E.facet2,w}_initHeightQuads(){const U=this._subdivisionsX,X=this._subdivisionsY;this._heightQuads=[];for(let b=0;b<X;b++)for(let X=0;X<U;X++){const E={slope:F.Vector2.Zero(),facet1:new F.Vector4(0,0,0,0),facet2:new F.Vector4(0,0,0,0)};this._heightQuads[b*U+X]=E}return this}_computeHeightQuads(){const U=this.getVerticesData(z.h.PositionKind);if(!U)return this;const X=F.TmpVectors.JX[3],b=F.TmpVectors.JX[2],E=F.TmpVectors.JX[1],w=F.TmpVectors.JX[0],Q=F.TmpVectors.JX[4],q=F.TmpVectors.JX[5],p=F.TmpVectors.JX[6],S=F.TmpVectors.JX[7],R=F.TmpVectors.JX[8];let n=0,a=0,J=0,m=0,x=0,I=0,O=0;const N=this._subdivisionsX,u=this._subdivisionsY;for(let z=0;z<u;z++)for(let u=0;u<N;u++){n=3*u,a=z*(N+1)*3,J=(z+1)*(N+1)*3,X.x=U[a+n],X.y=U[a+n+1],X.z=U[a+n+2],b.x=U[a+n+3],b.y=U[a+n+4],b.z=U[a+n+5],E.x=U[J+n],E.y=U[J+n+1],E.z=U[J+n+2],w.x=U[J+n+3],w.y=U[J+n+4],w.z=U[J+n+5],m=(w.z-X.z)/(w.x-X.x),x=X.z-m*X.x,b.subtractToRef(X,Q),E.subtractToRef(X,q),w.subtractToRef(X,p),F.JX.CrossToRef(p,q,S),F.JX.CrossToRef(Q,p,R),S.normalize(),R.normalize(),I=-(S.x*X.x+S.y*X.y+S.z*X.z),O=-(R.x*b.x+R.y*b.y+R.z*b.z);const i=this._heightQuads[z*N+u];i.slope.Pb(m,x),i.facet1.Pb(S.x,S.y,S.z,I),i.facet2.Pb(R.x,R.y,R.z,O)}return this}serialize(U){super.serialize(U),U.subdivisionsX=this._subdivisionsX,U.subdivisionsY=this._subdivisionsY,U.minX=this._minX,U.maxX=this._maxX,U.xb=this._minZ,U.maxZ=this._maxZ,U.width=this._width,U.height=this._height}static Parse(U,X){const b=new q(U.name,X);return b._subdivisionsX=U.subdivisionsX||1,b._subdivisionsY=U.subdivisionsY||1,b._minX=U.minX,b._maxX=U.maxX,b._minZ=U.xb,b._maxZ=U.maxZ,b._width=U.width,b._height=U.height,b}}var p=b(11385),S=b(11442),R=b(11597),n=b(11650);function a(U){const X=[],b=[],E=[],w=[];let z,q;const p=U.width||U.size||1,S=U.height||U.size||1,R=0|(U.subdivisionsX||U.subdivisions||1),a=0|(U.subdivisionsY||U.subdivisions||1);for(z=0;z<=a;z++)for(q=0;q<=R;q++){const U=new F.JX(q*p/R-p/2,0,(a-z)*S/a-S/2),X=new F.JX(0,1,0);b.push(U.x,U.y,U.z),E.push(X.x,X.y,X.z),w.push(q/R,n.b?z/a:1-z/a)}for(z=0;z<a;z++)for(q=0;q<R;q++)X.push(q+1+(z+1)*(R+1)),X.push(q+1+z*(R+1)),X.push(q+z*(R+1)),X.push(q+(z+1)*(R+1)),X.push(q+1+(z+1)*(R+1)),X.push(q+z*(R+1));const J=new Q.d;return J.indices=X,J.eU=b,J.lU=E,J.kU=w,J}function J(U){const X=void 0!==U.xmin&&null!==U.xmin?U.xmin:-1,b=void 0!==U.zmin&&null!==U.zmin?U.zmin:-1,E=void 0!==U.xmax&&null!==U.xmax?U.xmax:1,w=void 0!==U.zmax&&null!==U.zmax?U.zmax:1,z=U.subdivisions||{w:1,h:1},q=U.precision||{w:1,h:1},p=[],S=[],R=[],n=[];let a,J,m,x;z.h=z.h<1?1:z.h,z.w=z.w<1?1:z.w,q.w=q.w<1?1:q.w,q.h=q.h<1?1:q.h;const I=(E-X)/z.w,O=(w-b)/z.h;function N(U,X,b,E){const w=S.length/3,Q=q.w+1;for(a=0;a<q.h;a++)for(J=0;J<q.w;J++){const U=[w+J+a*Q,w+(J+1)+a*Q,w+(J+1)+(a+1)*Q,w+J+(a+1)*Q];p.push(U[1]),p.push(U[2]),p.push(U[3]),p.push(U[0]),p.push(U[1]),p.push(U[3])}const z=F.JX.Zero(),m=new F.JX(0,1,0);for(a=0;a<=q.h;a++)for(z.z=a*(E-X)/q.h+X,J=0;J<=q.w;J++)z.x=J*(b-U)/q.w+U,z.y=0,S.push(z.x,z.y,z.z),R.push(m.x,m.y,m.z),n.push(J/q.w,a/q.h)}for(m=0;m<z.h;m++)for(x=0;x<z.w;x++)N(X+x*I,b+m*O,X+(x+1)*I,b+(m+1)*O);const u=new Q.d;return u.indices=p,u.eU=S,u.lU=R,u.kU=n,u}function m(U){const X=[],b=[],w=[],z=[];let q,p;const S=U.colorFilter||new E.NX(.3,.59,.11),n=U.alphaFilter||0;let a=!1;if(U.minHeight>U.maxHeight){a=!0;const X=U.maxHeight;U.maxHeight=U.minHeight,U.minHeight=X}for(q=0;q<=U.subdivisions;q++)for(p=0;p<=U.subdivisions;p++){const X=new F.JX(p*U.width/U.subdivisions-U.width/2,0,(U.subdivisions-q)*U.height/U.subdivisions-U.height/2),E=4*(((X.x+U.width/2)/U.width*(U.bufferWidth-1)|0)+((1-(X.z+U.height/2)/U.height)*(U.bufferHeight-1)|0)*U.bufferWidth);let Q=U.buffer[E]/255,J=U.buffer[E+1]/255,m=U.buffer[E+2]/255;const x=U.buffer[E+3]/255;a&&(Q=1-Q,J=1-J,m=1-m);const I=Q*S.r+J*S.g+m*S.b;X.y=x>=n?U.minHeight+(U.maxHeight-U.minHeight)*I:U.minHeight-R.d,U.heightBuffer&&(U.heightBuffer[q*(U.subdivisions+1)+p]=X.y),b.push(X.x,X.y,X.z),w.push(0,0,0),z.push(p/U.subdivisions,1-q/U.subdivisions)}for(q=0;q<U.subdivisions;q++)for(p=0;p<U.subdivisions;p++){const F=p+1+(q+1)*(U.subdivisions+1),E=p+1+q*(U.subdivisions+1),w=p+q*(U.subdivisions+1),Q=p+(q+1)*(U.subdivisions+1),z=b[3*F+1]>=U.minHeight,S=b[3*E+1]>=U.minHeight,R=b[3*w+1]>=U.minHeight;z&&S&&R&&(X.push(F),X.push(E),X.push(w));b[3*Q+1]>=U.minHeight&&z&&R&&(X.push(Q),X.push(F),X.push(w))}Q.d.ComputeNormals(b,X,w);const J=new Q.d;return J.indices=X,J.eU=b,J.lU=w,J.kU=z,J}function x(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=new q(U,arguments.length>2?arguments[2]:void 0);b._setReady(!1),b._subdivisionsX=X.subdivisionsX||X.subdivisions||1,b._subdivisionsY=X.subdivisionsY||X.subdivisions||1,b._width=X.width||1,b._height=X.height||1,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ;return a(X).AU(b,X.updatable),b._setReady(!0),b}function I(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new w.e(U,b);return J(X).AU(F,X.updatable),F}function O(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const w=b.width||10,Q=b.height||10,z=b.subdivisions||1,R=b.minHeight||0,n=b.maxHeight||1,a=b.colorFilter||new E.NX(.3,.59,.11),J=b.alphaFilter||0,x=b.updatable,I=b.onReady;F=F||S.c.LastCreatedScene;const O=new q(U,F);let N;O._subdivisionsX=z,O._subdivisionsY=z,O._width=w,O._height=Q,O._maxX=O._width/2,O._maxZ=O._height/2,O._minX=-O._maxX,O._minZ=-O._maxZ,O._setReady(!1),b.passHeightBufferInCallback&&(N=new Float32Array((z+1)*(z+1)));const u=(U,X,b)=>{m({width:w,height:Q,subdivisions:z,minHeight:R,maxHeight:n,colorFilter:a,buffer:U,bufferWidth:X,bufferHeight:b,alphaFilter:J,heightBuffer:N}).AU(O,x),I&&I(O,N),O._setReady(!0)};if("string"===typeof X){const U=U=>{var X;const b=U.width,E=U.height;if(F.R)return;const w=null===(X=F)||void 0===X?void 0:X.getEngine().resizeImageBitmap(U,b,E);u(w,b,E)};p.Tools.LoadImage(X,U,b.onError?b.onError:()=>{},F.offlineProvider)}else u(X.data,X.width,X.height);return O}Q.d.CreateGround=a,Q.d.CreateTiledGround=J,Q.d.CreateGroundFromHeightMap=m,w.e.CreateGround=(U,X,b,F,E,w)=>x(U,{width:X,height:b,subdivisions:F,updatable:w},E),w.e.CreateTiledGround=(U,X,b,F,E,w,Q,z,q)=>I(U,{xmin:X,zmin:b,xmax:F,zmax:E,subdivisions:w,precision:Q,updatable:q},z),w.e.CreateGroundFromHeightMap=(U,X,b,F,E,w,Q,z,q,p,S)=>O(U,X,{width:b,height:F,subdivisions:E,minHeight:w,maxHeight:Q,updatable:q,onReady:p,alphaFilter:S},z)},13459:(U,X,b)=>{"use strict";b.d(X,{d:()=>a,h:()=>R,k:()=>n});var F=b(11593),E=b(12067),w=b(12047),Q=b(12161),z=b(11664),q=b(11408);function p(U){const X=[],b=[],F=U.lines,E=U.dU,Q=[];let z=0;for(let w=0;w<F.length;w++){const U=F[w];for(let F=0;F<U.length;F++){const{x:q,y:p,z:S}=U[F];if(b.push(q,p,S),E){const U=E[w],{r:X,g:b,b:z,a:q}=U[F];Q.push(X,b,z,q)}F>0&&(X.push(z-1),X.push(z)),z++}}const q=new w.d;return q.indices=X,q.eU=b,E&&(q.dU=Q),q}function S(U){const X=U.dashSize||3,b=U.gapSize||1,E=U.dashNb||200,Q=U.points,z=[],q=[],p=F.JX.Zero();let S=0,R=0,n=0,a=0,J=0,m=0,x=0;for(x=0;x<Q.length-1;x++)Q[x+1].subtractToRef(Q[x],p),S+=p.length();for(n=S/E,a=X*n/(X+b),x=0;x<Q.length-1;x++){Q[x+1].subtractToRef(Q[x],p),R=Math.floor(p.length()/n),p.normalize();for(let U=0;U<R;U++)J=n*U,z.push(Q[x].x+J*p.x,Q[x].y+J*p.y,Q[x].z+J*p.z),z.push(Q[x].x+(J+a)*p.x,Q[x].y+(J+a)*p.y,Q[x].z+(J+a)*p.z),q.push(m,m+1),m+=2}const I=new w.d;return I.eU=z,I.indices=q,I}function R(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=X.instance,E=X.lines,w=X.dU;if(F){const U=F.getVerticesData(z.h.PositionKind);let X,b;w&&(X=F.getVerticesData(z.h.ColorKind));let Q=0,q=0;for(let F=0;F<E.length;F++){const z=E[F];for(let E=0;E<z.length;E++)U[Q]=z[E].x,U[Q+1]=z[E].y,U[Q+2]=z[E].z,w&&X&&(b=w[F],X[q]=b[E].r,X[q+1]=b[E].g,X[q+2]=b[E].b,X[q+3]=b[E].a,q+=4),Q+=3}return F.updateVerticesData(z.h.PositionKind,U,!1,!1),w&&X&&F.updateVerticesData(z.h.ColorKind,X,!1,!1),F.refreshBoundingInfo(),F}const q=!!w,S=new Q.e(U,b,null,void 0,void 0,q,X.useVertexAlpha,X.material);return p(X).AU(S,X.updatable),S}function n(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=X.dU?[X.dU]:null;return R(U,{lines:[X.points],updatable:X.updatable,instance:X.instance,dU:F,useVertexAlpha:X.useVertexAlpha,material:X.material},b)}function a(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=X.points,z=X.instance,p=X.gapSize||1,R=X.dashSize||3;if(z){const U=U=>{const X=F.JX.Zero(),b=U.length/6;let E=0,Q=0,q=0,p=0,S=0,R=0,n=0,a=0;for(n=0;n<w.length-1;n++)w[n+1].subtractToRef(w[n],X),E+=X.length();q=E/b;const J=z._creationDataStorage.dashSize;for(p=J*q/(J+z._creationDataStorage.gapSize),n=0;n<w.length-1;n++)for(w[n+1].subtractToRef(w[n],X),Q=Math.floor(X.length()/q),X.normalize(),a=0;a<Q&&R<U.length;)S=q*a,U[R]=w[n].x+S*X.x,U[R+1]=w[n].y+S*X.y,U[R+2]=w[n].z+S*X.z,U[R+3]=w[n].x+(S+p)*X.x,U[R+4]=w[n].y+(S+p)*X.y,U[R+5]=w[n].z+(S+p)*X.z,R+=6,a++;for(;R<U.length;)U[R]=w[n].x,U[R+1]=w[n].y,U[R+2]=w[n].z,R+=3};return(X.dashNb||X.dashSize||X.gapSize||X.useVertexAlpha||X.material)&&q.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),z.updateMeshPositions(U,!1),z}const n=new Q.e(U,b,null,void 0,void 0,void 0,X.useVertexAlpha,X.material);return S(X).AU(n,X.updatable),n._creationDataStorage=new E.f,n._creationDataStorage.dashSize=R,n._creationDataStorage.gapSize=p,n}w.d.CreateLineSystem=p,w.d.CreateDashedLines=S,E.e.dp=function(U,X){return n(U,{points:X,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},E.e.CreateDashedLines=function(U,X,b,F,E){return a(U,{points:X,dashSize:b,gapSize:F,dashNb:E,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12868:(U,X,b)=>{"use strict";b.d(X,{d:()=>z,f:()=>q});var F=b(12067),E=b(12047),w=b(11650);function Q(U){const X=[],b=[],F=[],Q=[],z=void 0!==U.width?U.width:void 0!==U.size?U.size:1,q=void 0!==U.height?U.height:void 0!==U.size?U.size:1,p=0===U.sideOrientation?0:U.sideOrientation||E.d.DEFAULTSIDE,S=z/2,R=q/2;b.push(-S,-R,0),F.push(0,0,-1),Q.push(0,w.b?1:0),b.push(S,-R,0),F.push(0,0,-1),Q.push(1,w.b?1:0),b.push(S,R,0),F.push(0,0,-1),Q.push(1,w.b?0:1),b.push(-S,R,0),F.push(0,0,-1),Q.push(0,w.b?0:1),X.push(0),X.push(1),X.push(2),X.push(0),X.push(2),X.push(3),E.d._ComputeSides(p,b,X,F,Q,U.frontUVs,U.backUVs);const n=new E.d;return n.indices=X,n.eU=b,n.lU=F,n.kU=Q,n}function z(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new F.e(U,b);X.sideOrientation=F.e._GetDefaultSideOrientation(X.sideOrientation),E._originalBuilderSideOrientation=X.sideOrientation;return Q(X).AU(E,X.updatable),X.sourcePlane&&(E.translate(X.sourcePlane.normal,-X.sourcePlane.d),E.setDirection(X.sourcePlane.normal.scale(-1))),E}const q={Ap:z};E.d.Ap=Q,F.e.Ap=(U,X,b,F,E)=>z(U,{size:X,width:X,height:X,sideOrientation:E,updatable:F},b)},12950:(U,X,b)=>{"use strict";b.d(X,{e:()=>q});var F=b(11593),E=b(12067),w=b(12047),Q=b(11650);function z(U){const X=0|(U.segments||32),b=U.diameterX||U.diameter||1,E=U.diameterY||U.diameter||1,z=U.diameterZ||U.diameter||1,q=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,p=U.slice&&U.slice<=0?1:U.slice||1,S=0===U.sideOrientation?0:U.sideOrientation||w.d.DEFAULTSIDE,R=!!U.dedupTopBottomIndices,n=new F.JX(b/2,E/2,z/2),a=2+X,J=2*a,m=[],x=[],I=[],O=[];for(let w=0;w<=a;w++){const U=w/a,X=U*Math.PI*p;for(let b=0;b<=J;b++){const E=b/J,w=E*Math.PI*2*q,z=F.Matrix.RotationZ(-X),p=F.Matrix.RotationY(w),S=F.JX.TransformCoordinates(F.JX.Up(),z),R=F.JX.TransformCoordinates(S,p),a=R.multiply(n),m=R.divide(n).normalize();x.push(a.x,a.y,a.z),I.push(m.x,m.y,m.z),O.push(E,Q.b?1-U:U)}if(w>0){const U=x.length/3;for(let X=U-2*(J+1);X+J+2<U;X++)R?(w>1&&(m.push(X),m.push(X+1),m.push(X+J+1)),(w<a||p<1)&&(m.push(X+J+1),m.push(X+1),m.push(X+J+2))):(m.push(X),m.push(X+1),m.push(X+J+1),m.push(X+J+1),m.push(X+1),m.push(X+J+2))}}w.d._ComputeSides(S,x,m,I,O,U.frontUVs,U.backUVs);const N=new w.d;return N.indices=m,N.eU=x,N.lU=I,N.kU=O,N}function q(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new E.e(U,b);X.sideOrientation=E.e._GetDefaultSideOrientation(X.sideOrientation),F._originalBuilderSideOrientation=X.sideOrientation;return z(X).AU(F,X.updatable),F}w.d.CreateSphere=z,E.e.CreateSphere=(U,X,b,F,E,w)=>q(U,{segments:X,diameterX:b,diameterY:b,diameterZ:b,sideOrientation:w,updatable:E},F)},13807:(U,X,b)=>{"use strict";b.d(X,{b:()=>z});var F=b(12179),E=b(13258),w=b(12200),Q=b(12047);class z{static get Configuration(){return{get decoder(){return E.c.DefaultConfiguration},set decoder(U){E.c.DefaultConfiguration=U}}}static set Configuration(U){E.c.DefaultConfiguration=U.decoder}static get DecoderAvailable(){return(0,F.f)(E.c.DefaultConfiguration)}static get Default(){return z._Default??(z._Default=new z),z._Default}static ResetDefault(U){z._Default&&(U||z._Default.dispose(),z._Default=null)}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.DefaultNumWorkers;const X="number"===typeof U?{...E.c.DefaultConfiguration,numWorkers:U}:{...E.c.DefaultConfiguration,...U};this._decoder=new E.c(X)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(U,X,b){return this._decoder.decodeMeshToMeshDataAsync(U,X,b)}async decodeMeshToGeometryAsync(U,X,b,F){return await this._decoder.decodeMeshToGeometryAsync(U,X,b,F)}async _decodeMeshToGeometryForGltfAsync(U,X,b,F,E,w){return await this._decoder._decodeMeshToGeometryForGltfAsync(U,X,b,F,E,w)}async decodeMeshAsync(U,X){const b=await this._decoder.decodeMeshToMeshDataAsync(U,X),F=new Q.d;b.indices&&(F.indices=b.indices);for(const E of b.attributes){const U=w.e.GetFloatData(E.data,E.size,w.e.GetDataType(E.data),E.byteOffset,E.byteStride,E.normalized,b.totalVertices);F.set(U,E.kind)}return F}}z.DefaultNumWorkers=(0,F.d)(),z._Default=null},13258:(U,X,b)=>{"use strict";b.d(X,{c:()=>p});var F=b(12179),E=b(11385),w=b(12083),Q=b(12200),z=b(11408),q=b(12193);class p extends F.b{static get DefaultAvailable(){return(0,F.f)(p.DefaultConfiguration)}static get Default(){return p._Default??(p._Default=new p),p._Default}static ResetDefault(U){p._Default&&(U||p._Default.dispose(),p._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(U,X){return{module:await(X||DracoDecoderModule)({wasmBinary:U})}}_getWorkerContent(){return`${q.c}(${q.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.DefaultConfiguration)}decodeMeshToMeshDataAsync(U,X,b){const F=U instanceof ArrayBuffer?new Int8Array(U):new Int8Array(U.buffer,U.byteOffset,U.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async U=>await new Promise(((E,w)=>{U.push(((U,Q)=>{let q=null;const p=[],S=X=>{U.removeEventListener("error",S),U.removeEventListener("message",R),w(X),Q()},R=X=>{const F=X.data;switch(F.id){case"indices":q=F.data;break;case"attribute":p.push({kind:F.kind,data:F.data,size:F.size,byteOffset:F.byteOffset,byteStride:F.byteStride,normalized:(w=F.kind,n=F.normalized,b&&void 0!==b[w]?(n!==b[w]&&z.e.Warn(`Normalized flag from Draco data (${n}) does not match normalized flag from glTF accessor (${b[w]}). Using flag from glTF accessor.`),b[w]):n)});break;case"decodeMeshDone":U.removeEventListener("error",S),U.removeEventListener("message",R),E({indices:q,attributes:p,totalVertices:F.totalVertices}),Q()}var w,n};U.addEventListener("error",S),U.addEventListener("message",R);const n=F.slice();U.postMessage({id:"decodeMesh",dataView:n,attributes:X},[n.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((U=>{let b=null;const E=[],w=(0,q.c)(U.module,F,X,(U=>{b=U}),((U,X,b,F,w,Q)=>{E.push({kind:U,data:X,size:b,byteOffset:F,byteStride:w,normalized:Q})}));return{indices:b,attributes:E,totalVertices:w}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(U,X,b,F){const E=await this.decodeMeshToMeshDataAsync(b,F),z=new w.c(U,X);E.indices&&z.setIndices(E.indices);for(const w of E.attributes)z.setVerticesBuffer(new Q.e(X.getEngine(),w.data,w.kind,!1,void 0,w.byteStride,void 0,w.byteOffset,w.size,void 0,w.normalized,!0),E.totalVertices);return z}async _decodeMeshToGeometryForGltfAsync(U,X,b,F,E,z){const q=await this.decodeMeshToMeshDataAsync(b,F,E),p=new w.c(U,X);z&&(p._boundingInfo=z,p.useBoundingInfoFromGeometry=!0),q.indices&&p.setIndices(q.indices);for(const w of q.attributes)p.setVerticesBuffer(new Q.e(X.getEngine(),w.data,w.kind,!1,void 0,w.byteStride,void 0,w.byteOffset,w.size,void 0,w.normalized,!0),q.totalVertices);return p}}p.DefaultConfiguration={wasmUrl:`${E.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},p._Default=null},13452:(U,X,b)=>{"use strict";b.d(X,{c:()=>zU});var F=b(11593),E=b(12067),w=b(11664),Q=b(12047),z=b(11650);function q(U){let X=U.pathArray;const b=U.closeArray||!1,F=U.closePath||!1,E=U.invertUV||!1,q=Math.floor(X[0].length/2);let p=U.offset||q;p=p>q?q:Math.floor(p);const S=0===U.sideOrientation?0:U.sideOrientation||Q.d.DEFAULTSIDE,R=U.kU,n=U.dU,a=[],J=[],m=[],x=[],I=[],O=[],N=[],u=[];let i;const P=[],f=[];let j,e,l;if(X.length<2){const U=[],b=[];for(e=0;e<X[0].length-p;e++)U.push(X[0][e]),b.push(X[0][e+p]);X=[U,b]}let d=0;const k=F?1:0,v=b?1:0;let A,s,h,B,o,y;for(i=X[0].length,j=0;j<X.length+v;j++){for(N[j]=0,I[j]=[0],A=j===X.length?X[0]:X[j],s=A.length,i=i<s?i:s,l=0;l<s;)a.push(A[l].x,A[l].y,A[l].z),l>0&&(h=A[l].mX(A[l-1]).length(),B=h+N[j],I[j].push(B),N[j]=B),l++;F&&(l--,a.push(A[0].x,A[0].y,A[0].z),h=A[l].mX(A[0]).length(),B=h+N[j],I[j].push(B),N[j]=B),P[j]=s+k,f[j]=d,d+=s+k}let t,W,Y=null,K=null;for(e=0;e<i+k;e++)for(u[e]=0,O[e]=[0],j=0;j<X.length-1+v;j++)o=X[j],y=j===X.length-1?X[0]:X[j+1],e===i?(Y=o[0],K=y[0]):(Y=o[e],K=y[e]),h=K.mX(Y).length(),B=h+u[e],O[e].push(B),u[e]=B;if(R)for(j=0;j<R.length;j++)x.push(R[j].x,z.b?1-R[j].y:R[j].y);else for(j=0;j<X.length+v;j++)for(e=0;e<i+k;e++)t=0!=N[j]?I[j][e]/N[j]:0,W=0!=u[e]?O[e][j]/u[e]:0,E?x.push(W,t):x.push(t,z.b?1-W:W);j=0;let V=0,g=P[j]-1,L=P[j+1]-1,D=g<L?g:L,G=f[1]-f[0];const Z=P.length-1;for(;V<=D&&j<Z;)J.push(V,V+G,V+1),J.push(V+G+1,V+1,V+G),V+=1,V===D&&(j++,G=f[j+1]-f[j],g=P[j]-1,L=P[j+1]-1,V=f[j],D=g<L?g+V:L+V);if(Q.d.ComputeNormals(a,J,m),F){let U=0,b=0;for(j=0;j<X.length;j++){U=3*f[j],b=j+1<X.length?3*(f[j+1]-1):m.length-3,m[U]=.5*(m[U]+m[b]),m[U+1]=.5*(m[U+1]+m[b+1]),m[U+2]=.5*(m[U+2]+m[b+2]);const F=Math.sqrt(m[U]*m[U]+m[U+1]*m[U+1]+m[U+2]*m[U+2]);m[U]/=F,m[U+1]/=F,m[U+2]/=F,m[b]=m[U],m[b+1]=m[U+1],m[b+2]=m[U+2]}}if(b){let U=3*f[0],b=3*f[X.length];for(e=0;e<i+k;e++){m[U]=.5*(m[U]+m[b]),m[U+1]=.5*(m[U+1]+m[b+1]),m[U+2]=.5*(m[U+2]+m[b+2]);const X=Math.sqrt(m[U]*m[U]+m[U+1]*m[U+1]+m[U+2]*m[U+2]);m[U]/=X,m[U+1]/=X,m[U+2]/=X,m[b]=m[U],m[b+1]=m[U+1],m[b+2]=m[U+2],U+=3,b+=3}}Q.d._ComputeSides(S,a,J,m,x,U.frontUVs,U.backUVs);let c=null;if(n){c=new Float32Array(4*n.length);for(let U=0;U<n.length;U++)c[4*U]=n[U].r,c[4*U+1]=n[U].g,c[4*U+2]=n[U].b,c[4*U+3]=n[U].a}const r=new Q.d,M=new Float32Array(a),H=new Float32Array(m),T=new Float32Array(x);return r.indices=J,r.eU=M,r.lU=H,r.kU=T,c&&r.set(c,w.h.ColorKind),F&&(r._idx=f),r}function p(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=X.pathArray,S=X.closeArray,R=X.closePath,n=E.e._GetDefaultSideOrientation(X.sideOrientation),a=X.instance,J=X.updatable;if(a){const U=F.TmpVectors.JX[0].jb(Number.MAX_VALUE),b=F.TmpVectors.JX[1].jb(-Number.MAX_VALUE),q=X=>{let F=p[0].length;const w=a;let Q=0;const z=w._originalBuilderSideOrientation===E.e.DOUBLESIDE?2:1;for(let E=1;E<=z;++E)for(let z=0;z<p.length;++z){const E=p[z],q=E.length;F=F<q?F:q;for(let w=0;w<F;++w){const F=E[w];X[Q]=F.x,X[Q+1]=F.y,X[Q+2]=F.z,U.minimizeInPlaceFromFloats(F.x,F.y,F.z),b.maximizeInPlaceFromFloats(F.x,F.y,F.z),Q+=3}if(w._creationDataStorage&&w._creationDataStorage.closePath){const U=E[0];X[Q]=U.x,X[Q+1]=U.y,X[Q+2]=U.z,Q+=3}}},S=a.getVerticesData(w.h.PositionKind);if(q(S),a.hasBoundingInfo?a.getBoundingInfo().reConstruct(U,b,a._worldMatrix):a.buildBoundingInfo(U,b,a._worldMatrix),a.updateVerticesData(w.h.PositionKind,S,!1,!1),X.dU){const U=a.getVerticesData(w.h.ColorKind);for(let b=0,F=0;b<X.dU.length;b++,F+=4){const E=X.dU[b];U[F]=E.r,U[F+1]=E.g,U[F+2]=E.b,U[F+3]=E.a}a.updateVerticesData(w.h.ColorKind,U,!1,!1)}if(X.kU){const U=a.getVerticesData(w.h.UVKind);for(let b=0;b<X.kU.length;b++)U[2*b]=X.kU[b].x,U[2*b+1]=z.b?1-X.kU[b].y:X.kU[b].y;a.updateVerticesData(w.h.UVKind,U,!1,!1)}if(!a.areNormalsFrozen||a.isFacetDataEnabled){const U=a.ub(),X=a.getVerticesData(w.h.NormalKind),b=a.isFacetDataEnabled?a.getFacetDataParameters():null;if(Q.d.ComputeNormals(S,U,X,b),a._creationDataStorage&&a._creationDataStorage.closePath){let U=0,b=0;for(let F=0;F<p.length;F++)U=3*a._creationDataStorage.idx[F],b=F+1<p.length?3*(a._creationDataStorage.idx[F+1]-1):X.length-3,X[U]=.5*(X[U]+X[b]),X[U+1]=.5*(X[U+1]+X[b+1]),X[U+2]=.5*(X[U+2]+X[b+2]),X[b]=X[U],X[b+1]=X[U+1],X[b+2]=X[U+2]}a.areNormalsFrozen||a.updateVerticesData(w.h.NormalKind,X,!1,!1)}return a}{const F=new E.e(U,b);F._originalBuilderSideOrientation=n,F._creationDataStorage=new E.f;const w=q(X);return R&&(F._creationDataStorage.idx=w._idx),F._creationDataStorage.closePath=R,F._creationDataStorage.closeArray=S,w.AU(F,J),F}}Q.d.CreateRibbon=q,E.e.CreateRibbon=function(U,X){return p(U,{pathArray:X,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var S=b(12966),R=b(12822),n=b(11636);function a(U){const X=U.pattern||E.e.NO_FLIP,b=U.tileWidth||U.tileSize||1,F=U.tileHeight||U.tileSize||1,w=U.alignHorizontal||0,z=U.alignVertical||0,q=U.width||U.size||1,p=Math.floor(q/b);let S=q-p*b;const R=U.height||U.size||1,n=Math.floor(R/F);let a=R-n*F;const J=b*p/2,m=F*n/2;let x=0,I=0,O=0,N=0,u=0,i=0;if(S>0||a>0){switch(O=-J,N=-m,u=J,i=m,w){case E.e.CENTER:S/=2,O-=S,u+=S;break;case E.e.LEFT:u+=S,x=-S/2;break;case E.e.RIGHT:O-=S,x=S/2}switch(z){case E.e.CENTER:a/=2,N-=a,i+=a;break;case E.e.BOTTOM:i+=a,I=-a/2;break;case E.e.TOP:N-=a,I=a/2}}const P=[],f=[],j=[];j[0]=[0,0,1,0,1,1,0,1],j[1]=[0,0,1,0,1,1,0,1],X!==E.e.ROTATE_TILE&&X!==E.e.ROTATE_ROW||(j[1]=[1,1,0,1,0,0,1,0]),X!==E.e.FLIP_TILE&&X!==E.e.FLIP_ROW||(j[1]=[1,0,0,0,0,1,1,1]),X!==E.e.FLIP_N_ROTATE_TILE&&X!==E.e.FLIP_N_ROTATE_ROW||(j[1]=[0,1,1,1,1,0,0,0]);let e=[];const l=[],d=[];let k=0;for(let Q=0;Q<n;Q++)for(let U=0;U<p;U++)P.push(U*b-J+x,Q*F-m+I,0),P.push((U+1)*b-J+x,Q*F-m+I,0),P.push((U+1)*b-J+x,(Q+1)*F-m+I,0),P.push(U*b-J+x,(Q+1)*F-m+I,0),d.push(k,k+1,k+3,k+1,k+2,k+3),e=X===E.e.FLIP_TILE||X===E.e.ROTATE_TILE||X===E.e.FLIP_N_ROTATE_TILE?e.concat(j[(U%2+Q%2)%2]):X===E.e.FLIP_ROW||X===E.e.ROTATE_ROW||X===E.e.FLIP_N_ROTATE_ROW?e.concat(j[Q%2]):e.concat(j[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),k+=4;if(S>0||a>0){const U=a>0&&(z===E.e.CENTER||z===E.e.TOP),Q=a>0&&(z===E.e.CENTER||z===E.e.BOTTOM),q=S>0&&(w===E.e.CENTER||w===E.e.RIGHT),R=S>0&&(w===E.e.CENTER||w===E.e.LEFT);let j,v,A,s,h=[];if(U&&q&&(P.push(O+x,N+I,0),P.push(-J+x,N+I,0),P.push(-J+x,N+a+I,0),P.push(O+x,N+a+I,0),d.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,j=1-S/b,v=1-a/F,A=1,s=1,h=[j,v,A,v,A,s,j,s],X===E.e.ROTATE_ROW&&(h=[1-j,1-v,1-A,1-v,1-A,1-s,1-j,1-s]),X===E.e.FLIP_ROW&&(h=[1-j,v,1-A,v,1-A,s,1-j,s]),X===E.e.FLIP_N_ROTATE_ROW&&(h=[j,1-v,A,1-v,A,1-s,j,1-s]),e=e.concat(h),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&R&&(P.push(J+x,N+I,0),P.push(u+x,N+I,0),P.push(u+x,N+a+I,0),P.push(J+x,N+a+I,0),d.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,j=0,v=1-a/F,A=S/b,s=1,h=[j,v,A,v,A,s,j,s],(X===E.e.ROTATE_ROW||X===E.e.ROTATE_TILE&&p%2===0)&&(h=[1-j,1-v,1-A,1-v,1-A,1-s,1-j,1-s]),(X===E.e.FLIP_ROW||X===E.e.FLIP_TILE&&p%2===0)&&(h=[1-j,v,1-A,v,1-A,s,1-j,s]),(X===E.e.FLIP_N_ROTATE_ROW||X===E.e.FLIP_N_ROTATE_TILE&&p%2===0)&&(h=[j,1-v,A,1-v,A,1-s,j,1-s]),e=e.concat(h),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Q&&q&&(P.push(O+x,m+I,0),P.push(-J+x,m+I,0),P.push(-J+x,i+I,0),P.push(O+x,i+I,0),d.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,j=1-S/b,v=0,A=1,s=a/F,h=[j,v,A,v,A,s,j,s],(X===E.e.ROTATE_ROW&&n%2===1||X===E.e.ROTATE_TILE&&n%1===0)&&(h=[1-j,1-v,1-A,1-v,1-A,1-s,1-j,1-s]),(X===E.e.FLIP_ROW&&n%2===1||X===E.e.FLIP_TILE&&n%2===0)&&(h=[1-j,v,1-A,v,1-A,s,1-j,s]),(X===E.e.FLIP_N_ROTATE_ROW&&n%2===1||X===E.e.FLIP_N_ROTATE_TILE&&n%2===0)&&(h=[j,1-v,A,1-v,A,1-s,j,1-s]),e=e.concat(h),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Q&&R&&(P.push(J+x,m+I,0),P.push(u+x,m+I,0),P.push(u+x,i+I,0),P.push(J+x,i+I,0),d.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,j=0,v=0,A=S/b,s=a/F,h=[j,v,A,v,A,s,j,s],(X===E.e.ROTATE_ROW&&n%2===1||X===E.e.ROTATE_TILE&&(n+p)%2===1)&&(h=[1-j,1-v,1-A,1-v,1-A,1-s,1-j,1-s]),(X===E.e.FLIP_ROW&&n%2===1||X===E.e.FLIP_TILE&&(n+p)%2===1)&&(h=[1-j,v,1-A,v,1-A,s,1-j,s]),(X===E.e.FLIP_N_ROTATE_ROW&&n%2===1||X===E.e.FLIP_N_ROTATE_TILE&&(n+p)%2===1)&&(h=[j,1-v,A,1-v,A,1-s,j,1-s]),e=e.concat(h),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U){const U=[];j=0,v=1-a/F,A=1,s=1,U[0]=[j,v,A,v,A,s,j,s],U[1]=[j,v,A,v,A,s,j,s],X!==E.e.ROTATE_TILE&&X!==E.e.ROTATE_ROW||(U[1]=[1-j,1-v,1-A,1-v,1-A,1-s,1-j,1-s]),X!==E.e.FLIP_TILE&&X!==E.e.FLIP_ROW||(U[1]=[1-j,v,1-A,v,1-A,s,1-j,s]),X!==E.e.FLIP_N_ROTATE_TILE&&X!==E.e.FLIP_N_ROTATE_ROW||(U[1]=[j,1-v,A,1-v,A,1-s,j,1-s]);for(let F=0;F<p;F++)P.push(F*b-J+x,N+I,0),P.push((F+1)*b-J+x,N+I,0),P.push((F+1)*b-J+x,N+a+I,0),P.push(F*b-J+x,N+a+I,0),d.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,e=X===E.e.FLIP_TILE||X===E.e.ROTATE_TILE||X===E.e.FLIP_N_ROTATE_TILE?e.concat(U[(F+1)%2]):X===E.e.FLIP_ROW||X===E.e.ROTATE_ROW||X===E.e.FLIP_N_ROTATE_ROW?e.concat(U[1]):e.concat(U[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Q){const U=[];j=0,v=0,A=1,s=a/F,U[0]=[j,v,A,v,A,s,j,s],U[1]=[j,v,A,v,A,s,j,s],X!==E.e.ROTATE_TILE&&X!==E.e.ROTATE_ROW||(U[1]=[1-j,1-v,1-A,1-v,1-A,1-s,1-j,1-s]),X!==E.e.FLIP_TILE&&X!==E.e.FLIP_ROW||(U[1]=[1-j,v,1-A,v,1-A,s,1-j,s]),X!==E.e.FLIP_N_ROTATE_TILE&&X!==E.e.FLIP_N_ROTATE_ROW||(U[1]=[j,1-v,A,1-v,A,1-s,j,1-s]);for(let F=0;F<p;F++)P.push(F*b-J+x,i-a+I,0),P.push((F+1)*b-J+x,i-a+I,0),P.push((F+1)*b-J+x,i+I,0),P.push(F*b-J+x,i+I,0),d.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,e=X===E.e.FLIP_TILE||X===E.e.ROTATE_TILE||X===E.e.FLIP_N_ROTATE_TILE?e.concat(U[(F+n)%2]):X===E.e.FLIP_ROW||X===E.e.ROTATE_ROW||X===E.e.FLIP_N_ROTATE_ROW?e.concat(U[n%2]):e.concat(U[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const U=[];j=1-S/b,v=0,A=1,s=1,U[0]=[j,v,A,v,A,s,j,s],U[1]=[j,v,A,v,A,s,j,s],X!==E.e.ROTATE_TILE&&X!==E.e.ROTATE_ROW||(U[1]=[1-j,1-v,1-A,1-v,1-A,1-s,1-j,1-s]),X!==E.e.FLIP_TILE&&X!==E.e.FLIP_ROW||(U[1]=[1-j,v,1-A,v,1-A,s,1-j,s]),X!==E.e.FLIP_N_ROTATE_TILE&&X!==E.e.FLIP_N_ROTATE_ROW||(U[1]=[j,1-v,A,1-v,A,1-s,j,1-s]);for(let b=0;b<n;b++)P.push(O+x,b*F-m+I,0),P.push(O+S+x,b*F-m+I,0),P.push(O+S+x,(b+1)*F-m+I,0),P.push(O+x,(b+1)*F-m+I,0),d.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,e=X===E.e.FLIP_TILE||X===E.e.ROTATE_TILE||X===E.e.FLIP_N_ROTATE_TILE?e.concat(U[(b+1)%2]):X===E.e.FLIP_ROW||X===E.e.ROTATE_ROW||X===E.e.FLIP_N_ROTATE_ROW?e.concat(U[b%2]):e.concat(U[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(R){const U=[];j=0,v=0,A=S/F,s=1,U[0]=[j,v,A,v,A,s,j,s],U[1]=[j,v,A,v,A,s,j,s],X!==E.e.ROTATE_TILE&&X!==E.e.ROTATE_ROW||(U[1]=[1-j,1-v,1-A,1-v,1-A,1-s,1-j,1-s]),X!==E.e.FLIP_TILE&&X!==E.e.FLIP_ROW||(U[1]=[1-j,v,1-A,v,1-A,s,1-j,s]),X!==E.e.FLIP_N_ROTATE_TILE&&X!==E.e.FLIP_N_ROTATE_ROW||(U[1]=[j,1-v,A,1-v,A,1-s,j,1-s]);for(let b=0;b<n;b++)P.push(u-S+x,b*F-m+I,0),P.push(u+x,b*F-m+I,0),P.push(u+x,(b+1)*F-m+I,0),P.push(u-S+x,(b+1)*F-m+I,0),d.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,e=X===E.e.FLIP_TILE||X===E.e.ROTATE_TILE||X===E.e.FLIP_N_ROTATE_TILE?e.concat(U[(b+p)%2]):X===E.e.FLIP_ROW||X===E.e.ROTATE_ROW||X===E.e.FLIP_N_ROTATE_ROW?e.concat(U[b%2]):e.concat(U[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const v=0===U.sideOrientation?0:U.sideOrientation||Q.d.DEFAULTSIDE;Q.d._ComputeSides(v,P,d,f,e,U.frontUVs,U.backUVs);const A=new Q.d;A.indices=d,A.eU=P,A.lU=f,A.kU=e;const s=v===Q.d.DOUBLESIDE?l.concat(l):l;return A.dU=s,A}function J(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new E.e(U,b);X.sideOrientation=E.e._GetDefaultSideOrientation(X.sideOrientation),F._originalBuilderSideOrientation=X.sideOrientation;return a(X).AU(F,X.updatable),F}function m(U){const X=U.faceUV||new Array(6),b=U.faceColors,w=U.pattern||E.e.NO_FLIP,q=U.width||U.size||1,p=U.height||U.size||1,S=U.depth||U.size||1,R=U.tileWidth||U.tileSize||1,J=U.tileHeight||U.tileSize||1,m=U.alignHorizontal||0,x=U.alignVertical||0,I=0===U.sideOrientation?0:U.sideOrientation||Q.d.DEFAULTSIDE;for(let E=0;E<6;E++)void 0===X[E]&&(X[E]=new F.Vector4(0,0,1,1)),b&&void 0===b[E]&&(b[E]=new n.eb(1,1,1,1));const O=q/2,N=p/2,u=S/2,i=[];for(let F=0;F<2;F++)i[F]=a({pattern:w,tileWidth:R,tileHeight:J,width:q,height:p,alignVertical:x,alignHorizontal:m,sideOrientation:I});for(let F=2;F<4;F++)i[F]=a({pattern:w,tileWidth:R,tileHeight:J,width:S,height:p,alignVertical:x,alignHorizontal:m,sideOrientation:I});let P=x;x===E.e.BOTTOM?P=E.e.TOP:x===E.e.TOP&&(P=E.e.BOTTOM);for(let F=4;F<6;F++)i[F]=a({pattern:w,tileWidth:R,tileHeight:J,width:q,height:S,alignVertical:P,alignHorizontal:m,sideOrientation:I});let f=[],j=[],e=[],l=[];const d=[],k=[],v=[],A=[];let s=0,h=0;for(let E=0;E<6;E++){const U=i[E].eU.length;k[E]=[],v[E]=[];for(let X=0;X<U/3;X++)k[E].push(new F.JX(i[E].eU[3*X],i[E].eU[3*X+1],i[E].eU[3*X+2])),v[E].push(new F.JX(i[E].lU[3*X],i[E].lU[3*X+1],i[E].lU[3*X+2]));s=i[E].kU.length,A[E]=[];for(let b=0;b<s;b+=2)A[E][b]=X[E].x+(X[E].z-X[E].x)*i[E].kU[b],A[E][b+1]=X[E].y+(X[E].w-X[E].y)*i[E].kU[b+1],z.b&&(A[E][b+1]=1-A[E][b+1]);if(e=e.concat(A[E]),l=l.concat(i[E].indices.map((U=>U+h))),h+=k[E].length,b)for(let X=0;X<4;X++)d.push(b[E].r,b[E].g,b[E].b,b[E].a)}const B=new F.JX(0,0,u),o=F.Matrix.RotationY(Math.PI);f=k[0].map((U=>F.JX.TransformNormal(U,o).add(B))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[]),j=v[0].map((U=>F.JX.TransformNormal(U,o))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[]),f=f.concat(k[1].map((U=>U.mX(B))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[])),j=j.concat(v[1].map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[]));const y=new F.JX(O,0,0),t=F.Matrix.RotationY(-Math.PI/2);f=f.concat(k[2].map((U=>F.JX.TransformNormal(U,t).add(y))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[])),j=j.concat(v[2].map((U=>F.JX.TransformNormal(U,t))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[]));const W=F.Matrix.RotationY(Math.PI/2);f=f.concat(k[3].map((U=>F.JX.TransformNormal(U,W).mX(y))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[])),j=j.concat(v[3].map((U=>F.JX.TransformNormal(U,W))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[]));const Y=new F.JX(0,N,0),K=F.Matrix.RotationX(Math.PI/2);f=f.concat(k[4].map((U=>F.JX.TransformNormal(U,K).add(Y))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[])),j=j.concat(v[4].map((U=>F.JX.TransformNormal(U,K))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[]));const V=F.Matrix.RotationX(-Math.PI/2);f=f.concat(k[5].map((U=>F.JX.TransformNormal(U,V).mX(Y))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[])),j=j.concat(v[5].map((U=>F.JX.TransformNormal(U,V))).map((U=>[U.x,U.y,U.z])).reduce(((U,X)=>U.concat(X)),[])),Q.d._ComputeSides(I,f,l,j,e);const g=new Q.d;if(g.indices=l,g.eU=f,g.lU=j,g.kU=e,b){const U=I===Q.d.DOUBLESIDE?d.concat(d):d;g.dU=U}return g}function x(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new E.e(U,b);X.sideOrientation=E.e._GetDefaultSideOrientation(X.sideOrientation),F._originalBuilderSideOrientation=X.sideOrientation;return m(X).AU(F,X.updatable),F}Q.d.CreateTiledPlane=a;Q.d.CreateTiledBox=m;var I=b(12950),O=b(11833),N=b(11790);function u(U){const X=U.height||2;let b=0===U.diameterTop?0:U.diameterTop||U.diameter||1,w=0===U.diameterBottom?0:U.diameterBottom||U.diameter||1;b=b||1e-5,w=w||1e-5;const q=0|(U.tessellation||24),p=0|(U.subdivisions||1),S=!!U.hasRings,R=!!U.enclose,a=0===U.cap?0:U.cap||E.e.CAP_ALL,J=U.arc&&(U.arc<=0||U.arc>1)?1:U.arc||1,m=0===U.sideOrientation?0:U.sideOrientation||Q.d.DEFAULTSIDE,x=U.faceUV||new Array(3),I=U.faceColors,O=2+(1+(1!==J&&R?2:0))*(S?p:1);let u;for(u=0;u<O;u++)I&&void 0===I[u]&&(I[u]=new n.eb(1,1,1,1));for(u=0;u<O;u++)x&&void 0===x[u]&&(x[u]=new F.Vector4(0,0,1,1));const i=[],P=[],f=[],j=[],e=[],l=2*Math.PI*J/q;let d,k,v;const A=(w-b)/2/X,s=F.JX.Zero(),h=F.JX.Zero(),B=F.JX.Zero(),o=F.JX.Zero(),y=F.JX.Zero(),t=N.c.Y;let W,Y,K,V=1,g=1,L=0,D=0;for(W=0;W<=p;W++)for(k=W/p,v=(k*(b-w)+w)/2,V=S&&0!==W&&W!==p?2:1,K=0;K<V;K++){for(S&&(g+=K),R&&(g+=2*K),Y=0;Y<=q;Y++)d=Y*l,s.x=Math.cos(-d)*v,s.y=-X/2+k*X,s.z=Math.sin(-d)*v,0===b&&W===p?(h.x=f[f.length-3*(q+1)],h.y=f[f.length-3*(q+1)+1],h.z=f[f.length-3*(q+1)+2]):(h.x=s.x,h.z=s.z,h.y=Math.sqrt(h.x*h.x+h.z*h.z)*A,h.normalize()),0===Y&&(B.q(s),o.q(h)),P.push(s.x,s.y,s.z),f.push(h.x,h.y,h.z),D=S?L!==g?x[g].y:x[g].w:x[g].y+(x[g].w-x[g].y)*k,j.push(x[g].x+(x[g].z-x[g].x)*Y/q,z.b?1-D:D),I&&e.push(I[g].r,I[g].g,I[g].b,I[g].a);1!==J&&R&&(P.push(s.x,s.y,s.z),P.push(0,s.y,0),P.push(0,s.y,0),P.push(B.x,B.y,B.z),F.JX.CrossToRef(t,h,y),y.normalize(),f.push(y.x,y.y,y.z,y.x,y.y,y.z),F.JX.CrossToRef(o,t,y),y.normalize(),f.push(y.x,y.y,y.z,y.x,y.y,y.z),D=S?L!==g?x[g+1].y:x[g+1].w:x[g+1].y+(x[g+1].w-x[g+1].y)*k,j.push(x[g+1].x,z.b?1-D:D),j.push(x[g+1].z,z.b?1-D:D),D=S?L!==g?x[g+2].y:x[g+2].w:x[g+2].y+(x[g+2].w-x[g+2].y)*k,j.push(x[g+2].x,z.b?1-D:D),j.push(x[g+2].z,z.b?1-D:D),I&&(e.push(I[g+1].r,I[g+1].g,I[g+1].b,I[g+1].a),e.push(I[g+1].r,I[g+1].g,I[g+1].b,I[g+1].a),e.push(I[g+2].r,I[g+2].g,I[g+2].b,I[g+2].a),e.push(I[g+2].r,I[g+2].g,I[g+2].b,I[g+2].a))),L!==g&&(L=g)}const G=1!==J&&R?q+4:q;for(W=0,g=0;g<p;g++){let U=0,X=0,b=0,F=0;for(Y=0;Y<q;Y++)U=W*(G+1)+Y,X=(W+1)*(G+1)+Y,b=W*(G+1)+(Y+1),F=(W+1)*(G+1)+(Y+1),i.push(U,X,b),i.push(F,b,X);1!==J&&R&&(i.push(U+2,X+2,b+2),i.push(F+2,b+2,X+2),i.push(U+4,X+4,b+4),i.push(F+4,b+4,X+4)),W=S?W+2:W+1}const Z=U=>{const E=U?b/2:w/2;if(0===E)return;let Q,p,S;const R=U?x[O-1]:x[0];let n=null;I&&(n=U?I[O-1]:I[0]);const a=P.length/3,m=U?X/2:-X/2,N=new F.JX(0,m,0);P.push(N.x,N.y,N.z),f.push(0,U?1:-1,0);const u=R.y+.5*(R.w-R.y);j.push(R.x+.5*(R.z-R.x),z.b?1-u:u),n&&e.push(n.r,n.g,n.b,n.a);const l=new F.Vector2(.5,.5);for(S=0;S<=q;S++){Q=2*Math.PI*S*J/q;const X=Math.cos(-Q),b=Math.sin(-Q);p=new F.JX(X*E,m,b*E);const w=new F.Vector2(X*l.x+.5,b*l.y+.5);P.push(p.x,p.y,p.z),f.push(0,U?1:-1,0);const a=R.y+(R.w-R.y)*w.y;j.push(R.x+(R.z-R.x)*w.x,z.b?1-a:a),n&&e.push(n.r,n.g,n.b,n.a)}for(S=0;S<q;S++)U?(i.push(a),i.push(a+(S+2)),i.push(a+(S+1))):(i.push(a),i.push(a+(S+1)),i.push(a+(S+2)))};a!==E.e.CAP_START&&a!==E.e.CAP_ALL||Z(!1),a!==E.e.CAP_END&&a!==E.e.CAP_ALL||Z(!0),Q.d._ComputeSides(m,P,i,f,j,U.frontUVs,U.backUVs);const c=new Q.d;return c.indices=i,c.eU=P,c.lU=f,c.kU=j,I&&(c.dU=e),c}function i(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const F=new E.e(U,b);X.sideOrientation=E.e._GetDefaultSideOrientation(X.sideOrientation),F._originalBuilderSideOrientation=X.sideOrientation;return u(X).AU(F,X.updatable),F}function P(U){const X=[],b=[],E=[],w=[],q=U.diameter||1,p=U.thickness||.5,S=0|(U.tessellation||16),R=0===U.sideOrientation?0:U.sideOrientation||Q.d.DEFAULTSIDE,n=S+1;for(let Q=0;Q<=S;Q++){const U=Q/S,R=Q*Math.PI*2/S-Math.PI/2,a=F.Matrix.Translation(q/2,0,0).multiply(F.Matrix.RotationY(R));for(let q=0;q<=S;q++){const R=1-q/S,J=q*Math.PI*2/S+Math.PI,m=Math.cos(J),x=Math.sin(J);let I=new F.JX(m,x,0),O=I.scale(p/2);const N=new F.Vector2(U,R);O=F.JX.TransformCoordinates(O,a),I=F.JX.TransformNormal(I,a),b.push(O.x,O.y,O.z),E.push(I.x,I.y,I.z),w.push(N.x,z.b?1-N.y:N.y);const u=(Q+1)%n,i=(q+1)%n;X.push(Q*n+q),X.push(Q*n+i),X.push(u*n+q),X.push(Q*n+i),X.push(u*n+i),X.push(u*n+q)}}Q.d._ComputeSides(R,b,X,E,w,U.frontUVs,U.backUVs);const a=new Q.d;return a.indices=X,a.eU=b,a.lU=E,a.kU=w,a}function f(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const F=new E.e(U,b);X.sideOrientation=E.e._GetDefaultSideOrientation(X.sideOrientation),F._originalBuilderSideOrientation=X.sideOrientation;return P(X).AU(F,X.updatable),F}Q.d.CreateCylinder=u,E.e.CreateCylinder=(U,X,b,F,w,Q,z,q,p)=>{void 0!==z&&z instanceof O.c||(void 0!==z&&(p=q||E.e.DEFAULTSIDE,q=z),z=Q,Q=1);return i(U,{height:X,diameterTop:b,diameterBottom:F,tessellation:w,subdivisions:Q,sideOrientation:p,updatable:q},z)};function j(U){const X=[],b=[],E=[],w=[],q=U.radius||2,p=U.tube||.5,S=U.radialSegments||32,R=U.tubularSegments||32,n=U.p||2,a=U.q||3,J=0===U.sideOrientation?0:U.sideOrientation||Q.d.DEFAULTSIDE,m=U=>{const X=Math.cos(U),b=Math.sin(U),E=a/n*U,w=Math.cos(E),Q=q*(2+w)*.5*X,z=q*(2+w)*b*.5,p=q*Math.sin(E)*.5;return new F.JX(Q,z,p)};let x,I;for(x=0;x<=S;x++){const U=x%S/S*2*n*Math.PI,X=m(U),E=m(U+.01),Q=E.mX(X);let q=E.add(X);const a=F.JX.Cross(Q,q);for(q=F.JX.Cross(a,Q),a.normalize(),q.normalize(),I=0;I<R;I++){const U=I%R/R*2*Math.PI,F=-p*Math.cos(U),E=p*Math.sin(U);b.push(X.x+F*q.x+E*a.x),b.push(X.y+F*q.y+E*a.y),b.push(X.z+F*q.z+E*a.z),w.push(x/S),w.push(z.b?1-I/R:I/R)}}for(x=0;x<S;x++)for(I=0;I<R;I++){const U=(I+1)%R,b=x*R+I,F=(x+1)*R+I,E=(x+1)*R+U,w=x*R+U;X.push(w),X.push(F),X.push(b),X.push(w),X.push(E),X.push(F)}Q.d.ComputeNormals(b,X,E),Q.d._ComputeSides(J,b,X,E,w,U.frontUVs,U.backUVs);const O=new Q.d;return O.indices=X,O.eU=b,O.lU=E,O.kU=w,O}function e(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const F=new E.e(U,b);X.sideOrientation=E.e._GetDefaultSideOrientation(X.sideOrientation),F._originalBuilderSideOrientation=X.sideOrientation;return j(X).AU(F,X.updatable),F}Q.d.CreateTorus=P,E.e.CreateTorus=(U,X,b,F,E,w,Q)=>f(U,{diameter:X,thickness:b,tessellation:F,sideOrientation:Q,updatable:w},E);Q.d.CreateTorusKnot=j,E.e.CreateTorusKnot=(U,X,b,F,E,w,Q,z,q,p)=>e(U,{radius:X,tube:b,radialSegments:F,tubularSegments:E,p:w,q:Q,sideOrientation:p,updatable:q},z);var l=b(13459),d=b(12170),k=b(11803);function v(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=X.path,w=X.shape,Q=X.scale||1,z=X.rotation||0,q=0===X.cap?0:X.cap||E.e.NO_CAP,p=X.updatable,S=E.e._GetDefaultSideOrientation(X.sideOrientation),R=X.instance||null,n=X.invertUV||!1,a=X.closeShape||!1,J=X.closePath||!1,m=X.capFunction||null;return s(U,w,F,Q,z,null,null,J,a,q,!1,b,!!p,S,R,n,X.frontUVs||null,X.backUVs||null,X.firstNormal||null,!!X.adjustFrame,m)}function A(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=X.path,w=X.shape,Q=X.scaleFunction||(()=>1),z=X.rotationFunction||(()=>0),q=X.closePath||X.ribbonCloseArray||!1,p=X.closeShape||X.ribbonClosePath||!1,S=0===X.cap?0:X.cap||E.e.NO_CAP,R=X.updatable,n=X.firstNormal||null,a=X.adjustFrame||!1,J=E.e._GetDefaultSideOrientation(X.sideOrientation),m=X.instance,x=X.invertUV||!1,I=X.capFunction||null;return s(U,w,F,null,null,Q,z,q,p,S,!0,b,!!R,J,m||null,x,X.frontUVs||null,X.backUVs||null,n,a,I||null)}function s(U,X,b,w,Q,z,q,S,R,n,a,J,m,x,I,O,N,u,i,P,f){const j=(U,X,b,w,Q,z,q,p,S,R,n)=>{const a=b.getTangents(),J=b.getNormals(),m=b.getBinormals(),x=b.getDistances();if(n)for(let E=0;E<a.length;E++)if(0==a[E].x&&0==a[E].y&&0==a[E].z&&a[E].q(a[E-1]),0==J[E].x&&0==J[E].y&&0==J[E].z&&J[E].q(J[E-1]),0==m[E].x&&0==m[E].y&&0==m[E].z&&m[E].q(m[E-1]),E>0){let U=a[E-1];F.JX.Dot(U,a[E])<0&&a[E].scaleInPlace(-1),U=J[E-1],F.JX.Dot(U,J[E])<0&&J[E].scaleInPlace(-1),U=m[E-1],F.JX.Dot(U,m[E])<0&&m[E].scaleInPlace(-1)}let I=0;const O=R&&p?p:()=>null!==z?z:0,N=R&&q?q:()=>null!==Q?Q:1;let u=S===E.e.NO_CAP||S===E.e.CAP_END?0:2;const i=F.TmpVectors.Matrix[0];for(let E=0;E<X.length;E++){const b=[],Q=O(E,x[E]),z=N(E,x[E]);F.Matrix.RotationAxisToRef(a[E],I,i);for(let w=0;w<U.length;w++){const Q=a[E].scale(U[w].z).add(J[E].scale(U[w].x)).add(m[E].scale(U[w].y)),q=F.JX.Zero();F.JX.TransformCoordinatesToRef(Q,i,q),q.scaleInPlace(z).addInPlace(X[E]),b[w]=q}w[u]=b,I+=Q,u++}const P=f||(U=>{const X=Array(),b=F.JX.Zero();let E;for(E=0;E<U.length;E++)b.addInPlace(U[E]);for(b.scaleInPlace(1/U.length),E=0;E<U.length;E++)X.push(b);return X});switch(S){case E.e.NO_CAP:break;case E.e.CAP_START:w[0]=P(w[2]),w[1]=w[2];break;case E.e.CAP_END:w[u]=w[u-1],w[u+1]=P(w[u-1]);break;case E.e.CAP_ALL:w[0]=P(w[2]),w[1]=w[2],w[u]=w[u-1],w[u+1]=P(w[u-1])}return w};let e,l;if(I){const U=I._creationDataStorage;return e=i?U.path3D.update(b,i):U.path3D.update(b),l=j(X,b,U.path3D,U.pathArray,w,Q,z,q,U.cap,a,P),I=p("",{pathArray:l,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:I},J||void 0)}e=i?new k.n(b,i):new k.n(b);l=j(X,b,e,new Array,w,Q,z,q,n=n<0||n>3?0:n,a,P);const d=p(U,{pathArray:l,closeArray:S,closePath:R,updatable:m,sideOrientation:x,invertUV:O,frontUVs:N||void 0,backUVs:u||void 0},J);return d._creationDataStorage.pathArray=l,d._creationDataStorage.path3D=e,d._creationDataStorage.cap=n,d}function h(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=X.arc?X.arc<=0||X.arc>1?1:X.arc:1,Q=void 0===X.closed||X.closed,z=X.shape,q=X.radius||1,S=X.tessellation||64,R=X.clip||0,n=X.updatable,a=E.e._GetDefaultSideOrientation(X.sideOrientation),J=X.cap||E.e.NO_CAP,m=2*Math.PI,x=[],I=X.invertUV||!1;let O=0,N=0;const u=m/S*w;let i,P;for(O=0;O<=S-R;O++){for(P=[],J!=E.e.CAP_START&&J!=E.e.CAP_ALL||(P.push(new F.JX(0,z[0].y,0)),P.push(new F.JX(Math.cos(O*u)*z[0].x*q,z[0].y,Math.sin(O*u)*z[0].x*q))),N=0;N<z.length;N++)i=new F.JX(Math.cos(O*u)*z[N].x*q,z[N].y,Math.sin(O*u)*z[N].x*q),P.push(i);J!=E.e.CAP_END&&J!=E.e.CAP_ALL||(P.push(new F.JX(Math.cos(O*u)*z[z.length-1].x*q,z[z.length-1].y,Math.sin(O*u)*z[z.length-1].x*q)),P.push(new F.JX(0,z[z.length-1].y,0))),x.push(P)}return p(U,{pathArray:x,closeArray:Q,sideOrientation:a,updatable:n,invertUV:I,frontUVs:X.frontUVs,backUVs:X.backUVs},b)}E.e.ExtrudeShape=function(U,X,b,F,w,Q){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7?arguments[7]:void 0,p=arguments.length>8?arguments[8]:void 0,S=arguments.length>9?arguments[9]:void 0;return v(U,{shape:X,path:b,scale:F,rotation:w,cap:0===Q?0:Q||E.e.NO_CAP,sideOrientation:p,instance:S,updatable:q},z)},E.e.ExtrudeShapeCustom=(U,X,b,F,w,Q,z,q,p,S,R,n)=>A(U,{shape:X,path:b,scaleFunction:F,rotationFunction:w,ribbonCloseArray:Q,ribbonClosePath:z,cap:0===q?0:q||E.e.NO_CAP,sideOrientation:R,instance:n,updatable:S},p);E.e.CreateLathe=(U,X,b,F,E,w,Q)=>h(U,{shape:X,radius:b,tessellation:F,sideOrientation:Q,updatable:w},E);var B=b(12868),o=b(12827);function y(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=X.path;let Q=X.instance,z=1;void 0!==X.radius?z=X.radius:Q&&(z=Q._creationDataStorage.radius);const q=X.tessellation||64,S=X.radiusFunction||null;let R=X.cap||E.e.NO_CAP;const n=X.invertUV||!1,a=X.updatable,J=E.e._GetDefaultSideOrientation(X.sideOrientation);X.arc=X.arc&&(X.arc<=0||X.arc>1)?1:X.arc||1;const m=(U,X,b,w,Q,z,q,p)=>{const S=X.getTangents(),R=X.getNormals(),n=X.getDistances(),a=2*Math.PI/Q*p,J=z||(()=>w);let m,x,I,O;const N=F.TmpVectors.Matrix[0];let u=q===E.e.NO_CAP||q===E.e.CAP_END?0:2;for(let E=0;E<U.length;E++){x=J(E,n[E]),m=Array(),I=R[E];for(let X=0;X<Q;X++)F.Matrix.RotationAxisToRef(S[E],a*X,N),O=m[X]?m[X]:F.JX.Zero(),F.JX.TransformCoordinatesToRef(I,N,O),O.scaleInPlace(x).addInPlace(U[E]),m[X]=O;b[u]=m,u++}const i=(X,b)=>{const F=Array();for(let E=0;E<X;E++)F.push(U[b]);return F};switch(q){case E.e.NO_CAP:break;case E.e.CAP_START:b[0]=i(Q,0),b[1]=b[2].slice(0);break;case E.e.CAP_END:b[u]=b[u-1].slice(0),b[u+1]=i(Q,U.length-1);break;case E.e.CAP_ALL:b[0]=i(Q,0),b[1]=b[2].slice(0),b[u]=b[u-1].slice(0),b[u+1]=i(Q,U.length-1)}return b};let x,I;if(Q){const U=Q._creationDataStorage,b=X.arc||U.arc;return x=U.path3D.update(w),I=m(w,x,U.pathArray,z,U.tessellation,S,U.cap,b),Q=p("",{pathArray:I,instance:Q}),U.path3D=x,U.pathArray=I,U.arc=b,U.radius=z,Q}x=new k.n(w);R=R<0||R>3?0:R,I=m(w,x,new Array,z,q,S,R,X.arc);const O=p(U,{pathArray:I,closePath:!0,closeArray:!1,updatable:a,sideOrientation:J,invertUV:n,frontUVs:X.frontUVs,backUVs:X.backUVs},b);return O._creationDataStorage.pathArray=I,O._creationDataStorage.path3D=x,O._creationDataStorage.tessellation=q,O._creationDataStorage.cap=R,O._creationDataStorage.arc=X.arc,O._creationDataStorage.radius=z,O}function t(U){const X=[];X[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},X[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},X[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},X[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},X[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},X[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},X[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},X[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},X[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},X[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},X[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},X[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},X[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},X[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},X[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const b=U.type&&(U.type<0||U.type>=X.length)?0:U.type||0,E=U.size,w=U.sizeX||E||1,q=U.sizeY||E||1,p=U.sizeZ||E||1,S=U.custom||X[b],R=S.face.length,a=U.faceUV||new Array(R),J=U.faceColors,m=void 0===U.flat||U.flat,x=0===U.sideOrientation?0:U.sideOrientation||Q.d.DEFAULTSIDE,I=[],O=[],N=[],u=[],i=[];let P=0,f=0;const j=[];let e,l,d,k,v,A,s=0,h=0;if(m)for(h=0;h<R;h++)J&&void 0===J[h]&&(J[h]=new n.eb(1,1,1,1)),a&&void 0===a[h]&&(a[h]=new F.Vector4(0,0,1,1));if(m)for(h=0;h<R;h++){const U=S.face[h].length;for(d=2*Math.PI/U,k=.5*Math.tan(d/2),v=.5,s=0;s<U;s++)I.push(S.vertex[S.face[h][s]][0]*w,S.vertex[S.face[h][s]][1]*q,S.vertex[S.face[h][s]][2]*p),j.push(P),P++,e=a[h].x+(a[h].z-a[h].x)*(.5+k),l=a[h].y+(a[h].w-a[h].y)*(v-.5),u.push(e,z.b?1-l:l),A=k*Math.cos(d)-v*Math.sin(d),v=k*Math.sin(d)+v*Math.cos(d),k=A,J&&i.push(J[h].r,J[h].g,J[h].b,J[h].a);for(s=0;s<U-2;s++)O.push(j[0+f],j[s+2+f],j[s+1+f]);f+=U}else{for(s=0;s<S.vertex.length;s++)I.push(S.vertex[s][0]*w,S.vertex[s][1]*q,S.vertex[s][2]*p),u.push(0,z.b?1:0);for(h=0;h<R;h++)for(s=0;s<S.face[h].length-2;s++)O.push(S.face[h][0],S.face[h][s+2],S.face[h][s+1])}Q.d.ComputeNormals(I,O,N),Q.d._ComputeSides(x,I,O,N,u,U.frontUVs,U.backUVs);const B=new Q.d;return B.eU=I,B.indices=O,B.lU=N,B.kU=u,J&&m&&(B.dU=i),B}function W(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new E.e(U,b);X.sideOrientation=E.e._GetDefaultSideOrientation(X.sideOrientation),F._originalBuilderSideOrientation=X.sideOrientation;return t(X).AU(F,X.updatable),F}E.e.CreateTube=(U,X,b,F,E,w,Q,z,q,p)=>y(U,{path:X,radius:b,tessellation:F,radiusFunction:E,arc:1,cap:w,updatable:z,sideOrientation:q,instance:p},Q);function Y(U){const X=U.sideOrientation||Q.d.DEFAULTSIDE,b=U.radius||1,E=void 0===U.flat||U.flat,w=0|(U.subdivisions||4),q=U.radiusX||b,p=U.radiusY||b,S=U.radiusZ||b,R=(1+Math.sqrt(5))/2,n=[-1,R,-0,1,R,0,-1,-R,0,1,-R,0,0,-1,-R,0,1,-R,0,-1,R,0,1,R,R,0,1,R,0,-1,-R,0,1,-R,0,-1],a=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],J=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],m=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],x=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],I=[],O=[],N=[],u=[];let i=0;const P=new Array(3),f=new Array(3);let j;for(j=0;j<3;j++)P[j]=F.JX.Zero(),f[j]=F.Vector2.Zero();for(let Q=0;Q<20;Q++){for(j=0;j<3;j++){const U=a[3*Q+j];P[j].Pb(n[3*J[U]],n[3*J[U]+1],n[3*J[U]+2]),P[j].normalize(),f[j].Pb(.134765625*m[2*U]+.05859375+-.0390625*x[Q],.2333984375*m[2*U+1]+.025390625+.01953125*x[Q])}const U=(U,X,b,Q)=>{const R=F.JX.Lerp(P[0],P[2],X/w),n=F.JX.Lerp(P[1],P[2],X/w),a=w===X?P[2]:F.JX.Lerp(R,n,U/(w-X));let J;if(a.normalize(),E){const U=F.JX.Lerp(P[0],P[2],Q/w),X=F.JX.Lerp(P[1],P[2],Q/w);J=F.JX.Lerp(U,X,b/(w-Q))}else J=new F.JX(a.x,a.y,a.z);J.x/=q,J.y/=p,J.z/=S,J.normalize();const m=F.Vector2.Lerp(f[0],f[2],X/w),x=F.Vector2.Lerp(f[1],f[2],X/w),j=w===X?f[2]:F.Vector2.Lerp(m,x,U/(w-X));O.push(a.x*q,a.y*p,a.z*S),N.push(J.x,J.y,J.z),u.push(j.x,z.b?1-j.y:j.y),I.push(i),i++};for(let X=0;X<w;X++)for(let b=0;b+X<w;b++)U(b,X,b+1/3,X+1/3),U(b+1,X,b+1/3,X+1/3),U(b,X+1,b+1/3,X+1/3),b+X+1<w&&(U(b+1,X,b+2/3,X+2/3),U(b+1,X+1,b+2/3,X+2/3),U(b,X+1,b+2/3,X+2/3))}Q.d._ComputeSides(X,O,I,N,u,U.frontUVs,U.backUVs);const e=new Q.d;return e.indices=I,e.eU=O,e.lU=N,e.kU=u,e}function K(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new E.e(U,b);X.sideOrientation=E.e._GetDefaultSideOrientation(X.sideOrientation),F._originalBuilderSideOrientation=X.sideOrientation;return Y(X).AU(F,X.updatable),F}Q.d.CreatePolyhedron=t,E.e.CreatePolyhedron=(U,X,b)=>W(U,X,b);Q.d.CreateIcoSphere=Y,E.e.CreateIcoSphere=(U,X,b)=>K(U,X,b);var V=b(11608);const g=new F.JX(1,0,0),L=new F.JX(-1,0,0),D=new F.JX(0,1,0),G=new F.JX(0,-1,0),Z=new F.JX(0,0,1),c=new F.JX(0,0,-1);class r{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.JX.Zero(),X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.JX.Up(),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.Vector2.Zero(),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=U,this.normal=X,this.uv=b,this.vertexIdx=E,this.vertexIdxForBones=w,this.localPositionOverride=Q,this.localNormalOverride=z,this.matrixIndicesOverride=q,this.matrixWeightsOverride=p}clone(){var U,X,b,F;return new r(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(U=this.localPositionOverride)||void 0===U?void 0:U.slice(),null===(X=this.localNormalOverride)||void 0===X?void 0:X.slice(),null===(b=this.matrixIndicesOverride)||void 0===b?void 0:b.slice(),null===(F=this.matrixWeightsOverride)||void 0===F?void 0:F.slice())}}function M(U,X,b){var q,p,S,R,n;const a=!!X.skeleton,J=!(null===(q=X.morphTargetManager)||void 0===q||!q.numTargets),m=b.localMode||a,x=X.ub(),I=a||J?X.Gz(!0,!0):X.getVerticesData(w.h.PositionKind),O=a||J?X.getNormalsData(!0,!0):X.getVerticesData(w.h.NormalKind),N=m?a?X.getVerticesData(w.h.PositionKind):I:null,u=m?a?X.getVerticesData(w.h.NormalKind):O:null,i=X.getVerticesData(w.h.UVKind),P=a?X.getVerticesData(w.h.MatricesIndicesKind):null,f=a?X.getVerticesData(w.h.MatricesWeightsKind):null,j=a?X.getVerticesData(w.h.MatricesIndicesExtraKind):null,e=a?X.getVerticesData(w.h.MatricesWeightsExtraKind):null,l=b.position||F.JX.Zero();let d=b.normal||F.JX.Up();const k=b.size||F.JX.One(),v=b.angle||0;if(!d){const U=new F.JX(0,0,1),b=X.fU().activeCamera,E=F.JX.TransformCoordinates(U,b.getWorldMatrix());d=b.globalPosition.mX(E)}const A=-Math.atan2(d.z,d.x)-Math.PI/2,s=Math.sqrt(d.x*d.x+d.z*d.z),h=Math.atan2(d.y,s),B=new Q.d;B.indices=[],B.eU=[],B.lU=[],B.kU=[],B.matricesIndices=a?[]:null,B.matricesWeights=a?[]:null,B.matricesIndicesExtra=j?[]:null,B.matricesWeightsExtra=e?[]:null;let o=0;const y=(U,X)=>{const E=new r;if(!x||!I||!O)return E;const w=x[U];if(E.vertexIdx=3*w,E.vertexIdxForBones=4*w,E.position=new F.JX(I[3*w],I[3*w+1],I[3*w+2]),F.JX.TransformCoordinatesToRef(E.position,X,E.position),E.normal=new F.JX(O[3*w],O[3*w+1],O[3*w+2]),F.JX.TransformNormalToRef(E.normal,X,E.normal),b.captureUVS&&i){const U=i[2*w+1];E.uv=new F.Vector2(i[2*w],z.b?1-U:U)}return E},t=[0,0,0,0],W=(U,X)=>{if(0===U.length)return U;const b=.5*Math.abs(F.JX.Dot(k,X)),E=(U,X,b,F)=>{for(let E=0;E<F;++E)if(U[b+E]===X)return b+E;return-1},w=(U,w)=>{const Q=F.JX.GetClipFactor(U.position,w.position,X,b);let z=t,q=t;if(P&&f){const X=U.matrixIndicesOverride?0:U.vertexIdxForBones,b=U.matrixIndicesOverride??P,F=U.matrixWeightsOverride??f,p=w.matrixIndicesOverride?0:w.vertexIdxForBones,S=w.matrixIndicesOverride??P,R=w.matrixWeightsOverride??f;z=[0,0,0,0],q=[0,0,0,0];let n=0;for(let U=0;U<4;++U)if(F[X+U]>0){const w=E(S,b[X+U],p,4);z[n]=b[X+U],q[n]=(0,V.Lerp)(F[X+U],w>=0?R[w]:0,Q),n++}for(let U=0;U<4&&n<4;++U){const F=S[p+U];-1===E(b,F,X,4)&&(z[n]=F,q[n]=(0,V.Lerp)(0,R[p+U],Q),n++)}const a=q[0]+q[1]+q[2]+q[3];q[0]/=a,q[1]/=a,q[2]/=a,q[3]/=a}const p=U.localPositionOverride?U.localPositionOverride[0]:(null===N||void 0===N?void 0:N[U.vertexIdx])??0,S=U.localPositionOverride?U.localPositionOverride[1]:(null===N||void 0===N?void 0:N[U.vertexIdx+1])??0,R=U.localPositionOverride?U.localPositionOverride[2]:(null===N||void 0===N?void 0:N[U.vertexIdx+2])??0,n=w.localPositionOverride?w.localPositionOverride[0]:(null===N||void 0===N?void 0:N[w.vertexIdx])??0,a=w.localPositionOverride?w.localPositionOverride[1]:(null===N||void 0===N?void 0:N[w.vertexIdx+1])??0,J=w.localPositionOverride?w.localPositionOverride[2]:(null===N||void 0===N?void 0:N[w.vertexIdx+2])??0,m=U.localNormalOverride?U.localNormalOverride[0]:(null===u||void 0===u?void 0:u[U.vertexIdx])??0,x=U.localNormalOverride?U.localNormalOverride[1]:(null===u||void 0===u?void 0:u[U.vertexIdx+1])??0,I=U.localNormalOverride?U.localNormalOverride[2]:(null===u||void 0===u?void 0:u[U.vertexIdx+2])??0,O=m+((w.localNormalOverride?w.localNormalOverride[0]:(null===u||void 0===u?void 0:u[w.vertexIdx])??0)-m)*Q,i=x+((w.localNormalOverride?w.localNormalOverride[1]:(null===u||void 0===u?void 0:u[w.vertexIdx+1])??0)-x)*Q,j=I+((w.localNormalOverride?w.localNormalOverride[2]:(null===u||void 0===u?void 0:u[w.vertexIdx+2])??0)-I)*Q,e=Math.sqrt(O*O+i*i+j*j);return new r(F.JX.Lerp(U.position,w.position,Q),F.JX.Lerp(U.normal,w.normal,Q).normalize(),F.Vector2.Lerp(U.uv,w.uv,Q),-1,-1,N?[p+(n-p)*Q,S+(a-S)*Q,R+(J-R)*Q]:null,u?[O/e,i/e,j/e]:null,z,q)};let Q=null;U.length>3&&(Q=[]);for(let z=0;z<U.length;z+=3){let E=0,q=null,p=null,S=null,R=null;const n=F.JX.Dot(U[z].position,X)-b>0,a=F.JX.Dot(U[z+1].position,X)-b>0,J=F.JX.Dot(U[z+2].position,X)-b>0;switch(E=(n?1:0)+(a?1:0)+(J?1:0),E){case 0:U.length>3?(Q.push(U[z]),Q.push(U[z+1]),Q.push(U[z+2])):Q=U;break;case 1:if(Q=Q??new Array,n&&(q=U[z+1],p=U[z+2],S=w(U[z],q),R=w(U[z],p)),a){q=U[z],p=U[z+2],S=w(U[z+1],q),R=w(U[z+1],p),Q.push(S),Q.push(p.clone()),Q.push(q.clone()),Q.push(p.clone()),Q.push(S.clone()),Q.push(R);break}J&&(q=U[z],p=U[z+1],S=w(U[z+2],q),R=w(U[z+2],p)),q&&p&&S&&R&&(Q.push(q.clone()),Q.push(p.clone()),Q.push(S),Q.push(R),Q.push(S.clone()),Q.push(p.clone()));break;case 2:Q=Q??new Array,n||(q=U[z].clone(),p=w(q,U[z+1]),S=w(q,U[z+2]),Q.push(q),Q.push(p),Q.push(S)),a||(q=U[z+1].clone(),p=w(q,U[z+2]),S=w(q,U[z]),Q.push(q),Q.push(p),Q.push(S)),J||(q=U[z+2].clone(),p=w(q,U[z]),S=w(q,U[z+1]),Q.push(q),Q.push(p),Q.push(S))}}return Q},Y=X instanceof E.e?X:null,K=null===Y||void 0===Y?void 0:Y._thinInstanceDataStorage.matrixData,M=(null===Y||void 0===Y?void 0:Y.kb)||1,H=F.TmpVectors.Matrix[0];H.q(F.Matrix.IdentityReadOnly);for(let E=0;E<M;++E){if(null!==Y&&void 0!==Y&&Y.hasThinInstances&&K){const U=16*E;H.setRowFromFloats(0,K[U+0],K[U+1],K[U+2],K[U+3]),H.setRowFromFloats(1,K[U+4],K[U+5],K[U+6],K[U+7]),H.setRowFromFloats(2,K[U+8],K[U+9],K[U+10],K[U+11]),H.setRowFromFloats(3,K[U+12],K[U+13],K[U+14],K[U+15])}const U=F.Matrix.RotationYawPitchRoll(A,h,v).multiply(F.Matrix.Translation(l.x,l.y,l.z)),w=F.Matrix.Invert(U),Q=X.getWorldMatrix(),q=H.multiply(Q).multiply(w),p=new Array(3);for(let X=0;X<x.length;X+=3){let U=p;if(U[0]=y(X,q),U[1]=y(X+1,q),U[2]=y(X+2,q),!(b.cullBackFaces&&-U[0].normal.z<=0&&-U[1].normal.z<=0&&-U[2].normal.z<=0)&&(U=W(U,g),U&&(U=W(U,L),U&&(U=W(U,D),U&&(U=W(U,G),U&&(U=W(U,Z),U&&(U=W(U,c),U)))))))for(let X=0;X<U.length;X++){const F=U[X];if(B.indices.push(o),m?(F.localPositionOverride?(B.eU[3*o]=F.localPositionOverride[0],B.eU[3*o+1]=F.localPositionOverride[1],B.eU[3*o+2]=F.localPositionOverride[2]):N&&(B.eU[3*o]=N[F.vertexIdx],B.eU[3*o+1]=N[F.vertexIdx+1],B.eU[3*o+2]=N[F.vertexIdx+2]),F.localNormalOverride?(B.lU[3*o]=F.localNormalOverride[0],B.lU[3*o+1]=F.localNormalOverride[1],B.lU[3*o+2]=F.localNormalOverride[2]):u&&(B.lU[3*o]=u[F.vertexIdx],B.lU[3*o+1]=u[F.vertexIdx+1],B.lU[3*o+2]=u[F.vertexIdx+2])):(F.position.toArray(B.eU,3*o),F.normal.toArray(B.lU,3*o)),B.matricesIndices&&B.matricesWeights&&(F.matrixIndicesOverride?(B.matricesIndices[4*o]=F.matrixIndicesOverride[0],B.matricesIndices[4*o+1]=F.matrixIndicesOverride[1],B.matricesIndices[4*o+2]=F.matrixIndicesOverride[2],B.matricesIndices[4*o+3]=F.matrixIndicesOverride[3]):(P&&(B.matricesIndices[4*o]=P[F.vertexIdxForBones],B.matricesIndices[4*o+1]=P[F.vertexIdxForBones+1],B.matricesIndices[4*o+2]=P[F.vertexIdxForBones+2],B.matricesIndices[4*o+3]=P[F.vertexIdxForBones+3]),j&&B.matricesIndicesExtra&&(B.matricesIndicesExtra[4*o]=j[F.vertexIdxForBones],B.matricesIndicesExtra[4*o+1]=j[F.vertexIdxForBones+1],B.matricesIndicesExtra[4*o+2]=j[F.vertexIdxForBones+2],B.matricesIndicesExtra[4*o+3]=j[F.vertexIdxForBones+3])),F.matrixWeightsOverride?(B.matricesWeights[4*o]=F.matrixWeightsOverride[0],B.matricesWeights[4*o+1]=F.matrixWeightsOverride[1],B.matricesWeights[4*o+2]=F.matrixWeightsOverride[2],B.matricesWeights[4*o+3]=F.matrixWeightsOverride[3]):(f&&(B.matricesWeights[4*o]=f[F.vertexIdxForBones],B.matricesWeights[4*o+1]=f[F.vertexIdxForBones+1],B.matricesWeights[4*o+2]=f[F.vertexIdxForBones+2],B.matricesWeights[4*o+3]=f[F.vertexIdxForBones+3]),e&&B.matricesWeightsExtra&&(B.matricesWeightsExtra[4*o]=e[F.vertexIdxForBones],B.matricesWeightsExtra[4*o+1]=e[F.vertexIdxForBones+1],B.matricesWeightsExtra[4*o+2]=e[F.vertexIdxForBones+2],B.matricesWeightsExtra[4*o+3]=e[F.vertexIdxForBones+3]))),b.captureUVS)F.uv.toArray(B.kU,2*o);else{B.kU.push(.5+F.position.x/k.x);const U=.5+F.position.y/k.y;B.kU.push(z.b?1-U:U)}o++}}}0===B.indices.length&&(B.indices=null),0===B.eU.length&&(B.eU=null),0===B.lU.length&&(B.lU=null),0===B.kU.length&&(B.kU=null),0===(null===(p=B.matricesIndices)||void 0===p?void 0:p.length)&&(B.matricesIndices=null),0===(null===(S=B.matricesWeights)||void 0===S?void 0:S.length)&&(B.matricesWeights=null),0===(null===(R=B.matricesIndicesExtra)||void 0===R?void 0:R.length)&&(B.matricesIndicesExtra=null),0===(null===(n=B.matricesWeightsExtra)||void 0===n?void 0:n.length)&&(B.matricesWeightsExtra=null);const T=new E.e(U,X.fU());return B.AU(T),m?(T.skeleton=X.skeleton,T.parent=X):(T.position=l.clone(),T.rotation=new F.JX(h,A,v)),T.Ob(!0),T.refreshBoundingInfo(!0,!0),T}function H(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const X=0|Math.max(U.subdivisions?U.subdivisions:2,1),b=0|Math.max(U.tessellation?U.tessellation:16,3),E=Math.max(U.height?U.height:1,0),w=Math.max(U.radius?U.radius:.25,0),q=0|Math.max(U.capSubdivisions?U.capSubdivisions:6,1),p=b,S=X,R=Math.max(U.radiusTop?U.radiusTop:w,0),n=Math.max(U.radiusBottom?U.radiusBottom:w,0),a=E-(R+n),J=2*Math.PI,m=Math.max(U.topCapSubdivisions?U.topCapSubdivisions:q,1),x=Math.max(U.bottomCapSubdivisions?U.bottomCapSubdivisions:q,1),I=Math.acos((n-R)/E);let O=[];const N=[],u=[],i=[];let P=0;const f=[],j=.5*a,e=.5*Math.PI;let l,d;const k=F.JX.Zero(),v=F.JX.Zero(),A=Math.cos(I),s=Math.sin(I),h=new F.Vector2(R*s,j+R*A).mX(new F.Vector2(n*s,n*A-j)).length(),B=R*I+h+n*(e-I);let o=0;for(d=0;d<=m;d++){const U=[],X=e-I*(d/m);o+=R*I/m;const b=Math.cos(X),F=Math.sin(X),E=b*R;for(l=0;l<=p;l++){const X=l/p,w=X*J+0,Q=Math.sin(w),q=Math.cos(w);v.x=E*Q,v.y=j+F*R,v.z=E*q,N.push(v.x,v.y,v.z),k.set(b*Q,F,b*q),u.push(k.x,k.y,k.z),i.push(X,z.b?o/B:1-o/B),U.push(P),P++}f.push(U)}const y=E-R-n+A*R-A*n,t=s*(n-R)/y;for(d=1;d<=S;d++){const U=[];o+=h/S;const X=s*(d*(n-R)/S+R);for(l=0;l<=p;l++){const b=l/p,F=b*J+0,E=Math.sin(F),w=Math.cos(F);v.x=X*E,v.y=j+A*R-d*y/S,v.z=X*w,N.push(v.x,v.y,v.z),k.set(E,t,w).normalize(),u.push(k.x,k.y,k.z),i.push(b,z.b?o/B:1-o/B),U.push(P),P++}f.push(U)}for(d=1;d<=x;d++){const U=[],X=e-I-(Math.PI-I)*(d/x);o+=n*I/x;const b=Math.cos(X),F=Math.sin(X),E=b*n;for(l=0;l<=p;l++){const X=l/p,w=X*J+0,Q=Math.sin(w),q=Math.cos(w);v.x=E*Q,v.y=F*n-j,v.z=E*q,N.push(v.x,v.y,v.z),k.set(b*Q,F,b*q),u.push(k.x,k.y,k.z),i.push(X,z.b?o/B:1-o/B),U.push(P),P++}f.push(U)}for(l=0;l<p;l++)for(d=0;d<m+S+x;d++){const U=f[d][l],X=f[d+1][l],b=f[d+1][l+1],F=f[d][l+1];O.push(U),O.push(X),O.push(F),O.push(X),O.push(b),O.push(F)}if(O=O.reverse(),U.orientation&&!U.orientation.equals(F.JX.Up())){const X=new F.Matrix;U.orientation.clone().scale(.5*Math.PI).cross(F.JX.Up()).toQuaternion().toRotationMatrix(X);const b=F.JX.Zero();for(let U=0;U<N.length;U+=3)b.set(N[U],N[U+1],N[U+2]),F.JX.TransformCoordinatesToRef(b.clone(),X,b),N[U]=b.x,N[U+1]=b.y,N[U+2]=b.z}const W=new Q.d;return W.eU=N,W.lU=u,W.kU=i,W.indices=O,W}function T(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:F.JX.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new E.e(U,b);return H(X).AU(w,X.updatable),w}E.e.CreateDecal=(U,X,b,F,E,w)=>M(U,X,{position:b,normal:F,size:E,angle:w});E.e.CreateCapsule=(U,X,b)=>T(U,X,b),Q.d.CreateCapsule=H;var C=b(11408),UU=b(11597);class XU{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=U,this.y=X,U!==Math.floor(U)&&(U=Math.floor(U),C.e.Warn("x is not an integer, floor(x) used")),X!==Math.floor(X)&&(X=Math.floor(X),C.e.Warn("y is not an integer, floor(y) used"))}clone(){return new XU(this.x,this.y)}rotate60About(U){const X=this.x;return this.x=U.x+U.y-this.y,this.y=X+this.y-U.x,this}rotateNeg60About(U){const X=this.x;return this.x=X+this.y-U.y,this.y=U.x+U.y-X,this}rotate120(U,X){U!==Math.floor(U)&&(U=Math.floor(U),C.e.Warn("m not an integer only floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),C.e.Warn("n not an integer only floor(n) used"));const b=this.x;return this.x=U-b-this.y,this.y=X+b,this}rotateNeg120(U,X){U!==Math.floor(U)&&(U=Math.floor(U),C.e.Warn("m is not an integer, floor(m) used")),X!==Math.floor(X)&&(X=Math.floor(X),C.e.Warn("n is not an integer,   floor(n) used"));const b=this.x;return this.x=this.y-X,this.y=U+X-b-this.y,this}toCartesianOrigin(U,X){const b=F.JX.Zero();return b.x=U.x+2*this.x*X+this.y*X,b.y=U.y+Math.sqrt(3)*this.y*X,b}static Zero(){return new XU(0,0)}}class bU{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new FU("icosahedron","Regular",[[0,UU.f,-1],[-UU.f,1,0],[-1,0,-UU.f],[1,0,-UU.f],[UU.f,1,0],[0,UU.f,1],[-1,0,UU.f],[-UU.f,-1,0],[0,-UU.f,-1],[UU.f,-1,0],[1,0,UU.f],[0,-UU.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let U=12;const X={},b=this.m,F=this.n;let E,w,Q,z,q,p=b,S=1,R=0;0!==F&&(p=(0,V.HighestCommonFactor)(b,F)),S=b/p,R=F/p;const n=XU.Zero(),a=new XU(b,F),J=new XU(-F,b+F),m=XU.Zero(),x=XU.Zero(),I=XU.Zero();let O,N,u,i,P=[];const f=[],j=this.vertByDist,e=(b,F,E,w)=>{O=b+"|"+E,N=F+"|"+w,O in X||N in X?O in X&&!(N in X)?X[N]=X[O]:N in X&&!(O in X)&&(X[O]=X[N]):(X[O]=U,X[N]=U,U++),j[E][0]>2?f[X[O]]=[-j[E][0],j[E][1],X[O]]:f[X[O]]=[P[j[E][0]],j[E][1],X[O]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let l=0;l<20;l++){if(P=this.IDATA.face[l],Q=P[2],z=P[1],q=P[0],u=n.x+"|"+n.y,O=l+"|"+u,O in X||(X[O]=Q,f[Q]=[P[j[u][0]],j[u][1]]),u=a.x+"|"+a.y,O=l+"|"+u,O in X||(X[O]=z,f[z]=[P[j[u][0]],j[u][1]]),u=J.x+"|"+J.y,O=l+"|"+u,O in X||(X[O]=q,f[q]=[P[j[u][0]],j[u][1]]),E=this.IDATA.edgematch[l][0],w=this.IDATA.edgematch[l][1],"B"===w)for(let U=1;U<p;U++)x.x=b-U*(S+R),x.y=F+U*S,I.x=-U*R,I.y=U*(S+R),u=x.x+"|"+x.y,i=I.x+"|"+I.y,e(l,E,u,i);if("O"===w)for(let U=1;U<p;U++)I.x=-U*R,I.y=U*(S+R),m.x=U*S,m.y=U*R,u=I.x+"|"+I.y,i=m.x+"|"+m.y,e(l,E,u,i);if(E=this.IDATA.edgematch[l][2],w=this.IDATA.edgematch[l][3],w&&"A"===w)for(let U=1;U<p;U++)m.x=U*S,m.y=U*R,x.x=b-(p-U)*(S+R),x.y=F+(p-U)*S,u=m.x+"|"+m.y,i=x.x+"|"+x.y,e(l,E,u,i);for(let b=0;b<this.vertices.length;b++)u=this.vertices[b].x+"|"+this.vertices[b].y,O=l+"|"+u,O in X||(X[O]=U++,j[u][0]>2?f[X[O]]=[-j[u][0],j[u][1],X[O]]:f[X[O]]=[P[j[u][0]],j[u][1],X[O]])}this.closestTo=f,this.vecToidx=X}calcCoeffs(){const U=this.m,X=this.n,b=Math.sqrt(3)/3,F=U*U+X*X+U*X;this.coau=(U+X)/F,this.cobu=-X/F,this.coav=-b*(U-X)/F,this.cobv=b*(2*U+X)/F}createInnerFacets(){const U=this.m,X=this.n;for(let b=0;b<X+U+1;b++)for(let U=this.min[b];U<this.max[b]+1;U++)U<this.max[b]&&U<this.max[b+1]+1&&this.innerFacets.push(["|"+U+"|"+b,"|"+U+"|"+(b+1),"|"+(U+1)+"|"+b]),b>0&&U<this.max[b-1]&&U+1<this.max[b]+1&&this.innerFacets.push(["|"+U+"|"+b,"|"+(U+1)+"|"+b,"|"+(U+1)+"|"+(b-1)])}edgeVecsABOB(){const U=this.m,X=this.n,b=new XU(-X,U+X);for(let F=1;F<U+X;F++){const U=new XU(this.min[F],F),X=new XU(this.min[F-1],F-1),E=new XU(this.min[F+1],F+1),w=U.clone(),Q=X.clone(),z=E.clone();w.rotate60About(b),Q.rotate60About(b),z.rotate60About(b);const q=new XU(this.max[w.y],w.y),p=new XU(this.max[w.y-1],w.y-1),S=new XU(this.max[w.y-1]-1,w.y-1);w.x===q.x&&w.y===q.y||(w.x!==p.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,p,S]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,S,q])):w.y===z.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([U,X,p]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([U,p,E])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([U,X,p]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([U,p,q])))}}mapABOBtoOBOA(){const U=new XU(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const b=[];for(let F=0;F<3;F++)U.x=this.isoVecsABOB[X][F].x,U.y=this.isoVecsABOB[X][F].y,0===this.vertexTypes[X][F]&&U.rotateNeg120(this.m,this.n),b.push(U.clone());this.isoVecsOBOA.push(b)}}mapABOBtoBAOA(){const U=new XU(0,0);for(let X=0;X<this.isoVecsABOB.length;X++){const b=[];for(let F=0;F<3;F++)U.x=this.isoVecsABOB[X][F].x,U.y=this.isoVecsABOB[X][F].y,1===this.vertexTypes[X][F]&&U.rotate120(this.m,this.n),b.push(U.clone());this.isoVecsBAOA.push(b)}}MapToFace(U,X){const b=this.IDATA.face[U],E=b[2],w=b[1],Q=b[0],z=F.JX.uX(this.IDATA.vertex[E]),q=F.JX.uX(this.IDATA.vertex[w]),p=F.JX.uX(this.IDATA.vertex[Q]),S=q.mX(z),R=p.mX(z),n=S.scale(this.coau).add(R.scale(this.cobu)),a=S.scale(this.coav).add(R.scale(this.cobv)),J=[];let m,x=F.TmpVectors.JX[0];for(let F=0;F<this.cartesian.length;F++)x=n.scale(this.cartesian[F].x).add(a.scale(this.cartesian[F].y)).add(z),J[F]=[x.x,x.y,x.z],m=U+"|"+this.vertices[F].x+"|"+this.vertices[F].y,X.vertex[this.vecToidx[m]]=[x.x,x.y,x.z]}build(U,X){const b=[],F=XU.Zero(),E=new XU(U,X),w=new XU(-X,U+X);b.push(F,E,w);for(let u=X;u<U+1;u++)for(let X=0;X<U+1-u;X++)b.push(new XU(X,u));if(X>0){const F=(0,V.HighestCommonFactor)(U,X),E=U/F,w=X/F;for(let z=1;z<F;z++)b.push(new XU(z*E,z*w)),b.push(new XU(-z*w,z*(E+w))),b.push(new XU(U-z*(E+w),X+z*E));const Q=U/X;for(let z=1;z<X;z++)for(let F=0;F<z*Q;F++)b.push(new XU(F,z)),b.push(new XU(F,z).rotate120(U,X)),b.push(new XU(F,z).rotateNeg120(U,X))}b.sort(((U,X)=>U.x-X.x)),b.sort(((U,X)=>U.y-X.y));const Q=new Array(U+X+1),z=new Array(U+X+1);for(let u=0;u<Q.length;u++)Q[u]=1/0,z[u]=-1/0;let q=0,p=0;const S=b.length;for(let u=0;u<S;u++)p=b[u].x,q=b[u].y,Q[q]=Math.min(p,Q[q]),z[q]=Math.max(p,z[q]);const R=(b,F)=>{const E=b.clone();return"A"===F&&E.rotateNeg120(U,X),"B"===F&&E.rotate120(U,X),E.x<0?E.y:E.x+E.y},n=[],a=[],J=[],m=[],x={},I=[];let O=-1,N=-1;for(let u=0;u<S;u++)n[u]=b[u].toCartesianOrigin(new XU(0,0),.5),a[u]=R(b[u],"O"),J[u]=R(b[u],"A"),m[u]=R(b[u],"B"),a[u]===J[u]&&J[u]===m[u]?(O=3,N=a[u]):a[u]===J[u]?(O=4,N=a[u]):J[u]===m[u]?(O=5,N=J[u]):m[u]===a[u]&&(O=6,N=a[u]),a[u]<J[u]&&a[u]<m[u]&&(O=2,N=a[u]),J[u]<a[u]&&J[u]<m[u]&&(O=1,N=J[u]),m[u]<J[u]&&m[u]<a[u]&&(O=0,N=m[u]),I.push([O,N,b[u].x,b[u].y]);I.sort(((U,X)=>U[2]-X[2])),I.sort(((U,X)=>U[3]-X[3])),I.sort(((U,X)=>U[1]-X[1])),I.sort(((U,X)=>U[0]-X[0]));for(let u=0;u<I.length;u++)x[I[u][2]+"|"+I[u][3]]=[I[u][0],I[u][1],u];return this.m=U,this.n=X,this.vertices=b,this.vertByDist=x,this.cartesian=n,this.min=Q,this.max=z,this}}class FU{constructor(U,X,b,F){this.name=U,this.category=X,this.vertex=b,this.face=F}}class EU extends FU{innerToData(U,X){for(let b=0;b<X.innerFacets.length;b++)this.face.push(X.innerFacets[b].map((b=>X.vecToidx[U+b])))}mapABOBtoDATA(U,X){const b=X.IDATA.edgematch[U][0];for(let F=0;F<X.isoVecsABOB.length;F++){const E=[];for(let w=0;w<3;w++)0===X.vertexTypes[F][w]?E.push(U+"|"+X.isoVecsABOB[F][w].x+"|"+X.isoVecsABOB[F][w].y):E.push(b+"|"+X.isoVecsABOB[F][w].x+"|"+X.isoVecsABOB[F][w].y);this.face.push([X.vecToidx[E[0]],X.vecToidx[E[1]],X.vecToidx[E[2]]])}}mapOBOAtoDATA(U,X){const b=X.IDATA.edgematch[U][0];for(let F=0;F<X.isoVecsOBOA.length;F++){const E=[];for(let w=0;w<3;w++)1===X.vertexTypes[F][w]?E.push(U+"|"+X.isoVecsOBOA[F][w].x+"|"+X.isoVecsOBOA[F][w].y):E.push(b+"|"+X.isoVecsOBOA[F][w].x+"|"+X.isoVecsOBOA[F][w].y);this.face.push([X.vecToidx[E[0]],X.vecToidx[E[1]],X.vecToidx[E[2]]])}}mapBAOAtoDATA(U,X){const b=X.IDATA.edgematch[U][2];for(let F=0;F<X.isoVecsBAOA.length;F++){const E=[];for(let w=0;w<3;w++)1===X.vertexTypes[F][w]?E.push(U+"|"+X.isoVecsBAOA[F][w].x+"|"+X.isoVecsBAOA[F][w].y):E.push(b+"|"+X.isoVecsBAOA[F][w].x+"|"+X.isoVecsBAOA[F][w].y);this.face.push([X.vecToidx[E[0]],X.vecToidx[E[1]],X.vecToidx[E[2]]])}}orderData(U){const X=[];for(let w=0;w<13;w++)X[w]=[];const b=U.closestTo;for(let w=0;w<b.length;w++)b[w][0]>-1?b[w][1]>0&&X[b[w][0]].push([w,b[w][1]]):X[12].push([w,b[w][0]]);const F=[];for(let w=0;w<12;w++)F[w]=w;let E=12;for(let w=0;w<12;w++){X[w].sort(((U,X)=>U[1]-X[1]));for(let U=0;U<X[w].length;U++)F[X[w][U][0]]=E++}for(let w=0;w<X[12].length;w++)F[X[12][w][0]]=E++;for(let w=0;w<this.vertex.length;w++)this.vertex[w].push(F[w]);this.vertex.sort(((U,X)=>U[3]-X[3]));for(let w=0;w<this.vertex.length;w++)this.vertex[w].pop();for(let w=0;w<this.face.length;w++)for(let U=0;U<this.face[w].length;U++)this.face[w][U]=F[this.face[w][U]];this.sharedNodes=X[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(U,X){const b=[],F=[];let E=X.pop();F.push(E);let w=this.face[E].indexOf(U);w=(w+2)%3;let Q=this.face[E][w];b.push(Q);let z=0;for(;X.length>0;)E=X[z],this.face[E].indexOf(Q)>-1?(w=(this.face[E].indexOf(Q)+1)%3,Q=this.face[E][w],b.push(Q),F.push(E),X.splice(z,1),z=0):z++;return this.adjacentFaces.push(b),F}toGoldbergPolyhedronData(){const U=new FU("GeoDual","Goldberg",[],[]);U.name="GD dual";const X=this.vertex.length,b=new Array(X);for(let q=0;q<X;q++)b[q]=[];for(let q=0;q<this.face.length;q++)for(let U=0;U<3;U++)b[this.face[q][U]].push(q);let F=0,E=0,w=0,Q=[],z=[];this.adjacentFaces=[];for(let q=0;q<b.length;q++){U.face[q]=this.setOrder(q,b[q].concat([]));for(const X of b[q]){F=0,E=0,w=0,Q=this.face[X];for(let U=0;U<3;U++)z=this.vertex[Q[U]],F+=z[0],E+=z[1],w+=z[2];U.vertex[X]=[F/3,E/3,w/3]}}return U}static BuildGeodesicData(U){const X=new EU("Geodesic-m-n","Geodesic",[[0,UU.f,-1],[-UU.f,1,0],[-1,0,-UU.f],[1,0,-UU.f],[UU.f,1,0],[0,UU.f,1],[-1,0,UU.f],[-UU.f,-1,0],[0,-UU.f,-1],[UU.f,-1,0],[1,0,UU.f],[0,-UU.f,1]],[]);U.setIndices(),U.calcCoeffs(),U.createInnerFacets(),U.edgeVecsABOB(),U.mapABOBtoOBOA(),U.mapABOBtoBAOA();for(let b=0;b<U.IDATA.face.length;b++)U.MapToFace(b,X),X.innerToData(b,U),"B"===U.IDATA.edgematch[b][1]&&X.mapABOBtoDATA(b,U),"O"===U.IDATA.edgematch[b][1]&&X.mapOBOAtoDATA(b,U),"A"===U.IDATA.edgematch[b][3]&&X.mapBAOAtoDATA(b,U);X.orderData(U);return X.vertex=X.vertex.map((function(U){const X=U[0],b=U[1],F=U[2],E=Math.sqrt(X*X+b*b+F*F);return U[0]*=1/E,U[1]*=1/E,U[2]*=1/E,U})),X}}E.e._GoldbergMeshParser=(U,X)=>wU.Parse(U,X);class wU extends E.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(U,X){return void 0===X?(U>this.goldbergData.nbUnsharedFaces-1&&(C.e.Warn("Maximum number of unshared faces used"),U=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+U):(U>11&&(C.e.Warn("Last pole used"),U=11),X>this.goldbergData.nbFacesAtPole-1&&(C.e.Warn("Maximum number of faces at a pole used"),X=this.goldbergData.nbFacesAtPole-1),12+U*this.goldbergData.nbFacesAtPole+X)}_changeGoldbergFaceColors(U){for(let b=0;b<U.length;b++){const X=U[b][0],F=U[b][1],E=U[b][2];for(let U=X;U<F+1;U++)this.goldbergData.faceColors[U]=E}const X=[];for(let b=0;b<12;b++)for(let U=0;U<5;U++)X.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);for(let b=12;b<this.goldbergData.faceColors.length;b++)for(let U=0;U<6;U++)X.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);return X}setGoldbergFaceColors(U){const X=this._changeGoldbergFaceColors(U);this.oU(w.h.ColorKind,X)}updateGoldbergFaceColors(U){const X=this._changeGoldbergFaceColors(U);this.updateVerticesData(w.h.ColorKind,X)}_changeGoldbergFaceUVs(U){const X=this.getVerticesData(w.h.UVKind);for(let b=0;b<U.length;b++){const F=U[b][0],E=U[b][1],w=U[b][2],Q=U[b][3],z=U[b][4],q=[],p=[];let S,R;for(let U=0;U<5;U++)S=w.x+Q*Math.cos(z+U*Math.PI/2.5),R=w.y+Q*Math.sin(z+U*Math.PI/2.5),S<0&&(S=0),S>1&&(S=1),q.push(S,R);for(let U=0;U<6;U++)S=w.x+Q*Math.cos(z+U*Math.PI/3),R=w.y+Q*Math.sin(z+U*Math.PI/3),S<0&&(S=0),S>1&&(S=1),p.push(S,R);for(let U=F;U<Math.min(12,E+1);U++)for(let b=0;b<5;b++)X[10*U+2*b]=q[2*b],X[10*U+2*b+1]=q[2*b+1];for(let U=Math.max(12,F);U<E+1;U++)for(let b=0;b<6;b++)X[12*U-24+2*b]=p[2*b],X[12*U-23+2*b]=p[2*b+1]}return X}setGoldbergFaceUVs(U){const X=this._changeGoldbergFaceUVs(U);this.oU(w.h.UVKind,X)}updateGoldbergFaceUVs(U){const X=this._changeGoldbergFaceUVs(U);this.updateVerticesData(w.h.UVKind,X)}placeOnGoldbergFaceAt(U,X,b){const E=F.JX.RotationFromAxis(this.goldbergData.faceXaxis[X],this.goldbergData.faceYaxis[X],this.goldbergData.faceZaxis[X]);U.rotation=E,U.position=this.goldbergData.faceCenters[X].add(this.goldbergData.faceXaxis[X].scale(b.x)).add(this.goldbergData.faceYaxis[X].scale(b.y)).add(this.goldbergData.faceZaxis[X].scale(b.z))}serialize(U){super.serialize(U),U.type="GoldbergMesh";const X={};if(X.adjacentFaces=this.goldbergData.adjacentFaces,X.nbSharedFaces=this.goldbergData.nbSharedFaces,X.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,X.nbFaces=this.goldbergData.nbFaces,X.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){X.faceColors=[];for(const U of this.goldbergData.faceColors)X.faceColors.push(U.Jb())}if(this.goldbergData.faceCenters){X.faceCenters=[];for(const U of this.goldbergData.faceCenters)X.faceCenters.push(U.Jb())}if(this.goldbergData.faceZaxis){X.faceZaxis=[];for(const U of this.goldbergData.faceZaxis)X.faceZaxis.push(U.Jb())}if(this.goldbergData.faceYaxis){X.faceYaxis=[];for(const U of this.goldbergData.faceYaxis)X.faceYaxis.push(U.Jb())}if(this.goldbergData.faceXaxis){X.faceXaxis=[];for(const U of this.goldbergData.faceXaxis)X.faceXaxis.push(U.Jb())}U.goldbergData=X}static Parse(U,X){const b=U.goldbergData;b.faceColors=b.faceColors.map((U=>n.eb.uX(U))),b.faceCenters=b.faceCenters.map((U=>F.JX.uX(U))),b.faceZaxis=b.faceZaxis.map((U=>F.JX.uX(U))),b.faceXaxis=b.faceXaxis.map((U=>F.JX.uX(U))),b.faceYaxis=b.faceYaxis.map((U=>F.JX.uX(U)));const E=new wU(U.name,X);return E.goldbergData=b,E}}var QU=b(12163);const zU={CreateBox:R.e,CreateTiledBox:x,CreateSphere:I.e,CreateDisc:S.b,CreateIcoSphere:K,CreateRibbon:p,CreateCylinder:i,CreateTorus:f,CreateTorusKnot:e,CreateLineSystem:l.h,dp:l.k,CreateDashedLines:l.d,ExtrudeShape:v,ExtrudeShapeCustom:A,CreateLathe:h,CreateTiledPlane:J,Ap:B.d,CreateGround:o.c,CreateTiledGround:o.g,CreateGroundFromHeightMap:o.b,CreatePolygon:d.c,ExtrudePolygon:d.g,CreateTube:y,CreatePolyhedron:W,CreateGeodesic:function(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=X.m||1;F!==Math.floor(F)&&(F=Math.floor(F),C.e.Warn("m not an integer only floor(m) used"));let E=X.n||0;if(E!==Math.floor(E)&&(E=Math.floor(E),C.e.Warn("n not an integer only floor(n) used")),E>F){const U=E;E=F,F=U,C.e.Warn("n > m therefore m and n swapped")}const w=new bU;return w.build(F,E),W(U,{custom:EU.BuildGeodesicData(w),size:X.size,sizeX:X.sizeX,sizeY:X.sizeY,sizeZ:X.sizeZ,faceUV:X.faceUV,faceColors:X.faceColors,flat:X.flat,updatable:X.updatable,sideOrientation:X.sideOrientation,frontUVs:X.frontUVs,backUVs:X.backUVs},b)},CreateGoldberg:function(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=X.size,q=X.sizeX||w||1,p=X.sizeY||w||1,S=X.sizeZ||w||1;let R=X.m||1;R!==Math.floor(R)&&(R=Math.floor(R),C.e.Warn("m not an integer only floor(m) used"));let a=X.n||0;if(a!==Math.floor(a)&&(a=Math.floor(a),C.e.Warn("n not an integer only floor(n) used")),a>R){const U=a;a=R,R=U,C.e.Warn("n > m therefore m and n swapped")}const J=new bU;J.build(R,a);const m=EU.BuildGeodesicData(J),x=m.toGoldbergPolyhedronData(),I=new wU(U,b);X.sideOrientation=E.e._GetDefaultSideOrientation(X.sideOrientation),I._originalBuilderSideOrientation=X.sideOrientation;(function(U,X){const b=U.size,E=U.sizeX||b||1,w=U.sizeY||b||1,q=U.sizeZ||b||1,p=0===U.sideOrientation?0:U.sideOrientation||Q.d.DEFAULTSIDE,S=[],R=[],n=[],a=[];let J=1/0,m=-1/0,x=1/0,I=-1/0;for(let F=0;F<X.vertex.length;F++)J=Math.min(J,X.vertex[F][0]*E),m=Math.max(m,X.vertex[F][0]*E),x=Math.min(x,X.vertex[F][1]*w),I=Math.max(I,X.vertex[F][1]*w);let O=0;for(let Q=0;Q<X.face.length;Q++){const U=X.face[Q],b=F.JX.uX(X.vertex[U[0]]),p=F.JX.uX(X.vertex[U[2]]),N=F.JX.uX(X.vertex[U[1]]),u=p.mX(b),i=N.mX(b),P=F.JX.Cross(i,u).normalize();for(let F=0;F<U.length;F++){n.push(P.x,P.y,P.z);const b=X.vertex[U[F]];S.push(b[0]*E,b[1]*w,b[2]*q);const Q=(b[1]*w-x)/(I-x);a.push((b[0]*E-J)/(m-J),z.b?1-Q:Q)}for(let X=0;X<U.length-2;X++)R.push(O,O+X+2,O+X+1);O+=U.length}Q.d._ComputeSides(p,S,R,n,a);const N=new Q.d;return N.eU=S,N.indices=R,N.lU=n,N.kU=a,N})(X,x).AU(I,X.updatable),I.goldbergData.nbSharedFaces=m.sharedNodes,I.goldbergData.nbUnsharedFaces=m.poleNodes,I.goldbergData.adjacentFaces=m.adjacentFaces,I.goldbergData.nbFaces=I.goldbergData.nbSharedFaces+I.goldbergData.nbUnsharedFaces,I.goldbergData.nbFacesAtPole=(I.goldbergData.nbUnsharedFaces-12)/12;for(let E=0;E<m.vertex.length;E++)I.goldbergData.faceCenters.push(F.JX.uX(m.vertex[E])),I.goldbergData.faceCenters[E].x*=q,I.goldbergData.faceCenters[E].y*=p,I.goldbergData.faceCenters[E].z*=S,I.goldbergData.faceColors.push(new n.eb(1,1,1,1));for(let E=0;E<x.face.length;E++){const U=x.face[E],X=F.JX.uX(x.vertex[U[0]]),b=F.JX.uX(x.vertex[U[2]]),w=F.JX.uX(x.vertex[U[1]]),Q=b.mX(X),z=w.mX(X),q=F.JX.Cross(z,Q).normalize(),p=F.JX.Cross(z,q).normalize();I.goldbergData.faceXaxis.push(z.normalize()),I.goldbergData.faceYaxis.push(q),I.goldbergData.faceZaxis.push(p)}return I},CreateDecal:M,CreateCapsule:T,CreateText:QU.g}},12881:(U,X,b)=>{"use strict";b.d(X,{d:()=>zX});var F=b(11593),E=b(11987);class w extends E.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Q=b(11636),z=(b(11751),b(11551));class q{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(U){this._targetStopDuration!==U&&(this._targetStopDuration=U)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(U){this._noiseTexture!==U&&(this._noiseTexture=U,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(U){this._animationSheetEnabled!==U&&(this._animationSheetEnabled=U)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(U){this._isAnimationSheetEnabled!=U&&(this._isAnimationSheetEnabled=U,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(U){this._useLogarithmicDepth=U&&this.fU().getEngine().getCaps().fragmentDepthSupported}fU(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(U){switch(U){case q.BLENDMODE_MULTIPLYADD:return;case q.BLENDMODE_ADD:U=1;break;case q.BLENDMODE_ONEONE:U=6;break;case q.BLENDMODE_STANDARD:U=2;break;case q.BLENDMODE_MULTIPLY:U=4;break;case q.BLENDMODE_SUBTRACT:U=3}this._engine.setAlphaMode(U)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:F.JX.Zero()}set direction1(U){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=U)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:F.JX.Zero()}set direction2(U){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=U)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:F.JX.Zero()}set minEmitBox(U){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=U)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:F.JX.Zero()}set maxEmitBox(U){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=U)}get billboardMode(){return this._billboardMode}set billboardMode(U){this._billboardMode!==U&&(this._billboardMode=U,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(U){this._isBillboardBased!==U&&(this._isBillboardBased=U,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(U){this._attachImageProcessingConfiguration(U)}_attachImageProcessingConfiguration(U){U!==this._imageProcessingConfiguration&&(!U&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=U)}_reset(){}_removeGradientAndTexture(U,X,b){if(!X)return this;let F=0;for(const E of X){if(E.gradient===U){X.splice(F,1);break}F++}return b&&b.dispose(),this}constructor(U){this.animations=[],this.renderingGroupId=0,this.FX=F.JX.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new F.JX(10,10,10),this.onAnimationEnd=null,this.blendMode=q.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new F.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.jp=new F.JX(0,0,0),this._useLogarithmicDepth=!1,this.gravity=F.JX.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Q.eb(1,1,1,1),this.color2=new Q.eb(1,1,1,1),this.colorDead=new Q.eb(0,0,0,1),this.textureMask=new Q.eb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new w,this.id=U,this.name=U}createPointEmitter(U,X){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new F.JX(0,1,0),arguments.length>2&&void 0!==arguments[2]||new F.JX(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new F.JX(0,1,0),arguments.length>4&&void 0!==arguments[4]||new F.JX(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new F.JX(0,1,0),arguments.length>3&&void 0!==arguments[3]||new F.JX(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(U,X,b,F){throw new Error("Method not implemented.")}}q.BLENDMODE_ONEONE=0,q.BLENDMODE_STANDARD=1,q.BLENDMODE_ADD=2,q.BLENDMODE_MULTIPLY=3,q.BLENDMODE_MULTIPLYADD=4,q.BLENDMODE_SUBTRACT=-1,(0,z.f)("BABYLON.BaseParticleSystem",q);var p=b(11608),S=b(11416);class R{constructor(){this.direction1=new F.JX(0,1,0),this.direction2=new F.JX(0,1,0),this.minEmitBox=new F.JX(-.5,-.5,-.5),this.maxEmitBox=new F.JX(.5,.5,.5)}startDirectionFunction(U,X,b,E){const w=(0,p.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,p.RandomRange)(this.direction1.y,this.direction2.y),z=(0,p.RandomRange)(this.direction1.z,this.direction2.z);if(E)return X.x=w,X.y=Q,void(X.z=z);F.JX.TransformNormalFromFloatsToRef(w,Q,z,U,X)}startPositionFunction(U,X,b,E){const w=(0,p.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Q=(0,p.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),z=(0,p.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(E)return X.x=w,X.y=Q,void(X.z=z);F.JX.TransformCoordinatesFromFloatsToRef(w,Q,z,U,X)}clone(){const U=new R;return S.d.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2),U.setVector3("minEmitBox",this.minEmitBox),U.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3),U.addUniform("minEmitBox",3),U.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.direction1=this.direction1.Jb(),U.direction2=this.direction2.Jb(),U.minEmitBox=this.minEmitBox.Jb(),U.maxEmitBox=this.maxEmitBox.Jb(),U}parse(U){F.JX.FromArrayToRef(U.direction1,0,this.direction1),F.JX.FromArrayToRef(U.direction2,0,this.direction2),F.JX.FromArrayToRef(U.minEmitBox,0,this.minEmitBox),F.JX.FromArrayToRef(U.maxEmitBox,0,this.maxEmitBox)}}class n{get radius(){return this._radius}set radius(U){this._radius=U,this._buildHeight()}get angle(){return this._angle}set angle(U){this._angle=U,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=b,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=X,this.radius=U}startDirectionFunction(U,X,b,E){E?F.TmpVectors.JX[0].q(b.Fq).normalize():b.position.subtractToRef(U.getTranslation(),F.TmpVectors.JX[0]).normalize();const w=(0,p.RandomRange)(0,this.directionRandomizer),Q=(0,p.RandomRange)(0,this.directionRandomizer),z=(0,p.RandomRange)(0,this.directionRandomizer);X.x=F.TmpVectors.JX[0].x+w,X.y=F.TmpVectors.JX[0].y+Q,X.z=F.TmpVectors.JX[0].z+z,X.normalize()}startPositionFunction(U,X,b,E){const w=(0,p.RandomRange)(0,2*Math.PI);let Q;this.emitFromSpawnPointOnly?Q=1e-4:(Q=(0,p.RandomRange)(0,this.heightRange),Q=1-Q*Q);let z=this._radius-(0,p.RandomRange)(0,this._radius*this.radiusRange);z*=Q;const q=z*Math.sin(w),S=z*Math.cos(w),R=Q*this._height;if(E)return X.x=q,X.y=R,void(X.z=S);F.JX.TransformCoordinatesFromFloatsToRef(q,R,S,U,X)}clone(){const U=new n(this._radius,this._angle,this.directionRandomizer);return S.d.DeepCopy(this,U),U}applyToShader(U){U.setFloat2("radius",this._radius,this.radiusRange),U.setFloat("coneAngle",this._angle),U.setFloat2("height",this._height,this.heightRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",2),U.addUniform("coneAngle",1),U.addUniform("height",2),U.addUniform("directionRandomizer",1)}getEffectDefines(){let U="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(U+="\n#define CONEEMITTERSPAWNPOINT"),U}getClassName(){return"ConeParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this._radius,U.angle=this._angle,U.directionRandomizer=this.directionRandomizer,U.radiusRange=this.radiusRange,U.heightRange=this.heightRange,U.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,U}parse(U){this.radius=U.radius,this.angle=U.angle,this.directionRandomizer=U.directionRandomizer,this.radiusRange=void 0!==U.radiusRange?U.radiusRange:1,this.heightRange=void 0!==U.radiusRange?U.heightRange:1,this.emitFromSpawnPointOnly=void 0!==U.emitFromSpawnPointOnly&&U.emitFromSpawnPointOnly}}class a extends n{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.JX(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.JX(0,1,0);super(U,X),this.direction1=b,this.direction2=E}startDirectionFunction(U,X){const b=(0,p.RandomRange)(this.direction1.x,this.direction2.x),E=(0,p.RandomRange)(this.direction1.y,this.direction2.y),w=(0,p.RandomRange)(this.direction1.z,this.direction2.z);F.JX.TransformNormalFromFloatsToRef(b,E,w,U,X)}clone(){const U=new a(this.radius,this.angle,this.direction1,this.direction2);return S.d.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.Jb(),U.direction2=this.direction2.Jb(),U}parse(U){super.parse(U),this.direction1.q(U.direction1),this.direction2.q(U.direction2)}}class J{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=U,this.height=X,this.radiusRange=b,this.directionRandomizer=E,this._tempVector=F.JX.Zero()}startDirectionFunction(U,X,b,E,w){b.position.subtractToRef(U.getTranslation(),this._tempVector),this._tempVector.normalize(),F.JX.TransformNormalToRef(this._tempVector,w,this._tempVector);const Q=(0,p.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let z=Math.atan2(this._tempVector.x,this._tempVector.z);z+=(0,p.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Q,this._tempVector.x=Math.sin(z),this._tempVector.z=Math.cos(z),this._tempVector.normalize(),E?X.q(this._tempVector):F.JX.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,U,X)}startPositionFunction(U,X,b,E){const w=(0,p.RandomRange)(-this.height/2,this.height/2),Q=(0,p.RandomRange)(0,2*Math.PI),z=(0,p.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),q=Math.sqrt(z)*this.radius,S=q*Math.cos(Q),R=q*Math.sin(Q);E?X.Pb(S,w,R):F.JX.TransformCoordinatesFromFloatsToRef(S,w,R,U,X)}clone(){const U=new J(this.radius,this.directionRandomizer);return S.d.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("height",this.height),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("height",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.height=this.height,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.height=U.height,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class m extends J{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.JX(0,1,0),w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new F.JX(0,1,0);super(U,X,b),this.direction1=E,this.direction2=w}startDirectionFunction(U,X,b,E){const w=(0,p.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,p.RandomRange)(this.direction1.y,this.direction2.y),z=(0,p.RandomRange)(this.direction1.z,this.direction2.z);E?X.Pb(w,Q,z):F.JX.TransformNormalFromFloatsToRef(w,Q,z,U,X)}clone(){const U=new m(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return S.d.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("height",this.height),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("height",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.Jb(),U.direction2=this.direction2.Jb(),U}parse(U){super.parse(U),F.JX.FromArrayToRef(U.direction1,0,this.direction1),F.JX.FromArrayToRef(U.direction2,0,this.direction2)}}class x{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=U,this.radiusRange=X,this.directionRandomizer=b}startDirectionFunction(U,X,b,E){const w=b.position.mX(U.getTranslation()).normalize(),Q=(0,p.RandomRange)(0,this.directionRandomizer),z=(0,p.RandomRange)(0,this.directionRandomizer),q=(0,p.RandomRange)(0,this.directionRandomizer);w.x+=Q,w.y+=z,w.z+=q,w.normalize(),E?X.q(w):F.JX.TransformNormalFromFloatsToRef(w.x,w.y,w.z,U,X)}startPositionFunction(U,X,b,E){const w=this.radius-(0,p.RandomRange)(0,this.radius*this.radiusRange),Q=(0,p.RandomRange)(0,1),z=(0,p.RandomRange)(0,2*Math.PI),q=Math.acos(2*Q-1),S=w*Math.cos(z)*Math.sin(q),R=w*Math.cos(q),n=w*Math.sin(z)*Math.sin(q);E?X.Pb(S,Math.abs(R),n):F.JX.TransformCoordinatesFromFloatsToRef(S,Math.abs(R),n,U,X)}clone(){const U=new x(this.radius,this.directionRandomizer);return S.d.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class I{constructor(){this.direction1=new F.JX(0,1,0),this.direction2=new F.JX(0,1,0)}startDirectionFunction(U,X,b,E){const w=(0,p.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,p.RandomRange)(this.direction1.y,this.direction2.y),z=(0,p.RandomRange)(this.direction1.z,this.direction2.z);E?X.Pb(w,Q,z):F.JX.TransformNormalFromFloatsToRef(w,Q,z,U,X)}startPositionFunction(U,X,b,E){E?X.Pb(0,0,0):F.JX.TransformCoordinatesFromFloatsToRef(0,0,0,U,X)}clone(){const U=new I;return S.d.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.direction1=this.direction1.Jb(),U.direction2=this.direction2.Jb(),U}parse(U){F.JX.FromArrayToRef(U.direction1,0,this.direction1),F.JX.FromArrayToRef(U.direction2,0,this.direction2)}}class O{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=U,this.radiusRange=X,this.directionRandomizer=b}startDirectionFunction(U,X,b,E){const w=b.position.mX(U.getTranslation()).normalize(),Q=(0,p.RandomRange)(0,this.directionRandomizer),z=(0,p.RandomRange)(0,this.directionRandomizer),q=(0,p.RandomRange)(0,this.directionRandomizer);w.x+=Q,w.y+=z,w.z+=q,w.normalize(),E?X.q(w):F.JX.TransformNormalFromFloatsToRef(w.x,w.y,w.z,U,X)}startPositionFunction(U,X,b,E){const w=this.radius-(0,p.RandomRange)(0,this.radius*this.radiusRange),Q=(0,p.RandomRange)(0,1),z=(0,p.RandomRange)(0,2*Math.PI),q=Math.acos(2*Q-1),S=w*Math.cos(z)*Math.sin(q),R=w*Math.cos(q),n=w*Math.sin(z)*Math.sin(q);E?X.Pb(S,R,n):F.JX.TransformCoordinatesFromFloatsToRef(S,R,n,U,X)}clone(){const U=new O(this.radius,this.directionRandomizer);return S.d.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.radius=this.radius,U.radiusRange=this.radiusRange,U.directionRandomizer=this.directionRandomizer,U}parse(U){this.radius=U.radius,this.radiusRange=U.radiusRange,this.directionRandomizer=U.directionRandomizer}}class N extends O{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new F.JX(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.JX(0,1,0);super(U),this.direction1=X,this.direction2=b}startDirectionFunction(U,X){const b=(0,p.RandomRange)(this.direction1.x,this.direction2.x),E=(0,p.RandomRange)(this.direction1.y,this.direction2.y),w=(0,p.RandomRange)(this.direction1.z,this.direction2.z);F.JX.TransformNormalFromFloatsToRef(b,E,w,U,X)}clone(){const U=new N(this.radius,this.direction1,this.direction2);return S.d.DeepCopy(this,U),U}applyToShader(U){U.setFloat("radius",this.radius),U.setFloat("radiusRange",this.radiusRange),U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("radius",1),U.addUniform("radiusRange",1),U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const U=super.serialize();return U.direction1=this.direction1.Jb(),U.direction2=this.direction2.Jb(),U}parse(U){super.parse(U),this.direction1.q(U.direction1),this.direction2.q(U.direction2)}}class u{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(U,X,b,E){const w=F.TmpVectors.JX[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,b,w);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,b,w);const U=F.TmpVectors.JX[1];w.subtractToRef(b.position,U),U.scaleToRef(1/b.lifeTime,w)}else w.set(0,0,0);E?X.q(w):F.JX.TransformNormalToRef(w,U,X)}startPositionFunction(U,X,b,E){const w=F.TmpVectors.JX[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,b,w):w.set(0,0,0),E?X.q(w):F.JX.TransformCoordinatesToRef(w,U,X)}clone(){const U=new u;return S.d.DeepCopy(this,U),U}applyToShader(U){}buildUniformLayout(U){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const U={};return U.type=this.getClassName(),U.particlePositionGenerator=this.particlePositionGenerator,U.particleDestinationGenerator=this.particleDestinationGenerator,U}parse(U){U.particlePositionGenerator&&(this.particlePositionGenerator=U.particlePositionGenerator),U.particleDestinationGenerator&&(this.particleDestinationGenerator=U.particleDestinationGenerator)}}var i=b(11664);class P{get mesh(){return this._mesh}set mesh(U){this._mesh!==U&&(this._mesh=U,U?(this._indices=U.ub(),this._positions=U.getVerticesData(i.h.PositionKind),this._normals=U.getVerticesData(i.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=F.JX.Zero(),this._mesh=null,this.direction1=new F.JX(0,1,0),this.direction2=new F.JX(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=U}startDirectionFunction(U,X,b,E){if(this.useMeshNormalsForDirection&&this._normals)return void F.JX.TransformNormalToRef(this._storedNormal,U,X);const w=(0,p.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,p.RandomRange)(this.direction1.y,this.direction2.y),z=(0,p.RandomRange)(this.direction1.z,this.direction2.z);E?X.Pb(w,Q,z):F.JX.TransformNormalFromFloatsToRef(w,Q,z,U,X)}startPositionFunction(U,X,b,E){if(!this._indices||!this._positions)return;const w=3*(Math.random()*(this._indices.length/3)|0),Q=Math.random(),z=Math.random()*(1-Q),q=1-Q-z,p=this._indices[w],S=this._indices[w+1],R=this._indices[w+2],n=F.TmpVectors.JX[0],a=F.TmpVectors.JX[1],J=F.TmpVectors.JX[2],m=F.TmpVectors.JX[3];F.JX.FromArrayToRef(this._positions,3*p,n),F.JX.FromArrayToRef(this._positions,3*S,a),F.JX.FromArrayToRef(this._positions,3*R,J),m.x=Q*n.x+z*a.x+q*J.x,m.y=Q*n.y+z*a.y+q*J.y,m.z=Q*n.z+z*a.z+q*J.z,E?X.Pb(m.x,m.y,m.z):F.JX.TransformCoordinatesFromFloatsToRef(m.x,m.y,m.z,U,X),this.useMeshNormalsForDirection&&this._normals&&(F.JX.FromArrayToRef(this._normals,3*p,n),F.JX.FromArrayToRef(this._normals,3*S,a),F.JX.FromArrayToRef(this._normals,3*R,J),this._storedNormal.x=Q*n.x+z*a.x+q*J.x,this._storedNormal.y=Q*n.y+z*a.y+q*J.y,this._storedNormal.z=Q*n.z+z*a.z+q*J.z)}clone(){const U=new P(this.mesh);return S.d.DeepCopy(this,U),U}applyToShader(U){U.setVector3("direction1",this.direction1),U.setVector3("direction2",this.direction2)}buildUniformLayout(U){U.addUniform("direction1",3),U.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var U;const X={};return X.type=this.getClassName(),X.direction1=this.direction1.Jb(),X.direction2=this.direction2.Jb(),X.meshId=null===(U=this.mesh)||void 0===U?void 0:U.id,X.useMeshNormalsForDirection=this.useMeshNormalsForDirection,X}parse(U,X){F.JX.FromArrayToRef(U.direction1,0,this.direction1),F.JX.FromArrayToRef(U.direction2,0,this.direction2),U.meshId&&X&&(this.mesh=X.getLastMeshById(U.meshId)),this.useMeshNormalsForDirection=U.useMeshNormalsForDirection}}class f{_isUbo(U){return void 0!==U.addUniform}constructor(U){this._isUbo(U)?(this.setMatrix3x3=U.updateMatrix3x3.bind(U),this.setMatrix2x2=U.updateMatrix2x2.bind(U),this.setFloat=U.updateFloat.bind(U),this.setFloat2=U.updateFloat2.bind(U),this.setFloat3=U.updateFloat3.bind(U),this.setFloat4=U.updateFloat4.bind(U),this.setFloatArray=U.updateFloatArray.bind(U),this.setArray=U.updateArray.bind(U),this.setIntArray=U.updateIntArray.bind(U),this.setMatrix=U.Ib.bind(U),this.setMatrices=U.updateMatrices.bind(U),this.setVector3=U.updateVector3.bind(U),this.setVector4=U.updateVector4.bind(U),this.setColor3=U.updateColor3.bind(U),this.setColor4=U.updateColor4.bind(U),this.setDirectColor4=U.updateDirectColor4.bind(U),this.setInt=U.updateInt.bind(U),this.setInt2=U.updateInt2.bind(U),this.setInt3=U.updateInt3.bind(U),this.setInt4=U.updateInt4.bind(U)):(this.setMatrix3x3=U.setMatrix3x3.bind(U),this.setMatrix2x2=U.setMatrix2x2.bind(U),this.setFloat=U.setFloat.bind(U),this.setFloat2=U.setFloat2.bind(U),this.setFloat3=U.setFloat3.bind(U),this.setFloat4=U.setFloat4.bind(U),this.setFloatArray=U.setFloatArray.bind(U),this.setArray=U.setArray.bind(U),this.setIntArray=U.setIntArray.bind(U),this.setMatrix=U.setMatrix.bind(U),this.setMatrices=U.setMatrices.bind(U),this.setVector3=U.setVector3.bind(U),this.setVector4=U.setVector4.bind(U),this.setColor3=U.setColor3.bind(U),this.setColor4=U.setColor4.bind(U),this.setDirectColor4=U.setDirectColor4.bind(U),this.setInt=U.setInt.bind(U),this.setInt2=U.setInt2.bind(U),this.setInt3=U.setInt3.bind(U),this.setInt4=U.setInt4.bind(U))}}var j=b(11499);const e="gpuUpdateParticlesPixelShader",l="#version 300 es\nvoid main() {discard;}\n";j.c.ShadersStore[e]||(j.c.ShadersStore[e]=l);const d="gpuUpdateParticlesVertexShader",k="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";j.c.ShadersStore[d]||(j.c.ShadersStore[d]=k);(0,z.f)("BABYLON.WebGL2ParticleSystem",class{constructor(U,X){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=U,this._engine=X,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var U;return(null===(U=this._updateEffect)||void 0===U?void 0:U.isReady())??!1}createUpdateBuffer(U){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof u&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=U,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new f(this._updateEffect)}createVertexBuffers(U,X){this._updateVAO.push(this._createUpdateVAO(U)),this._renderVAO.push(this._engine.recordVertexArrayObject(X,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=X}createParticleBuffer(U){return U}bindDrawBuffers(U,X,b){b?this._engine.bindBuffers(this._renderVertexBuffers,b,X):this._engine.bindVertexArrayObject(this._renderVAO[U],null)}preUpdateParticleBuffer(){const U=this._engine;if(this._engine.enableEffect(this._updateEffect),!U.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(U,X,b){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[U],null);const F=this._engine;F.bindTransformFeedbackBuffer(X.getBuffer()),F.setRasterizerState(!1),F.beginTransformFeedback(!0),F.drawArraysType(3,0,b),F.endTransformFeedback(),F.setRasterizerState(!0),F.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let U=0;U<this._updateVAO.length;U++)this._engine.releaseVertexArrayObject(this._updateVAO[U]);this._updateVAO.length=0;for(let U=0;U<this._renderVAO.length;U++)this._engine.releaseVertexArrayObject(this._renderVAO[U]);this._renderVAO.length=0}_createUpdateVAO(U){const X={};X.position=U.createVertexBuffer("position",0,3);let b=3;X.age=U.createVertexBuffer("age",b,1),b+=1,X.size=U.createVertexBuffer("size",b,3),b+=3,X.life=U.createVertexBuffer("life",b,1),b+=1,X.seed=U.createVertexBuffer("seed",b,4),b+=4,X.direction=U.createVertexBuffer("direction",b,3),b+=3,this._parent.particleEmitterType instanceof u&&(X.initialPosition=U.createVertexBuffer("initialPosition",b,3),b+=3),this._parent._colorGradientsTexture||(X.color=U.createVertexBuffer("color",b,4),b+=4),this._parent._isBillboardBased||(X.initialDirection=U.createVertexBuffer("initialDirection",b,3),b+=3),this._parent.noiseTexture&&(X.noiseCoordinates1=U.createVertexBuffer("noiseCoordinates1",b,3),b+=3,X.noiseCoordinates2=U.createVertexBuffer("noiseCoordinates2",b,3),b+=3),this._parent._angularSpeedGradientsTexture?(X.angle=U.createVertexBuffer("angle",b,1),b+=1):(X.angle=U.createVertexBuffer("angle",b,2),b+=2),this._parent._isAnimationSheetEnabled&&(X.cellIndex=U.createVertexBuffer("cellIndex",b,1),b+=1,this._parent.spriteRandomStartCell&&(X.cellStartOffset=U.createVertexBuffer("cellStartOffset",b,1),b+=1));const F=this._engine.recordVertexArrayObject(X,null,this._updateEffect);return this._engine.bindArrayBuffer(null),F}});class v{constructor(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,F=arguments.length>3?arguments[3]:void 0;this._engine=U,this._label=F,this._engine._storageBuffers.push(this),this._create(X,b)}_create(U,X){this._bufferSize=U,this._creationFlags=X,this._buffer=this._engine.createStorageBuffer(U,X,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(U,X,b){this._buffer&&this._engine.updateStorageBuffer(this._buffer,U,X,b)}async read(U,X,b,F){return await this._engine.readFromStorageBuffer(this._buffer,U,X,b,F)}dispose(){const U=this._engine._storageBuffers,X=U.indexOf(this);-1!==X&&(U[X]=U[U.length-1],U.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var A=b(11576),s=b(11583),h=b(11623),B=b(11570),o=b(11904),y=b(11408),t=b(11535),W=b(11812);class Y{constructor(){this._gpuTimeInFrameId=-1,this.counter=new W.e}_addDuration(U,X){U<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==U?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(X,!1),this._gpuTimeInFrameId=U):this.counter.addCount(X,!1))}}var K=b(11481);class V{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=U,this._engine=X,this.uniqueId=o.c.UniqueId,X.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Y),this._engine.getCaps().supportComputeShaders?F.bindingsMapping?(this._context=X.createComputeContext(),this._shaderPath=b,this._options={bindingsMapping:{},defines:[],...F}):y.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):y.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(U,X){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const F=this._bindings[U];this._bindings[U]={type:b?0:4,object:X,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!F||F.object!==X||F.type!==this._bindings[U].type)}setStorageTexture(U,X){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==X),this._bindings[U]={type:1,object:X,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setExternalTexture(U,X){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==X),this._bindings[U]={type:6,object:X,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setVideoTexture(U,X){return!!X.externalTexture&&(this.setExternalTexture(U,X.externalTexture),!0)}setUniformBuffer(U,X){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==X),this._bindings[U]={type:V._BufferIsDataBuffer(X)?7:2,object:X,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setStorageBuffer(U,X){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==X),this._bindings[U]={type:V._BufferIsDataBuffer(X)?7:3,object:X,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setTextureSampler(U,X){const b=this._bindings[U];this._contextIsDirty||(this._contextIsDirty=!b||!X.compareSampler(b.object)),this._bindings[U]={type:5,object:X,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}isReady(){let U=this._effect;for(const E in this._bindings){const U=this._bindings[E],X=U.type,b=U.object;switch(X){case 0:case 4:case 1:if(!b.isReady())return!1;break;case 6:if(!b.isReady())return!1;break}}const X=[],b=this._shaderPath;if(this._options.defines)for(let E=0;E<this._options.defines.length;E++)X.push(this._options.defines[E]);const F=X.join("\n");return this._cachedDefines!==F&&(this._cachedDefines=F,U=this._engine.createComputeEffect(b,{defines:F,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=U),!!U.isReady()}dispatch(U,X,b){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,U,X,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const b=V._BufferIsDataBuffer(U)?U:U.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,b,X,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const X in this._bindings){const b=this._bindings[X];if(!this._options.bindingsMapping[X])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+X+"'");switch(b.type){case 0:{const F=this._samplers[X],E=b.object;var U;if(!F||!E._texture||!F.compareSampler(E._texture))this._samplers[X]=(new t.e).setParameters(E.wrapU,E.wrapV,E.wrapR,E.anisotropicFilteringLevel,E._texture.samplingMode,null===(U=E._texture)||void 0===U?void 0:U._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const U=b.object;U.getBuffer()!==b.buffer&&(b.buffer=U.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((E=>{(0,K.g)((()=>this.dispatch(U,X,b)),E,void 0,F)}))}serialize(){const U=h.d.Serialize(this);U.options=this._options,U.shaderPath=this._shaderPath,U.nn={},U.textures={};for(const X in this._bindings){const b=this._bindings[X],F=b.object;switch(b.type){case 0:case 4:case 1:{const E=F.serialize();E&&(U.textures[X]=E,U.nn[X]={type:b.type});break}}}return U}static Parse(U,X,b){const F=h.d.Parse((()=>new V(U.name,X.getEngine(),U.shaderPath,U.options)),U,X,b);for(const E in U.textures){const w=U.nn[E],Q=B.c.Parse(U.textures[E],X,b);0===w.type?F.setTexture(E,Q):4===w.type?F.setTexture(E,Q,!1):F.setStorageTexture(E,Q)}return F}static _BufferIsDataBuffer(U){return void 0!==U.underlyingResource}}(0,A.c)([(0,s.J)()],V.prototype,"name",void 0),(0,A.c)([(0,s.J)()],V.prototype,"fastMode",void 0),(0,z.f)("BABYLON.ComputeShader",V);var g=b(11857);const L="gpuUpdateParticlesComputeShader",D="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";j.c.ShadersStoreWGSL[L]||(j.c.ShadersStoreWGSL[L]=D);(0,z.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(U,X){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=U,this._engine=X}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var U;return(null===(U=this._updateComputeShader)||void 0===U?void 0:U.isReady())??!1}createUpdateBuffer(U){var X;const b={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(b.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(b.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(b.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(b.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(b.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(b.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(b.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new V("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:b,defines:U.split("\n")}),null===(X=this._simParamsComputeShader)||void 0===X||X.dispose(),this._simParamsComputeShader=new g.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new f(this._simParamsComputeShader)}createVertexBuffers(U,X){this._renderVertexBuffers.push(X)}createParticleBuffer(U){const X=new v(this._engine,4*U.length,11,"ComputeShaderParticleSystemBuffer");return X.update(U),this._bufferComputeShader.push(X),X.getBuffer()}bindDrawBuffers(U,X,b){this._engine.bindBuffers(this._renderVertexBuffers[U],b,X)}preUpdateParticleBuffer(){}updateParticleBuffer(U,X,b){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[U]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^U]),this._updateComputeShader.dispatch(Math.ceil(b/64))}releaseBuffers(){var U;for(let X=0;X<this._bufferComputeShader.length;++X)this._bufferComputeShader[X].dispose();this._bufferComputeShader.length=0,null===(U=this._simParamsComputeShader)||void 0===U||U.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class G{constructor(U,X,b){this.gradient=U,this.color1=X,this.color2=b}getColorToRef(U){this.color2?Q.eb.LerpToRef(this.color1,this.color2,Math.random(),U):U.q(this.color1)}}class Z{constructor(U,X){this.gradient=U,this.color=X}}class c{constructor(U,X,b){this.gradient=U,this.factor1=X,this.factor2=b}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class r{static GetCurrentGradient(U,X,b){if(X[0].gradient>U)return void b(X[0],X[0],1);for(let E=0;E<X.length-1;E++){const F=X[E],w=X[E+1];if(U>=F.gradient&&U<=w.gradient){return void b(F,w,(U-F.gradient)/(w.gradient-F.gradient))}}const F=X.length-1;b(X[F],X[F],1)}}var M=b(11392),H=b(12098),T=b(11442);class C{constructor(U){this.particleSystem=U,this.position=F.JX.Zero(),this.direction=F.JX.Zero(),this.color=new Q.eb(0,0,0,0),this.colorStep=new Q.eb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new F.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Q.eb(0,0,0,0),this._currentColor2=new Q.eb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=C._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let U=this.age,X=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===X?(X=1,U=this._randomCellOffset):U+=this._randomCellOffset);const b=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let F;F=this._initialSpriteCellLoop?(0,p.Clamp)(U*X%this.lifeTime/this.lifeTime):(0,p.Clamp)(U*X/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+F*b|0}_inheritParticleInfoToSubEmitter(U){if(U.particleSystem.FX.position){const X=U.particleSystem.FX;if(X.position.q(this.position),U.inheritDirection){const U=F.TmpVectors.JX[0];this.direction.normalizeToRef(U),X.setDirection(U,0,Math.PI/2)}}else{U.particleSystem.FX.q(this.position)}this.direction.scaleToRef(U.inheritedVelocityAmount/2,F.TmpVectors.JX[0]),U.particleSystem._inheritedVelocityOffset.q(F.TmpVectors.JX[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const U of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(U)}_reset(){this.age=0,this.id=C._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(U){U.position.q(this.position),this._initialDirection?U._initialDirection?U._initialDirection.q(this._initialDirection):U._initialDirection=this._initialDirection.clone():U._initialDirection=null,U.direction.q(this.direction),this.Fq&&(U.Fq?U.Fq.q(this.Fq):U.Fq=this.Fq.clone()),U.color.q(this.color),U.colorStep.q(this.colorStep),U.lifeTime=this.lifeTime,U.age=this.age,U._randomCellOffset=this._randomCellOffset,U.size=this.size,U.scale.q(this.scale),U.angle=this.angle,U.angularSpeed=this.angularSpeed,U.particleSystem=this.particleSystem,U.cellIndex=this.cellIndex,U.id=this.id,U._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(U._currentColorGradient=this._currentColorGradient,U._currentColor1.q(this._currentColor1),U._currentColor2.q(this._currentColor2)),this._currentSizeGradient&&(U._currentSizeGradient=this._currentSizeGradient,U._currentSize1=this._currentSize1,U._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(U._currentAngularSpeedGradient=this._currentAngularSpeedGradient,U._currentAngularSpeed1=this._currentAngularSpeed1,U._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(U._currentVelocityGradient=this._currentVelocityGradient,U._currentVelocity1=this._currentVelocity1,U._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(U._currentLimitVelocityGradient=this._currentLimitVelocityGradient,U._currentLimitVelocity1=this._currentLimitVelocity1,U._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(U._currentDragGradient=this._currentDragGradient,U._currentDrag1=this._currentDrag1,U._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(U._initialStartSpriteCellId=this._initialStartSpriteCellId,U._initialEndSpriteCellId=this._initialEndSpriteCellId,U._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(U.remapData&&this.remapData?U.remapData.q(this.remapData):U.remapData=new F.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(U._randomNoiseCoordinates1?(U._randomNoiseCoordinates1.q(this._randomNoiseCoordinates1),U._randomNoiseCoordinates2.q(this._randomNoiseCoordinates2)):(U._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),U._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}C._Count=0;var UU=b(11707),XU=(b(11744),b(11972)),bU=b(11969),FU=b(11851);function EU(U,X){const b=(0,p.RandomRange)(0,1);Q.eb.LerpToRef(X.color1,X.color2,b,U.color),X.colorDead.subtractToRef(U.color,X._colorDiff),X._colorDiff.scaleToRef(1/U.lifeTime,U.colorStep)}function wU(U,X){U._currentColorGradient=X._colorGradients[0],U._currentColorGradient.getColorToRef(U.color),U._currentColor1.q(U.color),X._colorGradients.length>1?X._colorGradients[1].getColorToRef(U._currentColor2):U._currentColor2.q(U.color)}function QU(U,X){const b=X._colorGradients;r.GetCurrentGradient(X._ratio,b,((X,b,F)=>{X!==U._currentColorGradient&&(U._currentColor1.q(U._currentColor2),b.getColorToRef(U._currentColor2),U._currentColorGradient=X),Q.eb.LerpToRef(U._currentColor1,U._currentColor2,F,U.color)}))}function zU(U,X){U.colorStep.scaleToRef(X._scaledUpdateSpeed,X._scaledColorStep),U.color.addInPlace(X._scaledColorStep),U.color.a<0&&(U.color.a=0)}function qU(U,X){r.GetCurrentGradient(X._ratio,X._angularSpeedGradients,((X,b,F)=>{X!==U._currentAngularSpeedGradient&&(U._currentAngularSpeed1=U._currentAngularSpeed2,U._currentAngularSpeed2=b.getFactor(),U._currentAngularSpeedGradient=X),U.angularSpeed=(0,p.Lerp)(U._currentAngularSpeed1,U._currentAngularSpeed2,F)}))}function pU(U,X){U.angle+=U.angularSpeed*X._scaledUpdateSpeed}function SU(U,X){X.particleEmitterType.startDirectionFunction(X._emitterWorldMatrix,U.direction,U,X.isLocal,X._emitterInverseWorldMatrix)}function RU(U,X){X.startDirectionFunction(X._emitterWorldMatrix,U.direction,U,X.isLocal)}function nU(U,X){U._currentVelocityGradient=X._velocityGradients[0],U._currentVelocity1=U._currentVelocityGradient.getFactor(),X._velocityGradients.length>1?U._currentVelocity2=X._velocityGradients[1].getFactor():U._currentVelocity2=U._currentVelocity1}function aU(U,X){U._currentLimitVelocityGradient=X._limitVelocityGradients[0],U._currentLimitVelocity1=U._currentLimitVelocityGradient.getFactor(),X._limitVelocityGradients.length>1?U._currentLimitVelocity2=X._limitVelocityGradients[1].getFactor():U._currentLimitVelocity2=U._currentLimitVelocity1}function JU(U,X){r.GetCurrentGradient(X._ratio,X._velocityGradients,((b,F,E)=>{b!==U._currentVelocityGradient&&(U._currentVelocity1=U._currentVelocity2,U._currentVelocity2=F.getFactor(),U._currentVelocityGradient=b),X._directionScale*=(0,p.Lerp)(U._currentVelocity1,U._currentVelocity2,E)}))}function mU(U,X){r.GetCurrentGradient(X._ratio,X._limitVelocityGradients,((b,F,E)=>{b!==U._currentLimitVelocityGradient&&(U._currentLimitVelocity1=U._currentLimitVelocity2,U._currentLimitVelocity2=F.getFactor(),U._currentLimitVelocityGradient=b);const w=(0,p.Lerp)(U._currentLimitVelocity1,U._currentLimitVelocity2,E);U.direction.length()>w&&U.direction.scaleInPlace(X.limitVelocityDamping)}))}function xU(U,X){U.direction.scaleToRef(X._directionScale,X._scaledDirection)}function IU(U,X){X.particleEmitterType.startPositionFunction(X._emitterWorldMatrix,U.position,U,X.isLocal)}function OU(U,X){X.startPositionFunction(X._emitterWorldMatrix,U.position,U,X.isLocal)}function NU(U,X){U.Fq?U.Fq.q(U.position):U.Fq=U.position.clone(),F.JX.TransformCoordinatesToRef(U.Fq,X._emitterWorldMatrix,U.position)}function uU(U,X){X.isLocal&&U.Fq?(U.Fq.addInPlace(X._scaledDirection),F.JX.TransformCoordinatesToRef(U.Fq,X._emitterWorldMatrix,U.position)):U.position.addInPlace(X._scaledDirection)}function iU(U,X){U._currentDragGradient=X._dragGradients[0],U._currentDrag1=U._currentDragGradient.getFactor(),X._dragGradients.length>1?U._currentDrag2=X._dragGradients[1].getFactor():U._currentDrag2=U._currentDrag1}function PU(U,X){r.GetCurrentGradient(X._ratio,X._dragGradients,((b,F,E)=>{b!==U._currentDragGradient&&(U._currentDrag1=U._currentDrag2,U._currentDrag2=F.getFactor(),U._currentDragGradient=b);const w=(0,p.Lerp)(U._currentDrag1,U._currentDrag2,E);X._scaledDirection.scaleInPlace(1-w)}))}function fU(U,X){U._randomNoiseCoordinates1?(U._randomNoiseCoordinates1.Pb(Math.random(),Math.random(),Math.random()),U._randomNoiseCoordinates2.Pb(Math.random(),Math.random(),Math.random())):(U._randomNoiseCoordinates1=new F.JX(Math.random(),Math.random(),Math.random()),U._randomNoiseCoordinates2=new F.JX(Math.random(),Math.random(),Math.random()))}function jU(U,X){const b=X._noiseTextureData,E=X._noiseTextureSize;if(b&&E&&U._randomNoiseCoordinates1){const w=X._fetchR(U._randomNoiseCoordinates1.x,U._randomNoiseCoordinates1.y,E.width,E.height,b),Q=X._fetchR(U._randomNoiseCoordinates1.z,U._randomNoiseCoordinates2.x,E.width,E.height,b),z=X._fetchR(U._randomNoiseCoordinates2.y,U._randomNoiseCoordinates2.z,E.width,E.height,b),q=F.TmpVectors.JX[0],p=F.TmpVectors.JX[1];q.Pb((2*w-1)*X.noiseStrength.x,(2*Q-1)*X.noiseStrength.y,(2*z-1)*X.noiseStrength.z),q.scaleToRef(X._tempScaledUpdateSpeed,p),U.direction.addInPlace(p)}}function eU(U,X){X.gravity.scaleToRef(X._tempScaledUpdateSpeed,X._scaledGravity),U.direction.addInPlace(X._scaledGravity)}function lU(U,X){U.size=(0,p.RandomRange)(X.minSize,X.maxSize),U.scale.Pb((0,p.RandomRange)(X.minScaleX,X.maxScaleX),(0,p.RandomRange)(X.minScaleY,X.maxScaleY))}function dU(U,X){U._currentSizeGradient=X._sizeGradients[0],U._currentSize1=U._currentSizeGradient.getFactor(),U.size=U._currentSize1,X._sizeGradients.length>1?U._currentSize2=X._sizeGradients[1].getFactor():U._currentSize2=U._currentSize1,U.scale.Pb((0,p.RandomRange)(X.minScaleX,X.maxScaleX),(0,p.RandomRange)(X.minScaleY,X.maxScaleY))}function kU(U,X){const b=X._actualFrame/X.targetStopDuration;r.GetCurrentGradient(b,X._startSizeGradients,((b,F,E)=>{b!==X._currentStartSizeGradient&&(X._currentStartSize1=X._currentStartSize2,X._currentStartSize2=F.getFactor(),X._currentStartSizeGradient=b);const w=(0,p.Lerp)(X._currentStartSize1,X._currentStartSize2,E);U.scale.scaleInPlace(w)}))}function vU(U,X){r.GetCurrentGradient(X._ratio,X._sizeGradients,((X,b,F)=>{X!==U._currentSizeGradient&&(U._currentSize1=U._currentSize2,U._currentSize2=b.getFactor(),U._currentSizeGradient=X),U.size=(0,p.Lerp)(U._currentSize1,U._currentSize2,F)}))}function AU(U,X){U.remapData=new F.Vector4(0,1,0,1)}function sU(U,X){X._colorRemapGradients&&X._colorRemapGradients.length>0&&r.GetCurrentGradient(X._ratio,X._colorRemapGradients,((X,b,F)=>{const E=(0,p.Lerp)(X.factor1,b.factor1,F),w=(0,p.Lerp)(X.factor2,b.factor2,F);U.remapData.x=E,U.remapData.y=w-E})),X._alphaRemapGradients&&X._alphaRemapGradients.length>0&&r.GetCurrentGradient(X._ratio,X._alphaRemapGradients,((X,b,F)=>{const E=(0,p.Lerp)(X.factor1,b.factor1,F),w=(0,p.Lerp)(X.factor2,b.factor2,F);U.remapData.z=E,U.remapData.w=w-E}))}function hU(U,X){const b=(0,p.Clamp)(X._actualFrame/X.targetStopDuration);r.GetCurrentGradient(b,X._lifeTimeGradients,((X,F)=>{const E=X,w=F,Q=E.getFactor(),z=w.getFactor(),q=(b-E.gradient)/(w.gradient-E.gradient);U.lifeTime=(0,p.Lerp)(Q,z,q)})),X._emitPower=(0,p.RandomRange)(X.minEmitPower,X.maxEmitPower)}function BU(U,X){U.lifeTime=(0,p.RandomRange)(X.minLifeTime,X.maxLifeTime),X._emitPower=(0,p.RandomRange)(X.minEmitPower,X.maxEmitPower)}function oU(U,X){0===X._emitPower?(U._initialDirection?U._initialDirection.q(U.direction):U._initialDirection=U.direction.clone(),U.direction.set(0,0,0)):(U._initialDirection=null,U.direction.scaleInPlace(X._emitPower)),U.direction.addInPlace(X._inheritedVelocityOffset)}function yU(U,X){U.angularSpeed=(0,p.RandomRange)(X.minAngularSpeed,X.maxAngularSpeed),U.angle=(0,p.RandomRange)(X.minInitialRotation,X.maxInitialRotation)}function tU(U,X){U._currentAngularSpeedGradient=X._angularSpeedGradients[0],U.angularSpeed=U._currentAngularSpeedGradient.getFactor(),U._currentAngularSpeed1=U.angularSpeed,X._angularSpeedGradients.length>1?U._currentAngularSpeed2=X._angularSpeedGradients[1].getFactor():U._currentAngularSpeed2=U._currentAngularSpeed1,U.angle=(0,p.RandomRange)(X.minInitialRotation,X.maxInitialRotation)}function WU(U,X){U._initialStartSpriteCellId=X.startSpriteCellID,U._initialEndSpriteCellId=X.endSpriteCellID,U._initialSpriteCellLoop=X.spriteCellLoop}function YU(U,X){U.previousItem=X.previousItem,U.nextItem=X,X.previousItem&&(X.previousItem.nextItem=U),X.previousItem=U}function KU(U,X){U.previousItem=X,U.nextItem=X.nextItem,X.nextItem&&(X.nextItem.previousItem=U),X.nextItem=U}function VU(U,X){let b=X;for(;b.nextItem;)b=b.nextItem;U.previousItem=b,U.nextItem=b.nextItem,b.nextItem=U}function gU(U){U.previousItem&&(U.previousItem.nextItem=U.nextItem),U.nextItem&&(U.nextItem.previousItem=U.previousItem)}class LU extends q{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(U){this._startDirectionFunction!==U&&(this._startDirectionFunction=U,this._directionProcessing.process=U?RU:SU)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(U){this._startPositionFunction!==U&&(this._startPositionFunction=U,this._positionCreation.process=U?OU:IU)}set onDispose(U){this._onDisposeObserver&&this.wb.remove(this._onDisposeObserver),this._onDisposeObserver=this.wb.add(U)}get R(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(U){this._useRampGradients!==U&&(this._useRampGradients=U,this._resetEffect(),U?(this._rampCreation={process:AU,previousItem:null,nextItem:null},KU(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:sU,previousItem:null,nextItem:null},KU(this._remapGradientProcessing,this._gravityProcessing)):(gU(this._rampCreation),gU(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(U){this._isLocal!==U&&(this._isLocal=U,U?(this._isLocalCreation={process:NU,previousItem:null,nextItem:null},KU(this._isLocalCreation,this._positionCreation)):gU(this._isLocalCreation))}get particles(){return this.zn}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(U){this._animationSheetEnabled!==U&&(this._animationSheetEnabled=U,U?(this._sheetCreation={process:WU,previousItem:null,nextItem:null},KU(this._sheetCreation,this._colorCreation)):gU(this._sheetCreation),this._reset())}getActiveCount(){return this.zn.length}getClassName(){return"Bb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var U;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(U=this._customWrappers[X])||void 0===U?void 0:U.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[U]??this._customWrappers[0]}setCustomEffect(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new UU.d(this._engine),this._customWrappers[X].effect=U,this._customWrappers[X].drawContext&&(this._customWrappers[X].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new M.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(U){if(this.noiseTexture!==U){if(this._noiseTexture=U,!U)return gU(this._noiseCreation),void gU(this._noiseProcessing);this._noiseCreation={process:fU,previousItem:null,nextItem:null},KU(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:jU,previousItem:null,nextItem:null},KU(this._noiseProcessing,this._positionProcessing)}}constructor(U,X,b){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(U),this._emitterInverseWorldMatrix=F.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new F.JX,this.wb=new M.e,this.onStoppedObservable=new M.e,this.onStartedObservable=new M.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.zn=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Q.eb(0,0,0,0),this._colorDiff=new Q.eb(0,0,0,0),this._scaledDirection=F.JX.Zero(),this._scaledGravity=F.JX.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=U=>{},this.recycleParticle=U=>{const X=this.zn.pop();X!==U&&X.copyTo(U),this._stockParticles.push(X)},this._createParticle=()=>{let U;return 0!==this._stockParticles.length?(U=this._stockParticles.pop(),U._reset()):U=new C(this),this._prepareParticle(U),U},this.paused=!1,this._shadersLoaded=!1,this._capacity=X,this._epsilon=z,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=F.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||T.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.wn.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:BU,previousItem:null,nextItem:null},this._positionCreation={process:IU,previousItem:null,nextItem:null},KU(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:SU,previousItem:null,nextItem:null},KU(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:oU,previousItem:null,nextItem:null},KU(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:lU,previousItem:null,nextItem:null},KU(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:yU,previousItem:null,nextItem:null},KU(this._angleCreation,this._sizeCreation),this._colorCreation={process:EU,previousItem:null,nextItem:null},KU(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,q||(this._colorProcessing={process:zU,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:pU,previousItem:null,nextItem:null},KU(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:xU,previousItem:null,nextItem:null},KU(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:uU,previousItem:null,nextItem:null},KU(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:eU,previousItem:null,nextItem:null},KU(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=w,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new UU.d(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new R,this.updateFunction=U=>{var X;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(X=this.noiseTexture.getContent())||void 0===X||X.then((U=>{this._noiseTextureData=U})));const b=U===this.zn;for(let F=0;F<U.length;F++){const X=U[F];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const E=X.age;if(X.age+=this._tempScaledUpdateSpeed,X.age>X.lifeTime){const U=X.age-E,b=X.lifeTime-E;this._tempScaledUpdateSpeed=b*this._tempScaledUpdateSpeed/U,X.age=X.lifeTime}this._ratio=X.age/X.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let w=this._updateQueueStart;for(;w;)w.process(X,this),w=w.nextItem;if(this._isAnimationSheetEnabled&&!q&&X.updateCellIndex(),X._inheritParticleInfoToSubEmitters(),X.age>=X.lifeTime){if(this._emitFromParticle(X),X._attachedSubEmitters){for(const U of X._attachedSubEmitters)U.particleSystem.disposeOnStop=!0,U.particleSystem.stop();X._attachedSubEmitters=null}this.recycleParticle(X),b&&F--}else;}}}serialize(U){throw new Error("Method not implemented.")}clone(U,X){throw new Error("Method not implemented.")}_addFactorGradient(U,X,b,F){const E=new c(X,b,F);U.push(E),U.sort(((U,X)=>U.gradient<X.gradient?-1:U.gradient>X.gradient?1:0))}_removeFactorGradient(U,X){if(!U)return;let b=0;for(const F of U){if(F.gradient===X){U.splice(b,1);break}b++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=hU:this._lifeTimeCreation.process=BU}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:kU,previousItem:null,nextItem:null},KU(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(gU(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(U){this.targetStopDuration!==U&&(this._targetStopDuration=U,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(U,X,b){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,U,X,b),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(U){return this._removeFactorGradient(this._lifeTimeGradients,U),this._syncLifeTimeCreation(),this}addSizeGradient(U,X,b){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=dU,this._sizeGradientProcessing={process:vU,previousItem:null,nextItem:null},YU(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,U,X,b),this}removeSizeGradient(U){var X;return this._removeFactorGradient(this._sizeGradients,U),0===(null===(X=this._sizeGradients)||void 0===X?void 0:X.length)&&(gU(this._sizeGradientProcessing),this._sizeCreation.process=lU),this}addColorRemapGradient(U,X,b){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,U,X,b),this}removeColorRemapGradient(U){return this._removeFactorGradient(this._colorRemapGradients,U),this}addAlphaRemapGradient(U,X,b){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,U,X,b),this}removeAlphaRemapGradient(U){return this._removeFactorGradient(this._alphaRemapGradients,U),this}addAngularSpeedGradient(U,X,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=tU,this._angularSpeedGradientProcessing={process:qU,previousItem:null,nextItem:null},YU(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,U,X,b),this}removeAngularSpeedGradient(U){var X;return this._removeFactorGradient(this._angularSpeedGradients,U),0===(null===(X=this._angularSpeedGradients)||void 0===X?void 0:X.length)&&(this._angleCreation.process=yU,gU(this._angularSpeedGradientProcessing)),this}addVelocityGradient(U,X,b){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:nU,previousItem:null,nextItem:null},KU(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:JU,previousItem:null,nextItem:null},YU(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,U,X,b),this}removeVelocityGradient(U){var X;return this._removeFactorGradient(this._velocityGradients,U),0===(null===(X=this._velocityGradients)||void 0===X?void 0:X.length)&&(gU(this._velocityCreation),gU(this._velocityGradientProcessing)),this}addLimitVelocityGradient(U,X,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:aU,previousItem:null,nextItem:null},KU(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:mU,previousItem:null,nextItem:null},KU(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,U,X,b),this}removeLimitVelocityGradient(U){var X;return this._removeFactorGradient(this._limitVelocityGradients,U),0===(null===(X=this._limitVelocityGradients)||void 0===X?void 0:X.length)&&(gU(this._limitVelocityCreation),gU(this._limitVelocityGradientProcessing)),this}addDragGradient(U,X,b){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:iU,previousItem:null,nextItem:null},YU(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:PU,previousItem:null,nextItem:null},YU(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,U,X,b),this}removeDragGradient(U){var X;return this._removeFactorGradient(this._dragGradients,U),0===(null===(X=this._dragGradients)||void 0===X?void 0:X.length)&&(gU(this._dragCreation),gU(this._dragGradientProcessing)),this}addEmitRateGradient(U,X,b){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,U,X,b),this}removeEmitRateGradient(U){return this._removeFactorGradient(this._emitRateGradients,U),this}addStartSizeGradient(U,X,b){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,U,X,b),this._syncStartSizeCreation(),this}removeStartSizeGradient(U){return this._removeFactorGradient(this._startSizeGradients,U),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const U=new Uint8Array(4*this._rawTextureWidth),X=Q.TmpColors.NX[0];for(let b=0;b<this._rawTextureWidth;b++){const F=b/this._rawTextureWidth;r.GetCurrentGradient(F,this._rampGradients,((F,E,w)=>{Q.NX.LerpToRef(F.color,E.color,w,X),U[4*b]=255*X.r,U[4*b+1]=255*X.g,U[4*b+2]=255*X.b,U[4*b+3]=255}))}this._rampGradientsTexture=H.d.CreateRGBATexture(U,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((U,X)=>U.gradient<X.gradient?-1:U.gradient>X.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(U,X){this._rampGradients||(this._rampGradients=[]);const b=new Z(U,X);return this._rampGradients.push(b),this._syncRampGradientTexture(),this}removeRampGradient(U){return this._removeGradientAndTexture(U,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(U,X,b){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=wU,this._colorProcessing.process=QU);const F=new G(U,X,b);return this._colorGradients.push(F),this._colorGradients.sort(((U,X)=>U.gradient<X.gradient?-1:U.gradient>X.gradient?1:0)),this}removeColorGradient(U){if(!this._colorGradients)return this;let X=0;for(const b of this._colorGradients){if(b.gradient===U){this._colorGradients.splice(X,1);break}X++}return 0===this._colorGradients.length&&(this._colorCreation.process=EU,this._colorProcessing.process=zU),this}resetDrawCache(){if(this._drawWrappers){for(const U of this._drawWrappers)if(U)for(const X of U)null===X||void 0===X||X.dispose();this._drawWrappers=[]}}_fetchR(U,X,b,F,E){return E[4*(((U=.5*Math.abs(U)+.5)*b%b|0)+((X=.5*Math.abs(X)+.5)*F%F|0)*b)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const U=this._engine,X=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*X),this._vertexBuffer=new i.d(U,this._vertexData,!0,X);let b=0;const F=this._vertexBuffer.createVertexBuffer(i.h.PositionKind,b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[i.h.PositionKind]=F,b+=3;const E=this._vertexBuffer.createVertexBuffer(i.h.ColorKind,b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[i.h.ColorKind]=E,b+=4;const w=this._vertexBuffer.createVertexBuffer("angle",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=w,b+=1;const Q=this._vertexBuffer.createVertexBuffer("size",b,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Q,b+=2,this._isAnimationSheetEnabled){const U=this._vertexBuffer.createVertexBuffer("cellIndex",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=U,b+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const U=this._vertexBuffer.createVertexBuffer("direction",b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=U,b+=3}if(this._useRampGradients){const U=this._vertexBuffer.createVertexBuffer("remapData",b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=U,b+=4}let z;if(this._useInstancing){const X=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new i.d(U,X,!1,2),z=this._spriteBuffer.createVertexBuffer("offset",0,2)}else z=this._vertexBuffer.createVertexBuffer("offset",b,2,this._vertexBufferSize,this._useInstancing),b+=2;this._vertexBuffers.offset=z,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const U=[],X=[];let b=0;for(let F=0;F<this._capacity;F++)U.push(b),U.push(b+1),U.push(b+2),U.push(b),U.push(b+2),U.push(b+3),X.push(b,b+1,b+1,b+2,b+2,b+3,b+3,b,b,b+3),b+=4;this._indexBuffer=this._engine.createIndexBuffer(U),this._linesIndexBuffer=this._engine.createIndexBuffer(X)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(U)setTimeout((()=>{this.start(0)}),U);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var X;-1!==(null===(X=this.FX)||void 0===X?void 0:X.getClassName().indexOf("Mesh"))&&this.FX.Ob(!0);const U=this.noiseTexture;if(U&&U.onGeneratedObservable)U.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let X=0;X<this.preWarmCycles;X++)this.animate(!0),U.render()}))}));else for(let X=0;X<this.preWarmCycles;X++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(U))}_postStop(U){}reset(){this._stockParticles.length=0,this.zn.length=0}_appendParticleVertex(U,X,b,E){let w=U*this._vertexBufferSize;if(this._vertexData[w++]=X.position.x+this.jp.x,this._vertexData[w++]=X.position.y+this.jp.y,this._vertexData[w++]=X.position.z+this.jp.z,this._vertexData[w++]=X.color.r,this._vertexData[w++]=X.color.g,this._vertexData[w++]=X.color.b,this._vertexData[w++]=X.color.a,this._vertexData[w++]=X.angle,this._vertexData[w++]=X.scale.x*X.size,this._vertexData[w++]=X.scale.y*X.size,this._isAnimationSheetEnabled&&(this._vertexData[w++]=X.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[w++]=X.direction.x,this._vertexData[w++]=X.direction.y,this._vertexData[w++]=X.direction.z);else if(X._initialDirection){let U=X._initialDirection;this.isLocal&&(F.JX.TransformNormalToRef(U,this._emitterWorldMatrix,F.TmpVectors.JX[0]),U=F.TmpVectors.JX[0]),0===U.x&&0===U.z&&(U.x=.001),this._vertexData[w++]=U.x,this._vertexData[w++]=U.y,this._vertexData[w++]=U.z}else{let U=X.direction;this.isLocal&&(F.JX.TransformNormalToRef(U,this._emitterWorldMatrix,F.TmpVectors.JX[0]),U=F.TmpVectors.JX[0]),0===U.x&&0===U.z&&(U.x=.001),this._vertexData[w++]=U.x,this._vertexData[w++]=U.y,this._vertexData[w++]=U.z}this._useRampGradients&&X.remapData&&(this._vertexData[w++]=X.remapData.x,this._vertexData[w++]=X.remapData.y,this._vertexData[w++]=X.remapData.z,this._vertexData[w++]=X.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===b?b=this._epsilon:1===b&&(b=1-this._epsilon),0===E?E=this._epsilon:1===E&&(E=1-this._epsilon)),this._vertexData[w++]=b,this._vertexData[w++]=E)}_prepareParticle(U){}_createNewOnes(U){let X;for(let b=0;b<U&&this.zn.length!==this._capacity;b++){X=this._createParticle(),this.zn.push(X);let U=this._createQueueStart;for(;U;)U.process(X,this),U=U.nextItem;X._inheritParticleInfoToSubEmitters()}}_update(U){if(this._alive=this.zn.length>0,this.FX.position){const U=this.FX;this._emitterWorldMatrix=U.getWorldMatrix()}else{const U=this.FX;this._emitterWorldMatrix=F.Matrix.Translation(U.x,U.y,U.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.zn),this._createNewOnes(U)}static _GetAttributeNamesOrOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F=[i.h.PositionKind,i.h.ColorKind,"angle","offset","size"];return U&&F.push("cellIndex"),X||F.push("direction"),b&&F.push("remapData"),F}static _GetEffectCreationOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,XU.b)(F),U&&F.push("particlesInfos"),X&&F.push("logarithmicDepthConstant"),b&&(F.push("vFogInfos"),F.push("vFogColor")),F}fillDefines(U,X){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,XU.h)(this,this._scene,U),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&U.push("#define FOG")),this._isAnimationSheetEnabled&&U.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&U.push("#define LOGARITHMICDEPTH"),X===q.BLENDMODE_MULTIPLY&&U.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&U.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(U.push("#define BILLBOARD"),this.billboardMode){case 2:U.push("#define BILLBOARDY");break;case 8:case 9:U.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&U.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:U.push("#define BILLBOARDMODE_ALL")}b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),U.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(U,X,b){X.push(...LU._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),U.push(...LU._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,FU.f)(U,this._imageProcessingConfigurationDefines),(0,FU.c)(b,this._imageProcessingConfigurationDefines))}_getWrapper(U){const X=this._getCustomDrawWrapper(U);if(null!==X&&void 0!==X&&X.effect)return X;const b=[];this.fillDefines(b,U);const F=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let E=this._drawWrappers[F];E||(E=this._drawWrappers[F]=[]);let w=E[U];w||(w=new UU.d(this._engine),w.drawContext&&(w.drawContext.useInstancing=this._useInstancing),E[U]=w);const Q=b.join("\n");if(w.defines!==Q){const U=[],X=[],b=[];this.fillUniformsAttributesAndSamplerNames(X,U,b),w.setEffect(this._engine.createEffect("particles",U,X,b,Q,void 0,void 0,void 0,void 0,this._shaderLanguage),Q)}return w}animate(){var U;let X,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!b&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(b?this.preWarmStepOffset:(null===(U=this._scene)||void 0===U?void 0:U.getAnimationRatio())||1),this.manualEmitCount>-1)X=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let U=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const X=this._actualFrame/this.targetStopDuration;r.GetCurrentGradient(X,this._emitRateGradients,((X,b,F)=>{X!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=b.getFactor(),this._currentEmitRateGradient=X),U=(0,p.Lerp)(this._currentEmitRate1,this._currentEmitRate2,F)}))}X=U*this._scaledUpdateSpeed|0,this._newPartsExcess+=U*this._scaledUpdateSpeed-X}if(this._newPartsExcess>1&&(X+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?X=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(X),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!b){let U=0;for(let X=0;X<this.zn.length;X++){const b=this.zn[X];this._appendParticleVertices(U,b),U+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.zn.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(U,X){this._appendParticleVertex(U++,X,0,0),this._useInstancing||(this._appendParticleVertex(U++,X,1,0),this._appendParticleVertex(U++,X,1,1),this._appendParticleVertex(U++,X,0,1))}rebuild(){var U;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(U=this._spriteBuffer)||void 0===U||U._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!LU.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(b.bind(b,13041)),Promise.resolve().then(b.bind(b,12999))])):await Promise.all([Promise.resolve().then(b.bind(b,12984)),Promise.resolve().then(b.bind(b,12980))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.FX||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==q.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(q.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(q.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(U){const X=this._getWrapper(U),b=X.effect,E=this._engine;E.enableEffect(X);const w=this.defaultViewMatrix??this._scene.getViewMatrix();if(b.setTexture("diffuseSampler",this.particleTexture),b.setMatrix("view",w),b.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const U=this.particleTexture.getBaseSize();b.setFloat3("particlesInfos",this.spriteCellWidth/U.width,this.spriteCellHeight/U.height,this.spriteCellWidth/U.width)}if(b.setVector2("translationPivot",this.translationPivot),b.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const U=this._scene.activeCamera;b.setVector3("eyePosition",U.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),b.setTexture("rampSampler",this._rampGradientsTexture));const Q=b.defines;var z,q,p,S,R,n;(this._scene&&((0,XU.d)(b,this,this._scene),this.applyFog&&(0,bU.g)(this._scene,void 0,b)),Q.indexOf("#define BILLBOARDMODE_ALL")>=0&&(w.invertToRef(F.TmpVectors.Matrix[0]),b.setMatrix("invView",F.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?E.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,b):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,b)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?E.bindBuffers(this._vertexBuffers,null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._linesIndexBuffer:this._indexBuffer,b):E.bindBuffers(this._vertexBuffers,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBufferUseInstancing:null,b);(this.useLogarithmicDepth&&this._scene&&(0,bU.l)(Q,b,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(b),this._setEngineBasedOnBlendMode(U),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(b),this._useInstancing)?null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?E.drawElementsType(6,0,10,this.zn.length):E.drawArraysType(7,0,4,this.zn.length):null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?E.drawElementsType(1,0,10*this.zn.length):E.drawElementsType(0,0,6*this.zn.length);return this.zn.length}render(){if(!this.isReady()||!this.zn.length)return 0;const U=this._engine;U.setState&&(U.setState(!1),this.forceDepthWrite&&U.setDepthWrite(!0));let X=0;return X=this.blendMode===q.BLENDMODE_MULTIPLYADD?this._render(q.BLENDMODE_MULTIPLY)+this._render(q.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),X}_onDispose(){}dispose(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),U&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),U&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(X,b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const U=this._scene.wn.indexOf(this);U>-1&&this._scene.wn.splice(U,1),this._scene._activeParticleSystems.dispose()}this.wb.notifyObservers(this),this.wb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}LU.ForceGLSL=!1;var DU,GU=b(11428);!function(U){U[U.ATTACHED=0]="ATTACHED",U[U.END=1]="END"}(DU||(DU={}));class ZU{constructor(U){if(this.particleSystem=U,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!U.FX||!U.FX.dispose){const X=(0,z.c)("BABYLON.AbstractMesh");U.FX=new X("SubemitterSystemEmitter",U.fU()),U._disposeEmitterOnDispose=!0}}clone(){let U=this.particleSystem.FX;if(U){if(U instanceof F.JX)U=U.clone();else if(-1!==U.getClassName().indexOf("Mesh")){U=new((0,z.c)("BABYLON.Mesh"))("",U.fU()),U.isVisible=!1}}else U=new F.JX;const X=new ZU(this.particleSystem.clone(this.particleSystem.name,U));return X.particleSystem.name+="Clone",X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem._disposeEmitterOnDispose=!0,X.particleSystem.disposeOnStop=!0,X}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return X.type=this.type,X.inheritDirection=this.inheritDirection,X.inheritedVelocityAmount=this.inheritedVelocityAmount,X.particleSystem=this.particleSystem.serialize(U),X}static _ParseParticleSystem(U,X,b){throw(0,GU.b)("ParseParticle")}static Parse(U,X,b){const F=U.particleSystem,E=new ZU(ZU._ParseParticleSystem(F,X,b,!0));return E.type=U.type,E.inheritDirection=U.inheritDirection,E.inheritedVelocityAmount=U.inheritedVelocityAmount,E.particleSystem._isSubEmitter=!0,E}dispose(){this.particleSystem.dispose()}}var cU=b(11487);function rU(U,X){const b=new I;return b.direction1=U,b.direction2=X,b}function MU(){return new x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function HU(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function TU(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new F.JX(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.JX(0,1,0);return new N(U,X,b)}function CU(){return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function UX(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.JX(0,1,0),w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new F.JX(0,1,0);return new m(U,X,b,E,w)}function XX(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new n(U,X)}function bX(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.JX(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.JX(0,1,0);return new a(U,X,b,E)}const FX=F.JX.Zero(),EX=F.JX.Zero(),wX=F.JX.Zero();class QX{constructor(){this.strength=0,this.position=F.JX.Zero()}_processParticle(U,X){this.position.subtractToRef(U.position,FX);const b=FX.lengthSquared()+1;FX.normalize().scaleToRef(this.strength/b,EX),EX.scaleToRef(X._tempScaledUpdateSpeed,wX),U.direction.addInPlace(wX)}serialize(){return{position:this.position.Jb(),strength:this.strength}}}class zX extends LU{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=U=>{if(!this._subEmitters||0===this._subEmitters.length)return;const X=Math.floor(Math.random()*this._subEmitters.length);for(const b of this._subEmitters[X])if(1===b.type){const X=b.clone();U._inheritParticleInfoToSubEmitter(X),X.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(X.particleSystem),X.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(U,X){const b=rU(U,X);return this.particleEmitterType=b,b}get flowMap(){return this._flowMap}set flowMap(U){this._flowMap!==U&&(this._flowMap=U,this._flowMapUpdate&&(gU(this._flowMapUpdate),this._flowMapUpdate=null),U&&(this._flowMapUpdate={process:U=>{var X;const b=null===(X=this.fU())||void 0===X?void 0:X.getTransformMatrix();this._flowMap._processParticle(U,this.flowMapStrength*this._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null},KU(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(U){this._attractors.push(U),1===this._attractors.length&&(this._attractorUpdate={process:U=>{for(const X of this._attractors)X._processParticle(U,this)},previousItem:null,nextItem:null},KU(this._attractorUpdate,this._directionProcessing))}removeAttractor(U){const X=this._attractors.indexOf(U);-1!==X&&this._attractors.splice(X,1),0===this._attractors.length&&gU(this._attractorUpdate)}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(U)}createHemisphericEmitter(){const U=MU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createSphereEmitter(){const U=HU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createDirectedSphereEmitter(){const U=TU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new F.JX(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.JX(0,1,0));return this.particleEmitterType=U,U}createCylinderEmitter(){const U=CU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=U,U}createDirectedCylinderEmitter(){const U=UX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.JX(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new F.JX(0,1,0));return this.particleEmitterType=U,U}createConeEmitter(){const U=XX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=U,U}createDirectedConeEmitter(){const U=bX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.JX(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.JX(0,1,0));return this.particleEmitterType=U,U}createBoxEmitter(U,X,b,F){const E=new R;return this.particleEmitterType=E,this.direction1=U,this.direction2=X,this.minEmitBox=b,this.maxEmitBox=F,E}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const U of this.subEmitters)U instanceof zX?this._subEmitters.push([new ZU(U)]):U instanceof ZU?this._subEmitters.push([U]):U instanceof Array&&this._subEmitters.push(U)}_stopSubEmitters(){if(this.activeSubSystems){for(const U of this.activeSubSystems)U.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const U=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==U&&this._rootParticleSystem.activeSubSystems.splice(U,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(U){U&&this._stopSubEmitters()}_prepareParticle(U){if(this._subEmitters&&this._subEmitters.length>0){const X=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];U._attachedSubEmitters=[];for(const b of X)if(0===b.type){const X=b.clone();U._attachedSubEmitters.push(X),X.particleSystem.start()}}}_onDispose(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),U&&this.particles)for(const b of this.particles)if(b._attachedSubEmitters)for(let U=b._attachedSubEmitters.length-1;U>=0;U-=1)b._attachedSubEmitters[U].dispose();if(X&&this.activeSubSystems)for(let b=this.activeSubSystems.length-1;b>=0;b-=1)this.activeSubSystems[b].dispose();if(this._subEmitters&&this._subEmitters.length){for(let U=0;U<this._subEmitters.length;U++)for(const X of this._subEmitters[U])X.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.FX&&this.FX.dispose&&this.FX.dispose(!0)}static _Parse(U,X,b,E){let w;w=b instanceof cU.e?null:b;const q=(0,z.c)("BABYLON.Texture");if(q&&w&&(U.texture?X.particleTexture=q.Parse(U.texture,w,E):U.textureName&&(X.particleTexture=new q(E+U.textureName,w,!1,void 0===U.invertY||U.invertY),X.particleTexture.name=U.textureName)),U.emitterId||0===U.emitterId||void 0!==U.FX?U.emitterId&&w?X.FX=w.getLastMeshById(U.emitterId):X.FX=F.JX.uX(U.FX):X.FX=F.JX.Zero(),X.isLocal=!!U.isLocal,void 0!==U.renderingGroupId&&(X.renderingGroupId=U.renderingGroupId),void 0!==U.isBillboardBased&&(X.isBillboardBased=U.isBillboardBased),void 0!==U.billboardMode&&(X.billboardMode=U.billboardMode),void 0!==U.useLogarithmicDepth&&(X.useLogarithmicDepth=U.useLogarithmicDepth),U.animations){for(let b=0;b<U.animations.length;b++){const F=U.animations[b],E=(0,z.c)("BABYLON.Animation");E&&X.animations.push(E.Parse(F))}X.beginAnimationOnStart=U.beginAnimationOnStart,X.beginAnimationFrom=U.beginAnimationFrom,X.beginAnimationTo=U.beginAnimationTo,X.beginAnimationLoop=U.beginAnimationLoop}if(U.autoAnimate&&w&&w.beginAnimation(X,U.autoAnimateFrom,U.autoAnimateTo,U.autoAnimateLoop,U.autoAnimateSpeed||1),X.startDelay=0|U.startDelay,X.minAngularSpeed=U.minAngularSpeed,X.maxAngularSpeed=U.maxAngularSpeed,X.minSize=U.minSize,X.maxSize=U.maxSize,U.minScaleX&&(X.minScaleX=U.minScaleX,X.maxScaleX=U.maxScaleX,X.minScaleY=U.minScaleY,X.maxScaleY=U.maxScaleY),void 0!==U.preWarmCycles&&(X.preWarmCycles=U.preWarmCycles,X.preWarmStepOffset=U.preWarmStepOffset),void 0!==U.minInitialRotation&&(X.minInitialRotation=U.minInitialRotation,X.maxInitialRotation=U.maxInitialRotation),X.minLifeTime=U.minLifeTime,X.maxLifeTime=U.maxLifeTime,X.minEmitPower=U.minEmitPower,X.maxEmitPower=U.maxEmitPower,X.emitRate=U.emitRate,X.gravity=F.JX.uX(U.gravity),U.noiseStrength&&(X.noiseStrength=F.JX.uX(U.noiseStrength)),X.color1=Q.eb.uX(U.color1),X.color2=Q.eb.uX(U.color2),X.colorDead=Q.eb.uX(U.colorDead),X.updateSpeed=U.updateSpeed,X.targetStopDuration=U.targetStopDuration,X.blendMode=U.blendMode,U.colorGradients)for(const F of U.colorGradients)X.addColorGradient(F.gradient,Q.eb.uX(F.color1),F.color2?Q.eb.uX(F.color2):void 0);if(U.rampGradients){for(const b of U.rampGradients)X.addRampGradient(b.gradient,Q.NX.uX(b.color));X.useRampGradients=U.useRampGradients}if(U.colorRemapGradients)for(const F of U.colorRemapGradients)X.addColorRemapGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(U.alphaRemapGradients)for(const F of U.alphaRemapGradients)X.addAlphaRemapGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(U.sizeGradients)for(const F of U.sizeGradients)X.addSizeGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(U.angularSpeedGradients)for(const F of U.angularSpeedGradients)X.addAngularSpeedGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(U.velocityGradients)for(const F of U.velocityGradients)X.addVelocityGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(U.dragGradients)for(const F of U.dragGradients)X.addDragGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(U.emitRateGradients)for(const F of U.emitRateGradients)X.addEmitRateGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(U.startSizeGradients)for(const F of U.startSizeGradients)X.addStartSizeGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(U.lifeTimeGradients)for(const F of U.lifeTimeGradients)X.addLifeTimeGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);if(U.limitVelocityGradients){for(const b of U.limitVelocityGradients)X.addLimitVelocityGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);X.limitVelocityDamping=U.limitVelocityDamping}if(U.noiseTexture&&w){const b=(0,z.c)("BABYLON.ProceduralTexture");X.noiseTexture=b.Parse(U.noiseTexture,w,E)}let p;if(U.particleEmitterType){switch(U.particleEmitterType.type){case"SphereParticleEmitter":p=new O;break;case"SphereDirectedParticleEmitter":p=new N;break;case"ConeEmitter":case"ConeParticleEmitter":p=new n;break;case"ConeDirectedParticleEmitter":p=new a;break;case"CylinderParticleEmitter":p=new J;break;case"CylinderDirectedParticleEmitter":p=new m;break;case"HemisphericParticleEmitter":p=new x;break;case"PointParticleEmitter":p=new I;break;case"MeshParticleEmitter":p=new P;break;case"CustomParticleEmitter":p=new u;break;default:p=new R}p.parse(U.particleEmitterType,w)}else p=new R,p.parse(U,w);X.particleEmitterType=p,X.startSpriteCellID=U.startSpriteCellID,X.endSpriteCellID=U.endSpriteCellID,X.spriteCellLoop=U.spriteCellLoop??!0,X.spriteCellWidth=U.spriteCellWidth,X.spriteCellHeight=U.spriteCellHeight,X.spriteCellChangeSpeed=U.spriteCellChangeSpeed,X.spriteRandomStartCell=U.spriteRandomStartCell,X.disposeOnStop=U.disposeOnStop??!1,X.manualEmitCount=U.manualEmitCount??-1}static Parse(U,X,b){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0;const z=U.name;let q,p,S=null,R=null;if(X instanceof cU.e?q=X:(p=X,q=p.getEngine()),U.customShader&&q.createEffectForParticles){R=U.customShader;const X=R.shaderOptions.defines.length>0?R.shaderOptions.defines.join("\n"):"";S=q.createEffectForParticles(R.shaderPath.fragmentElement,R.shaderOptions.uniforms,R.shaderOptions.samplers,X)}const n=new zX(z,w||U.tX,X,S,U.isAnimationSheetEnabled);if(n.customShader=R,n._rootUrl=b,U.id&&(n.id=U.id),U.subEmitters){n.subEmitters=[];for(const F of U.subEmitters){const U=[];for(const E of F)U.push(ZU.Parse(E,X,b));n.subEmitters.push(U)}}if(U.attractors)for(const Q of U.attractors){const U=new QX;U.position=F.JX.uX(Q.position),U.strength=Q.strength,n.addAttractor(U)}return zX._Parse(U,n,X,b),U.textureMask&&(n.textureMask=Q.eb.uX(U.textureMask)),U.jp&&(n.jp=F.JX.uX(U.jp)),U.preventAutoStart&&(n.preventAutoStart=U.preventAutoStart),E||n.preventAutoStart||n.start(),n}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};if(zX._Serialize(X,this,U),X.textureMask=this.textureMask.Jb(),X.customShader=this.customShader,X.preventAutoStart=this.preventAutoStart,X.jp=this.jp.Jb(),this.subEmitters){X.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const b of this._subEmitters){const F=[];for(const X of b)F.push(X.serialize(U));X.subEmitters.push(F)}}if(this._attractors&&this._attractors.length){X.attractors=[];for(const U of this._attractors)X.attractors.push(U.serialize())}return X}static _Serialize(U,X,b){if(U.name=X.name,U.id=X.id,U.tX=X.getCapacity(),U.disposeOnStop=X.disposeOnStop,U.manualEmitCount=X.manualEmitCount,X.FX.position){const b=X.FX;U.emitterId=b.id}else{const b=X.FX;U.FX=b.Jb()}X.particleEmitterType&&(U.particleEmitterType=X.particleEmitterType.serialize()),X.particleTexture&&(b?U.texture=X.particleTexture.serialize():(U.textureName=X.particleTexture.name,U.invertY=!!X.particleTexture._invertY)),U.isLocal=X.isLocal,h.d.AppendSerializedAnimations(X,U),U.beginAnimationOnStart=X.beginAnimationOnStart,U.beginAnimationFrom=X.beginAnimationFrom,U.beginAnimationTo=X.beginAnimationTo,U.beginAnimationLoop=X.beginAnimationLoop,U.startDelay=X.startDelay,U.renderingGroupId=X.renderingGroupId,U.isBillboardBased=X.isBillboardBased,U.billboardMode=X.billboardMode,U.minAngularSpeed=X.minAngularSpeed,U.maxAngularSpeed=X.maxAngularSpeed,U.minSize=X.minSize,U.maxSize=X.maxSize,U.minScaleX=X.minScaleX,U.maxScaleX=X.maxScaleX,U.minScaleY=X.minScaleY,U.maxScaleY=X.maxScaleY,U.minEmitPower=X.minEmitPower,U.maxEmitPower=X.maxEmitPower,U.minLifeTime=X.minLifeTime,U.maxLifeTime=X.maxLifeTime,U.emitRate=X.emitRate,U.gravity=X.gravity.Jb(),U.noiseStrength=X.noiseStrength.Jb(),U.color1=X.color1.Jb(),U.color2=X.color2.Jb(),U.colorDead=X.colorDead.Jb(),U.updateSpeed=X.updateSpeed,U.targetStopDuration=X.targetStopDuration,U.blendMode=X.blendMode,U.preWarmCycles=X.preWarmCycles,U.preWarmStepOffset=X.preWarmStepOffset,U.minInitialRotation=X.minInitialRotation,U.maxInitialRotation=X.maxInitialRotation,U.startSpriteCellID=X.startSpriteCellID,U.spriteCellLoop=X.spriteCellLoop,U.endSpriteCellID=X.endSpriteCellID,U.spriteCellChangeSpeed=X.spriteCellChangeSpeed,U.spriteCellWidth=X.spriteCellWidth,U.spriteCellHeight=X.spriteCellHeight,U.spriteRandomStartCell=X.spriteRandomStartCell,U.isAnimationSheetEnabled=X.isAnimationSheetEnabled,U.useLogarithmicDepth=X.useLogarithmicDepth;const F=X.getColorGradients();if(F){U.colorGradients=[];for(const X of F){const b={gradient:X.gradient,color1:X.color1.Jb()};X.color2?b.color2=X.color2.Jb():b.color2=X.color1.Jb(),U.colorGradients.push(b)}}const E=X.getRampGradients();if(E){U.rampGradients=[];for(const X of E){const b={gradient:X.gradient,color:X.color.Jb()};U.rampGradients.push(b)}U.useRampGradients=X.useRampGradients}const w=X.getColorRemapGradients();if(w){U.colorRemapGradients=[];for(const X of w){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.colorRemapGradients.push(b)}}const Q=X.getAlphaRemapGradients();if(Q){U.alphaRemapGradients=[];for(const X of Q){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.alphaRemapGradients.push(b)}}const z=X.getSizeGradients();if(z){U.sizeGradients=[];for(const X of z){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.sizeGradients.push(b)}}const q=X.getAngularSpeedGradients();if(q){U.angularSpeedGradients=[];for(const X of q){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.angularSpeedGradients.push(b)}}const p=X.getVelocityGradients();if(p){U.velocityGradients=[];for(const X of p){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.velocityGradients.push(b)}}const S=X.getDragGradients();if(S){U.dragGradients=[];for(const X of S){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.dragGradients.push(b)}}const R=X.getEmitRateGradients();if(R){U.emitRateGradients=[];for(const X of R){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.emitRateGradients.push(b)}}const n=X.getStartSizeGradients();if(n){U.startSizeGradients=[];for(const X of n){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.startSizeGradients.push(b)}}const a=X.getLifeTimeGradients();if(a){U.lifeTimeGradients=[];for(const X of a){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.lifeTimeGradients.push(b)}}const J=X.getLimitVelocityGradients();if(J){U.limitVelocityGradients=[];for(const X of J){const b={gradient:X.gradient,factor1:X.factor1};void 0!==X.factor2?b.factor2=X.factor2:b.factor2=X.factor1,U.limitVelocityGradients.push(b)}U.limitVelocityDamping=X.limitVelocityDamping}X.noiseTexture&&(U.noiseTexture=X.noiseTexture.serialize())}clone(U,X){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F={...this._customWrappers};let E=null;const w=this._engine;if(w.createEffectForParticles&&null!=this.customShader){E=this.customShader;const U=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",X=w.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,U);F[0]?F[0].effect=X:this.setCustomEffect(X,0)}const Q=this.serialize(b),z=zX.Parse(Q,this._scene||this._engine,this._rootUrl);return z.name=U,z.customShader=E,z._customWrappers=F,void 0===X&&(X=this.FX),this.noiseTexture&&(z.noiseTexture=this.noiseTexture.clone()),z.FX=X,this.preventAutoStart||z.start(),z}}zX.BILLBOARDMODE_Y=2,zX.BILLBOARDMODE_ALL=7,zX.BILLBOARDMODE_STRETCHED=8,zX.BILLBOARDMODE_STRETCHED_LOCAL=9,ZU._ParseParticleSystem=zX.Parse;var qX=b(11840),pX=b(11833),SX=b(11717);SX.e.prototype.createTransformFeedback=function(){const U=this._gl.createTransformFeedback();if(!U)throw new Error("Unable to create Transform Feedback");return U},SX.e.prototype.deleteTransformFeedback=function(U){this._gl.deleteTransformFeedback(U)},SX.e.prototype.bindTransformFeedback=function(U){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,U)},SX.e.prototype.beginTransformFeedback=function(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(U?this._gl.POINTS:this._gl.TRIANGLES)},SX.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},SX.e.prototype.setTranformFeedbackVaryings=function(U,X){this._gl.transformFeedbackVaryings(U,X,this._gl.INTERLEAVED_ATTRIBS)},SX.e.prototype.bindTransformFeedbackBuffer=function(U){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,U?U.underlyingResource:null)},SX.e.prototype.readTransformFeedbackBuffer=function(U){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,U)};const RX="clipPlaneFragmentDeclaration2",nX="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";j.c.IncludesShadersStore[RX]||(j.c.IncludesShadersStore[RX]=nX);b(12888),b(12894),b(12902),b(12911),b(12916),b(12922),b(12926),b(12929);const aX="gpuRenderParticlesPixelShader",JX="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";j.c.ShadersStore[aX]||(j.c.ShadersStore[aX]=JX);const mX="clipPlaneVertexDeclaration2",xX="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";j.c.IncludesShadersStore[mX]||(j.c.IncludesShadersStore[mX]=xX);b(12935),b(12937),b(12943),b(12946);const IX="gpuRenderParticlesVertexShader",OX="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";j.c.ShadersStore[IX]||(j.c.ShadersStore[IX]=OX);class NX extends q{static get IsSupported(){if(!T.c.LastCreatedEngine)return!1;const U=T.c.LastCreatedEngine.getCaps();return U.supportTransformFeedbacks||U.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(U){this._maxActiveParticleCount=Math.min(U,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(U){this.maxActiveParticleCount=U}createPointEmitter(U,X){const b=rU(U,X);return this.particleEmitterType=b,b}createHemisphericEmitter(){const U=MU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createSphereEmitter(){const U=HU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=U,U}createDirectedSphereEmitter(){const U=TU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new F.JX(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.JX(0,1,0));return this.particleEmitterType=U,U}createCylinderEmitter(){const U=CU(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=U,U}createDirectedCylinderEmitter(){const U=UX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.JX(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new F.JX(0,1,0));return this.particleEmitterType=U,U}createConeEmitter(){const U=XX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=U,U}createDirectedConeEmitter(){const U=bX(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new F.JX(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new F.JX(0,1,0));return this.particleEmitterType=U,U}createBoxEmitter(U,X,b,F){const E=new R;return this.particleEmitterType=E,this.direction1=U,this.direction2=X,this.minEmitBox=b,this.maxEmitBox=F,E}get flowMap(){return this._flowMap}set flowMap(U){this._flowMap!==U&&(this._flowMap=U)}isReady(){if(!this.FX||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==zX.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(zX.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(zX.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";U?setTimeout((()=>{this.start(0)}),U):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var U;let X=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(U=this._customWrappers[X])||void 0===U?void 0:U.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[U]??this._customWrappers[0]}setCustomEffect(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[X]=new UU.d(this._engine),this._customWrappers[X].effect=U}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new M.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(U,X,b){return super._removeGradientAndTexture(U,X,b),this._releaseBuffers(),this}addColorGradient(U,X){this._colorGradients||(this._colorGradients=[]);const b=new G(U,X);return this._colorGradients.push(b),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(U&&this._colorGradients.sort(((U,X)=>U.gradient<X.gradient?-1:U.gradient>X.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(U){return this._removeGradientAndTexture(U,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const X in this._drawWrappers){var U;null===(U=this._drawWrappers[X].drawContext)||void 0===U||U.reset()}}_addFactorGradient(U,X,b){const F=new c(X,b);U.push(F),this._releaseBuffers()}addSizeGradient(U,X){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,U,X),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(U){return this._removeGradientAndTexture(U,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(U,X){if(!U)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&U.sort(((U,X)=>U.gradient<X.gradient?-1:U.gradient>X.gradient?1:0));const b=this;b[X]&&(b[X].dispose(),b[X]=null)}addAngularSpeedGradient(U,X){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,U,X),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(U){return this._removeGradientAndTexture(U,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(U,X){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,U,X),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(U){return this._removeGradientAndTexture(U,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(U,X){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,U,X),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(U){return this._removeGradientAndTexture(U,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(U,X){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,U,X),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(U){return this._removeGradientAndTexture(U,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(U){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(U,X,b){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(U),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.wb=new M.e,this.onStoppedObservable=new M.e,this.onStartedObservable=new M.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=F.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||T.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.wn.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,z.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,z.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,z.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,z.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new UU.d(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers={0:new UU.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(X=X??{}).randomTextureSize||delete X.randomTextureSize;const Q={tX:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...X},q=X;isFinite(q)&&(Q.tX=q),this._capacity=Q.tX,this._maxActiveParticleCount=Q.tX,this._currentActiveCount=0,this._isAnimationSheetEnabled=w,this.particleEmitterType=new R;const p=Math.min(this._engine.getCaps().maxTextureSize,Q.randomTextureSize);let S=[];for(let F=0;F<p;++F)S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random());this._randomTexture=new H.d(new Float32Array(S),p,1,5,b,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,S=[];for(let F=0;F<p;++F)S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random());this._randomTexture2=new H.d(new Float32Array(S),p,1,5,b,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=p}_reset(){this._releaseBuffers()}_createVertexBuffers(U,X,b){const F={};F.position=X.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let E=3;F.age=X.createVertexBuffer("age",E,1,this._attributesStrideSize,!0),E+=1,F.size=X.createVertexBuffer("size",E,3,this._attributesStrideSize,!0),E+=3,F.life=X.createVertexBuffer("life",E,1,this._attributesStrideSize,!0),E+=1,E+=4,this.billboardMode===zX.BILLBOARDMODE_STRETCHED&&(F.direction=X.createVertexBuffer("direction",E,3,this._attributesStrideSize,!0)),E+=3,this._platform.alignDataInBuffer&&(E+=1),this.particleEmitterType instanceof u&&(E+=3,this._platform.alignDataInBuffer&&(E+=1)),this._colorGradientsTexture||(F.color=X.createVertexBuffer("color",E,4,this._attributesStrideSize,!0),E+=4),this._isBillboardBased||(F.initialDirection=X.createVertexBuffer("initialDirection",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),this.noiseTexture&&(F.noiseCoordinates1=X.createVertexBuffer("noiseCoordinates1",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1),F.noiseCoordinates2=X.createVertexBuffer("noiseCoordinates2",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),F.angle=X.createVertexBuffer("angle",E,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?E++:E+=2,this._isAnimationSheetEnabled&&(F.cellIndex=X.createVertexBuffer("cellIndex",E,1,this._attributesStrideSize,!0),E+=1,this.spriteRandomStartCell&&(F.cellStartOffset=X.createVertexBuffer("cellStartOffset",E,1,this._attributesStrideSize,!0),E+=1)),F.offset=b.createVertexBuffer("offset",0,2),F.uv=b.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(F),this._platform.createVertexBuffers(U,F),this.resetDrawCache()}_initialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!U)return;const X=this._engine,b=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof u&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const E=this.particleEmitterType instanceof u,w=F.TmpVectors.JX[0];let Q=0;for(let F=0;F<this._capacity;F++)if(b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),E?(this.particleEmitterType.particleDestinationGenerator(F,null,w),b.push(w.x),b.push(w.y),b.push(w.z)):(b.push(0),b.push(0),b.push(0)),this._platform.alignDataInBuffer&&b.push(0),Q+=16,E&&(this.particleEmitterType.particlePositionGenerator(F,null,w),b.push(w.x),b.push(w.y),b.push(w.z),this._platform.alignDataInBuffer&&b.push(0),Q+=4),this._colorGradientsTexture||(b.push(0),b.push(0),b.push(0),b.push(0),Q+=4),this.isBillboardBased||(b.push(0),b.push(0),b.push(0),this._platform.alignDataInBuffer&&b.push(0),Q+=4),this.noiseTexture&&(b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),Q+=8),b.push(0),Q+=1,this._angularSpeedGradientsTexture||(b.push(0),Q+=1),this._isAnimationSheetEnabled&&(b.push(0),Q+=1,this.spriteRandomStartCell&&(b.push(0),Q+=1)),this._platform.alignDataInBuffer){let U=3-(Q+3&3);for(Q+=U;U-- >0;)b.push(0)}const z=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),q=this._platform.createParticleBuffer(b),p=this._platform.createParticleBuffer(b);this._buffer0=new i.d(X,q,!1,this._attributesStrideSize),this._buffer1=new i.d(X,p,!1,this._attributesStrideSize),this._spriteBuffer=new i.d(X,z,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let U=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(U+="\n#define BILLBOARD"),this._colorGradientsTexture&&(U+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(U+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(U+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(U+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(U+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(U+="\n#define DRAGGRADIENTS"),this._flowMap&&(U+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(U+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(U+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(U+="\n#define NOISE"),this.isLocal&&(U+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===U||(this._cachedUpdateDefines=U,this._updateBuffer=this._platform.createUpdateBuffer(U)),this._platform.isUpdateBufferReady()}_getWrapper(U){const X=this._getCustomDrawWrapper(U);if(null!==X&&void 0!==X&&X.effect)return X;const b=[];this.fillDefines(b,U);let F=this._drawWrappers[U];F||(F=new UU.d(this._engine),F.drawContext&&(F.drawContext.useInstancing=!0),this._drawWrappers[U]=F);const E=b.join("\n");if(F.defines!==E){const U=[],X=[],b=[];this.fillUniformsAttributesAndSamplerNames(X,U,b),F.setEffect(this._engine.createEffect("gpuRenderParticles",U,X,b,E),E)}return F}static _GetAttributeNamesOrOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=[i.h.PositionKind,"age","life","size","angle"];return U||E.push(i.h.ColorKind),X&&E.push("cellIndex"),b||E.push("initialDirection"),F&&E.push("direction"),E.push("offset",i.h.UVKind),E}static _GetEffectCreationOptions(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F=["emitterWM","jp","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,XU.b)(F),U&&F.push("sheetInfos"),X&&F.push("logarithmicDepthConstant"),b&&(F.push("vFogInfos"),F.push("vFogColor")),F}fillDefines(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,XU.h)(this,this._scene,U),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==pX.c.FOGMODE_NONE&&U.push("#define FOG")),X===zX.BLENDMODE_MULTIPLY&&U.push("#define BLENDMULTIPLYMODE"),this.isLocal&&U.push("#define LOCAL"),this.useLogarithmicDepth&&U.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(U.push("#define BILLBOARD"),this.billboardMode){case zX.BILLBOARDMODE_Y:U.push("#define BILLBOARDY");break;case zX.BILLBOARDMODE_STRETCHED:U.push("#define BILLBOARDSTRETCHED");break;case zX.BILLBOARDMODE_ALL:U.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&U.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&U.push("#define ANIMATESHEET"),b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),U.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(U,X,b){X.push(...NX._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===zX.BILLBOARDMODE_STRETCHED)),U.push(...NX._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(qX.d.PrepareUniforms(U,this._imageProcessingConfigurationDefines),qX.d.PrepareSamplers(b,this._imageProcessingConfigurationDefines))}animate(){var U;let X=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(X?this.preWarmStepOffset:(null===(U=this._scene)||void 0===U?void 0:U.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(U,X){const b=this[X];if(!U||!U.length||b)return;const F=new Float32Array(this._rawTextureWidth);for(let E=0;E<this._rawTextureWidth;E++){const X=E/this._rawTextureWidth;r.GetCurrentGradient(X,U,((U,X,b)=>{F[E]=(0,p.Lerp)(U.factor1,X.factor1,b)}))}this[X]=H.d.CreateRTexture(F,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[X].name=X.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const U=new Uint8Array(4*this._rawTextureWidth),X=Q.TmpColors.eb[0];for(let b=0;b<this._rawTextureWidth;b++){const F=b/this._rawTextureWidth;r.GetCurrentGradient(F,this._colorGradients,((F,E,w)=>{Q.eb.LerpToRef(F.color1,E.color1,w,X),U[4*b]=255*X.r,U[4*b+1]=255*X.g,U[4*b+2]=255*X.b,U[4*b+3]=255*X.a}))}this._colorGradientsTexture=H.d.CreateRGBATexture(U,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(U,X){var b,E,w,Q;const z=this._getWrapper(U),q=z.effect;this._engine.enableEffect(z);const p=(null===(b=this._scene)||void 0===b?void 0:b.getViewMatrix())||F.Matrix.IdentityReadOnly;if(q.setMatrix("view",p),q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),q.setTexture("diffuseSampler",this.particleTexture),q.setVector2("translationPivot",this.translationPivot),q.setVector3("jp",this.jp),this.isLocal&&q.setMatrix("emitterWM",X),this._colorGradientsTexture?q.setTexture("colorGradientSampler",this._colorGradientsTexture):q.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const U=this.particleTexture.getBaseSize();q.setFloat3("sheetInfos",this.spriteCellWidth/U.width,this.spriteCellHeight/U.height,U.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const U=this._scene.activeCamera;q.setVector3("eyePosition",U.globalPosition)}const S=q.defines;if(this._scene&&((0,XU.d)(q,this,this._scene),this.applyFog&&(0,bU.g)(this._scene,void 0,q)),S.indexOf("#define BILLBOARDMODE_ALL")>=0){const U=p.clone();U.invert(),q.setMatrix("invView",U)}return this.useLogarithmicDepth&&this._scene&&(0,bU.l)(S,q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(q),this._setEngineBasedOnBlendMode(U),this._platform.bindDrawBuffers(this._targetIndex,q,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(q),null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(U){if(!this.FX||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!U)if(this.FX.position){U=this.FX.getWorldMatrix()}else{const X=this.FX;U=F.TmpVectors.Matrix[0],F.Matrix.TranslationToRef(X.x,X.y,X.z,U)}const X=this._engine,b=X.getDepthWrite();if(X.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const U=this.fU();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",U.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",U),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const E=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=E,X.setDepthWrite(b)}render(){let U,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!X&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let U=0;U<this.preWarmCycles;U++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const U=0|this._accumulatedCount;this._accumulatedCount-=U,this._currentActiveCount+=U}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.FX.position){U=this.FX.getWorldMatrix()}else{const X=this.FX;U=F.TmpVectors.Matrix[0],F.Matrix.TranslationToRef(X.x,X.y,X.z,U)}const E=this._engine;this.updateInAnimate||this._update(U);let w=0;return X||b||(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0),w=this.blendMode===zX.BLENDMODE_MULTIPLYADD?this._render(zX.BLENDMODE_MULTIPLY,U)+this._render(zX.BLENDMODE_ADD,U):this._render(this.blendMode,U),this._engine.setAlphaMode(0)),w}rebuild(){const U=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(U,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,U()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const X in this._drawWrappers){this._drawWrappers[X].dispose()}if(this._drawWrappers={},this._scene){const U=this._scene.wn.indexOf(this);U>-1&&this._scene.wn.splice(U,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let X=0;X<this._renderVertexBuffers.length;++X){const U=this._renderVertexBuffers[X];for(const X in U)U[X].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),U&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),U&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.wb.notifyObservers(this),this.wb.clear()}clone(U,X){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const F={...this._customWrappers};let E=null;const w=this._engine;if(w.createEffectForParticles&&null!=this.customShader){E=this.customShader;const U=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"";F[0]=w.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,U,void 0,void 0,void 0,this)}const Q=this.serialize(b),z=NX.Parse(Q,this._scene||this._engine,this._rootUrl);return z.name=U,z.customShader=E,z._customWrappers=F,void 0===X&&(X=this.FX),this.noiseTexture&&(z.noiseTexture=this.noiseTexture.clone()),z.FX=X,z}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={};return zX._Serialize(X,this,U),X.activeParticleCount=this.activeParticleCount,X.randomTextureSize=this._randomTextureSize,X.customShader=this.customShader,X}static Parse(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const w=U.name;let Q,z;X instanceof cU.e?Q=X:(z=X,Q=z.getEngine());const q=new NX(w,{tX:E||U.tX,randomTextureSize:U.randomTextureSize},X,null,U.isAnimationSheetEnabled);if(q._rootUrl=b,U.customShader&&Q.createEffectForParticles){const X=U.customShader,b=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"",F=Q.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,b,void 0,void 0,void 0,q);q.setCustomEffect(F,0),q.customShader=X}return U.id&&(q.id=U.id),U.activeParticleCount&&(q.activeParticleCount=U.activeParticleCount),zX._Parse(U,q,X,b),U.preventAutoStart&&(q.preventAutoStart=U.preventAutoStart),F||q.preventAutoStart||q.start(),q}}var uX=b(11385),iX=b(12950),PX=b(11975);class fX{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(U){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const X of this.systems)X.FX=U;this._emitterNode=U}setEmitterAsSphere(U,X,b){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:U,renderingGroupId:X};const F=(0,iX.e)("emitterSphere",{diameter:U.diameter,segments:U.segments},b);F.renderingGroupId=X;const E=new PX.OX("emitterSphereMaterial",b);E.emissiveColor=U.color,F.material=E;for(const w of this.systems)w.FX=F;this._emitterNode=F}start(U){for(const X of this.systems)U&&(X.FX=U),X.start()}dispose(){for(const U of this.systems)U.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const X={systems:[]};for(const b of this.systems)X.systems.push(b.serialize(U));return this._emitterNode&&(X.FX=this._emitterCreationOptions),X}static Parse(U,X){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3?arguments[3]:void 0;const E=new fX,w=this.BaseAssetsUrl+"/textures/";X=X||T.c.LastCreatedScene;for(const Q of U.systems)E.systems.push(b?NX.Parse(Q,X,w,!0,F):zX.Parse(Q,X,w,!0,F));if(U.FX){const b=U.FX.options;if("Sphere"===U.FX.kind)E.setEmitterAsSphere({diameter:b.diameter,segments:b.segments,color:Q.NX.uX(b.color)},U.FX.renderingGroupId,X)}return E}}fX.BaseAssetsUrl="https://assets.babylonjs.com/particles";var jX=b(11436);class eX{static CreateDefault(U){let X,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,F=arguments.length>2?arguments[2]:void 0;X=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new NX("default system",{tX:b},F):new zX("default system",b,F),X.FX=U;const E=uX.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return X.particleTexture=new B.c(E,X.fU()),X.createConeEmitter(.1,Math.PI/4),X.color1=new Q.eb(1,1,1,1),X.color2=new Q.eb(1,1,1,1),X.colorDead=new Q.eb(1,1,1,0),X.minSize=.1,X.maxSize=.1,X.minEmitPower=2,X.maxEmitPower=2,X.updateSpeed=1/60,X.emitRate=30,X}static CreateAsync(U,X){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3?arguments[3]:void 0;X||(X=T.c.LastCreatedScene);const E={};return X.addPendingData(E),new Promise(((w,Q)=>{if(b&&!NX.IsSupported)return X.removePendingData(E),Q("Particle system with GPU is not supported.");uX.Tools.LoadFile(`${eX.BaseAssetsUrl}/systems/${U}.json`,(U=>{X.removePendingData(E);const Q=JSON.parse(U.toString());return w(fX.Parse(Q,X,b,F))}),void 0,void 0,void 0,(()=>(X.removePendingData(E),Q(`An error occurred with the creation of your particle system. Check if your type '${U}' exists.`))))}))}static ExportSet(U){const X=new fX;for(const b of U)X.systems.push(b);return X}static ParseFromFileAsync(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",w=arguments.length>5?arguments[5]:void 0;return new Promise(((Q,z)=>{const q=new jX.b;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const X=JSON.parse(q.responseText);let z;z=F?NX.Parse(X,b,E,!1,w):zX.Parse(X,b,E,!1,w),U&&(z.name=U),Q(z)}else z("Unable to load the particle system")})),q.open("GET",X),q.send()}))}static ParseFromSnippetAsync(U,X){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0;if("_BLANK"===U){const U=this.CreateDefault(null);return U.start(),Promise.resolve(U)}return new Promise(((w,Q)=>{const z=new jX.b;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const Q=JSON.parse(JSON.parse(z.responseText).jsonPayload),q=JSON.parse(Q.particleSystem);let p;p=b?NX.Parse(q,X,F,!1,E):zX.Parse(q,X,F,!1,E),p.snippetId=U,w(p)}else Q("Unable to load the snippet "+U)})),z.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),z.send()}))}}eX.BaseAssetsUrl=fX.BaseAssetsUrl,eX.SnippetUrl="https://snippet.babylonjs.com",eX.CreateFromSnippetAsync=eX.ParseFromSnippetAsync;var lX=b(12067),dX=b(11874),kX=b(12957);(0,kX.f)(dX.e.NAME_PARTICLESYSTEM,((U,X,b,F)=>{const E=(0,kX.g)(dX.e.NAME_PARTICLESYSTEM);if(E&&void 0!==U.wn&&null!==U.wn)for(let w=0,Q=U.wn.length;w<Q;w++){const Q=U.wn[w];b.wn.push(E(Q,X,F))}})),(0,kX.b)(dX.e.NAME_PARTICLESYSTEM,((U,X,b)=>{if(U.activeParticleCount){return NX.Parse(U,X,b)}return zX.Parse(U,X,b)})),cU.e.prototype.createEffectForParticles=function(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",w=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,q=arguments.length>7?arguments[7]:void 0,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,S=arguments.length>9?arguments[9]:void 0,R=[],n=[];const a=[];return q?q.fillUniformsAttributesAndSamplerNames(n,R,a):(R=zX._GetAttributeNamesOrOptions(),n=zX._GetEffectCreationOptions()),-1===E.indexOf(" BILLBOARD")&&(E+="\n#define BILLBOARD\n"),null!==q&&void 0!==q&&q.isAnimationSheetEnabled&&-1===E.indexOf(" ANIMATESHEET")&&(E+="\n#define ANIMATESHEET\n"),-1===F.indexOf("diffuseSampler")&&F.push("diffuseSampler"),this.createEffect({vertex:S??(null===q||void 0===q?void 0:q.vertexShaderName)??"particles",fragmentElement:U},R,n.concat(X),a.concat(F),E,w,Q,z,void 0,p,(async()=>{0===p?await Promise.resolve().then(b.bind(b,12984)):await Promise.resolve().then(b.bind(b,13041))}))},lX.e.prototype.getEmittedParticleSystems=function(){const U=[];for(let X=0;X<this.fU().wn.length;X++){const b=this.fU().wn[X];b.FX===this&&U.push(b)}return U},lX.e.prototype.getHierarchyEmittedParticleSystems=function(){const U=[],X=this.getDescendants();X.push(this);for(let b=0;b<this.fU().wn.length;b++){const F=this.fU().wn[b],E=F.FX;E.position&&-1!==X.indexOf(E)&&U.push(F)}return U};b(11949),b(11958),b(12038);b(12047),b(12966),b(11790),b(11933),b(12094);b(11781);var vX;b(12972),b(11612);!function(U){U[U.Color=2]="Color",U[U.UV=1]="UV",U[U.Random=0]="Random",U[U.Stated=3]="Stated"}(vX||(vX={}));var AX=b(11821);const sX=new F.JX(0,0,0),hX=new F.JX(0,0,0),BX=new F.JX(0,0,0);class oX{constructor(U,X,b){this.width=U,this.height=X,this.data=b}processFlowable(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;if(!b)return;b instanceof F.Matrix?F.JX.TransformCoordinatesToRef(U.position,b,BX):(BX.x=b.x,BX.y=b.y,BX.z=b.z);const E=.5*BX.x+.5,w=1-(.5*BX.y+.5),Q=Math.floor(E*this.width),z=Math.floor(w*this.height);if(Q<0||Q>=this.width||z<0||z>=this.height)return;const q=4*(z*this.width+Q),p=this.data[q]/255*2-1,S=this.data[q+1]/255*2-1,R=this.data[q+2]/255*2-1,n=this.data[q+3]/255;sX.set(p,S,R),sX.scaleToRef(X*n,hX),U.direction.addInPlace(hX)}_processParticle(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;this.processFlowable(U,X,b)}static async FromUrlAsync(U){return await new Promise(((X,b)=>{const F=document.createElement("canvas"),E=F.getContext("2d");let w=null;const Q=new Image;Q.crossOrigin="anonymous",Q.src=U,Q.onerror=X=>{b(new Error(`Failed to load image: ${U} : ${X}`))},Q.onload=()=>{F.width=Q.width,F.height=Q.height,E.drawImage(Q,0,0),w=E.getImageData(0,0,F.width,F.height),X(new oX(F.width,F.height,w.data))}}))}static async ExtractFromTextureAsync(U){return await new Promise(((X,b)=>{if(!U.isReady())return void U.onLoadObservable.addOnce((async()=>{try{const b=await this.ExtractFromTextureAsync(U);X(b)}catch(F){b(F)}}));const F=U.getSize();AX.k.GetTextureDataAsync(U,F.width,F.height).then((U=>{X(new oX(F.width,F.height,new Uint8ClampedArray(U)))})).catch(b)}))}}var yX,tX,WX,YX,KX,VX,gX,LX,DX;!function(U){U[U.Int=1]="Int",U[U.Float=2]="Float",U[U.Vector2=4]="Vector2",U[U.JX=8]="JX",U[U.Matrix=16]="Matrix",U[U.Particle=32]="Particle",U[U.Texture=64]="Texture",U[U.eb=128]="eb",U[U.FloatGradient=256]="FloatGradient",U[U.Vector2Gradient=512]="Vector2Gradient",U[U.Vector3Gradient=1024]="Vector3Gradient",U[U.Color4Gradient=2048]="Color4Gradient",U[U.System=4096]="System",U[U.AutoDetect=8192]="AutoDetect",U[U.BasedOnInput=16384]="BasedOnInput",U[U.Undefined=32768]="Undefined",U[U.All=65535]="All"}(yX||(yX={})),function(U){U[U.Compatible=0]="Compatible",U[U.TypeIncompatible=1]="TypeIncompatible",U[U.HierarchyIssue=2]="HierarchyIssue"}(tX||(tX={})),function(U){U[U.Input=0]="Input",U[U.Output=1]="Output"}(WX||(WX={}));class GX{get direction(){return this._direction}get type(){if(this._type===yX.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===yX.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(U){this._type=U}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((U=>U.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(U,X,b){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=yX.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new M.e,this.onDisconnectionObservable=new M.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=X,this.name=U,this._direction=b}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(U){var X;return this.isConnected?null!==(X=this._connectedPoint)&&void 0!==X&&X._storedFunction?this._connectedPoint._storedFunction(U):this._connectedPoint._storedValue:this.value}canConnectTo(U){return 0===this.checkCompatibilityState(U)}checkCompatibilityState(U){const X=this._ownerBlock,b=U.ownerBlock;if(this.type!==U.type&&U.innerType!==yX.AutoDetect)return U.acceptedConnectionPointTypes&&-1!==U.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(U.excludedConnectionPointTypes&&-1!==U.excludedConnectionPointTypes.indexOf(this.type))return 1;let F=b,E=X;return 0===this.direction&&(F=X,E=b),F.isAnAncestorOf(E)?2:0}connectTo(U){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(U))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${U.ownerBlock.name}".${U.name}`;return this._endpoints.push(U),U._connectedPoint=this,this.onConnectionObservable.notifyObservers(U),U.onConnectionObservable.notifyObservers(this),this}disconnectFrom(U){const X=this._endpoints.indexOf(U);return-1===X||(this._endpoints.splice(X,1),U._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(U),U.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(U){let X=1;for(;X<yX.All;)U&X||this.excludedConnectionPointTypes.push(X),X<<=1}serialize(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const X={};return X.name=this.name,X.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Jb?(X.valueType="BABYLON."+this.value.getClassName(),X.value=this.value.Jb()):(X.valueType="number",X.value=this.value)),U&&this.connectedPoint&&(X.inputName=this.name,X.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,X.targetConnectionName=this.connectedPoint.name,X.isExposedOnFrame=!0,X.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(X.isExposedOnFrame=!0,X.exposedPortPosition=this.exposedPortPosition),X}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class ZX{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(U){this._name=U}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(U){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new M.e,this.wb=new M.e,this.onInputChangedObservable=new M.e,this.visibleOnFrame=!1,this._name=U,this.uniqueId=o.c.UniqueId}_inputRename(U){return U}_outputRename(U){return U}isAnAncestorOf(U){for(const X of this._outputs)if(X.hasEndpoints)for(const b of X.endpoints){if(b.ownerBlock===U)return!0;if(b.ownerBlock.isAnAncestorOf(U))return!0}return!1}isAnAncestorOfType(U){if(this.getClassName()===U)return!0;for(const X of this._outputs)if(X.hasEndpoints)for(const b of X.endpoints)if(b.ownerBlock.isAnAncestorOfType(U))return!0;return!1}getInputByName(U){const X=this._inputs.filter((X=>X.name===U));return X.length?X[0]:null}_linkConnectionTypes(U,X){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[X]._acceptedConnectionPointType=this._inputs[U]:(this._inputs[U]._linkedConnectionSource=this._inputs[X],this._inputs[U]._isMainLinkSource=!0),this._inputs[X]._linkedConnectionSource=this._inputs[U]}registerInput(U,X){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0;const Q=new GX(U,this,0);return Q.type=X,Q.isOptional=b,Q.defaultValue=F,Q.value=F,Q.valueMin=E,Q.valueMax=w,this._inputs.push(Q),this.onInputChangedObservable.notifyObservers(Q),this}registerOutput(U,X,b){return(b=b??new GX(U,this,1)).type=X,this._outputs.push(b),this}_build(U){}_customBuildStep(U){}build(U){if(this._buildId===U.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((U=>U.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=U.buildId;for(const X of this._inputs){if(!X.connectedPoint){X.isOptional||U.notConnectedNonOptionalInputs.push(X);continue}const b=X.connectedPoint.ownerBlock;b&&b!==this&&!b.isSystem&&b.build(U)}return this._customBuildStep(U),U.verbose&&y.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(U),this.onBuildObservable.notifyObservers(this),!1}serialize(){const U={};U.customType="BABYLON."+this.getClassName(),U.id=this.uniqueId,U.name=this.name,U.visibleOnFrame=this.visibleOnFrame,U.inputs=[],U.outputs=[];for(const X of this.inputs)U.inputs.push(X.serialize());for(const X of this.outputs)U.outputs.push(X.serialize(!1));return U}_deserialize(U){this._name=U.name,this.comments=U.comments,this.visibleOnFrame=!!U.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(U)}_deserializePortDisplayNamesAndExposedOnFrame(U){const X=U.inputs,b=U.outputs;if(X)for(const F of X){const U=this.inputs.find((U=>U.name===F.name));if(!U)return;if(F.displayName&&(U.displayName=F.displayName),F.isExposedOnFrame&&(U.isExposedOnFrame=F.isExposedOnFrame,U.exposedPortPosition=F.exposedPortPosition),void 0!==F.value&&null!==F.value)if("number"===F.valueType)U.value=F.value;else{const X=(0,z.c)(F.valueType);X&&(U.value=X.uX(F.value))}}if(b)for(let F=0;F<b.length;F++){const U=b[F];U.displayName&&(this.outputs[F].displayName=U.displayName),U.isExposedOnFrame&&(this.outputs[F].isExposedOnFrame=U.isExposedOnFrame,this.outputs[F].exposedPortPosition=U.exposedPortPosition)}}clone(){const U=this.serialize(),X=(0,z.c)(U.customType);if(X){const b=new X;return b._deserialize(U),b}return null}dispose(){this.wb.notifyObservers(this),this.wb.clear();for(const U of this.inputs)U.dispose();for(const U of this.outputs)U.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function cX(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",F=arguments.length>3?arguments[3]:void 0;return(E,w)=>{let Q=E._propStore;Q||(Q=[],E._propStore=Q),Q.push({propertyName:w,displayName:U,type:X,groupName:b,options:F??{},className:E.getClassName()})}}(0,A.c)([(0,s.J)("comment")],ZX.prototype,"comments",void 0),function(U){U[U.Boolean=0]="Boolean",U[U.Float=1]="Float",U[U.Int=2]="Int",U[U.Vector2=3]="Vector2",U[U.List=4]="List",U[U.eb=5]="eb",U[U.SamplingMode=6]="SamplingMode",U[U.TextureFormat=7]="TextureFormat",U[U.TextureType=8]="TextureType"}(YX||(YX={})),function(U){U[U.None=0]="None",U[U.Position=1]="Position",U[U.Direction=2]="Direction",U[U.Age=3]="Age",U[U.Lifetime=4]="Lifetime",U[U.Color=5]="Color",U[U.ScaledDirection=6]="ScaledDirection",U[U.Scale=7]="Scale",U[U.AgeGradient=8]="AgeGradient",U[U.Angle=9]="Angle",U[U.SpriteCellIndex=16]="SpriteCellIndex",U[U.SpriteCellStart=17]="SpriteCellStart",U[U.SpriteCellEnd=18]="SpriteCellEnd"}(KX||(KX={})),function(U){U[U.None=0]="None",U[U.Time=1]="Time",U[U.Delta=2]="Delta",U[U.Emitter=3]="Emitter"}(VX||(VX={}));class rX{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let U="";for(const X of this.notConnectedNonOptionalInputs)U+=`input ${X.name} from block ${X.ownerBlock.name}[${X.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(U)throw"Build of Node Particle System Set failed:\n"+U}adapt(U,X){const b=U.getConnectedValue(this)||0;if(U.type===X)return b;switch(X){case yX.Vector2:return new F.Vector2(b,b);case yX.JX:return new F.JX(b,b,b);case yX.eb:return new Q.eb(b,b,b,b)}return null}getContextualValue(U){if(!this.particleContext||!this.systemContext)return null;switch(U){case KX.Position:return this.particleContext.position;case KX.Direction:return this.particleContext.direction;case KX.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case KX.Color:return this.particleContext.color;case KX.Age:return this.particleContext.age;case KX.Lifetime:return this.particleContext.lifeTime;case KX.Angle:return this.particleContext.angle;case KX.Scale:return this.particleContext.scale;case KX.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case KX.SpriteCellEnd:return this.systemContext.endSpriteCellID;case KX.SpriteCellIndex:return this.particleContext.cellIndex;case KX.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.FX.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.FX.absolutePosition:this.systemContext.FX:null}getSystemValue(U){if(!this.particleContext||!this.systemContext)return null;switch(U){case VX.Time:return this.systemContext._actualFrame;case VX.Delta:return this.systemContext._scaledUpdateSpeed;case VX.Emitter:if(this.isEmitterTransformNode){return this.systemContext.FX.absolutePosition}return this.systemContext.FX}return null}}function MX(U,X,b){const F=new rX;F.xX=X;const E=U.createSystem(F);return E.canStart=()=>!0,E.FX=b.clone(),E.disposeOnStop=!0,E.start(),E}class HX extends ZX{constructor(U){super(U),this.blendMode=q.BLENDMODE_ONEONE,this.tX=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",yX.Particle),this.registerInput("texture",yX.Texture),this.registerInput("onStart",yX.System,!0),this.registerInput("onEnd",yX.System,!0),this.registerOutput("system",yX.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(U){U.tX=this.tX,U.buildId=this._buildId++,this.build(U);const X=this.particle.getConnectedValue(U);return X.particleTexture=this.texture.getConnectedValue(U),X.emitRate=this.emitRate,X.blendMode=this.blendMode,X.name=this.name,X._nodeGenerated=!0,X._targetStopDuration=this.targetStopDuration,X.startDelay=this.startDelay,this.system._storedValue=this,X.canStart=()=>!this.doNoStart,X.onStartedObservable.add((b=>{const F=this.onStart.getConnectedValue(U);F&&b.onStartedObservable.addOnce((()=>{U.systemContext=X;const b=MX(F,U.xX,U.emitterPosition);this.wb.addOnce((()=>{b.dispose()}))}));const E=this.onEnd.getConnectedValue(U);E&&b.onStoppedObservable.addOnce((()=>{U.systemContext=X;const b=MX(E,U.xX,U.emitterPosition);this.wb.addOnce((()=>{b.dispose()}))}))})),this.wb.addOnce((()=>{X.dispose()})),X}serialize(){const U=super.serialize();return U.tX=this.tX,U.emitRate=this.emitRate,U.blendMode=this.blendMode,U.doNoStart=this.doNoStart,U.targetStopDuration=this.targetStopDuration,U.startDelay=this.startDelay,U}_deserialize(U){super._deserialize(U),this.tX=U.tX,this.emitRate=U.emitRate,this.doNoStart=!!U.doNoStart,void 0!==U.blendMode&&(this.blendMode=U.blendMode),void 0!==U.targetStopDuration&&(this.targetStopDuration=U.targetStopDuration),void 0!==U.startDelay&&(this.startDelay=U.startDelay)}}(0,A.c)([cX("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:q.BLENDMODE_ONEONE},{label:"Standard",value:q.BLENDMODE_STANDARD},{label:"Add",value:q.BLENDMODE_ADD},{label:"Multiply",value:q.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:q.BLENDMODE_MULTIPLYADD}]})],HX.prototype,"blendMode",void 0),(0,A.c)([cX("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],HX.prototype,"tX",void 0),(0,A.c)([cX("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HX.prototype,"emitRate",void 0),(0,A.c)([cX("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HX.prototype,"targetStopDuration",void 0),(0,A.c)([cX("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HX.prototype,"startDelay",void 0),(0,A.c)([cX("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],HX.prototype,"doNoStart",void 0),(0,z.f)("BABYLON.SystemBlock",HX);class TX extends ZX{get type(){if(this._type===yX.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=yX.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=yX.Vector2,this._type;case"JX":return this._type=yX.JX,this._type;case"eb":return this._type=yX.eb,this._type;case"Matrix":return this._type=yX.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===KX.None&&this._systemSource!==VX.None}get systemSource(){return this._systemSource}set systemSource(U){if(this._systemSource=U,U!==VX.None){switch(this._contextualSource=KX.None,this._type=yX.Float,U){case VX.Time:case VX.Delta:this._type=yX.Float;break;case VX.Emitter:this._type=yX.JX}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==KX.None}get contextualValue(){return this._contextualSource}set contextualValue(U){if(this._contextualSource=U,U!==KX.None){switch(this._systemSource=VX.None,U){case KX.Scale:this._type=yX.Vector2;break;case KX.Position:case KX.Direction:case KX.ScaledDirection:this._type=yX.JX;break;case KX.Color:this._type=yX.eb;break;case KX.Age:case KX.Lifetime:case KX.Angle:case KX.AgeGradient:this._type=yX.Float;break;case KX.SpriteCellEnd:case KX.SpriteCellStart:case KX.SpriteCellIndex:this._type=yX.Int}this.output&&(this.output.type=this._type)}}constructor(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yX.AutoDetect;super(U),this._type=yX.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new M.e,this._systemSource=VX.None,this._contextualSource=KX.None,this._type=X,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",X)}get value(){return this._storedValue}set value(U){this.type===yX.Float&&this.min!==this.max&&(U=Math.max(this.min,U),U=Math.min(this.max,U)),this._storedValue=U,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(U){this._valueCallback=U}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case yX.Int:case yX.Float:this.value=0;break;case yX.Vector2:this.value=F.Vector2.Zero();break;case yX.JX:this.value=F.JX.Zero();break;case yX.eb:this.value=new Q.eb(1,1,1,1);break;case yX.Matrix:this.value=F.Matrix.Identity()}}_build(U){super._build(U),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=U=>U.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=U=>U.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const U=super.serialize();return U.type=this.type,U.contextualValue=this.contextualValue,U.systemSource=this.systemSource,U.min=this.min,U.max=this.max,U.groupInInspector=this.groupInInspector,U.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Jb?(U.valueType="BABYLON."+this._storedValue.getClassName(),U.value=this._storedValue.Jb()):(U.valueType="number",U.value=this._storedValue)),U}_deserialize(U){if(super._deserialize(U),this._type=U.type,this.contextualValue=U.contextualValue,this.systemSource=U.systemSource||VX.None,this.min=U.min||0,this.max=U.max||0,this.groupInInspector=U.groupInInspector||"",void 0!==U.displayInInspector&&(this.displayInInspector=U.displayInInspector),U.valueType)if("number"===U.valueType)this._storedValue=U.value;else{const X=(0,z.c)(U.valueType);X&&(this._storedValue=X.uX(U.value))}}}(0,z.f)("BABYLON.ParticleInputBlock",TX);class CX extends ZX{get url(){return this._url}set url(U){this._url!==U&&(this._cachedData=null,this._url=U,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(U){this._textureDataUrl!==U&&(this._cachedData=null,this._textureDataUrl=U,this._url="",this._sourceTexture=null)}set sourceTexture(U){this._sourceTexture!==U&&(this._cachedData=null,this._sourceTexture=U,this._url="",this._textureDataUrl="")}constructor(U){super(U),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",yX.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const U=this.texture._storedValue;return await new Promise(((X,b)=>{if(!U.isReady())return void U.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),X(this._cachedData)}catch(U){b(U)}}));const F=U.getSize();AX.k.GetTextureDataAsync(U,F.width,F.height).then((b=>{this._cachedData={width:F.width,height:F.height,data:new Uint8ClampedArray(b)},U.dispose(),X(this._cachedData)})).catch(b)}))}_build(U){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new B.c(this._textureDataUrl,U.xX):this.texture._storedValue=new B.c(this._url,U.xX):this.texture._storedValue=null}serialize(){const U=super.serialize();return U.url=this.url,U.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(U.textureDataUrl=this.textureDataUrl),U}_deserialize(U){super._deserialize(U),this.url=U.url,this.serializedCachedData=!!U.serializedCachedData,U.textureDataUrl&&(this.textureDataUrl=U.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,z.f)("BABYLON.ParticleTextureSourceBlock",CX);class Ub extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerInput("position",yX.JX),this.registerOutput("output",yX.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(U){const X=this.particle.getConnectedValue(U);if(this.output._storedValue=X,!this.position.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=X,b.position.q(this.position.getConnectedValue(U))},previousItem:null,nextItem:null};X._updateQueueStart?VU(b,X._updateQueueStart):X._updateQueueStart=b}}(0,z.f)("BABYLON.UpdatePositionBlock",Ub),function(U){U[U.Add=0]="Add",U[U.Subtract=1]="Subtract",U[U.Multiply=2]="Multiply",U[U.Divide=3]="Divide",U[U.Max=4]="Max",U[U.Min=5]="Min"}(gX||(gX={}));class Xb extends ZX{constructor(U){super(U),this.operation=gX.Add,this.registerInput("left",yX.AutoDetect),this.registerInput("right",yX.AutoDetect),this.registerOutput("output",yX.BasedOnInput),this.output._typeConnectionSource=this.left;const X=[yX.Matrix,yX.Particle,yX.Texture,yX.System,yX.FloatGradient,yX.Color4Gradient,yX.Vector2Gradient,yX.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...X),this.right.excludedConnectionPointTypes.push(...X),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(U){let X;const b=this.left,E=this.right;if(!b.isConnected||!E.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const w=b.type===yX.Float||b.type===yX.Int,z=E.type===yX.Float||E.type===yX.Int,q=w&&z;switch(this.operation){case gX.Add:X=q?U=>b.getConnectedValue(U)+E.getConnectedValue(U):w?U=>U.adapt(b,E.type).add(E.getConnectedValue(U)):U=>b.getConnectedValue(U).add(U.adapt(E,b.type));break;case gX.Subtract:X=q?U=>b.getConnectedValue(U)-E.getConnectedValue(U):w?U=>U.adapt(b,E.type).mX(E.getConnectedValue(U)):U=>b.getConnectedValue(U).mX(U.adapt(E,b.type));break;case gX.Multiply:X=q?U=>b.getConnectedValue(U)*E.getConnectedValue(U):w?U=>U.adapt(b,E.type).multiply(E.getConnectedValue(U)):U=>b.getConnectedValue(U).multiply(U.adapt(E,b.type));break;case gX.Divide:X=q?U=>b.getConnectedValue(U)/E.getConnectedValue(U):w?U=>U.adapt(b,E.type).divide(E.getConnectedValue(U)):U=>b.getConnectedValue(U).divide(U.adapt(E,b.type));break;case gX.Min:if(q)X=U=>Math.min(b.getConnectedValue(U),E.getConnectedValue(U));else{const[U,z]=w?[E,b]:[b,E];switch(U.type){case yX.Vector2:X=X=>F.Vector2.Minimize(U.getConnectedValue(X),X.adapt(z,U.type));break;case yX.JX:X=X=>F.JX.Minimize(U.getConnectedValue(X),X.adapt(z,U.type));break;case yX.eb:X=X=>{const b=U.getConnectedValue(X),{r:F,g:E,b:w,a:q}=X.adapt(z,U.type);return new Q.eb(Math.min(b.r,F),Math.min(b.g,E),Math.min(b.b,w),Math.min(b.a,q))}}}break;case gX.Max:if(!q){const[U,z]=w?[E,b]:[b,E];switch(U.type){case yX.Vector2:X=X=>F.Vector2.Maximize(U.getConnectedValue(X),X.adapt(z,U.type));break;case yX.JX:X=X=>F.JX.Maximize(U.getConnectedValue(X),X.adapt(z,U.type));break;case yX.eb:X=X=>{const b=U.getConnectedValue(X),{r:F,g:E,b:w,a:q}=X.adapt(z,U.type);return new Q.eb(Math.max(b.r,F),Math.min(b.g,E),Math.min(b.b,w),Math.min(b.a,q))}}break}X=U=>Math.max(b.getConnectedValue(U),E.getConnectedValue(U))}this.output._storedFunction=U=>b.type===yX.Int?0|X(U):X(U)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===yX.Int||this.left.type===yX.Float&&this.right.type!==yX.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[U,X]of[[this.left,this.right],[this.right,this.left]])U.acceptedConnectionPointTypes=[yX.Int,yX.Float],X.isConnected&&(U.acceptedConnectionPointTypes.push(X.type),X.type!==yX.Int&&X.type!==yX.Float||U.acceptedConnectionPointTypes.push(yX.Vector2,yX.JX,yX.eb))}dispose(){super.dispose();for(const U of this._connectionObservers)U.remove();this._connectionObservers.length=0}serialize(){const U=super.serialize();return U.operation=this.operation,U}_deserialize(U){super._deserialize(U),this.operation=U.operation}}(0,A.c)([cX("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:gX.Add},{label:"Subtract",value:gX.Subtract},{label:"Multiply",value:gX.Multiply},{label:"Divide",value:gX.Divide},{label:"Max",value:gX.Max},{label:"Min",value:gX.Min}]})],Xb.prototype,"operation",void 0),(0,z.f)("BABYLON.ParticleMathBlock",Xb);class bb extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerInput("direction1",yX.JX,!0,new F.JX(0,1,0)),this.registerInput("direction2",yX.JX,!0,new F.JX(0,1,0)),this.registerInput("minEmitBox",yX.JX,!0,new F.JX(-.5,-.5,-.5)),this.registerInput("maxEmitBox",yX.JX,!0,new F.JX(.5,.5,.5)),this.registerOutput("output",yX.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(U){const X=this.particle.getConnectedValue(U);X._directionCreation.process=b=>{U.particleContext=b,U.systemContext=X;const E=this.direction1.getConnectedValue(U),w=this.direction2.getConnectedValue(U),Q=(0,p.RandomRange)(E.x,w.x),z=(0,p.RandomRange)(E.y,w.y),q=(0,p.RandomRange)(E.z,w.z);U.isEmitterTransformNode?F.JX.TransformNormalFromFloatsToRef(Q,z,q,U.emitterWorldMatrix,b.direction):b.direction.Pb(Q,z,q)},X._positionCreation.process=b=>{U.particleContext=b,U.systemContext=X;const E=this.minEmitBox.getConnectedValue(U),w=this.maxEmitBox.getConnectedValue(U),Q=(0,p.RandomRange)(E.x,w.x),z=(0,p.RandomRange)(E.y,w.y),q=(0,p.RandomRange)(E.z,w.z);U.isEmitterTransformNode?F.JX.TransformCoordinatesFromFloatsToRef(Q,z,q,U.emitterWorldMatrix,b.position):(b.position.Pb(Q,z,q),b.position.addInPlace(U.emitterPosition))},this.output._storedValue=X}}(0,z.f)("BABYLON.BoxShapeBlock",bb);class Fb extends ZX{constructor(U){super(U),this.registerInput("emitPower",yX.Float,!0,1),this.registerInput("lifeTime",yX.Float,!0,1),this.registerInput("color",yX.eb,!0,new Q.eb(1,1,1,1)),this.registerInput("scale",yX.Vector2,!0,new F.Vector2(1,1)),this.registerInput("angle",yX.Float,!0,0),this.registerOutput("particle",yX.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(U){const X=new zX(this.name,U.tX,U.xX,null,!1,void 0,!0);X.particleEmitterType=new I,X._lifeTimeCreation.process=(X,b)=>{U.particleContext=X,X.lifeTime=this.lifeTime.getConnectedValue(U),b._emitPower=this.emitPower.getConnectedValue(U)},X._colorCreation.process=X=>{U.particleContext=X,X.color.q(this.color.getConnectedValue(U))},X._sizeCreation.process=X=>{U.particleContext=X,X.size=1,X.scale.q(this.scale.getConnectedValue(U))},X._angleCreation.process=X=>{U.particleContext=X,X.angle=this.angle.getConnectedValue(U)},this.particle._storedValue=X}}(0,z.f)("BABYLON.CreateParticleBlock",Fb);class Eb{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const U=[];for(const X of this.attachedBlocks)X.isInput&&U.push(X);return U}constructor(U){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new M.e,this.name=U}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(U){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(U)&&this.attachedBlocks.push(U);for(const b of U.inputs){const F=b.connectedPoint;if(F){const b=F.ownerBlock;b!==U&&this._initializeBlock(b,X)}}}async buildAsync(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((b=>{const F=new fX;for(const U of this._systemBlocks)this._initializeBlock(U);for(const E of this.systemBlocks){const b=new rX;b.buildId=this._buildId++,b.xX=U,b.verbose=X;const w=E.createSystem(b);b.emitErrors(),F.systems.push(w)}this.onBuildObservable.notifyObservers(this),b(F)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const U=new HX("Particle system"),X=new Ub("Update position");X.output.connectTo(U.particle);const b=new TX("Position");b.contextualValue=KX.Position;const F=new TX("Scaled direction");F.contextualValue=KX.ScaledDirection;const E=new Xb("Add");E.operation=gX.Add,b.output.connectTo(E.left),F.output.connectTo(E.right),E.output.connectTo(X.position);const w=new Fb("Create particle"),Q=new bb("Box shape");w.particle.connectTo(Q.particle),Q.output.connectTo(X.particle);const z=new CX("Texture");z.texture.connectTo(U.texture),z.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(U)}removeBlock(U){const X=this.attachedBlocks.indexOf(U);if(X>-1&&this.attachedBlocks.splice(X,1),U.isSystem){const X=this._systemBlocks.indexOf(U);X>-1&&this._systemBlocks.splice(X,1)}}parseSerializedObject(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];X||this.clear();const b={};for(const F of U.jS){const U=(0,z.c)(F.customType);if(U){const X=new U;X._deserialize(F),b[F.id]=X,this.attachedBlocks.push(X),X.isSystem&&this._systemBlocks.push(X)}}for(const F of this.attachedBlocks)if(F.isTeleportOut){const U=F,X=U._tempEntryPointUniqueId;if(X){const F=b[X];F&&F.attachToEndpoint(U)}}for(let F=0;F<U.jS.length;F++){const E=U.jS[F],w=b[E.id];w&&(w.inputs.length&&E.inputs.some((U=>U.targetConnectionName))&&!X||this._restoreConnections(w,U,b))}if(U.locations||U.editorData&&U.editorData.locations){const F=U.locations||U.editorData.locations;for(const U of F)b[U.Nw]&&(U.Nw=b[U.Nw].uniqueId);X&&this.editorData&&this.editorData.locations&&F.concat(this.editorData.locations),U.locations?this.editorData={locations:F}:(this.editorData=U.editorData,this.editorData.locations=F);const E=[];for(const U in b)E[U]=b[U].uniqueId;this.editorData.map=E}this.comment=U.comment}_restoreConnections(U,X,b){for(const F of U.outputs)for(const E of X.jS){const w=b[E.id];if(w)for(const Q of E.inputs)if(b[Q.targetBlockId]!==U||Q.targetConnectionName!==F.name);else{const U=w.getInputByName(Q.inputName);if(!U||U.isConnected)continue;F.connectTo(U,!0),this._restoreConnections(w,X,b)}}}serialize(U){const X=U?{}:h.d.Serialize(this);X.editorData=JSON.parse(JSON.stringify(this.editorData));let b=[];U?b=U:X.customType="BABYLON.NodeParticleSystemSet",X.jS=[];for(const F of b)X.jS.push(F.serialize());if(!U)for(const F of this.attachedBlocks)-1===b.indexOf(F)&&X.jS.push(F.serialize());return X}dispose(){for(const U of this.attachedBlocks)U.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(U){const X=new Eb(U);return X.setToDefault(),X}static Parse(U){const X=h.d.Parse((()=>new Eb(U.name)),U,null);return X.parseSerializedObject(U),X}static ParseFromSnippetAsync(U,X){return"_BLANK"===U?Promise.resolve(Eb.CreateDefault("blank")):new Promise(((b,F)=>{const E=new jX.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const Q=JSON.parse(JSON.parse(E.responseText).jsonPayload),z=JSON.parse(Q.nodeParticle);X||(X=h.d.Parse((()=>new Eb(U)),z,null)),X.parseSerializedObject(z),X.snippetId=U;try{b(X)}catch(w){F(w)}}else F("Unable to load the snippet "+U)})),E.open("GET",this.SnippetUrl+"/"+U.replace(/#/g,"/")),E.send()}))}}Eb.EditorURL=`${uX.Tools._DefaultCdnUrl}/v${cU.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Eb.SnippetUrl="https://snippet.babylonjs.com",(0,A.c)([(0,s.J)()],Eb.prototype,"name",void 0),(0,A.c)([(0,s.J)("comment")],Eb.prototype,"comment",void 0),function(U){U[U.None=0]="None",U[U.PerParticle=1]="PerParticle",U[U.PerSystem=2]="PerSystem"}(LX||(LX={}));class wb extends ZX{constructor(U){super(U),this._currentLockId=-2,this.lockMode=LX.PerParticle,this.registerInput("min",yX.AutoDetect,!0,0),this.registerInput("max",yX.AutoDetect,!0,1),this.registerOutput("output",yX.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(yX.Float|yX.Int|yX.Vector2|yX.JX|yX.eb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(yX.Float|yX.Int|yX.Vector2|yX.JX|yX.eb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=yX.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let U=null;switch(this._currentLockId=-2,this.min.type){case yX.AutoDetect:case yX.Int:case yX.Float:U=U=>{const X=this.min.getConnectedValue(U)||0,b=this.max.getConnectedValue(U)||1;return X+Math.random()*(b-X)};break;case yX.Vector2:U=U=>{const X=this.min.getConnectedValue(U)||F.Vector2.Zero(),b=this.max.getConnectedValue(U)||F.Vector2.One();return new F.Vector2(X.x+Math.random()*(b.x-X.x),X.y+Math.random()*(b.y-X.y))};break;case yX.JX:U=U=>{const X=this.min.getConnectedValue(U)||F.JX.Zero(),b=this.max.getConnectedValue(U)||F.JX.One();return new F.JX(X.x+Math.random()*(b.x-X.x),X.y+Math.random()*(b.y-X.y),X.z+Math.random()*(b.z-X.z))};break;case yX.eb:U=U=>{const X=this.min.getConnectedValue(U)||new Q.eb(0,0,0,0),b=this.max.getConnectedValue(U)||new Q.eb(1,1,1,1);return new Q.eb(X.x+Math.random()*(b.x-X.x),X.y+Math.random()*(b.y-X.y),X.z+Math.random()*(b.z-X.z),X.w+Math.random()*(b.w-X.w))}}this.output._storedFunction=X=>{var b;let F=0;switch(this.lockMode){case LX.PerParticle:F=(null===(b=X.particleContext)||void 0===b?void 0:b.id)||-1;break;case LX.PerSystem:F=X.buildId||0}return this._currentLockId!==F&&(this.lockMode!==LX.None&&(this._currentLockId=F),this.output._storedValue=U(X)),this.output._storedValue}}serialize(){const U=super.serialize();return U.lockMode=this.lockMode,U}_deserialize(U){super._deserialize(U),this.lockMode=U.lockMode}}(0,A.c)([cX("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:LX.None},{label:"Per particle",value:LX.PerParticle},{label:"Per system",value:LX.PerSystem}]})],wb.prototype,"lockMode",void 0),(0,z.f)("BABYLON.ParticleRandomBlock",wb);class Qb extends ZX{constructor(U){super(U),this._currentLockId=-2,this.lockMode=LX.PerParticle,this.registerInput("min",yX.AutoDetect),this.registerInput("max",yX.AutoDetect),this.registerOutput("output",yX.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const X=[yX.Matrix,yX.Particle,yX.Texture,yX.System,yX.FloatGradient,yX.Color4Gradient,yX.Vector2Gradient,yX.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...X),this.max.excludedConnectionPointTypes.push(...X)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let U=null;switch(this._currentLockId=-2,this.min.type){case yX.Float:case yX.Int:U=U=>{const X=this.min.getConnectedValue(U),b=this.max.getConnectedValue(U);return Math.random()*(b-X)+X};break;case yX.Vector2:U=U=>{const X=this.min.getConnectedValue(U),b=this.max.getConnectedValue(U);return new F.Vector2(Math.random()*(b.x-X.x)+X.x,Math.random()*(b.y-X.y)+X.y)};break;case yX.JX:U=U=>{const X=this.min.getConnectedValue(U),b=this.max.getConnectedValue(U);return new F.JX(Math.random()*(b.x-X.x)+X.x,Math.random()*(b.y-X.y)+X.y,Math.random()*(b.z-X.z)+X.z)};break;case yX.eb:U=U=>{const X=this.min.getConnectedValue(U),b=this.max.getConnectedValue(U);return new Q.eb(Math.random()*(b.r-X.r)+X.r,Math.random()*(b.g-X.g)+X.g,Math.random()*(b.b-X.b)+X.b,Math.random()*(b.a-X.a)+X.a)}}this.output._storedFunction=X=>{var b;let F=0;switch(this.lockMode){case LX.PerParticle:F=(null===(b=X.particleContext)||void 0===b?void 0:b.id)||-1;break;case LX.PerSystem:F=X.buildId||0}return this._currentLockId!==F&&(this.lockMode!==LX.None&&(this._currentLockId=F),this.output._storedValue=U(X)),this.output._storedValue}}serialize(){const U=super.serialize();return U.lockMode=this.lockMode,U}_deserialize(U){super._deserialize(U),void 0!==U.lockMode&&(this.lockMode=U.lockMode)}}(0,A.c)([cX("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:LX.None},{label:"Per particle",value:LX.PerParticle},{label:"Per system",value:LX.PerSystem}]})],Qb.prototype,"lockMode",void 0),(0,z.f)("BABYLON.RandomRangeBlock",Qb);(0,z.f)("BABYLON.ParticleLerpBlock",class extends ZX{constructor(U){super(U),this.registerInput("left",yX.AutoDetect),this.registerInput("right",yX.AutoDetect),this.registerInput("gradient",yX.Float,!0,0,0,1),this.registerOutput("output",yX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(yX.Float|yX.Int|yX.Vector2|yX.JX|yX.eb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const U=(U,X,b)=>(1-U)*X+U*b;this.output._storedFunction=X=>{const b=this.left.getConnectedValue(X),E=this.right.getConnectedValue(X),w=this.gradient.getConnectedValue(X);switch(this.left.type){case yX.Int:case yX.Float:return U(w,b,E);case yX.Vector2:return new F.Vector2(U(w,b.x,E.x),U(w,b.y,E.y));case yX.JX:return new F.JX(U(w,b.x,E.x),U(w,b.y,E.y),U(w,b.z,E.z));case yX.eb:return new Q.eb(U(w,b.r,E.r),U(w,b.g,E.g),U(w,b.b,E.b),U(w,b.a,E.a))}return 0}}});(0,z.f)("BABYLON.UpdateDirectionBlock",class extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerInput("direction",yX.JX),this.registerOutput("output",yX.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(U){const X=this.particle.getConnectedValue(U);if(this.output._storedValue=X,!this.direction.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=X,b.direction.q(this.direction.getConnectedValue(U))},previousItem:null,nextItem:null};X._updateQueueStart?VU(b,X._updateQueueStart):X._updateQueueStart=b}});(0,z.f)("BABYLON.UpdateColorBlock",class extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerInput("color",yX.eb),this.registerOutput("output",yX.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(U){const X=this.particle.getConnectedValue(U);if(this.output._storedValue=X,!this.color.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=X,b.color.q(this.color.getConnectedValue(U))},previousItem:null,nextItem:null};X._updateQueueStart?VU(b,X._updateQueueStart):X._updateQueueStart=b}});(0,z.f)("BABYLON.UpdateScaleBlock",class extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerInput("scale",yX.Vector2),this.registerOutput("output",yX.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(U){const X=this.particle.getConnectedValue(U);if(this.output._storedValue=X,!this.scale.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=X,b.scale.q(this.scale.getConnectedValue(U))},previousItem:null,nextItem:null};X._updateQueueStart?VU(b,X._updateQueueStart):X._updateQueueStart=b}});(0,z.f)("BABYLON.UpdateAngleBlock",class extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerInput("angle",yX.Float),this.registerOutput("output",yX.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(U){const X=this.particle.getConnectedValue(U);if(this.output._storedValue=X,!this.angle.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=X,b.angle=this.angle.getConnectedValue(U)},previousItem:null,nextItem:null};X._updateQueueStart?VU(b,X._updateQueueStart):X._updateQueueStart=b}});(0,z.f)("BABYLON.BasicPositionUpdateBlock",class extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerOutput("output",yX.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(U){const X=this.particle.getConnectedValue(U),b={process:b=>{U.particleContext=b,U.systemContext=X,b.direction.scaleToRef(X._directionScale,X._scaledDirection),b.position.addInPlace(X._scaledDirection)},previousItem:null,nextItem:null};X._updateQueueStart?VU(b,X._updateQueueStart):X._updateQueueStart=b,this.output._storedValue=X}});(0,z.f)("BABYLON.BasicSpriteUpdateBlock",class extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerOutput("output",yX.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(U){const X=this.particle.getConnectedValue(U),b={process:b=>{U.particleContext=b,U.systemContext=X,b.updateCellIndex()},previousItem:null,nextItem:null};X._updateQueueStart?VU(b,X._updateQueueStart):X._updateQueueStart=b,this.output._storedValue=X}});(0,z.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerInput("cellIndex",yX.Int),this.registerOutput("output",yX.Particle),this.cellIndex.acceptedConnectionPointTypes=[yX.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(U){const X=this.particle.getConnectedValue(U);if(this.output._storedValue=X,!this.cellIndex.isConnected)return;const b={process:b=>{U.particleContext=b,U.systemContext=X,b.cellIndex=Math.floor(this.cellIndex.getConnectedValue(U))},previousItem:null,nextItem:null};X._updateQueueStart?VU(b,X._updateQueueStart):X._updateQueueStart=b}});class zb extends ZX{constructor(U){super(U),this.strength=1,this.registerInput("particle",yX.Particle),this.registerInput("flowMap",yX.Texture),this.registerOutput("output",yX.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(U){var X;const b=this.particle.getConnectedValue(U),F=U.xX;let E;(null===(X=this.flowMap.connectedPoint)||void 0===X?void 0:X.ownerBlock).extractTextureContentAsync().then((U=>{U&&(E=new oX(U.width,U.height,U.data))}));const w={process:U=>{const X=F.getTransformMatrix();E&&E._processParticle(U,this.strength*b._tempScaledUpdateSpeed,X)},previousItem:null,nextItem:null};b._updateQueueStart?VU(w,b._updateQueueStart):b._updateQueueStart=w,this.output._storedValue=b}serialize(){const U=super.serialize();return U.strength=this.strength,U}_deserialize(U){super._deserialize(U),this.strength=U.strength}}(0,A.c)([cX("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zb.prototype,"strength",void 0),(0,z.f)("BABYLON.UpdateFlowMapBlock",zb);(0,z.f)("BABYLON.SphereShapeBlock",class extends ZX{constructor(U){super(U),this.registerInput("input",yX.Particle),this.registerInput("radius",yX.Float,!0,1),this.registerInput("radiusRange",yX.Float,!0,1,0,1),this.registerInput("directionRandomizer",yX.Float,!0,0,0,1),this.registerOutput("output",yX.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(U){const X=this.input.getConnectedValue(U);X._directionCreation.process=b=>{U.particleContext=b,U.systemContext=X;const E=this.directionRandomizer.getConnectedValue(U),w=b.position.mX(U.emitterPosition).normalize(),Q=(0,p.RandomRange)(0,E),z=(0,p.RandomRange)(0,E),q=(0,p.RandomRange)(0,E);w.x+=Q,w.y+=z,w.z+=q,w.normalize(),U.isEmitterTransformNode?F.JX.TransformNormalFromFloatsToRef(Q,z,q,U.emitterWorldMatrix,b.direction):b.direction.Pb(Q,z,q)},X._positionCreation.process=b=>{U.particleContext=b,U.systemContext=X;const E=this.radius.getConnectedValue(U),w=this.radiusRange.getConnectedValue(U),Q=E-(0,p.RandomRange)(0,E*w),z=(0,p.RandomRange)(0,1),q=(0,p.RandomRange)(0,2*Math.PI),S=Math.acos(2*z-1),R=Q*Math.cos(q)*Math.sin(S),n=Q*Math.cos(S),a=Q*Math.sin(q)*Math.sin(S);U.isEmitterTransformNode?F.JX.TransformCoordinatesFromFloatsToRef(R,n,a,U.emitterWorldMatrix,b.position):(b.position.Pb(R,n,a),b.position.addInPlace(U.emitterPosition))},this.output._storedValue=X}});(0,z.f)("BABYLON.PointShapeBlock",class extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerInput("direction1",yX.JX,!0,new F.JX(0,1,0)),this.registerInput("direction2",yX.JX,!0,new F.JX(0,1,0)),this.registerOutput("output",yX.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){const X=this.particle.getConnectedValue(U);X._directionCreation.process=b=>{U.particleContext=b,U.systemContext=X;const E=this.direction1.getConnectedValue(U),w=this.direction2.getConnectedValue(U),Q=(0,p.RandomRange)(E.x,w.x),z=(0,p.RandomRange)(E.y,w.y),q=(0,p.RandomRange)(E.z,w.z);U.isEmitterTransformNode?F.JX.TransformNormalFromFloatsToRef(Q,z,q,U.emitterWorldMatrix,b.direction):b.direction.Pb(Q,z,q)},X._positionCreation.process=b=>{U.systemContext=X,U.isEmitterTransformNode?F.JX.TransformCoordinatesFromFloatsToRef(0,0,0,U.emitterWorldMatrix,b.position):b.position.q(U.emitterPosition)},this.output._storedValue=X}});(0,z.f)("BABYLON.CustomShapeBlock",class extends ZX{constructor(U){super(U),this.registerInput("particle",yX.Particle),this.registerInput("position",yX.JX,!0,new F.JX(0,0,0)),this.registerInput("direction",yX.JX,!0,new F.JX(0,1,0)),this.registerOutput("output",yX.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){const X=this.particle.getConnectedValue(U);X._directionCreation.process=b=>{U.particleContext=b,U.systemContext=X;const E=this.direction.getConnectedValue(U);U.isEmitterTransformNode?F.JX.TransformNormalToRef(E,U.emitterWorldMatrix,b.direction):b.direction.q(E)},X._positionCreation.process=b=>{U.particleContext=b,U.systemContext=X;const E=this.position.getConnectedValue(U);U.isEmitterTransformNode?F.JX.TransformCoordinatesToRef(E,U.emitterWorldMatrix,b.position):(b.position.q(E),b.position.addInPlace(U.emitterPosition))},this.output._storedValue=X}});(0,z.f)("BABYLON.CylinderShapeBlock",class extends ZX{constructor(U){super(U),this._tempVector=F.JX.Zero(),this.registerInput("particle",yX.Particle),this.registerInput("radius",yX.Float,!0,1),this.registerInput("height",yX.Float,!0,1,0),this.registerInput("radiusRange",yX.Float,!0,1,0,1),this.registerInput("directionRandomizer",yX.Float,!0,0,0,1),this.registerOutput("output",yX.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(U){const X=this.particle.getConnectedValue(U);X._directionCreation.process=b=>{U.particleContext=b,U.systemContext=X;const E=this.directionRandomizer.getConnectedValue(U);b.position.subtractToRef(U.emitterPosition,this._tempVector),this._tempVector.normalize(),U.isEmitterTransformNode&&F.JX.TransformNormalToRef(this._tempVector,U.emitterInverseWorldMatrix,this._tempVector);const w=(0,p.RandomRange)(-E/2,E/2);let Q=Math.atan2(this._tempVector.x,this._tempVector.z);Q+=(0,p.RandomRange)(-Math.PI/2,Math.PI/2)*E,this._tempVector.y=w,this._tempVector.x=Math.sin(Q),this._tempVector.z=Math.cos(Q),this._tempVector.normalize(),U.isEmitterTransformNode?F.JX.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,U.emitterWorldMatrix,b.direction):b.direction.q(this._tempVector)},X._positionCreation.process=b=>{U.particleContext=b,U.systemContext=X;const E=this.height.getConnectedValue(U),w=this.radiusRange.getConnectedValue(U),Q=this.radius.getConnectedValue(U),z=(0,p.RandomRange)(-E/2,E/2),q=(0,p.RandomRange)(0,2*Math.PI),S=(0,p.RandomRange)((1-w)*(1-w),1),R=Math.sqrt(S)*Q,n=R*Math.cos(q),a=R*Math.sin(q);U.isEmitterTransformNode?F.JX.TransformCoordinatesFromFloatsToRef(n,z,a,U.emitterWorldMatrix,b.position):(b.position.Pb(n,z,a),b.position.addInPlace(U.emitterPosition))},this.output._storedValue=X}});class qb extends ZX{constructor(U){super(U),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",yX.Particle),this.registerOutput("output",yX.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);const X=this.particle.getConnectedValue(U);X._isAnimationSheetEnabled=!0,X.spriteCellWidth=this.width,X.spriteCellHeight=this.height,X.startSpriteCellID=this.start,X.endSpriteCellID=this.end,X.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=X}serialize(){const U=super.serialize();return U.width=this.width,U.height=this.height,U.start=this.start,U.end=this.end,U.randomStartCell=this.randomStartCell,U}_deserialize(U){super._deserialize(U),this.width=U.width,this.height=U.height,this.start=U.start,this.end=U.end,this.randomStartCell=U.randomStartCell}}(0,A.c)([cX("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qb.prototype,"start",void 0),(0,A.c)([cX("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qb.prototype,"end",void 0),(0,A.c)([cX("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qb.prototype,"width",void 0),(0,A.c)([cX("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qb.prototype,"height",void 0),(0,A.c)([cX("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],qb.prototype,"loop",void 0),(0,A.c)([cX("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],qb.prototype,"randomStartCell",void 0),(0,z.f)("BABYLON.SetupSpriteSheetBlock",qb);class pb extends ZX{constructor(U){super(U),this.reference=0,this.registerInput("value",yX.AutoDetect),this.registerOutput("output",yX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=U=>{switch(U){case yX.Float:return yX.FloatGradient;case yX.Vector2:return yX.Vector2Gradient;case yX.JX:return yX.Vector3Gradient;case yX.eb:return yX.Color4Gradient}return U},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(yX.Float|yX.Vector2|yX.JX|yX.eb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=U=>null}serialize(){const U=super.serialize();return U.reference=this.reference,U}_deserialize(U){super._deserialize(U),this.reference=U.reference}}(0,A.c)([cX("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],pb.prototype,"reference",void 0),(0,z.f)("BABYLON.ParticleGradientValueBlock",pb);(0,z.f)("BABYLON.ParticleGradientBlock",class extends ZX{constructor(U){super(U),this._entryCount=1,this.registerInput("gradient",yX.Float,!0,1,0,1),this.registerInput("value0",yX.AutoDetect),this.registerOutput("output",yX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=U=>{switch(U){case yX.FloatGradient:return yX.Float;case yX.Vector2Gradient:return yX.Vector2;case yX.Vector3Gradient:return yX.JX;case yX.Color4Gradient:return yX.eb}return U},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(yX.FloatGradient|yX.Vector2Gradient|yX.Vector3Gradient|yX.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(U){this._inputs[U].onConnectionObservable.add((()=>{this._entryCount>U||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),yX.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const U=[];for(let b=1;b<this._inputs.length;b++){var X;if(this._inputs[b].isConnected)U.push(null===(X=this._inputs[b].connectedPoint)||void 0===X?void 0:X.ownerBlock)}U.sort(((U,X)=>U.reference-X.reference)),this.output._storedFunction=X=>{const b=this.gradient.getConnectedValue(X);if(1===U.length)return U[0].value.getConnectedValue(X);let E=null;for(let w=U.length-1;w>=0;w--){const z=U[w];if(z.reference<=b){const U=z.value.getConnectedValue(X);if(E){const w=E.value.getConnectedValue(X),q=E.reference,S=z.reference,R=Math.max(0,Math.min(1,(b-S)/(q-S)));switch(this.output.type){case yX.Float:return(0,p.Lerp)(U,w,R);case yX.Vector2:return F.Vector2.Lerp(U,w,R);case yX.JX:return F.JX.Lerp(U,w,R);case yX.eb:return Q.eb.Lerp(U,w,R)}}return U}E=z}return 0}}});(0,z.f)("BABYLON.ParticleConverterBlock",class extends ZX{constructor(U){super(U),this.registerInput("color ",yX.eb,!0),this.registerInput("xyz ",yX.JX,!0),this.registerInput("xy ",yX.Vector2,!0),this.registerInput("zw ",yX.Vector2,!0),this.registerInput("x ",yX.Float,!0),this.registerInput("y ",yX.Float,!0),this.registerInput("z ",yX.Float,!0),this.registerInput("w ",yX.Float,!0),this.registerOutput("color",yX.eb),this.registerOutput("xyz",yX.JX),this.registerOutput("xy",yX.Vector2),this.registerOutput("zw",yX.Vector2),this.registerOutput("x",yX.Float),this.registerOutput("y",yX.Float),this.registerOutput("z",yX.Float),this.registerOutput("w",yX.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(U){return"color "===U?"colorIn":"xyz "===U?"xyzIn":"xy "===U?"xyIn":"zw "===U?"zwIn":"x "===U?"xIn":"y "===U?"yIn":"z "===U?"zIn":"w "===U?"wIn":U}_outputRename(U){switch(U){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return U}}_build(U){super._build(U);const X=this.xIn,b=this.yIn,E=this.zIn,w=this.wIn,z=this.xyIn,q=this.zwIn,p=this.xyzIn,S=this.colorIn,R=this.colorOut,n=this.xyzOut,a=this.xyOut,J=this.zwOut,m=this.xOut,x=this.yOut,I=this.zOut,O=this.wOut,N=U=>{if(S.isConnected)return S.getConnectedValue(U);let F=0,R=0,n=0,a=0;if(X.isConnected&&(F=X.getConnectedValue(U)),b.isConnected&&(R=b.getConnectedValue(U)),E.isConnected&&(n=E.getConnectedValue(U)),w.isConnected&&(a=w.getConnectedValue(U)),z.isConnected){const X=z.getConnectedValue(U);X&&(F=X.x,R=X.y)}if(q.isConnected){const X=q.getConnectedValue(U);X&&(n=X.x,a=X.y)}if(p.isConnected){const X=p.getConnectedValue(U);X&&(F=X.x,R=X.y,n=X.z)}return new Q.eb(F,R,n,a)};R._storedFunction=U=>N(U),n._storedFunction=U=>{const X=N(U);return new F.JX(X.r,X.g,X.b)},a._storedFunction=U=>{const X=N(U);return new F.Vector2(X.r,X.g)},J._storedFunction=U=>{const X=N(U);return new F.Vector2(X.b,X.a)},m._storedFunction=U=>N(U).r,x._storedFunction=U=>N(U).g,I._storedFunction=U=>N(U).b,O._storedFunction=U=>N(U).a}}),function(U){U[U.Cos=0]="Cos",U[U.Sin=1]="Sin",U[U.Abs=2]="Abs",U[U.Exp=3]="Exp",U[U.Exp2=4]="Exp2",U[U.Round=5]="Round",U[U.Floor=6]="Floor",U[U.Ceiling=7]="Ceiling",U[U.Sqrt=8]="Sqrt",U[U.Log=9]="Log",U[U.Tan=10]="Tan",U[U.ArcTan=11]="ArcTan",U[U.ArcCos=12]="ArcCos",U[U.ArcSin=13]="ArcSin",U[U.Sign=14]="Sign",U[U.Negate=15]="Negate",U[U.OneMinus=16]="OneMinus",U[U.Reciprocal=17]="Reciprocal",U[U.ToDegrees=18]="ToDegrees",U[U.ToRadians=19]="ToRadians",U[U.Fract=20]="Fract"}(DX||(DX={}));class Sb extends ZX{constructor(U){super(U),this.operation=DX.Cos,this.registerInput("input",yX.AutoDetect),this.registerOutput("output",yX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(yX.Float|yX.Int|yX.Vector2|yX.JX|yX.eb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);let X=null;switch(this.operation){case DX.Cos:X=U=>Math.cos(U);break;case DX.Sin:X=U=>Math.sin(U);break;case DX.Abs:X=U=>Math.abs(U);break;case DX.Exp:X=U=>Math.exp(U);break;case DX.Exp2:X=U=>Math.pow(2,U);break;case DX.Round:X=U=>Math.round(U);break;case DX.Floor:X=U=>Math.floor(U);break;case DX.Ceiling:X=U=>Math.ceil(U);break;case DX.Sqrt:X=U=>Math.sqrt(U);break;case DX.Log:X=U=>Math.log(U);break;case DX.Tan:X=U=>Math.tan(U);break;case DX.ArcTan:X=U=>Math.atan(U);break;case DX.ArcCos:X=U=>Math.acos(U);break;case DX.ArcSin:X=U=>Math.asin(U);break;case DX.Sign:X=U=>Math.sign(U);break;case DX.Negate:X=U=>-U;break;case DX.OneMinus:X=U=>1-U;break;case DX.Reciprocal:X=U=>1/U;break;case DX.ToRadians:X=U=>U*Math.PI/180;break;case DX.ToDegrees:X=U=>180*U/Math.PI;break;case DX.Fract:X=U=>U>=0?U-Math.floor(U):U-Math.ceil(U)}if(!X)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case yX.Int:case yX.Float:this.output._storedFunction=U=>{const b=this.input.getConnectedValue(U);return X(b)};break;case yX.Vector2:this.output._storedFunction=U=>{const b=this.input.getConnectedValue(U);return new F.Vector2(X(b.x),X(b.y))};break;case yX.JX:this.output._storedFunction=U=>{const b=this.input.getConnectedValue(U);return new F.JX(X(b.x),X(b.y),X(b.z))};break;case yX.eb:this.output._storedFunction=U=>{const b=this.input.getConnectedValue(U);return new Q.eb(X(b.r),X(b.g),X(b.b),X(b.a))}}return this}serialize(){const U=super.serialize();return U.operation=this.operation,U}_deserialize(U){super._deserialize(U),this.operation=U.operation}}(0,A.c)([cX("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:DX.Cos},{label:"Sin",value:DX.Sin},{label:"Abs",value:DX.Abs},{label:"Exp",value:DX.Exp},{label:"Exp2",value:DX.Exp2},{label:"Round",value:DX.Round},{label:"Floor",value:DX.Floor},{label:"Ceiling",value:DX.Ceiling},{label:"Sqrt",value:DX.Sqrt},{label:"Log",value:DX.Log},{label:"Tan",value:DX.Tan},{label:"ArcTan",value:DX.ArcTan},{label:"ArcCos",value:DX.ArcCos},{label:"ArcSin",value:DX.ArcSin},{label:"Sign",value:DX.Sign},{label:"Negate",value:DX.Negate},{label:"OneMinus",value:DX.OneMinus},{label:"Reciprocal",value:DX.Reciprocal},{label:"ToDegrees",value:DX.ToDegrees},{label:"ToRadians",value:DX.ToRadians},{label:"Fract",value:DX.Fract}]})],Sb.prototype,"operation",void 0),(0,z.f)("BABYLON.ParticleTrigonometryBlock",Sb);var Rb,nb=b(12976);class ab extends ZX{constructor(U){super(U),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",yX.AutoDetect),this.registerOutput("output",yX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(yX.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(yX.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(yX.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(yX.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(yX.System),this._inputs[0].excludedConnectionPointTypes.push(yX.Particle),this._inputs[0].excludedConnectionPointTypes.push(yX.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const X=U=>{const X=this.input.getConnectedValue(U);if(this.log.length>=this.stackSize)return X;if(null===X||void 0===X)return this.log.push(["null",""]),X;switch(this.input.type){case yX.Vector2:this.log.push([(0,nb.e)(X,4),X.toString()]);break;case yX.JX:this.log.push([(0,nb.f)(X,4),X.toString()]);break;case yX.eb:this.log.push([`{R: ${X.r.toFixed(4)} G: ${X.g.toFixed(4)} B: ${X.b.toFixed(4)} A: ${X.a.toFixed(4)}}`,X.toString()]);break;default:this.log.push([X.toString(),X.toString()])}return X};this.output.isConnected?this.output._storedFunction=X:this.output._storedValue=X(U)}serialize(){const U=super.serialize();return U.stackSize=this.stackSize,U}_deserialize(U){super._deserialize(U),this.stackSize=U.stackSize}}(0,A.c)([cX("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],ab.prototype,"stackSize",void 0),(0,z.f)("BABYLON.ParticleDebugBlock",ab);(0,z.f)("BABYLON.ParticleElbowBlock",class extends ZX{constructor(U){super(U),this.registerInput("input",yX.AutoDetect),this.registerOutput("output",yX.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(U){super._build(U);const X=this._outputs[0],b=this._inputs[0];X._storedFunction=U=>b.getConnectedValue(U)}});(0,z.f)("BABYLON.ParticleTeleportInBlock",class extends ZX{get endpoints(){return this._endpoints}constructor(U){super(U),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",yX.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(U){if(this.getClassName()===U)return!0;for(const X of this.endpoints)if(X.isAnAncestorOfType(U))return!0;return!1}isAnAncestorOf(U){for(const X of this.endpoints){if(X===U)return!0;if(X.isAnAncestorOf(U))return!0}return!1}attachToEndpoint(U){U.detach(),this._endpoints.push(U),U._entryPoint=this,U._outputs[0]._typeConnectionSource=this._inputs[0],U._tempEntryPointUniqueId=null,U.name="> "+this.name}detachFromEndpoint(U){const X=this._endpoints.indexOf(U);-1!==X&&(this._endpoints.splice(X,1),U._outputs[0]._typeConnectionSource=null,U._entryPoint=null)}_build(){for(const U of this._endpoints)U.output._storedFunction=U=>this.input.getConnectedValue(U)}});(0,z.f)("BABYLON.ParticleTeleportOutBlock",class extends ZX{constructor(U){super(U),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",yX.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(U){this.entryPoint&&this.entryPoint.build(U)}clone(){const U=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(U),U}serialize(){var U;const X=super.serialize();return X.entryPoint=(null===(U=this.entryPoint)||void 0===U?void 0:U.uniqueId)??"",X}_deserialize(U){super._deserialize(U),this._tempEntryPointUniqueId=U.entryPoint}}),function(U){U[U.Equal=0]="Equal",U[U.NotEqual=1]="NotEqual",U[U.LessThan=2]="LessThan",U[U.GreaterThan=3]="GreaterThan",U[U.LessOrEqual=4]="LessOrEqual",U[U.GreaterOrEqual=5]="GreaterOrEqual",U[U.Xor=6]="Xor",U[U.Or=7]="Or",U[U.And=8]="And"}(Rb||(Rb={}));class Jb extends ZX{constructor(U){super(U),this.test=Rb.Equal,this.epsilon=0,this.registerInput("left",yX.Float),this.registerInput("right",yX.Float,!0,0),this.registerInput("ifTrue",yX.AutoDetect,!0,1),this.registerInput("ifFalse",yX.AutoDetect,!0,0),this.registerOutput("output",yX.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=yX.Float,this._inputs[0].acceptedConnectionPointTypes.push(yX.Int),this._inputs[1].acceptedConnectionPointTypes.push(yX.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const U=U=>{const X=this.left.getConnectedValue(U),b=this.right.getConnectedValue(U);let F=!1;switch(this.test){case Rb.Equal:F=(0,p.WithinEpsilon)(X,b,this.epsilon);break;case Rb.NotEqual:F=!(0,p.WithinEpsilon)(X,b,this.epsilon);break;case Rb.LessThan:F=X<b+this.epsilon;break;case Rb.GreaterThan:F=X>b-this.epsilon;break;case Rb.LessOrEqual:F=X<=b+this.epsilon;break;case Rb.GreaterOrEqual:F=X>=b-this.epsilon;break;case Rb.Xor:F=!!X&&!b||!X&&!!b;break;case Rb.Or:F=!!X||!!b;break;case Rb.And:F=!!X&&!!b}return F};this.output._storedFunction=X=>U(X)?this.ifTrue.getConnectedValue(X):this.ifFalse.getConnectedValue(X)}serialize(){const U=super.serialize();return U.test=this.test,U.epsilon=this.epsilon,U}_deserialize(U){super._deserialize(U),this.test=U.test,void 0!==U.epsilon&&(this.epsilon=U.epsilon)}}(0,A.c)([cX("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Rb.Equal},{label:"NotEqual",value:Rb.NotEqual},{label:"LessThan",value:Rb.LessThan},{label:"GreaterThan",value:Rb.GreaterThan},{label:"LessOrEqual",value:Rb.LessOrEqual},{label:"GreaterOrEqual",value:Rb.GreaterOrEqual},{label:"Xor",value:Rb.Xor},{label:"Or",value:Rb.Or},{label:"And",value:Rb.And}]})],Jb.prototype,"test",void 0),(0,A.c)([cX("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Jb.prototype,"epsilon",void 0),(0,z.f)("BABYLON.ParticleConditionBlock",Jb);class mb extends ZX{constructor(U){super(U),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",yX.Particle),this.registerInput("condition",yX.Float,!0,0),this.registerInput("system",yX.System),this.registerOutput("output",yX.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(U){this._triggerCount=0;const X=this.input.getConnectedValue(U),b={process:b=>{if(U.particleContext=b,U.systemContext=X,0!==this.condition.getConnectedValue(U)&&(0===this.limit||this._triggerCount<this.limit)){const F=(new Date).getTime();if(this._previousOne&&F-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=F;const E=this.system.getConnectedValue(U);if(E){const F=MX(E,U.xX,b.position);F.wb.addOnce((()=>{this._triggerCount--})),X.wb.addOnce((()=>{F.dispose()}))}}},previousItem:null,nextItem:null};X._updateQueueStart?VU(b,X._updateQueueStart):X._updateQueueStart=b,this.output._storedValue=X}serialize(){const U=super.serialize();return U.limit=this.limit,U.delay=this.delay,U}_deserialize(U){super._deserialize(U),void 0!==U.limit&&(this.limit=U.limit),void 0!==U.delay&&(this.delay=U.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,A.c)([cX("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mb.prototype,"limit",void 0),(0,A.c)([cX("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],mb.prototype,"delay",void 0),(0,z.f)("BABYLON.ParticleTriggerBlock",mb);b(12980),b(12984),b(12999),b(13041)},13027:(U,X,b)=>{"use strict";var F=b(11499);const E="clipPlaneFragment",w="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13004:(U,X,b)=>{"use strict";var F=b(11499);const E="clipPlaneFragmentDeclaration",w="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13060:(U,X,b)=>{"use strict";var F=b(11499);const E="clipPlaneVertex",w="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13048:(U,X,b)=>{"use strict";var F=b(11499);const E="clipPlaneVertexDeclaration",w="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13032:(U,X,b)=>{"use strict";var F=b(11499);const E="fogFragment",w="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13025:(U,X,b)=>{"use strict";var F=b(11499);const E="fogFragmentDeclaration",w="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13068:(U,X,b)=>{"use strict";var F=b(11499);const E="fogVertex",w="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13055:(U,X,b)=>{"use strict";var F=b(11499);const E="fogVertexDeclaration",w="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13016:(U,X,b)=>{"use strict";var F=b(11499);const E="helperFunctions",w="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13008:(U,X,b)=>{"use strict";var F=b(11499);const E="imageProcessingDeclaration",w="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13023:(U,X,b)=>{"use strict";var F=b(11499);const E="imageProcessingFunctions",w="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13012:(U,X,b)=>{"use strict";var F=b(11499);const E="logDepthDeclaration",w="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13029:(U,X,b)=>{"use strict";var F=b(11499);const E="logDepthFragment",w="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},13072:(U,X,b)=>{"use strict";var F=b(11499);const E="logDepthVertex",w="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";F.c.IncludesShadersStoreWGSL[E]||(F.c.IncludesShadersStoreWGSL[E]=w)},12999:(U,X,b)=>{"use strict";b.r(X),b.d(X,{particlesPixelShaderWGSL:()=>Q});var F=b(11499);b(13004),b(13008),b(13012),b(13016),b(13023),b(13025),b(13027),b(13029),b(13032);const E="particlesPixelShader",w="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";F.c.ShadersStoreWGSL[E]||(F.c.ShadersStoreWGSL[E]=w);const Q={name:E,shader:w}},13041:(U,X,b)=>{"use strict";b.r(X),b.d(X,{particlesVertexShaderWGSL:()=>Q});var F=b(11499);b(13048),b(13055),b(13012),b(13060),b(13068),b(13072);const E="particlesVertexShader",w="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";F.c.ShadersStoreWGSL[E]||(F.c.ShadersStoreWGSL[E]=w);const Q={name:E,shader:w}},12922:(U,X,b)=>{"use strict";var F=b(11499);const E="clipPlaneFragment",w="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12982:(U,X,b)=>{"use strict";var F=b(11499);const E="clipPlaneFragmentDeclaration",w="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12937:(U,X,b)=>{"use strict";var F=b(11499);const E="clipPlaneVertex",w="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12993:(U,X,b)=>{"use strict";var F=b(11499);const E="clipPlaneVertexDeclaration",w="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12929:(U,X,b)=>{"use strict";var F=b(11499);const E="fogFragment",w="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12916:(U,X,b)=>{"use strict";var F=b(11499);const E="fogFragmentDeclaration",w="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12943:(U,X,b)=>{"use strict";var F=b(11499);const E="fogVertex",w="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12935:(U,X,b)=>{"use strict";var F=b(11499);const E="fogVertexDeclaration",w="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12902:(U,X,b)=>{"use strict";var F=b(11499);const E="helperFunctions",w="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12888:(U,X,b)=>{"use strict";var F=b(11499);const E="imageProcessingDeclaration",w="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12911:(U,X,b)=>{"use strict";var F=b(11499);const E="imageProcessingFunctions",w="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12894:(U,X,b)=>{"use strict";var F=b(11499);const E="logDepthDeclaration",w="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12926:(U,X,b)=>{"use strict";var F=b(11499);const E="logDepthFragment",w="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12946:(U,X,b)=>{"use strict";var F=b(11499);const E="logDepthVertex",w="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";F.c.IncludesShadersStore[E]||(F.c.IncludesShadersStore[E]=w)},12980:(U,X,b)=>{"use strict";b.r(X),b.d(X,{particlesPixelShader:()=>Q});var F=b(11499);b(12982),b(12888),b(12894),b(12902),b(12911),b(12916),b(12922),b(12926),b(12929);const E="particlesPixelShader",w="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";F.c.ShadersStore[E]||(F.c.ShadersStore[E]=w);const Q={name:E,shader:w}},12984:(U,X,b)=>{"use strict";b.r(X),b.d(X,{particlesVertexShader:()=>Q});var F=b(11499);b(12993),b(12935),b(12894),b(12937),b(12943),b(12946);const E="particlesVertexShader",w="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";F.c.ShadersStore[E]||(F.c.ShadersStore[E]=w);const Q={name:E,shader:w}},13335:(U,X,b)=>{"use strict";b.r(X),b.d(X,{FlowGraphGLTFDataProvider:()=>w});var F=b(13308),E=b(13281);class w extends F.d{constructor(U){var X,b;super();const F=U.glTF,w=(null===(X=F.animations)||void 0===X?void 0:X.map((U=>U._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",E.b,w);const Q=(null===(b=F.nodes)||void 0===b?void 0:b.map((U=>U._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",E.b,Q)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13219:(U,X,b)=>{"use strict";b.d(X,{d:()=>x,g:()=>J,i:()=>a,l:()=>m});var F=b(11593),E=b(12104),w=b(11636),Q=b(13227);const z=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class q{constructor(U,X){this._gltf=U,this._infoTree=X}convert(U){let X,b=this._gltf,F=this._infoTree;if(!U.startsWith("/"))throw new Error("Path must start with a /");const E=U.split("/");if(E.shift(),E[E.length-1].includes(".length")){const U=E[E.length-1].split(".");E.pop(),E.push(...U)}let w=!1;for(const q of E){const E="length"===q;if(E&&!F.__array__)throw new Error(`Path ${U} is invalid`);if(F.__ignoreObjectTree__&&(w=!0),F.__array__&&!E)F=F.__array__;else if(F=F[q],!F)throw new Error(`Path ${U} is invalid`);if(!w)if(void 0===b){if(!z.find((X=>X.regex.test(U))))throw new Error(`Path ${U} is invalid`)}else if(!E){var Q;b=null===(Q=b)||void 0===Q?void 0:Q[q]}(F.__target__||E)&&(X=b)}return{object:X,info:F}}}function p(U,X,b,F){const E=S(U,X);return F?E[b][F]:E[b]}function S(U,X,b){var F,w;return null===(F=U._data)||void 0===F||null===(w=F[(null===b||void 0===b?void 0:b.fillMode)??E.e.MATERIAL_TriangleFillMode])||void 0===w?void 0:w.babylonMaterial}function R(U,X){return{offset:{componentsCount:2,type:"Vector2",get:(b,E,w)=>{const Q=p(b,w,U,X);return new F.Vector2(null===Q||void 0===Q?void 0:Q.uOffset,null===Q||void 0===Q?void 0:Q.vOffset)},getTarget:S,set:(b,F,E,w)=>{const Q=p(F,w,U,X);Q.uOffset=b.x,Q.vOffset=b.y},getPropertyName:[()=>`${U}${X?"."+X:""}.uOffset`,()=>`${U}${X?"."+X:""}.vOffset`]},rotation:{type:"number",get:(b,F,E)=>{var w;return null===(w=p(b,E,U,X))||void 0===w?void 0:w.wAng},getTarget:S,set:(b,F,E,w)=>p(F,w,U,X).wAng=b,getPropertyName:[()=>`${U}${X?"."+X:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(b,E,w)=>{const Q=p(b,w,U,X);return new F.Vector2(null===Q||void 0===Q?void 0:Q.uScale,null===Q||void 0===Q?void 0:Q.vScale)},getTarget:S,set:(b,F,E,w)=>{const Q=p(F,w,U,X);Q.uScale=b.x,Q.vScale=b.y},getPropertyName:[()=>`${U}${X?"."+X:""}.uScale`,()=>`${U}${X?"."+X:""}.vScale`]}}}const n={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:U=>{var X,b;return new F.Vector2((null===(X=U._babylonCamera)||void 0===X?void 0:X.orthoLeft)??0,(null===(b=U._babylonCamera)||void 0===b?void 0:b.orthoRight)??0)},set:(U,X)=>{X._babylonCamera&&(X._babylonCamera.orthoLeft=U.x,X._babylonCamera.orthoRight=U.y)},getTarget:U=>U,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:U=>{var X,b;return new F.Vector2((null===(X=U._babylonCamera)||void 0===X?void 0:X.orthoBottom)??0,(null===(b=U._babylonCamera)||void 0===b?void 0:b.orthoTop)??0)},set:(U,X)=>{X._babylonCamera&&(X._babylonCamera.orthoBottom=U.x,X._babylonCamera.orthoTop=U.y)},getTarget:U=>U,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:U=>{var X;return null===(X=U._babylonCamera)||void 0===X?void 0:X.maxZ},set:(U,X)=>{X._babylonCamera&&(X._babylonCamera.maxZ=U)},getTarget:U=>U,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:U=>{var X;return null===(X=U._babylonCamera)||void 0===X?void 0:X.xb},set:(U,X)=>{X._babylonCamera&&(X._babylonCamera.xb=U)},getTarget:U=>U,getPropertyName:[()=>"xb"]}},perspective:{aspectRatio:{type:"number",get:U=>{var X;return null===(X=U._babylonCamera)||void 0===X?void 0:X.getEngine().getAspectRatio(U._babylonCamera)},getTarget:U=>U,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:U=>{var X;return null===(X=U._babylonCamera)||void 0===X?void 0:X.fov},set:(U,X)=>{X._babylonCamera&&(X._babylonCamera.fov=U)},getTarget:U=>U,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:U=>{var X;return null===(X=U._babylonCamera)||void 0===X?void 0:X.maxZ},set:(U,X)=>{X._babylonCamera&&(X._babylonCamera.maxZ=U)},getTarget:U=>U,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:U=>{var X;return null===(X=U._babylonCamera)||void 0===X?void 0:X.xb},set:(U,X)=>{X._babylonCamera&&(X._babylonCamera.xb=U)},getTarget:U=>U,getPropertyName:[()=>"xb"]}}}},nodes:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"JX",get:U=>{var X;return null===(X=U._babylonTransformNode)||void 0===X?void 0:X.position},set:(U,X)=>{var b;return null===(b=X._babylonTransformNode)||void 0===b?void 0:b.position.q(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:U=>{var X;return null===(X=U._babylonTransformNode)||void 0===X?void 0:X.rotationQuaternion},set:(U,X)=>{var b,F;return null===(b=X._babylonTransformNode)||void 0===b||null===(F=b.rotationQuaternion)||void 0===F?void 0:F.q(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"JX",get:U=>{var X;return null===(X=U._babylonTransformNode)||void 0===X?void 0:X.fb},set:(U,X)=>{var b;return null===(b=X._babylonTransformNode)||void 0===b?void 0:b.fb.q(U)},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"fb"]},weights:{length:{type:"number",get:U=>U._numMorphTargets,getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(U,X)=>{var b,F;return void 0!==X?null===(b=U._primitiveBabylonMeshes)||void 0===b||null===(F=b[0].morphTargetManager)||void 0===F?void 0:F.getTarget(X).influence:void 0},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(U,X)=>[0],getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:U=>{var X,b,E;return F.Matrix.Compose(null===(X=U._babylonTransformNode)||void 0===X?void 0:X.fb,null===(b=U._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion,null===(E=U._babylonTransformNode)||void 0===E?void 0:E.position)},getTarget:U=>U._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:U=>{var X,b,E,w;const Q=F.Matrix.Identity();let z=U.parent;for(;z&&z.parent;)z=z.parent;const q=(null===(X=U._babylonTransformNode)||void 0===X?void 0:X.position._isDirty)||(null===(b=U._babylonTransformNode)||void 0===b||null===(E=b.rotationQuaternion)||void 0===E?void 0:E._isDirty)||(null===(w=U._babylonTransformNode)||void 0===w?void 0:w.fb._isDirty);if(z){var p;const X=null===(p=z._babylonTransformNode)||void 0===p?void 0:p.Ob(!0).invert();var S,R;if(X)null===(S=U._babylonTransformNode)||void 0===S||null===(R=S.Ob(q))||void 0===R||R.multiplyToRef(X,Q)}else U._babylonTransformNode&&Q.q(U._babylonTransformNode.Ob(q));return Q},getTarget:U=>U._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:U=>{var X,b;return null===(X=U._babylonTransformNode)||void 0===X||null===(b=X.getChildren((U=>U instanceof Q.c),!0)[0])||void 0===b?void 0:b.sb},getTarget:U=>{var X;return null===(X=U._babylonTransformNode)||void 0===X?void 0:X.getChildren((U=>U instanceof Q.c),!0)[0]},set:(U,X)=>{if(X._babylonTransformNode){const b=X._babylonTransformNode.getChildren((U=>U instanceof Q.c),!0)[0];b&&(b.sb=U)}}},color:{type:"NX",get:U=>{var X,b;return null===(X=U._babylonTransformNode)||void 0===X||null===(b=X.getChildren((U=>U instanceof Q.c),!0)[0])||void 0===b?void 0:b.hb},getTarget:U=>{var X;return null===(X=U._babylonTransformNode)||void 0===X?void 0:X.getChildren((U=>U instanceof Q.c),!0)[0]},set:(U,X)=>{if(X._babylonTransformNode){const b=X._babylonTransformNode.getChildren((U=>U instanceof Q.c),!0)[0];b&&(b.hb=U)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"NX",get:(U,X,b)=>S(U,X,b).emissiveColor,set:(U,X,b,F)=>S(X,b,F).emissiveColor.q(U),getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:R("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(U,X,b)=>{var F;return null===(F=p(U,b,"bumpTexture"))||void 0===F?void 0:F.level},set:(U,X,b,F)=>{const E=p(X,F,"bumpTexture");E&&(E.level=U)},getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:R("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(U,X,b)=>S(U,X,b).ambientTextureStrength,set:(U,X,b,F)=>{const E=S(X,b,F);E&&(E.ambientTextureStrength=U)},getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:R("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"eb",get:(U,X,b)=>{const F=S(U,X,b);return w.eb.FromColor3(F.albedoColor,F.alpha)},set:(U,X,b,F)=>{const E=S(X,b,F);E.albedoColor.set(U.r,U.g,U.b),E.alpha=U.a},getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:R("albedoTexture")}},metallicFactor:{type:"number",get:(U,X,b)=>S(U,X,b).metallic,set:(U,X,b,F)=>{const E=S(X,b,F);E&&(E.metallic=U)},getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(U,X,b)=>S(U,X,b).roughness,set:(U,X,b,F)=>{const E=S(X,b,F);E&&(E.roughness=U)},getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:R("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(U,X,b)=>S(U,X,b).anisotropy.sb,set:(U,X,b,F)=>{S(X,b,F).anisotropy.sb=U},getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(U,X,b)=>S(U,X,b).anisotropy.angle,set:(U,X,b,F)=>{S(X,b,F).anisotropy.angle=U},getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:R("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(U,X,b)=>S(U,X,b).clearCoat.sb,set:(U,X,b,F)=>{S(X,b,F).clearCoat.sb=U},getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(U,X,b)=>S(U,X,b).clearCoat.roughness,set:(U,X,b,F)=>{S(X,b,F).clearCoat.roughness=U},getTarget:(U,X,b)=>S(U,X,b),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:R("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(U,X,b)=>{var F;return null===(F=S(U,X,b).clearCoat.bumpTexture)||void 0===F?void 0:F.level},getTarget:S,set:(U,X,b,F)=>S(X,b,F).clearCoat.bumpTexture.level=U},extensions:{KHR_texture_transform:R("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:R("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(U,X,b)=>S(U,X,b).subSurface.dispersion,getTarget:S,set:(U,X,b,F)=>S(X,b,F).subSurface.dispersion=U}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(U,X,b)=>S(U,X,b).emissiveIntensity,getTarget:S,set:(U,X,b,F)=>S(X,b,F).emissiveIntensity=U}},KHR_materials_ior:{ior:{type:"number",get:(U,X,b)=>S(U,X,b).indexOfRefraction,getTarget:S,set:(U,X,b,F)=>S(X,b,F).indexOfRefraction=U}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(U,X,b)=>S(U,X,b).iridescence.sb,getTarget:S,set:(U,X,b,F)=>S(X,b,F).iridescence.sb=U},iridescenceIor:{type:"number",get:(U,X,b)=>S(U,X,b).iridescence.indexOfRefraction,getTarget:S,set:(U,X,b,F)=>S(X,b,F).iridescence.indexOfRefraction=U},iridescenceTexture:{extensions:{KHR_texture_transform:R("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(U,X,b)=>S(U,X,b).iridescence.maximumThickness,getTarget:S,set:(U,X,b,F)=>S(X,b,F).iridescence.maximumThickness=U},iridescenceThicknessMinimum:{type:"number",get:(U,X,b)=>S(U,X,b).iridescence.minimumThickness,getTarget:S,set:(U,X,b,F)=>S(X,b,F).iridescence.minimumThickness=U},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:R("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"NX",get:(U,X,b)=>S(U,X,b).sheen.color,getTarget:S,set:(U,X,b,F)=>S(X,b,F).sheen.color.q(U)},sheenColorTexture:{extensions:{KHR_texture_transform:R("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(U,X,b)=>S(U,X,b).sheen.sb,getTarget:S,set:(U,X,b,F)=>S(X,b,F).sheen.sb=U},sheenRoughnessTexture:{extensions:{KHR_texture_transform:R("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(U,X,b)=>S(U,X,b).metallicF0Factor,getTarget:S,set:(U,X,b,F)=>S(X,b,F).metallicF0Factor=U,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"NX",get:(U,X,b)=>S(U,X,b).metallicReflectanceColor,getTarget:S,set:(U,X,b,F)=>S(X,b,F).metallicReflectanceColor.q(U),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:R("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:R("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(U,X,b)=>S(U,X,b).subSurface.refractionIntensity,getTarget:S,set:(U,X,b,F)=>S(X,b,F).subSurface.refractionIntensity=U,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:R("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(U,X,b)=>S(U,X,b).subSurface.translucencyIntensity,getTarget:S,set:(U,X,b,F)=>S(X,b,F).subSurface.translucencyIntensity=U},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:R("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"NX",get:(U,X,b)=>S(U,X,b).subSurface.translucencyColor,getTarget:S,set:(U,X,b,F)=>{var E;return U&&(null===(E=S(X,b,F).subSurface.translucencyColor)||void 0===E?void 0:E.q(U))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:R("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"NX",get:(U,X,b)=>S(U,X,b).subSurface.tintColor,getTarget:S,set:(U,X,b,F)=>S(X,b,F).subSurface.tintColor.q(U)},attenuationDistance:{type:"number",get:(U,X,b)=>S(U,X,b).subSurface.tintColorAtDistance,getTarget:S,set:(U,X,b,F)=>S(X,b,F).subSurface.tintColorAtDistance=U},thicknessFactor:{type:"number",get:(U,X,b)=>S(U,X,b).subSurface.maximumThickness,getTarget:S,set:(U,X,b,F)=>S(X,b,F).subSurface.maximumThickness=U},thicknessTexture:{extensions:{KHR_texture_transform:R("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonLight)),getPropertyName:[U=>"length"]},__array__:{__target__:!0,color:{type:"NX",get:U=>{var X;return null===(X=U._babylonLight)||void 0===X?void 0:X.hb},set:(U,X)=>{var b;return null===(b=X._babylonLight)||void 0===b?void 0:b.hb.q(U)},getTarget:U=>U._babylonLight,getPropertyName:[U=>"diffuse"]},sb:{type:"number",get:U=>{var X;return null===(X=U._babylonLight)||void 0===X?void 0:X.sb},set:(U,X)=>X._babylonLight?X._babylonLight.sb=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"intensity"]},range:{type:"number",get:U=>{var X;return null===(X=U._babylonLight)||void 0===X?void 0:X.range},set:(U,X)=>X._babylonLight?X._babylonLight.range=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"range"]},spot:{innerConeAngle:{type:"number",get:U=>{var X;return null===(X=U._babylonLight)||void 0===X?void 0:X.innerAngle},set:(U,X)=>X._babylonLight?X._babylonLight.innerAngle=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"innerConeAngle"]},outerConeAngle:{type:"number",get:U=>{var X;return null===(X=U._babylonLight)||void 0===X?void 0:X.angle},set:(U,X)=>X._babylonLight?X._babylonLight.angle=U:void 0,getTarget:U=>U._babylonLight,getPropertyName:[U=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonLight)),getPropertyName:[U=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonTexture)),getPropertyName:[U=>"length"]},__array__:{__target__:!0,sb:{type:"number",get:U=>{var X;return null===(X=U._babylonTexture)||void 0===X?void 0:X.level},set:(U,X)=>{X._babylonTexture&&(X._babylonTexture.level=U)},getTarget:U=>U._babylonTexture},rotation:{type:"Quaternion",get:U=>{var X;return U._babylonTexture&&F.Quaternion.FromRotationMatrix(null===(X=U._babylonTexture)||void 0===X?void 0:X.getReflectionTextureMatrix())},set:(U,X)=>{var b;X._babylonTexture&&(null!==(b=X._babylonTexture.fU())&&void 0!==b&&b.useRightHandedSystem||(U=F.Quaternion.Inverse(U)),F.Matrix.FromQuaternionToRef(U,X._babylonTexture.getReflectionTextureMatrix()))},getTarget:U=>U._babylonTexture}}}}},animations:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>U._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:U=>U.length,getTarget:U=>U.map((U=>{var X;return null===(X=U.primitives[0]._instanceData)||void 0===X?void 0:X.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function a(U){return new q(U,n)}function J(U){const X=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let b=n;for(const F of X)F&&(b=b[F]);if(b&&b.type&&b.get)return b}function m(U,X){const b=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let F=n;for(const E of b)E&&(F=F[E]);F&&F.type&&F.get&&(F.interpolation=X)}function x(U,X){const b=U.split("/").map((U=>U.replace(/{}/g,"__array__")));let F=n;for(const E of b)if(E){if(!F[E]){if("?"===E){F.__ignoreObjectTree__=!0;continue}F[E]={},"__array__"===E&&(F[E].__target__=!0)}F=F[E]}Object.assign(F,X)}},13233:(U,X,b)=>{"use strict";b.r(X),b.d(X,{AnimationPropertyInfo:()=>p,TransformNodeAnimationPropertyInfo:()=>S,WeightAnimationPropertyInfo:()=>R,getQuaternion:()=>z,getVector3:()=>Q,getWeights:()=>q});var F=b(12142),E=b(11593),w=b(13219);function Q(U,X,b,F){return E.JX.uX(X,b).scaleInPlace(F)}function z(U,X,b,F){return E.Quaternion.uX(X,b).scaleInPlace(F)}function q(U,X,b,F){const E=new Array(U._numMorphTargets);for(let w=0;w<E.length;w++)E[w]=X[b++]*F;return E}class p{constructor(U,X,b,F){this.type=U,this.name=X,this.getValue=b,this.getStride=F}_buildAnimation(U,X,b){const E=new F.e(U,this.name,X,this.type);return E.setKeys(b),E}}class S extends p{buildAnimations(U,X,b,F){const E=[];return E.push({babylonAnimatable:U._babylonTransformNode,babylonAnimation:this._buildAnimation(X,b,F)}),E}}class R extends p{buildAnimations(U,X,b,E){const w=[];if(U._numMorphTargets)for(let Q=0;Q<U._numMorphTargets;Q++){const z=new F.e(`${X}_${Q}`,this.name,b,this.type);if(z.setKeys(E.map((U=>({frame:U.frame,inTangent:U.inTangent?U.inTangent[Q]:void 0,value:U.value[Q],outTangent:U.outTangent?U.outTangent[Q]:void 0,interpolation:U.interpolation})))),U._primitiveBabylonMeshes)for(const X of U._primitiveBabylonMeshes)if(X.morphTargetManager){const U=X.morphTargetManager.getTarget(Q),b=z.clone();U.animations.push(b),w.push({babylonAnimatable:U,babylonAnimation:b})}}return w}}(0,w.l)("/nodes/{}/translation",[new S(F.e.ANIMATIONTYPE_VECTOR3,"position",Q,(()=>3))]),(0,w.l)("/nodes/{}/rotation",[new S(F.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",z,(()=>4))]),(0,w.l)("/nodes/{}/scale",[new S(F.e.ANIMATIONTYPE_VECTOR3,"fb",Q,(()=>3))]),(0,w.l)("/nodes/{}/weights",[new R(F.e.ANIMATIONTYPE_FLOAT,"influence",q,(U=>U._numMorphTargets))])},13186:(U,X,b)=>{"use strict";class F{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((U,X)=>{this._resolve=U,this._reject=X}))}}var E=b(11593),w=b(11636),Q=b(11385),z=b(12075),q=b(13192),p=b(13199),S=b(11392),R=b(12098),n=b(12142),a=b(12146),J=b(11442),m=b(11408),x=b(11416);class I{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(U){this._useTextureToStoreBoneMatrices=U,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(U){this._animationPropertiesOverride=U}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(U,X,b){this.name=U,this.id=X,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=E.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new S.e,this.bones=[],this._scene=b||J.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const F=this._scene.getEngine().getCaps();this._canUseTextureForBones=F.textureFloat&&F.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((U=>!U.getParent()))}getTransformMatrices(U){if(this.needInitialSkinMatrix){if(!U)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return U._bonesTransformMatrices||this.prepare(!0),U._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(U){return this.needInitialSkinMatrix&&U._transformMatrixTexture?U._transformMatrixTexture:this._transformMatrixTexture}fU(){return this._scene}toString(U){let X=`Name: ${this.name}, nBones: ${this.bones.length}`;if(X+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,U){X+=", Ranges: {";let U=!0;for(const b in this._ranges)U&&(X+=", ",U=!1),X+=b;X+="}"}return X}getBoneIndexByName(U){for(let X=0,b=this.bones.length;X<b;X++)if(this.bones[X].name===U)return X;return-1}createAnimationRange(U,X,b){if(!this._ranges[U]){this._ranges[U]=new a.d(U,X,b);for(let F=0,E=this.bones.length;F<E;F++)this.bones[F].animations[0]&&this.bones[F].animations[0].createRange(U,X,b)}}deleteAnimationRange(U){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let b=0,F=this.bones.length;b<F;b++)this.bones[b].animations[0]&&this.bones[b].animations[0].deleteRange(U,X);this._ranges[U]=null}getAnimationRange(U){return this._ranges[U]||null}getAnimationRanges(){const U=[];let X;for(X in this._ranges)U.push(this._ranges[X]);return U}copyAnimationRange(U,X){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[X]||!U.getAnimationRange(X))return!1;let F=!0;const E=this._getHighestAnimationFrame()+1,w={},Q=U.bones;let z,q;for(q=0,z=Q.length;q<z;q++)w[Q[q].name]=Q[q];this.bones.length!==Q.length&&(m.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Q.length}`),F=!1);const p=b&&this.dimensionsAtRest&&U.dimensionsAtRest?this.dimensionsAtRest.divide(U.dimensionsAtRest):null;for(q=0,z=this.bones.length;q<z;q++){const U=this.bones[q].name,Q=w[U];Q?F=F&&this.bones[q].copyAnimationRange(Q,X,E,b,p):(m.e.Warn("copyAnimationRange: not same rig, missing source bone "+U),F=!1)}const S=U.getAnimationRange(X);return S&&(this._ranges[X]=new a.d(X,S.from+E,S.to+E)),F}returnToRest(){for(const U of this.bones)-1!==U._index&&U.returnToRest()}_getHighestAnimationFrame(){let U=0;for(let X=0,b=this.bones.length;X<b;X++)if(this.bones[X].animations[0]){const b=this.bones[X].animations[0].getHighestFrame();U<b&&(U=b)}return U}beginAnimation(U,X,b,F){const E=this.getAnimationRange(U);return E?this._scene.beginAnimation(this,E.from,E.to,X,b,F):null}static MakeAnimationAdditive(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const F=U.getAnimationRange(b);if(!F)return null;const E=U._scene.getAllAnimatablesByTarget(U);let w=null;for(let z=0;z<E.length;z++){const U=E[z];if(U.fromFrame===(null===F||void 0===F?void 0:F.from)&&U.toFrame===(null===F||void 0===F?void 0:F.to)){w=U;break}}const Q=U.getAnimatables();for(let z=0;z<Q.length;z++){const U=Q[z].animations;if(U)for(let F=0;F<U.length;F++)n.e.MakeAnimationAdditive(U[F],X,b)}return w&&(w.isAdditive=!0),U}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(U){this._meshesWithPoseMatrix.push(U)}_unregisterMeshWithPoseMatrix(U){const X=this._meshesWithPoseMatrix.indexOf(U);X>-1&&this._meshesWithPoseMatrix.splice(X,1)}_computeTransformMatrices(U,X){this.onBeforeComputeObservable.notifyObservers(this);for(let b=0;b<this.bones.length;b++){const F=this.bones[b];F._childUpdateId++;const E=F.getParent();if(E?F.getLocalMatrix().multiplyToRef(E.getFinalMatrix(),F.getFinalMatrix()):X?F.getLocalMatrix().multiplyToRef(X,F.getFinalMatrix()):F.getFinalMatrix().q(F.getLocalMatrix()),-1!==F._index){const X=null===F._index?b:F._index;F.getAbsoluteInverseBindMatrix().multiplyToArray(F.getFinalMatrix(),U,16*X)}}this._identity.copyToArray(U,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const U=this.fU().getRenderId();if(this._currentRenderId===U)return;this._currentRenderId=U}if(this._numBonesWithLinkedTransformNode>0)for(const U of this.bones)if(U._linkedTransformNode){const X=U._linkedTransformNode;U.position=X.position,X.rotationQuaternion?U.rotationQuaternion=X.rotationQuaternion:U.rotation=X.rotation,U.fb=X.fb}if(this.needInitialSkinMatrix)for(const U of this._meshesWithPoseMatrix){const X=U.getPoseMatrix();let b=this._isDirty;if(U._bonesTransformMatrices&&U._bonesTransformMatrices.length===16*(this.bones.length+1)||(U._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),b=!0),b){if(this._synchronizedWithMesh!==U){this._synchronizedWithMesh=U;for(const U of this.bones)if(!U.getParent()){U.getBindMatrix().multiplyToRef(X,E.TmpVectors.Matrix[1]),U._updateAbsoluteBindMatrices(E.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const X=4*(this.bones.length+1);U._transformMatrixTexture&&U._transformMatrixTexture.getSize().width===X||(U._transformMatrixTexture&&U._transformMatrixTexture.dispose(),U._transformMatrixTexture=R.d.CreateRGBATexture(U._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(U._bonesTransformMatrices,X),this.isUsingTextureForMatrices&&U._transformMatrixTexture&&U._transformMatrixTexture.update(U._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=R.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let U=0;U<this.bones.length;U++)this._animatables.push(this.bones[U])}return this._animatables}clone(U,X){const b=new I(U,X||U,this._scene);b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let F=0;F<this.bones.length;F++){const U=this.bones[F];let X=null;const E=U.getParent();if(E){const U=this.bones.indexOf(E);X=b.bones[U]}const w=new p.e(U.name,b,X,U.getBindMatrix().clone(),U.getRestMatrix().clone());w._index=U._index,U._linkedTransformNode&&w.linkTransformNode(U._linkedTransformNode),x.d.DeepCopy(U.animations,w.animations)}if(this._ranges){b._ranges={};for(const U in this._ranges){const X=this._ranges[U];X&&(b._ranges[U]=X.clone())}}return this._isDirty=!0,b.prepare(!0),b}enableBlending(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const X of this.bones)for(const b of X.animations)b.enableBlending=!0,b.blendingSpeed=U}dispose(){if(this._meshesWithPoseMatrix.length=0,this.fU().stopAnimation(this),this.fU().removeSkeleton(this),this._parentContainer){const U=this._parentContainer.skeletons.indexOf(this);U>-1&&this._parentContainer.skeletons.splice(U,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const U={};U.name=this.name,U.id=this.id,this.dimensionsAtRest&&(U.dimensionsAtRest=this.dimensionsAtRest.Jb()),U.bones=[],U.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let b=0;b<this.bones.length;b++){var X;const F=this.bones[b],E=F.getParent(),w={parentBoneIndex:E?this.bones.indexOf(E):-1,index:F.getIndex(),name:F.name,id:F.id,matrix:F.getBindMatrix().Jb(),rest:F.getRestMatrix().Jb(),linkedTransformNodeId:null===(X=F.getTransformNode())||void 0===X?void 0:X.id};U.bones.push(w),F.length&&(w.length=F.length),F.metadata&&(w.metadata=F.metadata),F.animations&&F.animations.length>0&&(w.animation=F.animations[0].serialize()),U.ranges=[];for(const X in this._ranges){const b=this._ranges[X];if(!b)continue;const F={};F.name=X,F.from=b.from,F.to=b.to,U.ranges.push(F)}}return U}static Parse(U,X){const b=new I(U.name,U.id,X);let F;for(U.dimensionsAtRest&&(b.dimensionsAtRest=E.JX.uX(U.dimensionsAtRest)),b.needInitialSkinMatrix=U.needInitialSkinMatrix,F=0;F<U.bones.length;F++){const X=U.bones[F],w=U.bones[F].index;let Q=null;X.parentBoneIndex>-1&&(Q=b.bones[X.parentBoneIndex]);const z=X.rest?E.Matrix.uX(X.rest):null,q=new p.e(X.name,b,Q,E.Matrix.uX(X.matrix),z,null,w);void 0!==X.id&&null!==X.id&&(q.id=X.id),X.length&&(q.length=X.length),X.metadata&&(q.metadata=X.metadata),X.animation&&q.animations.push(n.e.Parse(X.animation)),void 0!==X.linkedTransformNodeId&&null!==X.linkedTransformNodeId&&(b._hasWaitingData=!0,q._waitingTransformNodeId=X.linkedTransformNodeId)}if(U.ranges)for(F=0;F<U.ranges.length;F++){const X=U.ranges[F];b.createAnimationRange(X.name,X.from,X.to)}return b}computeAbsoluteMatrices(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||U)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(U)}getPoseMatrix(){let U=null;return this._meshesWithPoseMatrix.length>0&&(U=this._meshesWithPoseMatrix[0].getPoseMatrix()),U}sortBones(){const U=[],X=new Array(this.bones.length);for(let b=0;b<this.bones.length;b++)this._sortBones(b,U,X);this.bones=U}_sortBones(U,X,b){if(b[U])return;b[U]=!0;const F=this.bones[U];if(!F)return;void 0===F._index&&(F._index=U);const E=F.getParent();E&&this._sortBones(this.bones.indexOf(E),X,b),X.push(F)}setCurrentPoseAsRest(){for(const U of this.bones)U.setCurrentPoseAsRest()}}var O=b(11928),N=b(12117),u=b(11570),i=b(12028),P=b(11664),f=b(12083),j=b(12038),e=b(12067),l=b(12154),d=b(11679),k=b(13147);class v{set areUpdatesFrozen(U){U?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new d.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,U||(U=J.c.LastCreatedScene),this._scene=U,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const U=this._scene.getEngine().getCaps();this._canUseTextureForTargets=U.canUseGLVertexID&&U.textureFloat&&U.maxVertexTextureImageUnits>0&&U.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return v.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?v.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(U){this._numMaxInfluencers!==U&&(this._numMaxInfluencers=U,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(U){this._useTextureToStoreTargets!==U&&(this._useTextureToStoreTargets=U,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var U;return v.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(U=this._scene)&&void 0!==U&&U.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(U){return this._activeTargets.data[U]}getTarget(U){return this._targets[U]}getTargetByName(U){for(const X of this._targets)if(X.name===U)return X;return null}addTarget(U){this._targets.push(U),this._targetInfluenceChangedObservers.push(U.onInfluenceChanged.add((U=>{this.areUpdatesFrozen&&U&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(U)}))),this._targetDataLayoutChangedObservers.push(U._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(U){const X=this._targets.indexOf(U);X>=0&&(this._targets.splice(X,1),U.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(X,1)[0]),U._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(X,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(U)}_bind(U){U.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),U.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),U.setTexture("morphTargets",this._targetStoreTexture),U.setInt("morphTargetCount",this.numInfluencers)}clone(){const U=new v(this._scene);for(const X of this._targets)U.addTarget(X.clone());return U.enablePositionMorphing=this.enablePositionMorphing,U.enableNormalMorphing=this.enableNormalMorphing,U.enableTangentMorphing=this.enableTangentMorphing,U.enableUVMorphing=this.enableUVMorphing,U.enableUV2Morphing=this.enableUV2Morphing,U.enableColorMorphing=this.enableColorMorphing,U}serialize(){const U={};U.id=this.uniqueId,U.targets=[];for(const X of this._targets)U.targets.push(X.serialize());return U}_syncActiveTargets(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const X=!!this._targetStoreTexture,b=this.isUsingTextureForTargets;(this._mustSynchronize||X!==b)&&(this._mustSynchronize=!1,this.synchronize());let F=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let E=-1;for(const w of this._targets)if(E++,0!==w.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=v.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(w),this._morphTargetTextureIndices[F]=E,this._tempInfluences[F++]=w.influence}this._morphTargetTextureIndices.length!==F&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,F)),this._influences&&this._influences.length===F||(this._influences=new Float32Array(F));for(let w=0;w<F;w++)this._influences[w]=this._tempInfluences[w];if(U&&this._scene)for(const w of this._scene.meshes)w.morphTargetManager===this&&(b?w._markSubMeshesAsAttributesDirty():w._syncGeometryWithMorphTargetManager())}synchronize(){var U;if(!this._scene||this.areUpdatesFrozen)return;const X=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(U=this._targetStoreTexture)||void 0===U||U.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>X.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const b of this._targets){this._supportsPositions=this._supportsPositions&&b.hasPositions,this._supportsNormals=this._supportsNormals&&b.hasNormals,this._supportsTangents=this._supportsTangents&&b.hasTangents,this._supportsUVs=this._supportsUVs&&b.hasUVs,this._supportsUV2s=this._supportsUV2s&&b.hasUV2s,this._supportsColors=this._supportsColors&&b.hasColors;const U=b.vertexCount;if(0===this._vertexCount)this._vertexCount=U;else if(this._vertexCount!==U)return void m.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${b.name}": ${U}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const U=X.getCaps().maxTextureSize;this._textureWidth>U&&(this._textureHeight=Math.ceil(this._textureWidth/U),this._textureWidth=U);const b=this._targets.length,F=new Float32Array(b*this._textureWidth*this._textureHeight*4);let E=0;for(let X=0;X<b;X++){const U=this._targets[X],b=U.getPositions(),w=U.getNormals(),Q=U.getUVs(),z=U.getTangents(),q=U.getUV2s(),p=U.getColors();E=X*this._textureWidth*this._textureHeight*4;for(let X=0;X<this._vertexCount;X++)this._supportsPositions&&b&&(F[E]=b[3*X],F[E+1]=b[3*X+1],F[E+2]=b[3*X+2],E+=4),this._supportsNormals&&w&&(F[E]=w[3*X],F[E+1]=w[3*X+1],F[E+2]=w[3*X+2],E+=4),this._supportsUVs&&Q&&(F[E]=Q[2*X],F[E+1]=Q[2*X+1],E+=4),this._supportsTangents&&z&&(F[E]=z[3*X],F[E+1]=z[3*X+1],F[E+2]=z[3*X+2],E+=4),this._supportsUV2s&&q&&(F[E]=q[2*X],F[E+1]=q[2*X+1],E+=4),this._supportsColors&&p&&(F[E]=p[4*X],F[E+1]=p[4*X+1],F[E+2]=p[4*X+2],F[E+3]=p[4*X+3],E+=4)}this._targetStoreTexture=k.b.CreateRGBATexture(F,this._textureWidth,this._textureHeight,b,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const b of this._scene.meshes)b.morphTargetManager===this&&b._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const U=this._parentContainer.morphTargetManagers.indexOf(this);U>-1&&this._parentContainer.morphTargetManagers.splice(U,1),this._parentContainer=null}for(const U of this._targets)this._scene.stopAnimation(U)}}static Parse(U,X){const b=new v(X);for(const F of U.targets)b.addTarget(l.e.Parse(F,X));return b}}v.EnableTextureStorage=!0,v.MaxActiveMorphTargetsInVertexAttributeMode=8,v.ConstantTargetCountForTextureMode=0;var A=b(13207),s=b(11448),h=b(11949);const B=new Map,o=B;function y(U,X,b){t(U)&&m.e.Warn(`Extension with the name '${U}' already exists`),B.set(U,{isGLTFExtension:X,factory:b})}function t(U){return B.delete(U)}var W=b(13219),Y=b(12204),K=b(11669);class V{static Get(U,X,b){if(!X||void 0==b||!X[b])throw new Error(`${U}: Failed to find index (${b})`);return X[b]}static TryGet(U,X){return U&&void 0!=X&&U[X]?U[X]:null}static Assign(U){if(U)for(let X=0;X<U.length;X++)U[X].index=X}}function g(U){if(U.min&&U.max){const X=U.min,b=U.max,F=E.TmpVectors.JX[0].Pb(X[0],X[1],X[2]),w=E.TmpVectors.JX[1].Pb(b[0],b[1],b[2]);if(U.normalized&&5126!==U.componentType){let X=1;switch(U.componentType){case 5120:X=127;break;case 5121:X=255;break;case 5122:X=32767;break;case 5123:X=65535}const b=1/X;F.scaleInPlace(b),w.scaleInPlace(b)}return new h.d(F,w)}return null}class L{static RegisterExtension(U,X){y(U,!1,X)}static UnregisterExtension(U){return t(U)}get Sb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(U){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=U}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((U=>U.dispose&&U.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(U,X,b,F,E,w){let Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=X,this._assetContainer=b,this._loadData(F);let w=null;if(U){const X={};if(this._gltf.nodes)for(const U of this._gltf.nodes)U.name&&(X[U.name]=U.index);w=(U instanceof Array?U:[U]).map((U=>{const b=X[U];if(void 0===b)throw new Error(`Failed to find node '${U}'`);return b}))}return await this._loadAsync(E,Q,w,(()=>({meshes:this._getMeshes(),wn:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(U,X,b,F){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=U,this._loadData(X),await this._loadAsync(b,E,null,(()=>{}))}async _loadAsync(U,X,b,F){return await Promise.resolve().then((async()=>{this._rootUrl=U,this._uniqueRootUrl=!U.startsWith("file:")&&X?U:`${U}${Date.now()}/`,this._fileName=X,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const E=`${A.k[A.k.LOADING]} => ${A.k[A.k.READY]}`,w=`${A.k[A.k.LOADING]} => ${A.k[A.k.COMPLETE]}`;this._parent._startPerformanceCounter(E),this._parent._startPerformanceCounter(w),this._parent._setState(A.k.LOADING),this._extensionsOnLoading();const z=new Array;if(!this.parent.loadOnlyMaterials)if(b)z.push(this.loadSceneAsync("/nodes",{nodes:b,index:-1}));else if(void 0!=this._gltf.xX||this._gltf.scenes&&this._gltf.scenes[0]){const U=V.Get("/scene",this._gltf.scenes,this._gltf.xX||0);z.push(this.loadSceneAsync(`/scenes/${U.index}`,U))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let U=0;U<this._gltf.materials.length;++U){const X=this._gltf.materials[U],b="/materials/"+U,F=O.e.TriangleFillMode;z.push(this._loadMaterialAsync(b,X,null,F,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&z.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&z.push(this._compileShadowGeneratorsAsync());const q=Promise.all(z).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Xq(!0);for(const U of this._babylonScene.materials){const X=U;void 0!==X.maxSimultaneousLights&&(X.maxSimultaneousLights=Math.max(X.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(A.k.READY),this._skipStartAnimationStep||this._startAnimations(),F()}));return await q.then((U=>(this._parent._endPerformanceCounter(E),Q.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(w),this._parent._setState(A.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(U=>{this._parent.onErrorObservable.notifyObservers(U),this._parent.onErrorObservable.clear(),this.dispose()}))})),U)))})).catch((U=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(U),this._parent.onErrorObservable.clear(),this.dispose()),U}))}_loadData(U){if(this._gltf=U.json,this._setupData(),U.bin){const X=this._gltf.buffers;if(X&&X[0]&&!X[0].uri){const b=X[0];(b.byteLength<U.bin.byteLength-3||b.byteLength>U.bin.byteLength)&&m.e.Warn(`Binary buffer length (${b.byteLength}) from JSON does not match chunk length (${U.bin.byteLength})`),this._bin=U.bin}else m.e.Warn("Unexpected BIN chunk")}}_setupData(){if(V.Assign(this._gltf.accessors),V.Assign(this._gltf.animations),V.Assign(this._gltf.buffers),V.Assign(this._gltf.bufferViews),V.Assign(this._gltf.cameras),V.Assign(this._gltf.images),V.Assign(this._gltf.materials),V.Assign(this._gltf.meshes),V.Assign(this._gltf.nodes),V.Assign(this._gltf.samplers),V.Assign(this._gltf.scenes),V.Assign(this._gltf.skins),V.Assign(this._gltf.textures),this._gltf.nodes){const U={};for(const b of this._gltf.nodes)if(b.children)for(const X of b.children)U[X]=b.index;const X=this._createRootNode();for(const b of this._gltf.nodes){const F=U[b.index];b.parent=void 0===F?X:this._gltf.nodes[F]}}}async _loadExtensionsAsync(){const U=[];if(o.forEach(((X,b)=>{var F;!1===(null===(F=this.parent.extensionOptions[b])||void 0===F?void 0:F.enabled)?X.isGLTFExtension&&this.isExtensionUsed(b)&&m.e.Warn(`Extension ${b} is used but has been explicitly disabled.`):X.isGLTFExtension&&!this.isExtensionUsed(b)||U.push((async()=>{const U=await X.factory(this);return U.name!==b&&m.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${U.name} !== ${b}`),this._parent.onExtensionLoadedObservable.notifyObservers(U),U})())})),this._extensions.push(...await Promise.all(U)),this._extensions.sort(((U,X)=>(U.order||Number.MAX_VALUE)-(X.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const b of this._gltf.extensionsRequired){if(!this._extensions.some((U=>U.name===b&&U.enabled))){var X;if(!1===(null===(X=this.parent.extensionOptions[b])||void 0===X?void 0:X.enabled))throw new Error(`Required extension ${b} is disabled`);throw new Error(`Required extension ${b} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new e.e("__root__",this._babylonScene);this._rootBabylonMesh=U,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Xq(!1);const X={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case A.i.AUTO:this._babylonScene.useRightHandedSystem||(X.rotation=[0,1,0,0],X.scale=[1,1,-1],L._LoadTransform(X,this._rootBabylonMesh));break;case A.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(U),X}loadSceneAsync(U,X){const b=this._extensionsLoadSceneAsync(U,X);if(b)return b;const F=new Array;if(this.logOpen(`${U} ${X.name||""}`),X.nodes)for(const E of X.nodes){const X=V.Get(`${U}/nodes/${E}`,this._gltf.nodes,E);F.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(U=>{U.parent=this._rootBabylonMesh})))}for(const E of this._postSceneLoadActions)E();return F.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(F).then((()=>{}))}_forEachPrimitive(U,X){if(U._primitiveBabylonMeshes)for(const b of U._primitiveBabylonMeshes)X(b)}_getGeometries(){const U=[],X=this._gltf.nodes;if(X)for(const b of X)this._forEachPrimitive(b,(X=>{const b=X.Nb;b&&-1===U.indexOf(b)&&U.push(b)}));return U}_getMeshes(){const U=[];this._rootBabylonMesh instanceof j.b&&U.push(this._rootBabylonMesh);const X=this._gltf.nodes;if(X)for(const b of X)this._forEachPrimitive(b,(X=>{U.push(X)}));return U}_getTransformNodes(){const U=[],X=this._gltf.nodes;if(X)for(const b of X)b._babylonTransformNode&&"yb"===b._babylonTransformNode.getClassName()&&U.push(b._babylonTransformNode),b._babylonTransformNodeForSkin&&U.push(b._babylonTransformNodeForSkin);return U}_getSkeletons(){const U=[],X=this._gltf.skins;if(X)for(const b of X)b._data&&U.push(b._data.babylonSkeleton);return U}_getAnimationGroups(){const U=[],X=this._gltf.animations;if(X)for(const b of X)b._babylonAnimationGroup&&U.push(b._babylonAnimationGroup);return U}_startAnimations(){switch(this._parent.animationStartMode){case A.g.NONE:break;case A.g.FIRST:{const U=this._getAnimationGroups();0!==U.length&&U[0].start(!0);break}case A.g.ALL:{const U=this._getAnimationGroups();for(const X of U)X.start(!0);break}default:return void m.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const F=this._extensionsLoadNodeAsync(U,X,b);if(F)return F;if(X._babylonTransformNode)throw new Error(`${U}: Invalid recursive node hierarchy`);const E=new Array;this.logOpen(`${U} ${X.name||""}`);const w=F=>{if(L.AddPointerMetadata(F,U),L._LoadTransform(X,F),void 0!=X.camera){const b=V.Get(`${U}/camera`,this._gltf.cameras,X.camera);E.push(this.loadCameraAsync(`/cameras/${b.index}`,b,(U=>{U.parent=F,this._babylonScene.useRightHandedSystem||(F.fb.x=-1)})))}if(X.children)for(const b of X.children){const X=V.Get(`${U}/children/${b}`,this._gltf.nodes,b);E.push(this.loadNodeAsync(`/nodes/${X.index}`,X,(U=>{U.parent=F})))}b(F)},Q=void 0!=X.mesh,z=this._parent.loadSkins&&void 0!=X.skin;if(!Q||z){const U=X.name||`node${X.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new i.c(U,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==X.mesh?X._babylonTransformNode=b:X._babylonTransformNodeForSkin=b,w(b)}if(Q)if(z){const b=V.Get(`${U}/mesh`,this._gltf.meshes,X.mesh);E.push(this._loadMeshAsync(`/meshes/${b.index}`,X,b,(b=>{const F=X._babylonTransformNodeForSkin;b.metadata=(0,Y.d)(F.metadata,b.metadata||{});const w=V.Get(`${U}/skin`,this._gltf.skins,X.skin);E.push(this._loadSkinAsync(`/skins/${w.index}`,X,w,(U=>{this._forEachPrimitive(X,(X=>{X.skeleton=U})),this._postSceneLoadActions.push((()=>{if(void 0!=w.skeleton){const U=V.Get(`/skins/${w.index}/skeleton`,this._gltf.nodes,w.skeleton).parent;X.index===U.index?b.parent=F.parent:b.parent=U._babylonTransformNode}else b.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:F,skinnedNode:b})}))})))})))}else{const b=V.Get(`${U}/mesh`,this._gltf.meshes,X.mesh);E.push(this._loadMeshAsync(`/meshes/${b.index}`,X,b,w))}return this.logClose(),Promise.all(E).then((()=>(this._forEachPrimitive(X,(U=>{const X=U;!X.isAnInstance&&X.Nb&&X.Nb.useBoundingInfoFromGeometry?U.hU():U.refreshBoundingInfo(!0,!0)})),X._babylonTransformNode)))}_loadMeshAsync(U,X,b,F){const E=b.primitives;if(!E||!E.length)throw new Error(`${U}: Primitives are missing`);void 0==E[0].index&&V.Assign(E);const w=new Array;this.logOpen(`${U} ${b.name||""}`);const Q=X.name||`node${X.index}`;if(1===E.length){const F=b.primitives[0];w.push(this._loadMeshPrimitiveAsync(`${U}/primitives/${F.index}`,Q,X,b,F,(U=>{X._babylonTransformNode=U,X._primitiveBabylonMeshes=[U]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,X._babylonTransformNode=new i.c(Q,this._babylonScene),X._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._primitiveBabylonMeshes=[];for(const F of E)w.push(this._loadMeshPrimitiveAsync(`${U}/primitives/${F.index}`,`${Q}_primitive${F.index}`,X,b,F,(U=>{U.parent=X._babylonTransformNode,X._primitiveBabylonMeshes.push(U)})))}return F(X._babylonTransformNode),this.logClose(),Promise.all(w).then((()=>X._babylonTransformNode))}_loadMeshPrimitiveAsync(U,X,b,F,E,w){const Q=this._extensionsLoadMeshPrimitiveAsync(U,X,b,F,E,w);if(Q)return Q;this.logOpen(`${U}`);const z=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==b.skin&&!F.primitives[0].targets;let q,p;if(z&&E._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,q=E._instanceData.babylonSourceMesh.createInstance(X),q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p=E._instanceData.promise;else{const w=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new e.e(X,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.sideOrientation=this._babylonScene.useRightHandedSystem?O.e.CounterClockWiseSideOrientation:O.e.ClockWiseSideOrientation,this._createMorphTargets(U,b,F,E,Q),w.push(this._loadVertexDataAsync(U,E,Q).then((async X=>await this._loadMorphTargetsAsync(U,E,Q,X).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,X.AU(Q),X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const S=L._GetDrawMode(U,E.mode);if(void 0==E.material){let U=this._defaultBabylonMaterialData[S];U||(U=this._createDefaultMaterial("__GLTFLoader._default",S),this._parent.onMaterialLoadedObservable.notifyObservers(U),this._defaultBabylonMaterialData[S]=U),Q.material=U}else if(!this.parent.skipMaterials){const X=V.Get(`${U}/material`,this._gltf.materials,E.material);w.push(this._loadMaterialAsync(`/materials/${X.index}`,X,Q,S,(U=>{Q.material=U})))}p=Promise.all(w),z&&(E._instanceData={babylonSourceMesh:Q,promise:p}),q=Q}return L.AddPointerMetadata(q,U),this._parent.onMeshLoadedObservable.notifyObservers(q),w(q),this.logClose(),p.then((()=>q))}_loadVertexDataAsync(U,X,b){const F=this._extensionsLoadVertexDataAsync(U,X,b);if(F)return F;const E=X.attributes;if(!E)throw new Error(`${U}: Attributes are missing`);const w=new Array,Q=new f.c(b.name,this._babylonScene);if(void 0==X.indices)b.isUnIndexed=!0;else{const b=V.Get(`${U}/indices`,this._gltf.accessors,X.indices);w.push(this._loadIndicesAccessorAsync(`/accessors/${b.index}`,b).then((U=>{Q.setIndices(U)})))}const z=(X,F,z)=>{if(void 0==E[X])return;b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(F)&&b._delayInfo.push(F);const q=V.Get(`${U}/attributes/${X}`,this._gltf.accessors,E[X]);w.push(this._loadVertexAccessorAsync(`/accessors/${q.index}`,q,F).then((U=>{if(U.getKind()===P.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!b.skeleton){const U=g(q);U&&(Q._boundingInfo=U,Q.useBoundingInfoFromGeometry=!0)}Q.setVerticesBuffer(U,q.count)}))),F==P.h.MatricesIndicesExtraKind&&(b.numBoneInfluencers=8),z&&z(q)};return z("POSITION",P.h.PositionKind),z("NORMAL",P.h.NormalKind),z("TANGENT",P.h.TangentKind),z("TEXCOORD_0",P.h.UVKind),z("TEXCOORD_1",P.h.UV2Kind),z("TEXCOORD_2",P.h.UV3Kind),z("TEXCOORD_3",P.h.UV4Kind),z("TEXCOORD_4",P.h.UV5Kind),z("TEXCOORD_5",P.h.UV6Kind),z("JOINTS_0",P.h.MatricesIndicesKind),z("WEIGHTS_0",P.h.MatricesWeightsKind),z("JOINTS_1",P.h.MatricesIndicesExtraKind),z("WEIGHTS_1",P.h.MatricesWeightsExtraKind),z("COLOR_0",P.h.ColorKind,(U=>{"VEC4"===U.type&&(b.hasVertexAlpha=!0)})),Promise.all(w).then((()=>Q))}_createMorphTargets(U,X,b,F,E){if(!F.targets||!this._parent.loadMorphTargets)return;if(void 0==X._numMorphTargets)X._numMorphTargets=F.targets.length;else if(F.targets.length!==X._numMorphTargets)throw new Error(`${U}: Primitives do not have the same number of targets`);const w=b.extras?b.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,E.morphTargetManager=new v(this._babylonScene),E.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.morphTargetManager.areUpdatesFrozen=!0;for(let Q=0;Q<F.targets.length;Q++){const U=X.weights?X.weights[Q]:b.weights?b.weights[Q]:0,F=w?w[Q]:`morphTarget${Q}`;E.morphTargetManager.addTarget(new l.e(F,U,E.fU()))}}_loadMorphTargetsAsync(U,X,b,F){if(!X.targets||!this._parent.loadMorphTargets)return Promise.resolve();const E=new Array,w=b.morphTargetManager;for(let Q=0;Q<w.numTargets;Q++){const b=w.getTarget(Q);E.push(this._loadMorphTargetVertexDataAsync(`${U}/targets/${Q}`,F,X.targets[Q],b))}return Promise.all(E).then((()=>{w.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(U,X,b,F){const E=new Array,w=(F,w,Q)=>{if(void 0==b[F])return;const z=X.getVertexBuffer(w);if(!z)return;const q=V.Get(`${U}/${F}`,this._gltf.accessors,b[F]);E.push(this._loadFloatAccessorAsync(`/accessors/${q.index}`,q).then((U=>{Q(z,U)})))};return w("POSITION",P.h.PositionKind,((U,X)=>{const b=new Float32Array(X.length);U.forEach(X.length,((U,F)=>{b[F]=X[F]+U})),F.setPositions(b)})),w("NORMAL",P.h.NormalKind,((U,X)=>{const b=new Float32Array(X.length);U.forEach(b.length,((U,F)=>{b[F]=X[F]+U})),F.setNormals(b)})),w("TANGENT",P.h.TangentKind,((U,X)=>{const b=new Float32Array(X.length/3*4);let E=0;U.forEach(X.length/3*4,((U,F)=>{(F+1)%4!==0&&(b[E]=X[E]+U,E++)})),F.setTangents(b)})),w("TEXCOORD_0",P.h.UVKind,((U,X)=>{const b=new Float32Array(X.length);U.forEach(X.length,((U,F)=>{b[F]=X[F]+U})),F.setUVs(b)})),w("TEXCOORD_1",P.h.UV2Kind,((U,X)=>{const b=new Float32Array(X.length);U.forEach(X.length,((U,F)=>{b[F]=X[F]+U})),F.setUV2s(b)})),w("COLOR_0",P.h.ColorKind,((X,b)=>{let E=null;const w=X.getSize();if(3===w){E=new Float32Array(b.length/3*4),X.forEach(b.length,((U,X)=>{const F=Math.floor(X/3),w=X%3;E[4*F+w]=b[3*F+w]+U}));for(let U=0;U<b.length/3;++U)E[4*U+3]=1}else{if(4!==w)throw new Error(`${U}: Invalid number of components (${w}) for COLOR_0 attribute`);E=new Float32Array(b.length),X.forEach(b.length,((U,X)=>{E[X]=b[X]+U}))}F.setColors(E)})),await Promise.all(E).then((()=>{}))}static _LoadTransform(U,X){if(void 0!=U.skin)return;let b=E.JX.Zero(),F=E.Quaternion.Identity(),w=E.JX.One();if(U.matrix){E.Matrix.uX(U.matrix).decompose(w,F,b)}else U.translation&&(b=E.JX.uX(U.translation)),U.rotation&&(F=E.Quaternion.uX(U.rotation)),U.scale&&(w=E.JX.uX(U.scale));X.position=b,X.rotationQuaternion=F,X.fb=w}_loadSkinAsync(U,X,b,F){if(!this._parent.loadSkins)return Promise.resolve();const E=this._extensionsLoadSkinAsync(U,X,b);if(E)return E;if(b._data)return F(b._data.babylonSkeleton),b._data.promise;const w=`skeleton${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new I(b.name||w,w,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(U,b,Q);const z=this._loadSkinInverseBindMatricesDataAsync(U,b).then((U=>{this._updateBoneMatrices(Q,U)}));return b._data={babylonSkeleton:Q,promise:z},F(Q),z}_loadBones(U,X,b){if(void 0==X.skeleton||this._parent.alwaysComputeSkeletonRootNode){const b=this._findSkeletonRootNode(`${U}/joints`,X.joints);if(b)if(void 0===X.skeleton)X.skeleton=b.index;else{const F=(U,X)=>{for(;X.parent;X=X.parent)if(X.parent===U)return!0;return!1},E=V.Get(`${U}/skeleton`,this._gltf.nodes,X.skeleton);E===b||F(E,b)||(m.e.Warn(`${U}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),X.skeleton=b.index)}else m.e.Warn(`${U}: Failed to find common root`)}const F={};for(const E of X.joints){const w=V.Get(`${U}/joints/${E}`,this._gltf.nodes,E);this._loadBone(w,X,b,F)}}_findSkeletonRootNode(U,X){if(0===X.length)return null;const b={};for(const E of X){const X=[];let F=V.Get(`${U}/${E}`,this._gltf.nodes,E);for(;-1!==F.index;)X.unshift(F),F=F.parent;b[E]=X}let F=null;for(let E=0;;++E){let U=b[X[0]];if(E>=U.length)return F;const w=U[E];for(let Q=1;Q<X.length;++Q)if(U=b[X[Q]],E>=U.length||w!==U[E])return F;F=w}}_loadBone(U,X,b,F){U._isJoint=!0;let E=F[U.index];if(E)return E;let w=null;U.index!==X.skeleton&&(U.parent&&-1!==U.parent.index?w=this._loadBone(U.parent,X,b,F):void 0!==X.skeleton&&m.e.Warn(`/skins/${X.index}/skeleton: Skeleton node is not a common root`));const Q=X.joints.indexOf(U.index);return E=new p.e(U.name||`joint${U.index}`,b,w,this._getNodeMatrix(U),null,null,Q),F[U.index]=E,this._postSceneLoadActions.push((()=>{E.linkTransformNode(U._babylonTransformNode)})),E}_loadSkinInverseBindMatricesDataAsync(U,X){if(void 0==X.inverseBindMatrices)return Promise.resolve(null);const b=V.Get(`${U}/inverseBindMatrices`,this._gltf.accessors,X.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${b.index}`,b)}_updateBoneMatrices(U,X){for(const b of U.bones){const U=E.Matrix.Identity(),F=b._index;X&&-1!==F&&(E.Matrix.FromArrayToRef(X,16*F,U),U.invertToRef(U));const w=b.getParent();w&&U.multiplyToRef(w.getAbsoluteInverseBindMatrix(),U),b.Ib(U,!1,!1),b._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(U){return U.matrix?E.Matrix.uX(U.matrix):E.Matrix.Compose(U.scale?E.JX.uX(U.scale):E.JX.One(),U.rotation?E.Quaternion.uX(U.rotation):E.Quaternion.Identity(),U.translation?E.JX.uX(U.translation):E.JX.Zero())}loadCameraAsync(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const F=this._extensionsLoadCameraAsync(U,X,b);if(F)return F;const w=new Array;this.logOpen(`${U} ${X.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new q.c(X.name||`camera${X.index}`,E.JX.Zero(),this._babylonScene,!1);switch(Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._babylonCamera=Q,Q.setTarget(new E.JX(0,0,-1)),X.type){case"perspective":{const b=X.perspective;if(!b)throw new Error(`${U}: Camera perspective properties are missing`);Q.fov=b.yfov,Q.xb=b.znear,Q.maxZ=b.zfar||0;break}case"orthographic":if(!X.orthographic)throw new Error(`${U}: Camera orthographic properties are missing`);Q.mode=z.e.ORTHOGRAPHIC_CAMERA,Q.orthoLeft=-X.orthographic.xmag,Q.orthoRight=X.orthographic.xmag,Q.orthoBottom=-X.orthographic.ymag,Q.orthoTop=X.orthographic.ymag,Q.xb=X.orthographic.znear,Q.maxZ=X.orthographic.zfar;break;default:throw new Error(`${U}: Invalid camera type (${X.type})`)}return L.AddPointerMetadata(Q,U),this._parent.onCameraLoadedObservable.notifyObservers(Q),b(Q),this.logClose(),Promise.all(w).then((()=>Q))}_loadAnimationsAsync(){const U=this._gltf.animations;if(!U)return Promise.resolve();const X=new Array;for(let b=0;b<U.length;b++){const F=U[b];X.push(this.loadAnimationAsync(`/animations/${F.index}`,F).then((U=>{0===U.targetedAnimations.length&&U.dispose()})))}return Promise.all(X).then((()=>{}))}loadAnimationAsync(U,X){const F=this._extensionsLoadAnimationAsync(U,X);return F||b.e(78).then(b.bind(b,14771)).then((b=>{let{AnimationGroup:F}=b;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new F(X.name||`animation${X.index}`,this._babylonScene);E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X._babylonAnimationGroup=E;const w=new Array;V.Assign(X.channels),V.Assign(X.samplers);for(const Q of X.channels)w.push(this._loadAnimationChannelAsync(`${U}/channels/${Q.index}`,U,X,Q,((U,X)=>{U.animations=U.animations||[],U.animations.push(X),E.addTargetedAnimation(X,U)})));return Promise.all(w).then((()=>(E.normalize(0),E)))}))}async _loadAnimationChannelAsync(U,X,F,E,w){const Q=this._extensionsLoadAnimationChannelAsync(U,X,F,E,w);if(Q)return await Q;if(void 0==E.target.node)return await Promise.resolve();const z=V.Get(`${U}/target/node`,this._gltf.nodes,E.target.node),q=E.target.path,p="weights"===q;if(p&&!z._numMorphTargets||!p&&!z._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!p&&!z._isJoint)return await Promise.resolve();let S;switch(await Promise.resolve().then(b.bind(b,13233)),q){case"translation":var R;S=null===(R=(0,W.g)("/nodes/{}/translation"))||void 0===R?void 0:R.interpolation;break;case"rotation":var n;S=null===(n=(0,W.g)("/nodes/{}/rotation"))||void 0===n?void 0:n.interpolation;break;case"scale":var a;S=null===(a=(0,W.g)("/nodes/{}/scale"))||void 0===a?void 0:a.interpolation;break;case"weights":var J;S=null===(J=(0,W.g)("/nodes/{}/weights"))||void 0===J?void 0:J.interpolation;break;default:throw new Error(`${U}/target/path: Invalid value (${E.target.path})`)}if(!S)throw new Error(`${U}/target/path: Could not find interpolation properties for target path (${E.target.path})`);const m={object:z,info:S};return await this._loadAnimationChannelFromTargetInfoAsync(U,X,F,E,m,w)}_loadAnimationChannelFromTargetInfoAsync(U,X,b,F,E,w){const Q=this.parent.targetFps,z=1/Q,q=V.Get(`${U}/sampler`,b.samplers,F.sampler);return this._loadAnimationSamplerAsync(`${X}/samplers/${F.sampler}`,q).then((U=>{let X=0;const q=E.object,p=E.info;for(const E of p){const p=E.getStride(q),S=U.input,R=U.output,n=new Array(S.length);let a=0;switch(U.interpolation){case"STEP":for(let U=0;U<S.length;U++){const X=E.getValue(q,R,a,1);a+=p,n[U]={frame:S[U]*Q,value:X,interpolation:1}}break;case"CUBICSPLINE":for(let U=0;U<S.length;U++){const X=E.getValue(q,R,a,z);a+=p;const b=E.getValue(q,R,a,1);a+=p;const F=E.getValue(q,R,a,z);a+=p,n[U]={frame:S[U]*Q,inTangent:X,value:b,outTangent:F}}break;case"LINEAR":for(let U=0;U<S.length;U++){const X=E.getValue(q,R,a,1);a+=p,n[U]={frame:S[U]*Q,value:X}}}if(a>0){const U=`${b.name||`animation${b.index}`}_channel${F.index}_${X}`,z=E.buildAnimations(q,U,Q,n);for(const b of z)X++,w(b.babylonAnimatable,b.babylonAnimation)}}}))}_loadAnimationSamplerAsync(U,X){if(X._data)return X._data;const b=X.interpolation||"LINEAR";switch(b){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${U}/interpolation: Invalid value (${X.interpolation})`)}const F=V.Get(`${U}/input`,this._gltf.accessors,X.input),E=V.Get(`${U}/output`,this._gltf.accessors,X.output);return X._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${F.index}`,F),this._loadFloatAccessorAsync(`/accessors/${E.index}`,E)]).then((U=>{let[X,F]=U;return{input:X,interpolation:b,output:F}})),X._data}loadBufferAsync(U,X,b,F){const E=this._extensionsLoadBufferAsync(U,X,b,F);if(E)return E;if(!X._data)if(X.uri)X._data=this.loadUriAsync(`${U}/uri`,X,X.uri);else{if(!this._bin)throw new Error(`${U}: Uri is missing or the binary glTF is missing its binary chunk`);X._data=this._bin.readAsync(0,X.byteLength)}return X._data.then((X=>{try{return new Uint8Array(X.buffer,X.byteOffset+b,F)}catch(E){throw new Error(`${U}: ${E.message}`)}}))}loadBufferViewAsync(U,X){const b=this._extensionsLoadBufferViewAsync(U,X);if(b)return b;if(X._data)return X._data;const F=V.Get(`${U}/buffer`,this._gltf.buffers,X.buffer);return X._data=this.loadBufferAsync(`/buffers/${F.index}`,F,X.byteOffset||0,X.byteLength),X._data}_loadAccessorAsync(U,X,b){if(X._data)return X._data;const F=L._GetNumComponents(U,X.type),E=F*P.h.GetTypeByteLength(X.componentType),w=F*X.count;if(void 0==X.bufferView)X._data=Promise.resolve(new b(w));else{const Q=V.Get(`${U}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q).then((z=>{if(5126!==X.componentType||X.normalized||Q.byteStride&&Q.byteStride!==E){const U=new b(w);return P.h.ForEach(z,X.byteOffset||0,Q.byteStride||E,F,X.componentType,U.length,X.normalized||!1,((X,b)=>{U[b]=X})),U}return L._GetTypedArray(U,X.componentType,z,X.byteOffset,w)}))}if(X.sparse){const w=X.sparse;X._data=X._data.then((Q=>{const z=Q,q=V.Get(`${U}/sparse/indices/bufferView`,this._gltf.bufferViews,w.indices.bufferView),p=V.Get(`${U}/sparse/values/bufferView`,this._gltf.bufferViews,w.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${q.index}`,q),this.loadBufferViewAsync(`/bufferViews/${p.index}`,p)]).then((Q=>{let[q,p]=Q;const S=L._GetTypedArray(`${U}/sparse/indices`,w.indices.componentType,q,w.indices.byteOffset,w.count),R=F*w.count;let n;if(5126!==X.componentType||X.normalized){const Q=L._GetTypedArray(`${U}/sparse/values`,X.componentType,p,w.values.byteOffset,R);n=new b(R),P.h.ForEach(Q,0,E,F,X.componentType,n.length,X.normalized||!1,((U,X)=>{n[X]=U}))}else n=L._GetTypedArray(`${U}/sparse/values`,X.componentType,p,w.values.byteOffset,R);let a=0;for(let U=0;U<S.length;U++){let X=S[U]*F;for(let U=0;U<F;U++)z[X++]=n[a++]}return z}))}))}return X._data}_loadFloatAccessorAsync(U,X){return this._loadAccessorAsync(U,X,Float32Array)}_loadIndicesAccessorAsync(U,X){if("SCALAR"!==X.type)throw new Error(`${U}/type: Invalid value ${X.type}`);if(5121!==X.componentType&&5123!==X.componentType&&5125!==X.componentType)throw new Error(`${U}/componentType: Invalid value ${X.componentType}`);if(X._data)return X._data;if(X.sparse){const b=L._GetTypedArrayConstructor(`${U}/componentType`,X.componentType);X._data=this._loadAccessorAsync(U,X,b)}else{const b=V.Get(`${U}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>L._GetTypedArray(U,X.componentType,b,X.byteOffset,X.count)))}return X._data}_loadVertexBufferViewAsync(U){if(U._babylonBuffer)return U._babylonBuffer;const X=this._babylonScene.getEngine();return U._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((U=>new P.d(X,U,!1))),U._babylonBuffer}_loadVertexAccessorAsync(U,X,b){var F;if(null!==(F=X._babylonVertexBuffer)&&void 0!==F&&F[b])return X._babylonVertexBuffer[b];X._babylonVertexBuffer||(X._babylonVertexBuffer={});const E=this._babylonScene.getEngine();if(X.sparse||void 0==X.bufferView)X._babylonVertexBuffer[b]=this._loadFloatAccessorAsync(U,X).then((U=>new P.h(E,U,b,!1)));else{const F=V.Get(`${U}/bufferView`,this._gltf.bufferViews,X.bufferView);X._babylonVertexBuffer[b]=this._loadVertexBufferViewAsync(F).then((w=>{const Q=L._GetNumComponents(U,X.type);return new P.h(E,w,b,!1,void 0,F.byteStride,void 0,X.byteOffset,Q,X.componentType,X.normalized,!0,void 0,!0)}))}return X._babylonVertexBuffer[b]}_loadMaterialMetallicRoughnessPropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;return X&&(X.baseColorFactor?(b.albedoColor=w.NX.uX(X.baseColorFactor),b.alpha=X.baseColorFactor[3]):b.albedoColor=w.NX.White(),b.metallic=void 0==X.metallicFactor?1:X.metallicFactor,b.roughness=void 0==X.roughnessFactor?1:X.roughnessFactor,X.baseColorTexture&&F.push(this.loadTextureInfoAsync(`${U}/baseColorTexture`,X.baseColorTexture,(U=>{U.name=`${b.name} (Base Color)`,b.albedoTexture=U}))),X.metallicRoughnessTexture&&(X.metallicRoughnessTexture.nonColorData=!0,F.push(this.loadTextureInfoAsync(`${U}/metallicRoughnessTexture`,X.metallicRoughnessTexture,(U=>{U.name=`${b.name} (Metallic Roughness)`,b.metallicTexture=U}))),b.useMetallnessFromMetallicTextureBlue=!0,b.useRoughnessFromMetallicTextureGreen=!0,b.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(F).then((()=>{}))}_loadMaterialAsync(U,X,b,F){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const w=this._extensionsLoadMaterialAsync(U,X,b,F,E);if(w)return w;X._data=X._data||{};let Q=X._data[F];if(!Q){this.logOpen(`${U} ${X.name||""}`);const b=this.createMaterial(U,X,F);Q={babylonMaterial:b,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(U,X,b)},X._data[F]=Q,L.AddPointerMetadata(b,U),this._parent.onMaterialLoadedObservable.notifyObservers(b),this.logClose()}return b&&(Q.babylonMeshes.push(b),b.wb.addOnce((()=>{const U=Q.babylonMeshes.indexOf(b);-1!==U&&Q.babylonMeshes.splice(U,1)}))),E(Q.babylonMaterial),Q.promise.then((()=>Q.babylonMaterial))}_createDefaultMaterial(U,X){this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new N.b(U,this._babylonScene);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.fillMode=X,b.enableSpecularAntiAliasing=!0,b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,b.transparencyMode=N.b.PBRMATERIAL_OPAQUE,b.metallic=1,b.roughness=1,b}createMaterial(U,X,b){const F=this._extensionsCreateMaterial(U,X,b);if(F)return F;const E=X.name||`material${X.index}`;return this._createDefaultMaterial(E,b)}loadMaterialPropertiesAsync(U,X,b){const F=this._extensionsLoadMaterialPropertiesAsync(U,X,b);if(F)return F;const E=new Array;return E.push(this.loadMaterialBasePropertiesAsync(U,X,b)),X.pbrMetallicRoughness&&E.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${U}/pbrMetallicRoughness`,X.pbrMetallicRoughness,b)),this.loadMaterialAlphaProperties(U,X,b),Promise.all(E).then((()=>{}))}loadMaterialBasePropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;return b.emissiveColor=X.emissiveFactor?w.NX.uX(X.emissiveFactor):new w.NX(0,0,0),X.doubleSided&&(b.ib=!1,b.twoSidedLighting=!0),X.normalTexture&&(X.normalTexture.nonColorData=!0,F.push(this.loadTextureInfoAsync(`${U}/normalTexture`,X.normalTexture,(U=>{U.name=`${b.name} (Normal)`,b.bumpTexture=U}))),b.invertNormalMapX=!this._babylonScene.useRightHandedSystem,b.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=X.normalTexture.scale&&b.bumpTexture&&(b.bumpTexture.level=X.normalTexture.scale),b.forceIrradianceInFragment=!0),X.occlusionTexture&&(X.occlusionTexture.nonColorData=!0,F.push(this.loadTextureInfoAsync(`${U}/occlusionTexture`,X.occlusionTexture,(U=>{U.name=`${b.name} (Occlusion)`,b.ambientTexture=U}))),b.useAmbientInGrayScale=!0,void 0!=X.occlusionTexture.strength&&(b.ambientTextureStrength=X.occlusionTexture.strength)),X.emissiveTexture&&F.push(this.loadTextureInfoAsync(`${U}/emissiveTexture`,X.emissiveTexture,(U=>{U.name=`${b.name} (Emissive)`,b.emissiveTexture=U}))),Promise.all(F).then((()=>{}))}loadMaterialAlphaProperties(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);switch(X.alphaMode||"OPAQUE"){case"OPAQUE":b.transparencyMode=N.b.PBRMATERIAL_OPAQUE,b.alpha=1;break;case"MASK":b.transparencyMode=N.b.PBRMATERIAL_ALPHATEST,b.alphaCutOff=void 0==X.alphaCutoff?.5:X.alphaCutoff,b.albedoTexture&&(b.albedoTexture.mb=!0);break;case"BLEND":b.transparencyMode=N.b.PBRMATERIAL_ALPHABLEND,b.albedoTexture&&(b.albedoTexture.mb=!0,b.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${U}/alphaMode: Invalid value (${X.alphaMode})`)}}loadTextureInfoAsync(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const F=this._extensionsLoadTextureInfoAsync(U,X,b);if(F)return F;if(this.logOpen(`${U}`),X.texCoord>=6)throw new Error(`${U}/texCoord: Invalid value (${X.texCoord})`);const E=V.Get(`${U}/index`,this._gltf.textures,X.index);E._textureInfo=X;const w=this._loadTextureAsync(`/textures/${X.index}`,E,(F=>{F.coordinatesIndex=X.texCoord||0,L.AddPointerMetadata(F,U),this._parent.onTextureLoadedObservable.notifyObservers(F),b(F)}));return this.logClose(),w}_loadTextureAsync(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const F=this._extensionsLoadTextureAsync(U,X,b);if(F)return F;this.logOpen(`${U} ${X.name||""}`);const E=void 0==X.sampler?L.DefaultSampler:V.Get(`${U}/sampler`,this._gltf.samplers,X.sampler),w=V.Get(`${U}/source`,this._gltf.images,X.source),Q=this._createTextureAsync(U,E,w,b,void 0,!X._textureInfo.nonColorData);return this.logClose(),Q}_createTextureAsync(U,X,b){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},w=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0;const z=this._loadSampler(`/samplers/${X.index}`,X),q=new Array,p=new F;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S={noMipmap:z.noMipMaps,invertY:!1,samplingMode:z.samplingMode,H:()=>{this._disposed||p.resolve()},onError:(X,b)=>{this._disposed||p.reject(new Error(`${U}: ${b&&b.message?b.message:X||"Failed to load texture"}`))},mimeType:b.mimeType??(0,s.i)(b.uri??""),loaderOptions:w,useSRGBBuffer:!!Q&&this._parent.useSRGBBuffers},R=new u.c(null,this._babylonScene,S);return R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.push(p.promise),q.push(this.loadImageAsync(`/images/${b.index}`,b).then((U=>{const X=b.uri||`${this._fileName}#image${b.index}`,F=`data:${this._uniqueRootUrl}${X}`;R.updateURL(F,U);const E=R.getInternalTexture();E&&(E.label=b.name)}))),R.wrapU=z.wrapU,R.wrapV=z.wrapV,E(R),this._parent.useGltfTextureNames&&(R.name=b.name||b.uri||`image${b.index}`),Promise.all(q).then((()=>R))}_loadSampler(U,X){return X._data||(X._data={noMipMaps:9728===X.minFilter||9729===X.minFilter,samplingMode:L._GetTextureSamplingMode(U,X),wrapU:L._GetTextureWrapMode(`${U}/wrapS`,X.wrapS),wrapV:L._GetTextureWrapMode(`${U}/wrapT`,X.wrapT)}),X._data}loadImageAsync(U,X){if(!X._data){if(this.logOpen(`${U} ${X.name||""}`),X.uri)X._data=this.loadUriAsync(`${U}/uri`,X,X.uri);else{const b=V.Get(`${U}/bufferView`,this._gltf.bufferViews,X.bufferView);X._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}this.logClose()}return X._data}loadUriAsync(U,X,b){const F=this._extensionsLoadUriAsync(U,X,b);if(F)return F;if(!L._ValidateUri(b))throw new Error(`${U}: '${b}' is invalid`);if((0,s.k)(b)){const X=new Uint8Array((0,s.b)(b));return this.log(`${U}: Decoded ${b.substring(0,64)}... (${X.length} bytes)`),Promise.resolve(X)}return this.log(`${U}: Loading ${b}`),this._parent.preprocessUrlAsync(this._rootUrl+b).then((X=>new Promise(((F,E)=>{this._parent._loadFile(this._babylonScene,X,(X=>{this._disposed||(this.log(`${U}: Loaded ${b} (${X.byteLength} bytes)`),F(new Uint8Array(X)))}),!0,(X=>{E(new s.m(`${U}: Failed to load '${b}'${X?": "+X.status+" "+X.statusText:""}`,X))}))}))))}static AddPointerMetadata(U,X){U.metadata=U.metadata||{};const b=U._internalMetadata=U._internalMetadata||{},F=b.Sb=b.Sb||{};(F.pointers=F.pointers||[]).push(X)}static _GetTextureWrapMode(U,X){switch(X=void 0==X?10497:X){case 33071:return u.c.CLAMP_ADDRESSMODE;case 33648:return u.c.MIRROR_ADDRESSMODE;case 10497:return u.c.WRAP_ADDRESSMODE;default:return m.e.Warn(`${U}: Invalid value (${X})`),u.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(U,X){const b=void 0==X.magFilter?9729:X.magFilter,F=void 0==X.minFilter?9987:X.minFilter;if(9729===b)switch(F){case 9728:return u.c.LINEAR_NEAREST;case 9729:return u.c.LINEAR_LINEAR;case 9984:return u.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return u.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return u.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return u.c.LINEAR_LINEAR_MIPLINEAR;default:return m.e.Warn(`${U}/minFilter: Invalid value (${F})`),u.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==b&&m.e.Warn(`${U}/magFilter: Invalid value (${b})`),F){case 9728:return u.c.NEAREST_NEAREST;case 9729:return u.c.NEAREST_LINEAR;case 9984:return u.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return u.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return u.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return u.c.NEAREST_LINEAR_MIPLINEAR;default:return m.e.Warn(`${U}/minFilter: Invalid value (${F})`),u.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(U,X){try{return(0,K.q)(X)}catch(b){throw new Error(`${U}: ${b.message}`)}}static _GetTypedArray(U,X,b,F,E){const w=b.buffer;F=b.byteOffset+(F||0);const Q=L._GetTypedArrayConstructor(`${U}/componentType`,X),z=P.h.GetTypeByteLength(X);return F%z!==0?(m.e.Warn(`${U}: Copying buffer as byte offset (${F}) is not a multiple of component type byte length (${z})`),new Q(w.slice(F,F+E*z),0)):new Q(w,F,E)}static _GetNumComponents(U,X){switch(X){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${U}: Invalid type (${X})`)}static _ValidateUri(U){return Q.Tools.IsBase64(U)||-1===U.indexOf("..")}static _GetDrawMode(U,X){switch(void 0==X&&(X=4),X){case 0:return O.e.PointListDrawMode;case 1:return O.e.LineListDrawMode;case 2:return O.e.LineLoopDrawMode;case 3:return O.e.LineStripDrawMode;case 4:return O.e.TriangleFillMode;case 5:return O.e.TriangleStripDrawMode;case 6:return O.e.TriangleFanDrawMode}throw new Error(`${U}: Invalid mesh primitive mode (${X})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const U=new Array;if(this._gltf.materials)for(const X of this._gltf.materials)if(X._data)for(const b in X._data){const F=X._data[b];for(const X of F.babylonMeshes){X.Ob(!0);const b=F.babylonMaterial;U.push(b.forceCompilationAsync(X)),U.push(b.forceCompilationAsync(X,{useInstances:!0})),this._parent.useClipPlane&&(U.push(b.forceCompilationAsync(X,{clipPlane:!0})),U.push(b.forceCompilationAsync(X,{clipPlane:!0,useInstances:!0})))}}return Promise.all(U).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const U=new Array,X=this._babylonScene.lights;for(const b of X){const X=b.getShadowGenerator();X&&U.push(X.forceCompilationAsync())}return Promise.all(U).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(U){for(const X of this._extensions)X.enabled&&U(X)}_applyExtensions(U,X,b){for(const F of this._extensions)if(F.enabled){const E=`${F.name}.${X}`,w=U;w._activeLoaderExtensionFunctions=w._activeLoaderExtensionFunctions||{};const Q=w._activeLoaderExtensionFunctions;if(!Q[E]){Q[E]=!0;try{const U=b(F);if(U)return U}finally{delete Q[E]}}}return null}_extensionsOnLoading(){this._forEachExtensions((U=>U.onLoading&&U.onLoading()))}_extensionsOnReady(){this._forEachExtensions((U=>U.onReady&&U.onReady()))}_extensionsLoadSceneAsync(U,X){return this._applyExtensions(X,"loadScene",(b=>b.loadSceneAsync&&b.loadSceneAsync(U,X)))}_extensionsLoadNodeAsync(U,X,b){return this._applyExtensions(X,"loadNode",(F=>F.loadNodeAsync&&F.loadNodeAsync(U,X,b)))}_extensionsLoadCameraAsync(U,X,b){return this._applyExtensions(X,"loadCamera",(F=>F.loadCameraAsync&&F.loadCameraAsync(U,X,b)))}_extensionsLoadVertexDataAsync(U,X,b){return this._applyExtensions(X,"loadVertexData",(F=>F._loadVertexDataAsync&&F._loadVertexDataAsync(U,X,b)))}_extensionsLoadMeshPrimitiveAsync(U,X,b,F,E,w){return this._applyExtensions(E,"loadMeshPrimitive",(Q=>Q._loadMeshPrimitiveAsync&&Q._loadMeshPrimitiveAsync(U,X,b,F,E,w)))}_extensionsLoadMaterialAsync(U,X,b,F,E){return this._applyExtensions(X,"loadMaterial",(w=>w._loadMaterialAsync&&w._loadMaterialAsync(U,X,b,F,E)))}_extensionsCreateMaterial(U,X,b){return this._applyExtensions(X,"createMaterial",(F=>F.createMaterial&&F.createMaterial(U,X,b)))}_extensionsLoadMaterialPropertiesAsync(U,X,b){return this._applyExtensions(X,"loadMaterialProperties",(F=>F.loadMaterialPropertiesAsync&&F.loadMaterialPropertiesAsync(U,X,b)))}_extensionsLoadTextureInfoAsync(U,X,b){return this._applyExtensions(X,"loadTextureInfo",(F=>F.loadTextureInfoAsync&&F.loadTextureInfoAsync(U,X,b)))}_extensionsLoadTextureAsync(U,X,b){return this._applyExtensions(X,"loadTexture",(F=>F._loadTextureAsync&&F._loadTextureAsync(U,X,b)))}_extensionsLoadAnimationAsync(U,X){return this._applyExtensions(X,"loadAnimation",(b=>b.loadAnimationAsync&&b.loadAnimationAsync(U,X)))}_extensionsLoadAnimationChannelAsync(U,X,b,F,E){return this._applyExtensions(b,"loadAnimationChannel",(w=>w._loadAnimationChannelAsync&&w._loadAnimationChannelAsync(U,X,b,F,E)))}_extensionsLoadSkinAsync(U,X,b){return this._applyExtensions(b,"loadSkin",(F=>F._loadSkinAsync&&F._loadSkinAsync(U,X,b)))}_extensionsLoadUriAsync(U,X,b){return this._applyExtensions(X,"loadUri",(F=>F._loadUriAsync&&F._loadUriAsync(U,X,b)))}_extensionsLoadBufferViewAsync(U,X){return this._applyExtensions(X,"loadBufferView",(b=>b.loadBufferViewAsync&&b.loadBufferViewAsync(U,X)))}_extensionsLoadBufferAsync(U,X,b,F){return this._applyExtensions(X,"loadBuffer",(E=>E.loadBufferAsync&&E.loadBufferAsync(U,X,b,F)))}static LoadExtensionAsync(U,X,b,F){if(!X.extensions)return null;const E=X.extensions[b];return E?F(`${U}/extensions/${b}`,E):null}static LoadExtraAsync(U,X,b,F){if(!X.extras)return null;const E=X.extras[b];return E?F(`${U}/extras/${b}`,E):null}isExtensionUsed(U){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(U)}logOpen(U){this._parent._logOpen(U)}logClose(){this._parent._logClose()}log(U){this._parent._log(U)}startPerformanceCounter(U){this._parent._startPerformanceCounter(U)}endPerformanceCounter(U){this._parent._endPerformanceCounter(U)}}L.DefaultSampler={index:-1},A.e._CreateGLTF2Loader=U=>new L(U);var D=b(13233),G=b(11774),Z=b(11623),c=b(13235),r=b(13243);class M extends r.d{constructor(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",U),this._texture=U.getEngine().createRawCubeTexture(X,b,F,E,w,Q,z,q)}update(U,X,b,F){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,U,X,b,F,E)}updateRGBDAsync(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,c.i)(this._texture,U,X,b,F).then((()=>{}))}clone(){return Z.d.Clone((()=>{const U=this.fU(),X=this._texture,b=new M(U,X._bufferViewArray,X.width,X.format,X.type,X.generateMipMaps,X.invertY,X.samplingMode,X._compression);return 13===X.source&&b.updateRGBDAsync(X._bufferViewArrayArray,X._sphericalPolynomial,X._lodGenerationScale,X._lodGenerationOffset),b}),this)}}const H="EXT_lights_image_based";class T{constructor(U){this.name=H,this._loader=U,this.enabled=this._loader.isExtensionUsed(H)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.Sb.extensions;if(U&&U[this.name]){const X=U[this.name];this._lights=X.lights}}loadSceneAsync(U,X){return L.LoadExtensionAsync(U,X,this.name,(async(b,F)=>{this._loader._allMaterialsDirtyRequired=!0;const E=new Array;E.push(this._loader.loadSceneAsync(U,X)),this._loader.logOpen(`${b}`);const w=V.Get(`${b}/light`,this._lights,F.bb);return E.push(this._loadLightAsync(`/extensions/${this.name}/lights/${F.bb}`,w).then((U=>{this._loader.babylonScene.environmentTexture=U}))),this._loader.logClose(),await Promise.all(E).then((()=>{}))}))}_loadLightAsync(U,X){if(!X._loaded){const b=new Array;this._loader.logOpen(`${U}`);const F=new Array(X.specularImages.length);for(let E=0;E<X.specularImages.length;E++){const w=X.specularImages[E];F[E]=new Array(w.length);for(let X=0;X<w.length;X++){const Q=`${U}/specularImages/${E}/${X}`;this._loader.logOpen(`${Q}`);const z=w[X],q=V.Get(Q,this._loader.Sb.images,z);b.push(this._loader.loadImageAsync(`/images/${z}`,q).then((U=>{F[E][X]=U}))),this._loader.logClose()}}this._loader.logClose(),X._loaded=Promise.all(b).then((async()=>{const b=new M(this._loader.babylonScene,null,X.specularImageSize);if(b.name=X.name||"environment",X._babylonTexture=b,void 0!=X.sb&&(b.level=X.sb),X.rotation){let U=E.Quaternion.uX(X.rotation);this._loader.babylonScene.useRightHandedSystem||(U=E.Quaternion.Inverse(U)),E.Matrix.FromQuaternionToRef(U,b.getReflectionTextureMatrix())}if(!X.irradianceCoefficients)throw new Error(`${U}: Irradiance coefficients are missing`);const w=G.b.uX(X.irradianceCoefficients);w.scaleInPlace(X.sb),w.convertIrradianceToLambertianRadiance();const Q=G.f.FromHarmonics(w),z=(F.length-1)/Math.log2(X.specularImageSize);return await b.updateRGBDAsync(F,Q,z)}))}return X._loaded.then((()=>X._babylonTexture))}}t(H),y(H,!0,(U=>new T(U)));b(12175);const C="EXT_mesh_gpu_instancing";class UU{constructor(U){this.name=C,this._loader=U,this.enabled=this._loader.isExtensionUsed(C)}dispose(){this._loader=null}loadNodeAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(U,F)=>{this._loader._disableInstancedMesh++;const w=this._loader.loadNodeAsync(`/nodes/${X.index}`,X,b);if(this._loader._disableInstancedMesh--,!X._primitiveBabylonMeshes)return await w;const Q=new Array;let z=0;const q=X=>{if(void 0==F.attributes[X])return void Q.push(Promise.resolve(null));const b=V.Get(`${U}/attributes/${X}`,this._loader.Sb.accessors,F.attributes[X]);if(Q.push(this._loader._loadFloatAccessorAsync(`/accessors/${b.bufferView}`,b)),0===z)z=b.count;else if(z!==b.count)throw new Error(`${U}/attributes: Instance buffer accessors do not have the same count.`)};return q("TRANSLATION"),q("ROTATION"),q("SCALE"),await w.then((async U=>{const[b,F,w]=await Promise.all(Q),q=new Float32Array(16*z);E.TmpVectors.JX[0].Pb(0,0,0),E.TmpVectors.Quaternion[0].Pb(0,0,0,1),E.TmpVectors.JX[1].Pb(1,1,1);for(let X=0;X<z;++X)b&&E.JX.FromArrayToRef(b,3*X,E.TmpVectors.JX[0]),F&&E.Quaternion.FromArrayToRef(F,4*X,E.TmpVectors.Quaternion[0]),w&&E.JX.FromArrayToRef(w,3*X,E.TmpVectors.JX[1]),E.Matrix.ComposeToRef(E.TmpVectors.JX[1],E.TmpVectors.Quaternion[0],E.TmpVectors.JX[0],E.TmpVectors.Matrix[0]),E.TmpVectors.Matrix[0].copyToArray(q,16*X);for(const E of X._primitiveBabylonMeshes)E.eR("matrix",q,16,!0);return U}))}))}}t(C),y(C,!0,(U=>new UU(U)));let XU=0,bU=null;class FU{static get Default(){return FU._Default||(FU._Default=new FU),FU._Default}constructor(){const U=FU.Configuration.decoder;this._decoderModulePromise=Q.Tools.LoadBabylonScriptAsync(U.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(U,X,b,F,E){await this._decoderModulePromise,0===XU&&(MeshoptDecoder.useWorkers(1),XU=1);const w=await MeshoptDecoder.decodeGltfBufferAsync(X,b,U,F,E);return null!==bU&&clearTimeout(bU),bU=setTimeout((()=>{MeshoptDecoder.useWorkers(0),XU=0,bU=null}),1e3),w}}FU.Configuration={decoder:{url:`${Q.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},FU._Default=null;const EU="EXT_meshopt_compression";class wU{constructor(U){this.name=EU,this.enabled=U.isExtensionUsed(EU),this._loader=U}dispose(){this._loader=null}loadBufferViewAsync(U,X){return L.LoadExtensionAsync(U,X,this.name,(async(b,F)=>{const E=X;if(E._meshOptData)return await E._meshOptData;const w=V.Get(`${U}/buffer`,this._loader.Sb.buffers,F.buffer);return E._meshOptData=this._loader.loadBufferAsync(`/buffers/${w.index}`,w,F.byteOffset||0,F.byteLength).then((async U=>await FU.Default.decodeGltfBufferAsync(U,F.count,F.byteStride,F.mode,F.filter))),await E._meshOptData}))}}t(EU),y(EU,!0,(U=>new wU(U)));const QU="EXT_texture_webp";class zU{constructor(U){this.name=QU,this._loader=U,this.enabled=U.isExtensionUsed(QU)}dispose(){this._loader=null}_loadTextureAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=void 0==X.sampler?L.DefaultSampler:V.Get(`${U}/sampler`,this._loader.Sb.samplers,X.sampler),Q=V.Get(`${F}/source`,this._loader.Sb.images,E.source);return await this._loader._createTextureAsync(U,w,Q,(U=>{b(U)}),void 0,!X._textureInfo.nonColorData)}))}}t(QU),y(QU,!0,(U=>new zU(U)));const qU="EXT_texture_avif";class pU{constructor(U){this.name=qU,this._loader=U,this.enabled=U.isExtensionUsed(qU)}dispose(){this._loader=null}_loadTextureAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=void 0==X.sampler?L.DefaultSampler:V.Get(`${U}/sampler`,this._loader.Sb.samplers,X.sampler),Q=V.Get(`${F}/source`,this._loader.Sb.images,E.source);return await this._loader._createTextureAsync(U,w,Q,(U=>{b(U)}),void 0,!X._textureInfo.nonColorData)}))}}t(qU),y(qU,!0,(U=>new pU(U)));var SU=b(13227),RU=b(12158);const nU="EXT_lights_ies";class aU{constructor(U){this.name=nU,this._loader=U,this.enabled=this._loader.isExtensionUsed(nU)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.Sb.extensions;if(U&&U[this.name]){const X=U[this.name];this._lights=X.lights,V.Assign(this._lights)}}loadNodeAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,Q)=>{let z,q;this._loader._allMaterialsDirtyRequired=!0;const p=await this._loader.loadNodeAsync(U,X,(U=>{q=V.Get(F,this._lights,Q.bb);const X=q.name||U.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,z=new SU.c(X,E.JX.Zero(),E.JX.Backward(),0,1,this._loader.babylonScene),z.angle=Math.PI/2,z.innerAngle=0,z._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,q._babylonLight=z,z.falloffType=RU.c.FALLOFF_GLTF,z.hb=Q.color?w.NX.uX(Q.color):w.NX.White(),z.sb=Q.multiplier||1,z.range=Number.MAX_VALUE,z.parent=U,this._loader._babylonLights.push(z),L.AddPointerMetadata(z,F),b(U)}));let S;if(q.uri)S=await this._loader.loadUriAsync(U,q,q.uri);else{const X=V.Get(`${U}/bufferView`,this._loader.Sb.bufferViews,q.bufferView);S=await this._loader.loadBufferViewAsync(`/bufferViews/${X.index}`,X)}return z.iesProfileTexture=new u.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,S,!0,void 0,void 0,void 0,void 0,".ies"),p}))}}t(nU),y(nU,!0,(U=>new aU(U)));var JU=b(13258);const mU="KHR_draco_mesh_compression";class xU{constructor(U){this.name=mU,this.useNormalizedFlagFromAccessor=!0,this._loader=U,this.enabled=JU.c.DefaultAvailable&&this._loader.isExtensionUsed(mU)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{if(void 0!=X.mode&&4!==X.mode&&5!==X.mode)throw new Error(`${U}: Unsupported mode ${X.mode}`);const w={},Q={},z=(U,F)=>{const z=E.attributes[U];if(void 0!=z&&(b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(F)&&b._delayInfo.push(F),w[F]=z,this.useNormalizedFlagFromAccessor)){const b=V.TryGet(this._loader.Sb.accessors,X.attributes[U]);b&&(Q[F]=b.normalized||!1)}};z("POSITION",P.h.PositionKind),z("NORMAL",P.h.NormalKind),z("TANGENT",P.h.TangentKind),z("TEXCOORD_0",P.h.UVKind),z("TEXCOORD_1",P.h.UV2Kind),z("TEXCOORD_2",P.h.UV3Kind),z("TEXCOORD_3",P.h.UV4Kind),z("TEXCOORD_4",P.h.UV5Kind),z("TEXCOORD_5",P.h.UV6Kind),z("JOINTS_0",P.h.MatricesIndicesKind),z("WEIGHTS_0",P.h.MatricesWeightsKind),z("COLOR_0",P.h.ColorKind);const q=V.Get(F,this._loader.Sb.bufferViews,E.bufferView);return q._dracoBabylonGeometry||(q._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((async F=>{const E=this.dracoDecoder||JU.c.Default,z=V.TryGet(this._loader.Sb.accessors,X.attributes.POSITION),q=this._loader.parent.alwaysComputeBoundingBox||b.skeleton||!z?null:g(z);return await E._decodeMeshToGeometryForGltfAsync(b.name,this._loader.babylonScene,F,w,Q,q).catch((X=>{throw new Error(`${U}: ${X.message}`)}))}))),await q._dracoBabylonGeometry}))}}t(mU),y(mU,!0,(U=>new xU(U)));var IU=b(13263),OU=b(11576),NU=b(11583),uU=b(12034),iU=b(12210),PU=b(11551);uU.c.AddNodeConstructor("Light_Type_0",((U,X)=>()=>new fU(U,E.JX.Zero(),X)));class fU extends iU.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(U){this._shadowAngle=U,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(U){const X=this.needCube();if(this._direction=U,this.needCube()!==X&&this._shadowGenerators){const U=this._shadowGenerators.values();for(let X=U.next();!0!==X.done;X=U.next()){X.value.recreateShadowMap()}}}constructor(U,X,b){super(U,b),this._shadowAngle=Math.PI/2,this.position=X}getClassName(){return"PointLight"}getTypeID(){return RU.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(U){if(this.direction)return super.getShadowDirection(U);switch(U){case 0:return new E.JX(1,0,0);case 1:return new E.JX(-1,0,0);case 2:return new E.JX(0,-1,0);case 3:return new E.JX(0,1,0);case 4:return new E.JX(0,0,1);case 5:return new E.JX(0,0,-1)}return E.JX.Zero()}_setDefaultShadowProjectionMatrix(U,X,b){const F=this.fU().activeCamera;if(!F)return;const w=void 0!==this.shadowMinZ?this.shadowMinZ:F.xb,Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:F.maxZ,z=this.fU().getEngine().useReverseDepthBuffer;E.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,z?Q:w,z?w:Q,U,!0,this._scene.getEngine().isNDCHalfZRange,void 0,z)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(U,X){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,X):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,X),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,X),this}transferToNodeMaterialEffect(U,X){return this.computeTransformedInformation()?U.setFloat3(X,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):U.setFloat3(X,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(U,X){U["POINTLIGHT"+X]=!0}}(0,OU.c)([(0,NU.J)()],fU.prototype,"shadowAngle",null),(0,PU.f)("BABYLON.PointLight",fU);const jU="KHR_lights_punctual";class eU{constructor(U){this.name=jU,this._loader=U,this.enabled=this._loader.isExtensionUsed(jU)}dispose(){this._loader=null,delete this._lights}onLoading(){const U=this._loader.Sb.extensions;if(U&&U[this.name]){const X=U[this.name];this._lights=X.lights,V.Assign(this._lights)}}loadNodeAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,Q)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(U,X,(U=>{let X;const z=V.Get(F,this._lights,Q.bb),q=z.name||U.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,z.type){case"directional":{const U=new IU.c(q,E.JX.Backward(),this._loader.babylonScene);U.position.jb(0),X=U;break}case"point":X=new fU(q,E.JX.Zero(),this._loader.babylonScene);break;case"spot":{const U=new SU.c(q,E.JX.Zero(),E.JX.Backward(),0,1,this._loader.babylonScene);U.angle=2*(z.spot&&z.spot.outerConeAngle||Math.PI/4),U.innerAngle=2*(z.spot&&z.spot.innerConeAngle||0),X=U;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${F}: Invalid light type (${z.type})`)}X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,z._babylonLight=X,X.falloffType=RU.c.FALLOFF_GLTF,X.hb=z.color?w.NX.uX(z.color):w.NX.White(),X.sb=void 0==z.sb?1:z.sb,X.range=void 0==z.range?Number.MAX_VALUE:z.range,X.parent=U,this._loader._babylonLights.push(X),L.AddPointerMetadata(X,F),b(U)})))))}}t(jU),y(jU,!0,(U=>new eU(U)));const lU="KHR_materials_pbrSpecularGlossiness";class dU{constructor(U){this.name=lU,this.order=200,this._loader=U,this.enabled=this._loader.isExtensionUsed(lU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;return w.push(this._loader.loadMaterialBasePropertiesAsync(U,X,b)),w.push(this._loadSpecularGlossinessPropertiesAsync(F,E,b)),this._loader.loadMaterialAlphaProperties(U,X,b),await Promise.all(w).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;return b.metallic=null,b.roughness=null,X.diffuseFactor?(b.albedoColor=w.NX.uX(X.diffuseFactor),b.alpha=X.diffuseFactor[3]):b.albedoColor=w.NX.White(),b.reflectivityColor=X.specularFactor?w.NX.uX(X.specularFactor):w.NX.White(),b.microSurface=void 0==X.glossinessFactor?1:X.glossinessFactor,X.diffuseTexture&&F.push(this._loader.loadTextureInfoAsync(`${U}/diffuseTexture`,X.diffuseTexture,(U=>{U.name=`${b.name} (Diffuse)`,b.albedoTexture=U}))),X.specularGlossinessTexture&&(F.push(this._loader.loadTextureInfoAsync(`${U}/specularGlossinessTexture`,X.specularGlossinessTexture,(U=>{U.name=`${b.name} (Specular Glossiness)`,b.reflectivityTexture=U,b.reflectivityTexture.mb=!0}))),b.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(F).then((()=>{}))}}t(lU),y(lU,!0,(U=>new dU(U)));const kU="KHR_materials_unlit";class vU{constructor(U){this.name=kU,this.order=210,this._loader=U,this.enabled=this._loader.isExtensionUsed(kU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async()=>await this._loadUnlitPropertiesAsync(U,X,b)))}_loadUnlitPropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;b.unlit=!0;const E=X.pbrMetallicRoughness;return E&&(E.baseColorFactor?(b.albedoColor=w.NX.uX(E.baseColorFactor),b.alpha=E.baseColorFactor[3]):b.albedoColor=w.NX.White(),E.baseColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${U}/baseColorTexture`,E.baseColorTexture,(U=>{U.name=`${b.name} (Base Color)`,b.albedoTexture=U})))),X.doubleSided&&(b.ib=!1,b.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(U,X,b),Promise.all(F).then((()=>{}))}}t(kU),y(kU,!0,(U=>new vU(U)));const AU="KHR_materials_clearcoat";class sU{constructor(U){this.name=AU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(AU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadClearCoatPropertiesAsync(F,E,b)),await Promise.all(w)}))}_loadClearCoatPropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;return b.clearCoat.isEnabled=!0,b.clearCoat.useRoughnessFromMainTexture=!1,b.clearCoat.remapF0OnInterfaceChange=!1,void 0!=X.clearcoatFactor?b.clearCoat.sb=X.clearcoatFactor:b.clearCoat.sb=0,X.clearcoatTexture&&F.push(this._loader.loadTextureInfoAsync(`${U}/clearcoatTexture`,X.clearcoatTexture,(U=>{U.name=`${b.name} (ClearCoat)`,b.clearCoat.texture=U}))),void 0!=X.clearcoatRoughnessFactor?b.clearCoat.roughness=X.clearcoatRoughnessFactor:b.clearCoat.roughness=0,X.clearcoatRoughnessTexture&&(X.clearcoatRoughnessTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${U}/clearcoatRoughnessTexture`,X.clearcoatRoughnessTexture,(U=>{U.name=`${b.name} (ClearCoat Roughness)`,b.clearCoat.textureRoughness=U})))),X.clearcoatNormalTexture&&(X.clearcoatNormalTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${U}/clearcoatNormalTexture`,X.clearcoatNormalTexture,(U=>{U.name=`${b.name} (ClearCoat Normal)`,b.clearCoat.bumpTexture=U}))),b.invertNormalMapX=!b.fU().useRightHandedSystem,b.invertNormalMapY=b.fU().useRightHandedSystem,void 0!=X.clearcoatNormalTexture.scale&&(b.clearCoat.bumpTexture.level=X.clearcoatNormalTexture.scale)),Promise.all(F).then((()=>{}))}}t(AU),y(AU,!0,(U=>new sU(U)));const hU="KHR_materials_iridescence";class BU{constructor(U){this.name=hU,this.order=195,this._loader=U,this.enabled=this._loader.isExtensionUsed(hU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadIridescencePropertiesAsync(F,E,b)),await Promise.all(w).then((()=>{}))}))}_loadIridescencePropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;return b.iridescence.isEnabled=!0,b.iridescence.sb=X.iridescenceFactor??0,b.iridescence.indexOfRefraction=X.iridescenceIor??X.iridescenceIOR??1.3,b.iridescence.minimumThickness=X.iridescenceThicknessMinimum??100,b.iridescence.maximumThickness=X.iridescenceThicknessMaximum??400,X.iridescenceTexture&&F.push(this._loader.loadTextureInfoAsync(`${U}/iridescenceTexture`,X.iridescenceTexture,(U=>{U.name=`${b.name} (Iridescence)`,b.iridescence.texture=U}))),X.iridescenceThicknessTexture&&F.push(this._loader.loadTextureInfoAsync(`${U}/iridescenceThicknessTexture`,X.iridescenceThicknessTexture,(U=>{U.name=`${b.name} (Iridescence Thickness)`,b.iridescence.thicknessTexture=U}))),Promise.all(F).then((()=>{}))}}t(hU),y(hU,!0,(U=>new BU(U)));const oU="KHR_materials_anisotropy";class yU{constructor(U){this.name=oU,this.order=195,this._loader=U,this.enabled=this._loader.isExtensionUsed(oU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadIridescencePropertiesAsync(F,E,b)),await Promise.all(w)}))}async _loadIridescencePropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;b.anisotropy.isEnabled=!0,b.anisotropy.sb=X.anisotropyStrength??0,b.anisotropy.angle=X.anisotropyRotation??0,X.anisotropyTexture&&(X.anisotropyTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${U}/anisotropyTexture`,X.anisotropyTexture,(U=>{U.name=`${b.name} (Anisotropy Intensity)`,b.anisotropy.texture=U})))),await Promise.all(F)}}t(oU),y(oU,!0,(U=>new yU(U)));const tU="KHR_materials_emissive_strength";class WU{constructor(U){this.name=tU,this.order=170,this._loader=U,this.enabled=this._loader.isExtensionUsed(tU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>await this._loader.loadMaterialPropertiesAsync(U,X,b).then((()=>{this._loadEmissiveProperties(F,E,b)}))))}_loadEmissiveProperties(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);void 0!==X.emissiveStrength&&(b.emissiveIntensity=X.emissiveStrength)}}t(tU),y(tU,!0,(U=>new WU(U)));const YU="KHR_materials_sheen";class KU{constructor(U){this.name=YU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(YU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadSheenPropertiesAsync(F,E,b)),await Promise.all(w).then((()=>{}))}))}_loadSheenPropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;return b.sheen.isEnabled=!0,b.sheen.sb=1,void 0!=X.sheenColorFactor?b.sheen.color=w.NX.uX(X.sheenColorFactor):b.sheen.color=w.NX.Black(),X.sheenColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${U}/sheenColorTexture`,X.sheenColorTexture,(U=>{U.name=`${b.name} (Sheen Color)`,b.sheen.texture=U}))),void 0!==X.sheenRoughnessFactor?b.sheen.roughness=X.sheenRoughnessFactor:b.sheen.roughness=0,X.sheenRoughnessTexture&&(X.sheenRoughnessTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${U}/sheenRoughnessTexture`,X.sheenRoughnessTexture,(U=>{U.name=`${b.name} (Sheen Roughness)`,b.sheen.textureRoughness=U})))),b.sheen.albedoScaling=!0,b.sheen.useRoughnessFromMainTexture=!1,Promise.all(F).then((()=>{}))}}t(YU),y(YU,!0,(U=>new KU(U)));var VU=b(12104);const gU="KHR_materials_specular";class LU{constructor(U){this.name=gU,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(gU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;if(w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadSpecularPropertiesAsync(F,E,b)),E.extensions&&E.extensions.EXT_materials_specular_edge_color&&b instanceof N.b){E.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(b.brdf.dielectricSpecularModel=VU.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,b.brdf.conductorSpecularModel=VU.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(w).then((()=>{}))}))}_loadSpecularPropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;return void 0!==X.specularFactor&&(b.metallicF0Factor=X.specularFactor),void 0!==X.specularColorFactor&&(b.metallicReflectanceColor=w.NX.uX(X.specularColorFactor)),X.specularTexture&&(X.specularTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${U}/specularTexture`,X.specularTexture,(U=>{U.name=`${b.name} (Specular)`,b.metallicReflectanceTexture=U,b.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),X.specularColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${U}/specularColorTexture`,X.specularColorTexture,(U=>{U.name=`${b.name} (Specular Color)`,b.reflectanceTexture=U}))),Promise.all(F).then((()=>{}))}}t(gU),y(gU,!0,(U=>new LU(U)));const DU="KHR_materials_ior";class GU{constructor(U){this.name=DU,this.order=180,this._loader=U,this.enabled=this._loader.isExtensionUsed(DU)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadIorPropertiesAsync(F,E,b)),await Promise.all(w).then((()=>{}))}))}_loadIorPropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);return void 0!==X.ior?b.indexOfRefraction=X.ior:b.indexOfRefraction=GU._DEFAULT_IOR,Promise.resolve()}}GU._DEFAULT_IOR=1.5,t(DU),y(DU,!0,(U=>new GU(U)));const ZU="KHR_materials_variants";class cU{constructor(U){this.name=ZU,this._loader=U,this.enabled=this._loader.isExtensionUsed(ZU)}dispose(){this._loader=null}static GetAvailableVariants(U){const X=this._GetExtensionMetadata(U);return X?Object.keys(X.variants):[]}getAvailableVariants(U){return cU.GetAvailableVariants(U)}static SelectVariant(U,X){const b=this._GetExtensionMetadata(U);if(!b)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${ZU} extension`);const F=U=>{const X=b.variants[U];if(X)for(const b of X)b.mesh.material=b.material};if(X instanceof Array)for(const E of X)F(E);else F(X);b.lastSelected=X}selectVariant(U,X){cU.SelectVariant(U,X)}static Reset(U){const X=this._GetExtensionMetadata(U);if(!X)throw new Error(`Cannot reset on a glTF mesh that does not have the ${ZU} extension`);for(const b of X.original)b.mesh.material=b.material;X.lastSelected=null}reset(U){cU.Reset(U)}static GetLastSelectedVariant(U){const X=this._GetExtensionMetadata(U);if(!X)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${ZU} extension`);return X.lastSelected}getLastSelectedVariant(U){return cU.GetLastSelectedVariant(U)}static _GetExtensionMetadata(U){var X,b;return(null===U||void 0===U||null===(X=U._internalMetadata)||void 0===X||null===(b=X.Sb)||void 0===b?void 0:b[ZU])||null}onLoading(){const U=this._loader.Sb.extensions;if(U&&U[this.name]){const X=U[this.name];this._variants=X.variants}}onReady(){const U=this._loader.rootBabylonMesh;if(U){var X;const b=this._loader.parent.extensionOptions[ZU];null!==b&&void 0!==b&&b.defaultVariant&&cU.SelectVariant(U,b.defaultVariant),null===b||void 0===b||null===(X=b.onLoaded)||void 0===X||X.call(b,{get variants(){return cU.GetAvailableVariants(U)},get selectedVariant(){const X=cU.GetLastSelectedVariant(U);return X?Array.isArray(X)?X[0]:X:cU.GetAvailableVariants(U)[0]},set selectedVariant(X){cU.SelectVariant(U,X)}})}}_loadMeshPrimitiveAsync(U,X,b,F,E,w){return L.LoadExtensionAsync(U,E,this.name,(async(Q,z)=>{const q=new Array;return q.push(this._loader._loadMeshPrimitiveAsync(U,X,b,F,E,(X=>{if(w(X),X instanceof e.e){const b=L._GetDrawMode(U,E.mode),F=this._loader.rootBabylonMesh,w=F?F._internalMetadata=F._internalMetadata||{}:{},p=w.Sb=w.Sb||{},S=p[ZU]=p[ZU]||{lastSelected:null,original:[],variants:{}};S.original.push({mesh:X,material:X.material});for(let U=0;U<z.mappings.length;++U){const E=z.mappings[U],w=V.Get(`${Q}/mappings/${U}/material`,this._loader.Sb.materials,E.material);q.push(this._loader._loadMaterialAsync(`#/materials/${E.material}`,w,X,b,(U=>{for(let b=0;b<E.variants.length;++b){const w=E.variants[b],Q=V.Get(`/extensions/${ZU}/variants/${w}`,this._variants,w);S.variants[Q.name]=S.variants[Q.name]||[],S.variants[Q.name].push({mesh:X,material:U}),X.onClonedObservable.add((U=>{const b=U;let E=null,w=b;do{if(w=w.parent,!w)return;E=cU._GetExtensionMetadata(w)}while(null===E);if(F&&E===cU._GetExtensionMetadata(F)){w._internalMetadata={};for(const U in F._internalMetadata)w._internalMetadata[U]=F._internalMetadata[U];w._internalMetadata.Sb=[];for(const U in F._internalMetadata.Sb)w._internalMetadata.Sb[U]=F._internalMetadata.Sb[U];w._internalMetadata.Sb[ZU]={lastSelected:null,original:[],variants:{}};for(const U of E.original)w._internalMetadata.Sb[ZU].original.push({mesh:U.mesh,material:U.material});for(const U in E.variants)if(Object.prototype.hasOwnProperty.call(E.variants,U)){w._internalMetadata.Sb[ZU].variants[U]=[];for(const X of E.variants[U])w._internalMetadata.Sb[ZU].variants[U].push({mesh:X.mesh,material:X.material})}E=w._internalMetadata.Sb[ZU]}for(const F of E.original)F.mesh===X&&(F.mesh=b);for(const F of E.variants[Q.name])F.mesh===X&&(F.mesh=b)}))}})))}}}))),await Promise.all(q).then((U=>{let[X]=U;return X}))}))}}t(ZU),y(ZU,!0,(U=>new cU(U)));var rU=b(11654);class MU{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:VU.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(U,X){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...MU._GetDefaultOptions(),...U},this._scene=X,this._scene._transmissionHelper=this,this.onErrorObservable=new S.e,this._scene.wb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(U){if(!Object.keys(U).filter((X=>this._options[X]!==U[X])).length)return;const X={...this._options,...U},b=this._options;this._options=X,X.renderSize===b.renderSize&&X.renderTargetTextureType===b.renderTargetTextureType&&X.generateMipmaps===b.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=X.samples,this._opaqueRenderTarget.lodGenerationScale=X.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=X.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(U){return!!U&&!!(U instanceof N.b&&U.subSurface.isRefractionEnabled)}_addMesh(U){this._materialObservers[U.uniqueId]=U.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Q.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(U.material)?(U.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(U)&&this._transparentMeshesCache.push(U)):-1===this._opaqueMeshesCache.indexOf(U)&&this._opaqueMeshesCache.push(U)}))}_removeMesh(U){U.onMaterialChangedObservable.remove(this._materialObservers[U.uniqueId]),delete this._materialObservers[U.uniqueId];let X=this._transparentMeshesCache.indexOf(U);-1!==X&&this._transparentMeshesCache.splice(X,1),X=this._opaqueMeshesCache.indexOf(U),-1!==X&&this._opaqueMeshesCache.splice(X,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(U){const X=this._transparentMeshesCache.indexOf(U),b=this._opaqueMeshesCache.indexOf(U);this._shouldRenderAsTransmission(U.material)?(U.material instanceof N.b&&(U.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==b?(this._opaqueMeshesCache.splice(b,1),this._transparentMeshesCache.push(U)):-1===X&&this._transparentMeshesCache.push(U)):-1!==X?(this._transparentMeshesCache.splice(X,1),this._opaqueMeshesCache.push(U)):-1===b&&this._opaqueMeshesCache.push(U)}_isRenderTargetValid(){var U;return null!==(null===(U=this._opaqueRenderTarget)||void 0===U?void 0:U.getInternalTexture())}_setupRenderTargets(){var U;let X;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new rU.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(U=this._options.clearColor)||void 0===U?void 0:U.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((U=>{X=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?U.clearColor.q(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(U.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=X}));for(const b of this._transparentMeshesCache)this._shouldRenderAsTransmission(b.material)&&(b.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const HU="KHR_materials_transmission";class TU{constructor(U){this.name=HU,this.order=175,this._loader=U,this.enabled=this._loader.isExtensionUsed(HU),this.enabled&&(U.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadTransparentPropertiesAsync(F,X,b,E)),await Promise.all(w).then((()=>{}))}))}_loadTransparentPropertiesAsync(U,X,b,F){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const E=b;if(E.subSurface.isRefractionEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.useAlbedoToTintRefraction=!0,void 0===F.transmissionFactor)return E.subSurface.refractionIntensity=0,E.subSurface.isRefractionEnabled=!1,Promise.resolve();{var w;E.subSurface.refractionIntensity=F.transmissionFactor;const U=E.fU();if(E.subSurface.refractionIntensity&&!U._transmissionHelper)new MU({},E.fU());else if(E.subSurface.refractionIntensity&&(null===(w=U._transmissionHelper)||void 0===w||!w._isRenderTargetValid())){var Q;null===(Q=U._transmissionHelper)||void 0===Q||Q._setupRenderTargets()}}return E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,F.transmissionTexture?(F.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${U}/transmissionTexture`,F.transmissionTexture,void 0).then((U=>{U.name=`${b.name} (Transmission)`,E.subSurface.refractionIntensityTexture=U,E.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}t(HU),y(HU,!0,(U=>new TU(U)));const CU="KHR_materials_diffuse_transmission";class UX{constructor(U){this.name=CU,this.order=174,this._loader=U,this.enabled=this._loader.isExtensionUsed(CU),this.enabled&&(U.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadTranslucentPropertiesAsync(F,X,b,E)),await Promise.all(w).then((()=>{}))}))}_loadTranslucentPropertiesAsync(U,X,b,F){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const E=b;if(E.subSurface.isTranslucencyEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,E.subSurface.useAlbedoToTintTranslucency=!1,void 0===F.diffuseTransmissionFactor)return E.subSurface.translucencyIntensity=0,E.subSurface.isTranslucencyEnabled=!1,Promise.resolve();E.subSurface.translucencyIntensity=F.diffuseTransmissionFactor;const Q=new Array;return E.subSurface.useGltfStyleTextures=!0,F.diffuseTransmissionTexture&&(F.diffuseTransmissionTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${U}/diffuseTransmissionTexture`,F.diffuseTransmissionTexture).then((U=>{U.name=`${b.name} (Diffuse Transmission)`,E.subSurface.translucencyIntensityTexture=U})))),void 0!==F.diffuseTransmissionColorFactor?E.subSurface.translucencyColor=w.NX.uX(F.diffuseTransmissionColorFactor):E.subSurface.translucencyColor=w.NX.White(),F.diffuseTransmissionColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${U}/diffuseTransmissionColorTexture`,F.diffuseTransmissionColorTexture).then((U=>{U.name=`${b.name} (Diffuse Transmission Color)`,E.subSurface.translucencyColorTexture=U}))),Promise.all(Q).then((()=>{}))}}t(CU),y(CU,!0,(U=>new UX(U)));const XX="KHR_materials_volume";class bX{constructor(U){this.name=XX,this.order=173,this._loader=U,this.enabled=this._loader.isExtensionUsed(XX),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadVolumePropertiesAsync(F,X,b,E)),await Promise.all(w).then((()=>{}))}))}_loadVolumePropertiesAsync(U,X,b,F){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);if(!b.subSurface.isRefractionEnabled&&!b.subSurface.isTranslucencyEnabled||!F.thicknessFactor)return Promise.resolve();b.subSurface.volumeIndexOfRefraction=b.indexOfRefraction;const E=void 0!==F.attenuationDistance?F.attenuationDistance:Number.MAX_VALUE;return b.subSurface.tintColorAtDistance=E,void 0!==F.attenuationColor&&3==F.attenuationColor.length&&b.subSurface.tintColor.Pb(F.attenuationColor[0],F.attenuationColor[1],F.attenuationColor[2]),b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=F.thicknessFactor,b.subSurface.useThicknessAsDepth=!0,F.thicknessTexture?(F.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${U}/thicknessTexture`,F.thicknessTexture).then((U=>{U.name=`${b.name} (Thickness)`,b.subSurface.thicknessTexture=U,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}t(XX),y(XX,!0,(U=>new bX(U)));const FX="KHR_materials_dispersion";class EX{constructor(U){this.name=FX,this.order=174,this._loader=U,this.enabled=this._loader.isExtensionUsed(FX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadDispersionPropertiesAsync(F,X,b,E)),await Promise.all(w).then((()=>{}))}))}_loadDispersionPropertiesAsync(U,X,b,F){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);return b.subSurface.isRefractionEnabled&&F.dispersion?(b.subSurface.isDispersionEnabled=!0,b.subSurface.dispersion=F.dispersion,Promise.resolve()):Promise.resolve()}}t(FX),y(FX,!0,(U=>new EX(U)));const wX="EXT_materials_diffuse_roughness";class QX{constructor(U){this.name=wX,this.order=190,this._loader=U,this.enabled=this._loader.isExtensionUsed(wX)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=new Array;return w.push(this._loader.loadMaterialPropertiesAsync(U,X,b)),w.push(this._loadDiffuseRoughnessPropertiesAsync(F,E,b)),await Promise.all(w).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(U,X,b){if(!(b instanceof N.b))throw new Error(`${U}: Material type not supported`);const F=new Array;return b.brdf.baseDiffuseModel=VU.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=X.diffuseRoughnessFactor?b.baseDiffuseRoughness=X.diffuseRoughnessFactor:b.baseDiffuseRoughness=0,X.diffuseRoughnessTexture&&F.push(this._loader.loadTextureInfoAsync(`${U}/diffuseRoughnessTexture`,X.diffuseRoughnessTexture,(U=>{U.name=`${b.name} (Diffuse Roughness)`,b.baseDiffuseRoughnessTexture=U}))),Promise.all(F).then((()=>{}))}}t(wX),y(wX,!0,(U=>new QX(U)));const zX="KHR_mesh_quantization";class qX{constructor(U){this.name=zX,this.enabled=U.isExtensionUsed(zX)}dispose(){}}t(zX),y(zX,!0,(U=>new qX(U)));const pX="KHR_texture_basisu";class SX{constructor(U){this.name=pX,this._loader=U,this.enabled=U.isExtensionUsed(pX)}dispose(){this._loader=null}_loadTextureAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>{const w=void 0==X.sampler?L.DefaultSampler:V.Get(`${U}/sampler`,this._loader.Sb.samplers,X.sampler),Q=V.Get(`${F}/source`,this._loader.Sb.images,E.source);return await this._loader._createTextureAsync(U,w,Q,(U=>{b(U)}),X._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!X._textureInfo.nonColorData)}))}}t(pX),y(pX,!0,(U=>new SX(U)));const RX="KHR_texture_transform";class nX{constructor(U){this.name=RX,this._loader=U,this.enabled=this._loader.isExtensionUsed(RX)}dispose(){this._loader=null}loadTextureInfoAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(F,E)=>await this._loader.loadTextureInfoAsync(U,X,(U=>{if(!(U instanceof u.c))throw new Error(`${F}: Texture type not supported`);E.offset&&(U.uOffset=E.offset[0],U.vOffset=E.offset[1]),U.uRotationCenter=0,U.vRotationCenter=0,E.rotation&&(U.wAng=-E.rotation),E.scale&&(U.uScale=E.scale[0],U.vScale=E.scale[1]),void 0!=E.texCoord&&(U.coordinatesIndex=E.texCoord),b(U)}))))}}t(RX),y(RX,!0,(U=>new nX(U)));const aX="KHR_xmp_json_ld";class JX{constructor(U){this.name=aX,this.order=100,this._loader=U,this.enabled=this._loader.isExtensionUsed(aX)}dispose(){this._loader=null}onLoading(){var U,X,b;if(null===this._loader.rootBabylonMesh)return;const F=null===(U=this._loader.Sb.extensions)||void 0===U?void 0:U.KHR_xmp_json_ld,E=null===(X=this._loader.Sb.asset)||void 0===X||null===(b=X.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld;if(F&&E){const U=+E.packet;F.packets&&U<F.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=F.packets[U])}}}function mX(U,X,b,F){return w.NX.uX(X,b).scale(F)}function xX(U,X,b,F){return X[b]*F}function IX(U,X,b,F){return-X[b]*F}function OX(U,X,b,F){return X[b+1]*F}function NX(U,X,b,F){return X[b]*F*2}function uX(U){return{scale:[new PX(n.e.ANIMATIONTYPE_FLOAT,`${U}.uScale`,xX,(()=>2)),new PX(n.e.ANIMATIONTYPE_FLOAT,`${U}.vScale`,OX,(()=>2))],offset:[new PX(n.e.ANIMATIONTYPE_FLOAT,`${U}.uOffset`,xX,(()=>2)),new PX(n.e.ANIMATIONTYPE_FLOAT,`${U}.vOffset`,OX,(()=>2))],rotation:[new PX(n.e.ANIMATIONTYPE_FLOAT,`${U}.wAng`,IX,(()=>1))]}}t(aX),y(aX,!0,(U=>new JX(U)));class iX extends D.AnimationPropertyInfo{buildAnimations(U,X,b,F){return[{babylonAnimatable:U._babylonCamera,babylonAnimation:this._buildAnimation(X,b,F)}]}}class PX extends D.AnimationPropertyInfo{buildAnimations(U,X,b,F){const E=[];for(const w in U._data)E.push({babylonAnimatable:U._data[w].babylonMaterial,babylonAnimation:this._buildAnimation(X,b,F)});return E}}class fX extends D.AnimationPropertyInfo{buildAnimations(U,X,b,F){return[{babylonAnimatable:U._babylonLight,babylonAnimation:this._buildAnimation(X,b,F)}]}}(0,W.l)("/cameras/{}/orthographic/xmag",[new iX(n.e.ANIMATIONTYPE_FLOAT,"orthoLeft",IX,(()=>1)),new iX(n.e.ANIMATIONTYPE_FLOAT,"orthoRight",OX,(()=>1))]),(0,W.l)("/cameras/{}/orthographic/ymag",[new iX(n.e.ANIMATIONTYPE_FLOAT,"orthoBottom",IX,(()=>1)),new iX(n.e.ANIMATIONTYPE_FLOAT,"orthoTop",OX,(()=>1))]),(0,W.l)("/cameras/{}/orthographic/zfar",[new iX(n.e.ANIMATIONTYPE_FLOAT,"maxZ",xX,(()=>1))]),(0,W.l)("/cameras/{}/orthographic/znear",[new iX(n.e.ANIMATIONTYPE_FLOAT,"xb",xX,(()=>1))]),(0,W.l)("/cameras/{}/perspective/yfov",[new iX(n.e.ANIMATIONTYPE_FLOAT,"fov",xX,(()=>1))]),(0,W.l)("/cameras/{}/perspective/zfar",[new iX(n.e.ANIMATIONTYPE_FLOAT,"maxZ",xX,(()=>1))]),(0,W.l)("/cameras/{}/perspective/znear",[new iX(n.e.ANIMATIONTYPE_FLOAT,"xb",xX,(()=>1))]),(0,W.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new PX(n.e.ANIMATIONTYPE_COLOR3,"albedoColor",mX,(()=>4)),new PX(n.e.ANIMATIONTYPE_FLOAT,"alpha",(function(U,X,b,F){return X[b+3]*F}),(()=>4))]),(0,W.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"metallic",xX,(()=>1))]),(0,W.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"roughness",xX,(()=>1))]);const jX=uX("albedoTexture");(0,W.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",jX.scale),(0,W.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",jX.offset),(0,W.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",jX.rotation);const eX=uX("metallicTexture");(0,W.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",eX.scale),(0,W.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",eX.offset),(0,W.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",eX.rotation),(0,W.l)("/materials/{}/emissiveFactor",[new PX(n.e.ANIMATIONTYPE_COLOR3,"emissiveColor",mX,(()=>3))]);const lX=uX("bumpTexture");(0,W.l)("/materials/{}/normalTexture/scale",[new PX(n.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",xX,(()=>1))]),(0,W.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",lX.scale),(0,W.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",lX.offset),(0,W.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",lX.rotation),(0,W.l)("/materials/{}/occlusionTexture/strength",[new PX(n.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",xX,(()=>1))]);const dX=uX("ambientTexture");(0,W.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",dX.scale),(0,W.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",dX.offset),(0,W.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",dX.rotation);const kX=uX("emissiveTexture");(0,W.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",kX.scale),(0,W.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",kX.offset),(0,W.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",kX.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new PX(n.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new PX(n.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",xX,(()=>1))]);const vX=uX("anisotropy.texture");(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",vX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",vX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",vX.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",xX,(()=>1))]);const AX=uX("clearCoat.texture");(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",AX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",AX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",AX.rotation);const sX=uX("clearCoat.bumpTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new PX(n.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",sX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",sX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",sX.rotation);const hX=uX("clearCoat.textureRoughness");(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",hX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",hX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",hX.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new PX(n.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new PX(n.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new PX(n.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new PX(n.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",xX,(()=>1))]);const BX=uX("iridescence.texture");(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",BX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",BX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",BX.rotation);const oX=uX("iridescence.thicknessTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",oX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",oX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",oX.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new PX(n.e.ANIMATIONTYPE_COLOR3,"sheen.color",mX,(()=>3))]),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",xX,(()=>1))]);const yX=uX("sheen.texture");(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",yX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",yX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",yX.rotation);const tX=uX("sheen.textureRoughness");(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",tX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",tX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",tX.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new PX(n.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",mX,(()=>3))]);const WX=uX("metallicReflectanceTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",WX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",WX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",WX.rotation);const YX=uX("reflectanceTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",YX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",YX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",YX.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",xX,(()=>1))]);const KX=uX("subSurface.refractionIntensityTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",KX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",KX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",KX.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new PX(n.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",mX,(()=>3))]),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new PX(n.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",xX,(()=>1))]),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",xX,(()=>1))]);const VX=uX("subSurface.thicknessTexture");(0,W.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",VX.scale),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",VX.offset),(0,W.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",VX.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new PX(n.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",xX,(()=>1))]);const gX=uX("subSurface.translucencyIntensityTexture");(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",gX.scale),(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",gX.offset),(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",gX.rotation),(0,W.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new PX(n.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",mX,(()=>3))]);const LX=uX("subSurface.translucencyColorTexture");(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",LX.scale),(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",LX.offset),(0,W.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",LX.rotation),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new fX(n.e.ANIMATIONTYPE_COLOR3,"diffuse",mX,(()=>3))]),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new fX(n.e.ANIMATIONTYPE_FLOAT,"intensity",xX,(()=>1))]),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new fX(n.e.ANIMATIONTYPE_FLOAT,"range",xX,(()=>1))]),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new fX(n.e.ANIMATIONTYPE_FLOAT,"innerAngle",NX,(()=>1))]),(0,W.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new fX(n.e.ANIMATIONTYPE_FLOAT,"angle",NX,(()=>1))]),(0,W.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new fX(n.e.ANIMATIONTYPE_COLOR3,"diffuse",mX,(()=>3))]),(0,W.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new fX(n.e.ANIMATIONTYPE_FLOAT,"intensity",xX,(()=>1))]);const DX="KHR_animation_pointer";class GX{constructor(U){this.name=DX,this._loader=U,this._pathToObjectConverter=(0,W.i)(this._loader.Sb)}get enabled(){return this._loader.isExtensionUsed(DX)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(U,X,b,F,E){var w;const Q=null===(w=F.target.extensions)||void 0===w?void 0:w.KHR_animation_pointer;if(!Q||!this._pathToObjectConverter)return null;"pointer"!==F.target.path&&m.e.Warn(`${U}/target/path: Value (${F.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=F.target.node&&m.e.Warn(`${U}/target/node: Value (${F.target.node}) must not be present when using the ${this.name} extension`);const z=`${U}/extensions/${this.name}`,q=Q.pointer;if(!q)throw new Error(`${z}: Pointer is missing`);try{const w=this._pathToObjectConverter.convert(q);if(!w.info.interpolation)throw new Error(`${z}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(U,X,b,F,{object:w.object,info:w.info.interpolation},E)}catch(p){return m.e.Warn(`${z}/pointer: Invalid pointer (${q}) skipped`),null}}}t(DX),y(DX,!0,(U=>new GX(U)));class ZX{constructor(U,X,b){this.frame=U,this.action=X,this.onlyOnce=b,this.isDone=!1}_clone(){return new ZX(this.frame,this.action,this.onlyOnce)}}var cX=b(11428),rX=b(11487),MX=b(11481);class HX{get loop(){return this._loop}set loop(U){U!==this._loop&&(this._loop=U,this.updateOptions({loop:U}))}get currentTime(){var U;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(U=rX.e.audioEngine)&&void 0!==U&&U.audioContext&&(this.isPlaying||this.isPaused)){const U=this.isPaused?0:rX.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+U}return 0}get spatialSound(){return this._spatialSound}set spatialSound(U){if(U==this._spatialSound)return;const X=this.isPlaying;this.pause(),U?(this._spatialSound=U,this._updateSpatialParameters()):this._disableSpatialSound(),X&&this.play()}constructor(U,X,b){var F;let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new S.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=E.JX.Zero(),this._localDirection=new E.JX(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=U,b=b||J.c.LastCreatedScene)if(this._scene=b,HX._SceneComponentInitialization(b),this._readyToPlayCallback=w,this._customAttenuationFunction=(U,X,b,F,E)=>X<b?U*(1-X/b):0,z&&(this.autoplay=z.autoplay||!1,this._loop=z.loop||!1,void 0!==z.volume&&(this._volume=z.volume),this._spatialSound=z.spatialSound??!1,this.maxDistance=z.maxDistance??100,this.useCustomAttenuation=z.useCustomAttenuation??!1,this.rolloffFactor=z.rolloffFactor||1,this.refDistance=z.refDistance||1,this.distanceModel=z.distanceModel||"linear",this._playbackRate=z.playbackRate||1,this._streaming=z.streaming??!1,this._length=z.length,this._offset=z.offset),null!==(F=rX.e.audioEngine)&&void 0!==F&&F.canUseWebAudio&&rX.e.audioEngine.audioContext){this._soundGain=rX.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let U=!0;if(X)try{"string"===typeof X?(this._urlType="String",this._url=X):X instanceof ArrayBuffer?this._urlType="ArrayBuffer":X instanceof HTMLMediaElement?this._urlType="MediaElement":X instanceof MediaStream?this._urlType="MediaStream":X instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(X)&&(this._urlType="Array");let b=[],F=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=rX.e.audioEngine.audioContext.createMediaElementSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=rX.e.audioEngine.audioContext.createMediaStreamSource(X),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":X.byteLength>0&&(F=!0,this._soundLoaded(X));break;case"AudioBuffer":this._audioBufferLoaded(X);break;case"String":b.push(X);case"Array":0===b.length&&(b=X);for(let U=0;U<b.length;U++){const X=b[U];if(F=z&&z.skipCodecCheck||-1!==X.indexOf(".mp3",X.length-4)&&rX.e.audioEngine.isMP3supported||-1!==X.indexOf(".ogg",X.length-4)&&rX.e.audioEngine.isOGGsupported||-1!==X.indexOf(".wav",X.length-4)||-1!==X.indexOf(".m4a",X.length-4)||-1!==X.indexOf(".mp4",X.length-4)||-1!==X.indexOf("blob:"),F){this._streaming?(this._htmlAudioElement=new Audio(X),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Q.Tools.SetCorsBehavior(X,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(X,(U=>{this._soundLoaded(U)}),void 0,!0,!0,(U=>{U&&m.e.Error("XHR "+U.status+" error on: "+X+"."),m.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:U=!1}U?F||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):m.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(q){m.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),rX.e.audioEngine&&!rX.e.audioEngine.WarnedWebAudioUnsupported&&(m.e.Error("Web Audio is not supported by your browser."),rX.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var U;null!==(U=rX.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(U){var X;null!==(X=rX.e.audioEngine)&&void 0!==X&&X.audioContext&&(this._audioBuffer=U,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(U){var X;null!==(X=rX.e.audioEngine)&&void 0!==X&&X.audioContext&&rX.e.audioEngine.audioContext.decodeAudioData(U,(U=>{this._audioBufferLoaded(U)}),(U=>{m.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+U)}))}setAudioBuffer(U){var X;null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&(this._audioBuffer=U,this._isReadyToPlay=!0)}updateOptions(U){U&&(this.loop=U.loop??this.loop,this.maxDistance=U.maxDistance??this.maxDistance,this.useCustomAttenuation=U.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=U.rolloffFactor??this.rolloffFactor,this.refDistance=U.refDistance??this.refDistance,this.distanceModel=U.distanceModel??this.distanceModel,this._playbackRate=U.playbackRate??this._playbackRate,this._length=U.length??void 0,this.spatialSound=U.spatialSound??this._spatialSound,this._setOffset(U.offset??void 0),this.setVolume(U.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var U;null!==(U=rX.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&rX.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??rX.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var U;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(U=this._soundPanner)||void 0===U||U.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var U;null!==(U=rX.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(U){var X;null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(U),this._isOutputConnected=!0)}setDirectionalCone(U,X,b){X<U?m.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=U,this._coneOuterAngle=X,this._coneOuterGain=b,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(U){if(U!=this._coneInnerAngle){var X;if(this._coneOuterAngle<U)return void m.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=U,null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(U){if(U!=this._coneOuterAngle){var X;if(U<this._coneInnerAngle)return void m.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=U,null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(U){var X;U.equals(this._position)||(this._position.q(U),null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(U){var X;this._localDirection=U,null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const U=this._connectedTransformNode.getWorldMatrix(),X=E.JX.TransformNormal(this._localDirection,U);X.normalize(),this._soundPanner.orientationX.value=X.x,this._soundPanner.orientationY.value=X.y,this._soundPanner.orientationZ.value=X.z}updateDistanceFromListener(){var U;if(null!==(U=rX.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const U=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.mX(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,U,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(U){this._customAttenuationFunction=U}play(U,X,b){var F;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(F=rX.e.audioEngine)&&void 0!==F&&F.audioContext)try{var E,w;this._clearTimeoutsAndObservers();let F=U?(null===(E=rX.e.audioEngine)||void 0===E?void 0:E.audioContext.currentTime)+U:null===(w=rX.e.audioEngine)||void 0===w?void 0:w.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=rX.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const U=()=>{var b;if(null!==(b=rX.e.audioEngine)&&void 0!==b&&b.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=X??0;const b=this._htmlAudioElement.play();void 0!==b&&b.catch((()=>{var X,b;(null===(X=rX.e.audioEngine)||void 0===X||X.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(b=rX.e.audioEngine)||void 0===b?void 0:b.onAudioUnlockedObservable.addOnce((()=>{U()})))}))}else{var F;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(F=rX.e.audioEngine)||void 0===F?void 0:F.onAudioUnlockedObservable.addOnce((()=>{U()}))}};U()}}else{var Q;const E=()=>{var E;if(null!==(E=rX.e.audioEngine)&&void 0!==E&&E.audioContext){var w;if(b=b||this._length,void 0!==X&&this._setOffset(X),this._soundSource){const U=this._soundSource;U.onended=()=>{U.disconnect()}}if(this._soundSource=null===(w=rX.e.audioEngine)||void 0===w?void 0:w.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Q;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==X&&(this._soundSource.loopStart=X),void 0!==b&&(this._soundSource.loopEnd=(0|X)+b),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},F=U?(null===(Q=rX.e.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime)+U:rX.e.audioEngine.audioContext.currentTime;const E=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(F,E,this.loop?void 0:b)}}};"suspended"===(null===(Q=rX.e.audioEngine)||void 0===Q?void 0:Q.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var U;"suspended"===(null===(U=rX.e.audioEngine)||void 0===U?void 0:U.audioContext.state)?(rX.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=rX.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{E()})))):E()}),500):E()}this._startTime=F,this.isPlaying=!0,this.isPaused=!1}catch(z){m.e.Error("Error while trying to play audio: "+this.name+", "+z.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(U){var X;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1}else if(null!==(X=rX.e.audioEngine)&&void 0!==X&&X.audioContext&&this._soundSource){const X=U?rX.e.audioEngine.audioContext.currentTime+U:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(X)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var U;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var X;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(X=this._streamingSource)||void 0===X||X.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(U=rX.e.audioEngine)&&void 0!==U&&U.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=rX.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(U,X){var b;null!==(b=rX.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._soundGain&&(X&&rX.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(rX.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,rX.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(U,rX.e.audioEngine.audioContext.currentTime+X)):this._soundGain.gain.value=U),this._volume=U}setPlaybackRate(U){this._playbackRate=U,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(U){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=U,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=U=>this._onRegisterAfterWorldMatrixUpdate(U),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(U){var X;if(U.getBoundingInfo){const X=U.getBoundingInfo();this.setPosition(X.boundingSphere.centerWorld)}else this.setPosition(U.absolutePosition);null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const U=()=>{(0,MX.g)((()=>this._isReadyToPlay),(()=>{b._audioBuffer=this.getAudioBuffer(),b._isReadyToPlay=!0,b.autoplay&&b.play(0,this._offset,this._length)}),void 0,300)},X={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},b=new HX(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,X);return this.useCustomAttenuation&&b.setAttenuationFunction(this._customAttenuationFunction),b.setPosition(this._position),b.setPlaybackRate(this._playbackRate),U(),b}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const U={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(U.connectedMeshId=this._connectedTransformNode.id),U.position=this._position.Jb(),U.refDistance=this.refDistance,U.distanceModel=this.distanceModel,U.isDirectional=this._isDirectional,U.localDirectionToMesh=this._localDirection.Jb(),U.coneInnerAngle=this._coneInnerAngle,U.coneOuterAngle=this._coneOuterAngle,U.coneOuterGain=this._coneOuterGain),U}static Parse(U,X,b,F){const w=U.name;let Q;Q=U.url?b+U.url:b+w;const z={autoplay:U.autoplay,loop:U.loop,volume:U.volume,spatialSound:U.spatialSound,maxDistance:U.maxDistance,rolloffFactor:U.rolloffFactor,refDistance:U.refDistance,distanceModel:U.distanceModel,playbackRate:U.playbackRate};let q;if(F){const U=()=>{(0,MX.g)((()=>F._isReadyToPlay),(()=>{q._audioBuffer=F.getAudioBuffer(),q._isReadyToPlay=!0,q.autoplay&&q.play(0,q._offset,q._length)}),void 0,300)};q=new HX(w,new ArrayBuffer(0),X,null,z),U()}else q=new HX(w,Q,X,(()=>{X.removePendingData(q)}),z),X.addPendingData(q);if(U.position){const X=E.JX.uX(U.position);q.setPosition(X)}if(U.isDirectional&&(q.setDirectionalCone(U.coneInnerAngle||360,U.coneOuterAngle||360,U.coneOuterGain||0),U.localDirectionToMesh)){const X=E.JX.uX(U.localDirectionToMesh);q.setLocalDirectionToMesh(X)}if(U.connectedMeshId){const b=X.getMeshById(U.connectedMeshId);b&&q.attachToMesh(b)}return U.metadata&&(q.metadata=U.metadata),q}_setOffset(U){this._offset!==U&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=U)}_clearTimeoutsAndObservers(){var U;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(U=rX.e.audioEngine)||void 0===U||U.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}HX._SceneComponentInitialization=U=>{throw(0,cX.b)("AudioSceneComponent")},(0,PU.f)("BABYLON.Sound",HX);class TX{constructor(U,X,b){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],X.length!==b.length)throw new Error("Sounds length does not equal weights length");this.loop=U,this._weights=b;let F=0;for(const w of b)F+=w;const E=F>0?1/F:0;for(let w=0;w<this._weights.length;w++)this._weights[w]*=E;this._sounds=X;for(const w of this._sounds)w.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(U){if(U!==this._coneInnerAngle){if(this._coneOuterAngle<U)return void m.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=U;for(const X of this._sounds)X.directionalConeInnerAngle=U}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(U){if(U!==this._coneOuterAngle){if(U<this._coneInnerAngle)return void m.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=U;for(const X of this._sounds)X.directionalConeOuterAngle=U}}get volume(){return this._volume}set volume(U){if(U!==this._volume)for(const X of this._sounds)X.setVolume(U)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(U){if(!this.isPaused){this.stop();const U=Math.random();let X=0;for(let b=0;b<this._weights.length;b++)if(X+=this._weights[b],U<=X){this._currentIndex=b;break}}const X=this._sounds[this._currentIndex??0];X.isReady()?X.play(0,this.isPaused?void 0:U):X.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class CX{constructor(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(U=U||J.c.LastCreatedScene)&&(this._scene=U,this.soundCollection=[],this._options=X,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var U;null!==(U=rX.e.audioEngine)&&void 0!==U&&U.canUseWebAudio&&rX.e.audioEngine.audioContext&&(this._outputAudioNode=rX.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(rX.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(rX.e.audioEngine&&rX.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(U){var X;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&U.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==U.soundTrackId&&(-1===U.soundTrackId?this._scene.mainSoundTrack.removeSound(U):this._scene.soundTracks&&this._scene.soundTracks[U.soundTrackId].removeSound(U)),this.soundCollection.push(U),U.soundTrackId=this.id}removeSound(U){const X=this.soundCollection.indexOf(U);-1!==X&&this.soundCollection.splice(X,1)}setVolume(U){var X;null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=U)}switchPanningModelToHRTF(){var U;if(null!==(U=rX.e.audioEngine)&&void 0!==U&&U.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var U;if(null!==(U=rX.e.audioEngine)&&void 0!==U&&U.canUseWebAudio)for(let X=0;X<this.soundCollection.length;X++)this.soundCollection[X].switchPanningModelToEqualPower()}connectToAnalyser(U){var X;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=U,null!==(X=rX.e.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,rX.e.audioEngine.masterGain))}}var Ub=b(11874),Xb=b(11833),bb=b(11401);rX.e.AudioEngineFactory=(U,X,b)=>new Fb(U,X,b);class Fb{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new S.e,this.onAudioLockedObservable=new S.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,bb.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const F=document.createElement("audio");this._hostElement=U,this._audioContext=X,this._audioDestination=b;try{F&&F.canPlayType&&(F.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||F.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(E){}try{F&&F.canPlayType&&F.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(E){}}lock(){this._triggerSuspendedState()}unlock(){var U,X;if("running"===(null===(U=this._audioContext)||void 0===U?void 0:U.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(X=this._audioContext)||void 0===X||X.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{m.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var U;null===(U=this._audioContext)||void 0===U||U.addEventListener("statechange",(()=>{var U;this.unlocked&&"running"!==(null===(U=this._audioContext)||void 0===U?void 0:U.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var U;return null!==(U=this._audioContext)&&void 0!==U&&U.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(U){this.canUseWebAudio=!1,m.e.Error("Web Audio: "+U.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(U){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const U=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",X=document.createElement("style");X.appendChild(document.createTextNode(U)),document.getElementsByTagName("head")[0].appendChild(X),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var U;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(U=this._audioContext)||void 0===U||U.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(U){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=U)}connectToAnalyser(U){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=U,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Eb=b(11421);(0,b(12957).f)(Ub.e.NAME_AUDIO,((U,X,b,F)=>{let E,w=[];if(b.Vn=b.Vn||[],void 0!==U.Vn&&null!==U.Vn)for(let z=0,q=U.Vn.length;z<q;z++){var Q;const q=U.Vn[z];null!==(Q=rX.e.audioEngine)&&void 0!==Q&&Q.canUseWebAudio?(q.url||(q.url=q.name),w[q.url]?b.Vn.push(HX.Parse(q,X,F,w[q.url])):(E=HX.Parse(q,X,F),w[q.url]=E,b.Vn.push(E))):b.Vn.push(new HX(q.name,null,X))}w=[]})),Object.defineProperty(Xb.c.prototype,"mainSoundTrack",{get:function(){let U=this._getComponent(Ub.e.NAME_AUDIO);return U||(U=new wb(this),this.o(U)),this._mainSoundTrack||(this._mainSoundTrack=new CX(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Xb.c.prototype.getSoundByName=function(U){let X;for(X=0;X<this.mainSoundTrack.soundCollection.length;X++)if(this.mainSoundTrack.soundCollection[X].name===U)return this.mainSoundTrack.soundCollection[X];if(this.soundTracks)for(let b=0;b<this.soundTracks.length;b++)for(X=0;X<this.soundTracks[b].soundCollection.length;X++)if(this.soundTracks[b].soundCollection[X].name===U)return this.soundTracks[b].soundCollection[X];return null},Object.defineProperty(Xb.c.prototype,"audioEnabled",{get:function(){let U=this._getComponent(Ub.e.NAME_AUDIO);return U||(U=new wb(this),this.o(U)),U.audioEnabled},set:function(U){let X=this._getComponent(Ub.e.NAME_AUDIO);X||(X=new wb(this),this.o(X)),U?X.enableAudio():X.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Xb.c.prototype,"headphone",{get:function(){let U=this._getComponent(Ub.e.NAME_AUDIO);return U||(U=new wb(this),this.o(U)),U.headphone},set:function(U){let X=this._getComponent(Ub.e.NAME_AUDIO);X||(X=new wb(this),this.o(X)),U?X.switchAudioModeForHeadphones():X.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Xb.c.prototype,"audioListenerPositionProvider",{get:function(){let U=this._getComponent(Ub.e.NAME_AUDIO);return U||(U=new wb(this),this.o(U)),U.audioListenerPositionProvider},set:function(U){let X=this._getComponent(Ub.e.NAME_AUDIO);if(X||(X=new wb(this),this.o(X)),U&&"function"!==typeof U)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");X.audioListenerPositionProvider=U},enumerable:!0,configurable:!0}),Object.defineProperty(Xb.c.prototype,"audioListenerRotationProvider",{get:function(){let U=this._getComponent(Ub.e.NAME_AUDIO);return U||(U=new wb(this),this.o(U)),U.audioListenerRotationProvider},set:function(U){let X=this._getComponent(Ub.e.NAME_AUDIO);if(X||(X=new wb(this),this.o(X)),U&&"function"!==typeof U)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");X.audioListenerRotationProvider=U},enumerable:!0,configurable:!0}),Object.defineProperty(Xb.c.prototype,"audioPositioningRefreshRate",{get:function(){let U=this._getComponent(Ub.e.NAME_AUDIO);return U||(U=new wb(this),this.o(U)),U.audioPositioningRefreshRate},set:function(U){let X=this._getComponent(Ub.e.NAME_AUDIO);X||(X=new wb(this),this.o(X)),X.audioPositioningRefreshRate=U},enumerable:!0,configurable:!0});class wb{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(U){this.name=Ub.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new E.JX,this._cachedCameraPosition=new E.JX,this._lastCheck=0,this._invertMatrixTemp=new E.Matrix,this._cameraDirectionTemp=new E.JX,(U=U||J.c.LastCreatedScene)&&(this.xX=U,U.soundTracks=[],U.Vn=[])}register(){this.xX._afterRenderStage.registerStep(Ub.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(U){if(U.Vn=[],this.xX.soundTracks)for(let X=0;X<this.xX.soundTracks.length;X++){const b=this.xX.soundTracks[X];for(let X=0;X<b.soundCollection.length;X++)U.Vn.push(b.soundCollection[X].serialize())}}addFromContainer(U){if(U.Vn)for(const X of U.Vn)X.play(),X.autoplay=!0,this.xX.mainSoundTrack.addSound(X)}removeFromContainer(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(U.Vn)for(const b of U.Vn)b.stop(),b.autoplay=!1,this.xX.mainSoundTrack.removeSound(b),X&&b.dispose()}dispose(){const U=this.xX;if(U._mainSoundTrack&&U.mainSoundTrack.dispose(),U.soundTracks)for(let X=0;X<U.soundTracks.length;X++)U.soundTracks[X].dispose()}disableAudio(){const U=this.xX;let X;for(this._audioEnabled=!1,rX.e.audioEngine&&rX.e.audioEngine.audioContext&&rX.e.audioEngine.audioContext.suspend(),X=0;X<U.mainSoundTrack.soundCollection.length;X++)U.mainSoundTrack.soundCollection[X].pause();if(U.soundTracks)for(X=0;X<U.soundTracks.length;X++)for(let b=0;b<U.soundTracks[X].soundCollection.length;b++)U.soundTracks[X].soundCollection[b].pause()}enableAudio(){const U=this.xX;let X;for(this._audioEnabled=!0,rX.e.audioEngine&&rX.e.audioEngine.audioContext&&rX.e.audioEngine.audioContext.resume(),X=0;X<U.mainSoundTrack.soundCollection.length;X++)U.mainSoundTrack.soundCollection[X].isPaused&&U.mainSoundTrack.soundCollection[X].play();if(U.soundTracks)for(X=0;X<U.soundTracks.length;X++)for(let b=0;b<U.soundTracks[X].soundCollection.length;b++)U.soundTracks[X].soundCollection[b].isPaused&&U.soundTracks[X].soundCollection[b].play()}switchAudioModeForHeadphones(){const U=this.xX;if(this._headphone=!0,U.mainSoundTrack.switchPanningModelToHRTF(),U.soundTracks)for(let X=0;X<U.soundTracks.length;X++)U.soundTracks[X].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const U=this.xX;if(this._headphone=!1,U.mainSoundTrack.switchPanningModelToEqualPower(),U.soundTracks)for(let X=0;X<U.soundTracks.length;X++)U.soundTracks[X].switchPanningModelToEqualPower()}_afterRender(){const U=Eb.e.Now;if(this._lastCheck&&U-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=U;const X=this.xX;if(!this._audioEnabled||!X._mainSoundTrack||!X.soundTracks||0===X._mainSoundTrack.soundCollection.length&&1===X.soundTracks.length)return;const b=rX.e.audioEngine;if(b&&b.audioContext){let U,F=X.activeCamera;if(X.activeCameras&&X.activeCameras.length>0&&(F=X.activeCameras[0]),this.audioListenerPositionProvider){const U=this.audioListenerPositionProvider();b.audioContext.listener.setPosition(U.x||0,U.y||0,U.z||0)}else F?this._cachedCameraPosition.equals(F.globalPosition)||(this._cachedCameraPosition.q(F.globalPosition),b.audioContext.listener.setPosition(F.globalPosition.x,F.globalPosition.y,F.globalPosition.z)):b.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const U=this.audioListenerRotationProvider();b.audioContext.listener.setOrientation(U.x||0,U.y||0,U.z||0,0,1,0)}else F?(F.rigCameras&&F.rigCameras.length>0&&(F=F.rigCameras[0]),F.getViewMatrix().invertToRef(this._invertMatrixTemp),E.JX.TransformNormalToRef(wb._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.q(this._cameraDirectionTemp),b.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):b.audioContext.listener.setOrientation(0,0,0,0,1,0);for(U=0;U<X.mainSoundTrack.soundCollection.length;U++){const b=X.mainSoundTrack.soundCollection[U];b.useCustomAttenuation&&b.updateDistanceFromListener()}if(X.soundTracks)for(U=0;U<X.soundTracks.length;U++)for(let b=0;b<X.soundTracks[U].soundCollection.length;b++){const F=X.soundTracks[U].soundCollection[b];F.useCustomAttenuation&&F.updateDistanceFromListener()}}}}wb._CameraDirection=new E.JX(0,0,-1),HX._SceneComponentInitialization=U=>{let X=U._getComponent(Ub.e.NAME_AUDIO);X||(X=new wb(U),U.o(X))};const Qb="MSFT_audio_emitter";class zb{constructor(U){this.name=Qb,this._loader=U,this.enabled=this._loader.isExtensionUsed(Qb)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const U=this._loader.Sb.extensions;if(U&&U[this.name]){const X=U[this.name];this._clips=X.clips,this._emitters=X.emitters,V.Assign(this._clips),V.Assign(this._emitters)}}loadSceneAsync(U,X){return L.LoadExtensionAsync(U,X,this.name,(async(b,F)=>{const E=new Array;E.push(this._loader.loadSceneAsync(U,X));for(const U of F.emitters){const X=V.Get(`${b}/emitters`,this._emitters,U);if(void 0!=X.refDistance||void 0!=X.maxDistance||void 0!=X.rolloffFactor||void 0!=X.distanceModel||void 0!=X.innerAngle||void 0!=X.outerAngle)throw new Error(`${b}: Direction or Distance properties are not allowed on emitters attached to a scene`);E.push(this._loadEmitterAsync(`${b}/emitters/${X.index}`,X))}await Promise.all(E)}))}loadNodeAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(U,F)=>{const w=new Array,z=await this._loader.loadNodeAsync(U,X,(X=>{for(const b of F.emitters){const F=V.Get(`${U}/emitters`,this._emitters,b);w.push(this._loadEmitterAsync(`${U}/emitters/${F.index}`,F).then((()=>{for(const U of F._babylonSounds)U.attachToMesh(X),void 0==F.innerAngle&&void 0==F.outerAngle||(U.setLocalDirectionToMesh(E.JX.Forward()),U.setDirectionalCone(2*Q.Tools.ToDegrees(void 0==F.innerAngle?Math.PI:F.innerAngle),2*Q.Tools.ToDegrees(void 0==F.outerAngle?Math.PI:F.outerAngle),0))})))}b(X)}));return await Promise.all(w),z}))}loadAnimationAsync(U,X){return L.LoadExtensionAsync(U,X,this.name,(async(b,F)=>{const E=await this._loader.loadAnimationAsync(U,X),w=new Array;V.Assign(F.events);for(const Q of F.events)w.push(this._loadAnimationEventAsync(`${b}/events/${Q.index}`,U,X,Q,E));return await Promise.all(w),E}))}_loadClipAsync(U,X){if(X._objectURL)return X._objectURL;let b;if(X.uri)b=this._loader.loadUriAsync(U,X,X.uri);else{const F=V.Get(`${U}/bufferView`,this._loader.Sb.bufferViews,X.bufferView);b=this._loader.loadBufferViewAsync(`/bufferViews/${F.index}`,F)}return X._objectURL=b.then((U=>URL.createObjectURL(new Blob([U],{type:X.mimeType})))),X._objectURL}_loadEmitterAsync(U,X){if(X._babylonSounds=X._babylonSounds||[],!X._babylonData){const U=new Array,b=X.name||`emitter${X.index}`,F={loop:!1,autoplay:!1,volume:void 0==X.volume?1:X.volume};for(let w=0;w<X.clips.length;w++){const E=`/extensions/${this.name}/clips`,Q=V.Get(E,this._clips,X.clips[w].clip);U.push(this._loadClipAsync(`${E}/${X.clips[w].clip}`,Q).then((U=>{const E=X._babylonSounds[w]=new HX(b,U,this._loader.babylonScene,null,F);E.refDistance=X.refDistance||1,E.maxDistance=X.maxDistance||256,E.rolloffFactor=X.rolloffFactor||1,E.distanceModel=X.distanceModel||"exponential"})))}const E=Promise.all(U).then((()=>{const U=X.clips.map((U=>U.weight||1)),b=new TX(X.loop||!1,X._babylonSounds,U);X.innerAngle&&(b.directionalConeInnerAngle=2*Q.Tools.ToDegrees(X.innerAngle)),X.outerAngle&&(b.directionalConeOuterAngle=2*Q.Tools.ToDegrees(X.outerAngle)),X.volume&&(b.volume=X.volume),X._babylonData.sound=b}));X._babylonData={loaded:E}}return X._babylonData.loaded}_getEventAction(U,X,b,F,E){switch(b){case"play":return U=>{const b=(E||0)+(U-F);X.play(b)};case"stop":return()=>{X.stop()};case"pause":return()=>{X.pause()};default:throw new Error(`${U}: Unsupported action ${b}`)}}_loadAnimationEventAsync(U,X,b,F,E){if(0==E.targetedAnimations.length)return Promise.resolve();const w=E.targetedAnimations[0],Q=F.FX,z=V.Get(`/extensions/${this.name}/emitters`,this._emitters,Q);return this._loadEmitterAsync(U,z).then((()=>{const X=z._babylonData.sound;if(X){const b=new ZX(F.time,this._getEventAction(U,X,F.action,F.time,F.startOffset));w.animation.addEvent(b),E.onAnimationGroupEndObservable.add((()=>{X.stop()})),E.onAnimationGroupPauseObservable.add((()=>{X.pause()}))}}))}}t(Qb),y(Qb,!0,(U=>new zb(U)));const qb="MSFT_lod";class pb{constructor(U){var X;this.name=qb,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new S.e,this.onMaterialLODsLoadedObservable=new S.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=U,this.maxLODsToLoad=(null===(X=this._loader.parent.extensionOptions[qb])||void 0===X?void 0:X.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(qb)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let U=0;U<this._nodePromiseLODs.length;U++){const X=Promise.all(this._nodePromiseLODs[U]).then((()=>{0!==U&&(this._loader.endPerformanceCounter(`Node LOD ${U}`),this._loader.log(`Loaded node LOD ${U}`)),this.onNodeLODsLoadedObservable.notifyObservers(U),U!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${U+1}`),this._loadBufferLOD(this._nodeBufferLODs,U+1),this._nodeSignalLODs[U]&&this._nodeSignalLODs[U].resolve())}));this._loader._completePromises.push(X)}for(let U=0;U<this._materialPromiseLODs.length;U++){const X=Promise.all(this._materialPromiseLODs[U]).then((()=>{0!==U&&(this._loader.endPerformanceCounter(`Material LOD ${U}`),this._loader.log(`Loaded material LOD ${U}`)),this.onMaterialLODsLoadedObservable.notifyObservers(U),U!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${U+1}`),this._loadBufferLOD(this._materialBufferLODs,U+1),this._materialSignalLODs[U]&&this._materialSignalLODs[U].resolve())}));this._loader._completePromises.push(X)}}loadSceneAsync(U,X){const b=this._loader.loadSceneAsync(U,X);return this._loadBufferLOD(this._bufferLODs,0),b}loadNodeAsync(U,X,b){return L.LoadExtensionAsync(U,X,this.name,(async(U,E)=>{let w;const Q=this._getLODs(U,X,this._loader.Sb.nodes,E.ids);this._loader.logOpen(`${U}`);for(let X=0;X<Q.length;X++){const U=Q[X];0!==X&&(this._nodeIndexLOD=X,this._nodeSignalLODs[X]=this._nodeSignalLODs[X]||new F);const E=U=>{b(U),U.Xq(!1)},z=this._loader.loadNodeAsync(`/nodes/${U.index}`,U,E).then((U=>{if(0!==X){const U=Q[X-1];U._babylonTransformNode&&(this._disposeTransformNode(U._babylonTransformNode),delete U._babylonTransformNode)}return U.Xq(!0),U}));this._nodePromiseLODs[X]=this._nodePromiseLODs[X]||[],0===X?w=z:(this._nodeIndexLOD=null,this._nodePromiseLODs[X].push(z))}return this._loader.logClose(),await w}))}_loadMaterialAsync(U,X,b,F,E){return this._nodeIndexLOD?null:L.LoadExtensionAsync(U,X,this.name,(async(U,w)=>{let Q;const z=this._getLODs(U,X,this._loader.Sb.materials,w.ids);this._loader.logOpen(`${U}`);for(let X=0;X<z.length;X++){const U=z[X];0!==X&&(this._materialIndexLOD=X);const w=this._loader._loadMaterialAsync(`/materials/${U.index}`,U,b,F,(U=>{0===X&&E(U)})).then((U=>{if(0!==X){E(U);const b=z[X-1]._data;b[F]&&(this._disposeMaterials([b[F].babylonMaterial]),delete b[F])}return U}));this._materialPromiseLODs[X]=this._materialPromiseLODs[X]||[],0===X?Q=w:(this._materialIndexLOD=null,this._materialPromiseLODs[X].push(w))}return this._loader.logClose(),await Q}))}_loadUriAsync(U,X,b){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const E=this._nodeIndexLOD-1;return this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new F,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(U,X,b)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const E=this._materialIndexLOD-1;return this._materialSignalLODs[E]=this._materialSignalLODs[E]||new F,this._materialSignalLODs[E].promise.then((async()=>await this._loader.loadUriAsync(U,X,b)))}return null}loadBufferAsync(U,X,b,E){if(this._loader.parent.useRangeRequests&&!X.uri){if(!this._loader.bin)throw new Error(`${U}: Uri is missing or the binary glTF is missing its binary chunk`);const X=async(U,X)=>{const w=b,Q=w+E-1;let z=U[X];return z?(z.start=Math.min(z.start,w),z.end=Math.max(z.end,Q)):(z={start:w,end:Q,loaded:new F},U[X]=z),await z.loaded.promise.then((U=>new Uint8Array(U.buffer,U.byteOffset+b-z.start,E)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?X(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?X(this._materialBufferLODs,this._materialIndexLOD):X(this._bufferLODs,0)}return null}_loadBufferLOD(U,X){const b=U[X];b&&(this._loader.log(`Loading buffer range [${b.start}-${b.end}]`),this._loader.bin.readAsync(b.start,b.end-b.start+1).then((U=>{b.loaded.resolve(U)}),(U=>{b.loaded.reject(U)})))}_getLODs(U,X,b,F){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const E=[];for(let w=F.length-1;w>=0;w--)if(E.push(V.Get(`${U}/ids/${F[w]}`,b,F[w])),E.length===this.maxLODsToLoad)return E;return E.push(X),E}_disposeTransformNode(U){const X=[],b=U.material;b&&X.push(b);for(const E of U.getChildMeshes())E.material&&X.push(E.material);U.dispose();const F=X.filter((U=>this._loader.babylonScene.meshes.every((X=>X.material!=U))));this._disposeMaterials(F)}_disposeMaterials(U){const X={};for(const b of U){for(const U of b.getActiveTextures())X[U.uniqueId]=U;b.dispose()}for(const b in X)for(const U of this._loader.babylonScene.materials)U.hasTexture(X[b])&&delete X[b];for(const b in X)X[b].dispose()}}t(qb),y(qb,!0,(U=>new pb(U)));const Sb="MSFT_minecraftMesh";class Rb{constructor(U){this.name=Sb,this._loader=U,this.enabled=this._loader.isExtensionUsed(Sb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtraAsync(U,X,this.name,(async(F,E)=>{if(E){if(!(b instanceof N.b))throw new Error(`${F}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(U,X,b);return b.needAlphaBlending()&&(b.forceDepthWrite=!0,b.separateCullingPass=!0),b.ib=b.forceDepthWrite,b.twoSidedLighting=!0,await E}}))}}t(Sb),y(Sb,!0,(U=>new Rb(U)));const nb="MSFT_sRGBFactors";class ab{constructor(U){this.name=nb,this._loader=U,this.enabled=this._loader.isExtensionUsed(nb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(U,X,b){return L.LoadExtraAsync(U,X,this.name,(async(F,E)=>{if(E){if(!(b instanceof N.b))throw new Error(`${F}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(U,X,b),w=b.fU().getEngine().useExactSrgbConversions;return b.albedoTexture||b.albedoColor.toLinearSpaceToRef(b.albedoColor,w),b.reflectivityTexture||b.reflectivityColor.toLinearSpaceToRef(b.reflectivityColor,w),await E}}))}}t(nb),y(nb,!0,(U=>new ab(U)));var Jb=b(13268);const mb={};var xb=b(13323),Ib=b(13303),Ob=b(13272),Nb=b(13281);function ub(U,X){for(const b of U)for(const U of b.dataOutputs)if(U.uniqueId===X)return U;throw new Error("Could not find data out connection with unique id "+X)}function ib(U,X){for(const b of U)if(b instanceof Ib.d)for(const U of b.signalInputs)if(U.uniqueId===X)return U;throw new Error("Could not find signal in connection with unique id "+X)}async function Pb(U,X){const F=await Promise.all(U.allBlocks.map((async U=>{const X=function(U){switch(U){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([b.e(78),b.e(79)]).then(b.bind(b,14778))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await b.e(80).then(b.bind(b,14780))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await b.e(81).then(b.bind(b,14787))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await b.e(82).then(b.bind(b,14791))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await b.e(83).then(b.bind(b,14796))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await b.e(84).then(b.bind(b,14804))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await b.e(85).then(b.bind(b,14809))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await b.e(86).then(b.bind(b,14813))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await b.e(87).then(b.bind(b,14818))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await b.e(90).then(b.bind(b,14854))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await b.e(90).then(b.bind(b,14854))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await b.e(90).then(b.bind(b,14854))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await b.e(90).then(b.bind(b,14854))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await b.e(95).then(b.bind(b,14861))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await b.e(96).then(b.bind(b,14865))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await b.e(97).then(b.bind(b,14872))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await b.e(98).then(b.bind(b,14874))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await b.e(99).then(b.bind(b,14879))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await b.e(100).then(b.bind(b,14884))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await b.e(101).then(b.bind(b,14886))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await b.e(102).then(b.bind(b,14889))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await b.e(103).then(b.bind(b,14891))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await b.e(104).then(b.bind(b,14894))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await b.e(105).then(b.bind(b,14899))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await b.e(106).then(b.bind(b,14905))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await b.e(107).then(b.bind(b,14907))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await b.e(108).then(b.bind(b,14910))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await b.e(109).then(b.bind(b,14914))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await b.e(110).then(b.bind(b,14916))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await b.e(111).then(b.bind(b,14919))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await b.e(112).then(b.bind(b,14921))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await b.e(113).then(b.bind(b,14927))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await b.e(92).then(b.bind(b,14931))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await b.e(114).then(b.bind(b,14936))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await b.e(115).then(b.bind(b,14939))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await b.e(116).then(b.bind(b,14947))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await b.e(93).then(b.bind(b,14953))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await b.e(88).then(b.bind(b,14823))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await b.e(94).then(b.bind(b,14960))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await b.e(94).then(b.bind(b,14960))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await b.e(94).then(b.bind(b,14960))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await b.e(94).then(b.bind(b,14960))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await b.e(94).then(b.bind(b,14960))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await b.e(94).then(b.bind(b,14960))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await b.e(94).then(b.bind(b,14960))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await b.e(94).then(b.bind(b,14960))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await b.e(89).then(b.bind(b,14845))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await b.e(90).then(b.bind(b,14854))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await b.e(90).then(b.bind(b,14854))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await b.e(91).then(b.bind(b,14963))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await b.e(91).then(b.bind(b,14963))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await b.e(91).then(b.bind(b,14963))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await b.e(91).then(b.bind(b,14963))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await b.e(91).then(b.bind(b,14963))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await b.e(91).then(b.bind(b,14963))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await b.e(117).then(b.bind(b,14968))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await b.e(118).then(b.bind(b,14974))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await b.e(119).then(b.bind(b,14980))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await b.e(120).then(b.bind(b,14984))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await b.e(121).then(b.bind(b,14987))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await b.e(122).then(b.bind(b,14993))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await b.e(123).then(b.bind(b,15001))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await b.e(124).then(b.bind(b,15005))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await b.e(125).then(b.bind(b,15014))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await b.e(126).then(b.bind(b,15021))).FlowGraphDataSwitchBlock;default:if(mb[U])return mb[U];throw new Error(`Unknown block name ${U}`)}}(U.className);return await X()})));return function(U,X,b){const F=X.coordinator.createGraph(),E=[],w=X.valueParseFunction??Ob.d;for(let Q=0;Q<U.allBlocks.length;Q++){const z=jb(U.allBlocks[Q],{xX:X.coordinator.config.xX,pathConverter:X.pathConverter,assetsContainer:X.coordinator.config.xX,valueParseFunction:w},b[Q]);E.push(z),z instanceof xb.e&&F.addEventBlock(z)}for(const Q of E){for(const U of Q.dataInputs)for(const X of U.connectedPointIds){const b=ub(E,X);U.connectTo(b)}if(Q instanceof Ib.d)for(const U of Q.signalOutputs)for(const X of U.connectedPointIds){const b=ib(E,X);U.connectTo(b)}}for(const Q of U.executionContexts)fb(Q,{graph:F,valueParseFunction:w},U.rightHanded);return F}(U,X,F)}function fb(U,X,b){const F=X.graph.createContext();U.enableLogging&&(F.enableLogging=!0),F.treatDataAsRightHanded=b||!1;const E=X.valueParseFunction??Ob.d;F.uniqueId=U.uniqueId;const w=F.fU();if(U._assetsContext){var Q,z,q,p,S,R,n,a,J,m;const X=U._assetsContext,b={meshes:null===(Q=X.meshes)||void 0===Q?void 0:Q.map((U=>w.getMeshById(U))),lights:null===(z=X.lights)||void 0===z?void 0:z.map((U=>w.getLightByName(U))),cameras:null===(q=X.cameras)||void 0===q?void 0:q.map((U=>w.getCameraByName(U))),materials:null===(p=X.materials)||void 0===p?void 0:p.map((U=>w.getMaterialById(U))),textures:null===(S=X.textures)||void 0===S?void 0:S.map((U=>w.getTextureByName(U))),animations:null===(R=X.animations)||void 0===R?void 0:R.map((U=>w.animations.find((X=>X.name===U)))),skeletons:null===(n=X.skeletons)||void 0===n?void 0:n.map((U=>w.getSkeletonByName(U))),wn:null===(a=X.wn)||void 0===a?void 0:a.map((U=>w.getParticleSystemById(U))),animationGroups:null===(J=X.animationGroups)||void 0===J?void 0:J.map((U=>w.getAnimationGroupByName(U))),transformNodes:null===(m=X.transformNodes)||void 0===m?void 0:m.map((U=>w.getTransformNodeById(U))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Vn:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};F.assetsContext=b}for(const x in U._userVariables){const X=E(x,U._userVariables,F.assetsContext,w);F.userVariables[x]=X}for(const x in U._connectionValues){const X=E(x,U._connectionValues,F.assetsContext,w);F._setConnectionValueByKey(x,X)}return F}function jb(U,X,b){const F={},E=X.valueParseFunction??Ob.d;if(U.config)for(const Q in U.config)F[Q]=E(Q,U.config,X.assetsContainer||X.xX,X.xX);if((0,Ob.l)(U.className)){if(!X.pathConverter)throw new Error("Path converter is required for this block");F.pathConverter=X.pathConverter}const w=new b(F);w.uniqueId=U.uniqueId;for(let Q=0;Q<U.dataInputs.length;Q++){const X=w.getDataInput(U.dataInputs[Q].name);if(!X)throw new Error("Could not find data input with name "+U.dataInputs[Q].name+" in block "+U.className);X.deserialize(U.dataInputs[Q])}for(let Q=0;Q<U.dataOutputs.length;Q++){const X=w.getDataOutput(U.dataOutputs[Q].name);if(!X)throw new Error("Could not find data output with name "+U.dataOutputs[Q].name+" in block "+U.className);X.deserialize(U.dataOutputs[Q])}return w.metadata=U.metadata,w.deserialize&&w.deserialize(U),w}function eb(U){const[X,b]=U.split(":");return lb({op:X,extension:b})}function lb(U){var X;let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const F=U.extension?null===(X=kb[U.extension])||void 0===X?void 0:X[U.op]:vb[U.op];if(!F&&(m.e.Warn(`No mapping found for operation ${U.op} and extension ${U.extension||"KHR_interactivity"}`),b)){const X={},b={flows:{}};if(U.inputValueSockets){X.values={};for(const b in U.inputValueSockets)X.values[b]={name:b}}return U.outputValueSockets&&(b.values={},Object.keys(U.outputValueSockets).forEach((U=>{b.values[U]={name:U}}))),{jS:[],inputs:X,outputs:b}}return F}function db(U,X,b){kb[X]||(kb[X]={}),kb[X][U]=b}const kb={BABYLON:{"flow/log":{jS:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},vb={"event/onStart":{jS:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{jS:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{jS:["FlowGraphSendCustomEventBlock"],extraProcessor(U,X,b,F,E){if("event/send"!==X.op||!U.configuration||1!==Object.keys(U.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const w=U.configuration.event.value[0];if("number"!==typeof w)throw new Error("Event id should be a number");const Q=F.arrays.events[w],z=E[0];return z.config||(z.config={}),z.config.eventId=Q.eventId,z.config.eventData=Q.eventData,E}},"event/receive":{jS:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(U,X){var b;if(!U.configuration)return m.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const F=U.configuration.event;if(!F)return m.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const E=F.value[0];if("number"!==typeof E)return m.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(b=X.events)||void 0===b?void 0:b[E])?{valid:!0}:(m.e.Error(`Event with id ${E} not found`),{valid:!1,error:`Event with id ${E} not found`})},extraProcessor(U,X,b,F,E){if("event/receive"!==X.op||!U.configuration||1!==Object.keys(U.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const w=U.configuration.event.value[0];if("number"!==typeof w)throw new Error("Event id should be a number");const Q=F.arrays.events[w],z=E[0];return z.config||(z.config={}),z.config.eventId=Q.eventId,z.config.eventData=Q.eventData,E}},"math/e":Ab("FlowGraphEBlock"),"math/pi":Ab("FlowGraphPIBlock"),"math/inf":Ab("FlowGraphInfBlock"),"math/nan":Ab("FlowGraphNaNBlock"),"math/abs":Ab("FlowGraphAbsBlock"),"math/sign":Ab("FlowGraphSignBlock"),"math/trunc":Ab("FlowGraphTruncBlock"),"math/floor":Ab("FlowGraphFloorBlock"),"math/ceil":Ab("FlowGraphCeilBlock"),"math/round":{jS:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E){var w;return(w=E[0]).config||(w.config={}),E[0].config.roundHalfAwayFromZero=!0,E}},"math/fract":Ab("FlowGraphFractBlock"),"math/neg":Ab("FlowGraphNegationBlock"),"math/add":Ab("FlowGraphAddBlock",["a","b"],!0),"math/sub":Ab("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{jS:["FlowGraphMultiplyBlock"],extraProcessor(U,X,b,F,E){var w;(w=E[0]).config||(w.config={}),E[0].config.useMatrixPerComponent=!0,E[0].config.preventIntegerFloatArithmetic=!0;let Q=-1;return Object.keys(U.values||{}).find((X=>{var b;return void 0!==(null===(b=U.values)||void 0===b?void 0:b[X].type)&&(Q=U.values[X].type,!0)})),-1!==Q&&(E[0].config.type=F.arrays.types[Q].flowGraphType),E},validation:U=>U.values?sb(U):{valid:!0}},"math/div":Ab("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Ab("FlowGraphModuloBlock",["a","b"]),"math/min":Ab("FlowGraphMinBlock",["a","b"]),"math/max":Ab("FlowGraphMaxBlock",["a","b"]),"math/clamp":Ab("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Ab("FlowGraphSaturateBlock"),"math/mix":Ab("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Ab("FlowGraphEqualityBlock",["a","b"]),"math/lt":Ab("FlowGraphLessThanBlock",["a","b"]),"math/le":Ab("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Ab("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Ab("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Ab("FlowGraphIsNaNBlock"),"math/isinf":Ab("FlowGraphIsInfBlock"),"math/select":{jS:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{jS:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Ab("FlowGraphSinBlock"),"math/cos":Ab("FlowGraphCosBlock"),"math/tan":Ab("FlowGraphTanBlock"),"math/asin":Ab("FlowGraphASinBlock"),"math/acos":Ab("FlowGraphACosBlock"),"math/atan":Ab("FlowGraphATanBlock"),"math/atan2":Ab("FlowGraphATan2Block",["a","b"]),"math/sinh":Ab("FlowGraphSinhBlock"),"math/cosh":Ab("FlowGraphCoshBlock"),"math/tanh":Ab("FlowGraphTanhBlock"),"math/asinh":Ab("FlowGraphASinhBlock"),"math/acosh":Ab("FlowGraphACoshBlock"),"math/atanh":Ab("FlowGraphATanhBlock"),"math/exp":Ab("FlowGraphExponentialBlock"),"math/log":Ab("FlowGraphLogBlock"),"math/log2":Ab("FlowGraphLog2Block"),"math/log10":Ab("FlowGraphLog10Block"),"math/sqrt":Ab("FlowGraphSquareRootBlock"),"math/cbrt":Ab("FlowGraphCubeRootBlock"),"math/pow":Ab("FlowGraphPowerBlock",["a","b"]),"math/length":Ab("FlowGraphLengthBlock"),"math/normalize":Ab("FlowGraphNormalizeBlock"),"math/dot":Ab("FlowGraphDotBlock",["a","b"]),"math/cross":Ab("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Ab("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Ab("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{jS:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{jS:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{jS:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{jS:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{jS:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{jS:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{jS:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Ab("FlowGraphTransposeBlock"),"math/determinant":Ab("FlowGraphDeterminantBlock"),"math/inverse":Ab("FlowGraphInvertMatrixBlock"),"math/matmul":Ab("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{jS:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"fb",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E,w){const Q=E[0].dataInputs.find((U=>"rotationQuaternion"===U.name));if(!Q)throw new Error("Rotation quaternion input not found");return w._connectionValues[Q.uniqueId]&&(w._connectionValues[Q.uniqueId].type="Quaternion"),E}},"math/matDecompose":{jS:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"fb"}}}},"math/quatConjugate":Ab("FlowGraphConjugateBlock",["a"]),"math/quatMul":{jS:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E){var w;return(w=E[0]).config||(w.config={}),E[0].config.type="Quaternion",E}},"math/quatAngleBetween":Ab("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{jS:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Ab("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Ab("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{jS:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E){var w;return(w=E[0]).config||(w.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract2x2":{jS:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{jS:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E){var w;return(w=E[0]).config||(w.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract3x3":{jS:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{jS:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E){var w;return(w=E[0]).config||(w.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract4x4":{jS:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{jS:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E,w){var Q,z;(z=E[0]).config||(z.config={});const q=E[0].dataInputs[0];return E[0].config.valueType=(null===(Q=w._connectionValues[q.uniqueId])||void 0===Q?void 0:Q.type)??"FlowGraphInteger",E}},"math/and":{jS:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E,w){var Q,z,q;(q=E[0]).config||(q.config={});const p=E[0].dataInputs[0],S=E[0].dataInputs[1];return E[0].config.valueType=(null===(Q=w._connectionValues[p.uniqueId])||void 0===Q?void 0:Q.type)??(null===(z=w._connectionValues[S.uniqueId])||void 0===z?void 0:z.type)??"FlowGraphInteger",E}},"math/or":{jS:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E,w){var Q,z,q;(q=E[0]).config||(q.config={});const p=E[0].dataInputs[0],S=E[0].dataInputs[1];return E[0].config.valueType=(null===(Q=w._connectionValues[p.uniqueId])||void 0===Q?void 0:Q.type)??(null===(z=w._connectionValues[S.uniqueId])||void 0===z?void 0:z.type)??"FlowGraphInteger",E}},"math/xor":{jS:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(U,X,b,F,E,w){var Q,z,q;(q=E[0]).config||(q.config={});const p=E[0].dataInputs[0],S=E[0].dataInputs[1];return E[0].config.valueType=(null===(Q=w._connectionValues[p.uniqueId])||void 0===Q?void 0:Q.type)??(null===(z=w._connectionValues[S.uniqueId])||void 0===z?void 0:z.type)??"FlowGraphInteger",E}},"math/asr":Ab("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Ab("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Ab("FlowGraphLeadingZerosBlock"),"math/ctz":Ab("FlowGraphTrailingZerosBlock"),"math/popcnt":Ab("FlowGraphOneBitsCounterBlock"),"math/rad":Ab("FlowGraphDegToRadBlock"),"math/deg":Ab("FlowGraphRadToDegBlock"),"type/boolToInt":Ab("FlowGraphBooleanToInt"),"type/boolToFloat":Ab("FlowGraphBooleanToFloat"),"type/intToBool":Ab("FlowGraphIntToBoolean"),"type/intToFloat":Ab("FlowGraphIntToFloat"),"type/floatToInt":Ab("FlowGraphFloatToInt"),"type/floatToBool":Ab("FlowGraphFloatToBoolean"),"flow/sequence":{jS:["FlowGraphSequenceBlock"],extraProcessor(U,X,b,F,E){const w=E[0];return w.config||(w.config={}),w.config.outputSignalCount=Object.keys(U.flows||[]).length,w.signalOutputs.forEach(((U,X)=>{U.name="out_"+X})),E}},"flow/branch":{jS:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{jS:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(U){if(U.configuration&&U.configuration.cases){const X=U.configuration.cases.value;if(!X.every((U=>"number"===typeof U&&/^-?\d+$/.test(U.toString()))))return m.e.Warn("Switch cases should be integers. Using empty array instead."),U.configuration.cases.value=[],{valid:!0};const b=new Set(X);U.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(U,X,b,F,E){if("flow/switch"!==X.op||!U.flows||0===Object.keys(U.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return E[0].signalOutputs.forEach((U=>{"default"!==U.name&&(U.name="out_"+U.name)})),E}},"flow/while":{jS:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{jS:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(U,X,b,F,E){const w=E[0];return w.config||(w.config={}),w.config.incrementIndexWhenLoopDone=!0,E}},"flow/doN":{jS:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{jS:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(U,X,b,F,E){if("flow/multiGate"!==X.op||!U.flows||0===Object.keys(U.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const w=E[0];return w.config||(w.config={}),w.config.outputSignalCount=Object.keys(U.flows).length,w.signalOutputs.forEach(((U,X)=>{U.name="out_"+X})),E}},"flow/waitAll":{jS:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(U){var X,b;return"number"!==typeof(null===(X=U.configuration)||void 0===X||null===(b=X.inputFlows)||void 0===b?void 0:b.value[0])&&(U.configuration=U.configuration||{inputFlows:{value:[0]}},U.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{jS:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{jS:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{jS:["FlowGraphCancelDelayBlock"]},"variable/get":{jS:["FlowGraphGetVariableBlock"],validation(U){var X,b;return null!==(X=U.configuration)&&void 0!==X&&null!==(b=X.variable)&&void 0!==b&&b.value?{valid:!0}:(m.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(U,X)=>[X.getVariableName(U[0])]}}},"variable/set":{jS:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(U,X)=>[X.getVariableName(U[0])]}}},"variable/setMultiple":{jS:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(U,X)=>[U[0].map((U=>X.getVariableName(U)))]}},extraProcessor:(U,X,b,F,E)=>(E[0].dataInputs.forEach((U=>{U.name=F.getVariableName(+U.name)})),E)},"variable/interpolate":{jS:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(U,X)=>[X.getVariableName(U[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:U=>!0===U[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",aF:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",aF:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",aF:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",aF:"FlowGraphPlayAnimationBlock"},out:{name:"out",aF:"FlowGraphPlayAnimationBlock"},done:{name:"done",aF:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(U,X,b,F,E){var w,Q,z;const q=E[0],p=null===(w=U.configuration)||void 0===w?void 0:w.variable.value[0];if("number"!==typeof p)throw m.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const S=F.arrays.staticVariables[p];"undefined"===typeof q.config.animationType.value&&(F.arrays.staticVariables,q.config.animationType.value=(0,Nb.F)(S.type));const R=E[4];return R.config||(R.config={}),(Q=R.config).variable||(Q.variable={}),R.config.variable.value=F.getVariableName(p),(z=E[3]).config||(z.config={}),E}},"pointer/get":{jS:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",aF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",aF:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,X,b,F,E)=>(E.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className&&(U.config||(U.config={}),U.config.outputValue=!0)})),E)},"pointer/set":{jS:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",aF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",aF:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,X,b,F,E)=>(E.forEach((U=>{"FlowGraphJsonPointerParserBlock"===U.className&&(U.config||(U.config={}),U.config.outputValue=!0)})),E)},"pointer/interpolate":{jS:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",aF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",aF:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",aF:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",aF:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",aF:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",aF:"FlowGraphPlayAnimationBlock"},out:{name:"out",aF:"FlowGraphPlayAnimationBlock"},done:{name:"done",aF:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(U,X,b,F,E)=>(E.forEach((X=>{"FlowGraphJsonPointerParserBlock"===X.className?(X.config||(X.config={}),X.config.outputValue=!0):"FlowGraphInterpolationBlock"===X.className&&(X.config||(X.config={}),Object.keys(U.values||[]).forEach((b=>{var E;const w=null===(E=U.values)||void 0===E?void 0:E[b];if("value"===b&&w){const U=w.type;void 0!==U&&(X.config.animationType=F.arrays.types[U].flowGraphType)}})))})),E)},"animation/start":{jS:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",aF:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(U,X)=>[U[0]*X._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(U,X)=>[U[0]*X._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,X,b,F,E,w,Q){const z=E[E.length-1];return z.config||(z.config={}),z.config.glTF=Q,E}},"animation/stop":{jS:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",aF:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,X,b,F,E,w,Q){const z=E[E.length-1];return z.config||(z.config={}),z.config.glTF=Q,E}},"animation/stopAt":{jS:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",aF:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(U,X)=>[U[0]*X._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(U,X,b,F,E,w,Q){const z=E[E.length-1];return z.config||(z.config={}),z.config.glTF=Q,E}},"math/switch":{jS:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(U){if(U.configuration&&U.configuration.cases){const X=U.configuration.cases.value;if(!X.every((U=>"number"===typeof U&&/^-?\d+$/.test(U.toString()))))return m.e.Warn("Switch cases should be integers. Using empty array instead."),U.configuration.cases.value=[],{valid:!0};const b=new Set(X);U.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(U,X,b,F,E){const w=E[0];return w.dataInputs.forEach((U=>{"default"!==U.name&&"case"!==U.name&&(U.name="in_"+U.name)})),w.config||(w.config={}),w.config.treatCasesAsIntegers=!0,E}},"debug/log":{jS:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Ab(U){let X=arguments.length>2?arguments[2]:void 0;return{jS:[U],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((U,X)=>(U[X]={name:X},U)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(U,b,F,E,w){var Q;if(X){(Q=w[0]).config||(Q.config={}),w[0].config.preventIntegerFloatArithmetic=!0;let X=-1;Object.keys(U.values||{}).find((b=>{var F;return void 0!==(null===(F=U.values)||void 0===F?void 0:F[b].type)&&(X=U.values[b].type,!0)})),-1!==X&&(w[0].config.type=E.arrays.types[X].flowGraphType)}return w},validation:U=>X?sb(U):{valid:!0}}}function sb(U){if(U.values){const X=Object.keys(U.values).map((X=>U.values[X].type)).filter((U=>void 0!==U));if(!X.every((U=>U===X[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}vb["math/compose"]=vb["math/matCompose"],vb["math/decompose"]=vb["math/matDecompose"];var hb=b(11555);const Bb={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"JX",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class ob{constructor(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=U,this._gltf=X,this._animationTargetFps=b,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const U of this._interactivityGraph.types)this._types.push(Bb[U.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const U of this._interactivityGraph.declarations){const X=lb(U);if(!X)throw m.e.Error(["No mapping found for declaration",U]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:X,fullOperationName:U.extension?U.op+":"+U.extension:U.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const U of this._interactivityGraph.variables){const X=this._parseVariable(U);this._staticVariables.push(X)}}_parseVariable(U,X){const b=this._types[U.type];if(!b)throw m.e.Error(["No type found for variable",U]),new Error("Error parsing variables");if(U.value&&U.value.length!==b.length)throw m.e.Error(["Invalid value length for variable",U,b]),new Error("Error parsing variables");const F=U.value||[];if(!F.length)switch(b.flowGraphType){case"boolean":F.push(!1);break;case"FlowGraphInteger":F.push(0);break;case"number":F.push(NaN);break;case"Vector2":F.push(NaN,NaN);break;case"JX":F.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":F.fill(NaN,0,4);break;case"Matrix":F.fill(NaN,0,16);break;case"Matrix3D":F.fill(NaN,0,9)}return"number"===b.elementType&&"string"===typeof F[0]&&(F[0]=parseFloat(F[0])),{type:b.flowGraphType,value:X?X(F,this):F}}_parseEvents(){if(this._interactivityGraph.events)for(const U of this._interactivityGraph.events){const X={eventId:U.id||"internalEvent_"+this._internalEventsCounter++};U.values&&(X.eventData=Object.keys(U.values).map((X=>{var b;const F=null===(b=U.values)||void 0===b?void 0:b[X];if(!F)throw m.e.Error(["No value found for event key",X]),new Error("Error parsing events");const E=this._types[F.type];if(!E)throw m.e.Error(["No type found for event value",F]),new Error("Error parsing events");const w="undefined"!==typeof F.value?this._parseVariable(F):void 0;return{id:X,type:E.flowGraphType,eventData:!0,value:w}}))),this._events.push(X)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const X of this._interactivityGraph.nodes){if("number"!==typeof X.declaration)throw m.e.Error(["No declaration found for node",X]),new Error("Error parsing nodes");const b=this._mappings[X.declaration];if(!b)throw m.e.Error(["No mapping found for node",X]),new Error("Error parsing nodes");if(b.flowGraphMapping.validation){const F=b.flowGraphMapping.validation(X,this._interactivityGraph,this._gltf);var U;if(!F.valid)throw new Error(`Error validating interactivity node ${null===(U=this._interactivityGraph.declarations)||void 0===U?void 0:U[X.declaration].op} - ${F.error}`)}const F=[];for(const U of b.flowGraphMapping.jS){const E=this._getEmptyBlock(U,b.fullOperationName);this._parseNodeConfiguration(X,E,b.flowGraphMapping,U),F.push(E)}this._nodes.push({jS:F,fullOperationName:b.fullOperationName})}}_getEmptyBlock(U,X){return{uniqueId:(0,hb.c)(),className:U,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:X,metadata:{}}}_parseNodeConfiguration(U,X,b,F){const E=X.config;if(U.configuration){const X=Object.keys(U.configuration);for(const z of X){var w,Q;const X=null===(w=U.configuration)||void 0===w?void 0:w[z];if(!X)throw m.e.Error(["No value found for node configuration",z]),new Error("Error parsing node configuration");const q=null===(Q=b.configuration)||void 0===Q?void 0:Q[z];if(q&&q.aF?q.aF===F:0===b.jS.indexOf(F)){const U=(null===q||void 0===q?void 0:q.name)||z;X&&"undefined"!==typeof X.value||"undefined"===typeof(null===q||void 0===q?void 0:q.defaultValue)?X.value.length>=0?E[U]={value:1===X.value.length?X.value[0]:X.value}:m.e.Warn(["Invalid value for node configuration",X]):E[U]={value:q.defaultValue},q&&q.dataTransformer&&(E[U].value=q.dataTransformer([E[U].value],this)[0])}}}}_parseNodeConnections(U){for(let P=0;P<this._nodes.length;P++){var X;const f=null===(X=this._interactivityGraph.nodes)||void 0===X?void 0:X[P];if(!f)throw m.e.Error(["No node found for interactivity node",this._nodes[P]]),new Error("Error parsing node connections");const j=this._nodes[P],e=this._mappings[f.declaration];if(!e)throw m.e.Error(["No mapping found for node",f]),new Error("Error parsing node connections");const l=f.flows||{},d=Object.keys(l).sort();for(const U of d){var b,F,E,w;const X=l[U],p=null===(b=e.flowGraphMapping.outputs)||void 0===b||null===(F=b.flows)||void 0===F?void 0:F[U],S=(null===p||void 0===p?void 0:p.name)||U,R=this._createNewSocketConnection(S,!0);(p&&p.aF&&j.jS.find((U=>U.className===p.aF))||j.jS[0]).signalOutputs.push(R);const n=X.node,a=this._nodes[n];if(!a)throw m.e.Error(["No node found for input node id",n]),new Error("Error parsing node connections");const J=eb(a.fullOperationName);if(!J)throw m.e.Error(["No mapping found for input node",a]),new Error("Error parsing node connections");let x=null===(E=J.inputs)||void 0===E||null===(w=E.flows)||void 0===w?void 0:w[X.socket||"in"],I=!1;if(!x)for(const U in null===(Q=J.inputs)||void 0===Q?void 0:Q.flows){var Q,z,q;if(U.startsWith("[")&&U.endsWith("]"))I=!0,x=null===(z=J.inputs)||void 0===z||null===(q=z.flows)||void 0===q?void 0:q[U]}const O=x?I?x.name.replace("$1",X.socket||""):x.name:X.socket||"in",N=x&&x.aF&&a.jS.find((U=>U.className===x.aF))||a.jS[0];let u=N.signalInputs.find((U=>U.name===O));u||(u=this._createNewSocketConnection(O),N.signalInputs.push(u)),u.connectedPointIds.push(R.uniqueId),R.connectedPointIds.push(u.uniqueId)}const k=f.values||{},v=Object.keys(k);for(const X of v){var p,S;const b=k[X];let F=null===(p=e.flowGraphMapping.inputs)||void 0===p||null===(S=p.values)||void 0===S?void 0:S[X],E=!1;if(!F)for(const U in null===(R=e.flowGraphMapping.inputs)||void 0===R?void 0:R.values){var R,n,a;if(U.startsWith("[")&&U.endsWith("]"))E=!0,F=null===(n=e.flowGraphMapping.inputs)||void 0===n||null===(a=n.values)||void 0===a?void 0:a[U]}const w=F?E?F.name.replace("$1",X):F.name:X,Q=this._createNewSocketConnection(w);if((F&&F.aF&&j.jS.find((U=>U.className===F.aF))||j.jS[0]).dataInputs.push(Q),void 0!==b.value){const X=this._parseVariable(b,F&&F.dataTransformer);U._connectionValues[Q.uniqueId]=X}else{if("undefined"===typeof b.node)throw m.e.Error(["Invalid value for value connection",b]),new Error("Error parsing node connections");{var J,x,I;const U=b.node,X=b.socket||"value",F=this._nodes[U];if(!F)throw m.e.Error(["No node found for output socket reference",b]),new Error("Error parsing node connections");const E=eb(F.fullOperationName);if(!E)throw m.e.Error(["No mapping found for output socket reference",b]),new Error("Error parsing node connections");let w=null===(J=E.outputs)||void 0===J||null===(x=J.values)||void 0===x?void 0:x[X],z=!1;if(!w)for(const b in null===(O=E.outputs)||void 0===O?void 0:O.values){var O,N,u;if(b.startsWith("[")&&b.endsWith("]"))z=!0,w=null===(N=E.outputs)||void 0===N||null===(u=N.values)||void 0===u?void 0:u[b]}const q=w?z?w.name.replace("$1",X):null===(I=w)||void 0===I?void 0:I.name:X,p=w&&w.aF&&F.jS.find((U=>U.className===w.aF))||F.jS[0];let S=p.dataOutputs.find((U=>U.name===q));S||(S=this._createNewSocketConnection(q,!0),p.dataOutputs.push(S)),Q.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(Q.uniqueId)}}}if(e.flowGraphMapping.interBlockConnectors)for(const U of e.flowGraphMapping.interBlockConnectors){const X=U.input,b=U.output,F=U.isVariable;this._connectFlowGraphNodes(X,b,j.jS[U.inputBlockIndex],j.jS[U.outputBlockIndex],F)}if(e.flowGraphMapping.extraProcessor){var i;const X=null===(i=this._interactivityGraph.declarations)||void 0===i?void 0:i[f.declaration];if(!X)throw m.e.Error(["No declaration found for extra processor",f]),new Error("Error parsing node connections");j.jS=e.flowGraphMapping.extraProcessor(f,X,e.flowGraphMapping,this,j.jS,U,this._gltf)}}}_createNewSocketConnection(U,X){return{uniqueId:(0,hb.c)(),name:U,_connectionType:X?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(U,X,b,F,E){const w=E?b.dataInputs:b.signalInputs,Q=E?F.dataOutputs:F.signalOutputs,z=w.find((X=>X.name===U))||this._createNewSocketConnection(U),q=Q.find((U=>U.name===X))||this._createNewSocketConnection(X,!0);w.find((X=>X.name===U))||w.push(z),Q.find((U=>U.name===X))||Q.push(q),z.connectedPointIds.push(q.uniqueId),q.connectedPointIds.push(z.uniqueId)}getVariableName(U){return"staticVariable_"+U}serializeToFlowGraph(){const U={uniqueId:(0,hb.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(U);for(let X=0;X<this._staticVariables.length;X++){const b=this._staticVariables[X];U._userVariables[this.getVariableName(X)]=b}return{rightHanded:!0,allBlocks:this._nodes.reduce(((U,X)=>U.concat(X.jS)),[]),executionContexts:[U]}}}const yb="KHR_interactivity";class tb{constructor(U){this._loader=U,this.name=yb,this.enabled=this._loader.isExtensionUsed(yb),this._pathConverter=(0,W.i)(this._loader.Sb),U._skipStartAnimationStep=!0;const X=U.babylonScene;X&&function(U){(0,W.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!U.activeCamera)return new E.Quaternion(NaN,NaN,NaN,NaN);const X=E.Quaternion.FromRotationMatrix(U.activeCamera.getWorldMatrix()).normalize();return U.useRightHandedSystem||(X.w*=-1,X.x*=-1),X},type:"Quaternion",getTarget:()=>U.activeCamera}),(0,W.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!U.activeCamera)return new E.JX(NaN,NaN,NaN);const X=U.activeCamera.getWorldMatrix().getTranslation();return U.useRightHandedSystem||(X.x*=-1),X},type:"JX",getTarget:()=>U.activeCamera}),(0,W.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:U=>{var X;return(null===(X=U._babylonAnimationGroup)||void 0===X?void 0:X.isPlaying)??!1},type:"boolean",getTarget:U=>U._babylonAnimationGroup}),(0,W.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:U=>{var X;return((null===(X=U._babylonAnimationGroup)||void 0===X?void 0:X.from)??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,W.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:U=>{var X;return((null===(X=U._babylonAnimationGroup)||void 0===X?void 0:X.to)??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,W.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:U=>{var X;return((null===(X=U._babylonAnimationGroup)||void 0===X?void 0:X.getCurrentFrame())??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup}),(0,W.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:U=>{var X;return((null===(X=U._babylonAnimationGroup)||void 0===X?void 0:X.getCurrentFrame())??0)/60},type:"number",getTarget:U=>U._babylonAnimationGroup})}(X)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var U;if(!this._loader.babylonScene||!this._pathConverter)return;const X=this._loader.babylonScene,b=null===(U=this._loader.Sb.extensions)||void 0===U?void 0:U.KHR_interactivity;if(!b)return;const F=new Jb.c({xX:X});F.dispatchEventsSynchronously=!1;const E=b.graphs.map((U=>new ob(U,this._loader.Sb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(E.map((async U=>await Pb(U,{coordinator:F,pathConverter:this._pathConverter})))),F.start()}}var Wb;Wb=async()=>(await Promise.resolve().then(b.bind(b,13335))).FlowGraphGLTFDataProvider,mb[`${yb}/${"FlowGraphGLTFDataProvider"}`]=Wb,t(yb),y(yb,!0,(U=>new tb(U)));const Yb="KHR_node_visibility";(0,W.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:U=>{const X=U._babylonTransformNode;return!X||void 0===X.isVisible||X.isVisible},set:(U,X)=>{var b,F;null===(b=X._primitiveBabylonMeshes)||void 0===b||b.forEach((U=>{U.inheritVisibility=!0})),X._babylonTransformNode&&(X._babylonTransformNode.isVisible=U),null===(F=X._primitiveBabylonMeshes)||void 0===F||F.forEach((X=>{X.isVisible=U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Kb{constructor(U){this.name=Yb,this._loader=U,this.enabled=U.isExtensionUsed(Yb)}async onReady(){var U;null===(U=this._loader.Sb.nodes)||void 0===U||U.forEach((U=>{var X,b,F,E;(null===(X=U._primitiveBabylonMeshes)||void 0===X||X.forEach((U=>{U.inheritVisibility=!0})),null!==(b=U.extensions)&&void 0!==b&&b.KHR_node_visibility)&&(!1===(null===(F=U.extensions)||void 0===F?void 0:F.KHR_node_visibility.visible)&&(U._babylonTransformNode&&(U._babylonTransformNode.isVisible=!1),null===(E=U._primitiveBabylonMeshes)||void 0===E||E.forEach((U=>{U.isVisible=!1}))))}))}dispose(){this._loader=null}}t(Yb),y(Yb,!0,(U=>new Kb(U)));const Vb="KHR_node_selectability";db("event/onSelect",Vb,{jS:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",aF:"FlowGraphGetVariableBlock",dataTransformer:U=>["pickedMesh_"+U[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",aF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,X,b,F,E,w,Q){var z,q,p,S,R,n;const a=E[E.length-1];a.config=a.config||{},a.config.glTF=Q;const J=null===(z=U.configuration)||void 0===z||null===(q=z.nodeIndex)||void 0===q?void 0:q.value[0];if(void 0===J||"number"!==typeof J)throw new Error("nodeIndex not found in configuration");const m="pickedMesh_"+J;return E[1].config.variable=m,w._userVariables[m]={className:"Mesh",id:null===Q||void 0===Q||null===(p=Q.nodes)||void 0===p||null===(S=p[J]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===Q||void 0===Q||null===(R=Q.nodes)||void 0===R||null===(n=R[J]._babylonTransformNode)||void 0===n?void 0:n.uniqueId},E}}),(0,W.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:U=>{const X=U._babylonTransformNode;return!X||void 0===X.rq||X.rq},set:(U,X)=>{var b;null===(b=X._primitiveBabylonMeshes)||void 0===b||b.forEach((X=>{X.rq=U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"rq"],type:"boolean"});class gb{constructor(U){this.name=Vb,this._loader=U,this.enabled=U.isExtensionUsed(Vb)}async onReady(){var U;null===(U=this._loader.Sb.nodes)||void 0===U||U.forEach((U=>{var X,b,F;null!==(X=U.extensions)&&void 0!==X&&X.KHR_node_selectability&&!1===(null===(b=U.extensions)||void 0===b?void 0:b.KHR_node_selectability.selectable)&&(null===(F=U._babylonTransformNode)||void 0===F||F.getChildMeshes().forEach((U=>{U.rq=!1})))}))}dispose(){this._loader=null}}t(Vb),y(Vb,!0,(U=>new gb(U)));const Lb="KHR_node_hoverability",Db="targetMeshPointerOver_";db("event/onHoverIn",Lb,{jS:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",aF:"FlowGraphGetVariableBlock",dataTransformer:U=>[Db+U[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",aF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,X,b,F,E,w,Q){var z,q,p,S,R,n;const a=E[E.length-1];a.config=a.config||{},a.config.glTF=Q;const J=null===(z=U.configuration)||void 0===z||null===(q=z.nodeIndex)||void 0===q?void 0:q.value[0];if(void 0===J||"number"!==typeof J)throw new Error("nodeIndex not found in configuration");const m=Db+J;return E[1].config.variable=m,w._userVariables[m]={className:"Mesh",id:null===Q||void 0===Q||null===(p=Q.nodes)||void 0===p||null===(S=p[J]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===Q||void 0===Q||null===(R=Q.nodes)||void 0===R||null===(n=R[J]._babylonTransformNode)||void 0===n?void 0:n.uniqueId},E}});const Gb="targetMeshPointerOut_";db("event/onHoverOut",Lb,{jS:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",aF:"FlowGraphGetVariableBlock",dataTransformer:U=>[Gb+U[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",aF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(U,X,b,F,E,w,Q){var z,q,p,S,R,n;const a=E[E.length-1];a.config=a.config||{},a.config.glTF=Q;const J=null===(z=U.configuration)||void 0===z||null===(q=z.nodeIndex)||void 0===q?void 0:q.value[0];if(void 0===J||"number"!==typeof J)throw new Error("nodeIndex not found in configuration");const m=Gb+J;return E[1].config.variable=m,w._userVariables[m]={className:"Mesh",id:null===Q||void 0===Q||null===(p=Q.nodes)||void 0===p||null===(S=p[J]._babylonTransformNode)||void 0===S?void 0:S.id,uniqueId:null===Q||void 0===Q||null===(R=Q.nodes)||void 0===R||null===(n=R[J]._babylonTransformNode)||void 0===n?void 0:n.uniqueId},E}}),(0,W.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:U=>{const X=U._babylonTransformNode;return!X||void 0===X.pointerOverDisableMeshTesting||X.pointerOverDisableMeshTesting},set:(U,X)=>{var b;null===(b=X._primitiveBabylonMeshes)||void 0===b||b.forEach((X=>{X.pointerOverDisableMeshTesting=!U}))},getTarget:U=>U._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Zb{constructor(U){this.name=Lb,this._loader=U,this.enabled=U.isExtensionUsed(Lb)}async onReady(){var U;null===(U=this._loader.Sb.nodes)||void 0===U||U.forEach((U=>{var X,b,F;null!==(X=U.extensions)&&void 0!==X&&X.KHR_node_hoverability&&!1===(null===(b=U.extensions)||void 0===b?void 0:b.KHR_node_hoverability.hoverable)&&(null===(F=U._babylonTransformNode)||void 0===F||F.getChildMeshes().forEach((U=>{U.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}t(Lb),y(Lb,!0,(U=>new Zb(U)));const cb="ExtrasAsMetadata";class rb{_assignExtras(U,X){if(X.extras&&Object.keys(X.extras).length>0){const b=U.metadata=U.metadata||{};(b.Sb=b.Sb||{}).extras=X.extras}}constructor(U){this.name=cb,this.enabled=!0,this._loader=U}dispose(){this._loader=null}loadNodeAsync(U,X,b){return this._loader.loadNodeAsync(U,X,(U=>{this._assignExtras(U,X),b(U)}))}loadCameraAsync(U,X,b){return this._loader.loadCameraAsync(U,X,(U=>{this._assignExtras(U,X),b(U)}))}createMaterial(U,X,b){const F=this._loader.createMaterial(U,X,b);return this._assignExtras(F,X),F}}t(cb),y(cb,!1,(U=>new rb(U)));b(13335)},13207:(U,X,b)=>{"use strict";b.d(X,{e:()=>s,g:()=>e,i:()=>j,k:()=>l});var F=b(11392),E=b(11385),w=b(12865),Q=b(12067),z=b(12028),q=b(12038),p=b(11408),S=b(11442),R=b(12059),n=b(12158),a=b(12075),J=b(11630);class m{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.wn=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Vn=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(U){this._environmentTexture=U}getNodes(){let U=[];U=U.concat(this.meshes),U=U.concat(this.lights),U=U.concat(this.cameras),U=U.concat(this.transformNodes);for(const X of this.skeletons)U=U.concat(X.bones);return U}}class x extends m{}class I{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const U=this.rootNodes;for(const F of U)F.dispose();U.length=0;const X=this.skeletons;for(const F of X)F.dispose();X.length=0;const b=this.animationGroups;for(const F of b)F.dispose();b.length=0}}class O extends m{constructor(U){super(),this._wasAddedToScene=!1,(U=U||S.c.LastCreatedScene)&&(this.xX=U,this.proceduralTextures=[],U.wb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=U.getEngine().onContextRestoredObservable.add((()=>{for(const U of this.geometries)U._rebuild();for(const U of this.meshes)U._rebuild();for(const U of this.wn)U.rebuild();for(const U of this.textures)U._rebuild()})))}_topologicalSort(U){const X=new Map;for(const Q of U)X.set(Q.uniqueId,Q);const b={dependsOn:new Map,dependedBy:new Map};for(const Q of U){const U=Q.uniqueId;b.dependsOn.set(U,new Set),b.dependedBy.set(U,new Set)}for(const Q of U){const U=Q.uniqueId,F=b.dependsOn.get(U);if(Q instanceof R.c){const E=Q.sourceMesh;X.has(E.uniqueId)&&(F.add(E.uniqueId),b.dependedBy.get(E.uniqueId).add(U))}const E=b.dependedBy.get(U);for(const w of Q.getDescendants()){const F=w.uniqueId;if(X.has(F)){E.add(F);b.dependsOn.get(F).add(U)}}}const F=[],E=[];for(const Q of U){const U=Q.uniqueId;0===b.dependsOn.get(U).size&&(E.push(Q),X.delete(U))}const w=E;for(;w.length>0;){const U=w.shift();F.push(U);const E=b.dependedBy.get(U.uniqueId);for(const F of Array.from(E.values())){const E=b.dependsOn.get(F);E.delete(U.uniqueId),0===E.size&&X.get(F)&&(w.push(X.get(F)),X.delete(F))}}return X.size>0&&(p.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),X.forEach((U=>{p.e.Error(U.name)}))),F}_addNodeAndDescendantsToList(U,X,b,F){if(b&&(!F||F(b))&&!X.has(b.uniqueId)){U.push(b),X.add(b.uniqueId);for(const E of b.getDescendants(!0))this._addNodeAndDescendantsToList(U,X,E,F)}}_isNodeInContainer(U){return U instanceof q.b&&-1!==this.meshes.indexOf(U)||(U instanceof z.c&&-1!==this.transformNodes.indexOf(U)||(U instanceof n.c&&-1!==this.lights.indexOf(U)||U instanceof a.e&&-1!==this.cameras.indexOf(U)))}_isValidHierarchy(){for(const U of this.meshes)if(U.parent&&!this._isNodeInContainer(U.parent))return p.e.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;for(const U of this.transformNodes)if(U.parent&&!this._isNodeInContainer(U.parent))return p.e.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;for(const U of this.lights)if(U.parent&&!this._isNodeInContainer(U.parent))return p.e.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;for(const U of this.cameras)if(U.parent&&!this._isNodeInContainer(U.parent))return p.e.Warn(`Node ${U.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(U){let X=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const F={},w={},z=new I,q=[],p=[],S={doNotInstantiate:!0,...b},R=[],n=new Set;for(const E of this.transformNodes)null===E.parent&&this._addNodeAndDescendantsToList(R,n,E,S.predicate);for(const E of this.meshes)null===E.parent&&this._addNodeAndDescendantsToList(R,n,E,S.predicate);const a=this._topologicalSort(R),J=(b,E)=>{if(((X,b)=>{if(F[X.uniqueId]=b.uniqueId,w[b.uniqueId]=b,U&&(b.name=U(X.name)),b instanceof Q.e){const U=b;if(U.morphTargetManager){const b=X.morphTargetManager;U.morphTargetManager=b.clone();for(let X=0;X<b.numTargets;X++){const E=b.getTarget(X),Q=U.morphTargetManager.getTarget(X);F[E.uniqueId]=Q.uniqueId,w[Q.uniqueId]=Q}}}})(b,E),b.parent){const U=F[b.parent.uniqueId],X=w[U];E.parent=X||b.parent}if(E.position&&b.position&&E.position.q(b.position),E.rotationQuaternion&&b.rotationQuaternion&&E.rotationQuaternion.q(b.rotationQuaternion),E.rotation&&b.rotation&&E.rotation.q(b.rotation),E.fb&&b.fb&&E.fb.q(b.fb),E.material){const Q=E;if(Q.material)if(X){const X=b.material;if(-1===p.indexOf(X)){let b=X.clone(U?U(X.name):"Clone of "+X.name);if(p.push(X),F[X.uniqueId]=b.uniqueId,w[b.uniqueId]=b,"MultiMaterial"===X.getClassName()){const E=X;for(const X of E.lb)X&&(b=X.clone(U?U(X.name):"Clone of "+X.name),p.push(X),F[X.uniqueId]=b.uniqueId,w[b.uniqueId]=b);E.lb=E.lb.map((U=>U&&w[F[U.uniqueId]]))}}"InstancedMesh"!==Q.getClassName()&&(Q.material=w[F[X.uniqueId]])}else"MultiMaterial"===Q.material.getClassName()?-1===this.xX.multiMaterials.indexOf(Q.material)&&this.xX.addMultiMaterial(Q.material):-1===this.xX.materials.indexOf(Q.material)&&this.xX.addMaterial(Q.material)}null===E.parent&&z.rootNodes.push(E)};for(const E of a)if("InstancedMesh"===E.getClassName()){const U=E,X=U.sourceMesh,b=F[X.uniqueId];J(U,("number"===typeof b?w[b]:X).createInstance(U.name))}else{let U=!0;"yb"===E.getClassName()||"Node"===E.getClassName()||E.skeleton||!E.getTotalVertices||0===E.getTotalVertices()?U=!1:S.doNotInstantiate&&(U="function"===typeof S.doNotInstantiate?!S.doNotInstantiate(E):!S.doNotInstantiate);const X=U?E.createInstance(`instance of ${E.name}`):E.clone(`Clone of ${E.name}`,null,!0);if(!X)throw new Error(`Could not clone or instantiate node on Asset Container ${E.name}`);J(E,X)}for(const E of this.skeletons){if(S.predicate&&!S.predicate(E))continue;const X=E.clone(U?U(E.name):"Clone of "+E.name);for(const U of this.meshes)if(U.skeleton===E&&!U.isAnInstance){const b=w[F[U.uniqueId]];if(!b||b.isAnInstance)continue;if(b.skeleton=X,-1!==q.indexOf(X))continue;q.push(X);for(const U of X.bones)U._linkedTransformNode&&(U._linkedTransformNode=w[F[U._linkedTransformNode.uniqueId]])}z.skeletons.push(X)}for(const E of this.animationGroups){if(S.predicate&&!S.predicate(E))continue;const X=E.clone(U?U(E.name):"Clone of "+E.name,(U=>w[F[U.uniqueId]]||U));z.animationGroups.push(X)}return z}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.xX.environmentTexture=this.environmentTexture);for(const U of this.xX._serializableComponents)U.addFromContainer(this);this.xX.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const X=[];for(const b of this.cameras)U&&!U(b)||(this.xX.addCamera(b),X.push(b));for(const b of this.lights)U&&!U(b)||(this.xX.addLight(b),X.push(b));for(const b of this.meshes)U&&!U(b)||(this.xX.nS(b),X.push(b));for(const b of this.skeletons)U&&!U(b)||this.xX.addSkeleton(b);for(const b of this.animations)U&&!U(b)||this.xX.addAnimation(b);for(const b of this.animationGroups)U&&!U(b)||this.xX.addAnimationGroup(b);for(const b of this.multiMaterials)U&&!U(b)||this.xX.addMultiMaterial(b);for(const b of this.materials)U&&!U(b)||this.xX.addMaterial(b);for(const b of this.morphTargetManagers)U&&!U(b)||this.xX.addMorphTargetManager(b);for(const b of this.geometries)U&&!U(b)||this.xX.addGeometry(b);for(const b of this.transformNodes)U&&!U(b)||(this.xX.addTransformNode(b),X.push(b));for(const b of this.actionManagers)U&&!U(b)||this.xX.addActionManager(b);for(const b of this.textures)U&&!U(b)||this.xX.addTexture(b);for(const b of this.reflectionProbes)U&&!U(b)||this.xX.addReflectionProbe(b);for(const b of X)b.parent&&-1===this.xX.getNodes().indexOf(b.parent)&&(b.setParent?b.setParent(null):b.parent=null)}removeAllFromScene(){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.xX.environmentTexture&&(this.xX.environmentTexture=null);for(const U of this.xX._serializableComponents)U.removeFromContainer(this)}removeFromScene(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const X of this.cameras)U&&!U(X)||this.xX.removeCamera(X);for(const X of this.lights)U&&!U(X)||this.xX.removeLight(X);for(const X of this.meshes)U&&!U(X)||this.xX.RS(X,!0);for(const X of this.skeletons)U&&!U(X)||this.xX.removeSkeleton(X);for(const X of this.animations)U&&!U(X)||this.xX.removeAnimation(X);for(const X of this.animationGroups)U&&!U(X)||this.xX.removeAnimationGroup(X);for(const X of this.multiMaterials)U&&!U(X)||this.xX.removeMultiMaterial(X);for(const X of this.materials)U&&!U(X)||this.xX.removeMaterial(X);for(const X of this.morphTargetManagers)U&&!U(X)||this.xX.removeMorphTargetManager(X);for(const X of this.geometries)U&&!U(X)||this.xX.removeGeometry(X);for(const X of this.transformNodes)U&&!U(X)||this.xX.removeTransformNode(X);for(const X of this.actionManagers)U&&!U(X)||this.xX.removeActionManager(X);for(const X of this.textures)U&&!U(X)||this.xX.removeTexture(X);for(const X of this.reflectionProbes)U&&!U(X)||this.xX.removeReflectionProbe(X)}dispose(){const U=this.cameras.slice(0);for(const a of U)a.dispose();this.cameras.length=0;const X=this.lights.slice(0);for(const a of X)a.dispose();this.lights.length=0;const b=this.meshes.slice(0);for(const a of b)a.dispose();this.meshes.length=0;const F=this.skeletons.slice(0);for(const a of F)a.dispose();this.skeletons.length=0;const E=this.animationGroups.slice(0);for(const a of E)a.dispose();this.animationGroups.length=0;const w=this.multiMaterials.slice(0);for(const a of w)a.dispose();this.multiMaterials.length=0;const Q=this.materials.slice(0);for(const a of Q)a.dispose();this.materials.length=0;const z=this.geometries.slice(0);for(const a of z)a.dispose();this.geometries.length=0;const q=this.transformNodes.slice(0);for(const a of q)a.dispose();this.transformNodes.length=0;const p=this.actionManagers.slice(0);for(const a of p)a.dispose();this.actionManagers.length=0;const S=this.textures.slice(0);for(const a of S)a.dispose();this.textures.length=0;const R=this.reflectionProbes.slice(0);for(const a of R)a.dispose();this.reflectionProbes.length=0;const n=this.morphTargetManagers.slice(0);for(const a of n)a.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const a of this.xX._serializableComponents)a.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.xX.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(U,X,b){if(U&&X)for(const F of U){let U=!0;if(b)for(const X of b)if(F===X){U=!1;break}U&&(X.push(F),F._parentContainer=this)}}moveAllFromScene(U){this._wasAddedToScene=!1,void 0===U&&(U=new x);for(const X in this)Object.prototype.hasOwnProperty.call(this,X)&&(this[X]=this[X]||("_environmentTexture"===X?null:[]),this._moveAssets(this.xX[X],this[X],U[X]));this.environmentTexture=this.xX.environmentTexture,this.removeAllFromScene()}createRootMesh(){const U=new Q.e("assetContainerRootMesh",this.xX);for(const X of this.meshes)X.parent||U.addChild(X);return this.meshes.unshift(U),U}mergeAnimationsTo(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.c.LastCreatedScene,X=arguments.length>1?arguments[1]:void 0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!U)return p.e.Error("No scene available to merge animations to"),[];const F=b||(X=>{let b=null;const F=X.animations.length?X.animations[0].targetProperty:"",E=X.name.split(".").join("").split("_primitive")[0];switch(F){case"position":case"rotationQuaternion":b=U.getTransformNodeByName(X.name)||U.getTransformNodeByName(E);break;case"influence":b=U.getMorphTargetByName(X.name)||U.getMorphTargetByName(E);break;default:b=U.getNodeByName(X.name)||U.getNodeByName(E)}return b}),E=this.getNodes();for(const z of E){const U=F(z);if(null!==U){for(const X of z.animations){const b=U.animations.filter((U=>U.targetProperty===X.targetProperty));for(const X of b){const b=U.animations.indexOf(X,0);b>-1&&U.animations.splice(b,1)}}U.animations=U.animations.concat(z.animations)}}const w=[],Q=this.animationGroups.slice();for(const z of Q){w.push(z.clone(z.name,F));for(const U of z.animatables)U.stop()}for(const z of X){const X=F(z.target);X&&(U.beginAnimation(X,z.fromFrame,z.toFrame,z.loopAnimation,z.speedRatio,z.onAnimationEnd?z.onAnimationEnd:void 0,void 0,!0,void 0,z.onAnimationLoop?z.onAnimationLoop:void 0),U.stopAnimation(z.target))}return w}populateRootNodes(){this.rootNodes.length=0;for(const U of this.meshes)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.transformNodes)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.lights)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U);for(const U of this.cameras)U.parent||-1!==this.rootNodes.indexOf(U)||this.rootNodes.push(U)}addAllAssetsToContainer(U){if(!U)return;const X=[],b=new Set;for(X.push(U);X.length>0;){const U=X.pop();if(U instanceof Q.e?(U.Nb&&-1===this.geometries.indexOf(U.Nb)&&this.geometries.push(U.Nb),this.meshes.push(U)):U instanceof R.c?this.meshes.push(U):U instanceof z.c?this.transformNodes.push(U):U instanceof n.c?this.lights.push(U):U instanceof a.e&&this.cameras.push(U),U instanceof q.b){if(U.material&&-1===this.materials.indexOf(U.material)){this.materials.push(U.material);for(const X of U.material.getActiveTextures())-1===this.textures.indexOf(X)&&this.textures.push(X)}U.skeleton&&-1===this.skeletons.indexOf(U.skeleton)&&this.skeletons.push(U.skeleton),U.morphTargetManager&&-1===this.morphTargetManagers.indexOf(U.morphTargetManager)&&this.morphTargetManagers.push(U.morphTargetManager)}for(const F of U.getChildren())b.has(F)||X.push(F);b.add(U)}this.populateRootNodes()}_getByTags(U,X,b){if(void 0===X)return U;const F=[];for(const E in U){const w=U[E];J.d&&J.d.MatchesQuery(w,X)&&(!b||b(w))&&F.push(w)}return F}getMeshesByTags(U,X){return this._getByTags(this.meshes,U,X)}getCamerasByTags(U,X){return this._getByTags(this.cameras,U,X)}getLightsByTags(U,X){return this._getByTags(this.lights,U,X)}getMaterialsByTags(U,X){return this._getByTags(this.materials,U,X).concat(this._getByTags(this.multiMaterials,U,X))}getTransformNodesByTags(U,X){return this._getByTags(this.transformNodes,U,X)}}var N=b(11463);class u{constructor(U){this.byteOffset=0,this.buffer=U}async loadAsync(U){const X=await this.buffer.readAsync(this.byteOffset,U);this._dataView=new DataView(X.buffer,X.byteOffset,X.byteLength),this._dataByteOffset=0}readUint32(){const U=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,U}readUint8Array(U){const X=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,U);return this._dataByteOffset+=U,this.byteOffset+=U,X}readString(U){return(0,N.d)(this.readUint8Array(U))}skipBytes(U){this._dataByteOffset+=U,this.byteOffset+=U}}var i=b(13210);const P="Z2xURg",f={name:"Sb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:U=>-1!==U.indexOf("asset")&&-1!==U.indexOf("version")||U.startsWith("data:base64,"+P)||U.startsWith("data:;base64,"+P)||U.startsWith("data:application/octet-stream;base64,"+P)||U.startsWith("data:model/gltf-binary;base64,"+P)};var j,e,l,d=b(11448),k=b(11454);function v(U,X,b){try{return Promise.resolve(new Uint8Array(U,X,b))}catch(F){return Promise.reject(F)}}!function(U){U[U.AUTO=0]="AUTO",U[U.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(j||(j={})),function(U){U[U.NONE=0]="NONE",U[U.FIRST=1]="FIRST",U[U.ALL=2]="ALL"}(e||(e={})),function(U){U[U.LOADING=0]="LOADING",U[U.READY=1]="READY",U[U.COMPLETE=2]="COMPLETE"}(l||(l={}));class A{constructor(){this.coordinateSystemMode=j.AUTO,this.animationStartMode=e.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=U=>Promise.resolve(U),this.extensionOptions={}}q(U){U&&(this.onParsed=U.onParsed,this.coordinateSystemMode=U.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=U.animationStartMode??this.animationStartMode,this.loadNodeAnimations=U.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=U.loadSkins??this.loadSkins,this.loadMorphTargets=U.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=U.compileMaterials??this.compileMaterials,this.useClipPlane=U.useClipPlane??this.useClipPlane,this.compileShadowGenerators=U.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=U.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=U.useRangeRequests??this.useRangeRequests,this.createInstances=U.createInstances??this.createInstances,this.alwaysComputeBoundingBox=U.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=U.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=U.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=U.skipMaterials??this.skipMaterials,this.useSRGBBuffers=U.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=U.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=U.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=U.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=U.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=U.customRootNode,this.onMeshLoaded=U.onMeshLoaded,this.onSkinLoaded=U.onSkinLoaded,this.onTextureLoaded=U.onTextureLoaded,this.onMaterialLoaded=U.onMaterialLoaded,this.onCameraLoaded=U.onCameraLoaded,this.extensionOptions=U.extensionOptions??this.extensionOptions)}}class s extends A{constructor(U){super(),this.onParsedObservable=new F.e,this.onMeshLoadedObservable=new F.e,this.onSkinLoadedObservable=new F.e,this.onTextureLoadedObservable=new F.e,this.onMaterialLoadedObservable=new F.e,this.onCameraLoadedObservable=new F.e,this.onCompleteObservable=new F.e,this.onErrorObservable=new F.e,this.wb=new F.e,this.onExtensionLoadedObservable=new F.e,this.validate=!1,this.onValidatedObservable=new F.e,this._loader=null,this._state=null,this._requests=new Array,this.name=f.name,this.extensions=f.extensions,this.onLoaderStateChangedObservable=new F.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.q(U)}set onParsed(U){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),U&&(this._onParsedObserver=this.onParsedObservable.add(U))}set onMeshLoaded(U){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),U&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(U))}set onSkinLoaded(U){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),U&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((X=>U(X.node,X.skinnedNode))))}set onTextureLoaded(U){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),U&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(U))}set onMaterialLoaded(U){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),U&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(U))}set onCameraLoaded(U){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),U&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(U))}set onComplete(U){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(U)}set onError(U){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(U)}set onDispose(U){this._onDisposeObserver&&this.wb.remove(this._onDisposeObserver),this._onDisposeObserver=this.wb.add(U)}set onExtensionLoaded(U){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(U)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(U){this._loggingEnabled!==U&&(this._loggingEnabled=U,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(U){this._capturePerformanceCounters!==U&&(this._capturePerformanceCounters=U,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(U){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(U)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const U of this._requests)U.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=U=>Promise.resolve(U),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.wb.notifyObservers(void 0),this.wb.clear()}loadFile(U,X,b,w,Q,z,q,S){if(ArrayBuffer.isView(X))return this._loadBinary(U,X,b,w,q,S),null;this._progressCallback=Q;const R=X.name||E.Tools.GetFilename(X);if(z){if(this.useRangeRequests){this.validate&&p.e.Warn("glTF validation is not supported when range requests are enabled");const b={abort:()=>{},onCompleteObservable:new F.e},E={readAsync:(b,F)=>new Promise(((E,w)=>{this._loadFile(U,X,(U=>{E(new Uint8Array(U))}),!0,(U=>{w(U)}),(U=>{U.setRequestHeader("Range",`bytes=${b}-${b+F-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new u(E)).then((U=>{b.onCompleteObservable.notifyObservers(b),w(U)}),q?U=>q(void 0,U):void 0),b}return this._loadFile(U,X,(X=>{this._validate(U,new Uint8Array(X,0,X.byteLength),b,R),this._unpackBinaryAsync(new u({readAsync:(U,b)=>v(X,U,b),byteLength:X.byteLength})).then((U=>{w(U)}),q?U=>q(void 0,U):void 0)}),!0,q)}return this._loadFile(U,X,(X=>{try{this._validate(U,X,b,R),w({json:this._parseJson(X)})}catch{q&&q()}}),!1,q)}_loadBinary(U,X,b,F,E,w){this._validate(U,new Uint8Array(X.buffer,X.byteOffset,X.byteLength),b,w),this._unpackBinaryAsync(new u({readAsync:(U,b)=>function(U,X,b){try{if(X<0||X>=U.byteLength)throw new RangeError("Offset is out of range.");if(X+b>U.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(U.buffer,U.byteOffset+X,b))}catch(F){return Promise.reject(F)}}(X,U,b),byteLength:X.byteLength})).then((U=>{F(U)}),E?U=>E(void 0,U):void 0)}importMeshAsync(U,X,b,F,E,w){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${w||""}`),this._loader=this._getLoader(b),this._loader.importMeshAsync(U,X,null,b,F,E,w))))}loadAsync(U,X,b,F,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(X),this._loader.loadAsync(U,X,b,F,E))))}loadAssetContainerAsync(U,X,b,F,E){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(X);const w=new O(U),Q=[];this.onMaterialLoadedObservable.add((U=>{Q.push(U)}));const z=[];this.onTextureLoadedObservable.add((U=>{z.push(U)}));const q=[];this.onCameraLoadedObservable.add((U=>{q.push(U)}));const p=[];return this.onMeshLoadedObservable.add((U=>{U.morphTargetManager&&p.push(U.morphTargetManager)})),this._loader.importMeshAsync(null,U,w,X,b,F,E).then((U=>(Array.prototype.push.apply(w.geometries,U.geometries),Array.prototype.push.apply(w.meshes,U.meshes),Array.prototype.push.apply(w.wn,U.wn),Array.prototype.push.apply(w.skeletons,U.skeletons),Array.prototype.push.apply(w.animationGroups,U.animationGroups),Array.prototype.push.apply(w.materials,Q),Array.prototype.push.apply(w.textures,z),Array.prototype.push.apply(w.lights,U.lights),Array.prototype.push.apply(w.transformNodes,U.transformNodes),Array.prototype.push.apply(w.cameras,q),Array.prototype.push.apply(w.morphTargetManagers,p),w)))}))}canDirectLoad(U){return f.canDirectLoad(U)}directLoad(U,X){if(X.startsWith("base64,"+P)||X.startsWith(";base64,"+P)||X.startsWith("application/octet-stream;base64,"+P)||X.startsWith("model/gltf-binary;base64,"+P)){const b=(0,d.b)(X);return this._validate(U,new Uint8Array(b,0,b.byteLength)),this._unpackBinaryAsync(new u({readAsync:(U,X)=>v(b,U,X),byteLength:b.byteLength}))}return this._validate(U,X),Promise.resolve({json:this._parseJson(X)})}createPlugin(U){return new s(U[f.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((U,X)=>{this.onCompleteObservable.addOnce((()=>{U()})),this.onErrorObservable.addOnce((U=>{X(U)}))}))}_setState(U){this._state!==U&&(this._state=U,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(l[this._state]))}_loadFile(U,X,b,F,E,w){const Q=U._loadFile(X,b,(U=>{this._onProgress(U,Q)}),!0,F,E,w);return Q.onCompleteObservable.add((()=>{Q._lengthComputable=!0,Q._total=Q._loaded})),this._requests.push(Q),Q}_onProgress(U,X){if(!this._progressCallback)return;X._lengthComputable=U.lengthComputable,X._loaded=U.loaded,X._total=U.total;let b=!0,F=0,E=0;for(const w of this._requests){if(void 0===w._lengthComputable||void 0===w._loaded||void 0===w._total)return;b=b&&w._lengthComputable,F+=w._loaded,E+=w._total}this._progressCallback({lengthComputable:b,loaded:F,total:b?E:0})}_validate(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),i.c.ValidateAsync(X,b,F,(X=>this.preprocessUrlAsync(b+X).then((X=>U._loadFileAsync(X,void 0,!0,!0).then((U=>new Uint8Array(U,0,U.byteLength))))))).then((U=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(U),this.onValidatedObservable.clear()}),(U=>{this._endPerformanceCounter("Validate JSON"),E.Tools.Warn(`Failed to validate: ${U.message}`),this.onValidatedObservable.clear()})))}_getLoader(U){const X=U.json.asset||{};this._log(`Asset version: ${X.version}`),X.minVersion&&this._log(`Asset minimum version: ${X.minVersion}`),X.generator&&this._log(`Asset generator: ${X.generator}`);const b=s._parseVersion(X.version);if(!b)throw new Error("Invalid version: "+X.version);if(void 0!==X.minVersion){const U=s._parseVersion(X.minVersion);if(!U)throw new Error("Invalid minimum version: "+X.minVersion);if(s._compareVersion(U,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+X.minVersion)}const F={1:s._CreateGLTF1Loader,2:s._CreateGLTF2Loader}[b.major];if(!F)throw new Error("Unsupported version: "+X.version);return F(this)}_parseJson(U){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${U.length}`);const X=JSON.parse(U);return this._endPerformanceCounter("Parse JSON"),X}_unpackBinaryAsync(U){return this._startPerformanceCounter("Unpack Binary"),U.loadAsync(20).then((()=>{const X=U.readUint32();if(1179937895!==X)throw new k.g("Unexpected magic: "+X,k.f.GLTFLoaderUnexpectedMagicError);const b=U.readUint32();this.loggingEnabled&&this._log(`Binary version: ${b}`);const F=U.readUint32();let E;switch(this.useRangeRequests||F===U.buffer.byteLength||p.e.Warn(`Length in header does not match actual data length: ${F} != ${U.buffer.byteLength}`),b){case 1:E=this._unpackBinaryV1Async(U,F);break;case 2:E=this._unpackBinaryV2Async(U,F);break;default:throw new Error("Unsupported version: "+b)}return this._endPerformanceCounter("Unpack Binary"),E}))}_unpackBinaryV1Async(U,X){const b=U.readUint32(),F=U.readUint32();if(0!==F)throw new Error(`Unexpected content format: ${F}`);const E=X-U.byteOffset,w={json:this._parseJson(U.readString(b)),bin:null};if(0!==E){const X=U.byteOffset;w.bin={readAsync:(b,F)=>U.buffer.readAsync(X+b,F),byteLength:E}}return Promise.resolve(w)}_unpackBinaryV2Async(U,X){const b=1313821514,F=5130562,E=U.readUint32();if(U.readUint32()!==b)throw new Error("First chunk format is not JSON");return U.byteOffset+E===X?U.loadAsync(E).then((()=>({json:this._parseJson(U.readString(E)),bin:null}))):U.loadAsync(E+8).then((()=>{const w={json:this._parseJson(U.readString(E)),bin:null},Q=()=>{const E=U.readUint32();switch(U.readUint32()){case b:throw new Error("Unexpected JSON chunk");case F:{const X=U.byteOffset;w.bin={readAsync:(b,F)=>U.buffer.readAsync(X+b,F),byteLength:E},U.skipBytes(E);break}default:U.skipBytes(E)}return U.byteOffset!==X?U.loadAsync(8).then(Q):Promise.resolve(w)};return Q()}))}static _parseVersion(U){if("1.0"===U||"1.0.1"===U)return{major:1,minor:0};const X=(U+"").match(/^(\d+)\.(\d+)/);return X?{major:parseInt(X[1]),minor:parseInt(X[2])}:null}static _compareVersion(U,X){return U.major>X.major?1:U.major<X.major?-1:U.minor>X.minor?1:U.minor<X.minor?-1:0}_logOpen(U){this._log(U),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(U){const X=s._logSpaces.substring(0,2*this._logIndentLevel);p.e.Log(`${X}${U}`)}_logDisabled(U){}_startPerformanceCounterEnabled(U){E.Tools.StartPerformanceCounter(U)}_startPerformanceCounterDisabled(U){}_endPerformanceCounterEnabled(U){E.Tools.EndPerformanceCounter(U)}_endPerformanceCounterDisabled(U){}}s.IncrementalLoading=!0,s.HomogeneousCoordinates=!1,s._logSpaces="                                ",(0,w.c)(new s)},13210:(U,X,b)=>{"use strict";b.d(X,{c:()=>Q});var F=b(11385);function E(U,X,b,F){const E={externalResourceFunction:F};return b&&(E.uri="file:"===X?b:X+b),ArrayBuffer.isView(U)?GLTFValidator.validateBytes(U,E):GLTFValidator.validateString(U,E)}function w(){const U=[];onmessage=X=>{const b=X.data;switch(b.id){case"init":importScripts(b.url);break;case"validate":E(b.data,b.rootUrl,b.fileName,(X=>new Promise(((b,F)=>{const E=U.length;U.push({resolve:b,reject:F}),postMessage({id:"getExternalResource",index:E,uri:X})})))).then((U=>{postMessage({id:"validate.resolve",value:U})}),(U=>{postMessage({id:"validate.reject",reason:U})}));break;case"getExternalResource.resolve":U[b.index].resolve(b.value);break;case"getExternalResource.reject":U[b.index].reject(b.reason)}}}class Q{static ValidateAsync(U,X,b,Q){return"function"===typeof Worker?new Promise(((z,q)=>{const p=`${E}(${w})()`,S=URL.createObjectURL(new Blob([p],{type:"application/javascript"})),R=new Worker(S),n=U=>{R.removeEventListener("error",n),R.removeEventListener("message",a),q(U)},a=U=>{const X=U.data;switch(X.id){case"getExternalResource":Q(X.uri).then((U=>{R.postMessage({id:"getExternalResource.resolve",index:X.index,value:U},[U.buffer])}),(U=>{R.postMessage({id:"getExternalResource.reject",index:X.index,reason:U})}));break;case"validate.resolve":R.removeEventListener("error",n),R.removeEventListener("message",a),z(X.value),R.terminate();break;case"validate.reject":R.removeEventListener("error",n),R.removeEventListener("message",a),q(X.reason),R.terminate()}};if(R.addEventListener("error",n),R.addEventListener("message",a),R.postMessage({id:"init",url:F.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(U)){const F=U.slice();R.postMessage({id:"validate",data:F,rootUrl:X,fileName:b},[F.buffer])}else R.postMessage({id:"validate",data:U,rootUrl:X,fileName:b})})):(this._LoadScriptPromise||(this._LoadScriptPromise=F.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>E(U,X,b,Q))))}}Q.Configuration={url:`${F.Tools._DefaultCdnUrl}/gltf_validator.js`}},13805:(U,X,b)=>{"use strict";b.d(X,{c:()=>f});var F=b(11576),E=b(11583),w=b(11623),Q=b(11593),z=b(11987),q=b(11922),p=b(11664),S=b(11833),R=b(11551),n=b(11499);b(12982),b(12894),b(12916),b(12902),b(12922),b(12926),b(12929);const a="imageProcessingCompatibility",J="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";n.c.IncludesShadersStore[a]||(n.c.IncludesShadersStore[a]=J);const m="skyPixelShader",x="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";n.c.ShadersStore[m]||(n.c.ShadersStore[m]=x);b(12993),b(12935),b(12937),b(12946),b(12943);const I="skyVertexShader",O="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";n.c.ShadersStore[I]||(n.c.ShadersStore[I]=O);var N=b(11916),u=b(11972),i=b(11969);class P extends z.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class f extends q.b{constructor(U,X){super(U,X),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Q.JX(0,100,0),this.useSunPosition=!1,this.cameraOffset=Q.JX.Zero(),this.up=Q.JX.Up(),this.dithering=!1,this._cameraPosition=Q.JX.Zero(),this._skyOrientation=new Q.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(U,X){const b=X._drawWrapper;if(this.isFrozen&&b.effect&&b._wasPreviouslyReady)return!0;X.materialDefines||(X.materialDefines=new P);const F=X.materialDefines,E=this.fU();if(this._isReadyForSubMesh(X))return!0;if((0,i.T)(U,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,F),(0,i.N)(U,F,!0,!1),F.IMAGEPROCESSINGPOSTPROCESS!==E.imageProcessingConfiguration.applyByPostProcess&&F.markAsMiscDirty(),F.DITHER!==this.dithering&&F.markAsMiscDirty(),F.isDirty){F.markAsProcessed(),E.resetCachedMaterial();const U=new N.d;F.FOG&&U.addFallback(1,"FOG"),F.IMAGEPROCESSINGPOSTPROCESS=E.imageProcessingConfiguration.applyByPostProcess,F.DITHER=this.dithering;const b=[p.h.PositionKind];F.VERTEXCOLOR&&b.push(p.h.ColorKind);const w="sky",Q=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,u.b)(Q);const z=F.toString();X.setEffect(E.getEngine().createEffect(w,b,Q,[],z,U,this.onCompiled,this.onError),F,this._materialContext)}return!(!X.effect||!X.effect.isReady())&&(F._renderId=E.getRenderId(),b._wasPreviouslyReady=!0,!0)}bindForSubMesh(U,X,b){const F=this.fU(),E=b.materialDefines;if(!E)return;const w=b.effect;if(!w)return;this._activeEffect=w,this.bindOnlyWorldMatrix(U),this._activeEffect.setMatrix("viewProjection",F.getTransformMatrix()),this._mustRebind(F,w,b)&&((0,u.d)(w,this,F),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,i.l)(E,w,F)),F.fogEnabled&&X.applyFog&&F.fogMode!==S.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",F.getViewMatrix()),(0,i.g)(F,X,this._activeEffect);const z=F.activeCamera;if(z){const U=z.getWorldMatrix();this._cameraPosition.x=U.m[12],this._cameraPosition.y=U.m[13],this._cameraPosition.z=U.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const U=Math.PI*(this.inclination-.5),X=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(X)*Math.cos(U),this.sunPosition.y=this.distance*Math.sin(-U),this.sunPosition.z=this.distance*Math.sin(X)*Math.cos(U),Q.Quaternion.FromUnitVectorsToRef(Q.JX.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(X,this._activeEffect,b)}getAnimatables(){return[]}dispose(U){super.dispose(U)}clone(U){return w.d.Clone((()=>new f(U,this.fU())),this)}serialize(){const U=super.serialize();return U.customType="BABYLON.SkyMaterial",U}getClassName(){return"SkyMaterial"}static Parse(U,X,b){return w.d.Parse((()=>new f(U.name,X)),U,X,b)}}(0,F.c)([(0,E.J)()],f.prototype,"luminance",void 0),(0,F.c)([(0,E.J)()],f.prototype,"turbidity",void 0),(0,F.c)([(0,E.J)()],f.prototype,"rayleigh",void 0),(0,F.c)([(0,E.J)()],f.prototype,"mieCoefficient",void 0),(0,F.c)([(0,E.J)()],f.prototype,"mieDirectionalG",void 0),(0,F.c)([(0,E.J)()],f.prototype,"distance",void 0),(0,F.c)([(0,E.J)()],f.prototype,"inclination",void 0),(0,F.c)([(0,E.J)()],f.prototype,"azimuth",void 0),(0,F.c)([(0,E.F)()],f.prototype,"sunPosition",void 0),(0,F.c)([(0,E.J)()],f.prototype,"useSunPosition",void 0),(0,F.c)([(0,E.F)()],f.prototype,"cameraOffset",void 0),(0,F.c)([(0,E.F)()],f.prototype,"up",void 0),(0,F.c)([(0,E.J)()],f.prototype,"dithering",void 0),(0,R.f)("BABYLON.SkyMaterial",f)},12298:(U,X,b)=>{"use strict";function F(U,X){X.headers=U.headers||{},X.statusMessage=U.statusText,X.statusCode=U.status,X.data=U.response}function E(U,X,b){return new Promise((function(E,w){b=b||{};var Q,z,q,p=new XMLHttpRequest,S=b.body,R=b.headers||{};for(Q in b.timeout&&(p.timeout=b.timeout),p.ontimeout=p.onerror=function(U){U.timeout="timeout"==U.type,w(U)},p.open(U,X.href||X),p.onload=function(){for(q=p.getAllResponseHeaders().trim().split(/[\r\n]+/),F(p,p);z=q.shift();)z=z.split(": "),p.headers[z.shift().toLowerCase()]=z.join(": ");if((z=p.headers["content-type"])&&~z.indexOf("application/json"))try{p.data=JSON.parse(p.data,b.reviver)}catch(U){return F(p,U),w(U)}(p.status>=400?w:E)(p)},typeof FormData<"u"&&S instanceof FormData||S&&"object"==typeof S&&(R["content-type"]="application/json",S=JSON.stringify(S)),p.withCredentials=!!b.withCredentials,R)p.setRequestHeader(Q,R[Q]);p.send(S)}))}b.r(X),b.d(X,{del:()=>q,get:()=>w,patch:()=>z,post:()=>Q,put:()=>p,send:()=>E});var w=E.bind(E,"GET"),Q=E.bind(E,"POST"),z=E.bind(E,"PATCH"),q=E.bind(E,"DELETE"),p=E.bind(E,"PUT")},13894:(U,X,b)=>{"use strict";b.d(X,{b:()=>R});const F=.5*(Math.sqrt(3)-1),E=(3-Math.sqrt(3))/6,w=1/3,Q=1/6,z=(Math.sqrt(5)-1)/4,q=(5-Math.sqrt(5))/20,p=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),S=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const R=class{constructor(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const X="function"==typeof U?U:function(U){let X=0,b=0,F=0,E=1;const w=function(){let U=4022871197;return function(X){X=X.toString();for(let b=0;b<X.length;b++){U+=X.charCodeAt(b);let F=.02519603282416938*U;U=F>>>0,F-=U,F*=U,U=F>>>0,F-=U,U+=4294967296*F}return 2.3283064365386963e-10*(U>>>0)}}();X=w(" "),b=w(" "),F=w(" "),X-=w(U),X<0&&(X+=1);b-=w(U),b<0&&(b+=1);F-=w(U),F<0&&(F+=1);return function(){const U=2091639*X+2.3283064365386963e-10*E;return X=b,b=F,F=U-(E=0|U)}}(U);this.p=function(U){const X=new Uint8Array(256);for(let b=0;b<256;b++)X[b]=b;for(let b=0;b<255;b++){const F=b+~~(U()*(256-b)),E=X[b];X[b]=X[F],X[F]=E}return X}(X),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let b=0;b<512;b++)this.perm[b]=this.p[255&b],this.permMod12[b]=this.perm[b]%12}noise2D(U,X){const b=this.permMod12,w=this.perm;let Q=0,z=0,q=0;const S=(U+X)*F,R=Math.floor(U+S),n=Math.floor(X+S),a=(R+n)*E,J=U-(R-a),m=X-(n-a);let x,I;J>m?(x=1,I=0):(x=0,I=1);const O=J-x+E,N=m-I+E,u=J-1+2*E,i=m-1+2*E,P=255&R,f=255&n;let j=.5-J*J-m*m;if(j>=0){const U=3*b[P+w[f]];j*=j,Q=j*j*(p[U]*J+p[U+1]*m)}let e=.5-O*O-N*N;if(e>=0){const U=3*b[P+x+w[f+I]];e*=e,z=e*e*(p[U]*O+p[U+1]*N)}let l=.5-u*u-i*i;if(l>=0){const U=3*b[P+1+w[f+1]];l*=l,q=l*l*(p[U]*u+p[U+1]*i)}return 70*(Q+z+q)}noise3D(U,X,b){const F=this.permMod12,E=this.perm;let z,q,S,R;const n=(U+X+b)*w,a=Math.floor(U+n),J=Math.floor(X+n),m=Math.floor(b+n),x=(a+J+m)*Q,I=U-(a-x),O=X-(J-x),N=b-(m-x);let u,i,P,f,j,e;I>=O?O>=N?(u=1,i=0,P=0,f=1,j=1,e=0):I>=N?(u=1,i=0,P=0,f=1,j=0,e=1):(u=0,i=0,P=1,f=1,j=0,e=1):O<N?(u=0,i=0,P=1,f=0,j=1,e=1):I<N?(u=0,i=1,P=0,f=0,j=1,e=1):(u=0,i=1,P=0,f=1,j=1,e=0);const l=I-u+Q,d=O-i+Q,k=N-P+Q,v=I-f+2*Q,A=O-j+2*Q,s=N-e+2*Q,h=I-1+.5,B=O-1+.5,o=N-1+.5,y=255&a,t=255&J,W=255&m;let Y=.6-I*I-O*O-N*N;if(Y<0)z=0;else{const U=3*F[y+E[t+E[W]]];Y*=Y,z=Y*Y*(p[U]*I+p[U+1]*O+p[U+2]*N)}let K=.6-l*l-d*d-k*k;if(K<0)q=0;else{const U=3*F[y+u+E[t+i+E[W+P]]];K*=K,q=K*K*(p[U]*l+p[U+1]*d+p[U+2]*k)}let V=.6-v*v-A*A-s*s;if(V<0)S=0;else{const U=3*F[y+f+E[t+j+E[W+e]]];V*=V,S=V*V*(p[U]*v+p[U+1]*A+p[U+2]*s)}let g=.6-h*h-B*B-o*o;if(g<0)R=0;else{const U=3*F[y+1+E[t+1+E[W+1]]];g*=g,R=g*g*(p[U]*h+p[U+1]*B+p[U+2]*o)}return 32*(z+q+S+R)}noise4D(U,X,b,F){const E=this.perm;let w,Q,p,R,n;const a=(U+X+b+F)*z,J=Math.floor(U+a),m=Math.floor(X+a),x=Math.floor(b+a),I=Math.floor(F+a),O=(J+m+x+I)*q,N=U-(J-O),u=X-(m-O),i=b-(x-O),P=F-(I-O);let f=0,j=0,e=0,l=0;N>u?f++:j++,N>i?f++:e++,N>P?f++:l++,u>i?j++:e++,u>P?j++:l++,i>P?e++:l++;const d=f>=3?1:0,k=j>=3?1:0,v=e>=3?1:0,A=l>=3?1:0,s=f>=2?1:0,h=j>=2?1:0,B=e>=2?1:0,o=l>=2?1:0,y=f>=1?1:0,t=j>=1?1:0,W=e>=1?1:0,Y=l>=1?1:0,K=N-d+q,V=u-k+q,g=i-v+q,L=P-A+q,D=N-s+2*q,G=u-h+2*q,Z=i-B+2*q,c=P-o+2*q,r=N-y+3*q,M=u-t+3*q,H=i-W+3*q,T=P-Y+3*q,C=N-1+4*q,UU=u-1+4*q,XU=i-1+4*q,bU=P-1+4*q,FU=255&J,EU=255&m,wU=255&x,QU=255&I;let zU=.6-N*N-u*u-i*i-P*P;if(zU<0)w=0;else{const U=E[FU+E[EU+E[wU+E[QU]]]]%32*4;zU*=zU,w=zU*zU*(S[U]*N+S[U+1]*u+S[U+2]*i+S[U+3]*P)}let qU=.6-K*K-V*V-g*g-L*L;if(qU<0)Q=0;else{const U=E[FU+d+E[EU+k+E[wU+v+E[QU+A]]]]%32*4;qU*=qU,Q=qU*qU*(S[U]*K+S[U+1]*V+S[U+2]*g+S[U+3]*L)}let pU=.6-D*D-G*G-Z*Z-c*c;if(pU<0)p=0;else{const U=E[FU+s+E[EU+h+E[wU+B+E[QU+o]]]]%32*4;pU*=pU,p=pU*pU*(S[U]*D+S[U+1]*G+S[U+2]*Z+S[U+3]*c)}let SU=.6-r*r-M*M-H*H-T*T;if(SU<0)R=0;else{const U=E[FU+y+E[EU+t+E[wU+W+E[QU+Y]]]]%32*4;SU*=SU,R=SU*SU*(S[U]*r+S[U+1]*M+S[U+2]*H+S[U+3]*T)}let RU=.6-C*C-UU*UU-XU*XU-bU*bU;if(RU<0)n=0;else{const U=E[FU+1+E[EU+1+E[wU+1+E[QU+1]]]]%32*4;RU*=RU,n=RU*RU*(S[U]*C+S[U+1]*UU+S[U+2]*XU+S[U+3]*bU)}return 27*(w+Q+p+R+n)}}}}]);