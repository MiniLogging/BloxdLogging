/*! For license information please see l65s6m.32.e7f7fc35.chunk.js.LICENSE.txt */
(self.hwpa2z1pqte=self.hwpa2z1pqte||[]).push([[32],{14884:(h,R,l)=>{"use strict";var j=l(14886),a=l(14894),D=l(14896);l.g.__TYPEDARRAY_POOL||(l.g.__TYPEDARRAY_POOL={UINT8:a([32,0]),UINT16:a([32,0]),UINT32:a([32,0]),INT8:a([32,0]),INT16:a([32,0]),INT32:a([32,0]),FLOAT:a([32,0]),DOUBLE:a([32,0]),DATA:a([32,0]),UINT8C:a([32,0]),BUFFER:a([32,0])});var U="undefined"!==typeof Uint8ClampedArray,F=l.g.__TYPEDARRAY_POOL;F.UINT8C||(F.UINT8C=a([32,0])),F.BUFFER||(F.BUFFER=a([32,0]));var w=F.DATA,mh=F.BUFFER;function u(h){if(h){var R=h.length||h.byteLength,l=j.log2(R);w[l].push(h)}}function c(h){h=j.nextPow2(h);var R=j.log2(h),l=w[R];return l.length>0?l.pop():new ArrayBuffer(h)}function J(h){return new Uint8Array(c(h),0,h)}function q(h){return new Uint16Array(c(2*h),0,h)}function Q(h){return new Uint32Array(c(4*h),0,h)}function Y(h){return new Int8Array(c(h),0,h)}function s(h){return new Int16Array(c(2*h),0,h)}function t(h){return new Int32Array(c(4*h),0,h)}function f(h){return new Float32Array(c(4*h),0,h)}function T(h){return new Float64Array(c(8*h),0,h)}function E(h){return U?new Uint8ClampedArray(c(h),0,h):J(h)}function x(h){return new DataView(c(h),0,h)}R.free=function(h){if(D(h))mh[j.log2(h.length)].push(h);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(h)&&(h=h.buffer),!h)return;var R=h.length||h.byteLength,l=0|j.log2(R);w[l].push(h)}},R.freeUint8=R.freeUint16=R.freeUint32=R.freeInt8=R.freeInt16=R.freeInt32=R.freeFloat32=R.freeFloat=R.freeFloat64=R.freeDouble=R.freeUint8Clamped=R.freeDataView=function(h){u(h.buffer)},R.freeArrayBuffer=u,R.freeBuffer=function(h){mh[j.log2(h.length)].push(h)},R.malloc=function(h,R){if(void 0===R||"arraybuffer"===R)return c(h);switch(R){case"uint8":return J(h);case"uint16":return q(h);case"uint32":return Q(h);case"int8":return Y(h);case"int16":return s(h);case"int32":return t(h);case"float":case"float32":return f(h);case"double":case"float64":return T(h);case"uint8_clamped":return E(h);case"buffer":throw"Buffer not supported";case"data":case"dataview":return x(h);default:return null}return null},R.mallocArrayBuffer=c,R.mallocUint8=J,R.mallocUint16=q,R.mallocUint32=Q,R.mallocInt8=Y,R.mallocInt16=s,R.mallocInt32=t,R.mallocFloat32=R.mallocFloat=f,R.mallocFloat64=R.mallocDouble=T,R.mallocUint8Clamped=E,R.mallocDataView=x,R.clearCache=function(){for(var h=0;h<32;++h)F.UINT8[h].length=0,F.UINT16[h].length=0,F.UINT32[h].length=0,F.INT8[h].length=0,F.INT16[h].length=0,F.INT32[h].length=0,F.FLOAT[h].length=0,F.DOUBLE[h].length=0,F.UINT8C[h].length=0,w[h].length=0,mh[h].length=0}},14979:(h,R,l)=>{h.exports=a;var j=l(13704);function a(h,R){if(!(this instanceof a))return new a(h,R);var l=j.create();j.add(l,h,R),this.base=j.min(j.create(),h,l),this.Du=j.clone(R),this.max=j.max(j.create(),h,l),this.mag=j.length(this.Du)}var D=a.prototype;D.width=function(){return this.Du[0]},D.height=function(){return this.Du[1]},D.depth=function(){return this.Du[2]},D.x0=function(){return this.base[0]},D.y0=function(){return this.base[1]},D.z0=function(){return this.base[2]},D.x1=function(){return this.max[0]},D.y1=function(){return this.max[1]},D.z1=function(){return this.max[2]},D.translate=function(h){return j.add(this.max,this.max,h),j.add(this.base,this.base,h),this},D.setPosition=function(h){return j.add(this.max,h,this.Du),j.i(this.base,h),this},D.expand=function(h){var R=j.create(),l=j.create();return j.max(R,h.max,this.max),j.min(l,h.base,this.base),j.fR(R,R,l),new a(l,R)},D.intersects=function(h){return!(h.base[0]>this.max[0])&&(!(h.base[1]>this.max[1])&&(!(h.base[2]>this.max[2])&&(!(h.max[0]<this.base[0])&&(!(h.max[1]<this.base[1])&&!(h.max[2]<this.base[2])))))},D.touches=function(h){var R=this.union(h);return null!==R&&(0==R.width()||0==R.height()||0==R.depth())},D.union=function(h){if(!this.intersects(h))return null;var R=Math.max(h.base[0],this.base[0]),l=Math.max(h.base[1],this.base[1]),j=Math.max(h.base[2],this.base[2]);return new a([R,l,j],[Math.min(h.max[0],this.max[0])-R,Math.min(h.max[1],this.max[1])-l,Math.min(h.max[2],this.max[2])-j])}},14886:(h,R)=>{"use strict";function l(h){var R=32;return(h&=-h)&&R--,65535&h&&(R-=16),16711935&h&&(R-=8),252645135&h&&(R-=4),858993459&h&&(R-=2),1431655765&h&&(R-=1),R}R.INT_BITS=32,R.INT_MAX=2147483647,R.INT_MIN=-1<<31,R.sign=function(h){return(h>0)-(h<0)},R.abs=function(h){var R=h>>31;return(h^R)-R},R.min=function(h,R){return R^(h^R)&-(h<R)},R.max=function(h,R){return h^(h^R)&-(h<R)},R.isPow2=function(h){return!(h&h-1)&&!!h},R.log2=function(h){var R,l;return R=(h>65535)<<4,R|=l=((h>>>=R)>255)<<3,R|=l=((h>>>=l)>15)<<2,(R|=l=((h>>>=l)>3)<<1)|(h>>>=l)>>1},R.log10=function(h){return h>=1e9?9:h>=1e8?8:h>=1e7?7:h>=1e6?6:h>=1e5?5:h>=1e4?4:h>=1e3?3:h>=100?2:h>=10?1:0},R.popCount=function(h){return 16843009*((h=(858993459&(h-=h>>>1&1431655765))+(h>>>2&858993459))+(h>>>4)&252645135)>>>24},R.countTrailingZeros=l,R.nextPow2=function(h){return h+=0===h,--h,h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)+1},R.prevPow2=function(h){return h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)-(h>>>1)},R.parity=function(h){return h^=h>>>16,h^=h>>>8,h^=h>>>4,27030>>>(h&=15)&1};var j=new Array(256);!function(h){for(var R=0;R<256;++R){var l=R,j=R,a=7;for(l>>>=1;l;l>>>=1)j<<=1,j|=1&l,--a;h[R]=j<<a&255}}(j),R.reverse=function(h){return j[255&h]<<24|j[h>>>8&255]<<16|j[h>>>16&255]<<8|j[h>>>24&255]},R.interleave2=function(h,R){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))|(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))<<1},R.deinterleave2=function(h,R){return(h=65535&((h=16711935&((h=252645135&((h=858993459&((h=h>>>R&1431655765)|h>>>1))|h>>>2))|h>>>4))|h>>>16))<<16>>16},R.interleave3=function(h,R,l){return h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2),(h|=(R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2))<<1)|(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<2},R.deinterleave3=function(h,R){return(h=1023&((h=4278190335&((h=251719695&((h=3272356035&((h=h>>>R&1227133513)|h>>>2))|h>>>4))|h>>>8))|h>>>16))<<22>>22},R.nextCombination=function(h){var R=h|h-1;return R+1|(~R&-~R)-1>>>l(h)+1}},14879:(h,R,l)=>{"use strict";h.exports=function(h,R,l){switch(arguments.length){case 1:return j=[],mh(a=h,a,u,!0),j;case 2:return"function"===typeof R?mh(h,h,R,!0):function(h,R){return j=[],mh(h,R,u,!1),j}(h,R);case 3:return mh(h,R,l,!1);default:throw new Error("box-intersect: Invalid arguments")}var a};var j,a=l(14884),D=l(14900),U=l(14913);function F(h,R){for(var l=0;l<h;++l)if(!(R[l]<=R[l+h]))return!0;return!1}function w(h,R,l,j){for(var a=0,D=0,U=0,w=h.length;U<w;++U){var mh=h[U];if(!F(R,mh)){for(var u=0;u<2*R;++u)l[a++]=mh[u];j[D++]=U}}return D}function mh(h,R,l,j){var F=h.length,mh=R.length;if(!(F<=0||mh<=0)){var u=h[0].length>>>1;if(!(u<=0)){var c,J=a.mallocDouble(2*u*F),q=a.mallocInt32(F);if((F=w(h,u,J,q))>0){if(1===u&&j)D.init(F),c=D.sweepComplete(u,l,0,F,J,q,0,F,J,q);else{var Q=a.mallocDouble(2*u*mh),Y=a.mallocInt32(mh);(mh=w(R,u,Q,Y))>0&&(D.init(F+mh),c=1===u?D.sweepBipartite(u,l,0,F,J,q,0,mh,Q,Y):U(u,l,j,F,J,q,mh,Q,Y),a.free(Q),a.free(Y))}a.free(J),a.free(q)}return c}}}function u(h,R){j.push([h,R])}},14922:(h,R)=>{"use strict";var l="d",j="ax",a="fp",D="es",U="rs",F="re",w="rb",mh="bs",u="be",c="bb",J=[l,j,"vv",U,F,w,"ri",mh,u,c,"bi"];function q(h){var R="bruteForce"+(h?"Full":"Partial"),j=[],U=J.slice();h||U.splice(3,0,a);var F=["function "+R+"("+U.join()+"){"];function w(R,a){var U=function(h,R,j){var a="bruteForce"+(h?"Red":"Blue")+(R?"Flip":"")+(j?"Full":""),U=["function ",a,"(",J.join(),"){","var ",D,"=2*",l,";"],F="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",w="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(j?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return h?U.push(F,"Q",":",w):U.push(w,"Q",":",F),j?U.push("if(y1<x0||x1<y0)continue;"):R?U.push("if(y0<=x0||x1<y0)continue;"):U.push("if(y0<x0||x1<y0)continue;"),U.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),R?U.push("yi,xi"):U.push("xi,yi"),U.push(");if(rv!==void 0)return rv;}}}"),{name:a,code:U.join("")}}(R,a,h);j.push(U.code),F.push("return "+U.name+"("+J.join()+");")}F.push("if(re-rs>be-bs){"),h?(w(!0,!1),F.push("}else{"),w(!1,!1)):(F.push("if(fp){"),w(!0,!0),F.push("}else{"),w(!0,!1),F.push("}}else{if(fp){"),w(!1,!0),F.push("}else{"),w(!1,!1),F.push("}")),F.push("}}return "+R);var mh=j.join("")+F.join("");return new Function(mh)()}R.partial=q(!1),R.full=q(!0)},14913:(h,R,l)=>{"use strict";h.exports=function(h,R,l,D,u,b,I,L,n){!function(h,R){var l=8*a.log2(R+1)*(h+1)|0,D=a.nextPow2(E*l);G.length<D&&(j.free(G),G=j.mallocInt32(D));var U=a.nextPow2(x*l);p.length<U&&(j.free(p),p=j.mallocDouble(U))}(h,D+I);var r,P=0,z=2*h;O(P++,0,0,D,0,I,l?16:0,-1/0,1/0),l||O(P++,0,0,I,0,D,1,-1/0,1/0);for(;P>0;){var o=(P-=1)*E,K=G[o],W=G[o+1],g=G[o+2],H=G[o+3],k=G[o+4],C=G[o+5],A=P*x,e=p[A],S=p[A+1],Z=1&C,M=!!(16&C),i=u,d=b,X=L,V=n;if(Z&&(i=L,d=n,X=u,V=b),!(2&C&&W>=(g=s(h,K,W,g,i,d,S)))&&!(4&C&&(W=t(h,K,W,g,i,d,e))>=g)){var B=g-W,N=k-H;if(M){if(h*B*(B+N)<q){if(void 0!==(r=w.scanComplete(h,K,R,W,g,i,d,H,k,X,V)))return r;continue}}else{if(h*Math.min(B,N)<c){if(void 0!==(r=U(h,K,R,Z,W,g,i,d,H,k,X,V)))return r;continue}if(h*B*N<J){if(void 0!==(r=w.scanBipartite(h,K,R,Z,W,g,i,d,H,k,X,V)))return r;continue}}var hh=Q(h,K,W,g,i,d,e,S);if(W<hh)if(h*(hh-W)<c){if(void 0!==(r=F(h,K+1,R,W,hh,i,d,H,k,X,V)))return r}else if(K===h-2){if(void 0!==(r=Z?w.sweepBipartite(h,R,H,k,X,V,W,hh,i,d):w.sweepBipartite(h,R,W,hh,i,d,H,k,X,V)))return r}else O(P++,K+1,W,hh,H,k,Z,-1/0,1/0),O(P++,K+1,H,k,W,hh,1^Z,-1/0,1/0);if(hh<g){var Rh=mh(h,K,H,k,X,V),lh=X[z*Rh+K],jh=Y(h,K,Rh,k,X,V,lh);if(jh<k&&O(P++,K,hh,g,jh,k,(4|Z)+(M?16:0),lh,S),H<Rh&&O(P++,K,hh,g,H,Rh,(2|Z)+(M?16:0),e,lh),Rh+1===jh){if(void 0!==(r=M?v(h,K,R,hh,g,i,d,Rh,X,V[Rh]):y(h,K,R,Z,hh,g,i,d,Rh,X,V[Rh])))return r}else if(Rh<jh){var ah;if(M){if(hh<(ah=f(h,K,hh,g,i,d,lh))){var Dh=Y(h,K,hh,ah,i,d,lh);if(K===h-2){if(hh<Dh&&void 0!==(r=w.sweepComplete(h,R,hh,Dh,i,d,Rh,jh,X,V)))return r;if(Dh<ah&&void 0!==(r=w.sweepBipartite(h,R,Dh,ah,i,d,Rh,jh,X,V)))return r}else hh<Dh&&O(P++,K+1,hh,Dh,Rh,jh,16,-1/0,1/0),Dh<ah&&(O(P++,K+1,Dh,ah,Rh,jh,0,-1/0,1/0),O(P++,K+1,Rh,jh,Dh,ah,1,-1/0,1/0))}}else hh<(ah=Z?T(h,K,hh,g,i,d,lh):f(h,K,hh,g,i,d,lh))&&(K===h-2?r=Z?w.sweepBipartite(h,R,Rh,jh,X,V,hh,ah,i,d):w.sweepBipartite(h,R,hh,ah,i,d,Rh,jh,X,V):(O(P++,K+1,hh,ah,Rh,jh,Z,-1/0,1/0),O(P++,K+1,Rh,jh,hh,ah,1^Z,-1/0,1/0)))}}}}};var j=l(14884),a=l(14886),D=l(14922),U=D.partial,F=D.full,w=l(14900),mh=l(14928),u=l(14934),c=128,J=1<<22,q=1<<22,Q=u("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),Y=u("lo===p0",["p0"]),s=u("lo<p0",["p0"]),t=u("hi<=p0",["p0"]),f=u("lo<=p0&&p0<=hi",["p0"]),T=u("lo<p0&&p0<=hi",["p0"]),E=6,x=2,G=j.mallocInt32(1024),p=j.mallocDouble(1024);function O(h,R,l,j,a,D,U,F,w){var mh=E*h;G[mh]=R,G[mh+1]=l,G[mh+2]=j,G[mh+3]=a,G[mh+4]=D,G[mh+5]=U;var u=x*h;p[u]=F,p[u+1]=w}function y(h,R,l,j,a,D,U,F,w,mh,u){var c=2*h,J=w*c,q=mh[J+R];h:for(var Q=a,Y=a*c;Q<D;++Q,Y+=c){var s=U[Y+R],t=U[Y+R+h];if(!(q<s||t<q)&&(!j||q!==s)){for(var f,T=F[Q],E=R+1;E<h;++E){s=U[Y+E],t=U[Y+E+h];var x=mh[J+E],G=mh[J+E+h];if(t<x||G<s)continue h}if(void 0!==(f=j?l(u,T):l(T,u)))return f}}}function v(h,R,l,j,a,D,U,F,w,mh){var u=2*h,c=F*u,J=w[c+R];h:for(var q=j,Q=j*u;q<a;++q,Q+=u){var Y=U[q];if(Y!==mh){var s=D[Q+R],t=D[Q+R+h];if(!(J<s||t<J)){for(var f=R+1;f<h;++f){s=D[Q+f],t=D[Q+f+h];var T=w[c+f],E=w[c+f+h];if(t<T||E<s)continue h}var x=l(Y,mh);if(void 0!==x)return x}}}}},14928:(h,R,l)=>{"use strict";h.exports=function(h,R,l,U,F,w){if(U<=l+1)return l;var mh=l,u=U,c=U+l>>>1,J=2*h,q=c,Q=F[J*c+R];for(;mh<u;){if(u-mh<a){D(h,R,mh,u,F,w),Q=F[J*c+R];break}var Y=u-mh,s=Math.random()*Y+mh|0,t=F[J*s+R],f=Math.random()*Y+mh|0,T=F[J*f+R],E=Math.random()*Y+mh|0,x=F[J*E+R];t<=T?x>=T?(q=f,Q=T):t>=x?(q=s,Q=t):(q=E,Q=x):T>=x?(q=f,Q=T):x>=t?(q=s,Q=t):(q=E,Q=x);for(var G=J*(u-1),p=J*q,O=0;O<J;++O,++G,++p){var y=F[G];F[G]=F[p],F[p]=y}var v=w[u-1];w[u-1]=w[q],w[q]=v;for(G=J*(u-1),p=J*(q=j(h,R,mh,u-1,F,w,Q)),O=0;O<J;++O,++G,++p){y=F[G];F[G]=F[p],F[p]=y}v=w[u-1];if(w[u-1]=w[q],w[q]=v,c<q){for(u=q-1;mh<u&&F[J*(u-1)+R]===Q;)u-=1;u+=1}else{if(!(q<c))break;for(mh=q+1;mh<u&&F[J*mh+R]===Q;)mh+=1}}return j(h,R,l,c,F,w,F[J*c+R])};var j=l(14934)("lo<p0",["p0"]),a=8;function D(h,R,l,j,a,D){for(var U=2*h,F=U*(l+1)+R,w=l+1;w<j;++w,F+=U)for(var mh=a[F],u=w,c=U*(w-1);u>l&&a[c+R]>mh;--u,c-=U){for(var J=c,q=c+U,Q=0;Q<U;++Q,++J,++q){var Y=a[J];a[J]=a[q],a[q]=Y}var s=D[u];D[u]=D[u-1],D[u-1]=s}}},14934:h=>{"use strict";h.exports=function(h,l){var j="abcdef".split("").concat(l),a=[];h.indexOf("lo")>=0&&a.push("lo=e[k+n]");h.indexOf("hi")>=0&&a.push("hi=e[k+o]");return j.push(R.replace("_",a.join()).replace("$",h)),Function.apply(void 0,j)};var R="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14906:h=>{"use strict";h.exports=function(h,j){j<=4*R?l(0,j-1,h):mh(0,j-1,h)};var R=32;function l(h,R,l){for(var j=2*(h+1),a=h+1;a<=R;++a){for(var D=l[j++],U=l[j++],F=a,w=j-2;F-- >h;){var mh=l[w-2],u=l[w-1];if(mh<D)break;if(mh===D&&u<U)break;l[w]=mh,l[w+1]=u,w-=2}l[w]=D,l[w+1]=U}}function j(h,R,l){R*=2;var j=l[h*=2],a=l[h+1];l[h]=l[R],l[h+1]=l[R+1],l[R]=j,l[R+1]=a}function a(h,R,l){R*=2,l[h*=2]=l[R],l[h+1]=l[R+1]}function D(h,R,l,j){R*=2,l*=2;var a=j[h*=2],D=j[h+1];j[h]=j[R],j[h+1]=j[R+1],j[R]=j[l],j[R+1]=j[l+1],j[l]=a,j[l+1]=D}function U(h,R,l,j,a){R*=2,a[h*=2]=a[R],a[R]=l,a[h+1]=a[R+1],a[R+1]=j}function F(h,R,l){R*=2;var j=l[h*=2],a=l[R];return!(j<a)&&(j!==a||l[h+1]>l[R+1])}function w(h,R,l,j){var a=j[h*=2];return a<R||a===R&&j[h+1]<l}function mh(h,u,c){var J=(u-h+1)/6|0,q=h+J,Q=u-J,Y=h+u>>1,s=Y-J,t=Y+J,f=q,T=s,E=Y,x=t,G=Q,p=h+1,O=u-1,y=0;F(f,T,c)&&(y=f,f=T,T=y),F(x,G,c)&&(y=x,x=G,G=y),F(f,E,c)&&(y=f,f=E,E=y),F(T,E,c)&&(y=T,T=E,E=y),F(f,x,c)&&(y=f,f=x,x=y),F(E,x,c)&&(y=E,E=x,x=y),F(T,G,c)&&(y=T,T=G,G=y),F(T,E,c)&&(y=T,T=E,E=y),F(x,G,c)&&(y=x,x=G,G=y);for(var v=c[2*T],b=c[2*T+1],I=c[2*x],L=c[2*x+1],n=2*f,r=2*E,P=2*G,z=2*q,o=2*Y,K=2*Q,W=0;W<2;++W){var g=c[n+W],H=c[r+W],k=c[P+W];c[z+W]=g,c[o+W]=H,c[K+W]=k}a(s,h,c),a(t,u,c);for(var C=p;C<=O;++C)if(w(C,v,b,c))C!==p&&j(C,p,c),++p;else if(!w(C,I,L,c))for(;;){if(w(O,I,L,c)){w(O,v,b,c)?(D(C,p,O,c),++p,--O):(j(C,O,c),--O);break}if(--O<C)break}U(h,p-1,v,b,c),U(u,O+1,I,L,c),p-2-h<=R?l(h,p-2,c):mh(h,p-2,c),u-(O+2)<=R?l(O+2,u,c):mh(O+2,u,c),O-p<=R?l(p,O,c):mh(p,O,c)}},14900:(h,R,l)=>{"use strict";h.exports={init:function(h){var R=a.nextPow2(h);w.length<R&&(j.free(w),w=j.mallocInt32(R));mh.length<R&&(j.free(mh),mh=j.mallocInt32(R));u.length<R&&(j.free(u),u=j.mallocInt32(R));c.length<R&&(j.free(c),c=j.mallocInt32(R));J.length<R&&(j.free(J),J=j.mallocInt32(R));q.length<R&&(j.free(q),q=j.mallocInt32(R));var l=8*R;Q.length<l&&(j.free(Q),Q=j.mallocDouble(l))},sweepBipartite:function(h,R,l,j,a,F,J,q,t,f){for(var T=0,E=2*h,x=h-1,G=E-1,p=l;p<j;++p){var O=F[p],y=E*p;Q[T++]=a[y+x],Q[T++]=-(O+1),Q[T++]=a[y+G],Q[T++]=O}for(p=J;p<q;++p){O=f[p]+U;var v=E*p;Q[T++]=t[v+x],Q[T++]=-O,Q[T++]=t[v+G],Q[T++]=O}var b=T>>>1;D(Q,b);var I=0,L=0;for(p=0;p<b;++p){var n=0|Q[2*p+1];if(n>=U)Y(u,c,L--,n=n-U|0);else if(n>=0)Y(w,mh,I--,n);else if(n<=-U){n=-n-U|0;for(var r=0;r<I;++r){if(void 0!==(P=R(w[r],n)))return P}s(u,c,L++,n)}else{n=-n-1|0;for(r=0;r<L;++r){var P;if(void 0!==(P=R(n,u[r])))return P}s(w,mh,I++,n)}}},sweepComplete:function(h,R,l,j,a,U,F,t,f,T){for(var E=0,x=2*h,G=h-1,p=x-1,O=l;O<j;++O){var y=U[O]+1<<1,v=x*O;Q[E++]=a[v+G],Q[E++]=-y,Q[E++]=a[v+p],Q[E++]=y}for(O=F;O<t;++O){y=T[O]+1<<1;var b=x*O;Q[E++]=f[b+G],Q[E++]=1|-y,Q[E++]=f[b+p],Q[E++]=1|y}var I=E>>>1;D(Q,I);var L=0,n=0,r=0;for(O=0;O<I;++O){var P=0|Q[2*O+1],z=1&P;if(O<I-1&&P>>1===Q[2*O+3]>>1&&(z=2,O+=1),P<0){for(var o=-(P>>1)-1,K=0;K<r;++K){if(void 0!==(W=R(J[K],o)))return W}if(0!==z)for(K=0;K<L;++K){if(void 0!==(W=R(w[K],o)))return W}if(1!==z)for(K=0;K<n;++K){var W;if(void 0!==(W=R(u[K],o)))return W}0===z?s(w,mh,L++,o):1===z?s(u,c,n++,o):2===z&&s(J,q,r++,o)}else{o=(P>>1)-1;0===z?Y(w,mh,L--,o):1===z?Y(u,c,n--,o):2===z&&Y(J,q,r--,o)}}},scanBipartite:function(h,R,l,j,a,F,u,c,J,q,t,f){var T=0,E=2*h,x=R,G=R+h,p=1,O=1;j?O=U:p=U;for(var y=a;y<F;++y){var v=y+p,b=E*y;Q[T++]=u[b+x],Q[T++]=-v,Q[T++]=u[b+G],Q[T++]=v}for(y=J;y<q;++y){v=y+O;var I=E*y;Q[T++]=t[I+x],Q[T++]=-v}var L=T>>>1;D(Q,L);var n=0;for(y=0;y<L;++y){var r=0|Q[2*y+1];if(r<0){var P=!1;if((v=-r)>=U?(P=!j,v-=U):(P=!!j,v-=1),P)s(w,mh,n++,v);else{var z=f[v],o=E*v,K=t[o+R+1],W=t[o+R+1+h];h:for(var g=0;g<n;++g){var H=w[g],k=E*H;if(!(W<u[k+R+1]||u[k+R+1+h]<K)){for(var C=R+2;C<h;++C)if(t[o+C+h]<u[k+C]||u[k+C+h]<t[o+C])continue h;var A,e=c[H];if(void 0!==(A=j?l(z,e):l(e,z)))return A}}}}else Y(w,mh,n--,r-p)}},scanComplete:function(h,R,l,j,a,F,mh,u,c,J,q){for(var Y=0,s=2*h,t=R,f=R+h,T=j;T<a;++T){var E=T+U,x=s*T;Q[Y++]=F[x+t],Q[Y++]=-E,Q[Y++]=F[x+f],Q[Y++]=E}for(T=u;T<c;++T){E=T+1;var G=s*T;Q[Y++]=J[G+t],Q[Y++]=-E}var p=Y>>>1;D(Q,p);var O=0;for(T=0;T<p;++T){var y=0|Q[2*T+1];if(y<0){if((E=-y)>=U)w[O++]=E-U;else{var v=q[E-=1],b=s*E,I=J[b+R+1],L=J[b+R+1+h];h:for(var n=0;n<O;++n){var r=w[n],P=mh[r];if(P===v)break;var z=s*r;if(!(L<F[z+R+1]||F[z+R+1+h]<I)){for(var o=R+2;o<h;++o)if(J[b+o+h]<F[z+o]||F[z+o+h]<J[b+o])continue h;var K=l(P,v);if(void 0!==K)return K}}}}else{for(E=y-U,n=O-1;n>=0;--n)if(w[n]===E){for(o=n+1;o<O;++o)w[o-1]=w[o];break}--O}}}};var j=l(14884),a=l(14886),D=l(14906),U=1<<28,F=1024,w=j.mallocInt32(F),mh=j.mallocInt32(F),u=j.mallocInt32(F),c=j.mallocInt32(F),J=j.mallocInt32(F),q=j.mallocInt32(F),Q=j.mallocDouble(8192);function Y(h,R,l,j){var a=R[j],D=h[l-1];h[a]=D,R[D]=a}function s(h,R,l,j){h[l]=j,R[j]=l}},14894:h=>{"use strict";function R(h,l,j){var a=0|h[j];if(a<=0)return[];var D,U=new Array(a);if(j===h.length-1)for(D=0;D<a;++D)U[D]=l;else for(D=0;D<a;++D)U[D]=R(h,l,j+1);return U}h.exports=function(h,l){switch("undefined"===typeof l&&(l=0),typeof h){case"number":if(h>0)return function(h,R){var l,j;for(l=new Array(h),j=0;j<h;++j)l[j]=R;return l}(0|h,l);break;case"object":if("number"===typeof h.length)return R(h,l,0)}return[]}},14847:(h,R,l)=>{h.exports=function(){var h=this;this.components={},this.comps=this.components;var R=this.components,l=1,a={},D=[],U=[],F={timeout:!1,removals:[],multiComps:[]};function w(h,l){var j=R[l],D=a[l],U=D.hash[h];U&&(D.remove(h),j.CD&&(j.multi?(U.forEach((R=>{R&&j.CD(h,R)})),U.length=0):j.CD(h,U)),F.removals.push(D),mh())}function mh(){F.timeout||(F.timeout=!0,setTimeout(u,1))}function u(){F.timeout=!1,c()}function c(){F.multiComps.length&&function(h){for(var R=0;R<h.length;R++){var{entID:l,data:j}=h[R],a=j.hash[l];if(a){for(var D=0;D<a.length;D++)a[D]||(a.splice(D,1),D--);0===a.length&&(j.remove(l),F.removals.push(j))}}h.length=0}(F.multiComps),F.removals.length&&function(h){for(var R=0;R<h.length;R++){h[R].flush()}h.length=0}(F.removals)}this.UJ=a,this._systems=D,this._renderSystems=U,this.Vw=function(R){var j=l++;return Array.isArray(R)&&R.forEach((R=>h.Aw(j,R))),j},this.deleteEntity=function(R){return Object.keys(a).forEach((h=>{a[h].hash[R]&&w(R,h)})),h},this.pu=function(h){if(!h)throw new Error("Missing component definition");var l=h.name;if(!l)throw new Error("Component definition must have a name property.");if("string"!==typeof l)throw new Error("Component name must be a string.");if(""===l)throw new Error("Component name must be a non-empty string.");if(a[l])throw new Error(`Component ${l} already exists.`);var F={};return F.name=l,F.multi=!!h.multi,F.order=isNaN(h.order)?99:h.order,F.stateConstructor=h.stateConstructor||null,F.state=h.state||{},F.gF=h.gF||null,F.CD=h.CD||null,F.system=h.system||null,F.SF=h.SF||null,R[l]=F,a[l]=new j,a[l]._pendingMultiCleanup=!1,a[l]._multiCleanupIDs=F.multi?[]:null,F.system&&(D.push(l),D.sort(((h,l)=>R[h].order-R[l].order))),F.SF&&(U.push(l),U.sort(((h,l)=>R[h].order-R[l].order))),l},this.overwriteComponent=function(h,l){var j=R[h];if(!j)throw new Error(`Unknown component: ${h}`);if(!l)throw new Error("Missing component definition");if(j.name!==l.name)throw new Error("Overwriting component must use the same name property.");var F={};F.name=h,F.multi=!!l.multi,F.order=isNaN(l.order)?99:l.order,F.state=l.state||{},F.gF=l.gF||null,F.CD=l.CD||null,F.system=l.system||null,F.SF=l.SF||null,R[h]=F,a[h]._pendingMultiCleanup=!1,a[h]._multiCleanupIDs=F.multi?[]:null;var w=D.indexOf(h);F.system&&w<0&&D.push(h),!F.system&&w>=0&&D.splice(w,1),D.sort(((h,l)=>R[h].order-R[l].order));var mh=U.indexOf(h);F.SF&&mh<0&&U.push(h),!F.SF&&mh>=0&&U.splice(mh,1),U.sort(((h,l)=>R[h].order-R[l].order));var u=F.state;return this.Am(h).forEach((h=>{for(var R in u)R in h||(h[R]=u[R]);F.gF&&F.gF(h.AF,h)})),h},this.deleteComponent=function(l){var j=a[l];if(!j)throw new Error(`Unknown component: ${l}`);j.flush(),j.list.forEach((h=>{h&&w(h.AF||h[0].AF,l)}));var F=D.indexOf(l),mh=U.indexOf(l);return F>-1&&D.splice(F,1),mh>-1&&U.splice(mh,1),a[l].dispose(),delete a[l],delete R[l],h},this.Aw=function(h,l,j){var D,U=R[l],F=a[l];if(!F)throw new Error(`Unknown component: ${l}.`);if(F.hash[h]&&!U.multi)throw new Error(`Entity ${h} already has component: ${l}.`);if(U.stateConstructor){if(!(D=new U.stateConstructor).hasOwnProperty("AF"))throw new Error(`Component ${U.name} stateConstructor type does not have property __id`)}else D=Object.assign({},{AF:h},U.state,j);if(D.AF=h,U.multi){var w=F.hash[h];w||(w=[],F.add(h,w)),w.push(D)}else F.add(h,D);return U.gF&&U.gF(h,D),this},this.hm=function(h,R){var l=a[R];if(!l)throw new Error(`Unknown component: ${R}.`);return!!l.hash[h]},this.Mw=function(R,l){if(!a[l])throw new Error(`Unknown component: ${l}.`);return w(R,l),h},this.getState=function(h,R){var l=a[R];if(!l)throw new Error(`Unknown component: ${R}.`);return l.hash[h]},this.Am=function(h){var R=a[h];if(!R)throw new Error(`Unknown component: ${h}.`);return c(),R.list},this.dq=function(h){if(!a[h])throw new Error(`Unknown component: ${h}.`);var R=a[h].hash;return h=>R[h]},this.Bq=function(h){if(!a[h])throw new Error(`Unknown component: ${h}.`);var R=a[h].hash;return h=>!!R[h]},this.RF=function(l){c();for(var j=0;j<D.length;j++){var U=D[j],F=R[U],w=a[U];F.system(l,w.list),c()}return h},this.render=function(l){c();for(var j=0;j<U.length;j++){var D=U[j],F=R[D],w=a[D];F.SF(l,w.list),c()}return h},this.removeMultiComponent=function(l,j,D){var U=R[j],w=a[j];if(!w)throw new Error(`Unknown component: ${j}.`);if(!U.multi)throw new Error("removeMultiComponent called on non-multi component");return function(h,R,l,j){var a=l.hash[h];if(a){var D=a[j];D&&(a[j]=null,R.CD&&R.CD(h,D),F.multiComps.push({entID:h,data:l}),mh())}}(l,U,w,D),h}};var j=l(14854)},14854:h=>{function R(h,R){var l=h._map[R];if(delete h.hash[R],delete h._map[R],l===h.list.length-1)h.list.pop();else{var j=h.list.pop();if(h.list[l]=j,null===j||null===j[0]){var a=h.list.length;for(var D in h._map)if(h._map[D]===a)return void(h._map[D]=l)}else{var U=j.AF||j[0].AF;h._map[U]=l}}}h.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(h,R){if("number"===typeof this._map[h]){var l=this._map[h];this.hash[h]=R,this.list[l]=R}else this._map[h]=this.list.length,this.hash[h]=R,this.list.push(R)}remove(h){var R=this._map[h];this.hash[h]=null,this.list[R]=null,this._pendingRemovals.push(h)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var h=0;h<this._pendingRemovals.length;h++){var l=this._pendingRemovals[h];null===this.hash[l]&&R(this,l)}this._pendingRemovals.length=0}}},14806:h=>{"use strict";var R,l="object"===typeof Reflect?Reflect:null,j=function(h,R,l){return Function.prototype.apply.call(h,R,l)};R=l&&"function"===typeof l.ownKeys?l.ownKeys:Object.getOwnPropertySymbols?function(h){return Object.getOwnPropertyNames(h).concat(Object.getOwnPropertySymbols(h))}:function(h){return Object.getOwnPropertyNames(h)};var a=Number.isNaN||function(h){return h!==h};function D(){D.init.call(this)}h.exports=D,h.exports.once=function(h,R){return new Promise((function(l,j){function a(l){h.removeListener(R,D),j(l)}function D(){"function"===typeof h.removeListener&&h.removeListener("error",a),l([].slice.call(arguments))}Y(h,R,D,{once:!0}),"error"!==R&&function(h,R,l){"function"===typeof h.on&&Y(h,"error",R,l)}(h,a,{once:!0})}))},D.EventEmitter=D,D.prototype._events=void 0,D.prototype._eventsCount=0,D.prototype._maxListeners=void 0;var U=10;function F(h){if("function"!==typeof h)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof h)}function w(h){return void 0===h._maxListeners?D.defaultMaxListeners:h._maxListeners}function mh(h,R,l,j){var a,D,U,mh;if(F(l),void 0===(D=h._events)?(D=h._events=Object.create(null),h._eventsCount=0):(void 0!==D.newListener&&(h.emit("newListener",R,l.listener?l.listener:l),D=h._events),U=D[R]),void 0===U)U=D[R]=l,++h._eventsCount;else if("function"===typeof U?U=D[R]=j?[l,U]:[U,l]:j?U.unshift(l):U.push(l),(a=w(h))>0&&U.length>a&&!U.warned){U.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.UR=h,u.type=R,u.count=U.length,mh=u,console&&console.warn&&console.warn(mh)}return h}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(h,R,l){var j={fired:!1,wrapFn:void 0,target:h,type:R,listener:l},a=u.bind(j);return a.listener=l,j.wrapFn=a,a}function J(h,R,l){var j=h._events;if(void 0===j)return[];var a=j[R];return void 0===a?[]:"function"===typeof a?l?[a.listener||a]:[a]:l?function(h){for(var R=new Array(h.length),l=0;l<R.length;++l)R[l]=h[l].listener||h[l];return R}(a):Q(a,a.length)}function q(h){var R=this._events;if(void 0!==R){var l=R[h];if("function"===typeof l)return 1;if(void 0!==l)return l.length}return 0}function Q(h,R){for(var l=new Array(R),j=0;j<R;++j)l[j]=h[j];return l}function Y(h,R,l,j){if("function"===typeof h.on)j.once?h.once(R,l):h.on(R,l);else{if("function"!==typeof h.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof h);h.addEventListener(R,(function a(D){j.once&&h.removeEventListener(R,a),l(D)}))}}Object.defineProperty(D,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(h){if("number"!==typeof h||h<0||a(h))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+h+".");U=h}}),D.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},D.prototype.setMaxListeners=function(h){if("number"!==typeof h||h<0||a(h))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+h+".");return this._maxListeners=h,this},D.prototype.getMaxListeners=function(){return w(this)},D.prototype.emit=function(h){for(var R=[],l=1;l<arguments.length;l++)R.push(arguments[l]);var a="error"===h,D=this._events;if(void 0!==D)a=a&&void 0===D.error;else if(!a)return!1;if(a){var U;if(R.length>0&&(U=R[0]),U instanceof Error)throw U;var F=new Error("Unhandled error."+(U?" ("+U.message+")":""));throw F.context=U,F}var w=D[h];if(void 0===w)return!1;if("function"===typeof w)j(w,this,R);else{var mh=w.length,u=Q(w,mh);for(l=0;l<mh;++l)j(u[l],this,R)}return!0},D.prototype.addListener=function(h,R){return mh(this,h,R,!1)},D.prototype.on=D.prototype.addListener,D.prototype.prependListener=function(h,R){return mh(this,h,R,!0)},D.prototype.once=function(h,R){return F(R),this.on(h,c(this,h,R)),this},D.prototype.prependOnceListener=function(h,R){return F(R),this.prependListener(h,c(this,h,R)),this},D.prototype.removeListener=function(h,R){var l,j,a,D,U;if(F(R),void 0===(j=this._events))return this;if(void 0===(l=j[h]))return this;if(l===R||l.listener===R)0===--this._eventsCount?this._events=Object.create(null):(delete j[h],j.removeListener&&this.emit("removeListener",h,l.listener||R));else if("function"!==typeof l){for(a=-1,D=l.length-1;D>=0;D--)if(l[D]===R||l[D].listener===R){U=l[D].listener,a=D;break}if(a<0)return this;0===a?l.shift():function(h,R){for(;R+1<h.length;R++)h[R]=h[R+1];h.pop()}(l,a),1===l.length&&(j[h]=l[0]),void 0!==j.removeListener&&this.emit("removeListener",h,U||R)}return this},D.prototype.off=D.prototype.removeListener,D.prototype.FR=function(h){var R,l,j;if(void 0===(l=this._events))return this;if(void 0===l.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==l[h]&&(0===--this._eventsCount?this._events=Object.create(null):delete l[h]),this;if(0===arguments.length){var a,D=Object.keys(l);for(j=0;j<D.length;++j)"removeListener"!==(a=D[j])&&this.FR(a);return this.FR("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(R=l[h]))this.removeListener(h,R);else if(void 0!==R)for(j=R.length-1;j>=0;j--)this.removeListener(h,R[j]);return this},D.prototype.listeners=function(h){return J(this,h,!0)},D.prototype.rawListeners=function(h){return J(this,h,!1)},D.listenerCount=function(h,R){return"function"===typeof h.listenerCount?h.listenerCount(R):q.call(h,R)},D.prototype.listenerCount=q,D.prototype.eventNames=function(){return this._eventsCount>0?R(this._events):[]}},15122:h=>{"use strict";h.exports=function(h,R,l,j,a,D){var U=+R[0],F=+R[1],w=+R[2],mh=+l[0],u=+l[1],c=+l[2],J=Math.sqrt(mh*mh+u*u+c*c);if(0===J)throw new Error("Can't raycast along a zero vector");return function(h,R,l,j,a,D,U,F,w,mh){for(var u=0,c=Math.floor,J=0|c(R),q=0|c(l),Q=0|c(j),Y=a>0?1:-1,s=D>0?1:-1,t=U>0?1:-1,f=Math.abs(1/a),T=Math.abs(1/D),E=Math.abs(1/U),x=f<1/0?f*(Y>0?J+1-R:R-J):1/0,G=T<1/0?T*(s>0?q+1-l:l-q):1/0,p=E<1/0?E*(t>0?Q+1-j:j-Q):1/0,O=-1;u<=F;){var y=h(J,q,Q);if(y)return w&&(w[0]=R+u*a,w[1]=l+u*D,w[2]=j+u*U),mh&&(mh[0]=mh[1]=mh[2]=0,0===O&&(mh[0]=-Y),1===O&&(mh[1]=-s),2===O&&(mh[2]=-t)),y;x<G?x<p?(J+=Y,u=x,x+=f,O=0):(Q+=t,u=p,p+=E,O=2):G<p?(q+=s,u=G,G+=T,O=1):(Q+=t,u=p,p+=E,O=2)}return w&&(w[0]=R+u*a,w[1]=l+u*D,w[2]=j+u*U),mh&&(mh[0]=mh[1]=mh[2]=0),0}(h,U,F,w,mh/=J,u/=J,c/=J,j="undefined"===typeof j?64:+j,a,D)}},15156:(h,R,l)=>{"use strict";l.d(R,{d:()=>D});var j=l(14806);function a(){this.XJ=!1,this.stopPropagation=!1,this.VJ=!1,this.disabled=!1}class D{constructor(h,R){this.version="0.7.0";var l=Object.assign({},new a,R||{});this.element=h||document,this.XJ=!!l.XJ,this.stopPropagation=!!l.stopPropagation,this.VJ=!!l.VJ,this.disabled=!!l.disabled,this.filterEvents=(h,R)=>!0,this.down=new j.EventEmitter,this.up=new j.EventEmitter,this.state={},this.Km={dx:0,dy:0,Hq:0,om:0,kq:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?F(this):document.addEventListener("DOMContentLoaded",(h=>{F(this)}),{once:!0})}bind(h){for(var R=arguments.length,l=new Array(R>1?R-1:0),j=1;j<R;j++)l[j-1]=arguments[j];l.forEach((R=>{var l=this._keyBindmap[R]||[];l.includes(h)||(l.push(h),this._keyBindmap[R]=l)})),this.state[h]=!!this.state[h],this.pressCount[h]=this.pressCount[h]||0,this.releaseCount[h]=this.releaseCount[h]||0}unbind(h){for(var R in this._keyBindmap){var l=this._keyBindmap[R],j=l.indexOf(h);j>-1&&l.splice(j,1)}}getBindings(){var h={};for(var R in this._keyBindmap){this._keyBindmap[R].forEach((l=>{h[l]=h[l]||[],h[l].push(R)}))}return h}RF(){U(this.Km),U(this.pressCount),U(this.releaseCount)}}function U(h){for(var R in h)h[R]=0}function F(h){window.addEventListener("keydown",Q.bind(null,h,!0),!1),window.addEventListener("keyup",Q.bind(null,h,!1),!1);var R={passive:!0};h.element.addEventListener("touchstart",c.bind(void 0,h),{passive:!1}),h.element.addEventListener("touchend",q.bind(void 0,h),R),h.element.addEventListener("mousedown",Y.bind(null,h,!0),R),window.document.addEventListener("mouseup",Y.bind(null,h,!1),R),h.element.addEventListener("touchmove",s.bind(null,h),R),h.element.addEventListener("mousemove",s.bind(null,h),R),window.PointerEvent,h.element.addEventListener("wheel",t.bind(null,h),R),h.element.addEventListener("contextmenu",f.bind(null,h),!1),window.addEventListener("blur",T.bind(null,h),!1)}var w=0,mh=0,u=null;function c(h,R){R.preventDefault(),J(R)}function J(h){let R=!1;for(let l=0;l<h.touches.length;++l)if(h.touches[l].identifier===u){R=!0;break}if(!R){const R=h.changedTouches[0];w=R.clientX,mh=R.clientY,u=R.identifier}}function q(h,R){for(var l=R.changedTouches,j=0;j<l.length;++j)l[j].identifier===u&&(u=null)}function Q(h,R,l){E(l.code,R,h,l)}function Y(h,R,l){if("pointerId"in l)if(R){if(null!==h._touches.currID)return;h._touches.currID=l.pointerId}else{if(h._touches.currID!==l.pointerId)return;h._touches.currID=null}return E("Mouse"+("button"in l?l.button+1:1),R,h,l),!1}function s(h,R){var l=R.movementX||R.mozMovementX||0,j=R.movementY||R.mozMovementY||0;if(R.touches&&0===(l|j)){var a=function(h){J(h);for(let R=0;R<h.changedTouches.length;++R)if(h.changedTouches[R].identifier==u){const l=h.changedTouches[R],j=[l.clientX-w,l.clientY-mh];return w=l.clientX,mh=l.clientY,j}return console.error(`Did not find touch id ${u}`),[0,0]}(R);l=a[0],j=a[1]}h.Km.dx+=l,h.Km.dy+=j}function t(h,R){var l=1;switch(R.deltaMode){case 0:l=1;break;case 1:l=12;break;case 2:l=h.element.clientHeight||window.innerHeight}h.Km.Hq+=(R.deltaX||0)*l,h.Km.om+=(R.deltaY||0)*l,h.Km.kq+=(R.deltaZ||0)*l}function f(h,R){if(!h.VJ)return R.preventDefault(),!1}function T(h){for(var R in h._keyStates)h._keyStates[R]&&(/^Mouse\d/.test(R)||E(R,!1,h,{code:R,note:"umoe6zag43",preventDefault:()=>{},stopPropagation:()=>{}}))}function E(h,R,l,j){var a=l._keyBindmap[h];a&&(x(l._keyStates[h],R)&&(l._keyStates[h]=R,a.forEach((h=>{(!l.filterEvents||l.filterEvents(j,h))&&function(h,R,l,j){var a=R?l.pressCount:l.releaseCount;a[h]=(a[h]||0)+1;var D=l._bindPressCount[h]||0;(D+=R?1:-1)<0&&(D=0);l._bindPressCount[h]=D;var U=l.state[h];if(x(U,D)){l.state[h]=D>0;var F=R?l.down:l.up;l.disabled||F.emit(h,j)}}(h,R,l,j)}))),"button"in j||(l.XJ&&!j.defaultPrevented&&j.preventDefault(),l.stopPropagation&&j.stopPropagation()))}function x(h,R){return h?!R:R}},13785:h=>{h.exports=function(h,R,l){return h[0]=R[0]+l[0],h[1]=R[1]+l[1],h[2]=R[2]+l[2],h}},13734:(h,R,l)=>{h.exports=function(h,R){var l=j(h[0],h[1],h[2]),U=j(R[0],R[1],R[2]);a(l,l),a(U,U);var F=D(l,U);return F>1?0:Math.acos(F)};var j=l(13743),a=l(13748),D=l(13754)},13834:h=>{h.exports=function(h,R){return h[0]=Math.ceil(R[0]),h[1]=Math.ceil(R[1]),h[2]=Math.ceil(R[2]),h}},13726:h=>{h.exports=function(h){var R=new Float32Array(3);return R[0]=h[0],R[1]=h[1],R[2]=h[2],R}},13763:h=>{h.exports=function(h,R){return h[0]=R[0],h[1]=R[1],h[2]=R[2],h}},13721:h=>{h.exports=function(){var h=new Float32Array(3);return h[0]=0,h[1]=0,h[2]=0,h}},13926:h=>{h.exports=function(h,R,l){var j=R[0],a=R[1],D=R[2],U=l[0],F=l[1],w=l[2];return h[0]=a*w-D*F,h[1]=D*U-j*w,h[2]=j*F-a*U,h}},13865:(h,R,l)=>{h.exports=l(13858)},13858:h=>{h.exports=function(h,R){var l=R[0]-h[0],j=R[1]-h[1],a=R[2]-h[2];return Math.sqrt(l*l+j*j+a*a)}},13811:(h,R,l)=>{h.exports=l(13802)},13802:h=>{h.exports=function(h,R,l){return h[0]=R[0]/l[0],h[1]=R[1]/l[1],h[2]=R[2]/l[2],h}},13754:h=>{h.exports=function(h,R){return h[0]*R[0]+h[1]*R[1]+h[2]*R[2]}},13712:h=>{h.exports=1e-6},13774:(h,R,l)=>{h.exports=function(h,R){var l=h[0],a=h[1],D=h[2],U=R[0],F=R[1],w=R[2];return Math.abs(l-U)<=j*Math.max(1,Math.abs(l),Math.abs(U))&&Math.abs(a-F)<=j*Math.max(1,Math.abs(a),Math.abs(F))&&Math.abs(D-w)<=j*Math.max(1,Math.abs(D),Math.abs(w))};var j=l(13712)},13776:h=>{h.exports=function(h,R){return h[0]===R[0]&&h[1]===R[1]&&h[2]===R[2]}},13827:h=>{h.exports=function(h,R){return h[0]=Math.floor(R[0]),h[1]=Math.floor(R[1]),h[2]=Math.floor(R[2]),h}},13985:(h,R,l)=>{h.exports=function(h,R,l,a,D,U){var F,w;R||(R=3);l||(l=0);w=a?Math.min(a*R+l,h.length):h.length;for(F=l;F<w;F+=R)j[0]=h[F],j[1]=h[F+1],j[2]=h[F+2],D(j,j,U),h[F]=j[0],h[F+1]=j[1],h[F+2]=j[2];return h};var j=l(13721)()},13743:h=>{h.exports=function(h,R,l){var j=new Float32Array(3);return j[0]=h,j[1]=R,j[2]=l,j}},13704:(h,R,l)=>{h.exports={EPSILON:l(13712),create:l(13721),clone:l(13726),angle:l(13734),ZU:l(13743),i:l(13763),set:l(13766),equals:l(13774),exactEquals:l(13776),add:l(13785),fR:l(13787),sub:l(13789),multiply:l(13793),mul:l(13797),divide:l(13802),div:l(13811),min:l(13819),max:l(13824),floor:l(13827),ceil:l(13834),round:l(13842),scale:l(13847),MU:l(13852),distance:l(13858),j:l(13865),squaredDistance:l(13873),sqrDist:l(13882),length:l(13891),len:l(13900),squaredLength:l(13902),iU:l(13907),negate:l(13915),inverse:l(13922),normalize:l(13748),dot:l(13754),cross:l(13926),KU:l(13932),random:l(13937),transformMat4:l(13941),transformMat3:l(13945),transformQuat:l(13954),dU:l(13960),XU:l(13967),VU:l(13976),forEach:l(13985)}},13922:h=>{h.exports=function(h,R){return h[0]=1/R[0],h[1]=1/R[1],h[2]=1/R[2],h}},13900:(h,R,l)=>{h.exports=l(13891)},13891:h=>{h.exports=function(h){var R=h[0],l=h[1],j=h[2];return Math.sqrt(R*R+l*l+j*j)}},13932:h=>{h.exports=function(h,R,l,j){var a=R[0],D=R[1],U=R[2];return h[0]=a+j*(l[0]-a),h[1]=D+j*(l[1]-D),h[2]=U+j*(l[2]-U),h}},13824:h=>{h.exports=function(h,R,l){return h[0]=Math.max(R[0],l[0]),h[1]=Math.max(R[1],l[1]),h[2]=Math.max(R[2],l[2]),h}},13819:h=>{h.exports=function(h,R,l){return h[0]=Math.min(R[0],l[0]),h[1]=Math.min(R[1],l[1]),h[2]=Math.min(R[2],l[2]),h}},13797:(h,R,l)=>{h.exports=l(13793)},13793:h=>{h.exports=function(h,R,l){return h[0]=R[0]*l[0],h[1]=R[1]*l[1],h[2]=R[2]*l[2],h}},13915:h=>{h.exports=function(h,R){return h[0]=-R[0],h[1]=-R[1],h[2]=-R[2],h}},13748:h=>{h.exports=function(h,R){var l=R[0],j=R[1],a=R[2],D=l*l+j*j+a*a;D>0&&(D=1/Math.sqrt(D),h[0]=R[0]*D,h[1]=R[1]*D,h[2]=R[2]*D);return h}},13937:h=>{h.exports=function(h,R){R=R||1;var l=2*Math.random()*Math.PI,j=2*Math.random()-1,a=Math.sqrt(1-j*j)*R;return h[0]=Math.cos(l)*a,h[1]=Math.sin(l)*a,h[2]=j*R,h}},13960:h=>{h.exports=function(h,R,l,j){var a=l[1],D=l[2],U=R[1]-a,F=R[2]-D,w=Math.sin(j),mh=Math.cos(j);return h[0]=R[0],h[1]=a+U*mh-F*w,h[2]=D+U*w+F*mh,h}},13967:h=>{h.exports=function(h,R,l,j){var a=l[0],D=l[2],U=R[0]-a,F=R[2]-D,w=Math.sin(j),mh=Math.cos(j);return h[0]=a+F*w+U*mh,h[1]=R[1],h[2]=D+F*mh-U*w,h}},13976:h=>{h.exports=function(h,R,l,j){var a=l[0],D=l[1],U=R[0]-a,F=R[1]-D,w=Math.sin(j),mh=Math.cos(j);return h[0]=a+U*mh-F*w,h[1]=D+U*w+F*mh,h[2]=R[2],h}},13842:h=>{h.exports=function(h,R){return h[0]=Math.round(R[0]),h[1]=Math.round(R[1]),h[2]=Math.round(R[2]),h}},13847:h=>{h.exports=function(h,R,l){return h[0]=R[0]*l,h[1]=R[1]*l,h[2]=R[2]*l,h}},13852:h=>{h.exports=function(h,R,l,j){return h[0]=R[0]+l[0]*j,h[1]=R[1]+l[1]*j,h[2]=R[2]+l[2]*j,h}},13766:h=>{h.exports=function(h,R,l,j){return h[0]=R,h[1]=l,h[2]=j,h}},13882:(h,R,l)=>{h.exports=l(13873)},13907:(h,R,l)=>{h.exports=l(13902)},13873:h=>{h.exports=function(h,R){var l=R[0]-h[0],j=R[1]-h[1],a=R[2]-h[2];return l*l+j*j+a*a}},13902:h=>{h.exports=function(h){var R=h[0],l=h[1],j=h[2];return R*R+l*l+j*j}},13789:(h,R,l)=>{h.exports=l(13787)},13787:h=>{h.exports=function(h,R,l){return h[0]=R[0]-l[0],h[1]=R[1]-l[1],h[2]=R[2]-l[2],h}},13945:h=>{h.exports=function(h,R,l){var j=R[0],a=R[1],D=R[2];return h[0]=j*l[0]+a*l[3]+D*l[6],h[1]=j*l[1]+a*l[4]+D*l[7],h[2]=j*l[2]+a*l[5]+D*l[8],h}},13941:h=>{h.exports=function(h,R,l){var j=R[0],a=R[1],D=R[2],U=l[3]*j+l[7]*a+l[11]*D+l[15];return U=U||1,h[0]=(l[0]*j+l[4]*a+l[8]*D+l[12])/U,h[1]=(l[1]*j+l[5]*a+l[9]*D+l[13])/U,h[2]=(l[2]*j+l[6]*a+l[10]*D+l[14])/U,h}},13954:h=>{h.exports=function(h,R,l){var j=R[0],a=R[1],D=R[2],U=l[0],F=l[1],w=l[2],mh=l[3],u=mh*j+F*D-w*a,c=mh*a+w*j-U*D,J=mh*D+U*a-F*j,q=-U*j-F*a-w*D;return h[0]=u*mh+q*-U+c*-w-J*-F,h[1]=c*mh+q*-F+J*-U-u*-w,h[2]=J*mh+q*-w+u*-F-c*-U,h}},14832:h=>{"use strict";h.exports=function(h){for(var R=new Array(h),l=0;l<h;++l)R[l]=l;return R}},14896:h=>{h.exports=function(h){return null!=h&&null!=h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}},15129:(h,R,l)=>{"use strict";l.d(R,{d:()=>j});class j{constructor(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Su=!1,this.Zu=!1,this.Au=30,this.eu=0,this.hc=!1,this.fullscreen=!1,this.iu=function(h){},this.du=function(){},this.Bu=function(){},this.lF=function(){},this.Xu=function(h){},this.onFullscreenChanged=function(h){},mh((()=>{!function(h,R){h._nowObject=performance||Date,h._lastTick=0,h._renderAccum=0,h._rt=0,h._frameCB=F.bind(null,h),requestAnimationFrame(h._frameCB),R>0&&(h._intervalCB=U.bind(null,h),h._interval=setInterval(h._intervalCB,Math.max(R,1e3/h.Au/2)))}(this,R),function(h,R){if(!R)return;var l=!1,j=!1;document.addEventListener("pointerlockchange",(j=>{l=document.pointerLockElement===R,h.Xu(l)})),document.addEventListener("fullscreenchange",(l=>{j=document.fullscreenElement===R,h.onFullscreenChanged(j)})),Object.defineProperty(h,"hc",{get:()=>l,set:h=>{h&&!l?w(R):l&&!h&&function(h){h.exitPointerLock&&h.exitPointerLock()}(document)}}),Object.defineProperty(h,"fullscreen",{get:()=>j,set:h=>{h&&!j?R.requestFullscreen():j&&!h&&document.exitFullscreen()}}),R.addEventListener("click",(a=>{h.Su&&!l&&w(R),h.Zu&&!j&&R.requestFullscreen()}));var a=()=>h.lF();if(window.ResizeObserver){new ResizeObserver(a).observe(R)}else window.addEventListener("resize",a)}(this,h),this.Bu()}))}}var a=3,D=20;function U(h){for(var R=1e3/h.Au,l=h._nowObject.now()+D,j=0;h._nowObject.now()>=h._lastTick+R&&h._nowObject.now()<l&&++j<=a;)h.iu(R),h._lastTick+=R;var U=5*(R+5),F=h._nowObject.now();if(F-h._lastTick>U)for(;F>=h._lastTick+R;)h._lastTick+=R}function F(h){requestAnimationFrame(h._frameCB),U(h);var R=h._nowObject.now(),l=R-h._rt;if(h._rt=R,h.eu>0){h._renderAccum+=l;var j=1e3/h.eu;if(h._renderAccum<j)return;h._renderAccum=Math.min(h._renderAccum-j,j)}var a=1e3/h.Au,D=(R-h._lastTick)/a;h.du(l,D,a)}function w(h){h.requestPointerLock&&h.requestPointerLock()}var mh=h=>{if("loading"===document.readyState){var R=()=>{document.removeEventListener("readystatechange",R),h()};document.addEventListener("readystatechange",R)}else setTimeout(h,1)}},14823:(h,R,l)=>{var j=l(14832),a=l(14837),D="undefined"!==typeof Float64Array;function U(h,R){return h[0]-R[0]}function F(){var h,R=this.stride,l=new Array(R.length);for(h=0;h<l.length;++h)l[h]=[Math.abs(R[h]),h];l.sort(U);var j=new Array(l.length);for(h=0;h<j.length;++h)j[h]=l[h][1];return j}function w(h,R){var l=["View",R,"d",h].join("");R<0&&(l="View_Nil"+h);var a="generic"===h;if(-1===R){var D="function "+l+"(a){this.data=a;};var proto="+l+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+l+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+l+"(a){return new "+l+"(a);}";return new Function(D)()}if(0===R){D="function "+l+"(a,d) {this.data = a;this.offset = d};var proto="+l+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+l+"_copy() {return new "+l+"(this.data,this.offset)};proto.pick=function "+l+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+l+"_get(){return "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+l+"_set(v){return "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+l+"(a,b,c,d){return new "+l+"(a,d)}";return new Function("TrivialArray",D)(mh[h][0])}D=["'use strict'"];var U=j(R),w=U.map((function(h){return"i"+h})),u="this.offset+"+U.map((function(h){return"this.stride["+h+"]*i"+h})).join("+"),c=U.map((function(h){return"b"+h})).join(","),J=U.map((function(h){return"c"+h})).join(",");D.push("function "+l+"(a,"+c+","+J+",d){this.data=a","this.shape=["+c+"]","this.stride=["+J+"]","this.offset=d|0}","var proto="+l+".prototype","proto.dtype='"+h+"'","proto.dimension="+R),D.push("Object.defineProperty(proto,'size',{get:function "+l+"_size(){return "+U.map((function(h){return"this.shape["+h+"]"})).join("*"),"}})"),1===R?D.push("proto.order=[0]"):(D.push("Object.defineProperty(proto,'order',{get:"),R<4?(D.push("function "+l+"_order(){"),2===R?D.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===R&&D.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):D.push("ORDER})")),D.push("proto.set=function "+l+"_set("+w.join(",")+",v){"),a?D.push("return this.data.set("+u+",v)}"):D.push("return this.data["+u+"]=v}"),D.push("proto.get=function "+l+"_get("+w.join(",")+"){"),a?D.push("return this.data.get("+u+")}"):D.push("return this.data["+u+"]}"),D.push("proto.index=function "+l+"_index(",w.join(),"){return "+u+"}"),D.push("proto.hi=function "+l+"_hi("+w.join(",")+"){return new "+l+"(this.data,"+U.map((function(h){return["(typeof i",h,"!=='number'||i",h,"<0)?this.shape[",h,"]:i",h,"|0"].join("")})).join(",")+","+U.map((function(h){return"this.stride["+h+"]"})).join(",")+",this.offset)}");var q=U.map((function(h){return"a"+h+"=this.shape["+h+"]"})),Q=U.map((function(h){return"c"+h+"=this.stride["+h+"]"}));D.push("proto.lo=function "+l+"_lo("+w.join(",")+"){var b=this.offset,d=0,"+q.join(",")+","+Q.join(","));for(var Y=0;Y<R;++Y)D.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){d=i"+Y+"|0;b+=c"+Y+"*d;a"+Y+"-=d}");D.push("return new "+l+"(this.data,"+U.map((function(h){return"a"+h})).join(",")+","+U.map((function(h){return"c"+h})).join(",")+",b)}"),D.push("proto.step=function "+l+"_step("+w.join(",")+"){var "+U.map((function(h){return"a"+h+"=this.shape["+h+"]"})).join(",")+","+U.map((function(h){return"b"+h+"=this.stride["+h+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Y=0;Y<R;++Y)D.push("if(typeof i"+Y+"==='number'){d=i"+Y+"|0;if(d<0){c+=b"+Y+"*(a"+Y+"-1);a"+Y+"=ceil(-a"+Y+"/d)}else{a"+Y+"=ceil(a"+Y+"/d)}b"+Y+"*=d}");D.push("return new "+l+"(this.data,"+U.map((function(h){return"a"+h})).join(",")+","+U.map((function(h){return"b"+h})).join(",")+",c)}");var s=new Array(R),t=new Array(R);for(Y=0;Y<R;++Y)s[Y]="a[i"+Y+"]",t[Y]="b[i"+Y+"]";D.push("proto.transpose=function "+l+"_transpose("+w+"){"+w.map((function(h,R){return h+"=("+h+"===undefined?"+R+":"+h+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+l+"(this.data,"+s.join(",")+","+t.join(",")+",this.offset)}"),D.push("proto.pick=function "+l+"_pick("+w+"){var a=[],b=[],c=this.offset");for(Y=0;Y<R;++Y)D.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){c=(c+this.stride["+Y+"]*i"+Y+")|0}else{a.push(this.shape["+Y+"]);b.push(this.stride["+Y+"])}");return D.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),D.push("return function construct_"+l+"(data,shape,stride,offset){return new "+l+"(data,"+U.map((function(h){return"shape["+h+"]"})).join(",")+","+U.map((function(h){return"stride["+h+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",D.join("\n"))(mh[h],F)}var mh={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};h.exports=function(h,R,l,j){if(void 0===h)return(0,mh.array[0])([]);"number"===typeof h&&(h=[h]),void 0===R&&(R=[h.length]);var U=R.length;if(void 0===l){l=new Array(U);for(var F=U-1,u=1;F>=0;--F)l[F]=u,u*=R[F]}if(void 0===j){j=0;for(F=0;F<U;++F)l[F]<0&&(j-=(R[F]-1)*l[F])}for(var c=function(h){if(a(h))return"buffer";if(D)switch(Object.prototype.toString.call(h)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(h)?"array":"generic"}(h),J=mh[c];J.length<=U+1;)J.push(w(c,J.length-1));return(0,J[U+1])(h,R,l,j)}},14837:h=>{function R(h){return!!h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}h.exports=function(h){return null!=h&&(R(h)||function(h){return"function"===typeof h.readFloatLE&&"function"===typeof h.slice&&R(h.slice(0,0))}(h)||!!h._isBuffer)}},14988:h=>{"use strict";var R=[],l=[],j=[],a=[],D=[],U=[],F=[],w=[],mh=[],u=[],c=[],J=[];h.exports=function(h,q,Q,Y,s,t){for(var f=F,T=mh,E=u,x=J,G=0;G<3;G++)f[G]=+Q[G],E[G]=+q.max[G],T[G]=+q.base[G];t||(t=1e-10);var p=function(h,F,mh,u,J,q){var Q=R,Y=l,s=j,t=a,f=D,T=U,E=w,x=Math.floor,G=0,p=0,O=0,y=0,v=0;if(b(),0===O)return 0;for(y=n();p<=O;){if(I(y)&&L())return G;y=n()}for(G+=O,v=0;v<3;v++)u[v]+=mh[v],J[v]+=mh[v];return G;function b(){if(p=0,0!==(O=Math.sqrt(mh[0]*mh[0]+mh[1]*mh[1]+mh[2]*mh[2])))for(var h=0;h<3;h++){var R=mh[h]>=0;t[h]=R?1:-1;var l=R?J[h]:u[h];Q[h]=R?u[h]:J[h],Y[h]=r(l,t[h]),s[h]=P(Q[h],t[h]),E[h]=mh[h]/O,f[h]=Math.abs(1/E[h]);var j=R?Y[h]+1-l:l-Y[h];T[h]=f[h]<1/0?f[h]*j:1/0}}function I(R){for(var l=t[0],j=0===R?Y[0]:s[0],a=Y[0]+l,D=t[1],U=1===R?Y[1]:s[1],F=Y[1]+D,w=t[2],mh=2===R?Y[2]:s[2],u=Y[2]+w,c=j;c!=a;c+=l)for(var J=U;J!=F;J+=D)for(var q=mh;q!=u;q+=w)if(h(c,J,q))return!0;return!1}function L(){G+=p;var h=t[y],R=p/O,l=c;for(v=0;v<3;v++){var j=mh[v]*R;u[v]+=j,J[v]+=j,l[v]=mh[v]-j}if(h>0?J[y]=Math.round(J[y]):u[y]=Math.round(u[y]),F(G,y,h,l))return!0;for(v=0;v<3;v++)mh[v]=l[v];return b(),0===O}function n(){var h=T[0]<T[1]?T[0]<T[2]?0:2:T[1]<T[2]?1:2,R=T[h]-p;for(p=T[h],Y[h]+=t[h],T[h]+=f[h],v=0;v<3;v++)Q[v]+=R*E[v],s[v]=P(Q[v],t[v]);return h}function r(h,R){return x(h-R*q)}function P(h,R){return x(h+R*q)}}(h,Y,f,T,E,t);if(!s){for(G=0;G<3;G++)x[G]=Q[G]>0?E[G]-q.max[G]:T[G]-q.base[G];q.translate(x)}return p}},15164:(h,R,l)=>{"use strict";l.d(R,{d:()=>c});var j=l(14979),a=l(13704);class D{constructor(h,R,l,D,U,F,w){this.Cm=new j(h.base,h.Du),this.hj=R,this.friction=l,this.restitution=D,this.IU=U,this.UQ=F,this.LU=!!w,this.au=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.MQ=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.sm=a.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=a.create(),this._impulses=a.create(),this._sleepFrameCount=10}loadFromCopy(h){a.i(this.Cm.base,h.Cm.base),a.i(this.Cm.Du,h.Cm.Du),a.i(this.Cm.max,h.Cm.max),this.Cm.mag=h.Cm.mag,this.hj=h.hj,this.friction=h.friction,this.restitution=h.restitution,this.IU=h.IU,this.UQ=h.UQ,this.LU=h.LU,this.au=h.au,this.fluidDrag=h.fluidDrag,this.MQ=h.MQ,this.preventFallOffEdge=h.preventFallOffEdge,this.rolledBackLastTick=h.rolledBackLastTick,a.i(this.sm,h.sm),a.i(this.resting,h.resting),this.inFluid=h.inFluid,this._ratioInFluid=h._ratioInFluid,a.i(this._forces,h._forces),a.i(this._impulses,h._impulses),this._sleepFrameCount=h._sleepFrameCount}setPosition(h){U(h),a.fR(h,h,this.Cm.base),this.Cm.translate(h),this.Tm()}jF(){return a.clone(this.Cm.base)}applyForce(h){U(h),a.add(this._forces,this._forces,h),this.Tm()}applyImpulse(h){U(h),a.add(this._impulses,this._impulses,h),this.Tm()}Tm(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var U=h=>{};var F=l(14979),w=l(13704),mh=l(14988);function u(){this.au=.1,this.fluidDrag=.4,this.oU=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function c(h,R,l){h=Object.assign(new u,h),this.gravity=h.gravity||[0,-10,0],this.au=h.au||.1,this.oU=h.oU||2,this.fluidDrag=h.fluidDrag||.4,this.minBounceImpulse=h.minBounceImpulse,this.bodies=[],this.Iq=h.Iq,this.testSolid=R,this.testFluid=l}c.prototype.qQ=function(h,R,l,j,a,U){h=h||new F([0,0,0],[1,1,1]),"undefined"==typeof R&&(R=1),"undefined"==typeof l&&(l=1),"undefined"==typeof j&&(j=0),"undefined"==typeof a&&(a=1);var w=new D(h,R,l,j,a,U);return this.bodies.push(w),w},c.prototype.QQ=function(h){var R=this.bodies.indexOf(h);R<0||(this.bodies.splice(R,1),h.Cm=h.UQ=null)};var J=w.create(),q=w.create(),Q=w.create(),Y=w.create(),s=w.create(),t=w.create(),f=w.create(),T=new F([0,0,0],[1,1,1]),E=new D(T,1,1,0,1,(()=>{}),!1);function x(h,R,l){return R=l,R*=1-(1-h.ratioInFluid)**2}c.prototype.RF=function(h){h/=1e3;var R=g(0,w.squaredLength(this.gravity));this.bodies.forEach((l=>function(h,R,l,j){w.i(s,R.resting),h.Iq&&E.loadFromCopy(R);if(R.hj<=0)return w.set(R.sm,0,0,0),w.set(R._forces,0,0,0),void w.set(R._impulses,0,0,0);var a=j||0===R.IU;if(function(h,R,l,j){if(R._sleepFrameCount>0)return!1;if(j)return!0;var a=!1,D=.5*l*l*R.IU;return w.scale(W,h.gravity,D),mh(h.testSolid,R.Cm,W,(function(){return a=!0,!0}),!0),a}(h,R,l,a))return;R._sleepFrameCount--,function(h,R){var l=R.Cm,j=Math.floor(l.base[0]),a=Math.floor(l.base[2]),D=Math.floor(l.base[1]),U=Math.floor(l.max[1]);if(!h.testFluid(j,D,a))return R.inFluid=!1,void(R.ratioInFluid=0);var F=1,mh=D+1;for(;mh<=U&&h.testFluid(j,mh,a);)F++,mh++;var u=(D+F-l.base[1])/l.Du[1];u>1&&(u=1);var c=l.Du[0]*l.Du[1]*l.Du[2]*u,J=p;w.scale(J,h.gravity,-h.oU*c*R.IU),R.applyForce(J),R.inFluid=!0,R.ratioInFluid=u}(h,R),k(R._forces),k(R._impulses),k(R.sm),k(R.resting),w.scale(J,R._forces,1/R.hj),w.MU(J,J,h.gravity,R.IU),w.scale(q,R._impulses,1/R.hj),w.MU(q,q,J,l),w.add(R.sm,R.sm,q),R.friction&&(O(h,0,R,q,l),O(h,1,R,q,l),O(h,2,R,q,l));var D=R.fluidDrag>=0?R.fluidDrag:h.fluidDrag,U=R.au>=0?R.au:h.au,F=U,u=U;R.inFluid&&(F=x(R,F,R.fluidDragHoriz>=0?R.fluidDragHoriz:D),u=x(R,u,R.fluidDragVert>=0?R.fluidDragVert:D));F=Math.max(1-F*l/R.hj,0),u=Math.max(1-u*l/R.hj,0),w.set(G,F,u,F),w.multiply(R.sm,R.sm,G),w.scale(Q,R.sm,l),w.set(R._forces,0,0,0),w.set(R._impulses,0,0,0),R.LU&&H(b,R.Cm);w.i(t,Q),w.set(f,0,0,0),R.preventFallOffEdge&&function(h,R,l,j){if(!R.resting[1]||l[1]>0)return;var a=z;H(a,R.Cm);for(var D=0;D<3;D+=2){w.set(P,0,0,0),P[D]=l[D];var U=!0;(U=(U=(U=(U=U&&!K(h,a.base[0]+P[0]+1e-5,a.base[1],a.base[2]+P[2]+1e-5))&&!K(h,a.max[0]+P[0]-1e-5,a.base[1],a.base[2]+P[2]+1e-5))&&!K(h,a.base[0]+P[0]+1e-5,a.base[1],a.max[2]+P[2]-1e-5))&&!K(h,a.max[0]+P[0]-1e-5,a.base[1],a.max[2]+P[2]-1e-5))?(j[D]=l[D]>0?1:-1,l[D]=0):0===D&&(w.set(o,l[0],0,0),v(h,a,o,j,R.slideOnCollision))}}(h,R,Q,f);v(h,R.Cm,Q,R.resting,R.slideOnCollision),R.LU&&function(h,R,l,j){if(R.resting[1]>=0&&!R.inFluid)return;var a=0!==R.resting[0],D=0!==R.resting[2];if(!a&&!D)return;var U=Math.abs(j[0]/j[2]),F=4;if(!a&&U>F)return;if(!D&&U<1/F)return;w.add(L,l.base,j);var u=h.testSolid;mh(u,l,j,(function(h,R,l,j){if(1!==R)return!0;j[R]=0}));var c=l.base[1],J=R.inFluid?1.951:1.001,q=Math.floor(c+J)-c;w.set(n,0,q,0);var Q=!1;if(mh(u,l,n,(function(h,R,l,j){return Q=!0,!0})),Q)return;w.fR(r,L,l.base),r[1]=0,v(h,l,r,I,!0);var Y=g(l.base[0],L[0]),s=g(l.base[2],L[2]);if(a&&!Y&&(!s||!D))return;if(D&&(!Y||!a)&&!s)return;var t=!0;if(t=t&&!K(h,l.base[0]+1e-5,l.base[1],l.base[2]+1e-5),t=t&&!K(h,l.max[0]-1e-5,l.base[1],l.base[2]+1e-5),t=t&&!K(h,l.base[0]+1e-5,l.base[1],l.max[2]-1e-5),t=t&&!K(h,l.max[0]-1e-5,l.base[1],l.max[2]-1e-5),t)return;H(R.Cm,l),R.resting[0]=I[0],R.resting[2]=I[2],R.MQ&&R.MQ()}(h,R,b,t);for(var c=0;c<3;++c)R.resting[c]=R.resting[c]||f[c],Y[c]=0,R.resting[c]&&(s[c]||(Y[c]=-R.sm[c]),R.sm[c]=0);var T=w.length(Y);T>.001&&(w.scale(Y,Y,R.hj),R.UQ&&R.UQ(Y),R.restitution>0&&T>h.minBounceImpulse&&(w.scale(Y,Y,R.restitution),R.applyImpulse(Y)));var y=w.squaredLength(R.sm);y>1e-5&&R.Tm();h.Iq&&h.Iq(R)?(R.loadFromCopy(E),R.rolledBackLastTick=!0):R.rolledBackLastTick=!1}(this,l,h,R)))};var G=w.create([0,0,0]);var p=w.create();function O(h,R,l,j,a){var D=l.resting[R],U=j[R];if(!l.alwaysApplyHorizFriction||1!==R){if(0===D)return;if(D*U<=0)return}w.i(y,l.sm),y[R]=0;var F=w.length(y);if(!g(F,0)){var mh=Math.abs(l.friction*h.gravity[R]*a),u=F>mh?(F-mh)/F:0;l.sm[(R+1)%3]*=u,l.sm[(R+2)%3]*=u}}var y=w.create();function v(h,R,l,j,a){return w.set(j,0,0,0),mh(h.testSolid,R,l,(function(h,R,l,D){j[R]=l,D[R]=0,a||(D[0]=0,D[1]=0,D[2]=0)}))}var b=new F([],[]),I=w.create(),L=w.create(),n=w.create(),r=w.create();var P=w.create(),z=new F([],[]),o=w.create();function K(h,R,l,j){return h.testSolid(Math.floor(R),Math.floor(l-1),Math.floor(j))}var W=w.create();function g(h,R){return Math.abs(h-R)<1e-5}function H(h,R){for(var l=0;l<3;l++)h.base[l]=R.base[l],h.max[l]=R.max[l],h.Du[l]=R.Du[l]}var k=function(h){}},13566:function(h,R){!function(h){"use strict";var R=function(h,l){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,R){h.__proto__=R}||function(h,R){for(var l in R)Object.prototype.hasOwnProperty.call(R,l)&&(h[l]=R[l])},R(h,l)};function l(h,l){if("function"!==typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function j(){this.constructor=h}R(h,l),h.prototype=null===l?Object.create(l):(j.prototype=l.prototype,new j)}function j(h,R,l,j){var a,D=arguments.length,U=D<3?R:null===j?j=Object.getOwnPropertyDescriptor(R,l):j;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)U=Reflect.decorate(h,R,l,j);else for(var F=h.length-1;F>=0;F--)(a=h[F])&&(U=(D<3?a(U):D>3?a(R,l,U):a(R,l))||U);return D>3&&U&&Object.defineProperty(R,l,U),U}function a(h,R,l){if(l||2===arguments.length)for(var j,a=0,D=R.length;a<D;a++)!j&&a in R||(j||(j=Array.prototype.slice.call(R,0,a)),j[a]=R[a]);return h.concat(j||Array.prototype.slice.call(R))}var D,U=255,F=213;h.OPERATION=void 0,(D=h.OPERATION||(h.OPERATION={}))[D.ADD=128]="ADD",D[D.REPLACE=0]="REPLACE",D[D.DELETE=64]="DELETE",D[D.DELETE_AND_ADD=192]="DELETE_AND_ADD",D[D.TOUCH=1]="TOUCH",D[D.CLEAR=10]="CLEAR";var w=function(){function R(h,R,l){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=h,this.setParent(R,l)}return R.prototype.setParent=function(h,R,l){var j=this;if(this.indexes||(this.indexes=this.ref instanceof rh?this.ref._definition.indexes:{}),this.parent=h,this.parentIndex=l,R)if(this.root=R,this.ref instanceof rh){var a=this.ref._definition;for(var D in a.schema){var U=this.ref[D];if(U&&U.$changes){var F=a.indexes[D];U.$changes.setParent(this.ref,R,F)}}}else"object"===typeof this.ref&&this.ref.forEach((function(h,R){if(h instanceof rh){var l=h.$changes,a=j.ref.$changes.indexes[R];l.setParent(j.ref,j.root,a)}}))},R.prototype.operation=function(h){this.changes.set(--this.currentCustomOperation,h)},R.prototype.change=function(R,l){void 0===l&&(l=h.OPERATION.ADD);var j="number"===typeof R?R:this.indexes[R];this.assertValidIndex(j,R);var a=this.changes.get(j);a&&a.op!==h.OPERATION.DELETE&&a.op!==h.OPERATION.TOUCH||this.changes.set(j,{op:a&&a.op===h.OPERATION.DELETE?h.OPERATION.DELETE_AND_ADD:l,index:j}),this.allChanges.add(j),this.changed=!0,this.touchParents()},R.prototype.touch=function(R){var l="number"===typeof R?R:this.indexes[R];this.assertValidIndex(l,R),this.changes.has(l)||this.changes.set(l,{op:h.OPERATION.TOUCH,index:l}),this.allChanges.add(l),this.touchParents()},R.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},R.prototype.getType=function(h){if(this.ref._definition)return(R=this.ref._definition).schema[R.fieldsByIndex[h]];var R,l=(R=this.parent._definition).schema[R.fieldsByIndex[this.parentIndex]];return Object.values(l)[0]},R.prototype.getChildrenFilter=function(){var h=this.parent._definition.childFilters;return h&&h[this.parentIndex]},R.prototype.getValue=function(h){return this.ref.getByIndex(h)},R.prototype.delete=function(R){var l="number"===typeof R?R:this.indexes[R];if(void 0!==l){var j=this.getValue(l);this.changes.set(l,{op:h.OPERATION.DELETE,index:l}),this.allChanges.delete(l),delete this.caches[l],j&&j.$changes&&(j.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(R," (").concat(l,")"))},R.prototype.discard=function(R,l){var j=this;void 0===R&&(R=!1),void 0===l&&(l=!1),this.ref instanceof rh||this.changes.forEach((function(R){if(R.op===h.OPERATION.DELETE){var l=j.ref.getIndex(R.index);delete j.indexes[l]}})),this.changes.clear(),this.changed=R,l&&this.allChanges.clear(),this.currentCustomOperation=0},R.prototype.discardAll=function(){var h=this;this.changes.forEach((function(R){var l=h.getValue(R.index);l&&l.$changes&&l.$changes.discardAll()})),this.discard()},R.prototype.cache=function(h,R){this.caches[h]=R},R.prototype.clone=function(){return new R(this.ref,this.parent,this.root)},R.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},R.prototype.assertValidIndex=function(h,R){if(void 0===h)throw new Error('ChangeTree: missing index for field "'.concat(R,'"'))},R}();function mh(h,R,l,j){return h[R]||(h[R]=[]),h[R].push(l),null===j||void 0===j||j.forEach((function(h,R){return l(h,R)})),function(){return c(h[R],h[R].indexOf(l))}}function u(R){var l=this,j="string"!==typeof this.$changes.getType();this.$items.forEach((function(a,D){R.push({refId:l.$changes.refId,op:h.OPERATION.DELETE,field:D,value:void 0,previousValue:a}),j&&l.$changes.root.removeRef(a.$changes.refId)}))}function c(h,R){if(-1===R||R>=h.length)return!1;for(var l=h.length-1,j=R;j<l;j++)h[j]=h[j+1];return h.length=l,!0}var J=function(h,R){var l=h.toString(),j=R.toString();return l<j?-1:l>j?1:0};function q(h){return h.$proxy=!0,h=new Proxy(h,{get:function(h,R){return"symbol"===typeof R||isNaN(R)?h[R]:h.at(R)},set:function(h,R,l){if("symbol"===typeof R||isNaN(R))h[R]=l;else{var j=Array.from(h.$items.keys()),a=parseInt(j[R]||R);void 0===l||null===l?h.deleteAt(a):h.setAt(a,l)}return!0},deleteProperty:function(h,R){return"number"===typeof R?h.deleteAt(R):delete h[R],!0}})}var Q=function(){function R(){for(var h=[],R=0;R<arguments.length;R++)h[R]=arguments[R];this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,h)}return R.prototype.gF=function(R,l){return void 0===l&&(l=!0),mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,R,l?this.$items:void 0)},R.prototype.CD=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,R)},R.prototype.onChange=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,R)},R.is=function(h){return Array.isArray(h)||void 0!==h.array},Object.defineProperty(R.prototype,"length",{get:function(){return this.$items.size},set:function(h){0===h?this.clear():this.splice(h,this.length-h)},enumerable:!1,configurable:!0}),R.prototype.push=function(){for(var h,R=this,l=[],j=0;j<arguments.length;j++)l[j]=arguments[j];return l.forEach((function(l){h=R.$refId++,R.setAt(h,l)})),h},R.prototype.pop=function(){var h=Array.from(this.$indexes.values()).pop();if(void 0!==h){this.$changes.delete(h),this.$indexes.delete(h);var R=this.$items.get(h);return this.$items.delete(h),R}},R.prototype.at=function(h){var R=Array.from(this.$items.keys())[h];return this.$items.get(R)},R.prototype.setAt=function(R,l){var j,a;if(void 0!==l&&null!==l){if(this.$items.get(R)!==l){void 0!==l.$changes&&l.$changes.setParent(this,this.$changes.root,R);var D=null!==(a=null===(j=this.$changes.indexes[R])||void 0===j?void 0:j.op)&&void 0!==a?a:h.OPERATION.ADD;this.$changes.indexes[R]=R,this.$indexes.set(R,R),this.$items.set(R,l),this.$changes.change(R,D)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},R.prototype.deleteAt=function(h){var R=Array.from(this.$items.keys())[h];return void 0!==R&&this.$deleteAt(R)},R.prototype.$deleteAt=function(h){return this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h)},R.prototype.clear=function(R){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),R&&u.call(this,R),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},R.prototype.concat=function(){for(var h,l=[],j=0;j<arguments.length;j++)l[j]=arguments[j];return new(R.bind.apply(R,a([void 0],(h=Array.from(this.$items.values())).concat.apply(h,l),!1)))},R.prototype.join=function(h){return Array.from(this.$items.values()).join(h)},R.prototype.reverse=function(){var h=this,R=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(l,j){h.setAt(R[j],l)})),this},R.prototype.shift=function(){var h=Array.from(this.$items.keys()).shift();if(void 0!==h){var R=this.$items.get(h);return this.$deleteAt(h),R}},R.prototype.slice=function(h,l){var j=new R;return j.push.apply(j,Array.from(this.$items.values()).slice(h,l)),j},R.prototype.sort=function(h){var R=this;void 0===h&&(h=J);var l=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(h).forEach((function(h,j){R.setAt(l[j],h)})),this},R.prototype.splice=function(h,R){void 0===R&&(R=this.length-h);for(var l=Array.from(this.$items.keys()),j=[],a=h;a<h+R;a++)j.push(this.$items.get(l[a])),this.$deleteAt(l[a]);return j},R.prototype.unshift=function(){for(var h=this,R=[],l=0;l<arguments.length;l++)R[l]=arguments[l];var j=this.length,a=R.length,D=Array.from(this.$items.values());return R.forEach((function(R,l){h.setAt(l,R)})),D.forEach((function(R,l){h.setAt(a+l,R)})),j+a},R.prototype.indexOf=function(h,R){return Array.from(this.$items.values()).indexOf(h,R)},R.prototype.lastIndexOf=function(h,R){return void 0===R&&(R=this.length-1),Array.from(this.$items.values()).lastIndexOf(h,R)},R.prototype.every=function(h,R){return Array.from(this.$items.values()).every(h,R)},R.prototype.some=function(h,R){return Array.from(this.$items.values()).some(h,R)},R.prototype.forEach=function(h,R){Array.from(this.$items.values()).forEach(h,R)},R.prototype.map=function(h,R){return Array.from(this.$items.values()).map(h,R)},R.prototype.filter=function(h,R){return Array.from(this.$items.values()).filter(h,R)},R.prototype.reduce=function(h,R){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},R.prototype.reduceRight=function(h,R){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},R.prototype.find=function(h,R){return Array.from(this.$items.values()).find(h,R)},R.prototype.findIndex=function(h,R){return Array.from(this.$items.values()).findIndex(h,R)},R.prototype.fill=function(h,R,l){throw new Error("ArraySchema#fill() not implemented")},R.prototype.copyWithin=function(h,R,l){throw new Error("ArraySchema#copyWithin() not implemented")},R.prototype.toString=function(){return this.$items.toString()},R.prototype.toLocaleString=function(){return this.$items.toLocaleString()},R.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(R,Symbol.species,{get:function(){return R},enumerable:!1,configurable:!0}),R.prototype.entries=function(){return this.$items.entries()},R.prototype.keys=function(){return this.$items.keys()},R.prototype.values=function(){return this.$items.values()},R.prototype.includes=function(h,R){return Array.from(this.$items.values()).includes(h,R)},R.prototype.flatMap=function(h,R){throw new Error("ArraySchema#flatMap() is not supported.")},R.prototype.flat=function(h){throw new Error("ArraySchema#flat() is not supported.")},R.prototype.findLast=function(){var h=Array.from(this.$items.values());return h.findLast.apply(h,arguments)},R.prototype.findLastIndex=function(){var h=Array.from(this.$items.values());return h.findLastIndex.apply(h,arguments)},R.prototype.setIndex=function(h,R){this.$indexes.set(h,R)},R.prototype.getIndex=function(h){return this.$indexes.get(h)},R.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},R.prototype.deleteByIndex=function(h){var R=this.$indexes.get(h);this.$items.delete(R),this.$indexes.delete(h)},R.prototype.toArray=function(){return Array.from(this.$items.values())},R.prototype.toJSON=function(){return this.toArray().map((function(h){return"function"===typeof h.toJSON?h.toJSON():h}))},R.prototype.clone=function(h){return h?new(R.bind.apply(R,a([void 0],Array.from(this.$items.values()),!1))):new(R.bind.apply(R,a([void 0],this.map((function(h){return h.$changes?h.clone():h})),!1)))},R}();function Y(h){return h.$proxy=!0,h=new Proxy(h,{get:function(h,R){return"symbol"!==typeof R&&"undefined"===typeof h[R]?h.get(R):h[R]},set:function(h,R,l){return"symbol"!==typeof R&&-1===R.indexOf("$")&&"gF"!==R&&"CD"!==R&&"onChange"!==R?h.set(R,l):h[R]=l,!0},deleteProperty:function(h,R){return h.delete(R),!0}})}var s=function(){function R(h){var l=this;if(this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h)if(h instanceof Map||h instanceof R)h.forEach((function(h,R){return l.set(R,h)}));else for(var j in h)this.set(j,h[j])}return R.prototype.gF=function(R,l){return void 0===l&&(l=!0),mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,R,l?this.$items:void 0)},R.prototype.CD=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,R)},R.prototype.onChange=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,R)},R.is=function(h){return void 0!==h.map},R.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(R.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(R,Symbol.species,{get:function(){return R},enumerable:!1,configurable:!0}),R.prototype.set=function(R,l){if(void 0===l||null===l)throw new Error("MapSchema#set('".concat(R,"', ").concat(l,"): trying to set ").concat(l," value on '").concat(R,"'."));R=R.toString();var j="undefined"!==typeof this.$changes.indexes[R],a=j?this.$changes.indexes[R]:this.$refId++,D=j?h.OPERATION.REPLACE:h.OPERATION.ADD,U=void 0!==l.$changes;if(U&&l.$changes.setParent(this,this.$changes.root,a),j){if(!U&&this.$items.get(R)===l)return;U&&this.$items.get(R)!==l&&(D=h.OPERATION.ADD)}else this.$changes.indexes[R]=a,this.$indexes.set(a,R);return this.$items.set(R,l),this.$changes.change(R,D),this},R.prototype.get=function(h){return this.$items.get(h)},R.prototype.delete=function(h){return this.$changes.delete(h),this.$items.delete(h)},R.prototype.clear=function(R){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),R&&u.call(this,R),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},R.prototype.has=function(h){return this.$items.has(h)},R.prototype.forEach=function(h){this.$items.forEach(h)},R.prototype.entries=function(){return this.$items.entries()},R.prototype.keys=function(){return this.$items.keys()},R.prototype.values=function(){return this.$items.values()},Object.defineProperty(R.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),R.prototype.setIndex=function(h,R){this.$indexes.set(h,R)},R.prototype.getIndex=function(h){return this.$indexes.get(h)},R.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},R.prototype.deleteByIndex=function(h){var R=this.$indexes.get(h);this.$items.delete(R),this.$indexes.delete(h)},R.prototype.toJSON=function(){var h={};return this.forEach((function(R,l){h[l]="function"===typeof R.toJSON?R.toJSON():R})),h},R.prototype.clone=function(h){var l;return h?l=Object.assign(new R,this):(l=new R,this.forEach((function(h,R){h.$changes?l.set(R,h.clone()):l.set(R,h)}))),l},R}(),t={};function f(h,R){t[h]=R}function T(h){return t[h]}var E=function(){function h(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return h.create=function(R){var l=new h;return l.schema=Object.assign({},R&&R.schema||{}),l.indexes=Object.assign({},R&&R.indexes||{}),l.fieldsByIndex=Object.assign({},R&&R.fieldsByIndex||{}),l.descriptors=Object.assign({},R&&R.descriptors||{}),l.deprecated=Object.assign({},R&&R.deprecated||{}),l},h.prototype.addField=function(h,R){var l=this.getNextFieldIndex();this.fieldsByIndex[l]=h,this.indexes[h]=l,this.schema[h]=Array.isArray(R)?{array:R[0]}:R},h.prototype.hasField=function(h){return void 0!==this.indexes[h]},h.prototype.addFilter=function(h,R){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[h]]=R,this.indexesWithFilters.push(this.indexes[h]),!0},h.prototype.addChildrenFilter=function(h,R){var l=this.indexes[h],j=this.schema[h];if(T(Object.keys(j)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[l]=R,!0;console.warn("@filterChildren: field '".concat(h,"' can't have children. Ignoring filter."))},h.prototype.getChildrenFilter=function(h){return this.childFilters&&this.childFilters[this.indexes[h]]},h.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},h}();function x(h){return h._context&&h._context.useFilters}var G=function(){function h(){this.types={},this.schemas=new Map,this.useFilters=!1}return h.prototype.has=function(h){return this.schemas.has(h)},h.prototype.get=function(h){return this.types[h]},h.prototype.add=function(h,R){void 0===R&&(R=this.schemas.size),h._definition=E.create(h._definition),h._typeid=R,this.types[R]=h,this.schemas.set(h,R)},h.create=function(R){return void 0===R&&(R={}),function(l){return R.context||(R.context=new h),O(l,R)}},h}(),p=new G;function O(h,R){return void 0===R&&(R={}),function(l,j){var D=R.context||p,U=l.constructor;if(U._context=D,!h)throw new Error("".concat(U.name,': @type() reference provided for "').concat(j,"\" is undefined. Make sure you don't have any circular dependencies."));D.has(U)||D.add(U);var F=U._definition;if(F.addField(j,h),F.descriptors[j]){if(F.deprecated[j])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(j,"' definition on '").concat(U.name,"'.\nCheck @type() annotation"))}catch(t){var w=t.stack.split("\n")[4].trim();throw new Error("".concat(t.message," ").concat(w))}}var mh=Q.is(h),u=!mh&&s.is(h);if("string"!==typeof h&&!rh.is(h)){var c=Object.values(h)[0];"string"===typeof c||D.has(c)||D.add(c)}if(R.manual)F.descriptors[j]={enumerable:!0,configurable:!0,writable:!0};else{var J="_".concat(j);F.descriptors[J]={enumerable:!1,configurable:!1,writable:!0},F.descriptors[j]={get:function(){return this[J]},set:function(h){h!==this[J]&&(void 0!==h&&null!==h?(!mh||h instanceof Q||(h=new(Q.bind.apply(Q,a([void 0],h,!1)))),!u||h instanceof s||(h=new s(h)),void 0===h.$proxy&&(u?h=Y(h):mh&&(h=q(h))),this.$changes.change(j),h.$changes&&h.$changes.setParent(this,this.$changes.root,this._definition.indexes[j])):this[J]&&this.$changes.delete(j),this[J]=h)},enumerable:!0,configurable:!0}}}}function y(h){return function(R,l){var j=R.constructor;j._definition.addFilter(l,h)&&(j._context.useFilters=!0)}}function v(h){return function(R,l){var j=R.constructor;j._definition.addChildrenFilter(l,h)&&(j._context.useFilters=!0)}}function b(h){return void 0===h&&(h=!0),function(R,l){var j=R.constructor._definition;j.deprecated[l]=!0,h&&(j.descriptors[l]={get:function(){throw new Error("".concat(l," is deprecated."))},set:function(h){},enumerable:!1,configurable:!0})}}function I(h,R,l){for(var j in void 0===l&&(l={}),l.context||(l.context=h._context||l.context||p),R)O(R[j],l)(h.prototype,j);return h}function L(h){for(var R=0,l=0,j=0,a=h.length;j<a;j++)(R=h.charCodeAt(j))<128?l+=1:R<2048?l+=2:R<55296||R>=57344?l+=3:(j++,l+=4);return l}function n(h,R,l){for(var j=0,a=0,D=l.length;a<D;a++)(j=l.charCodeAt(a))<128?h[R++]=j:j<2048?(h[R++]=192|j>>6,h[R++]=128|63&j):j<55296||j>=57344?(h[R++]=224|j>>12,h[R++]=128|j>>6&63,h[R++]=128|63&j):(a++,j=65536+((1023&j)<<10|1023&l.charCodeAt(a)),h[R++]=240|j>>18,h[R++]=128|j>>12&63,h[R++]=128|j>>6&63,h[R++]=128|63&j)}function r(h,R){h.push(255&R)}function P(h,R){h.push(255&R)}function z(h,R){h.push(255&R),h.push(R>>8&255)}function o(h,R){h.push(255&R),h.push(R>>8&255)}function K(h,R){h.push(255&R),h.push(R>>8&255),h.push(R>>16&255),h.push(R>>24&255)}function W(h,R){var l=R>>24,j=R>>16,a=R>>8,D=R;h.push(255&D),h.push(255&a),h.push(255&j),h.push(255&l)}function g(h,R){var l=Math.floor(R/Math.pow(2,32));W(h,R>>>0),W(h,l)}function H(h,R){var l=R/Math.pow(2,32)|0;W(h,R>>>0),W(h,l)}function k(h,R){Z(h,R)}function C(h,R){M(h,R)}var A=new Int32Array(2),e=new Float32Array(A.buffer),S=new Float64Array(A.buffer);function Z(h,R){e[0]=R,K(h,A[0])}function M(h,R){S[0]=R,K(h,A[0]),K(h,A[1])}function i(h,R){return P(h,R?1:0)}function d(h,R){R||(R="");var l=L(R),j=0;if(l<32)h.push(160|l),j=1;else if(l<256)h.push(217),P(h,l),j=2;else if(l<65536)h.push(218),o(h,l),j=3;else{if(!(l<4294967296))throw new Error("String too long");h.push(219),W(h,l),j=5}return n(h,h.length,R),j+l}function X(h,R){return isNaN(R)?X(h,0):isFinite(R)?R!==(0|R)?(h.push(203),M(h,R),9):R>=0?R<128?(P(h,R),1):R<256?(h.push(204),P(h,R),2):R<65536?(h.push(205),o(h,R),3):R<4294967296?(h.push(206),W(h,R),5):(h.push(207),H(h,R),9):R>=-32?(h.push(224|R+32),1):R>=-128?(h.push(208),r(h,R),2):R>=-32768?(h.push(209),z(h,R),3):R>=-2147483648?(h.push(210),K(h,R),5):(h.push(211),g(h,R),9):X(h,R>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var V=Object.freeze({__proto__:null,utf8Write:n,int8:r,uint8:P,int16:z,uint16:o,int32:K,uint32:W,int64:g,uint64:H,float32:k,float64:C,writeFloat32:Z,writeFloat64:M,boolean:i,string:d,number:X});function B(h,R,l){for(var j="",a=0,D=R,U=R+l;D<U;D++){var F=h[D];0!==(128&F)?192!==(224&F)?224!==(240&F)?240!==(248&F)?console.error("Invalid byte "+F.toString(16)):(a=(7&F)<<18|(63&h[++D])<<12|(63&h[++D])<<6|63&h[++D])>=65536?(a-=65536,j+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):j+=String.fromCharCode(a):j+=String.fromCharCode((15&F)<<12|(63&h[++D])<<6|63&h[++D]):j+=String.fromCharCode((31&F)<<6|63&h[++D]):j+=String.fromCharCode(F)}return j}function N(h,R){return hh(h,R)<<24>>24}function hh(h,R){return h[R.offset++]}function Rh(h,R){return lh(h,R)<<16>>16}function lh(h,R){return h[R.offset++]|h[R.offset++]<<8}function jh(h,R){return h[R.offset++]|h[R.offset++]<<8|h[R.offset++]<<16|h[R.offset++]<<24}function ah(h,R){return jh(h,R)>>>0}function Dh(h,R){return Jh(h,R)}function Uh(h,R){return qh(h,R)}function Fh(h,R){var l=ah(h,R);return jh(h,R)*Math.pow(2,32)+l}function wh(h,R){var l=ah(h,R);return ah(h,R)*Math.pow(2,32)+l}var mR=new Int32Array(2),uh=new Float32Array(mR.buffer),ch=new Float64Array(mR.buffer);function Jh(h,R){return mR[0]=jh(h,R),uh[0]}function qh(h,R){return mR[0]=jh(h,R),mR[1]=jh(h,R),ch[0]}function Qh(h,R){return hh(h,R)>0}function Yh(h,R){var l,j=h[R.offset++];j<192?l=31&j:217===j?l=hh(h,R):218===j?l=lh(h,R):219===j&&(l=ah(h,R));var a=B(h,R.offset,l);return R.offset+=l,a}function sh(h,R){var l=h[R.offset];return l<192&&l>160||217===l||218===l||219===l}function th(h,R){var l=h[R.offset++];return l<128?l:202===l?Jh(h,R):203===l?qh(h,R):204===l?hh(h,R):205===l?lh(h,R):206===l?ah(h,R):207===l?wh(h,R):208===l?N(h,R):209===l?Rh(h,R):210===l?jh(h,R):211===l?Fh(h,R):l>223?-1*(255-l+1):void 0}function fh(h,R){var l=h[R.offset];return l<128||l>=202&&l<=211}function Th(h,R){return h[R.offset]<160}function Eh(h,R){return h[R.offset-1]===U&&(h[R.offset]<128||h[R.offset]>=202&&h[R.offset]<=211)}var xh=Object.freeze({__proto__:null,int8:N,uint8:hh,int16:Rh,uint16:lh,int32:jh,uint32:ah,float32:Dh,float64:Uh,int64:Fh,uint64:wh,readFloat32:Jh,readFloat64:qh,boolean:Qh,string:Yh,stringCheck:sh,number:th,numberCheck:fh,arrayCheck:Th,switchStructureCheck:Eh}),Gh=function(){function R(h){var R=this;this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h&&h.forEach((function(h){return R.add(h)}))}return R.prototype.gF=function(R,l){return void 0===l&&(l=!0),mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,R,l?this.$items:void 0)},R.prototype.CD=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,R)},R.prototype.onChange=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,R)},R.is=function(h){return void 0!==h.collection},R.prototype.add=function(h){var R=this.$refId++;return void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,R),this.$changes.indexes[R]=R,this.$indexes.set(R,R),this.$items.set(R,h),this.$changes.change(R),R},R.prototype.at=function(h){var R=Array.from(this.$items.keys())[h];return this.$items.get(R)},R.prototype.entries=function(){return this.$items.entries()},R.prototype.delete=function(h){for(var R,l,j=this.$items.entries();(l=j.next())&&!l.done;)if(h===l.value[1]){R=l.value[0];break}return void 0!==R&&(this.$changes.delete(R),this.$indexes.delete(R),this.$items.delete(R))},R.prototype.clear=function(R){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),R&&u.call(this,R),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},R.prototype.has=function(h){return Array.from(this.$items.values()).some((function(R){return R===h}))},R.prototype.forEach=function(h){var R=this;this.$items.forEach((function(l,j,a){return h(l,j,R)}))},R.prototype.values=function(){return this.$items.values()},Object.defineProperty(R.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),R.prototype.setIndex=function(h,R){this.$indexes.set(h,R)},R.prototype.getIndex=function(h){return this.$indexes.get(h)},R.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},R.prototype.deleteByIndex=function(h){var R=this.$indexes.get(h);this.$items.delete(R),this.$indexes.delete(h)},R.prototype.toArray=function(){return Array.from(this.$items.values())},R.prototype.toJSON=function(){var h=[];return this.forEach((function(R,l){h.push("function"===typeof R.toJSON?R.toJSON():R)})),h},R.prototype.clone=function(h){var l;return h?l=Object.assign(new R,this):(l=new R,this.forEach((function(h){h.$changes?l.add(h.clone()):l.add(h)}))),l},R}(),ph=function(){function R(h){var R=this;this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h&&h.forEach((function(h){return R.add(h)}))}return R.prototype.gF=function(R,l){return void 0===l&&(l=!0),mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,R,l?this.$items:void 0)},R.prototype.CD=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,R)},R.prototype.onChange=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,R)},R.is=function(h){return void 0!==h.set},R.prototype.add=function(R){var l,j;if(this.has(R))return!1;var a=this.$refId++;void 0!==R.$changes&&R.$changes.setParent(this,this.$changes.root,a);var D=null!==(j=null===(l=this.$changes.indexes[a])||void 0===l?void 0:l.op)&&void 0!==j?j:h.OPERATION.ADD;return this.$changes.indexes[a]=a,this.$indexes.set(a,a),this.$items.set(a,R),this.$changes.change(a,D),a},R.prototype.entries=function(){return this.$items.entries()},R.prototype.delete=function(h){for(var R,l,j=this.$items.entries();(l=j.next())&&!l.done;)if(h===l.value[1]){R=l.value[0];break}return void 0!==R&&(this.$changes.delete(R),this.$indexes.delete(R),this.$items.delete(R))},R.prototype.clear=function(R){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),R&&u.call(this,R),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},R.prototype.has=function(h){for(var R,l=this.$items.values(),j=!1;(R=l.next())&&!R.done;)if(h===R.value){j=!0;break}return j},R.prototype.forEach=function(h){var R=this;this.$items.forEach((function(l,j,a){return h(l,j,R)}))},R.prototype.values=function(){return this.$items.values()},Object.defineProperty(R.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),R.prototype.setIndex=function(h,R){this.$indexes.set(h,R)},R.prototype.getIndex=function(h){return this.$indexes.get(h)},R.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},R.prototype.deleteByIndex=function(h){var R=this.$indexes.get(h);this.$items.delete(R),this.$indexes.delete(h)},R.prototype.toArray=function(){return Array.from(this.$items.values())},R.prototype.toJSON=function(){var h=[];return this.forEach((function(R,l){h.push("function"===typeof R.toJSON?R.toJSON():R)})),h},R.prototype.clone=function(h){var l;return h?l=Object.assign(new R,this):(l=new R,this.forEach((function(h){h.$changes?l.add(h.clone()):l.add(h)}))),l},R}(),Oh=function(){function h(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return h.prototype.addRefId=function(h){this.refIds.has(h)||(this.refIds.add(h),this.containerIndexes.set(h,new Set))},h.get=function(R){return void 0===R.$filterState&&(R.$filterState=new h),R.$filterState},h}(),yh=function(){function h(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return h.prototype.getNextUniqueId=function(){return this.nextUniqueId++},h.prototype.addRef=function(h,R,l){void 0===l&&(l=!0),this.refs.set(h,R),l&&(this.refCounts[h]=(this.refCounts[h]||0)+1)},h.prototype.removeRef=function(h){this.refCounts[h]=this.refCounts[h]-1,this.deletedRefs.add(h)},h.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},h.prototype.garbageCollectDeletedRefs=function(){var h=this;this.deletedRefs.forEach((function(R){if(!(h.refCounts[R]>0)){var l=h.refs.get(R);if(l instanceof rh)for(var j in l._definition.schema)"string"!==typeof l._definition.schema[j]&&l[j]&&l[j].$changes&&h.removeRef(l[j].$changes.refId);else{var a=l.$changes.parent._definition,D=a.schema[a.fieldsByIndex[l.$changes.parentIndex]];"function"===typeof Object.values(D)[0]&&Array.from(l.values()).forEach((function(R){return h.removeRef(R.$changes.refId)}))}h.refs.delete(R),delete h.refCounts[R]}})),this.deletedRefs.clear()},h}(),vh=function(h){function R(){return null!==h&&h.apply(this,arguments)||this}return l(R,h),R}(Error);function bh(h,R,l,j){var a,D=!1;switch(R){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":a="number",isNaN(h)&&console.log('trying to encode "NaN" in '.concat(l.constructor.name,"#").concat(j));break;case"string":a="string",D=!0;break;case"boolean":return}if(typeof h!==a&&(!D||D&&null!==h)){var U="'".concat(JSON.stringify(h),"'").concat(h&&h.constructor&&" (".concat(h.constructor.name,")")||"");throw new vh("a '".concat(a,"' was expected, but ").concat(U," was provided in ").concat(l.constructor.name,"#").concat(j))}}function Ih(h,R,l,j){if(!(h instanceof R))throw new vh("a '".concat(R.name,"' was expected, but '").concat(h.constructor.name,"' was provided in ").concat(l.constructor.name,"#").concat(j))}function Lh(h,R,l,j,a){bh(l,h,j,a);var D=V[h];if(!D)throw new vh("a '".concat(h,"' was expected, but ").concat(l," was provided in ").concat(j.constructor.name,"#").concat(a));D(R,l)}function nh(h,R,l){return xh[h](R,l)}var rh=function(){function R(){for(var h=[],R=0;R<arguments.length;R++)h[R]=arguments[R];Object.defineProperties(this,{$changes:{value:new w(this,void 0,new yh),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var l=this._definition.descriptors;l&&Object.defineProperties(this,l),h[0]&&this.assign(h[0])}return R.onError=function(h){console.error(h)},R.is=function(h){return h._definition&&void 0!==h._definition.schema},R.prototype.onChange=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,R)},R.prototype.CD=function(R){return mh(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,R)},R.prototype.assign=function(h){return Object.assign(this,h),this},Object.defineProperty(R.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),R.prototype.setDirty=function(h,R){this.$changes.change(h,R)},R.prototype.listen=function(h,R,l){var j=this;return void 0===l&&(l=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[h]||(this.$callbacks[h]=[]),this.$callbacks[h].push(R),l&&void 0!==this[h]&&R(this[h],void 0),function(){return c(j.$callbacks[h],j.$callbacks[h].indexOf(R))}},R.prototype.decode=function(l,j,a){var D;void 0===j&&(j={offset:0}),void 0===a&&(a=this);var F=[],w=this.$changes.root,mh=l.length,u=0;for(w.refs.set(u,this);j.offset<mh;){var c=l[j.offset++];if(c!=U){var J=a.$changes,q=void 0!==a._definition,Y=q?c>>6<<6:c;if(Y!==h.OPERATION.CLEAR){var t=q?c%(Y||255):th(l,j),f=q?a._definition.fieldsByIndex[t]:"",E=J.getType(t),x=void 0,G=void 0,p=void 0;if(q?G=a["_".concat(f)]:(G=a.getByIndex(t),(Y&h.OPERATION.ADD)===h.OPERATION.ADD?(p=a instanceof s?Yh(l,j):t,a.setIndex(t,p)):p=a.getIndex(t)),(Y&h.OPERATION.DELETE)===h.OPERATION.DELETE&&(Y!==h.OPERATION.DELETE_AND_ADD&&a.deleteByIndex(t),G&&G.$changes&&w.removeRef(G.$changes.refId),x=null),void 0!==f){if(Y===h.OPERATION.DELETE);else if(R.is(E)){var O=th(l,j);if(x=w.refs.get(O),Y!==h.OPERATION.REPLACE){var y=this.getSchemaType(l,j,E);x||((x=this.createTypeInstance(y)).$changes.refId=O,G&&(x.$callbacks=G.$callbacks,G.$changes.refId&&O!==G.$changes.refId&&w.removeRef(G.$changes.refId))),w.addRef(O,x,x!==G)}}else if("string"===typeof E)x=nh(E,l,j);else{var v=T(Object.keys(E)[0]),b=th(l,j),I=w.refs.has(b)?G||w.refs.get(b):new v.constructor;if((x=I.clone(!0)).$changes.refId=b,G&&(x.$callbacks=G.$callbacks,G.$changes.refId&&b!==G.$changes.refId)){w.removeRef(G.$changes.refId);for(var L=G.entries(),n=void 0;(n=L.next())&&!n.done;){var r=(D=n.value)[0],P=D[1];F.push({refId:b,op:h.OPERATION.DELETE,field:r,value:void 0,previousValue:P})}}w.addRef(b,x,I!==G)}if(null!==x&&void 0!==x)if(x.$changes&&x.$changes.setParent(J.ref,J.root,t),a instanceof R)a[f]=x;else if(a instanceof s)r=p,a.$items.set(r,x),a.$changes.allChanges.add(t);else if(a instanceof Q)a.setAt(t,x);else if(a instanceof Gh){var z=a.add(x);a.setIndex(t,z)}else a instanceof ph&&!1!==(z=a.add(x))&&a.setIndex(t,z);G!==x&&F.push({refId:u,op:Y,field:f,dynamicIndex:p,value:x,previousValue:G})}else{console.warn("@colyseus/schema: definition mismatch");for(var o={offset:j.offset};j.offset<mh&&(!Eh(l,j)||(o.offset=j.offset+1,!w.refs.has(th(l,o))));)j.offset++}}else a.clear(F)}else{u=th(l,j);var K=w.refs.get(u);if(!K)throw new Error('"refId" not found: '.concat(u));a=K}}return this._triggerChanges(F),w.garbageCollectDeletedRefs(),F},R.prototype.encode=function(l,j,a){void 0===l&&(l=!1),void 0===j&&(j=[]),void 0===a&&(a=!1);for(var D=this.$changes,F=new WeakSet,w=[D],mh=1,u=0;u<mh;u++){var c=w[u],J=c.ref,q=J instanceof R;c.ensureRefId(),F.add(c),c!==D&&(c.changed||l)&&(P(j,U),X(j,c.refId));for(var Q=l?Array.from(c.allChanges):Array.from(c.changes.values()),Y=0,t=Q.length;Y<t;Y++){var f=l?{op:h.OPERATION.ADD,index:Q[Y]}:Q[Y],E=f.index,x=q?J._definition.fieldsByIndex&&J._definition.fieldsByIndex[E]:E,G=j.length;if(f.op!==h.OPERATION.TOUCH)if(q)P(j,E|f.op);else{if(P(j,f.op),f.op===h.OPERATION.CLEAR)continue;X(j,E)}if(q||(f.op&h.OPERATION.ADD)!=h.OPERATION.ADD||J instanceof s&&d(j,c.ref.$indexes.get(E)),f.op!==h.OPERATION.DELETE){var p=c.getType(E),O=c.getValue(E);if(O&&O.$changes&&!F.has(O.$changes)&&(w.push(O.$changes),O.$changes.ensureRefId(),mh++),f.op!==h.OPERATION.TOUCH){if(R.is(p))Ih(O,p,J,x),X(j,O.$changes.refId),(f.op&h.OPERATION.ADD)===h.OPERATION.ADD&&this.tryEncodeTypeId(j,p,O.constructor);else if("string"===typeof p)Lh(p,j,O,J,x);else{var y=T(Object.keys(p)[0]);Ih(J["_".concat(x)],y.constructor,J,x),X(j,O.$changes.refId)}a&&c.cache(E,j.slice(G))}}}l||a||c.discard()}return j},R.prototype.encodeAll=function(h){return this.encode(!0,[],h)},R.prototype.applyFilters=function(l,j){var a,D;void 0===j&&(j=!1);for(var F=this,w=new Set,mh=Oh.get(l),u=[this.$changes],c=1,J=[],q=function(q){var Q=u[q];if(w.has(Q.refId))return"continue";var Y=Q.ref,t=Y instanceof R;P(J,U),X(J,Q.refId);var f=mh.refIds.has(Q),T=j||!f;mh.addRefId(Q);var E=mh.containerIndexes.get(Q),x=T?Array.from(Q.allChanges):Array.from(Q.changes.values());!j&&t&&Y._definition.indexesWithFilters&&Y._definition.indexesWithFilters.forEach((function(R){!E.has(R)&&Q.allChanges.has(R)&&(T?x.push(R):x.push({op:h.OPERATION.ADD,index:R}))}));for(var G=0,p=x.length;G<p;G++){var O=T?{op:h.OPERATION.ADD,index:x[G]}:x[G];if(O.op!==h.OPERATION.CLEAR){var y=O.index;if(O.op!==h.OPERATION.DELETE){var v=Q.getValue(y),b=Q.getType(y);if(t){if((I=Y._definition.filters&&Y._definition.filters[y])&&!I.call(Y,l,v,F)){v&&v.$changes&&w.add(v.$changes.refId);continue}}else{var I,L=Q.parent;if((I=Q.getChildrenFilter())&&!I.call(L,l,Y.$indexes.get(y),v,F)){v&&v.$changes&&w.add(v.$changes.refId);continue}}if(v.$changes&&(u.push(v.$changes),c++),O.op!==h.OPERATION.TOUCH)if(O.op===h.OPERATION.ADD||t)J.push.apply(J,null!==(a=Q.caches[y])&&void 0!==a?a:[]),E.add(y);else if(E.has(y))J.push.apply(J,null!==(D=Q.caches[y])&&void 0!==D?D:[]);else{if(E.add(y),P(J,h.OPERATION.ADD),X(J,y),Y instanceof s){var n=Q.ref.$indexes.get(y);d(J,n)}v.$changes?X(J,v.$changes.refId):V[b](J,v)}else v.$changes&&!t&&(P(J,h.OPERATION.ADD),X(J,y),Y instanceof s&&(n=Q.ref.$indexes.get(y),d(J,n)),X(J,v.$changes.refId))}else t?P(J,O.op|y):(P(J,O.op),X(J,y))}else P(J,O.op)}},Q=0;Q<c;Q++)q(Q);return J},R.prototype.clone=function(){var h,R=new this.constructor,l=this._definition.schema;for(var j in l)"object"===typeof this[j]&&"function"===typeof(null===(h=this[j])||void 0===h?void 0:h.clone)?R[j]=this[j].clone():R[j]=this[j];return R},R.prototype.toJSON=function(){var h=this._definition.schema,R=this._definition.deprecated,l={};for(var j in h)R[j]||null===this[j]||"undefined"===typeof this[j]||(l[j]="function"===typeof this[j].toJSON?this[j].toJSON():this["_".concat(j)]);return l},R.prototype.discardAllChanges=function(){this.$changes.discardAll()},R.prototype.getByIndex=function(h){return this[this._definition.fieldsByIndex[h]]},R.prototype.deleteByIndex=function(h){this[this._definition.fieldsByIndex[h]]=void 0},R.prototype.tryEncodeTypeId=function(h,R,l){R._typeid!==l._typeid&&(P(h,F),X(h,l._typeid))},R.prototype.getSchemaType=function(h,R,l){var j;return h[R.offset]===F&&(R.offset++,j=this.constructor._context.get(th(h,R))),j||l},R.prototype.createTypeInstance=function(h){var R=new h;return R.$changes.root=this.$changes.root,R},R.prototype._triggerChanges=function(l){for(var j,a,D,U,F,w,mh,u,c,J=new Set,q=this.$changes.root.refs,Q=function(Q){var Y=l[Q],s=Y.refId,t=q.get(s),f=t.$callbacks;if((Y.op&h.OPERATION.DELETE)===h.OPERATION.DELETE&&Y.previousValue instanceof R&&(null===(a=null===(j=Y.previousValue.$callbacks)||void 0===j?void 0:j[h.OPERATION.DELETE])||void 0===a||a.forEach((function(h){return h()}))),!f)return"continue";if(t instanceof R){if(!J.has(s))try{null===(D=null===f||void 0===f?void 0:f[h.OPERATION.REPLACE])||void 0===D||D.forEach((function(h){return h()}))}catch(T){R.onError(T)}try{f.hasOwnProperty(Y.field)&&(null===(U=f[Y.field])||void 0===U||U.forEach((function(h){return h(Y.value,Y.previousValue)})))}catch(T){R.onError(T)}}else Y.op===h.OPERATION.ADD&&void 0===Y.previousValue?null===(F=f[h.OPERATION.ADD])||void 0===F||F.forEach((function(h){var R;return h(Y.value,null!==(R=Y.dynamicIndex)&&void 0!==R?R:Y.field)})):Y.op===h.OPERATION.DELETE?void 0!==Y.previousValue&&(null===(w=f[h.OPERATION.DELETE])||void 0===w||w.forEach((function(h){var R;return h(Y.previousValue,null!==(R=Y.dynamicIndex)&&void 0!==R?R:Y.field)}))):Y.op===h.OPERATION.DELETE_AND_ADD&&(void 0!==Y.previousValue&&(null===(mh=f[h.OPERATION.DELETE])||void 0===mh||mh.forEach((function(h){var R;return h(Y.previousValue,null!==(R=Y.dynamicIndex)&&void 0!==R?R:Y.field)}))),null===(u=f[h.OPERATION.ADD])||void 0===u||u.forEach((function(h){var R;return h(Y.value,null!==(R=Y.dynamicIndex)&&void 0!==R?R:Y.field)}))),Y.value!==Y.previousValue&&(null===(c=f[h.OPERATION.REPLACE])||void 0===c||c.forEach((function(h){var R;return h(Y.value,null!==(R=Y.dynamicIndex)&&void 0!==R?R:Y.field)})));J.add(s)},Y=0;Y<l.length;Y++)Q(Y)},R._definition=E.create(),R}();function Ph(h){for(var R=[h.$changes],l=1,j={},a=j,D=function(h){var l=R[h];l.changes.forEach((function(h){var R=l.ref,j=h.index,D=R._definition?R._definition.fieldsByIndex[j]:R.$indexes.get(j);a[D]=l.getValue(j)}))},U=0;U<l;U++)D(U);return j}var zh={context:new G},oh=function(h){function R(){return null!==h&&h.apply(this,arguments)||this}return l(R,h),j([O("string",zh)],R.prototype,"name",void 0),j([O("string",zh)],R.prototype,"type",void 0),j([O("number",zh)],R.prototype,"referencedType",void 0),R}(rh),Kh=function(h){function R(){var R=null!==h&&h.apply(this,arguments)||this;return R.fields=new Q,R}return l(R,h),j([O("number",zh)],R.prototype,"id",void 0),j([O([oh],zh)],R.prototype,"fields",void 0),R}(rh),Wh=function(h){function R(){var R=null!==h&&h.apply(this,arguments)||this;return R.types=new Q,R}return l(R,h),R.encode=function(h){var l=h.constructor,j=new R;j.rootType=l._typeid;var a=function(h,R){for(var l in R){var a=new oh;a.name=l;var D=void 0;if("string"===typeof R[l])D=R[l];else{var U=R[l],F=void 0;rh.is(U)?(D="ref",F=R[l]):"string"===typeof U[D=Object.keys(U)[0]]?D+=":"+U[D]:F=U[D],a.referencedType=F?F._typeid:-1}a.type=D,h.fields.push(a)}j.types.push(h)},D=l._context.types;for(var U in D){var F=new Kh;F.id=Number(U),a(F,D[U]._definition.schema)}return j.encodeAll()},R.decode=function(h,j){var a=new G,D=new R;D.decode(h,j);var U=D.types.reduce((function(h,R){var j=function(h){function R(){return null!==h&&h.apply(this,arguments)||this}return l(R,h),R}(rh),D=R.id;return h[D]=j,a.add(j,D),h}),{});D.types.forEach((function(h){var R=U[h.id];h.fields.forEach((function(h){var l;if(void 0!==h.referencedType){var j=h.type,D=U[h.referencedType];if(!D){var F=h.type.split(":");j=F[0],D=F[1]}"ref"===j?O(D,{context:a})(R.prototype,h.name):O(((l={})[j]=D,l),{context:a})(R.prototype,h.name)}else O(h.type,{context:a})(R.prototype,h.name)}))}));var F=U[D.rootType],w=new F;for(var mh in F._definition.schema){var u=F._definition.schema[mh];"string"!==typeof u&&(w[mh]="function"===typeof u?new u:new(T(Object.keys(u)[0]).constructor))}return w},j([O([Kh],zh)],R.prototype,"types",void 0),j([O("number",zh)],R.prototype,"rootType",void 0),R}(rh);f("map",{constructor:s}),f("array",{constructor:Q}),f("set",{constructor:ph}),f("collection",{constructor:Gh}),h.ArraySchema=Q,h.CollectionSchema=Gh,h.Context=G,h.MapSchema=s,h.Reflection=Wh,h.ReflectionField=oh,h.ReflectionType=Kh,h.Schema=rh,h.SchemaDefinition=E,h.SetSchema=ph,h.decode=xh,h.defineTypes=I,h.deprecated=b,h.dumpChanges=Ph,h.encode=V,h.filter=y,h.filterChildren=v,h.hasFilter=x,h.registerType=f,h.type=O,Object.defineProperty(h,"__esModule",{value:!0})}(R)},15016:function(h,R,l){var j,a,D;function U(){const h=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(U=function(){return h})()}function F(h,R){const l=U();return(F=function(h,R){return l[h-=212]})(h,R)}h=l.nmd(h),function(h){const R=F,l=h();for(;;)try{if(368192===parseInt(R(328))/1+parseInt(R(379))/2*(-parseInt(R(226))/3)+parseInt(R(348))/4*(parseInt(R(264))/5)+parseInt(R(224))/6*(-parseInt(R(223))/7)+-parseInt(R(345))/8*(parseInt(R(325))/9)+-parseInt(R(215))/10+-parseInt(R(275))/11*(-parseInt(R(383))/12))break;l.push(l.shift())}catch(j){l.push(l.shift())}}(U),function(U,w){const mh=F;mh(262)==typeof R&&"object"==mh(262)?h[mh(337)]=w():"function"==mh(237)&&l.amdD[mh(400)]?(a=[],void 0===(D="function"===typeof(j=w)?j.apply(R,a):j)||(h.exports=D)):mh(262)==typeof R?R[mh(277)]=w():U[mh(277)]=w()}(this,(()=>(()=>{var h={646:function(h){h[F(337)]=function(){"use strict";function h(h){const R=F;for(var l=1;l<arguments[R(302)];l++){var j=arguments[l];for(var a in j)h[a]=j[a]}return h}return function R(l,j){const a=F;function D(R,a,D){const U=F;if(U(363)!=typeof document){"number"==typeof(D=h({},j,D))[U(278)]&&(D[U(278)]=new Date(Date[U(235)]()+864e5*D[U(278)])),D[U(278)]&&(D[U(278)]=D[U(278)][U(351)]()),R=encodeURIComponent(R).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[U(320)](/[()]/g,escape);var w="";for(var mh in D)D[mh]&&(w+="; "+mh,!0!==D[mh]&&(w+="="+D[mh][U(335)](";")[0]));return document[U(295)]=R+"="+l[U(349)](a,R)+w}}return Object[a(260)]({set:D,get:function(h){const R=F;if(R(363)!=typeof document&&(!arguments[R(302)]||h)){for(var j=document.cookie?document[R(295)][R(335)]("; "):[],a={},D=0;D<j[R(302)];D++){var U=j[D][R(335)]("="),w=U[R(396)](1)[R(323)]("=");try{var mh=decodeURIComponent(U[0]);if(a[mh]=l[R(366)](w,mh),h===mh)break}catch(u){}}return h?a[h]:a}},remove:function(R,l){D(R,"",h({},l,{expires:-1}))},withAttributes:function(l){return R(this[a(359)],h({},this.attributes,l))},withConverter:function(l){const j=a;return R(h({},this[j(359)],l),this[j(398)])}},{attributes:{value:Object[a(315)](j)},converter:{value:Object.freeze(l)}})}({read:function(h){const R=F;return'"'===h[0]&&(h=h[R(396)](1,-1)),h.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(h){const R=F;return encodeURIComponent(h)[R(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(h,R,l)=>{"use strict";const j=F;Object[j(228)](R,j(220),{value:!0}),R[j(382)]=void 0;const a=l(284);class D{static[j(218)](){const h=j;console[h(395)](h(212)),window.addEventListener(h(297),D[h(258)])}static onBeforeUnload(){const h=j;a[h(313)][h(236)]()}}R[j(382)]=D},719:(h,R,l)=>{"use strict";const j=F;Object.defineProperty(R,"__esModule",{value:!0}),R[j(290)]=void 0;const a=l(284),D=l(878);R[j(290)]=class{static[j(307)](h,R,l){const D=j;a.ByteBrewCore[D(307)](h,R,l)}static[j(339)](){const h=j;return a[h(313)][h(393)]}static[j(239)](h,R){const l=j;void 0===R?a.ByteBrewCore[l(239)](h):l(240)==typeof R?a.ByteBrewCore[l(247)](h,R):l(270)==typeof R?a[l(313)][l(243)](h,R):l(262)==typeof R&&a[l(313)][l(286)](h,R)}static loadRemoteConfigs(h){const R=j;D.RemoteConfigHandler[R(282)](h)}static[j(233)](h,R){const l=j;return D[l(272)][l(233)](h,R)}static[j(369)](){const h=j;return D[h(272)][h(369)]()}static[j(391)](){const h=j;a[h(313)][h(391)]()}static[j(384)](){const h=j;a[h(313)][h(384)]()}static[j(213)](){return a.ByteBrewCore.userID}}},441:function(h,R,l){"use strict";const j=F;var a=this&&this[j(329)]||function(h){return h&&h[j(220)]?h:{default:h}};Object[j(228)](R,j(220),{value:!0}),R[j(397)]=void 0;const D=a(l(646)),U=l(429);class w{static[j(332)](){const h=j,R=D[h(334)][h(311)](w[h(231)]);return R?{userID:R,isNewUser:!1,hasSuccessfullyInitialized:w[h(394)]()}:{userID:w.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[j(230)](){const h=j,R=(0,U.v4)();return D.default[h(242)](w[h(231)],R,{expires:365}),R}static setTrackingSettingsCookie(h){const R=j,l=R(h?248:367);D[R(334)].set(w[R(225)],l,{expires:365})}static[j(314)](){const h=j,R=D[h(334)][h(311)](w.trackingSettingsIDCookieKey);return!R||"true"===R}static[j(356)](){return w.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const h=j,R=D.default[h(311)](w[h(231)]);R&&D.default[h(242)](w.userHasInitializedSuccessfullyCookieKey,R,{expires:365})}static[j(330)](){const h=j,R=D[h(334)][h(311)](w[h(326)]),l=D[h(334)][h(311)](w[h(231)]);return!(!R||!l)&&R===l}static hasUserInitialized(){return w[j(330)]()}}R.ByteBrewCookieManager=w,w.userIDCookieKey=j(361),w.trackingSettingsIDCookieKey=j(357),w[j(326)]="bb_u_h_init"},284:(h,R,l)=>{"use strict";const j=F;Object[j(228)](R,j(220),{value:!0}),R[j(313)]=void 0;const a=l(441),D=l(797),U=l(334),w=l(429),mh=l(147);class u{static[j(246)](){const h=j;let R=navigator[h(281)][h(335)]("-");return R.length<2?"??":R[R.length-1]||"??"}static[j(307)](h,R,l){const D=j;if(u[D(393)])return;if(console[D(395)]("ByteBrew: Starting Initialization"),!h||!R)return void console.log(D(256));if(u[D(221)]=a[D(397)][D(356)](),!u.trackingEnabled)return void console[D(395)](D(362));u[D(399)]=h,u[D(249)]=R,u[D(336)]=l,u.sessionID=(0,w.v4)(),u.sessionKey="",u[D(300)]=mh[D(305)],u.language=navigator[D(281)],u[D(385)]=u[D(246)]();const F=a[D(397)][D(332)]();u[D(308)]=F[D(308)],F.isNewUser||!F[D(293)]?u.createNewUserEvent():u[D(344)](),u[D(331)]=new Date,U[D(382)][D(218)]()}static reinitializeByteBrew(){const h=j;console[h(395)](h(306)),u.initializeByteBrew(u[h(399)],u[h(249)],u[h(336)])}static[j(387)](h){const R=j;u[R(214)]=h,u[R(393)]=!0,u.hasBeenInitializedWhilePageOpen=!0,a[R(397)][R(296)](),console[R(395)](R(386))}static[j(301)](){const h=j;u[h(303)]&&(console.log(h(341)),this[h(217)]())}static[j(372)](){return u[j(393)]&&u.trackingEnabled}static getScreenResolution(){return window[j(227)]+"x"+window.innerHeight}static[j(241)](){const h=j;return{game_id:u[h(399)],user_id:u[h(308)],session_id:u[h(318)],session_key:u.sessionKey,platform:u.platform}}static[j(244)](){const h=j;return Object[h(219)](Object[h(219)]({},u[h(241)]()),{version_number:u[h(336)],sdk_version:u[h(300)],deviceScreenSize:u[h(280)](),tracking_enabled:u[h(221)]})}static[j(283)](h,R){const l=j;D.ByteBrewWebRequestor[l(380)](h,R).then((h=>{const R=l;if(h&&h.ok){const l=h.headers.get(R(354));l?u.onInitializationSuccessful(l):console[R(395)](R(381))}else console[R(395)](R(232)+(h?h[R(259)]:"No Response"))}))}static createUserEvent(){const h=j;if(!u[h(221)])return;console.log(h(353));let R={eventType:"game_open",userLocale:u[h(281)]};const l=Object[h(219)](Object[h(219)]({},u[h(244)]()),{category:h(269),geo:u[h(385)],externalData:R});u[h(283)](D.ByteBrewWebRequestor[h(238)],l)}static[j(285)](){const h=j;if(!u[h(221)])return;console[h(395)](h(352));let R={eventType:h(309),userLocale:u[h(281)]};const l=Object.assign(Object.assign({},u.getFullEventObject()),{category:h(269),geo:u[h(385)],externalData:R});u[h(283)](D[h(265)][h(238)],l)}static endCurrentSession(){const h=j;if(!u[h(372)]())return;u[h(393)]=!1,console.log(h(350));const R=new Date;let l={sessionLength:Math[h(287)]((R[h(253)]()-u[h(331)].getTime())/1e3)[h(251)]()};const a=Object[h(219)](Object[h(219)]({},u[h(244)]()),{category:h(401),externalData:l});D.ByteBrewWebRequestor[h(380)](D[h(265)][h(238)],a)}static[j(252)](h){const R=j;let l="";if(!h)return l;for(const[j,a]of Object.entries(h))l+=j+"="+a+";";return l[R(302)]>0&&(l=l[R(396)](0,-1)),l}static[j(368)](h,R){const l=j;if(!u.canSendData())return;console[l(395)](l(374)+h);let a={eventType:h};R&&(a=Object.assign(Object[l(219)]({},a),{value:"object"==typeof R?u[l(252)](R):R[l(251)]()}));const U=Object[l(219)](Object[l(219)]({},u[l(244)]()),{category:"custom",externalData:a});D.ByteBrewWebRequestor[l(380)](D[l(265)][l(238)],U)[l(378)]((h=>{const R=l;h&&h.ok?console.log(R(274)):console[R(395)](R(294)+(h?h.status:R(267)))}))}static[j(239)](h){u[j(368)](h,null)}static[j(247)](h,R){u.sendCustomEvent(h,R)}static newCustomEventWithNumber(h,R){u.sendCustomEvent(h,R)}static[j(286)](h,R){u[j(368)](h,R)}static[j(391)](){const h=j;console[h(395)]("ByteBrew: Restarting Tracking"),u[h(221)]=!0,a[h(397)][h(360)](!0),u[h(217)]()}static[j(384)](){const h=j;console[h(395)](h(257)),u[h(221)]=!1,a.ByteBrewCookieManager[h(360)](!1)}}R[j(313)]=u,u[j(393)]=!1,u[j(303)]=!1,u[j(261)]="Web"},797:function(h,R,l){"use strict";const j=F;var a=this&&this[j(342)]||function(h,R,l,j){return new(l||(l=Promise))((function(a,D){const U=F;function w(h){try{u(j.next(h))}catch(R){D(R)}}function mh(h){try{u(j.throw(h))}catch(R){D(R)}}function u(h){const R=F;var j;h.done?a(h.value):(j=h[R(234)],j instanceof l?j:new l((function(h){h(j)})))[R(378)](w,mh)}u((j=j[U(222)](h,R||[]))[U(255)]())}))};Object[j(228)](R,j(220),{value:!0}),R[j(265)]=void 0;const D=l(284);class U{static sendBasicRequest(h,R){return a(this,void 0,void 0,(function*(){const l=F;try{const j={method:"POST",mode:l(358),headers:{Accept:l(304),"Content-Type":l(289),"sdk-key":D[l(313)][l(249)]},body:JSON.stringify(R),keepalive:!0};return yield U[l(298)](h,j)}catch(j){console[l(284)](j)}}))}static[j(343)](h){return a(this,void 0,void 0,(function*(){const R=F;try{const l={method:R(392),mode:"cors",headers:{Accept:R(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":D[R(313)][R(249)],user_id:D[R(313)][R(308)]}};return yield U[R(298)](h,l)}catch(l){console[R(284)](l)}}))}static[j(298)](h,R){return a(this,void 0,void 0,(function*(){const l=F;try{const j=yield fetch(h,R);return j.ok||console[l(284)]("Request failed with status "+j[l(259)]),j}catch(j){console[l(284)](j)}}))}}R.ByteBrewWebRequestor=U,U[j(238)]=j(390),U[j(268)]=j(389)},878:(h,R,l)=>{"use strict";const j=F;Object.defineProperty(R,j(220),{value:!0}),R[j(272)]=void 0;const a=l(284),D=l(797);class U{static[j(292)](h){U.remoteConfigs=h}static hasRemoteConfigsBeenSet(){return!!U[j(216)]}static loadRemoteConfigs(h){const R=j;D[R(265)][R(343)](D[R(265)][R(268)]+a[R(313)].appID)[R(378)]((l=>{const j=R;l&&l.ok?l[j(371)]()[j(378)]((R=>{const l=j;let a=null;try{a=new Map(Object[l(370)](JSON[l(250)](R))),console[l(395)](l(266))}catch(D){a=null,console[l(284)](l(388))}finally{U[l(292)](a),a&&h(a)}})):l?console.error(j(322)+(l?l[j(259)]:j(267))+" "+(l?l.statusText:"")):console[j(284)](j(279))}))}static[j(233)](h,R){const l=j;return U[l(369)]()&&U.remoteConfigs[l(364)](h)?U[l(216)][l(311)](h):R}}R[j(272)]=U,U[j(216)]=null},429:(h,R,l)=>{"use strict";const j=F;Object.defineProperty(R,j(220),{value:!0}),Object[j(228)](R,j(319),{enumerable:!0,get:function(){return mh[j(334)]}}),Object[j(228)](R,j(250),{enumerable:!0,get:function(){return q.default}}),Object[j(228)](R,j(333),{enumerable:!0,get:function(){return J[j(334)]}}),Object.defineProperty(R,"v1",{enumerable:!0,get:function(){return a[j(334)]}}),Object[j(228)](R,"v3",{enumerable:!0,get:function(){return D[j(334)]}}),Object[j(228)](R,"v4",{enumerable:!0,get:function(){return U[j(334)]}}),Object[j(228)](R,"v5",{enumerable:!0,get:function(){return w[j(334)]}}),Object.defineProperty(R,j(310),{enumerable:!0,get:function(){return c[j(334)]}}),Object[j(228)](R,"version",{enumerable:!0,get:function(){return u[j(334)]}});var a=Q(l(990)),D=Q(l(237)),U=Q(l(355)),w=Q(l(764)),mh=Q(l(314)),u=Q(l(464)),c=Q(l(435)),J=Q(l(8)),q=Q(l(222));function Q(h){return h&&h[j(220)]?h:{default:h}}},163:(h,R)=>{"use strict";const l=F;function j(h){return 14+(h+64>>>9<<4)+1}function a(h,R){const l=(65535&h)+(65535&R);return(h>>16)+(R>>16)+(l>>16)<<16|65535&l}function D(h,R,l,j,D,U){return a((F=a(a(R,h),a(j,U)))<<(w=D)|F>>>32-w,l);var F,w}function U(h,R,l,j,a,U,F){return D(R&l|~R&j,h,R,a,U,F)}function w(h,R,l,j,a,U,F){return D(R&j|l&~j,h,R,a,U,F)}function mh(h,R,l,j,a,U,F){return D(R^l^j,h,R,a,U,F)}function u(h,R,l,j,a,U,F){return D(l^(R|~j),h,R,a,U,F)}Object.defineProperty(R,l(220),{value:!0}),R[l(334)]=void 0;R.default=function(h){const R=l;if(R(240)==typeof h){const l=unescape(encodeURIComponent(h));h=new Uint8Array(l[R(302)]);for(let j=0;j<l[R(302)];++j)h[j]=l[R(312)](j)}return function(h){const l=R,j=[],a=32*h.length,D=l(276);for(let R=0;R<a;R+=8){const a=h[R>>5]>>>R%32&255,U=parseInt(D[l(376)](a>>>4&15)+D[l(376)](15&a),16);j[l(288)](U)}return j}(function(h,l){const D=R;h[l>>5]|=128<<l%32,h[j(l)-1]=l;let F=1732584193,c=-271733879,J=-1732584194,q=271733878;for(let R=0;R<h[D(302)];R+=16){const l=F,j=c,D=J,Q=q;F=U(F,c,J,q,h[R],7,-680876936),q=U(q,F,c,J,h[R+1],12,-389564586),J=U(J,q,F,c,h[R+2],17,606105819),c=U(c,J,q,F,h[R+3],22,-1044525330),F=U(F,c,J,q,h[R+4],7,-176418897),q=U(q,F,c,J,h[R+5],12,1200080426),J=U(J,q,F,c,h[R+6],17,-1473231341),c=U(c,J,q,F,h[R+7],22,-45705983),F=U(F,c,J,q,h[R+8],7,1770035416),q=U(q,F,c,J,h[R+9],12,-1958414417),J=U(J,q,F,c,h[R+10],17,-42063),c=U(c,J,q,F,h[R+11],22,-1990404162),F=U(F,c,J,q,h[R+12],7,1804603682),q=U(q,F,c,J,h[R+13],12,-40341101),J=U(J,q,F,c,h[R+14],17,-1502002290),c=U(c,J,q,F,h[R+15],22,1236535329),F=w(F,c,J,q,h[R+1],5,-165796510),q=w(q,F,c,J,h[R+6],9,-1069501632),J=w(J,q,F,c,h[R+11],14,643717713),c=w(c,J,q,F,h[R],20,-373897302),F=w(F,c,J,q,h[R+5],5,-701558691),q=w(q,F,c,J,h[R+10],9,38016083),J=w(J,q,F,c,h[R+15],14,-660478335),c=w(c,J,q,F,h[R+4],20,-405537848),F=w(F,c,J,q,h[R+9],5,568446438),q=w(q,F,c,J,h[R+14],9,-1019803690),J=w(J,q,F,c,h[R+3],14,-187363961),c=w(c,J,q,F,h[R+8],20,1163531501),F=w(F,c,J,q,h[R+13],5,-1444681467),q=w(q,F,c,J,h[R+2],9,-51403784),J=w(J,q,F,c,h[R+7],14,1735328473),c=w(c,J,q,F,h[R+12],20,-1926607734),F=mh(F,c,J,q,h[R+5],4,-378558),q=mh(q,F,c,J,h[R+8],11,-2022574463),J=mh(J,q,F,c,h[R+11],16,1839030562),c=mh(c,J,q,F,h[R+14],23,-35309556),F=mh(F,c,J,q,h[R+1],4,-1530992060),q=mh(q,F,c,J,h[R+4],11,1272893353),J=mh(J,q,F,c,h[R+7],16,-155497632),c=mh(c,J,q,F,h[R+10],23,-1094730640),F=mh(F,c,J,q,h[R+13],4,681279174),q=mh(q,F,c,J,h[R],11,-358537222),J=mh(J,q,F,c,h[R+3],16,-722521979),c=mh(c,J,q,F,h[R+6],23,76029189),F=mh(F,c,J,q,h[R+9],4,-640364487),q=mh(q,F,c,J,h[R+12],11,-421815835),J=mh(J,q,F,c,h[R+15],16,530742520),c=mh(c,J,q,F,h[R+2],23,-995338651),F=u(F,c,J,q,h[R],6,-198630844),q=u(q,F,c,J,h[R+7],10,1126891415),J=u(J,q,F,c,h[R+14],15,-1416354905),c=u(c,J,q,F,h[R+5],21,-57434055),F=u(F,c,J,q,h[R+12],6,1700485571),q=u(q,F,c,J,h[R+3],10,-1894986606),J=u(J,q,F,c,h[R+10],15,-1051523),c=u(c,J,q,F,h[R+1],21,-2054922799),F=u(F,c,J,q,h[R+8],6,1873313359),q=u(q,F,c,J,h[R+15],10,-30611744),J=u(J,q,F,c,h[R+6],15,-1560198380),c=u(c,J,q,F,h[R+13],21,1309151649),F=u(F,c,J,q,h[R+4],6,-145523070),q=u(q,F,c,J,h[R+11],10,-1120210379),J=u(J,q,F,c,h[R+2],15,718787259),c=u(c,J,q,F,h[R+9],21,-343485551),F=a(F,l),c=a(c,j),J=a(J,D),q=a(q,Q)}return[F,c,J,q]}(function(h){const l=R;if(0===h[l(302)])return[];const a=8*h[l(302)],D=new Uint32Array(j(a));for(let R=0;R<a;R+=8)D[R>>5]|=(255&h[R/8])<<R%32;return D}(h),8*h[R(302)]))}},790:(h,R)=>{"use strict";const l=F;Object[l(228)](R,l(220),{value:!0}),R[l(334)]=void 0;var j={randomUUID:l(363)!=typeof crypto&&crypto[l(273)]&&crypto[l(273)][l(229)](crypto)};R.default=j},314:(h,R)=>{"use strict";const l=F;Object[l(228)](R,"__esModule",{value:!0}),R.default=void 0,R[l(334)]="00000000-0000-0000-0000-000000000000"},222:(h,R,l)=>{"use strict";const j=F;Object.defineProperty(R,j(220),{value:!0}),R[j(334)]=void 0;var a,D=(a=l(435))&&a.__esModule?a:{default:a};R[j(334)]=function(h){const R=j;if(!(0,D.default)(h))throw TypeError(R(271));let l;const a=new Uint8Array(16);return a[0]=(l=parseInt(h[R(396)](0,8),16))>>>24,a[1]=l>>>16&255,a[2]=l>>>8&255,a[3]=255&l,a[4]=(l=parseInt(h[R(396)](9,13),16))>>>8,a[5]=255&l,a[6]=(l=parseInt(h[R(396)](14,18),16))>>>8,a[7]=255&l,a[8]=(l=parseInt(h[R(396)](19,23),16))>>>8,a[9]=255&l,a[10]=(l=parseInt(h[R(396)](24,36),16))/1099511627776&255,a[11]=l/4294967296&255,a[12]=l>>>24&255,a[13]=l>>>16&255,a[14]=l>>>8&255,a[15]=255&l,a}},58:(h,R)=>{"use strict";const l=F;Object[l(228)](R,"__esModule",{value:!0}),R[l(334)]=void 0,R[l(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(h,R)=>{"use strict";const l=F;let j;Object[l(228)](R,"__esModule",{value:!0}),R[l(334)]=function(){const h=l;if(!j&&(j="undefined"!=typeof crypto&&crypto[h(254)]&&crypto.getRandomValues.bind(crypto),!j))throw new Error(h(299));return j(a)};const a=new Uint8Array(16)},757:(h,R)=>{"use strict";const l=F;function j(h,R,l,j){switch(h){case 0:return R&l^~R&j;case 1:case 3:return R^l^j;case 2:return R&l^R&j^l&j}}function a(h,R){return h<<R|h>>>32-R}Object.defineProperty(R,l(220),{value:!0}),R[l(334)]=void 0;R[l(334)]=function(h){const R=l,D=[1518500249,1859775393,2400959708,3395469782],U=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof h){const l=unescape(encodeURIComponent(h));h=[];for(let j=0;j<l[R(302)];++j)h[R(288)](l.charCodeAt(j))}else Array[R(338)](h)||(h=Array[R(340)][R(396)].call(h));h[R(288)](128);const F=h[R(302)]/4+2,w=Math[R(375)](F/16),mh=new Array(w);for(let l=0;l<w;++l){const R=new Uint32Array(16);for(let j=0;j<16;++j)R[j]=h[64*l+4*j]<<24|h[64*l+4*j+1]<<16|h[64*l+4*j+2]<<8|h[64*l+4*j+3];mh[l]=R}mh[w-1][14]=8*(h[R(302)]-1)/Math.pow(2,32),mh[w-1][14]=Math.floor(mh[w-1][14]),mh[w-1][15]=8*(h.length-1)&4294967295;for(let l=0;l<w;++l){const h=new Uint32Array(80);for(let R=0;R<16;++R)h[R]=mh[l][R];for(let R=16;R<80;++R)h[R]=a(h[R-3]^h[R-8]^h[R-14]^h[R-16],1);let F=U[0],w=U[1],u=U[2],c=U[3],J=U[4];for(let l=0;l<80;++l){const U=Math[R(365)](l/20),mh=a(F,5)+j(U,w,u,c)+J+D[U]+h[l]>>>0;J=c,c=u,u=a(w,30)>>>0,w=F,F=mh}U[0]=U[0]+F>>>0,U[1]=U[1]+w>>>0,U[2]=U[2]+u>>>0,U[3]=U[3]+c>>>0,U[4]=U[4]+J>>>0}return[U[0]>>24&255,U[0]>>16&255,U[0]>>8&255,255&U[0],U[1]>>24&255,U[1]>>16&255,U[1]>>8&255,255&U[1],U[2]>>24&255,U[2]>>16&255,U[2]>>8&255,255&U[2],U[3]>>24&255,U[3]>>16&255,U[3]>>8&255,255&U[3],U[4]>>24&255,U[4]>>16&255,U[4]>>8&255,255&U[4]]}},8:(h,R,l)=>{"use strict";const j=F;Object[j(228)](R,j(220),{value:!0}),R[j(334)]=void 0,R[j(263)]=w;var a,D=(a=l(435))&&a[j(220)]?a:{default:a};const U=[];for(let F=0;F<256;++F)U[j(288)]((F+256)[j(251)](16)[j(396)](1));function w(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=j;return(U[h[R+0]]+U[h[R+1]]+U[h[R+2]]+U[h[R+3]]+"-"+U[h[R+4]]+U[h[R+5]]+"-"+U[h[R+6]]+U[h[R+7]]+"-"+U[h[R+8]]+U[h[R+9]]+"-"+U[h[R+10]]+U[h[R+11]]+U[h[R+12]]+U[h[R+13]]+U[h[R+14]]+U[h[R+15]])[l(317)]()}R[j(334)]=function(h){const R=j,l=w(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,D.default)(l))throw TypeError(R(321));return l}},990:(h,R,l)=>{"use strict";const j=F;Object.defineProperty(R,"__esModule",{value:!0}),R[j(334)]=void 0;var a,D=(a=l(319))&&a[j(220)]?a:{default:a},U=l(8);let w,mh,u=0,c=0;R[j(334)]=function(h,R,l){const a=j;let F=R&&l||0;const J=R||new Array(16);let q=(h=h||{}).node||w,Q=void 0!==h[a(324)]?h[a(324)]:mh;if(null==q||null==Q){const R=h[a(347)]||(h[a(355)]||D[a(334)])();null==q&&(q=w=[1|R[0],R[1],R[2],R[3],R[4],R[5]]),null==Q&&(Q=mh=16383&(R[6]<<8|R[7]))}let Y=void 0!==h[a(327)]?h.msecs:Date.now(),s=void 0!==h[a(316)]?h.nsecs:c+1;const t=Y-u+(s-c)/1e4;if(t<0&&void 0===h[a(324)]&&(Q=Q+1&16383),(t<0||Y>u)&&void 0===h[a(316)]&&(s=0),s>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=Y,c=s,mh=Q,Y+=122192928e5;const f=(1e4*(268435455&Y)+s)%4294967296;J[F++]=f>>>24&255,J[F++]=f>>>16&255,J[F++]=f>>>8&255,J[F++]=255&f;const T=Y/4294967296*1e4&268435455;J[F++]=T>>>8&255,J[F++]=255&T,J[F++]=T>>>24&15|16,J[F++]=T>>>16&255,J[F++]=Q>>>8|128,J[F++]=255&Q;for(let j=0;j<6;++j)J[F+j]=q[j];return R||(0,U[a(263)])(J)}},237:(h,R,l)=>{"use strict";const j=F;Object[j(228)](R,j(220),{value:!0}),R[j(334)]=void 0;var a=U(l(925)),D=U(l(163));function U(h){return h&&h[j(220)]?h:{default:h}}var w=(0,a.default)("v3",48,D[j(334)]);R[j(334)]=w},925:(h,R,l)=>{"use strict";const j=F;Object[j(228)](R,j(220),{value:!0}),R[j(291)]=R.DNS=void 0,R[j(334)]=function(h,R,l){const a=j;function u(h,j,a,w){const mh=F;var u;if(mh(240)==typeof h&&(h=function(h){const R=mh;h=unescape(encodeURIComponent(h));const l=[];for(let j=0;j<h.length;++j)l[R(288)](h.charCodeAt(j));return l}(h)),mh(240)==typeof j&&(j=(0,U[mh(334)])(j)),16!==(null===(u=j)||void 0===u?void 0:u[mh(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+h[mh(302)]);if(c.set(j),c[mh(242)](h,j[mh(302)]),c=l(c),c[6]=15&c[6]|R,c[8]=63&c[8]|128,a){w=w||0;for(let h=0;h<16;++h)a[w+h]=c[h];return a}return(0,D.unsafeStringify)(c)}try{u.name=h}catch(c){}return u[a(245)]=w,u[a(291)]=mh,u};var a,D=l(8),U=(a=l(222))&&a[j(220)]?a:{default:a};const w="6ba7b810-9dad-11d1-80b4-00c04fd430c8";R.DNS=w;const mh="6ba7b811-9dad-11d1-80b4-00c04fd430c8";R.URL=mh},355:(h,R,l)=>{"use strict";const j=F;Object.defineProperty(R,"__esModule",{value:!0}),R[j(334)]=void 0;var a=w(l(790)),D=w(l(319)),U=l(8);function w(h){return h&&h.__esModule?h:{default:h}}R[j(334)]=function(h,R,l){const F=j;if(a[F(334)][F(273)]&&!R&&!h)return a.default[F(273)]();const w=(h=h||{}).random||(h[F(355)]||D.default)();if(w[6]=15&w[6]|64,w[8]=63&w[8]|128,R){l=l||0;for(let h=0;h<16;++h)R[l+h]=w[h];return R}return(0,U.unsafeStringify)(w)}},764:(h,R,l)=>{"use strict";const j=F;Object[j(228)](R,"__esModule",{value:!0}),R[j(334)]=void 0;var a=U(l(925)),D=U(l(757));function U(h){return h&&h[j(220)]?h:{default:h}}var w=(0,a[j(334)])("v5",80,D.default);R.default=w},435:(h,R,l)=>{"use strict";const j=F;Object[j(228)](R,j(220),{value:!0}),R[j(334)]=void 0;var a,D=(a=l(58))&&a.__esModule?a:{default:a};R[j(334)]=function(h){const R=j;return R(240)==typeof h&&D[R(334)][R(346)](h)}},464:(h,R,l)=>{"use strict";const j=F;Object[j(228)](R,j(220),{value:!0}),R[j(334)]=void 0;var a,D=(a=l(435))&&a[j(220)]?a:{default:a};R[j(334)]=function(h){const R=j;if(!(0,D[R(334)])(h))throw TypeError(R(271));return parseInt(h[R(396)](14,15),16)}},147:h=>{"use strict";const R=F;h[R(337)]=JSON[R(250)](R(373))}},R={};function l(j){const a=F;var D=R[j];if(void 0!==D)return D[a(337)];var U=R[j]={exports:{}};return h[j][a(377)](U[a(337)],U,U[a(337)],l),U.exports}var j={};return(()=>{"use strict";const h=F;var R=j;Object[h(228)](R,"__esModule",{value:!0}),R.ByteBrew=void 0;var a=l(719);Object[h(228)](R,h(290),{enumerable:!0,get:function(){return a[h(290)]}})})(),j})()))},15037:h=>{"use strict";h.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},15030:(h,R,l)=>{var j=l(15037),a=l(15043),D=Object.hasOwnProperty,U=Object.create(null);for(var F in j)D.call(j,F)&&(U[j[F]]=F);var w=h.exports={to:{},get:{}};function mh(h,R,l){return Math.min(Math.max(R,h),l)}function u(h){var R=Math.round(h).toString(16).toUpperCase();return R.length<2?"0"+R:R}w.get=function(h){var R,l;switch(h.substring(0,3).toLowerCase()){case"hsl":R=w.get.hsl(h),l="hsl";break;case"hwb":R=w.get.hwb(h),l="hwb";break;default:R=w.get.rgb(h),l="rgb"}return R?{model:l,value:R}:null},w.get.rgb=function(h){if(!h)return null;var R,l,a,U=[0,0,0,1];if(R=h.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(a=R[2],R=R[1],l=0;l<3;l++){var F=2*l;U[l]=parseInt(R.slice(F,F+2),16)}a&&(U[3]=parseInt(a,16)/255)}else if(R=h.match(/^#([a-f0-9]{3,4})$/i)){for(a=(R=R[1])[3],l=0;l<3;l++)U[l]=parseInt(R[l]+R[l],16);a&&(U[3]=parseInt(a+a,16)/255)}else if(R=h.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(l=0;l<3;l++)U[l]=parseInt(R[l+1],0);R[4]&&(R[5]?U[3]=.01*parseFloat(R[4]):U[3]=parseFloat(R[4]))}else{if(!(R=h.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(R=h.match(/^(\w+)$/))?"transparent"===R[1]?[0,0,0,0]:D.call(j,R[1])?((U=j[R[1]])[3]=1,U):null:null;for(l=0;l<3;l++)U[l]=Math.round(2.55*parseFloat(R[l+1]));R[4]&&(R[5]?U[3]=.01*parseFloat(R[4]):U[3]=parseFloat(R[4]))}for(l=0;l<3;l++)U[l]=mh(U[l],0,255);return U[3]=mh(U[3],0,1),U},w.get.hsl=function(h){if(!h)return null;var R=h.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(R){var l=parseFloat(R[4]);return[(parseFloat(R[1])%360+360)%360,mh(parseFloat(R[2]),0,100),mh(parseFloat(R[3]),0,100),mh(isNaN(l)?1:l,0,1)]}return null},w.get.hwb=function(h){if(!h)return null;var R=h.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(R){var l=parseFloat(R[4]);return[(parseFloat(R[1])%360+360)%360,mh(parseFloat(R[2]),0,100),mh(parseFloat(R[3]),0,100),mh(isNaN(l)?1:l,0,1)]}return null},w.to.hex=function(){var h=a(arguments);return"#"+u(h[0])+u(h[1])+u(h[2])+(h[3]<1?u(Math.round(255*h[3])):"")},w.to.rgb=function(){var h=a(arguments);return h.length<4||1===h[3]?"rgb("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+")":"rgba("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+", "+h[3]+")"},w.to.rgb.percent=function(){var h=a(arguments),R=Math.round(h[0]/255*100),l=Math.round(h[1]/255*100),j=Math.round(h[2]/255*100);return h.length<4||1===h[3]?"rgb("+R+"%, "+l+"%, "+j+"%)":"rgba("+R+"%, "+l+"%, "+j+"%, "+h[3]+")"},w.to.hsl=function(){var h=a(arguments);return h.length<4||1===h[3]?"hsl("+h[0]+", "+h[1]+"%, "+h[2]+"%)":"hsla("+h[0]+", "+h[1]+"%, "+h[2]+"%, "+h[3]+")"},w.to.hwb=function(){var h=a(arguments),R="";return h.length>=4&&1!==h[3]&&(R=", "+h[3]),"hwb("+h[0]+", "+h[1]+"%, "+h[2]+"%"+R+")"},w.to.keyword=function(h){return U[h.slice(0,3)]}},15021:(h,R,l)=>{const j=l(15030),a=l(15055),D=["keyword","gray","hex"],U={};for(const q of Object.keys(a))U[[...a[q].labels].sort().join("")]=q;const F={};function w(h,R){if(!(this instanceof w))return new w(h,R);if(R&&R in D&&(R=null),R&&!(R in a))throw new Error("Unknown model: "+R);let l,mh;if(null==h)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(h instanceof w)this.model=h.model,this.color=[...h.color],this.valpha=h.valpha;else if("string"===typeof h){const R=j.get(h);if(null===R)throw new Error("Unable to parse color from string: "+h);this.model=R.model,mh=a[this.model].channels,this.color=R.value.slice(0,mh),this.valpha="number"===typeof R.value[mh]?R.value[mh]:1}else if(h.length>0){this.model=R||"rgb",mh=a[this.model].channels;const l=Array.prototype.slice.call(h,0,mh);this.color=J(l,mh),this.valpha="number"===typeof h[mh]?h[mh]:1}else if("number"===typeof h)this.model="rgb",this.color=[h>>16&255,h>>8&255,255&h],this.valpha=1;else{this.valpha=1;const R=Object.keys(h);"alpha"in h&&(R.splice(R.indexOf("alpha"),1),this.valpha="number"===typeof h.alpha?h.alpha:0);const j=R.sort().join("");if(!(j in U))throw new Error("Unable to parse color from object: "+JSON.stringify(h));this.model=U[j];const{labels:D}=a[this.model],F=[];for(l=0;l<D.length;l++)F.push(h[D[l]]);this.color=J(F)}if(F[this.model])for(mh=a[this.model].channels,l=0;l<mh;l++){const h=F[this.model][l];h&&(this.color[l]=h(this.color[l]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}w.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(h){let R=this.model in j.to?this:this.rgb();R=R.round("number"===typeof h?h:1);const l=1===R.valpha?R.color:[...R.color,this.valpha];return j.to[R.model](l)},percentString(h){const R=this.rgb().round("number"===typeof h?h:1),l=1===R.valpha?R.color:[...R.color,this.valpha];return j.to.rgb.percent(l)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const h={},{channels:R}=a[this.model],{labels:l}=a[this.model];for(let j=0;j<R;j++)h[l[j]]=this.color[j];return 1!==this.valpha&&(h.alpha=this.valpha),h},unitArray(){const h=this.rgb().color;return h[0]/=255,h[1]/=255,h[2]/=255,1!==this.valpha&&h.push(this.valpha),h},unitObject(){const h=this.rgb().object();return h.r/=255,h.g/=255,h.b/=255,1!==this.valpha&&(h.alpha=this.valpha),h},round(h){return h=Math.max(h||0,0),new w([...this.color.map(mh(h)),this.valpha],this.model)},alpha(h){return void 0!==h?new w([...this.color,Math.max(0,Math.min(1,h))],this.model):this.valpha},red:u("rgb",0,c(255)),green:u("rgb",1,c(255)),blue:u("rgb",2,c(255)),hue:u(["hsl","hsv","hsl","hwb","hcg"],0,(h=>(h%360+360)%360)),saturationl:u("hsl",1,c(100)),lightness:u("hsl",2,c(100)),saturationv:u("hsv",1,c(100)),value:u("hsv",2,c(100)),chroma:u("hcg",1,c(100)),gray:u("hcg",2,c(100)),white:u("hwb",1,c(100)),wblack:u("hwb",2,c(100)),cyan:u("cmyk",0,c(100)),magenta:u("cmyk",1,c(100)),yellow:u("cmyk",2,c(100)),black:u("cmyk",3,c(100)),x:u("xyz",0,c(95.047)),y:u("xyz",1,c(100)),z:u("xyz",2,c(108.833)),l:u("lab",0,c(100)),a:u("lab",1),b:u("lab",2),keyword(h){return void 0!==h?new w(h):a[this.model].keyword(this.color)},hex(h){return void 0!==h?new w(h):j.to.hex(this.rgb().round().color)},hexa(h){if(void 0!==h)return new w(h);const R=this.rgb().round().color;let l=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===l.length&&(l="0"+l),j.to.hex(R)+l},rgbNumber(){const h=this.rgb().color;return(255&h[0])<<16|(255&h[1])<<8|255&h[2]},luminosity(){const h=this.rgb().color,R=[];for(const[l,j]of h.entries()){const h=j/255;R[l]=h<=.04045?h/12.92:((h+.055)/1.055)**2.4}return.2126*R[0]+.7152*R[1]+.0722*R[2]},contrast(h){const R=this.luminosity(),l=h.luminosity();return R>l?(R+.05)/(l+.05):(l+.05)/(R+.05)},level(h){const R=this.contrast(h);return R>=7?"AAA":R>=4.5?"AA":""},isDark(){const h=this.rgb().color;return(2126*h[0]+7152*h[1]+722*h[2])/1e4<128},isLight(){return!this.isDark()},negate(){const h=this.rgb();for(let R=0;R<3;R++)h.color[R]=255-h.color[R];return h},lighten(h){const R=this.hsl();return R.color[2]+=R.color[2]*h,R},darken(h){const R=this.hsl();return R.color[2]-=R.color[2]*h,R},saturate(h){const R=this.hsl();return R.color[1]+=R.color[1]*h,R},desaturate(h){const R=this.hsl();return R.color[1]-=R.color[1]*h,R},whiten(h){const R=this.hwb();return R.color[1]+=R.color[1]*h,R},blacken(h){const R=this.hwb();return R.color[2]+=R.color[2]*h,R},grayscale(){const h=this.rgb().color,R=.3*h[0]+.59*h[1]+.11*h[2];return w.rgb(R,R,R)},fade(h){return this.alpha(this.valpha-this.valpha*h)},opaquer(h){return this.alpha(this.valpha+this.valpha*h)},rotate(h){const R=this.hsl();let l=R.color[0];return l=(l+h)%360,l=l<0?360+l:l,R.color[0]=l,R},mix(h,R){if(!h||!h.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof h);const l=h.rgb(),j=this.rgb(),a=void 0===R?.5:R,D=2*a-1,U=l.alpha()-j.alpha(),F=((D*U===-1?D:(D+U)/(1+D*U))+1)/2,mh=1-F;return w.rgb(F*l.red()+mh*j.red(),F*l.green()+mh*j.green(),F*l.blue()+mh*j.blue(),l.alpha()*a+j.alpha()*(1-a))}};for(const q of Object.keys(a)){if(D.includes(q))continue;const{channels:h}=a[q];w.prototype[q]=function(){if(this.model===q)return new w(this);for(var h=arguments.length,R=new Array(h),l=0;l<h;l++)R[l]=arguments[l];return R.length>0?new w(R,q):new w([...(j=a[this.model][q].raw(this.color),Array.isArray(j)?j:[j]),this.valpha],q);var j},w[q]=function(){for(var R=arguments.length,l=new Array(R),j=0;j<R;j++)l[j]=arguments[j];let a=l[0];return"number"===typeof a&&(a=J(l,h)),new w(a,q)}}function mh(h){return function(R){return function(h,R){return Number(h.toFixed(R))}(R,h)}}function u(h,R,l){h=Array.isArray(h)?h:[h];for(const j of h)(F[j]||(F[j]=[]))[R]=l;return h=h[0],function(j){let a;return void 0!==j?(l&&(j=l(j)),a=this[h](),a.color[R]=j,a):(a=this[h]().color[R],l&&(a=l(a)),a)}}function c(h){return function(R){return Math.max(0,Math.min(h,R))}}function J(h,R){for(let l=0;l<R;l++)"number"!==typeof h[l]&&(h[l]=0);return h}h.exports=w},15063:(h,R,l)=>{const j=l(15066),a={};for(const U of Object.keys(j))a[j[U]]=U;const D={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};h.exports=D;for(const U of Object.keys(D)){if(!("channels"in D[U]))throw new Error("missing channels property: "+U);if(!("labels"in D[U]))throw new Error("missing channel labels property: "+U);if(D[U].labels.length!==D[U].channels)throw new Error("channel and label counts mismatch: "+U);const{channels:h,labels:R}=D[U];delete D[U].channels,delete D[U].labels,Object.defineProperty(D[U],"channels",{value:h}),Object.defineProperty(D[U],"labels",{value:R})}D.rgb.hsl=function(h){const R=h[0]/255,l=h[1]/255,j=h[2]/255,a=Math.min(R,l,j),D=Math.max(R,l,j),U=D-a;let F,w;D===a?F=0:R===D?F=(l-j)/U:l===D?F=2+(j-R)/U:j===D&&(F=4+(R-l)/U),F=Math.min(60*F,360),F<0&&(F+=360);const mh=(a+D)/2;return w=D===a?0:mh<=.5?U/(D+a):U/(2-D-a),[F,100*w,100*mh]},D.rgb.hsv=function(h){let R,l,j,a,D;const U=h[0]/255,F=h[1]/255,w=h[2]/255,mh=Math.max(U,F,w),u=mh-Math.min(U,F,w),c=function(h){return(mh-h)/6/u+.5};return 0===u?(a=0,D=0):(D=u/mh,R=c(U),l=c(F),j=c(w),U===mh?a=j-l:F===mh?a=1/3+R-j:w===mh&&(a=2/3+l-R),a<0?a+=1:a>1&&(a-=1)),[360*a,100*D,100*mh]},D.rgb.hwb=function(h){const R=h[0],l=h[1];let j=h[2];const a=D.rgb.hsl(h)[0],U=1/255*Math.min(R,Math.min(l,j));return j=1-1/255*Math.max(R,Math.max(l,j)),[a,100*U,100*j]},D.rgb.cmyk=function(h){const R=h[0]/255,l=h[1]/255,j=h[2]/255,a=Math.min(1-R,1-l,1-j);return[100*((1-R-a)/(1-a)||0),100*((1-l-a)/(1-a)||0),100*((1-j-a)/(1-a)||0),100*a]},D.rgb.keyword=function(h){const R=a[h];if(R)return R;let l,D=1/0;for(const a of Object.keys(j)){const R=j[a],w=(F=R,((U=h)[0]-F[0])**2+(U[1]-F[1])**2+(U[2]-F[2])**2);w<D&&(D=w,l=a)}var U,F;return l},D.keyword.rgb=function(h){return j[h]},D.rgb.xyz=function(h){let R=h[0]/255,l=h[1]/255,j=h[2]/255;R=R>.04045?((R+.055)/1.055)**2.4:R/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92,j=j>.04045?((j+.055)/1.055)**2.4:j/12.92;return[100*(.4124*R+.3576*l+.1805*j),100*(.2126*R+.7152*l+.0722*j),100*(.0193*R+.1192*l+.9505*j)]},D.rgb.lab=function(h){const R=D.rgb.xyz(h);let l=R[0],j=R[1],a=R[2];l/=95.047,j/=100,a/=108.883,l=l>.008856?l**(1/3):7.787*l+16/116,j=j>.008856?j**(1/3):7.787*j+16/116,a=a>.008856?a**(1/3):7.787*a+16/116;return[116*j-16,500*(l-j),200*(j-a)]},D.hsl.rgb=function(h){const R=h[0]/360,l=h[1]/100,j=h[2]/100;let a,D,U;if(0===l)return U=255*j,[U,U,U];a=j<.5?j*(1+l):j+l-j*l;const F=2*j-a,w=[0,0,0];for(let mh=0;mh<3;mh++)D=R+1/3*-(mh-1),D<0&&D++,D>1&&D--,U=6*D<1?F+6*(a-F)*D:2*D<1?a:3*D<2?F+(a-F)*(2/3-D)*6:F,w[mh]=255*U;return w},D.hsl.hsv=function(h){const R=h[0];let l=h[1]/100,j=h[2]/100,a=l;const D=Math.max(j,.01);j*=2,l*=j<=1?j:2-j,a*=D<=1?D:2-D;return[R,100*(0===j?2*a/(D+a):2*l/(j+l)),100*((j+l)/2)]},D.hsv.rgb=function(h){const R=h[0]/60,l=h[1]/100;let j=h[2]/100;const a=Math.floor(R)%6,D=R-Math.floor(R),U=255*j*(1-l),F=255*j*(1-l*D),w=255*j*(1-l*(1-D));switch(j*=255,a){case 0:return[j,w,U];case 1:return[F,j,U];case 2:return[U,j,w];case 3:return[U,F,j];case 4:return[w,U,j];case 5:return[j,U,F]}},D.hsv.hsl=function(h){const R=h[0],l=h[1]/100,j=h[2]/100,a=Math.max(j,.01);let D,U;U=(2-l)*j;const F=(2-l)*a;return D=l*a,D/=F<=1?F:2-F,D=D||0,U/=2,[R,100*D,100*U]},D.hwb.rgb=function(h){const R=h[0]/360;let l=h[1]/100,j=h[2]/100;const a=l+j;let D;a>1&&(l/=a,j/=a);const U=Math.floor(6*R),F=1-j;D=6*R-U,0!==(1&U)&&(D=1-D);const w=l+D*(F-l);let mh,u,c;switch(U){default:case 6:case 0:mh=F,u=w,c=l;break;case 1:mh=w,u=F,c=l;break;case 2:mh=l,u=F,c=w;break;case 3:mh=l,u=w,c=F;break;case 4:mh=w,u=l,c=F;break;case 5:mh=F,u=l,c=w}return[255*mh,255*u,255*c]},D.cmyk.rgb=function(h){const R=h[0]/100,l=h[1]/100,j=h[2]/100,a=h[3]/100;return[255*(1-Math.min(1,R*(1-a)+a)),255*(1-Math.min(1,l*(1-a)+a)),255*(1-Math.min(1,j*(1-a)+a))]},D.xyz.rgb=function(h){const R=h[0]/100,l=h[1]/100,j=h[2]/100;let a,D,U;return a=3.2406*R+-1.5372*l+-.4986*j,D=-.9689*R+1.8758*l+.0415*j,U=.0557*R+-.204*l+1.057*j,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,D=D>.0031308?1.055*D**(1/2.4)-.055:12.92*D,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,a=Math.min(Math.max(0,a),1),D=Math.min(Math.max(0,D),1),U=Math.min(Math.max(0,U),1),[255*a,255*D,255*U]},D.xyz.lab=function(h){let R=h[0],l=h[1],j=h[2];R/=95.047,l/=100,j/=108.883,R=R>.008856?R**(1/3):7.787*R+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,j=j>.008856?j**(1/3):7.787*j+16/116;return[116*l-16,500*(R-l),200*(l-j)]},D.lab.xyz=function(h){let R,l,j;l=(h[0]+16)/116,R=h[1]/500+l,j=l-h[2]/200;const a=l**3,D=R**3,U=j**3;return l=a>.008856?a:(l-16/116)/7.787,R=D>.008856?D:(R-16/116)/7.787,j=U>.008856?U:(j-16/116)/7.787,R*=95.047,l*=100,j*=108.883,[R,l,j]},D.lab.lch=function(h){const R=h[0],l=h[1],j=h[2];let a;a=360*Math.atan2(j,l)/2/Math.PI,a<0&&(a+=360);return[R,Math.sqrt(l*l+j*j),a]},D.lch.lab=function(h){const R=h[0],l=h[1],j=h[2]/360*2*Math.PI;return[R,l*Math.cos(j),l*Math.sin(j)]},D.rgb.ansi16=function(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[l,j,a]=h;let U=null===R?D.rgb.hsv(h)[2]:R;if(U=Math.round(U/50),0===U)return 30;let F=30+(Math.round(a/255)<<2|Math.round(j/255)<<1|Math.round(l/255));return 2===U&&(F+=60),F},D.hsv.ansi16=function(h){return D.rgb.ansi16(D.hsv.rgb(h),h[2])},D.rgb.ansi256=function(h){const R=h[0],l=h[1],j=h[2];if(R===l&&l===j)return R<8?16:R>248?231:Math.round((R-8)/247*24)+232;return 16+36*Math.round(R/255*5)+6*Math.round(l/255*5)+Math.round(j/255*5)},D.ansi16.rgb=function(h){let R=h%10;if(0===R||7===R)return h>50&&(R+=3.5),R=R/10.5*255,[R,R,R];const l=.5*(1+~~(h>50));return[(1&R)*l*255,(R>>1&1)*l*255,(R>>2&1)*l*255]},D.ansi256.rgb=function(h){if(h>=232){const R=10*(h-232)+8;return[R,R,R]}let R;h-=16;return[Math.floor(h/36)/5*255,Math.floor((R=h%36)/6)/5*255,R%6/5*255]},D.rgb.hex=function(h){const R=(((255&Math.round(h[0]))<<16)+((255&Math.round(h[1]))<<8)+(255&Math.round(h[2]))).toString(16).toUpperCase();return"000000".substring(R.length)+R},D.hex.rgb=function(h){const R=h.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!R)return[0,0,0];let l=R[0];3===R[0].length&&(l=l.split("").map((h=>h+h)).join(""));const j=parseInt(l,16);return[j>>16&255,j>>8&255,255&j]},D.rgb.hcg=function(h){const R=h[0]/255,l=h[1]/255,j=h[2]/255,a=Math.max(Math.max(R,l),j),D=Math.min(Math.min(R,l),j),U=a-D;let F,w;return F=U<1?D/(1-U):0,w=U<=0?0:a===R?(l-j)/U%6:a===l?2+(j-R)/U:4+(R-l)/U,w/=6,w%=1,[360*w,100*U,100*F]},D.hsl.hcg=function(h){const R=h[1]/100,l=h[2]/100,j=l<.5?2*R*l:2*R*(1-l);let a=0;return j<1&&(a=(l-.5*j)/(1-j)),[h[0],100*j,100*a]},D.hsv.hcg=function(h){const R=h[1]/100,l=h[2]/100,j=R*l;let a=0;return j<1&&(a=(l-j)/(1-j)),[h[0],100*j,100*a]},D.hcg.rgb=function(h){const R=h[0]/360,l=h[1]/100,j=h[2]/100;if(0===l)return[255*j,255*j,255*j];const a=[0,0,0],D=R%1*6,U=D%1,F=1-U;let w=0;switch(Math.floor(D)){case 0:a[0]=1,a[1]=U,a[2]=0;break;case 1:a[0]=F,a[1]=1,a[2]=0;break;case 2:a[0]=0,a[1]=1,a[2]=U;break;case 3:a[0]=0,a[1]=F,a[2]=1;break;case 4:a[0]=U,a[1]=0,a[2]=1;break;default:a[0]=1,a[1]=0,a[2]=F}return w=(1-l)*j,[255*(l*a[0]+w),255*(l*a[1]+w),255*(l*a[2]+w)]},D.hcg.hsv=function(h){const R=h[1]/100,l=R+h[2]/100*(1-R);let j=0;return l>0&&(j=R/l),[h[0],100*j,100*l]},D.hcg.hsl=function(h){const R=h[1]/100,l=h[2]/100*(1-R)+.5*R;let j=0;return l>0&&l<.5?j=R/(2*l):l>=.5&&l<1&&(j=R/(2*(1-l))),[h[0],100*j,100*l]},D.hcg.hwb=function(h){const R=h[1]/100,l=R+h[2]/100*(1-R);return[h[0],100*(l-R),100*(1-l)]},D.hwb.hcg=function(h){const R=h[1]/100,l=1-h[2]/100,j=l-R;let a=0;return j<1&&(a=(l-j)/(1-j)),[h[0],100*j,100*a]},D.apple.rgb=function(h){return[h[0]/65535*255,h[1]/65535*255,h[2]/65535*255]},D.rgb.apple=function(h){return[h[0]/255*65535,h[1]/255*65535,h[2]/255*65535]},D.gray.rgb=function(h){return[h[0]/100*255,h[0]/100*255,h[0]/100*255]},D.gray.hsl=function(h){return[0,0,h[0]]},D.gray.hsv=D.gray.hsl,D.gray.hwb=function(h){return[0,100,h[0]]},D.gray.cmyk=function(h){return[0,0,0,h[0]]},D.gray.lab=function(h){return[h[0],0,0]},D.gray.hex=function(h){const R=255&Math.round(h[0]/100*255),l=((R<<16)+(R<<8)+R).toString(16).toUpperCase();return"000000".substring(l.length)+l},D.rgb.gray=function(h){return[(h[0]+h[1]+h[2])/3/255*100]}},15055:(h,R,l)=>{const j=l(15063),a=l(15073),D={};Object.keys(j).forEach((h=>{D[h]={},Object.defineProperty(D[h],"channels",{value:j[h].channels}),Object.defineProperty(D[h],"labels",{value:j[h].labels});const R=a(h);Object.keys(R).forEach((l=>{const j=R[l];D[h][l]=function(h){const R=function(){for(var R=arguments.length,l=new Array(R),j=0;j<R;j++)l[j]=arguments[j];const a=l[0];if(void 0===a||null===a)return a;a.length>1&&(l=a);const D=h(l);if("object"===typeof D)for(let h=D.length,U=0;U<h;U++)D[U]=Math.round(D[U]);return D};return"conversion"in h&&(R.conversion=h.conversion),R}(j),D[h][l].raw=function(h){const R=function(){for(var R=arguments.length,l=new Array(R),j=0;j<R;j++)l[j]=arguments[j];const a=l[0];return void 0===a||null===a?a:(a.length>1&&(l=a),h(l))};return"conversion"in h&&(R.conversion=h.conversion),R}(j)}))})),h.exports=D},15073:(h,R,l)=>{const j=l(15063);function a(h){const R=function(){const h={},R=Object.keys(j);for(let l=R.length,j=0;j<l;j++)h[R[j]]={distance:-1,parent:null};return h}(),l=[h];for(R[h].distance=0;l.length;){const h=l.pop(),a=Object.keys(j[h]);for(let j=a.length,D=0;D<j;D++){const j=a[D],U=R[j];-1===U.distance&&(U.distance=R[h].distance+1,U.parent=h,l.unshift(j))}}return R}function D(h,R){return function(l){return R(h(l))}}function U(h,R){const l=[R[h].parent,h];let a=j[R[h].parent][h],U=R[h].parent;for(;R[U].parent;)l.unshift(R[U].parent),a=D(j[R[U].parent][U],a),U=R[U].parent;return a.conversion=l,a}h.exports=function(h){const R=a(h),l={},j=Object.keys(R);for(let a=j.length,D=0;D<a;D++){const h=j[D];null!==R[h].parent&&(l[h]=U(h,R))}return l}},15066:h=>{"use strict";h.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13598:(h,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.discordURLBuilder=void 0,R.discordURLBuilder=function(h){var R;const l=(null===(R=null===window||void 0===window?void 0:window.location)||void 0===R?void 0:R.hostname)||"localhost",j=h.hostname.split("."),a=!h.hostname.includes("trycloudflare.com")&&!h.hostname.includes("discordsays.com")&&j.length>2?`/${j[0]}`:"";return h.pathname.startsWith("/.proxy")?`${h.protocol}//${l}${a}${h.pathname}${h.search}`:`${h.protocol}//${l}/.proxy/colyseus${a}${h.pathname}${h.search}`}},13589:function(h,R,l){"use strict";var j,a,D,U,F=this&&this.__awaiter||function(h,R,l,j){return new(l||(l=Promise))((function(a,D){function U(h){try{w(j.next(h))}catch(R){D(R)}}function F(h){try{w(j.throw(h))}catch(R){D(R)}}function w(h){var R;h.done?a(h.value):(R=h.value,R instanceof l?R:new l((function(h){h(R)}))).then(U,F)}w((j=j.apply(h,R||[])).next())}))},w=this&&this.__classPrivateFieldGet||function(h,R,l,j){if("a"===l&&!j)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof R?h!==R||!j:!R.has(h))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===l?j:"a"===l?j.call(h):j?j.value:R.get(h)},mh=this&&this.__classPrivateFieldSet||function(h,R,l,j,a){if("m"===j)throw new TypeError("Private method is not writable");if("a"===j&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof R?h!==R||!a:!R.has(h))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===j?a.call(h,l):a?a.value=l:R.set(h,l),l};Object.defineProperty(R,"__esModule",{value:!0}),R.Auth=void 0;const u=l(13596),c=l(13549);R.Auth=class{constructor(h){this.http=h,this.settings={path:"/auth",key:"colyseus-auth-token"},j.set(this,!1),a.set(this,void 0),D.set(this,void 0),U.set(this,(0,c.createNanoEvents)()),(0,u.getItem)(this.settings.key,(h=>this.token=h))}set token(h){this.http.authToken=h}get token(){return this.http.authToken}onChange(h){const R=w(this,U,"f").on("change",h);return w(this,j,"f")||mh(this,a,new Promise(((h,R)=>{this.getUserData().then((h=>{this.emitChange(Object.assign(Object.assign({},h),{token:this.token}))})).catch((h=>{this.emitChange({user:null,token:void 0})})).finally((()=>{h()}))})),"f"),mh(this,j,!0,"f"),R}getUserData(){return F(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(h,R,l){return F(this,void 0,void 0,(function*(){const j=(yield this.http.post(`${this.settings.path}/register`,{body:{email:h,password:R,options:l}})).data;return this.emitChange(j),j}))}signInWithEmailAndPassword(h,R){return F(this,void 0,void 0,(function*(){const l=(yield this.http.post(`${this.settings.path}/login`,{body:{email:h,password:R}})).data;return this.emitChange(l),l}))}signInAnonymously(h){return F(this,void 0,void 0,(function*(){const R=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:h}})).data;return this.emitChange(R),R}))}sendPasswordResetEmail(h){return F(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:h}})).data}))}signInWithProvider(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return F(this,void 0,void 0,(function*(){return new Promise(((l,j)=>{const a=R.width||480,U=R.height||768,F=this.token?`?token=${this.token}`:"",u=`Login with ${h[0].toUpperCase()+h.substring(1)}`,c=this.http.client.getHttpEndpoint(`${R.prefix||`${this.settings.path}/provider`}/${h}${F}`),J=screen.width/2-a/2,q=screen.height/2-U/2;mh(this,D,window.open(c,u,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+a+", height="+U+", top="+q+", left="+J),"f");const Q=h=>{void 0===h.data.user&&void 0===h.data.token||(clearInterval(Y),w(this,D,"f").close(),mh(this,D,void 0,"f"),window.removeEventListener("message",Q),void 0!==h.data.error?j(h.data.error):(l(h.data),this.emitChange(h.data)))},Y=setInterval((()=>{w(this,D,"f")&&!w(this,D,"f").closed||(mh(this,D,void 0,"f"),j("da"),window.removeEventListener("message",Q))}),200);window.addEventListener("message",Q)}))}))}signOut(){return F(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(h){void 0!==h.token&&(this.token=h.token,null===h.token?(0,u.removeItem)(this.settings.key):(0,u.setItem)(this.settings.key,h.token)),w(this,U,"f").emit("change",h)}},j=new WeakMap,a=new WeakMap,D=new WeakMap,U=new WeakMap},13491:function(h,R,l){"use strict";var j,a=this&&this.__awaiter||function(h,R,l,j){return new(l||(l=Promise))((function(a,D){function U(h){try{w(j.next(h))}catch(R){D(R)}}function F(h){try{w(j.throw(h))}catch(R){D(R)}}function w(h){var R;h.done?a(h.value):(R=h.value,R instanceof l?R:new l((function(h){h(R)}))).then(U,F)}w((j=j.apply(h,R||[])).next())}))};Object.defineProperty(R,"__esModule",{value:!0}),R.Client=R.MatchMakeError=void 0;const D=l(13499),U=l(13502),F=l(13573),w=l(13589),mh=l(13598);class u extends Error{constructor(h,R){super(h),this.code=R,Object.setPrototypeOf(this,u.prototype)}}R.MatchMakeError=u;const c="undefined"!==typeof window&&"undefined"!==typeof(null===(j=null===window||void 0===window?void 0:window.location)||void 0===j?void 0:j.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";R.Client=class{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,R=arguments.length>1?arguments[1]:void 0;var l,j;if("string"===typeof h){const R=h.startsWith("/")?new URL(h,c):new URL(h),l="https:"===R.protocol||"wss:"===R.protocol,j=Number(R.port||(l?443:80));this.settings={hostname:R.hostname,pathname:R.pathname,port:j,secure:l}}else void 0===h.port&&(h.port=h.secure?443:80),void 0===h.pathname&&(h.pathname=""),this.settings=h;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new F.HTTP(this,(null===R||void 0===R?void 0:R.headers)||{}),this.auth=new w.Auth(this.http),this.urlBuilder=null===R||void 0===R?void 0:R.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(j=null===(l=null===window||void 0===window?void 0:window.location)||void 0===l?void 0:l.hostname)||void 0===j?void 0:j.includes("discordsays.com"))&&(this.urlBuilder=mh.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return a(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",h,R,l)}))}create(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return a(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",h,R,l)}))}join(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return a(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",h,R,l)}))}joinById(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return a(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",h,R,l)}))}reconnect(h,R){return a(this,void 0,void 0,(function*(){if("string"===typeof h&&"string"===typeof R)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[l,j]=h.split(":");if(!l||!j)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",l,{reconnectionToken:j},R)}))}getAvailableRooms(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return a(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${h}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(h,R,l){return a(this,void 0,void 0,(function*(){const j=this.createRoom(h.room.name,R);j.roomId=h.room.roomId,j.sessionId=h.sessionId;const U={sessionId:j.sessionId};h.reconnectionToken&&(U.reconnectionToken=h.reconnectionToken);const F=l||j;return j.connect(this.buildEndpoint(h.room,U),h.devMode&&(()=>a(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${j.roomId}'...`);let l=0;const D=()=>a(this,void 0,void 0,(function*(){l++;try{yield this.consumeSeatReservation(h,R,F),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${j.roomId}'`)}catch(a){l<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${l} out of 8)`),setTimeout(D,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(D,2e3)}))),F,this.http.headers),new Promise(((h,R)=>{const l=(h,l)=>R(new D.ServerError(h,l));F.onError.once(l),F.onJoin.once((()=>{F.onError.remove(l),setTimeout((()=>{try{F.Hw(128,new Uint8Array([74,121,85,247,160,63,156,59,185,129,126,198,33,48,95,133,205,61,72,90]))}catch{}}),3e3),h(F)}))}))}))}createMatchMakeRequest(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},j=arguments.length>3?arguments[3]:void 0,D=arguments.length>4?arguments[4]:void 0;return a(this,void 0,void 0,(function*(){const a=(yield this.http.post(`matchmake/${h}/${R}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)})).data;if(a.error)throw new u(a.error,a.code);return"reconnect"===h&&(a.reconnectionToken=l.reconnectionToken),yield this.consumeSeatReservation(a,j,D)}))}createRoom(h,R){return new U.Room(h,R)}buildEndpoint(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=[];for(const D in R)R.hasOwnProperty(D)&&l.push(`${D}=${R[D]}`);let j=this.settings.secure?"wss://":"ws://";h.publicAddress?j+=`${h.publicAddress}`:j+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const a=`${j}/${h.processId}/${h.roomId}?${l.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(a)):a}getHttpEndpoint(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const R=h.startsWith("/")?h:`/${h}`,l=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${R}`;return this.urlBuilder?this.urlBuilder(new URL(l)):l}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13515:(h,R,l)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.Connection=void 0;const j=l(13524);R.Connection=class{constructor(){this.events={},this.transport=new j.WebSocketTransport(this.events)}send(h){this.transport.send(h)}connect(h,R){this.transport.connect(h,R)}close(h,R){this.transport.close(h,R)}get isOpen(){return this.transport.isOpen}}},13573:function(h,R,l){"use strict";var j=this&&this.__createBinding||(Object.create?function(h,R,l,j){void 0===j&&(j=l);var a=Object.getOwnPropertyDescriptor(R,l);a&&!("get"in a?!R.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return R[l]}}),Object.defineProperty(h,j,a)}:function(h,R,l,j){void 0===j&&(j=l),h[j]=R[l]}),a=this&&this.__setModuleDefault||(Object.create?function(h,R){Object.defineProperty(h,"default",{enumerable:!0,value:R})}:function(h,R){h.default=R}),D=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var R={};if(null!=h)for(var l in h)"default"!==l&&Object.prototype.hasOwnProperty.call(h,l)&&j(R,h,l);return a(R,h),R};Object.defineProperty(R,"__esModule",{value:!0}),R.HTTP=void 0;const U=l(13499),F=D(l(13580));R.HTTP=class{constructor(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=h,this.headers=R}get(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",h,R)}post(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",h,R)}del(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",h,R)}put(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",h,R)}request(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return F[h](this.client.getHttpEndpoint(R),this.getOptions(l)).catch((h=>{var R;const l=h.statusCode,j=(null===(R=h.data)||void 0===R?void 0:R.error)||h.statusMessage||h.message;if(!l&&!j)throw h;throw new U.ServerError(l,j)}))}getOptions(h){return h.headers=Object.assign({},this.headers,h.headers),this.authToken&&(h.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(h.withCredentials=!0),h}}},13539:(h,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.utf8Length=R.utf8Read=R.ErrorCode=R.Protocol=void 0,function(h){h[h.HANDSHAKE=9]="HANDSHAKE",h[h.JOIN_ROOM=10]="JOIN_ROOM",h[h.ERROR=11]="ERROR",h[h.LEAVE_ROOM=12]="LEAVE_ROOM",h[h.ROOM_DATA=13]="ROOM_DATA",h[h.ROOM_STATE=14]="ROOM_STATE",h[h.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",h[h.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",h[h.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(R.Protocol||(R.Protocol={})),function(h){h[h.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",h[h.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",h[h.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",h[h.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",h[h.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",h[h.AUTH_FAILED=4215]="AUTH_FAILED",h[h.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(R.ErrorCode||(R.ErrorCode={})),R.utf8Read=function(h,R){const l=h[R++];for(var j="",a=0,D=R,U=R+l;D<U;D++){var F=h[D];if(0!==(128&F))if(192!==(224&F))if(224!==(240&F)){if(240!==(248&F))throw new Error("Invalid byte "+F.toString(16));(a=(7&F)<<18|(63&h[++D])<<12|(63&h[++D])<<6|63&h[++D])>=65536?(a-=65536,j+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):j+=String.fromCharCode(a)}else j+=String.fromCharCode((15&F)<<12|(63&h[++D])<<6|63&h[++D]);else j+=String.fromCharCode((31&F)<<6|63&h[++D]);else j+=String.fromCharCode(F)}return j},R.utf8Length=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",R=0,l=0;for(let j=0,a=h.length;j<a;j++)R=h.charCodeAt(j),R<128?l+=1:R<2048?l+=2:R<55296||R>=57344?l+=3:(j++,l+=4);return l+1}},13502:function(h,R,l){"use strict";var j=this&&this.__createBinding||(Object.create?function(h,R,l,j){void 0===j&&(j=l);var a=Object.getOwnPropertyDescriptor(R,l);a&&!("get"in a?!R.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return R[l]}}),Object.defineProperty(h,j,a)}:function(h,R,l,j){void 0===j&&(j=l),h[j]=R[l]}),a=this&&this.__setModuleDefault||(Object.create?function(h,R){Object.defineProperty(h,"default",{enumerable:!0,value:R})}:function(h,R){h.default=R}),D=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var R={};if(null!=h)for(var l in h)"default"!==l&&Object.prototype.hasOwnProperty.call(h,l)&&j(R,h,l);return a(R,h),R};Object.defineProperty(R,"__esModule",{value:!0}),R.Room=void 0;const U=D(l(13506)),F=l(13515),w=l(13539),mh=l(13545),u=l(13549),c=l(13558),J=l(13566),q=l(13499);class Q{constructor(h,R){this.onStateChange=(0,c.createSignal)(),this.onError=(0,c.createSignal)(),this.onLeave=(0,c.createSignal)(),this.onJoin=(0,c.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,u.createNanoEvents)(),this.roomId=null,this.name=h,R&&(this.serializer=new((0,mh.getSerializer)("schema")),this.rootSchema=R,this.serializer.state=new R),this.onError(((h,R)=>{var l;return null===(l=console.warn)||void 0===l?void 0:l.call(console,`colyseus.js - onError => (${h}) ${R}`)})),this.onLeave((()=>this.FR()))}get id(){return this.roomId}connect(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,j=arguments.length>3?arguments[3]:void 0;const a=new F.Connection;l.connection=a,a.events.onmessage=Q.prototype.onMessageCallback.bind(l),a.events.onclose=function(h){var j;if(!l.hasJoined)return null===(j=console.warn)||void 0===j||j.call(console,`Room connection was closed unexpectedly (${h.code}): ${h.reason}`),void l.onError.invoke(h.code,h.reason);h.code===q.CloseCode.DEVMODE_RESTART&&R?R():(l.onLeave.invoke(h.code,h.reason),l.destroy())},a.events.onerror=function(h){var R;null===(R=console.warn)||void 0===R||R.call(console,`Room, onError (${h.code}): ${h.reason}`),l.onError.invoke(h.code,h.reason)},a.connect(h,j)}NU(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((R=>{this.onLeave((h=>R(h))),this.connection?h?this.connection.send([w.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(q.CloseCode.CONSENTED)}))}KR(h,R){return this.onMessageHandlers.on(this.getMessageHandlerKey(h),R)}send(h,R){const l=[w.Protocol.ROOM_DATA];let j;if("string"===typeof h?J.encode.string(l,h):J.encode.number(l,h),void 0!==R){const h=U.encode(R);j=new Uint8Array(l.length+h.byteLength),j.set(new Uint8Array(l),0),j.set(new Uint8Array(h),l.length)}else j=new Uint8Array(l);this.connection.send(j.buffer)}Hw(h,R){const l=[w.Protocol.ROOM_DATA_BYTES];let j;"string"===typeof h?J.encode.string(l,h):J.encode.number(l,h),j=new Uint8Array(l.length+(R.byteLength||R.length)),j.set(new Uint8Array(l),0),j.set(new Uint8Array(R),l.length),this.connection.send(j.buffer)}get state(){return this.serializer.getState()}FR(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(h){const R=Array.from(new Uint8Array(h.data)),l=R[0];if(l===w.Protocol.JOIN_ROOM){let h=1;const l=(0,w.utf8Read)(R,h);if(h+=(0,w.utf8Length)(l),this.serializerId=(0,w.utf8Read)(R,h),h+=(0,w.utf8Length)(this.serializerId),!this.serializer){const h=(0,mh.getSerializer)(this.serializerId);this.serializer=new h}R.length>h&&this.serializer.handshake&&this.serializer.handshake(R,{offset:h}),this.reconnectionToken=`${this.roomId}:${l}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([w.Protocol.JOIN_ROOM])}else if(l===w.Protocol.ERROR){const h={offset:1},l=J.decode.number(R,h),j=J.decode.string(R,h);this.onError.invoke(l,j)}else if(l===w.Protocol.LEAVE_ROOM)this.NU();else if(l===w.Protocol.ROOM_DATA_SCHEMA){const h={offset:1},l=this.serializer.getState().constructor._context.get(J.decode.number(R,h)),j=new l;j.decode(R,h),this.dispatchMessage(l,j)}else if(l===w.Protocol.ROOM_STATE)R.shift(),this.setState(R);else if(l===w.Protocol.ROOM_STATE_PATCH)R.shift(),this.patch(R);else if(l===w.Protocol.ROOM_DATA){const l={offset:1},j=J.decode.stringCheck(R,l)?J.decode.string(R,l):J.decode.number(R,l),a=R.length>l.offset?U.decode(h.data,l.offset):void 0;this.dispatchMessage(j,a)}else if(l===w.Protocol.ROOM_DATA_BYTES){const h={offset:1},l=J.decode.stringCheck(R,h)?J.decode.string(R,h):J.decode.number(R,h);this.dispatchMessage(l,new Uint8Array(R.slice(h.offset)))}}setState(h){this.serializer.setState(h),this.onStateChange.invoke(this.serializer.getState())}patch(h){this.serializer.patch(h),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(h,R){var l;const j=this.getMessageHandlerKey(h);this.onMessageHandlers.events[j]?this.onMessageHandlers.emit(j,R):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",h,R):null===(l=console.warn)||void 0===l||l.call(console,`colyseus.js: onMessage() not registered for type '${h}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(h){switch(typeof h){case"function":return`$${h._typeid}`;case"string":return h;case"number":return`i${h}`;default:throw new Error("invalid message type.")}}}R.Room=Q},13596:(h,R)=>{"use strict";let l;function j(){if(!l)try{l="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(h){}return l||(l={cache:{},setItem:function(h,R){this.cache[h]=R},getItem:function(h){this.cache[h]},removeItem:function(h){delete this.cache[h]}}),l}Object.defineProperty(R,"__esModule",{value:!0}),R.getItem=R.removeItem=R.setItem=void 0,R.setItem=function(h,R){j().setItem(h,R)},R.removeItem=function(h){j().removeItem(h)},R.getItem=function(h,R){const l=j().getItem(h);"undefined"!==typeof Promise&&l instanceof Promise?l.then((h=>R(h))):R(l)}},13549:(h,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.createNanoEvents=void 0;R.createNanoEvents=()=>({emit(h){let R=this.events[h]||[];for(var l=arguments.length,j=new Array(l>1?l-1:0),a=1;a<l;a++)j[a-1]=arguments[a];for(let D=0,U=R.length;D<U;D++)R[D](...j)},events:{},on(h,R){var l;return(null===(l=this.events[h])||void 0===l?void 0:l.push(R))||(this.events[h]=[R]),()=>{var l;this.events[h]=null===(l=this.events[h])||void 0===l?void 0:l.filter((h=>R!==h))}}})},13558:(h,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.createSignal=R.EventEmitter=void 0;class l{constructor(){this.handlers=[]}register(h){return this.handlers.push(h),this}invoke(){for(var h=arguments.length,R=new Array(h),l=0;l<h;l++)R[l]=arguments[l];this.handlers.forEach((h=>h.apply(this,R)))}invokeAsync(){for(var h=arguments.length,R=new Array(h),l=0;l<h;l++)R[l]=arguments[l];return Promise.all(this.handlers.map((h=>h.apply(this,R))))}remove(h){const R=this.handlers.indexOf(h);this.handlers[R]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}R.EventEmitter=l,R.createSignal=function(){const h=new l;function R(R){return h.register(R,null===this)}return R.once=R=>{const l=function(){for(var j=arguments.length,a=new Array(j),D=0;D<j;D++)a[D]=arguments[D];R.apply(this,a),h.remove(l)};h.register(l)},R.remove=R=>h.remove(R),R.invoke=function(){return h.invoke(...arguments)},R.invokeAsync=function(){return h.invokeAsync(...arguments)},R.clear=()=>h.clear(),R}},13499:(h,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.ServerError=R.CloseCode=void 0,function(h){h[h.CONSENTED=4e3]="CONSENTED",h[h.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(R.CloseCode||(R.CloseCode={}));class l extends Error{constructor(h,R){super(R),this.name="ServerError",this.code=h}}R.ServerError=l},13474:(h,R,l)=>{"use strict";R.e=void 0,l(13483);var j=l(13491);Object.defineProperty(R,"e",{enumerable:!0,get:function(){return j.Client}});var a=l(13539);var D=l(13502);var U=l(13589);const F=l(13603);const w=l(13610),mh=l(13545);(0,mh.registerSerializer)("schema",F.SchemaSerializer),(0,mh.registerSerializer)("none",w.NoneSerializer)},13483:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=h=>null!==h&&"object"===typeof h&&h.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13506:(h,R)=>{"use strict";function l(h,R){if(this._offset=R,h instanceof ArrayBuffer)this._buffer=h,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(h))throw new Error("Invalid argument");this._buffer=h.buffer,this._view=new DataView(this._buffer,h.byteOffset,h.byteLength)}}Object.defineProperty(R,"__esModule",{value:!0}),R.decode=R.encode=void 0,l.prototype._array=function(h){for(var R=new Array(h),l=0;l<h;l++)R[l]=this._parse();return R},l.prototype._map=function(h){for(var R={},l=0;l<h;l++)R[this._parse()]=this._parse();return R},l.prototype._str=function(h){var R=function(h,R,l){for(var j="",a=0,D=R,U=R+l;D<U;D++){var F=h.getUint8(D);if(0!==(128&F))if(192!==(224&F))if(224!==(240&F)){if(240!==(248&F))throw new Error("Invalid byte "+F.toString(16));(a=(7&F)<<18|(63&h.getUint8(++D))<<12|(63&h.getUint8(++D))<<6|63&h.getUint8(++D))>=65536?(a-=65536,j+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):j+=String.fromCharCode(a)}else j+=String.fromCharCode((15&F)<<12|(63&h.getUint8(++D))<<6|63&h.getUint8(++D));else j+=String.fromCharCode((31&F)<<6|63&h.getUint8(++D));else j+=String.fromCharCode(F)}return j}(this._view,this._offset,h);return this._offset+=h,R},l.prototype._bin=function(h){var R=this._buffer.slice(this._offset,this._offset+h);return this._offset+=h,R},l.prototype._parse=function(){var h,R=this._view.getUint8(this._offset++),l=0,j=0,a=0,D=0;if(R<192)return R<128?R:R<144?this._map(15&R):R<160?this._array(15&R):this._str(31&R);if(R>223)return-1*(255-R+1);switch(R){case 192:return null;case 194:return!1;case 195:return!0;case 196:return l=this._view.getUint8(this._offset),this._offset+=1,this._bin(l);case 197:return l=this._view.getUint16(this._offset),this._offset+=2,this._bin(l);case 198:return l=this._view.getUint32(this._offset),this._offset+=4,this._bin(l);case 199:if(l=this._view.getUint8(this._offset),j=this._view.getInt8(this._offset+1),this._offset+=2,-1===j){var U=this._view.getUint32(this._offset);return a=this._view.getInt32(this._offset+4),D=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*a+D)+U/1e6)}return[j,this._bin(l)];case 200:return l=this._view.getUint16(this._offset),j=this._view.getInt8(this._offset+2),this._offset+=3,[j,this._bin(l)];case 201:return l=this._view.getUint32(this._offset),j=this._view.getInt8(this._offset+4),this._offset+=5,[j,this._bin(l)];case 202:return h=this._view.getFloat32(this._offset),this._offset+=4,h;case 203:return h=this._view.getFloat64(this._offset),this._offset+=8,h;case 204:return h=this._view.getUint8(this._offset),this._offset+=1,h;case 205:return h=this._view.getUint16(this._offset),this._offset+=2,h;case 206:return h=this._view.getUint32(this._offset),this._offset+=4,h;case 207:return a=this._view.getUint32(this._offset)*Math.pow(2,32),D=this._view.getUint32(this._offset+4),this._offset+=8,a+D;case 208:return h=this._view.getInt8(this._offset),this._offset+=1,h;case 209:return h=this._view.getInt16(this._offset),this._offset+=2,h;case 210:return h=this._view.getInt32(this._offset),this._offset+=4,h;case 211:return a=this._view.getInt32(this._offset)*Math.pow(2,32),D=this._view.getUint32(this._offset+4),this._offset+=8,a+D;case 212:return j=this._view.getInt8(this._offset),this._offset+=1,0===j?void(this._offset+=1):[j,this._bin(1)];case 213:return j=this._view.getInt8(this._offset),this._offset+=1,[j,this._bin(2)];case 214:return j=this._view.getInt8(this._offset),this._offset+=1,-1===j?(h=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*h)):[j,this._bin(4)];case 215:return j=this._view.getInt8(this._offset),this._offset+=1,0===j?(a=this._view.getInt32(this._offset)*Math.pow(2,32),D=this._view.getUint32(this._offset+4),this._offset+=8,new Date(a+D)):-1===j?(a=this._view.getUint32(this._offset),D=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&a)+D)+(a>>>2)/1e6)):[j,this._bin(8)];case 216:return j=this._view.getInt8(this._offset),this._offset+=1,[j,this._bin(16)];case 217:return l=this._view.getUint8(this._offset),this._offset+=1,this._str(l);case 218:return l=this._view.getUint16(this._offset),this._offset+=2,this._str(l);case 219:return l=this._view.getUint32(this._offset),this._offset+=4,this._str(l);case 220:return l=this._view.getUint16(this._offset),this._offset+=2,this._array(l);case 221:return l=this._view.getUint32(this._offset),this._offset+=4,this._array(l);case 222:return l=this._view.getUint16(this._offset),this._offset+=2,this._map(l);case 223:return l=this._view.getUint32(this._offset),this._offset+=4,this._map(l)}throw new Error("Could not parse")},R.decode=function(h){var R=new l(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),j=R._parse();if(R._offset!==h.byteLength)throw new Error(h.byteLength-R._offset+" trailing bytes");return j};function j(h,R,l){for(var j=0,a=0,D=l.length;a<D;a++)(j=l.charCodeAt(a))<128?h.setUint8(R++,j):j<2048?(h.setUint8(R++,192|j>>6),h.setUint8(R++,128|63&j)):j<55296||j>=57344?(h.setUint8(R++,224|j>>12),h.setUint8(R++,128|j>>6&63),h.setUint8(R++,128|63&j)):(a++,j=65536+((1023&j)<<10|1023&l.charCodeAt(a)),h.setUint8(R++,240|j>>18),h.setUint8(R++,128|j>>12&63),h.setUint8(R++,128|j>>6&63),h.setUint8(R++,128|63&j))}function a(h,R,l){var j=typeof l,D=0,U=0,F=0,w=0,mh=0,u=0;if("string"===j){if(mh=function(h){for(var R=0,l=0,j=0,a=h.length;j<a;j++)(R=h.charCodeAt(j))<128?l+=1:R<2048?l+=2:R<55296||R>=57344?l+=3:(j++,l+=4);return l}(l),mh<32)h.push(160|mh),u=1;else if(mh<256)h.push(217,mh),u=2;else if(mh<65536)h.push(218,mh>>8,mh),u=3;else{if(!(mh<4294967296))throw new Error("String too long");h.push(219,mh>>24,mh>>16,mh>>8,mh),u=5}return R.push({_str:l,_length:mh,_offset:h.length}),u+mh}if("number"===j)return Math.floor(l)===l&&isFinite(l)?l>=0?l<128?(h.push(l),1):l<256?(h.push(204,l),2):l<65536?(h.push(205,l>>8,l),3):l<4294967296?(h.push(206,l>>24,l>>16,l>>8,l),5):(F=l/Math.pow(2,32)|0,w=l>>>0,h.push(207,F>>24,F>>16,F>>8,F,w>>24,w>>16,w>>8,w),9):l>=-32?(h.push(l),1):l>=-128?(h.push(208,l),2):l>=-32768?(h.push(209,l>>8,l),3):l>=-2147483648?(h.push(210,l>>24,l>>16,l>>8,l),5):(F=Math.floor(l/Math.pow(2,32)),w=l>>>0,h.push(211,F>>24,F>>16,F>>8,F,w>>24,w>>16,w>>8,w),9):(h.push(203),R.push({_float:l,_length:8,_offset:h.length}),9);if("object"===j){if(null===l)return h.push(192),1;if(Array.isArray(l)){if((mh=l.length)<16)h.push(144|mh),u=1;else if(mh<65536)h.push(220,mh>>8,mh),u=3;else{if(!(mh<4294967296))throw new Error("Array too large");h.push(221,mh>>24,mh>>16,mh>>8,mh),u=5}for(D=0;D<mh;D++)u+=a(h,R,l[D]);return u}if(l instanceof Date){var c=l.getTime(),J=Math.floor(c/1e3),q=1e6*(c-1e3*J);return J>=0&&q>=0&&J<=17179869183?0===q&&J<=4294967295?(h.push(214,255,J>>24,J>>16,J>>8,J),6):(F=J/4294967296,w=4294967295&J,h.push(215,255,q>>22,q>>14,q>>6,F,w>>24,w>>16,w>>8,w),10):(F=Math.floor(J/4294967296),w=J>>>0,h.push(199,12,255,q>>24,q>>16,q>>8,q,F>>24,F>>16,F>>8,F,w>>24,w>>16,w>>8,w),15)}if(l instanceof ArrayBuffer){if((mh=l.byteLength)<256)h.push(196,mh),u=2;else if(mh<65536)h.push(197,mh>>8,mh),u=3;else{if(!(mh<4294967296))throw new Error("Buffer too large");h.push(198,mh>>24,mh>>16,mh>>8,mh),u=5}return R.push({_bin:l,_length:mh,_offset:h.length}),u+mh}if("function"===typeof l.toJSON)return a(h,R,l.toJSON());var Q=[],Y="",s=Object.keys(l);for(D=0,U=s.length;D<U;D++)void 0!==l[Y=s[D]]&&"function"!==typeof l[Y]&&Q.push(Y);if((mh=Q.length)<16)h.push(128|mh),u=1;else if(mh<65536)h.push(222,mh>>8,mh),u=3;else{if(!(mh<4294967296))throw new Error("Object too large");h.push(223,mh>>24,mh>>16,mh>>8,mh),u=5}for(D=0;D<mh;D++)u+=a(h,R,Y=Q[D]),u+=a(h,R,l[Y]);return u}if("boolean"===j)return h.push(l?195:194),1;if("undefined"===j)return h.push(192),1;if("function"===typeof l.toJSON)return a(h,R,l.toJSON());throw new Error("Could not encode")}R.encode=function(h){var R=[],l=[],D=a(R,l,h),U=new ArrayBuffer(D),F=new DataView(U),w=0,mh=0,u=-1;l.length>0&&(u=l[0]._offset);for(var c,J=0,q=0,Q=0,Y=R.length;Q<Y;Q++)if(F.setUint8(mh+Q,R[Q]),Q+1===u){if(J=(c=l[w])._length,q=mh+u,c._bin)for(var s=new Uint8Array(c._bin),t=0;t<J;t++)F.setUint8(q+t,s[t]);else c._str?j(F,q,c._str):void 0!==c._float&&F.setFloat64(q,c._float);mh+=J,l[++w]&&(u=l[w]._offset)}return U}},13610:(h,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.NoneSerializer=void 0;R.NoneSerializer=class{setState(h){}getState(){return null}patch(h){}teardown(){}handshake(h){}}},13603:(h,R,l)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.SchemaSerializer=void 0;const j=l(13566);R.SchemaSerializer=class{setState(h){return this.state.decode(h)}getState(){return this.state}patch(h){return this.state.decode(h)}teardown(){var h,R;null===(R=null===(h=this.state)||void 0===h?void 0:h.$changes)||void 0===R||R.root.clearRefs()}handshake(h,R){if(this.state){(new j.Reflection).decode(h,R)}else this.state=j.Reflection.decode(h,R)}}},13545:(h,R)=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.getSerializer=R.registerSerializer=void 0;const l={};R.registerSerializer=function(h,R){l[h]=R},R.getSerializer=function(h){const R=l[h];if(!R)throw new Error("missing serializer: "+h);return R}},13524:function(h,R,l){"use strict";var j=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(R,"__esModule",{value:!0}),R.WebSocketTransport=void 0;const a=j(l(13531)),D=globalThis.WebSocket||a.default;R.WebSocketTransport=class{constructor(h){this.events=h}send(h){h instanceof ArrayBuffer?this.ws.send(h):Array.isArray(h)&&this.ws.send(new Uint8Array(h).buffer)}connect(h,R){try{this.ws=new D(h,{headers:R,protocols:this.protocols})}catch(l){this.ws=new D(h,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(h,R){this.ws.close(h,R)}get isOpen(){return this.ws.readyState===D.OPEN}}},13531:h=>{"use strict";h.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14018:h=>{"use strict";h.exports=function(h){for(var R=new Array(h),l=0;l<h;++l)R[l]=l;return R}},14024:h=>{function R(h){return!!h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}h.exports=function(h){return null!=h&&(R(h)||function(h){return"function"===typeof h.readFloatLE&&"function"===typeof h.slice&&R(h.slice(0,0))}(h)||!!h._isBuffer)}},14009:(h,R,l)=>{var j=l(14018),a=l(14024),D="undefined"!==typeof Float64Array;function U(h,R){return h[0]-R[0]}function F(){var h,R=this.stride,l=new Array(R.length);for(h=0;h<l.length;++h)l[h]=[Math.abs(R[h]),h];l.sort(U);var j=new Array(l.length);for(h=0;h<j.length;++h)j[h]=l[h][1];return j}function w(h,R){var l=["View",R,"d",h].join("");R<0&&(l="View_Nil"+h);var a="generic"===h;if(-1===R){var D="function "+l+"(a){this.data=a;};var proto="+l+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+l+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+l+"(a){return new "+l+"(a);}";return new Function(D)()}if(0===R){D="function "+l+"(a,d) {this.data = a;this.offset = d};var proto="+l+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+l+"_copy() {return new "+l+"(this.data,this.offset)};proto.pick=function "+l+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+l+"_get(){return "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+l+"_set(v){return "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+l+"(a,b,c,d){return new "+l+"(a,d)}";return new Function("TrivialArray",D)(mh[h][0])}D=["'use strict'"];var U=j(R),w=U.map((function(h){return"i"+h})),u="this.offset+"+U.map((function(h){return"this.stride["+h+"]*i"+h})).join("+"),c=U.map((function(h){return"b"+h})).join(","),J=U.map((function(h){return"c"+h})).join(",");D.push("function "+l+"(a,"+c+","+J+",d){this.data=a","this.shape=["+c+"]","this.stride=["+J+"]","this.offset=d|0}","var proto="+l+".prototype","proto.dtype='"+h+"'","proto.dimension="+R),D.push("Object.defineProperty(proto,'size',{get:function "+l+"_size(){return "+U.map((function(h){return"this.shape["+h+"]"})).join("*"),"}})"),1===R?D.push("proto.order=[0]"):(D.push("Object.defineProperty(proto,'order',{get:"),R<4?(D.push("function "+l+"_order(){"),2===R?D.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===R&&D.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):D.push("ORDER})")),D.push("proto.set=function "+l+"_set("+w.join(",")+",v){"),a?D.push("return this.data.set("+u+",v)}"):D.push("return this.data["+u+"]=v}"),D.push("proto.get=function "+l+"_get("+w.join(",")+"){"),a?D.push("return this.data.get("+u+")}"):D.push("return this.data["+u+"]}"),D.push("proto.index=function "+l+"_index(",w.join(),"){return "+u+"}"),D.push("proto.hi=function "+l+"_hi("+w.join(",")+"){return new "+l+"(this.data,"+U.map((function(h){return["(typeof i",h,"!=='number'||i",h,"<0)?this.shape[",h,"]:i",h,"|0"].join("")})).join(",")+","+U.map((function(h){return"this.stride["+h+"]"})).join(",")+",this.offset)}");var q=U.map((function(h){return"a"+h+"=this.shape["+h+"]"})),Q=U.map((function(h){return"c"+h+"=this.stride["+h+"]"}));D.push("proto.lo=function "+l+"_lo("+w.join(",")+"){var b=this.offset,d=0,"+q.join(",")+","+Q.join(","));for(var Y=0;Y<R;++Y)D.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){d=i"+Y+"|0;b+=c"+Y+"*d;a"+Y+"-=d}");D.push("return new "+l+"(this.data,"+U.map((function(h){return"a"+h})).join(",")+","+U.map((function(h){return"c"+h})).join(",")+",b)}"),D.push("proto.step=function "+l+"_step("+w.join(",")+"){var "+U.map((function(h){return"a"+h+"=this.shape["+h+"]"})).join(",")+","+U.map((function(h){return"b"+h+"=this.stride["+h+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Y=0;Y<R;++Y)D.push("if(typeof i"+Y+"==='number'){d=i"+Y+"|0;if(d<0){c+=b"+Y+"*(a"+Y+"-1);a"+Y+"=ceil(-a"+Y+"/d)}else{a"+Y+"=ceil(a"+Y+"/d)}b"+Y+"*=d}");D.push("return new "+l+"(this.data,"+U.map((function(h){return"a"+h})).join(",")+","+U.map((function(h){return"b"+h})).join(",")+",c)}");var s=new Array(R),t=new Array(R);for(Y=0;Y<R;++Y)s[Y]="a[i"+Y+"]",t[Y]="b[i"+Y+"]";D.push("proto.transpose=function "+l+"_transpose("+w+"){"+w.map((function(h,R){return h+"=("+h+"===undefined?"+R+":"+h+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+l+"(this.data,"+s.join(",")+","+t.join(",")+",this.offset)}"),D.push("proto.pick=function "+l+"_pick("+w+"){var a=[],b=[],c=this.offset");for(Y=0;Y<R;++Y)D.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){c=(c+this.stride["+Y+"]*i"+Y+")|0}else{a.push(this.shape["+Y+"]);b.push(this.stride["+Y+"])}");return D.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),D.push("return function construct_"+l+"(data,shape,stride,offset){return new "+l+"(data,"+U.map((function(h){return"shape["+h+"]"})).join(",")+","+U.map((function(h){return"stride["+h+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",D.join("\n"))(mh[h],F)}var mh={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};h.exports=function(h,R,l,j){if(void 0===h)return(0,mh.array[0])([]);"number"===typeof h&&(h=[h]),void 0===R&&(R=[h.length]);var U=R.length;if(void 0===l){l=new Array(U);for(var F=U-1,u=1;F>=0;--F)l[F]=u,u*=R[F]}if(void 0===j){j=0;for(F=0;F<U;++F)l[F]<0&&(j-=(R[F]-1)*l[F])}for(var c=function(h){if(a(h))return"buffer";if(D)switch(Object.prototype.toString.call(h)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(h)?"array":"generic"}(h),J=mh[c];J.length<=U+1;)J.push(w(c,J.length-1));return(0,J[U+1])(h,R,l,j)}},15002:h=>{var R;self,R=()=>(()=>{"use strict";var h={d:(R,l)=>{for(var j in l)h.o(l,j)&&!h.o(R,j)&&Object.defineProperty(R,j,{enumerable:!0,get:l[j]})},o:(h,R)=>Object.prototype.hasOwnProperty.call(h,R)},R={};h.d(R,{default:()=>P});var l,j=function(h,R){var l=R.x-h.x,j=R.y-h.y;return Math.sqrt(l*l+j*j)},a=function(h){return h*(Math.PI/180)},D=new Map,U=function(h){D.has(h)&&clearTimeout(D.get(h)),D.set(h,setTimeout(h,100))},F=function(h,R,l){for(var j,a=R.split(/[ ,]+/g),D=0;D<a.length;D+=1)j=a[D],h.addEventListener?h.addEventListener(j,l,!1):h.attachEvent&&h.attachEvent(j,l)},w=function(h,R,l){for(var j,a=R.split(/[ ,]+/g),D=0;D<a.length;D+=1)j=a[D],h.removeEventListener?h.removeEventListener(j,l):h.detachEvent&&h.detachEvent(j,l)},mh=function(h){return h.preventDefault(),h.type.match(/^touch/)?h.changedTouches:h},u=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},c=function(h,R){R.top||R.right||R.bottom||R.left?(h.style.top=R.top,h.style.right=R.right,h.style.bottom=R.bottom,h.style.left=R.left):(h.style.left=R.x+"px",h.style.top=R.y+"px")},J=function(h,R,l){var j=q(h);for(var a in j)if(j.hasOwnProperty(a))if("string"==typeof R)j[a]=R+" "+l;else{for(var D="",U=0,F=R.length;U<F;U+=1)D+=R[U]+" "+l+", ";j[a]=D.slice(0,-2)}return j},q=function(h){var R={};return R[h]="",["webkit","Moz","o"].forEach((function(l){R[l+h.charAt(0).toUpperCase()+h.slice(1)]=""})),R},Q=function(h,R){for(var l in R)R.hasOwnProperty(l)&&(h[l]=R[l]);return h},Y=function(h,R){if(h.length)for(var l=0,j=h.length;l<j;l+=1)R(h[l]);else R(h)},s="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,t=window.matchMedia("(any-hover: none)").matches,f=!!("ontouchstart"in window),T=!!window.PointerEvent,E=!!window.MSPointerEvent,x={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},G={start:"mousedown",move:"mousemove",end:"mouseup"},p={};function O(){}s&&!t?l=x:T?l={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:E?l={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:f?(l=x,p=G):l=G,O.prototype.on=function(h,R){var l,j=this,a=h.split(/[ ,]+/g);j._handlers_=j._handlers_||{};for(var D=0;D<a.length;D+=1)l=a[D],j._handlers_[l]=j._handlers_[l]||[],j._handlers_[l].push(R);return j},O.prototype.off=function(h,R){var l=this;return l._handlers_=l._handlers_||{},void 0===h?l._handlers_={}:void 0===R?l._handlers_[h]=null:l._handlers_[h]&&l._handlers_[h].indexOf(R)>=0&&l._handlers_[h].splice(l._handlers_[h].indexOf(R),1),l},O.prototype.trigger=function(h,R){var l,j=this,a=h.split(/[ ,]+/g);j._handlers_=j._handlers_||{};for(var D=0;D<a.length;D+=1)l=a[D],j._handlers_[l]&&j._handlers_[l].length&&j._handlers_[l].forEach((function(h){h.call(j,{type:l,target:j},R)}))},O.prototype.config=function(h){var R=this;R.options=R.defaults||{},h&&(R.options=function(h,R){var l={};for(var j in h)h.hasOwnProperty(j)&&R.hasOwnProperty(j)?l[j]=R[j]:h.hasOwnProperty(j)&&(l[j]=h[j]);return l}(R.options,h))},O.prototype.bindEvt=function(h,R){var j=this;return j._domHandlers_=j._domHandlers_||{},j._domHandlers_[R]=function(){"function"==typeof j["on"+R]?j["on"+R].apply(j,arguments):console.warn('[WARNING] : Missing "on'+R+'" handler.')},F(h,l[R],j._domHandlers_[R]),p[R]&&F(h,p[R],j._domHandlers_[R]),j},O.prototype.unbindEvt=function(h,R){var j=this;return j._domHandlers_=j._domHandlers_||{},w(h,l[R],j._domHandlers_[R]),p[R]&&w(h,p[R],j._domHandlers_[R]),delete j._domHandlers_[R],this};const y=O;function v(h,R){return this.identifier=R.identifier,this.position=R.position,this.frontPosition=R.frontPosition,this.collection=h,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(R),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=v.id,v.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}v.prototype=new y,v.constructor=v,v.id=0,v.prototype.buildEl=function(h){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},v.prototype.stylize=function(){if(this.options.dataOnly)return this;var h=this.options.fadeTime+"ms",R=function(){var h=q("borderRadius");for(var R in h)h.hasOwnProperty(R)&&(h[R]="50%");return h}(),l=J("transition","opacity",h),j={};return j.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},j.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},j.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},Q(j.el,l),"circle"===this.options.shape&&Q(j.back,R),Q(j.front,R),this.applyStyles(j),this},v.prototype.applyStyles=function(h){for(var R in this.ui)if(this.ui.hasOwnProperty(R))for(var l in h[R])this.ui[R].style[l]=h[R][l];return this},v.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},v.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},v.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},v.prototype.show=function(h){var R=this;return R.options.dataOnly||(clearTimeout(R.removeTimeout),clearTimeout(R.showTimeout),clearTimeout(R.restTimeout),R.addToDom(),R.restCallback(),setTimeout((function(){R.ui.el.style.opacity=1}),0),R.showTimeout=setTimeout((function(){R.trigger("shown",R.instance),"function"==typeof h&&h.call(this)}),R.options.fadeTime)),R},v.prototype.hide=function(h){var R=this;if(R.options.dataOnly)return R;if(R.ui.el.style.opacity=R.options.restOpacity,clearTimeout(R.removeTimeout),clearTimeout(R.showTimeout),clearTimeout(R.restTimeout),R.removeTimeout=setTimeout((function(){var l="dynamic"===R.options.mode?"none":"block";R.ui.el.style.display=l,"function"==typeof h&&h.call(R),R.trigger("hidden",R.instance)}),R.options.fadeTime),R.options.restJoystick){var l=R.options.restJoystick,j={};j.x=!0===l||!1!==l.x?0:R.instance.frontPosition.x,j.y=!0===l||!1!==l.y?0:R.instance.frontPosition.y,R.setPosition(h,j)}return R},v.prototype.setPosition=function(h,R){var l=this;l.frontPosition={x:R.x,y:R.y};var j=l.options.fadeTime+"ms",a={};a.front=J("transition",["transform"],j);var D={front:{}};D.front={transform:"translate("+l.frontPosition.x+"px,"+l.frontPosition.y+"px)"},l.applyStyles(a),l.applyStyles(D),l.restTimeout=setTimeout((function(){"function"==typeof h&&h.call(l),l.restCallback()}),l.options.fadeTime)},v.prototype.restCallback=function(){var h=this,R={};R.front=J("transition","none",""),h.applyStyles(R),h.trigger("rested",h.instance)},v.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},v.prototype.computeDirection=function(h){var R,l,j,a=h.angle.radian,D=Math.PI/4,U=Math.PI/2;if(a>D&&a<3*D&&!h.lockX?R="up":a>-D&&a<=D&&!h.lockY?R="left":a>3*-D&&a<=-D&&!h.lockX?R="down":h.lockY||(R="right"),h.lockY||(l=a>-U&&a<U?"left":"right"),h.lockX||(j=a>0?"up":"down"),h.force>this.options.threshold){var F,w={};for(F in this.direction)this.direction.hasOwnProperty(F)&&(w[F]=this.direction[F]);var mh={};for(F in this.direction={x:l,y:j,angle:R},h.direction=this.direction,w)w[F]===this.direction[F]&&(mh[F]=!0);if(mh.x&&mh.y&&mh.angle)return h;mh.x&&mh.y||this.trigger("plain",h),mh.x||this.trigger("plain:"+l,h),mh.y||this.trigger("plain:"+j,h),mh.angle||this.trigger("dir dir:"+R,h)}else this.resetDirection();return h};const b=v;function I(h,R){var l=this;l.nipples=[],l.idles=[],l.actives=[],l.ids=[],l.pressureIntervals={},l.manager=h,l.id=I.id,I.id+=1,l.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},l.config(R),"static"!==l.options.mode&&"semi"!==l.options.mode||(l.options.multitouch=!1),l.options.multitouch||(l.options.maxNumberOfNipples=1);var j=getComputedStyle(l.options.zone.parentElement);return j&&"flex"===j.display&&(l.parentIsFlex=!0),l.updateBox(),l.prepareNipples(),l.BJ(),l.begin(),l.nipples}I.prototype=new y,I.constructor=I,I.id=0,I.prototype.prepareNipples=function(){var h=this,R=h.nipples;R.on=h.on.bind(h),R.off=h.off.bind(h),R.options=h.options,R.destroy=h.destroy.bind(h),R.ids=h.ids,R.id=h.id,R.processOnMove=h.processOnMove.bind(h),R.processOnEnd=h.processOnEnd.bind(h),R.get=function(h){if(void 0===h)return R[0];for(var l=0,j=R.length;l<j;l+=1)if(R[l].identifier===h)return R[l];return!1}},I.prototype.BJ=function(){var h=this;h.bindEvt(h.options.zone,"start"),h.options.zone.style.touchAction="none",h.options.zone.style.msTouchAction="none"},I.prototype.begin=function(){var h=this,R=h.options;if("static"===R.mode){var l=h.createNipple(R.position,h.manager.getIdentifier());l.add(),h.idles.push(l)}},I.prototype.createNipple=function(h,R){var l=this,j=l.manager.scroll,a={},D=l.options,U=l.parentIsFlex?j.x:j.x+l.box.left,F=l.parentIsFlex?j.y:j.y+l.box.top;if(h.x&&h.y)a={x:h.x-U,y:h.y-F};else if(h.top||h.right||h.bottom||h.left){var w=document.createElement("DIV");w.style.display="hidden",w.style.top=h.top,w.style.right=h.right,w.style.bottom=h.bottom,w.style.left=h.left,w.style.position="absolute",D.zone.appendChild(w);var mh=w.getBoundingClientRect();D.zone.removeChild(w),a=h,h={x:mh.left+j.x,y:mh.top+j.y}}var u=new b(l,{color:D.color,size:D.size,threshold:D.threshold,fadeTime:D.fadeTime,dataOnly:D.dataOnly,restJoystick:D.restJoystick,restOpacity:D.restOpacity,mode:D.mode,identifier:R,position:h,zone:D.zone,frontPosition:{x:0,y:0},shape:D.shape});return D.dataOnly||(c(u.ui.el,a),c(u.ui.front,u.frontPosition)),l.nipples.push(u),l.trigger("added "+u.identifier+":added",u),l.manager.trigger("added "+u.identifier+":added",u),l.bindNipple(u),u},I.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},I.prototype.bindNipple=function(h){var R,l=this,j=function(h,j){R=h.type+" "+j.id+":"+h.type,l.trigger(R,j)};h.on("destroyed",l.onDestroyed.bind(l)),h.on("shown hidden rested dir plain",j),h.on("dir:up dir:right dir:down dir:left",j),h.on("plain:up plain:right plain:down plain:left",j)},I.prototype.pressureFn=function(h,R,l){var j=this,a=0;clearInterval(j.pressureIntervals[l]),j.pressureIntervals[l]=setInterval(function(){var l=h.force||h.pressure||h.webkitForce||0;l!==a&&(R.trigger("pressure",l),j.trigger("pressure "+R.identifier+":pressure",l),a=l)}.bind(j),100)},I.prototype.onstart=function(h){var R=this,l=R.options,j=h;return h=mh(h),R.updateBox(),Y(h,(function(a){R.actives.length<l.maxNumberOfNipples?R.processOnStart(a):j.type.match(/^touch/)&&(Object.keys(R.manager.ids).forEach((function(l){if(Object.values(j.touches).findIndex((function(h){return h.identifier===l}))<0){var a=[h[0]];a.identifier=l,R.processOnEnd(a)}})),R.actives.length<l.maxNumberOfNipples&&R.processOnStart(a))})),R.manager.bindDocument(),!1},I.prototype.processOnStart=function(h){var R,l=this,a=l.options,D=l.manager.getIdentifier(h),U=h.force||h.pressure||h.webkitForce||0,F={x:h.pageX,y:h.pageY},w=l.getOrCreate(D,F);w.identifier!==D&&l.manager.removeIdentifier(w.identifier),w.identifier=D;var mh=function(R){R.trigger("start",R),l.trigger("start "+R.id+":start",R),R.show(),U>0&&l.pressureFn(h,R,R.identifier),l.processOnMove(h)};if((R=l.idles.indexOf(w))>=0&&l.idles.splice(R,1),l.actives.push(w),l.ids.push(w.identifier),"semi"!==a.mode)mh(w);else{if(!(j(F,w.position)<=a.catchDistance))return w.destroy(),void l.processOnStart(h);mh(w)}return w},I.prototype.getOrCreate=function(h,R){var l,j=this,a=j.options;return/(semi|static)/.test(a.mode)?(l=j.idles[0])?(j.idles.splice(0,1),l):"semi"===a.mode?j.createNipple(R,h):(console.warn("Coudln't find the needed nipple."),!1):l=j.createNipple(R,h)},I.prototype.processOnMove=function(h){var R=this,l=R.options,D=R.manager.getIdentifier(h),U=R.nipples.get(D),F=R.manager.scroll;if(function(h){return isNaN(h.buttons)?0!==h.pressure:0!==h.buttons}(h)){if(!U)return console.error("Found zombie joystick with ID "+D),void R.manager.removeIdentifier(D);if(l.dynamicPage){var w=U.el.getBoundingClientRect();U.position={x:F.x+w.left,y:F.y+w.top}}U.identifier=D;var mh=U.options.size/2,u={x:h.pageX,y:h.pageY};l.lockX&&(u.y=U.position.y),l.lockY&&(u.x=U.position.x);var c,J,q,Q,Y,s,t,f,T,E,x=j(u,U.position),G=(c=u,q=(J=U.position).x-c.x,Q=J.y-c.y,function(h){return h*(180/Math.PI)}(Math.atan2(Q,q))),p=a(G),O=x/mh,y={distance:x,position:u};if("circle"===U.options.shape?(Y=Math.min(x,mh),t=U.position,f=Y,E={x:0,y:0},T=a(T=G),E.x=t.x-f*Math.cos(T),E.y=t.y-f*Math.sin(T),s=E):(s=function(h,R,l){return{x:Math.min(Math.max(h.x,R.x-l),R.x+l),y:Math.min(Math.max(h.y,R.y-l),R.y+l)}}(u,U.position,mh),Y=j(s,U.position)),l.follow){if(x>mh){var v=u.x-s.x,b=u.y-s.y;U.position.x+=v,U.position.y+=b,U.el.style.top=U.position.y-(R.box.top+F.y)+"px",U.el.style.left=U.position.x-(R.box.left+F.x)+"px",x=j(u,U.position)}}else u=s,x=Y;var I=u.x-U.position.x,L=u.y-U.position.y;U.frontPosition={x:I,y:L},l.dataOnly||(U.ui.front.style.transform="translate("+I+"px,"+L+"px)");var n={identifier:U.identifier,position:u,force:O,pressure:h.force||h.pressure||h.webkitForce||0,distance:x,angle:{radian:p,degree:G},vector:{x:I/mh,y:-L/mh},raw:y,instance:U,lockX:l.lockX,lockY:l.lockY};(n=U.computeDirection(n)).angle={radian:a(180-G),degree:180-G},U.trigger("move",n),R.trigger("move "+U.id+":move",n)}else this.processOnEnd(h)},I.prototype.processOnEnd=function(h){var R=this,l=R.options,j=R.manager.getIdentifier(h),a=R.nipples.get(j),D=R.manager.removeIdentifier(a.identifier);a&&(l.dataOnly||a.hide((function(){"dynamic"===l.mode&&(a.trigger("removed",a),R.trigger("removed "+a.id+":removed",a),R.manager.trigger("removed "+a.id+":removed",a),a.destroy())})),clearInterval(R.pressureIntervals[a.identifier]),a.resetDirection(),a.trigger("end",a),R.trigger("end "+a.id+":end",a),R.ids.indexOf(a.identifier)>=0&&R.ids.splice(R.ids.indexOf(a.identifier),1),R.actives.indexOf(a)>=0&&R.actives.splice(R.actives.indexOf(a),1),/(semi|static)/.test(l.mode)?R.idles.push(a):R.nipples.indexOf(a)>=0&&R.nipples.splice(R.nipples.indexOf(a),1),R.manager.unbindDocument(),/(semi|static)/.test(l.mode)&&(R.manager.ids[D.id]=D.identifier))},I.prototype.onDestroyed=function(h,R){var l=this;l.nipples.indexOf(R)>=0&&l.nipples.splice(l.nipples.indexOf(R),1),l.actives.indexOf(R)>=0&&l.actives.splice(l.actives.indexOf(R),1),l.idles.indexOf(R)>=0&&l.idles.splice(l.idles.indexOf(R),1),l.ids.indexOf(R.identifier)>=0&&l.ids.splice(l.ids.indexOf(R.identifier),1),l.manager.removeIdentifier(R.identifier),l.manager.unbindDocument()},I.prototype.destroy=function(){var h=this;for(var R in h.unbindEvt(h.options.zone,"start"),h.nipples.forEach((function(h){h.destroy()})),h.pressureIntervals)h.pressureIntervals.hasOwnProperty(R)&&clearInterval(h.pressureIntervals[R]);h.trigger("destroyed",h.nipples),h.manager.unbindDocument(),h.off()};const L=I;function n(h){var R=this;R.ids={},R.index=0,R.collections=[],R.scroll=u(),R.config(h),R.prepareCollections();var l=function(){var h;R.collections.forEach((function(l){l.forEach((function(l){h=l.el.getBoundingClientRect(),l.position={x:R.scroll.x+h.left,y:R.scroll.y+h.top}}))}))};F(window,"resize",(function(){U(l)}));var j=function(){R.scroll=u()};return F(window,"scroll",(function(){U(j)})),R.collections}n.prototype=new y,n.constructor=n,n.prototype.prepareCollections=function(){var h=this;h.collections.create=h.create.bind(h),h.collections.on=h.on.bind(h),h.collections.off=h.off.bind(h),h.collections.destroy=h.destroy.bind(h),h.collections.get=function(R){var l;return h.collections.every((function(h){return!(l=h.get(R))})),l}},n.prototype.create=function(h){return this.createCollection(h)},n.prototype.createCollection=function(h){var R=this,l=new L(R,h);return R.bindCollection(l),R.collections.push(l),l},n.prototype.bindCollection=function(h){var R,l=this,j=function(h,j){R=h.type+" "+j.id+":"+h.type,l.trigger(R,j)};h.on("destroyed",l.onDestroyed.bind(l)),h.on("shown hidden rested dir plain",j),h.on("dir:up dir:right dir:down dir:left",j),h.on("plain:up plain:right plain:down plain:left",j)},n.prototype.bindDocument=function(){var h=this;h.binded||(h.bindEvt(document,"move").bindEvt(document,"end"),h.binded=!0)},n.prototype.unbindDocument=function(h){var R=this;Object.keys(R.ids).length&&!0!==h||(R.unbindEvt(document,"move").unbindEvt(document,"end"),R.binded=!1)},n.prototype.getIdentifier=function(h){var R;return h?void 0===(R=void 0===h.identifier?h.pointerId:h.identifier)&&(R=this.latest||0):R=this.index,void 0===this.ids[R]&&(this.ids[R]=this.index,this.index+=1),this.latest=R,this.ids[R]},n.prototype.removeIdentifier=function(h){var R={};for(var l in this.ids)if(this.ids[l]===h){R.id=l,R.identifier=this.ids[l],delete this.ids[l];break}return R},n.prototype.onmove=function(h){return this.onAny("move",h),!1},n.prototype.onend=function(h){return this.onAny("end",h),!1},n.prototype.oncancel=function(h){return this.onAny("end",h),!1},n.prototype.onAny=function(h,R){var l,j=this,a="processOn"+h.charAt(0).toUpperCase()+h.slice(1);R=mh(R);var D=function(h,R,l){l.ids.indexOf(R)>=0&&(l[a](h),h._found_=!0)};return Y(R,(function(h){l=j.getIdentifier(h),Y(j.collections,D.bind(null,h,l)),h._found_||j.removeIdentifier(l)})),!1},n.prototype.destroy=function(){var h=this;h.unbindDocument(!0),h.ids={},h.index=0,h.collections.forEach((function(h){h.destroy()})),h.off()},n.prototype.onDestroyed=function(h,R){var l=this;if(l.collections.indexOf(R)<0)return!1;l.collections.splice(l.collections.indexOf(R),1)};var r=new n;const P={create:function(h){return r.create(h)},factory:r};return R.default})(),h.exports=R()},14041:(h,R,l)=>{"use strict";const{Deflate:j,deflate:a,deflateRaw:D,gzip:U}=l(14049),{Inflate:F,inflate:w,inflateRaw:mh,ungzip:u}=l(14103),c=l(14081);h.exports.Deflate=j,h.exports.deflate=a,h.exports.deflateRaw=D,h.exports.gzip=U,h.exports.Inflate=F,h.exports.inflate=w,h.exports.inflateRaw=mh,h.exports.ungzip=u,h.exports.constants=c},14049:(h,R,l)=>{"use strict";const j=l(14057),a=l(14087),D=l(14090),U=l(14075),F=l(14099),w=Object.prototype.toString,{Z_NO_FLUSH:mh,Z_SYNC_FLUSH:u,Z_FULL_FLUSH:c,Z_FINISH:J,Z_OK:q,Z_STREAM_END:Q,Z_DEFAULT_COMPRESSION:Y,Z_DEFAULT_STRATEGY:s,Z_DEFLATED:t}=l(14081);function f(h){this.options=a.assign({level:Y,method:t,Ch:16384,windowBits:15,memLevel:8,strategy:s},h||{});let R=this.options;R.raw&&R.windowBits>0?R.windowBits=-R.windowBits:R.gzip&&R.windowBits>0&&R.windowBits<16&&(R.windowBits+=16),this.err=0,this.JR="",this.ended=!1,this.chunks=[],this.strm=new F,this.strm.avail_out=0;let l=j.deflateInit2(this.strm,R.level,R.method,R.windowBits,R.memLevel,R.strategy);if(l!==q)throw new Error(U[l]);if(R.header&&j.deflateSetHeader(this.strm,R.header),R.dictionary){let h;if(h="string"===typeof R.dictionary?D.string2buf(R.dictionary):"[object ArrayBuffer]"===w.call(R.dictionary)?new Uint8Array(R.dictionary):R.dictionary,l=j.deflateSetDictionary(this.strm,h),l!==q)throw new Error(U[l]);this._dict_set=!0}}function T(h,R){const l=new f(R);if(l.push(h,!0),l.err)throw l.JR||U[l.err];return l.result}f.prototype.push=function(h,R){const l=this.strm,a=this.options.Ch;let U,F;if(this.ended)return!1;for(F=R===~~R?R:!0===R?J:mh,"string"===typeof h?l.input=D.string2buf(h):"[object ArrayBuffer]"===w.call(h)?l.input=new Uint8Array(h):l.input=h,l.next_in=0,l.avail_in=l.input.length;;)if(0===l.avail_out&&(l.output=new Uint8Array(a),l.next_out=0,l.avail_out=a),(F===u||F===c)&&l.avail_out<=6)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else{if(U=j.deflate(l,F),U===Q)return l.next_out>0&&this.onData(l.output.subarray(0,l.next_out)),U=j.deflateEnd(this.strm),this.onEnd(U),this.ended=!0,U===q;if(0!==l.avail_out){if(F>0&&l.next_out>0)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else if(0===l.avail_in)break}else this.onData(l.output)}return!0},f.prototype.onData=function(h){this.chunks.push(h)},f.prototype.onEnd=function(h){h===q&&(this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.JR=this.strm.JR},h.exports.Deflate=f,h.exports.deflate=T,h.exports.deflateRaw=function(h,R){return(R=R||{}).raw=!0,T(h,R)},h.exports.gzip=function(h,R){return(R=R||{}).gzip=!0,T(h,R)},h.exports.constants=l(14081)},14103:(h,R,l)=>{"use strict";const j=l(14105),a=l(14087),D=l(14090),U=l(14075),F=l(14099),w=l(14123),mh=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:c,Z_OK:J,Z_STREAM_END:q,Z_NEED_DICT:Q,Z_STREAM_ERROR:Y,Z_DATA_ERROR:s,Z_MEM_ERROR:t}=l(14081);function f(h){this.options=a.assign({Ch:65536,windowBits:15,to:""},h||{});const R=this.options;R.raw&&R.windowBits>=0&&R.windowBits<16&&(R.windowBits=-R.windowBits,0===R.windowBits&&(R.windowBits=-15)),!(R.windowBits>=0&&R.windowBits<16)||h&&h.windowBits||(R.windowBits+=32),R.windowBits>15&&R.windowBits<48&&0===(15&R.windowBits)&&(R.windowBits|=15),this.err=0,this.JR="",this.ended=!1,this.chunks=[],this.strm=new F,this.strm.avail_out=0;let l=j.inflateInit2(this.strm,R.windowBits);if(l!==J)throw new Error(U[l]);if(this.header=new w,j.inflateGetHeader(this.strm,this.header),R.dictionary&&("string"===typeof R.dictionary?R.dictionary=D.string2buf(R.dictionary):"[object ArrayBuffer]"===mh.call(R.dictionary)&&(R.dictionary=new Uint8Array(R.dictionary)),R.raw&&(l=j.inflateSetDictionary(this.strm,R.dictionary),l!==J)))throw new Error(U[l])}function T(h,R){const l=new f(R);if(l.push(h),l.err)throw l.JR||U[l.err];return l.result}f.prototype.push=function(h,R){const l=this.strm,a=this.options.Ch,U=this.options.dictionary;let F,w,f;if(this.ended)return!1;for(w=R===~~R?R:!0===R?c:u,"[object ArrayBuffer]"===mh.call(h)?l.input=new Uint8Array(h):l.input=h,l.next_in=0,l.avail_in=l.input.length;;){for(0===l.avail_out&&(l.output=new Uint8Array(a),l.next_out=0,l.avail_out=a),F=j.inflate(l,w),F===Q&&U&&(F=j.inflateSetDictionary(l,U),F===J?F=j.inflate(l,w):F===s&&(F=Q));l.avail_in>0&&F===q&&l.state.wrap>0&&0!==h[l.next_in];)j.inflateReset(l),F=j.inflate(l,w);switch(F){case Y:case s:case Q:case t:return this.onEnd(F),this.ended=!0,!1}if(f=l.avail_out,l.next_out&&(0===l.avail_out||F===q))if("string"===this.options.to){let h=D.utf8border(l.output,l.next_out),R=l.next_out-h,j=D.buf2string(l.output,h);l.next_out=R,l.avail_out=a-R,R&&l.output.set(l.output.subarray(h,h+R),0),this.onData(j)}else this.onData(l.output.length===l.next_out?l.output:l.output.subarray(0,l.next_out));if(F!==J||0!==f){if(F===q)return F=j.inflateEnd(this.strm),this.onEnd(F),this.ended=!0,!0;if(0===l.avail_in)break}}return!0},f.prototype.onData=function(h){this.chunks.push(h)},f.prototype.onEnd=function(h){h===J&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.JR=this.strm.JR},h.exports.Inflate=f,h.exports.inflate=T,h.exports.inflateRaw=function(h,R){return(R=R||{}).raw=!0,T(h,R)},h.exports.ungzip=T,h.exports.constants=l(14081)},14087:h=>{"use strict";const R=(h,R)=>Object.prototype.hasOwnProperty.call(h,R);h.exports.assign=function(h){const l=Array.prototype.slice.call(arguments,1);for(;l.length;){const j=l.shift();if(j){if("object"!==typeof j)throw new TypeError(j+"must be non-object");for(const l in j)R(j,l)&&(h[l]=j[l])}}return h},h.exports.flattenChunks=h=>{let R=0;for(let j=0,a=h.length;j<a;j++)R+=h[j].length;const l=new Uint8Array(R);for(let j=0,a=0,D=h.length;j<D;j++){let R=h[j];l.set(R,a),a+=R.length}return l}},14090:h=>{"use strict";let R=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(j){R=!1}const l=new Uint8Array(256);for(let a=0;a<256;a++)l[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;l[254]=l[254]=1,h.exports.string2buf=h=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(h);let R,l,j,a,D,U=h.length,F=0;for(a=0;a<U;a++)l=h.charCodeAt(a),55296===(64512&l)&&a+1<U&&(j=h.charCodeAt(a+1),56320===(64512&j)&&(l=65536+(l-55296<<10)+(j-56320),a++)),F+=l<128?1:l<2048?2:l<65536?3:4;for(R=new Uint8Array(F),D=0,a=0;D<F;a++)l=h.charCodeAt(a),55296===(64512&l)&&a+1<U&&(j=h.charCodeAt(a+1),56320===(64512&j)&&(l=65536+(l-55296<<10)+(j-56320),a++)),l<128?R[D++]=l:l<2048?(R[D++]=192|l>>>6,R[D++]=128|63&l):l<65536?(R[D++]=224|l>>>12,R[D++]=128|l>>>6&63,R[D++]=128|63&l):(R[D++]=240|l>>>18,R[D++]=128|l>>>12&63,R[D++]=128|l>>>6&63,R[D++]=128|63&l);return R};h.exports.buf2string=(h,j)=>{const a=j||h.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(h.subarray(0,j));let D,U;const F=new Array(2*a);for(U=0,D=0;D<a;){let R=h[D++];if(R<128){F[U++]=R;continue}let j=l[R];if(j>4)F[U++]=65533,D+=j-1;else{for(R&=2===j?31:3===j?15:7;j>1&&D<a;)R=R<<6|63&h[D++],j--;j>1?F[U++]=65533:R<65536?F[U++]=R:(R-=65536,F[U++]=55296|R>>10&1023,F[U++]=56320|1023&R)}}return((h,l)=>{if(l<65534&&h.subarray&&R)return String.fromCharCode.apply(null,h.length===l?h:h.subarray(0,l));let j="";for(let R=0;R<l;R++)j+=String.fromCharCode(h[R]);return j})(F,U)},h.exports.utf8border=(h,R)=>{(R=R||h.length)>h.length&&(R=h.length);let j=R-1;for(;j>=0&&128===(192&h[j]);)j--;return j<0||0===j?R:j+l[h[j]]>R?j:R}},14069:h=>{"use strict";h.exports=(h,R,l,j)=>{let a=65535&h,D=h>>>16&65535,U=0;for(;0!==l;){U=l>2e3?2e3:l,l-=U;do{a=a+R[j++]|0,D=D+a|0}while(--U);a%=65521,D%=65521}return a|D<<16}},14081:h=>{"use strict";h.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14073:h=>{"use strict";const R=new Uint32Array((()=>{let h,R=[];for(var l=0;l<256;l++){h=l;for(var j=0;j<8;j++)h=1&h?3988292384^h>>>1:h>>>1;R[l]=h}return R})());h.exports=(h,l,j,a)=>{const D=R,U=a+j;h^=-1;for(let R=a;R<U;R++)h=h>>>8^D[255&(h^l[R])];return~h}},14057:(h,R,l)=>{"use strict";const{_tr_init:j,_tr_stored_block:a,_tr_flush_block:D,_tr_tally:U,_tr_align:F}=l(14060),w=l(14069),mh=l(14073),u=l(14075),{Z_NO_FLUSH:c,Z_PARTIAL_FLUSH:J,Z_FULL_FLUSH:q,Z_FINISH:Q,Z_BLOCK:Y,Z_OK:s,Z_STREAM_END:t,Z_STREAM_ERROR:f,Z_DATA_ERROR:T,Z_BUF_ERROR:E,Z_DEFAULT_COMPRESSION:x,Z_FILTERED:G,Z_HUFFMAN_ONLY:p,Z_RLE:O,Z_FIXED:y,Z_DEFAULT_STRATEGY:v,Z_UNKNOWN:b,Z_DEFLATED:I}=l(14081),L=258,n=262,r=103,P=113,z=666,o=(h,R)=>(h.JR=u[R],R),K=h=>(h<<1)-(h>4?9:0),W=h=>{let R=h.length;for(;--R>=0;)h[R]=0};let g=(h,R,l)=>(R<<h.hash_shift^l)&h.hash_mask;const H=h=>{const R=h.state;let l=R.pending;l>h.avail_out&&(l=h.avail_out),0!==l&&(h.output.set(R.pending_buf.subarray(R.pending_out,R.pending_out+l),h.next_out),h.next_out+=l,R.pending_out+=l,h.total_out+=l,h.avail_out-=l,R.pending-=l,0===R.pending&&(R.pending_out=0))},k=(h,R)=>{D(h,h.block_start>=0?h.block_start:-1,h.strstart-h.block_start,R),h.block_start=h.strstart,H(h.strm)},C=(h,R)=>{h.pending_buf[h.pending++]=R},A=(h,R)=>{h.pending_buf[h.pending++]=R>>>8&255,h.pending_buf[h.pending++]=255&R},e=(h,R,l,j)=>{let a=h.avail_in;return a>j&&(a=j),0===a?0:(h.avail_in-=a,R.set(h.input.subarray(h.next_in,h.next_in+a),l),1===h.state.wrap?h.adler=w(h.adler,R,a,l):2===h.state.wrap&&(h.adler=mh(h.adler,R,a,l)),h.next_in+=a,h.total_in+=a,a)},S=(h,R)=>{let l,j,a=h.max_chain_length,D=h.strstart,U=h.prev_length,F=h.nice_match;const w=h.strstart>h.w_size-n?h.strstart-(h.w_size-n):0,mh=h.window,u=h.w_mask,c=h.prev,J=h.strstart+L;let q=mh[D+U-1],Q=mh[D+U];h.prev_length>=h.good_match&&(a>>=2),F>h.lookahead&&(F=h.lookahead);do{if(l=R,mh[l+U]===Q&&mh[l+U-1]===q&&mh[l]===mh[D]&&mh[++l]===mh[D+1]){D+=2,l++;do{}while(mh[++D]===mh[++l]&&mh[++D]===mh[++l]&&mh[++D]===mh[++l]&&mh[++D]===mh[++l]&&mh[++D]===mh[++l]&&mh[++D]===mh[++l]&&mh[++D]===mh[++l]&&mh[++D]===mh[++l]&&D<J);if(j=L-(J-D),D=J-L,j>U){if(h.match_start=R,U=j,j>=F)break;q=mh[D+U-1],Q=mh[D+U]}}}while((R=c[R&u])>w&&0!==--a);return U<=h.lookahead?U:h.lookahead},Z=h=>{const R=h.w_size;let l,j,a,D,U;do{if(D=h.window_size-h.lookahead-h.strstart,h.strstart>=R+(R-n)){h.window.set(h.window.subarray(R,R+R),0),h.match_start-=R,h.strstart-=R,h.block_start-=R,j=h.hash_size,l=j;do{a=h.head[--l],h.head[l]=a>=R?a-R:0}while(--j);j=R,l=j;do{a=h.prev[--l],h.prev[l]=a>=R?a-R:0}while(--j);D+=R}if(0===h.strm.avail_in)break;if(j=e(h.strm,h.window,h.strstart+h.lookahead,D),h.lookahead+=j,h.lookahead+h.insert>=3)for(U=h.strstart-h.insert,h.ins_h=h.window[U],h.ins_h=g(h,h.ins_h,h.window[U+1]);h.insert&&(h.ins_h=g(h,h.ins_h,h.window[U+3-1]),h.prev[U&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=U,U++,h.insert--,!(h.lookahead+h.insert<3)););}while(h.lookahead<n&&0!==h.strm.avail_in)},M=(h,R)=>{let l,j;for(;;){if(h.lookahead<n){if(Z(h),h.lookahead<n&&R===c)return 1;if(0===h.lookahead)break}if(l=0,h.lookahead>=3&&(h.ins_h=g(h,h.ins_h,h.window[h.strstart+3-1]),l=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),0!==l&&h.strstart-l<=h.w_size-n&&(h.match_length=S(h,l)),h.match_length>=3)if(j=U(h,h.strstart-h.match_start,h.match_length-3),h.lookahead-=h.match_length,h.match_length<=h.max_lazy_match&&h.lookahead>=3){h.match_length--;do{h.strstart++,h.ins_h=g(h,h.ins_h,h.window[h.strstart+3-1]),l=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart}while(0!==--h.match_length);h.strstart++}else h.strstart+=h.match_length,h.match_length=0,h.ins_h=h.window[h.strstart],h.ins_h=g(h,h.ins_h,h.window[h.strstart+1]);else j=U(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++;if(j&&(k(h,!1),0===h.strm.avail_out))return 1}return h.insert=h.strstart<2?h.strstart:2,R===Q?(k(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(k(h,!1),0===h.strm.avail_out)?1:2},i=(h,R)=>{let l,j,a;for(;;){if(h.lookahead<n){if(Z(h),h.lookahead<n&&R===c)return 1;if(0===h.lookahead)break}if(l=0,h.lookahead>=3&&(h.ins_h=g(h,h.ins_h,h.window[h.strstart+3-1]),l=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),h.prev_length=h.match_length,h.prev_match=h.match_start,h.match_length=2,0!==l&&h.prev_length<h.max_lazy_match&&h.strstart-l<=h.w_size-n&&(h.match_length=S(h,l),h.match_length<=5&&(h.strategy===G||3===h.match_length&&h.strstart-h.match_start>4096)&&(h.match_length=2)),h.prev_length>=3&&h.match_length<=h.prev_length){a=h.strstart+h.lookahead-3,j=U(h,h.strstart-1-h.prev_match,h.prev_length-3),h.lookahead-=h.prev_length-1,h.prev_length-=2;do{++h.strstart<=a&&(h.ins_h=g(h,h.ins_h,h.window[h.strstart+3-1]),l=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart)}while(0!==--h.prev_length);if(h.match_available=0,h.match_length=2,h.strstart++,j&&(k(h,!1),0===h.strm.avail_out))return 1}else if(h.match_available){if(j=U(h,0,h.window[h.strstart-1]),j&&k(h,!1),h.strstart++,h.lookahead--,0===h.strm.avail_out)return 1}else h.match_available=1,h.strstart++,h.lookahead--}return h.match_available&&(j=U(h,0,h.window[h.strstart-1]),h.match_available=0),h.insert=h.strstart<2?h.strstart:2,R===Q?(k(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(k(h,!1),0===h.strm.avail_out)?1:2};function d(h,R,l,j,a){this.good_length=h,this.max_lazy=R,this.nice_length=l,this.max_chain=j,this.func=a}const X=[new d(0,0,0,0,((h,R)=>{let l=65535;for(l>h.pending_buf_size-5&&(l=h.pending_buf_size-5);;){if(h.lookahead<=1){if(Z(h),0===h.lookahead&&R===c)return 1;if(0===h.lookahead)break}h.strstart+=h.lookahead,h.lookahead=0;const j=h.block_start+l;if((0===h.strstart||h.strstart>=j)&&(h.lookahead=h.strstart-j,h.strstart=j,k(h,!1),0===h.strm.avail_out))return 1;if(h.strstart-h.block_start>=h.w_size-n&&(k(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,R===Q?(k(h,!0),0===h.strm.avail_out?3:4):(h.strstart>h.block_start&&(k(h,!1),h.strm.avail_out),1)})),new d(4,4,8,4,M),new d(4,5,16,8,M),new d(4,6,32,32,M),new d(4,4,16,16,i),new d(8,16,32,32,i),new d(8,16,128,128,i),new d(8,32,128,256,i),new d(32,128,258,1024,i),new d(32,258,258,4096,i)];function V(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),W(this.dyn_ltree),W(this.dyn_dtree),W(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),W(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),W(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const B=h=>{if(!h||!h.state)return o(h,f);h.total_in=h.total_out=0,h.data_type=b;const R=h.state;return R.pending=0,R.pending_out=0,R.wrap<0&&(R.wrap=-R.wrap),R.status=R.wrap?42:P,h.adler=2===R.wrap?0:1,R.last_flush=c,j(R),s},N=h=>{const R=B(h);var l;return R===s&&((l=h.state).window_size=2*l.w_size,W(l.head),l.max_lazy_match=X[l.level].max_lazy,l.good_match=X[l.level].good_length,l.nice_match=X[l.level].nice_length,l.max_chain_length=X[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=2,l.match_available=0,l.ins_h=0),R},hh=(h,R,l,j,a,D)=>{if(!h)return f;let U=1;if(R===x&&(R=6),j<0?(U=0,j=-j):j>15&&(U=2,j-=16),a<1||a>9||l!==I||j<8||j>15||R<0||R>9||D<0||D>y)return o(h,f);8===j&&(j=9);const F=new V;return h.state=F,F.strm=h,F.wrap=U,F.gzhead=null,F.w_bits=j,F.w_size=1<<F.w_bits,F.w_mask=F.w_size-1,F.hash_bits=a+7,F.hash_size=1<<F.hash_bits,F.hash_mask=F.hash_size-1,F.hash_shift=~~((F.hash_bits+3-1)/3),F.window=new Uint8Array(2*F.w_size),F.head=new Uint16Array(F.hash_size),F.prev=new Uint16Array(F.w_size),F.lit_bufsize=1<<a+6,F.pending_buf_size=4*F.lit_bufsize,F.pending_buf=new Uint8Array(F.pending_buf_size),F.d_buf=1*F.lit_bufsize,F.l_buf=3*F.lit_bufsize,F.level=R,F.strategy=D,F.method=l,N(h)};h.exports.deflateInit=(h,R)=>hh(h,R,I,15,8,v),h.exports.deflateInit2=hh,h.exports.deflateReset=N,h.exports.deflateResetKeep=B,h.exports.deflateSetHeader=(h,R)=>h&&h.state?2!==h.state.wrap?f:(h.state.gzhead=R,s):f,h.exports.deflate=(h,R)=>{let l,j;if(!h||!h.state||R>Y||R<0)return h?o(h,f):f;const D=h.state;if(!h.output||!h.input&&0!==h.avail_in||D.status===z&&R!==Q)return o(h,0===h.avail_out?E:f);D.strm=h;const w=D.last_flush;if(D.last_flush=R,42===D.status)if(2===D.wrap)h.adler=0,C(D,31),C(D,139),C(D,8),D.gzhead?(C(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),C(D,255&D.gzhead.time),C(D,D.gzhead.time>>8&255),C(D,D.gzhead.time>>16&255),C(D,D.gzhead.time>>24&255),C(D,9===D.level?2:D.strategy>=p||D.level<2?4:0),C(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(C(D,255&D.gzhead.extra.length),C(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(h.adler=mh(h.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(C(D,0),C(D,0),C(D,0),C(D,0),C(D,0),C(D,9===D.level?2:D.strategy>=p||D.level<2?4:0),C(D,3),D.status=P);else{let R=I+(D.w_bits-8<<4)<<8,l=-1;l=D.strategy>=p||D.level<2?0:D.level<6?1:6===D.level?2:3,R|=l<<6,0!==D.strstart&&(R|=32),R+=31-R%31,D.status=P,A(D,R),0!==D.strstart&&(A(D,h.adler>>>16),A(D,65535&h.adler)),h.adler=1}if(69===D.status)if(D.gzhead.extra){for(l=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>l&&(h.adler=mh(h.adler,D.pending_buf,D.pending-l,l)),H(h),l=D.pending,D.pending!==D.pending_buf_size));)C(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>l&&(h.adler=mh(h.adler,D.pending_buf,D.pending-l,l)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(73===D.status)if(D.gzhead.name){l=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>l&&(h.adler=mh(h.adler,D.pending_buf,D.pending-l,l)),H(h),l=D.pending,D.pending===D.pending_buf_size)){j=1;break}j=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,C(D,j)}while(0!==j);D.gzhead.hcrc&&D.pending>l&&(h.adler=mh(h.adler,D.pending_buf,D.pending-l,l)),0===j&&(D.gzindex=0,D.status=91)}else D.status=91;if(91===D.status)if(D.gzhead.comment){l=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>l&&(h.adler=mh(h.adler,D.pending_buf,D.pending-l,l)),H(h),l=D.pending,D.pending===D.pending_buf_size)){j=1;break}j=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,C(D,j)}while(0!==j);D.gzhead.hcrc&&D.pending>l&&(h.adler=mh(h.adler,D.pending_buf,D.pending-l,l)),0===j&&(D.status=r)}else D.status=r;if(D.status===r&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&H(h),D.pending+2<=D.pending_buf_size&&(C(D,255&h.adler),C(D,h.adler>>8&255),h.adler=0,D.status=P)):D.status=P),0!==D.pending){if(H(h),0===h.avail_out)return D.last_flush=-1,s}else if(0===h.avail_in&&K(R)<=K(w)&&R!==Q)return o(h,E);if(D.status===z&&0!==h.avail_in)return o(h,E);if(0!==h.avail_in||0!==D.lookahead||R!==c&&D.status!==z){let l=D.strategy===p?((h,R)=>{let l;for(;;){if(0===h.lookahead&&(Z(h),0===h.lookahead)){if(R===c)return 1;break}if(h.match_length=0,l=U(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++,l&&(k(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,R===Q?(k(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(k(h,!1),0===h.strm.avail_out)?1:2})(D,R):D.strategy===O?((h,R)=>{let l,j,a,D;const F=h.window;for(;;){if(h.lookahead<=L){if(Z(h),h.lookahead<=L&&R===c)return 1;if(0===h.lookahead)break}if(h.match_length=0,h.lookahead>=3&&h.strstart>0&&(a=h.strstart-1,j=F[a],j===F[++a]&&j===F[++a]&&j===F[++a])){D=h.strstart+L;do{}while(j===F[++a]&&j===F[++a]&&j===F[++a]&&j===F[++a]&&j===F[++a]&&j===F[++a]&&j===F[++a]&&j===F[++a]&&a<D);h.match_length=L-(D-a),h.match_length>h.lookahead&&(h.match_length=h.lookahead)}if(h.match_length>=3?(l=U(h,1,h.match_length-3),h.lookahead-=h.match_length,h.strstart+=h.match_length,h.match_length=0):(l=U(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++),l&&(k(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,R===Q?(k(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(k(h,!1),0===h.strm.avail_out)?1:2})(D,R):X[D.level].func(D,R);if(3!==l&&4!==l||(D.status=z),1===l||3===l)return 0===h.avail_out&&(D.last_flush=-1),s;if(2===l&&(R===J?F(D):R!==Y&&(a(D,0,0,!1),R===q&&(W(D.head),0===D.lookahead&&(D.strstart=0,D.block_start=0,D.insert=0))),H(h),0===h.avail_out))return D.last_flush=-1,s}return R!==Q?s:D.wrap<=0?t:(2===D.wrap?(C(D,255&h.adler),C(D,h.adler>>8&255),C(D,h.adler>>16&255),C(D,h.adler>>24&255),C(D,255&h.total_in),C(D,h.total_in>>8&255),C(D,h.total_in>>16&255),C(D,h.total_in>>24&255)):(A(D,h.adler>>>16),A(D,65535&h.adler)),H(h),D.wrap>0&&(D.wrap=-D.wrap),0!==D.pending?s:t)},h.exports.deflateEnd=h=>{if(!h||!h.state)return f;const R=h.state.status;return 42!==R&&69!==R&&73!==R&&91!==R&&R!==r&&R!==P&&R!==z?o(h,f):(h.state=null,R===P?o(h,T):s)},h.exports.deflateSetDictionary=(h,R)=>{let l=R.length;if(!h||!h.state)return f;const j=h.state,a=j.wrap;if(2===a||1===a&&42!==j.status||j.lookahead)return f;if(1===a&&(h.adler=w(h.adler,R,l,0)),j.wrap=0,l>=j.w_size){0===a&&(W(j.head),j.strstart=0,j.block_start=0,j.insert=0);let h=new Uint8Array(j.w_size);h.set(R.subarray(l-j.w_size,l),0),R=h,l=j.w_size}const D=h.avail_in,U=h.next_in,F=h.input;for(h.avail_in=l,h.next_in=0,h.input=R,Z(j);j.lookahead>=3;){let h=j.strstart,R=j.lookahead-2;do{j.ins_h=g(j,j.ins_h,j.window[h+3-1]),j.prev[h&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=h,h++}while(--R);j.strstart=h,j.lookahead=2,Z(j)}return j.strstart+=j.lookahead,j.block_start=j.strstart,j.insert=j.lookahead,j.lookahead=0,j.match_length=j.prev_length=2,j.match_available=0,h.next_in=U,h.input=F,h.avail_in=D,j.wrap=a,s},h.exports.deflateInfo="pako deflate (from Nodeca project)"},14123:h=>{"use strict";h.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14111:h=>{"use strict";h.exports=function(h,R){let l,j,a,D,U,F,w,mh,u,c,J,q,Q,Y,s,t,f,T,E,x,G,p,O,y;const v=h.state;l=h.next_in,O=h.input,j=l+(h.avail_in-5),a=h.next_out,y=h.output,D=a-(R-h.avail_out),U=a+(h.avail_out-257),F=v.dmax,w=v.wsize,mh=v.whave,u=v.wnext,c=v.window,J=v.hold,q=v.bits,Q=v.lencode,Y=v.distcode,s=(1<<v.lenbits)-1,t=(1<<v.distbits)-1;h:do{q<15&&(J+=O[l++]<<q,q+=8,J+=O[l++]<<q,q+=8),f=Q[J&s];R:for(;;){if(T=f>>>24,J>>>=T,q-=T,T=f>>>16&255,0===T)y[a++]=65535&f;else{if(!(16&T)){if(0===(64&T)){f=Q[(65535&f)+(J&(1<<T)-1)];continue R}if(32&T){v.mode=12;break h}h.JR="invalid literal/length code",v.mode=30;break h}E=65535&f,T&=15,T&&(q<T&&(J+=O[l++]<<q,q+=8),E+=J&(1<<T)-1,J>>>=T,q-=T),q<15&&(J+=O[l++]<<q,q+=8,J+=O[l++]<<q,q+=8),f=Y[J&t];l:for(;;){if(T=f>>>24,J>>>=T,q-=T,T=f>>>16&255,!(16&T)){if(0===(64&T)){f=Y[(65535&f)+(J&(1<<T)-1)];continue l}h.JR="invalid distance code",v.mode=30;break h}if(x=65535&f,T&=15,q<T&&(J+=O[l++]<<q,q+=8,q<T&&(J+=O[l++]<<q,q+=8)),x+=J&(1<<T)-1,x>F){h.JR="invalid distance too far back",v.mode=30;break h}if(J>>>=T,q-=T,T=a-D,x>T){if(T=x-T,T>mh&&v.sane){h.JR="invalid distance too far back",v.mode=30;break h}if(G=0,p=c,0===u){if(G+=w-T,T<E){E-=T;do{y[a++]=c[G++]}while(--T);G=a-x,p=y}}else if(u<T){if(G+=w+u-T,T-=u,T<E){E-=T;do{y[a++]=c[G++]}while(--T);if(G=0,u<E){T=u,E-=T;do{y[a++]=c[G++]}while(--T);G=a-x,p=y}}}else if(G+=u-T,T<E){E-=T;do{y[a++]=c[G++]}while(--T);G=a-x,p=y}for(;E>2;)y[a++]=p[G++],y[a++]=p[G++],y[a++]=p[G++],E-=3;E&&(y[a++]=p[G++],E>1&&(y[a++]=p[G++]))}else{G=a-x;do{y[a++]=y[G++],y[a++]=y[G++],y[a++]=y[G++],E-=3}while(E>2);E&&(y[a++]=y[G++],E>1&&(y[a++]=y[G++]))}break}}break}}while(l<j&&a<U);E=q>>3,l-=E,q-=E<<3,J&=(1<<q)-1,h.next_in=l,h.next_out=a,h.avail_in=l<j?j-l+5:5-(l-j),h.avail_out=a<U?U-a+257:257-(a-U),v.hold=J,v.bits=q}},14105:(h,R,l)=>{"use strict";const j=l(14069),a=l(14073),D=l(14111),U=l(14114),{Z_FINISH:F,Z_BLOCK:w,Z_TREES:mh,Z_OK:u,Z_STREAM_END:c,Z_NEED_DICT:J,Z_STREAM_ERROR:q,Z_DATA_ERROR:Q,Z_MEM_ERROR:Y,Z_BUF_ERROR:s,Z_DEFLATED:t}=l(14081),f=12,T=30,E=h=>(h>>>24&255)+(h>>>8&65280)+((65280&h)<<8)+((255&h)<<24);function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const G=h=>{if(!h||!h.state)return q;const R=h.state;return h.total_in=h.total_out=R.total=0,h.JR="",R.wrap&&(h.adler=1&R.wrap),R.mode=1,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new Int32Array(852),R.distcode=R.distdyn=new Int32Array(592),R.sane=1,R.back=-1,u},p=h=>{if(!h||!h.state)return q;const R=h.state;return R.wsize=0,R.whave=0,R.wnext=0,G(h)},O=(h,R)=>{let l;if(!h||!h.state)return q;const j=h.state;return R<0?(l=0,R=-R):(l=1+(R>>4),R<48&&(R&=15)),R&&(R<8||R>15)?q:(null!==j.window&&j.wbits!==R&&(j.window=null),j.wrap=l,j.wbits=R,p(h))},y=(h,R)=>{if(!h)return q;const l=new x;h.state=l,l.window=null;const j=O(h,R);return j!==u&&(h.state=null),j};let v,b,I=!0;const L=h=>{if(I){v=new Int32Array(512),b=new Int32Array(32);let R=0;for(;R<144;)h.lens[R++]=8;for(;R<256;)h.lens[R++]=9;for(;R<280;)h.lens[R++]=7;for(;R<288;)h.lens[R++]=8;for(U(1,h.lens,0,288,v,0,h.work,{bits:9}),R=0;R<32;)h.lens[R++]=5;U(2,h.lens,0,32,b,0,h.work,{bits:5}),I=!1}h.lencode=v,h.lenbits=9,h.distcode=b,h.distbits=5},n=(h,R,l,j)=>{let a;const D=h.state;return null===D.window&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new Uint8Array(D.wsize)),j>=D.wsize?(D.window.set(R.subarray(l-D.wsize,l),0),D.wnext=0,D.whave=D.wsize):(a=D.wsize-D.wnext,a>j&&(a=j),D.window.set(R.subarray(l-j,l-j+a),D.wnext),(j-=a)?(D.window.set(R.subarray(l-j,l),0),D.wnext=j,D.whave=D.wsize):(D.wnext+=a,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=a))),0};h.exports.inflateReset=p,h.exports.inflateReset2=O,h.exports.inflateResetKeep=G,h.exports.inflateInit=h=>y(h,15),h.exports.inflateInit2=y,h.exports.inflate=(h,R)=>{let l,x,G,p,O,y,v,b,I,r,P,z,o,K,W,g,H,k,C,A,e,S,Z=0;const M=new Uint8Array(4);let i,d;const X=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!h||!h.state||!h.output||!h.input&&0!==h.avail_in)return q;l=h.state,l.mode===f&&(l.mode=13),O=h.next_out,G=h.output,v=h.avail_out,p=h.next_in,x=h.input,y=h.avail_in,b=l.hold,I=l.bits,r=y,P=v,S=u;h:for(;;)switch(l.mode){case 1:if(0===l.wrap){l.mode=13;break}for(;I<16;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if(2&l.wrap&&35615===b){l.check=0,M[0]=255&b,M[1]=b>>>8&255,l.check=a(l.check,M,2,0),b=0,I=0,l.mode=2;break}if(l.flags=0,l.head&&(l.head.done=!1),!(1&l.wrap)||(((255&b)<<8)+(b>>8))%31){h.JR="incorrect header check",l.mode=T;break}if((15&b)!==t){h.JR="unknown compression method",l.mode=T;break}if(b>>>=4,I-=4,e=8+(15&b),0===l.wbits)l.wbits=e;else if(e>l.wbits){h.JR="invalid window size",l.mode=T;break}l.dmax=1<<l.wbits,h.adler=l.check=1,l.mode=512&b?10:f,b=0,I=0;break;case 2:for(;I<16;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if(l.flags=b,(255&l.flags)!==t){h.JR="unknown compression method",l.mode=T;break}if(57344&l.flags){h.JR="unknown header flags set",l.mode=T;break}l.head&&(l.head.text=b>>8&1),512&l.flags&&(M[0]=255&b,M[1]=b>>>8&255,l.check=a(l.check,M,2,0)),b=0,I=0,l.mode=3;case 3:for(;I<32;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}l.head&&(l.head.time=b),512&l.flags&&(M[0]=255&b,M[1]=b>>>8&255,M[2]=b>>>16&255,M[3]=b>>>24&255,l.check=a(l.check,M,4,0)),b=0,I=0,l.mode=4;case 4:for(;I<16;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}l.head&&(l.head.xflags=255&b,l.head.os=b>>8),512&l.flags&&(M[0]=255&b,M[1]=b>>>8&255,l.check=a(l.check,M,2,0)),b=0,I=0,l.mode=5;case 5:if(1024&l.flags){for(;I<16;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}l.length=b,l.head&&(l.head.extra_len=b),512&l.flags&&(M[0]=255&b,M[1]=b>>>8&255,l.check=a(l.check,M,2,0)),b=0,I=0}else l.head&&(l.head.extra=null);l.mode=6;case 6:if(1024&l.flags&&(z=l.length,z>y&&(z=y),z&&(l.head&&(e=l.head.extra_len-l.length,l.head.extra||(l.head.extra=new Uint8Array(l.head.extra_len)),l.head.extra.set(x.subarray(p,p+z),e)),512&l.flags&&(l.check=a(l.check,x,z,p)),y-=z,p+=z,l.length-=z),l.length))break h;l.length=0,l.mode=7;case 7:if(2048&l.flags){if(0===y)break h;z=0;do{e=x[p+z++],l.head&&e&&l.length<65536&&(l.head.name+=String.fromCharCode(e))}while(e&&z<y);if(512&l.flags&&(l.check=a(l.check,x,z,p)),y-=z,p+=z,e)break h}else l.head&&(l.head.name=null);l.length=0,l.mode=8;case 8:if(4096&l.flags){if(0===y)break h;z=0;do{e=x[p+z++],l.head&&e&&l.length<65536&&(l.head.comment+=String.fromCharCode(e))}while(e&&z<y);if(512&l.flags&&(l.check=a(l.check,x,z,p)),y-=z,p+=z,e)break h}else l.head&&(l.head.comment=null);l.mode=9;case 9:if(512&l.flags){for(;I<16;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if(b!==(65535&l.check)){h.JR="header crc mismatch",l.mode=T;break}b=0,I=0}l.head&&(l.head.hcrc=l.flags>>9&1,l.head.done=!0),h.adler=l.check=0,l.mode=f;break;case 10:for(;I<32;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}h.adler=l.check=E(b),b=0,I=0,l.mode=11;case 11:if(0===l.havedict)return h.next_out=O,h.avail_out=v,h.next_in=p,h.avail_in=y,l.hold=b,l.bits=I,J;h.adler=l.check=1,l.mode=f;case f:if(R===w||R===mh)break h;case 13:if(l.last){b>>>=7&I,I-=7&I,l.mode=27;break}for(;I<3;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}switch(l.last=1&b,b>>>=1,I-=1,3&b){case 0:l.mode=14;break;case 1:if(L(l),l.mode=20,R===mh){b>>>=2,I-=2;break h}break;case 2:l.mode=17;break;case 3:h.JR="invalid block type",l.mode=T}b>>>=2,I-=2;break;case 14:for(b>>>=7&I,I-=7&I;I<32;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if((65535&b)!==(b>>>16^65535)){h.JR="invalid stored block lengths",l.mode=T;break}if(l.length=65535&b,b=0,I=0,l.mode=15,R===mh)break h;case 15:l.mode=16;case 16:if(z=l.length,z){if(z>y&&(z=y),z>v&&(z=v),0===z)break h;G.set(x.subarray(p,p+z),O),y-=z,p+=z,v-=z,O+=z,l.length-=z;break}l.mode=f;break;case 17:for(;I<14;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if(l.nlen=257+(31&b),b>>>=5,I-=5,l.ndist=1+(31&b),b>>>=5,I-=5,l.ncode=4+(15&b),b>>>=4,I-=4,l.nlen>286||l.ndist>30){h.JR="too many length or distance symbols",l.mode=T;break}l.have=0,l.mode=18;case 18:for(;l.have<l.ncode;){for(;I<3;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}l.lens[X[l.have++]]=7&b,b>>>=3,I-=3}for(;l.have<19;)l.lens[X[l.have++]]=0;if(l.lencode=l.lendyn,l.lenbits=7,i={bits:l.lenbits},S=U(0,l.lens,0,19,l.lencode,0,l.work,i),l.lenbits=i.bits,S){h.JR="invalid code lengths set",l.mode=T;break}l.have=0,l.mode=19;case 19:for(;l.have<l.nlen+l.ndist;){for(;Z=l.lencode[b&(1<<l.lenbits)-1],W=Z>>>24,g=Z>>>16&255,H=65535&Z,!(W<=I);){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if(H<16)b>>>=W,I-=W,l.lens[l.have++]=H;else{if(16===H){for(d=W+2;I<d;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if(b>>>=W,I-=W,0===l.have){h.JR="invalid bit length repeat",l.mode=T;break}e=l.lens[l.have-1],z=3+(3&b),b>>>=2,I-=2}else if(17===H){for(d=W+3;I<d;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}b>>>=W,I-=W,e=0,z=3+(7&b),b>>>=3,I-=3}else{for(d=W+7;I<d;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}b>>>=W,I-=W,e=0,z=11+(127&b),b>>>=7,I-=7}if(l.have+z>l.nlen+l.ndist){h.JR="invalid bit length repeat",l.mode=T;break}for(;z--;)l.lens[l.have++]=e}}if(l.mode===T)break;if(0===l.lens[256]){h.JR="invalid code -- missing end-of-block",l.mode=T;break}if(l.lenbits=9,i={bits:l.lenbits},S=U(1,l.lens,0,l.nlen,l.lencode,0,l.work,i),l.lenbits=i.bits,S){h.JR="invalid literal/lengths set",l.mode=T;break}if(l.distbits=6,l.distcode=l.distdyn,i={bits:l.distbits},S=U(2,l.lens,l.nlen,l.ndist,l.distcode,0,l.work,i),l.distbits=i.bits,S){h.JR="invalid distances set",l.mode=T;break}if(l.mode=20,R===mh)break h;case 20:l.mode=21;case 21:if(y>=6&&v>=258){h.next_out=O,h.avail_out=v,h.next_in=p,h.avail_in=y,l.hold=b,l.bits=I,D(h,P),O=h.next_out,G=h.output,v=h.avail_out,p=h.next_in,x=h.input,y=h.avail_in,b=l.hold,I=l.bits,l.mode===f&&(l.back=-1);break}for(l.back=0;Z=l.lencode[b&(1<<l.lenbits)-1],W=Z>>>24,g=Z>>>16&255,H=65535&Z,!(W<=I);){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if(g&&0===(240&g)){for(k=W,C=g,A=H;Z=l.lencode[A+((b&(1<<k+C)-1)>>k)],W=Z>>>24,g=Z>>>16&255,H=65535&Z,!(k+W<=I);){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}b>>>=k,I-=k,l.back+=k}if(b>>>=W,I-=W,l.back+=W,l.length=H,0===g){l.mode=26;break}if(32&g){l.back=-1,l.mode=f;break}if(64&g){h.JR="invalid literal/length code",l.mode=T;break}l.extra=15&g,l.mode=22;case 22:if(l.extra){for(d=l.extra;I<d;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}l.length+=b&(1<<l.extra)-1,b>>>=l.extra,I-=l.extra,l.back+=l.extra}l.was=l.length,l.mode=23;case 23:for(;Z=l.distcode[b&(1<<l.distbits)-1],W=Z>>>24,g=Z>>>16&255,H=65535&Z,!(W<=I);){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if(0===(240&g)){for(k=W,C=g,A=H;Z=l.distcode[A+((b&(1<<k+C)-1)>>k)],W=Z>>>24,g=Z>>>16&255,H=65535&Z,!(k+W<=I);){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}b>>>=k,I-=k,l.back+=k}if(b>>>=W,I-=W,l.back+=W,64&g){h.JR="invalid distance code",l.mode=T;break}l.offset=H,l.extra=15&g,l.mode=24;case 24:if(l.extra){for(d=l.extra;I<d;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}l.offset+=b&(1<<l.extra)-1,b>>>=l.extra,I-=l.extra,l.back+=l.extra}if(l.offset>l.dmax){h.JR="invalid distance too far back",l.mode=T;break}l.mode=25;case 25:if(0===v)break h;if(z=P-v,l.offset>z){if(z=l.offset-z,z>l.whave&&l.sane){h.JR="invalid distance too far back",l.mode=T;break}z>l.wnext?(z-=l.wnext,o=l.wsize-z):o=l.wnext-z,z>l.length&&(z=l.length),K=l.window}else K=G,o=O-l.offset,z=l.length;z>v&&(z=v),v-=z,l.length-=z;do{G[O++]=K[o++]}while(--z);0===l.length&&(l.mode=21);break;case 26:if(0===v)break h;G[O++]=l.length,v--,l.mode=21;break;case 27:if(l.wrap){for(;I<32;){if(0===y)break h;y--,b|=x[p++]<<I,I+=8}if(P-=v,h.total_out+=P,l.total+=P,P&&(h.adler=l.check=l.flags?a(l.check,G,P,O-P):j(l.check,G,P,O-P)),P=v,(l.flags?b:E(b))!==l.check){h.JR="incorrect data check",l.mode=T;break}b=0,I=0}l.mode=28;case 28:if(l.wrap&&l.flags){for(;I<32;){if(0===y)break h;y--,b+=x[p++]<<I,I+=8}if(b!==(4294967295&l.total)){h.JR="incorrect length check",l.mode=T;break}b=0,I=0}l.mode=29;case 29:S=c;break h;case T:S=Q;break h;case 31:return Y;default:return q}return h.next_out=O,h.avail_out=v,h.next_in=p,h.avail_in=y,l.hold=b,l.bits=I,(l.wsize||P!==h.avail_out&&l.mode<T&&(l.mode<27||R!==F))&&n(h,h.output,h.next_out,P-h.avail_out)?(l.mode=31,Y):(r-=h.avail_in,P-=h.avail_out,h.total_in+=r,h.total_out+=P,l.total+=P,l.wrap&&P&&(h.adler=l.check=l.flags?a(l.check,G,P,h.next_out-P):j(l.check,G,P,h.next_out-P)),h.data_type=l.bits+(l.last?64:0)+(l.mode===f?128:0)+(20===l.mode||15===l.mode?256:0),(0===r&&0===P||R===F)&&S===u&&(S=s),S)},h.exports.inflateEnd=h=>{if(!h||!h.state)return q;let R=h.state;return R.window&&(R.window=null),h.state=null,u},h.exports.inflateGetHeader=(h,R)=>{if(!h||!h.state)return q;const l=h.state;return 0===(2&l.wrap)?q:(l.head=R,R.done=!1,u)},h.exports.inflateSetDictionary=(h,R)=>{const l=R.length;let a,D,U;return h&&h.state?(a=h.state,0!==a.wrap&&11!==a.mode?q:11===a.mode&&(D=1,D=j(D,R,l,0),D!==a.check)?Q:(U=n(h,R,l,l),U?(a.mode=31,Y):(a.havedict=1,u))):q},h.exports.inflateInfo="pako inflate (from Nodeca project)"},14114:h=>{"use strict";const R=15,l=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),j=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),a=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),D=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);h.exports=(h,U,F,w,mh,u,c,J)=>{const q=J.bits;let Q,Y,s,t,f,T,E=0,x=0,G=0,p=0,O=0,y=0,v=0,b=0,I=0,L=0,n=null,r=0;const P=new Uint16Array(16),z=new Uint16Array(16);let o,K,W,g=null,H=0;for(E=0;E<=R;E++)P[E]=0;for(x=0;x<w;x++)P[U[F+x]]++;for(O=q,p=R;p>=1&&0===P[p];p--);if(O>p&&(O=p),0===p)return mh[u++]=20971520,mh[u++]=20971520,J.bits=1,0;for(G=1;G<p&&0===P[G];G++);for(O<G&&(O=G),b=1,E=1;E<=R;E++)if(b<<=1,b-=P[E],b<0)return-1;if(b>0&&(0===h||1!==p))return-1;for(z[1]=0,E=1;E<R;E++)z[E+1]=z[E]+P[E];for(x=0;x<w;x++)0!==U[F+x]&&(c[z[U[F+x]]++]=x);if(0===h?(n=g=c,T=19):1===h?(n=l,r-=257,g=j,H-=257,T=256):(n=a,g=D,T=-1),L=0,x=0,E=G,f=u,y=O,v=0,s=-1,I=1<<O,t=I-1,1===h&&I>852||2===h&&I>592)return 1;for(;;){o=E-v,c[x]<T?(K=0,W=c[x]):c[x]>T?(K=g[H+c[x]],W=n[r+c[x]]):(K=96,W=0),Q=1<<E-v,Y=1<<y,G=Y;do{Y-=Q,mh[f+(L>>v)+Y]=o<<24|K<<16|W}while(0!==Y);for(Q=1<<E-1;L&Q;)Q>>=1;if(0!==Q?(L&=Q-1,L+=Q):L=0,x++,0===--P[E]){if(E===p)break;E=U[F+c[x]]}if(E>O&&(L&t)!==s){for(0===v&&(v=O),f+=G,y=E-v,b=1<<y;y+v<p&&(b-=P[y+v],!(b<=0));)y++,b<<=1;if(I+=1<<y,1===h&&I>852||2===h&&I>592)return 1;s=L&t,mh[s]=O<<24|y<<16|f-u}}return 0!==L&&(mh[f+L]=E-v<<24|64<<16),J.bits=O,0}},14075:h=>{"use strict";h.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14060:h=>{"use strict";function R(h){let R=h.length;for(;--R>=0;)h[R]=0}const l=256,j=286,a=30,D=15,U=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),F=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),w=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),mh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=new Array(576);R(u);const c=new Array(60);R(c);const J=new Array(512);R(J);const q=new Array(256);R(q);const Q=new Array(29);R(Q);const Y=new Array(a);function s(h,R,l,j,a){this.static_tree=h,this.extra_bits=R,this.extra_base=l,this.elems=j,this.max_length=a,this.has_stree=h&&h.length}let t,f,T;function E(h,R){this.dyn_tree=h,this.max_code=0,this.stat_desc=R}R(Y);const x=h=>h<256?J[h]:J[256+(h>>>7)],G=(h,R)=>{h.pending_buf[h.pending++]=255&R,h.pending_buf[h.pending++]=R>>>8&255},p=(h,R,l)=>{h.bi_valid>16-l?(h.bi_buf|=R<<h.bi_valid&65535,G(h,h.bi_buf),h.bi_buf=R>>16-h.bi_valid,h.bi_valid+=l-16):(h.bi_buf|=R<<h.bi_valid&65535,h.bi_valid+=l)},O=(h,R,l)=>{p(h,l[2*R],l[2*R+1])},y=(h,R)=>{let l=0;do{l|=1&h,h>>>=1,l<<=1}while(--R>0);return l>>>1},v=(h,R,l)=>{const j=new Array(16);let a,U,F=0;for(a=1;a<=D;a++)j[a]=F=F+l[a-1]<<1;for(U=0;U<=R;U++){let R=h[2*U+1];0!==R&&(h[2*U]=y(j[R]++,R))}},b=h=>{let R;for(R=0;R<j;R++)h.dyn_ltree[2*R]=0;for(R=0;R<a;R++)h.dyn_dtree[2*R]=0;for(R=0;R<19;R++)h.bl_tree[2*R]=0;h.dyn_ltree[512]=1,h.opt_len=h.static_len=0,h.last_lit=h.matches=0},I=h=>{h.bi_valid>8?G(h,h.bi_buf):h.bi_valid>0&&(h.pending_buf[h.pending++]=h.bi_buf),h.bi_buf=0,h.bi_valid=0},L=(h,R,l,j)=>{const a=2*R,D=2*l;return h[a]<h[D]||h[a]===h[D]&&j[R]<=j[l]},n=(h,R,l)=>{const j=h.heap[l];let a=l<<1;for(;a<=h.heap_len&&(a<h.heap_len&&L(R,h.heap[a+1],h.heap[a],h.depth)&&a++,!L(R,j,h.heap[a],h.depth));)h.heap[l]=h.heap[a],l=a,a<<=1;h.heap[l]=j},r=(h,R,j)=>{let a,D,w,mh,u=0;if(0!==h.last_lit)do{a=h.pending_buf[h.d_buf+2*u]<<8|h.pending_buf[h.d_buf+2*u+1],D=h.pending_buf[h.l_buf+u],u++,0===a?O(h,D,R):(w=q[D],O(h,w+l+1,R),mh=U[w],0!==mh&&(D-=Q[w],p(h,D,mh)),a--,w=x(a),O(h,w,j),mh=F[w],0!==mh&&(a-=Y[w],p(h,a,mh)))}while(u<h.last_lit);O(h,256,R)},P=(h,R)=>{const l=R.dyn_tree,j=R.stat_desc.static_tree,a=R.stat_desc.has_stree,U=R.stat_desc.elems;let F,w,mh,u=-1;for(h.heap_len=0,h.heap_max=573,F=0;F<U;F++)0!==l[2*F]?(h.heap[++h.heap_len]=u=F,h.depth[F]=0):l[2*F+1]=0;for(;h.heap_len<2;)mh=h.heap[++h.heap_len]=u<2?++u:0,l[2*mh]=1,h.depth[mh]=0,h.opt_len--,a&&(h.static_len-=j[2*mh+1]);for(R.max_code=u,F=h.heap_len>>1;F>=1;F--)n(h,l,F);mh=U;do{F=h.heap[1],h.heap[1]=h.heap[h.heap_len--],n(h,l,1),w=h.heap[1],h.heap[--h.heap_max]=F,h.heap[--h.heap_max]=w,l[2*mh]=l[2*F]+l[2*w],h.depth[mh]=(h.depth[F]>=h.depth[w]?h.depth[F]:h.depth[w])+1,l[2*F+1]=l[2*w+1]=mh,h.heap[1]=mh++,n(h,l,1)}while(h.heap_len>=2);h.heap[--h.heap_max]=h.heap[1],((h,R)=>{const l=R.dyn_tree,j=R.max_code,a=R.stat_desc.static_tree,U=R.stat_desc.has_stree,F=R.stat_desc.extra_bits,w=R.stat_desc.extra_base,mh=R.stat_desc.max_length;let u,c,J,q,Q,Y,s=0;for(q=0;q<=D;q++)h.bl_count[q]=0;for(l[2*h.heap[h.heap_max]+1]=0,u=h.heap_max+1;u<573;u++)c=h.heap[u],q=l[2*l[2*c+1]+1]+1,q>mh&&(q=mh,s++),l[2*c+1]=q,c>j||(h.bl_count[q]++,Q=0,c>=w&&(Q=F[c-w]),Y=l[2*c],h.opt_len+=Y*(q+Q),U&&(h.static_len+=Y*(a[2*c+1]+Q)));if(0!==s){do{for(q=mh-1;0===h.bl_count[q];)q--;h.bl_count[q]--,h.bl_count[q+1]+=2,h.bl_count[mh]--,s-=2}while(s>0);for(q=mh;0!==q;q--)for(c=h.bl_count[q];0!==c;)J=h.heap[--u],J>j||(l[2*J+1]!==q&&(h.opt_len+=(q-l[2*J+1])*l[2*J],l[2*J+1]=q),c--)}})(h,R),v(l,u,h.bl_count)},z=(h,R,l)=>{let j,a,D=-1,U=R[1],F=0,w=7,mh=4;for(0===U&&(w=138,mh=3),R[2*(l+1)+1]=65535,j=0;j<=l;j++)a=U,U=R[2*(j+1)+1],++F<w&&a===U||(F<mh?h.bl_tree[2*a]+=F:0!==a?(a!==D&&h.bl_tree[2*a]++,h.bl_tree[32]++):F<=10?h.bl_tree[34]++:h.bl_tree[36]++,F=0,D=a,0===U?(w=138,mh=3):a===U?(w=6,mh=3):(w=7,mh=4))},o=(h,R,l)=>{let j,a,D=-1,U=R[1],F=0,w=7,mh=4;for(0===U&&(w=138,mh=3),j=0;j<=l;j++)if(a=U,U=R[2*(j+1)+1],!(++F<w&&a===U)){if(F<mh)do{O(h,a,h.bl_tree)}while(0!==--F);else 0!==a?(a!==D&&(O(h,a,h.bl_tree),F--),O(h,16,h.bl_tree),p(h,F-3,2)):F<=10?(O(h,17,h.bl_tree),p(h,F-3,3)):(O(h,18,h.bl_tree),p(h,F-11,7));F=0,D=a,0===U?(w=138,mh=3):a===U?(w=6,mh=3):(w=7,mh=4)}};let K=!1;const W=(h,R,l,j)=>{p(h,0+(j?1:0),3),((h,R,l,j)=>{I(h),j&&(G(h,l),G(h,~l)),h.pending_buf.set(h.window.subarray(R,R+l),h.pending),h.pending+=l})(h,R,l,!0)};h.exports._tr_init=h=>{K||((()=>{let h,R,l,mh,E;const x=new Array(16);for(l=0,mh=0;mh<28;mh++)for(Q[mh]=l,h=0;h<1<<U[mh];h++)q[l++]=mh;for(q[l-1]=mh,E=0,mh=0;mh<16;mh++)for(Y[mh]=E,h=0;h<1<<F[mh];h++)J[E++]=mh;for(E>>=7;mh<a;mh++)for(Y[mh]=E<<7,h=0;h<1<<F[mh]-7;h++)J[256+E++]=mh;for(R=0;R<=D;R++)x[R]=0;for(h=0;h<=143;)u[2*h+1]=8,h++,x[8]++;for(;h<=255;)u[2*h+1]=9,h++,x[9]++;for(;h<=279;)u[2*h+1]=7,h++,x[7]++;for(;h<=287;)u[2*h+1]=8,h++,x[8]++;for(v(u,287,x),h=0;h<a;h++)c[2*h+1]=5,c[2*h]=y(h,5);t=new s(u,U,257,j,D),f=new s(c,F,0,a,D),T=new s(new Array(0),w,0,19,7)})(),K=!0),h.l_desc=new E(h.dyn_ltree,t),h.d_desc=new E(h.dyn_dtree,f),h.bl_desc=new E(h.bl_tree,T),h.bi_buf=0,h.bi_valid=0,b(h)},h.exports._tr_stored_block=W,h.exports._tr_flush_block=(h,R,j,a)=>{let D,U,F=0;h.level>0?(2===h.strm.data_type&&(h.strm.data_type=(h=>{let R,j=4093624447;for(R=0;R<=31;R++,j>>>=1)if(1&j&&0!==h.dyn_ltree[2*R])return 0;if(0!==h.dyn_ltree[18]||0!==h.dyn_ltree[20]||0!==h.dyn_ltree[26])return 1;for(R=32;R<l;R++)if(0!==h.dyn_ltree[2*R])return 1;return 0})(h)),P(h,h.l_desc),P(h,h.d_desc),F=(h=>{let R;for(z(h,h.dyn_ltree,h.l_desc.max_code),z(h,h.dyn_dtree,h.d_desc.max_code),P(h,h.bl_desc),R=18;R>=3&&0===h.bl_tree[2*mh[R]+1];R--);return h.opt_len+=3*(R+1)+5+5+4,R})(h),D=h.opt_len+3+7>>>3,U=h.static_len+3+7>>>3,U<=D&&(D=U)):D=U=j+5,j+4<=D&&-1!==R?W(h,R,j,a):4===h.strategy||U===D?(p(h,2+(a?1:0),3),r(h,u,c)):(p(h,4+(a?1:0),3),((h,R,l,j)=>{let a;for(p(h,R-257,5),p(h,l-1,5),p(h,j-4,4),a=0;a<j;a++)p(h,h.bl_tree[2*mh[a]+1],3);o(h,h.dyn_ltree,R-1),o(h,h.dyn_dtree,l-1)})(h,h.l_desc.max_code+1,h.d_desc.max_code+1,F+1),r(h,h.dyn_ltree,h.dyn_dtree)),b(h),a&&I(h)},h.exports._tr_tally=(h,R,j)=>(h.pending_buf[h.d_buf+2*h.last_lit]=R>>>8&255,h.pending_buf[h.d_buf+2*h.last_lit+1]=255&R,h.pending_buf[h.l_buf+h.last_lit]=255&j,h.last_lit++,0===R?h.dyn_ltree[2*j]++:(h.matches++,R--,h.dyn_ltree[2*(q[j]+l+1)]++,h.dyn_dtree[2*x(R)]++),h.last_lit===h.lit_bufsize-1),h.exports._tr_align=h=>{p(h,2,3),O(h,256,u),(h=>{16===h.bi_valid?(G(h,h.bi_buf),h.bi_buf=0,h.bi_valid=0):h.bi_valid>=8&&(h.pending_buf[h.pending++]=255&h.bi_buf,h.bi_buf>>=8,h.bi_valid-=8)})(h)}},14099:h=>{"use strict";h.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.JR="",this.state=null,this.data_type=2,this.adler=0}},13689:h=>{function R(h,R,l){for(var j=h.length,a=-1/0,D=1/0,U=0;U<j;U++){var F=(l[0][U]-h[U])/R[U],w=(l[1][U]-h[U])/R[U];if(F>w){var mh=F;F=w,w=mh}if(w<a||F>D)return 1/0;F>a&&(a=F),w<D&&(D=w)}return a>D?1/0:a}h.exports=function(h,l,j,a){var D=R(l,j,a);if(D===1/0)h=null;else{h=h||[];for(var U=0;U<l.length;U++)h[U]=l[U]+j[U]*D}return h},h.exports.distance=R},15094:(h,R,l)=>{"use strict";l.d(R,{e:()=>U});var j=l(37);const a=j.useLayoutEffect;const D=function(h){var R=(0,j.useRef)(h);return a((function(){R.current=h})),R};var U=function(h){var R=D(h);(0,j.ml)((function(){var h=function(h){var l;if(null!=R.current&&(l=R.current(h)),h.defaultPrevented&&(h.returnValue=""),"string"===typeof l)return h.returnValue=l,l};return window.addEventListener("beforeunload",h),function(){window.removeEventListener("beforeunload",h)}}),[])}},15043:(h,R,l)=>{"use strict";var j=l(15052),a=Array.prototype.concat,D=Array.prototype.slice,U=h.exports=function(h){for(var R=[],l=0,U=h.length;l<U;l++){var F=h[l];j(F)?R=a.call(R,D.call(F)):R.push(F)}return R};U.wrap=function(h){return function(){return h(U(arguments))}}},15052:h=>{h.exports=function(h){return!(!h||"string"===typeof h)&&(h instanceof Array||Array.isArray(h)||h.length>=0&&(h.splice instanceof Function||Object.getOwnPropertyDescriptor(h,h.length-1)&&"String"!==h.constructor.name))}},13998:(h,R,l)=>{var j=l(14006);function a(h){for(var R,l,a=0,D=h.length,U=0;U<h.length;){for(R=h[U],l=0;U<D&&h[U]===R;)++U,++l;a+=j.log2(l)/7|0,a+=j.log2(R>>>0)/7|0,a+=2}return a}R.size=a,R.encode=function(h,R){R||(R=new Uint8Array(a(h)));for(var l,j,D=0,U=R.length,F=0;F<h.length;){for(l=h[F],j=0;F<h.length&&h[F]===l;)++F,++j;for(;D<U&&j>=128;)R[D++]=128+(127&j),j>>>=7;if(D>=U)throw new Error("RLE buffer overflow");for(R[D++]=j,l>>>=0;D<U&&l>=128;)R[D++]=128+(127&l),l>>>=7;if(D>=U)throw new Error("RLE buffer overflow");R[D++]=l}return R},R.decode=function(h,R){for(var l,j,a,D,U=R.length,F=h.length,w=0,mh=0;mh<F;){for(l=0,j=0;mh<F&&h[mh]>=128;)l+=(127&h[mh++])<<j,j+=7;if(l+=h[mh++]<<j,mh>=F)throw new Error("RLE buffer underrun");if(w+l>U)throw new Error("Chunk buffer overflow");for(a=0,j=0;mh<F&&h[mh]>=128;)a+=(127&h[mh++])<<j,j+=7;if(mh>=F)throw new Error("RLE buffer underrun");for(a+=h[mh++]<<j,D=0;D<l;++D)R[w++]=a}return R}},14006:(h,R)=>{"use strict";function l(h){var R=32;return(h&=-h)&&R--,65535&h&&(R-=16),16711935&h&&(R-=8),252645135&h&&(R-=4),858993459&h&&(R-=2),1431655765&h&&(R-=1),R}R.INT_BITS=32,R.INT_MAX=2147483647,R.INT_MIN=-1<<31,R.sign=function(h){return(h>0)-(h<0)},R.abs=function(h){var R=h>>31;return(h^R)-R},R.min=function(h,R){return R^(h^R)&-(h<R)},R.max=function(h,R){return h^(h^R)&-(h<R)},R.isPow2=function(h){return!(h&h-1)&&!!h},R.log2=function(h){var R,l;return R=(h>65535)<<4,R|=l=((h>>>=R)>255)<<3,R|=l=((h>>>=l)>15)<<2,(R|=l=((h>>>=l)>3)<<1)|(h>>>=l)>>1},R.log10=function(h){return h>=1e9?9:h>=1e8?8:h>=1e7?7:h>=1e6?6:h>=1e5?5:h>=1e4?4:h>=1e3?3:h>=100?2:h>=10?1:0},R.popCount=function(h){return 16843009*((h=(858993459&(h-=h>>>1&1431655765))+(h>>>2&858993459))+(h>>>4)&252645135)>>>24},R.countTrailingZeros=l,R.nextPow2=function(h){return h+=0===h,--h,h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)+1},R.prevPow2=function(h){return h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)-(h>>>1)},R.parity=function(h){return h^=h>>>16,h^=h>>>8,h^=h>>>4,27030>>>(h&=15)&1};var j=new Array(256);!function(h){for(var R=0;R<256;++R){var l=R,j=R,a=7;for(l>>>=1;l;l>>>=1)j<<=1,j|=1&l,--a;h[R]=j<<a&255}}(j),R.reverse=function(h){return j[255&h]<<24|j[h>>>8&255]<<16|j[h>>>16&255]<<8|j[h>>>24&255]},R.interleave2=function(h,R){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))|(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))<<1},R.deinterleave2=function(h,R){return(h=65535&((h=16711935&((h=252645135&((h=858993459&((h=h>>>R&1431655765)|h>>>1))|h>>>2))|h>>>4))|h>>>16))<<16>>16},R.interleave3=function(h,R,l){return h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2),(h|=(R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2))<<1)|(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<2},R.deinterleave3=function(h,R){return(h=1023&((h=4278190335&((h=251719695&((h=3272356035&((h=h>>>R&1227133513)|h>>>2))|h>>>4))|h>>>8))|h>>>16))<<22>>22},R.nextCombination=function(h){var R=h|h-1;return R+1|(~R&-~R)-1>>>l(h)+1}},14035:h=>{"use strict";h.exports=function(h,R,l,j){var a=self||window;try{try{var D;try{D=new a.Blob([h])}catch(mh){(D=new(a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder)).append(h),D=D.getBlob()}var U=a.URL||a.webkitURL,F=U.createObjectURL(D),w=new a[R](F,l);return U.revokeObjectURL(F),w}catch(mh){return new a[R]("data:application/javascript,".concat(encodeURIComponent(h)),l)}}catch(mh){if(!j)throw Error("Inline worker is not supported");return new a[R](j,l)}}},13677:(h,R,l)=>{"use strict";function j(h,R,l,j,a){var D={};return Object.keys(j).forEach((function(h){D[h]=j[h]})),D.enumerable=!!D.enumerable,D.configurable=!!D.configurable,("value"in D||D.initializer)&&(D.writable=!0),D=l.slice().reverse().reduce((function(l,j){return j(h,R,l)||l}),D),a&&void 0!==D.initializer&&(D.value=D.initializer?D.initializer.call(a):void 0,D.initializer=void 0),void 0===D.initializer&&(Object.defineProperty(h,R,D),D=null),D}l.d(R,{e:()=>j})},13674:(h,R,l)=>{"use strict";function j(h,R,l,j){l&&Object.defineProperty(h,R,{enumerable:l.enumerable,configurable:l.configurable,writable:l.writable,value:l.initializer?l.initializer.call(j):void 0})}l.d(R,{c:()=>j})},15084:(h,R,l)=>{"use strict";l.d(R,{e:()=>U,g:()=>c,k:()=>F,l:()=>D,m:()=>w,q:()=>a,u:()=>mh,y:()=>u});var j=l(13100);class a{constructor(){this._easingMode=a.EASINGMODE_EASEIN}setEasingMode(h){const R=Math.min(Math.max(h,0),2);this._easingMode=R}getEasingMode(){return this._easingMode}easeInCore(h){throw new Error("You must implement this method")}ease(h){switch(this._easingMode){case a.EASINGMODE_EASEIN:return this.easeInCore(h);case a.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-h)}return h>=.5?.5*(1-this.easeInCore(2*(1-h)))+.5:.5*this.easeInCore(2*h)}}a.EASINGMODE_EASEIN=0,a.EASINGMODE_EASEOUT=1,a.EASINGMODE_EASEINOUT=2;class D extends a{easeInCore(h){return h=Math.max(0,Math.min(1,h)),1-Math.sqrt(1-h*h)}}class U extends a{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=h}easeInCore(h){const R=Math.max(0,this.amplitude);return Math.pow(h,3)-h*R*Math.sin(3.141592653589793*h)}}class F extends a{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=h,this.bounciness=R}easeInCore(h){const R=Math.max(0,this.bounces);let l=this.bounciness;l<=1&&(l=1.001);const j=Math.pow(l,R),a=1-l,D=(1-j)/a+.5*j,U=h*D,F=Math.log(-U*(1-l)+1)/Math.log(l),w=Math.floor(F),mh=w+1,u=(1-Math.pow(l,w))/(a*D),c=.5*(u+(1-Math.pow(l,mh))/(a*D)),J=h-c,q=c-u;return-Math.pow(1/l,R-w)/(q*q)*(J-q)*(J+q)}}class w extends a{easeInCore(h){return h*h*h}}class mh extends a{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=h,this.springiness=R}easeInCore(h){let R;const l=Math.max(0,this.oscillations),j=Math.max(0,this.springiness);return R=0==j?h:(Math.exp(j*h)-1)/(Math.exp(j)-1),R*Math.sin((6.283185307179586*l+1.5707963267948966)*h)}}class u extends a{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=h}easeInCore(h){return this.exponent<=0?h:(Math.exp(this.exponent*h)-1)/(Math.exp(this.exponent)-1)}}class c extends a{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=h,this.y1=R,this.x2=l,this.y2=j}easeInCore(h){return j.c.Interpolate(h,this.x1,this.y1,this.x2,this.y2)}}},14521:(h,R,l)=>{"use strict";l.d(R,{d:()=>U});var j=l(12900),a=l(12910),D=l(13291);class U extends D.b{get _matrix(){return this._compose(),this.qq}set _matrix(h){(h.updateFlag!==this.qq.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.qq.D(h),this._markAsDirtyAndDecompose())}constructor(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(h,R.yh(),!1),this.name=h,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=R,this.qq=(null===a||void 0===a?void 0:a.clone())??j.Matrix.Identity(),this._restMatrix=D??this.qq.clone(),this._bindMatrix=U??this.qq.clone(),this._index=F,this._absoluteMatrix=new j.Matrix,this._absoluteBindMatrix=new j.Matrix,this._absoluteInverseBindMatrix=new j.Matrix,this._finalMatrix=new j.Matrix,R.bones.push(this),this.setParent(l,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(h){this.setParent(h)}setParent(h){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==h){if(this.parent){const h=this.parent.children.indexOf(this);-1!==h&&this.parent.children.splice(h,1)}this._parentNode=h,this.parent&&this.parent.children.push(this),R&&this._updateAbsoluteBindMatrices(),this.Vm()}}getLocalMatrix(){return this._compose(),this.qq}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(h){this._restMatrix.D(h)}setRestPose(h){this.setRestMatrix(h)}getBindPose(){return this.getBindMatrix()}setBindMatrix(h){this.TF(h)}setBindPose(h){this.setBindMatrix(h)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const h=j.TmpVectors.tR[0],R=j.TmpVectors.Quaternion[0],l=j.TmpVectors.tR[1];this.getRestMatrix().decompose(h,R,l),this._linkedTransformNode.position.D(l),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??j.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.D(R),this._linkedTransformNode.yF.D(h)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(h){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=h,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.VF}set position(h){this._decompose(),this.VF.D(h),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(h){this.setRotation(h)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(h){this.setRotationQuaternion(h)}get yF(){return this.getScale()}set yF(h){this.setScale(h)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=j.tR.Zero(),this._localRotation=j.Quaternion.Zero(),this.VF=j.tR.Zero()),this.qq.decompose(this._localScaling,this._localRotation,this.VF))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,j.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.VF,this.qq)):this._needToCompose=!1)}TF(h){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.D(h),R&&this._updateAbsoluteBindMatrices(),l?this._matrix=h:this.Vm()}_updateAbsoluteBindMatrices(h){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(h||(h=this._bindMatrix),this.parent?h.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.D(h),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),R)for(let l=0;l<this.children.length;l++)this.children[l]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Vm(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Vm(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Vm(),this._needToDecompose=!0}_updatePosition(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const D=this.getLocalMatrix();if(0==R)a?(D.addAtIndex(12,h.x),D.addAtIndex(13,h.y),D.addAtIndex(14,h.z)):D.setTranslationFromFloats(h.x,h.y,h.z);else{let R=null;l&&(R=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const F=U._TmpMats[0],w=U._TmpVecs[0];this.parent?l&&R?(F.D(this.parent.getAbsoluteMatrix()),F.multiplyToRef(R,F)):F.D(this.parent.getAbsoluteMatrix()):j.Matrix.IdentityToRef(F),a&&F.setTranslationFromFloats(0,0,0),F.invert(),j.tR.TransformCoordinatesToRef(h,F,w),a?(D.addAtIndex(12,w.x),D.addAtIndex(13,w.y),D.addAtIndex(14,w.z)):D.setTranslationFromFloats(w.x,w.y,w.z)}this._markAsDirtyAndDecompose()}translate(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this._updatePosition(h,R,l,!0)}setPosition(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this._updatePosition(h,R,l,!1)}setAbsolutePosition(h,R){this.setPosition(h,1,R)}scale(h,R,l){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const D=this.getLocalMatrix(),F=U._TmpMats[0];j.Matrix.ScalingToRef(h,R,l,F),F.multiplyToRef(D,D),F.invert();for(const j of this.children){const a=j.getLocalMatrix();a.multiplyToRef(F,a),a.multiplyAtIndex(12,h),a.multiplyAtIndex(13,R),a.multiplyAtIndex(14,l),j._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),a)for(const j of this.children)j.scale(h,R,l,a)}setScale(h){this._decompose(),this._localScaling.D(h),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(h){this._decompose(),h.D(this._localScaling)}setYawPitchRoll(h,R,l){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,D=arguments.length>4?arguments[4]:void 0;if(0===a){const F=U._TmpQuat;return j.Quaternion.RotationYawPitchRollToRef(h,R,l,F),void this.setRotationQuaternion(F,a,D)}const F=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,D))return;const w=U._TmpMats[1];j.Matrix.RotationYawPitchRollToRef(h,R,l,w),F.multiplyToRef(w,w),this._rotateWithMatrix(w,a,D)}rotate(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;const D=U._TmpMats[0];D.setTranslationFromFloats(0,0,0),j.Matrix.RotationAxisToRef(h,R,D),this._rotateWithMatrix(D,l,a)}setAxisAngle(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;if(0===l){const D=U._TmpQuat;return j.Quaternion.RotationAxisToRef(h,R,D),void this.setRotationQuaternion(D,l,a)}const D=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(D,a))return;const F=U._TmpMats[1];j.Matrix.RotationAxisToRef(h,R,F),D.multiplyToRef(F,F),this._rotateWithMatrix(F,l,a)}setRotation(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(h.y,h.x,h.z,R,l)}setRotationQuaternion(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;if(0===R)return this._decompose(),this._localRotation.D(h),void this._markAsDirtyAndCompose();const a=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,l))return;const D=U._TmpMats[1];j.Matrix.FromQuaternionToRef(h,D),a.multiplyToRef(D,D),this._rotateWithMatrix(D,R,l)}setRotationMatrix(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;if(0===R){const a=U._TmpQuat;return j.Quaternion.FromRotationMatrixToRef(h,a),void this.setRotationQuaternion(a,R,l)}const a=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,l))return;const D=U._TmpMats[1];D.D(h),a.multiplyToRef(h,D),this._rotateWithMatrix(D,R,l)}_rotateWithMatrix(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;const j=this.getLocalMatrix(),a=j.m[12],D=j.m[13],F=j.m[14],w=this.getParent(),mh=U._TmpMats[3],u=U._TmpMats[4];w&&1==R?(l?(mh.D(l.getWorldMatrix()),w.getAbsoluteMatrix().multiplyToRef(mh,mh)):mh.D(w.getAbsoluteMatrix()),u.D(mh),u.invert(),j.multiplyToRef(mh,j),j.multiplyToRef(h,j),j.multiplyToRef(u,j)):1==R&&l?(mh.D(l.getWorldMatrix()),u.D(mh),u.invert(),j.multiplyToRef(mh,j),j.multiplyToRef(h,j),j.multiplyToRef(u,j)):j.multiplyToRef(h,j),j.setTranslationFromFloats(a,D,F),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(h,R){const l=U._TmpMats[2];return h.D(this.getAbsoluteMatrix()),R?(h.multiplyToRef(R.getWorldMatrix(),h),j.Matrix.ScalingToRef(R.yF.x,R.yF.y,R.yF.z,l)):j.Matrix.IdentityToRef(l),h.invert(),!isNaN(h.m[0])&&(l.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyToRef(l,h),!0)}jF(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=j.tR.Zero();return this.getPositionToRef(h,R,l),l}getPositionToRef(){let h=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const h=this.getLocalMatrix();R.x=h.m[12],R.y=h.m[13],R.z=h.m[14]}else{let l=null;h&&(l=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let j=U._TmpMats[0];h&&l?(j.D(this.getAbsoluteMatrix()),j.multiplyToRef(l,j)):j=this.getAbsoluteMatrix(),R.x=j.m[12],R.y=j.m[13],R.z=j.m[14]}}getAbsolutePosition(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const R=j.tR.Zero();return this.getPositionToRef(1,h,R),R}getAbsolutePositionToRef(h,R){this.getPositionToRef(1,h,R)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.qq.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.D(this.qq);const h=this._skeleton.getPoseMatrix();h&&this._absoluteMatrix.multiplyToRef(h,this._absoluteMatrix)}const h=this.children,R=h.length;for(let l=0;l<R;l++)h[l].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}yw(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=j.tR.Zero();return this.getDirectionToRef(h,R,l),l}getDirectionToRef(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,a=null;R&&(a=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const D=U._TmpMats[0];D.D(this.getAbsoluteMatrix()),R&&a&&D.multiplyToRef(a,D),j.tR.TransformNormalToRef(h,D,l),l.normalize()}getRotation(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=j.tR.Zero();return this.getRotationToRef(h,R,l),l}getRotationToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;const j=U._TmpQuat;this.getRotationQuaternionToRef(h,R,j),j.toEulerAnglesToRef(l)}getRotationQuaternion(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=j.Quaternion.Identity();return this.getRotationQuaternionToRef(h,R,l),l}getRotationQuaternionToRef(){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),R.D(this._localRotation);else{const l=U._TmpMats[0],j=this.getAbsoluteMatrix();h?j.multiplyToRef(h.getWorldMatrix(),l):l.D(j),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.decompose(void 0,R,void 0)}}getRotationMatrix(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1?arguments[1]:void 0;const l=j.Matrix.Identity();return this.getRotationMatrixToRef(h,R,l),l}getRotationMatrixToRef(){let h=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(R);else{const l=U._TmpMats[0],j=this.getAbsoluteMatrix();h?j.multiplyToRef(h.getWorldMatrix(),l):l.D(j),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.getRotationMatrixToRef(R)}}getAbsolutePositionFromLocal(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=j.tR.Zero();return this.getAbsolutePositionFromLocalToRef(h,R,l),l}getAbsolutePositionFromLocalToRef(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,a=null;R&&(a=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const D=U._TmpMats[0];D.D(this.getAbsoluteMatrix()),R&&a&&D.multiplyToRef(a,D),j.tR.TransformCoordinatesToRef(h,D,l)}getLocalPositionFromAbsolute(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=j.tR.Zero();return this.getLocalPositionFromAbsoluteToRef(h,R,l),l}getLocalPositionFromAbsoluteToRef(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,a=null;R&&(a=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const D=U._TmpMats[0];D.D(this.getAbsoluteMatrix()),R&&a&&D.multiplyToRef(a,D),D.invert(),j.tR.TransformCoordinatesToRef(h,D,l)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const h=this._skeleton.bones.indexOf(this);if(-1!==h&&this._skeleton.bones.splice(h,1),this._parentNode&&this._parentNode.children){const h=this._parentNode.children,R=h.indexOf(this);-1!==R&&h.splice(R,1)}super.dispose()}}U._TmpVecs=(0,a.e)(2,j.tR.Zero),U._TmpQuat=j.Quaternion.Identity(),U._TmpMats=(0,a.e)(5,j.Matrix.Identity)},15077:(h,R,l)=>{"use strict";l.d(R,{d:()=>P});var j=l(12882),a=l(12887),D=l(12696),U=l(12900),F=l(12917),w=l(13291),mh=l(13310),u=l(13153),c=l(12724),J=l(12902);class q{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(h){this._zoomStopsAnimation=h}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(h){this._idleRotationSpeed=h}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(h){this._idleRotationWaitTime=h}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(h){this._idleRotationSpinupTime=h}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(h){this._attachedCamera=h;const R=this._attachedCamera.yh();this._onPrePointerObservableObserver=R.onPrePointerObservable.add((h=>{h.type!==u.d.POINTERDOWN?h.type===u.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const h=c.e.Now;let R=0;null!=this._lastFrameTime&&(R=h-this._lastFrameTime),this._lastFrameTime=h,this._applyUserInteraction();const l=h-this._lastInteractionTime-this._idleRotationWaitTime,j=Math.max(Math.min(l/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*j,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(R/1e3))}))}detach(){if(!this._attachedCamera)return;const h=this._attachedCamera.yh();this._onPrePointerObservableObserver&&h.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(h){this._lastInteractionTime=h??c.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<J.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let h=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(h=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?h:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=c.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var Q=l(15084),Y=l(13399);class s{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(h){if(this._autoTransitionRange===h)return;this._autoTransitionRange=h;const R=this._attachedCamera;R&&(h?this._onMeshTargetChangedObserver=R.onMeshTargetChangedObservable.add((h=>{if(h&&(h.EF(!0),h.getBoundingInfo)){const R=h.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*R,this.upperRadiusTransitionRange=.05*R}})):this._onMeshTargetChangedObserver&&R.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(h){this._attachedCamera=h,this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(h){return!!this._attachedCamera&&(this._attachedCamera.radius===h&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(h){if(!this._attachedCamera)return;this._radiusBounceTransition||(s.EasingFunction.setEasingMode(s.EasingMode),this._radiusBounceTransition=Y.b.CreateAnimation("radius",Y.b.ANIMATIONTYPE_FLOAT,60,s.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const R=Y.b.TransitionTo("radius",this._attachedCamera.radius+h,this._attachedCamera,this._attachedCamera.yh(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));R&&this._animatables.push(R)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}s.EasingFunction=new Q.e(.3),s.EasingMode=Q.q.EASINGMODE_EASEOUT;class t{constructor(){this.onTargetFramingAnimationEndObservable=new D.d,this._mode=t.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(h){this._mode=h}get mode(){return this._mode}set radiusScale(h){this._radiusScale=h}get radiusScale(){return this._radiusScale}set positionScale(h){this._positionScale=h}get positionScale(){return this._positionScale}set defaultElevation(h){this._defaultElevation=h}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(h){this._elevationReturnTime=h}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(h){this._elevationReturnWaitTime=h}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(h){this._zoomStopsAnimation=h}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(h){this._framingTime=h}get framingTime(){return this._framingTime}init(){}attach(h){this._attachedCamera=h;const R=this._attachedCamera.yh();t.EasingFunction.setEasingMode(t.EasingMode),this._onPrePointerObservableObserver=R.onPrePointerObservable.add((h=>{h.type!==u.d.POINTERDOWN?h.type===u.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=h.onMeshTargetChangedObservable.add((h=>{h&&h.getBoundingInfo&&this.zoomOnMesh(h,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const h=this._attachedCamera.yh();this._onPrePointerObservableObserver&&h.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h.EF(!0);const j=h.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(j.minimumWorld,j.maximumWorld,R,l)}zoomOnMeshHierarchy(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h.EF(!0);const j=h.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(j.min,j.max,R,l)}zoomOnMeshesHierarchy(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new U.tR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new U.tR(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let D=0;D<h.length;D++){const R=h[D].getHierarchyBoundingVectors(!0);U.tR.CheckExtends(R.min,j,a),U.tR.CheckExtends(R.max,j,a)}this.zoomOnBoundingInfo(j,a,R,l)}zoomOnBoundingInfo(h,R){let l,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const D=h.y,F=D+(R.y-D)*this._positionScale,w=R.fR(h).scale(.5);if(!isFinite(F))return!1;if(j)l=new U.tR(0,F,0);else{const R=h.add(w);l=new U.tR(R.x,F,R.z)}this._vectorTransition||(this._vectorTransition=Y.b.CreateAnimation("target",Y.b.ANIMATIONTYPE_VECTOR3,60,t.EasingFunction)),this._betaIsAnimating=!0;let mh=Y.b.TransitionTo("target",l,this._attachedCamera,this._attachedCamera.yh(),60,this._vectorTransition,this._framingTime);mh&&this._animatables.push(mh);let u=0;if(this._mode===t.FitFrustumSidesMode){const l=this._calculateLowerRadiusFromModelBoundingSphere(h,R);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=w.length()+this._attachedCamera.fF),u=l}else this._mode===t.IgnoreBoundsSizeMode&&(u=this._calculateLowerRadiusFromModelBoundingSphere(h,R),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.fF));if(this.autoCorrectCameraLimitsAndSensibility){const l=R.fR(h).length();this._attachedCamera.panningSensibility=5e3/l,this._attachedCamera.wheelPrecision=100/u}return this._radiusTransition||(this._radiusTransition=Y.b.CreateAnimation("radius",Y.b.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),mh=Y.b.TransitionTo("radius",u,this._attachedCamera,this._attachedCamera.yh(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),a&&a(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),mh&&this._animatables.push(mh),!0}_calculateLowerRadiusFromModelBoundingSphere(h,R){const l=this._attachedCamera;if(!l)return 0;let j=l._calculateLowerRadiusFromModelBoundingSphere(h,R,this._radiusScale);return l.lowerRadiusLimit&&this._mode===t.IgnoreBoundsSizeMode&&(j=j<l.lowerRadiusLimit?l.lowerRadiusLimit:j),l.upperRadiusLimit&&(j=j>l.upperRadiusLimit?l.upperRadiusLimit:j),j}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const h=c.e.Now-this._lastInteractionTime,R=.5*Math.PI-this._defaultElevation,l=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>l&&h>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Y.b.CreateAnimation("beta",Y.b.ANIMATIONTYPE_FLOAT,60,t.EasingFunction));const h=Y.b.TransitionTo("beta",R,this._attachedCamera,this._attachedCamera.yh(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));h&&this._animatables.push(h)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=c.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}t.EasingFunction=new Q.y,t.EasingMode=Q.q.EASINGMODE_EASEINOUT,t.IgnoreBoundsSizeMode=0,t.FitFrustumSidesMode=1;var f=l(13313),T=l(13359),E=l(14512),x=l(12689);class G{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(h){h=x.Tools.BackCompatCameraNoPreventDefault(arguments);const R=this.camera.getEngine(),l=R.getInputElement();let j=0,a=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=D=>{var U,F;const w=D.event,mh="touch"===w.pointerType;if(D.type!==u.d.POINTERMOVE&&-1===this.buttons.indexOf(w.button))return;const c=w.target;if(this._altKey=w.altKey,this._ctrlKey=w.ctrlKey,this._metaKey=w.metaKey,this._shiftKey=w.shiftKey,this._buttonsPressed=w.buttons,R.isPointerLock){const h=w.movementX,R=w.movementY;this.onTouch(null,h,R),this._pointA=null,this._pointB=null}else{if(D.type!==u.d.POINTERDOWN&&D.type!==u.d.POINTERDOUBLETAP&&mh&&(null===(U=this._pointA)||void 0===U?void 0:U.pointerId)!==w.pointerId&&(null===(F=this._pointB)||void 0===F?void 0:F.pointerId)!==w.pointerId)return;if(D.type!==u.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!mh)if(D.type===u.d.POINTERDOUBLETAP)this.onDoubleTap(w.pointerType);else if(D.type!==u.d.POINTERUP||this._currentMousePointerIdDown!==w.pointerId&&!mh){if(D.type===u.d.POINTERMOVE)if(h||w.preventDefault(),this._pointA&&null===this._pointB){const h=w.clientX-this._pointA.x,R=w.clientY-this._pointA.y;this._pointA.x=w.clientX,this._pointA.y=w.clientY,this.onTouch(this._pointA,h,R)}else if(this._pointA&&this._pointB){const h=this._pointA.pointerId===w.pointerId?this._pointA:this._pointB;h.x=w.clientX,h.y=w.clientY;const R=this._pointA.x-this._pointB.x,l=this._pointA.y-this._pointB.y,U=R*R+l*l,F={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:w.pointerId,type:D.type};this.onMultiTouch(this._pointA,this._pointB,j,U,a,F),a=F,j=U}}else{try{null===c||void 0===c||c.releasePointerCapture(w.pointerId)}catch(J){}mh||(this._pointB=null),R._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==w.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==w.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==j||a)&&(this.onMultiTouch(this._pointA,this._pointB,j,0,a,null),j=0,a=null),this._currentMousePointerIdDown=-1,this.onButtonUp(w),h||w.preventDefault()}else{try{null===c||void 0===c||c.setPointerCapture(w.pointerId)}catch(J){}if(null===this._pointA)this._pointA={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType};else{if(null!==this._pointB)return;this._pointB={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType}}-1!==this._currentMousePointerIdDown||mh||(this._currentMousePointerIdDown=w.pointerId),this.onButtonDown(w),h||(w.preventDefault(),l&&l.focus())}}},this._observer=this.camera.yh()._inputManager._addCameraPointerObserver(this._pointerInput,u.d.POINTERDOWN|u.d.POINTERUP|u.d.POINTERMOVE|u.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,j=0,a=null,this.onLostFocus()},this._contextMenuBind=h=>this.onContextMenu(h),l&&l.addEventListener("contextmenu",this._contextMenuBind,!1);const D=this.camera.yh().getEngine().getHostWindow();D&&x.Tools.RegisterTopRootEvents(D,[{name:"blur",handler:this._onLostFocus}])}pJ(){if(this._onLostFocus){const h=this.camera.yh().getEngine().getHostWindow();h&&x.Tools.UnregisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.yh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const h=this.camera.yh().getEngine().getInputElement();h&&h.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(h){}onTouch(h,R,l){}onMultiTouch(h,R,l,j,a,D){}onContextMenu(h){h.preventDefault()}onButtonDown(h){}onButtonUp(h){}onLostFocus(){}}(0,j.e)([(0,a.G)()],G.prototype,"buttons",void 0);class p extends G{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(h,R){if(0!==this.panningSensibility&&h&&R){const l=R.x-h.x,j=R.y-h.y;this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=j/this.panningSensibility}}_computePinchZoom(h,R){const l=this.camera.radius||p.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=l*Math.sqrt(h)/Math.sqrt(R):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(R-h)*l*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(R-h)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(h,R,l){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-R/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility):(this.camera.inertialAlphaOffset-=R/this.angularSensibilityX,this.camera.inertialBetaOffset-=l/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(h,R,l,j,a,D){0===l&&null===a||0===j&&null===D||(this.multiTouchPanAndZoom?(this._computePinchZoom(l,j),this._computeMultiTouchPanning(a,D)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(j)-Math.sqrt(l))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(l,j),this._isPinching=!0):this._computeMultiTouchPanning(a,D)):this.multiTouchPanning?this._computeMultiTouchPanning(a,D):this.pinchZoom&&this._computePinchZoom(l,j))}onButtonDown(h){this._isPanClick=h.button===this.camera._panningMouseButton}onButtonUp(h){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}p.MinimumRadiusForPinch=.001,(0,j.e)([(0,a.G)()],p.prototype,"buttons",void 0),(0,j.e)([(0,a.G)()],p.prototype,"angularSensibilityX",void 0),(0,j.e)([(0,a.G)()],p.prototype,"angularSensibilityY",void 0),(0,j.e)([(0,a.G)()],p.prototype,"pinchPrecision",void 0),(0,j.e)([(0,a.G)()],p.prototype,"pinchDeltaPercentage",void 0),(0,j.e)([(0,a.G)()],p.prototype,"useNaturalPinchZoom",void 0),(0,j.e)([(0,a.G)()],p.prototype,"pinchZoom",void 0),(0,j.e)([(0,a.G)()],p.prototype,"panningSensibility",void 0),(0,j.e)([(0,a.G)()],p.prototype,"multiTouchPanning",void 0),(0,j.e)([(0,a.G)()],p.prototype,"multiTouchPanAndZoom",void 0),E.c.ArcRotateCameraPointersInput=p;var O=l(13157);class y{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(h){h=x.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.yh(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((R=>{const l=R.event;if(!l.metaKey)if(R.type===O.b.KEYDOWN){if(this._ctrlPressed=l.ctrlKey,this._altPressed=l.altKey,-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysReset.indexOf(l.keyCode)){-1===this._keys.indexOf(l.keyCode)&&this._keys.push(l.keyCode),l.preventDefault&&(h||l.preventDefault())}}else if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysReset.indexOf(l.keyCode)){const R=this._keys.indexOf(l.keyCode);R>=0&&this._keys.splice(R,1),l.preventDefault&&(h||l.preventDefault())}})))}pJ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const h=this.camera;for(let R=0;R<this._keys.length;R++){const l=this._keys[R];-1!==this.keysLeft.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningX-=1/this.panningSensibility:h.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?h.inertialRadiusOffset+=1/this.zoomingSensibility:h.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningX+=1/this.panningSensibility:h.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?h.inertialRadiusOffset-=1/this.zoomingSensibility:h.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(l)&&h.useInputToRestoreState&&h.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,j.e)([(0,a.G)()],y.prototype,"keysUp",void 0),(0,j.e)([(0,a.G)()],y.prototype,"keysDown",void 0),(0,j.e)([(0,a.G)()],y.prototype,"keysLeft",void 0),(0,j.e)([(0,a.G)()],y.prototype,"keysRight",void 0),(0,j.e)([(0,a.G)()],y.prototype,"keysReset",void 0),(0,j.e)([(0,a.G)()],y.prototype,"panningSensibility",void 0),(0,j.e)([(0,a.G)()],y.prototype,"zoomingSensibility",void 0),(0,j.e)([(0,a.G)()],y.prototype,"useAltToZoom",void 0),(0,j.e)([(0,a.G)()],y.prototype,"angularSpeed",void 0),E.c.ArcRotateCameraKeyboardMoveInput=y;var v=l(12960),b=l(13160);class I{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new U.tR(0,0,0),this._globalOffset=new U.tR(0,0,0),this._inertialPanning=U.tR.Zero()}_computeDeltaFromMouseWheelLegacyEvent(h,R){let l=0;const j=.01*h*this.wheelDeltaPercentage*R;return l=h>0?j/(1+this.wheelDeltaPercentage):j*(1+this.wheelDeltaPercentage),l}attachControl(h){h=x.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=R=>{if(R.type!==u.d.POINTERWHEEL)return;const l=R.event;let j=0;const a=l.deltaMode===b.d.DOM_DELTA_LINE?40:1,D=-l.deltaY*a;if(this.customComputeDeltaFromMouseWheel)j=this.customComputeDeltaFromMouseWheel(D,this,l);else if(this.wheelDeltaPercentage){if(j=this._computeDeltaFromMouseWheelLegacyEvent(D,this.camera.radius),j>0){let h=this.camera.radius,R=this.camera.inertialRadiusOffset+j;for(let l=0;l<20&&!(h<=R)&&!(Math.abs(R*this.camera.inertia)<.001);l++)h-=R,R*=this.camera.inertia;h=(0,F.Clamp)(h,0,Number.MAX_VALUE),j=this._computeDeltaFromMouseWheelLegacyEvent(D,h)}}else j=D/(40*this.wheelPrecision);j&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(j)):this.camera.inertialRadiusOffset+=j),l.preventDefault&&(h||l.preventDefault())},this._observer=this.camera.yh()._inputManager._addCameraPointerObserver(this._wheel,u.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.vF(0)}pJ(){this._observer&&(this.camera.yh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const h=this.camera;0+h.inertialAlphaOffset+h.inertialBetaOffset+h.inertialRadiusOffset&&(this._updateHitPlane(),h.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(h.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const h=this.camera,R=h.target.fR(h.position);this._hitPlane=v.d.FromPositionAndNormal(h.target,R)}_getPosition(){const h=this.camera,R=h.yh(),l=R.createPickingRay(R.pointerX,R.pointerY,U.Matrix.Identity(),h,!1);0===h.targetScreenOffset.x&&0===h.targetScreenOffset.y||(this._viewOffset.set(h.targetScreenOffset.x,h.targetScreenOffset.y,0),h.getViewMatrix().invertToRef(h._cameraTransformMatrix),this._globalOffset=U.tR.TransformNormal(this._viewOffset,h._cameraTransformMatrix),l.origin.addInPlace(this._globalOffset));let j=0;return this._hitPlane&&(j=l.intersectsPlane(this._hitPlane)??0),l.origin.addInPlace(l.direction.scaleInPlace(j))}_zoomToMouse(h){const R=this.camera,l=1-R.inertia;if(R.lowerRadiusLimit){const j=R.lowerRadiusLimit??0;R.radius-(R.inertialRadiusOffset+h)/l<j&&(h=(R.radius-j)*l-R.inertialRadiusOffset)}if(R.upperRadiusLimit){const j=R.upperRadiusLimit??0;R.radius-(R.inertialRadiusOffset+h)/l>j&&(h=(R.radius-j)*l-R.inertialRadiusOffset)}const j=h/l/R.radius,a=this._getPosition(),D=U.TmpVectors.tR[6];a.subtractToRef(R.target,D),D.scaleInPlace(j),D.scaleInPlace(l),this._inertialPanning.addInPlace(D),R.inertialRadiusOffset+=h}_zeroIfClose(h){Math.abs(h.x)<J.d&&(h.x=0),Math.abs(h.y)<J.d&&(h.y=0),Math.abs(h.z)<J.d&&(h.z=0)}}(0,j.e)([(0,a.G)()],I.prototype,"wheelPrecision",void 0),(0,j.e)([(0,a.G)()],I.prototype,"zoomToMouseLocation",void 0),(0,j.e)([(0,a.G)()],I.prototype,"wheelDeltaPercentage",void 0),E.c.ArcRotateCameraMouseWheelInput=I;class L extends E.f{constructor(h){super(h)}addMouseWheel(){return this.add(new I),this}addPointers(){return this.add(new p),this}addKeyboard(){return this.add(new y),this}}var n=l(12852);function r(h,R){return isNaN(h)?R:h}w.b.AddNodeConstructor("ArcRotateCamera",((h,R)=>()=>new P(h,0,0,1,U.tR.Zero(),R)));class P extends T.c{get target(){return this._target}set target(h){this.setTarget(h)}get targetHost(){return this._targetHost}set targetHost(h){h&&this.setTarget(h)}getTarget(){return this.target}get position(){return this._position}set position(h){this.setPosition(h)}set upVector(h){this._upToYMatrix||(this._yToUpMatrix=new U.Matrix,this._upToYMatrix=new U.Matrix,this._upVector=U.tR.Zero()),h.normalize(),this._upVector.D(h),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){U.Matrix.RotationAlignToRef(U.tR.UpReadOnly,this._upVector,this._yToUpMatrix),U.Matrix.RotationAlignToRef(this._upVector,U.tR.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const h=this.inputs.attached.pointers;return h?h.angularSensibilityX:0}set angularSensibilityX(h){const R=this.inputs.attached.pointers;R&&(R.angularSensibilityX=h)}get angularSensibilityY(){const h=this.inputs.attached.pointers;return h?h.angularSensibilityY:0}set angularSensibilityY(h){const R=this.inputs.attached.pointers;R&&(R.angularSensibilityY=h)}get pinchPrecision(){const h=this.inputs.attached.pointers;return h?h.pinchPrecision:0}set pinchPrecision(h){const R=this.inputs.attached.pointers;R&&(R.pinchPrecision=h)}get pinchDeltaPercentage(){const h=this.inputs.attached.pointers;return h?h.pinchDeltaPercentage:0}set pinchDeltaPercentage(h){const R=this.inputs.attached.pointers;R&&(R.pinchDeltaPercentage=h)}get useNaturalPinchZoom(){const h=this.inputs.attached.pointers;return!!h&&h.useNaturalPinchZoom}set useNaturalPinchZoom(h){const R=this.inputs.attached.pointers;R&&(R.useNaturalPinchZoom=h)}get panningSensibility(){const h=this.inputs.attached.pointers;return h?h.panningSensibility:0}set panningSensibility(h){const R=this.inputs.attached.pointers;R&&(R.panningSensibility=h)}get keysUp(){const h=this.inputs.attached.keyboard;return h?h.keysUp:[]}set keysUp(h){const R=this.inputs.attached.keyboard;R&&(R.keysUp=h)}get keysDown(){const h=this.inputs.attached.keyboard;return h?h.keysDown:[]}set keysDown(h){const R=this.inputs.attached.keyboard;R&&(R.keysDown=h)}get keysLeft(){const h=this.inputs.attached.keyboard;return h?h.keysLeft:[]}set keysLeft(h){const R=this.inputs.attached.keyboard;R&&(R.keysLeft=h)}get keysRight(){const h=this.inputs.attached.keyboard;return h?h.keysRight:[]}set keysRight(h){const R=this.inputs.attached.keyboard;R&&(R.keysRight=h)}get wheelPrecision(){const h=this.inputs.attached.mousewheel;return h?h.wheelPrecision:0}set wheelPrecision(h){const R=this.inputs.attached.mousewheel;R&&(R.wheelPrecision=h)}get zoomToMouseLocation(){const h=this.inputs.attached.mousewheel;return!!h&&h.zoomToMouseLocation}set zoomToMouseLocation(h){const R=this.inputs.attached.mousewheel;R&&(R.zoomToMouseLocation=h)}get wheelDeltaPercentage(){const h=this.inputs.attached.mousewheel;return h?h.wheelDeltaPercentage:0}set wheelDeltaPercentage(h){const R=this.inputs.attached.mousewheel;R&&(R.wheelDeltaPercentage=h)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(h){h!==this.useBouncingBehavior&&(h?(this._bouncingBehavior=new s,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(h){h!==this.useFramingBehavior&&(h?(this._framingBehavior=new t,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(h){h!==this.useAutoRotationBehavior&&(h?(this._autoRotationBehavior=new q,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(h,R,l,j,a,F){var w;let mh=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(h,U.tR.Zero(),F,mh),w=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=U.tR.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=U.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new U.Matrix,this.panningAxis=new U.tR(1,1,0),this._transformedDirection=new U.tR,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new D.d,this.checkCollisions=!1,this.collisionRadius=new U.tR(.5,.5,.5),this._previousPosition=U.tR.Zero(),this._collisionVelocity=U.tR.Zero(),this._newPosition=U.tR.Zero(),this._computationVector=U.tR.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new U.tR(NaN,NaN,NaN),this._goalTargetScreenOffset=new U.Vector2(NaN,NaN),this._onCollisionPositionChange=function(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;l?(w.setPosition(R),w.UQ&&w.UQ(l)):w._previousPosition.D(w._position);const j=Math.cos(w.alpha),a=Math.sin(w.alpha),D=Math.cos(w.beta);let U=Math.sin(w.beta);0===U&&(U=1e-4);const F=w._getTargetPosition();w._computationVector.OF(w.radius*j*U,w.radius*D,w.radius*a*U),F.addToRef(w._computationVector,w._newPosition),w._position.D(w._newPosition);let mh=w.upVector;w.allowUpsideDown&&w.beta<0&&(mh=mh.clone(),mh=mh.negate()),w._computeViewMatrix(w._position,F,mh),w._viewMatrix.addAtIndex(12,w.targetScreenOffset.x),w._viewMatrix.addAtIndex(13,w.targetScreenOffset.y),w._collisionTriggered=!1},this._target=U.tR.Zero(),a&&this.setTarget(a),this.alpha=R,this.beta=l,this.radius=j,this.getViewMatrix(),this.inputs=new L(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new U.tR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=U.Vector2.Zero()}_updateCache(h){h||super._updateCache(),this._cache._target.D(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.D(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const h=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?h.addToRef(this._targetBoundingCenter,this._target):this._target.D(h)}const h=this._getLockedTargetPosition();return h||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>J.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,D=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=D?this._currentInterpolationFactor=D:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=r(h,this._goalAlpha),this._goalBeta=r(R,this._goalBeta),this._goalRadius=r(l,this._goalRadius),this._goalTarget.set(r(j.x,this._goalTarget.x),r(j.y,this._goalTarget.y),r(j.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(r(a.x,this._goalTargetScreenOffset.x),r(a.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,F.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,F.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,F.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,F.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(h,R){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const a=arguments;R=x.Tools.BackCompatCameraNoPreventDefault(a),this._useCtrlForPanning=l,this._panningMouseButton=j,"boolean"===typeof a[0]&&(a.length>1&&(this._useCtrlForPanning=a[1]),a.length>2&&(this._panningMouseButton=a[2])),this.inputs.attachElement(R),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}pJ(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let h=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){h=!0;const R=this.invertRotation?-1:1,l=this._calculateHandednessMultiplier();let j=this.inertialAlphaOffset*l;this.beta<0&&(j*=-1),this.alpha+=j*R,this.beta+=this.inertialBetaOffset*R,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<J.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<J.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*J.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){h=!0;const R=new U.tR(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),R.multiplyInPlace(this.panningAxis),U.tR.TransformNormalToRef(R,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const h=this.upVector,R=U.tR.CrossToRef(this._transformedDirection,h,this._transformedDirection);U.tR.CrossToRef(h,R,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);U.tR.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.D(this._transformedDirection)}else{if(this.parent){const h=U.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.transposeToRef(h),U.tR.TransformCoordinatesToRef(this._transformedDirection,h,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*J.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*J.d&&(this.inertialPanningY=0)}if(h)this.stopInterpolation();else if(this._isInterpolating){let h=!1;const R=this._scene.getEngine().getDeltaTime()/1e3,l=1-Math.pow(2,-R/this._currentInterpolationFactor),j=r(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const R=U.TmpVectors.tR[0].set(r(this._goalTarget.x,this._target.x),r(this._goalTarget.y,this._target.y),r(this._goalTarget.z,this._target.z));U.tR.LerpToRef(this.target,R,l,this._target),10*U.tR.Distance(this.target,R)/j<J.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.D(R),this.setTarget(this.target,!1,!0,!0)):h=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const R=U.Quaternion.RotationAlphaBetaGammaToRef(r(this._goalAlpha,this.alpha),r(this._goalBeta,this.beta),0,U.TmpVectors.Quaternion[0]),j=U.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,U.TmpVectors.Quaternion[1]),a=U.Quaternion.SlerpToRef(j,R,l,U.TmpVectors.Quaternion[2]);a.normalize();const D=a.toAlphaBetaGammaToRef(U.TmpVectors.tR[0]);if(this.alpha=D.x,this.beta=D.y,a.isApprox(R,J.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const h=R.toAlphaBetaGammaToRef(U.TmpVectors.tR[0]);this.alpha=h.x,this.beta=h.y}else h=!0}if(isNaN(this._goalRadius)||(this.radius+=(j-this.radius)*l,Math.abs(j/this.radius-1)<J.d?(this._goalRadius=NaN,this.radius=j):h=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const R=U.TmpVectors.Vector2[0].set(r(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),r(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));U.Vector2.LerpToRef(this.targetScreenOffset,R,l,this.targetScreenOffset),U.Vector2.Distance(this.targetScreenOffset,R)<J.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.D(R)):h=!0}this._isInterpolating=h}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||U.tR.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const h=this.alpha;var R,l;this.alpha=function(h){let R=Math.PI/2;return 0===h.x&&0===h.z||(R=Math.acos(h.x/Math.sqrt(Math.pow(h.x,2)+Math.pow(h.z,2)))),h.z<0&&(R=2*Math.PI-R),R}(this._computationVector),this.beta=(R=this._computationVector.y,l=this.radius,Math.acos(R/l));const j=Math.round((h-this.alpha)/(2*Math.PI));this.alpha+=2*j*Math.PI,this._checkLimits()}setPosition(h){this._position.equals(h)||(this._position.D(h),this.rebuildAnglesAndRadius())}setTarget(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(j=this.overrideCloneAlphaBetaRadius??j,h.EF)R&&h.getBoundingInfo?this._targetBoundingCenter=h.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,h.EF(),this._targetHost=h,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const R=h,j=this._getTargetPosition();if(j&&!l&&j.equals(R))return;this._targetHost=null,this._target=R,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}j||this.rebuildAnglesAndRadius()}_getViewMatrix(){const h=Math.cos(this.alpha),R=Math.sin(this.alpha),l=Math.cos(this.beta);let j=Math.sin(this.beta);0===j&&(j=1e-4),0===this.radius&&(this.radius=1e-4);const a=this._getTargetPosition();if(this._computationVector.OF(this.radius*h*j,this.radius*l,this.radius*R*j),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||U.tR.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),a.addToRef(this._computationVector,this._newPosition),this.yh().collisionsEnabled&&this.checkCollisions){const h=this.yh().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,h.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.D(this._newPosition);let h=this.upVector;this.allowUpsideDown&&j<0&&(h=h.negate()),this._computeViewMatrix(this._position,a,h),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.D(a),this._viewMatrix}zoomOn(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h=h||this.yh().meshes;const l=mh.b.MinMax(h);let j=this._calculateLowerRadiusFromModelBoundingSphere(l.min,l.max);if(j=Math.max(Math.min(j,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=j*this.zoomOnFactor,this.mode===f.e.ORTHOGRAPHIC_CAMERA){const h=this.yh().getEngine().getAspectRatio(this),R=j*this.zoomOnFactor/2;this.orthoLeft=-R*h,this.orthoRight=R*h,this.orthoBottom=-R,this.orthoTop=R}this.focusOn({min:l.min,max:l.max,distance:j},R)}focusOn(h){let R,l,j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===h.min){const j=h||this.yh().meshes;R=mh.b.MinMax(j),l=U.tR.Distance(R.min,R.max)}else{R=h,l=h.distance}this._target=mh.b.Center(R),j||(this.maxZ=2*l)}createRigCamera(h,R){let l=0;switch(this.cameraRigMode){case f.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.e.RIG_MODE_VR:l=this._cameraRigParams.stereoHalfAngle*(0===R?1:-1);break;case f.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:l=this._cameraRigParams.stereoHalfAngle*(0===R?-1:1)}const j=new P(h,this.alpha+l,this.beta,this.radius,this._target,this.yh());return j._cameraRigParams={},j.isRigCamera=!0,j.rigParent=this,j.upVector=this.upVector,j.mode=this.mode,j.orthoLeft=this.orthoLeft,j.orthoRight=this.orthoRight,j.orthoBottom=this.orthoBottom,j.orthoTop=this.orthoTop,j}_updateRigCameras(){const h=this._rigCameras[0],R=this._rigCameras[1];switch(h.beta=R.beta=this.beta,this.cameraRigMode){case f.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case f.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case f.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case f.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case f.e.RIG_MODE_VR:h.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,R.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case f.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:h.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,R.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const j=U.tR.Distance(h,R),a=this.yh().getEngine().getAspectRatio(this),D=Math.tan(this.fov/2),F=D*a,w=.5*j*l,mh=w*Math.sqrt(1+1/(F*F)),u=w*Math.sqrt(1+1/(D*D));return Math.max(mh,u)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,j.e)([(0,a.G)()],P.prototype,"alpha",void 0),(0,j.e)([(0,a.G)()],P.prototype,"beta",void 0),(0,j.e)([(0,a.G)()],P.prototype,"radius",void 0),(0,j.e)([(0,a.G)()],P.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,j.e)([(0,a.F)("target")],P.prototype,"_target",void 0),(0,j.e)([(0,a.q)("targetHost")],P.prototype,"_targetHost",void 0),(0,j.e)([(0,a.G)()],P.prototype,"inertialAlphaOffset",void 0),(0,j.e)([(0,a.G)()],P.prototype,"inertialBetaOffset",void 0),(0,j.e)([(0,a.G)()],P.prototype,"inertialRadiusOffset",void 0),(0,j.e)([(0,a.G)()],P.prototype,"lowerAlphaLimit",void 0),(0,j.e)([(0,a.G)()],P.prototype,"upperAlphaLimit",void 0),(0,j.e)([(0,a.G)()],P.prototype,"lowerBetaLimit",void 0),(0,j.e)([(0,a.G)()],P.prototype,"upperBetaLimit",void 0),(0,j.e)([(0,a.G)()],P.prototype,"lowerRadiusLimit",void 0),(0,j.e)([(0,a.G)()],P.prototype,"upperRadiusLimit",void 0),(0,j.e)([(0,a.G)()],P.prototype,"lowerTargetYLimit",void 0),(0,j.e)([(0,a.G)()],P.prototype,"inertialPanningX",void 0),(0,j.e)([(0,a.G)()],P.prototype,"inertialPanningY",void 0),(0,j.e)([(0,a.G)()],P.prototype,"pinchToPanMaxDistance",void 0),(0,j.e)([(0,a.G)()],P.prototype,"panningDistanceLimit",void 0),(0,j.e)([(0,a.F)()],P.prototype,"panningOriginTarget",void 0),(0,j.e)([(0,a.G)()],P.prototype,"panningInertia",void 0),(0,j.e)([(0,a.G)()],P.prototype,"zoomToMouseLocation",null),(0,j.e)([(0,a.G)()],P.prototype,"zoomOnFactor",void 0),(0,j.e)([(0,a.B)()],P.prototype,"targetScreenOffset",void 0),(0,j.e)([(0,a.G)()],P.prototype,"allowUpsideDown",void 0),(0,j.e)([(0,a.G)()],P.prototype,"useInputToRestoreState",void 0),(0,j.e)([(0,a.G)()],P.prototype,"restoreStateInterpolationFactor",void 0),(0,n.f)("BABYLON.ArcRotateCamera",P)},14512:(h,R,l)=>{"use strict";l.d(R,{c:()=>U,f:()=>F});var j=l(12711),a=l(12942),D=l(13313),U={};class F{constructor(h){this.attachedToElement=!1,this.attached={},this.camera=h,this.checkInputs=()=>{}}add(h){const R=h.getSimpleName();this.attached[R]?j.c.Warn("camera input of type "+R+" already exists on camera"):(this.attached[R]=h,h.camera=this.camera,h.checkInputs&&(this.checkInputs=this._addCheckInputs(h.checkInputs.bind(h))),this.attachedToElement&&h.attachControl(this.noPreventDefault))}remove(h){for(const R in this.attached){const l=this.attached[R];if(l===h)return l.pJ(),l.camera=null,delete this.attached[R],void this.rebuildInputCheck()}}removeByType(h){for(const R in this.attached){const l=this.attached[R];l.getClassName()===h&&(l.pJ(),l.camera=null,delete this.attached[R],this.rebuildInputCheck())}}_addCheckInputs(h){const R=this.checkInputs;return()=>{R(),h()}}attachInput(h){this.attachedToElement&&h.attachControl(this.noPreventDefault)}attachElement(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){h=!D.e.ForceAttachControlToAlwaysPreventDefault&&h,this.attachedToElement=!0,this.noPreventDefault=h;for(const R in this.attached)this.attached[R].attachControl(h)}}detachElement(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const R in this.attached)this.attached[R].pJ(),h&&(this.attached[R].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const h in this.attached){const R=this.attached[h];R.checkInputs&&(this.checkInputs=this._addCheckInputs(R.checkInputs.bind(R)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(h){const R={};for(const l in this.attached){const h=this.attached[l],j=a.c.Serialize(h);R[h.getClassName()]=j}h.inputsmgr=R}parse(h){const R=h.inputsmgr;if(R){this.clear();for(const h in R){const l=U[h];if(l){const j=R[h],D=a.c.Parse((()=>new l),j,null);this.add(D)}}}else for(const l in this.attached){const R=U[this.attached[l].getClassName()];if(R){const j=a.c.Parse((()=>new R),h,null);this.remove(this.attached[l]),this.add(j)}}}}},14504:(h,R,l)=>{"use strict";l.d(R,{d:()=>G});var j=l(12882),a=l(12887),D=l(12900),U=l(13359),F=l(14512),w=l(13157),mh=l(12689);class u{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(h){h=mh.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.yh(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((R=>{const l=R.event;if(!l.metaKey)if(R.type===w.b.KEYDOWN){if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysUpward.indexOf(l.keyCode)||-1!==this.keysDownward.indexOf(l.keyCode)||-1!==this.keysRotateLeft.indexOf(l.keyCode)||-1!==this.keysRotateRight.indexOf(l.keyCode)||-1!==this.keysRotateUp.indexOf(l.keyCode)||-1!==this.keysRotateDown.indexOf(l.keyCode)){-1===this._keys.indexOf(l.keyCode)&&this._keys.push(l.keyCode),h||l.preventDefault()}}else if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysUpward.indexOf(l.keyCode)||-1!==this.keysDownward.indexOf(l.keyCode)||-1!==this.keysRotateLeft.indexOf(l.keyCode)||-1!==this.keysRotateRight.indexOf(l.keyCode)||-1!==this.keysRotateUp.indexOf(l.keyCode)||-1!==this.keysRotateDown.indexOf(l.keyCode)){const R=this._keys.indexOf(l.keyCode);R>=0&&this._keys.splice(R,1),h||l.preventDefault()}})))}pJ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const h=this.camera;for(let R=0;R<this._keys.length;R++){const l=this._keys[R],j=h._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(l)?h._localDirection.OF(-j,0,0):-1!==this.keysUp.indexOf(l)?h._localDirection.OF(0,0,j):-1!==this.keysRight.indexOf(l)?h._localDirection.OF(j,0,0):-1!==this.keysDown.indexOf(l)?h._localDirection.OF(0,0,-j):-1!==this.keysUpward.indexOf(l)?h._localDirection.OF(0,j,0):-1!==this.keysDownward.indexOf(l)?h._localDirection.OF(0,-j,0):-1!==this.keysRotateLeft.indexOf(l)?(h._localDirection.OF(0,0,0),h.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(l)?(h._localDirection.OF(0,0,0),h.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(l)?(h._localDirection.OF(0,0,0),h.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(l)&&(h._localDirection.OF(0,0,0),h.cameraRotation.x+=this._getLocalRotation()),h.yh().useRightHandedSystem&&(h._localDirection.z*=-1),h.getViewMatrix().invertToRef(h._cameraTransformMatrix),D.tR.TransformNormalToRef(h._localDirection,h._cameraTransformMatrix,h._transformedDirection),h.cameraDirection.addInPlace(h._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const h=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*h}}(0,j.e)([(0,a.G)()],u.prototype,"keysUp",void 0),(0,j.e)([(0,a.G)()],u.prototype,"keysUpward",void 0),(0,j.e)([(0,a.G)()],u.prototype,"keysDown",void 0),(0,j.e)([(0,a.G)()],u.prototype,"keysDownward",void 0),(0,j.e)([(0,a.G)()],u.prototype,"keysLeft",void 0),(0,j.e)([(0,a.G)()],u.prototype,"keysRight",void 0),(0,j.e)([(0,a.G)()],u.prototype,"rotationSpeed",void 0),(0,j.e)([(0,a.G)()],u.prototype,"keysRotateLeft",void 0),(0,j.e)([(0,a.G)()],u.prototype,"keysRotateRight",void 0),(0,j.e)([(0,a.G)()],u.prototype,"keysRotateUp",void 0),(0,j.e)([(0,a.G)()],u.prototype,"keysRotateDown",void 0),F.c.FreeCameraKeyboardMoveInput=u;var c=l(12696),J=l(13153);class q{constructor(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=h,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new c.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(h){h=mh.Tools.BackCompatCameraNoPreventDefault(arguments);const R=this.camera.getEngine(),l=R.getInputElement();this._pointerInput||(this._pointerInput=j=>{const a=j.event,D="touch"===a.pointerType;if(!this.touchEnabled&&D)return;if(j.type!==J.d.POINTERMOVE&&-1===this.buttons.indexOf(a.button))return;const U=a.target;if(j.type===J.d.POINTERDOWN){if(D&&-1!==this._activePointerId||!D&&-1!==this._currentActiveButton)return;this._activePointerId=a.pointerId;try{null===U||void 0===U||U.setPointerCapture(a.pointerId)}catch(F){}-1===this._currentActiveButton&&(this._currentActiveButton=a.button),this._previousPosition={x:a.clientX,y:a.clientY},h||(a.preventDefault(),l&&l.focus()),R.isPointerLock&&this._onMouseMove&&this._onMouseMove(j.event)}else if(j.type===J.d.POINTERUP){if(D&&this._activePointerId!==a.pointerId||!D&&this._currentActiveButton!==a.button)return;try{null===U||void 0===U||U.releasePointerCapture(a.pointerId)}catch(F){}this._currentActiveButton=-1,this._previousPosition=null,h||a.preventDefault(),this._activePointerId=-1}else if(j.type===J.d.POINTERMOVE&&(this._activePointerId===a.pointerId||!D))if(R.isPointerLock&&this._onMouseMove)this._onMouseMove(j.event);else if(this._previousPosition){const R=this.camera._calculateHandednessMultiplier(),l=(a.clientX-this._previousPosition.x)*R,j=a.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=l/this.angularSensibility,this.camera.cameraRotation.x+=j/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:l,offsetY:j}),this._previousPosition={x:a.clientX,y:a.clientY},h||a.preventDefault()}}),this._onMouseMove=l=>{if(!R.isPointerLock)return;const j=this.camera._calculateHandednessMultiplier(),a=l.movementX*j;this.camera.cameraRotation.y+=a/this.angularSensibility;const D=l.movementY;this.camera.cameraRotation.x+=D/this.angularSensibility,this._previousPosition=null,h||l.preventDefault()},this._observer=this.camera.yh()._inputManager._addCameraPointerObserver(this._pointerInput,J.d.POINTERDOWN|J.d.POINTERUP|J.d.POINTERMOVE),l&&(this._contextMenuBind=h=>this.onContextMenu(h),l.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(h){h.preventDefault()}pJ(){if(this._observer){if(this.camera.yh()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const h=this.camera.getEngine().getInputElement();h&&h.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,j.e)([(0,a.G)()],q.prototype,"buttons",void 0),(0,j.e)([(0,a.G)()],q.prototype,"angularSensibility",void 0),F.c.FreeCameraMouseInput=q;var Q,Y=l(13160);class s{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new c.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(h){h=mh.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=R=>{if(R.type!==J.d.POINTERWHEEL)return;const l=R.event,j=l.deltaMode===Y.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*j*l.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*j*l.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*j*l.deltaZ/this._normalize,l.preventDefault&&(h||l.preventDefault())},this._observer=this.camera.yh()._inputManager._addCameraPointerObserver(this._wheel,J.d.POINTERWHEEL)}pJ(){this._observer&&(this.camera.yh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,j.e)([(0,a.G)()],s.prototype,"wheelPrecisionX",void 0),(0,j.e)([(0,a.G)()],s.prototype,"wheelPrecisionY",void 0),(0,j.e)([(0,a.G)()],s.prototype,"wheelPrecisionZ",void 0),function(h){h[h.MoveRelative=0]="MoveRelative",h[h.RotateRelative=1]="RotateRelative",h[h.MoveScene=2]="MoveScene"}(Q||(Q={}));class t extends s{constructor(){super(...arguments),this._moveRelative=D.tR.Zero(),this._rotateRelative=D.tR.Zero(),this._moveScene=D.tR.Zero(),this._wheelXAction=Q.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=Q.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(h){null===h&&this._wheelXAction!==Q.MoveRelative||(this._wheelXAction=Q.MoveRelative,this._wheelXActionCoordinate=h)}get wheelXMoveRelative(){return this._wheelXAction!==Q.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(h){null===h&&this._wheelYAction!==Q.MoveRelative||(this._wheelYAction=Q.MoveRelative,this._wheelYActionCoordinate=h)}get wheelYMoveRelative(){return this._wheelYAction!==Q.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(h){null===h&&this._wheelZAction!==Q.MoveRelative||(this._wheelZAction=Q.MoveRelative,this._wheelZActionCoordinate=h)}get wheelZMoveRelative(){return this._wheelZAction!==Q.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(h){null===h&&this._wheelXAction!==Q.RotateRelative||(this._wheelXAction=Q.RotateRelative,this._wheelXActionCoordinate=h)}get wheelXRotateRelative(){return this._wheelXAction!==Q.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(h){null===h&&this._wheelYAction!==Q.RotateRelative||(this._wheelYAction=Q.RotateRelative,this._wheelYActionCoordinate=h)}get wheelYRotateRelative(){return this._wheelYAction!==Q.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(h){null===h&&this._wheelZAction!==Q.RotateRelative||(this._wheelZAction=Q.RotateRelative,this._wheelZActionCoordinate=h)}get wheelZRotateRelative(){return this._wheelZAction!==Q.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(h){null===h&&this._wheelXAction!==Q.MoveScene||(this._wheelXAction=Q.MoveScene,this._wheelXActionCoordinate=h)}get wheelXMoveScene(){return this._wheelXAction!==Q.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(h){null===h&&this._wheelYAction!==Q.MoveScene||(this._wheelYAction=Q.MoveScene,this._wheelYActionCoordinate=h)}get wheelYMoveScene(){return this._wheelYAction!==Q.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(h){null===h&&this._wheelZAction!==Q.MoveScene||(this._wheelZAction=Q.MoveScene,this._wheelZActionCoordinate=h)}get wheelZMoveScene(){return this._wheelZAction!==Q.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.vF(0),this._rotateRelative.vF(0),this._moveScene.vF(0),this._updateCamera(),this.camera.yh().useRightHandedSystem&&(this._moveRelative.z*=-1);const h=D.Matrix.Zero();this.camera.getViewMatrix().invertToRef(h);const R=D.tR.Zero();D.tR.TransformNormalToRef(this._moveRelative,h,R),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(R),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(h,R,l){if(0===h)return;if(null===R||null===l)return;let j=null;switch(R){case Q.MoveRelative:j=this._moveRelative;break;case Q.RotateRelative:j=this._rotateRelative;break;case Q.MoveScene:j=this._moveScene}switch(l){case 0:j.set(h,0,0);break;case 1:j.set(0,h,0);break;case 2:j.set(0,0,h)}}}(0,j.e)([(0,a.G)()],t.prototype,"wheelXMoveRelative",null),(0,j.e)([(0,a.G)()],t.prototype,"wheelYMoveRelative",null),(0,j.e)([(0,a.G)()],t.prototype,"wheelZMoveRelative",null),(0,j.e)([(0,a.G)()],t.prototype,"wheelXRotateRelative",null),(0,j.e)([(0,a.G)()],t.prototype,"wheelYRotateRelative",null),(0,j.e)([(0,a.G)()],t.prototype,"wheelZRotateRelative",null),(0,j.e)([(0,a.G)()],t.prototype,"wheelXMoveScene",null),(0,j.e)([(0,a.G)()],t.prototype,"wheelYMoveScene",null),(0,j.e)([(0,a.G)()],t.prototype,"wheelZMoveScene",null),F.c.FreeCameraMouseWheelInput=t;class f{constructor(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=h,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=mh.Tools.IsSafari()}attachControl(h){h=mh.Tools.BackCompatCameraNoPreventDefault(arguments);let R=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=l=>{const j=l.event,a="mouse"===j.pointerType||this._isSafari&&"undefined"===typeof j.pointerType;if(this.allowMouse||!a)if(l.type===J.d.POINTERDOWN){if(h||j.preventDefault(),this._pointerPressed.push(j.pointerId),1!==this._pointerPressed.length)return;R={x:j.clientX,y:j.clientY}}else if(l.type===J.d.POINTERUP){h||j.preventDefault();const l=this._pointerPressed.indexOf(j.pointerId);if(-1===l)return;if(this._pointerPressed.splice(l,1),0!=l)return;R=null,this._offsetX=null,this._offsetY=null}else if(l.type===J.d.POINTERMOVE){if(h||j.preventDefault(),!R)return;if(0!=this._pointerPressed.indexOf(j.pointerId))return;this._offsetX=j.clientX-R.x,this._offsetY=-(j.clientY-R.y)}}),this._observer=this.camera.yh()._inputManager._addCameraPointerObserver(this._pointerInput,J.d.POINTERDOWN|J.d.POINTERUP|J.d.POINTERMOVE),this._onLostFocus){const h=this.camera.getEngine().getInputElement();h&&h.addEventListener("blur",this._onLostFocus)}}pJ(){if(this._pointerInput){if(this._observer&&(this.camera.yh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const h=this.camera.getEngine().getInputElement();h&&h.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const h=this.camera,R=h._calculateHandednessMultiplier();h.cameraRotation.y=R*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)h.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const R=h._computeLocalCameraSpeed(),l=new D.tR(0,0,0!==this.touchMoveSensibility?R*this._offsetY/this.touchMoveSensibility:0);D.Matrix.RotationYawPitchRollToRef(h.rotation.y,h.rotation.x,0,h._cameraRotationMatrix),h.cameraDirection.addInPlace(D.tR.TransformCoordinates(l,h._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,j.e)([(0,a.G)()],f.prototype,"touchAngularSensibility",void 0),(0,j.e)([(0,a.G)()],f.prototype,"touchMoveSensibility",void 0),F.c.FreeCameraTouchInput=f;class T extends F.f{constructor(h){super(h),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new u),this}addMouse(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new q(h),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new t,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new f),this}clear(){super.clear(),this._mouseInput=null}}var E=l(12852),x=l(12797);class G extends U.c{get angularSensibility(){const h=this.inputs.attached.mouse;return h?h.angularSensibility:0}set angularSensibility(h){const R=this.inputs.attached.mouse;R&&(R.angularSensibility=h)}get keysUp(){const h=this.inputs.attached.keyboard;return h?h.keysUp:[]}set keysUp(h){const R=this.inputs.attached.keyboard;R&&(R.keysUp=h)}get keysUpward(){const h=this.inputs.attached.keyboard;return h?h.keysUpward:[]}set keysUpward(h){const R=this.inputs.attached.keyboard;R&&(R.keysUpward=h)}get keysDown(){const h=this.inputs.attached.keyboard;return h?h.keysDown:[]}set keysDown(h){const R=this.inputs.attached.keyboard;R&&(R.keysDown=h)}get keysDownward(){const h=this.inputs.attached.keyboard;return h?h.keysDownward:[]}set keysDownward(h){const R=this.inputs.attached.keyboard;R&&(R.keysDownward=h)}get keysLeft(){const h=this.inputs.attached.keyboard;return h?h.keysLeft:[]}set keysLeft(h){const R=this.inputs.attached.keyboard;R&&(R.keysLeft=h)}get keysRight(){const h=this.inputs.attached.keyboard;return h?h.keysRight:[]}set keysRight(h){const R=this.inputs.attached.keyboard;R&&(R.keysRight=h)}get keysRotateLeft(){const h=this.inputs.attached.keyboard;return h?h.keysRotateLeft:[]}set keysRotateLeft(h){const R=this.inputs.attached.keyboard;R&&(R.keysRotateLeft=h)}get keysRotateRight(){const h=this.inputs.attached.keyboard;return h?h.keysRotateRight:[]}set keysRotateRight(h){const R=this.inputs.attached.keyboard;R&&(R.keysRotateRight=h)}get keysRotateUp(){const h=this.inputs.attached.keyboard;return h?h.keysRotateUp:[]}set keysRotateUp(h){const R=this.inputs.attached.keyboard;R&&(R.keysRotateUp=h)}get keysRotateDown(){const h=this.inputs.attached.keyboard;return h?h.keysRotateDown:[]}set keysRotateDown(h){const R=this.inputs.attached.keyboard;R&&(R.keysRotateDown=h)}constructor(h,R,l){var j;super(h,R,l,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),j=this,this.ellipsoid=new D.tR(.5,1,.5),this.ellipsoidOffset=new D.tR(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=D.tR.Zero(),this._diffPosition=D.tR.Zero(),this._newPosition=D.tR.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;j._newPosition.D(R),j._newPosition.subtractToRef(j._oldPosition,j._diffPosition),j._diffPosition.length()>x.c.CollisionsEpsilon&&(j.position.addToRef(j._diffPosition,j._deferredPositionUpdate),j._deferOnly?j._deferredUpdated=!0:j.position.D(j._deferredPositionUpdate),j.UQ&&l&&j.UQ(l))},this.inputs=new T(this),this.inputs.addKeyboard().addMouse()}attachControl(h,R){R=mh.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(R)}pJ(){this.inputs.detachElement(),this.cameraDirection=new D.tR(0,0,0),this.cameraRotation=new D.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(h){this._collisionMask=isNaN(h)?-1:h}_collideWithWorld(h){let R;R=this.parent?D.tR.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,R.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const l=this.yh().collisionCoordinator;this._collider||(this._collider=l.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let j=h;this.applyGravity&&(j=h.add(this.yh().gravity)),l.getNewPosition(this._oldPosition,j,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=D.tR.Zero(),this._transformedDirection=D.tR.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(h){this._needMoveForGravity=h}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.yh().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"jc"}}(0,j.e)([(0,a.F)()],G.prototype,"ellipsoid",void 0),(0,j.e)([(0,a.F)()],G.prototype,"ellipsoidOffset",void 0),(0,j.e)([(0,a.G)()],G.prototype,"checkCollisions",void 0),(0,j.e)([(0,a.G)()],G.prototype,"applyGravity",void 0),(0,E.f)("BABYLON.FreeCamera",G)},15133:(h,R,l)=>{"use strict";l.d(R,{e:()=>D});var j=l(12995),a=l(15141);class D{constructor(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=l,this.Jc=[],this._maxBlockCapacity=R||64,this._selectionContent=new j.e(1024),this._creationFunc=h}update(h,R,l){a.b._CreateBlocks(h,R,l,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}uu(h){for(let R=0;R<this.Gu.length;R++){this.Gu[R].addEntry(h)}}wu(h){for(let R=0;R<this.Gu.length;R++){this.Gu[R].removeEntry(h)}}select(h,R){this._selectionContent.reset();for(let l=0;l<this.Gu.length;l++){this.Gu[l].select(h,this._selectionContent,R)}return R?this._selectionContent.concat(this.Jc):this._selectionContent.concatWithNoDuplicate(this.Jc),this._selectionContent}intersects(h,R,l){this._selectionContent.reset();for(let j=0;j<this.Gu.length;j++){this.Gu[j].intersects(h,R,this._selectionContent,l)}return l?this._selectionContent.concat(this.Jc):this._selectionContent.concatWithNoDuplicate(this.Jc),this._selectionContent}intersectsRay(h){this._selectionContent.reset();for(let R=0;R<this.Gu.length;R++){this.Gu[R].intersectsRay(h,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Jc),this._selectionContent}}D.CreationFuncForMeshes=(h,R)=>{const l=h.getBoundingInfo();!h.isBlocked&&l.boundingBox.intersectsMinMax(R.Cc,R.Zc)&&R.entries.push(h)},D.CreationFuncForSubMeshes=(h,R)=>{h.getBoundingInfo().boundingBox.intersectsMinMax(R.Cc,R.Zc)&&R.entries.push(h)}},15141:(h,R,l)=>{"use strict";l.d(R,{b:()=>D});var j=l(12900),a=l(13198);class D{constructor(h,R,l,j,a,D){this.entries=[],this.Xc=new Array,this._capacity=l,this._depth=j,this._maxDepth=a,this._creationFunc=D,this._minPoint=h,this._maxPoint=R,this.Xc.push(h.clone()),this.Xc.push(R.clone()),this.Xc.push(h.clone()),this.Xc[2].x=R.x,this.Xc.push(h.clone()),this.Xc[3].y=R.y,this.Xc.push(h.clone()),this.Xc[4].z=R.z,this.Xc.push(R.clone()),this.Xc[5].z=h.z,this.Xc.push(R.clone()),this.Xc[6].x=h.x,this.Xc.push(R.clone()),this.Xc[7].y=h.y}get tl(){return this._capacity}get Cc(){return this._minPoint}get Zc(){return this._maxPoint}addEntry(h){if(this.Gu)for(let R=0;R<this.Gu.length;R++){this.Gu[R].addEntry(h)}else this._creationFunc(h,this),this.entries.length>this.tl&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(h){if(this.Gu){for(let R=0;R<this.Gu.length;R++){this.Gu[R].removeEntry(h)}return}const R=this.entries.indexOf(h);R>-1&&this.entries.splice(R,1)}addEntries(h){for(let R=0;R<h.length;R++){const l=h[R];this.addEntry(l)}}select(h,R,l){if(a.c.IsInFrustum(this.Xc,h)){if(this.Gu){for(let j=0;j<this.Gu.length;j++){this.Gu[j].select(h,R,l)}return}l?R.concat(this.entries):R.concatWithNoDuplicate(this.entries)}}intersects(h,R,l,j){if(a.c.IntersectsSphere(this._minPoint,this._maxPoint,h,R)){if(this.Gu){for(let a=0;a<this.Gu.length;a++){this.Gu[a].intersects(h,R,l,j)}return}j?l.concat(this.entries):l.concatWithNoDuplicate(this.entries)}}intersectsRay(h,R){if(h.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Gu){for(let l=0;l<this.Gu.length;l++){this.Gu[l].intersectsRay(h,R)}return}R.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){D._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(h,R,l,a,U,F,w,mh){w.Gu=new Array;const u=new j.tR((R.x-h.x)/2,(R.y-h.y)/2,(R.z-h.z)/2);for(let j=0;j<2;j++)for(let R=0;R<2;R++)for(let c=0;c<2;c++){const J=h.add(u.multiplyByFloats(j,R,c)),q=h.add(u.multiplyByFloats(j+1,R+1,c+1)),Q=new D(J,q,a,U+1,F,mh);Q.addEntries(l),w.Gu.push(Q)}}}},15147:(h,R,l)=>{"use strict";l.d(R,{e:()=>u});var j=l(13126),a=l(12900),D=l(13293),U=l(14293),F=l(13151),w=l(15133),mh=l(12749);j.e.prototype.createOrUpdateSelectionOctree=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,l=this._getComponent(F.c.NAME_OCTREE);l||(l=new u(this),this.DF(l)),this.ac||(this.ac=new w.e(w.e.CreationFuncForMeshes,h,R));const j=this.getWorldExtends();return this.ac.update(j.min,j.max,this.meshes),this.ac},Object.defineProperty(j.e.prototype,"selectionOctree",{get:function(){return this.ac},enumerable:!0,configurable:!0}),D.c.prototype.createOrUpdateSubmeshesOctree=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const l=this.yh();let j=l._getComponent(F.c.NAME_OCTREE);j||(j=new u(l),l.DF(j)),this._submeshesOctree||(this._submeshesOctree=new w.e(w.e.CreationFuncForSubMeshes,h,R)),this.EF(!0);const a=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(a.minimumWorld,a.maximumWorld,this.YF),this._submeshesOctree};class u{constructor(h){this.name=F.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new U.d(a.tR.Zero(),new a.tR(1,1,1)),(h=h||mh.b.LastCreatedScene)&&(this.TR=h,this.TR.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.TR.getActiveSubMeshCandidates=h=>this.getActiveSubMeshCandidates(h),this.TR.getCollidingSubMeshCandidates=(h,R)=>this.getCollidingSubMeshCandidates(h,R),this.TR.getIntersectingSubMeshCandidates=(h,R)=>this.getIntersectingSubMeshCandidates(h,R))}register(){this.TR.onMeshRemovedObservable.add((h=>{const R=this.TR.selectionOctree;if(void 0!==R&&null!==R){const l=R.Jc.indexOf(h);-1!==l&&R.Jc.splice(l,1)}})),this.TR.onMeshImportedObservable.add((h=>{const R=this.TR.selectionOctree;void 0!==R&&null!==R&&R.uu(h)}))}getActiveMeshCandidates(){var h;return(null===(h=this.TR.ac)||void 0===h?void 0:h.select(this.TR.frustumPlanes))||this.TR._getDefaultMeshCandidates()}getActiveSubMeshCandidates(h){if(h._submeshesOctree&&h.useOctreeForRenderingSelection){return h._submeshesOctree.select(this.TR.frustumPlanes)}return this.TR._getDefaultSubMeshCandidates(h)}getIntersectingSubMeshCandidates(h,R){if(h._submeshesOctree&&h.useOctreeForPicking){U.d.TransformToRef(R,h.getWorldMatrix(),this._tempRay);return h._submeshesOctree.intersectsRay(this._tempRay)}return this.TR._getDefaultSubMeshCandidates(h)}getCollidingSubMeshCandidates(h,R){if(h._submeshesOctree&&h.useOctreeForCollisions){const l=R._velocityWorldLength+Math.max(R._radius.x,R._radius.y,R._radius.z);return h._submeshesOctree.intersects(R._basePointWorld,l)}return this.TR._getDefaultSubMeshCandidates(h)}rebuild(){}dispose(){}}},14293:(h,R,l)=>{"use strict";l.d(R,{d:()=>q});var j=l(13126),a=l(13313),D=l(12902),U=l(12900),F=l(12910),w=l(13186),mh=l(13147),u=l(12749),c=l(13168);const J={internalPickerForMesh:void 0};class q{constructor(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:D.d;this.origin=h,this.direction=R,this.length=l,this.epsilon=j}clone(){return new q(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const j=q._TmpVector3[0].OF(h.x-l,h.y-l,h.z-l),a=q._TmpVector3[1].OF(R.x+l,R.y+l,R.z+l);let D,U,F,w,mh=0,u=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<j.x||this.origin.x>a.x)return!1}else if(D=1/this.direction.x,U=(j.x-this.origin.x)*D,F=(a.x-this.origin.x)*D,F===-1/0&&(F=1/0),U>F&&(w=U,U=F,F=w),mh=Math.max(U,mh),u=Math.min(F,u),mh>u)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<j.y||this.origin.y>a.y)return!1}else if(D=1/this.direction.y,U=(j.y-this.origin.y)*D,F=(a.y-this.origin.y)*D,F===-1/0&&(F=1/0),U>F&&(w=U,U=F,F=w),mh=Math.max(U,mh),u=Math.min(F,u),mh>u)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<j.z||this.origin.z>a.z)return!1}else if(D=1/this.direction.z,U=(j.z-this.origin.z)*D,F=(a.z-this.origin.z)*D,F===-1/0&&(F=1/0),U>F&&(w=U,U=F,F=w),mh=Math.max(U,mh),u=Math.min(F,u),mh>u)return!1;return!0}intersectsBox(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(h.minimum,h.maximum,R)}intersectsSphere(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=h.center.x-this.origin.x,j=h.center.y-this.origin.y,a=h.center.z-this.origin.z,D=l*l+j*j+a*a,U=h.radius+R,F=U*U;if(D<=F)return!0;const w=l*this.direction.x+j*this.direction.y+a*this.direction.z;if(w<0)return!1;return D-w*w<=F}intersectsTriangle(h,R,l){const j=q._TmpVector3[0],a=q._TmpVector3[1],D=q._TmpVector3[2],F=q._TmpVector3[3],mh=q._TmpVector3[4];R.subtractToRef(h,j),l.subtractToRef(h,a),U.tR.CrossToRef(this.direction,a,D);const u=U.tR.Dot(j,D);if(0===u)return null;const c=1/u;this.origin.subtractToRef(h,F);const J=U.tR.Dot(F,D)*c;if(J<-this.epsilon||J>1+this.epsilon)return null;U.tR.CrossToRef(F,j,mh);const Q=U.tR.Dot(this.direction,mh)*c;if(Q<-this.epsilon||J+Q>1+this.epsilon)return null;const Y=U.tR.Dot(a,mh)*c;return Y>this.length?null:new w.b(1-J-Q,J,Y)}intersectsPlane(h){let R;const l=U.tR.Dot(h.normal,this.direction);if(Math.abs(l)<9.99999997475243e-7)return null;{const j=U.tR.Dot(h.normal,this.origin);return R=(-h.d-j)/l,R<0?R<-9.99999997475243e-7?null:0:R}}intersectsAxis(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(h){case"y":{const h=(this.origin.y-R)/this.direction.y;return h>0?null:new U.tR(this.origin.x+this.direction.x*-h,R,this.origin.z+this.direction.z*-h)}case"x":{const h=(this.origin.x-R)/this.direction.x;return h>0?null:new U.tR(R,this.origin.y+this.direction.y*-h,this.origin.z+this.direction.z*-h)}case"z":{const h=(this.origin.z-R)/this.direction.z;return h>0?null:new U.tR(this.origin.x+this.direction.x*-h,this.origin.y+this.direction.y*-h,R)}default:return null}}intersectsMesh(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=U.TmpVectors.Matrix[0];return h.getWorldMatrix().invertToRef(F),this._tmpRay?q.TransformToRef(this,F,this._tmpRay):this._tmpRay=q.Transform(this,F),h.intersects(this._tmpRay,R,l,j,a,D)}intersectsMeshes(h,R,l){l?l.length=0:l=[];for(let j=0;j<h.length;j++){const a=this.intersectsMesh(h[j],R);a.hit&&l.push(a)}return l.sort(this._comparePickingInfo),l}_comparePickingInfo(h,R){return h.distance<R.distance?-1:h.distance>R.distance?1:0}intersectionSegment(h,R,l){const j=this.origin,a=U.TmpVectors.tR[0],D=U.TmpVectors.tR[1],F=U.TmpVectors.tR[2],w=U.TmpVectors.tR[3];R.subtractToRef(h,a),this.direction.scaleToRef(q._Rayl,F),j.addToRef(F,D),h.subtractToRef(j,w);const mh=U.tR.Dot(a,a),u=U.tR.Dot(a,F),c=U.tR.Dot(F,F),J=U.tR.Dot(a,w),Q=U.tR.Dot(F,w),Y=mh*c-u*u;let s,t,f=Y,T=Y;Y<q._Smallnum?(s=0,f=1,t=Q,T=c):(s=u*Q-c*J,t=mh*Q-u*J,s<0?(s=0,t=Q,T=c):s>f&&(s=f,t=Q+u,T=c)),t<0?(t=0,-J<0?s=0:-J>mh?s=f:(s=-J,f=mh)):t>T&&(t=T,-J+u<0?s=0:-J+u>mh?s=f:(s=-J+u,f=mh));const E=Math.abs(s)<q._Smallnum?0:s/f,x=Math.abs(t)<q._Smallnum?0:t/T,G=U.TmpVectors.tR[4];F.scaleToRef(x,G);const p=U.TmpVectors.tR[5];a.scaleToRef(E,p),p.addInPlace(w);const O=U.TmpVectors.tR[6];p.subtractToRef(G,O);return x>0&&x<=this.length&&O.lengthSquared()<l*l?p.length():-1}update(h,R,l,j,a,D,F){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){q._RayDistant||(q._RayDistant=q.Zero()),q._RayDistant.unprojectRayToRef(h,R,l,j,U.Matrix.IdentityReadOnly,D,F);const w=U.TmpVectors.Matrix[0];a.invertToRef(w),q.TransformToRef(q._RayDistant,w,this)}else this.unprojectRayToRef(h,R,l,j,a,D,F);return this}static Zero(){return new q(U.tR.Zero(),U.tR.Zero())}static CreateNew(h,R,l,j,a,D,U){return q.Zero().update(h,R,l,j,a,D,U)}static CreateNewFromTo(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.Matrix.IdentityReadOnly;const j=new q(new U.tR(0,0,0),new U.tR(0,0,0));return q.CreateFromToToRef(h,R,j,l)}static CreateFromToToRef(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:U.Matrix.IdentityReadOnly;l.origin.D(h);const a=R.subtractToRef(h,l.direction),D=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);return l.length=D,l.direction.normalize(),q.TransformToRef(l,j,l)}static Transform(h,R){const l=new q(new U.tR(0,0,0),new U.tR(0,0,0));return q.TransformToRef(h,R,l),l}static TransformToRef(h,R,l){U.tR.TransformCoordinatesToRef(h.origin,R,l.origin),U.tR.TransformNormalToRef(h.direction,R,l.direction),l.length=h.length,l.epsilon=h.epsilon;const j=l.direction,a=j.length();if(0!==a&&1!==a){const h=1/a;j.x*=h,j.y*=h,j.z*=h,l.length*=a}return l}unprojectRayToRef(h,R,l,j,a,D,F){const w=U.TmpVectors.Matrix[0];a.multiplyToRef(D,w),w.multiplyToRef(F,w),w.invert();const mh=u.b.LastCreatedEngine,c=U.TmpVectors.tR[0];c.x=h/l*2-1,c.y=-(R/j*2-1),c.z=null!==mh&&void 0!==mh&&mh.UF?1:null!==mh&&void 0!==mh&&mh.isNDCHalfZRange?0:-1;const J=U.TmpVectors.tR[1].OF(c.x,c.y,1-1e-8),q=U.TmpVectors.tR[2],Q=U.TmpVectors.tR[3];U.tR._UnprojectFromInvertedMatrixToRef(c,w,q),U.tR._UnprojectFromInvertedMatrixToRef(J,w,Q),this.origin.D(q),Q.subtractToRef(q,this.direction),this.direction.normalize()}}function Q(h,R,l,j,a){let D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const U=q.Zero();return Y(h,R,l,j,U,a,D),U}function Y(h,R,l,j,a,D){let F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const mh=h.getEngine();if(!D&&!(D=h.activeCamera))return h;const u=D.viewport,c=mh.getRenderHeight(),{x:J,y:q,width:Q,height:Y}=u.toGlobal(mh.getRenderWidth(),c),s=1/mh.getHardwareScalingLevel();return R=R*s-J,l=l*s-(c-q-Y),a.update(R,l,Q,Y,j||U.Matrix.IdentityReadOnly,F?U.Matrix.IdentityReadOnly:D.getViewMatrix(),D.getProjectionMatrix(),w),h}function s(h,R,l,j,a){if(!mh.c)return h;const D=h.getEngine();if(!a&&!(a=h.activeCamera))throw new Error("Active camera not set");const F=a.viewport,w=D.getRenderHeight(),{x:u,y:c,width:J,height:q}=F.toGlobal(D.getRenderWidth(),w),Q=U.Matrix.Identity(),Y=1/D.getHardwareScalingLevel();return R=R*Y-u,l=l*Y-(w-c-q),j.update(R,l,J,q,Q,Q,a.getProjectionMatrix()),h}function t(h,R,l,j,a,D,U,F){const w=R(j,l.enableDistantPicking),mh=l.intersects(w,a,U,D,j,F);return mh&&mh.hit?!a&&null!=h&&mh.distance>=h.distance?null:mh:null}function f(h,R,l,j,a,D){let F=null;const w=!!(h.activeCameras&&h.activeCameras.length>1&&h.cameraToUseForPointers!==h.activeCamera),u=h.cameraToUseForPointers||h.activeCamera,c=J.internalPickerForMesh||t;for(let mh=0;mh<h.meshes.length;mh++){const J=h.meshes[mh];if(l){if(!l(J,-1))continue}else if(!J.isEnabled()||!J.isVisible||!J.Sw)continue;const q=w&&J.isWorldMatrixCameraDependent(),Q=J.EF(q,u);if(J.hasThinInstances&&J.ym){const h=c(F,R,J,Q,!0,!0,D);if(h){if(a)return h;const w=U.TmpVectors.Matrix[1],mh=J.thinInstanceGetWorldMatrices();for(let h=0;h<mh.length;h++){if(l&&!l(J,h))continue;mh[h].multiplyToRef(Q,w);const U=c(F,R,J,w,j,a,D,!0);if(U&&(F=U,F.thinInstanceIndex=h,j))return F}}}else{const h=c(F,R,J,Q,j,a,D);if(h&&(F=h,j))return F}}return F||new mh.c}function T(h,R,l,j){if(!mh.c)return null;const a=[],D=!!(h.activeCameras&&h.activeCameras.length>1&&h.cameraToUseForPointers!==h.activeCamera),F=h.cameraToUseForPointers||h.activeCamera,w=J.internalPickerForMesh||t;for(let mh=0;mh<h.meshes.length;mh++){const u=h.meshes[mh];if(l){if(!l(u,-1))continue}else if(!u.isEnabled()||!u.isVisible||!u.Sw)continue;const c=D&&u.isWorldMatrixCameraDependent(),J=u.EF(c,F);if(u.hasThinInstances&&u.ym){if(w(null,R,u,J,!0,!0,j)){const h=U.TmpVectors.Matrix[1],D=u.thinInstanceGetWorldMatrices();for(let U=0;U<D.length;U++){if(l&&!l(u,U))continue;D[U].multiplyToRef(J,h);const F=w(null,R,u,h,!1,!1,j,!0);F&&(F.thinInstanceIndex=U,a.push(F))}}}else{const h=w(null,R,u,J,!1,!1,j);h&&a.push(h)}}return a}function E(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,j=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;j||(j=h.getWorldMatrix()),R.length=l,a?R.origin.D(a):R.origin.D(h.position);const D=U.TmpVectors.tR[2];D.set(0,0,h._scene.useRightHandedSystem?-1:1);const F=U.TmpVectors.tR[3];return U.tR.TransformNormalToRef(D,j,F),U.tR.NormalizeToRef(F,R.direction),R}var x,G;q._TmpVector3=(0,F.e)(6,U.tR.Zero),q._RayDistant=q.Zero(),q._Smallnum=1e-8,q._Rayl=1e9,x=j.e,(G=a.e)&&(G.prototype.getForwardRay=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,R=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return E(this,new q(U.tR.Zero(),U.tR.Zero(),h),h,R,l)},G.prototype.getForwardRayToRef=function(h){return E(this,h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),x&&(c.b._IsPickingAvailable=!0,x.prototype.createPickingRay=function(h,R,l,j){return Q(this,h,R,l,j,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),j.e.prototype.createPickingRayToRef=function(h,R,l,j,a){return Y(this,h,R,l,j,a,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},j.e.prototype.createPickingRayInCameraSpace=function(h,R,l){return function(h,R,l,j){const a=q.Zero();return s(h,R,l,a,j),a}(this,h,R,l)},j.e.prototype.createPickingRayInCameraSpaceToRef=function(h,R,l,j){return s(this,h,R,l,j)},j.e.prototype.pickWithBoundingInfo=function(h,R,l,j,a){return function(h,R,l,j,a,D){if(!mh.c)return null;const F=f(h,(j=>(h._tempPickingRay||(h._tempPickingRay=q.Zero()),Y(h,R,l,j,h._tempPickingRay,D||null),h._tempPickingRay)),j,a,!0);return F&&(F.ray=Q(h,R,l,U.Matrix.Identity(),D||null)),F}(this,h,R,l,j,a)},j.e.prototype.Ql=function(h,R,l,j,a,D){return function(h,R,l,j,a,D,F){const w=f(h,((j,a)=>(h._tempPickingRay||(h._tempPickingRay=q.Zero()),Y(h,R,l,j,h._tempPickingRay,D||null,!1,a),h._tempPickingRay)),j,a,!1,F);return w&&(w.ray=Q(h,R,l,U.Matrix.Identity(),D||null)),w}(this,h,R,l,j,a,D)},j.e.prototype.pickWithRay=function(h,R,l,j){return function(h,R,l,j,a){const D=f(h,(l=>(h._pickWithRayInverseMatrix||(h._pickWithRayInverseMatrix=U.Matrix.Identity()),l.invertToRef(h._pickWithRayInverseMatrix),h._cachedRayForTransform||(h._cachedRayForTransform=q.Zero()),q.TransformToRef(R,h._pickWithRayInverseMatrix,h._cachedRayForTransform),h._cachedRayForTransform)),l,j,!1,a);return D&&(D.ray=R),D}(this,h,R,l,j)},j.e.prototype.multiPick=function(h,R,l,j,a){return function(h,R,l,j,a,D){return T(h,(j=>Q(h,R,l,j,a||null)),j,D)}(this,h,R,l,j,a)},j.e.prototype.multiPickWithRay=function(h,R,l){return function(h,R,l,j){return T(h,(l=>(h._pickWithRayInverseMatrix||(h._pickWithRayInverseMatrix=U.Matrix.Identity()),l.invertToRef(h._pickWithRayInverseMatrix),h._cachedRayForTransform||(h._cachedRayForTransform=q.Zero()),q.TransformToRef(R,h._pickWithRayInverseMatrix,h._cachedRayForTransform),h._cachedRayForTransform)),l,j)}(this,h,R,l)}},14568:(h,R,l)=>{"use strict";var j=l(12835),a=l(12711),D=l(12758),U=l(12855),F=l(12797),w=l(12842);F.c.prototype._partialLoadFile=function(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(h,(h=>{l[R]=h,l._internalCount++,6===l._internalCount&&j(l)}),void 0,void 0,!0,((h,R)=>{a&&h&&a(h.status+" "+h.statusText,R)}))},F.c.prototype._cascadeLoadFiles=function(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=[];a._internalCount=0;for(let D=0;D<6;D++)this._partialLoadFile(l[D],D,a,R,j)},F.c.prototype._cascadeLoadImgs=function(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5?arguments[5]:void 0;const U=[];U._internalCount=0;for(let F=0;F<6;F++)this._partialLoadImg(j[F],F,U,h,R,l,a,D)},F.c.prototype._partialLoadImg=function(h,R,l,j,a,F){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mh=arguments.length>7?arguments[7]:void 0;const u=(0,U.e)();(0,D.l)(h,(h=>{l[R]=h,l._internalCount++,j&&j.removePendingData(u),6===l._internalCount&&F&&F(a,l)}),((h,R)=>{j&&j.removePendingData(u),w&&w(h,R)}),j?j.offlineProvider:null,mh),j&&j.addPendingData(u)},F.c.prototype.createCubeTextureBase=function(h,R,l,D){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mh=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,s=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,t=arguments.length>14&&void 0!==arguments[14]&&arguments[14],f=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const T=Q||new j.e(this,7);T.isCube=!0,T.url=h,T.generateMipMaps=!D,T._lodGenerationScale=J,T._lodGenerationOffset=q,T._useSRGBBuffer=!!t&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!D),T!==Q&&(T.label=h.substring(0,60)),this._doNotHandleContextLost||(T._extension=u,T._files=l,T._buffer=f);const E=h;this._transformTextureUrl&&!Q&&(h=this._transformTextureUrl(h));const x=u??function(h){const R=h.split("?")[0],l=R.lastIndexOf(".");return l>-1?R.substring(l).toLowerCase():""}(h),G=(0,w.e)(x),p=(h,R)=>{T.dispose(),F?F(h,R):h&&a.c.Warn(h)},O=(j,F)=>{h===E?j&&p(j.status+" "+j.statusText,F):(a.c.Warn(`Failed to load ${h}, falling back to the ${E}`),this.createCubeTextureBase(E,R,l,!!D,U,p,mh,u,c,J,q,T,Y,s,t,f))};if(G)G.then((j=>{const a=h=>{Y&&Y(T,h),j.loadCubeData(h,T,c,U,((h,R)=>{p(h,R)}))};f?a(f):l&&6===l.length?j.supportCascades?this._cascadeLoadFiles(R,(h=>a(h.map((h=>new Uint8Array(h))))),l,p):p("Textures type does not support cascades."):this._loadFile(h,(h=>a(new Uint8Array(h))),void 0,void 0,!0,O)}));else{if(!l||0===l.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(R,T,((h,R)=>{s&&s(h,R)}),l,p)}return this._internalTexturesCache.push(T),T}},15153:(h,R,l)=>{"use strict";l(12711);var j=l(13022);l(12835),l(12988),l(12829),l(13062),l(13029);j.c},14591:(h,R,l)=>{"use strict";l.d(R,{c:()=>a});var j=l(12852);class a{constructor(h){this.value=this._toInt(h)}_toInt(h){return 0|h}add(h){return new a(this.value+h.value)}fR(h){return new a(this.value-h.value)}multiply(h){return new a(Math.imul(this.value,h.value))}divide(h){return new a(this.value/h.value)}getClassName(){return a.ClassName}equals(h){return this.value===h.value}static FromValue(h){return new a(h)}toString(){return this.value.toString()}}a.ClassName="FlowGraphInteger",(0,j.f)("FlowGraphInteger",a)},14605:(h,R,l)=>{"use strict";l.d(R,{d:()=>a,h:()=>D});var j=l(12900);class a{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.cF=h}get m(){return this.cF}transformVector(h){return this.transformVectorToRef(h,new j.Vector2)}transformVectorToRef(h,R){return R.x=h.x*this.cF[0]+h.y*this.cF[1],R.y=h.x*this.cF[2]+h.y*this.cF[3],R}sF(){return this.toArray()}toArray(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let R=0;R<4;R++)h[R]=this.cF[R];return h}Yl(h){for(let R=0;R<4;R++)this.cF[R]=h[R];return this}multiplyToRef(h,R){const l=h.cF,j=this.cF,a=R.cF;return a[0]=l[0]*j[0]+l[1]*j[2],a[1]=l[0]*j[1]+l[1]*j[3],a[2]=l[2]*j[0]+l[3]*j[2],a[3]=l[2]*j[1]+l[3]*j[3],R}multiply(h){return this.multiplyToRef(h,new a)}divideToRef(h,R){const l=this.cF,j=h.cF,a=R.cF;return a[0]=l[0]/j[0],a[1]=l[1]/j[1],a[2]=l[2]/j[2],a[3]=l[3]/j[3],R}divide(h){return this.divideToRef(h,new a)}addToRef(h,R){const l=this.cF,j=h.m,a=R.m;return a[0]=l[0]+j[0],a[1]=l[1]+j[1],a[2]=l[2]+j[2],a[3]=l[3]+j[3],R}add(h){return this.addToRef(h,new a)}subtractToRef(h,R){const l=this.cF,j=h.m,a=R.m;return a[0]=l[0]-j[0],a[1]=l[1]-j[1],a[2]=l[2]-j[2],a[3]=l[3]-j[3],R}fR(h){return this.subtractToRef(h,new a)}transpose(){const h=this.cF;return new a([h[0],h[2],h[1],h[3]])}determinant(){const h=this.cF;return h[0]*h[3]-h[1]*h[2]}inverse(){const h=this.determinant();if(0===h)throw new Error("Matrix is not invertible");const R=this.cF,l=1/h;return new a([R[3]*l,-R[1]*l,-R[2]*l,R[0]*l])}equals(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=this.cF,j=h.m;return 0===R?l[0]===j[0]&&l[1]===j[1]&&l[2]===j[2]&&l[3]===j[3]:Math.abs(l[0]-j[0])<R&&Math.abs(l[1]-j[1])<R&&Math.abs(l[2]-j[2])<R&&Math.abs(l[3]-j[3])<R}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.cF.join(", ")})`}}class D{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.cF=h}get m(){return this.cF}transformVector(h){return this.transformVectorToRef(h,new j.tR)}transformVectorToRef(h,R){const l=this.cF;return R.x=h.x*l[0]+h.y*l[1]+h.z*l[2],R.y=h.x*l[3]+h.y*l[4]+h.z*l[5],R.z=h.x*l[6]+h.y*l[7]+h.z*l[8],R}multiplyToRef(h,R){const l=h.cF,j=this.cF,a=R.m;return a[0]=l[0]*j[0]+l[1]*j[3]+l[2]*j[6],a[1]=l[0]*j[1]+l[1]*j[4]+l[2]*j[7],a[2]=l[0]*j[2]+l[1]*j[5]+l[2]*j[8],a[3]=l[3]*j[0]+l[4]*j[3]+l[5]*j[6],a[4]=l[3]*j[1]+l[4]*j[4]+l[5]*j[7],a[5]=l[3]*j[2]+l[4]*j[5]+l[5]*j[8],a[6]=l[6]*j[0]+l[7]*j[3]+l[8]*j[6],a[7]=l[6]*j[1]+l[7]*j[4]+l[8]*j[7],a[8]=l[6]*j[2]+l[7]*j[5]+l[8]*j[8],R}multiply(h){return this.multiplyToRef(h,new D)}divideToRef(h,R){const l=this.cF,j=h.m,a=R.m;return a[0]=l[0]/j[0],a[1]=l[1]/j[1],a[2]=l[2]/j[2],a[3]=l[3]/j[3],a[4]=l[4]/j[4],a[5]=l[5]/j[5],a[6]=l[6]/j[6],a[7]=l[7]/j[7],a[8]=l[8]/j[8],R}divide(h){return this.divideToRef(h,new D)}addToRef(h,R){const l=this.cF,j=h.m,a=R.m;return a[0]=l[0]+j[0],a[1]=l[1]+j[1],a[2]=l[2]+j[2],a[3]=l[3]+j[3],a[4]=l[4]+j[4],a[5]=l[5]+j[5],a[6]=l[6]+j[6],a[7]=l[7]+j[7],a[8]=l[8]+j[8],R}add(h){return this.addToRef(h,new D)}subtractToRef(h,R){const l=this.cF,j=h.m,a=R.m;return a[0]=l[0]-j[0],a[1]=l[1]-j[1],a[2]=l[2]-j[2],a[3]=l[3]-j[3],a[4]=l[4]-j[4],a[5]=l[5]-j[5],a[6]=l[6]-j[6],a[7]=l[7]-j[7],a[8]=l[8]-j[8],R}fR(h){return this.subtractToRef(h,new D)}toArray(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let R=0;R<9;R++)h[R]=this.cF[R];return h}sF(){return this.toArray()}Yl(h){for(let R=0;R<9;R++)this.cF[R]=h[R];return this}transpose(){const h=this.cF;return new D([h[0],h[3],h[6],h[1],h[4],h[7],h[2],h[5],h[8]])}determinant(){const h=this.cF;return h[0]*(h[4]*h[8]-h[5]*h[7])-h[1]*(h[3]*h[8]-h[5]*h[6])+h[2]*(h[3]*h[7]-h[4]*h[6])}inverse(){const h=this.determinant();if(0===h)throw new Error("Matrix is not invertible");const R=this.cF,l=1/h;return new D([(R[4]*R[8]-R[5]*R[7])*l,(R[2]*R[7]-R[1]*R[8])*l,(R[1]*R[5]-R[2]*R[4])*l,(R[5]*R[6]-R[3]*R[8])*l,(R[0]*R[8]-R[2]*R[6])*l,(R[2]*R[3]-R[0]*R[5])*l,(R[3]*R[7]-R[4]*R[6])*l,(R[1]*R[6]-R[0]*R[7])*l,(R[0]*R[4]-R[1]*R[3])*l])}equals(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=this.cF,j=h.m;return 0===R?l[0]===j[0]&&l[1]===j[1]&&l[2]===j[2]&&l[3]===j[3]&&l[4]===j[4]&&l[5]===j[5]&&l[6]===j[6]&&l[7]===j[7]&&l[8]===j[8]:Math.abs(l[0]-j[0])<R&&Math.abs(l[1]-j[1])<R&&Math.abs(l[2]-j[2])<R&&Math.abs(l[3]-j[3])<R&&Math.abs(l[4]-j[4])<R&&Math.abs(l[5]-j[5])<R&&Math.abs(l[6]-j[6])<R&&Math.abs(l[7]-j[7])<R&&Math.abs(l[8]-j[8])<R}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.cF.join(", ")})`}}},14610:(h,R,l)=>{"use strict";var j;function a(h,R,l,j){switch(R){case"Animation":return j?h.animations.find((h=>h.uniqueId===l))??null:h.animations[l]??null;case"AnimationGroup":return j?h.animationGroups.find((h=>h.uniqueId===l))??null:h.animationGroups[l]??null;case"Mesh":return j?h.meshes.find((h=>h.uniqueId===l))??null:h.meshes[l]??null;case"Material":return j?h.materials.find((h=>h.uniqueId===l))??null:h.materials[l]??null;case"fu":return j?h.cameras.find((h=>h.uniqueId===l))??null:h.cameras[l]??null;case"Light":return j?h.lights.find((h=>h.uniqueId===l))??null:h.lights[l]??null;default:return null}}l.d(R,{b:()=>a}),function(h){h.Animation="Animation",h.AnimationGroup="AnimationGroup",h.Mesh="Mesh",h.Material="Material",h.fu="fu",h.Light="Light"}(j||(j={}))},14640:(h,R,l)=>{"use strict";l.d(R,{b:()=>a});var j=l(14646);class a extends j.c{constructor(h,R){if(super(h),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),R)for(const l of R)this._eventsSignalOutputs[l]=this._registerSignalOutput(l+"Event")}_executeOnTick(h){}_startPendingTasks(h){h._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(h),this._resetAfterCanceled(h)),this._preparePendingTasks(h),h._addPendingBlock(this),this.out._activateSignal(h),h._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(h){h._deleteExecutionVariable(this,"_initialized"),h._removePendingBlock(this)}}},14620:(h,R,l)=>{"use strict";l.d(R,{e:()=>mh});var j=l(12855),a=l(12852),D=l(14623),U=l(12696),F=l(14588);class w extends D.c{constructor(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:j.defaultValue,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(h,R,l),this.richType=j,this._defaultValue=a,this._optional=D,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new U.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(h){this._isDisabled!==h&&(this._isDisabled=h,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(h,R){R._getConnectionValue(this)!==h&&(R._setConnectionValue(this,h),this.onValueChangedObservable.notifyObservers(h))}resetToDefaultValue(h){h._setConnectionValue(this,this._defaultValue)}connectTo(h){this._isDisabled||super.connectTo(h)}_getValueOrDefault(h){const R=h._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(R):R}getValue(h){if(1===this.connectionType){h._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(h);const R=this._getValueOrDefault(h);return this._lastValue=R,this.richType.typeTransformer?this.richType.typeTransformer(R):R}const R=this.isConnected()?this._connectedPoint[0].getValue(h):this._getValueOrDefault(h);return this._lastValue=R,this.richType.typeTransformer?this.richType.typeTransformer(R):R}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(h),h.richType={},this.richType.serialize(h.richType),h.optional=this._optional,(0,F.f)("defaultValue",this._defaultValue,h)}}(0,a.f)("FlowGraphDataConnection",w);class mh{constructor(h){var R;this.config=h,this.uniqueId=(0,j.e)(),this.name=(null===(R=this.config)||void 0===R?void 0:R.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(h){}registerDataInput(h,R,l){const j=new w(h,0,this,R,l);return this.dataInputs.push(j),j}registerDataOutput(h,R,l){const j=new w(h,1,this,R,l);return this.dataOutputs.push(j),j}getDataInput(h){return this.dataInputs.find((R=>R.name===h))}getDataOutput(h){return this.dataOutputs.find((R=>R.name===h))}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.f;if(h.uniqueId=this.uniqueId,h.config={},this.config){const l=this.config,j=Object.keys(l);for(const a of j)R(a,l[a],h.config)}h.dataInputs=[],h.dataOutputs=[],h.className=this.getClassName();for(const l of this.dataInputs){const R={};l.serialize(R),h.dataInputs.push(R)}for(const l of this.dataOutputs){const R={};l.serialize(R),h.dataOutputs.push(R)}}deserialize(h){}_log(h,R,l){var j;null===(j=h.logger)||void 0===j||j.addLogItem({action:R,sl:l,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14623:(h,R,l)=>{"use strict";l.d(R,{c:()=>D});var j,a=l(12855);!function(h){h[h.Input=0]="Input",h[h.Output=1]="Output"}(j||(j={}));class D{constructor(h,R,l){this._ownerBlock=l,this._connectedPoint=[],this.uniqueId=(0,a.e)(),this.connectedPointIds=[],this.name=h,this._connectionType=R}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(h){if(this._connectionType===h._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||h._isSingularConnection()&&h._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(h),h._connectedPoint.push(this)}disconnectFrom(h){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const l=this._connectedPoint.indexOf(h),j=h._connectedPoint.indexOf(this);-1!==l&&-1!==j&&(R&&this._connectedPoint.splice(l,1),h._connectedPoint.splice(j,1))}disconnectFromAll(){for(const h of this._connectedPoint)this.disconnectFrom(h,!1);this._connectedPoint.length=0}dispose(){for(const h of this._connectedPoint)this.disconnectFrom(h)}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h.uniqueId=this.uniqueId,h.name=this.name,h._connectionType=this._connectionType,h.connectedPointIds=[],h.className=this.getClassName();for(const R of this._connectedPoint)h.connectedPointIds.push(R.uniqueId)}getClassName(){return"FGConnection"}deserialize(h){this.uniqueId=h.uniqueId,this.name=h.name,this._connectionType=h._connectionType,this.connectedPointIds=h.connectedPointIds}}},14580:(h,R,l)=>{"use strict";l.d(R,{b:()=>T});var j,a=l(12696),D=l(12882),U=l(12887),F=l(12855),w=l(14588),mh=l(14610),u=l(12711);!function(h){h.ExecuteBlock="ExecuteBlock",h.ExecuteEvent="ExecuteEvent",h.TriggerConnection="TriggerConnection",h.ContextVariableSet="ContextVariableSet",h.GlobalVariableSet="GlobalVariableSet",h.GlobalVariableDelete="GlobalVariableDelete",h.GlobalVariableGet="GlobalVariableGet",h.AddConnection="AddConnection",h.GetConnectionValue="GetConnectionValue",h.SetConnectionValue="SetConnectionValue",h.ActivateSignal="ActivateSignal",h.ContextVariableGet="ContextVariableGet"}(j||(j={}));class c{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(h){if(h.time||(h.time=Date.now()),this.log.push(h),this.logToConsole){var R;const l=null===(R=h.sl)||void 0===R?void 0:R.value;"object"===typeof l&&l.getClassName?u.c.Log(`[FGLog] ${h.className}:${h.uniqueId.split("-")[0]} ${h.action} - ${JSON.stringify(l.getClassName())}: ${l.toString()}`):u.c.Log(`[FGLog] ${h.className}:${h.uniqueId.split("-")[0]} ${h.action} - ${JSON.stringify(h.sl)}`)}}getItemsOfType(h){return this.log.filter((R=>R.action===h))}}class J{get enableLogging(){return this._enableLogging}set enableLogging(h){this._enableLogging!==h&&(this._enableLogging=h,this._enableLogging?(this.logger=new c,this.logger.logToConsole=!0):this.logger=null)}constructor(h){this.uniqueId=(0,F.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new a.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=h,this.assetsContext=h.assetsContext??h.TR}hasVariable(h){return h in this._userVariables}setVariable(h,R){var l;this._userVariables[h]=R,null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",sl:{name:h,value:R}})}getAsset(h,R){return(0,mh.b)(this.assetsContext,h,R)}getVariable(h){var R;return null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",sl:{name:h,value:this._userVariables[h]}}),this._userVariables[h]}get userVariables(){return this._userVariables}yh(){return this._configuration.TR}_getUniqueIdPrefixedName(h,R){return`${h.uniqueId}_${R}`}_getGlobalContextVariable(h,R){var l;return null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",sl:{name:h,defaultValue:R,possibleValue:this._globalContextVariables[h]}}),this._hasGlobalContextVariable(h)?this._globalContextVariables[h]:R}_setGlobalContextVariable(h,R){var l;null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",sl:{name:h,value:R}}),this._globalContextVariables[h]=R}_deleteGlobalContextVariable(h){var R;null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",sl:{name:h}}),delete this._globalContextVariables[h]}_hasGlobalContextVariable(h){return h in this._globalContextVariables}_setExecutionVariable(h,R,l){this._executionVariables[this._getUniqueIdPrefixedName(h,R)]=l}_getExecutionVariable(h,R,l){return this._hasExecutionVariable(h,R)?this._executionVariables[this._getUniqueIdPrefixedName(h,R)]:l}_deleteExecutionVariable(h,R){delete this._executionVariables[this._getUniqueIdPrefixedName(h,R)]}_hasExecutionVariable(h,R){return this._getUniqueIdPrefixedName(h,R)in this._executionVariables}_hasConnectionValue(h){return h.uniqueId in this._connectionValues}_setConnectionValue(h,R){var l;this._connectionValues[h.uniqueId]=R,null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",sl:{connectionPointId:h.uniqueId,value:R}})}_setConnectionValueByKey(h,R){this._connectionValues[h]=R}_getConnectionValue(h){var R;return null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",sl:{connectionPointId:h.uniqueId,value:this._connectionValues[h.uniqueId]}}),this._connectionValues[h.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(h){this._pendingBlocks.includes(h)||(this._pendingBlocks.push(h),this._pendingBlocks.sort(((h,R)=>h.priority-R.priority)))}_removePendingBlock(h){const R=this._pendingBlocks.indexOf(h);-1!==R&&this._pendingBlocks.splice(R,1)}_clearPendingBlocks(){for(const h of this._pendingBlocks)h._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(h){var R;this.onNodeExecutedObservable.notifyObservers(h),null===(R=this.logger)||void 0===R||R.addLogItem({time:Date.now(),className:h.getClassName(),uniqueId:h.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(h){this._setGlobalContextVariable("timeSinceStart",h.timeSinceStart),this._setGlobalContextVariable("deltaTime",h.deltaTime);for(const l of this._pendingBlocks){var R;null===(R=l._executeOnTick)||void 0===R||R.call(l,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.f;h.uniqueId=this.uniqueId,h._userVariables={};for(const j in this._userVariables)R(j,this._userVariables[j],h._userVariables);h._connectionValues={};for(const j in this._connectionValues)R(j,this._connectionValues[j],h._connectionValues);var l;this.assetsContext!==this.yh()&&(h._assetsContext={meshes:this.assetsContext.meshes.map((h=>h.id)),materials:this.assetsContext.materials.map((h=>h.id)),textures:this.assetsContext.textures.map((h=>h.name)),animations:this.assetsContext.animations.map((h=>h.name)),lights:this.assetsContext.lights.map((h=>h.id)),cameras:this.assetsContext.cameras.map((h=>h.id)),Oq:null===(l=this.assetsContext.Oq)||void 0===l?void 0:l.map((h=>h.name)),skeletons:this.assetsContext.skeletons.map((h=>h.id)),SJ:this.assetsContext.SJ.map((h=>h.name)),geometries:this.assetsContext.geometries.map((h=>h.id)),multiMaterials:this.assetsContext.multiMaterials.map((h=>h.id)),transformNodes:this.assetsContext.transformNodes.map((h=>h.id))})}getClassName(){return"FlowGraphContext"}}(0,D.e)([(0,U.G)()],J.prototype,"uniqueId",void 0);var q=l(14615),Q=l(13153);class Y{constructor(h){this.onEventTriggeredObservable=new a.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=h,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.mw.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const h=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",sl:{timeSinceStart:this._startingTime,deltaTime:h}}),this._startingTime+=h})),this._meshPickedObserver=this._scene.onPointerObservable.add((h=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",sl:h})}),Q.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((h=>{const R=h.pointerId,l=h.mesh,j=this._pointerUnderMeshState[R];!j&&l?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",sl:{pointerId:R,mesh:l}}):j&&!l?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",sl:{pointerId:R,mesh:j}}):j&&l&&j!==l&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",sl:{pointerId:R,mesh:j,over:l}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",sl:{pointerId:R,mesh:l,out:j}})),this._pointerUnderMeshState[R]=l}),Q.d.POINTERMOVE)}dispose(){var h,R,l,j,a;null===(h=this._sceneDisposeObserver)||void 0===h||h.remove(),null===(R=this._sceneReadyObserver)||void 0===R||R.remove(),null===(l=this._sceneOnBeforeRenderObserver)||void 0===l||l.remove(),null===(j=this._meshPickedObserver)||void 0===j||j.remove(),null===(a=this._meshUnderPointerObserver)||void 0===a||a.remove(),this.onEventTriggeredObservable.clear()}}var s,t=l(14629);!function(h){h[h.Stopped=0]="Stopped",h[h.Started=1]="Started"}(s||(s={}));class f{get state(){return this._state}set state(h){this._state=h,this.onStateChangedObservable.notifyObservers(h)}constructor(h){this.onStateChangedObservable=new a.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=h.TR,this._sceneEventCoordinator=new Y(this._scene),this._coordinator=h.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((h=>{for(const R of this._executionContexts){const l=this._getContextualOrder(h.type,R);for(const j of l)if(!j._executeEvent(R,h.sl))break}switch(h.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const R of this._executionContexts)R._notifyOnTick(h.sl);break;case"SceneDispose":this.dispose()}}))}createContext(){const h=new J({TR:this._scene,coordinator:this._coordinator});return this._executionContexts.push(h),h}getContext(h){return this._executionContexts[h]}addEventBlock(h){if("PointerOver"!==h.type&&"PointerOut"!==h.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==h.type&&this._eventBlocks[h.type].push(h),1===this.state)for(const R of this._executionContexts)h._startPendingTasks(R);else this.onStateChangedObservable.addOnce((R=>{if(1===R)for(const l of this._executionContexts)h._startPendingTasks(l)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((h=>{1===h&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const h of this._executionContexts)for(const R in this._eventBlocks){const l=this._getContextualOrder(R,h);for(const R of l)R._startPendingTasks(h)}}_getContextualOrder(h,R){const l=this._eventBlocks[h].sort(((h,R)=>R.initPriority-h.initPriority));if("MeshPick"===h){const h=[];for(const j of l){const a=j.asset.getValue(R);let D=0;for(;D<l.length;D++){const h=l[D].asset.getValue(R);if(a&&h&&(0,t.o)(a,h))break}h.splice(D,0,j)}return h}return l}dispose(){var h;if(0!==this.state){this.state=0;for(const h of this._executionContexts)h._clearPendingBlocks();this._executionContexts.length=0;for(const h in this._eventBlocks)this._eventBlocks[h].length=0;null===(h=this._eventObserver)||void 0===h||h.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(h){const R=[],l=new Set;for(const j in this._eventBlocks)for(const h of this._eventBlocks[j])R.push(h),l.add(h.uniqueId);for(;R.length>0;){const j=R.pop();h(j);for(const h of j.dataInputs)for(const j of h._connectedPoint)l.has(j._ownerBlock.uniqueId)||(R.push(j._ownerBlock),l.add(j._ownerBlock.uniqueId));if(j instanceof q.e)for(const h of j.signalOutputs)for(const j of h._connectedPoint)l.has(j._ownerBlock.uniqueId)||(R.push(j._ownerBlock),l.add(j._ownerBlock.uniqueId))}}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},R=arguments.length>1?arguments[1]:void 0;h.allBlocks=[],this.visitAllBlocks((R=>{const l={};R.serialize(l),h.allBlocks.push(l)})),h.executionContexts=[];for(const l of this._executionContexts){const j={};l.serialize(j,R),h.executionContexts.push(j)}}}class T{constructor(h){this.config=h,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.TR.mw.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.TR.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const h=this._executeOnNextFrame.slice(0);if(h.length)for(const R of h){this.notifyCustomEvent(R.id,R.data,!1);const h=this._executeOnNextFrame.findIndex((h=>h.uniqueId===R.uniqueId));-1!==h&&this._executeOnNextFrame.splice(h,1)}}));(T.SceneCoordinators.get(this.config.TR)??[]).push(this)}createGraph(){const h=new f({TR:this.config.TR,coordinator:this});return this._flowGraphs.push(h),h}removeGraph(h){const R=this._flowGraphs.indexOf(h);-1!==R&&(h.dispose(),this._flowGraphs.splice(R,1))}start(){for(const h of this._flowGraphs)h.start()}dispose(){var h,R;for(const a of this._flowGraphs)a.dispose();this._flowGraphs.length=0,null===(h=this._disposeObserver)||void 0===h||h.remove(),null===(R=this._onBeforeRenderObserver)||void 0===R||R.remove();const l=T.SceneCoordinators.get(this.config.TR)??[],j=l.indexOf(this);-1!==j&&l.splice(j,1)}serialize(h,R){h._flowGraphs=[];for(const l of this._flowGraphs){const j={};l.serialize(j,R),h._flowGraphs.push(j)}h.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(h){let R=this._customEventsMap.get(h);return R||(R=new a.d,this._customEventsMap.set(h,R)),R}notifyCustomEvent(h,R){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:h,data:R,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(h)){const R=this._eventExecutionCounter.get(h);if(this._eventExecutionCounter.set(h,R+1),R>=T.MaxEventTypeExecutionPerFrame)return void(R===T.MaxEventTypeExecutionPerFrame&&u.c.Warn(`FlowGraphCoordinator: Too many executions of event "${h}".`))}else this._eventExecutionCounter.set(h,1);const l=this._customEventsMap.get(h);l&&l.notifyObservers(R)}}T.MaxEventsPerType=30,T.MaxEventTypeExecutionPerFrame=30,T.SceneCoordinators=new Map},14635:(h,R,l)=>{"use strict";l.d(R,{e:()=>a});var j=l(14640);class a extends j.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(h){h._notifyExecuteNode(this),this.done._activateSignal(h)}}},14615:(h,R,l)=>{"use strict";l.d(R,{e:()=>F});var j=l(14620),a=l(14623),D=l(12852);class U extends a.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(h){super.connectTo(h),this._connectedPoint.sort(((h,R)=>R.priority-h.priority))}_activateSignal(h){var R;if(null===(R=h.logger)||void 0===R||R.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,sl:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)h._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(h,this),h._increaseExecutionId();else for(const l of this._connectedPoint)l._activateSignal(h)}}(0,D.f)("FlowGraphSignalConnection",U);class F extends j.e{constructor(h){super(h),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(h){const R=new U(h,0,this);return this.signalInputs.push(R),R}_registerSignalOutput(h){const R=new U(h,1,this);return this.signalOutputs.push(R),R}_unregisterSignalInput(h){const R=this.signalInputs.findIndex((R=>R.name===h));-1!==R&&(this.signalInputs[R].dispose(),this.signalInputs.splice(R,1))}_unregisterSignalOutput(h){const R=this.signalOutputs.findIndex((R=>R.name===h));-1!==R&&(this.signalOutputs[R].dispose(),this.signalOutputs.splice(R,1))}_reportError(h,R){this.error.sl="string"===typeof R?new Error(R):R,this.error._activateSignal(h)}getSignalInput(h){return this.signalInputs.find((R=>R.name===h))}getSignalOutput(h){return this.signalOutputs.find((R=>R.name===h))}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(h),h.signalInputs=[],h.signalOutputs=[];for(const R of this.signalInputs){const l={};R.serialize(l),h.signalInputs.push(l)}for(const R of this.signalOutputs){const l={};R.serialize(l),h.signalOutputs.push(l)}}deserialize(h){for(let R=0;R<h.signalInputs.length;R++){const l=this.getSignalInput(h.signalInputs[R].name);if(!l)throw new Error("Could not find signal input with name "+h.signalInputs[R].name+" in block "+h.className);l.deserialize(h.signalInputs[R])}for(let R=0;R<h.signalOutputs.length;R++){const l=this.getSignalOutput(h.signalOutputs[R].name);if(!l)throw new Error("Could not find signal output with name "+h.signalOutputs[R].name+" in block "+h.className);l.deserialize(h.signalOutputs[R])}}getClassName(){return"FlowGraphExecutionBlock"}}},14646:(h,R,l)=>{"use strict";l.d(R,{c:()=>a});var j=l(14615);class a extends j.e{constructor(h){super(h),this.out=this._registerSignalOutput("out")}}},14597:(h,R,l)=>{"use strict";l.d(R,{D:()=>Q,F:()=>Y,H:()=>y,I:()=>v,L:()=>O,P:()=>p,c:()=>mh,g:()=>J,i:()=>G,j:()=>s,m:()=>t,o:()=>f,r:()=>c,s:()=>x,w:()=>u,z:()=>q});var j,a=l(12900),D=l(12952),U=l(14591),F=l(14605);!function(h){h.Any="any",h.String="string",h.Number="number",h.Boolean="boolean",h.Object="object",h.Integer="FlowGraphInteger",h.Vector2="Vector2",h.tR="tR",h.Vector4="Vector4",h.Quaternion="Quaternion",h.Matrix="Matrix",h.Matrix2D="Matrix2D",h.Matrix3D="Matrix3D",h.xR="xR",h.bF="bF"}(j||(j={}));class w{constructor(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=h,this.defaultValue=R,this.animationType=l}serialize(h){h.typeName=this.typeName,h.defaultValue=this.defaultValue}}const mh=new w("any",void 0),u=new w("string",""),c=new w("number",0,0),J=new w("boolean",!1),q=new w("Vector2",a.Vector2.Zero(),5),Q=new w("tR",a.tR.Zero(),1),Y=new w("Vector4",a.Vector4.Zero()),s=new w("Matrix",a.Matrix.Identity(),3),t=new w("Matrix2D",new F.d),f=new w("Matrix3D",new F.h),T=new w("xR",D.xR.Black(),4),E=new w("bF",new D.bF(0,0,0,0),7),x=new w("Quaternion",a.Quaternion.Identity(),2);x.typeTransformer=h=>{if(h.getClassName){if("Vector4"===h.getClassName())return a.Quaternion.GR(h.sF());if("tR"===h.getClassName())return a.Quaternion.FromEulerVector(h);if("Matrix"===h.getClassName())return a.Quaternion.FromRotationMatrix(h)}return h};const G=new w("FlowGraphInteger",new U.c(0),0);function p(h){const R=h;switch(typeof h){case"string":return u;case"number":return c;case"boolean":return J;case"object":if(R.getClassName)switch(R.getClassName()){case"Vector2":return q;case"tR":return Q;case"Vector4":return Y;case"Matrix":return s;case"xR":return T;case"bF":return E;case"Quaternion":return x;case"FlowGraphInteger":return G;case"Matrix2D":return t;case"Matrix3D":return f}return mh;default:return mh}}function O(h){switch(h){case"string":return u;case"number":return c;case"boolean":return J;case"Vector2":return q;case"tR":return Q;case"Vector4":return Y;case"Matrix":return s;case"xR":return T;case"bF":return E;case"Quaternion":return x;case"FlowGraphInteger":return G;case"Matrix2D":return t;case"Matrix3D":return f;default:return mh}}function y(h){switch(h){case"number":default:return 0;case"Vector2":return 5;case"tR":return 1;case"Matrix":return 3;case"xR":return 4;case"bF":return 7;case"Quaternion":return 2}}function v(h){switch(h){case 0:return c;case 5:return q;case 1:return Q;case 3:return s;case 4:return T;case 7:return E;case 2:return x;default:return mh}}},14588:(h,R,l)=>{"use strict";l.d(R,{d:()=>u,f:()=>mh,h:()=>c});var j=l(12952),a=l(12900),D=l(14591),U=l(14597),F=l(14605);function w(h){return"Vector2"===h||"tR"===h||"Vector4"===h||"Quaternion"===h||"xR"===h||"bF"===h}function mh(h,R,l){var j;const a=(null===R||void 0===R||null===(j=R.getClassName)||void 0===j?void 0:j.call(R))??"";if(w(a)||function(h){return"Matrix"===h||"Matrix2D"===h||"Matrix3D"===h}(a))l[h]={value:R.sF(),className:a};else if("FlowGraphInteger"===a)l[h]={value:R.value,className:a};else if(a&&(R.id||R.name))l[h]={id:R.id,name:R.name,className:a};else{if("object"===typeof R)throw new Error(`Could not serialize value ${R}`);l[h]=R}}function u(h,R,l,mh){const c=R[h];let J;const q=(null===c||void 0===c?void 0:c.type)??(null===c||void 0===c?void 0:c.className);if(function(h){return"Mesh"===h||"AbstractMesh"===h||"GroundMesh"===h||"InstanceMesh"===h||"LinesMesh"===h||"GoldbergMesh"===h||"GreasedLineMesh"===h||"TrailMesh"===h}(q)){let h=mh.meshes.filter((h=>c.id?h.id===c.id:h.name===c.name));0===h.length&&(h=mh.transformNodes.filter((h=>c.id?h.id===c.id:h.name===c.name))),J=c.uniqueId?h.find((h=>h.uniqueId===c.uniqueId)):h[0]}else if(w(q))J=function(h,R){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===h)return a.Vector2.GR(R);if("tR"===h)return l&&(R[2]*=-1),a.tR.GR(R);if("Vector4"===h)return a.Vector4.GR(R);if("Quaternion"===h)return l&&(R[2]*=-1,R[3]*=-1),a.Quaternion.GR(R);if("xR"===h)return new j.xR(R[0],R[1],R[2]);if("bF"===h)return new j.bF(R[0],R[1],R[2],R[3]);throw new Error(`Unknown vector class name ${h}`)}(q,c.value);else if(function(h){return"AnimationGroup"===h}(q)){const h=mh.animationGroups.filter((h=>h.name===c.name));J=1===h.length?h[0]:h.find((h=>h.uniqueId===c.uniqueId))}else J="Matrix"===q?a.Matrix.GR(c.value):"Matrix2D"===q?new F.d(c.value):"Matrix3D"===q?new F.h(c.value):"FlowGraphInteger"===q?D.c.FromValue(c.value):"number"===q||"string"===q||"boolean"===q?c.value[0]:c&&void 0!==c.value?c.value:Array.isArray(c)?c.reduce(((h,R)=>R.eventData?(h[R.id]={type:(0,U.L)(R.type)},"undefined"!==typeof R.value&&(h[R.id].value=u("value",R,l,mh)),h):h),{}):c;return J}function c(h){return"FlowGraphJsonPointerParserBlock"===h}},14629:(h,R,l)=>{"use strict";function j(h,R){return!(!h.parent||h.parent!==R&&!j(h.parent,R))}function a(h){if(h.getClassName)return h.getClassName()}function D(h,R){return h===R&&("Vector2"===h||"tR"===h||"Vector4"===h||"Quaternion"===h)}function U(h,R){return h===R&&("Matrix"===h||"Matrix2D"===h||"Matrix3D"===h)}function F(h,R){return"FlowGraphInteger"===h&&"FlowGraphInteger"===R}function w(h,R){const l="number"===typeof h||"number"===typeof(null===h||void 0===h?void 0:h.value);return l&&!R?!isNaN(mh(h)):l}function mh(h){return"number"===typeof h?h:h.value}l.d(R,{e:()=>F,f:()=>U,j:()=>D,k:()=>a,o:()=>j,s:()=>mh,t:()=>w})},14028:(h,R,l)=>{"use strict";l.r(R),l.d(R,{SceneInstrumentation:()=>D});var j=l(12689),a=l(13108);class D{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(h){h!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=h,h?(this._onBeforeActiveMeshesEvaluationObserver=this.TR.onBeforeActiveMeshesEvaluationObservable.add((()=>{j.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.TR.onAfterActiveMeshesEvaluationObservable.add((()=>{j.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.TR.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.TR.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(h){h!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=h,h?(this._onBeforeRenderTargetsRenderObserver=this.TR.onBeforeRenderTargetsRenderObservable.add((()=>{j.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.TR.onAfterRenderTargetsRenderObservable.add((()=>{j.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.TR.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.TR.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(h){h!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=h,h?(this._onBeforeParticlesRenderingObserver=this.TR.onBeforeParticlesRenderingObservable.add((()=>{j.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.TR.onAfterParticlesRenderingObservable.add((()=>{j.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.TR.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.TR.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(h){h!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=h,this.TR.spriteManagers&&(h?(this._onBeforeSpritesRenderingObserver=this.TR.onBeforeSpritesRenderingObservable.add((()=>{j.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.TR.onAfterSpritesRenderingObservable.add((()=>{j.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.TR.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.TR.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(h){h!==this._capturePhysicsTime&&this.TR.onBeforePhysicsObservable&&(this._capturePhysicsTime=h,h?(this._onBeforePhysicsObserver=this.TR.onBeforePhysicsObservable.add((()=>{j.Tools.StartPerformanceCounter("Dc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.TR.onAfterPhysicsObservable.add((()=>{j.Tools.EndPerformanceCounter("Dc"),this._physicsTime.endMonitoring()}))):(this.TR.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.TR.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(h){h!==this._captureAnimationsTime&&(this._captureAnimationsTime=h,h?this._onAfterAnimationsObserver=this.TR.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.TR.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(h){this._captureFrameTime=h}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(h){this._captureInterFrameTime=h}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(h){h!==this._captureRenderTime&&(this._captureRenderTime=h,h?(this._onBeforeDrawPhaseObserver=this.TR.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),j.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.TR.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),j.Tools.EndPerformanceCounter("Main render")}))):(this.TR.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.TR.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(h){h!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=h,h?(this._onBeforeCameraRenderObserver=this.TR.onBeforeCameraRenderObservable.add((h=>{this._cameraRenderTime.beginMonitoring(),j.Tools.StartPerformanceCounter(`Rendering camera ${h.name}`)})),this._onAfterCameraRenderObserver=this.TR.onAfterCameraRenderObservable.add((h=>{this._cameraRenderTime.endMonitoring(!1),j.Tools.EndPerformanceCounter(`Rendering camera ${h.name}`)}))):(this.TR.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.TR.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.TR.getEngine()._drawCalls}constructor(h){this.TR=h,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new a.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new a.d,this._captureFrameTime=!1,this._frameTime=new a.d,this._captureRenderTime=!1,this._renderTime=new a.d,this._captureInterFrameTime=!1,this._interFrameTime=new a.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new a.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new a.d,this._capturePhysicsTime=!1,this._physicsTime=new a.d,this._captureAnimationsTime=!1,this._animationsTime=new a.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new a.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=h.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(j.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.TR.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=h.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(j.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.wF(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.wF(),this._captureParticlesRenderTime&&this._particlesRenderTime.wF(),this._captureSpritesRenderTime&&this._spritesRenderTime.wF(),this._captureRenderTime&&this._renderTime.wF(),this._captureCameraRenderTime&&this._cameraRenderTime.wF()}))}dispose(){this._disposed||(this.TR.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.TR.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.TR.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.TR.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.TR.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.TR.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.TR.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.TR.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.TR.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.TR.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.TR.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.TR.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.TR.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.TR.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.TR.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.TR.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.TR.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.TR=null,this._disposed=!0)}}},14576:(h,R,l)=>{"use strict";l.d(R,{d:()=>u});var j=l(12882),a=l(12887),D=l(12900),U=l(13291),F=l(13417),w=l(13463),mh=l(12852);U.b.AddNodeConstructor("Light_Type_1",((h,R)=>()=>new u(h,D.tR.Zero(),R)));class u extends w.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(h){this._shadowFrustumSize=h,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(h){this._shadowOrthoScale=h,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(h){this._orthoLeft=h}get orthoRight(){return this._orthoRight}set orthoRight(h){this._orthoRight=h}get orthoTop(){return this._orthoTop}set orthoTop(h){this._orthoTop=h}get orthoBottom(){return this._orthoBottom}set orthoBottom(h){this._orthoBottom=h}constructor(h,R,l){super(h,l),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=R.scale(-1),this.direction=R}getClassName(){return"Uc"}getTypeID(){return F.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(h,R,l){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(h):this._setDefaultAutoExtendShadowProjectionMatrix(h,R,l)}_setDefaultFixedFrustumShadowProjectionMatrix(h){const R=this.yh().activeCamera;R&&D.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:R.fF,void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ,h,this.yh().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(h,R,l){const j=this.yh().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const h=D.tR.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let j=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let U=0;U<l.length;U++){const F=l[U];if(!F)continue;const w=F.getBoundingInfo().boundingBox;for(let l=0;l<w.vectorsWorld.length;l++)D.tR.TransformCoordinatesToRef(w.vectorsWorld[l],R,h),h.x<this._orthoLeft&&(this._orthoLeft=h.x),h.y<this._orthoBottom&&(this._orthoBottom=h.y),h.x>this._orthoRight&&(this._orthoRight=h.x),h.y>this._orthoTop&&(this._orthoTop=h.y),this.autoCalcShadowZBounds&&(h.z<j&&(j=h.z),h.z>a&&(a=h.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=j,this._shadowMaxZ=a)}const a=this._orthoRight-this._orthoLeft,U=this._orthoTop-this._orthoBottom,F=void 0!==this.shadowMinZ?this.shadowMinZ:(null===j||void 0===j?void 0:j.fF)||0,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===j||void 0===j?void 0:j.maxZ)||1e4,mh=this.yh().getEngine().UF;D.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-a*this.shadowOrthoScale,this._orthoRight+a*this.shadowOrthoScale,this._orthoBottom-U*this.shadowOrthoScale,this._orthoTop+U*this.shadowOrthoScale,mh?w:F,mh?F:w,h,this.yh().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(h,R){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,R),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,R),this)}transferToNodeMaterialEffect(h,R){return this.computeTransformedInformation()?(h.setFloat3(R,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(h.setFloat3(R,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(h){const R=this._scene.getEngine();return!R.UF&&R.isNDCHalfZRange?0:1}getDepthMaxZ(h){const R=this._scene.getEngine();return R.UF&&R.isNDCHalfZRange?0:1}prepareLightSpecificDefines(h,R){h["DIRLIGHT"+R]=!0}}(0,j.e)([(0,a.G)()],u.prototype,"shadowFrustumSize",null),(0,j.e)([(0,a.G)()],u.prototype,"shadowOrthoScale",null),(0,j.e)([(0,a.G)()],u.prototype,"autoUpdateExtends",void 0),(0,j.e)([(0,a.G)()],u.prototype,"autoCalcShadowZBounds",void 0),(0,j.e)([(0,a.G)("orthoLeft")],u.prototype,"_orthoLeft",void 0),(0,j.e)([(0,a.G)("orthoRight")],u.prototype,"_orthoRight",void 0),(0,j.e)([(0,a.G)("orthoTop")],u.prototype,"_orthoTop",void 0),(0,j.e)([(0,a.G)("orthoBottom")],u.prototype,"_orthoBottom",void 0),(0,mh.f)("BABYLON.DirectionalLight",u)},15088:(h,R,l)=>{"use strict";l.d(R,{c:()=>u});var j=l(12882),a=l(12887),D=l(12900),U=l(12952),F=l(13291),w=l(13417),mh=l(12852);F.b.AddNodeConstructor("Light_Type_3",((h,R)=>()=>new u(h,D.tR.Zero(),R)));class u extends w.e{constructor(h,R,l){super(h,l),this.groundColor=new U.xR(0,0,0),this.direction=R||D.tR.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Fc"}setDirectionToTarget(h){return this.direction=D.tR.Normalize(h.fR(D.tR.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(h,R){const l=D.tR.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",l.x,l.y,l.z,0,R),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.nF),R),this}transferToNodeMaterialEffect(h,R){const l=D.tR.Normalize(this.direction);return h.setFloat3(R,l.x,l.y,l.z),this}EF(){return this._worldMatrix||(this._worldMatrix=D.Matrix.Identity()),this._worldMatrix}getTypeID(){return w.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(h,R){h["HEMILIGHT"+R]=!0}}(0,j.e)([(0,a.i)()],u.prototype,"groundColor",void 0),(0,j.e)([(0,a.F)()],u.prototype,"direction",void 0),(0,mh.f)("BABYLON.HemisphericLight",u)},14547:(h,R,l)=>{"use strict";l.d(R,{e:()=>c});var j=l(12882),a=l(12887),D=l(12900),U=l(13291),F=l(13417),w=l(13463),mh=l(12874),u=l(12852);U.b.AddNodeConstructor("Light_Type_2",((h,R)=>()=>new c(h,D.tR.Zero(),D.tR.Zero(),0,0,R)));class c extends w.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(h){this._iesProfileTexture!==h&&(this._iesProfileTexture=h,this._iesProfileTexture&&c._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(h){this._angle=h,this._cosHalfAngle=Math.cos(.5*h),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(h){this._innerAngle=h,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(h){this._shadowAngleScale=h,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(h){this._projectionTextureLightNear=h,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(h){this._projectionTextureLightFar=h,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(h){this._projectionTextureUpDirection=h,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(h){this._projectionTexture!==h&&(this._projectionTexture=h,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(c._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):c._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(h){return void 0!==h.onGeneratedObservable}static _IsTexture(h){return void 0!==h.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(h){this._projectionTextureProjectionLightMatrix=h,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(h,R,l,j,a,U){super(h,U),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=D.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=D.tR.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=D.tR.Zero(),this._projectionTextureViewLightMatrix=D.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=D.Matrix.Zero(),this._projectionTextureScalingMatrix=D.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=R,this.direction=l,this.angle=j,this.exponent=a}getClassName(){return"SpotLight"}getTypeID(){return F.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(h){super._setDirection(h),this._projectionTextureViewLightDirty=!0}_setPosition(h){super._setPosition(h),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(h,R,l){const j=this.yh().activeCamera;if(!j)return;this._shadowAngleScale=this._shadowAngleScale||1;const a=this._shadowAngleScale*this._angle,U=void 0!==this.shadowMinZ?this.shadowMinZ:j.fF,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,w=this.yh().getEngine().UF;D.Matrix.PerspectiveFovLHToRef(a,1,w?F:U,w?U:F,h,!0,this._scene.getEngine().isNDCHalfZRange,void 0,w)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),D.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const h=this.projectionTextureLightFar,R=this.projectionTextureLightNear,l=h/(h-R),j=-l*R,a=1/Math.tan(this._angle/2);D.Matrix.FromValuesToRef(a/1,0,0,0,0,a,0,0,0,0,l,1,0,0,j,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof mh.b){const h=this._projectionTexture.uScale/2,R=this._projectionTexture.vScale/2;D.Matrix.FromValuesToRef(h,0,0,0,0,R,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(h,R){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),h.setMatrix("textureProjectionMatrix"+R,this._projectionTextureMatrix),h.setTexture("projectionLightTexture"+R,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&h.setTexture("iesLightTexture"+R,this._iesProfileTexture),this}transferToEffect(h,R){let l;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,R),l=D.tR.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,R),l=D.tR.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",l.x,l.y,l.z,this._cosHalfAngle,R),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,R),this}transferToNodeMaterialEffect(h,R){let l;return l=this.computeTransformedInformation()?D.tR.Normalize(this.transformedDirection):D.tR.Normalize(this.direction),this.yh().useRightHandedSystem?h.setFloat3(R,-l.x,-l.y,-l.z):h.setFloat3(R,l.x,l.y,l.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(h){const R=this._scene.getEngine(),l=void 0!==this.shadowMinZ?this.shadowMinZ:(null===h||void 0===h?void 0:h.fF)??0;return R.UF&&R.isNDCHalfZRange?l:this._scene.getEngine().isNDCHalfZRange?0:l}getDepthMaxZ(h){const R=this._scene.getEngine(),l=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===h||void 0===h?void 0:h.maxZ)??1e4;return R.UF&&R.isNDCHalfZRange?0:l}prepareLightSpecificDefines(h,R){h["SPOTLIGHT"+R]=!0,h["PROJECTEDLIGHTTEXTURE"+R]=!(!this.projectionTexture||!this.projectionTexture.isReady()),h["IESLIGHTTEXTURE"+R]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,j.e)([(0,a.G)()],c.prototype,"angle",null),(0,j.e)([(0,a.G)()],c.prototype,"innerAngle",null),(0,j.e)([(0,a.G)()],c.prototype,"shadowAngleScale",null),(0,j.e)([(0,a.G)()],c.prototype,"exponent",void 0),(0,j.e)([(0,a.G)()],c.prototype,"projectionTextureLightNear",null),(0,j.e)([(0,a.G)()],c.prototype,"projectionTextureLightFar",null),(0,j.e)([(0,a.G)()],c.prototype,"projectionTextureUpDirection",null),(0,j.e)([(0,a.x)("projectedLightTexture")],c.prototype,"_projectionTexture",void 0),(0,u.f)("BABYLON.SpotLight",c)},14288:(h,R,l)=>{"use strict";l.d(R,{b:()=>U,f:()=>D,j:()=>F});const j={},a={};function D(h,R){j[h]=R}function U(h,R){a[h]=R}function F(h){return a[h]?a[h]:null}},14197:(h,R,l)=>{"use strict";l.d(R,{b:()=>p,f:()=>o});var j,a=l(12689),D=l(12696),U=l(13126),F=l(12749),w=l(12711),mh=l(13330),u=l(12758),c=l(12766),J=l(12855),q=l(12797),Q=l(12741);!function(h){h[h.Clean=0]="Clean",h[h.Stop=1]="Stop",h[h.Sync=2]="Sync",h[h.NoSync=3]="NoSync"}(j||(j={}));const Y=new D.d,s={};let t=!1;function f(){return s[".babylon"]}function T(h,R){const l=s[h];return l||(w.c.Warn("Unable to find a plugin to load "+h+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),R?f():void 0)}function E(h,R,l){let j="Unable to load from "+(h.rawData?"binary data":h.url);return R?j+=`: ${R}`:l&&(j+=`: ${l}`),j}async function x(h,R,l,j,a,D,U,F,w){var mh;const c="data:"===(J=h.url).substring(0,5)?J.substring(5):null;var J;if(h.rawData&&!U)throw"When using ArrayBufferView to load data the file extension must be provided.";const t=c||U?"":function(h){const R=h.indexOf("?");-1!==R&&(h=h.substring(0,R));const l=h.lastIndexOf(".");return h.substring(l,h.length).toLowerCase()}(h.url);let E=U?T(U,!0):c?function(h){for(const R in s){const l=s[R].plugin;if(l.canDirectLoad&&l.canDirectLoad(h))return s[R]}return f()}(h.url):T(t,!1);if(!E&&t){if(h.url&&!h.url.startsWith("blob:")){const R=await async function(h,R){const l=R.method||"GET";return await new Promise(((j,a)=>{const D=new Q.b;D.addEventListener("readystatechange",(()=>{if(4==D.readyState)if(200==D.status){const h={};if(R.responseHeaders)for(const l of R.responseHeaders)h[l]=D.getResponseHeader(l)||"";j({response:D.response,headerValues:h})}else a(`Unable to fetch data from ${h}. Error code: ${D.status}`)})),D.open(l,h),D.send()}))}(h.url,{method:"HEAD",responseHeaders:["Content-Type"]}),l=R.headerValues?R.headerValues["Content-Type"]:"";l&&(E=function(h){for(const R in s){const l=s[R];if(l.mimeType===h)return l}}(l))}E||(E=f())}if(!E)throw new Error(`No plugin or fallback for ${U??h.url}`);if(!1===(null===w||void 0===w||null===(mh=w[E.plugin.name])||void 0===mh?void 0:mh.enabled))throw new Error(`The '${E.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(h.rawData&&!E.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(h=>{if(E.plugin.createPlugin){const R=E.plugin.createPlugin(w??{});return R instanceof Promise?(R.then(h).catch((h=>{a("Error instantiating plugin.",h)})),null):(h(R),R)}return h(E.plugin),E.plugin})((w=>{var mh;if(!w)throw`The loader plugin corresponding to the '${U}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(Y.notifyObservers(w),c&&(w.canDirectLoad&&w.canDirectLoad(h.url)||!(0,u.i)(h.url))){if(w.directLoad){const h=w.directLoad(R,c);h instanceof Promise?h.then((h=>{l(w,h)})).catch((h=>{a("Error in directLoad of _loadData: "+h,h)})):l(w,h)}else l(w,c);return}const J=E.isBinary,Q=(h,j)=>{R.mh?a("Scene has been disposed"):l(w,h,j)};let s=null,t=!1;null===(mh=w.mw)||void 0===mh||mh.add((()=>{t=!0,s&&(s.abort(),s=null),D()}));const f=()=>{if(t)return;const l=(h,R)=>{a(null===h||void 0===h?void 0:h.statusText,R)};if(!w.loadFile&&h.rawData)throw"Plugin does not support loading ArrayBufferView.";s=w.loadFile?w.loadFile(R,h.rawData||h.file||h.url,h.rootUrl,Q,j,J,l,F):R._loadFile(h.file||h.url,Q,j,!0,J,l)},T=R.getEngine();let x=T.enableOfflineSupport;if(x){let l=!1;for(const j of R.disableOfflineSupportExceptionRules)if(j.test(h.url)){l=!0;break}x=!l}x&&q.c.OfflineProviderFactory?R.offlineProvider=q.c.OfflineProviderFactory(h.url,f,T.disableManifestCheck):f()}))}function G(h,R){let l,j,D=null,U=null;if(R)if(R.name)l=`file:${R.name}`,j=R.name,D=R;else if(ArrayBuffer.isView(R))l="",j=(0,J.e)(),U=R;else if(R.startsWith("data:"))l=R,j="";else if(h){const D=R;if("/"===D.substring(0,1))return a.Tools.Error("Wrong sceneFilename parameter"),null;l=h+D,j=D}else l=R,j=a.Tools.GetFilename(R),h=a.Tools.GetFolderPath(R);else l=h,j=a.Tools.GetFilename(h),h=a.Tools.GetFolderPath(h);return{url:l,rootUrl:h,name:j,file:D,rawData:U}}function p(h){if("string"===typeof h.extensions){const R=h.extensions;s[R.toLowerCase()]={plugin:h,isBinary:!1}}else{const R=h.extensions,l=Object.keys(R);for(const j of l)s[j.toLowerCase()]={plugin:h,isBinary:R[j].isBinary,mimeType:R[j].mimeType}}}async function O(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.b.LastCreatedScene,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mh=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!j)return w.c.Error("No scene available to import mesh to"),null;const q=G(R,l);if(!q)return null;const Q={};j.addPendingData(Q);const Y=()=>{j.removePendingData(Q)},s=(h,R)=>{const l=E(q,h,R);U?U(j,l,new c.g(l,c.f.SceneLoaderError,R)):w.c.Error(l),Y()},t=D?h=>{try{D(h)}catch(R){s("Error in onProgress callback: "+R,R)}}:void 0,f=(h,R,l,D,U,F,w,mh)=>{if(j.importedMeshesFiles.push(q.url),a)try{a(h,R,l,D,U,F,w,mh)}catch(u){s("Error in onSuccess callback: "+u,u)}j.removePendingData(Q)};return await x(q,j,((R,l,a)=>{if(R.rewriteRootURL&&(q.rootUrl=R.rewriteRootURL(q.rootUrl,a)),R.importMesh){const a=[],D=[],U=[];if(!R.importMesh(h,j,l,q.rootUrl,a,D,U,s))return;j.loadingPluginName=R.name,f(a,D,U,[],[],[],[],[])}else{R.importMeshAsync(h,j,l,q.rootUrl,t,q.name).then((h=>{j.loadingPluginName=R.name,f(h.meshes,h.SJ,h.skeletons,h.animationGroups,h.transformNodes,h.geometries,h.lights,h.spriteManagers)})).catch((h=>{s(h.message,h)}))}}),t,s,Y,mh,u,J)}async function y(h,R,l,j,a,D,U,F){return await new Promise(((w,mh)=>{try{O(h,R,l,j,((h,R,l,j,a,D,U,F)=>{w({meshes:h,SJ:R,skeletons:l,animationGroups:j,transformNodes:a,geometries:D,lights:U,spriteManagers:F})}),a,((h,R,l)=>{mh(l||new Error(R))}),D,U,F).catch(mh)}catch(c){mh(c)}}))}async function v(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.LastCreatedEngine,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mh=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};l?await I(h,R,new U.e(l),j,D,w,mh,u,c):a.Tools.Error("No engine available")}async function b(h,R,l,j,a,D,U){return await new Promise(((F,w)=>{v(h,R,l,(h=>{F(h)}),j,((h,R,l)=>{w(l||new Error(R))}),a,D,U)}))}async function I(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.LastCreatedScene,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!l)return w.c.Error("No scene available to append to"),null;const q=G(h,R);if(!q)return null;const Q={};l.addPendingData(Q);const Y=()=>{l.removePendingData(Q)};mh.d.ShowLoadingScreen&&!t&&(t=!0,l.getEngine().displayLoadingUI(),l.executeWhenReady((()=>{l.getEngine().hideLoadingUI(),t=!1})));const s=(h,R)=>{const j=E(q,h,R);D?D(l,j,new c.g(j,c.f.SceneLoaderError,R)):w.c.Error(j),Y()},f=a?h=>{try{a(h)}catch(R){s("Error in onProgress callback",R)}}:void 0,T=()=>{if(j)try{j(l)}catch(h){s("Error in onSuccess callback",h)}l.removePendingData(Q)};return await x(q,l,((h,R)=>{if(h.load){if(!h.load(l,R,q.rootUrl,s))return;l.loadingPluginName=h.name,T()}else{h.loadAsync(l,R,q.rootUrl,f,q.name).then((()=>{l.loadingPluginName=h.name,T()})).catch((h=>{s(h.message,h)}))}}),f,s,Y,U,u,J)}async function L(h,R,l,j,a,D,U){return await new Promise(((F,w)=>{try{I(h,R,l,(h=>{F(h)}),j,((h,R,l)=>{w(l||new Error(R))}),a,D,U).catch(w)}catch(c){w(c)}}))}async function n(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.LastCreatedScene,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mh=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!l)return w.c.Error("No scene available to load asset container to"),null;const J=G(h,R);if(!J)return null;const q={};l.addPendingData(q);const Q=()=>{l.removePendingData(q)},Y=(h,R)=>{const j=E(J,h,R);D?D(l,j,new c.g(j,c.f.SceneLoaderError,R)):w.c.Error(j),Q()},s=a?h=>{try{a(h)}catch(R){Y("Error in onProgress callback",R)}}:void 0,t=h=>{if(j)try{j(h)}catch(R){Y("Error in onSuccess callback",R)}l.removePendingData(q)};return await x(J,l,((h,R)=>{if(h.loadAssetContainer){const j=h.loadAssetContainer(l,R,J.rootUrl,Y);if(!j)return;j.populateRootNodes(),l.loadingPluginName=h.name,t(j)}else if(h.loadAssetContainerAsync){h.loadAssetContainerAsync(l,R,J.rootUrl,s,J.name).then((R=>{R.populateRootNodes(),l.loadingPluginName=h.name,t(R)})).catch((h=>{Y(h.message,h)}))}else Y("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),s,Y,Q,U,mh,u)}async function r(h,R,l,j,a,D,U){return await new Promise(((F,w)=>{try{n(h,R,l,(h=>{F(h)}),j,((h,R,l)=>{w(l||new Error(R))}),a,D,U).catch(w)}catch(c){w(c)}}))}async function P(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.LastCreatedScene,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mh=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!l)return void w.c.Error("No scene available to load animations to");if(j){for(const j of l.animatables)j.reset();l.stopAllAnimations();const h=l.animationGroups.slice();for(const l of h)l.dispose();const R=l.getNodes();for(const l of R)l.animations&&(l.animations=[])}else switch(a){case 0:const h=l.animationGroups.slice();for(const R of h)R.dispose();break;case 1:for(const R of l.animationGroups)R.stop();break;case 2:for(const R of l.animationGroups)R.reset(),R.restart();break;case 3:break;default:return void w.c.Error("Unknown animation group loading mode value '"+a+"'")}const Q=l.animatables.length;await n(h,R,l,(h=>{h.mergeAnimationsTo(l,l.animatables.slice(Q),D),h.dispose(),l.onAnimationFileImportedObservable.notifyObservers(l),U&&U(l)}),mh,u,c,J,q)}async function z(h,R,l,j,a,D,U,F,w,mh){return await new Promise(((u,J)=>{try{P(h,R,l,j,a,D,(h=>{u(h)}),U,((h,R,l)=>{J(l||new Error(R))}),F,w,mh).catch(J)}catch(c){J(c)}}))}class o{static get ForceFullSceneLoadingForIncremental(){return mh.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(h){mh.d.ForceFullSceneLoadingForIncremental=h}static get ShowLoadingScreen(){return mh.d.ShowLoadingScreen}static set ShowLoadingScreen(h){mh.d.ShowLoadingScreen=h}static get loggingLevel(){return mh.d.loggingLevel}static set loggingLevel(h){mh.d.loggingLevel=h}static get CleanBoneMatrixWeights(){return mh.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(h){mh.d.CleanBoneMatrixWeights=h}static GetDefaultPlugin(){return f()}static GetPluginForExtension(h){var R;return null===(R=T(h,!0))||void 0===R?void 0:R.plugin}static IsPluginForExtensionAvailable(h){return function(h){return!!s[h]}(h)}static RegisterPlugin(h){p(h)}static ImportMesh(h,R,l,j,a,D,U,w,mh){O(h,R,l,j,a,D,U,w,mh).catch((h=>null===U||void 0===U?void 0:U(F.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async ImportMeshAsync(h,R,l,j,a,D,U){return await y(h,R,l,j,a,D,U)}static Load(h,R,l,j,a,D,U,w){v(h,R,l,j,a,D,U,w).catch((h=>null===D||void 0===D?void 0:D(F.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async LoadAsync(h,R,l,j,a,D){return await b(h,R,l,j,a,D)}static Append(h,R,l,j,a,D,U,w){I(h,R,l,j,a,D,U,w).catch((h=>null===D||void 0===D?void 0:D(l??F.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async AppendAsync(h,R,l,j,a,D){return await L(h,R,l,j,a,D)}static LoadAssetContainer(h,R,l,j,a,D,U,w){n(h,R,l,j,a,D,U,w).catch((h=>null===D||void 0===D?void 0:D(l??F.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async LoadAssetContainerAsync(h,R,l,j,a,D){return await r(h,R,l,j,a,D)}static ImportAnimations(h,R,l,j,a,D,U,w,mh,u,c){P(h,R,l,j,a,D,U,w,mh,u,c).catch((h=>null===mh||void 0===mh?void 0:mh(l??F.b.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async ImportAnimationsAsync(h,R,l,j,a,D,U,F,w,mh,u){return await z(h,R,l,j,a,D,F,mh,u)}}o.NO_LOGGING=0,o.MINIMAL_LOGGING=1,o.SUMMARY_LOGGING=2,o.DETAILED_LOGGING=3,o.OnPluginActivatedObservable=Y},14565:(h,R,l)=>{"use strict";l.d(R,{e:()=>J});var j=l(12882),a=l(12887),D=l(12689),U=l(12900),F=l(12925),w=l(12874),mh=l(12852),u=l(12696),c=l(12942);l(14568);class J extends F.e{set boundingBoxSize(h){if(this._boundingBoxSize&&this._boundingBoxSize.equals(h))return;this._boundingBoxSize=h;const R=this.yh();R&&R.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(h){this._rotationY=h,this.setReflectionTextureMatrix(U.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(h,R,l){let j="";for(const a of h)j+=a;return new J(j,R,null,l,h)}static CreateFromPrefilteredData(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=R.useDelayedTextureLoading;R.useDelayedTextureLoading=!1;const D=new J(h,R,null,!1,null,null,null,void 0,!0,l,j);return R.useDelayedTextureLoading=a,D}constructor(h,R){var l;let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mh=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,J=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,s=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,t=arguments.length>13?arguments[13]:void 0,f=arguments.length>14?arguments[14]:void 0;super(R),this.onLoadObservable=new u.d,this.boundingBoxPosition=U.tR.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new U.Matrix,this._buffer=null,this.name=h,this.url=h,this._noMipmap=a,this.tF=!1,this.isCube=!0,this._textureMatrix=U.Matrix.Identity(),this.coordinatesMode=w.b.CUBIC_MODE;let T=null,E=null;null===j||Array.isArray(j)?(this._noMipmap=a,this._format=c,this._createPolynomials=Q,T=j,this._loaderOptions=t,this._useSRGBBuffer=f,this._lodScale=Y,this._lodOffset=s):(T=j.extensions??null,this._noMipmap=j.noMipmap??!1,D=j.files??null,E=j.buffer??null,this._format=j.format??5,J=j.prefiltered??!1,q=j.forcedExtension??null,this._createPolynomials=j.createPolynomials??!1,this._lodScale=j.lodScale??.8,this._lodOffset=j.lodOffset??0,this._loaderOptions=j.loaderOptions,this._useSRGBBuffer=j.useSRGBBuffer,F=j.V??null,mh=j.onError??null),(h||D)&&this.updateURL(h,q,F,J,mh,T,null===(l=this.yh())||void 0===l?void 0:l.useDelayedTextureLoading,D,E)}getClassName(){return"CubeTexture"}updateURL(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=h),this.url=h,R&&(this._forcedExtension=R);const mh=h.lastIndexOf("."),u=R||(mh>-1?h.substring(mh).toLowerCase():""),c=0===u.indexOf(".dds"),J=0===u.indexOf(".env"),q=0===u.indexOf(".basis");if(J?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=j,j&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),F)this._files=F;else if(q||J||c||D||(D=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,D){for(let R=0;R<D.length;R++)this._files.push(h+D[R]);this._extensions=D}this._buffer=w,U?(this.delayLoadState=4,this._delayedOnLoad=l,this._delayedOnError=a):this._loadTexture(l,a)}delayLoad(h){4===this.delayLoadState&&(h&&(this._forcedExtension=h),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(h){var R,l;if(h.updateFlag===this._textureMatrix.updateFlag)return;h.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(l=this.yh())||void 0===l||l.markAllMaterialsAsDirty(1,(h=>-1!==h.getActiveTextures().indexOf(this))));if(this._textureMatrix=h,null===(R=this.yh())||void 0===R||!R.useRightHandedSystem)return;const j=U.TmpVectors.tR[0],a=U.TmpVectors.Quaternion[0],D=U.TmpVectors.tR[1];this._textureMatrix.decompose(j,a,D),a.z*=-1,a.w*=-1,U.Matrix.ComposeToRef(j,a,D,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var h;return null!==(h=this.yh())&&void 0!==h&&h.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=this.yh(),j=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const a=()=>{var R;(this.onLoadObservable.notifyObservers(this),j)&&(j.dispose(),null===(R=this.yh())||void 0===R||R.markAllMaterialsAsDirty(1));h&&h()},U=(h,l)=>{this._loadingError=!0,this._errorObject={message:h,exception:l},R&&R(h,l),w.b.OnTextureLoadErrorObservable.notifyObservers(this)};var F;this._texture?this._texture.isReady?D.Tools.SetImmediate((()=>a())):this._texture.onLoadedObservable.add((()=>a())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,l,this._lodScale,this._lodOffset,h,U,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,l,this._files,this._noMipmap,h,U,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(F=this._texture)||void 0===F||F.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(h,R,l){const j=c.c.Parse((()=>{let j=!1;return h.prefiltered&&(j=h.prefiltered),new J(l+(h.url??h.name),R,h.extensions,!1,h.files||null,null,null,void 0,j,h.forcedExtension)}),h,R);if(h.boundingBoxPosition&&(j.boundingBoxPosition=U.tR.GR(h.boundingBoxPosition)),h.boundingBoxSize&&(j.boundingBoxSize=U.tR.GR(h.boundingBoxSize)),h.animations)for(let a=0;a<h.animations.length;a++){const R=h.animations[a],l=(0,mh.e)("BABYLON.Animation");l&&j.animations.push(l.Parse(R))}return j}clone(){let h=0;const R=c.c.Clone((()=>{const R=new J(this.url,this.yh()||this._getEngine(),this._extensions,this._noMipmap,this._files);return h=R.uniqueId,R}),this);return R.uniqueId=h,R}}(0,j.e)([(0,a.G)()],J.prototype,"url",void 0),(0,j.e)([(0,a.F)()],J.prototype,"boundingBoxPosition",void 0),(0,j.e)([(0,a.F)()],J.prototype,"boundingBoxSize",null),(0,j.e)([(0,a.G)("rotationY")],J.prototype,"rotationY",null),(0,j.e)([(0,a.G)("files")],J.prototype,"_files",void 0),(0,j.e)([(0,a.G)("forcedExtension")],J.prototype,"_forcedExtension",void 0),(0,j.e)([(0,a.G)("extensions")],J.prototype,"_extensions",void 0),(0,j.e)([(0,a.p)("textureMatrix")],J.prototype,"_textureMatrix",void 0),(0,j.e)([(0,a.p)("textureMatrixRefraction")],J.prototype,"_textureMatrixRefraction",void 0),w.b._CubeTextureParser=J.Parse,(0,mh.f)("BABYLON.CubeTexture",J)},15103:(h,R,l)=>{"use strict";l.d(R,{e:()=>w});var j=l(12711),a=l(12874),D=l(12858),U=l(13026),F=l(12835);U.ThinEngine.prototype.createDynamicTexture=function(h,R,l,j){const a=new F.e(this,4);return a.baseWidth=h,a.baseHeight=R,l&&(h=this.needPOTTextures?(0,D.f)(h,this._caps.maxTextureSize):h,R=this.needPOTTextures?(0,D.f)(R,this._caps.maxTextureSize):R),a.width=h,a.height=R,a.isReady=!1,a.generateMipMaps=l,a.samplingMode=j,this.updateTextureSamplingMode(j,a),this._internalTexturesCache.push(a),a},U.ThinEngine.prototype.updateDynamicTexture=function(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!h)return;const U=this._gl,F=U.TEXTURE_2D,w=this._bindTextureDirectly(F,h,!0,D);this._unpackFlipY(void 0===l?h.invertY:l),j&&U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const mh=this._getWebGLTextureType(h.type),u=this._getInternalFormat(a||h.format),c=this._getRGBABufferInternalSizedFormat(h.type,u);U.texImage2D(F,0,c,u,mh,R),h.generateMipMaps&&U.generateMipmap(F),w||this._bindTextureDirectly(F,null),j&&U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),a&&(h.format=a),h._dynamicTextureSource=R,h._premulAlpha=j,h.invertY=l||!1,h.isReady=!0};class w extends a.b{constructor(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,F=arguments.length>6?arguments[6]:void 0;const w=!l||l._isScene;super(null,w?l:null===l||void 0===l?void 0:l.TR,w?!j:l,F,D,void 0,void 0,void 0,void 0,U),this.name=h,this.wrapU=a.b.CLAMP_ADDRESSMODE,this.wrapV=a.b.CLAMP_ADDRESSMODE,this._generateMipMaps=j;const mh=this._getEngine();if(!mh)return;if(R.getContext)this._canvas=R,this._ownCanvas=!1,this._texture=mh.createDynamicTexture(this._canvas.width,this._canvas.height,j,D);else{this._canvas=mh.createCanvas(1,1),this._ownCanvas=!0;const h=R;h.width||0===h.width?this._texture=mh.createDynamicTexture(h.width,h.height,j,D):this._texture=mh.createDynamicTexture(R,R,j,D)}const u=this.getSize();this._canvas.width!==u.width&&(this._canvas.width=u.width),this._canvas.height!==u.height&&(this._canvas.height=u.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(h){this._canvas.width=h.width,this._canvas.height=h.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(h.width,h.height,this._generateMipMaps,this.samplingMode)}scale(h){const R=this.getSize();R.width*=h,R.height*=h,this._recreate(R)}scaleTo(h,R){const l=this.getSize();l.width=h,l.height=R,this._recreate(l)}getContext(){return this._context}clear(h){const R=this.getSize();h&&(this._context.fillStyle=h),this._context.clearRect(0,0,R.width,R.height)}update(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===h||h,R,this._format||void 0,void 0,l)}drawText(h,R,l,j,a,D,U){let F=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const w=this.getSize();if(D&&(this._context.fillStyle=D,this._context.fillRect(0,0,w.width,w.height)),this._context.font=j,null===R||void 0===R){const l=this._context.measureText(h);R=(w.width-l.width)/2}if(null===l||void 0===l){const h=parseInt(j.replace(/\D/g,""));l=w.height/2+h/3.65}this._context.fillStyle=a||"",this._context.fillText(h,R,l),F&&this.update(U)}dispose(){var h,R;(super.dispose(),this._ownCanvas)&&(null===(h=this._canvas)||void 0===h||null===(R=h.remove)||void 0===R||R.call(h));this._canvas=null,this._context=null}clone(){const h=this.yh();if(!h)return this;const R=this.getSize(),l=new w(this.name,R,h,this._generateMipMaps);return l.tF=this.tF,l.level=this.level,l.wrapU=this.wrapU,l.wrapV=this.wrapV,l}serialize(){const h=this.yh();h&&!h.isReady()&&j.c.Warn("The scene must be ready before serializing the dynamic texture");const R=super.serialize();return w._IsCanvasElement(this._canvas)&&(R.base64String=this._canvas.toDataURL()),R.invertY=this._invertY,R.samplingMode=this.samplingMode,R}static _IsCanvasElement(h){return void 0!==h.toDataURL}_rebuild(){this.update()}}},14465:(h,R,l)=>{"use strict";l.d(R,{b:()=>a});var j=l(12874);class a extends j.b{get depth(){return this._depth}constructor(h,R,l,a,D,U){let F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],w=arguments.length>7&&void 0!==arguments[7]&&arguments[7],mh=arguments.length>8&&void 0!==arguments[8]?arguments[8]:j.b.TRILINEAR_SAMPLINGMODE,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10?arguments[10]:void 0;super(null,U,!F,w),this.format=D,this._texture=U.getEngine().createRawTexture2DArray(h,R,l,a,D,F,w,mh,null,u,c),this._depth=a,this.is2DArray=!0}update(h){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,h,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(h,R,l,j,D){return new a(h,R,l,j,5,D,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14295:(h,R,l)=>{"use strict";l.d(R,{c:()=>F,g:()=>w,j:()=>D,m:()=>U});var j=l(12917),a=l(12900);function D(h,R){return`{X: ${h.x.toFixed(R)} Y: ${h.y.toFixed(R)}}`}function U(h,R){return`{X: ${h._x.toFixed(R)} Y: ${h._y.toFixed(R)} Z: ${h._z.toFixed(R)}}`}function F(h,R){return 2*Math.acos((0,j.Clamp)(a.Quaternion.Dot(h,R)))}function w(h,R){const l=new a.Quaternion;return function(h,R,l){const D=a.tR.Cross(h,R),U=Math.acos((0,j.Clamp)(a.tR.Dot(h,R),-1,1));a.Quaternion.RotationAxisToRef(D,U,l)}(h,R,l),l}},14145:(h,R,l)=>{"use strict";l.d(R,{d:()=>mh});var j=l(12900),a=l(12952),D=l(13310),U=l(13298),F=l(12969);l(14149);function w(h){let R=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const l=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],D=[];let w=[];const mh=h.width||h.size||1,u=h.height||h.size||1,c=h.depth||h.size||1,J=h.wrap||!1;let q=void 0===h.topBaseAt?1:h.topBaseAt,Q=void 0===h.bottomBaseAt?0:h.bottomBaseAt;q=(q+4)%4,Q=(Q+4)%4;let Y=[2,0,3,1][q],s=[2,0,1,3][Q],t=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(J){R=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],t=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let h=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],l=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const j=[17,18,19,16],a=[22,23,20,21];for(;Y>0;)h.unshift(h.pop()),j.unshift(j.pop()),Y--;for(;s>0;)l.unshift(l.pop()),a.unshift(a.pop()),s--;h=h.flat(),l=l.flat(),t=t.concat(h).concat(l),R.push(j[0],j[2],j[3],j[0],j[1],j[2]),R.push(a[0],a[2],a[3],a[0],a[1],a[2])}const f=[mh/2,u/2,c/2];w=t.reduce(((h,R,l)=>h.concat(R*f[l%3])),[]);const T=0===h.sideOrientation?0:h.sideOrientation||U.b.DEFAULTSIDE,E=h.faceUV||new Array(6),x=h.faceColors,G=[];for(let U=0;U<6;U++)void 0===E[U]&&(E[U]=new j.Vector4(0,0,1,1)),x&&void 0===x[U]&&(x[U]=new a.bF(1,1,1,1));for(let j=0;j<6;j++)if(D.push(E[j].z,F.e?1-E[j].w:E[j].w),D.push(E[j].x,F.e?1-E[j].w:E[j].w),D.push(E[j].x,F.e?1-E[j].y:E[j].y),D.push(E[j].z,F.e?1-E[j].y:E[j].y),x)for(let h=0;h<4;h++)G.push(x[j].r,x[j].g,x[j].b,x[j].a);U.b._ComputeSides(T,w,R,l,D,h.frontUVs,h.backUVs);const p=new U.b;if(p.indices=R,p.Ih=w,p.Lh=l,p.rh=D,x){const h=T===U.b.DOUBLESIDE?G.concat(G):G;p.nh=h}return p}function mh(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new D.b(h,l);R.sideOrientation=D.b._GetDefaultSideOrientation(R.sideOrientation),j._originalBuilderSideOrientation=R.sideOrientation;return w(R).zh(j,R.updatable),j}U.b.CreateBox=w,D.b.CreateBox=function(h,R){return mh(h,{size:R,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14291:(h,R,l)=>{"use strict";l.d(R,{d:()=>F});var j=l(13310),a=l(13298),D=l(12969);function U(h){const R=[],l=[],j=[],U=[],F=h.radius||.5,w=h.tessellation||64,mh=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,u=0===h.sideOrientation?0:h.sideOrientation||a.b.DEFAULTSIDE;R.push(0,0,0),U.push(.5,.5);const c=2*Math.PI*mh,J=1===mh?c/w:c/(w-1);let q=0;for(let a=0;a<w;a++){const h=Math.cos(q),l=Math.sin(q),j=(h+1)/2,a=(1-l)/2;R.push(F*h,F*l,0),U.push(j,D.e?1-a:a),q+=J}1===mh&&(R.push(R[3],R[4],R[5]),U.push(U[2],D.e?1-U[3]:U[3]));const Q=R.length/3;for(let a=1;a<Q-1;a++)l.push(a+1,0,a);a.b.ComputeNormals(R,l,j),a.b._ComputeSides(u,R,l,j,U,h.frontUVs,h.backUVs);const Y=new a.b;return Y.indices=l,Y.Ih=R,Y.Lh=j,Y.rh=U,Y}function F(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new j.b(h,l);R.sideOrientation=j.b._GetDefaultSideOrientation(R.sideOrientation),a._originalBuilderSideOrientation=R.sideOrientation;return U(R).zh(a,R.updatable),a}a.b.CreateDisc=U,j.b.CreateDisc=function(h,R,l){return F(h,{radius:R,tessellation:l,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},14149:(h,R,l)=>{"use strict";l.d(R,{f:()=>s,d:()=>f,h:()=>t});var j=l(12900),a=l(12952),D=l(13310),U=l(13298),F=l(12984);D.b._GroundMeshParser=(h,R)=>w.Parse(h,R);class w extends D.b{constructor(h,R){super(h,R),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=h,this._subdivisionsY=h,this.subdivide(h);const l=this;l.createOrUpdateSubmeshesOctree&&l.createOrUpdateSubmeshesOctree(R)}getHeightAtCoordinates(h,R){const l=this.getWorldMatrix(),a=j.TmpVectors.Matrix[5];l.invertToRef(a);const D=j.TmpVectors.tR[8];if(j.tR.TransformCoordinatesFromFloatsToRef(h,0,R,a,D),h=D.x,R=D.z,h<this._minX||h>=this._maxX||R<=this._minZ||R>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const U=this._getFacetAt(h,R),F=-(U.x*h+U.z*R+U.w)/U.y;return j.tR.TransformCoordinatesFromFloatsToRef(0,F,0,l,D),D.y}getNormalAtCoordinates(h,R){const l=new j.tR(0,1,0);return this.getNormalAtCoordinatesToRef(h,R,l),l}getNormalAtCoordinatesToRef(h,R,l){const a=this.getWorldMatrix(),D=j.TmpVectors.Matrix[5];a.invertToRef(D);const U=j.TmpVectors.tR[8];if(j.tR.TransformCoordinatesFromFloatsToRef(h,0,R,D,U),h=U.x,R=U.z,h<this._minX||h>this._maxX||R<this._minZ||R>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const F=this._getFacetAt(h,R);return j.tR.TransformNormalFromFloatsToRef(F.x,F.y,F.z,a,l),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(h,R){const l=Math.floor((h+this._maxX)*this._subdivisionsX/this._width),j=Math.floor(-(R+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),a=this._heightQuads[j*this._subdivisionsX+l];let D;return D=R<a.slope.x*h+a.slope.y?a.facet1:a.facet2,D}_initHeightQuads(){const h=this._subdivisionsX,R=this._subdivisionsY;this._heightQuads=[];for(let l=0;l<R;l++)for(let R=0;R<h;R++){const a={slope:j.Vector2.Zero(),facet1:new j.Vector4(0,0,0,0),facet2:new j.Vector4(0,0,0,0)};this._heightQuads[l*h+R]=a}return this}_computeHeightQuads(){const h=this.getVerticesData(F.g.PositionKind);if(!h)return this;const R=j.TmpVectors.tR[3],l=j.TmpVectors.tR[2],a=j.TmpVectors.tR[1],D=j.TmpVectors.tR[0],U=j.TmpVectors.tR[4],w=j.TmpVectors.tR[5],mh=j.TmpVectors.tR[6],u=j.TmpVectors.tR[7],c=j.TmpVectors.tR[8];let J=0,q=0,Q=0,Y=0,s=0,t=0,f=0;const T=this._subdivisionsX,E=this._subdivisionsY;for(let F=0;F<E;F++)for(let E=0;E<T;E++){J=3*E,q=F*(T+1)*3,Q=(F+1)*(T+1)*3,R.x=h[q+J],R.y=h[q+J+1],R.z=h[q+J+2],l.x=h[q+J+3],l.y=h[q+J+4],l.z=h[q+J+5],a.x=h[Q+J],a.y=h[Q+J+1],a.z=h[Q+J+2],D.x=h[Q+J+3],D.y=h[Q+J+4],D.z=h[Q+J+5],Y=(D.z-R.z)/(D.x-R.x),s=R.z-Y*R.x,l.subtractToRef(R,U),a.subtractToRef(R,w),D.subtractToRef(R,mh),j.tR.CrossToRef(mh,w,u),j.tR.CrossToRef(U,mh,c),u.normalize(),c.normalize(),t=-(u.x*R.x+u.y*R.y+u.z*R.z),f=-(c.x*l.x+c.y*l.y+c.z*l.z);const x=this._heightQuads[F*T+E];x.slope.OF(Y,s),x.facet1.OF(u.x,u.y,u.z,t),x.facet2.OF(c.x,c.y,c.z,f)}return this}serialize(h){super.serialize(h),h.subdivisionsX=this._subdivisionsX,h.subdivisionsY=this._subdivisionsY,h.minX=this._minX,h.maxX=this._maxX,h.fF=this._minZ,h.maxZ=this._maxZ,h.width=this._width,h.height=this._height}static Parse(h,R){const l=new w(h.name,R);return l._subdivisionsX=h.subdivisionsX||1,l._subdivisionsY=h.subdivisionsY||1,l._minX=h.minX,l._maxX=h.maxX,l._minZ=h.fF,l._maxZ=h.maxZ,l._width=h.width,l._height=h.height,l}}var mh=l(12689),u=l(12749),c=l(12902),J=l(12969);function q(h){const R=[],l=[],a=[],D=[];let F,w;const mh=h.width||h.size||1,u=h.height||h.size||1,c=0|(h.subdivisionsX||h.subdivisions||1),q=0|(h.subdivisionsY||h.subdivisions||1);for(F=0;F<=q;F++)for(w=0;w<=c;w++){const h=new j.tR(w*mh/c-mh/2,0,(q-F)*u/q-u/2),R=new j.tR(0,1,0);l.push(h.x,h.y,h.z),a.push(R.x,R.y,R.z),D.push(w/c,J.e?F/q:1-F/q)}for(F=0;F<q;F++)for(w=0;w<c;w++)R.push(w+1+(F+1)*(c+1)),R.push(w+1+F*(c+1)),R.push(w+F*(c+1)),R.push(w+(F+1)*(c+1)),R.push(w+1+(F+1)*(c+1)),R.push(w+F*(c+1));const Q=new U.b;return Q.indices=R,Q.Ih=l,Q.Lh=a,Q.rh=D,Q}function Q(h){const R=void 0!==h.xmin&&null!==h.xmin?h.xmin:-1,l=void 0!==h.zmin&&null!==h.zmin?h.zmin:-1,a=void 0!==h.xmax&&null!==h.xmax?h.xmax:1,D=void 0!==h.zmax&&null!==h.zmax?h.zmax:1,F=h.subdivisions||{w:1,h:1},w=h.precision||{w:1,h:1},mh=[],u=[],c=[],J=[];let q,Q,Y,s;F.h=F.h<1?1:F.h,F.w=F.w<1?1:F.w,w.w=w.w<1?1:w.w,w.h=w.h<1?1:w.h;const t=(a-R)/F.w,f=(D-l)/F.h;function T(h,R,l,a){const D=u.length/3,U=w.w+1;for(q=0;q<w.h;q++)for(Q=0;Q<w.w;Q++){const h=[D+Q+q*U,D+(Q+1)+q*U,D+(Q+1)+(q+1)*U,D+Q+(q+1)*U];mh.push(h[1]),mh.push(h[2]),mh.push(h[3]),mh.push(h[0]),mh.push(h[1]),mh.push(h[3])}const F=j.tR.Zero(),Y=new j.tR(0,1,0);for(q=0;q<=w.h;q++)for(F.z=q*(a-R)/w.h+R,Q=0;Q<=w.w;Q++)F.x=Q*(l-h)/w.w+h,F.y=0,u.push(F.x,F.y,F.z),c.push(Y.x,Y.y,Y.z),J.push(Q/w.w,q/w.h)}for(Y=0;Y<F.h;Y++)for(s=0;s<F.w;s++)T(R+s*t,l+Y*f,R+(s+1)*t,l+(Y+1)*f);const E=new U.b;return E.indices=mh,E.Ih=u,E.Lh=c,E.rh=J,E}function Y(h){const R=[],l=[],D=[],F=[];let w,mh;const u=h.colorFilter||new a.xR(.3,.59,.11),J=h.alphaFilter||0;let q=!1;if(h.minHeight>h.maxHeight){q=!0;const R=h.maxHeight;h.maxHeight=h.minHeight,h.minHeight=R}for(w=0;w<=h.subdivisions;w++)for(mh=0;mh<=h.subdivisions;mh++){const R=new j.tR(mh*h.width/h.subdivisions-h.width/2,0,(h.subdivisions-w)*h.height/h.subdivisions-h.height/2),a=4*(((R.x+h.width/2)/h.width*(h.bufferWidth-1)|0)+((1-(R.z+h.height/2)/h.height)*(h.bufferHeight-1)|0)*h.bufferWidth);let U=h.buffer[a]/255,Q=h.buffer[a+1]/255,Y=h.buffer[a+2]/255;const s=h.buffer[a+3]/255;q&&(U=1-U,Q=1-Q,Y=1-Y);const t=U*u.r+Q*u.g+Y*u.b;R.y=s>=J?h.minHeight+(h.maxHeight-h.minHeight)*t:h.minHeight-c.d,h.heightBuffer&&(h.heightBuffer[w*(h.subdivisions+1)+mh]=R.y),l.push(R.x,R.y,R.z),D.push(0,0,0),F.push(mh/h.subdivisions,1-w/h.subdivisions)}for(w=0;w<h.subdivisions;w++)for(mh=0;mh<h.subdivisions;mh++){const j=mh+1+(w+1)*(h.subdivisions+1),a=mh+1+w*(h.subdivisions+1),D=mh+w*(h.subdivisions+1),U=mh+(w+1)*(h.subdivisions+1),F=l[3*j+1]>=h.minHeight,u=l[3*a+1]>=h.minHeight,c=l[3*D+1]>=h.minHeight;F&&u&&c&&(R.push(j),R.push(a),R.push(D));l[3*U+1]>=h.minHeight&&F&&c&&(R.push(U),R.push(j),R.push(D))}U.b.ComputeNormals(l,R,D);const Q=new U.b;return Q.indices=R,Q.Ih=l,Q.Lh=D,Q.rh=F,Q}function s(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=new w(h,arguments.length>2?arguments[2]:void 0);l._setReady(!1),l._subdivisionsX=R.subdivisionsX||R.subdivisions||1,l._subdivisionsY=R.subdivisionsY||R.subdivisions||1,l._width=R.width||1,l._height=R.height||1,l._maxX=l._width/2,l._maxZ=l._height/2,l._minX=-l._maxX,l._minZ=-l._maxZ;return q(R).zh(l,R.updatable),l._setReady(!0),l}function t(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new D.b(h,l);return Q(R).zh(j,R.updatable),j}function f(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const D=l.width||10,U=l.height||10,F=l.subdivisions||1,c=l.minHeight||0,J=l.maxHeight||1,q=l.colorFilter||new a.xR(.3,.59,.11),Q=l.alphaFilter||0,s=l.updatable,t=l.onReady;j=j||u.b.LastCreatedScene;const f=new w(h,j);let T;f._subdivisionsX=F,f._subdivisionsY=F,f._width=D,f._height=U,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),l.passHeightBufferInCallback&&(T=new Float32Array((F+1)*(F+1)));const E=(h,R,l)=>{Y({width:D,height:U,subdivisions:F,minHeight:c,maxHeight:J,colorFilter:q,buffer:h,bufferWidth:R,bufferHeight:l,alphaFilter:Q,heightBuffer:T}).zh(f,s),t&&t(f,T),f._setReady(!0)};if("string"===typeof R){const h=h=>{var R;const l=h.width,a=h.height;if(j.mh)return;const D=null===(R=j)||void 0===R?void 0:R.getEngine().resizeImageBitmap(h,l,a);E(D,l,a)};mh.Tools.LoadImage(R,h,l.onError?l.onError:()=>{},j.offlineProvider)}else E(R.data,R.width,R.height);return f}U.b.CreateGround=q,U.b.CreateTiledGround=Q,U.b.CreateGroundFromHeightMap=Y,D.b.CreateGround=(h,R,l,j,a,D)=>s(h,{width:R,height:l,subdivisions:j,updatable:D},a),D.b.CreateTiledGround=(h,R,l,j,a,D,U,F,w)=>t(h,{xmin:R,zmin:l,xmax:j,zmax:a,subdivisions:D,precision:U,updatable:w},F),D.b.CreateGroundFromHeightMap=(h,R,l,j,a,D,U,F,w,mh,u)=>f(h,R,{width:l,height:j,subdivisions:a,minHeight:D,maxHeight:U,updatable:w,onReady:mh,alphaFilter:u},F)},14783:(h,R,l)=>{"use strict";l.d(R,{c:()=>q,e:()=>c,h:()=>J});var j=l(12900),a=l(13310),D=l(13298),U=l(13419),F=l(12984),w=l(12711);function mh(h){const R=[],l=[],j=h.lines,a=h.nh,U=[];let F=0;for(let D=0;D<j.length;D++){const h=j[D];for(let j=0;j<h.length;j++){const{x:w,y:mh,z:u}=h[j];if(l.push(w,mh,u),a){const h=a[D],{r:R,g:l,b:F,a:w}=h[j];U.push(R,l,F,w)}j>0&&(R.push(F-1),R.push(F)),F++}}const w=new D.b;return w.indices=R,w.Ih=l,a&&(w.nh=U),w}function u(h){const R=h.dashSize||3,l=h.gapSize||1,a=h.dashNb||200,U=h.points,F=[],w=[],mh=j.tR.Zero();let u=0,c=0,J=0,q=0,Q=0,Y=0,s=0;for(s=0;s<U.length-1;s++)U[s+1].subtractToRef(U[s],mh),u+=mh.length();for(J=u/a,q=R*J/(R+l),s=0;s<U.length-1;s++){U[s+1].subtractToRef(U[s],mh),c=Math.floor(mh.length()/J),mh.normalize();for(let h=0;h<c;h++)Q=J*h,F.push(U[s].x+Q*mh.x,U[s].y+Q*mh.y,U[s].z+Q*mh.z),F.push(U[s].x+(Q+q)*mh.x,U[s].y+(Q+q)*mh.y,U[s].z+(Q+q)*mh.z),w.push(Y,Y+1),Y+=2}const t=new D.b;return t.Ih=F,t.indices=w,t}function c(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=R.instance,a=R.lines,D=R.nh;if(j){const h=j.getVerticesData(F.g.PositionKind);let R,l;D&&(R=j.getVerticesData(F.g.ColorKind));let U=0,w=0;for(let j=0;j<a.length;j++){const F=a[j];for(let a=0;a<F.length;a++)h[U]=F[a].x,h[U+1]=F[a].y,h[U+2]=F[a].z,D&&R&&(l=D[j],R[w]=l[a].r,R[w+1]=l[a].g,R[w+2]=l[a].b,R[w+3]=l[a].a,w+=4),U+=3}return j.updateVerticesData(F.g.PositionKind,h,!1,!1),D&&R&&j.updateVerticesData(F.g.ColorKind,R,!1,!1),j.refreshBoundingInfo(),j}const w=!!D,u=new U.c(h,l,null,void 0,void 0,w,R.useVertexAlpha,R.material);return mh(R).zh(u,R.updatable),u}function J(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=R.nh?[R.nh]:null;return c(h,{lines:[R.points],updatable:R.updatable,instance:R.instance,nh:j,useVertexAlpha:R.useVertexAlpha,material:R.material},l)}function q(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=R.points,F=R.instance,mh=R.gapSize||1,c=R.dashSize||3;if(F){const h=h=>{const R=j.tR.Zero(),l=h.length/6;let a=0,U=0,w=0,mh=0,u=0,c=0,J=0,q=0;for(J=0;J<D.length-1;J++)D[J+1].subtractToRef(D[J],R),a+=R.length();w=a/l;const Q=F._creationDataStorage.dashSize;for(mh=Q*w/(Q+F._creationDataStorage.gapSize),J=0;J<D.length-1;J++)for(D[J+1].subtractToRef(D[J],R),U=Math.floor(R.length()/w),R.normalize(),q=0;q<U&&c<h.length;)u=w*q,h[c]=D[J].x+u*R.x,h[c+1]=D[J].y+u*R.y,h[c+2]=D[J].z+u*R.z,h[c+3]=D[J].x+(u+mh)*R.x,h[c+4]=D[J].y+(u+mh)*R.y,h[c+5]=D[J].z+(u+mh)*R.z,c+=6,q++;for(;c<h.length;)h[c]=D[J].x,h[c+1]=D[J].y,h[c+2]=D[J].z,c+=3};return(R.dashNb||R.dashSize||R.gapSize||R.useVertexAlpha||R.material)&&w.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),F.updateMeshPositions(h,!1),F}const J=new U.c(h,l,null,void 0,void 0,void 0,R.useVertexAlpha,R.material);return u(R).zh(J,R.updatable),J._creationDataStorage=new a.e,J._creationDataStorage.dashSize=c,J._creationDataStorage.gapSize=mh,J}D.b.CreateLineSystem=mh,D.b.CreateDashedLines=u,a.b.Om=function(h,R){return J(h,{points:R,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},a.b.CreateDashedLines=function(h,R,l,j,a){return q(h,{points:R,dashSize:l,gapSize:j,dashNb:a,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},14202:(h,R,l)=>{"use strict";l.d(R,{d:()=>F,e:()=>w});var j=l(13310),a=l(13298),D=l(12969);function U(h){const R=[],l=[],j=[],U=[],F=void 0!==h.width?h.width:void 0!==h.size?h.size:1,w=void 0!==h.height?h.height:void 0!==h.size?h.size:1,mh=0===h.sideOrientation?0:h.sideOrientation||a.b.DEFAULTSIDE,u=F/2,c=w/2;l.push(-u,-c,0),j.push(0,0,-1),U.push(0,D.e?1:0),l.push(u,-c,0),j.push(0,0,-1),U.push(1,D.e?1:0),l.push(u,c,0),j.push(0,0,-1),U.push(1,D.e?0:1),l.push(-u,c,0),j.push(0,0,-1),U.push(0,D.e?0:1),R.push(0),R.push(1),R.push(2),R.push(0),R.push(2),R.push(3),a.b._ComputeSides(mh,l,R,j,U,h.frontUVs,h.backUVs);const J=new a.b;return J.indices=R,J.Ih=l,J.Lh=j,J.rh=U,J}function F(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new j.b(h,l);R.sideOrientation=j.b._GetDefaultSideOrientation(R.sideOrientation),a._originalBuilderSideOrientation=R.sideOrientation;return U(R).zh(a,R.updatable),R.sourcePlane&&(a.translate(R.sourcePlane.normal,-R.sourcePlane.d),a.setDirection(R.sourcePlane.normal.scale(-1))),a}const w={bm:F};a.b.bm=U,j.b.bm=(h,R,l,j,a)=>F(h,{size:R,width:R,height:R,sideOrientation:a,updatable:j},l)},14283:(h,R,l)=>{"use strict";l.d(R,{b:()=>w});var j=l(12900),a=l(13310),D=l(13298),U=l(12969);function F(h){const R=0|(h.segments||32),l=h.diameterX||h.diameter||1,a=h.diameterY||h.diameter||1,F=h.diameterZ||h.diameter||1,w=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,mh=h.slice&&h.slice<=0?1:h.slice||1,u=0===h.sideOrientation?0:h.sideOrientation||D.b.DEFAULTSIDE,c=!!h.dedupTopBottomIndices,J=new j.tR(l/2,a/2,F/2),q=2+R,Q=2*q,Y=[],s=[],t=[],f=[];for(let D=0;D<=q;D++){const h=D/q,R=h*Math.PI*mh;for(let l=0;l<=Q;l++){const a=l/Q,D=a*Math.PI*2*w,F=j.Matrix.RotationZ(-R),mh=j.Matrix.RotationY(D),u=j.tR.TransformCoordinates(j.tR.Up(),F),c=j.tR.TransformCoordinates(u,mh),q=c.multiply(J),Y=c.divide(J).normalize();s.push(q.x,q.y,q.z),t.push(Y.x,Y.y,Y.z),f.push(a,U.e?1-h:h)}if(D>0){const h=s.length/3;for(let R=h-2*(Q+1);R+Q+2<h;R++)c?(D>1&&(Y.push(R),Y.push(R+1),Y.push(R+Q+1)),(D<q||mh<1)&&(Y.push(R+Q+1),Y.push(R+1),Y.push(R+Q+2))):(Y.push(R),Y.push(R+1),Y.push(R+Q+1),Y.push(R+Q+1),Y.push(R+1),Y.push(R+Q+2))}}D.b._ComputeSides(u,s,Y,t,f,h.frontUVs,h.backUVs);const T=new D.b;return T.indices=Y,T.Ih=s,T.Lh=t,T.rh=f,T}function w(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new a.b(h,l);R.sideOrientation=a.b._GetDefaultSideOrientation(R.sideOrientation),j._originalBuilderSideOrientation=R.sideOrientation;return F(R).zh(j,R.updatable),j}D.b.CreateSphere=F,a.b.CreateSphere=(h,R,l,j,a,D)=>w(h,{segments:R,diameterX:l,diameterY:l,diameterZ:l,sideOrientation:D,updatable:a},j)},15109:(h,R,l)=>{"use strict";l.d(R,{e:()=>F});var j=l(13436),a=l(14570),D=l(13455),U=l(13298);class F{static get Configuration(){return{get decoder(){return a.e.DefaultConfiguration},set decoder(h){a.e.DefaultConfiguration=h}}}static set Configuration(h){a.e.DefaultConfiguration=h.decoder}static get DecoderAvailable(){return(0,j.l)(a.e.DefaultConfiguration)}static get Default(){return F._Default??(F._Default=new F),F._Default}static ResetDefault(h){F._Default&&(h||F._Default.dispose(),F._Default=null)}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.DefaultNumWorkers;const R="number"===typeof h?{...a.e.DefaultConfiguration,numWorkers:h}:{...a.e.DefaultConfiguration,...h};this._decoder=new a.e(R)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(h,R,l){return this._decoder.decodeMeshToMeshDataAsync(h,R,l)}async decodeMeshToGeometryAsync(h,R,l,j){return await this._decoder.decodeMeshToGeometryAsync(h,R,l,j)}async _decodeMeshToGeometryForGltfAsync(h,R,l,j,a,D){return await this._decoder._decodeMeshToGeometryForGltfAsync(h,R,l,j,a,D)}async decodeMeshAsync(h,R){const l=await this._decoder.decodeMeshToMeshDataAsync(h,R),j=new U.b;l.indices&&(j.indices=l.indices);for(const a of l.attributes){const h=D.c.GetFloatData(a.data,a.size,D.c.GetDataType(a.data),a.byteOffset,a.byteStride,a.normalized,l.totalVertices);j.set(h,a.kind)}return j}}F.DefaultNumWorkers=(0,j.h)(),F._Default=null},14570:(h,R,l)=>{"use strict";l.d(R,{e:()=>mh});var j=l(13436),a=l(12689),D=l(13322),U=l(13455),F=l(12711),w=l(13446);class mh extends j.d{static get DefaultAvailable(){return(0,j.l)(mh.DefaultConfiguration)}static get Default(){return mh._Default??(mh._Default=new mh),mh._Default}static ResetDefault(h){mh._Default&&(h||mh._Default.dispose(),mh._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(h,R){return{module:await(R||DracoDecoderModule)({wasmBinary:h})}}_getWorkerContent(){return`${w.c}(${w.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:mh.DefaultConfiguration)}decodeMeshToMeshDataAsync(h,R,l){const j=h instanceof ArrayBuffer?new Int8Array(h):new Int8Array(h.buffer,h.byteOffset,h.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async h=>await new Promise(((a,D)=>{h.push(((h,U)=>{let w=null;const mh=[],u=R=>{h.removeEventListener("error",u),h.removeEventListener("message",c),D(R),U()},c=R=>{const j=R.data;switch(j.id){case"indices":w=j.data;break;case"attribute":mh.push({kind:j.kind,data:j.data,size:j.size,byteOffset:j.byteOffset,byteStride:j.byteStride,normalized:(D=j.kind,J=j.normalized,l&&void 0!==l[D]?(J!==l[D]&&F.c.Warn(`Normalized flag from Draco data (${J}) does not match normalized flag from glTF accessor (${l[D]}). Using flag from glTF accessor.`),l[D]):J)});break;case"decodeMeshDone":h.removeEventListener("error",u),h.removeEventListener("message",c),a({indices:w,attributes:mh,totalVertices:j.totalVertices}),U()}var D,J};h.addEventListener("error",u),h.addEventListener("message",c);const J=j.slice();h.postMessage({id:"decodeMesh",dataView:J,attributes:R},[J.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((h=>{let l=null;const a=[],D=(0,w.c)(h.module,j,R,(h=>{l=h}),((h,R,l,j,D,U)=>{a.push({kind:h,data:R,size:l,byteOffset:j,byteStride:D,normalized:U})}));return{indices:l,attributes:a,totalVertices:D}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(h,R,l,j){const a=await this.decodeMeshToMeshDataAsync(l,j),F=new D.b(h,R);a.indices&&F.setIndices(a.indices);for(const D of a.attributes)F.setVerticesBuffer(new U.c(R.getEngine(),D.data,D.kind,!1,void 0,D.byteStride,void 0,D.byteOffset,D.size,void 0,D.normalized,!0),a.totalVertices);return F}async _decodeMeshToGeometryForGltfAsync(h,R,l,j,a,F){const w=await this.decodeMeshToMeshDataAsync(l,j,a),mh=new D.b(h,R);F&&(mh._boundingInfo=F,mh.useBoundingInfoFromGeometry=!0),w.indices&&mh.setIndices(w.indices);for(const D of w.attributes)mh.setVerticesBuffer(new U.c(R.getEngine(),D.data,D.kind,!1,void 0,D.byteStride,void 0,D.byteOffset,D.size,void 0,D.normalized,!0),w.totalVertices);return mh}}mh.DefaultConfiguration={wasmUrl:`${a.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${a.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${a.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},mh._Default=null},14780:(h,R,l)=>{"use strict";l.d(R,{c:()=>Fh});var j=l(12900),a=l(13310),D=l(12984),U=l(13298),F=l(12969);function w(h){let R=h.pathArray;const l=h.closeArray||!1,j=h.closePath||!1,a=h.invertUV||!1,w=Math.floor(R[0].length/2);let mh=h.offset||w;mh=mh>w?w:Math.floor(mh);const u=0===h.sideOrientation?0:h.sideOrientation||U.b.DEFAULTSIDE,c=h.rh,J=h.nh,q=[],Q=[],Y=[],s=[],t=[],f=[],T=[],E=[];let x;const G=[],p=[];let O,y,v;if(R.length<2){const h=[],l=[];for(y=0;y<R[0].length-mh;y++)h.push(R[0][y]),l.push(R[0][y+mh]);R=[h,l]}let b=0;const I=j?1:0,L=l?1:0;let n,r,P,z,o,K;for(x=R[0].length,O=0;O<R.length+L;O++){for(T[O]=0,t[O]=[0],n=O===R.length?R[0]:R[O],r=n.length,x=x<r?x:r,v=0;v<r;)q.push(n[v].x,n[v].y,n[v].z),v>0&&(P=n[v].fR(n[v-1]).length(),z=P+T[O],t[O].push(z),T[O]=z),v++;j&&(v--,q.push(n[0].x,n[0].y,n[0].z),P=n[v].fR(n[0]).length(),z=P+T[O],t[O].push(z),T[O]=z),G[O]=r+I,p[O]=b,b+=r+I}let W,g,H=null,k=null;for(y=0;y<x+I;y++)for(E[y]=0,f[y]=[0],O=0;O<R.length-1+L;O++)o=R[O],K=O===R.length-1?R[0]:R[O+1],y===x?(H=o[0],k=K[0]):(H=o[y],k=K[y]),P=k.fR(H).length(),z=P+E[y],f[y].push(z),E[y]=z;if(c)for(O=0;O<c.length;O++)s.push(c[O].x,F.e?1-c[O].y:c[O].y);else for(O=0;O<R.length+L;O++)for(y=0;y<x+I;y++)W=0!=T[O]?t[O][y]/T[O]:0,g=0!=E[y]?f[y][O]/E[y]:0,a?s.push(g,W):s.push(W,F.e?1-g:g);O=0;let C=0,A=G[O]-1,e=G[O+1]-1,S=A<e?A:e,Z=p[1]-p[0];const M=G.length-1;for(;C<=S&&O<M;)Q.push(C,C+Z,C+1),Q.push(C+Z+1,C+1,C+Z),C+=1,C===S&&(O++,Z=p[O+1]-p[O],A=G[O]-1,e=G[O+1]-1,C=p[O],S=A<e?A+C:e+C);if(U.b.ComputeNormals(q,Q,Y),j){let h=0,l=0;for(O=0;O<R.length;O++){h=3*p[O],l=O+1<R.length?3*(p[O+1]-1):Y.length-3,Y[h]=.5*(Y[h]+Y[l]),Y[h+1]=.5*(Y[h+1]+Y[l+1]),Y[h+2]=.5*(Y[h+2]+Y[l+2]);const j=Math.sqrt(Y[h]*Y[h]+Y[h+1]*Y[h+1]+Y[h+2]*Y[h+2]);Y[h]/=j,Y[h+1]/=j,Y[h+2]/=j,Y[l]=Y[h],Y[l+1]=Y[h+1],Y[l+2]=Y[h+2]}}if(l){let h=3*p[0],l=3*p[R.length];for(y=0;y<x+I;y++){Y[h]=.5*(Y[h]+Y[l]),Y[h+1]=.5*(Y[h+1]+Y[l+1]),Y[h+2]=.5*(Y[h+2]+Y[l+2]);const R=Math.sqrt(Y[h]*Y[h]+Y[h+1]*Y[h+1]+Y[h+2]*Y[h+2]);Y[h]/=R,Y[h+1]/=R,Y[h+2]/=R,Y[l]=Y[h],Y[l+1]=Y[h+1],Y[l+2]=Y[h+2],h+=3,l+=3}}U.b._ComputeSides(u,q,Q,Y,s,h.frontUVs,h.backUVs);let i=null;if(J){i=new Float32Array(4*J.length);for(let h=0;h<J.length;h++)i[4*h]=J[h].r,i[4*h+1]=J[h].g,i[4*h+2]=J[h].b,i[4*h+3]=J[h].a}const d=new U.b,X=new Float32Array(q),V=new Float32Array(Y),B=new Float32Array(s);return d.indices=Q,d.Ih=X,d.Lh=V,d.rh=B,i&&d.set(i,D.g.ColorKind),j&&(d._idx=p),d}function mh(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const mh=R.pathArray,u=R.closeArray,c=R.closePath,J=a.b._GetDefaultSideOrientation(R.sideOrientation),q=R.instance,Q=R.updatable;if(q){const h=j.TmpVectors.tR[0].vF(Number.MAX_VALUE),l=j.TmpVectors.tR[1].vF(-Number.MAX_VALUE),w=R=>{let j=mh[0].length;const D=q;let U=0;const F=D._originalBuilderSideOrientation===a.b.DOUBLESIDE?2:1;for(let a=1;a<=F;++a)for(let F=0;F<mh.length;++F){const a=mh[F],w=a.length;j=j<w?j:w;for(let D=0;D<j;++D){const j=a[D];R[U]=j.x,R[U+1]=j.y,R[U+2]=j.z,h.minimizeInPlaceFromFloats(j.x,j.y,j.z),l.maximizeInPlaceFromFloats(j.x,j.y,j.z),U+=3}if(D._creationDataStorage&&D._creationDataStorage.closePath){const h=a[0];R[U]=h.x,R[U+1]=h.y,R[U+2]=h.z,U+=3}}},u=q.getVerticesData(D.g.PositionKind);if(w(u),q.hasBoundingInfo?q.getBoundingInfo().reConstruct(h,l,q._worldMatrix):q.buildBoundingInfo(h,l,q._worldMatrix),q.updateVerticesData(D.g.PositionKind,u,!1,!1),R.nh){const h=q.getVerticesData(D.g.ColorKind);for(let l=0,j=0;l<R.nh.length;l++,j+=4){const a=R.nh[l];h[j]=a.r,h[j+1]=a.g,h[j+2]=a.b,h[j+3]=a.a}q.updateVerticesData(D.g.ColorKind,h,!1,!1)}if(R.rh){const h=q.getVerticesData(D.g.UVKind);for(let l=0;l<R.rh.length;l++)h[2*l]=R.rh[l].x,h[2*l+1]=F.e?1-R.rh[l].y:R.rh[l].y;q.updateVerticesData(D.g.UVKind,h,!1,!1)}if(!q.areNormalsFrozen||q.isFacetDataEnabled){const h=q.GF(),R=q.getVerticesData(D.g.NormalKind),l=q.isFacetDataEnabled?q.getFacetDataParameters():null;if(U.b.ComputeNormals(u,h,R,l),q._creationDataStorage&&q._creationDataStorage.closePath){let h=0,l=0;for(let j=0;j<mh.length;j++)h=3*q._creationDataStorage.idx[j],l=j+1<mh.length?3*(q._creationDataStorage.idx[j+1]-1):R.length-3,R[h]=.5*(R[h]+R[l]),R[h+1]=.5*(R[h+1]+R[l+1]),R[h+2]=.5*(R[h+2]+R[l+2]),R[l]=R[h],R[l+1]=R[h+1],R[l+2]=R[h+2]}q.areNormalsFrozen||q.updateVerticesData(D.g.NormalKind,R,!1,!1)}return q}{const j=new a.b(h,l);j._originalBuilderSideOrientation=J,j._creationDataStorage=new a.e;const D=w(R);return c&&(j._creationDataStorage.idx=D._idx),j._creationDataStorage.closePath=c,j._creationDataStorage.closeArray=u,D.zh(j,Q),j}}U.b.CreateRibbon=w,a.b.CreateRibbon=function(h,R){return mh(h,{pathArray:R,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var u=l(14291),c=l(14145),J=l(12952);function q(h){const R=h.pattern||a.b.NO_FLIP,l=h.tileWidth||h.tileSize||1,j=h.tileHeight||h.tileSize||1,D=h.alignHorizontal||0,F=h.alignVertical||0,w=h.width||h.size||1,mh=Math.floor(w/l);let u=w-mh*l;const c=h.height||h.size||1,J=Math.floor(c/j);let q=c-J*j;const Q=l*mh/2,Y=j*J/2;let s=0,t=0,f=0,T=0,E=0,x=0;if(u>0||q>0){switch(f=-Q,T=-Y,E=Q,x=Y,D){case a.b.CENTER:u/=2,f-=u,E+=u;break;case a.b.LEFT:E+=u,s=-u/2;break;case a.b.RIGHT:f-=u,s=u/2}switch(F){case a.b.CENTER:q/=2,T-=q,x+=q;break;case a.b.BOTTOM:x+=q,t=-q/2;break;case a.b.TOP:T-=q,t=q/2}}const G=[],p=[],O=[];O[0]=[0,0,1,0,1,1,0,1],O[1]=[0,0,1,0,1,1,0,1],R!==a.b.ROTATE_TILE&&R!==a.b.ROTATE_ROW||(O[1]=[1,1,0,1,0,0,1,0]),R!==a.b.FLIP_TILE&&R!==a.b.FLIP_ROW||(O[1]=[1,0,0,0,0,1,1,1]),R!==a.b.FLIP_N_ROTATE_TILE&&R!==a.b.FLIP_N_ROTATE_ROW||(O[1]=[0,1,1,1,1,0,0,0]);let y=[];const v=[],b=[];let I=0;for(let U=0;U<J;U++)for(let h=0;h<mh;h++)G.push(h*l-Q+s,U*j-Y+t,0),G.push((h+1)*l-Q+s,U*j-Y+t,0),G.push((h+1)*l-Q+s,(U+1)*j-Y+t,0),G.push(h*l-Q+s,(U+1)*j-Y+t,0),b.push(I,I+1,I+3,I+1,I+2,I+3),y=R===a.b.FLIP_TILE||R===a.b.ROTATE_TILE||R===a.b.FLIP_N_ROTATE_TILE?y.concat(O[(h%2+U%2)%2]):R===a.b.FLIP_ROW||R===a.b.ROTATE_ROW||R===a.b.FLIP_N_ROTATE_ROW?y.concat(O[U%2]):y.concat(O[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),I+=4;if(u>0||q>0){const h=q>0&&(F===a.b.CENTER||F===a.b.TOP),U=q>0&&(F===a.b.CENTER||F===a.b.BOTTOM),w=u>0&&(D===a.b.CENTER||D===a.b.RIGHT),c=u>0&&(D===a.b.CENTER||D===a.b.LEFT);let O,L,n,r,P=[];if(h&&w&&(G.push(f+s,T+t,0),G.push(-Q+s,T+t,0),G.push(-Q+s,T+q+t,0),G.push(f+s,T+q+t,0),b.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,O=1-u/l,L=1-q/j,n=1,r=1,P=[O,L,n,L,n,r,O,r],R===a.b.ROTATE_ROW&&(P=[1-O,1-L,1-n,1-L,1-n,1-r,1-O,1-r]),R===a.b.FLIP_ROW&&(P=[1-O,L,1-n,L,1-n,r,1-O,r]),R===a.b.FLIP_N_ROTATE_ROW&&(P=[O,1-L,n,1-L,n,1-r,O,1-r]),y=y.concat(P),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&c&&(G.push(Q+s,T+t,0),G.push(E+s,T+t,0),G.push(E+s,T+q+t,0),G.push(Q+s,T+q+t,0),b.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,O=0,L=1-q/j,n=u/l,r=1,P=[O,L,n,L,n,r,O,r],(R===a.b.ROTATE_ROW||R===a.b.ROTATE_TILE&&mh%2===0)&&(P=[1-O,1-L,1-n,1-L,1-n,1-r,1-O,1-r]),(R===a.b.FLIP_ROW||R===a.b.FLIP_TILE&&mh%2===0)&&(P=[1-O,L,1-n,L,1-n,r,1-O,r]),(R===a.b.FLIP_N_ROTATE_ROW||R===a.b.FLIP_N_ROTATE_TILE&&mh%2===0)&&(P=[O,1-L,n,1-L,n,1-r,O,1-r]),y=y.concat(P),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&w&&(G.push(f+s,Y+t,0),G.push(-Q+s,Y+t,0),G.push(-Q+s,x+t,0),G.push(f+s,x+t,0),b.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,O=1-u/l,L=0,n=1,r=q/j,P=[O,L,n,L,n,r,O,r],(R===a.b.ROTATE_ROW&&J%2===1||R===a.b.ROTATE_TILE&&J%1===0)&&(P=[1-O,1-L,1-n,1-L,1-n,1-r,1-O,1-r]),(R===a.b.FLIP_ROW&&J%2===1||R===a.b.FLIP_TILE&&J%2===0)&&(P=[1-O,L,1-n,L,1-n,r,1-O,r]),(R===a.b.FLIP_N_ROTATE_ROW&&J%2===1||R===a.b.FLIP_N_ROTATE_TILE&&J%2===0)&&(P=[O,1-L,n,1-L,n,1-r,O,1-r]),y=y.concat(P),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&c&&(G.push(Q+s,Y+t,0),G.push(E+s,Y+t,0),G.push(E+s,x+t,0),G.push(Q+s,x+t,0),b.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,O=0,L=0,n=u/l,r=q/j,P=[O,L,n,L,n,r,O,r],(R===a.b.ROTATE_ROW&&J%2===1||R===a.b.ROTATE_TILE&&(J+mh)%2===1)&&(P=[1-O,1-L,1-n,1-L,1-n,1-r,1-O,1-r]),(R===a.b.FLIP_ROW&&J%2===1||R===a.b.FLIP_TILE&&(J+mh)%2===1)&&(P=[1-O,L,1-n,L,1-n,r,1-O,r]),(R===a.b.FLIP_N_ROTATE_ROW&&J%2===1||R===a.b.FLIP_N_ROTATE_TILE&&(J+mh)%2===1)&&(P=[O,1-L,n,1-L,n,1-r,O,1-r]),y=y.concat(P),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h){const h=[];O=0,L=1-q/j,n=1,r=1,h[0]=[O,L,n,L,n,r,O,r],h[1]=[O,L,n,L,n,r,O,r],R!==a.b.ROTATE_TILE&&R!==a.b.ROTATE_ROW||(h[1]=[1-O,1-L,1-n,1-L,1-n,1-r,1-O,1-r]),R!==a.b.FLIP_TILE&&R!==a.b.FLIP_ROW||(h[1]=[1-O,L,1-n,L,1-n,r,1-O,r]),R!==a.b.FLIP_N_ROTATE_TILE&&R!==a.b.FLIP_N_ROTATE_ROW||(h[1]=[O,1-L,n,1-L,n,1-r,O,1-r]);for(let j=0;j<mh;j++)G.push(j*l-Q+s,T+t,0),G.push((j+1)*l-Q+s,T+t,0),G.push((j+1)*l-Q+s,T+q+t,0),G.push(j*l-Q+s,T+q+t,0),b.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,y=R===a.b.FLIP_TILE||R===a.b.ROTATE_TILE||R===a.b.FLIP_N_ROTATE_TILE?y.concat(h[(j+1)%2]):R===a.b.FLIP_ROW||R===a.b.ROTATE_ROW||R===a.b.FLIP_N_ROTATE_ROW?y.concat(h[1]):y.concat(h[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const h=[];O=0,L=0,n=1,r=q/j,h[0]=[O,L,n,L,n,r,O,r],h[1]=[O,L,n,L,n,r,O,r],R!==a.b.ROTATE_TILE&&R!==a.b.ROTATE_ROW||(h[1]=[1-O,1-L,1-n,1-L,1-n,1-r,1-O,1-r]),R!==a.b.FLIP_TILE&&R!==a.b.FLIP_ROW||(h[1]=[1-O,L,1-n,L,1-n,r,1-O,r]),R!==a.b.FLIP_N_ROTATE_TILE&&R!==a.b.FLIP_N_ROTATE_ROW||(h[1]=[O,1-L,n,1-L,n,1-r,O,1-r]);for(let j=0;j<mh;j++)G.push(j*l-Q+s,x-q+t,0),G.push((j+1)*l-Q+s,x-q+t,0),G.push((j+1)*l-Q+s,x+t,0),G.push(j*l-Q+s,x+t,0),b.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,y=R===a.b.FLIP_TILE||R===a.b.ROTATE_TILE||R===a.b.FLIP_N_ROTATE_TILE?y.concat(h[(j+J)%2]):R===a.b.FLIP_ROW||R===a.b.ROTATE_ROW||R===a.b.FLIP_N_ROTATE_ROW?y.concat(h[J%2]):y.concat(h[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(w){const h=[];O=1-u/l,L=0,n=1,r=1,h[0]=[O,L,n,L,n,r,O,r],h[1]=[O,L,n,L,n,r,O,r],R!==a.b.ROTATE_TILE&&R!==a.b.ROTATE_ROW||(h[1]=[1-O,1-L,1-n,1-L,1-n,1-r,1-O,1-r]),R!==a.b.FLIP_TILE&&R!==a.b.FLIP_ROW||(h[1]=[1-O,L,1-n,L,1-n,r,1-O,r]),R!==a.b.FLIP_N_ROTATE_TILE&&R!==a.b.FLIP_N_ROTATE_ROW||(h[1]=[O,1-L,n,1-L,n,1-r,O,1-r]);for(let l=0;l<J;l++)G.push(f+s,l*j-Y+t,0),G.push(f+u+s,l*j-Y+t,0),G.push(f+u+s,(l+1)*j-Y+t,0),G.push(f+s,(l+1)*j-Y+t,0),b.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,y=R===a.b.FLIP_TILE||R===a.b.ROTATE_TILE||R===a.b.FLIP_N_ROTATE_TILE?y.concat(h[(l+1)%2]):R===a.b.FLIP_ROW||R===a.b.ROTATE_ROW||R===a.b.FLIP_N_ROTATE_ROW?y.concat(h[l%2]):y.concat(h[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){const h=[];O=0,L=0,n=u/j,r=1,h[0]=[O,L,n,L,n,r,O,r],h[1]=[O,L,n,L,n,r,O,r],R!==a.b.ROTATE_TILE&&R!==a.b.ROTATE_ROW||(h[1]=[1-O,1-L,1-n,1-L,1-n,1-r,1-O,1-r]),R!==a.b.FLIP_TILE&&R!==a.b.FLIP_ROW||(h[1]=[1-O,L,1-n,L,1-n,r,1-O,r]),R!==a.b.FLIP_N_ROTATE_TILE&&R!==a.b.FLIP_N_ROTATE_ROW||(h[1]=[O,1-L,n,1-L,n,1-r,O,1-r]);for(let l=0;l<J;l++)G.push(E-u+s,l*j-Y+t,0),G.push(E+s,l*j-Y+t,0),G.push(E+s,(l+1)*j-Y+t,0),G.push(E-u+s,(l+1)*j-Y+t,0),b.push(I,I+1,I+3,I+1,I+2,I+3),I+=4,y=R===a.b.FLIP_TILE||R===a.b.ROTATE_TILE||R===a.b.FLIP_N_ROTATE_TILE?y.concat(h[(l+mh)%2]):R===a.b.FLIP_ROW||R===a.b.ROTATE_ROW||R===a.b.FLIP_N_ROTATE_ROW?y.concat(h[l%2]):y.concat(h[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const L=0===h.sideOrientation?0:h.sideOrientation||U.b.DEFAULTSIDE;U.b._ComputeSides(L,G,b,p,y,h.frontUVs,h.backUVs);const n=new U.b;n.indices=b,n.Ih=G,n.Lh=p,n.rh=y;const r=L===U.b.DOUBLESIDE?v.concat(v):v;return n.nh=r,n}function Q(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new a.b(h,l);R.sideOrientation=a.b._GetDefaultSideOrientation(R.sideOrientation),j._originalBuilderSideOrientation=R.sideOrientation;return q(R).zh(j,R.updatable),j}function Y(h){const R=h.faceUV||new Array(6),l=h.faceColors,D=h.pattern||a.b.NO_FLIP,w=h.width||h.size||1,mh=h.height||h.size||1,u=h.depth||h.size||1,c=h.tileWidth||h.tileSize||1,Q=h.tileHeight||h.tileSize||1,Y=h.alignHorizontal||0,s=h.alignVertical||0,t=0===h.sideOrientation?0:h.sideOrientation||U.b.DEFAULTSIDE;for(let a=0;a<6;a++)void 0===R[a]&&(R[a]=new j.Vector4(0,0,1,1)),l&&void 0===l[a]&&(l[a]=new J.bF(1,1,1,1));const f=w/2,T=mh/2,E=u/2,x=[];for(let j=0;j<2;j++)x[j]=q({pattern:D,tileWidth:c,tileHeight:Q,width:w,height:mh,alignVertical:s,alignHorizontal:Y,sideOrientation:t});for(let j=2;j<4;j++)x[j]=q({pattern:D,tileWidth:c,tileHeight:Q,width:u,height:mh,alignVertical:s,alignHorizontal:Y,sideOrientation:t});let G=s;s===a.b.BOTTOM?G=a.b.TOP:s===a.b.TOP&&(G=a.b.BOTTOM);for(let j=4;j<6;j++)x[j]=q({pattern:D,tileWidth:c,tileHeight:Q,width:w,height:u,alignVertical:G,alignHorizontal:Y,sideOrientation:t});let p=[],O=[],y=[],v=[];const b=[],I=[],L=[],n=[];let r=0,P=0;for(let a=0;a<6;a++){const h=x[a].Ih.length;I[a]=[],L[a]=[];for(let R=0;R<h/3;R++)I[a].push(new j.tR(x[a].Ih[3*R],x[a].Ih[3*R+1],x[a].Ih[3*R+2])),L[a].push(new j.tR(x[a].Lh[3*R],x[a].Lh[3*R+1],x[a].Lh[3*R+2]));r=x[a].rh.length,n[a]=[];for(let l=0;l<r;l+=2)n[a][l]=R[a].x+(R[a].z-R[a].x)*x[a].rh[l],n[a][l+1]=R[a].y+(R[a].w-R[a].y)*x[a].rh[l+1],F.e&&(n[a][l+1]=1-n[a][l+1]);if(y=y.concat(n[a]),v=v.concat(x[a].indices.map((h=>h+P))),P+=I[a].length,l)for(let R=0;R<4;R++)b.push(l[a].r,l[a].g,l[a].b,l[a].a)}const z=new j.tR(0,0,E),o=j.Matrix.RotationY(Math.PI);p=I[0].map((h=>j.tR.TransformNormal(h,o).add(z))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[]),O=L[0].map((h=>j.tR.TransformNormal(h,o))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[]),p=p.concat(I[1].map((h=>h.fR(z))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[])),O=O.concat(L[1].map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[]));const K=new j.tR(f,0,0),W=j.Matrix.RotationY(-Math.PI/2);p=p.concat(I[2].map((h=>j.tR.TransformNormal(h,W).add(K))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[])),O=O.concat(L[2].map((h=>j.tR.TransformNormal(h,W))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[]));const g=j.Matrix.RotationY(Math.PI/2);p=p.concat(I[3].map((h=>j.tR.TransformNormal(h,g).fR(K))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[])),O=O.concat(L[3].map((h=>j.tR.TransformNormal(h,g))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[]));const H=new j.tR(0,T,0),k=j.Matrix.RotationX(Math.PI/2);p=p.concat(I[4].map((h=>j.tR.TransformNormal(h,k).add(H))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[])),O=O.concat(L[4].map((h=>j.tR.TransformNormal(h,k))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[]));const C=j.Matrix.RotationX(-Math.PI/2);p=p.concat(I[5].map((h=>j.tR.TransformNormal(h,C).fR(H))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[])),O=O.concat(L[5].map((h=>j.tR.TransformNormal(h,C))).map((h=>[h.x,h.y,h.z])).reduce(((h,R)=>h.concat(R)),[])),U.b._ComputeSides(t,p,v,O,y);const A=new U.b;if(A.indices=v,A.Ih=p,A.Lh=O,A.rh=y,l){const h=t===U.b.DOUBLESIDE?b.concat(b):b;A.nh=h}return A}function s(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new a.b(h,l);R.sideOrientation=a.b._GetDefaultSideOrientation(R.sideOrientation),j._originalBuilderSideOrientation=R.sideOrientation;return Y(R).zh(j,R.updatable),j}U.b.CreateTiledPlane=q;U.b.CreateTiledBox=Y;var t=l(14283),f=l(13126),T=l(13089);function E(h){const R=h.height||2;let l=0===h.diameterTop?0:h.diameterTop||h.diameter||1,D=0===h.diameterBottom?0:h.diameterBottom||h.diameter||1;l=l||1e-5,D=D||1e-5;const w=0|(h.tessellation||24),mh=0|(h.subdivisions||1),u=!!h.hasRings,c=!!h.enclose,q=0===h.cap?0:h.cap||a.b.CAP_ALL,Q=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,Y=0===h.sideOrientation?0:h.sideOrientation||U.b.DEFAULTSIDE,s=h.faceUV||new Array(3),t=h.faceColors,f=2+(1+(1!==Q&&c?2:0))*(u?mh:1);let E;for(E=0;E<f;E++)t&&void 0===t[E]&&(t[E]=new J.bF(1,1,1,1));for(E=0;E<f;E++)s&&void 0===s[E]&&(s[E]=new j.Vector4(0,0,1,1));const x=[],G=[],p=[],O=[],y=[],v=2*Math.PI*Q/w;let b,I,L;const n=(D-l)/2/R,r=j.tR.Zero(),P=j.tR.Zero(),z=j.tR.Zero(),o=j.tR.Zero(),K=j.tR.Zero(),W=T.c.Y;let g,H,k,C=1,A=1,e=0,S=0;for(g=0;g<=mh;g++)for(I=g/mh,L=(I*(l-D)+D)/2,C=u&&0!==g&&g!==mh?2:1,k=0;k<C;k++){for(u&&(A+=k),c&&(A+=2*k),H=0;H<=w;H++)b=H*v,r.x=Math.cos(-b)*L,r.y=-R/2+I*R,r.z=Math.sin(-b)*L,0===l&&g===mh?(P.x=p[p.length-3*(w+1)],P.y=p[p.length-3*(w+1)+1],P.z=p[p.length-3*(w+1)+2]):(P.x=r.x,P.z=r.z,P.y=Math.sqrt(P.x*P.x+P.z*P.z)*n,P.normalize()),0===H&&(z.D(r),o.D(P)),G.push(r.x,r.y,r.z),p.push(P.x,P.y,P.z),S=u?e!==A?s[A].y:s[A].w:s[A].y+(s[A].w-s[A].y)*I,O.push(s[A].x+(s[A].z-s[A].x)*H/w,F.e?1-S:S),t&&y.push(t[A].r,t[A].g,t[A].b,t[A].a);1!==Q&&c&&(G.push(r.x,r.y,r.z),G.push(0,r.y,0),G.push(0,r.y,0),G.push(z.x,z.y,z.z),j.tR.CrossToRef(W,P,K),K.normalize(),p.push(K.x,K.y,K.z,K.x,K.y,K.z),j.tR.CrossToRef(o,W,K),K.normalize(),p.push(K.x,K.y,K.z,K.x,K.y,K.z),S=u?e!==A?s[A+1].y:s[A+1].w:s[A+1].y+(s[A+1].w-s[A+1].y)*I,O.push(s[A+1].x,F.e?1-S:S),O.push(s[A+1].z,F.e?1-S:S),S=u?e!==A?s[A+2].y:s[A+2].w:s[A+2].y+(s[A+2].w-s[A+2].y)*I,O.push(s[A+2].x,F.e?1-S:S),O.push(s[A+2].z,F.e?1-S:S),t&&(y.push(t[A+1].r,t[A+1].g,t[A+1].b,t[A+1].a),y.push(t[A+1].r,t[A+1].g,t[A+1].b,t[A+1].a),y.push(t[A+2].r,t[A+2].g,t[A+2].b,t[A+2].a),y.push(t[A+2].r,t[A+2].g,t[A+2].b,t[A+2].a))),e!==A&&(e=A)}const Z=1!==Q&&c?w+4:w;for(g=0,A=0;A<mh;A++){let h=0,R=0,l=0,j=0;for(H=0;H<w;H++)h=g*(Z+1)+H,R=(g+1)*(Z+1)+H,l=g*(Z+1)+(H+1),j=(g+1)*(Z+1)+(H+1),x.push(h,R,l),x.push(j,l,R);1!==Q&&c&&(x.push(h+2,R+2,l+2),x.push(j+2,l+2,R+2),x.push(h+4,R+4,l+4),x.push(j+4,l+4,R+4)),g=u?g+2:g+1}const M=h=>{const a=h?l/2:D/2;if(0===a)return;let U,mh,u;const c=h?s[f-1]:s[0];let J=null;t&&(J=h?t[f-1]:t[0]);const q=G.length/3,Y=h?R/2:-R/2,T=new j.tR(0,Y,0);G.push(T.x,T.y,T.z),p.push(0,h?1:-1,0);const E=c.y+.5*(c.w-c.y);O.push(c.x+.5*(c.z-c.x),F.e?1-E:E),J&&y.push(J.r,J.g,J.b,J.a);const v=new j.Vector2(.5,.5);for(u=0;u<=w;u++){U=2*Math.PI*u*Q/w;const R=Math.cos(-U),l=Math.sin(-U);mh=new j.tR(R*a,Y,l*a);const D=new j.Vector2(R*v.x+.5,l*v.y+.5);G.push(mh.x,mh.y,mh.z),p.push(0,h?1:-1,0);const q=c.y+(c.w-c.y)*D.y;O.push(c.x+(c.z-c.x)*D.x,F.e?1-q:q),J&&y.push(J.r,J.g,J.b,J.a)}for(u=0;u<w;u++)h?(x.push(q),x.push(q+(u+2)),x.push(q+(u+1))):(x.push(q),x.push(q+(u+1)),x.push(q+(u+2)))};q!==a.b.CAP_START&&q!==a.b.CAP_ALL||M(!1),q!==a.b.CAP_END&&q!==a.b.CAP_ALL||M(!0),U.b._ComputeSides(Y,G,x,p,O,h.frontUVs,h.backUVs);const i=new U.b;return i.indices=x,i.Ih=G,i.Lh=p,i.rh=O,t&&(i.nh=y),i}function x(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const j=new a.b(h,l);R.sideOrientation=a.b._GetDefaultSideOrientation(R.sideOrientation),j._originalBuilderSideOrientation=R.sideOrientation;return E(R).zh(j,R.updatable),j}function G(h){const R=[],l=[],a=[],D=[],w=h.diameter||1,mh=h.thickness||.5,u=0|(h.tessellation||16),c=0===h.sideOrientation?0:h.sideOrientation||U.b.DEFAULTSIDE,J=u+1;for(let U=0;U<=u;U++){const h=U/u,c=U*Math.PI*2/u-Math.PI/2,q=j.Matrix.Translation(w/2,0,0).multiply(j.Matrix.RotationY(c));for(let w=0;w<=u;w++){const c=1-w/u,Q=w*Math.PI*2/u+Math.PI,Y=Math.cos(Q),s=Math.sin(Q);let t=new j.tR(Y,s,0),f=t.scale(mh/2);const T=new j.Vector2(h,c);f=j.tR.TransformCoordinates(f,q),t=j.tR.TransformNormal(t,q),l.push(f.x,f.y,f.z),a.push(t.x,t.y,t.z),D.push(T.x,F.e?1-T.y:T.y);const E=(U+1)%J,x=(w+1)%J;R.push(U*J+w),R.push(U*J+x),R.push(E*J+w),R.push(U*J+x),R.push(E*J+x),R.push(E*J+w)}}U.b._ComputeSides(c,l,R,a,D,h.frontUVs,h.backUVs);const q=new U.b;return q.indices=R,q.Ih=l,q.Lh=a,q.rh=D,q}function p(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const j=new a.b(h,l);R.sideOrientation=a.b._GetDefaultSideOrientation(R.sideOrientation),j._originalBuilderSideOrientation=R.sideOrientation;return G(R).zh(j,R.updatable),j}U.b.CreateCylinder=E,a.b.CreateCylinder=(h,R,l,j,D,U,F,w,mh)=>{void 0!==F&&F instanceof f.e||(void 0!==F&&(mh=w||a.b.DEFAULTSIDE,w=F),F=U,U=1);return x(h,{height:R,diameterTop:l,diameterBottom:j,tessellation:D,subdivisions:U,sideOrientation:mh,updatable:w},F)};function O(h){const R=[],l=[],a=[],D=[],w=h.radius||2,mh=h.tube||.5,u=h.radialSegments||32,c=h.tubularSegments||32,J=h.p||2,q=h.q||3,Q=0===h.sideOrientation?0:h.sideOrientation||U.b.DEFAULTSIDE,Y=h=>{const R=Math.cos(h),l=Math.sin(h),a=q/J*h,D=Math.cos(a),U=w*(2+D)*.5*R,F=w*(2+D)*l*.5,mh=w*Math.sin(a)*.5;return new j.tR(U,F,mh)};let s,t;for(s=0;s<=u;s++){const h=s%u/u*2*J*Math.PI,R=Y(h),a=Y(h+.01),U=a.fR(R);let w=a.add(R);const q=j.tR.Cross(U,w);for(w=j.tR.Cross(q,U),q.normalize(),w.normalize(),t=0;t<c;t++){const h=t%c/c*2*Math.PI,j=-mh*Math.cos(h),a=mh*Math.sin(h);l.push(R.x+j*w.x+a*q.x),l.push(R.y+j*w.y+a*q.y),l.push(R.z+j*w.z+a*q.z),D.push(s/u),D.push(F.e?1-t/c:t/c)}}for(s=0;s<u;s++)for(t=0;t<c;t++){const h=(t+1)%c,l=s*c+t,j=(s+1)*c+t,a=(s+1)*c+h,D=s*c+h;R.push(D),R.push(j),R.push(l),R.push(D),R.push(a),R.push(j)}U.b.ComputeNormals(l,R,a),U.b._ComputeSides(Q,l,R,a,D,h.frontUVs,h.backUVs);const f=new U.b;return f.indices=R,f.Ih=l,f.Lh=a,f.rh=D,f}function y(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const j=new a.b(h,l);R.sideOrientation=a.b._GetDefaultSideOrientation(R.sideOrientation),j._originalBuilderSideOrientation=R.sideOrientation;return O(R).zh(j,R.updatable),j}U.b.CreateTorus=G,a.b.CreateTorus=(h,R,l,j,a,D,U)=>p(h,{diameter:R,thickness:l,tessellation:j,sideOrientation:U,updatable:D},a);U.b.CreateTorusKnot=O,a.b.CreateTorusKnot=(h,R,l,j,a,D,U,F,w,mh)=>y(h,{radius:R,tube:l,radialSegments:j,tubularSegments:a,p:D,q:U,sideOrientation:mh,updatable:w},F);var v=l(14783),b=l(13428),I=l(13100);function L(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=R.path,D=R.shape,U=R.scale||1,F=R.rotation||0,w=0===R.cap?0:R.cap||a.b.NO_CAP,mh=R.updatable,u=a.b._GetDefaultSideOrientation(R.sideOrientation),c=R.instance||null,J=R.invertUV||!1,q=R.closeShape||!1,Q=R.closePath||!1,Y=R.capFunction||null;return r(h,D,j,U,F,null,null,Q,q,w,!1,l,!!mh,u,c,J,R.frontUVs||null,R.backUVs||null,R.firstNormal||null,!!R.adjustFrame,Y)}function n(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=R.path,D=R.shape,U=R.scaleFunction||(()=>1),F=R.rotationFunction||(()=>0),w=R.closePath||R.ribbonCloseArray||!1,mh=R.closeShape||R.ribbonClosePath||!1,u=0===R.cap?0:R.cap||a.b.NO_CAP,c=R.updatable,J=R.firstNormal||null,q=R.adjustFrame||!1,Q=a.b._GetDefaultSideOrientation(R.sideOrientation),Y=R.instance,s=R.invertUV||!1,t=R.capFunction||null;return r(h,D,j,null,null,U,F,w,mh,u,!0,l,!!c,Q,Y||null,s,R.frontUVs||null,R.backUVs||null,J,q,t||null)}function r(h,R,l,D,U,F,w,u,c,J,q,Q,Y,s,t,f,T,E,x,G,p){const O=(h,R,l,D,U,F,w,mh,u,c,J)=>{const q=l.getTangents(),Q=l.getNormals(),Y=l.getBinormals(),s=l.getDistances();if(J)for(let a=0;a<q.length;a++)if(0==q[a].x&&0==q[a].y&&0==q[a].z&&q[a].D(q[a-1]),0==Q[a].x&&0==Q[a].y&&0==Q[a].z&&Q[a].D(Q[a-1]),0==Y[a].x&&0==Y[a].y&&0==Y[a].z&&Y[a].D(Y[a-1]),a>0){let h=q[a-1];j.tR.Dot(h,q[a])<0&&q[a].scaleInPlace(-1),h=Q[a-1],j.tR.Dot(h,Q[a])<0&&Q[a].scaleInPlace(-1),h=Y[a-1],j.tR.Dot(h,Y[a])<0&&Y[a].scaleInPlace(-1)}let t=0;const f=c&&mh?mh:()=>null!==F?F:0,T=c&&w?w:()=>null!==U?U:1;let E=u===a.b.NO_CAP||u===a.b.CAP_END?0:2;const x=j.TmpVectors.Matrix[0];for(let a=0;a<R.length;a++){const l=[],U=f(a,s[a]),F=T(a,s[a]);j.Matrix.RotationAxisToRef(q[a],t,x);for(let D=0;D<h.length;D++){const U=q[a].scale(h[D].z).add(Q[a].scale(h[D].x)).add(Y[a].scale(h[D].y)),w=j.tR.Zero();j.tR.TransformCoordinatesToRef(U,x,w),w.scaleInPlace(F).addInPlace(R[a]),l[D]=w}D[E]=l,t+=U,E++}const G=p||(h=>{const R=Array(),l=j.tR.Zero();let a;for(a=0;a<h.length;a++)l.addInPlace(h[a]);for(l.scaleInPlace(1/h.length),a=0;a<h.length;a++)R.push(l);return R});switch(u){case a.b.NO_CAP:break;case a.b.CAP_START:D[0]=G(D[2]),D[1]=D[2];break;case a.b.CAP_END:D[E]=D[E-1],D[E+1]=G(D[E-1]);break;case a.b.CAP_ALL:D[0]=G(D[2]),D[1]=D[2],D[E]=D[E-1],D[E+1]=G(D[E-1])}return D};let y,v;if(t){const h=t._creationDataStorage;return y=x?h.path3D.update(l,x):h.path3D.update(l),v=O(R,l,h.path3D,h.pathArray,D,U,F,w,h.cap,q,G),t=mh("",{pathArray:v,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:t},Q||void 0)}y=x?new I.l(l,x):new I.l(l);v=O(R,l,y,new Array,D,U,F,w,J=J<0||J>3?0:J,q,G);const b=mh(h,{pathArray:v,closeArray:u,closePath:c,updatable:Y,sideOrientation:s,invertUV:f,frontUVs:T||void 0,backUVs:E||void 0},Q);return b._creationDataStorage.pathArray=v,b._creationDataStorage.path3D=y,b._creationDataStorage.cap=J,b}function P(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=R.arc?R.arc<=0||R.arc>1?1:R.arc:1,U=void 0===R.closed||R.closed,F=R.shape,w=R.radius||1,u=R.tessellation||64,c=R.clip||0,J=R.updatable,q=a.b._GetDefaultSideOrientation(R.sideOrientation),Q=R.cap||a.b.NO_CAP,Y=2*Math.PI,s=[],t=R.invertUV||!1;let f=0,T=0;const E=Y/u*D;let x,G;for(f=0;f<=u-c;f++){for(G=[],Q!=a.b.CAP_START&&Q!=a.b.CAP_ALL||(G.push(new j.tR(0,F[0].y,0)),G.push(new j.tR(Math.cos(f*E)*F[0].x*w,F[0].y,Math.sin(f*E)*F[0].x*w))),T=0;T<F.length;T++)x=new j.tR(Math.cos(f*E)*F[T].x*w,F[T].y,Math.sin(f*E)*F[T].x*w),G.push(x);Q!=a.b.CAP_END&&Q!=a.b.CAP_ALL||(G.push(new j.tR(Math.cos(f*E)*F[F.length-1].x*w,F[F.length-1].y,Math.sin(f*E)*F[F.length-1].x*w)),G.push(new j.tR(0,F[F.length-1].y,0))),s.push(G)}return mh(h,{pathArray:s,closeArray:U,sideOrientation:q,updatable:J,invertUV:t,frontUVs:R.frontUVs,backUVs:R.backUVs},l)}a.b.ExtrudeShape=function(h,R,l,j,D,U){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7?arguments[7]:void 0,mh=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0;return L(h,{shape:R,path:l,scale:j,rotation:D,cap:0===U?0:U||a.b.NO_CAP,sideOrientation:mh,instance:u,updatable:w},F)},a.b.ExtrudeShapeCustom=(h,R,l,j,D,U,F,w,mh,u,c,J)=>n(h,{shape:R,path:l,scaleFunction:j,rotationFunction:D,ribbonCloseArray:U,ribbonClosePath:F,cap:0===w?0:w||a.b.NO_CAP,sideOrientation:c,instance:J,updatable:u},mh);a.b.CreateLathe=(h,R,l,j,a,D,U)=>P(h,{shape:R,radius:l,tessellation:j,sideOrientation:U,updatable:D},a);var z=l(14202),o=l(14149);function K(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=R.path;let U=R.instance,F=1;void 0!==R.radius?F=R.radius:U&&(F=U._creationDataStorage.radius);const w=R.tessellation||64,u=R.radiusFunction||null;let c=R.cap||a.b.NO_CAP;const J=R.invertUV||!1,q=R.updatable,Q=a.b._GetDefaultSideOrientation(R.sideOrientation);R.arc=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1;const Y=(h,R,l,D,U,F,w,mh)=>{const u=R.getTangents(),c=R.getNormals(),J=R.getDistances(),q=2*Math.PI/U*mh,Q=F||(()=>D);let Y,s,t,f;const T=j.TmpVectors.Matrix[0];let E=w===a.b.NO_CAP||w===a.b.CAP_END?0:2;for(let a=0;a<h.length;a++){s=Q(a,J[a]),Y=Array(),t=c[a];for(let R=0;R<U;R++)j.Matrix.RotationAxisToRef(u[a],q*R,T),f=Y[R]?Y[R]:j.tR.Zero(),j.tR.TransformCoordinatesToRef(t,T,f),f.scaleInPlace(s).addInPlace(h[a]),Y[R]=f;l[E]=Y,E++}const x=(R,l)=>{const j=Array();for(let a=0;a<R;a++)j.push(h[l]);return j};switch(w){case a.b.NO_CAP:break;case a.b.CAP_START:l[0]=x(U,0),l[1]=l[2].slice(0);break;case a.b.CAP_END:l[E]=l[E-1].slice(0),l[E+1]=x(U,h.length-1);break;case a.b.CAP_ALL:l[0]=x(U,0),l[1]=l[2].slice(0),l[E]=l[E-1].slice(0),l[E+1]=x(U,h.length-1)}return l};let s,t;if(U){const h=U._creationDataStorage,l=R.arc||h.arc;return s=h.path3D.update(D),t=Y(D,s,h.pathArray,F,h.tessellation,u,h.cap,l),U=mh("",{pathArray:t,instance:U}),h.path3D=s,h.pathArray=t,h.arc=l,h.radius=F,U}s=new I.l(D);c=c<0||c>3?0:c,t=Y(D,s,new Array,F,w,u,c,R.arc);const f=mh(h,{pathArray:t,closePath:!0,closeArray:!1,updatable:q,sideOrientation:Q,invertUV:J,frontUVs:R.frontUVs,backUVs:R.backUVs},l);return f._creationDataStorage.pathArray=t,f._creationDataStorage.path3D=s,f._creationDataStorage.tessellation=w,f._creationDataStorage.cap=c,f._creationDataStorage.arc=R.arc,f._creationDataStorage.radius=F,f}function W(h){const R=[];R[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},R[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},R[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},R[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},R[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},R[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},R[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},R[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},R[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},R[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},R[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},R[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},R[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},R[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},R[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const l=h.type&&(h.type<0||h.type>=R.length)?0:h.type||0,a=h.size,D=h.sizeX||a||1,w=h.sizeY||a||1,mh=h.sizeZ||a||1,u=h.custom||R[l],c=u.face.length,q=h.faceUV||new Array(c),Q=h.faceColors,Y=void 0===h.flat||h.flat,s=0===h.sideOrientation?0:h.sideOrientation||U.b.DEFAULTSIDE,t=[],f=[],T=[],E=[],x=[];let G=0,p=0;const O=[];let y,v,b,I,L,n,r=0,P=0;if(Y)for(P=0;P<c;P++)Q&&void 0===Q[P]&&(Q[P]=new J.bF(1,1,1,1)),q&&void 0===q[P]&&(q[P]=new j.Vector4(0,0,1,1));if(Y)for(P=0;P<c;P++){const h=u.face[P].length;for(b=2*Math.PI/h,I=.5*Math.tan(b/2),L=.5,r=0;r<h;r++)t.push(u.vertex[u.face[P][r]][0]*D,u.vertex[u.face[P][r]][1]*w,u.vertex[u.face[P][r]][2]*mh),O.push(G),G++,y=q[P].x+(q[P].z-q[P].x)*(.5+I),v=q[P].y+(q[P].w-q[P].y)*(L-.5),E.push(y,F.e?1-v:v),n=I*Math.cos(b)-L*Math.sin(b),L=I*Math.sin(b)+L*Math.cos(b),I=n,Q&&x.push(Q[P].r,Q[P].g,Q[P].b,Q[P].a);for(r=0;r<h-2;r++)f.push(O[0+p],O[r+2+p],O[r+1+p]);p+=h}else{for(r=0;r<u.vertex.length;r++)t.push(u.vertex[r][0]*D,u.vertex[r][1]*w,u.vertex[r][2]*mh),E.push(0,F.e?1:0);for(P=0;P<c;P++)for(r=0;r<u.face[P].length-2;r++)f.push(u.face[P][0],u.face[P][r+2],u.face[P][r+1])}U.b.ComputeNormals(t,f,T),U.b._ComputeSides(s,t,f,T,E,h.frontUVs,h.backUVs);const z=new U.b;return z.Ih=t,z.indices=f,z.Lh=T,z.rh=E,Q&&Y&&(z.nh=x),z}function g(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new a.b(h,l);R.sideOrientation=a.b._GetDefaultSideOrientation(R.sideOrientation),j._originalBuilderSideOrientation=R.sideOrientation;return W(R).zh(j,R.updatable),j}a.b.CreateTube=(h,R,l,j,a,D,U,F,w,mh)=>K(h,{path:R,radius:l,tessellation:j,radiusFunction:a,arc:1,cap:D,updatable:F,sideOrientation:w,instance:mh},U);function H(h){const R=h.sideOrientation||U.b.DEFAULTSIDE,l=h.radius||1,a=void 0===h.flat||h.flat,D=0|(h.subdivisions||4),w=h.radiusX||l,mh=h.radiusY||l,u=h.radiusZ||l,c=(1+Math.sqrt(5))/2,J=[-1,c,-0,1,c,0,-1,-c,0,1,-c,0,0,-1,-c,0,1,-c,0,-1,c,0,1,c,c,0,1,c,0,-1,-c,0,1,-c,0,-1],q=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],Q=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Y=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],s=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],t=[],f=[],T=[],E=[];let x=0;const G=new Array(3),p=new Array(3);let O;for(O=0;O<3;O++)G[O]=j.tR.Zero(),p[O]=j.Vector2.Zero();for(let U=0;U<20;U++){for(O=0;O<3;O++){const h=q[3*U+O];G[O].OF(J[3*Q[h]],J[3*Q[h]+1],J[3*Q[h]+2]),G[O].normalize(),p[O].OF(.134765625*Y[2*h]+.05859375+-.0390625*s[U],.2333984375*Y[2*h+1]+.025390625+.01953125*s[U])}const h=(h,R,l,U)=>{const c=j.tR.Lerp(G[0],G[2],R/D),J=j.tR.Lerp(G[1],G[2],R/D),q=D===R?G[2]:j.tR.Lerp(c,J,h/(D-R));let Q;if(q.normalize(),a){const h=j.tR.Lerp(G[0],G[2],U/D),R=j.tR.Lerp(G[1],G[2],U/D);Q=j.tR.Lerp(h,R,l/(D-U))}else Q=new j.tR(q.x,q.y,q.z);Q.x/=w,Q.y/=mh,Q.z/=u,Q.normalize();const Y=j.Vector2.Lerp(p[0],p[2],R/D),s=j.Vector2.Lerp(p[1],p[2],R/D),O=D===R?p[2]:j.Vector2.Lerp(Y,s,h/(D-R));f.push(q.x*w,q.y*mh,q.z*u),T.push(Q.x,Q.y,Q.z),E.push(O.x,F.e?1-O.y:O.y),t.push(x),x++};for(let R=0;R<D;R++)for(let l=0;l+R<D;l++)h(l,R,l+1/3,R+1/3),h(l+1,R,l+1/3,R+1/3),h(l,R+1,l+1/3,R+1/3),l+R+1<D&&(h(l+1,R,l+2/3,R+2/3),h(l+1,R+1,l+2/3,R+2/3),h(l,R+1,l+2/3,R+2/3))}U.b._ComputeSides(R,f,t,T,E,h.frontUVs,h.backUVs);const y=new U.b;return y.indices=t,y.Ih=f,y.Lh=T,y.rh=E,y}function k(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new a.b(h,l);R.sideOrientation=a.b._GetDefaultSideOrientation(R.sideOrientation),j._originalBuilderSideOrientation=R.sideOrientation;return H(R).zh(j,R.updatable),j}U.b.CreatePolyhedron=W,a.b.CreatePolyhedron=(h,R,l)=>g(h,R,l);U.b.CreateIcoSphere=H,a.b.CreateIcoSphere=(h,R,l)=>k(h,R,l);var C=l(12917);const A=new j.tR(1,0,0),e=new j.tR(-1,0,0),S=new j.tR(0,1,0),Z=new j.tR(0,-1,0),M=new j.tR(0,0,1),i=new j.tR(0,0,-1);class d{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.tR.Zero(),R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.tR.Up(),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Vector2.Zero(),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,mh=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=h,this.normal=R,this.uv=l,this.vertexIdx=a,this.vertexIdxForBones=D,this.localPositionOverride=U,this.localNormalOverride=F,this.matrixIndicesOverride=w,this.matrixWeightsOverride=mh}clone(){var h,R,l,j;return new d(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(h=this.localPositionOverride)||void 0===h?void 0:h.slice(),null===(R=this.localNormalOverride)||void 0===R?void 0:R.slice(),null===(l=this.matrixIndicesOverride)||void 0===l?void 0:l.slice(),null===(j=this.matrixWeightsOverride)||void 0===j?void 0:j.slice())}}function X(h,R,l){var w,mh,u,c,J;const q=!!R.skeleton,Q=!(null===(w=R.morphTargetManager)||void 0===w||!w.numTargets),Y=l.localMode||q,s=R.GF(),t=q||Q?R.kF(!0,!0):R.getVerticesData(D.g.PositionKind),f=q||Q?R.getNormalsData(!0,!0):R.getVerticesData(D.g.NormalKind),T=Y?q?R.getVerticesData(D.g.PositionKind):t:null,E=Y?q?R.getVerticesData(D.g.NormalKind):f:null,x=R.getVerticesData(D.g.UVKind),G=q?R.getVerticesData(D.g.MatricesIndicesKind):null,p=q?R.getVerticesData(D.g.MatricesWeightsKind):null,O=q?R.getVerticesData(D.g.MatricesIndicesExtraKind):null,y=q?R.getVerticesData(D.g.MatricesWeightsExtraKind):null,v=l.position||j.tR.Zero();let b=l.normal||j.tR.Up();const I=l.size||j.tR.One(),L=l.angle||0;if(!b){const h=new j.tR(0,0,1),l=R.yh().activeCamera,a=j.tR.TransformCoordinates(h,l.getWorldMatrix());b=l.globalPosition.fR(a)}const n=-Math.atan2(b.z,b.x)-Math.PI/2,r=Math.sqrt(b.x*b.x+b.z*b.z),P=Math.atan2(b.y,r),z=new U.b;z.indices=[],z.Ih=[],z.Lh=[],z.rh=[],z.matricesIndices=q?[]:null,z.matricesWeights=q?[]:null,z.matricesIndicesExtra=O?[]:null,z.matricesWeightsExtra=y?[]:null;let o=0;const K=(h,R)=>{const a=new d;if(!s||!t||!f)return a;const D=s[h];if(a.vertexIdx=3*D,a.vertexIdxForBones=4*D,a.position=new j.tR(t[3*D],t[3*D+1],t[3*D+2]),j.tR.TransformCoordinatesToRef(a.position,R,a.position),a.normal=new j.tR(f[3*D],f[3*D+1],f[3*D+2]),j.tR.TransformNormalToRef(a.normal,R,a.normal),l.captureUVS&&x){const h=x[2*D+1];a.uv=new j.Vector2(x[2*D],F.e?1-h:h)}return a},W=[0,0,0,0],g=(h,R)=>{if(0===h.length)return h;const l=.5*Math.abs(j.tR.Dot(I,R)),a=(h,R,l,j)=>{for(let a=0;a<j;++a)if(h[l+a]===R)return l+a;return-1},D=(h,D)=>{const U=j.tR.GetClipFactor(h.position,D.position,R,l);let F=W,w=W;if(G&&p){const R=h.matrixIndicesOverride?0:h.vertexIdxForBones,l=h.matrixIndicesOverride??G,j=h.matrixWeightsOverride??p,mh=D.matrixIndicesOverride?0:D.vertexIdxForBones,u=D.matrixIndicesOverride??G,c=D.matrixWeightsOverride??p;F=[0,0,0,0],w=[0,0,0,0];let J=0;for(let h=0;h<4;++h)if(j[R+h]>0){const D=a(u,l[R+h],mh,4);F[J]=l[R+h],w[J]=(0,C.Lerp)(j[R+h],D>=0?c[D]:0,U),J++}for(let h=0;h<4&&J<4;++h){const j=u[mh+h];-1===a(l,j,R,4)&&(F[J]=j,w[J]=(0,C.Lerp)(0,c[mh+h],U),J++)}const q=w[0]+w[1]+w[2]+w[3];w[0]/=q,w[1]/=q,w[2]/=q,w[3]/=q}const mh=h.localPositionOverride?h.localPositionOverride[0]:(null===T||void 0===T?void 0:T[h.vertexIdx])??0,u=h.localPositionOverride?h.localPositionOverride[1]:(null===T||void 0===T?void 0:T[h.vertexIdx+1])??0,c=h.localPositionOverride?h.localPositionOverride[2]:(null===T||void 0===T?void 0:T[h.vertexIdx+2])??0,J=D.localPositionOverride?D.localPositionOverride[0]:(null===T||void 0===T?void 0:T[D.vertexIdx])??0,q=D.localPositionOverride?D.localPositionOverride[1]:(null===T||void 0===T?void 0:T[D.vertexIdx+1])??0,Q=D.localPositionOverride?D.localPositionOverride[2]:(null===T||void 0===T?void 0:T[D.vertexIdx+2])??0,Y=h.localNormalOverride?h.localNormalOverride[0]:(null===E||void 0===E?void 0:E[h.vertexIdx])??0,s=h.localNormalOverride?h.localNormalOverride[1]:(null===E||void 0===E?void 0:E[h.vertexIdx+1])??0,t=h.localNormalOverride?h.localNormalOverride[2]:(null===E||void 0===E?void 0:E[h.vertexIdx+2])??0,f=Y+((D.localNormalOverride?D.localNormalOverride[0]:(null===E||void 0===E?void 0:E[D.vertexIdx])??0)-Y)*U,x=s+((D.localNormalOverride?D.localNormalOverride[1]:(null===E||void 0===E?void 0:E[D.vertexIdx+1])??0)-s)*U,O=t+((D.localNormalOverride?D.localNormalOverride[2]:(null===E||void 0===E?void 0:E[D.vertexIdx+2])??0)-t)*U,y=Math.sqrt(f*f+x*x+O*O);return new d(j.tR.Lerp(h.position,D.position,U),j.tR.Lerp(h.normal,D.normal,U).normalize(),j.Vector2.Lerp(h.uv,D.uv,U),-1,-1,T?[mh+(J-mh)*U,u+(q-u)*U,c+(Q-c)*U]:null,E?[f/y,x/y,O/y]:null,F,w)};let U=null;h.length>3&&(U=[]);for(let F=0;F<h.length;F+=3){let a=0,w=null,mh=null,u=null,c=null;const J=j.tR.Dot(h[F].position,R)-l>0,q=j.tR.Dot(h[F+1].position,R)-l>0,Q=j.tR.Dot(h[F+2].position,R)-l>0;switch(a=(J?1:0)+(q?1:0)+(Q?1:0),a){case 0:h.length>3?(U.push(h[F]),U.push(h[F+1]),U.push(h[F+2])):U=h;break;case 1:if(U=U??new Array,J&&(w=h[F+1],mh=h[F+2],u=D(h[F],w),c=D(h[F],mh)),q){w=h[F],mh=h[F+2],u=D(h[F+1],w),c=D(h[F+1],mh),U.push(u),U.push(mh.clone()),U.push(w.clone()),U.push(mh.clone()),U.push(u.clone()),U.push(c);break}Q&&(w=h[F],mh=h[F+1],u=D(h[F+2],w),c=D(h[F+2],mh)),w&&mh&&u&&c&&(U.push(w.clone()),U.push(mh.clone()),U.push(u),U.push(c),U.push(u.clone()),U.push(mh.clone()));break;case 2:U=U??new Array,J||(w=h[F].clone(),mh=D(w,h[F+1]),u=D(w,h[F+2]),U.push(w),U.push(mh),U.push(u)),q||(w=h[F+1].clone(),mh=D(w,h[F+2]),u=D(w,h[F]),U.push(w),U.push(mh),U.push(u)),Q||(w=h[F+2].clone(),mh=D(w,h[F]),u=D(w,h[F+1]),U.push(w),U.push(mh),U.push(u))}}return U},H=R instanceof a.b?R:null,k=null===H||void 0===H?void 0:H._thinInstanceDataStorage.matrixData,X=(null===H||void 0===H?void 0:H.LF)||1,V=j.TmpVectors.Matrix[0];V.D(j.Matrix.IdentityReadOnly);for(let a=0;a<X;++a){if(null!==H&&void 0!==H&&H.hasThinInstances&&k){const h=16*a;V.setRowFromFloats(0,k[h+0],k[h+1],k[h+2],k[h+3]),V.setRowFromFloats(1,k[h+4],k[h+5],k[h+6],k[h+7]),V.setRowFromFloats(2,k[h+8],k[h+9],k[h+10],k[h+11]),V.setRowFromFloats(3,k[h+12],k[h+13],k[h+14],k[h+15])}const h=j.Matrix.RotationYawPitchRoll(n,P,L).multiply(j.Matrix.Translation(v.x,v.y,v.z)),D=j.Matrix.Invert(h),U=R.getWorldMatrix(),w=V.multiply(U).multiply(D),mh=new Array(3);for(let R=0;R<s.length;R+=3){let h=mh;if(h[0]=K(R,w),h[1]=K(R+1,w),h[2]=K(R+2,w),!(l.cullBackFaces&&-h[0].normal.z<=0&&-h[1].normal.z<=0&&-h[2].normal.z<=0)&&(h=g(h,A),h&&(h=g(h,e),h&&(h=g(h,S),h&&(h=g(h,Z),h&&(h=g(h,M),h&&(h=g(h,i),h)))))))for(let R=0;R<h.length;R++){const j=h[R];if(z.indices.push(o),Y?(j.localPositionOverride?(z.Ih[3*o]=j.localPositionOverride[0],z.Ih[3*o+1]=j.localPositionOverride[1],z.Ih[3*o+2]=j.localPositionOverride[2]):T&&(z.Ih[3*o]=T[j.vertexIdx],z.Ih[3*o+1]=T[j.vertexIdx+1],z.Ih[3*o+2]=T[j.vertexIdx+2]),j.localNormalOverride?(z.Lh[3*o]=j.localNormalOverride[0],z.Lh[3*o+1]=j.localNormalOverride[1],z.Lh[3*o+2]=j.localNormalOverride[2]):E&&(z.Lh[3*o]=E[j.vertexIdx],z.Lh[3*o+1]=E[j.vertexIdx+1],z.Lh[3*o+2]=E[j.vertexIdx+2])):(j.position.toArray(z.Ih,3*o),j.normal.toArray(z.Lh,3*o)),z.matricesIndices&&z.matricesWeights&&(j.matrixIndicesOverride?(z.matricesIndices[4*o]=j.matrixIndicesOverride[0],z.matricesIndices[4*o+1]=j.matrixIndicesOverride[1],z.matricesIndices[4*o+2]=j.matrixIndicesOverride[2],z.matricesIndices[4*o+3]=j.matrixIndicesOverride[3]):(G&&(z.matricesIndices[4*o]=G[j.vertexIdxForBones],z.matricesIndices[4*o+1]=G[j.vertexIdxForBones+1],z.matricesIndices[4*o+2]=G[j.vertexIdxForBones+2],z.matricesIndices[4*o+3]=G[j.vertexIdxForBones+3]),O&&z.matricesIndicesExtra&&(z.matricesIndicesExtra[4*o]=O[j.vertexIdxForBones],z.matricesIndicesExtra[4*o+1]=O[j.vertexIdxForBones+1],z.matricesIndicesExtra[4*o+2]=O[j.vertexIdxForBones+2],z.matricesIndicesExtra[4*o+3]=O[j.vertexIdxForBones+3])),j.matrixWeightsOverride?(z.matricesWeights[4*o]=j.matrixWeightsOverride[0],z.matricesWeights[4*o+1]=j.matrixWeightsOverride[1],z.matricesWeights[4*o+2]=j.matrixWeightsOverride[2],z.matricesWeights[4*o+3]=j.matrixWeightsOverride[3]):(p&&(z.matricesWeights[4*o]=p[j.vertexIdxForBones],z.matricesWeights[4*o+1]=p[j.vertexIdxForBones+1],z.matricesWeights[4*o+2]=p[j.vertexIdxForBones+2],z.matricesWeights[4*o+3]=p[j.vertexIdxForBones+3]),y&&z.matricesWeightsExtra&&(z.matricesWeightsExtra[4*o]=y[j.vertexIdxForBones],z.matricesWeightsExtra[4*o+1]=y[j.vertexIdxForBones+1],z.matricesWeightsExtra[4*o+2]=y[j.vertexIdxForBones+2],z.matricesWeightsExtra[4*o+3]=y[j.vertexIdxForBones+3]))),l.captureUVS)j.uv.toArray(z.rh,2*o);else{z.rh.push(.5+j.position.x/I.x);const h=.5+j.position.y/I.y;z.rh.push(F.e?1-h:h)}o++}}}0===z.indices.length&&(z.indices=null),0===z.Ih.length&&(z.Ih=null),0===z.Lh.length&&(z.Lh=null),0===z.rh.length&&(z.rh=null),0===(null===(mh=z.matricesIndices)||void 0===mh?void 0:mh.length)&&(z.matricesIndices=null),0===(null===(u=z.matricesWeights)||void 0===u?void 0:u.length)&&(z.matricesWeights=null),0===(null===(c=z.matricesIndicesExtra)||void 0===c?void 0:c.length)&&(z.matricesIndicesExtra=null),0===(null===(J=z.matricesWeightsExtra)||void 0===J?void 0:J.length)&&(z.matricesWeightsExtra=null);const B=new a.b(h,R.yh());return z.zh(B),Y?(B.skeleton=R.skeleton,B.parent=R):(B.position=v.clone(),B.rotation=new j.tR(P,n,L)),B.EF(!0),B.refreshBoundingInfo(!0,!0),B}function V(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const R=0|Math.max(h.subdivisions?h.subdivisions:2,1),l=0|Math.max(h.tessellation?h.tessellation:16,3),a=Math.max(h.height?h.height:1,0),D=Math.max(h.radius?h.radius:.25,0),w=0|Math.max(h.capSubdivisions?h.capSubdivisions:6,1),mh=l,u=R,c=Math.max(h.radiusTop?h.radiusTop:D,0),J=Math.max(h.radiusBottom?h.radiusBottom:D,0),q=a-(c+J),Q=2*Math.PI,Y=Math.max(h.topCapSubdivisions?h.topCapSubdivisions:w,1),s=Math.max(h.bottomCapSubdivisions?h.bottomCapSubdivisions:w,1),t=Math.acos((J-c)/a);let f=[];const T=[],E=[],x=[];let G=0;const p=[],O=.5*q,y=.5*Math.PI;let v,b;const I=j.tR.Zero(),L=j.tR.Zero(),n=Math.cos(t),r=Math.sin(t),P=new j.Vector2(c*r,O+c*n).fR(new j.Vector2(J*r,J*n-O)).length(),z=c*t+P+J*(y-t);let o=0;for(b=0;b<=Y;b++){const h=[],R=y-t*(b/Y);o+=c*t/Y;const l=Math.cos(R),j=Math.sin(R),a=l*c;for(v=0;v<=mh;v++){const R=v/mh,D=R*Q+0,U=Math.sin(D),w=Math.cos(D);L.x=a*U,L.y=O+j*c,L.z=a*w,T.push(L.x,L.y,L.z),I.set(l*U,j,l*w),E.push(I.x,I.y,I.z),x.push(R,F.e?o/z:1-o/z),h.push(G),G++}p.push(h)}const K=a-c-J+n*c-n*J,W=r*(J-c)/K;for(b=1;b<=u;b++){const h=[];o+=P/u;const R=r*(b*(J-c)/u+c);for(v=0;v<=mh;v++){const l=v/mh,j=l*Q+0,a=Math.sin(j),D=Math.cos(j);L.x=R*a,L.y=O+n*c-b*K/u,L.z=R*D,T.push(L.x,L.y,L.z),I.set(a,W,D).normalize(),E.push(I.x,I.y,I.z),x.push(l,F.e?o/z:1-o/z),h.push(G),G++}p.push(h)}for(b=1;b<=s;b++){const h=[],R=y-t-(Math.PI-t)*(b/s);o+=J*t/s;const l=Math.cos(R),j=Math.sin(R),a=l*J;for(v=0;v<=mh;v++){const R=v/mh,D=R*Q+0,U=Math.sin(D),w=Math.cos(D);L.x=a*U,L.y=j*J-O,L.z=a*w,T.push(L.x,L.y,L.z),I.set(l*U,j,l*w),E.push(I.x,I.y,I.z),x.push(R,F.e?o/z:1-o/z),h.push(G),G++}p.push(h)}for(v=0;v<mh;v++)for(b=0;b<Y+u+s;b++){const h=p[b][v],R=p[b+1][v],l=p[b+1][v+1],j=p[b][v+1];f.push(h),f.push(R),f.push(j),f.push(R),f.push(l),f.push(j)}if(f=f.reverse(),h.orientation&&!h.orientation.equals(j.tR.Up())){const R=new j.Matrix;h.orientation.clone().scale(.5*Math.PI).cross(j.tR.Up()).toQuaternion().toRotationMatrix(R);const l=j.tR.Zero();for(let h=0;h<T.length;h+=3)l.set(T[h],T[h+1],T[h+2]),j.tR.TransformCoordinatesToRef(l.clone(),R,l),T[h]=l.x,T[h+1]=l.y,T[h+2]=l.z}const g=new U.b;return g.Ih=T,g.Lh=E,g.rh=x,g.indices=f,g}function B(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:j.tR.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=new a.b(h,l);return V(R).zh(D,R.updatable),D}a.b.CreateDecal=(h,R,l,j,a,D)=>X(h,R,{position:l,normal:j,size:a,angle:D});a.b.CreateCapsule=(h,R,l)=>B(h,R,l),U.b.CreateCapsule=V;var N=l(12711),hh=l(12902);class Rh{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=h,this.y=R,h!==Math.floor(h)&&(h=Math.floor(h),N.c.Warn("x is not an integer, floor(x) used")),R!==Math.floor(R)&&(R=Math.floor(R),N.c.Warn("y is not an integer, floor(y) used"))}clone(){return new Rh(this.x,this.y)}rotate60About(h){const R=this.x;return this.x=h.x+h.y-this.y,this.y=R+this.y-h.x,this}rotateNeg60About(h){const R=this.x;return this.x=R+this.y-h.y,this.y=h.x+h.y-R,this}rotate120(h,R){h!==Math.floor(h)&&(h=Math.floor(h),N.c.Warn("m not an integer only floor(m) used")),R!==Math.floor(R)&&(R=Math.floor(R),N.c.Warn("n not an integer only floor(n) used"));const l=this.x;return this.x=h-l-this.y,this.y=R+l,this}rotateNeg120(h,R){h!==Math.floor(h)&&(h=Math.floor(h),N.c.Warn("m is not an integer, floor(m) used")),R!==Math.floor(R)&&(R=Math.floor(R),N.c.Warn("n is not an integer,   floor(n) used"));const l=this.x;return this.x=this.y-R,this.y=h+R-l-this.y,this}toCartesianOrigin(h,R){const l=j.tR.Zero();return l.x=h.x+2*this.x*R+this.y*R,l.y=h.y+Math.sqrt(3)*this.y*R,l}static Zero(){return new Rh(0,0)}}class lh{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new jh("icosahedron","Regular",[[0,hh.h,-1],[-hh.h,1,0],[-1,0,-hh.h],[1,0,-hh.h],[hh.h,1,0],[0,hh.h,1],[-1,0,hh.h],[-hh.h,-1,0],[0,-hh.h,-1],[hh.h,-1,0],[1,0,hh.h],[0,-hh.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let h=12;const R={},l=this.m,j=this.n;let a,D,U,F,w,mh=l,u=1,c=0;0!==j&&(mh=(0,C.HighestCommonFactor)(l,j)),u=l/mh,c=j/mh;const J=Rh.Zero(),q=new Rh(l,j),Q=new Rh(-j,l+j),Y=Rh.Zero(),s=Rh.Zero(),t=Rh.Zero();let f,T,E,x,G=[];const p=[],O=this.vertByDist,y=(l,j,a,D)=>{f=l+"|"+a,T=j+"|"+D,f in R||T in R?f in R&&!(T in R)?R[T]=R[f]:T in R&&!(f in R)&&(R[f]=R[T]):(R[f]=h,R[T]=h,h++),O[a][0]>2?p[R[f]]=[-O[a][0],O[a][1],R[f]]:p[R[f]]=[G[O[a][0]],O[a][1],R[f]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let v=0;v<20;v++){if(G=this.IDATA.face[v],U=G[2],F=G[1],w=G[0],E=J.x+"|"+J.y,f=v+"|"+E,f in R||(R[f]=U,p[U]=[G[O[E][0]],O[E][1]]),E=q.x+"|"+q.y,f=v+"|"+E,f in R||(R[f]=F,p[F]=[G[O[E][0]],O[E][1]]),E=Q.x+"|"+Q.y,f=v+"|"+E,f in R||(R[f]=w,p[w]=[G[O[E][0]],O[E][1]]),a=this.IDATA.edgematch[v][0],D=this.IDATA.edgematch[v][1],"B"===D)for(let h=1;h<mh;h++)s.x=l-h*(u+c),s.y=j+h*u,t.x=-h*c,t.y=h*(u+c),E=s.x+"|"+s.y,x=t.x+"|"+t.y,y(v,a,E,x);if("O"===D)for(let h=1;h<mh;h++)t.x=-h*c,t.y=h*(u+c),Y.x=h*u,Y.y=h*c,E=t.x+"|"+t.y,x=Y.x+"|"+Y.y,y(v,a,E,x);if(a=this.IDATA.edgematch[v][2],D=this.IDATA.edgematch[v][3],D&&"A"===D)for(let h=1;h<mh;h++)Y.x=h*u,Y.y=h*c,s.x=l-(mh-h)*(u+c),s.y=j+(mh-h)*u,E=Y.x+"|"+Y.y,x=s.x+"|"+s.y,y(v,a,E,x);for(let l=0;l<this.vertices.length;l++)E=this.vertices[l].x+"|"+this.vertices[l].y,f=v+"|"+E,f in R||(R[f]=h++,O[E][0]>2?p[R[f]]=[-O[E][0],O[E][1],R[f]]:p[R[f]]=[G[O[E][0]],O[E][1],R[f]])}this.closestTo=p,this.vecToidx=R}calcCoeffs(){const h=this.m,R=this.n,l=Math.sqrt(3)/3,j=h*h+R*R+h*R;this.coau=(h+R)/j,this.cobu=-R/j,this.coav=-l*(h-R)/j,this.cobv=l*(2*h+R)/j}createInnerFacets(){const h=this.m,R=this.n;for(let l=0;l<R+h+1;l++)for(let h=this.min[l];h<this.max[l]+1;h++)h<this.max[l]&&h<this.max[l+1]+1&&this.innerFacets.push(["|"+h+"|"+l,"|"+h+"|"+(l+1),"|"+(h+1)+"|"+l]),l>0&&h<this.max[l-1]&&h+1<this.max[l]+1&&this.innerFacets.push(["|"+h+"|"+l,"|"+(h+1)+"|"+l,"|"+(h+1)+"|"+(l-1)])}edgeVecsABOB(){const h=this.m,R=this.n,l=new Rh(-R,h+R);for(let j=1;j<h+R;j++){const h=new Rh(this.min[j],j),R=new Rh(this.min[j-1],j-1),a=new Rh(this.min[j+1],j+1),D=h.clone(),U=R.clone(),F=a.clone();D.rotate60About(l),U.rotate60About(l),F.rotate60About(l);const w=new Rh(this.max[D.y],D.y),mh=new Rh(this.max[D.y-1],D.y-1),u=new Rh(this.max[D.y-1]-1,D.y-1);D.x===w.x&&D.y===w.y||(D.x!==mh.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,mh,u]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,u,w])):D.y===F.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([h,R,mh]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([h,mh,a])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([h,R,mh]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,mh,w])))}}mapABOBtoOBOA(){const h=new Rh(0,0);for(let R=0;R<this.isoVecsABOB.length;R++){const l=[];for(let j=0;j<3;j++)h.x=this.isoVecsABOB[R][j].x,h.y=this.isoVecsABOB[R][j].y,0===this.vertexTypes[R][j]&&h.rotateNeg120(this.m,this.n),l.push(h.clone());this.isoVecsOBOA.push(l)}}mapABOBtoBAOA(){const h=new Rh(0,0);for(let R=0;R<this.isoVecsABOB.length;R++){const l=[];for(let j=0;j<3;j++)h.x=this.isoVecsABOB[R][j].x,h.y=this.isoVecsABOB[R][j].y,1===this.vertexTypes[R][j]&&h.rotate120(this.m,this.n),l.push(h.clone());this.isoVecsBAOA.push(l)}}MapToFace(h,R){const l=this.IDATA.face[h],a=l[2],D=l[1],U=l[0],F=j.tR.GR(this.IDATA.vertex[a]),w=j.tR.GR(this.IDATA.vertex[D]),mh=j.tR.GR(this.IDATA.vertex[U]),u=w.fR(F),c=mh.fR(F),J=u.scale(this.coau).add(c.scale(this.cobu)),q=u.scale(this.coav).add(c.scale(this.cobv)),Q=[];let Y,s=j.TmpVectors.tR[0];for(let j=0;j<this.cartesian.length;j++)s=J.scale(this.cartesian[j].x).add(q.scale(this.cartesian[j].y)).add(F),Q[j]=[s.x,s.y,s.z],Y=h+"|"+this.vertices[j].x+"|"+this.vertices[j].y,R.vertex[this.vecToidx[Y]]=[s.x,s.y,s.z]}build(h,R){const l=[],j=Rh.Zero(),a=new Rh(h,R),D=new Rh(-R,h+R);l.push(j,a,D);for(let E=R;E<h+1;E++)for(let R=0;R<h+1-E;R++)l.push(new Rh(R,E));if(R>0){const j=(0,C.HighestCommonFactor)(h,R),a=h/j,D=R/j;for(let F=1;F<j;F++)l.push(new Rh(F*a,F*D)),l.push(new Rh(-F*D,F*(a+D))),l.push(new Rh(h-F*(a+D),R+F*a));const U=h/R;for(let F=1;F<R;F++)for(let j=0;j<F*U;j++)l.push(new Rh(j,F)),l.push(new Rh(j,F).rotate120(h,R)),l.push(new Rh(j,F).rotateNeg120(h,R))}l.sort(((h,R)=>h.x-R.x)),l.sort(((h,R)=>h.y-R.y));const U=new Array(h+R+1),F=new Array(h+R+1);for(let E=0;E<U.length;E++)U[E]=1/0,F[E]=-1/0;let w=0,mh=0;const u=l.length;for(let E=0;E<u;E++)mh=l[E].x,w=l[E].y,U[w]=Math.min(mh,U[w]),F[w]=Math.max(mh,F[w]);const c=(l,j)=>{const a=l.clone();return"A"===j&&a.rotateNeg120(h,R),"B"===j&&a.rotate120(h,R),a.x<0?a.y:a.x+a.y},J=[],q=[],Q=[],Y=[],s={},t=[];let f=-1,T=-1;for(let E=0;E<u;E++)J[E]=l[E].toCartesianOrigin(new Rh(0,0),.5),q[E]=c(l[E],"O"),Q[E]=c(l[E],"A"),Y[E]=c(l[E],"B"),q[E]===Q[E]&&Q[E]===Y[E]?(f=3,T=q[E]):q[E]===Q[E]?(f=4,T=q[E]):Q[E]===Y[E]?(f=5,T=Q[E]):Y[E]===q[E]&&(f=6,T=q[E]),q[E]<Q[E]&&q[E]<Y[E]&&(f=2,T=q[E]),Q[E]<q[E]&&Q[E]<Y[E]&&(f=1,T=Q[E]),Y[E]<Q[E]&&Y[E]<q[E]&&(f=0,T=Y[E]),t.push([f,T,l[E].x,l[E].y]);t.sort(((h,R)=>h[2]-R[2])),t.sort(((h,R)=>h[3]-R[3])),t.sort(((h,R)=>h[1]-R[1])),t.sort(((h,R)=>h[0]-R[0]));for(let E=0;E<t.length;E++)s[t[E][2]+"|"+t[E][3]]=[t[E][0],t[E][1],E];return this.m=h,this.n=R,this.vertices=l,this.vertByDist=s,this.cartesian=J,this.min=U,this.max=F,this}}class jh{constructor(h,R,l,j){this.name=h,this.category=R,this.vertex=l,this.face=j}}class ah extends jh{innerToData(h,R){for(let l=0;l<R.innerFacets.length;l++)this.face.push(R.innerFacets[l].map((l=>R.vecToidx[h+l])))}mapABOBtoDATA(h,R){const l=R.IDATA.edgematch[h][0];for(let j=0;j<R.isoVecsABOB.length;j++){const a=[];for(let D=0;D<3;D++)0===R.vertexTypes[j][D]?a.push(h+"|"+R.isoVecsABOB[j][D].x+"|"+R.isoVecsABOB[j][D].y):a.push(l+"|"+R.isoVecsABOB[j][D].x+"|"+R.isoVecsABOB[j][D].y);this.face.push([R.vecToidx[a[0]],R.vecToidx[a[1]],R.vecToidx[a[2]]])}}mapOBOAtoDATA(h,R){const l=R.IDATA.edgematch[h][0];for(let j=0;j<R.isoVecsOBOA.length;j++){const a=[];for(let D=0;D<3;D++)1===R.vertexTypes[j][D]?a.push(h+"|"+R.isoVecsOBOA[j][D].x+"|"+R.isoVecsOBOA[j][D].y):a.push(l+"|"+R.isoVecsOBOA[j][D].x+"|"+R.isoVecsOBOA[j][D].y);this.face.push([R.vecToidx[a[0]],R.vecToidx[a[1]],R.vecToidx[a[2]]])}}mapBAOAtoDATA(h,R){const l=R.IDATA.edgematch[h][2];for(let j=0;j<R.isoVecsBAOA.length;j++){const a=[];for(let D=0;D<3;D++)1===R.vertexTypes[j][D]?a.push(h+"|"+R.isoVecsBAOA[j][D].x+"|"+R.isoVecsBAOA[j][D].y):a.push(l+"|"+R.isoVecsBAOA[j][D].x+"|"+R.isoVecsBAOA[j][D].y);this.face.push([R.vecToidx[a[0]],R.vecToidx[a[1]],R.vecToidx[a[2]]])}}orderData(h){const R=[];for(let D=0;D<13;D++)R[D]=[];const l=h.closestTo;for(let D=0;D<l.length;D++)l[D][0]>-1?l[D][1]>0&&R[l[D][0]].push([D,l[D][1]]):R[12].push([D,l[D][0]]);const j=[];for(let D=0;D<12;D++)j[D]=D;let a=12;for(let D=0;D<12;D++){R[D].sort(((h,R)=>h[1]-R[1]));for(let h=0;h<R[D].length;h++)j[R[D][h][0]]=a++}for(let D=0;D<R[12].length;D++)j[R[12][D][0]]=a++;for(let D=0;D<this.vertex.length;D++)this.vertex[D].push(j[D]);this.vertex.sort(((h,R)=>h[3]-R[3]));for(let D=0;D<this.vertex.length;D++)this.vertex[D].pop();for(let D=0;D<this.face.length;D++)for(let h=0;h<this.face[D].length;h++)this.face[D][h]=j[this.face[D][h]];this.sharedNodes=R[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(h,R){const l=[],j=[];let a=R.pop();j.push(a);let D=this.face[a].indexOf(h);D=(D+2)%3;let U=this.face[a][D];l.push(U);let F=0;for(;R.length>0;)a=R[F],this.face[a].indexOf(U)>-1?(D=(this.face[a].indexOf(U)+1)%3,U=this.face[a][D],l.push(U),j.push(a),R.splice(F,1),F=0):F++;return this.adjacentFaces.push(l),j}toGoldbergPolyhedronData(){const h=new jh("GeoDual","Goldberg",[],[]);h.name="GD dual";const R=this.vertex.length,l=new Array(R);for(let w=0;w<R;w++)l[w]=[];for(let w=0;w<this.face.length;w++)for(let h=0;h<3;h++)l[this.face[w][h]].push(w);let j=0,a=0,D=0,U=[],F=[];this.adjacentFaces=[];for(let w=0;w<l.length;w++){h.face[w]=this.setOrder(w,l[w].concat([]));for(const R of l[w]){j=0,a=0,D=0,U=this.face[R];for(let h=0;h<3;h++)F=this.vertex[U[h]],j+=F[0],a+=F[1],D+=F[2];h.vertex[R]=[j/3,a/3,D/3]}}return h}static BuildGeodesicData(h){const R=new ah("Geodesic-m-n","Geodesic",[[0,hh.h,-1],[-hh.h,1,0],[-1,0,-hh.h],[1,0,-hh.h],[hh.h,1,0],[0,hh.h,1],[-1,0,hh.h],[-hh.h,-1,0],[0,-hh.h,-1],[hh.h,-1,0],[1,0,hh.h],[0,-hh.h,1]],[]);h.setIndices(),h.calcCoeffs(),h.createInnerFacets(),h.edgeVecsABOB(),h.mapABOBtoOBOA(),h.mapABOBtoBAOA();for(let l=0;l<h.IDATA.face.length;l++)h.MapToFace(l,R),R.innerToData(l,h),"B"===h.IDATA.edgematch[l][1]&&R.mapABOBtoDATA(l,h),"O"===h.IDATA.edgematch[l][1]&&R.mapOBOAtoDATA(l,h),"A"===h.IDATA.edgematch[l][3]&&R.mapBAOAtoDATA(l,h);R.orderData(h);return R.vertex=R.vertex.map((function(h){const R=h[0],l=h[1],j=h[2],a=Math.sqrt(R*R+l*l+j*j);return h[0]*=1/a,h[1]*=1/a,h[2]*=1/a,h})),R}}a.b._GoldbergMeshParser=(h,R)=>Dh.Parse(h,R);class Dh extends a.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(h,R){return void 0===R?(h>this.goldbergData.nbUnsharedFaces-1&&(N.c.Warn("Maximum number of unshared faces used"),h=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+h):(h>11&&(N.c.Warn("Last pole used"),h=11),R>this.goldbergData.nbFacesAtPole-1&&(N.c.Warn("Maximum number of faces at a pole used"),R=this.goldbergData.nbFacesAtPole-1),12+h*this.goldbergData.nbFacesAtPole+R)}_changeGoldbergFaceColors(h){for(let l=0;l<h.length;l++){const R=h[l][0],j=h[l][1],a=h[l][2];for(let h=R;h<j+1;h++)this.goldbergData.faceColors[h]=a}const R=[];for(let l=0;l<12;l++)for(let h=0;h<5;h++)R.push(this.goldbergData.faceColors[l].r,this.goldbergData.faceColors[l].g,this.goldbergData.faceColors[l].b,this.goldbergData.faceColors[l].a);for(let l=12;l<this.goldbergData.faceColors.length;l++)for(let h=0;h<6;h++)R.push(this.goldbergData.faceColors[l].r,this.goldbergData.faceColors[l].g,this.goldbergData.faceColors[l].b,this.goldbergData.faceColors[l].a);return R}setGoldbergFaceColors(h){const R=this._changeGoldbergFaceColors(h);this.gh(D.g.ColorKind,R)}updateGoldbergFaceColors(h){const R=this._changeGoldbergFaceColors(h);this.updateVerticesData(D.g.ColorKind,R)}_changeGoldbergFaceUVs(h){const R=this.getVerticesData(D.g.UVKind);for(let l=0;l<h.length;l++){const j=h[l][0],a=h[l][1],D=h[l][2],U=h[l][3],F=h[l][4],w=[],mh=[];let u,c;for(let h=0;h<5;h++)u=D.x+U*Math.cos(F+h*Math.PI/2.5),c=D.y+U*Math.sin(F+h*Math.PI/2.5),u<0&&(u=0),u>1&&(u=1),w.push(u,c);for(let h=0;h<6;h++)u=D.x+U*Math.cos(F+h*Math.PI/3),c=D.y+U*Math.sin(F+h*Math.PI/3),u<0&&(u=0),u>1&&(u=1),mh.push(u,c);for(let h=j;h<Math.min(12,a+1);h++)for(let l=0;l<5;l++)R[10*h+2*l]=w[2*l],R[10*h+2*l+1]=w[2*l+1];for(let h=Math.max(12,j);h<a+1;h++)for(let l=0;l<6;l++)R[12*h-24+2*l]=mh[2*l],R[12*h-23+2*l]=mh[2*l+1]}return R}setGoldbergFaceUVs(h){const R=this._changeGoldbergFaceUVs(h);this.gh(D.g.UVKind,R)}updateGoldbergFaceUVs(h){const R=this._changeGoldbergFaceUVs(h);this.updateVerticesData(D.g.UVKind,R)}placeOnGoldbergFaceAt(h,R,l){const a=j.tR.RotationFromAxis(this.goldbergData.faceXaxis[R],this.goldbergData.faceYaxis[R],this.goldbergData.faceZaxis[R]);h.rotation=a,h.position=this.goldbergData.faceCenters[R].add(this.goldbergData.faceXaxis[R].scale(l.x)).add(this.goldbergData.faceYaxis[R].scale(l.y)).add(this.goldbergData.faceZaxis[R].scale(l.z))}serialize(h){super.serialize(h),h.type="GoldbergMesh";const R={};if(R.adjacentFaces=this.goldbergData.adjacentFaces,R.nbSharedFaces=this.goldbergData.nbSharedFaces,R.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,R.nbFaces=this.goldbergData.nbFaces,R.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){R.faceColors=[];for(const h of this.goldbergData.faceColors)R.faceColors.push(h.sF())}if(this.goldbergData.faceCenters){R.faceCenters=[];for(const h of this.goldbergData.faceCenters)R.faceCenters.push(h.sF())}if(this.goldbergData.faceZaxis){R.faceZaxis=[];for(const h of this.goldbergData.faceZaxis)R.faceZaxis.push(h.sF())}if(this.goldbergData.faceYaxis){R.faceYaxis=[];for(const h of this.goldbergData.faceYaxis)R.faceYaxis.push(h.sF())}if(this.goldbergData.faceXaxis){R.faceXaxis=[];for(const h of this.goldbergData.faceXaxis)R.faceXaxis.push(h.sF())}h.goldbergData=R}static Parse(h,R){const l=h.goldbergData;l.faceColors=l.faceColors.map((h=>J.bF.GR(h))),l.faceCenters=l.faceCenters.map((h=>j.tR.GR(h))),l.faceZaxis=l.faceZaxis.map((h=>j.tR.GR(h))),l.faceXaxis=l.faceXaxis.map((h=>j.tR.GR(h))),l.faceYaxis=l.faceYaxis.map((h=>j.tR.GR(h)));const a=new Dh(h.name,R);return a.goldbergData=l,a}}var Uh=l(13423);const Fh={CreateBox:c.d,CreateTiledBox:s,CreateSphere:t.b,CreateDisc:u.d,CreateIcoSphere:k,CreateRibbon:mh,CreateCylinder:x,CreateTorus:p,CreateTorusKnot:y,CreateLineSystem:v.e,Om:v.h,CreateDashedLines:v.c,ExtrudeShape:L,ExtrudeShapeCustom:n,CreateLathe:P,CreateTiledPlane:Q,bm:z.d,CreateGround:o.f,CreateTiledGround:o.h,CreateGroundFromHeightMap:o.d,CreatePolygon:b.c,ExtrudePolygon:b.f,CreateTube:K,CreatePolyhedron:g,CreateGeodesic:function(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=R.m||1;j!==Math.floor(j)&&(j=Math.floor(j),N.c.Warn("m not an integer only floor(m) used"));let a=R.n||0;if(a!==Math.floor(a)&&(a=Math.floor(a),N.c.Warn("n not an integer only floor(n) used")),a>j){const h=a;a=j,j=h,N.c.Warn("n > m therefore m and n swapped")}const D=new lh;return D.build(j,a),g(h,{custom:ah.BuildGeodesicData(D),size:R.size,sizeX:R.sizeX,sizeY:R.sizeY,sizeZ:R.sizeZ,faceUV:R.faceUV,faceColors:R.faceColors,flat:R.flat,updatable:R.updatable,sideOrientation:R.sideOrientation,frontUVs:R.frontUVs,backUVs:R.backUVs},l)},CreateGoldberg:function(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const D=R.size,w=R.sizeX||D||1,mh=R.sizeY||D||1,u=R.sizeZ||D||1;let c=R.m||1;c!==Math.floor(c)&&(c=Math.floor(c),N.c.Warn("m not an integer only floor(m) used"));let q=R.n||0;if(q!==Math.floor(q)&&(q=Math.floor(q),N.c.Warn("n not an integer only floor(n) used")),q>c){const h=q;q=c,c=h,N.c.Warn("n > m therefore m and n swapped")}const Q=new lh;Q.build(c,q);const Y=ah.BuildGeodesicData(Q),s=Y.toGoldbergPolyhedronData(),t=new Dh(h,l);R.sideOrientation=a.b._GetDefaultSideOrientation(R.sideOrientation),t._originalBuilderSideOrientation=R.sideOrientation;(function(h,R){const l=h.size,a=h.sizeX||l||1,D=h.sizeY||l||1,w=h.sizeZ||l||1,mh=0===h.sideOrientation?0:h.sideOrientation||U.b.DEFAULTSIDE,u=[],c=[],J=[],q=[];let Q=1/0,Y=-1/0,s=1/0,t=-1/0;for(let j=0;j<R.vertex.length;j++)Q=Math.min(Q,R.vertex[j][0]*a),Y=Math.max(Y,R.vertex[j][0]*a),s=Math.min(s,R.vertex[j][1]*D),t=Math.max(t,R.vertex[j][1]*D);let f=0;for(let U=0;U<R.face.length;U++){const h=R.face[U],l=j.tR.GR(R.vertex[h[0]]),mh=j.tR.GR(R.vertex[h[2]]),T=j.tR.GR(R.vertex[h[1]]),E=mh.fR(l),x=T.fR(l),G=j.tR.Cross(x,E).normalize();for(let j=0;j<h.length;j++){J.push(G.x,G.y,G.z);const l=R.vertex[h[j]];u.push(l[0]*a,l[1]*D,l[2]*w);const U=(l[1]*D-s)/(t-s);q.push((l[0]*a-Q)/(Y-Q),F.e?1-U:U)}for(let R=0;R<h.length-2;R++)c.push(f,f+R+2,f+R+1);f+=h.length}U.b._ComputeSides(mh,u,c,J,q);const T=new U.b;return T.Ih=u,T.indices=c,T.Lh=J,T.rh=q,T})(R,s).zh(t,R.updatable),t.goldbergData.nbSharedFaces=Y.sharedNodes,t.goldbergData.nbUnsharedFaces=Y.poleNodes,t.goldbergData.adjacentFaces=Y.adjacentFaces,t.goldbergData.nbFaces=t.goldbergData.nbSharedFaces+t.goldbergData.nbUnsharedFaces,t.goldbergData.nbFacesAtPole=(t.goldbergData.nbUnsharedFaces-12)/12;for(let a=0;a<Y.vertex.length;a++)t.goldbergData.faceCenters.push(j.tR.GR(Y.vertex[a])),t.goldbergData.faceCenters[a].x*=w,t.goldbergData.faceCenters[a].y*=mh,t.goldbergData.faceCenters[a].z*=u,t.goldbergData.faceColors.push(new J.bF(1,1,1,1));for(let a=0;a<s.face.length;a++){const h=s.face[a],R=j.tR.GR(s.vertex[h[0]]),l=j.tR.GR(s.vertex[h[2]]),D=j.tR.GR(s.vertex[h[1]]),U=l.fR(R),F=D.fR(R),w=j.tR.Cross(F,U).normalize(),mh=j.tR.Cross(F,w).normalize();t.goldbergData.faceXaxis.push(F.normalize()),t.goldbergData.faceYaxis.push(w),t.goldbergData.faceZaxis.push(mh)}return t},CreateDecal:X,CreateCapsule:B,CreateText:Uh.f}},14219:(h,R,l)=>{"use strict";l.d(R,{e:()=>FR});var j=l(12900),a=l(13247);class D extends a.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var U=l(12952),F=(l(13050),l(12852));class w{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(h){this._targetStopDuration!==h&&(this._targetStopDuration=h)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(h){this._noiseTexture!==h&&(this._noiseTexture=h,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(h){this._animationSheetEnabled!==h&&(this._animationSheetEnabled=h)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(h){this._isAnimationSheetEnabled!=h&&(this._isAnimationSheetEnabled=h,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(h){this._useLogarithmicDepth=h&&this.yh().getEngine().getCaps().fragmentDepthSupported}yh(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(h){switch(h){case w.BLENDMODE_MULTIPLYADD:return;case w.BLENDMODE_ADD:h=1;break;case w.BLENDMODE_ONEONE:h=6;break;case w.BLENDMODE_STANDARD:h=2;break;case w.BLENDMODE_MULTIPLY:h=4;break;case w.BLENDMODE_SUBTRACT:h=3}this._engine.setAlphaMode(h)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:j.tR.Zero()}set direction1(h){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=h)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:j.tR.Zero()}set direction2(h){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=h)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:j.tR.Zero()}set minEmitBox(h){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=h)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:j.tR.Zero()}set maxEmitBox(h){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=h)}get billboardMode(){return this._billboardMode}set billboardMode(h){this._billboardMode!==h&&(this._billboardMode=h,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(h){this._isBillboardBased!==h&&(this._isBillboardBased=h,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(h){this._attachImageProcessingConfiguration(h)}_attachImageProcessingConfiguration(h){h!==this._imageProcessingConfiguration&&(!h&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=h)}_reset(){}_removeGradientAndTexture(h,R,l){if(!R)return this;let j=0;for(const a of R){if(a.gradient===h){R.splice(j,1);break}j++}return l&&l.dispose(),this}constructor(h){this.animations=[],this.renderingGroupId=0,this.UR=j.tR.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new j.tR(10,10,10),this.onAnimationEnd=null,this.blendMode=w.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new j.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.xm=new j.tR(0,0,0),this._useLogarithmicDepth=!1,this.gravity=j.tR.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new U.bF(1,1,1,1),this.color2=new U.bF(1,1,1,1),this.colorDead=new U.bF(0,0,0,1),this.textureMask=new U.bF(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new D,this.id=h,this.name=h}createPointEmitter(h,R){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new j.tR(0,1,0),arguments.length>2&&void 0!==arguments[2]||new j.tR(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new j.tR(0,1,0),arguments.length>4&&void 0!==arguments[4]||new j.tR(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new j.tR(0,1,0),arguments.length>3&&void 0!==arguments[3]||new j.tR(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(h,R,l,j){throw new Error("Method not implemented.")}}w.BLENDMODE_ONEONE=0,w.BLENDMODE_STANDARD=1,w.BLENDMODE_ADD=2,w.BLENDMODE_MULTIPLY=3,w.BLENDMODE_MULTIPLYADD=4,w.BLENDMODE_SUBTRACT=-1,(0,F.f)("BABYLON.BaseParticleSystem",w);var mh=l(12917),u=l(12718);class c{constructor(){this.direction1=new j.tR(0,1,0),this.direction2=new j.tR(0,1,0),this.minEmitBox=new j.tR(-.5,-.5,-.5),this.maxEmitBox=new j.tR(.5,.5,.5)}startDirectionFunction(h,R,l,a){const D=(0,mh.RandomRange)(this.direction1.x,this.direction2.x),U=(0,mh.RandomRange)(this.direction1.y,this.direction2.y),F=(0,mh.RandomRange)(this.direction1.z,this.direction2.z);if(a)return R.x=D,R.y=U,void(R.z=F);j.tR.TransformNormalFromFloatsToRef(D,U,F,h,R)}startPositionFunction(h,R,l,a){const D=(0,mh.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),U=(0,mh.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),F=(0,mh.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(a)return R.x=D,R.y=U,void(R.z=F);j.tR.TransformCoordinatesFromFloatsToRef(D,U,F,h,R)}clone(){const h=new c;return u.e.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2),h.setVector3("minEmitBox",this.minEmitBox),h.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3),h.addUniform("minEmitBox",3),h.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.direction1=this.direction1.sF(),h.direction2=this.direction2.sF(),h.minEmitBox=this.minEmitBox.sF(),h.maxEmitBox=this.maxEmitBox.sF(),h}parse(h){j.tR.FromArrayToRef(h.direction1,0,this.direction1),j.tR.FromArrayToRef(h.direction2,0,this.direction2),j.tR.FromArrayToRef(h.minEmitBox,0,this.minEmitBox),j.tR.FromArrayToRef(h.maxEmitBox,0,this.maxEmitBox)}}class J{get radius(){return this._radius}set radius(h){this._radius=h,this._buildHeight()}get angle(){return this._angle}set angle(h){this._angle=h,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=l,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=R,this.radius=h}startDirectionFunction(h,R,l,a){a?j.TmpVectors.tR[0].D(l.VF).normalize():l.position.subtractToRef(h.getTranslation(),j.TmpVectors.tR[0]).normalize();const D=(0,mh.RandomRange)(0,this.directionRandomizer),U=(0,mh.RandomRange)(0,this.directionRandomizer),F=(0,mh.RandomRange)(0,this.directionRandomizer);R.x=j.TmpVectors.tR[0].x+D,R.y=j.TmpVectors.tR[0].y+U,R.z=j.TmpVectors.tR[0].z+F,R.normalize()}startPositionFunction(h,R,l,a){const D=(0,mh.RandomRange)(0,2*Math.PI);let U;this.emitFromSpawnPointOnly?U=1e-4:(U=(0,mh.RandomRange)(0,this.heightRange),U=1-U*U);let F=this._radius-(0,mh.RandomRange)(0,this._radius*this.radiusRange);F*=U;const w=F*Math.sin(D),u=F*Math.cos(D),c=U*this._height;if(a)return R.x=w,R.y=c,void(R.z=u);j.tR.TransformCoordinatesFromFloatsToRef(w,c,u,h,R)}clone(){const h=new J(this._radius,this._angle,this.directionRandomizer);return u.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat2("radius",this._radius,this.radiusRange),h.setFloat("coneAngle",this._angle),h.setFloat2("height",this._height,this.heightRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",2),h.addUniform("coneAngle",1),h.addUniform("height",2),h.addUniform("directionRandomizer",1)}getEffectDefines(){let h="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(h+="\n#define CONEEMITTERSPAWNPOINT"),h}getClassName(){return"ConeParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this._radius,h.angle=this._angle,h.directionRandomizer=this.directionRandomizer,h.radiusRange=this.radiusRange,h.heightRange=this.heightRange,h.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,h}parse(h){this.radius=h.radius,this.angle=h.angle,this.directionRandomizer=h.directionRandomizer,this.radiusRange=void 0!==h.radiusRange?h.radiusRange:1,this.heightRange=void 0!==h.radiusRange?h.heightRange:1,this.emitFromSpawnPointOnly=void 0!==h.emitFromSpawnPointOnly&&h.emitFromSpawnPointOnly}}class q extends J{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.tR(0,1,0),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.tR(0,1,0);super(h,R),this.direction1=l,this.direction2=a}startDirectionFunction(h,R){const l=(0,mh.RandomRange)(this.direction1.x,this.direction2.x),a=(0,mh.RandomRange)(this.direction1.y,this.direction2.y),D=(0,mh.RandomRange)(this.direction1.z,this.direction2.z);j.tR.TransformNormalFromFloatsToRef(l,a,D,h,R)}clone(){const h=new q(this.radius,this.angle,this.direction1,this.direction2);return u.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.sF(),h.direction2=this.direction2.sF(),h}parse(h){super.parse(h),this.direction1.D(h.direction1),this.direction2.D(h.direction2)}}class Q{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=h,this.height=R,this.radiusRange=l,this.directionRandomizer=a,this._tempVector=j.tR.Zero()}startDirectionFunction(h,R,l,a,D){l.position.subtractToRef(h.getTranslation(),this._tempVector),this._tempVector.normalize(),j.tR.TransformNormalToRef(this._tempVector,D,this._tempVector);const U=(0,mh.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let F=Math.atan2(this._tempVector.x,this._tempVector.z);F+=(0,mh.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=U,this._tempVector.x=Math.sin(F),this._tempVector.z=Math.cos(F),this._tempVector.normalize(),a?R.D(this._tempVector):j.tR.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,h,R)}startPositionFunction(h,R,l,a){const D=(0,mh.RandomRange)(-this.height/2,this.height/2),U=(0,mh.RandomRange)(0,2*Math.PI),F=(0,mh.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),w=Math.sqrt(F)*this.radius,u=w*Math.cos(U),c=w*Math.sin(U);a?R.OF(u,D,c):j.tR.TransformCoordinatesFromFloatsToRef(u,D,c,h,R)}clone(){const h=new Q(this.radius,this.directionRandomizer);return u.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("height",this.height),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("height",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.height=this.height,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.height=h.height,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class Y extends Q{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.tR(0,1,0),D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.tR(0,1,0);super(h,R,l),this.direction1=a,this.direction2=D}startDirectionFunction(h,R,l,a){const D=(0,mh.RandomRange)(this.direction1.x,this.direction2.x),U=(0,mh.RandomRange)(this.direction1.y,this.direction2.y),F=(0,mh.RandomRange)(this.direction1.z,this.direction2.z);a?R.OF(D,U,F):j.tR.TransformNormalFromFloatsToRef(D,U,F,h,R)}clone(){const h=new Y(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return u.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("height",this.height),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("height",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.sF(),h.direction2=this.direction2.sF(),h}parse(h){super.parse(h),j.tR.FromArrayToRef(h.direction1,0,this.direction1),j.tR.FromArrayToRef(h.direction2,0,this.direction2)}}class s{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=h,this.radiusRange=R,this.directionRandomizer=l}startDirectionFunction(h,R,l,a){const D=l.position.fR(h.getTranslation()).normalize(),U=(0,mh.RandomRange)(0,this.directionRandomizer),F=(0,mh.RandomRange)(0,this.directionRandomizer),w=(0,mh.RandomRange)(0,this.directionRandomizer);D.x+=U,D.y+=F,D.z+=w,D.normalize(),a?R.D(D):j.tR.TransformNormalFromFloatsToRef(D.x,D.y,D.z,h,R)}startPositionFunction(h,R,l,a){const D=this.radius-(0,mh.RandomRange)(0,this.radius*this.radiusRange),U=(0,mh.RandomRange)(0,1),F=(0,mh.RandomRange)(0,2*Math.PI),w=Math.acos(2*U-1),u=D*Math.cos(F)*Math.sin(w),c=D*Math.cos(w),J=D*Math.sin(F)*Math.sin(w);a?R.OF(u,Math.abs(c),J):j.tR.TransformCoordinatesFromFloatsToRef(u,Math.abs(c),J,h,R)}clone(){const h=new s(this.radius,this.directionRandomizer);return u.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class t{constructor(){this.direction1=new j.tR(0,1,0),this.direction2=new j.tR(0,1,0)}startDirectionFunction(h,R,l,a){const D=(0,mh.RandomRange)(this.direction1.x,this.direction2.x),U=(0,mh.RandomRange)(this.direction1.y,this.direction2.y),F=(0,mh.RandomRange)(this.direction1.z,this.direction2.z);a?R.OF(D,U,F):j.tR.TransformNormalFromFloatsToRef(D,U,F,h,R)}startPositionFunction(h,R,l,a){a?R.OF(0,0,0):j.tR.TransformCoordinatesFromFloatsToRef(0,0,0,h,R)}clone(){const h=new t;return u.e.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.direction1=this.direction1.sF(),h.direction2=this.direction2.sF(),h}parse(h){j.tR.FromArrayToRef(h.direction1,0,this.direction1),j.tR.FromArrayToRef(h.direction2,0,this.direction2)}}class f{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=h,this.radiusRange=R,this.directionRandomizer=l}startDirectionFunction(h,R,l,a){const D=l.position.fR(h.getTranslation()).normalize(),U=(0,mh.RandomRange)(0,this.directionRandomizer),F=(0,mh.RandomRange)(0,this.directionRandomizer),w=(0,mh.RandomRange)(0,this.directionRandomizer);D.x+=U,D.y+=F,D.z+=w,D.normalize(),a?R.D(D):j.tR.TransformNormalFromFloatsToRef(D.x,D.y,D.z,h,R)}startPositionFunction(h,R,l,a){const D=this.radius-(0,mh.RandomRange)(0,this.radius*this.radiusRange),U=(0,mh.RandomRange)(0,1),F=(0,mh.RandomRange)(0,2*Math.PI),w=Math.acos(2*U-1),u=D*Math.cos(F)*Math.sin(w),c=D*Math.cos(w),J=D*Math.sin(F)*Math.sin(w);a?R.OF(u,c,J):j.tR.TransformCoordinatesFromFloatsToRef(u,c,J,h,R)}clone(){const h=new f(this.radius,this.directionRandomizer);return u.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class T extends f{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.tR(0,1,0),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.tR(0,1,0);super(h),this.direction1=R,this.direction2=l}startDirectionFunction(h,R){const l=(0,mh.RandomRange)(this.direction1.x,this.direction2.x),a=(0,mh.RandomRange)(this.direction1.y,this.direction2.y),D=(0,mh.RandomRange)(this.direction1.z,this.direction2.z);j.tR.TransformNormalFromFloatsToRef(l,a,D,h,R)}clone(){const h=new T(this.radius,this.direction1,this.direction2);return u.e.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.sF(),h.direction2=this.direction2.sF(),h}parse(h){super.parse(h),this.direction1.D(h.direction1),this.direction2.D(h.direction2)}}class E{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(h,R,l,a){const D=j.TmpVectors.tR[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,l,D);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,l,D);const h=j.TmpVectors.tR[1];D.subtractToRef(l.position,h),h.scaleToRef(1/l.lifeTime,D)}else D.set(0,0,0);a?R.D(D):j.tR.TransformNormalToRef(D,h,R)}startPositionFunction(h,R,l,a){const D=j.TmpVectors.tR[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,l,D):D.set(0,0,0),a?R.D(D):j.tR.TransformCoordinatesToRef(D,h,R)}clone(){const h=new E;return u.e.DeepCopy(this,h),h}applyToShader(h){}buildUniformLayout(h){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.particlePositionGenerator=this.particlePositionGenerator,h.particleDestinationGenerator=this.particleDestinationGenerator,h}parse(h){h.particlePositionGenerator&&(this.particlePositionGenerator=h.particlePositionGenerator),h.particleDestinationGenerator&&(this.particleDestinationGenerator=h.particleDestinationGenerator)}}var x=l(12984);class G{get mesh(){return this._mesh}set mesh(h){this._mesh!==h&&(this._mesh=h,h?(this._indices=h.GF(),this._positions=h.getVerticesData(x.g.PositionKind),this._normals=h.getVerticesData(x.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=j.tR.Zero(),this._mesh=null,this.direction1=new j.tR(0,1,0),this.direction2=new j.tR(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=h}startDirectionFunction(h,R,l,a){if(this.useMeshNormalsForDirection&&this._normals)return void j.tR.TransformNormalToRef(this._storedNormal,h,R);const D=(0,mh.RandomRange)(this.direction1.x,this.direction2.x),U=(0,mh.RandomRange)(this.direction1.y,this.direction2.y),F=(0,mh.RandomRange)(this.direction1.z,this.direction2.z);a?R.OF(D,U,F):j.tR.TransformNormalFromFloatsToRef(D,U,F,h,R)}startPositionFunction(h,R,l,a){if(!this._indices||!this._positions)return;const D=3*(Math.random()*(this._indices.length/3)|0),U=Math.random(),F=Math.random()*(1-U),w=1-U-F,mh=this._indices[D],u=this._indices[D+1],c=this._indices[D+2],J=j.TmpVectors.tR[0],q=j.TmpVectors.tR[1],Q=j.TmpVectors.tR[2],Y=j.TmpVectors.tR[3];j.tR.FromArrayToRef(this._positions,3*mh,J),j.tR.FromArrayToRef(this._positions,3*u,q),j.tR.FromArrayToRef(this._positions,3*c,Q),Y.x=U*J.x+F*q.x+w*Q.x,Y.y=U*J.y+F*q.y+w*Q.y,Y.z=U*J.z+F*q.z+w*Q.z,a?R.OF(Y.x,Y.y,Y.z):j.tR.TransformCoordinatesFromFloatsToRef(Y.x,Y.y,Y.z,h,R),this.useMeshNormalsForDirection&&this._normals&&(j.tR.FromArrayToRef(this._normals,3*mh,J),j.tR.FromArrayToRef(this._normals,3*u,q),j.tR.FromArrayToRef(this._normals,3*c,Q),this._storedNormal.x=U*J.x+F*q.x+w*Q.x,this._storedNormal.y=U*J.y+F*q.y+w*Q.y,this._storedNormal.z=U*J.z+F*q.z+w*Q.z)}clone(){const h=new G(this.mesh);return u.e.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var h;const R={};return R.type=this.getClassName(),R.direction1=this.direction1.sF(),R.direction2=this.direction2.sF(),R.meshId=null===(h=this.mesh)||void 0===h?void 0:h.id,R.useMeshNormalsForDirection=this.useMeshNormalsForDirection,R}parse(h,R){j.tR.FromArrayToRef(h.direction1,0,this.direction1),j.tR.FromArrayToRef(h.direction2,0,this.direction2),h.meshId&&R&&(this.mesh=R.getLastMeshById(h.meshId)),this.useMeshNormalsForDirection=h.useMeshNormalsForDirection}}class p{_isUbo(h){return void 0!==h.addUniform}constructor(h){this._isUbo(h)?(this.setMatrix3x3=h.updateMatrix3x3.bind(h),this.setMatrix2x2=h.updateMatrix2x2.bind(h),this.setFloat=h.updateFloat.bind(h),this.setFloat2=h.updateFloat2.bind(h),this.setFloat3=h.updateFloat3.bind(h),this.setFloat4=h.updateFloat4.bind(h),this.setFloatArray=h.updateFloatArray.bind(h),this.setArray=h.updateArray.bind(h),this.setIntArray=h.updateIntArray.bind(h),this.setMatrix=h.TF.bind(h),this.setMatrices=h.updateMatrices.bind(h),this.setVector3=h.updateVector3.bind(h),this.setVector4=h.updateVector4.bind(h),this.setColor3=h.updateColor3.bind(h),this.setColor4=h.updateColor4.bind(h),this.setDirectColor4=h.updateDirectColor4.bind(h),this.setInt=h.updateInt.bind(h),this.setInt2=h.updateInt2.bind(h),this.setInt3=h.updateInt3.bind(h),this.setInt4=h.updateInt4.bind(h)):(this.setMatrix3x3=h.setMatrix3x3.bind(h),this.setMatrix2x2=h.setMatrix2x2.bind(h),this.setFloat=h.setFloat.bind(h),this.setFloat2=h.setFloat2.bind(h),this.setFloat3=h.setFloat3.bind(h),this.setFloat4=h.setFloat4.bind(h),this.setFloatArray=h.setFloatArray.bind(h),this.setArray=h.setArray.bind(h),this.setIntArray=h.setIntArray.bind(h),this.setMatrix=h.setMatrix.bind(h),this.setMatrices=h.setMatrices.bind(h),this.setVector3=h.setVector3.bind(h),this.setVector4=h.setVector4.bind(h),this.setColor3=h.setColor3.bind(h),this.setColor4=h.setColor4.bind(h),this.setDirectColor4=h.setDirectColor4.bind(h),this.setInt=h.setInt.bind(h),this.setInt2=h.setInt2.bind(h),this.setInt3=h.setInt3.bind(h),this.setInt4=h.setInt4.bind(h))}}var O=l(12808);const y="gpuUpdateParticlesPixelShader",v="#version 300 es\nvoid main() {discard;}\n";O.d.ShadersStore[y]||(O.d.ShadersStore[y]=v);const b="gpuUpdateParticlesVertexShader",I="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";O.d.ShadersStore[b]||(O.d.ShadersStore[b]=I);(0,F.f)("BABYLON.WebGL2ParticleSystem",class{constructor(h,R){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=h,this._engine=R,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var h;return(null===(h=this._updateEffect)||void 0===h?void 0:h.isReady())??!1}createUpdateBuffer(h){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof E&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=h,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new p(this._updateEffect)}createVertexBuffers(h,R){this._updateVAO.push(this._createUpdateVAO(h)),this._renderVAO.push(this._engine.recordVertexArrayObject(R,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=R}createParticleBuffer(h){return h}bindDrawBuffers(h,R,l){l?this._engine.bindBuffers(this._renderVertexBuffers,l,R):this._engine.bindVertexArrayObject(this._renderVAO[h],null)}preUpdateParticleBuffer(){const h=this._engine;if(this._engine.enableEffect(this._updateEffect),!h.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(h,R,l){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[h],null);const j=this._engine;j.bindTransformFeedbackBuffer(R.getBuffer()),j.setRasterizerState(!1),j.beginTransformFeedback(!0),j.drawArraysType(3,0,l),j.endTransformFeedback(),j.setRasterizerState(!0),j.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let h=0;h<this._updateVAO.length;h++)this._engine.releaseVertexArrayObject(this._updateVAO[h]);this._updateVAO.length=0;for(let h=0;h<this._renderVAO.length;h++)this._engine.releaseVertexArrayObject(this._renderVAO[h]);this._renderVAO.length=0}_createUpdateVAO(h){const R={};R.position=h.createVertexBuffer("position",0,3);let l=3;R.age=h.createVertexBuffer("age",l,1),l+=1,R.size=h.createVertexBuffer("size",l,3),l+=3,R.life=h.createVertexBuffer("life",l,1),l+=1,R.seed=h.createVertexBuffer("seed",l,4),l+=4,R.direction=h.createVertexBuffer("direction",l,3),l+=3,this._parent.particleEmitterType instanceof E&&(R.initialPosition=h.createVertexBuffer("initialPosition",l,3),l+=3),this._parent._colorGradientsTexture||(R.color=h.createVertexBuffer("color",l,4),l+=4),this._parent._isBillboardBased||(R.initialDirection=h.createVertexBuffer("initialDirection",l,3),l+=3),this._parent.noiseTexture&&(R.noiseCoordinates1=h.createVertexBuffer("noiseCoordinates1",l,3),l+=3,R.noiseCoordinates2=h.createVertexBuffer("noiseCoordinates2",l,3),l+=3),this._parent._angularSpeedGradientsTexture?(R.angle=h.createVertexBuffer("angle",l,1),l+=1):(R.angle=h.createVertexBuffer("angle",l,2),l+=2),this._parent._isAnimationSheetEnabled&&(R.cellIndex=h.createVertexBuffer("cellIndex",l,1),l+=1,this._parent.spriteRandomStartCell&&(R.cellStartOffset=h.createVertexBuffer("cellStartOffset",l,1),l+=1));const j=this._engine.recordVertexArrayObject(R,null,this._updateEffect);return this._engine.bindArrayBuffer(null),j}});class L{constructor(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,j=arguments.length>3?arguments[3]:void 0;this._engine=h,this._label=j,this._engine._storageBuffers.push(this),this._create(R,l)}_create(h,R){this._bufferSize=h,this._creationFlags=R,this._buffer=this._engine.createStorageBuffer(h,R,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(h,R,l){this._buffer&&this._engine.updateStorageBuffer(this._buffer,h,R,l)}async read(h,R,l,j){return await this._engine.readFromStorageBuffer(this._buffer,h,R,l,j)}dispose(){const h=this._engine._storageBuffers,R=h.indexOf(this);-1!==R&&(h[R]=h[h.length-1],h.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var n=l(12882),r=l(12887),P=l(12942),z=l(12874),o=l(13170),K=l(12711),W=l(12837),g=l(13108);class H{constructor(){this._gpuTimeInFrameId=-1,this.counter=new g.d}_addDuration(h,R){h<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==h?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(R,!1),this._gpuTimeInFrameId=h):this.counter.addCount(R,!1))}}var k=l(12790);class C{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=h,this._engine=R,this.uniqueId=o.b.UniqueId,R.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new H),this._engine.getCaps().supportComputeShaders?j.bindingsMapping?(this._context=R.createComputeContext(),this._shaderPath=l,this._options={bindingsMapping:{},defines:[],...j}):K.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):K.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(h,R){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const j=this._bindings[h];this._bindings[h]={type:l?0:4,object:R,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!j||j.object!==R||j.type!==this._bindings[h].type)}setStorageTexture(h,R){const l=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==R),this._bindings[h]={type:1,object:R,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setExternalTexture(h,R){const l=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==R),this._bindings[h]={type:6,object:R,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setVideoTexture(h,R){return!!R.externalTexture&&(this.setExternalTexture(h,R.externalTexture),!0)}setUniformBuffer(h,R){const l=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==R),this._bindings[h]={type:C._BufferIsDataBuffer(R)?7:2,object:R,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setStorageBuffer(h,R){const l=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==R),this._bindings[h]={type:C._BufferIsDataBuffer(R)?7:3,object:R,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setTextureSampler(h,R){const l=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!l||!R.compareSampler(l.object)),this._bindings[h]={type:5,object:R,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}isReady(){let h=this._effect;for(const a in this._bindings){const h=this._bindings[a],R=h.type,l=h.object;switch(R){case 0:case 4:case 1:if(!l.isReady())return!1;break;case 6:if(!l.isReady())return!1;break}}const R=[],l=this._shaderPath;if(this._options.defines)for(let a=0;a<this._options.defines.length;a++)R.push(this._options.defines[a]);const j=R.join("\n");return this._cachedDefines!==j&&(this._cachedDefines=j,h=this._engine.createComputeEffect(l,{defines:j,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=h),!!h.isReady()}dispatch(h,R,l){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,h,R,l,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const l=C._BufferIsDataBuffer(h)?h:h.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,l,R,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const R in this._bindings){const l=this._bindings[R];if(!this._options.bindingsMapping[R])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+R+"'");switch(l.type){case 0:{const j=this._samplers[R],a=l.object;var h;if(!j||!a._texture||!j.compareSampler(a._texture))this._samplers[R]=(new W.d).setParameters(a.wrapU,a.wrapV,a.wrapR,a.anisotropicFilteringLevel,a._texture.samplingMode,null===(h=a._texture)||void 0===h?void 0:h._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const h=l.object;h.getBuffer()!==l.buffer&&(l.buffer=h.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((a=>{(0,k.c)((()=>this.dispatch(h,R,l)),a,void 0,j)}))}serialize(){const h=P.c.Serialize(this);h.options=this._options,h.shaderPath=this._shaderPath,h.BJ={},h.textures={};for(const R in this._bindings){const l=this._bindings[R],j=l.object;switch(l.type){case 0:case 4:case 1:{const a=j.serialize();a&&(h.textures[R]=a,h.BJ[R]={type:l.type});break}}}return h}static Parse(h,R,l){const j=P.c.Parse((()=>new C(h.name,R.getEngine(),h.shaderPath,h.options)),h,R,l);for(const a in h.textures){const D=h.BJ[a],U=z.b.Parse(h.textures[a],R,l);0===D.type?j.setTexture(a,U):4===D.type?j.setTexture(a,U,!1):j.setStorageTexture(a,U)}return j}static _BufferIsDataBuffer(h){return void 0!==h.underlyingResource}}(0,n.e)([(0,r.G)()],C.prototype,"name",void 0),(0,n.e)([(0,r.G)()],C.prototype,"fastMode",void 0),(0,F.f)("BABYLON.ComputeShader",C);var A=l(13145);const e="gpuUpdateParticlesComputeShader",S="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";O.d.ShadersStoreWGSL[e]||(O.d.ShadersStoreWGSL[e]=S);(0,F.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(h,R){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=h,this._engine=R}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var h;return(null===(h=this._updateComputeShader)||void 0===h?void 0:h.isReady())??!1}createUpdateBuffer(h){var R;const l={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(l.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(l.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(l.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(l.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(l.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(l.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(l.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new C("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:l,defines:h.split("\n")}),null===(R=this._simParamsComputeShader)||void 0===R||R.dispose(),this._simParamsComputeShader=new A.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new p(this._simParamsComputeShader)}createVertexBuffers(h,R){this._renderVertexBuffers.push(R)}createParticleBuffer(h){const R=new L(this._engine,4*h.length,11,"ComputeShaderParticleSystemBuffer");return R.update(h),this._bufferComputeShader.push(R),R.getBuffer()}bindDrawBuffers(h,R,l){this._engine.bindBuffers(this._renderVertexBuffers[h],l,R)}preUpdateParticleBuffer(){}updateParticleBuffer(h,R,l){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[h]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^h]),this._updateComputeShader.dispatch(Math.ceil(l/64))}releaseBuffers(){var h;for(let R=0;R<this._bufferComputeShader.length;++R)this._bufferComputeShader[R].dispose();this._bufferComputeShader.length=0,null===(h=this._simParamsComputeShader)||void 0===h||h.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class Z{constructor(h,R,l){this.gradient=h,this.color1=R,this.color2=l}getColorToRef(h){this.color2?U.bF.LerpToRef(this.color1,this.color2,Math.random(),h):h.D(this.color1)}}class M{constructor(h,R){this.gradient=h,this.color=R}}class i{constructor(h,R,l){this.gradient=h,this.factor1=R,this.factor2=l}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class d{static GetCurrentGradient(h,R,l){if(R[0].gradient>h)return void l(R[0],R[0],1);for(let a=0;a<R.length-1;a++){const j=R[a],D=R[a+1];if(h>=j.gradient&&h<=D.gradient){return void l(j,D,(h-j.gradient)/(D.gradient-j.gradient))}}const j=R.length-1;l(R[j],R[j],1)}}var X=l(12696),V=l(13341),B=l(12749);class N{constructor(h){this.particleSystem=h,this.position=j.tR.Zero(),this.direction=j.tR.Zero(),this.color=new U.bF(0,0,0,0),this.colorStep=new U.bF(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new j.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new U.bF(0,0,0,0),this._currentColor2=new U.bF(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=N._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let h=this.age,R=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===R?(R=1,h=this._randomCellOffset):h+=this._randomCellOffset);const l=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let j;j=this._initialSpriteCellLoop?(0,mh.Clamp)(h*R%this.lifeTime/this.lifeTime):(0,mh.Clamp)(h*R/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+j*l|0}_inheritParticleInfoToSubEmitter(h){if(h.particleSystem.UR.position){const R=h.particleSystem.UR;if(R.position.D(this.position),h.inheritDirection){const h=j.TmpVectors.tR[0];this.direction.normalizeToRef(h),R.setDirection(h,0,Math.PI/2)}}else{h.particleSystem.UR.D(this.position)}this.direction.scaleToRef(h.inheritedVelocityAmount/2,j.TmpVectors.tR[0]),h.particleSystem._inheritedVelocityOffset.D(j.TmpVectors.tR[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const h of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(h)}_reset(){this.age=0,this.id=N._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(h){h.position.D(this.position),this._initialDirection?h._initialDirection?h._initialDirection.D(this._initialDirection):h._initialDirection=this._initialDirection.clone():h._initialDirection=null,h.direction.D(this.direction),this.VF&&(h.VF?h.VF.D(this.VF):h.VF=this.VF.clone()),h.color.D(this.color),h.colorStep.D(this.colorStep),h.lifeTime=this.lifeTime,h.age=this.age,h._randomCellOffset=this._randomCellOffset,h.size=this.size,h.scale.D(this.scale),h.angle=this.angle,h.angularSpeed=this.angularSpeed,h.particleSystem=this.particleSystem,h.cellIndex=this.cellIndex,h.id=this.id,h._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(h._currentColorGradient=this._currentColorGradient,h._currentColor1.D(this._currentColor1),h._currentColor2.D(this._currentColor2)),this._currentSizeGradient&&(h._currentSizeGradient=this._currentSizeGradient,h._currentSize1=this._currentSize1,h._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(h._currentAngularSpeedGradient=this._currentAngularSpeedGradient,h._currentAngularSpeed1=this._currentAngularSpeed1,h._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(h._currentVelocityGradient=this._currentVelocityGradient,h._currentVelocity1=this._currentVelocity1,h._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(h._currentLimitVelocityGradient=this._currentLimitVelocityGradient,h._currentLimitVelocity1=this._currentLimitVelocity1,h._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(h._currentDragGradient=this._currentDragGradient,h._currentDrag1=this._currentDrag1,h._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(h._initialStartSpriteCellId=this._initialStartSpriteCellId,h._initialEndSpriteCellId=this._initialEndSpriteCellId,h._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(h.remapData&&this.remapData?h.remapData.D(this.remapData):h.remapData=new j.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(h._randomNoiseCoordinates1?(h._randomNoiseCoordinates1.D(this._randomNoiseCoordinates1),h._randomNoiseCoordinates2.D(this._randomNoiseCoordinates2)):(h._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),h._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}N._Count=0;var hh=l(13016),Rh=(l(13044),l(13226)),lh=l(13219),jh=l(13138);function ah(h,R){const l=(0,mh.RandomRange)(0,1);U.bF.LerpToRef(R.color1,R.color2,l,h.color),R.colorDead.subtractToRef(h.color,R._colorDiff),R._colorDiff.scaleToRef(1/h.lifeTime,h.colorStep)}function Dh(h,R){h._currentColorGradient=R._colorGradients[0],h._currentColorGradient.getColorToRef(h.color),h._currentColor1.D(h.color),R._colorGradients.length>1?R._colorGradients[1].getColorToRef(h._currentColor2):h._currentColor2.D(h.color)}function Uh(h,R){const l=R._colorGradients;d.GetCurrentGradient(R._ratio,l,((R,l,j)=>{R!==h._currentColorGradient&&(h._currentColor1.D(h._currentColor2),l.getColorToRef(h._currentColor2),h._currentColorGradient=R),U.bF.LerpToRef(h._currentColor1,h._currentColor2,j,h.color)}))}function Fh(h,R){h.colorStep.scaleToRef(R._scaledUpdateSpeed,R._scaledColorStep),h.color.addInPlace(R._scaledColorStep),h.color.a<0&&(h.color.a=0)}function wh(h,R){d.GetCurrentGradient(R._ratio,R._angularSpeedGradients,((R,l,j)=>{R!==h._currentAngularSpeedGradient&&(h._currentAngularSpeed1=h._currentAngularSpeed2,h._currentAngularSpeed2=l.getFactor(),h._currentAngularSpeedGradient=R),h.angularSpeed=(0,mh.Lerp)(h._currentAngularSpeed1,h._currentAngularSpeed2,j)}))}function mR(h,R){h.angle+=h.angularSpeed*R._scaledUpdateSpeed}function uh(h,R){R.particleEmitterType.startDirectionFunction(R._emitterWorldMatrix,h.direction,h,R.isLocal,R._emitterInverseWorldMatrix)}function ch(h,R){R.startDirectionFunction(R._emitterWorldMatrix,h.direction,h,R.isLocal)}function Jh(h,R){h._currentVelocityGradient=R._velocityGradients[0],h._currentVelocity1=h._currentVelocityGradient.getFactor(),R._velocityGradients.length>1?h._currentVelocity2=R._velocityGradients[1].getFactor():h._currentVelocity2=h._currentVelocity1}function qh(h,R){h._currentLimitVelocityGradient=R._limitVelocityGradients[0],h._currentLimitVelocity1=h._currentLimitVelocityGradient.getFactor(),R._limitVelocityGradients.length>1?h._currentLimitVelocity2=R._limitVelocityGradients[1].getFactor():h._currentLimitVelocity2=h._currentLimitVelocity1}function Qh(h,R){d.GetCurrentGradient(R._ratio,R._velocityGradients,((l,j,a)=>{l!==h._currentVelocityGradient&&(h._currentVelocity1=h._currentVelocity2,h._currentVelocity2=j.getFactor(),h._currentVelocityGradient=l),R._directionScale*=(0,mh.Lerp)(h._currentVelocity1,h._currentVelocity2,a)}))}function Yh(h,R){d.GetCurrentGradient(R._ratio,R._limitVelocityGradients,((l,j,a)=>{l!==h._currentLimitVelocityGradient&&(h._currentLimitVelocity1=h._currentLimitVelocity2,h._currentLimitVelocity2=j.getFactor(),h._currentLimitVelocityGradient=l);const D=(0,mh.Lerp)(h._currentLimitVelocity1,h._currentLimitVelocity2,a);h.direction.length()>D&&h.direction.scaleInPlace(R.limitVelocityDamping)}))}function sh(h,R){h.direction.scaleToRef(R._directionScale,R._scaledDirection)}function th(h,R){R.particleEmitterType.startPositionFunction(R._emitterWorldMatrix,h.position,h,R.isLocal)}function fh(h,R){R.startPositionFunction(R._emitterWorldMatrix,h.position,h,R.isLocal)}function Th(h,R){h.VF?h.VF.D(h.position):h.VF=h.position.clone(),j.tR.TransformCoordinatesToRef(h.VF,R._emitterWorldMatrix,h.position)}function Eh(h,R){R.isLocal&&h.VF?(h.VF.addInPlace(R._scaledDirection),j.tR.TransformCoordinatesToRef(h.VF,R._emitterWorldMatrix,h.position)):h.position.addInPlace(R._scaledDirection)}function xh(h,R){h._currentDragGradient=R._dragGradients[0],h._currentDrag1=h._currentDragGradient.getFactor(),R._dragGradients.length>1?h._currentDrag2=R._dragGradients[1].getFactor():h._currentDrag2=h._currentDrag1}function Gh(h,R){d.GetCurrentGradient(R._ratio,R._dragGradients,((l,j,a)=>{l!==h._currentDragGradient&&(h._currentDrag1=h._currentDrag2,h._currentDrag2=j.getFactor(),h._currentDragGradient=l);const D=(0,mh.Lerp)(h._currentDrag1,h._currentDrag2,a);R._scaledDirection.scaleInPlace(1-D)}))}function ph(h,R){h._randomNoiseCoordinates1?(h._randomNoiseCoordinates1.OF(Math.random(),Math.random(),Math.random()),h._randomNoiseCoordinates2.OF(Math.random(),Math.random(),Math.random())):(h._randomNoiseCoordinates1=new j.tR(Math.random(),Math.random(),Math.random()),h._randomNoiseCoordinates2=new j.tR(Math.random(),Math.random(),Math.random()))}function Oh(h,R){const l=R._noiseTextureData,a=R._noiseTextureSize;if(l&&a&&h._randomNoiseCoordinates1){const D=R._fetchR(h._randomNoiseCoordinates1.x,h._randomNoiseCoordinates1.y,a.width,a.height,l),U=R._fetchR(h._randomNoiseCoordinates1.z,h._randomNoiseCoordinates2.x,a.width,a.height,l),F=R._fetchR(h._randomNoiseCoordinates2.y,h._randomNoiseCoordinates2.z,a.width,a.height,l),w=j.TmpVectors.tR[0],mh=j.TmpVectors.tR[1];w.OF((2*D-1)*R.noiseStrength.x,(2*U-1)*R.noiseStrength.y,(2*F-1)*R.noiseStrength.z),w.scaleToRef(R._tempScaledUpdateSpeed,mh),h.direction.addInPlace(mh)}}function yh(h,R){R.gravity.scaleToRef(R._tempScaledUpdateSpeed,R._scaledGravity),h.direction.addInPlace(R._scaledGravity)}function vh(h,R){h.size=(0,mh.RandomRange)(R.minSize,R.maxSize),h.scale.OF((0,mh.RandomRange)(R.minScaleX,R.maxScaleX),(0,mh.RandomRange)(R.minScaleY,R.maxScaleY))}function bh(h,R){h._currentSizeGradient=R._sizeGradients[0],h._currentSize1=h._currentSizeGradient.getFactor(),h.size=h._currentSize1,R._sizeGradients.length>1?h._currentSize2=R._sizeGradients[1].getFactor():h._currentSize2=h._currentSize1,h.scale.OF((0,mh.RandomRange)(R.minScaleX,R.maxScaleX),(0,mh.RandomRange)(R.minScaleY,R.maxScaleY))}function Ih(h,R){const l=R._actualFrame/R.targetStopDuration;d.GetCurrentGradient(l,R._startSizeGradients,((l,j,a)=>{l!==R._currentStartSizeGradient&&(R._currentStartSize1=R._currentStartSize2,R._currentStartSize2=j.getFactor(),R._currentStartSizeGradient=l);const D=(0,mh.Lerp)(R._currentStartSize1,R._currentStartSize2,a);h.scale.scaleInPlace(D)}))}function Lh(h,R){d.GetCurrentGradient(R._ratio,R._sizeGradients,((R,l,j)=>{R!==h._currentSizeGradient&&(h._currentSize1=h._currentSize2,h._currentSize2=l.getFactor(),h._currentSizeGradient=R),h.size=(0,mh.Lerp)(h._currentSize1,h._currentSize2,j)}))}function nh(h,R){h.remapData=new j.Vector4(0,1,0,1)}function rh(h,R){R._colorRemapGradients&&R._colorRemapGradients.length>0&&d.GetCurrentGradient(R._ratio,R._colorRemapGradients,((R,l,j)=>{const a=(0,mh.Lerp)(R.factor1,l.factor1,j),D=(0,mh.Lerp)(R.factor2,l.factor2,j);h.remapData.x=a,h.remapData.y=D-a})),R._alphaRemapGradients&&R._alphaRemapGradients.length>0&&d.GetCurrentGradient(R._ratio,R._alphaRemapGradients,((R,l,j)=>{const a=(0,mh.Lerp)(R.factor1,l.factor1,j),D=(0,mh.Lerp)(R.factor2,l.factor2,j);h.remapData.z=a,h.remapData.w=D-a}))}function Ph(h,R){const l=(0,mh.Clamp)(R._actualFrame/R.targetStopDuration);d.GetCurrentGradient(l,R._lifeTimeGradients,((R,j)=>{const a=R,D=j,U=a.getFactor(),F=D.getFactor(),w=(l-a.gradient)/(D.gradient-a.gradient);h.lifeTime=(0,mh.Lerp)(U,F,w)})),R._emitPower=(0,mh.RandomRange)(R.minEmitPower,R.maxEmitPower)}function zh(h,R){h.lifeTime=(0,mh.RandomRange)(R.minLifeTime,R.maxLifeTime),R._emitPower=(0,mh.RandomRange)(R.minEmitPower,R.maxEmitPower)}function oh(h,R){0===R._emitPower?(h._initialDirection?h._initialDirection.D(h.direction):h._initialDirection=h.direction.clone(),h.direction.set(0,0,0)):(h._initialDirection=null,h.direction.scaleInPlace(R._emitPower)),h.direction.addInPlace(R._inheritedVelocityOffset)}function Kh(h,R){h.angularSpeed=(0,mh.RandomRange)(R.minAngularSpeed,R.maxAngularSpeed),h.angle=(0,mh.RandomRange)(R.minInitialRotation,R.maxInitialRotation)}function Wh(h,R){h._currentAngularSpeedGradient=R._angularSpeedGradients[0],h.angularSpeed=h._currentAngularSpeedGradient.getFactor(),h._currentAngularSpeed1=h.angularSpeed,R._angularSpeedGradients.length>1?h._currentAngularSpeed2=R._angularSpeedGradients[1].getFactor():h._currentAngularSpeed2=h._currentAngularSpeed1,h.angle=(0,mh.RandomRange)(R.minInitialRotation,R.maxInitialRotation)}function gh(h,R){h._initialStartSpriteCellId=R.startSpriteCellID,h._initialEndSpriteCellId=R.endSpriteCellID,h._initialSpriteCellLoop=R.spriteCellLoop}function Hh(h,R){h.previousItem=R.previousItem,h.nextItem=R,R.previousItem&&(R.previousItem.nextItem=h),R.previousItem=h}function kh(h,R){h.previousItem=R,h.nextItem=R.nextItem,R.nextItem&&(R.nextItem.previousItem=h),R.nextItem=h}function Ch(h,R){let l=R;for(;l.nextItem;)l=l.nextItem;h.previousItem=l,h.nextItem=l.nextItem,l.nextItem=h}function Ah(h){h.previousItem&&(h.previousItem.nextItem=h.nextItem),h.nextItem&&(h.nextItem.previousItem=h.previousItem)}class eh extends w{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(h){this._startDirectionFunction!==h&&(this._startDirectionFunction=h,this._directionProcessing.process=h?ch:uh)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(h){this._startPositionFunction!==h&&(this._startPositionFunction=h,this._positionCreation.process=h?fh:th)}set onDispose(h){this._onDisposeObserver&&this.mw.remove(this._onDisposeObserver),this._onDisposeObserver=this.mw.add(h)}get mh(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(h){this._useRampGradients!==h&&(this._useRampGradients=h,this._resetEffect(),h?(this._rampCreation={process:nh,previousItem:null,nextItem:null},kh(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:rh,previousItem:null,nextItem:null},kh(this._remapGradientProcessing,this._gravityProcessing)):(Ah(this._rampCreation),Ah(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(h){this._isLocal!==h&&(this._isLocal=h,h?(this._isLocalCreation={process:Th,previousItem:null,nextItem:null},kh(this._isLocalCreation,this._positionCreation)):Ah(this._isLocalCreation))}get particles(){return this.MJ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(h){this._animationSheetEnabled!==h&&(this._animationSheetEnabled=h,h?(this._sheetCreation={process:gh,previousItem:null,nextItem:null},kh(this._sheetCreation,this._colorCreation)):Ah(this._sheetCreation),this._reset())}getActiveCount(){return this.MJ.length}getClassName(){return"mc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var h;let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(h=this._customWrappers[R])||void 0===h?void 0:h.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[h]??this._customWrappers[0]}setCustomEffect(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[R]=new hh.c(this._engine),this._customWrappers[R].effect=h,this._customWrappers[R].drawContext&&(this._customWrappers[R].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new X.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(h){if(this.noiseTexture!==h){if(this._noiseTexture=h,!h)return Ah(this._noiseCreation),void Ah(this._noiseProcessing);this._noiseCreation={process:ph,previousItem:null,nextItem:null},kh(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Oh,previousItem:null,nextItem:null},kh(this._noiseProcessing,this._positionProcessing)}}constructor(h,R,l){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(h),this._emitterInverseWorldMatrix=j.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new j.tR,this.mw=new X.d,this.onStoppedObservable=new X.d,this.onStartedObservable=new X.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.MJ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new U.bF(0,0,0,0),this._colorDiff=new U.bF(0,0,0,0),this._scaledDirection=j.tR.Zero(),this._scaledGravity=j.tR.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=h=>{},this.recycleParticle=h=>{const R=this.MJ.pop();R!==h&&R.copyTo(h),this._stockParticles.push(R)},this._createParticle=()=>{let h;return 0!==this._stockParticles.length?(h=this._stockParticles.pop(),h._reset()):h=new N(this),this._prepareParticle(h),h},this.paused=!1,this._shadersLoaded=!1,this._capacity=R,this._epsilon=F,l&&"Scene"!==l.getClassName()?(this._engine=l,this.defaultProjectionMatrix=j.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=l||B.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SJ.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:zh,previousItem:null,nextItem:null},this._positionCreation={process:th,previousItem:null,nextItem:null},kh(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:uh,previousItem:null,nextItem:null},kh(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:oh,previousItem:null,nextItem:null},kh(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:vh,previousItem:null,nextItem:null},kh(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Kh,previousItem:null,nextItem:null},kh(this._angleCreation,this._sizeCreation),this._colorCreation={process:ah,previousItem:null,nextItem:null},kh(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,w||(this._colorProcessing={process:Fh,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:mR,previousItem:null,nextItem:null},kh(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:sh,previousItem:null,nextItem:null},kh(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Eh,previousItem:null,nextItem:null},kh(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:yh,previousItem:null,nextItem:null},kh(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=D,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new hh.c(this._engine)},this._customWrappers[0].effect=a,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new c,this.updateFunction=h=>{var R;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(R=this.noiseTexture.getContent())||void 0===R||R.then((h=>{this._noiseTextureData=h})));const l=h===this.MJ;for(let j=0;j<h.length;j++){const R=h[j];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const a=R.age;if(R.age+=this._tempScaledUpdateSpeed,R.age>R.lifeTime){const h=R.age-a,l=R.lifeTime-a;this._tempScaledUpdateSpeed=l*this._tempScaledUpdateSpeed/h,R.age=R.lifeTime}this._ratio=R.age/R.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let D=this._updateQueueStart;for(;D;)D.process(R,this),D=D.nextItem;if(this._isAnimationSheetEnabled&&!w&&R.updateCellIndex(),R._inheritParticleInfoToSubEmitters(),R.age>=R.lifeTime){if(this._emitFromParticle(R),R._attachedSubEmitters){for(const h of R._attachedSubEmitters)h.particleSystem.disposeOnStop=!0,h.particleSystem.stop();R._attachedSubEmitters=null}this.recycleParticle(R),l&&j--}else;}}}serialize(h){throw new Error("Method not implemented.")}clone(h,R){throw new Error("Method not implemented.")}_addFactorGradient(h,R,l,j){const a=new i(R,l,j);h.push(a),h.sort(((h,R)=>h.gradient<R.gradient?-1:h.gradient>R.gradient?1:0))}_removeFactorGradient(h,R){if(!h)return;let l=0;for(const j of h){if(j.gradient===R){h.splice(l,1);break}l++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Ph:this._lifeTimeCreation.process=zh}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Ih,previousItem:null,nextItem:null},kh(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Ah(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(h){this.targetStopDuration!==h&&(this._targetStopDuration=h,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(h,R,l){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,h,R,l),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(h){return this._removeFactorGradient(this._lifeTimeGradients,h),this._syncLifeTimeCreation(),this}addSizeGradient(h,R,l){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=bh,this._sizeGradientProcessing={process:Lh,previousItem:null,nextItem:null},Hh(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,h,R,l),this}removeSizeGradient(h){var R;return this._removeFactorGradient(this._sizeGradients,h),0===(null===(R=this._sizeGradients)||void 0===R?void 0:R.length)&&(Ah(this._sizeGradientProcessing),this._sizeCreation.process=vh),this}addColorRemapGradient(h,R,l){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,h,R,l),this}removeColorRemapGradient(h){return this._removeFactorGradient(this._colorRemapGradients,h),this}addAlphaRemapGradient(h,R,l){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,h,R,l),this}removeAlphaRemapGradient(h){return this._removeFactorGradient(this._alphaRemapGradients,h),this}addAngularSpeedGradient(h,R,l){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Wh,this._angularSpeedGradientProcessing={process:wh,previousItem:null,nextItem:null},Hh(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,h,R,l),this}removeAngularSpeedGradient(h){var R;return this._removeFactorGradient(this._angularSpeedGradients,h),0===(null===(R=this._angularSpeedGradients)||void 0===R?void 0:R.length)&&(this._angleCreation.process=Kh,Ah(this._angularSpeedGradientProcessing)),this}addVelocityGradient(h,R,l){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Jh,previousItem:null,nextItem:null},kh(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Qh,previousItem:null,nextItem:null},Hh(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,h,R,l),this}removeVelocityGradient(h){var R;return this._removeFactorGradient(this._velocityGradients,h),0===(null===(R=this._velocityGradients)||void 0===R?void 0:R.length)&&(Ah(this._velocityCreation),Ah(this._velocityGradientProcessing)),this}addLimitVelocityGradient(h,R,l){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:qh,previousItem:null,nextItem:null},kh(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Yh,previousItem:null,nextItem:null},kh(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,h,R,l),this}removeLimitVelocityGradient(h){var R;return this._removeFactorGradient(this._limitVelocityGradients,h),0===(null===(R=this._limitVelocityGradients)||void 0===R?void 0:R.length)&&(Ah(this._limitVelocityCreation),Ah(this._limitVelocityGradientProcessing)),this}addDragGradient(h,R,l){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:xh,previousItem:null,nextItem:null},Hh(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Gh,previousItem:null,nextItem:null},Hh(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,h,R,l),this}removeDragGradient(h){var R;return this._removeFactorGradient(this._dragGradients,h),0===(null===(R=this._dragGradients)||void 0===R?void 0:R.length)&&(Ah(this._dragCreation),Ah(this._dragGradientProcessing)),this}addEmitRateGradient(h,R,l){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,h,R,l),this}removeEmitRateGradient(h){return this._removeFactorGradient(this._emitRateGradients,h),this}addStartSizeGradient(h,R,l){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,h,R,l),this._syncStartSizeCreation(),this}removeStartSizeGradient(h){return this._removeFactorGradient(this._startSizeGradients,h),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const h=new Uint8Array(4*this._rawTextureWidth),R=U.TmpColors.xR[0];for(let l=0;l<this._rawTextureWidth;l++){const j=l/this._rawTextureWidth;d.GetCurrentGradient(j,this._rampGradients,((j,a,D)=>{U.xR.LerpToRef(j.color,a.color,D,R),h[4*l]=255*R.r,h[4*l+1]=255*R.g,h[4*l+2]=255*R.b,h[4*l+3]=255}))}this._rampGradientsTexture=V.e.CreateRGBATexture(h,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((h,R)=>h.gradient<R.gradient?-1:h.gradient>R.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(h,R){this._rampGradients||(this._rampGradients=[]);const l=new M(h,R);return this._rampGradients.push(l),this._syncRampGradientTexture(),this}removeRampGradient(h){return this._removeGradientAndTexture(h,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(h,R,l){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Dh,this._colorProcessing.process=Uh);const j=new Z(h,R,l);return this._colorGradients.push(j),this._colorGradients.sort(((h,R)=>h.gradient<R.gradient?-1:h.gradient>R.gradient?1:0)),this}removeColorGradient(h){if(!this._colorGradients)return this;let R=0;for(const l of this._colorGradients){if(l.gradient===h){this._colorGradients.splice(R,1);break}R++}return 0===this._colorGradients.length&&(this._colorCreation.process=ah,this._colorProcessing.process=Fh),this}resetDrawCache(){if(this._drawWrappers){for(const h of this._drawWrappers)if(h)for(const R of h)null===R||void 0===R||R.dispose();this._drawWrappers=[]}}_fetchR(h,R,l,j,a){return a[4*(((h=.5*Math.abs(h)+.5)*l%l|0)+((R=.5*Math.abs(R)+.5)*j%j|0)*l)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const h=this._engine,R=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*R),this._vertexBuffer=new x.e(h,this._vertexData,!0,R);let l=0;const j=this._vertexBuffer.createVertexBuffer(x.g.PositionKind,l,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[x.g.PositionKind]=j,l+=3;const a=this._vertexBuffer.createVertexBuffer(x.g.ColorKind,l,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[x.g.ColorKind]=a,l+=4;const D=this._vertexBuffer.createVertexBuffer("angle",l,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=D,l+=1;const U=this._vertexBuffer.createVertexBuffer("size",l,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=U,l+=2,this._isAnimationSheetEnabled){const h=this._vertexBuffer.createVertexBuffer("cellIndex",l,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=h,l+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const h=this._vertexBuffer.createVertexBuffer("direction",l,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=h,l+=3}if(this._useRampGradients){const h=this._vertexBuffer.createVertexBuffer("remapData",l,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=h,l+=4}let F;if(this._useInstancing){const R=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new x.e(h,R,!1,2),F=this._spriteBuffer.createVertexBuffer("offset",0,2)}else F=this._vertexBuffer.createVertexBuffer("offset",l,2,this._vertexBufferSize,this._useInstancing),l+=2;this._vertexBuffers.offset=F,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const h=[],R=[];let l=0;for(let j=0;j<this._capacity;j++)h.push(l),h.push(l+1),h.push(l+2),h.push(l),h.push(l+2),h.push(l+3),R.push(l,l+1,l+1,l+2,l+2,l+3,l+3,l,l,l+3),l+=4;this._indexBuffer=this._engine.createIndexBuffer(h),this._linesIndexBuffer=this._engine.createIndexBuffer(R)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(h)setTimeout((()=>{this.start(0)}),h);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var R;-1!==(null===(R=this.UR)||void 0===R?void 0:R.getClassName().indexOf("Mesh"))&&this.UR.EF(!0);const h=this.noiseTexture;if(h&&h.onGeneratedObservable)h.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let R=0;R<this.preWarmCycles;R++)this.animate(!0),h.render()}))}));else for(let R=0;R<this.preWarmCycles;R++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(h))}_postStop(h){}reset(){this._stockParticles.length=0,this.MJ.length=0}_appendParticleVertex(h,R,l,a){let D=h*this._vertexBufferSize;if(this._vertexData[D++]=R.position.x+this.xm.x,this._vertexData[D++]=R.position.y+this.xm.y,this._vertexData[D++]=R.position.z+this.xm.z,this._vertexData[D++]=R.color.r,this._vertexData[D++]=R.color.g,this._vertexData[D++]=R.color.b,this._vertexData[D++]=R.color.a,this._vertexData[D++]=R.angle,this._vertexData[D++]=R.scale.x*R.size,this._vertexData[D++]=R.scale.y*R.size,this._isAnimationSheetEnabled&&(this._vertexData[D++]=R.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[D++]=R.direction.x,this._vertexData[D++]=R.direction.y,this._vertexData[D++]=R.direction.z);else if(R._initialDirection){let h=R._initialDirection;this.isLocal&&(j.tR.TransformNormalToRef(h,this._emitterWorldMatrix,j.TmpVectors.tR[0]),h=j.TmpVectors.tR[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[D++]=h.x,this._vertexData[D++]=h.y,this._vertexData[D++]=h.z}else{let h=R.direction;this.isLocal&&(j.tR.TransformNormalToRef(h,this._emitterWorldMatrix,j.TmpVectors.tR[0]),h=j.TmpVectors.tR[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[D++]=h.x,this._vertexData[D++]=h.y,this._vertexData[D++]=h.z}this._useRampGradients&&R.remapData&&(this._vertexData[D++]=R.remapData.x,this._vertexData[D++]=R.remapData.y,this._vertexData[D++]=R.remapData.z,this._vertexData[D++]=R.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===l?l=this._epsilon:1===l&&(l=1-this._epsilon),0===a?a=this._epsilon:1===a&&(a=1-this._epsilon)),this._vertexData[D++]=l,this._vertexData[D++]=a)}_prepareParticle(h){}_createNewOnes(h){let R;for(let l=0;l<h&&this.MJ.length!==this._capacity;l++){R=this._createParticle(),this.MJ.push(R);let h=this._createQueueStart;for(;h;)h.process(R,this),h=h.nextItem;R._inheritParticleInfoToSubEmitters()}}_update(h){if(this._alive=this.MJ.length>0,this.UR.position){const h=this.UR;this._emitterWorldMatrix=h.getWorldMatrix()}else{const h=this.UR;this._emitterWorldMatrix=j.Matrix.Translation(h.x,h.y,h.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.MJ),this._createNewOnes(h)}static _GetAttributeNamesOrOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=[x.g.PositionKind,x.g.ColorKind,"angle","offset","size"];return h&&j.push("cellIndex"),R||j.push("direction"),l&&j.push("remapData"),j}static _GetEffectCreationOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Rh.d)(j),h&&j.push("particlesInfos"),R&&j.push("logarithmicDepthConstant"),l&&(j.push("vFogInfos"),j.push("vFogColor")),j}fillDefines(h,R){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Rh.m)(this,this._scene,h),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&h.push("#define FOG")),this._isAnimationSheetEnabled&&h.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&h.push("#define LOGARITHMICDEPTH"),R===w.BLENDMODE_MULTIPLY&&h.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&h.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(h.push("#define BILLBOARD"),this.billboardMode){case 2:h.push("#define BILLBOARDY");break;case 8:case 9:h.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&h.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:h.push("#define BILLBOARDMODE_ALL")}l&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),h.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(h,R,l){R.push(...eh._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),h.push(...eh._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),l.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,jh.f)(h,this._imageProcessingConfigurationDefines),(0,jh.c)(l,this._imageProcessingConfigurationDefines))}_getWrapper(h){const R=this._getCustomDrawWrapper(h);if(null!==R&&void 0!==R&&R.effect)return R;const l=[];this.fillDefines(l,h);const j=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let a=this._drawWrappers[j];a||(a=this._drawWrappers[j]=[]);let D=a[h];D||(D=new hh.c(this._engine),D.drawContext&&(D.drawContext.useInstancing=this._useInstancing),a[h]=D);const U=l.join("\n");if(D.defines!==U){const h=[],R=[],l=[];this.fillUniformsAttributesAndSamplerNames(R,h,l),D.setEffect(this._engine.createEffect("particles",h,R,l,U,void 0,void 0,void 0,void 0,this._shaderLanguage),U)}return D}animate(){var h;let R,l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!l&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(l?this.preWarmStepOffset:(null===(h=this._scene)||void 0===h?void 0:h.getAnimationRatio())||1),this.manualEmitCount>-1)R=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let h=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const R=this._actualFrame/this.targetStopDuration;d.GetCurrentGradient(R,this._emitRateGradients,((R,l,j)=>{R!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=l.getFactor(),this._currentEmitRateGradient=R),h=(0,mh.Lerp)(this._currentEmitRate1,this._currentEmitRate2,j)}))}R=h*this._scaledUpdateSpeed|0,this._newPartsExcess+=h*this._scaledUpdateSpeed-R}if(this._newPartsExcess>1&&(R+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?R=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(R),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!l){let h=0;for(let R=0;R<this.MJ.length;R++){const l=this.MJ[R];this._appendParticleVertices(h,l),h+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.MJ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(h,R){this._appendParticleVertex(h++,R,0,0),this._useInstancing||(this._appendParticleVertex(h++,R,1,0),this._appendParticleVertex(h++,R,1,1),this._appendParticleVertex(h++,R,0,1))}rebuild(){var h;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(h=this._spriteBuffer)||void 0===h||h._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!eh.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(l.bind(l,14373)),Promise.resolve().then(l.bind(l,14326))])):await Promise.all([Promise.resolve().then(l.bind(l,14311)),Promise.resolve().then(l.bind(l,14298))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.UR||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==w.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(w.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(w.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(h){const R=this._getWrapper(h),l=R.effect,a=this._engine;a.enableEffect(R);const D=this.defaultViewMatrix??this._scene.getViewMatrix();if(l.setTexture("diffuseSampler",this.particleTexture),l.setMatrix("view",D),l.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const h=this.particleTexture.getBaseSize();l.setFloat3("particlesInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,this.spriteCellWidth/h.width)}if(l.setVector2("translationPivot",this.translationPivot),l.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const h=this._scene.activeCamera;l.setVector3("eyePosition",h.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),l.setTexture("rampSampler",this._rampGradientsTexture));const U=l.defines;var F,w,mh,u,c,J;(this._scene&&((0,Rh.f)(l,this,this._scene),this.applyFog&&(0,lh.g)(this._scene,void 0,l)),U.indexOf("#define BILLBOARDMODE_ALL")>=0&&(D.invertToRef(j.TmpVectors.Matrix[0]),l.setMatrix("invView",j.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?a.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,l):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,l)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?a.bindBuffers(this._vertexBuffers,null!==(mh=this._scene)&&void 0!==mh&&mh.forceWireframe?this._linesIndexBuffer:this._indexBuffer,l):a.bindBuffers(this._vertexBuffers,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:null,l);(this.useLogarithmicDepth&&this._scene&&(0,lh.m)(U,l,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(l),this._setEngineBasedOnBlendMode(h),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(l),this._useInstancing)?null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?a.drawElementsType(6,0,10,this.MJ.length):a.drawArraysType(7,0,4,this.MJ.length):null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?a.drawElementsType(1,0,10*this.MJ.length):a.drawElementsType(0,0,6*this.MJ.length);return this.MJ.length}render(){if(!this.isReady()||!this.MJ.length)return 0;const h=this._engine;h.setState&&(h.setState(!1),this.forceDepthWrite&&h.setDepthWrite(!0));let R=0;return R=this.blendMode===w.BLENDMODE_MULTIPLYADD?this._render(w.BLENDMODE_MULTIPLY)+this._render(w.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),R}_onDispose(){}dispose(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),h&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),h&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(R,l),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const h=this._scene.SJ.indexOf(this);h>-1&&this._scene.SJ.splice(h,1),this._scene._activeParticleSystems.dispose()}this.mw.notifyObservers(this),this.mw.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}eh.ForceGLSL=!1;var Sh,Zh=l(12733);!function(h){h[h.ATTACHED=0]="ATTACHED",h[h.END=1]="END"}(Sh||(Sh={}));class Mh{constructor(h){if(this.particleSystem=h,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!h.UR||!h.UR.dispose){const R=(0,F.e)("BABYLON.AbstractMesh");h.UR=new R("SubemitterSystemEmitter",h.yh()),h._disposeEmitterOnDispose=!0}}clone(){let h=this.particleSystem.UR;if(h){if(h instanceof j.tR)h=h.clone();else if(-1!==h.getClassName().indexOf("Mesh")){h=new((0,F.e)("BABYLON.Mesh"))("",h.yh()),h.isVisible=!1}}else h=new j.tR;const R=new Mh(this.particleSystem.clone(this.particleSystem.name,h));return R.particleSystem.name+="Clone",R.type=this.type,R.inheritDirection=this.inheritDirection,R.inheritedVelocityAmount=this.inheritedVelocityAmount,R.particleSystem._disposeEmitterOnDispose=!0,R.particleSystem.disposeOnStop=!0,R}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R={};return R.type=this.type,R.inheritDirection=this.inheritDirection,R.inheritedVelocityAmount=this.inheritedVelocityAmount,R.particleSystem=this.particleSystem.serialize(h),R}static _ParseParticleSystem(h,R,l){throw(0,Zh.b)("ParseParticle")}static Parse(h,R,l){const j=h.particleSystem,a=new Mh(Mh._ParseParticleSystem(j,R,l,!0));return a.type=h.type,a.inheritDirection=h.inheritDirection,a.inheritedVelocityAmount=h.inheritedVelocityAmount,a.particleSystem._isSubEmitter=!0,a}dispose(){this.particleSystem.dispose()}}var ih=l(12797);function dh(h,R){const l=new t;return l.direction1=h,l.direction2=R,l}function Xh(){return new s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Vh(){return new f(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Bh(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.tR(0,1,0),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.tR(0,1,0);return new T(h,R,l)}function Nh(){return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function hR(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.tR(0,1,0),D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.tR(0,1,0);return new Y(h,R,l,a,D)}function RR(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new J(h,R)}function lR(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.tR(0,1,0),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.tR(0,1,0);return new q(h,R,l,a)}const jR=j.tR.Zero(),aR=j.tR.Zero(),DR=j.tR.Zero();class UR{constructor(){this.strength=0,this.position=j.tR.Zero()}_processParticle(h,R){this.position.subtractToRef(h.position,jR);const l=jR.lengthSquared()+1;jR.normalize().scaleToRef(this.strength/l,aR),aR.scaleToRef(R._tempScaledUpdateSpeed,DR),h.direction.addInPlace(DR)}serialize(){return{position:this.position.sF(),strength:this.strength}}}class FR extends eh{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=h=>{if(!this._subEmitters||0===this._subEmitters.length)return;const R=Math.floor(Math.random()*this._subEmitters.length);for(const l of this._subEmitters[R])if(1===l.type){const R=l.clone();h._inheritParticleInfoToSubEmitter(R),R.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(R.particleSystem),R.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(h,R){const l=dh(h,R);return this.particleEmitterType=l,l}get flowMap(){return this._flowMap}set flowMap(h){this._flowMap!==h&&(this._flowMap=h,this._flowMapUpdate&&(Ah(this._flowMapUpdate),this._flowMapUpdate=null),h&&(this._flowMapUpdate={process:h=>{var R;const l=null===(R=this.yh())||void 0===R?void 0:R.getTransformMatrix();this._flowMap._processParticle(h,this.flowMapStrength*this._tempScaledUpdateSpeed,l)},previousItem:null,nextItem:null},kh(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(h){this._attractors.push(h),1===this._attractors.length&&(this._attractorUpdate={process:h=>{for(const R of this._attractors)R._processParticle(h,this)},previousItem:null,nextItem:null},kh(this._attractorUpdate,this._directionProcessing))}removeAttractor(h){const R=this._attractors.indexOf(h);-1!==R&&this._attractors.splice(R,1),0===this._attractors.length&&Ah(this._attractorUpdate)}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(h)}createHemisphericEmitter(){const h=Xh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createSphereEmitter(){const h=Vh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createDirectedSphereEmitter(){const h=Bh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.tR(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.tR(0,1,0));return this.particleEmitterType=h,h}createCylinderEmitter(){const h=Nh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=h,h}createDirectedCylinderEmitter(){const h=hR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.tR(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.tR(0,1,0));return this.particleEmitterType=h,h}createConeEmitter(){const h=RR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=h,h}createDirectedConeEmitter(){const h=lR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.tR(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.tR(0,1,0));return this.particleEmitterType=h,h}createBoxEmitter(h,R,l,j){const a=new c;return this.particleEmitterType=a,this.direction1=h,this.direction2=R,this.minEmitBox=l,this.maxEmitBox=j,a}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const h of this.subEmitters)h instanceof FR?this._subEmitters.push([new Mh(h)]):h instanceof Mh?this._subEmitters.push([h]):h instanceof Array&&this._subEmitters.push(h)}_stopSubEmitters(){if(this.activeSubSystems){for(const h of this.activeSubSystems)h.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const h=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==h&&this._rootParticleSystem.activeSubSystems.splice(h,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(h){h&&this._stopSubEmitters()}_prepareParticle(h){if(this._subEmitters&&this._subEmitters.length>0){const R=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];h._attachedSubEmitters=[];for(const l of R)if(0===l.type){const R=l.clone();h._attachedSubEmitters.push(R),R.particleSystem.start()}}}_onDispose(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),h&&this.particles)for(const l of this.particles)if(l._attachedSubEmitters)for(let h=l._attachedSubEmitters.length-1;h>=0;h-=1)l._attachedSubEmitters[h].dispose();if(R&&this.activeSubSystems)for(let l=this.activeSubSystems.length-1;l>=0;l-=1)this.activeSubSystems[l].dispose();if(this._subEmitters&&this._subEmitters.length){for(let h=0;h<this._subEmitters.length;h++)for(const R of this._subEmitters[h])R.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.UR&&this.UR.dispose&&this.UR.dispose(!0)}static _Parse(h,R,l,a){let D;D=l instanceof ih.c?null:l;const w=(0,F.e)("BABYLON.Texture");if(w&&D&&(h.texture?R.particleTexture=w.Parse(h.texture,D,a):h.textureName&&(R.particleTexture=new w(a+h.textureName,D,!1,void 0===h.invertY||h.invertY),R.particleTexture.name=h.textureName)),h.emitterId||0===h.emitterId||void 0!==h.UR?h.emitterId&&D?R.UR=D.getLastMeshById(h.emitterId):R.UR=j.tR.GR(h.UR):R.UR=j.tR.Zero(),R.isLocal=!!h.isLocal,void 0!==h.renderingGroupId&&(R.renderingGroupId=h.renderingGroupId),void 0!==h.isBillboardBased&&(R.isBillboardBased=h.isBillboardBased),void 0!==h.billboardMode&&(R.billboardMode=h.billboardMode),void 0!==h.useLogarithmicDepth&&(R.useLogarithmicDepth=h.useLogarithmicDepth),h.animations){for(let l=0;l<h.animations.length;l++){const j=h.animations[l],a=(0,F.e)("BABYLON.Animation");a&&R.animations.push(a.Parse(j))}R.beginAnimationOnStart=h.beginAnimationOnStart,R.beginAnimationFrom=h.beginAnimationFrom,R.beginAnimationTo=h.beginAnimationTo,R.beginAnimationLoop=h.beginAnimationLoop}if(h.autoAnimate&&D&&D.beginAnimation(R,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1),R.startDelay=0|h.startDelay,R.minAngularSpeed=h.minAngularSpeed,R.maxAngularSpeed=h.maxAngularSpeed,R.minSize=h.minSize,R.maxSize=h.maxSize,h.minScaleX&&(R.minScaleX=h.minScaleX,R.maxScaleX=h.maxScaleX,R.minScaleY=h.minScaleY,R.maxScaleY=h.maxScaleY),void 0!==h.preWarmCycles&&(R.preWarmCycles=h.preWarmCycles,R.preWarmStepOffset=h.preWarmStepOffset),void 0!==h.minInitialRotation&&(R.minInitialRotation=h.minInitialRotation,R.maxInitialRotation=h.maxInitialRotation),R.minLifeTime=h.minLifeTime,R.maxLifeTime=h.maxLifeTime,R.minEmitPower=h.minEmitPower,R.maxEmitPower=h.maxEmitPower,R.emitRate=h.emitRate,R.gravity=j.tR.GR(h.gravity),h.noiseStrength&&(R.noiseStrength=j.tR.GR(h.noiseStrength)),R.color1=U.bF.GR(h.color1),R.color2=U.bF.GR(h.color2),R.colorDead=U.bF.GR(h.colorDead),R.updateSpeed=h.updateSpeed,R.targetStopDuration=h.targetStopDuration,R.blendMode=h.blendMode,h.colorGradients)for(const j of h.colorGradients)R.addColorGradient(j.gradient,U.bF.GR(j.color1),j.color2?U.bF.GR(j.color2):void 0);if(h.rampGradients){for(const l of h.rampGradients)R.addRampGradient(l.gradient,U.xR.GR(l.color));R.useRampGradients=h.useRampGradients}if(h.colorRemapGradients)for(const j of h.colorRemapGradients)R.addColorRemapGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.alphaRemapGradients)for(const j of h.alphaRemapGradients)R.addAlphaRemapGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.sizeGradients)for(const j of h.sizeGradients)R.addSizeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.angularSpeedGradients)for(const j of h.angularSpeedGradients)R.addAngularSpeedGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.velocityGradients)for(const j of h.velocityGradients)R.addVelocityGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.dragGradients)for(const j of h.dragGradients)R.addDragGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.emitRateGradients)for(const j of h.emitRateGradients)R.addEmitRateGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.startSizeGradients)for(const j of h.startSizeGradients)R.addStartSizeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.lifeTimeGradients)for(const j of h.lifeTimeGradients)R.addLifeTimeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(h.limitVelocityGradients){for(const l of h.limitVelocityGradients)R.addLimitVelocityGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);R.limitVelocityDamping=h.limitVelocityDamping}if(h.noiseTexture&&D){const l=(0,F.e)("BABYLON.ProceduralTexture");R.noiseTexture=l.Parse(h.noiseTexture,D,a)}let mh;if(h.particleEmitterType){switch(h.particleEmitterType.type){case"SphereParticleEmitter":mh=new f;break;case"SphereDirectedParticleEmitter":mh=new T;break;case"ConeEmitter":case"ConeParticleEmitter":mh=new J;break;case"ConeDirectedParticleEmitter":mh=new q;break;case"CylinderParticleEmitter":mh=new Q;break;case"CylinderDirectedParticleEmitter":mh=new Y;break;case"HemisphericParticleEmitter":mh=new s;break;case"PointParticleEmitter":mh=new t;break;case"MeshParticleEmitter":mh=new G;break;case"CustomParticleEmitter":mh=new E;break;default:mh=new c}mh.parse(h.particleEmitterType,D)}else mh=new c,mh.parse(h,D);R.particleEmitterType=mh,R.startSpriteCellID=h.startSpriteCellID,R.endSpriteCellID=h.endSpriteCellID,R.spriteCellLoop=h.spriteCellLoop??!0,R.spriteCellWidth=h.spriteCellWidth,R.spriteCellHeight=h.spriteCellHeight,R.spriteCellChangeSpeed=h.spriteCellChangeSpeed,R.spriteRandomStartCell=h.spriteRandomStartCell,R.disposeOnStop=h.disposeOnStop??!1,R.manualEmitCount=h.manualEmitCount??-1}static Parse(h,R,l){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],D=arguments.length>4?arguments[4]:void 0;const F=h.name;let w,mh,u=null,c=null;if(R instanceof ih.c?w=R:(mh=R,w=mh.getEngine()),h.customShader&&w.createEffectForParticles){c=h.customShader;const R=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"";u=w.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,R)}const J=new FR(F,D||h.tl,R,u,h.isAnimationSheetEnabled);if(J.customShader=c,J._rootUrl=l,h.id&&(J.id=h.id),h.subEmitters){J.subEmitters=[];for(const j of h.subEmitters){const h=[];for(const a of j)h.push(Mh.Parse(a,R,l));J.subEmitters.push(h)}}if(h.attractors)for(const U of h.attractors){const h=new UR;h.position=j.tR.GR(U.position),h.strength=U.strength,J.addAttractor(h)}return FR._Parse(h,J,R,l),h.textureMask&&(J.textureMask=U.bF.GR(h.textureMask)),h.xm&&(J.xm=j.tR.GR(h.xm)),h.preventAutoStart&&(J.preventAutoStart=h.preventAutoStart),a||J.preventAutoStart||J.start(),J}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R={};if(FR._Serialize(R,this,h),R.textureMask=this.textureMask.sF(),R.customShader=this.customShader,R.preventAutoStart=this.preventAutoStart,R.xm=this.xm.sF(),this.subEmitters){R.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const l of this._subEmitters){const j=[];for(const R of l)j.push(R.serialize(h));R.subEmitters.push(j)}}if(this._attractors&&this._attractors.length){R.attractors=[];for(const h of this._attractors)R.attractors.push(h.serialize())}return R}static _Serialize(h,R,l){if(h.name=R.name,h.id=R.id,h.tl=R.getCapacity(),h.disposeOnStop=R.disposeOnStop,h.manualEmitCount=R.manualEmitCount,R.UR.position){const l=R.UR;h.emitterId=l.id}else{const l=R.UR;h.UR=l.sF()}R.particleEmitterType&&(h.particleEmitterType=R.particleEmitterType.serialize()),R.particleTexture&&(l?h.texture=R.particleTexture.serialize():(h.textureName=R.particleTexture.name,h.invertY=!!R.particleTexture._invertY)),h.isLocal=R.isLocal,P.c.AppendSerializedAnimations(R,h),h.beginAnimationOnStart=R.beginAnimationOnStart,h.beginAnimationFrom=R.beginAnimationFrom,h.beginAnimationTo=R.beginAnimationTo,h.beginAnimationLoop=R.beginAnimationLoop,h.startDelay=R.startDelay,h.renderingGroupId=R.renderingGroupId,h.isBillboardBased=R.isBillboardBased,h.billboardMode=R.billboardMode,h.minAngularSpeed=R.minAngularSpeed,h.maxAngularSpeed=R.maxAngularSpeed,h.minSize=R.minSize,h.maxSize=R.maxSize,h.minScaleX=R.minScaleX,h.maxScaleX=R.maxScaleX,h.minScaleY=R.minScaleY,h.maxScaleY=R.maxScaleY,h.minEmitPower=R.minEmitPower,h.maxEmitPower=R.maxEmitPower,h.minLifeTime=R.minLifeTime,h.maxLifeTime=R.maxLifeTime,h.emitRate=R.emitRate,h.gravity=R.gravity.sF(),h.noiseStrength=R.noiseStrength.sF(),h.color1=R.color1.sF(),h.color2=R.color2.sF(),h.colorDead=R.colorDead.sF(),h.updateSpeed=R.updateSpeed,h.targetStopDuration=R.targetStopDuration,h.blendMode=R.blendMode,h.preWarmCycles=R.preWarmCycles,h.preWarmStepOffset=R.preWarmStepOffset,h.minInitialRotation=R.minInitialRotation,h.maxInitialRotation=R.maxInitialRotation,h.startSpriteCellID=R.startSpriteCellID,h.spriteCellLoop=R.spriteCellLoop,h.endSpriteCellID=R.endSpriteCellID,h.spriteCellChangeSpeed=R.spriteCellChangeSpeed,h.spriteCellWidth=R.spriteCellWidth,h.spriteCellHeight=R.spriteCellHeight,h.spriteRandomStartCell=R.spriteRandomStartCell,h.isAnimationSheetEnabled=R.isAnimationSheetEnabled,h.useLogarithmicDepth=R.useLogarithmicDepth;const j=R.getColorGradients();if(j){h.colorGradients=[];for(const R of j){const l={gradient:R.gradient,color1:R.color1.sF()};R.color2?l.color2=R.color2.sF():l.color2=R.color1.sF(),h.colorGradients.push(l)}}const a=R.getRampGradients();if(a){h.rampGradients=[];for(const R of a){const l={gradient:R.gradient,color:R.color.sF()};h.rampGradients.push(l)}h.useRampGradients=R.useRampGradients}const D=R.getColorRemapGradients();if(D){h.colorRemapGradients=[];for(const R of D){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.colorRemapGradients.push(l)}}const U=R.getAlphaRemapGradients();if(U){h.alphaRemapGradients=[];for(const R of U){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.alphaRemapGradients.push(l)}}const F=R.getSizeGradients();if(F){h.sizeGradients=[];for(const R of F){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.sizeGradients.push(l)}}const w=R.getAngularSpeedGradients();if(w){h.angularSpeedGradients=[];for(const R of w){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.angularSpeedGradients.push(l)}}const mh=R.getVelocityGradients();if(mh){h.velocityGradients=[];for(const R of mh){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.velocityGradients.push(l)}}const u=R.getDragGradients();if(u){h.dragGradients=[];for(const R of u){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.dragGradients.push(l)}}const c=R.getEmitRateGradients();if(c){h.emitRateGradients=[];for(const R of c){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.emitRateGradients.push(l)}}const J=R.getStartSizeGradients();if(J){h.startSizeGradients=[];for(const R of J){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.startSizeGradients.push(l)}}const q=R.getLifeTimeGradients();if(q){h.lifeTimeGradients=[];for(const R of q){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.lifeTimeGradients.push(l)}}const Q=R.getLimitVelocityGradients();if(Q){h.limitVelocityGradients=[];for(const R of Q){const l={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2?l.factor2=R.factor2:l.factor2=R.factor1,h.limitVelocityGradients.push(l)}h.limitVelocityDamping=R.limitVelocityDamping}R.noiseTexture&&(h.noiseTexture=R.noiseTexture.serialize())}clone(h,R){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j={...this._customWrappers};let a=null;const D=this._engine;if(D.createEffectForParticles&&null!=this.customShader){a=this.customShader;const h=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"",R=D.createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,h);j[0]?j[0].effect=R:this.setCustomEffect(R,0)}const U=this.serialize(l),F=FR.Parse(U,this._scene||this._engine,this._rootUrl);return F.name=h,F.customShader=a,F._customWrappers=j,void 0===R&&(R=this.UR),this.noiseTexture&&(F.noiseTexture=this.noiseTexture.clone()),F.UR=R,this.preventAutoStart||F.start(),F}}FR.BILLBOARDMODE_Y=2,FR.BILLBOARDMODE_ALL=7,FR.BILLBOARDMODE_STRETCHED=8,FR.BILLBOARDMODE_STRETCHED_LOCAL=9,Mh._ParseParticleSystem=FR.Parse;var wR=l(13128),ml=l(13126),uR=l(13022);uR.c.prototype.createTransformFeedback=function(){const h=this._gl.createTransformFeedback();if(!h)throw new Error("Unable to create Transform Feedback");return h},uR.c.prototype.deleteTransformFeedback=function(h){this._gl.deleteTransformFeedback(h)},uR.c.prototype.bindTransformFeedback=function(h){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,h)},uR.c.prototype.beginTransformFeedback=function(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(h?this._gl.POINTS:this._gl.TRIANGLES)},uR.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},uR.c.prototype.setTranformFeedbackVaryings=function(h,R){this._gl.transformFeedbackVaryings(h,R,this._gl.INTERLEAVED_ATTRIBS)},uR.c.prototype.bindTransformFeedbackBuffer=function(h){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,h?h.underlyingResource:null)},uR.c.prototype.readTransformFeedbackBuffer=function(h){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,h)};const cR="clipPlaneFragmentDeclaration2",JR="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";O.d.IncludesShadersStore[cR]||(O.d.IncludesShadersStore[cR]=JR);l(14228),l(14232),l(14240),l(14242),l(14245),l(14247),l(14251),l(14254);const qR="gpuRenderParticlesPixelShader",QR="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";O.d.ShadersStore[qR]||(O.d.ShadersStore[qR]=QR);const YR="clipPlaneVertexDeclaration2",sR="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";O.d.IncludesShadersStore[YR]||(O.d.IncludesShadersStore[YR]=sR);l(14261),l(14265),l(14268),l(14275);const tR="gpuRenderParticlesVertexShader",fR="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";O.d.ShadersStore[tR]||(O.d.ShadersStore[tR]=fR);class TR extends w{static get IsSupported(){if(!B.b.LastCreatedEngine)return!1;const h=B.b.LastCreatedEngine.getCaps();return h.supportTransformFeedbacks||h.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(h){this._maxActiveParticleCount=Math.min(h,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(h){this.maxActiveParticleCount=h}createPointEmitter(h,R){const l=dh(h,R);return this.particleEmitterType=l,l}createHemisphericEmitter(){const h=Xh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createSphereEmitter(){const h=Vh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createDirectedSphereEmitter(){const h=Bh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.tR(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.tR(0,1,0));return this.particleEmitterType=h,h}createCylinderEmitter(){const h=Nh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=h,h}createDirectedCylinderEmitter(){const h=hR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.tR(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.tR(0,1,0));return this.particleEmitterType=h,h}createConeEmitter(){const h=RR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=h,h}createDirectedConeEmitter(){const h=lR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.tR(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.tR(0,1,0));return this.particleEmitterType=h,h}createBoxEmitter(h,R,l,j){const a=new c;return this.particleEmitterType=a,this.direction1=h,this.direction2=R,this.minEmitBox=l,this.maxEmitBox=j,a}get flowMap(){return this._flowMap}set flowMap(h){this._flowMap!==h&&(this._flowMap=h)}isReady(){if(!this.UR||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==FR.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(FR.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(FR.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";h?setTimeout((()=>{this.start(0)}),h):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var h;let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(h=this._customWrappers[R])||void 0===h?void 0:h.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[h]??this._customWrappers[0]}setCustomEffect(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[R]=new hh.c(this._engine),this._customWrappers[R].effect=h}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new X.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(h,R,l){return super._removeGradientAndTexture(h,R,l),this._releaseBuffers(),this}addColorGradient(h,R){this._colorGradients||(this._colorGradients=[]);const l=new Z(h,R);return this._colorGradients.push(l),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(h&&this._colorGradients.sort(((h,R)=>h.gradient<R.gradient?-1:h.gradient>R.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(h){return this._removeGradientAndTexture(h,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const R in this._drawWrappers){var h;null===(h=this._drawWrappers[R].drawContext)||void 0===h||h.reset()}}_addFactorGradient(h,R,l){const j=new i(R,l);h.push(j),this._releaseBuffers()}addSizeGradient(h,R){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,h,R),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(h){return this._removeGradientAndTexture(h,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(h,R){if(!h)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&h.sort(((h,R)=>h.gradient<R.gradient?-1:h.gradient>R.gradient?1:0));const l=this;l[R]&&(l[R].dispose(),l[R]=null)}addAngularSpeedGradient(h,R){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,h,R),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(h){return this._removeGradientAndTexture(h,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(h,R){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,h,R),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(h){return this._removeGradientAndTexture(h,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(h,R){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,h,R),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(h){return this._removeGradientAndTexture(h,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(h,R){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,h,R),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(h){return this._removeGradientAndTexture(h,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(h){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(h,R,l){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(h),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.mw=new X.d,this.onStoppedObservable=new X.d,this.onStartedObservable=new X.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,l&&"Scene"!==l.getClassName()?(this._engine=l,this.defaultProjectionMatrix=j.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=l||B.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.SJ.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,F.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,F.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,F.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,F.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new hh.c(this._engine)},this._customWrappers[0].effect=a,this._drawWrappers={0:new hh.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(R=R??{}).randomTextureSize||delete R.randomTextureSize;const U={tl:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...R},w=R;isFinite(w)&&(U.tl=w),this._capacity=U.tl,this._maxActiveParticleCount=U.tl,this._currentActiveCount=0,this._isAnimationSheetEnabled=D,this.particleEmitterType=new c;const mh=Math.min(this._engine.getCaps().maxTextureSize,U.randomTextureSize);let u=[];for(let j=0;j<mh;++j)u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),u.push(Math.random());this._randomTexture=new V.e(new Float32Array(u),mh,1,5,l,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,u=[];for(let j=0;j<mh;++j)u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),u.push(Math.random());this._randomTexture2=new V.e(new Float32Array(u),mh,1,5,l,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=mh}_reset(){this._releaseBuffers()}_createVertexBuffers(h,R,l){const j={};j.position=R.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let a=3;j.age=R.createVertexBuffer("age",a,1,this._attributesStrideSize,!0),a+=1,j.size=R.createVertexBuffer("size",a,3,this._attributesStrideSize,!0),a+=3,j.life=R.createVertexBuffer("life",a,1,this._attributesStrideSize,!0),a+=1,a+=4,this.billboardMode===FR.BILLBOARDMODE_STRETCHED&&(j.direction=R.createVertexBuffer("direction",a,3,this._attributesStrideSize,!0)),a+=3,this._platform.alignDataInBuffer&&(a+=1),this.particleEmitterType instanceof E&&(a+=3,this._platform.alignDataInBuffer&&(a+=1)),this._colorGradientsTexture||(j.color=R.createVertexBuffer("color",a,4,this._attributesStrideSize,!0),a+=4),this._isBillboardBased||(j.initialDirection=R.createVertexBuffer("initialDirection",a,3,this._attributesStrideSize,!0),a+=3,this._platform.alignDataInBuffer&&(a+=1)),this.noiseTexture&&(j.noiseCoordinates1=R.createVertexBuffer("noiseCoordinates1",a,3,this._attributesStrideSize,!0),a+=3,this._platform.alignDataInBuffer&&(a+=1),j.noiseCoordinates2=R.createVertexBuffer("noiseCoordinates2",a,3,this._attributesStrideSize,!0),a+=3,this._platform.alignDataInBuffer&&(a+=1)),j.angle=R.createVertexBuffer("angle",a,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?a++:a+=2,this._isAnimationSheetEnabled&&(j.cellIndex=R.createVertexBuffer("cellIndex",a,1,this._attributesStrideSize,!0),a+=1,this.spriteRandomStartCell&&(j.cellStartOffset=R.createVertexBuffer("cellStartOffset",a,1,this._attributesStrideSize,!0),a+=1)),j.offset=l.createVertexBuffer("offset",0,2),j.uv=l.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(j),this._platform.createVertexBuffers(h,j),this.resetDrawCache()}_initialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!h)return;const R=this._engine,l=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof E&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const a=this.particleEmitterType instanceof E,D=j.TmpVectors.tR[0];let U=0;for(let j=0;j<this._capacity;j++)if(l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),a?(this.particleEmitterType.particleDestinationGenerator(j,null,D),l.push(D.x),l.push(D.y),l.push(D.z)):(l.push(0),l.push(0),l.push(0)),this._platform.alignDataInBuffer&&l.push(0),U+=16,a&&(this.particleEmitterType.particlePositionGenerator(j,null,D),l.push(D.x),l.push(D.y),l.push(D.z),this._platform.alignDataInBuffer&&l.push(0),U+=4),this._colorGradientsTexture||(l.push(0),l.push(0),l.push(0),l.push(0),U+=4),this.isBillboardBased||(l.push(0),l.push(0),l.push(0),this._platform.alignDataInBuffer&&l.push(0),U+=4),this.noiseTexture&&(l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),this._platform.alignDataInBuffer&&l.push(0),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),this._platform.alignDataInBuffer&&l.push(0),U+=8),l.push(0),U+=1,this._angularSpeedGradientsTexture||(l.push(0),U+=1),this._isAnimationSheetEnabled&&(l.push(0),U+=1,this.spriteRandomStartCell&&(l.push(0),U+=1)),this._platform.alignDataInBuffer){let h=3-(U+3&3);for(U+=h;h-- >0;)l.push(0)}const F=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),w=this._platform.createParticleBuffer(l),mh=this._platform.createParticleBuffer(l);this._buffer0=new x.e(R,w,!1,this._attributesStrideSize),this._buffer1=new x.e(R,mh,!1,this._attributesStrideSize),this._spriteBuffer=new x.e(R,F,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let h=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(h+="\n#define BILLBOARD"),this._colorGradientsTexture&&(h+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(h+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(h+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(h+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(h+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(h+="\n#define DRAGGRADIENTS"),this._flowMap&&(h+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(h+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(h+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(h+="\n#define NOISE"),this.isLocal&&(h+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===h||(this._cachedUpdateDefines=h,this._updateBuffer=this._platform.createUpdateBuffer(h)),this._platform.isUpdateBufferReady()}_getWrapper(h){const R=this._getCustomDrawWrapper(h);if(null!==R&&void 0!==R&&R.effect)return R;const l=[];this.fillDefines(l,h);let j=this._drawWrappers[h];j||(j=new hh.c(this._engine),j.drawContext&&(j.drawContext.useInstancing=!0),this._drawWrappers[h]=j);const a=l.join("\n");if(j.defines!==a){const h=[],R=[],l=[];this.fillUniformsAttributesAndSamplerNames(R,h,l),j.setEffect(this._engine.createEffect("gpuRenderParticles",h,R,l,a),a)}return j}static _GetAttributeNamesOrOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=[x.g.PositionKind,"age","life","size","angle"];return h||a.push(x.g.ColorKind),R&&a.push("cellIndex"),l||a.push("initialDirection"),j&&a.push("direction"),a.push("offset",x.g.UVKind),a}static _GetEffectCreationOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=["emitterWM","xm","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Rh.d)(j),h&&j.push("sheetInfos"),R&&j.push("logarithmicDepthConstant"),l&&(j.push("vFogInfos"),j.push("vFogColor")),j}fillDefines(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Rh.m)(this,this._scene,h),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==ml.e.FOGMODE_NONE&&h.push("#define FOG")),R===FR.BLENDMODE_MULTIPLY&&h.push("#define BLENDMULTIPLYMODE"),this.isLocal&&h.push("#define LOCAL"),this.useLogarithmicDepth&&h.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(h.push("#define BILLBOARD"),this.billboardMode){case FR.BILLBOARDMODE_Y:h.push("#define BILLBOARDY");break;case FR.BILLBOARDMODE_STRETCHED:h.push("#define BILLBOARDSTRETCHED");break;case FR.BILLBOARDMODE_ALL:h.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&h.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&h.push("#define ANIMATESHEET"),l&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),h.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(h,R,l){R.push(...TR._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===FR.BILLBOARDMODE_STRETCHED)),h.push(...TR._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),l.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(wR.e.PrepareUniforms(h,this._imageProcessingConfigurationDefines),wR.e.PrepareSamplers(l,this._imageProcessingConfigurationDefines))}animate(){var h;let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(R?this.preWarmStepOffset:(null===(h=this._scene)||void 0===h?void 0:h.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(h,R){const l=this[R];if(!h||!h.length||l)return;const j=new Float32Array(this._rawTextureWidth);for(let a=0;a<this._rawTextureWidth;a++){const R=a/this._rawTextureWidth;d.GetCurrentGradient(R,h,((h,R,l)=>{j[a]=(0,mh.Lerp)(h.factor1,R.factor1,l)}))}this[R]=V.e.CreateRTexture(j,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[R].name=R.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const h=new Uint8Array(4*this._rawTextureWidth),R=U.TmpColors.bF[0];for(let l=0;l<this._rawTextureWidth;l++){const j=l/this._rawTextureWidth;d.GetCurrentGradient(j,this._colorGradients,((j,a,D)=>{U.bF.LerpToRef(j.color1,a.color1,D,R),h[4*l]=255*R.r,h[4*l+1]=255*R.g,h[4*l+2]=255*R.b,h[4*l+3]=255*R.a}))}this._colorGradientsTexture=V.e.CreateRGBATexture(h,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(h,R){var l,a,D,U;const F=this._getWrapper(h),w=F.effect;this._engine.enableEffect(F);const mh=(null===(l=this._scene)||void 0===l?void 0:l.getViewMatrix())||j.Matrix.IdentityReadOnly;if(w.setMatrix("view",mh),w.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),w.setTexture("diffuseSampler",this.particleTexture),w.setVector2("translationPivot",this.translationPivot),w.setVector3("xm",this.xm),this.isLocal&&w.setMatrix("emitterWM",R),this._colorGradientsTexture?w.setTexture("colorGradientSampler",this._colorGradientsTexture):w.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const h=this.particleTexture.getBaseSize();w.setFloat3("sheetInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,h.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const h=this._scene.activeCamera;w.setVector3("eyePosition",h.globalPosition)}const u=w.defines;if(this._scene&&((0,Rh.f)(w,this,this._scene),this.applyFog&&(0,lh.g)(this._scene,void 0,w)),u.indexOf("#define BILLBOARDMODE_ALL")>=0){const h=mh.clone();h.invert(),w.setMatrix("invView",h)}return this.useLogarithmicDepth&&this._scene&&(0,lh.m)(u,w,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(w),this._setEngineBasedOnBlendMode(h),this._platform.bindDrawBuffers(this._targetIndex,w,null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(w),null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(U=this._scene)&&void 0!==U&&U.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(h){if(!this.UR||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!h)if(this.UR.position){h=this.UR.getWorldMatrix()}else{const R=this.UR;h=j.TmpVectors.Matrix[0],j.Matrix.TranslationToRef(R.x,R.y,R.z,h)}const R=this._engine,l=R.getDepthWrite();if(R.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const h=this.yh();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",h.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",h),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const a=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=a,R.setDepthWrite(l)}render(){let h,R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!R&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let h=0;h<this.preWarmCycles;h++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const h=0|this._accumulatedCount;this._accumulatedCount-=h,this._currentActiveCount+=h}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.UR.position){h=this.UR.getWorldMatrix()}else{const R=this.UR;h=j.TmpVectors.Matrix[0],j.Matrix.TranslationToRef(R.x,R.y,R.z,h)}const a=this._engine;this.updateInAnimate||this._update(h);let D=0;return R||l||(a.setState(!1),this.forceDepthWrite&&a.setDepthWrite(!0),D=this.blendMode===FR.BLENDMODE_MULTIPLYADD?this._render(FR.BLENDMODE_MULTIPLY,h)+this._render(FR.BLENDMODE_ADD,h):this._render(this.blendMode,h),this._engine.setAlphaMode(0)),D}rebuild(){const h=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(h,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,h()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const R in this._drawWrappers){this._drawWrappers[R].dispose()}if(this._drawWrappers={},this._scene){const h=this._scene.SJ.indexOf(this);h>-1&&this._scene.SJ.splice(h,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let R=0;R<this._renderVertexBuffers.length;++R){const h=this._renderVertexBuffers[R];for(const R in h)h[R].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),h&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),h&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.mw.notifyObservers(this),this.mw.clear()}clone(h,R){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j={...this._customWrappers};let a=null;const D=this._engine;if(D.createEffectForParticles&&null!=this.customShader){a=this.customShader;const h=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"";j[0]=D.createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,h,void 0,void 0,void 0,this)}const U=this.serialize(l),F=TR.Parse(U,this._scene||this._engine,this._rootUrl);return F.name=h,F.customShader=a,F._customWrappers=j,void 0===R&&(R=this.UR),this.noiseTexture&&(F.noiseTexture=this.noiseTexture.clone()),F.UR=R,F}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R={};return FR._Serialize(R,this,h),R.activeParticleCount=this.activeParticleCount,R.randomTextureSize=this._randomTextureSize,R.customShader=this.customShader,R}static Parse(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;const D=h.name;let U,F;R instanceof ih.c?U=R:(F=R,U=F.getEngine());const w=new TR(D,{tl:a||h.tl,randomTextureSize:h.randomTextureSize},R,null,h.isAnimationSheetEnabled);if(w._rootUrl=l,h.customShader&&U.createEffectForParticles){const R=h.customShader,l=R.shaderOptions.defines.length>0?R.shaderOptions.defines.join("\n"):"",j=U.createEffectForParticles(R.shaderPath.fragmentElement,R.shaderOptions.uniforms,R.shaderOptions.samplers,l,void 0,void 0,void 0,w);w.setCustomEffect(j,0),w.customShader=R}return h.id&&(w.id=h.id),h.activeParticleCount&&(w.activeParticleCount=h.activeParticleCount),FR._Parse(h,w,R,l),h.preventAutoStart&&(w.preventAutoStart=h.preventAutoStart),j||w.preventAutoStart||w.start(),w}}var ER=l(12689),xR=l(14283),GR=l(13235);class pR{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(h){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const R of this.systems)R.UR=h;this._emitterNode=h}setEmitterAsSphere(h,R,l){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:h,renderingGroupId:R};const j=(0,xR.b)("emitterSphere",{diameter:h.diameter,segments:h.segments},l);j.renderingGroupId=R;const a=new GR.ER("emitterSphereMaterial",l);a.emissiveColor=h.color,j.material=a;for(const D of this.systems)D.UR=j;this._emitterNode=j}start(h){for(const R of this.systems)h&&(R.UR=h),R.start()}dispose(){for(const h of this.systems)h.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R={systems:[]};for(const l of this.systems)R.systems.push(l.serialize(h));return this._emitterNode&&(R.UR=this._emitterCreationOptions),R}static Parse(h,R){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;const a=new pR,D=this.BaseAssetsUrl+"/textures/";R=R||B.b.LastCreatedScene;for(const U of h.systems)a.systems.push(l?TR.Parse(U,R,D,!0,j):FR.Parse(U,R,D,!0,j));if(h.UR){const l=h.UR.options;if("Sphere"===h.UR.kind)a.setEmitterAsSphere({diameter:l.diameter,segments:l.segments,color:U.xR.GR(l.color)},h.UR.renderingGroupId,R)}return a}}pR.BaseAssetsUrl="https://assets.babylonjs.com/particles";var OR=l(12741);class yR{static CreateDefault(h){let R,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,j=arguments.length>2?arguments[2]:void 0;R=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new TR("default system",{tl:l},j):new FR("default system",l,j),R.UR=h;const a=ER.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return R.particleTexture=new z.b(a,R.yh()),R.createConeEmitter(.1,Math.PI/4),R.color1=new U.bF(1,1,1,1),R.color2=new U.bF(1,1,1,1),R.colorDead=new U.bF(1,1,1,0),R.minSize=.1,R.maxSize=.1,R.minEmitPower=2,R.maxEmitPower=2,R.updateSpeed=1/60,R.emitRate=30,R}static CreateAsync(h,R){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;R||(R=B.b.LastCreatedScene);const a={};return R.addPendingData(a),new Promise(((D,U)=>{if(l&&!TR.IsSupported)return R.removePendingData(a),U("Particle system with GPU is not supported.");ER.Tools.LoadFile(`${yR.BaseAssetsUrl}/systems/${h}.json`,(h=>{R.removePendingData(a);const U=JSON.parse(h.toString());return D(pR.Parse(U,R,l,j))}),void 0,void 0,void 0,(()=>(R.removePendingData(a),U(`An error occurred with the creation of your particle system. Check if your type '${h}' exists.`))))}))}static ExportSet(h){const R=new pR;for(const l of h)R.systems.push(l);return R}static ParseFromFileAsync(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",D=arguments.length>5?arguments[5]:void 0;return new Promise(((U,F)=>{const w=new OR.b;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const R=JSON.parse(w.responseText);let F;F=j?TR.Parse(R,l,a,!1,D):FR.Parse(R,l,a,!1,D),h&&(F.name=h),U(F)}else F("Unable to load the particle system")})),w.open("GET",R),w.send()}))}static ParseFromSnippetAsync(h,R){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4?arguments[4]:void 0;if("_BLANK"===h){const h=this.CreateDefault(null);return h.start(),Promise.resolve(h)}return new Promise(((D,U)=>{const F=new OR.b;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const U=JSON.parse(JSON.parse(F.responseText).jsonPayload),w=JSON.parse(U.particleSystem);let mh;mh=l?TR.Parse(w,R,j,!1,a):FR.Parse(w,R,j,!1,a),mh.snippetId=h,D(mh)}else U("Unable to load the snippet "+h)})),F.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),F.send()}))}}yR.BaseAssetsUrl=pR.BaseAssetsUrl,yR.SnippetUrl="https://snippet.babylonjs.com",yR.CreateFromSnippetAsync=yR.ParseFromSnippetAsync;var vR=l(13310),bR=l(13151),IR=l(14288);(0,IR.f)(bR.c.NAME_PARTICLESYSTEM,((h,R,l,j)=>{const a=(0,IR.j)(bR.c.NAME_PARTICLESYSTEM);if(a&&void 0!==h.SJ&&null!==h.SJ)for(let D=0,U=h.SJ.length;D<U;D++){const U=h.SJ[D];l.SJ.push(a(U,R,j))}})),(0,IR.b)(bR.c.NAME_PARTICLESYSTEM,((h,R,l)=>{if(h.activeParticleCount){return TR.Parse(h,R,l)}return FR.Parse(h,R,l)})),ih.c.prototype.createEffectForParticles=function(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",D=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,w=arguments.length>7?arguments[7]:void 0,mh=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9?arguments[9]:void 0,c=[],J=[];const q=[];return w?w.fillUniformsAttributesAndSamplerNames(J,c,q):(c=FR._GetAttributeNamesOrOptions(),J=FR._GetEffectCreationOptions()),-1===a.indexOf(" BILLBOARD")&&(a+="\n#define BILLBOARD\n"),null!==w&&void 0!==w&&w.isAnimationSheetEnabled&&-1===a.indexOf(" ANIMATESHEET")&&(a+="\n#define ANIMATESHEET\n"),-1===j.indexOf("diffuseSampler")&&j.push("diffuseSampler"),this.createEffect({vertex:u??(null===w||void 0===w?void 0:w.vertexShaderName)??"particles",fragmentElement:h},c,J.concat(R),q.concat(j),a,D,U,F,void 0,mh,(async()=>{0===mh?await Promise.resolve().then(l.bind(l,14311)):await Promise.resolve().then(l.bind(l,14373))}))},vR.b.prototype.getEmittedParticleSystems=function(){const h=[];for(let R=0;R<this.yh().SJ.length;R++){const l=this.yh().SJ[R];l.UR===this&&h.push(l)}return h},vR.b.prototype.getHierarchyEmittedParticleSystems=function(){const h=[],R=this.getDescendants();R.push(this);for(let l=0;l<this.yh().SJ.length;l++){const j=this.yh().SJ[l],a=j.UR;a.position&&-1!==R.indexOf(a)&&h.push(j)}return h};l(13195),l(13206),l(13293);l(13298),l(14291),l(13089),l(13181),l(13332);l(13082);var LR;l(14293),l(12925);!function(h){h[h.Color=2]="Color",h[h.UV=1]="UV",h[h.Random=0]="Random",h[h.Stated=3]="Stated"}(LR||(LR={}));var nR=l(13112);const rR=new j.tR(0,0,0),PR=new j.tR(0,0,0),zR=new j.tR(0,0,0);class oR{constructor(h,R,l){this.width=h,this.height=R,this.data=l}processFlowable(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2?arguments[2]:void 0;if(!l)return;l instanceof j.Matrix?j.tR.TransformCoordinatesToRef(h.position,l,zR):(zR.x=l.x,zR.y=l.y,zR.z=l.z);const a=.5*zR.x+.5,D=1-(.5*zR.y+.5),U=Math.floor(a*this.width),F=Math.floor(D*this.height);if(U<0||U>=this.width||F<0||F>=this.height)return;const w=4*(F*this.width+U),mh=this.data[w]/255*2-1,u=this.data[w+1]/255*2-1,c=this.data[w+2]/255*2-1,J=this.data[w+3]/255;rR.set(mh,u,c),rR.scaleToRef(R*J,PR),h.direction.addInPlace(PR)}_processParticle(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2?arguments[2]:void 0;this.processFlowable(h,R,l)}static async FromUrlAsync(h){return await new Promise(((R,l)=>{const j=document.createElement("canvas"),a=j.getContext("2d");let D=null;const U=new Image;U.crossOrigin="anonymous",U.src=h,U.onerror=R=>{l(new Error(`Failed to load image: ${h} : ${R}`))},U.onload=()=>{j.width=U.width,j.height=U.height,a.drawImage(U,0,0),D=a.getImageData(0,0,j.width,j.height),R(new oR(j.width,j.height,D.data))}}))}static async ExtractFromTextureAsync(h){return await new Promise(((R,l)=>{if(!h.isReady())return void h.onLoadObservable.addOnce((async()=>{try{const l=await this.ExtractFromTextureAsync(h);R(l)}catch(j){l(j)}}));const j=h.getSize();nR.g.GetTextureDataAsync(h,j.width,j.height).then((h=>{R(new oR(j.width,j.height,new Uint8ClampedArray(h)))})).catch(l)}))}}var KR,WR,gR,HR,kR,CR,AR,eR,SR;!function(h){h[h.Int=1]="Int",h[h.Float=2]="Float",h[h.Vector2=4]="Vector2",h[h.tR=8]="tR",h[h.Matrix=16]="Matrix",h[h.Particle=32]="Particle",h[h.Texture=64]="Texture",h[h.bF=128]="bF",h[h.FloatGradient=256]="FloatGradient",h[h.Vector2Gradient=512]="Vector2Gradient",h[h.Vector3Gradient=1024]="Vector3Gradient",h[h.Color4Gradient=2048]="Color4Gradient",h[h.System=4096]="System",h[h.AutoDetect=8192]="AutoDetect",h[h.BasedOnInput=16384]="BasedOnInput",h[h.Undefined=32768]="Undefined",h[h.All=65535]="All"}(KR||(KR={})),function(h){h[h.Compatible=0]="Compatible",h[h.TypeIncompatible=1]="TypeIncompatible",h[h.HierarchyIssue=2]="HierarchyIssue"}(WR||(WR={})),function(h){h[h.Input=0]="Input",h[h.Output=1]="Output"}(gR||(gR={}));class ZR{get direction(){return this._direction}get type(){if(this._type===KR.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===KR.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(h){this._type=h}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((h=>h.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(h,R,l){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=KR.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new X.d,this.onDisconnectionObservable=new X.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=R,this.name=h,this._direction=l}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(h){var R;return this.isConnected?null!==(R=this._connectedPoint)&&void 0!==R&&R._storedFunction?this._connectedPoint._storedFunction(h):this._connectedPoint._storedValue:this.value}canConnectTo(h){return 0===this.checkCompatibilityState(h)}checkCompatibilityState(h){const R=this._ownerBlock,l=h.ownerBlock;if(this.type!==h.type&&h.innerType!==KR.AutoDetect)return h.acceptedConnectionPointTypes&&-1!==h.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(h.excludedConnectionPointTypes&&-1!==h.excludedConnectionPointTypes.indexOf(this.type))return 1;let j=l,a=R;return 0===this.direction&&(j=R,a=l),j.isAnAncestorOf(a)?2:0}connectTo(h){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(h))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${h.ownerBlock.name}".${h.name}`;return this._endpoints.push(h),h._connectedPoint=this,this.onConnectionObservable.notifyObservers(h),h.onConnectionObservable.notifyObservers(this),this}disconnectFrom(h){const R=this._endpoints.indexOf(h);return-1===R||(this._endpoints.splice(R,1),h._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(h),h.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(h){let R=1;for(;R<KR.All;)h&R||this.excludedConnectionPointTypes.push(R),R<<=1}serialize(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const R={};return R.name=this.name,R.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.sF?(R.valueType="BABYLON."+this.value.getClassName(),R.value=this.value.sF()):(R.valueType="number",R.value=this.value)),h&&this.connectedPoint&&(R.inputName=this.name,R.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,R.targetConnectionName=this.connectedPoint.name,R.isExposedOnFrame=!0,R.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(R.isExposedOnFrame=!0,R.exposedPortPosition=this.exposedPortPosition),R}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class MR{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(h){this._name=h}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(h){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new X.d,this.mw=new X.d,this.onInputChangedObservable=new X.d,this.visibleOnFrame=!1,this._name=h,this.uniqueId=o.b.UniqueId}_inputRename(h){return h}_outputRename(h){return h}isAnAncestorOf(h){for(const R of this._outputs)if(R.hasEndpoints)for(const l of R.endpoints){if(l.ownerBlock===h)return!0;if(l.ownerBlock.isAnAncestorOf(h))return!0}return!1}isAnAncestorOfType(h){if(this.getClassName()===h)return!0;for(const R of this._outputs)if(R.hasEndpoints)for(const l of R.endpoints)if(l.ownerBlock.isAnAncestorOfType(h))return!0;return!1}getInputByName(h){const R=this._inputs.filter((R=>R.name===h));return R.length?R[0]:null}_linkConnectionTypes(h,R){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[R]._acceptedConnectionPointType=this._inputs[h]:(this._inputs[h]._linkedConnectionSource=this._inputs[R],this._inputs[h]._isMainLinkSource=!0),this._inputs[R]._linkedConnectionSource=this._inputs[h]}registerInput(h,R){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,D=arguments.length>5?arguments[5]:void 0;const U=new ZR(h,this,0);return U.type=R,U.isOptional=l,U.defaultValue=j,U.value=j,U.valueMin=a,U.valueMax=D,this._inputs.push(U),this.onInputChangedObservable.notifyObservers(U),this}registerOutput(h,R,l){return(l=l??new ZR(h,this,1)).type=R,this._outputs.push(l),this}_build(h){}_customBuildStep(h){}build(h){if(this._buildId===h.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((h=>h.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=h.buildId;for(const R of this._inputs){if(!R.connectedPoint){R.isOptional||h.notConnectedNonOptionalInputs.push(R);continue}const l=R.connectedPoint.ownerBlock;l&&l!==this&&!l.isSystem&&l.build(h)}return this._customBuildStep(h),h.verbose&&K.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(h),this.onBuildObservable.notifyObservers(this),!1}serialize(){const h={};h.customType="BABYLON."+this.getClassName(),h.id=this.uniqueId,h.name=this.name,h.visibleOnFrame=this.visibleOnFrame,h.inputs=[],h.outputs=[];for(const R of this.inputs)h.inputs.push(R.serialize());for(const R of this.outputs)h.outputs.push(R.serialize(!1));return h}_deserialize(h){this._name=h.name,this.comments=h.comments,this.visibleOnFrame=!!h.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(h)}_deserializePortDisplayNamesAndExposedOnFrame(h){const R=h.inputs,l=h.outputs;if(R)for(const j of R){const h=this.inputs.find((h=>h.name===j.name));if(!h)return;if(j.displayName&&(h.displayName=j.displayName),j.isExposedOnFrame&&(h.isExposedOnFrame=j.isExposedOnFrame,h.exposedPortPosition=j.exposedPortPosition),void 0!==j.value&&null!==j.value)if("number"===j.valueType)h.value=j.value;else{const R=(0,F.e)(j.valueType);R&&(h.value=R.GR(j.value))}}if(l)for(let j=0;j<l.length;j++){const h=l[j];h.displayName&&(this.outputs[j].displayName=h.displayName),h.isExposedOnFrame&&(this.outputs[j].isExposedOnFrame=h.isExposedOnFrame,this.outputs[j].exposedPortPosition=h.exposedPortPosition)}}clone(){const h=this.serialize(),R=(0,F.e)(h.customType);if(R){const l=new R;return l._deserialize(h),l}return null}dispose(){this.mw.notifyObservers(this),this.mw.clear();for(const h of this.inputs)h.dispose();for(const h of this.outputs)h.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function iR(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",j=arguments.length>3?arguments[3]:void 0;return(a,D)=>{let U=a._propStore;U||(U=[],a._propStore=U),U.push({propertyName:D,displayName:h,type:R,groupName:l,options:j??{},className:a.getClassName()})}}(0,n.e)([(0,r.G)("comment")],MR.prototype,"comments",void 0),function(h){h[h.Boolean=0]="Boolean",h[h.Float=1]="Float",h[h.Int=2]="Int",h[h.Vector2=3]="Vector2",h[h.List=4]="List",h[h.bF=5]="bF",h[h.SamplingMode=6]="SamplingMode",h[h.TextureFormat=7]="TextureFormat",h[h.TextureType=8]="TextureType"}(HR||(HR={})),function(h){h[h.None=0]="None",h[h.Position=1]="Position",h[h.Direction=2]="Direction",h[h.Age=3]="Age",h[h.Lifetime=4]="Lifetime",h[h.Color=5]="Color",h[h.ScaledDirection=6]="ScaledDirection",h[h.Scale=7]="Scale",h[h.AgeGradient=8]="AgeGradient",h[h.Angle=9]="Angle",h[h.SpriteCellIndex=16]="SpriteCellIndex",h[h.SpriteCellStart=17]="SpriteCellStart",h[h.SpriteCellEnd=18]="SpriteCellEnd"}(kR||(kR={})),function(h){h[h.None=0]="None",h[h.Time=1]="Time",h[h.Delta=2]="Delta",h[h.Emitter=3]="Emitter"}(CR||(CR={}));class dR{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let h="";for(const R of this.notConnectedNonOptionalInputs)h+=`input ${R.name} from block ${R.ownerBlock.name}[${R.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(h)throw"Build of Node Particle System Set failed:\n"+h}adapt(h,R){const l=h.getConnectedValue(this)||0;if(h.type===R)return l;switch(R){case KR.Vector2:return new j.Vector2(l,l);case KR.tR:return new j.tR(l,l,l);case KR.bF:return new U.bF(l,l,l,l)}return null}getContextualValue(h){if(!this.particleContext||!this.systemContext)return null;switch(h){case kR.Position:return this.particleContext.position;case kR.Direction:return this.particleContext.direction;case kR.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case kR.Color:return this.particleContext.color;case kR.Age:return this.particleContext.age;case kR.Lifetime:return this.particleContext.lifeTime;case kR.Angle:return this.particleContext.angle;case kR.Scale:return this.particleContext.scale;case kR.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case kR.SpriteCellEnd:return this.systemContext.endSpriteCellID;case kR.SpriteCellIndex:return this.particleContext.cellIndex;case kR.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.UR.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.UR.absolutePosition:this.systemContext.UR:null}getSystemValue(h){if(!this.particleContext||!this.systemContext)return null;switch(h){case CR.Time:return this.systemContext._actualFrame;case CR.Delta:return this.systemContext._scaledUpdateSpeed;case CR.Emitter:if(this.isEmitterTransformNode){return this.systemContext.UR.absolutePosition}return this.systemContext.UR}return null}}function XR(h,R,l){const j=new dR;j.TR=R;const a=h.createSystem(j);return a.canStart=()=>!0,a.UR=l.clone(),a.disposeOnStop=!0,a.start(),a}class VR extends MR{constructor(h){super(h),this.blendMode=w.BLENDMODE_ONEONE,this.tl=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",KR.Particle),this.registerInput("texture",KR.Texture),this.registerInput("onStart",KR.System,!0),this.registerInput("onEnd",KR.System,!0),this.registerOutput("system",KR.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(h){h.tl=this.tl,h.buildId=this._buildId++,this.build(h);const R=this.particle.getConnectedValue(h);return R.particleTexture=this.texture.getConnectedValue(h),R.emitRate=this.emitRate,R.blendMode=this.blendMode,R.name=this.name,R._nodeGenerated=!0,R._targetStopDuration=this.targetStopDuration,R.startDelay=this.startDelay,this.system._storedValue=this,R.canStart=()=>!this.doNoStart,R.onStartedObservable.add((l=>{const j=this.onStart.getConnectedValue(h);j&&l.onStartedObservable.addOnce((()=>{h.systemContext=R;const l=XR(j,h.TR,h.emitterPosition);this.mw.addOnce((()=>{l.dispose()}))}));const a=this.onEnd.getConnectedValue(h);a&&l.onStoppedObservable.addOnce((()=>{h.systemContext=R;const l=XR(a,h.TR,h.emitterPosition);this.mw.addOnce((()=>{l.dispose()}))}))})),this.mw.addOnce((()=>{R.dispose()})),R}serialize(){const h=super.serialize();return h.tl=this.tl,h.emitRate=this.emitRate,h.blendMode=this.blendMode,h.doNoStart=this.doNoStart,h.targetStopDuration=this.targetStopDuration,h.startDelay=this.startDelay,h}_deserialize(h){super._deserialize(h),this.tl=h.tl,this.emitRate=h.emitRate,this.doNoStart=!!h.doNoStart,void 0!==h.blendMode&&(this.blendMode=h.blendMode),void 0!==h.targetStopDuration&&(this.targetStopDuration=h.targetStopDuration),void 0!==h.startDelay&&(this.startDelay=h.startDelay)}}(0,n.e)([iR("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:w.BLENDMODE_ONEONE},{label:"Standard",value:w.BLENDMODE_STANDARD},{label:"Add",value:w.BLENDMODE_ADD},{label:"Multiply",value:w.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:w.BLENDMODE_MULTIPLYADD}]})],VR.prototype,"blendMode",void 0),(0,n.e)([iR("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],VR.prototype,"tl",void 0),(0,n.e)([iR("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VR.prototype,"emitRate",void 0),(0,n.e)([iR("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VR.prototype,"targetStopDuration",void 0),(0,n.e)([iR("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VR.prototype,"startDelay",void 0),(0,n.e)([iR("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],VR.prototype,"doNoStart",void 0),(0,F.f)("BABYLON.SystemBlock",VR);class BR extends MR{get type(){if(this._type===KR.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=KR.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=KR.Vector2,this._type;case"tR":return this._type=KR.tR,this._type;case"bF":return this._type=KR.bF,this._type;case"Matrix":return this._type=KR.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===kR.None&&this._systemSource!==CR.None}get systemSource(){return this._systemSource}set systemSource(h){if(this._systemSource=h,h!==CR.None){switch(this._contextualSource=kR.None,this._type=KR.Float,h){case CR.Time:case CR.Delta:this._type=KR.Float;break;case CR.Emitter:this._type=KR.tR}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==kR.None}get contextualValue(){return this._contextualSource}set contextualValue(h){if(this._contextualSource=h,h!==kR.None){switch(this._systemSource=CR.None,h){case kR.Scale:this._type=KR.Vector2;break;case kR.Position:case kR.Direction:case kR.ScaledDirection:this._type=KR.tR;break;case kR.Color:this._type=KR.bF;break;case kR.Age:case kR.Lifetime:case kR.Angle:case kR.AgeGradient:this._type=KR.Float;break;case kR.SpriteCellEnd:case kR.SpriteCellStart:case kR.SpriteCellIndex:this._type=KR.Int}this.output&&(this.output.type=this._type)}}constructor(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:KR.AutoDetect;super(h),this._type=KR.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new X.d,this._systemSource=CR.None,this._contextualSource=kR.None,this._type=R,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",R)}get value(){return this._storedValue}set value(h){this.type===KR.Float&&this.min!==this.max&&(h=Math.max(this.min,h),h=Math.min(this.max,h)),this._storedValue=h,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(h){this._valueCallback=h}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case KR.Int:case KR.Float:this.value=0;break;case KR.Vector2:this.value=j.Vector2.Zero();break;case KR.tR:this.value=j.tR.Zero();break;case KR.bF:this.value=new U.bF(1,1,1,1);break;case KR.Matrix:this.value=j.Matrix.Identity()}}_build(h){super._build(h),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=h=>h.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=h=>h.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const h=super.serialize();return h.type=this.type,h.contextualValue=this.contextualValue,h.systemSource=this.systemSource,h.min=this.min,h.max=this.max,h.groupInInspector=this.groupInInspector,h.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.sF?(h.valueType="BABYLON."+this._storedValue.getClassName(),h.value=this._storedValue.sF()):(h.valueType="number",h.value=this._storedValue)),h}_deserialize(h){if(super._deserialize(h),this._type=h.type,this.contextualValue=h.contextualValue,this.systemSource=h.systemSource||CR.None,this.min=h.min||0,this.max=h.max||0,this.groupInInspector=h.groupInInspector||"",void 0!==h.displayInInspector&&(this.displayInInspector=h.displayInInspector),h.valueType)if("number"===h.valueType)this._storedValue=h.value;else{const R=(0,F.e)(h.valueType);R&&(this._storedValue=R.GR(h.value))}}}(0,F.f)("BABYLON.ParticleInputBlock",BR);class NR extends MR{get url(){return this._url}set url(h){this._url!==h&&(this._cachedData=null,this._url=h,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(h){this._textureDataUrl!==h&&(this._cachedData=null,this._textureDataUrl=h,this._url="",this._sourceTexture=null)}set sourceTexture(h){this._sourceTexture!==h&&(this._cachedData=null,this._sourceTexture=h,this._url="",this._textureDataUrl="")}constructor(h){super(h),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",KR.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const h=this.texture._storedValue;return await new Promise(((R,l)=>{if(!h.isReady())return void h.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),R(this._cachedData)}catch(h){l(h)}}));const j=h.getSize();nR.g.GetTextureDataAsync(h,j.width,j.height).then((l=>{this._cachedData={width:j.width,height:j.height,data:new Uint8ClampedArray(l)},h.dispose(),R(this._cachedData)})).catch(l)}))}_build(h){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new z.b(this._textureDataUrl,h.TR):this.texture._storedValue=new z.b(this._url,h.TR):this.texture._storedValue=null}serialize(){const h=super.serialize();return h.url=this.url,h.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(h.textureDataUrl=this.textureDataUrl),h}_deserialize(h){super._deserialize(h),this.url=h.url,this.serializedCachedData=!!h.serializedCachedData,h.textureDataUrl&&(this.textureDataUrl=h.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,F.f)("BABYLON.ParticleTextureSourceBlock",NR);class hl extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerInput("position",KR.tR),this.registerOutput("output",KR.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(h){const R=this.particle.getConnectedValue(h);if(this.output._storedValue=R,!this.position.isConnected)return;const l={process:l=>{h.particleContext=l,h.systemContext=R,l.position.D(this.position.getConnectedValue(h))},previousItem:null,nextItem:null};R._updateQueueStart?Ch(l,R._updateQueueStart):R._updateQueueStart=l}}(0,F.f)("BABYLON.UpdatePositionBlock",hl),function(h){h[h.Add=0]="Add",h[h.Subtract=1]="Subtract",h[h.Multiply=2]="Multiply",h[h.Divide=3]="Divide",h[h.Max=4]="Max",h[h.Min=5]="Min"}(AR||(AR={}));class Rl extends MR{constructor(h){super(h),this.operation=AR.Add,this.registerInput("left",KR.AutoDetect),this.registerInput("right",KR.AutoDetect),this.registerOutput("output",KR.BasedOnInput),this.output._typeConnectionSource=this.left;const R=[KR.Matrix,KR.Particle,KR.Texture,KR.System,KR.FloatGradient,KR.Color4Gradient,KR.Vector2Gradient,KR.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...R),this.right.excludedConnectionPointTypes.push(...R),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(h){let R;const l=this.left,a=this.right;if(!l.isConnected||!a.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const D=l.type===KR.Float||l.type===KR.Int,F=a.type===KR.Float||a.type===KR.Int,w=D&&F;switch(this.operation){case AR.Add:R=w?h=>l.getConnectedValue(h)+a.getConnectedValue(h):D?h=>h.adapt(l,a.type).add(a.getConnectedValue(h)):h=>l.getConnectedValue(h).add(h.adapt(a,l.type));break;case AR.Subtract:R=w?h=>l.getConnectedValue(h)-a.getConnectedValue(h):D?h=>h.adapt(l,a.type).fR(a.getConnectedValue(h)):h=>l.getConnectedValue(h).fR(h.adapt(a,l.type));break;case AR.Multiply:R=w?h=>l.getConnectedValue(h)*a.getConnectedValue(h):D?h=>h.adapt(l,a.type).multiply(a.getConnectedValue(h)):h=>l.getConnectedValue(h).multiply(h.adapt(a,l.type));break;case AR.Divide:R=w?h=>l.getConnectedValue(h)/a.getConnectedValue(h):D?h=>h.adapt(l,a.type).divide(a.getConnectedValue(h)):h=>l.getConnectedValue(h).divide(h.adapt(a,l.type));break;case AR.Min:if(w)R=h=>Math.min(l.getConnectedValue(h),a.getConnectedValue(h));else{const[h,F]=D?[a,l]:[l,a];switch(h.type){case KR.Vector2:R=R=>j.Vector2.Minimize(h.getConnectedValue(R),R.adapt(F,h.type));break;case KR.tR:R=R=>j.tR.Minimize(h.getConnectedValue(R),R.adapt(F,h.type));break;case KR.bF:R=R=>{const l=h.getConnectedValue(R),{r:j,g:a,b:D,a:w}=R.adapt(F,h.type);return new U.bF(Math.min(l.r,j),Math.min(l.g,a),Math.min(l.b,D),Math.min(l.a,w))}}}break;case AR.Max:if(!w){const[h,F]=D?[a,l]:[l,a];switch(h.type){case KR.Vector2:R=R=>j.Vector2.Maximize(h.getConnectedValue(R),R.adapt(F,h.type));break;case KR.tR:R=R=>j.tR.Maximize(h.getConnectedValue(R),R.adapt(F,h.type));break;case KR.bF:R=R=>{const l=h.getConnectedValue(R),{r:j,g:a,b:D,a:w}=R.adapt(F,h.type);return new U.bF(Math.max(l.r,j),Math.min(l.g,a),Math.min(l.b,D),Math.min(l.a,w))}}break}R=h=>Math.max(l.getConnectedValue(h),a.getConnectedValue(h))}this.output._storedFunction=h=>l.type===KR.Int?0|R(h):R(h)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===KR.Int||this.left.type===KR.Float&&this.right.type!==KR.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[h,R]of[[this.left,this.right],[this.right,this.left]])h.acceptedConnectionPointTypes=[KR.Int,KR.Float],R.isConnected&&(h.acceptedConnectionPointTypes.push(R.type),R.type!==KR.Int&&R.type!==KR.Float||h.acceptedConnectionPointTypes.push(KR.Vector2,KR.tR,KR.bF))}dispose(){super.dispose();for(const h of this._connectionObservers)h.remove();this._connectionObservers.length=0}serialize(){const h=super.serialize();return h.operation=this.operation,h}_deserialize(h){super._deserialize(h),this.operation=h.operation}}(0,n.e)([iR("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:AR.Add},{label:"Subtract",value:AR.Subtract},{label:"Multiply",value:AR.Multiply},{label:"Divide",value:AR.Divide},{label:"Max",value:AR.Max},{label:"Min",value:AR.Min}]})],Rl.prototype,"operation",void 0),(0,F.f)("BABYLON.ParticleMathBlock",Rl);class ll extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerInput("direction1",KR.tR,!0,new j.tR(0,1,0)),this.registerInput("direction2",KR.tR,!0,new j.tR(0,1,0)),this.registerInput("minEmitBox",KR.tR,!0,new j.tR(-.5,-.5,-.5)),this.registerInput("maxEmitBox",KR.tR,!0,new j.tR(.5,.5,.5)),this.registerOutput("output",KR.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(h){const R=this.particle.getConnectedValue(h);R._directionCreation.process=l=>{h.particleContext=l,h.systemContext=R;const a=this.direction1.getConnectedValue(h),D=this.direction2.getConnectedValue(h),U=(0,mh.RandomRange)(a.x,D.x),F=(0,mh.RandomRange)(a.y,D.y),w=(0,mh.RandomRange)(a.z,D.z);h.isEmitterTransformNode?j.tR.TransformNormalFromFloatsToRef(U,F,w,h.emitterWorldMatrix,l.direction):l.direction.OF(U,F,w)},R._positionCreation.process=l=>{h.particleContext=l,h.systemContext=R;const a=this.minEmitBox.getConnectedValue(h),D=this.maxEmitBox.getConnectedValue(h),U=(0,mh.RandomRange)(a.x,D.x),F=(0,mh.RandomRange)(a.y,D.y),w=(0,mh.RandomRange)(a.z,D.z);h.isEmitterTransformNode?j.tR.TransformCoordinatesFromFloatsToRef(U,F,w,h.emitterWorldMatrix,l.position):(l.position.OF(U,F,w),l.position.addInPlace(h.emitterPosition))},this.output._storedValue=R}}(0,F.f)("BABYLON.BoxShapeBlock",ll);class jl extends MR{constructor(h){super(h),this.registerInput("emitPower",KR.Float,!0,1),this.registerInput("lifeTime",KR.Float,!0,1),this.registerInput("color",KR.bF,!0,new U.bF(1,1,1,1)),this.registerInput("scale",KR.Vector2,!0,new j.Vector2(1,1)),this.registerInput("angle",KR.Float,!0,0),this.registerOutput("particle",KR.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(h){const R=new FR(this.name,h.tl,h.TR,null,!1,void 0,!0);R.particleEmitterType=new t,R._lifeTimeCreation.process=(R,l)=>{h.particleContext=R,R.lifeTime=this.lifeTime.getConnectedValue(h),l._emitPower=this.emitPower.getConnectedValue(h)},R._colorCreation.process=R=>{h.particleContext=R,R.color.D(this.color.getConnectedValue(h))},R._sizeCreation.process=R=>{h.particleContext=R,R.size=1,R.scale.D(this.scale.getConnectedValue(h))},R._angleCreation.process=R=>{h.particleContext=R,R.angle=this.angle.getConnectedValue(h)},this.particle._storedValue=R}}(0,F.f)("BABYLON.CreateParticleBlock",jl);class al{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const h=[];for(const R of this.attachedBlocks)R.isInput&&h.push(R);return h}constructor(h){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new X.d,this.name=h}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(h){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(h)&&this.attachedBlocks.push(h);for(const l of h.inputs){const j=l.connectedPoint;if(j){const l=j.ownerBlock;l!==h&&this._initializeBlock(l,R)}}}async buildAsync(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((l=>{const j=new pR;for(const h of this._systemBlocks)this._initializeBlock(h);for(const a of this.systemBlocks){const l=new dR;l.buildId=this._buildId++,l.TR=h,l.verbose=R;const D=a.createSystem(l);l.emitErrors(),j.systems.push(D)}this.onBuildObservable.notifyObservers(this),l(j)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const h=new VR("Particle system"),R=new hl("Update position");R.output.connectTo(h.particle);const l=new BR("Position");l.contextualValue=kR.Position;const j=new BR("Scaled direction");j.contextualValue=kR.ScaledDirection;const a=new Rl("Add");a.operation=AR.Add,l.output.connectTo(a.left),j.output.connectTo(a.right),a.output.connectTo(R.position);const D=new jl("Create particle"),U=new ll("Box shape");D.particle.connectTo(U.particle),U.output.connectTo(R.particle);const F=new NR("Texture");F.texture.connectTo(h.texture),F.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(h)}removeBlock(h){const R=this.attachedBlocks.indexOf(h);if(R>-1&&this.attachedBlocks.splice(R,1),h.isSystem){const R=this._systemBlocks.indexOf(h);R>-1&&this._systemBlocks.splice(R,1)}}parseSerializedObject(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R||this.clear();const l={};for(const j of h.Gu){const h=(0,F.e)(j.customType);if(h){const R=new h;R._deserialize(j),l[j.id]=R,this.attachedBlocks.push(R),R.isSystem&&this._systemBlocks.push(R)}}for(const j of this.attachedBlocks)if(j.isTeleportOut){const h=j,R=h._tempEntryPointUniqueId;if(R){const j=l[R];j&&j.attachToEndpoint(h)}}for(let j=0;j<h.Gu.length;j++){const a=h.Gu[j],D=l[a.id];D&&(D.inputs.length&&a.inputs.some((h=>h.targetConnectionName))&&!R||this._restoreConnections(D,h,l))}if(h.locations||h.editorData&&h.editorData.locations){const j=h.locations||h.editorData.locations;for(const h of j)l[h.el]&&(h.el=l[h.el].uniqueId);R&&this.editorData&&this.editorData.locations&&j.concat(this.editorData.locations),h.locations?this.editorData={locations:j}:(this.editorData=h.editorData,this.editorData.locations=j);const a=[];for(const h in l)a[h]=l[h].uniqueId;this.editorData.map=a}this.comment=h.comment}_restoreConnections(h,R,l){for(const j of h.outputs)for(const a of R.Gu){const D=l[a.id];if(D)for(const U of a.inputs)if(l[U.targetBlockId]!==h||U.targetConnectionName!==j.name);else{const h=D.getInputByName(U.inputName);if(!h||h.isConnected)continue;j.connectTo(h,!0),this._restoreConnections(D,R,l)}}}serialize(h){const R=h?{}:P.c.Serialize(this);R.editorData=JSON.parse(JSON.stringify(this.editorData));let l=[];h?l=h:R.customType="BABYLON.NodeParticleSystemSet",R.Gu=[];for(const j of l)R.Gu.push(j.serialize());if(!h)for(const j of this.attachedBlocks)-1===l.indexOf(j)&&R.Gu.push(j.serialize());return R}dispose(){for(const h of this.attachedBlocks)h.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(h){const R=new al(h);return R.setToDefault(),R}static Parse(h){const R=P.c.Parse((()=>new al(h.name)),h,null);return R.parseSerializedObject(h),R}static ParseFromSnippetAsync(h,R){return"_BLANK"===h?Promise.resolve(al.CreateDefault("blank")):new Promise(((l,j)=>{const a=new OR.b;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const U=JSON.parse(JSON.parse(a.responseText).jsonPayload),F=JSON.parse(U.nodeParticle);R||(R=P.c.Parse((()=>new al(h)),F,null)),R.parseSerializedObject(F),R.snippetId=h;try{l(R)}catch(D){j(D)}}else j("Unable to load the snippet "+h)})),a.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),a.send()}))}}al.EditorURL=`${ER.Tools._DefaultCdnUrl}/v${ih.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,al.SnippetUrl="https://snippet.babylonjs.com",(0,n.e)([(0,r.G)()],al.prototype,"name",void 0),(0,n.e)([(0,r.G)("comment")],al.prototype,"comment",void 0),function(h){h[h.None=0]="None",h[h.PerParticle=1]="PerParticle",h[h.PerSystem=2]="PerSystem"}(eR||(eR={}));class Dl extends MR{constructor(h){super(h),this._currentLockId=-2,this.lockMode=eR.PerParticle,this.registerInput("min",KR.AutoDetect,!0,0),this.registerInput("max",KR.AutoDetect,!0,1),this.registerOutput("output",KR.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(KR.Float|KR.Int|KR.Vector2|KR.tR|KR.bF),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(KR.Float|KR.Int|KR.Vector2|KR.tR|KR.bF),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=KR.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let h=null;switch(this._currentLockId=-2,this.min.type){case KR.AutoDetect:case KR.Int:case KR.Float:h=h=>{const R=this.min.getConnectedValue(h)||0,l=this.max.getConnectedValue(h)||1;return R+Math.random()*(l-R)};break;case KR.Vector2:h=h=>{const R=this.min.getConnectedValue(h)||j.Vector2.Zero(),l=this.max.getConnectedValue(h)||j.Vector2.One();return new j.Vector2(R.x+Math.random()*(l.x-R.x),R.y+Math.random()*(l.y-R.y))};break;case KR.tR:h=h=>{const R=this.min.getConnectedValue(h)||j.tR.Zero(),l=this.max.getConnectedValue(h)||j.tR.One();return new j.tR(R.x+Math.random()*(l.x-R.x),R.y+Math.random()*(l.y-R.y),R.z+Math.random()*(l.z-R.z))};break;case KR.bF:h=h=>{const R=this.min.getConnectedValue(h)||new U.bF(0,0,0,0),l=this.max.getConnectedValue(h)||new U.bF(1,1,1,1);return new U.bF(R.x+Math.random()*(l.x-R.x),R.y+Math.random()*(l.y-R.y),R.z+Math.random()*(l.z-R.z),R.w+Math.random()*(l.w-R.w))}}this.output._storedFunction=R=>{var l;let j=0;switch(this.lockMode){case eR.PerParticle:j=(null===(l=R.particleContext)||void 0===l?void 0:l.id)||-1;break;case eR.PerSystem:j=R.buildId||0}return this._currentLockId!==j&&(this.lockMode!==eR.None&&(this._currentLockId=j),this.output._storedValue=h(R)),this.output._storedValue}}serialize(){const h=super.serialize();return h.lockMode=this.lockMode,h}_deserialize(h){super._deserialize(h),this.lockMode=h.lockMode}}(0,n.e)([iR("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:eR.None},{label:"Per particle",value:eR.PerParticle},{label:"Per system",value:eR.PerSystem}]})],Dl.prototype,"lockMode",void 0),(0,F.f)("BABYLON.ParticleRandomBlock",Dl);class Ul extends MR{constructor(h){super(h),this._currentLockId=-2,this.lockMode=eR.PerParticle,this.registerInput("min",KR.AutoDetect),this.registerInput("max",KR.AutoDetect),this.registerOutput("output",KR.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const R=[KR.Matrix,KR.Particle,KR.Texture,KR.System,KR.FloatGradient,KR.Color4Gradient,KR.Vector2Gradient,KR.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...R),this.max.excludedConnectionPointTypes.push(...R)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let h=null;switch(this._currentLockId=-2,this.min.type){case KR.Float:case KR.Int:h=h=>{const R=this.min.getConnectedValue(h),l=this.max.getConnectedValue(h);return Math.random()*(l-R)+R};break;case KR.Vector2:h=h=>{const R=this.min.getConnectedValue(h),l=this.max.getConnectedValue(h);return new j.Vector2(Math.random()*(l.x-R.x)+R.x,Math.random()*(l.y-R.y)+R.y)};break;case KR.tR:h=h=>{const R=this.min.getConnectedValue(h),l=this.max.getConnectedValue(h);return new j.tR(Math.random()*(l.x-R.x)+R.x,Math.random()*(l.y-R.y)+R.y,Math.random()*(l.z-R.z)+R.z)};break;case KR.bF:h=h=>{const R=this.min.getConnectedValue(h),l=this.max.getConnectedValue(h);return new U.bF(Math.random()*(l.r-R.r)+R.r,Math.random()*(l.g-R.g)+R.g,Math.random()*(l.b-R.b)+R.b,Math.random()*(l.a-R.a)+R.a)}}this.output._storedFunction=R=>{var l;let j=0;switch(this.lockMode){case eR.PerParticle:j=(null===(l=R.particleContext)||void 0===l?void 0:l.id)||-1;break;case eR.PerSystem:j=R.buildId||0}return this._currentLockId!==j&&(this.lockMode!==eR.None&&(this._currentLockId=j),this.output._storedValue=h(R)),this.output._storedValue}}serialize(){const h=super.serialize();return h.lockMode=this.lockMode,h}_deserialize(h){super._deserialize(h),void 0!==h.lockMode&&(this.lockMode=h.lockMode)}}(0,n.e)([iR("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:eR.None},{label:"Per particle",value:eR.PerParticle},{label:"Per system",value:eR.PerSystem}]})],Ul.prototype,"lockMode",void 0),(0,F.f)("BABYLON.RandomRangeBlock",Ul);(0,F.f)("BABYLON.ParticleLerpBlock",class extends MR{constructor(h){super(h),this.registerInput("left",KR.AutoDetect),this.registerInput("right",KR.AutoDetect),this.registerInput("gradient",KR.Float,!0,0,0,1),this.registerOutput("output",KR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(KR.Float|KR.Int|KR.Vector2|KR.tR|KR.bF)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const h=(h,R,l)=>(1-h)*R+h*l;this.output._storedFunction=R=>{const l=this.left.getConnectedValue(R),a=this.right.getConnectedValue(R),D=this.gradient.getConnectedValue(R);switch(this.left.type){case KR.Int:case KR.Float:return h(D,l,a);case KR.Vector2:return new j.Vector2(h(D,l.x,a.x),h(D,l.y,a.y));case KR.tR:return new j.tR(h(D,l.x,a.x),h(D,l.y,a.y),h(D,l.z,a.z));case KR.bF:return new U.bF(h(D,l.r,a.r),h(D,l.g,a.g),h(D,l.b,a.b),h(D,l.a,a.a))}return 0}}});(0,F.f)("BABYLON.UpdateDirectionBlock",class extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerInput("direction",KR.tR),this.registerOutput("output",KR.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(h){const R=this.particle.getConnectedValue(h);if(this.output._storedValue=R,!this.direction.isConnected)return;const l={process:l=>{h.particleContext=l,h.systemContext=R,l.direction.D(this.direction.getConnectedValue(h))},previousItem:null,nextItem:null};R._updateQueueStart?Ch(l,R._updateQueueStart):R._updateQueueStart=l}});(0,F.f)("BABYLON.UpdateColorBlock",class extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerInput("color",KR.bF),this.registerOutput("output",KR.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(h){const R=this.particle.getConnectedValue(h);if(this.output._storedValue=R,!this.color.isConnected)return;const l={process:l=>{h.particleContext=l,h.systemContext=R,l.color.D(this.color.getConnectedValue(h))},previousItem:null,nextItem:null};R._updateQueueStart?Ch(l,R._updateQueueStart):R._updateQueueStart=l}});(0,F.f)("BABYLON.UpdateScaleBlock",class extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerInput("scale",KR.Vector2),this.registerOutput("output",KR.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(h){const R=this.particle.getConnectedValue(h);if(this.output._storedValue=R,!this.scale.isConnected)return;const l={process:l=>{h.particleContext=l,h.systemContext=R,l.scale.D(this.scale.getConnectedValue(h))},previousItem:null,nextItem:null};R._updateQueueStart?Ch(l,R._updateQueueStart):R._updateQueueStart=l}});(0,F.f)("BABYLON.UpdateAngleBlock",class extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerInput("angle",KR.Float),this.registerOutput("output",KR.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(h){const R=this.particle.getConnectedValue(h);if(this.output._storedValue=R,!this.angle.isConnected)return;const l={process:l=>{h.particleContext=l,h.systemContext=R,l.angle=this.angle.getConnectedValue(h)},previousItem:null,nextItem:null};R._updateQueueStart?Ch(l,R._updateQueueStart):R._updateQueueStart=l}});(0,F.f)("BABYLON.BasicPositionUpdateBlock",class extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerOutput("output",KR.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(h){const R=this.particle.getConnectedValue(h),l={process:l=>{h.particleContext=l,h.systemContext=R,l.direction.scaleToRef(R._directionScale,R._scaledDirection),l.position.addInPlace(R._scaledDirection)},previousItem:null,nextItem:null};R._updateQueueStart?Ch(l,R._updateQueueStart):R._updateQueueStart=l,this.output._storedValue=R}});(0,F.f)("BABYLON.BasicSpriteUpdateBlock",class extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerOutput("output",KR.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(h){const R=this.particle.getConnectedValue(h),l={process:l=>{h.particleContext=l,h.systemContext=R,l.updateCellIndex()},previousItem:null,nextItem:null};R._updateQueueStart?Ch(l,R._updateQueueStart):R._updateQueueStart=l,this.output._storedValue=R}});(0,F.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerInput("cellIndex",KR.Int),this.registerOutput("output",KR.Particle),this.cellIndex.acceptedConnectionPointTypes=[KR.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(h){const R=this.particle.getConnectedValue(h);if(this.output._storedValue=R,!this.cellIndex.isConnected)return;const l={process:l=>{h.particleContext=l,h.systemContext=R,l.cellIndex=Math.floor(this.cellIndex.getConnectedValue(h))},previousItem:null,nextItem:null};R._updateQueueStart?Ch(l,R._updateQueueStart):R._updateQueueStart=l}});class Fl extends MR{constructor(h){super(h),this.strength=1,this.registerInput("particle",KR.Particle),this.registerInput("flowMap",KR.Texture),this.registerOutput("output",KR.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(h){var R;const l=this.particle.getConnectedValue(h),j=h.TR;let a;(null===(R=this.flowMap.connectedPoint)||void 0===R?void 0:R.ownerBlock).extractTextureContentAsync().then((h=>{h&&(a=new oR(h.width,h.height,h.data))}));const D={process:h=>{const R=j.getTransformMatrix();a&&a._processParticle(h,this.strength*l._tempScaledUpdateSpeed,R)},previousItem:null,nextItem:null};l._updateQueueStart?Ch(D,l._updateQueueStart):l._updateQueueStart=D,this.output._storedValue=l}serialize(){const h=super.serialize();return h.strength=this.strength,h}_deserialize(h){super._deserialize(h),this.strength=h.strength}}(0,n.e)([iR("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fl.prototype,"strength",void 0),(0,F.f)("BABYLON.UpdateFlowMapBlock",Fl);(0,F.f)("BABYLON.SphereShapeBlock",class extends MR{constructor(h){super(h),this.registerInput("input",KR.Particle),this.registerInput("radius",KR.Float,!0,1),this.registerInput("radiusRange",KR.Float,!0,1,0,1),this.registerInput("directionRandomizer",KR.Float,!0,0,0,1),this.registerOutput("output",KR.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(h){const R=this.input.getConnectedValue(h);R._directionCreation.process=l=>{h.particleContext=l,h.systemContext=R;const a=this.directionRandomizer.getConnectedValue(h),D=l.position.fR(h.emitterPosition).normalize(),U=(0,mh.RandomRange)(0,a),F=(0,mh.RandomRange)(0,a),w=(0,mh.RandomRange)(0,a);D.x+=U,D.y+=F,D.z+=w,D.normalize(),h.isEmitterTransformNode?j.tR.TransformNormalFromFloatsToRef(U,F,w,h.emitterWorldMatrix,l.direction):l.direction.OF(U,F,w)},R._positionCreation.process=l=>{h.particleContext=l,h.systemContext=R;const a=this.radius.getConnectedValue(h),D=this.radiusRange.getConnectedValue(h),U=a-(0,mh.RandomRange)(0,a*D),F=(0,mh.RandomRange)(0,1),w=(0,mh.RandomRange)(0,2*Math.PI),u=Math.acos(2*F-1),c=U*Math.cos(w)*Math.sin(u),J=U*Math.cos(u),q=U*Math.sin(w)*Math.sin(u);h.isEmitterTransformNode?j.tR.TransformCoordinatesFromFloatsToRef(c,J,q,h.emitterWorldMatrix,l.position):(l.position.OF(c,J,q),l.position.addInPlace(h.emitterPosition))},this.output._storedValue=R}});(0,F.f)("BABYLON.PointShapeBlock",class extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerInput("direction1",KR.tR,!0,new j.tR(0,1,0)),this.registerInput("direction2",KR.tR,!0,new j.tR(0,1,0)),this.registerOutput("output",KR.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){const R=this.particle.getConnectedValue(h);R._directionCreation.process=l=>{h.particleContext=l,h.systemContext=R;const a=this.direction1.getConnectedValue(h),D=this.direction2.getConnectedValue(h),U=(0,mh.RandomRange)(a.x,D.x),F=(0,mh.RandomRange)(a.y,D.y),w=(0,mh.RandomRange)(a.z,D.z);h.isEmitterTransformNode?j.tR.TransformNormalFromFloatsToRef(U,F,w,h.emitterWorldMatrix,l.direction):l.direction.OF(U,F,w)},R._positionCreation.process=l=>{h.systemContext=R,h.isEmitterTransformNode?j.tR.TransformCoordinatesFromFloatsToRef(0,0,0,h.emitterWorldMatrix,l.position):l.position.D(h.emitterPosition)},this.output._storedValue=R}});(0,F.f)("BABYLON.CustomShapeBlock",class extends MR{constructor(h){super(h),this.registerInput("particle",KR.Particle),this.registerInput("position",KR.tR,!0,new j.tR(0,0,0)),this.registerInput("direction",KR.tR,!0,new j.tR(0,1,0)),this.registerOutput("output",KR.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){const R=this.particle.getConnectedValue(h);R._directionCreation.process=l=>{h.particleContext=l,h.systemContext=R;const a=this.direction.getConnectedValue(h);h.isEmitterTransformNode?j.tR.TransformNormalToRef(a,h.emitterWorldMatrix,l.direction):l.direction.D(a)},R._positionCreation.process=l=>{h.particleContext=l,h.systemContext=R;const a=this.position.getConnectedValue(h);h.isEmitterTransformNode?j.tR.TransformCoordinatesToRef(a,h.emitterWorldMatrix,l.position):(l.position.D(a),l.position.addInPlace(h.emitterPosition))},this.output._storedValue=R}});(0,F.f)("BABYLON.CylinderShapeBlock",class extends MR{constructor(h){super(h),this._tempVector=j.tR.Zero(),this.registerInput("particle",KR.Particle),this.registerInput("radius",KR.Float,!0,1),this.registerInput("height",KR.Float,!0,1,0),this.registerInput("radiusRange",KR.Float,!0,1,0,1),this.registerInput("directionRandomizer",KR.Float,!0,0,0,1),this.registerOutput("output",KR.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(h){const R=this.particle.getConnectedValue(h);R._directionCreation.process=l=>{h.particleContext=l,h.systemContext=R;const a=this.directionRandomizer.getConnectedValue(h);l.position.subtractToRef(h.emitterPosition,this._tempVector),this._tempVector.normalize(),h.isEmitterTransformNode&&j.tR.TransformNormalToRef(this._tempVector,h.emitterInverseWorldMatrix,this._tempVector);const D=(0,mh.RandomRange)(-a/2,a/2);let U=Math.atan2(this._tempVector.x,this._tempVector.z);U+=(0,mh.RandomRange)(-Math.PI/2,Math.PI/2)*a,this._tempVector.y=D,this._tempVector.x=Math.sin(U),this._tempVector.z=Math.cos(U),this._tempVector.normalize(),h.isEmitterTransformNode?j.tR.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,h.emitterWorldMatrix,l.direction):l.direction.D(this._tempVector)},R._positionCreation.process=l=>{h.particleContext=l,h.systemContext=R;const a=this.height.getConnectedValue(h),D=this.radiusRange.getConnectedValue(h),U=this.radius.getConnectedValue(h),F=(0,mh.RandomRange)(-a/2,a/2),w=(0,mh.RandomRange)(0,2*Math.PI),u=(0,mh.RandomRange)((1-D)*(1-D),1),c=Math.sqrt(u)*U,J=c*Math.cos(w),q=c*Math.sin(w);h.isEmitterTransformNode?j.tR.TransformCoordinatesFromFloatsToRef(J,F,q,h.emitterWorldMatrix,l.position):(l.position.OF(J,F,q),l.position.addInPlace(h.emitterPosition))},this.output._storedValue=R}});class wl extends MR{constructor(h){super(h),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",KR.Particle),this.registerOutput("output",KR.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);const R=this.particle.getConnectedValue(h);R._isAnimationSheetEnabled=!0,R.spriteCellWidth=this.width,R.spriteCellHeight=this.height,R.startSpriteCellID=this.start,R.endSpriteCellID=this.end,R.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=R}serialize(){const h=super.serialize();return h.width=this.width,h.height=this.height,h.start=this.start,h.end=this.end,h.randomStartCell=this.randomStartCell,h}_deserialize(h){super._deserialize(h),this.width=h.width,this.height=h.height,this.start=h.start,this.end=h.end,this.randomStartCell=h.randomStartCell}}(0,n.e)([iR("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wl.prototype,"start",void 0),(0,n.e)([iR("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wl.prototype,"end",void 0),(0,n.e)([iR("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wl.prototype,"width",void 0),(0,n.e)([iR("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wl.prototype,"height",void 0),(0,n.e)([iR("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wl.prototype,"loop",void 0),(0,n.e)([iR("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wl.prototype,"randomStartCell",void 0),(0,F.f)("BABYLON.SetupSpriteSheetBlock",wl);class mj extends MR{constructor(h){super(h),this.reference=0,this.registerInput("value",KR.AutoDetect),this.registerOutput("output",KR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=h=>{switch(h){case KR.Float:return KR.FloatGradient;case KR.Vector2:return KR.Vector2Gradient;case KR.tR:return KR.Vector3Gradient;case KR.bF:return KR.Color4Gradient}return h},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(KR.Float|KR.Vector2|KR.tR|KR.bF)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=h=>null}serialize(){const h=super.serialize();return h.reference=this.reference,h}_deserialize(h){super._deserialize(h),this.reference=h.reference}}(0,n.e)([iR("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],mj.prototype,"reference",void 0),(0,F.f)("BABYLON.ParticleGradientValueBlock",mj);(0,F.f)("BABYLON.ParticleGradientBlock",class extends MR{constructor(h){super(h),this._entryCount=1,this.registerInput("gradient",KR.Float,!0,1,0,1),this.registerInput("value0",KR.AutoDetect),this.registerOutput("output",KR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=h=>{switch(h){case KR.FloatGradient:return KR.Float;case KR.Vector2Gradient:return KR.Vector2;case KR.Vector3Gradient:return KR.tR;case KR.Color4Gradient:return KR.bF}return h},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(KR.FloatGradient|KR.Vector2Gradient|KR.Vector3Gradient|KR.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(h){this._inputs[h].onConnectionObservable.add((()=>{this._entryCount>h||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),KR.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const h=[];for(let l=1;l<this._inputs.length;l++){var R;if(this._inputs[l].isConnected)h.push(null===(R=this._inputs[l].connectedPoint)||void 0===R?void 0:R.ownerBlock)}h.sort(((h,R)=>h.reference-R.reference)),this.output._storedFunction=R=>{const l=this.gradient.getConnectedValue(R);if(1===h.length)return h[0].value.getConnectedValue(R);let a=null;for(let D=h.length-1;D>=0;D--){const F=h[D];if(F.reference<=l){const h=F.value.getConnectedValue(R);if(a){const D=a.value.getConnectedValue(R),w=a.reference,u=F.reference,c=Math.max(0,Math.min(1,(l-u)/(w-u)));switch(this.output.type){case KR.Float:return(0,mh.Lerp)(h,D,c);case KR.Vector2:return j.Vector2.Lerp(h,D,c);case KR.tR:return j.tR.Lerp(h,D,c);case KR.bF:return U.bF.Lerp(h,D,c)}}return h}a=F}return 0}}});(0,F.f)("BABYLON.ParticleConverterBlock",class extends MR{constructor(h){super(h),this.registerInput("color ",KR.bF,!0),this.registerInput("xyz ",KR.tR,!0),this.registerInput("xy ",KR.Vector2,!0),this.registerInput("zw ",KR.Vector2,!0),this.registerInput("x ",KR.Float,!0),this.registerInput("y ",KR.Float,!0),this.registerInput("z ",KR.Float,!0),this.registerInput("w ",KR.Float,!0),this.registerOutput("color",KR.bF),this.registerOutput("xyz",KR.tR),this.registerOutput("xy",KR.Vector2),this.registerOutput("zw",KR.Vector2),this.registerOutput("x",KR.Float),this.registerOutput("y",KR.Float),this.registerOutput("z",KR.Float),this.registerOutput("w",KR.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(h){return"color "===h?"colorIn":"xyz "===h?"xyzIn":"xy "===h?"xyIn":"zw "===h?"zwIn":"x "===h?"xIn":"y "===h?"yIn":"z "===h?"zIn":"w "===h?"wIn":h}_outputRename(h){switch(h){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return h}}_build(h){super._build(h);const R=this.xIn,l=this.yIn,a=this.zIn,D=this.wIn,F=this.xyIn,w=this.zwIn,mh=this.xyzIn,u=this.colorIn,c=this.colorOut,J=this.xyzOut,q=this.xyOut,Q=this.zwOut,Y=this.xOut,s=this.yOut,t=this.zOut,f=this.wOut,T=h=>{if(u.isConnected)return u.getConnectedValue(h);let j=0,c=0,J=0,q=0;if(R.isConnected&&(j=R.getConnectedValue(h)),l.isConnected&&(c=l.getConnectedValue(h)),a.isConnected&&(J=a.getConnectedValue(h)),D.isConnected&&(q=D.getConnectedValue(h)),F.isConnected){const R=F.getConnectedValue(h);R&&(j=R.x,c=R.y)}if(w.isConnected){const R=w.getConnectedValue(h);R&&(J=R.x,q=R.y)}if(mh.isConnected){const R=mh.getConnectedValue(h);R&&(j=R.x,c=R.y,J=R.z)}return new U.bF(j,c,J,q)};c._storedFunction=h=>T(h),J._storedFunction=h=>{const R=T(h);return new j.tR(R.r,R.g,R.b)},q._storedFunction=h=>{const R=T(h);return new j.Vector2(R.r,R.g)},Q._storedFunction=h=>{const R=T(h);return new j.Vector2(R.b,R.a)},Y._storedFunction=h=>T(h).r,s._storedFunction=h=>T(h).g,t._storedFunction=h=>T(h).b,f._storedFunction=h=>T(h).a}}),function(h){h[h.Cos=0]="Cos",h[h.Sin=1]="Sin",h[h.Abs=2]="Abs",h[h.Exp=3]="Exp",h[h.Exp2=4]="Exp2",h[h.Round=5]="Round",h[h.Floor=6]="Floor",h[h.Ceiling=7]="Ceiling",h[h.Sqrt=8]="Sqrt",h[h.Log=9]="Log",h[h.Tan=10]="Tan",h[h.ArcTan=11]="ArcTan",h[h.ArcCos=12]="ArcCos",h[h.ArcSin=13]="ArcSin",h[h.Sign=14]="Sign",h[h.Negate=15]="Negate",h[h.OneMinus=16]="OneMinus",h[h.Reciprocal=17]="Reciprocal",h[h.ToDegrees=18]="ToDegrees",h[h.ToRadians=19]="ToRadians",h[h.Fract=20]="Fract"}(SR||(SR={}));class ul extends MR{constructor(h){super(h),this.operation=SR.Cos,this.registerInput("input",KR.AutoDetect),this.registerOutput("output",KR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(KR.Float|KR.Int|KR.Vector2|KR.tR|KR.bF)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);let R=null;switch(this.operation){case SR.Cos:R=h=>Math.cos(h);break;case SR.Sin:R=h=>Math.sin(h);break;case SR.Abs:R=h=>Math.abs(h);break;case SR.Exp:R=h=>Math.exp(h);break;case SR.Exp2:R=h=>Math.pow(2,h);break;case SR.Round:R=h=>Math.round(h);break;case SR.Floor:R=h=>Math.floor(h);break;case SR.Ceiling:R=h=>Math.ceil(h);break;case SR.Sqrt:R=h=>Math.sqrt(h);break;case SR.Log:R=h=>Math.log(h);break;case SR.Tan:R=h=>Math.tan(h);break;case SR.ArcTan:R=h=>Math.atan(h);break;case SR.ArcCos:R=h=>Math.acos(h);break;case SR.ArcSin:R=h=>Math.asin(h);break;case SR.Sign:R=h=>Math.sign(h);break;case SR.Negate:R=h=>-h;break;case SR.OneMinus:R=h=>1-h;break;case SR.Reciprocal:R=h=>1/h;break;case SR.ToRadians:R=h=>h*Math.PI/180;break;case SR.ToDegrees:R=h=>180*h/Math.PI;break;case SR.Fract:R=h=>h>=0?h-Math.floor(h):h-Math.ceil(h)}if(!R)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case KR.Int:case KR.Float:this.output._storedFunction=h=>{const l=this.input.getConnectedValue(h);return R(l)};break;case KR.Vector2:this.output._storedFunction=h=>{const l=this.input.getConnectedValue(h);return new j.Vector2(R(l.x),R(l.y))};break;case KR.tR:this.output._storedFunction=h=>{const l=this.input.getConnectedValue(h);return new j.tR(R(l.x),R(l.y),R(l.z))};break;case KR.bF:this.output._storedFunction=h=>{const l=this.input.getConnectedValue(h);return new U.bF(R(l.r),R(l.g),R(l.b),R(l.a))}}return this}serialize(){const h=super.serialize();return h.operation=this.operation,h}_deserialize(h){super._deserialize(h),this.operation=h.operation}}(0,n.e)([iR("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:SR.Cos},{label:"Sin",value:SR.Sin},{label:"Abs",value:SR.Abs},{label:"Exp",value:SR.Exp},{label:"Exp2",value:SR.Exp2},{label:"Round",value:SR.Round},{label:"Floor",value:SR.Floor},{label:"Ceiling",value:SR.Ceiling},{label:"Sqrt",value:SR.Sqrt},{label:"Log",value:SR.Log},{label:"Tan",value:SR.Tan},{label:"ArcTan",value:SR.ArcTan},{label:"ArcCos",value:SR.ArcCos},{label:"ArcSin",value:SR.ArcSin},{label:"Sign",value:SR.Sign},{label:"Negate",value:SR.Negate},{label:"OneMinus",value:SR.OneMinus},{label:"Reciprocal",value:SR.Reciprocal},{label:"ToDegrees",value:SR.ToDegrees},{label:"ToRadians",value:SR.ToRadians},{label:"Fract",value:SR.Fract}]})],ul.prototype,"operation",void 0),(0,F.f)("BABYLON.ParticleTrigonometryBlock",ul);var cl,Jl=l(14295);class ql extends MR{constructor(h){super(h),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",KR.AutoDetect),this.registerOutput("output",KR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(KR.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(KR.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(KR.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(KR.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(KR.System),this._inputs[0].excludedConnectionPointTypes.push(KR.Particle),this._inputs[0].excludedConnectionPointTypes.push(KR.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const R=h=>{const R=this.input.getConnectedValue(h);if(this.log.length>=this.stackSize)return R;if(null===R||void 0===R)return this.log.push(["null",""]),R;switch(this.input.type){case KR.Vector2:this.log.push([(0,Jl.j)(R,4),R.toString()]);break;case KR.tR:this.log.push([(0,Jl.m)(R,4),R.toString()]);break;case KR.bF:this.log.push([`{R: ${R.r.toFixed(4)} G: ${R.g.toFixed(4)} B: ${R.b.toFixed(4)} A: ${R.a.toFixed(4)}}`,R.toString()]);break;default:this.log.push([R.toString(),R.toString()])}return R};this.output.isConnected?this.output._storedFunction=R:this.output._storedValue=R(h)}serialize(){const h=super.serialize();return h.stackSize=this.stackSize,h}_deserialize(h){super._deserialize(h),this.stackSize=h.stackSize}}(0,n.e)([iR("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],ql.prototype,"stackSize",void 0),(0,F.f)("BABYLON.ParticleDebugBlock",ql);(0,F.f)("BABYLON.ParticleElbowBlock",class extends MR{constructor(h){super(h),this.registerInput("input",KR.AutoDetect),this.registerOutput("output",KR.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);const R=this._outputs[0],l=this._inputs[0];R._storedFunction=h=>l.getConnectedValue(h)}});(0,F.f)("BABYLON.ParticleTeleportInBlock",class extends MR{get endpoints(){return this._endpoints}constructor(h){super(h),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",KR.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(h){if(this.getClassName()===h)return!0;for(const R of this.endpoints)if(R.isAnAncestorOfType(h))return!0;return!1}isAnAncestorOf(h){for(const R of this.endpoints){if(R===h)return!0;if(R.isAnAncestorOf(h))return!0}return!1}attachToEndpoint(h){h.detach(),this._endpoints.push(h),h._entryPoint=this,h._outputs[0]._typeConnectionSource=this._inputs[0],h._tempEntryPointUniqueId=null,h.name="> "+this.name}detachFromEndpoint(h){const R=this._endpoints.indexOf(h);-1!==R&&(this._endpoints.splice(R,1),h._outputs[0]._typeConnectionSource=null,h._entryPoint=null)}_build(){for(const h of this._endpoints)h.output._storedFunction=h=>this.input.getConnectedValue(h)}});(0,F.f)("BABYLON.ParticleTeleportOutBlock",class extends MR{constructor(h){super(h),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",KR.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(h){this.entryPoint&&this.entryPoint.build(h)}clone(){const h=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(h),h}serialize(){var h;const R=super.serialize();return R.entryPoint=(null===(h=this.entryPoint)||void 0===h?void 0:h.uniqueId)??"",R}_deserialize(h){super._deserialize(h),this._tempEntryPointUniqueId=h.entryPoint}}),function(h){h[h.Equal=0]="Equal",h[h.NotEqual=1]="NotEqual",h[h.LessThan=2]="LessThan",h[h.GreaterThan=3]="GreaterThan",h[h.LessOrEqual=4]="LessOrEqual",h[h.GreaterOrEqual=5]="GreaterOrEqual",h[h.Xor=6]="Xor",h[h.Or=7]="Or",h[h.And=8]="And"}(cl||(cl={}));class Ql extends MR{constructor(h){super(h),this.test=cl.Equal,this.epsilon=0,this.registerInput("left",KR.Float),this.registerInput("right",KR.Float,!0,0),this.registerInput("ifTrue",KR.AutoDetect,!0,1),this.registerInput("ifFalse",KR.AutoDetect,!0,0),this.registerOutput("output",KR.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=KR.Float,this._inputs[0].acceptedConnectionPointTypes.push(KR.Int),this._inputs[1].acceptedConnectionPointTypes.push(KR.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const h=h=>{const R=this.left.getConnectedValue(h),l=this.right.getConnectedValue(h);let j=!1;switch(this.test){case cl.Equal:j=(0,mh.WithinEpsilon)(R,l,this.epsilon);break;case cl.NotEqual:j=!(0,mh.WithinEpsilon)(R,l,this.epsilon);break;case cl.LessThan:j=R<l+this.epsilon;break;case cl.GreaterThan:j=R>l-this.epsilon;break;case cl.LessOrEqual:j=R<=l+this.epsilon;break;case cl.GreaterOrEqual:j=R>=l-this.epsilon;break;case cl.Xor:j=!!R&&!l||!R&&!!l;break;case cl.Or:j=!!R||!!l;break;case cl.And:j=!!R&&!!l}return j};this.output._storedFunction=R=>h(R)?this.ifTrue.getConnectedValue(R):this.ifFalse.getConnectedValue(R)}serialize(){const h=super.serialize();return h.test=this.test,h.epsilon=this.epsilon,h}_deserialize(h){super._deserialize(h),this.test=h.test,void 0!==h.epsilon&&(this.epsilon=h.epsilon)}}(0,n.e)([iR("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:cl.Equal},{label:"NotEqual",value:cl.NotEqual},{label:"LessThan",value:cl.LessThan},{label:"GreaterThan",value:cl.GreaterThan},{label:"LessOrEqual",value:cl.LessOrEqual},{label:"GreaterOrEqual",value:cl.GreaterOrEqual},{label:"Xor",value:cl.Xor},{label:"Or",value:cl.Or},{label:"And",value:cl.And}]})],Ql.prototype,"test",void 0),(0,n.e)([iR("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ql.prototype,"epsilon",void 0),(0,F.f)("BABYLON.ParticleConditionBlock",Ql);class Yl extends MR{constructor(h){super(h),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",KR.Particle),this.registerInput("condition",KR.Float,!0,0),this.registerInput("system",KR.System),this.registerOutput("output",KR.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){this._triggerCount=0;const R=this.input.getConnectedValue(h),l={process:l=>{if(h.particleContext=l,h.systemContext=R,0!==this.condition.getConnectedValue(h)&&(0===this.limit||this._triggerCount<this.limit)){const j=(new Date).getTime();if(this._previousOne&&j-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=j;const a=this.system.getConnectedValue(h);if(a){const j=XR(a,h.TR,l.position);j.mw.addOnce((()=>{this._triggerCount--})),R.mw.addOnce((()=>{j.dispose()}))}}},previousItem:null,nextItem:null};R._updateQueueStart?Ch(l,R._updateQueueStart):R._updateQueueStart=l,this.output._storedValue=R}serialize(){const h=super.serialize();return h.limit=this.limit,h.delay=this.delay,h}_deserialize(h){super._deserialize(h),void 0!==h.limit&&(this.limit=h.limit),void 0!==h.delay&&(this.delay=h.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,n.e)([iR("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yl.prototype,"limit",void 0),(0,n.e)([iR("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yl.prototype,"delay",void 0),(0,F.f)("BABYLON.ParticleTriggerBlock",Yl);l(14298),l(14311),l(14326),l(14373)},14362:(h,R,l)=>{"use strict";var j=l(12808);const a="clipPlaneFragment",D="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14328:(h,R,l)=>{"use strict";var j=l(12808);const a="clipPlaneFragmentDeclaration",D="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14390:(h,R,l)=>{"use strict";var j=l(12808);const a="clipPlaneVertex",D="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14377:(h,R,l)=>{"use strict";var j=l(12808);const a="clipPlaneVertexDeclaration",D="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14371:(h,R,l)=>{"use strict";var j=l(12808);const a="fogFragment",D="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14360:(h,R,l)=>{"use strict";var j=l(12808);const a="fogFragmentDeclaration",D="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14399:(h,R,l)=>{"use strict";var j=l(12808);const a="fogVertex",D="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14383:(h,R,l)=>{"use strict";var j=l(12808);const a="fogVertexDeclaration",D="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14347:(h,R,l)=>{"use strict";var j=l(12808);const a="helperFunctions",D="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14332:(h,R,l)=>{"use strict";var j=l(12808);const a="imageProcessingDeclaration",D="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14354:(h,R,l)=>{"use strict";var j=l(12808);const a="imageProcessingFunctions",D="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14340:(h,R,l)=>{"use strict";var j=l(12808);const a="logDepthDeclaration",D="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14366:(h,R,l)=>{"use strict";var j=l(12808);const a="logDepthFragment",D="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14405:(h,R,l)=>{"use strict";var j=l(12808);const a="logDepthVertex",D="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";j.d.IncludesShadersStoreWGSL[a]||(j.d.IncludesShadersStoreWGSL[a]=D)},14326:(h,R,l)=>{"use strict";l.r(R),l.d(R,{particlesPixelShaderWGSL:()=>U});var j=l(12808);l(14328),l(14332),l(14340),l(14347),l(14354),l(14360),l(14362),l(14366),l(14371);const a="particlesPixelShader",D="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";j.d.ShadersStoreWGSL[a]||(j.d.ShadersStoreWGSL[a]=D);const U={name:a,shader:D}},14373:(h,R,l)=>{"use strict";l.r(R),l.d(R,{particlesVertexShaderWGSL:()=>U});var j=l(12808);l(14377),l(14383),l(14340),l(14390),l(14399),l(14405);const a="particlesVertexShader",D="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";j.d.ShadersStoreWGSL[a]||(j.d.ShadersStoreWGSL[a]=D);const U={name:a,shader:D}},14247:(h,R,l)=>{"use strict";var j=l(12808);const a="clipPlaneFragment",D="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14305:(h,R,l)=>{"use strict";var j=l(12808);const a="clipPlaneFragmentDeclaration",D="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14265:(h,R,l)=>{"use strict";var j=l(12808);const a="clipPlaneVertex",D="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14320:(h,R,l)=>{"use strict";var j=l(12808);const a="clipPlaneVertexDeclaration",D="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14254:(h,R,l)=>{"use strict";var j=l(12808);const a="fogFragment",D="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14245:(h,R,l)=>{"use strict";var j=l(12808);const a="fogFragmentDeclaration",D="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14268:(h,R,l)=>{"use strict";var j=l(12808);const a="fogVertex",D="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14261:(h,R,l)=>{"use strict";var j=l(12808);const a="fogVertexDeclaration",D="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14240:(h,R,l)=>{"use strict";var j=l(12808);const a="helperFunctions",D="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14228:(h,R,l)=>{"use strict";var j=l(12808);const a="imageProcessingDeclaration",D="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14242:(h,R,l)=>{"use strict";var j=l(12808);const a="imageProcessingFunctions",D="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14232:(h,R,l)=>{"use strict";var j=l(12808);const a="logDepthDeclaration",D="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14251:(h,R,l)=>{"use strict";var j=l(12808);const a="logDepthFragment",D="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14275:(h,R,l)=>{"use strict";var j=l(12808);const a="logDepthVertex",D="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";j.d.IncludesShadersStore[a]||(j.d.IncludesShadersStore[a]=D)},14298:(h,R,l)=>{"use strict";l.r(R),l.d(R,{particlesPixelShader:()=>U});var j=l(12808);l(14305),l(14228),l(14232),l(14240),l(14242),l(14245),l(14247),l(14251),l(14254);const a="particlesPixelShader",D="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";j.d.ShadersStore[a]||(j.d.ShadersStore[a]=D);const U={name:a,shader:D}},14311:(h,R,l)=>{"use strict";l.r(R),l.d(R,{particlesVertexShader:()=>U});var j=l(12808);l(14320),l(14261),l(14232),l(14265),l(14268),l(14275);const a="particlesVertexShader",D="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";j.d.ShadersStore[a]||(j.d.ShadersStore[a]=D);const U={name:a,shader:D}},14653:(h,R,l)=>{"use strict";l.r(R),l.d(R,{FlowGraphGLTFDataProvider:()=>D});var j=l(14620),a=l(14597);class D extends j.e{constructor(h){var R,l;super();const j=h.glTF,D=(null===(R=j.animations)||void 0===R?void 0:R.map((h=>h._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",a.c,D);const U=(null===(l=j.nodes)||void 0===l?void 0:l.map((h=>h._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",a.c,U)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14542:(h,R,l)=>{"use strict";l.d(R,{e:()=>s,f:()=>Q,j:()=>q,n:()=>Y});var j=l(12900),a=l(13350),D=l(12952),U=l(14547);const F=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class w{constructor(h,R){this._gltf=h,this._infoTree=R}convert(h){let R,l=this._gltf,j=this._infoTree;if(!h.startsWith("/"))throw new Error("Path must start with a /");const a=h.split("/");if(a.shift(),a[a.length-1].includes(".length")){const h=a[a.length-1].split(".");a.pop(),a.push(...h)}let D=!1;for(const w of a){const a="length"===w;if(a&&!j.__array__)throw new Error(`Path ${h} is invalid`);if(j.__ignoreObjectTree__&&(D=!0),j.__array__&&!a)j=j.__array__;else if(j=j[w],!j)throw new Error(`Path ${h} is invalid`);if(!D)if(void 0===l){if(!F.find((R=>R.regex.test(h))))throw new Error(`Path ${h} is invalid`)}else if(!a){var U;l=null===(U=l)||void 0===U?void 0:U[w]}(j.__target__||a)&&(R=l)}return{object:R,info:j}}}function mh(h,R,l,j){const a=u(h,R);return j?a[l][j]:a[l]}function u(h,R,l){var j,D;return null===(j=h._data)||void 0===j||null===(D=j[(null===l||void 0===l?void 0:l.fillMode)??a.c.MATERIAL_TriangleFillMode])||void 0===D?void 0:D.babylonMaterial}function c(h,R){return{offset:{componentsCount:2,type:"Vector2",get:(l,a,D)=>{const U=mh(l,D,h,R);return new j.Vector2(null===U||void 0===U?void 0:U.uOffset,null===U||void 0===U?void 0:U.vOffset)},getTarget:u,set:(l,j,a,D)=>{const U=mh(j,D,h,R);U.uOffset=l.x,U.vOffset=l.y},getPropertyName:[()=>`${h}${R?"."+R:""}.uOffset`,()=>`${h}${R?"."+R:""}.vOffset`]},rotation:{type:"number",get:(l,j,a)=>{var D;return null===(D=mh(l,a,h,R))||void 0===D?void 0:D.wAng},getTarget:u,set:(l,j,a,D)=>mh(j,D,h,R).wAng=l,getPropertyName:[()=>`${h}${R?"."+R:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(l,a,D)=>{const U=mh(l,D,h,R);return new j.Vector2(null===U||void 0===U?void 0:U.uScale,null===U||void 0===U?void 0:U.vScale)},getTarget:u,set:(l,j,a,D)=>{const U=mh(j,D,h,R);U.uScale=l.x,U.vScale=l.y},getPropertyName:[()=>`${h}${R?"."+R:""}.uScale`,()=>`${h}${R?"."+R:""}.vScale`]}}}const J={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:h=>{var R,l;return new j.Vector2((null===(R=h._babylonCamera)||void 0===R?void 0:R.orthoLeft)??0,(null===(l=h._babylonCamera)||void 0===l?void 0:l.orthoRight)??0)},set:(h,R)=>{R._babylonCamera&&(R._babylonCamera.orthoLeft=h.x,R._babylonCamera.orthoRight=h.y)},getTarget:h=>h,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:h=>{var R,l;return new j.Vector2((null===(R=h._babylonCamera)||void 0===R?void 0:R.orthoBottom)??0,(null===(l=h._babylonCamera)||void 0===l?void 0:l.orthoTop)??0)},set:(h,R)=>{R._babylonCamera&&(R._babylonCamera.orthoBottom=h.x,R._babylonCamera.orthoTop=h.y)},getTarget:h=>h,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:h=>{var R;return null===(R=h._babylonCamera)||void 0===R?void 0:R.maxZ},set:(h,R)=>{R._babylonCamera&&(R._babylonCamera.maxZ=h)},getTarget:h=>h,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:h=>{var R;return null===(R=h._babylonCamera)||void 0===R?void 0:R.fF},set:(h,R)=>{R._babylonCamera&&(R._babylonCamera.fF=h)},getTarget:h=>h,getPropertyName:[()=>"fF"]}},perspective:{aspectRatio:{type:"number",get:h=>{var R;return null===(R=h._babylonCamera)||void 0===R?void 0:R.getEngine().getAspectRatio(h._babylonCamera)},getTarget:h=>h,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:h=>{var R;return null===(R=h._babylonCamera)||void 0===R?void 0:R.fov},set:(h,R)=>{R._babylonCamera&&(R._babylonCamera.fov=h)},getTarget:h=>h,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:h=>{var R;return null===(R=h._babylonCamera)||void 0===R?void 0:R.maxZ},set:(h,R)=>{R._babylonCamera&&(R._babylonCamera.maxZ=h)},getTarget:h=>h,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:h=>{var R;return null===(R=h._babylonCamera)||void 0===R?void 0:R.fF},set:(h,R)=>{R._babylonCamera&&(R._babylonCamera.fF=h)},getTarget:h=>h,getPropertyName:[()=>"fF"]}}}},nodes:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"tR",get:h=>{var R;return null===(R=h._babylonTransformNode)||void 0===R?void 0:R.position},set:(h,R)=>{var l;return null===(l=R._babylonTransformNode)||void 0===l?void 0:l.position.D(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:h=>{var R;return null===(R=h._babylonTransformNode)||void 0===R?void 0:R.rotationQuaternion},set:(h,R)=>{var l,j;return null===(l=R._babylonTransformNode)||void 0===l||null===(j=l.rotationQuaternion)||void 0===j?void 0:j.D(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"tR",get:h=>{var R;return null===(R=h._babylonTransformNode)||void 0===R?void 0:R.yF},set:(h,R)=>{var l;return null===(l=R._babylonTransformNode)||void 0===l?void 0:l.yF.D(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"yF"]},weights:{length:{type:"number",get:h=>h._numMorphTargets,getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(h,R)=>{var l,j;return void 0!==R?null===(l=h._primitiveBabylonMeshes)||void 0===l||null===(j=l[0].morphTargetManager)||void 0===j?void 0:j.getTarget(R).influence:void 0},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(h,R)=>[0],getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:h=>{var R,l,a;return j.Matrix.Compose(null===(R=h._babylonTransformNode)||void 0===R?void 0:R.yF,null===(l=h._babylonTransformNode)||void 0===l?void 0:l.rotationQuaternion,null===(a=h._babylonTransformNode)||void 0===a?void 0:a.position)},getTarget:h=>h._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:h=>{var R,l,a,D;const U=j.Matrix.Identity();let F=h.parent;for(;F&&F.parent;)F=F.parent;const w=(null===(R=h._babylonTransformNode)||void 0===R?void 0:R.position._isDirty)||(null===(l=h._babylonTransformNode)||void 0===l||null===(a=l.rotationQuaternion)||void 0===a?void 0:a._isDirty)||(null===(D=h._babylonTransformNode)||void 0===D?void 0:D.yF._isDirty);if(F){var mh;const R=null===(mh=F._babylonTransformNode)||void 0===mh?void 0:mh.EF(!0).invert();var u,c;if(R)null===(u=h._babylonTransformNode)||void 0===u||null===(c=u.EF(w))||void 0===c||c.multiplyToRef(R,U)}else h._babylonTransformNode&&U.D(h._babylonTransformNode.EF(w));return U},getTarget:h=>h._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:h=>{var R,l;return null===(R=h._babylonTransformNode)||void 0===R||null===(l=R.getChildren((h=>h instanceof U.e),!0)[0])||void 0===l?void 0:l.nF},getTarget:h=>{var R;return null===(R=h._babylonTransformNode)||void 0===R?void 0:R.getChildren((h=>h instanceof U.e),!0)[0]},set:(h,R)=>{if(R._babylonTransformNode){const l=R._babylonTransformNode.getChildren((h=>h instanceof U.e),!0)[0];l&&(l.nF=h)}}},color:{type:"xR",get:h=>{var R,l;return null===(R=h._babylonTransformNode)||void 0===R||null===(l=R.getChildren((h=>h instanceof U.e),!0)[0])||void 0===l?void 0:l.rF},getTarget:h=>{var R;return null===(R=h._babylonTransformNode)||void 0===R?void 0:R.getChildren((h=>h instanceof U.e),!0)[0]},set:(h,R)=>{if(R._babylonTransformNode){const l=R._babylonTransformNode.getChildren((h=>h instanceof U.e),!0)[0];l&&(l.rF=h)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"xR",get:(h,R,l)=>u(h,R,l).emissiveColor,set:(h,R,l,j)=>u(R,l,j).emissiveColor.D(h),getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:c("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(h,R,l)=>{var j;return null===(j=mh(h,l,"bumpTexture"))||void 0===j?void 0:j.level},set:(h,R,l,j)=>{const a=mh(R,j,"bumpTexture");a&&(a.level=h)},getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:c("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(h,R,l)=>u(h,R,l).ambientTextureStrength,set:(h,R,l,j)=>{const a=u(R,l,j);a&&(a.ambientTextureStrength=h)},getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:c("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"bF",get:(h,R,l)=>{const j=u(h,R,l);return D.bF.FromColor3(j.albedoColor,j.alpha)},set:(h,R,l,j)=>{const a=u(R,l,j);a.albedoColor.set(h.r,h.g,h.b),a.alpha=h.a},getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:c("albedoTexture")}},metallicFactor:{type:"number",get:(h,R,l)=>u(h,R,l).metallic,set:(h,R,l,j)=>{const a=u(R,l,j);a&&(a.metallic=h)},getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(h,R,l)=>u(h,R,l).roughness,set:(h,R,l,j)=>{const a=u(R,l,j);a&&(a.roughness=h)},getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:c("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(h,R,l)=>u(h,R,l).anisotropy.nF,set:(h,R,l,j)=>{u(R,l,j).anisotropy.nF=h},getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(h,R,l)=>u(h,R,l).anisotropy.angle,set:(h,R,l,j)=>{u(R,l,j).anisotropy.angle=h},getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:c("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(h,R,l)=>u(h,R,l).clearCoat.nF,set:(h,R,l,j)=>{u(R,l,j).clearCoat.nF=h},getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(h,R,l)=>u(h,R,l).clearCoat.roughness,set:(h,R,l,j)=>{u(R,l,j).clearCoat.roughness=h},getTarget:(h,R,l)=>u(h,R,l),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:c("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(h,R,l)=>{var j;return null===(j=u(h,R,l).clearCoat.bumpTexture)||void 0===j?void 0:j.level},getTarget:u,set:(h,R,l,j)=>u(R,l,j).clearCoat.bumpTexture.level=h},extensions:{KHR_texture_transform:c("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:c("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(h,R,l)=>u(h,R,l).subSurface.dispersion,getTarget:u,set:(h,R,l,j)=>u(R,l,j).subSurface.dispersion=h}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(h,R,l)=>u(h,R,l).emissiveIntensity,getTarget:u,set:(h,R,l,j)=>u(R,l,j).emissiveIntensity=h}},KHR_materials_ior:{ior:{type:"number",get:(h,R,l)=>u(h,R,l).indexOfRefraction,getTarget:u,set:(h,R,l,j)=>u(R,l,j).indexOfRefraction=h}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(h,R,l)=>u(h,R,l).iridescence.nF,getTarget:u,set:(h,R,l,j)=>u(R,l,j).iridescence.nF=h},iridescenceIor:{type:"number",get:(h,R,l)=>u(h,R,l).iridescence.indexOfRefraction,getTarget:u,set:(h,R,l,j)=>u(R,l,j).iridescence.indexOfRefraction=h},iridescenceTexture:{extensions:{KHR_texture_transform:c("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(h,R,l)=>u(h,R,l).iridescence.maximumThickness,getTarget:u,set:(h,R,l,j)=>u(R,l,j).iridescence.maximumThickness=h},iridescenceThicknessMinimum:{type:"number",get:(h,R,l)=>u(h,R,l).iridescence.minimumThickness,getTarget:u,set:(h,R,l,j)=>u(R,l,j).iridescence.minimumThickness=h},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:c("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"xR",get:(h,R,l)=>u(h,R,l).sheen.color,getTarget:u,set:(h,R,l,j)=>u(R,l,j).sheen.color.D(h)},sheenColorTexture:{extensions:{KHR_texture_transform:c("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(h,R,l)=>u(h,R,l).sheen.nF,getTarget:u,set:(h,R,l,j)=>u(R,l,j).sheen.nF=h},sheenRoughnessTexture:{extensions:{KHR_texture_transform:c("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(h,R,l)=>u(h,R,l).metallicF0Factor,getTarget:u,set:(h,R,l,j)=>u(R,l,j).metallicF0Factor=h,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"xR",get:(h,R,l)=>u(h,R,l).metallicReflectanceColor,getTarget:u,set:(h,R,l,j)=>u(R,l,j).metallicReflectanceColor.D(h),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:c("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:c("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(h,R,l)=>u(h,R,l).subSurface.refractionIntensity,getTarget:u,set:(h,R,l,j)=>u(R,l,j).subSurface.refractionIntensity=h,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:c("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(h,R,l)=>u(h,R,l).subSurface.translucencyIntensity,getTarget:u,set:(h,R,l,j)=>u(R,l,j).subSurface.translucencyIntensity=h},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:c("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"xR",get:(h,R,l)=>u(h,R,l).subSurface.translucencyColor,getTarget:u,set:(h,R,l,j)=>{var a;return h&&(null===(a=u(R,l,j).subSurface.translucencyColor)||void 0===a?void 0:a.D(h))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:c("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"xR",get:(h,R,l)=>u(h,R,l).subSurface.tintColor,getTarget:u,set:(h,R,l,j)=>u(R,l,j).subSurface.tintColor.D(h)},attenuationDistance:{type:"number",get:(h,R,l)=>u(h,R,l).subSurface.tintColorAtDistance,getTarget:u,set:(h,R,l,j)=>u(R,l,j).subSurface.tintColorAtDistance=h},thicknessFactor:{type:"number",get:(h,R,l)=>u(h,R,l).subSurface.maximumThickness,getTarget:u,set:(h,R,l,j)=>u(R,l,j).subSurface.maximumThickness=h},thicknessTexture:{extensions:{KHR_texture_transform:c("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonLight)),getPropertyName:[h=>"length"]},__array__:{__target__:!0,color:{type:"xR",get:h=>{var R;return null===(R=h._babylonLight)||void 0===R?void 0:R.rF},set:(h,R)=>{var l;return null===(l=R._babylonLight)||void 0===l?void 0:l.rF.D(h)},getTarget:h=>h._babylonLight,getPropertyName:[h=>"diffuse"]},nF:{type:"number",get:h=>{var R;return null===(R=h._babylonLight)||void 0===R?void 0:R.nF},set:(h,R)=>R._babylonLight?R._babylonLight.nF=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"intensity"]},range:{type:"number",get:h=>{var R;return null===(R=h._babylonLight)||void 0===R?void 0:R.range},set:(h,R)=>R._babylonLight?R._babylonLight.range=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"range"]},spot:{innerConeAngle:{type:"number",get:h=>{var R;return null===(R=h._babylonLight)||void 0===R?void 0:R.innerAngle},set:(h,R)=>R._babylonLight?R._babylonLight.innerAngle=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"innerConeAngle"]},outerConeAngle:{type:"number",get:h=>{var R;return null===(R=h._babylonLight)||void 0===R?void 0:R.angle},set:(h,R)=>R._babylonLight?R._babylonLight.angle=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonLight)),getPropertyName:[h=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonTexture)),getPropertyName:[h=>"length"]},__array__:{__target__:!0,nF:{type:"number",get:h=>{var R;return null===(R=h._babylonTexture)||void 0===R?void 0:R.level},set:(h,R)=>{R._babylonTexture&&(R._babylonTexture.level=h)},getTarget:h=>h._babylonTexture},rotation:{type:"Quaternion",get:h=>{var R;return h._babylonTexture&&j.Quaternion.FromRotationMatrix(null===(R=h._babylonTexture)||void 0===R?void 0:R.getReflectionTextureMatrix())},set:(h,R)=>{var l;R._babylonTexture&&(null!==(l=R._babylonTexture.yh())&&void 0!==l&&l.useRightHandedSystem||(h=j.Quaternion.Inverse(h)),j.Matrix.FromQuaternionToRef(h,R._babylonTexture.getReflectionTextureMatrix()))},getTarget:h=>h._babylonTexture}}}}},animations:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>{var R;return null===(R=h.primitives[0]._instanceData)||void 0===R?void 0:R.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function q(h){return new w(h,J)}function Q(h){const R=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let l=J;for(const j of R)j&&(l=l[j]);if(l&&l.type&&l.get)return l}function Y(h,R){const l=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let j=J;for(const a of l)a&&(j=j[a]);j&&j.type&&j.get&&(j.interpolation=R)}function s(h,R){const l=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let j=J;for(const a of l)if(a){if(!j[a]){if("?"===a){j.__ignoreObjectTree__=!0;continue}j[a]={},"__array__"===a&&(j[a].__target__=!0)}j=j[a]}Object.assign(j,R)}},14555:(h,R,l)=>{"use strict";l.r(R),l.d(R,{AnimationPropertyInfo:()=>mh,TransformNodeAnimationPropertyInfo:()=>u,WeightAnimationPropertyInfo:()=>c,getQuaternion:()=>F,getVector3:()=>U,getWeights:()=>w});var j=l(13399),a=l(12900),D=l(14542);function U(h,R,l,j){return a.tR.GR(R,l).scaleInPlace(j)}function F(h,R,l,j){return a.Quaternion.GR(R,l).scaleInPlace(j)}function w(h,R,l,j){const a=new Array(h._numMorphTargets);for(let D=0;D<a.length;D++)a[D]=R[l++]*j;return a}class mh{constructor(h,R,l,j){this.type=h,this.name=R,this.getValue=l,this.getStride=j}_buildAnimation(h,R,l){const a=new j.b(h,this.name,R,this.type);return a.setKeys(l),a}}class u extends mh{buildAnimations(h,R,l,j){const a=[];return a.push({babylonAnimatable:h._babylonTransformNode,babylonAnimation:this._buildAnimation(R,l,j)}),a}}class c extends mh{buildAnimations(h,R,l,a){const D=[];if(h._numMorphTargets)for(let U=0;U<h._numMorphTargets;U++){const F=new j.b(`${R}_${U}`,this.name,l,this.type);if(F.setKeys(a.map((h=>({frame:h.frame,inTangent:h.inTangent?h.inTangent[U]:void 0,value:h.value[U],outTangent:h.outTangent?h.outTangent[U]:void 0,interpolation:h.interpolation})))),h._primitiveBabylonMeshes)for(const R of h._primitiveBabylonMeshes)if(R.morphTargetManager){const h=R.morphTargetManager.getTarget(U),l=F.clone();h.animations.push(l),D.push({babylonAnimatable:h,babylonAnimation:l})}}return D}}(0,D.n)("/nodes/{}/translation",[new u(j.b.ANIMATIONTYPE_VECTOR3,"position",U,(()=>3))]),(0,D.n)("/nodes/{}/rotation",[new u(j.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",F,(()=>4))]),(0,D.n)("/nodes/{}/scale",[new u(j.b.ANIMATIONTYPE_VECTOR3,"yF",U,(()=>3))]),(0,D.n)("/nodes/{}/weights",[new c(j.b.ANIMATIONTYPE_FLOAT,"influence",w,(h=>h._numMorphTargets))])},14500:(h,R,l)=>{"use strict";class j{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((h,R)=>{this._resolve=h,this._reject=R}))}}var a=l(12900),D=l(12952),U=l(12689),F=l(13313),w=l(14504),mh=l(14521),u=l(12696),c=l(13341),J=l(13399),q=l(13401),Q=l(12749),Y=l(12711),s=l(12718);class t{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(h){this._useTextureToStoreBoneMatrices=h,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(h){this._animationPropertiesOverride=h}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(h,R,l){this.name=h,this.id=R,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=a.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new u.d,this.bones=[],this._scene=l||Q.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const j=this._scene.getEngine().getCaps();this._canUseTextureForBones=j.textureFloat&&j.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((h=>!h.getParent()))}getTransformMatrices(h){if(this.needInitialSkinMatrix){if(!h)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return h._bonesTransformMatrices||this.prepare(!0),h._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(h){return this.needInitialSkinMatrix&&h._transformMatrixTexture?h._transformMatrixTexture:this._transformMatrixTexture}yh(){return this._scene}toString(h){let R=`Name: ${this.name}, nBones: ${this.bones.length}`;if(R+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,h){R+=", Ranges: {";let h=!0;for(const l in this._ranges)h&&(R+=", ",h=!1),R+=l;R+="}"}return R}getBoneIndexByName(h){for(let R=0,l=this.bones.length;R<l;R++)if(this.bones[R].name===h)return R;return-1}createAnimationRange(h,R,l){if(!this._ranges[h]){this._ranges[h]=new q.d(h,R,l);for(let j=0,a=this.bones.length;j<a;j++)this.bones[j].animations[0]&&this.bones[j].animations[0].createRange(h,R,l)}}deleteAnimationRange(h){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let l=0,j=this.bones.length;l<j;l++)this.bones[l].animations[0]&&this.bones[l].animations[0].deleteRange(h,R);this._ranges[h]=null}getAnimationRange(h){return this._ranges[h]||null}getAnimationRanges(){const h=[];let R;for(R in this._ranges)h.push(this._ranges[R]);return h}copyAnimationRange(h,R){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[R]||!h.getAnimationRange(R))return!1;let j=!0;const a=this._getHighestAnimationFrame()+1,D={},U=h.bones;let F,w;for(w=0,F=U.length;w<F;w++)D[U[w].name]=U[w];this.bones.length!==U.length&&(Y.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${U.length}`),j=!1);const mh=l&&this.dimensionsAtRest&&h.dimensionsAtRest?this.dimensionsAtRest.divide(h.dimensionsAtRest):null;for(w=0,F=this.bones.length;w<F;w++){const h=this.bones[w].name,U=D[h];U?j=j&&this.bones[w].copyAnimationRange(U,R,a,l,mh):(Y.c.Warn("copyAnimationRange: not same rig, missing source bone "+h),j=!1)}const u=h.getAnimationRange(R);return u&&(this._ranges[R]=new q.d(R,u.from+a,u.to+a)),j}returnToRest(){for(const h of this.bones)-1!==h._index&&h.returnToRest()}_getHighestAnimationFrame(){let h=0;for(let R=0,l=this.bones.length;R<l;R++)if(this.bones[R].animations[0]){const l=this.bones[R].animations[0].getHighestFrame();h<l&&(h=l)}return h}beginAnimation(h,R,l,j){const a=this.getAnimationRange(h);return a?this._scene.beginAnimation(this,a.from,a.to,R,l,j):null}static MakeAnimationAdditive(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;const j=h.getAnimationRange(l);if(!j)return null;const a=h._scene.getAllAnimatablesByTarget(h);let D=null;for(let F=0;F<a.length;F++){const h=a[F];if(h.fromFrame===(null===j||void 0===j?void 0:j.from)&&h.toFrame===(null===j||void 0===j?void 0:j.to)){D=h;break}}const U=h.getAnimatables();for(let F=0;F<U.length;F++){const h=U[F].animations;if(h)for(let j=0;j<h.length;j++)J.b.MakeAnimationAdditive(h[j],R,l)}return D&&(D.isAdditive=!0),h}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(h){this._meshesWithPoseMatrix.push(h)}_unregisterMeshWithPoseMatrix(h){const R=this._meshesWithPoseMatrix.indexOf(h);R>-1&&this._meshesWithPoseMatrix.splice(R,1)}_computeTransformMatrices(h,R){this.onBeforeComputeObservable.notifyObservers(this);for(let l=0;l<this.bones.length;l++){const j=this.bones[l];j._childUpdateId++;const a=j.getParent();if(a?j.getLocalMatrix().multiplyToRef(a.getFinalMatrix(),j.getFinalMatrix()):R?j.getLocalMatrix().multiplyToRef(R,j.getFinalMatrix()):j.getFinalMatrix().D(j.getLocalMatrix()),-1!==j._index){const R=null===j._index?l:j._index;j.getAbsoluteInverseBindMatrix().multiplyToArray(j.getFinalMatrix(),h,16*R)}}this._identity.copyToArray(h,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const h=this.yh().getRenderId();if(this._currentRenderId===h)return;this._currentRenderId=h}if(this._numBonesWithLinkedTransformNode>0)for(const h of this.bones)if(h._linkedTransformNode){const R=h._linkedTransformNode;h.position=R.position,R.rotationQuaternion?h.rotationQuaternion=R.rotationQuaternion:h.rotation=R.rotation,h.yF=R.yF}if(this.needInitialSkinMatrix)for(const h of this._meshesWithPoseMatrix){const R=h.getPoseMatrix();let l=this._isDirty;if(h._bonesTransformMatrices&&h._bonesTransformMatrices.length===16*(this.bones.length+1)||(h._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),l=!0),l){if(this._synchronizedWithMesh!==h){this._synchronizedWithMesh=h;for(const h of this.bones)if(!h.getParent()){h.getBindMatrix().multiplyToRef(R,a.TmpVectors.Matrix[1]),h._updateAbsoluteBindMatrices(a.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const R=4*(this.bones.length+1);h._transformMatrixTexture&&h._transformMatrixTexture.getSize().width===R||(h._transformMatrixTexture&&h._transformMatrixTexture.dispose(),h._transformMatrixTexture=c.e.CreateRGBATexture(h._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(h._bonesTransformMatrices,R),this.isUsingTextureForMatrices&&h._transformMatrixTexture&&h._transformMatrixTexture.update(h._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=c.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let h=0;h<this.bones.length;h++)this._animatables.push(this.bones[h])}return this._animatables}clone(h,R){const l=new t(h,R||h,this._scene);l.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let j=0;j<this.bones.length;j++){const h=this.bones[j];let R=null;const a=h.getParent();if(a){const h=this.bones.indexOf(a);R=l.bones[h]}const D=new mh.d(h.name,l,R,h.getBindMatrix().clone(),h.getRestMatrix().clone());D._index=h._index,h._linkedTransformNode&&D.linkTransformNode(h._linkedTransformNode),s.e.DeepCopy(h.animations,D.animations)}if(this._ranges){l._ranges={};for(const h in this._ranges){const R=this._ranges[h];R&&(l._ranges[h]=R.clone())}}return this._isDirty=!0,l.prepare(!0),l}enableBlending(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const R of this.bones)for(const l of R.animations)l.enableBlending=!0,l.blendingSpeed=h}dispose(){if(this._meshesWithPoseMatrix.length=0,this.yh().stopAnimation(this),this.yh().removeSkeleton(this),this._parentContainer){const h=this._parentContainer.skeletons.indexOf(this);h>-1&&this._parentContainer.skeletons.splice(h,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const h={};h.name=this.name,h.id=this.id,this.dimensionsAtRest&&(h.dimensionsAtRest=this.dimensionsAtRest.sF()),h.bones=[],h.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let l=0;l<this.bones.length;l++){var R;const j=this.bones[l],a=j.getParent(),D={parentBoneIndex:a?this.bones.indexOf(a):-1,index:j.getIndex(),name:j.name,id:j.id,matrix:j.getBindMatrix().sF(),rest:j.getRestMatrix().sF(),linkedTransformNodeId:null===(R=j.getTransformNode())||void 0===R?void 0:R.id};h.bones.push(D),j.length&&(D.length=j.length),j.metadata&&(D.metadata=j.metadata),j.animations&&j.animations.length>0&&(D.animation=j.animations[0].serialize()),h.ranges=[];for(const R in this._ranges){const l=this._ranges[R];if(!l)continue;const j={};j.name=R,j.from=l.from,j.to=l.to,h.ranges.push(j)}}return h}static Parse(h,R){const l=new t(h.name,h.id,R);let j;for(h.dimensionsAtRest&&(l.dimensionsAtRest=a.tR.GR(h.dimensionsAtRest)),l.needInitialSkinMatrix=h.needInitialSkinMatrix,j=0;j<h.bones.length;j++){const R=h.bones[j],D=h.bones[j].index;let U=null;R.parentBoneIndex>-1&&(U=l.bones[R.parentBoneIndex]);const F=R.rest?a.Matrix.GR(R.rest):null,w=new mh.d(R.name,l,U,a.Matrix.GR(R.matrix),F,null,D);void 0!==R.id&&null!==R.id&&(w.id=R.id),R.length&&(w.length=R.length),R.metadata&&(w.metadata=R.metadata),R.animation&&w.animations.push(J.b.Parse(R.animation)),void 0!==R.linkedTransformNodeId&&null!==R.linkedTransformNodeId&&(l._hasWaitingData=!0,w._waitingTransformNodeId=R.linkedTransformNodeId)}if(h.ranges)for(j=0;j<h.ranges.length;j++){const R=h.ranges[j];l.createAnimationRange(R.name,R.from,R.to)}return l}computeAbsoluteMatrices(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||h)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(h)}getPoseMatrix(){let h=null;return this._meshesWithPoseMatrix.length>0&&(h=this._meshesWithPoseMatrix[0].getPoseMatrix()),h}sortBones(){const h=[],R=new Array(this.bones.length);for(let l=0;l<this.bones.length;l++)this._sortBones(l,h,R);this.bones=h}_sortBones(h,R,l){if(l[h])return;l[h]=!0;const j=this.bones[h];if(!j)return;void 0===j._index&&(j._index=h);const a=j.getParent();a&&this._sortBones(this.bones.indexOf(a),R,l),R.push(j)}setCurrentPoseAsRest(){for(const h of this.bones)h.setCurrentPoseAsRest()}}var f=l(13179),T=l(13366),E=l(12874),x=l(13284),G=l(12984),p=l(13322),O=l(13293),y=l(13310),v=l(13408),b=l(12995),I=l(14465);class L{set areUpdatesFrozen(h){h?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new b.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,h||(h=Q.b.LastCreatedScene),this._scene=h,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const h=this._scene.getEngine().getCaps();this._canUseTextureForTargets=h.canUseGLVertexID&&h.textureFloat&&h.maxVertexTextureImageUnits>0&&h.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return L.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?L.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(h){this._numMaxInfluencers!==h&&(this._numMaxInfluencers=h,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(h){this._useTextureToStoreTargets!==h&&(this._useTextureToStoreTargets=h,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var h;return L.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(h=this._scene)&&void 0!==h&&h.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(h){return this._activeTargets.data[h]}getTarget(h){return this._targets[h]}getTargetByName(h){for(const R of this._targets)if(R.name===h)return R;return null}addTarget(h){this._targets.push(h),this._targetInfluenceChangedObservers.push(h.onInfluenceChanged.add((h=>{this.areUpdatesFrozen&&h&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(h)}))),this._targetDataLayoutChangedObservers.push(h._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(h){const R=this._targets.indexOf(h);R>=0&&(this._targets.splice(R,1),h.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(R,1)[0]),h._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(R,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(h)}_bind(h){h.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),h.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),h.setTexture("morphTargets",this._targetStoreTexture),h.setInt("morphTargetCount",this.numInfluencers)}clone(){const h=new L(this._scene);for(const R of this._targets)h.addTarget(R.clone());return h.enablePositionMorphing=this.enablePositionMorphing,h.enableNormalMorphing=this.enableNormalMorphing,h.enableTangentMorphing=this.enableTangentMorphing,h.enableUVMorphing=this.enableUVMorphing,h.enableUV2Morphing=this.enableUV2Morphing,h.enableColorMorphing=this.enableColorMorphing,h}serialize(){const h={};h.id=this.uniqueId,h.targets=[];for(const R of this._targets)h.targets.push(R.serialize());return h}_syncActiveTargets(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const R=!!this._targetStoreTexture,l=this.isUsingTextureForTargets;(this._mustSynchronize||R!==l)&&(this._mustSynchronize=!1,this.synchronize());let j=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let a=-1;for(const D of this._targets)if(a++,0!==D.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=L.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(D),this._morphTargetTextureIndices[j]=a,this._tempInfluences[j++]=D.influence}this._morphTargetTextureIndices.length!==j&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,j)),this._influences&&this._influences.length===j||(this._influences=new Float32Array(j));for(let D=0;D<j;D++)this._influences[D]=this._tempInfluences[D];if(h&&this._scene)for(const D of this._scene.meshes)D.morphTargetManager===this&&(l?D._markSubMeshesAsAttributesDirty():D._syncGeometryWithMorphTargetManager())}synchronize(){var h;if(!this._scene||this.areUpdatesFrozen)return;const R=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(h=this._targetStoreTexture)||void 0===h||h.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>R.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const l of this._targets){this._supportsPositions=this._supportsPositions&&l.hasPositions,this._supportsNormals=this._supportsNormals&&l.hasNormals,this._supportsTangents=this._supportsTangents&&l.hasTangents,this._supportsUVs=this._supportsUVs&&l.hasUVs,this._supportsUV2s=this._supportsUV2s&&l.hasUV2s,this._supportsColors=this._supportsColors&&l.hasColors;const h=l.vertexCount;if(0===this._vertexCount)this._vertexCount=h;else if(this._vertexCount!==h)return void Y.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${l.name}": ${h}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const h=R.getCaps().maxTextureSize;this._textureWidth>h&&(this._textureHeight=Math.ceil(this._textureWidth/h),this._textureWidth=h);const l=this._targets.length,j=new Float32Array(l*this._textureWidth*this._textureHeight*4);let a=0;for(let R=0;R<l;R++){const h=this._targets[R],l=h.getPositions(),D=h.getNormals(),U=h.getUVs(),F=h.getTangents(),w=h.getUV2s(),mh=h.getColors();a=R*this._textureWidth*this._textureHeight*4;for(let R=0;R<this._vertexCount;R++)this._supportsPositions&&l&&(j[a]=l[3*R],j[a+1]=l[3*R+1],j[a+2]=l[3*R+2],a+=4),this._supportsNormals&&D&&(j[a]=D[3*R],j[a+1]=D[3*R+1],j[a+2]=D[3*R+2],a+=4),this._supportsUVs&&U&&(j[a]=U[2*R],j[a+1]=U[2*R+1],a+=4),this._supportsTangents&&F&&(j[a]=F[3*R],j[a+1]=F[3*R+1],j[a+2]=F[3*R+2],a+=4),this._supportsUV2s&&w&&(j[a]=w[2*R],j[a+1]=w[2*R+1],a+=4),this._supportsColors&&mh&&(j[a]=mh[4*R],j[a+1]=mh[4*R+1],j[a+2]=mh[4*R+2],j[a+3]=mh[4*R+3],a+=4)}this._targetStoreTexture=I.b.CreateRGBATexture(j,this._textureWidth,this._textureHeight,l,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const l of this._scene.meshes)l.morphTargetManager===this&&l._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const h=this._parentContainer.morphTargetManagers.indexOf(this);h>-1&&this._parentContainer.morphTargetManagers.splice(h,1),this._parentContainer=null}for(const h of this._targets)this._scene.stopAnimation(h)}}static Parse(h,R){const l=new L(R);for(const j of h.targets)l.addTarget(v.b.Parse(j,R));return l}}L.EnableTextureStorage=!0,L.MaxActiveMorphTargetsInVertexAttributeMode=8,L.ConstantTargetCountForTextureMode=0;var n=l(14530),r=l(12758),P=l(13195);const z=new Map,o=z;function K(h,R,l){W(h)&&Y.c.Warn(`Extension with the name '${h}' already exists`),z.set(h,{isGLTFExtension:R,factory:l})}function W(h){return z.delete(h)}var g=l(14542),H=l(13460),k=l(12990);class C{static Get(h,R,l){if(!R||void 0==l||!R[l])throw new Error(`${h}: Failed to find index (${l})`);return R[l]}static TryGet(h,R){return h&&void 0!=R&&h[R]?h[R]:null}static Assign(h){if(h)for(let R=0;R<h.length;R++)h[R].index=R}}function A(h){if(h.min&&h.max){const R=h.min,l=h.max,j=a.TmpVectors.tR[0].OF(R[0],R[1],R[2]),D=a.TmpVectors.tR[1].OF(l[0],l[1],l[2]);if(h.normalized&&5126!==h.componentType){let R=1;switch(h.componentType){case 5120:R=127;break;case 5121:R=255;break;case 5122:R=32767;break;case 5123:R=65535}const l=1/R;j.scaleInPlace(l),D.scaleInPlace(l)}return new P.e(j,D)}return null}class e{static RegisterExtension(h,R){K(h,!1,R)}static UnregisterExtension(h){return W(h)}get qF(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(h){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=h}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((h=>h.dispose&&h.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(h,R,l,j,a,D){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=R,this._assetContainer=l,this._loadData(j);let D=null;if(h){const R={};if(this._gltf.nodes)for(const h of this._gltf.nodes)h.name&&(R[h.name]=h.index);D=(h instanceof Array?h:[h]).map((h=>{const l=R[h];if(void 0===l)throw new Error(`Failed to find node '${h}'`);return l}))}return await this._loadAsync(a,U,D,(()=>({meshes:this._getMeshes(),SJ:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=h,this._loadData(R),await this._loadAsync(l,a,null,(()=>{}))}async _loadAsync(h,R,l,j){return await Promise.resolve().then((async()=>{this._rootUrl=h,this._uniqueRootUrl=!h.startsWith("file:")&&R?h:`${h}${Date.now()}/`,this._fileName=R,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const a=`${n.k[n.k.LOADING]} => ${n.k[n.k.READY]}`,D=`${n.k[n.k.LOADING]} => ${n.k[n.k.COMPLETE]}`;this._parent._startPerformanceCounter(a),this._parent._startPerformanceCounter(D),this._parent._setState(n.k.LOADING),this._extensionsOnLoading();const F=new Array;if(!this.parent.loadOnlyMaterials)if(l)F.push(this.loadSceneAsync("/nodes",{nodes:l,index:-1}));else if(void 0!=this._gltf.TR||this._gltf.scenes&&this._gltf.scenes[0]){const h=C.Get("/scene",this._gltf.scenes,this._gltf.TR||0);F.push(this.loadSceneAsync(`/scenes/${h.index}`,h))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let h=0;h<this._gltf.materials.length;++h){const R=this._gltf.materials[h],l="/materials/"+h,j=f.e.TriangleFillMode;F.push(this._loadMaterialAsync(l,R,null,j,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&F.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&F.push(this._compileShadowGeneratorsAsync());const w=Promise.all(F).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.dF(!0);for(const h of this._babylonScene.materials){const R=h;void 0!==R.maxSimultaneousLights&&(R.maxSimultaneousLights=Math.max(R.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(n.k.READY),this._skipStartAnimationStep||this._startAnimations(),j()}));return await w.then((h=>(this._parent._endPerformanceCounter(a),U.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(D),this._parent._setState(n.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(h=>{this._parent.onErrorObservable.notifyObservers(h),this._parent.onErrorObservable.clear(),this.dispose()}))})),h)))})).catch((h=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(h),this._parent.onErrorObservable.clear(),this.dispose()),h}))}_loadData(h){if(this._gltf=h.json,this._setupData(),h.bin){const R=this._gltf.buffers;if(R&&R[0]&&!R[0].uri){const l=R[0];(l.byteLength<h.bin.byteLength-3||l.byteLength>h.bin.byteLength)&&Y.c.Warn(`Binary buffer length (${l.byteLength}) from JSON does not match chunk length (${h.bin.byteLength})`),this._bin=h.bin}else Y.c.Warn("Unexpected BIN chunk")}}_setupData(){if(C.Assign(this._gltf.accessors),C.Assign(this._gltf.animations),C.Assign(this._gltf.buffers),C.Assign(this._gltf.bufferViews),C.Assign(this._gltf.cameras),C.Assign(this._gltf.images),C.Assign(this._gltf.materials),C.Assign(this._gltf.meshes),C.Assign(this._gltf.nodes),C.Assign(this._gltf.samplers),C.Assign(this._gltf.scenes),C.Assign(this._gltf.skins),C.Assign(this._gltf.textures),this._gltf.nodes){const h={};for(const l of this._gltf.nodes)if(l.children)for(const R of l.children)h[R]=l.index;const R=this._createRootNode();for(const l of this._gltf.nodes){const j=h[l.index];l.parent=void 0===j?R:this._gltf.nodes[j]}}}async _loadExtensionsAsync(){const h=[];if(o.forEach(((R,l)=>{var j;!1===(null===(j=this.parent.extensionOptions[l])||void 0===j?void 0:j.enabled)?R.isGLTFExtension&&this.isExtensionUsed(l)&&Y.c.Warn(`Extension ${l} is used but has been explicitly disabled.`):R.isGLTFExtension&&!this.isExtensionUsed(l)||h.push((async()=>{const h=await R.factory(this);return h.name!==l&&Y.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${h.name} !== ${l}`),this._parent.onExtensionLoadedObservable.notifyObservers(h),h})())})),this._extensions.push(...await Promise.all(h)),this._extensions.sort(((h,R)=>(h.order||Number.MAX_VALUE)-(R.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const l of this._gltf.extensionsRequired){if(!this._extensions.some((h=>h.name===l&&h.enabled))){var R;if(!1===(null===(R=this.parent.extensionOptions[l])||void 0===R?void 0:R.enabled))throw new Error(`Required extension ${l} is disabled`);throw new Error(`Required extension ${l} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new y.b("__root__",this._babylonScene);this._rootBabylonMesh=h,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.dF(!1);const R={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case n.h.AUTO:this._babylonScene.useRightHandedSystem||(R.rotation=[0,1,0,0],R.scale=[1,1,-1],e._LoadTransform(R,this._rootBabylonMesh));break;case n.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(h),R}loadSceneAsync(h,R){const l=this._extensionsLoadSceneAsync(h,R);if(l)return l;const j=new Array;if(this.logOpen(`${h} ${R.name||""}`),R.nodes)for(const a of R.nodes){const R=C.Get(`${h}/nodes/${a}`,this._gltf.nodes,a);j.push(this.loadNodeAsync(`/nodes/${R.index}`,R,(h=>{h.parent=this._rootBabylonMesh})))}for(const a of this._postSceneLoadActions)a();return j.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(j).then((()=>{}))}_forEachPrimitive(h,R){if(h._primitiveBabylonMeshes)for(const l of h._primitiveBabylonMeshes)R(l)}_getGeometries(){const h=[],R=this._gltf.nodes;if(R)for(const l of R)this._forEachPrimitive(l,(R=>{const l=R.xF;l&&-1===h.indexOf(l)&&h.push(l)}));return h}_getMeshes(){const h=[];this._rootBabylonMesh instanceof O.c&&h.push(this._rootBabylonMesh);const R=this._gltf.nodes;if(R)for(const l of R)this._forEachPrimitive(l,(R=>{h.push(R)}));return h}_getTransformNodes(){const h=[],R=this._gltf.nodes;if(R)for(const l of R)l._babylonTransformNode&&"lc"===l._babylonTransformNode.getClassName()&&h.push(l._babylonTransformNode),l._babylonTransformNodeForSkin&&h.push(l._babylonTransformNodeForSkin);return h}_getSkeletons(){const h=[],R=this._gltf.skins;if(R)for(const l of R)l._data&&h.push(l._data.babylonSkeleton);return h}_getAnimationGroups(){const h=[],R=this._gltf.animations;if(R)for(const l of R)l._babylonAnimationGroup&&h.push(l._babylonAnimationGroup);return h}_startAnimations(){switch(this._parent.animationStartMode){case n.g.NONE:break;case n.g.FIRST:{const h=this._getAnimationGroups();0!==h.length&&h[0].start(!0);break}case n.g.ALL:{const h=this._getAnimationGroups();for(const R of h)R.start(!0);break}default:return void Y.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadNodeAsync(h,R,l);if(j)return j;if(R._babylonTransformNode)throw new Error(`${h}: Invalid recursive node hierarchy`);const a=new Array;this.logOpen(`${h} ${R.name||""}`);const D=j=>{if(e.AddPointerMetadata(j,h),e._LoadTransform(R,j),void 0!=R.camera){const l=C.Get(`${h}/camera`,this._gltf.cameras,R.camera);a.push(this.loadCameraAsync(`/cameras/${l.index}`,l,(h=>{h.parent=j,this._babylonScene.useRightHandedSystem||(j.yF.x=-1)})))}if(R.children)for(const l of R.children){const R=C.Get(`${h}/children/${l}`,this._gltf.nodes,l);a.push(this.loadNodeAsync(`/nodes/${R.index}`,R,(h=>{h.parent=j})))}l(j)},U=void 0!=R.mesh,F=this._parent.loadSkins&&void 0!=R.skin;if(!U||F){const h=R.name||`node${R.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new x.d(h,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==R.mesh?R._babylonTransformNode=l:R._babylonTransformNodeForSkin=l,D(l)}if(U)if(F){const l=C.Get(`${h}/mesh`,this._gltf.meshes,R.mesh);a.push(this._loadMeshAsync(`/meshes/${l.index}`,R,l,(l=>{const j=R._babylonTransformNodeForSkin;l.metadata=(0,H.e)(j.metadata,l.metadata||{});const D=C.Get(`${h}/skin`,this._gltf.skins,R.skin);a.push(this._loadSkinAsync(`/skins/${D.index}`,R,D,(h=>{this._forEachPrimitive(R,(R=>{R.skeleton=h})),this._postSceneLoadActions.push((()=>{if(void 0!=D.skeleton){const h=C.Get(`/skins/${D.index}/skeleton`,this._gltf.nodes,D.skeleton).parent;R.index===h.index?l.parent=j.parent:l.parent=h._babylonTransformNode}else l.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:j,skinnedNode:l})}))})))})))}else{const l=C.Get(`${h}/mesh`,this._gltf.meshes,R.mesh);a.push(this._loadMeshAsync(`/meshes/${l.index}`,R,l,D))}return this.logClose(),Promise.all(a).then((()=>(this._forEachPrimitive(R,(h=>{const R=h;!R.isAnInstance&&R.xF&&R.xF.useBoundingInfoFromGeometry?h.Kh():h.refreshBoundingInfo(!0,!0)})),R._babylonTransformNode)))}_loadMeshAsync(h,R,l,j){const a=l.primitives;if(!a||!a.length)throw new Error(`${h}: Primitives are missing`);void 0==a[0].index&&C.Assign(a);const D=new Array;this.logOpen(`${h} ${l.name||""}`);const U=R.name||`node${R.index}`;if(1===a.length){const j=l.primitives[0];D.push(this._loadMeshPrimitiveAsync(`${h}/primitives/${j.index}`,U,R,l,j,(h=>{R._babylonTransformNode=h,R._primitiveBabylonMeshes=[h]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,R._babylonTransformNode=new x.d(U,this._babylonScene),R._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R._primitiveBabylonMeshes=[];for(const j of a)D.push(this._loadMeshPrimitiveAsync(`${h}/primitives/${j.index}`,`${U}_primitive${j.index}`,R,l,j,(h=>{h.parent=R._babylonTransformNode,R._primitiveBabylonMeshes.push(h)})))}return j(R._babylonTransformNode),this.logClose(),Promise.all(D).then((()=>R._babylonTransformNode))}_loadMeshPrimitiveAsync(h,R,l,j,a,D){const U=this._extensionsLoadMeshPrimitiveAsync(h,R,l,j,a,D);if(U)return U;this.logOpen(`${h}`);const F=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==l.skin&&!j.primitives[0].targets;let w,mh;if(F&&a._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,w=a._instanceData.babylonSourceMesh.createInstance(R),w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,mh=a._instanceData.promise;else{const D=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new y.b(R,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.sideOrientation=this._babylonScene.useRightHandedSystem?f.e.CounterClockWiseSideOrientation:f.e.ClockWiseSideOrientation,this._createMorphTargets(h,l,j,a,U),D.push(this._loadVertexDataAsync(h,a,U).then((async R=>await this._loadMorphTargetsAsync(h,a,U,R).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,R.zh(U),R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const u=e._GetDrawMode(h,a.mode);if(void 0==a.material){let h=this._defaultBabylonMaterialData[u];h||(h=this._createDefaultMaterial("__GLTFLoader._default",u),this._parent.onMaterialLoadedObservable.notifyObservers(h),this._defaultBabylonMaterialData[u]=h),U.material=h}else if(!this.parent.skipMaterials){const R=C.Get(`${h}/material`,this._gltf.materials,a.material);D.push(this._loadMaterialAsync(`/materials/${R.index}`,R,U,u,(h=>{U.material=h})))}mh=Promise.all(D),F&&(a._instanceData={babylonSourceMesh:U,promise:mh}),w=U}return e.AddPointerMetadata(w,h),this._parent.onMeshLoadedObservable.notifyObservers(w),D(w),this.logClose(),mh.then((()=>w))}_loadVertexDataAsync(h,R,l){const j=this._extensionsLoadVertexDataAsync(h,R,l);if(j)return j;const a=R.attributes;if(!a)throw new Error(`${h}: Attributes are missing`);const D=new Array,U=new p.b(l.name,this._babylonScene);if(void 0==R.indices)l.isUnIndexed=!0;else{const l=C.Get(`${h}/indices`,this._gltf.accessors,R.indices);D.push(this._loadIndicesAccessorAsync(`/accessors/${l.index}`,l).then((h=>{U.setIndices(h)})))}const F=(R,j,F)=>{if(void 0==a[R])return;l._delayInfo=l._delayInfo||[],-1===l._delayInfo.indexOf(j)&&l._delayInfo.push(j);const w=C.Get(`${h}/attributes/${R}`,this._gltf.accessors,a[R]);D.push(this._loadVertexAccessorAsync(`/accessors/${w.index}`,w,j).then((h=>{if(h.getKind()===G.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!l.skeleton){const h=A(w);h&&(U._boundingInfo=h,U.useBoundingInfoFromGeometry=!0)}U.setVerticesBuffer(h,w.count)}))),j==G.g.MatricesIndicesExtraKind&&(l.numBoneInfluencers=8),F&&F(w)};return F("POSITION",G.g.PositionKind),F("NORMAL",G.g.NormalKind),F("TANGENT",G.g.TangentKind),F("TEXCOORD_0",G.g.UVKind),F("TEXCOORD_1",G.g.UV2Kind),F("TEXCOORD_2",G.g.UV3Kind),F("TEXCOORD_3",G.g.UV4Kind),F("TEXCOORD_4",G.g.UV5Kind),F("TEXCOORD_5",G.g.UV6Kind),F("JOINTS_0",G.g.MatricesIndicesKind),F("WEIGHTS_0",G.g.MatricesWeightsKind),F("JOINTS_1",G.g.MatricesIndicesExtraKind),F("WEIGHTS_1",G.g.MatricesWeightsExtraKind),F("COLOR_0",G.g.ColorKind,(h=>{"VEC4"===h.type&&(l.hasVertexAlpha=!0)})),Promise.all(D).then((()=>U))}_createMorphTargets(h,R,l,j,a){if(!j.targets||!this._parent.loadMorphTargets)return;if(void 0==R._numMorphTargets)R._numMorphTargets=j.targets.length;else if(j.targets.length!==R._numMorphTargets)throw new Error(`${h}: Primitives do not have the same number of targets`);const D=l.extras?l.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,a.morphTargetManager=new L(this._babylonScene),a.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.morphTargetManager.areUpdatesFrozen=!0;for(let U=0;U<j.targets.length;U++){const h=R.weights?R.weights[U]:l.weights?l.weights[U]:0,j=D?D[U]:`morphTarget${U}`;a.morphTargetManager.addTarget(new v.b(j,h,a.yh()))}}_loadMorphTargetsAsync(h,R,l,j){if(!R.targets||!this._parent.loadMorphTargets)return Promise.resolve();const a=new Array,D=l.morphTargetManager;for(let U=0;U<D.numTargets;U++){const l=D.getTarget(U);a.push(this._loadMorphTargetVertexDataAsync(`${h}/targets/${U}`,j,R.targets[U],l))}return Promise.all(a).then((()=>{D.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(h,R,l,j){const a=new Array,D=(j,D,U)=>{if(void 0==l[j])return;const F=R.getVertexBuffer(D);if(!F)return;const w=C.Get(`${h}/${j}`,this._gltf.accessors,l[j]);a.push(this._loadFloatAccessorAsync(`/accessors/${w.index}`,w).then((h=>{U(F,h)})))};return D("POSITION",G.g.PositionKind,((h,R)=>{const l=new Float32Array(R.length);h.forEach(R.length,((h,j)=>{l[j]=R[j]+h})),j.setPositions(l)})),D("NORMAL",G.g.NormalKind,((h,R)=>{const l=new Float32Array(R.length);h.forEach(l.length,((h,j)=>{l[j]=R[j]+h})),j.setNormals(l)})),D("TANGENT",G.g.TangentKind,((h,R)=>{const l=new Float32Array(R.length/3*4);let a=0;h.forEach(R.length/3*4,((h,j)=>{(j+1)%4!==0&&(l[a]=R[a]+h,a++)})),j.setTangents(l)})),D("TEXCOORD_0",G.g.UVKind,((h,R)=>{const l=new Float32Array(R.length);h.forEach(R.length,((h,j)=>{l[j]=R[j]+h})),j.setUVs(l)})),D("TEXCOORD_1",G.g.UV2Kind,((h,R)=>{const l=new Float32Array(R.length);h.forEach(R.length,((h,j)=>{l[j]=R[j]+h})),j.setUV2s(l)})),D("COLOR_0",G.g.ColorKind,((R,l)=>{let a=null;const D=R.getSize();if(3===D){a=new Float32Array(l.length/3*4),R.forEach(l.length,((h,R)=>{const j=Math.floor(R/3),D=R%3;a[4*j+D]=l[3*j+D]+h}));for(let h=0;h<l.length/3;++h)a[4*h+3]=1}else{if(4!==D)throw new Error(`${h}: Invalid number of components (${D}) for COLOR_0 attribute`);a=new Float32Array(l.length),R.forEach(l.length,((h,R)=>{a[R]=l[R]+h}))}j.setColors(a)})),await Promise.all(a).then((()=>{}))}static _LoadTransform(h,R){if(void 0!=h.skin)return;let l=a.tR.Zero(),j=a.Quaternion.Identity(),D=a.tR.One();if(h.matrix){a.Matrix.GR(h.matrix).decompose(D,j,l)}else h.translation&&(l=a.tR.GR(h.translation)),h.rotation&&(j=a.Quaternion.GR(h.rotation)),h.scale&&(D=a.tR.GR(h.scale));R.position=l,R.rotationQuaternion=j,R.yF=D}_loadSkinAsync(h,R,l,j){if(!this._parent.loadSkins)return Promise.resolve();const a=this._extensionsLoadSkinAsync(h,R,l);if(a)return a;if(l._data)return j(l._data.babylonSkeleton),l._data.promise;const D=`skeleton${l.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new t(l.name||D,D,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(h,l,U);const F=this._loadSkinInverseBindMatricesDataAsync(h,l).then((h=>{this._updateBoneMatrices(U,h)}));return l._data={babylonSkeleton:U,promise:F},j(U),F}_loadBones(h,R,l){if(void 0==R.skeleton||this._parent.alwaysComputeSkeletonRootNode){const l=this._findSkeletonRootNode(`${h}/joints`,R.joints);if(l)if(void 0===R.skeleton)R.skeleton=l.index;else{const j=(h,R)=>{for(;R.parent;R=R.parent)if(R.parent===h)return!0;return!1},a=C.Get(`${h}/skeleton`,this._gltf.nodes,R.skeleton);a===l||j(a,l)||(Y.c.Warn(`${h}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),R.skeleton=l.index)}else Y.c.Warn(`${h}: Failed to find common root`)}const j={};for(const a of R.joints){const D=C.Get(`${h}/joints/${a}`,this._gltf.nodes,a);this._loadBone(D,R,l,j)}}_findSkeletonRootNode(h,R){if(0===R.length)return null;const l={};for(const a of R){const R=[];let j=C.Get(`${h}/${a}`,this._gltf.nodes,a);for(;-1!==j.index;)R.unshift(j),j=j.parent;l[a]=R}let j=null;for(let a=0;;++a){let h=l[R[0]];if(a>=h.length)return j;const D=h[a];for(let U=1;U<R.length;++U)if(h=l[R[U]],a>=h.length||D!==h[a])return j;j=D}}_loadBone(h,R,l,j){h._isJoint=!0;let a=j[h.index];if(a)return a;let D=null;h.index!==R.skeleton&&(h.parent&&-1!==h.parent.index?D=this._loadBone(h.parent,R,l,j):void 0!==R.skeleton&&Y.c.Warn(`/skins/${R.index}/skeleton: Skeleton node is not a common root`));const U=R.joints.indexOf(h.index);return a=new mh.d(h.name||`joint${h.index}`,l,D,this._getNodeMatrix(h),null,null,U),j[h.index]=a,this._postSceneLoadActions.push((()=>{a.linkTransformNode(h._babylonTransformNode)})),a}_loadSkinInverseBindMatricesDataAsync(h,R){if(void 0==R.inverseBindMatrices)return Promise.resolve(null);const l=C.Get(`${h}/inverseBindMatrices`,this._gltf.accessors,R.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${l.index}`,l)}_updateBoneMatrices(h,R){for(const l of h.bones){const h=a.Matrix.Identity(),j=l._index;R&&-1!==j&&(a.Matrix.FromArrayToRef(R,16*j,h),h.invertToRef(h));const D=l.getParent();D&&h.multiplyToRef(D.getAbsoluteInverseBindMatrix(),h),l.TF(h,!1,!1),l._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(h){return h.matrix?a.Matrix.GR(h.matrix):a.Matrix.Compose(h.scale?a.tR.GR(h.scale):a.tR.One(),h.rotation?a.Quaternion.GR(h.rotation):a.Quaternion.Identity(),h.translation?a.tR.GR(h.translation):a.tR.Zero())}loadCameraAsync(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadCameraAsync(h,R,l);if(j)return j;const D=new Array;this.logOpen(`${h} ${R.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new w.d(R.name||`camera${R.index}`,a.tR.Zero(),this._babylonScene,!1);switch(U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R._babylonCamera=U,U.setTarget(new a.tR(0,0,-1)),R.type){case"perspective":{const l=R.perspective;if(!l)throw new Error(`${h}: Camera perspective properties are missing`);U.fov=l.yfov,U.fF=l.znear,U.maxZ=l.zfar||0;break}case"orthographic":if(!R.orthographic)throw new Error(`${h}: Camera orthographic properties are missing`);U.mode=F.e.ORTHOGRAPHIC_CAMERA,U.orthoLeft=-R.orthographic.xmag,U.orthoRight=R.orthographic.xmag,U.orthoBottom=-R.orthographic.ymag,U.orthoTop=R.orthographic.ymag,U.fF=R.orthographic.znear,U.maxZ=R.orthographic.zfar;break;default:throw new Error(`${h}: Invalid camera type (${R.type})`)}return e.AddPointerMetadata(U,h),this._parent.onCameraLoadedObservable.notifyObservers(U),l(U),this.logClose(),Promise.all(D).then((()=>U))}_loadAnimationsAsync(){const h=this._gltf.animations;if(!h)return Promise.resolve();const R=new Array;for(let l=0;l<h.length;l++){const j=h[l];R.push(this.loadAnimationAsync(`/animations/${j.index}`,j).then((h=>{0===h.targetedAnimations.length&&h.dispose()})))}return Promise.all(R).then((()=>{}))}loadAnimationAsync(h,R){const j=this._extensionsLoadAnimationAsync(h,R);return j||l.e(78).then(l.bind(l,16103)).then((l=>{let{AnimationGroup:j}=l;this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new j(R.name||`animation${R.index}`,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R._babylonAnimationGroup=a;const D=new Array;C.Assign(R.channels),C.Assign(R.samplers);for(const U of R.channels)D.push(this._loadAnimationChannelAsync(`${h}/channels/${U.index}`,h,R,U,((h,R)=>{h.animations=h.animations||[],h.animations.push(R),a.addTargetedAnimation(R,h)})));return Promise.all(D).then((()=>(a.normalize(0),a)))}))}async _loadAnimationChannelAsync(h,R,j,a,D){const U=this._extensionsLoadAnimationChannelAsync(h,R,j,a,D);if(U)return await U;if(void 0==a.target.node)return await Promise.resolve();const F=C.Get(`${h}/target/node`,this._gltf.nodes,a.target.node),w=a.target.path,mh="weights"===w;if(mh&&!F._numMorphTargets||!mh&&!F._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!mh&&!F._isJoint)return await Promise.resolve();let u;switch(await Promise.resolve().then(l.bind(l,14555)),w){case"translation":var c;u=null===(c=(0,g.f)("/nodes/{}/translation"))||void 0===c?void 0:c.interpolation;break;case"rotation":var J;u=null===(J=(0,g.f)("/nodes/{}/rotation"))||void 0===J?void 0:J.interpolation;break;case"scale":var q;u=null===(q=(0,g.f)("/nodes/{}/scale"))||void 0===q?void 0:q.interpolation;break;case"weights":var Q;u=null===(Q=(0,g.f)("/nodes/{}/weights"))||void 0===Q?void 0:Q.interpolation;break;default:throw new Error(`${h}/target/path: Invalid value (${a.target.path})`)}if(!u)throw new Error(`${h}/target/path: Could not find interpolation properties for target path (${a.target.path})`);const Y={object:F,info:u};return await this._loadAnimationChannelFromTargetInfoAsync(h,R,j,a,Y,D)}_loadAnimationChannelFromTargetInfoAsync(h,R,l,j,a,D){const U=this.parent.targetFps,F=1/U,w=C.Get(`${h}/sampler`,l.samplers,j.sampler);return this._loadAnimationSamplerAsync(`${R}/samplers/${j.sampler}`,w).then((h=>{let R=0;const w=a.object,mh=a.info;for(const a of mh){const mh=a.getStride(w),u=h.input,c=h.output,J=new Array(u.length);let q=0;switch(h.interpolation){case"STEP":for(let h=0;h<u.length;h++){const R=a.getValue(w,c,q,1);q+=mh,J[h]={frame:u[h]*U,value:R,interpolation:1}}break;case"CUBICSPLINE":for(let h=0;h<u.length;h++){const R=a.getValue(w,c,q,F);q+=mh;const l=a.getValue(w,c,q,1);q+=mh;const j=a.getValue(w,c,q,F);q+=mh,J[h]={frame:u[h]*U,inTangent:R,value:l,outTangent:j}}break;case"LINEAR":for(let h=0;h<u.length;h++){const R=a.getValue(w,c,q,1);q+=mh,J[h]={frame:u[h]*U,value:R}}}if(q>0){const h=`${l.name||`animation${l.index}`}_channel${j.index}_${R}`,F=a.buildAnimations(w,h,U,J);for(const l of F)R++,D(l.babylonAnimatable,l.babylonAnimation)}}}))}_loadAnimationSamplerAsync(h,R){if(R._data)return R._data;const l=R.interpolation||"LINEAR";switch(l){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${h}/interpolation: Invalid value (${R.interpolation})`)}const j=C.Get(`${h}/input`,this._gltf.accessors,R.input),a=C.Get(`${h}/output`,this._gltf.accessors,R.output);return R._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${j.index}`,j),this._loadFloatAccessorAsync(`/accessors/${a.index}`,a)]).then((h=>{let[R,j]=h;return{input:R,interpolation:l,output:j}})),R._data}loadBufferAsync(h,R,l,j){const a=this._extensionsLoadBufferAsync(h,R,l,j);if(a)return a;if(!R._data)if(R.uri)R._data=this.loadUriAsync(`${h}/uri`,R,R.uri);else{if(!this._bin)throw new Error(`${h}: Uri is missing or the binary glTF is missing its binary chunk`);R._data=this._bin.readAsync(0,R.byteLength)}return R._data.then((R=>{try{return new Uint8Array(R.buffer,R.byteOffset+l,j)}catch(a){throw new Error(`${h}: ${a.message}`)}}))}loadBufferViewAsync(h,R){const l=this._extensionsLoadBufferViewAsync(h,R);if(l)return l;if(R._data)return R._data;const j=C.Get(`${h}/buffer`,this._gltf.buffers,R.buffer);return R._data=this.loadBufferAsync(`/buffers/${j.index}`,j,R.byteOffset||0,R.byteLength),R._data}_loadAccessorAsync(h,R,l){if(R._data)return R._data;const j=e._GetNumComponents(h,R.type),a=j*G.g.GetTypeByteLength(R.componentType),D=j*R.count;if(void 0==R.bufferView)R._data=Promise.resolve(new l(D));else{const U=C.Get(`${h}/bufferView`,this._gltf.bufferViews,R.bufferView);R._data=this.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((F=>{if(5126!==R.componentType||R.normalized||U.byteStride&&U.byteStride!==a){const h=new l(D);return G.g.ForEach(F,R.byteOffset||0,U.byteStride||a,j,R.componentType,h.length,R.normalized||!1,((R,l)=>{h[l]=R})),h}return e._GetTypedArray(h,R.componentType,F,R.byteOffset,D)}))}if(R.sparse){const D=R.sparse;R._data=R._data.then((U=>{const F=U,w=C.Get(`${h}/sparse/indices/bufferView`,this._gltf.bufferViews,D.indices.bufferView),mh=C.Get(`${h}/sparse/values/bufferView`,this._gltf.bufferViews,D.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${w.index}`,w),this.loadBufferViewAsync(`/bufferViews/${mh.index}`,mh)]).then((U=>{let[w,mh]=U;const u=e._GetTypedArray(`${h}/sparse/indices`,D.indices.componentType,w,D.indices.byteOffset,D.count),c=j*D.count;let J;if(5126!==R.componentType||R.normalized){const U=e._GetTypedArray(`${h}/sparse/values`,R.componentType,mh,D.values.byteOffset,c);J=new l(c),G.g.ForEach(U,0,a,j,R.componentType,J.length,R.normalized||!1,((h,R)=>{J[R]=h}))}else J=e._GetTypedArray(`${h}/sparse/values`,R.componentType,mh,D.values.byteOffset,c);let q=0;for(let h=0;h<u.length;h++){let R=u[h]*j;for(let h=0;h<j;h++)F[R++]=J[q++]}return F}))}))}return R._data}_loadFloatAccessorAsync(h,R){return this._loadAccessorAsync(h,R,Float32Array)}_loadIndicesAccessorAsync(h,R){if("SCALAR"!==R.type)throw new Error(`${h}/type: Invalid value ${R.type}`);if(5121!==R.componentType&&5123!==R.componentType&&5125!==R.componentType)throw new Error(`${h}/componentType: Invalid value ${R.componentType}`);if(R._data)return R._data;if(R.sparse){const l=e._GetTypedArrayConstructor(`${h}/componentType`,R.componentType);R._data=this._loadAccessorAsync(h,R,l)}else{const l=C.Get(`${h}/bufferView`,this._gltf.bufferViews,R.bufferView);R._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((l=>e._GetTypedArray(h,R.componentType,l,R.byteOffset,R.count)))}return R._data}_loadVertexBufferViewAsync(h){if(h._babylonBuffer)return h._babylonBuffer;const R=this._babylonScene.getEngine();return h._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((h=>new G.e(R,h,!1))),h._babylonBuffer}_loadVertexAccessorAsync(h,R,l){var j;if(null!==(j=R._babylonVertexBuffer)&&void 0!==j&&j[l])return R._babylonVertexBuffer[l];R._babylonVertexBuffer||(R._babylonVertexBuffer={});const a=this._babylonScene.getEngine();if(R.sparse||void 0==R.bufferView)R._babylonVertexBuffer[l]=this._loadFloatAccessorAsync(h,R).then((h=>new G.g(a,h,l,!1)));else{const j=C.Get(`${h}/bufferView`,this._gltf.bufferViews,R.bufferView);R._babylonVertexBuffer[l]=this._loadVertexBufferViewAsync(j).then((D=>{const U=e._GetNumComponents(h,R.type);return new G.g(a,D,l,!1,void 0,j.byteStride,void 0,R.byteOffset,U,R.componentType,R.normalized,!0,void 0,!0)}))}return R._babylonVertexBuffer[l]}_loadMaterialMetallicRoughnessPropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;return R&&(R.baseColorFactor?(l.albedoColor=D.xR.GR(R.baseColorFactor),l.alpha=R.baseColorFactor[3]):l.albedoColor=D.xR.White(),l.metallic=void 0==R.metallicFactor?1:R.metallicFactor,l.roughness=void 0==R.roughnessFactor?1:R.roughnessFactor,R.baseColorTexture&&j.push(this.loadTextureInfoAsync(`${h}/baseColorTexture`,R.baseColorTexture,(h=>{h.name=`${l.name} (Base Color)`,l.albedoTexture=h}))),R.metallicRoughnessTexture&&(R.metallicRoughnessTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${h}/metallicRoughnessTexture`,R.metallicRoughnessTexture,(h=>{h.name=`${l.name} (Metallic Roughness)`,l.metallicTexture=h}))),l.useMetallnessFromMetallicTextureBlue=!0,l.useRoughnessFromMetallicTextureGreen=!0,l.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(j).then((()=>{}))}_loadMaterialAsync(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const D=this._extensionsLoadMaterialAsync(h,R,l,j,a);if(D)return D;R._data=R._data||{};let U=R._data[j];if(!U){this.logOpen(`${h} ${R.name||""}`);const l=this.createMaterial(h,R,j);U={babylonMaterial:l,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(h,R,l)},R._data[j]=U,e.AddPointerMetadata(l,h),this._parent.onMaterialLoadedObservable.notifyObservers(l),this.logClose()}return l&&(U.babylonMeshes.push(l),l.mw.addOnce((()=>{const h=U.babylonMeshes.indexOf(l);-1!==h&&U.babylonMeshes.splice(h,1)}))),a(U.babylonMaterial),U.promise.then((()=>U.babylonMaterial))}_createDefaultMaterial(h,R){this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new T.b(h,this._babylonScene);return l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.fillMode=R,l.enableSpecularAntiAliasing=!0,l.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,l.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,l.transparencyMode=T.b.PBRMATERIAL_OPAQUE,l.metallic=1,l.roughness=1,l}createMaterial(h,R,l){const j=this._extensionsCreateMaterial(h,R,l);if(j)return j;const a=R.name||`material${R.index}`;return this._createDefaultMaterial(a,l)}loadMaterialPropertiesAsync(h,R,l){const j=this._extensionsLoadMaterialPropertiesAsync(h,R,l);if(j)return j;const a=new Array;return a.push(this.loadMaterialBasePropertiesAsync(h,R,l)),R.pbrMetallicRoughness&&a.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${h}/pbrMetallicRoughness`,R.pbrMetallicRoughness,l)),this.loadMaterialAlphaProperties(h,R,l),Promise.all(a).then((()=>{}))}loadMaterialBasePropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;return l.emissiveColor=R.emissiveFactor?D.xR.GR(R.emissiveFactor):new D.xR(0,0,0),R.doubleSided&&(l.pF=!1,l.twoSidedLighting=!0),R.normalTexture&&(R.normalTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${h}/normalTexture`,R.normalTexture,(h=>{h.name=`${l.name} (Normal)`,l.bumpTexture=h}))),l.invertNormalMapX=!this._babylonScene.useRightHandedSystem,l.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=R.normalTexture.scale&&l.bumpTexture&&(l.bumpTexture.level=R.normalTexture.scale),l.forceIrradianceInFragment=!0),R.occlusionTexture&&(R.occlusionTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${h}/occlusionTexture`,R.occlusionTexture,(h=>{h.name=`${l.name} (Occlusion)`,l.ambientTexture=h}))),l.useAmbientInGrayScale=!0,void 0!=R.occlusionTexture.strength&&(l.ambientTextureStrength=R.occlusionTexture.strength)),R.emissiveTexture&&j.push(this.loadTextureInfoAsync(`${h}/emissiveTexture`,R.emissiveTexture,(h=>{h.name=`${l.name} (Emissive)`,l.emissiveTexture=h}))),Promise.all(j).then((()=>{}))}loadMaterialAlphaProperties(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);switch(R.alphaMode||"OPAQUE"){case"OPAQUE":l.transparencyMode=T.b.PBRMATERIAL_OPAQUE,l.alpha=1;break;case"MASK":l.transparencyMode=T.b.PBRMATERIAL_ALPHATEST,l.alphaCutOff=void 0==R.alphaCutoff?.5:R.alphaCutoff,l.albedoTexture&&(l.albedoTexture.tF=!0);break;case"BLEND":l.transparencyMode=T.b.PBRMATERIAL_ALPHABLEND,l.albedoTexture&&(l.albedoTexture.tF=!0,l.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${h}/alphaMode: Invalid value (${R.alphaMode})`)}}loadTextureInfoAsync(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadTextureInfoAsync(h,R,l);if(j)return j;if(this.logOpen(`${h}`),R.texCoord>=6)throw new Error(`${h}/texCoord: Invalid value (${R.texCoord})`);const a=C.Get(`${h}/index`,this._gltf.textures,R.index);a._textureInfo=R;const D=this._loadTextureAsync(`/textures/${R.index}`,a,(j=>{j.coordinatesIndex=R.texCoord||0,e.AddPointerMetadata(j,h),this._parent.onTextureLoadedObservable.notifyObservers(j),l(j)}));return this.logClose(),D}_loadTextureAsync(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadTextureAsync(h,R,l);if(j)return j;this.logOpen(`${h} ${R.name||""}`);const a=void 0==R.sampler?e.DefaultSampler:C.Get(`${h}/sampler`,this._gltf.samplers,R.sampler),D=C.Get(`${h}/source`,this._gltf.images,R.source),U=this._createTextureAsync(h,a,D,l,void 0,!R._textureInfo.nonColorData);return this.logClose(),U}_createTextureAsync(h,R,l){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},D=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0;const F=this._loadSampler(`/samplers/${R.index}`,R),w=new Array,mh=new j;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u={noMipmap:F.noMipMaps,invertY:!1,samplingMode:F.samplingMode,V:()=>{this._disposed||mh.resolve()},onError:(R,l)=>{this._disposed||mh.reject(new Error(`${h}: ${l&&l.message?l.message:R||"Failed to load texture"}`))},mimeType:l.mimeType??(0,r.h)(l.uri??""),loaderOptions:D,useSRGBBuffer:!!U&&this._parent.useSRGBBuffers},c=new E.b(null,this._babylonScene,u);return c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.push(mh.promise),w.push(this.loadImageAsync(`/images/${l.index}`,l).then((h=>{const R=l.uri||`${this._fileName}#image${l.index}`,j=`data:${this._uniqueRootUrl}${R}`;c.updateURL(j,h);const a=c.getInternalTexture();a&&(a.label=l.name)}))),c.wrapU=F.wrapU,c.wrapV=F.wrapV,a(c),this._parent.useGltfTextureNames&&(c.name=l.name||l.uri||`image${l.index}`),Promise.all(w).then((()=>c))}_loadSampler(h,R){return R._data||(R._data={noMipMaps:9728===R.minFilter||9729===R.minFilter,samplingMode:e._GetTextureSamplingMode(h,R),wrapU:e._GetTextureWrapMode(`${h}/wrapS`,R.wrapS),wrapV:e._GetTextureWrapMode(`${h}/wrapT`,R.wrapT)}),R._data}loadImageAsync(h,R){if(!R._data){if(this.logOpen(`${h} ${R.name||""}`),R.uri)R._data=this.loadUriAsync(`${h}/uri`,R,R.uri);else{const l=C.Get(`${h}/bufferView`,this._gltf.bufferViews,R.bufferView);R._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)}this.logClose()}return R._data}loadUriAsync(h,R,l){const j=this._extensionsLoadUriAsync(h,R,l);if(j)return j;if(!e._ValidateUri(l))throw new Error(`${h}: '${l}' is invalid`);if((0,r.i)(l)){const R=new Uint8Array((0,r.e)(l));return this.log(`${h}: Decoded ${l.substring(0,64)}... (${R.length} bytes)`),Promise.resolve(R)}return this.log(`${h}: Loading ${l}`),this._parent.preprocessUrlAsync(this._rootUrl+l).then((R=>new Promise(((j,a)=>{this._parent._loadFile(this._babylonScene,R,(R=>{this._disposed||(this.log(`${h}: Loaded ${l} (${R.byteLength} bytes)`),j(new Uint8Array(R)))}),!0,(R=>{a(new r.j(`${h}: Failed to load '${l}'${R?": "+R.status+" "+R.statusText:""}`,R))}))}))))}static AddPointerMetadata(h,R){h.metadata=h.metadata||{};const l=h._internalMetadata=h._internalMetadata||{},j=l.qF=l.qF||{};(j.pointers=j.pointers||[]).push(R)}static _GetTextureWrapMode(h,R){switch(R=void 0==R?10497:R){case 33071:return E.b.CLAMP_ADDRESSMODE;case 33648:return E.b.MIRROR_ADDRESSMODE;case 10497:return E.b.WRAP_ADDRESSMODE;default:return Y.c.Warn(`${h}: Invalid value (${R})`),E.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(h,R){const l=void 0==R.magFilter?9729:R.magFilter,j=void 0==R.minFilter?9987:R.minFilter;if(9729===l)switch(j){case 9728:return E.b.LINEAR_NEAREST;case 9729:return E.b.LINEAR_LINEAR;case 9984:return E.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return E.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return E.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return E.b.LINEAR_LINEAR_MIPLINEAR;default:return Y.c.Warn(`${h}/minFilter: Invalid value (${j})`),E.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==l&&Y.c.Warn(`${h}/magFilter: Invalid value (${l})`),j){case 9728:return E.b.NEAREST_NEAREST;case 9729:return E.b.NEAREST_LINEAR;case 9984:return E.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return E.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return E.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return E.b.NEAREST_LINEAR_MIPLINEAR;default:return Y.c.Warn(`${h}/minFilter: Invalid value (${j})`),E.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(h,R){try{return(0,k.o)(R)}catch(l){throw new Error(`${h}: ${l.message}`)}}static _GetTypedArray(h,R,l,j,a){const D=l.buffer;j=l.byteOffset+(j||0);const U=e._GetTypedArrayConstructor(`${h}/componentType`,R),F=G.g.GetTypeByteLength(R);return j%F!==0?(Y.c.Warn(`${h}: Copying buffer as byte offset (${j}) is not a multiple of component type byte length (${F})`),new U(D.slice(j,j+a*F),0)):new U(D,j,a)}static _GetNumComponents(h,R){switch(R){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${h}: Invalid type (${R})`)}static _ValidateUri(h){return U.Tools.IsBase64(h)||-1===h.indexOf("..")}static _GetDrawMode(h,R){switch(void 0==R&&(R=4),R){case 0:return f.e.PointListDrawMode;case 1:return f.e.LineListDrawMode;case 2:return f.e.LineLoopDrawMode;case 3:return f.e.LineStripDrawMode;case 4:return f.e.TriangleFillMode;case 5:return f.e.TriangleStripDrawMode;case 6:return f.e.TriangleFanDrawMode}throw new Error(`${h}: Invalid mesh primitive mode (${R})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const h=new Array;if(this._gltf.materials)for(const R of this._gltf.materials)if(R._data)for(const l in R._data){const j=R._data[l];for(const R of j.babylonMeshes){R.EF(!0);const l=j.babylonMaterial;h.push(l.forceCompilationAsync(R)),h.push(l.forceCompilationAsync(R,{useInstances:!0})),this._parent.useClipPlane&&(h.push(l.forceCompilationAsync(R,{clipPlane:!0})),h.push(l.forceCompilationAsync(R,{clipPlane:!0,useInstances:!0})))}}return Promise.all(h).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const h=new Array,R=this._babylonScene.lights;for(const l of R){const R=l.getShadowGenerator();R&&h.push(R.forceCompilationAsync())}return Promise.all(h).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(h){for(const R of this._extensions)R.enabled&&h(R)}_applyExtensions(h,R,l){for(const j of this._extensions)if(j.enabled){const a=`${j.name}.${R}`,D=h;D._activeLoaderExtensionFunctions=D._activeLoaderExtensionFunctions||{};const U=D._activeLoaderExtensionFunctions;if(!U[a]){U[a]=!0;try{const h=l(j);if(h)return h}finally{delete U[a]}}}return null}_extensionsOnLoading(){this._forEachExtensions((h=>h.onLoading&&h.onLoading()))}_extensionsOnReady(){this._forEachExtensions((h=>h.onReady&&h.onReady()))}_extensionsLoadSceneAsync(h,R){return this._applyExtensions(R,"loadScene",(l=>l.loadSceneAsync&&l.loadSceneAsync(h,R)))}_extensionsLoadNodeAsync(h,R,l){return this._applyExtensions(R,"loadNode",(j=>j.loadNodeAsync&&j.loadNodeAsync(h,R,l)))}_extensionsLoadCameraAsync(h,R,l){return this._applyExtensions(R,"loadCamera",(j=>j.loadCameraAsync&&j.loadCameraAsync(h,R,l)))}_extensionsLoadVertexDataAsync(h,R,l){return this._applyExtensions(R,"loadVertexData",(j=>j._loadVertexDataAsync&&j._loadVertexDataAsync(h,R,l)))}_extensionsLoadMeshPrimitiveAsync(h,R,l,j,a,D){return this._applyExtensions(a,"loadMeshPrimitive",(U=>U._loadMeshPrimitiveAsync&&U._loadMeshPrimitiveAsync(h,R,l,j,a,D)))}_extensionsLoadMaterialAsync(h,R,l,j,a){return this._applyExtensions(R,"loadMaterial",(D=>D._loadMaterialAsync&&D._loadMaterialAsync(h,R,l,j,a)))}_extensionsCreateMaterial(h,R,l){return this._applyExtensions(R,"createMaterial",(j=>j.createMaterial&&j.createMaterial(h,R,l)))}_extensionsLoadMaterialPropertiesAsync(h,R,l){return this._applyExtensions(R,"loadMaterialProperties",(j=>j.loadMaterialPropertiesAsync&&j.loadMaterialPropertiesAsync(h,R,l)))}_extensionsLoadTextureInfoAsync(h,R,l){return this._applyExtensions(R,"loadTextureInfo",(j=>j.loadTextureInfoAsync&&j.loadTextureInfoAsync(h,R,l)))}_extensionsLoadTextureAsync(h,R,l){return this._applyExtensions(R,"loadTexture",(j=>j._loadTextureAsync&&j._loadTextureAsync(h,R,l)))}_extensionsLoadAnimationAsync(h,R){return this._applyExtensions(R,"loadAnimation",(l=>l.loadAnimationAsync&&l.loadAnimationAsync(h,R)))}_extensionsLoadAnimationChannelAsync(h,R,l,j,a){return this._applyExtensions(l,"loadAnimationChannel",(D=>D._loadAnimationChannelAsync&&D._loadAnimationChannelAsync(h,R,l,j,a)))}_extensionsLoadSkinAsync(h,R,l){return this._applyExtensions(l,"loadSkin",(j=>j._loadSkinAsync&&j._loadSkinAsync(h,R,l)))}_extensionsLoadUriAsync(h,R,l){return this._applyExtensions(R,"loadUri",(j=>j._loadUriAsync&&j._loadUriAsync(h,R,l)))}_extensionsLoadBufferViewAsync(h,R){return this._applyExtensions(R,"loadBufferView",(l=>l.loadBufferViewAsync&&l.loadBufferViewAsync(h,R)))}_extensionsLoadBufferAsync(h,R,l,j){return this._applyExtensions(R,"loadBuffer",(a=>a.loadBufferAsync&&a.loadBufferAsync(h,R,l,j)))}static LoadExtensionAsync(h,R,l,j){if(!R.extensions)return null;const a=R.extensions[l];return a?j(`${h}/extensions/${l}`,a):null}static LoadExtraAsync(h,R,l,j){if(!R.extras)return null;const a=R.extras[l];return a?j(`${h}/extras/${l}`,a):null}isExtensionUsed(h){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(h)}logOpen(h){this._parent._logOpen(h)}logClose(){this._parent._logClose()}log(h){this._parent._log(h)}startPerformanceCounter(h){this._parent._startPerformanceCounter(h)}endPerformanceCounter(h){this._parent._endPerformanceCounter(h)}}e.DefaultSampler={index:-1},n.d._CreateGLTF2Loader=h=>new e(h);var S=l(14555),Z=l(13075),M=l(12942),i=l(14561),d=l(14565);class X extends d.e{constructor(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",h),this._texture=h.getEngine().createRawCubeTexture(R,l,j,a,D,U,F,w)}update(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,h,R,l,j,a)}updateRGBDAsync(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,i.k)(this._texture,h,R,l,j).then((()=>{}))}clone(){return M.c.Clone((()=>{const h=this.yh(),R=this._texture,l=new X(h,R._bufferViewArray,R.width,R.format,R.type,R.generateMipMaps,R.invertY,R.samplingMode,R._compression);return 13===R.source&&l.updateRGBDAsync(R._bufferViewArrayArray,R._sphericalPolynomial,R._lodGenerationScale,R._lodGenerationOffset),l}),this)}}const V="EXT_lights_image_based";class B{constructor(h){this.name=V,this._loader=h,this.enabled=this._loader.isExtensionUsed(V)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.qF.extensions;if(h&&h[this.name]){const R=h[this.name];this._lights=R.lights}}loadSceneAsync(h,R){return e.LoadExtensionAsync(h,R,this.name,(async(l,j)=>{this._loader._allMaterialsDirtyRequired=!0;const a=new Array;a.push(this._loader.loadSceneAsync(h,R)),this._loader.logOpen(`${l}`);const D=C.Get(`${l}/light`,this._lights,j.aF);return a.push(this._loadLightAsync(`/extensions/${this.name}/lights/${j.aF}`,D).then((h=>{this._loader.babylonScene.environmentTexture=h}))),this._loader.logClose(),await Promise.all(a).then((()=>{}))}))}_loadLightAsync(h,R){if(!R._loaded){const l=new Array;this._loader.logOpen(`${h}`);const j=new Array(R.specularImages.length);for(let a=0;a<R.specularImages.length;a++){const D=R.specularImages[a];j[a]=new Array(D.length);for(let R=0;R<D.length;R++){const U=`${h}/specularImages/${a}/${R}`;this._loader.logOpen(`${U}`);const F=D[R],w=C.Get(U,this._loader.qF.images,F);l.push(this._loader.loadImageAsync(`/images/${F}`,w).then((h=>{j[a][R]=h}))),this._loader.logClose()}}this._loader.logClose(),R._loaded=Promise.all(l).then((async()=>{const l=new X(this._loader.babylonScene,null,R.specularImageSize);if(l.name=R.name||"environment",R._babylonTexture=l,void 0!=R.nF&&(l.level=R.nF),R.rotation){let h=a.Quaternion.GR(R.rotation);this._loader.babylonScene.useRightHandedSystem||(h=a.Quaternion.Inverse(h)),a.Matrix.FromQuaternionToRef(h,l.getReflectionTextureMatrix())}if(!R.irradianceCoefficients)throw new Error(`${h}: Irradiance coefficients are missing`);const D=Z.b.GR(R.irradianceCoefficients);D.scaleInPlace(R.nF),D.convertIrradianceToLambertianRadiance();const U=Z.f.FromHarmonics(D),F=(j.length-1)/Math.log2(R.specularImageSize);return await l.updateRGBDAsync(j,U,F)}))}return R._loaded.then((()=>R._babylonTexture))}}W(V),K(V,!0,(h=>new B(h)));l(13430);const N="EXT_mesh_gpu_instancing";class hh{constructor(h){this.name=N,this._loader=h,this.enabled=this._loader.isExtensionUsed(N)}dispose(){this._loader=null}loadNodeAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(h,j)=>{this._loader._disableInstancedMesh++;const D=this._loader.loadNodeAsync(`/nodes/${R.index}`,R,l);if(this._loader._disableInstancedMesh--,!R._primitiveBabylonMeshes)return await D;const U=new Array;let F=0;const w=R=>{if(void 0==j.attributes[R])return void U.push(Promise.resolve(null));const l=C.Get(`${h}/attributes/${R}`,this._loader.qF.accessors,j.attributes[R]);if(U.push(this._loader._loadFloatAccessorAsync(`/accessors/${l.bufferView}`,l)),0===F)F=l.count;else if(F!==l.count)throw new Error(`${h}/attributes: Instance buffer accessors do not have the same count.`)};return w("TRANSLATION"),w("ROTATION"),w("SCALE"),await D.then((async h=>{const[l,j,D]=await Promise.all(U),w=new Float32Array(16*F);a.TmpVectors.tR[0].OF(0,0,0),a.TmpVectors.Quaternion[0].OF(0,0,0,1),a.TmpVectors.tR[1].OF(1,1,1);for(let R=0;R<F;++R)l&&a.tR.FromArrayToRef(l,3*R,a.TmpVectors.tR[0]),j&&a.Quaternion.FromArrayToRef(j,4*R,a.TmpVectors.Quaternion[0]),D&&a.tR.FromArrayToRef(D,3*R,a.TmpVectors.tR[1]),a.Matrix.ComposeToRef(a.TmpVectors.tR[1],a.TmpVectors.Quaternion[0],a.TmpVectors.tR[0],a.TmpVectors.Matrix[0]),a.TmpVectors.Matrix[0].copyToArray(w,16*R);for(const a of R._primitiveBabylonMeshes)a.uJ("matrix",w,16,!0);return h}))}))}}W(N),K(N,!0,(h=>new hh(h)));let Rh=0,lh=null;class jh{static get Default(){return jh._Default||(jh._Default=new jh),jh._Default}constructor(){const h=jh.Configuration.decoder;this._decoderModulePromise=U.Tools.LoadBabylonScriptAsync(h.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(h,R,l,j,a){await this._decoderModulePromise,0===Rh&&(MeshoptDecoder.useWorkers(1),Rh=1);const D=await MeshoptDecoder.decodeGltfBufferAsync(R,l,h,j,a);return null!==lh&&clearTimeout(lh),lh=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Rh=0,lh=null}),1e3),D}}jh.Configuration={decoder:{url:`${U.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},jh._Default=null;const ah="EXT_meshopt_compression";class Dh{constructor(h){this.name=ah,this.enabled=h.isExtensionUsed(ah),this._loader=h}dispose(){this._loader=null}loadBufferViewAsync(h,R){return e.LoadExtensionAsync(h,R,this.name,(async(l,j)=>{const a=R;if(a._meshOptData)return await a._meshOptData;const D=C.Get(`${h}/buffer`,this._loader.qF.buffers,j.buffer);return a._meshOptData=this._loader.loadBufferAsync(`/buffers/${D.index}`,D,j.byteOffset||0,j.byteLength).then((async h=>await jh.Default.decodeGltfBufferAsync(h,j.count,j.byteStride,j.mode,j.filter))),await a._meshOptData}))}}W(ah),K(ah,!0,(h=>new Dh(h)));const Uh="EXT_texture_webp";class Fh{constructor(h){this.name=Uh,this._loader=h,this.enabled=h.isExtensionUsed(Uh)}dispose(){this._loader=null}_loadTextureAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=void 0==R.sampler?e.DefaultSampler:C.Get(`${h}/sampler`,this._loader.qF.samplers,R.sampler),U=C.Get(`${j}/source`,this._loader.qF.images,a.source);return await this._loader._createTextureAsync(h,D,U,(h=>{l(h)}),void 0,!R._textureInfo.nonColorData)}))}}W(Uh),K(Uh,!0,(h=>new Fh(h)));const wh="EXT_texture_avif";class mR{constructor(h){this.name=wh,this._loader=h,this.enabled=h.isExtensionUsed(wh)}dispose(){this._loader=null}_loadTextureAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=void 0==R.sampler?e.DefaultSampler:C.Get(`${h}/sampler`,this._loader.qF.samplers,R.sampler),U=C.Get(`${j}/source`,this._loader.qF.images,a.source);return await this._loader._createTextureAsync(h,D,U,(h=>{l(h)}),void 0,!R._textureInfo.nonColorData)}))}}W(wh),K(wh,!0,(h=>new mR(h)));var uh=l(14547),ch=l(13417);const Jh="EXT_lights_ies";class qh{constructor(h){this.name=Jh,this._loader=h,this.enabled=this._loader.isExtensionUsed(Jh)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.qF.extensions;if(h&&h[this.name]){const R=h[this.name];this._lights=R.lights,C.Assign(this._lights)}}loadNodeAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,U)=>{let F,w;this._loader._allMaterialsDirtyRequired=!0;const mh=await this._loader.loadNodeAsync(h,R,(h=>{w=C.Get(j,this._lights,U.aF);const R=w.name||h.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,F=new uh.e(R,a.tR.Zero(),a.tR.Backward(),0,1,this._loader.babylonScene),F.angle=Math.PI/2,F.innerAngle=0,F._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,w._babylonLight=F,F.falloffType=ch.e.FALLOFF_GLTF,F.rF=U.color?D.xR.GR(U.color):D.xR.White(),F.nF=U.multiplier||1,F.range=Number.MAX_VALUE,F.parent=h,this._loader._babylonLights.push(F),e.AddPointerMetadata(F,j),l(h)}));let u;if(w.uri)u=await this._loader.loadUriAsync(h,w,w.uri);else{const R=C.Get(`${h}/bufferView`,this._loader.qF.bufferViews,w.bufferView);u=await this._loader.loadBufferViewAsync(`/bufferViews/${R.index}`,R)}return F.iesProfileTexture=new E.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,u,!0,void 0,void 0,void 0,void 0,".ies"),mh}))}}W(Jh),K(Jh,!0,(h=>new qh(h)));var Qh=l(14570);const Yh="KHR_draco_mesh_compression";class sh{constructor(h){this.name=Yh,this.useNormalizedFlagFromAccessor=!0,this._loader=h,this.enabled=Qh.e.DefaultAvailable&&this._loader.isExtensionUsed(Yh)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{if(void 0!=R.mode&&4!==R.mode&&5!==R.mode)throw new Error(`${h}: Unsupported mode ${R.mode}`);const D={},U={},F=(h,j)=>{const F=a.attributes[h];if(void 0!=F&&(l._delayInfo=l._delayInfo||[],-1===l._delayInfo.indexOf(j)&&l._delayInfo.push(j),D[j]=F,this.useNormalizedFlagFromAccessor)){const l=C.TryGet(this._loader.qF.accessors,R.attributes[h]);l&&(U[j]=l.normalized||!1)}};F("POSITION",G.g.PositionKind),F("NORMAL",G.g.NormalKind),F("TANGENT",G.g.TangentKind),F("TEXCOORD_0",G.g.UVKind),F("TEXCOORD_1",G.g.UV2Kind),F("TEXCOORD_2",G.g.UV3Kind),F("TEXCOORD_3",G.g.UV4Kind),F("TEXCOORD_4",G.g.UV5Kind),F("TEXCOORD_5",G.g.UV6Kind),F("JOINTS_0",G.g.MatricesIndicesKind),F("WEIGHTS_0",G.g.MatricesWeightsKind),F("COLOR_0",G.g.ColorKind);const w=C.Get(j,this._loader.qF.bufferViews,a.bufferView);return w._dracoBabylonGeometry||(w._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((async j=>{const a=this.dracoDecoder||Qh.e.Default,F=C.TryGet(this._loader.qF.accessors,R.attributes.POSITION),w=this._loader.parent.alwaysComputeBoundingBox||l.skeleton||!F?null:A(F);return await a._decodeMeshToGeometryForGltfAsync(l.name,this._loader.babylonScene,j,D,U,w).catch((R=>{throw new Error(`${h}: ${R.message}`)}))}))),await w._dracoBabylonGeometry}))}}W(Yh),K(Yh,!0,(h=>new sh(h)));var th=l(14576),fh=l(12882),Th=l(12887),Eh=l(13291),xh=l(13463),Gh=l(12852);Eh.b.AddNodeConstructor("Light_Type_0",((h,R)=>()=>new ph(h,a.tR.Zero(),R)));class ph extends xh.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(h){this._shadowAngle=h,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(h){const R=this.needCube();if(this._direction=h,this.needCube()!==R&&this._shadowGenerators){const h=this._shadowGenerators.values();for(let R=h.next();!0!==R.done;R=h.next()){R.value.recreateShadowMap()}}}constructor(h,R,l){super(h,l),this._shadowAngle=Math.PI/2,this.position=R}getClassName(){return"PointLight"}getTypeID(){return ch.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(h){if(this.direction)return super.getShadowDirection(h);switch(h){case 0:return new a.tR(1,0,0);case 1:return new a.tR(-1,0,0);case 2:return new a.tR(0,-1,0);case 3:return new a.tR(0,1,0);case 4:return new a.tR(0,0,1);case 5:return new a.tR(0,0,-1)}return a.tR.Zero()}_setDefaultShadowProjectionMatrix(h,R,l){const j=this.yh().activeCamera;if(!j)return;const D=void 0!==this.shadowMinZ?this.shadowMinZ:j.fF,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,F=this.yh().getEngine().UF;a.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,F?U:D,F?D:U,h,!0,this._scene.getEngine().isNDCHalfZRange,void 0,F)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(h,R){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,R):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,R),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,R),this}transferToNodeMaterialEffect(h,R){return this.computeTransformedInformation()?h.setFloat3(R,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):h.setFloat3(R,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(h,R){h["POINTLIGHT"+R]=!0}}(0,fh.e)([(0,Th.G)()],ph.prototype,"shadowAngle",null),(0,Gh.f)("BABYLON.PointLight",ph);const Oh="KHR_lights_punctual";class yh{constructor(h){this.name=Oh,this._loader=h,this.enabled=this._loader.isExtensionUsed(Oh)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.qF.extensions;if(h&&h[this.name]){const R=h[this.name];this._lights=R.lights,C.Assign(this._lights)}}loadNodeAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,U)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(h,R,(h=>{let R;const F=C.Get(j,this._lights,U.aF),w=F.name||h.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,F.type){case"directional":{const h=new th.d(w,a.tR.Backward(),this._loader.babylonScene);h.position.vF(0),R=h;break}case"point":R=new ph(w,a.tR.Zero(),this._loader.babylonScene);break;case"spot":{const h=new uh.e(w,a.tR.Zero(),a.tR.Backward(),0,1,this._loader.babylonScene);h.angle=2*(F.spot&&F.spot.outerConeAngle||Math.PI/4),h.innerAngle=2*(F.spot&&F.spot.innerConeAngle||0),R=h;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${j}: Invalid light type (${F.type})`)}R._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,F._babylonLight=R,R.falloffType=ch.e.FALLOFF_GLTF,R.rF=F.color?D.xR.GR(F.color):D.xR.White(),R.nF=void 0==F.nF?1:F.nF,R.range=void 0==F.range?Number.MAX_VALUE:F.range,R.parent=h,this._loader._babylonLights.push(R),e.AddPointerMetadata(R,j),l(h)})))))}}W(Oh),K(Oh,!0,(h=>new yh(h)));const vh="KHR_materials_pbrSpecularGlossiness";class bh{constructor(h){this.name=vh,this.order=200,this._loader=h,this.enabled=this._loader.isExtensionUsed(vh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;return D.push(this._loader.loadMaterialBasePropertiesAsync(h,R,l)),D.push(this._loadSpecularGlossinessPropertiesAsync(j,a,l)),this._loader.loadMaterialAlphaProperties(h,R,l),await Promise.all(D).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;return l.metallic=null,l.roughness=null,R.diffuseFactor?(l.albedoColor=D.xR.GR(R.diffuseFactor),l.alpha=R.diffuseFactor[3]):l.albedoColor=D.xR.White(),l.reflectivityColor=R.specularFactor?D.xR.GR(R.specularFactor):D.xR.White(),l.microSurface=void 0==R.glossinessFactor?1:R.glossinessFactor,R.diffuseTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTexture`,R.diffuseTexture,(h=>{h.name=`${l.name} (Diffuse)`,l.albedoTexture=h}))),R.specularGlossinessTexture&&(j.push(this._loader.loadTextureInfoAsync(`${h}/specularGlossinessTexture`,R.specularGlossinessTexture,(h=>{h.name=`${l.name} (Specular Glossiness)`,l.reflectivityTexture=h,l.reflectivityTexture.tF=!0}))),l.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(j).then((()=>{}))}}W(vh),K(vh,!0,(h=>new bh(h)));const Ih="KHR_materials_unlit";class Lh{constructor(h){this.name=Ih,this.order=210,this._loader=h,this.enabled=this._loader.isExtensionUsed(Ih)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async()=>await this._loadUnlitPropertiesAsync(h,R,l)))}_loadUnlitPropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;l.unlit=!0;const a=R.pbrMetallicRoughness;return a&&(a.baseColorFactor?(l.albedoColor=D.xR.GR(a.baseColorFactor),l.alpha=a.baseColorFactor[3]):l.albedoColor=D.xR.White(),a.baseColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/baseColorTexture`,a.baseColorTexture,(h=>{h.name=`${l.name} (Base Color)`,l.albedoTexture=h})))),R.doubleSided&&(l.pF=!1,l.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(h,R,l),Promise.all(j).then((()=>{}))}}W(Ih),K(Ih,!0,(h=>new Lh(h)));const nh="KHR_materials_clearcoat";class rh{constructor(h){this.name=nh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(nh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadClearCoatPropertiesAsync(j,a,l)),await Promise.all(D)}))}_loadClearCoatPropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;return l.clearCoat.isEnabled=!0,l.clearCoat.useRoughnessFromMainTexture=!1,l.clearCoat.remapF0OnInterfaceChange=!1,void 0!=R.clearcoatFactor?l.clearCoat.nF=R.clearcoatFactor:l.clearCoat.nF=0,R.clearcoatTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatTexture`,R.clearcoatTexture,(h=>{h.name=`${l.name} (ClearCoat)`,l.clearCoat.texture=h}))),void 0!=R.clearcoatRoughnessFactor?l.clearCoat.roughness=R.clearcoatRoughnessFactor:l.clearCoat.roughness=0,R.clearcoatRoughnessTexture&&(R.clearcoatRoughnessTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatRoughnessTexture`,R.clearcoatRoughnessTexture,(h=>{h.name=`${l.name} (ClearCoat Roughness)`,l.clearCoat.textureRoughness=h})))),R.clearcoatNormalTexture&&(R.clearcoatNormalTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatNormalTexture`,R.clearcoatNormalTexture,(h=>{h.name=`${l.name} (ClearCoat Normal)`,l.clearCoat.bumpTexture=h}))),l.invertNormalMapX=!l.yh().useRightHandedSystem,l.invertNormalMapY=l.yh().useRightHandedSystem,void 0!=R.clearcoatNormalTexture.scale&&(l.clearCoat.bumpTexture.level=R.clearcoatNormalTexture.scale)),Promise.all(j).then((()=>{}))}}W(nh),K(nh,!0,(h=>new rh(h)));const Ph="KHR_materials_iridescence";class zh{constructor(h){this.name=Ph,this.order=195,this._loader=h,this.enabled=this._loader.isExtensionUsed(Ph)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadIridescencePropertiesAsync(j,a,l)),await Promise.all(D).then((()=>{}))}))}_loadIridescencePropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;return l.iridescence.isEnabled=!0,l.iridescence.nF=R.iridescenceFactor??0,l.iridescence.indexOfRefraction=R.iridescenceIor??R.iridescenceIOR??1.3,l.iridescence.minimumThickness=R.iridescenceThicknessMinimum??100,l.iridescence.maximumThickness=R.iridescenceThicknessMaximum??400,R.iridescenceTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/iridescenceTexture`,R.iridescenceTexture,(h=>{h.name=`${l.name} (Iridescence)`,l.iridescence.texture=h}))),R.iridescenceThicknessTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/iridescenceThicknessTexture`,R.iridescenceThicknessTexture,(h=>{h.name=`${l.name} (Iridescence Thickness)`,l.iridescence.thicknessTexture=h}))),Promise.all(j).then((()=>{}))}}W(Ph),K(Ph,!0,(h=>new zh(h)));const oh="KHR_materials_anisotropy";class Kh{constructor(h){this.name=oh,this.order=195,this._loader=h,this.enabled=this._loader.isExtensionUsed(oh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadIridescencePropertiesAsync(j,a,l)),await Promise.all(D)}))}async _loadIridescencePropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;l.anisotropy.isEnabled=!0,l.anisotropy.nF=R.anisotropyStrength??0,l.anisotropy.angle=R.anisotropyRotation??0,R.anisotropyTexture&&(R.anisotropyTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/anisotropyTexture`,R.anisotropyTexture,(h=>{h.name=`${l.name} (Anisotropy Intensity)`,l.anisotropy.texture=h})))),await Promise.all(j)}}W(oh),K(oh,!0,(h=>new Kh(h)));const Wh="KHR_materials_emissive_strength";class gh{constructor(h){this.name=Wh,this.order=170,this._loader=h,this.enabled=this._loader.isExtensionUsed(Wh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>await this._loader.loadMaterialPropertiesAsync(h,R,l).then((()=>{this._loadEmissiveProperties(j,a,l)}))))}_loadEmissiveProperties(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);void 0!==R.emissiveStrength&&(l.emissiveIntensity=R.emissiveStrength)}}W(Wh),K(Wh,!0,(h=>new gh(h)));const Hh="KHR_materials_sheen";class kh{constructor(h){this.name=Hh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(Hh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadSheenPropertiesAsync(j,a,l)),await Promise.all(D).then((()=>{}))}))}_loadSheenPropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;return l.sheen.isEnabled=!0,l.sheen.nF=1,void 0!=R.sheenColorFactor?l.sheen.color=D.xR.GR(R.sheenColorFactor):l.sheen.color=D.xR.Black(),R.sheenColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/sheenColorTexture`,R.sheenColorTexture,(h=>{h.name=`${l.name} (Sheen Color)`,l.sheen.texture=h}))),void 0!==R.sheenRoughnessFactor?l.sheen.roughness=R.sheenRoughnessFactor:l.sheen.roughness=0,R.sheenRoughnessTexture&&(R.sheenRoughnessTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/sheenRoughnessTexture`,R.sheenRoughnessTexture,(h=>{h.name=`${l.name} (Sheen Roughness)`,l.sheen.textureRoughness=h})))),l.sheen.albedoScaling=!0,l.sheen.useRoughnessFromMainTexture=!1,Promise.all(j).then((()=>{}))}}W(Hh),K(Hh,!0,(h=>new kh(h)));var Ch=l(13350);const Ah="KHR_materials_specular";class eh{constructor(h){this.name=Ah,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(Ah)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;if(D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadSpecularPropertiesAsync(j,a,l)),a.extensions&&a.extensions.EXT_materials_specular_edge_color&&l instanceof T.b){a.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(l.brdf.dielectricSpecularModel=Ch.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,l.brdf.conductorSpecularModel=Ch.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(D).then((()=>{}))}))}_loadSpecularPropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;return void 0!==R.specularFactor&&(l.metallicF0Factor=R.specularFactor),void 0!==R.specularColorFactor&&(l.metallicReflectanceColor=D.xR.GR(R.specularColorFactor)),R.specularTexture&&(R.specularTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${h}/specularTexture`,R.specularTexture,(h=>{h.name=`${l.name} (Specular)`,l.metallicReflectanceTexture=h,l.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),R.specularColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/specularColorTexture`,R.specularColorTexture,(h=>{h.name=`${l.name} (Specular Color)`,l.reflectanceTexture=h}))),Promise.all(j).then((()=>{}))}}W(Ah),K(Ah,!0,(h=>new eh(h)));const Sh="KHR_materials_ior";class Zh{constructor(h){this.name=Sh,this.order=180,this._loader=h,this.enabled=this._loader.isExtensionUsed(Sh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadIorPropertiesAsync(j,a,l)),await Promise.all(D).then((()=>{}))}))}_loadIorPropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);return void 0!==R.ior?l.indexOfRefraction=R.ior:l.indexOfRefraction=Zh._DEFAULT_IOR,Promise.resolve()}}Zh._DEFAULT_IOR=1.5,W(Sh),K(Sh,!0,(h=>new Zh(h)));const Mh="KHR_materials_variants";class ih{constructor(h){this.name=Mh,this._loader=h,this.enabled=this._loader.isExtensionUsed(Mh)}dispose(){this._loader=null}static GetAvailableVariants(h){const R=this._GetExtensionMetadata(h);return R?Object.keys(R.variants):[]}getAvailableVariants(h){return ih.GetAvailableVariants(h)}static SelectVariant(h,R){const l=this._GetExtensionMetadata(h);if(!l)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Mh} extension`);const j=h=>{const R=l.variants[h];if(R)for(const l of R)l.mesh.material=l.material};if(R instanceof Array)for(const a of R)j(a);else j(R);l.lastSelected=R}selectVariant(h,R){ih.SelectVariant(h,R)}static Reset(h){const R=this._GetExtensionMetadata(h);if(!R)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Mh} extension`);for(const l of R.original)l.mesh.material=l.material;R.lastSelected=null}reset(h){ih.Reset(h)}static GetLastSelectedVariant(h){const R=this._GetExtensionMetadata(h);if(!R)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Mh} extension`);return R.lastSelected}getLastSelectedVariant(h){return ih.GetLastSelectedVariant(h)}static _GetExtensionMetadata(h){var R,l;return(null===h||void 0===h||null===(R=h._internalMetadata)||void 0===R||null===(l=R.qF)||void 0===l?void 0:l[Mh])||null}onLoading(){const h=this._loader.qF.extensions;if(h&&h[this.name]){const R=h[this.name];this._variants=R.variants}}onReady(){const h=this._loader.rootBabylonMesh;if(h){var R;const l=this._loader.parent.extensionOptions[Mh];null!==l&&void 0!==l&&l.defaultVariant&&ih.SelectVariant(h,l.defaultVariant),null===l||void 0===l||null===(R=l.onLoaded)||void 0===R||R.call(l,{get variants(){return ih.GetAvailableVariants(h)},get selectedVariant(){const R=ih.GetLastSelectedVariant(h);return R?Array.isArray(R)?R[0]:R:ih.GetAvailableVariants(h)[0]},set selectedVariant(R){ih.SelectVariant(h,R)}})}}_loadMeshPrimitiveAsync(h,R,l,j,a,D){return e.LoadExtensionAsync(h,a,this.name,(async(U,F)=>{const w=new Array;return w.push(this._loader._loadMeshPrimitiveAsync(h,R,l,j,a,(R=>{if(D(R),R instanceof y.b){const l=e._GetDrawMode(h,a.mode),j=this._loader.rootBabylonMesh,D=j?j._internalMetadata=j._internalMetadata||{}:{},mh=D.qF=D.qF||{},u=mh[Mh]=mh[Mh]||{lastSelected:null,original:[],variants:{}};u.original.push({mesh:R,material:R.material});for(let h=0;h<F.mappings.length;++h){const a=F.mappings[h],D=C.Get(`${U}/mappings/${h}/material`,this._loader.qF.materials,a.material);w.push(this._loader._loadMaterialAsync(`#/materials/${a.material}`,D,R,l,(h=>{for(let l=0;l<a.variants.length;++l){const D=a.variants[l],U=C.Get(`/extensions/${Mh}/variants/${D}`,this._variants,D);u.variants[U.name]=u.variants[U.name]||[],u.variants[U.name].push({mesh:R,material:h}),R.onClonedObservable.add((h=>{const l=h;let a=null,D=l;do{if(D=D.parent,!D)return;a=ih._GetExtensionMetadata(D)}while(null===a);if(j&&a===ih._GetExtensionMetadata(j)){D._internalMetadata={};for(const h in j._internalMetadata)D._internalMetadata[h]=j._internalMetadata[h];D._internalMetadata.qF=[];for(const h in j._internalMetadata.qF)D._internalMetadata.qF[h]=j._internalMetadata.qF[h];D._internalMetadata.qF[Mh]={lastSelected:null,original:[],variants:{}};for(const h of a.original)D._internalMetadata.qF[Mh].original.push({mesh:h.mesh,material:h.material});for(const h in a.variants)if(Object.prototype.hasOwnProperty.call(a.variants,h)){D._internalMetadata.qF[Mh].variants[h]=[];for(const R of a.variants[h])D._internalMetadata.qF[Mh].variants[h].push({mesh:R.mesh,material:R.material})}a=D._internalMetadata.qF[Mh]}for(const j of a.original)j.mesh===R&&(j.mesh=l);for(const j of a.variants[U.name])j.mesh===R&&(j.mesh=l)}))}})))}}}))),await Promise.all(w).then((h=>{let[R]=h;return R}))}))}}W(Mh),K(Mh,!0,(h=>new ih(h)));var dh=l(12974);class Xh{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Ch.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(h,R){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Xh._GetDefaultOptions(),...h},this._scene=R,this._scene._transmissionHelper=this,this.onErrorObservable=new u.d,this._scene.mw.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(h){if(!Object.keys(h).filter((R=>this._options[R]!==h[R])).length)return;const R={...this._options,...h},l=this._options;this._options=R,R.renderSize===l.renderSize&&R.renderTargetTextureType===l.renderTargetTextureType&&R.generateMipmaps===l.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=R.samples,this._opaqueRenderTarget.lodGenerationScale=R.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=R.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(h){return!!h&&!!(h instanceof T.b&&h.subSurface.isRefractionEnabled)}_addMesh(h){this._materialObservers[h.uniqueId]=h.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),U.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(h.material)?(h.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(h)&&this._transparentMeshesCache.push(h)):-1===this._opaqueMeshesCache.indexOf(h)&&this._opaqueMeshesCache.push(h)}))}_removeMesh(h){h.onMaterialChangedObservable.remove(this._materialObservers[h.uniqueId]),delete this._materialObservers[h.uniqueId];let R=this._transparentMeshesCache.indexOf(h);-1!==R&&this._transparentMeshesCache.splice(R,1),R=this._opaqueMeshesCache.indexOf(h),-1!==R&&this._opaqueMeshesCache.splice(R,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(h){const R=this._transparentMeshesCache.indexOf(h),l=this._opaqueMeshesCache.indexOf(h);this._shouldRenderAsTransmission(h.material)?(h.material instanceof T.b&&(h.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==l?(this._opaqueMeshesCache.splice(l,1),this._transparentMeshesCache.push(h)):-1===R&&this._transparentMeshesCache.push(h)):-1!==R?(this._transparentMeshesCache.splice(R,1),this._opaqueMeshesCache.push(h)):-1===l&&this._opaqueMeshesCache.push(h)}_isRenderTargetValid(){var h;return null!==(null===(h=this._opaqueRenderTarget)||void 0===h?void 0:h.getInternalTexture())}_setupRenderTargets(){var h;let R;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new dh.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(h=this._options.clearColor)||void 0===h?void 0:h.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((h=>{R=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?h.clearColor.D(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(h.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=R}));for(const l of this._transparentMeshesCache)this._shouldRenderAsTransmission(l.material)&&(l.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Vh="KHR_materials_transmission";class Bh{constructor(h){this.name=Vh,this.order=175,this._loader=h,this.enabled=this._loader.isExtensionUsed(Vh),this.enabled&&(h.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadTransparentPropertiesAsync(j,R,l,a)),await Promise.all(D).then((()=>{}))}))}_loadTransparentPropertiesAsync(h,R,l,j){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const a=l;if(a.subSurface.isRefractionEnabled=!0,a.subSurface.volumeIndexOfRefraction=1,a.subSurface.useAlbedoToTintRefraction=!0,void 0===j.transmissionFactor)return a.subSurface.refractionIntensity=0,a.subSurface.isRefractionEnabled=!1,Promise.resolve();{var D;a.subSurface.refractionIntensity=j.transmissionFactor;const h=a.yh();if(a.subSurface.refractionIntensity&&!h._transmissionHelper)new Xh({},a.yh());else if(a.subSurface.refractionIntensity&&(null===(D=h._transmissionHelper)||void 0===D||!D._isRenderTargetValid())){var U;null===(U=h._transmissionHelper)||void 0===U||U._setupRenderTargets()}}return a.subSurface.minimumThickness=0,a.subSurface.maximumThickness=0,j.transmissionTexture?(j.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${h}/transmissionTexture`,j.transmissionTexture,void 0).then((h=>{h.name=`${l.name} (Transmission)`,a.subSurface.refractionIntensityTexture=h,a.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}W(Vh),K(Vh,!0,(h=>new Bh(h)));const Nh="KHR_materials_diffuse_transmission";class hR{constructor(h){this.name=Nh,this.order=174,this._loader=h,this.enabled=this._loader.isExtensionUsed(Nh),this.enabled&&(h.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadTranslucentPropertiesAsync(j,R,l,a)),await Promise.all(D).then((()=>{}))}))}_loadTranslucentPropertiesAsync(h,R,l,j){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const a=l;if(a.subSurface.isTranslucencyEnabled=!0,a.subSurface.volumeIndexOfRefraction=1,a.subSurface.minimumThickness=0,a.subSurface.maximumThickness=0,a.subSurface.useAlbedoToTintTranslucency=!1,void 0===j.diffuseTransmissionFactor)return a.subSurface.translucencyIntensity=0,a.subSurface.isTranslucencyEnabled=!1,Promise.resolve();a.subSurface.translucencyIntensity=j.diffuseTransmissionFactor;const U=new Array;return a.subSurface.useGltfStyleTextures=!0,j.diffuseTransmissionTexture&&(j.diffuseTransmissionTexture.nonColorData=!0,U.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTransmissionTexture`,j.diffuseTransmissionTexture).then((h=>{h.name=`${l.name} (Diffuse Transmission)`,a.subSurface.translucencyIntensityTexture=h})))),void 0!==j.diffuseTransmissionColorFactor?a.subSurface.translucencyColor=D.xR.GR(j.diffuseTransmissionColorFactor):a.subSurface.translucencyColor=D.xR.White(),j.diffuseTransmissionColorTexture&&U.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTransmissionColorTexture`,j.diffuseTransmissionColorTexture).then((h=>{h.name=`${l.name} (Diffuse Transmission Color)`,a.subSurface.translucencyColorTexture=h}))),Promise.all(U).then((()=>{}))}}W(Nh),K(Nh,!0,(h=>new hR(h)));const RR="KHR_materials_volume";class lR{constructor(h){this.name=RR,this.order=173,this._loader=h,this.enabled=this._loader.isExtensionUsed(RR),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadVolumePropertiesAsync(j,R,l,a)),await Promise.all(D).then((()=>{}))}))}_loadVolumePropertiesAsync(h,R,l,j){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);if(!l.subSurface.isRefractionEnabled&&!l.subSurface.isTranslucencyEnabled||!j.thicknessFactor)return Promise.resolve();l.subSurface.volumeIndexOfRefraction=l.indexOfRefraction;const a=void 0!==j.attenuationDistance?j.attenuationDistance:Number.MAX_VALUE;return l.subSurface.tintColorAtDistance=a,void 0!==j.attenuationColor&&3==j.attenuationColor.length&&l.subSurface.tintColor.OF(j.attenuationColor[0],j.attenuationColor[1],j.attenuationColor[2]),l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=j.thicknessFactor,l.subSurface.useThicknessAsDepth=!0,j.thicknessTexture?(j.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${h}/thicknessTexture`,j.thicknessTexture).then((h=>{h.name=`${l.name} (Thickness)`,l.subSurface.thicknessTexture=h,l.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}W(RR),K(RR,!0,(h=>new lR(h)));const jR="KHR_materials_dispersion";class aR{constructor(h){this.name=jR,this.order=174,this._loader=h,this.enabled=this._loader.isExtensionUsed(jR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadDispersionPropertiesAsync(j,R,l,a)),await Promise.all(D).then((()=>{}))}))}_loadDispersionPropertiesAsync(h,R,l,j){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);return l.subSurface.isRefractionEnabled&&j.dispersion?(l.subSurface.isDispersionEnabled=!0,l.subSurface.dispersion=j.dispersion,Promise.resolve()):Promise.resolve()}}W(jR),K(jR,!0,(h=>new aR(h)));const DR="EXT_materials_diffuse_roughness";class UR{constructor(h){this.name=DR,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(DR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=new Array;return D.push(this._loader.loadMaterialPropertiesAsync(h,R,l)),D.push(this._loadDiffuseRoughnessPropertiesAsync(j,a,l)),await Promise.all(D).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(h,R,l){if(!(l instanceof T.b))throw new Error(`${h}: Material type not supported`);const j=new Array;return l.brdf.baseDiffuseModel=Ch.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=R.diffuseRoughnessFactor?l.baseDiffuseRoughness=R.diffuseRoughnessFactor:l.baseDiffuseRoughness=0,R.diffuseRoughnessTexture&&j.push(this._loader.loadTextureInfoAsync(`${h}/diffuseRoughnessTexture`,R.diffuseRoughnessTexture,(h=>{h.name=`${l.name} (Diffuse Roughness)`,l.baseDiffuseRoughnessTexture=h}))),Promise.all(j).then((()=>{}))}}W(DR),K(DR,!0,(h=>new UR(h)));const FR="KHR_mesh_quantization";class wR{constructor(h){this.name=FR,this.enabled=h.isExtensionUsed(FR)}dispose(){}}W(FR),K(FR,!0,(h=>new wR(h)));const ml="KHR_texture_basisu";class uR{constructor(h){this.name=ml,this._loader=h,this.enabled=h.isExtensionUsed(ml)}dispose(){this._loader=null}_loadTextureAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>{const D=void 0==R.sampler?e.DefaultSampler:C.Get(`${h}/sampler`,this._loader.qF.samplers,R.sampler),U=C.Get(`${j}/source`,this._loader.qF.images,a.source);return await this._loader._createTextureAsync(h,D,U,(h=>{l(h)}),R._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!R._textureInfo.nonColorData)}))}}W(ml),K(ml,!0,(h=>new uR(h)));const cR="KHR_texture_transform";class JR{constructor(h){this.name=cR,this._loader=h,this.enabled=this._loader.isExtensionUsed(cR)}dispose(){this._loader=null}loadTextureInfoAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(j,a)=>await this._loader.loadTextureInfoAsync(h,R,(h=>{if(!(h instanceof E.b))throw new Error(`${j}: Texture type not supported`);a.offset&&(h.uOffset=a.offset[0],h.vOffset=a.offset[1]),h.uRotationCenter=0,h.vRotationCenter=0,a.rotation&&(h.wAng=-a.rotation),a.scale&&(h.uScale=a.scale[0],h.vScale=a.scale[1]),void 0!=a.texCoord&&(h.coordinatesIndex=a.texCoord),l(h)}))))}}W(cR),K(cR,!0,(h=>new JR(h)));const qR="KHR_xmp_json_ld";class QR{constructor(h){this.name=qR,this.order=100,this._loader=h,this.enabled=this._loader.isExtensionUsed(qR)}dispose(){this._loader=null}onLoading(){var h,R,l;if(null===this._loader.rootBabylonMesh)return;const j=null===(h=this._loader.qF.extensions)||void 0===h?void 0:h.KHR_xmp_json_ld,a=null===(R=this._loader.qF.asset)||void 0===R||null===(l=R.extensions)||void 0===l?void 0:l.KHR_xmp_json_ld;if(j&&a){const h=+a.packet;j.packets&&h<j.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=j.packets[h])}}}function YR(h,R,l,j){return D.xR.GR(R,l).scale(j)}function sR(h,R,l,j){return R[l]*j}function tR(h,R,l,j){return-R[l]*j}function fR(h,R,l,j){return R[l+1]*j}function TR(h,R,l,j){return R[l]*j*2}function ER(h){return{scale:[new GR(J.b.ANIMATIONTYPE_FLOAT,`${h}.uScale`,sR,(()=>2)),new GR(J.b.ANIMATIONTYPE_FLOAT,`${h}.vScale`,fR,(()=>2))],offset:[new GR(J.b.ANIMATIONTYPE_FLOAT,`${h}.uOffset`,sR,(()=>2)),new GR(J.b.ANIMATIONTYPE_FLOAT,`${h}.vOffset`,fR,(()=>2))],rotation:[new GR(J.b.ANIMATIONTYPE_FLOAT,`${h}.wAng`,tR,(()=>1))]}}W(qR),K(qR,!0,(h=>new QR(h)));class xR extends S.AnimationPropertyInfo{buildAnimations(h,R,l,j){return[{babylonAnimatable:h._babylonCamera,babylonAnimation:this._buildAnimation(R,l,j)}]}}class GR extends S.AnimationPropertyInfo{buildAnimations(h,R,l,j){const a=[];for(const D in h._data)a.push({babylonAnimatable:h._data[D].babylonMaterial,babylonAnimation:this._buildAnimation(R,l,j)});return a}}class pR extends S.AnimationPropertyInfo{buildAnimations(h,R,l,j){return[{babylonAnimatable:h._babylonLight,babylonAnimation:this._buildAnimation(R,l,j)}]}}(0,g.n)("/cameras/{}/orthographic/xmag",[new xR(J.b.ANIMATIONTYPE_FLOAT,"orthoLeft",tR,(()=>1)),new xR(J.b.ANIMATIONTYPE_FLOAT,"orthoRight",fR,(()=>1))]),(0,g.n)("/cameras/{}/orthographic/ymag",[new xR(J.b.ANIMATIONTYPE_FLOAT,"orthoBottom",tR,(()=>1)),new xR(J.b.ANIMATIONTYPE_FLOAT,"orthoTop",fR,(()=>1))]),(0,g.n)("/cameras/{}/orthographic/zfar",[new xR(J.b.ANIMATIONTYPE_FLOAT,"maxZ",sR,(()=>1))]),(0,g.n)("/cameras/{}/orthographic/znear",[new xR(J.b.ANIMATIONTYPE_FLOAT,"fF",sR,(()=>1))]),(0,g.n)("/cameras/{}/perspective/yfov",[new xR(J.b.ANIMATIONTYPE_FLOAT,"fov",sR,(()=>1))]),(0,g.n)("/cameras/{}/perspective/zfar",[new xR(J.b.ANIMATIONTYPE_FLOAT,"maxZ",sR,(()=>1))]),(0,g.n)("/cameras/{}/perspective/znear",[new xR(J.b.ANIMATIONTYPE_FLOAT,"fF",sR,(()=>1))]),(0,g.n)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new GR(J.b.ANIMATIONTYPE_COLOR3,"albedoColor",YR,(()=>4)),new GR(J.b.ANIMATIONTYPE_FLOAT,"alpha",(function(h,R,l,j){return R[l+3]*j}),(()=>4))]),(0,g.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"metallic",sR,(()=>1))]),(0,g.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"roughness",sR,(()=>1))]);const OR=ER("albedoTexture");(0,g.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",OR.scale),(0,g.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",OR.offset),(0,g.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",OR.rotation);const yR=ER("metallicTexture");(0,g.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",yR.scale),(0,g.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",yR.offset),(0,g.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",yR.rotation),(0,g.n)("/materials/{}/emissiveFactor",[new GR(J.b.ANIMATIONTYPE_COLOR3,"emissiveColor",YR,(()=>3))]);const vR=ER("bumpTexture");(0,g.n)("/materials/{}/normalTexture/scale",[new GR(J.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",sR,(()=>1))]),(0,g.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",vR.scale),(0,g.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",vR.offset),(0,g.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",vR.rotation),(0,g.n)("/materials/{}/occlusionTexture/strength",[new GR(J.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",sR,(()=>1))]);const bR=ER("ambientTexture");(0,g.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",bR.scale),(0,g.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",bR.offset),(0,g.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",bR.rotation);const IR=ER("emissiveTexture");(0,g.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",IR.scale),(0,g.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",IR.offset),(0,g.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",IR.rotation),(0,g.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new GR(J.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new GR(J.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",sR,(()=>1))]);const LR=ER("anisotropy.texture");(0,g.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",LR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",LR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",LR.rotation),(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",sR,(()=>1))]);const nR=ER("clearCoat.texture");(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",nR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",nR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",nR.rotation);const rR=ER("clearCoat.bumpTexture");(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new GR(J.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",rR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",rR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",rR.rotation);const PR=ER("clearCoat.textureRoughness");(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",PR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",PR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",PR.rotation),(0,g.n)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new GR(J.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_ior/ior",[new GR(J.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new GR(J.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new GR(J.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",sR,(()=>1))]);const zR=ER("iridescence.texture");(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",zR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",zR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",zR.rotation);const oR=ER("iridescence.thicknessTexture");(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",oR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",oR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",oR.rotation),(0,g.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new GR(J.b.ANIMATIONTYPE_COLOR3,"sheen.color",YR,(()=>3))]),(0,g.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",sR,(()=>1))]);const KR=ER("sheen.texture");(0,g.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",KR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",KR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",KR.rotation);const WR=ER("sheen.textureRoughness");(0,g.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",WR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",WR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",WR.rotation),(0,g.n)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new GR(J.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",YR,(()=>3))]);const gR=ER("metallicReflectanceTexture");(0,g.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",gR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",gR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",gR.rotation);const HR=ER("reflectanceTexture");(0,g.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",HR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",HR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",HR.rotation),(0,g.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",sR,(()=>1))]);const kR=ER("subSurface.refractionIntensityTexture");(0,g.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",kR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",kR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",kR.rotation),(0,g.n)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new GR(J.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",YR,(()=>3))]),(0,g.n)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new GR(J.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",sR,(()=>1))]),(0,g.n)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",sR,(()=>1))]);const CR=ER("subSurface.thicknessTexture");(0,g.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",CR.scale),(0,g.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",CR.offset),(0,g.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",CR.rotation),(0,g.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new GR(J.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",sR,(()=>1))]);const AR=ER("subSurface.translucencyIntensityTexture");(0,g.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",AR.scale),(0,g.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",AR.offset),(0,g.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",AR.rotation),(0,g.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new GR(J.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",YR,(()=>3))]);const eR=ER("subSurface.translucencyColorTexture");(0,g.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",eR.scale),(0,g.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",eR.offset),(0,g.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",eR.rotation),(0,g.n)("/extensions/KHR_lights_punctual/lights/{}/color",[new pR(J.b.ANIMATIONTYPE_COLOR3,"diffuse",YR,(()=>3))]),(0,g.n)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new pR(J.b.ANIMATIONTYPE_FLOAT,"intensity",sR,(()=>1))]),(0,g.n)("/extensions/KHR_lights_punctual/lights/{}/range",[new pR(J.b.ANIMATIONTYPE_FLOAT,"range",sR,(()=>1))]),(0,g.n)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new pR(J.b.ANIMATIONTYPE_FLOAT,"innerAngle",TR,(()=>1))]),(0,g.n)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new pR(J.b.ANIMATIONTYPE_FLOAT,"angle",TR,(()=>1))]),(0,g.n)("/nodes/{}/extensions/EXT_lights_ies/color",[new pR(J.b.ANIMATIONTYPE_COLOR3,"diffuse",YR,(()=>3))]),(0,g.n)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new pR(J.b.ANIMATIONTYPE_FLOAT,"intensity",sR,(()=>1))]);const SR="KHR_animation_pointer";class ZR{constructor(h){this.name=SR,this._loader=h,this._pathToObjectConverter=(0,g.j)(this._loader.qF)}get enabled(){return this._loader.isExtensionUsed(SR)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(h,R,l,j,a){var D;const U=null===(D=j.target.extensions)||void 0===D?void 0:D.KHR_animation_pointer;if(!U||!this._pathToObjectConverter)return null;"pointer"!==j.target.path&&Y.c.Warn(`${h}/target/path: Value (${j.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=j.target.node&&Y.c.Warn(`${h}/target/node: Value (${j.target.node}) must not be present when using the ${this.name} extension`);const F=`${h}/extensions/${this.name}`,w=U.pointer;if(!w)throw new Error(`${F}: Pointer is missing`);try{const D=this._pathToObjectConverter.convert(w);if(!D.info.interpolation)throw new Error(`${F}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(h,R,l,j,{object:D.object,info:D.info.interpolation},a)}catch(mh){return Y.c.Warn(`${F}/pointer: Invalid pointer (${w}) skipped`),null}}}W(SR),K(SR,!0,(h=>new ZR(h)));class MR{constructor(h,R,l){this.frame=h,this.action=R,this.onlyOnce=l,this.isDone=!1}_clone(){return new MR(this.frame,this.action,this.onlyOnce)}}var iR=l(12733),dR=l(12797),XR=l(12790);class VR{get loop(){return this._loop}set loop(h){h!==this._loop&&(this._loop=h,this.updateOptions({loop:h}))}get currentTime(){var h;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(h=dR.c.audioEngine)&&void 0!==h&&h.audioContext&&(this.isPlaying||this.isPaused)){const h=this.isPaused?0:dR.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+h}return 0}get spatialSound(){return this._spatialSound}set spatialSound(h){if(h==this._spatialSound)return;const R=this.isPlaying;this.pause(),h?(this._spatialSound=h,this._updateSpatialParameters()):this._disableSpatialSound(),R&&this.play()}constructor(h,R,l){var j;let D=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new u.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=a.tR.Zero(),this._localDirection=new a.tR(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=h,l=l||Q.b.LastCreatedScene)if(this._scene=l,VR._SceneComponentInitialization(l),this._readyToPlayCallback=D,this._customAttenuationFunction=(h,R,l,j,a)=>R<l?h*(1-R/l):0,F&&(this.autoplay=F.autoplay||!1,this._loop=F.loop||!1,void 0!==F.volume&&(this._volume=F.volume),this._spatialSound=F.spatialSound??!1,this.maxDistance=F.maxDistance??100,this.useCustomAttenuation=F.useCustomAttenuation??!1,this.rolloffFactor=F.rolloffFactor||1,this.refDistance=F.refDistance||1,this.distanceModel=F.distanceModel||"linear",this._playbackRate=F.playbackRate||1,this._streaming=F.streaming??!1,this._length=F.length,this._offset=F.offset),null!==(j=dR.c.audioEngine)&&void 0!==j&&j.canUseWebAudio&&dR.c.audioEngine.audioContext){this._soundGain=dR.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let h=!0;if(R)try{"string"===typeof R?(this._urlType="String",this._url=R):R instanceof ArrayBuffer?this._urlType="ArrayBuffer":R instanceof HTMLMediaElement?this._urlType="MediaElement":R instanceof MediaStream?this._urlType="MediaStream":R instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(R)&&(this._urlType="Array");let l=[],j=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=dR.c.audioEngine.audioContext.createMediaElementSource(R),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=dR.c.audioEngine.audioContext.createMediaStreamSource(R),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":R.byteLength>0&&(j=!0,this._soundLoaded(R));break;case"AudioBuffer":this._audioBufferLoaded(R);break;case"String":l.push(R);case"Array":0===l.length&&(l=R);for(let h=0;h<l.length;h++){const R=l[h];if(j=F&&F.skipCodecCheck||-1!==R.indexOf(".mp3",R.length-4)&&dR.c.audioEngine.isMP3supported||-1!==R.indexOf(".ogg",R.length-4)&&dR.c.audioEngine.isOGGsupported||-1!==R.indexOf(".wav",R.length-4)||-1!==R.indexOf(".m4a",R.length-4)||-1!==R.indexOf(".mp4",R.length-4)||-1!==R.indexOf("blob:"),j){this._streaming?(this._htmlAudioElement=new Audio(R),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,U.Tools.SetCorsBehavior(R,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(R,(h=>{this._soundLoaded(h)}),void 0,!0,!0,(h=>{h&&Y.c.Error("XHR "+h.status+" error on: "+R+"."),Y.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:h=!1}h?j||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Y.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(w){Y.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),dR.c.audioEngine&&!dR.c.audioEngine.WarnedWebAudioUnsupported&&(Y.c.Error("Web Audio is not supported by your browser."),dR.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var h;null!==(h=dR.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(h){var R;null!==(R=dR.c.audioEngine)&&void 0!==R&&R.audioContext&&(this._audioBuffer=h,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(h){var R;null!==(R=dR.c.audioEngine)&&void 0!==R&&R.audioContext&&dR.c.audioEngine.audioContext.decodeAudioData(h,(h=>{this._audioBufferLoaded(h)}),(h=>{Y.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+h)}))}setAudioBuffer(h){var R;null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&(this._audioBuffer=h,this._isReadyToPlay=!0)}updateOptions(h){h&&(this.loop=h.loop??this.loop,this.maxDistance=h.maxDistance??this.maxDistance,this.useCustomAttenuation=h.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=h.rolloffFactor??this.rolloffFactor,this.refDistance=h.refDistance??this.refDistance,this.distanceModel=h.distanceModel??this.distanceModel,this._playbackRate=h.playbackRate??this._playbackRate,this._length=h.length??void 0,this.spatialSound=h.spatialSound??this._spatialSound,this._setOffset(h.offset??void 0),this.setVolume(h.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var h;null!==(h=dR.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&dR.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??dR.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var h;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(h=this._soundPanner)||void 0===h||h.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var h;null!==(h=dR.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(h){var R;null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(h),this._isOutputConnected=!0)}setDirectionalCone(h,R,l){R<h?Y.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=h,this._coneOuterAngle=R,this._coneOuterGain=l,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(h){if(h!=this._coneInnerAngle){var R;if(this._coneOuterAngle<h)return void Y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=h,null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(h){if(h!=this._coneOuterAngle){var R;if(h<this._coneInnerAngle)return void Y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=h,null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(h){var R;h.equals(this._position)||(this._position.D(h),null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(h){var R;this._localDirection=h,null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const h=this._connectedTransformNode.getWorldMatrix(),R=a.tR.TransformNormal(this._localDirection,h);R.normalize(),this._soundPanner.orientationX.value=R.x,this._soundPanner.orientationY.value=R.y,this._soundPanner.orientationZ.value=R.z}updateDistanceFromListener(){var h;if(null!==(h=dR.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const h=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.fR(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,h,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(h){this._customAttenuationFunction=h}play(h,R,l){var j;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(j=dR.c.audioEngine)&&void 0!==j&&j.audioContext)try{var a,D;this._clearTimeoutsAndObservers();let j=h?(null===(a=dR.c.audioEngine)||void 0===a?void 0:a.audioContext.currentTime)+h:null===(D=dR.c.audioEngine)||void 0===D?void 0:D.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=dR.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const h=()=>{var l;if(null!==(l=dR.c.audioEngine)&&void 0!==l&&l.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=R??0;const l=this._htmlAudioElement.play();void 0!==l&&l.catch((()=>{var R,l;(null===(R=dR.c.audioEngine)||void 0===R||R.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(l=dR.c.audioEngine)||void 0===l?void 0:l.onAudioUnlockedObservable.addOnce((()=>{h()})))}))}else{var j;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(j=dR.c.audioEngine)||void 0===j?void 0:j.onAudioUnlockedObservable.addOnce((()=>{h()}))}};h()}}else{var U;const a=()=>{var a;if(null!==(a=dR.c.audioEngine)&&void 0!==a&&a.audioContext){var D;if(l=l||this._length,void 0!==R&&this._setOffset(R),this._soundSource){const h=this._soundSource;h.onended=()=>{h.disconnect()}}if(this._soundSource=null===(D=dR.c.audioEngine)||void 0===D?void 0:D.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var U;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==R&&(this._soundSource.loopStart=R),void 0!==l&&(this._soundSource.loopEnd=(0|R)+l),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},j=h?(null===(U=dR.c.audioEngine)||void 0===U?void 0:U.audioContext.currentTime)+h:dR.c.audioEngine.audioContext.currentTime;const a=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(j,a,this.loop?void 0:l)}}};"suspended"===(null===(U=dR.c.audioEngine)||void 0===U?void 0:U.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var h;"suspended"===(null===(h=dR.c.audioEngine)||void 0===h?void 0:h.audioContext.state)?(dR.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=dR.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{a()})))):a()}),500):a()}this._startTime=j,this.isPlaying=!0,this.isPaused=!1}catch(F){Y.c.Error("Error while trying to play audio: "+this.name+", "+F.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(h){var R;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var l;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(l=this._streamingSource)||void 0===l||l.disconnect();this.isPlaying=!1}else if(null!==(R=dR.c.audioEngine)&&void 0!==R&&R.audioContext&&this._soundSource){const R=h?dR.c.audioEngine.audioContext.currentTime+h:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(R)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var h;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var R;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(R=this._streamingSource)||void 0===R||R.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(h=dR.c.audioEngine)&&void 0!==h&&h.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=dR.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(h,R){var l;null!==(l=dR.c.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._soundGain&&(R&&dR.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(dR.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,dR.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(h,dR.c.audioEngine.audioContext.currentTime+R)):this._soundGain.gain.value=h),this._volume=h}setPlaybackRate(h){this._playbackRate=h,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(h){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=h,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=h=>this._onRegisterAfterWorldMatrixUpdate(h),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(h){var R;if(h.getBoundingInfo){const R=h.getBoundingInfo();this.setPosition(R.boundingSphere.centerWorld)}else this.setPosition(h.absolutePosition);null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const h=()=>{(0,XR.c)((()=>this._isReadyToPlay),(()=>{l._audioBuffer=this.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play(0,this._offset,this._length)}),void 0,300)},R={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},l=new VR(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,R);return this.useCustomAttenuation&&l.setAttenuationFunction(this._customAttenuationFunction),l.setPosition(this._position),l.setPlaybackRate(this._playbackRate),h(),l}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const h={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(h.connectedMeshId=this._connectedTransformNode.id),h.position=this._position.sF(),h.refDistance=this.refDistance,h.distanceModel=this.distanceModel,h.isDirectional=this._isDirectional,h.localDirectionToMesh=this._localDirection.sF(),h.coneInnerAngle=this._coneInnerAngle,h.coneOuterAngle=this._coneOuterAngle,h.coneOuterGain=this._coneOuterGain),h}static Parse(h,R,l,j){const D=h.name;let U;U=h.url?l+h.url:l+D;const F={autoplay:h.autoplay,loop:h.loop,volume:h.volume,spatialSound:h.spatialSound,maxDistance:h.maxDistance,rolloffFactor:h.rolloffFactor,refDistance:h.refDistance,distanceModel:h.distanceModel,playbackRate:h.playbackRate};let w;if(j){const h=()=>{(0,XR.c)((()=>j._isReadyToPlay),(()=>{w._audioBuffer=j.getAudioBuffer(),w._isReadyToPlay=!0,w.autoplay&&w.play(0,w._offset,w._length)}),void 0,300)};w=new VR(D,new ArrayBuffer(0),R,null,F),h()}else w=new VR(D,U,R,(()=>{R.removePendingData(w)}),F),R.addPendingData(w);if(h.position){const R=a.tR.GR(h.position);w.setPosition(R)}if(h.isDirectional&&(w.setDirectionalCone(h.coneInnerAngle||360,h.coneOuterAngle||360,h.coneOuterGain||0),h.localDirectionToMesh)){const R=a.tR.GR(h.localDirectionToMesh);w.setLocalDirectionToMesh(R)}if(h.connectedMeshId){const l=R.getMeshById(h.connectedMeshId);l&&w.attachToMesh(l)}return h.metadata&&(w.metadata=h.metadata),w}_setOffset(h){this._offset!==h&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=h)}_clearTimeoutsAndObservers(){var h;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(h=dR.c.audioEngine)||void 0===h||h.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}VR._SceneComponentInitialization=h=>{throw(0,iR.b)("AudioSceneComponent")},(0,Gh.f)("BABYLON.Sound",VR);class BR{constructor(h,R,l){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],R.length!==l.length)throw new Error("Sounds length does not equal weights length");this.loop=h,this._weights=l;let j=0;for(const D of l)j+=D;const a=j>0?1/j:0;for(let D=0;D<this._weights.length;D++)this._weights[D]*=a;this._sounds=R;for(const D of this._sounds)D.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(h){if(h!==this._coneInnerAngle){if(this._coneOuterAngle<h)return void Y.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=h;for(const R of this._sounds)R.directionalConeInnerAngle=h}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(h){if(h!==this._coneOuterAngle){if(h<this._coneInnerAngle)return void Y.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=h;for(const R of this._sounds)R.directionalConeOuterAngle=h}}get volume(){return this._volume}set volume(h){if(h!==this._volume)for(const R of this._sounds)R.setVolume(h)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(h){if(!this.isPaused){this.stop();const h=Math.random();let R=0;for(let l=0;l<this._weights.length;l++)if(R+=this._weights[l],h<=R){this._currentIndex=l;break}}const R=this._sounds[this._currentIndex??0];R.isReady()?R.play(0,this.isPaused?void 0:h):R.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class NR{constructor(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(h=h||Q.b.LastCreatedScene)&&(this._scene=h,this.soundCollection=[],this._options=R,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var h;null!==(h=dR.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&dR.c.audioEngine.audioContext&&(this._outputAudioNode=dR.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(dR.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(dR.c.audioEngine&&dR.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(h){var R;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._outputAudioNode&&h.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==h.soundTrackId&&(-1===h.soundTrackId?this._scene.mainSoundTrack.removeSound(h):this._scene.soundTracks&&this._scene.soundTracks[h.soundTrackId].removeSound(h)),this.soundCollection.push(h),h.soundTrackId=this.id}removeSound(h){const R=this.soundCollection.indexOf(h);-1!==R&&this.soundCollection.splice(R,1)}setVolume(h){var R;null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=h)}switchPanningModelToHRTF(){var h;if(null!==(h=dR.c.audioEngine)&&void 0!==h&&h.canUseWebAudio)for(let R=0;R<this.soundCollection.length;R++)this.soundCollection[R].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var h;if(null!==(h=dR.c.audioEngine)&&void 0!==h&&h.canUseWebAudio)for(let R=0;R<this.soundCollection.length;R++)this.soundCollection[R].switchPanningModelToEqualPower()}connectToAnalyser(h){var R;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=h,null!==(R=dR.c.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,dR.c.audioEngine.masterGain))}}var hl=l(13151),Rl=l(13126),ll=l(12705);dR.c.AudioEngineFactory=(h,R,l)=>new jl(h,R,l);class jl{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new u.d,this.onAudioLockedObservable=new u.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ll.n)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const j=document.createElement("audio");this._hostElement=h,this._audioContext=R,this._audioDestination=l;try{j&&j.canPlayType&&(j.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||j.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(a){}try{j&&j.canPlayType&&j.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(a){}}lock(){this._triggerSuspendedState()}unlock(){var h,R;if("running"===(null===(h=this._audioContext)||void 0===h?void 0:h.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(R=this._audioContext)||void 0===R||R.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{Y.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var h;null===(h=this._audioContext)||void 0===h||h.addEventListener("statechange",(()=>{var h;this.unlocked&&"running"!==(null===(h=this._audioContext)||void 0===h?void 0:h.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var h;return null!==(h=this._audioContext)&&void 0!==h&&h.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(h){this.canUseWebAudio=!1,Y.c.Error("Web Audio: "+h.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(h){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const h=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",R=document.createElement("style");R.appendChild(document.createTextNode(h)),document.getElementsByTagName("head")[0].appendChild(R),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var h;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(h=this._audioContext)||void 0===h||h.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(h){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=h)}connectToAnalyser(h){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=h,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var al=l(12724);(0,l(14288).f)(hl.c.NAME_AUDIO,((h,R,l,j)=>{let a,D=[];if(l.Oq=l.Oq||[],void 0!==h.Oq&&null!==h.Oq)for(let F=0,w=h.Oq.length;F<w;F++){var U;const w=h.Oq[F];null!==(U=dR.c.audioEngine)&&void 0!==U&&U.canUseWebAudio?(w.url||(w.url=w.name),D[w.url]?l.Oq.push(VR.Parse(w,R,j,D[w.url])):(a=VR.Parse(w,R,j),D[w.url]=a,l.Oq.push(a))):l.Oq.push(new VR(w.name,null,R))}D=[]})),Object.defineProperty(Rl.e.prototype,"mainSoundTrack",{get:function(){let h=this._getComponent(hl.c.NAME_AUDIO);return h||(h=new Dl(this),this.DF(h)),this._mainSoundTrack||(this._mainSoundTrack=new NR(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Rl.e.prototype.getSoundByName=function(h){let R;for(R=0;R<this.mainSoundTrack.soundCollection.length;R++)if(this.mainSoundTrack.soundCollection[R].name===h)return this.mainSoundTrack.soundCollection[R];if(this.soundTracks)for(let l=0;l<this.soundTracks.length;l++)for(R=0;R<this.soundTracks[l].soundCollection.length;R++)if(this.soundTracks[l].soundCollection[R].name===h)return this.soundTracks[l].soundCollection[R];return null},Object.defineProperty(Rl.e.prototype,"audioEnabled",{get:function(){let h=this._getComponent(hl.c.NAME_AUDIO);return h||(h=new Dl(this),this.DF(h)),h.audioEnabled},set:function(h){let R=this._getComponent(hl.c.NAME_AUDIO);R||(R=new Dl(this),this.DF(R)),h?R.enableAudio():R.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Rl.e.prototype,"headphone",{get:function(){let h=this._getComponent(hl.c.NAME_AUDIO);return h||(h=new Dl(this),this.DF(h)),h.headphone},set:function(h){let R=this._getComponent(hl.c.NAME_AUDIO);R||(R=new Dl(this),this.DF(R)),h?R.switchAudioModeForHeadphones():R.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Rl.e.prototype,"audioListenerPositionProvider",{get:function(){let h=this._getComponent(hl.c.NAME_AUDIO);return h||(h=new Dl(this),this.DF(h)),h.audioListenerPositionProvider},set:function(h){let R=this._getComponent(hl.c.NAME_AUDIO);if(R||(R=new Dl(this),this.DF(R)),h&&"function"!==typeof h)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");R.audioListenerPositionProvider=h},enumerable:!0,configurable:!0}),Object.defineProperty(Rl.e.prototype,"audioListenerRotationProvider",{get:function(){let h=this._getComponent(hl.c.NAME_AUDIO);return h||(h=new Dl(this),this.DF(h)),h.audioListenerRotationProvider},set:function(h){let R=this._getComponent(hl.c.NAME_AUDIO);if(R||(R=new Dl(this),this.DF(R)),h&&"function"!==typeof h)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");R.audioListenerRotationProvider=h},enumerable:!0,configurable:!0}),Object.defineProperty(Rl.e.prototype,"audioPositioningRefreshRate",{get:function(){let h=this._getComponent(hl.c.NAME_AUDIO);return h||(h=new Dl(this),this.DF(h)),h.audioPositioningRefreshRate},set:function(h){let R=this._getComponent(hl.c.NAME_AUDIO);R||(R=new Dl(this),this.DF(R)),R.audioPositioningRefreshRate=h},enumerable:!0,configurable:!0});class Dl{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(h){this.name=hl.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new a.tR,this._cachedCameraPosition=new a.tR,this._lastCheck=0,this._invertMatrixTemp=new a.Matrix,this._cameraDirectionTemp=new a.tR,(h=h||Q.b.LastCreatedScene)&&(this.TR=h,h.soundTracks=[],h.Oq=[])}register(){this.TR._afterRenderStage.registerStep(hl.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(h){if(h.Oq=[],this.TR.soundTracks)for(let R=0;R<this.TR.soundTracks.length;R++){const l=this.TR.soundTracks[R];for(let R=0;R<l.soundCollection.length;R++)h.Oq.push(l.soundCollection[R].serialize())}}addFromContainer(h){if(h.Oq)for(const R of h.Oq)R.play(),R.autoplay=!0,this.TR.mainSoundTrack.addSound(R)}removeFromContainer(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h.Oq)for(const l of h.Oq)l.stop(),l.autoplay=!1,this.TR.mainSoundTrack.removeSound(l),R&&l.dispose()}dispose(){const h=this.TR;if(h._mainSoundTrack&&h.mainSoundTrack.dispose(),h.soundTracks)for(let R=0;R<h.soundTracks.length;R++)h.soundTracks[R].dispose()}disableAudio(){const h=this.TR;let R;for(this._audioEnabled=!1,dR.c.audioEngine&&dR.c.audioEngine.audioContext&&dR.c.audioEngine.audioContext.suspend(),R=0;R<h.mainSoundTrack.soundCollection.length;R++)h.mainSoundTrack.soundCollection[R].pause();if(h.soundTracks)for(R=0;R<h.soundTracks.length;R++)for(let l=0;l<h.soundTracks[R].soundCollection.length;l++)h.soundTracks[R].soundCollection[l].pause()}enableAudio(){const h=this.TR;let R;for(this._audioEnabled=!0,dR.c.audioEngine&&dR.c.audioEngine.audioContext&&dR.c.audioEngine.audioContext.resume(),R=0;R<h.mainSoundTrack.soundCollection.length;R++)h.mainSoundTrack.soundCollection[R].isPaused&&h.mainSoundTrack.soundCollection[R].play();if(h.soundTracks)for(R=0;R<h.soundTracks.length;R++)for(let l=0;l<h.soundTracks[R].soundCollection.length;l++)h.soundTracks[R].soundCollection[l].isPaused&&h.soundTracks[R].soundCollection[l].play()}switchAudioModeForHeadphones(){const h=this.TR;if(this._headphone=!0,h.mainSoundTrack.switchPanningModelToHRTF(),h.soundTracks)for(let R=0;R<h.soundTracks.length;R++)h.soundTracks[R].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const h=this.TR;if(this._headphone=!1,h.mainSoundTrack.switchPanningModelToEqualPower(),h.soundTracks)for(let R=0;R<h.soundTracks.length;R++)h.soundTracks[R].switchPanningModelToEqualPower()}_afterRender(){const h=al.e.Now;if(this._lastCheck&&h-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=h;const R=this.TR;if(!this._audioEnabled||!R._mainSoundTrack||!R.soundTracks||0===R._mainSoundTrack.soundCollection.length&&1===R.soundTracks.length)return;const l=dR.c.audioEngine;if(l&&l.audioContext){let h,j=R.activeCamera;if(R.activeCameras&&R.activeCameras.length>0&&(j=R.activeCameras[0]),this.audioListenerPositionProvider){const h=this.audioListenerPositionProvider();l.audioContext.listener.setPosition(h.x||0,h.y||0,h.z||0)}else j?this._cachedCameraPosition.equals(j.globalPosition)||(this._cachedCameraPosition.D(j.globalPosition),l.audioContext.listener.setPosition(j.globalPosition.x,j.globalPosition.y,j.globalPosition.z)):l.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const h=this.audioListenerRotationProvider();l.audioContext.listener.setOrientation(h.x||0,h.y||0,h.z||0,0,1,0)}else j?(j.rigCameras&&j.rigCameras.length>0&&(j=j.rigCameras[0]),j.getViewMatrix().invertToRef(this._invertMatrixTemp),a.tR.TransformNormalToRef(Dl._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.D(this._cameraDirectionTemp),l.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):l.audioContext.listener.setOrientation(0,0,0,0,1,0);for(h=0;h<R.mainSoundTrack.soundCollection.length;h++){const l=R.mainSoundTrack.soundCollection[h];l.useCustomAttenuation&&l.updateDistanceFromListener()}if(R.soundTracks)for(h=0;h<R.soundTracks.length;h++)for(let l=0;l<R.soundTracks[h].soundCollection.length;l++){const j=R.soundTracks[h].soundCollection[l];j.useCustomAttenuation&&j.updateDistanceFromListener()}}}}Dl._CameraDirection=new a.tR(0,0,-1),VR._SceneComponentInitialization=h=>{let R=h._getComponent(hl.c.NAME_AUDIO);R||(R=new Dl(h),h.DF(R))};const Ul="MSFT_audio_emitter";class Fl{constructor(h){this.name=Ul,this._loader=h,this.enabled=this._loader.isExtensionUsed(Ul)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const h=this._loader.qF.extensions;if(h&&h[this.name]){const R=h[this.name];this._clips=R.clips,this._emitters=R.emitters,C.Assign(this._clips),C.Assign(this._emitters)}}loadSceneAsync(h,R){return e.LoadExtensionAsync(h,R,this.name,(async(l,j)=>{const a=new Array;a.push(this._loader.loadSceneAsync(h,R));for(const h of j.emitters){const R=C.Get(`${l}/emitters`,this._emitters,h);if(void 0!=R.refDistance||void 0!=R.maxDistance||void 0!=R.rolloffFactor||void 0!=R.distanceModel||void 0!=R.innerAngle||void 0!=R.outerAngle)throw new Error(`${l}: Direction or Distance properties are not allowed on emitters attached to a scene`);a.push(this._loadEmitterAsync(`${l}/emitters/${R.index}`,R))}await Promise.all(a)}))}loadNodeAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(h,j)=>{const D=new Array,F=await this._loader.loadNodeAsync(h,R,(R=>{for(const l of j.emitters){const j=C.Get(`${h}/emitters`,this._emitters,l);D.push(this._loadEmitterAsync(`${h}/emitters/${j.index}`,j).then((()=>{for(const h of j._babylonSounds)h.attachToMesh(R),void 0==j.innerAngle&&void 0==j.outerAngle||(h.setLocalDirectionToMesh(a.tR.Forward()),h.setDirectionalCone(2*U.Tools.ToDegrees(void 0==j.innerAngle?Math.PI:j.innerAngle),2*U.Tools.ToDegrees(void 0==j.outerAngle?Math.PI:j.outerAngle),0))})))}l(R)}));return await Promise.all(D),F}))}loadAnimationAsync(h,R){return e.LoadExtensionAsync(h,R,this.name,(async(l,j)=>{const a=await this._loader.loadAnimationAsync(h,R),D=new Array;C.Assign(j.events);for(const U of j.events)D.push(this._loadAnimationEventAsync(`${l}/events/${U.index}`,h,R,U,a));return await Promise.all(D),a}))}_loadClipAsync(h,R){if(R._objectURL)return R._objectURL;let l;if(R.uri)l=this._loader.loadUriAsync(h,R,R.uri);else{const j=C.Get(`${h}/bufferView`,this._loader.qF.bufferViews,R.bufferView);l=this._loader.loadBufferViewAsync(`/bufferViews/${j.index}`,j)}return R._objectURL=l.then((h=>URL.createObjectURL(new Blob([h],{type:R.mimeType})))),R._objectURL}_loadEmitterAsync(h,R){if(R._babylonSounds=R._babylonSounds||[],!R._babylonData){const h=new Array,l=R.name||`emitter${R.index}`,j={loop:!1,autoplay:!1,volume:void 0==R.volume?1:R.volume};for(let D=0;D<R.clips.length;D++){const a=`/extensions/${this.name}/clips`,U=C.Get(a,this._clips,R.clips[D].clip);h.push(this._loadClipAsync(`${a}/${R.clips[D].clip}`,U).then((h=>{const a=R._babylonSounds[D]=new VR(l,h,this._loader.babylonScene,null,j);a.refDistance=R.refDistance||1,a.maxDistance=R.maxDistance||256,a.rolloffFactor=R.rolloffFactor||1,a.distanceModel=R.distanceModel||"exponential"})))}const a=Promise.all(h).then((()=>{const h=R.clips.map((h=>h.weight||1)),l=new BR(R.loop||!1,R._babylonSounds,h);R.innerAngle&&(l.directionalConeInnerAngle=2*U.Tools.ToDegrees(R.innerAngle)),R.outerAngle&&(l.directionalConeOuterAngle=2*U.Tools.ToDegrees(R.outerAngle)),R.volume&&(l.volume=R.volume),R._babylonData.sound=l}));R._babylonData={loaded:a}}return R._babylonData.loaded}_getEventAction(h,R,l,j,a){switch(l){case"play":return h=>{const l=(a||0)+(h-j);R.play(l)};case"stop":return()=>{R.stop()};case"pause":return()=>{R.pause()};default:throw new Error(`${h}: Unsupported action ${l}`)}}_loadAnimationEventAsync(h,R,l,j,a){if(0==a.targetedAnimations.length)return Promise.resolve();const D=a.targetedAnimations[0],U=j.UR,F=C.Get(`/extensions/${this.name}/emitters`,this._emitters,U);return this._loadEmitterAsync(h,F).then((()=>{const R=F._babylonData.sound;if(R){const l=new MR(j.time,this._getEventAction(h,R,j.action,j.time,j.startOffset));D.animation.addEvent(l),a.onAnimationGroupEndObservable.add((()=>{R.stop()})),a.onAnimationGroupPauseObservable.add((()=>{R.pause()}))}}))}}W(Ul),K(Ul,!0,(h=>new Fl(h)));const wl="MSFT_lod";class mj{constructor(h){var R;this.name=wl,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new u.d,this.onMaterialLODsLoadedObservable=new u.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=h,this.maxLODsToLoad=(null===(R=this._loader.parent.extensionOptions[wl])||void 0===R?void 0:R.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(wl)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let h=0;h<this._nodePromiseLODs.length;h++){const R=Promise.all(this._nodePromiseLODs[h]).then((()=>{0!==h&&(this._loader.endPerformanceCounter(`Node LOD ${h}`),this._loader.log(`Loaded node LOD ${h}`)),this.onNodeLODsLoadedObservable.notifyObservers(h),h!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${h+1}`),this._loadBufferLOD(this._nodeBufferLODs,h+1),this._nodeSignalLODs[h]&&this._nodeSignalLODs[h].resolve())}));this._loader._completePromises.push(R)}for(let h=0;h<this._materialPromiseLODs.length;h++){const R=Promise.all(this._materialPromiseLODs[h]).then((()=>{0!==h&&(this._loader.endPerformanceCounter(`Material LOD ${h}`),this._loader.log(`Loaded material LOD ${h}`)),this.onMaterialLODsLoadedObservable.notifyObservers(h),h!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${h+1}`),this._loadBufferLOD(this._materialBufferLODs,h+1),this._materialSignalLODs[h]&&this._materialSignalLODs[h].resolve())}));this._loader._completePromises.push(R)}}loadSceneAsync(h,R){const l=this._loader.loadSceneAsync(h,R);return this._loadBufferLOD(this._bufferLODs,0),l}loadNodeAsync(h,R,l){return e.LoadExtensionAsync(h,R,this.name,(async(h,a)=>{let D;const U=this._getLODs(h,R,this._loader.qF.nodes,a.ids);this._loader.logOpen(`${h}`);for(let R=0;R<U.length;R++){const h=U[R];0!==R&&(this._nodeIndexLOD=R,this._nodeSignalLODs[R]=this._nodeSignalLODs[R]||new j);const a=h=>{l(h),h.dF(!1)},F=this._loader.loadNodeAsync(`/nodes/${h.index}`,h,a).then((h=>{if(0!==R){const h=U[R-1];h._babylonTransformNode&&(this._disposeTransformNode(h._babylonTransformNode),delete h._babylonTransformNode)}return h.dF(!0),h}));this._nodePromiseLODs[R]=this._nodePromiseLODs[R]||[],0===R?D=F:(this._nodeIndexLOD=null,this._nodePromiseLODs[R].push(F))}return this._loader.logClose(),await D}))}_loadMaterialAsync(h,R,l,j,a){return this._nodeIndexLOD?null:e.LoadExtensionAsync(h,R,this.name,(async(h,D)=>{let U;const F=this._getLODs(h,R,this._loader.qF.materials,D.ids);this._loader.logOpen(`${h}`);for(let R=0;R<F.length;R++){const h=F[R];0!==R&&(this._materialIndexLOD=R);const D=this._loader._loadMaterialAsync(`/materials/${h.index}`,h,l,j,(h=>{0===R&&a(h)})).then((h=>{if(0!==R){a(h);const l=F[R-1]._data;l[j]&&(this._disposeMaterials([l[j].babylonMaterial]),delete l[j])}return h}));this._materialPromiseLODs[R]=this._materialPromiseLODs[R]||[],0===R?U=D:(this._materialIndexLOD=null,this._materialPromiseLODs[R].push(D))}return this._loader.logClose(),await U}))}_loadUriAsync(h,R,l){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const a=this._nodeIndexLOD-1;return this._nodeSignalLODs[a]=this._nodeSignalLODs[a]||new j,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(h,R,l)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const a=this._materialIndexLOD-1;return this._materialSignalLODs[a]=this._materialSignalLODs[a]||new j,this._materialSignalLODs[a].promise.then((async()=>await this._loader.loadUriAsync(h,R,l)))}return null}loadBufferAsync(h,R,l,a){if(this._loader.parent.useRangeRequests&&!R.uri){if(!this._loader.bin)throw new Error(`${h}: Uri is missing or the binary glTF is missing its binary chunk`);const R=async(h,R)=>{const D=l,U=D+a-1;let F=h[R];return F?(F.start=Math.min(F.start,D),F.end=Math.max(F.end,U)):(F={start:D,end:U,loaded:new j},h[R]=F),await F.loaded.promise.then((h=>new Uint8Array(h.buffer,h.byteOffset+l-F.start,a)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?R(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?R(this._materialBufferLODs,this._materialIndexLOD):R(this._bufferLODs,0)}return null}_loadBufferLOD(h,R){const l=h[R];l&&(this._loader.log(`Loading buffer range [${l.start}-${l.end}]`),this._loader.bin.readAsync(l.start,l.end-l.start+1).then((h=>{l.loaded.resolve(h)}),(h=>{l.loaded.reject(h)})))}_getLODs(h,R,l,j){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const a=[];for(let D=j.length-1;D>=0;D--)if(a.push(C.Get(`${h}/ids/${j[D]}`,l,j[D])),a.length===this.maxLODsToLoad)return a;return a.push(R),a}_disposeTransformNode(h){const R=[],l=h.material;l&&R.push(l);for(const a of h.getChildMeshes())a.material&&R.push(a.material);h.dispose();const j=R.filter((h=>this._loader.babylonScene.meshes.every((R=>R.material!=h))));this._disposeMaterials(j)}_disposeMaterials(h){const R={};for(const l of h){for(const h of l.getActiveTextures())R[h.uniqueId]=h;l.dispose()}for(const l in R)for(const h of this._loader.babylonScene.materials)h.hasTexture(R[l])&&delete R[l];for(const l in R)R[l].dispose()}}W(wl),K(wl,!0,(h=>new mj(h)));const ul="MSFT_minecraftMesh";class cl{constructor(h){this.name=ul,this._loader=h,this.enabled=this._loader.isExtensionUsed(ul)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtraAsync(h,R,this.name,(async(j,a)=>{if(a){if(!(l instanceof T.b))throw new Error(`${j}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(h,R,l);return l.needAlphaBlending()&&(l.forceDepthWrite=!0,l.separateCullingPass=!0),l.pF=l.forceDepthWrite,l.twoSidedLighting=!0,await a}}))}}W(ul),K(ul,!0,(h=>new cl(h)));const Jl="MSFT_sRGBFactors";class ql{constructor(h){this.name=Jl,this._loader=h,this.enabled=this._loader.isExtensionUsed(Jl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,R,l){return e.LoadExtraAsync(h,R,this.name,(async(j,a)=>{if(a){if(!(l instanceof T.b))throw new Error(`${j}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(h,R,l),D=l.yh().getEngine().useExactSrgbConversions;return l.albedoTexture||l.albedoColor.toLinearSpaceToRef(l.albedoColor,D),l.reflectivityTexture||l.reflectivityColor.toLinearSpaceToRef(l.reflectivityColor,D),await a}}))}}W(Jl),K(Jl,!0,(h=>new ql(h)));var Ql=l(14580);const Yl={};var sl=l(14635),tl=l(14615),fl=l(14588),Tl=l(14597);function El(h,R){for(const l of h)for(const h of l.dataOutputs)if(h.uniqueId===R)return h;throw new Error("Could not find data out connection with unique id "+R)}function xl(h,R){for(const l of h)if(l instanceof tl.e)for(const h of l.signalInputs)if(h.uniqueId===R)return h;throw new Error("Could not find signal in connection with unique id "+R)}async function Gl(h,R){const j=await Promise.all(h.allBlocks.map((async h=>{const R=function(h){switch(h){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([l.e(78),l.e(79)]).then(l.bind(l,16108))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await l.e(80).then(l.bind(l,16112))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await l.e(81).then(l.bind(l,16114))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await l.e(82).then(l.bind(l,16120))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await l.e(83).then(l.bind(l,16123))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await l.e(84).then(l.bind(l,16131))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await l.e(85).then(l.bind(l,16137))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await l.e(86).then(l.bind(l,16144))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await l.e(87).then(l.bind(l,16146))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await l.e(90).then(l.bind(l,16176))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await l.e(90).then(l.bind(l,16176))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await l.e(90).then(l.bind(l,16176))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await l.e(90).then(l.bind(l,16176))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await l.e(95).then(l.bind(l,16180))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await l.e(96).then(l.bind(l,16184))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await l.e(97).then(l.bind(l,16188))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await l.e(98).then(l.bind(l,16195))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await l.e(99).then(l.bind(l,16203))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await l.e(100).then(l.bind(l,16210))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await l.e(101).then(l.bind(l,16213))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await l.e(102).then(l.bind(l,16222))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await l.e(103).then(l.bind(l,16231))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await l.e(104).then(l.bind(l,16236))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await l.e(105).then(l.bind(l,16245))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await l.e(106).then(l.bind(l,16253))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await l.e(107).then(l.bind(l,16259))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await l.e(108).then(l.bind(l,16267))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await l.e(109).then(l.bind(l,16270))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await l.e(110).then(l.bind(l,16279))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await l.e(111).then(l.bind(l,16284))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await l.e(112).then(l.bind(l,16292))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await l.e(113).then(l.bind(l,16296))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await l.e(92).then(l.bind(l,16299))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await l.e(114).then(l.bind(l,16302))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await l.e(115).then(l.bind(l,16308))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await l.e(116).then(l.bind(l,16314))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await l.e(93).then(l.bind(l,16317))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await l.e(88).then(l.bind(l,16154))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await l.e(94).then(l.bind(l,16324))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await l.e(94).then(l.bind(l,16324))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await l.e(94).then(l.bind(l,16324))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await l.e(94).then(l.bind(l,16324))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await l.e(94).then(l.bind(l,16324))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await l.e(94).then(l.bind(l,16324))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await l.e(94).then(l.bind(l,16324))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await l.e(94).then(l.bind(l,16324))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await l.e(89).then(l.bind(l,16169))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await l.e(90).then(l.bind(l,16176))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await l.e(90).then(l.bind(l,16176))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await l.e(91).then(l.bind(l,16330))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await l.e(91).then(l.bind(l,16330))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await l.e(91).then(l.bind(l,16330))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await l.e(91).then(l.bind(l,16330))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await l.e(91).then(l.bind(l,16330))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await l.e(91).then(l.bind(l,16330))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await l.e(117).then(l.bind(l,16338))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await l.e(118).then(l.bind(l,16345))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await l.e(119).then(l.bind(l,16352))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await l.e(120).then(l.bind(l,16355))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await l.e(121).then(l.bind(l,16362))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await l.e(122).then(l.bind(l,16364))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await l.e(123).then(l.bind(l,16370))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await l.e(124).then(l.bind(l,16378))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await l.e(125).then(l.bind(l,16382))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await l.e(126).then(l.bind(l,16387))).FlowGraphDataSwitchBlock;default:if(Yl[h])return Yl[h];throw new Error(`Unknown block name ${h}`)}}(h.className);return await R()})));return function(h,R,l){const j=R.coordinator.createGraph(),a=[],D=R.valueParseFunction??fl.d;for(let U=0;U<h.allBlocks.length;U++){const F=Ol(h.allBlocks[U],{TR:R.coordinator.config.TR,pathConverter:R.pathConverter,assetsContainer:R.coordinator.config.TR,valueParseFunction:D},l[U]);a.push(F),F instanceof sl.e&&j.addEventBlock(F)}for(const U of a){for(const h of U.dataInputs)for(const R of h.connectedPointIds){const l=El(a,R);h.connectTo(l)}if(U instanceof tl.e)for(const h of U.signalOutputs)for(const R of h.connectedPointIds){const l=xl(a,R);h.connectTo(l)}}for(const U of h.executionContexts)pl(U,{graph:j,valueParseFunction:D},h.rightHanded);return j}(h,R,j)}function pl(h,R,l){const j=R.graph.createContext();h.enableLogging&&(j.enableLogging=!0),j.treatDataAsRightHanded=l||!1;const a=R.valueParseFunction??fl.d;j.uniqueId=h.uniqueId;const D=j.yh();if(h._assetsContext){var U,F,w,mh,u,c,J,q,Q,Y;const R=h._assetsContext,l={meshes:null===(U=R.meshes)||void 0===U?void 0:U.map((h=>D.getMeshById(h))),lights:null===(F=R.lights)||void 0===F?void 0:F.map((h=>D.getLightByName(h))),cameras:null===(w=R.cameras)||void 0===w?void 0:w.map((h=>D.getCameraByName(h))),materials:null===(mh=R.materials)||void 0===mh?void 0:mh.map((h=>D.getMaterialById(h))),textures:null===(u=R.textures)||void 0===u?void 0:u.map((h=>D.getTextureByName(h))),animations:null===(c=R.animations)||void 0===c?void 0:c.map((h=>D.animations.find((R=>R.name===h)))),skeletons:null===(J=R.skeletons)||void 0===J?void 0:J.map((h=>D.getSkeletonByName(h))),SJ:null===(q=R.SJ)||void 0===q?void 0:q.map((h=>D.getParticleSystemById(h))),animationGroups:null===(Q=R.animationGroups)||void 0===Q?void 0:Q.map((h=>D.getAnimationGroupByName(h))),transformNodes:null===(Y=R.transformNodes)||void 0===Y?void 0:Y.map((h=>D.getTransformNodeById(h))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Oq:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};j.assetsContext=l}for(const s in h._userVariables){const R=a(s,h._userVariables,j.assetsContext,D);j.userVariables[s]=R}for(const s in h._connectionValues){const R=a(s,h._connectionValues,j.assetsContext,D);j._setConnectionValueByKey(s,R)}return j}function Ol(h,R,l){const j={},a=R.valueParseFunction??fl.d;if(h.config)for(const U in h.config)j[U]=a(U,h.config,R.assetsContainer||R.TR,R.TR);if((0,fl.h)(h.className)){if(!R.pathConverter)throw new Error("Path converter is required for this block");j.pathConverter=R.pathConverter}const D=new l(j);D.uniqueId=h.uniqueId;for(let U=0;U<h.dataInputs.length;U++){const R=D.getDataInput(h.dataInputs[U].name);if(!R)throw new Error("Could not find data input with name "+h.dataInputs[U].name+" in block "+h.className);R.deserialize(h.dataInputs[U])}for(let U=0;U<h.dataOutputs.length;U++){const R=D.getDataOutput(h.dataOutputs[U].name);if(!R)throw new Error("Could not find data output with name "+h.dataOutputs[U].name+" in block "+h.className);R.deserialize(h.dataOutputs[U])}return D.metadata=h.metadata,D.deserialize&&D.deserialize(h),D}function yl(h){const[R,l]=h.split(":");return vl({op:R,extension:l})}function vl(h){var R;let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=h.extension?null===(R=Il[h.extension])||void 0===R?void 0:R[h.op]:Ll[h.op];if(!j&&(Y.c.Warn(`No mapping found for operation ${h.op} and extension ${h.extension||"KHR_interactivity"}`),l)){const R={},l={flows:{}};if(h.inputValueSockets){R.values={};for(const l in h.inputValueSockets)R.values[l]={name:l}}return h.outputValueSockets&&(l.values={},Object.keys(h.outputValueSockets).forEach((h=>{l.values[h]={name:h}}))),{Gu:[],inputs:R,outputs:l}}return j}function bl(h,R,l){Il[R]||(Il[R]={}),Il[R][h]=l}const Il={BABYLON:{"flow/log":{Gu:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Ll={"event/onStart":{Gu:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Gu:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Gu:["FlowGraphSendCustomEventBlock"],extraProcessor(h,R,l,j,a){if("event/send"!==R.op||!h.configuration||1!==Object.keys(h.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const D=h.configuration.event.value[0];if("number"!==typeof D)throw new Error("Event id should be a number");const U=j.arrays.events[D],F=a[0];return F.config||(F.config={}),F.config.eventId=U.eventId,F.config.eventData=U.eventData,a}},"event/receive":{Gu:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(h,R){var l;if(!h.configuration)return Y.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const j=h.configuration.event;if(!j)return Y.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const a=j.value[0];if("number"!==typeof a)return Y.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(l=R.events)||void 0===l?void 0:l[a])?{valid:!0}:(Y.c.Error(`Event with id ${a} not found`),{valid:!1,error:`Event with id ${a} not found`})},extraProcessor(h,R,l,j,a){if("event/receive"!==R.op||!h.configuration||1!==Object.keys(h.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const D=h.configuration.event.value[0];if("number"!==typeof D)throw new Error("Event id should be a number");const U=j.arrays.events[D],F=a[0];return F.config||(F.config={}),F.config.eventId=U.eventId,F.config.eventData=U.eventData,a}},"math/e":nl("FlowGraphEBlock"),"math/pi":nl("FlowGraphPIBlock"),"math/inf":nl("FlowGraphInfBlock"),"math/nan":nl("FlowGraphNaNBlock"),"math/abs":nl("FlowGraphAbsBlock"),"math/sign":nl("FlowGraphSignBlock"),"math/trunc":nl("FlowGraphTruncBlock"),"math/floor":nl("FlowGraphFloorBlock"),"math/ceil":nl("FlowGraphCeilBlock"),"math/round":{Gu:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a){var D;return(D=a[0]).config||(D.config={}),a[0].config.roundHalfAwayFromZero=!0,a}},"math/fract":nl("FlowGraphFractBlock"),"math/neg":nl("FlowGraphNegationBlock"),"math/add":nl("FlowGraphAddBlock",["a","b"],!0),"math/sub":nl("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Gu:["FlowGraphMultiplyBlock"],extraProcessor(h,R,l,j,a){var D;(D=a[0]).config||(D.config={}),a[0].config.useMatrixPerComponent=!0,a[0].config.preventIntegerFloatArithmetic=!0;let U=-1;return Object.keys(h.values||{}).find((R=>{var l;return void 0!==(null===(l=h.values)||void 0===l?void 0:l[R].type)&&(U=h.values[R].type,!0)})),-1!==U&&(a[0].config.type=j.arrays.types[U].flowGraphType),a},validation:h=>h.values?rl(h):{valid:!0}},"math/div":nl("FlowGraphDivideBlock",["a","b"],!0),"math/rem":nl("FlowGraphModuloBlock",["a","b"]),"math/min":nl("FlowGraphMinBlock",["a","b"]),"math/max":nl("FlowGraphMaxBlock",["a","b"]),"math/clamp":nl("FlowGraphClampBlock",["a","b","c"]),"math/saturate":nl("FlowGraphSaturateBlock"),"math/mix":nl("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":nl("FlowGraphEqualityBlock",["a","b"]),"math/lt":nl("FlowGraphLessThanBlock",["a","b"]),"math/le":nl("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":nl("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":nl("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":nl("FlowGraphIsNaNBlock"),"math/isinf":nl("FlowGraphIsInfBlock"),"math/select":{Gu:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Gu:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":nl("FlowGraphSinBlock"),"math/cos":nl("FlowGraphCosBlock"),"math/tan":nl("FlowGraphTanBlock"),"math/asin":nl("FlowGraphASinBlock"),"math/acos":nl("FlowGraphACosBlock"),"math/atan":nl("FlowGraphATanBlock"),"math/atan2":nl("FlowGraphATan2Block",["a","b"]),"math/sinh":nl("FlowGraphSinhBlock"),"math/cosh":nl("FlowGraphCoshBlock"),"math/tanh":nl("FlowGraphTanhBlock"),"math/asinh":nl("FlowGraphASinhBlock"),"math/acosh":nl("FlowGraphACoshBlock"),"math/atanh":nl("FlowGraphATanhBlock"),"math/exp":nl("FlowGraphExponentialBlock"),"math/log":nl("FlowGraphLogBlock"),"math/log2":nl("FlowGraphLog2Block"),"math/log10":nl("FlowGraphLog10Block"),"math/sqrt":nl("FlowGraphSquareRootBlock"),"math/cbrt":nl("FlowGraphCubeRootBlock"),"math/pow":nl("FlowGraphPowerBlock",["a","b"]),"math/length":nl("FlowGraphLengthBlock"),"math/normalize":nl("FlowGraphNormalizeBlock"),"math/dot":nl("FlowGraphDotBlock",["a","b"]),"math/cross":nl("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":nl("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":nl("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Gu:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Gu:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Gu:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Gu:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Gu:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Gu:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Gu:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":nl("FlowGraphTransposeBlock"),"math/determinant":nl("FlowGraphDeterminantBlock"),"math/inverse":nl("FlowGraphInvertMatrixBlock"),"math/matmul":nl("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Gu:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"yF",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a,D){const U=a[0].dataInputs.find((h=>"rotationQuaternion"===h.name));if(!U)throw new Error("Rotation quaternion input not found");return D._connectionValues[U.uniqueId]&&(D._connectionValues[U.uniqueId].type="Quaternion"),a}},"math/matDecompose":{Gu:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"yF"}}}},"math/quatConjugate":nl("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Gu:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a){var D;return(D=a[0]).config||(D.config={}),a[0].config.type="Quaternion",a}},"math/quatAngleBetween":nl("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Gu:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":nl("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":nl("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Gu:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a){var D;return(D=a[0]).config||(D.config={}),a[0].config.inputIsColumnMajor=!0,a}},"math/extract2x2":{Gu:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Gu:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a){var D;return(D=a[0]).config||(D.config={}),a[0].config.inputIsColumnMajor=!0,a}},"math/extract3x3":{Gu:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Gu:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a){var D;return(D=a[0]).config||(D.config={}),a[0].config.inputIsColumnMajor=!0,a}},"math/extract4x4":{Gu:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Gu:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a,D){var U,F;(F=a[0]).config||(F.config={});const w=a[0].dataInputs[0];return a[0].config.valueType=(null===(U=D._connectionValues[w.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",a}},"math/and":{Gu:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a,D){var U,F,w;(w=a[0]).config||(w.config={});const mh=a[0].dataInputs[0],u=a[0].dataInputs[1];return a[0].config.valueType=(null===(U=D._connectionValues[mh.uniqueId])||void 0===U?void 0:U.type)??(null===(F=D._connectionValues[u.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",a}},"math/or":{Gu:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a,D){var U,F,w;(w=a[0]).config||(w.config={});const mh=a[0].dataInputs[0],u=a[0].dataInputs[1];return a[0].config.valueType=(null===(U=D._connectionValues[mh.uniqueId])||void 0===U?void 0:U.type)??(null===(F=D._connectionValues[u.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",a}},"math/xor":{Gu:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,R,l,j,a,D){var U,F,w;(w=a[0]).config||(w.config={});const mh=a[0].dataInputs[0],u=a[0].dataInputs[1];return a[0].config.valueType=(null===(U=D._connectionValues[mh.uniqueId])||void 0===U?void 0:U.type)??(null===(F=D._connectionValues[u.uniqueId])||void 0===F?void 0:F.type)??"FlowGraphInteger",a}},"math/asr":nl("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":nl("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":nl("FlowGraphLeadingZerosBlock"),"math/ctz":nl("FlowGraphTrailingZerosBlock"),"math/popcnt":nl("FlowGraphOneBitsCounterBlock"),"math/rad":nl("FlowGraphDegToRadBlock"),"math/deg":nl("FlowGraphRadToDegBlock"),"type/boolToInt":nl("FlowGraphBooleanToInt"),"type/boolToFloat":nl("FlowGraphBooleanToFloat"),"type/intToBool":nl("FlowGraphIntToBoolean"),"type/intToFloat":nl("FlowGraphIntToFloat"),"type/floatToInt":nl("FlowGraphFloatToInt"),"type/floatToBool":nl("FlowGraphFloatToBoolean"),"flow/sequence":{Gu:["FlowGraphSequenceBlock"],extraProcessor(h,R,l,j,a){const D=a[0];return D.config||(D.config={}),D.config.outputSignalCount=Object.keys(h.flows||[]).length,D.signalOutputs.forEach(((h,R)=>{h.name="out_"+R})),a}},"flow/branch":{Gu:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Gu:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(h){if(h.configuration&&h.configuration.cases){const R=h.configuration.cases.value;if(!R.every((h=>"number"===typeof h&&/^-?\d+$/.test(h.toString()))))return Y.c.Warn("Switch cases should be integers. Using empty array instead."),h.configuration.cases.value=[],{valid:!0};const l=new Set(R);h.configuration.cases.value=Array.from(l)}return{valid:!0}},extraProcessor(h,R,l,j,a){if("flow/switch"!==R.op||!h.flows||0===Object.keys(h.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return a[0].signalOutputs.forEach((h=>{"default"!==h.name&&(h.name="out_"+h.name)})),a}},"flow/while":{Gu:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Gu:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(h,R,l,j,a){const D=a[0];return D.config||(D.config={}),D.config.incrementIndexWhenLoopDone=!0,a}},"flow/doN":{Gu:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Gu:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(h,R,l,j,a){if("flow/multiGate"!==R.op||!h.flows||0===Object.keys(h.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const D=a[0];return D.config||(D.config={}),D.config.outputSignalCount=Object.keys(h.flows).length,D.signalOutputs.forEach(((h,R)=>{h.name="out_"+R})),a}},"flow/waitAll":{Gu:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(h){var R,l;return"number"!==typeof(null===(R=h.configuration)||void 0===R||null===(l=R.inputFlows)||void 0===l?void 0:l.value[0])&&(h.configuration=h.configuration||{inputFlows:{value:[0]}},h.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Gu:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Gu:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Gu:["FlowGraphCancelDelayBlock"]},"variable/get":{Gu:["FlowGraphGetVariableBlock"],validation(h){var R,l;return null!==(R=h.configuration)&&void 0!==R&&null!==(l=R.variable)&&void 0!==l&&l.value?{valid:!0}:(Y.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(h,R)=>[R.getVariableName(h[0])]}}},"variable/set":{Gu:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(h,R)=>[R.getVariableName(h[0])]}}},"variable/setMultiple":{Gu:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(h,R)=>[h[0].map((h=>R.getVariableName(h)))]}},extraProcessor:(h,R,l,j,a)=>(a[0].dataInputs.forEach((h=>{h.name=j.getVariableName(+h.name)})),a)},"variable/interpolate":{Gu:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(h,R)=>[R.getVariableName(h[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:h=>!0===h[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",bl:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",bl:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",bl:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",bl:"FlowGraphPlayAnimationBlock"},out:{name:"out",bl:"FlowGraphPlayAnimationBlock"},done:{name:"done",bl:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(h,R,l,j,a){var D,U,F;const w=a[0],mh=null===(D=h.configuration)||void 0===D?void 0:D.variable.value[0];if("number"!==typeof mh)throw Y.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const u=j.arrays.staticVariables[mh];"undefined"===typeof w.config.animationType.value&&(j.arrays.staticVariables,w.config.animationType.value=(0,Tl.H)(u.type));const c=a[4];return c.config||(c.config={}),(U=c.config).variable||(U.variable={}),c.config.variable.value=j.getVariableName(mh),(F=a[3]).config||(F.config={}),a}},"pointer/get":{Gu:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",bl:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",bl:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,R,l,j,a)=>(a.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className&&(h.config||(h.config={}),h.config.outputValue=!0)})),a)},"pointer/set":{Gu:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",bl:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",bl:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,R,l,j,a)=>(a.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className&&(h.config||(h.config={}),h.config.outputValue=!0)})),a)},"pointer/interpolate":{Gu:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",bl:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",bl:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",bl:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",bl:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",bl:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",bl:"FlowGraphPlayAnimationBlock"},out:{name:"out",bl:"FlowGraphPlayAnimationBlock"},done:{name:"done",bl:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,R,l,j,a)=>(a.forEach((R=>{"FlowGraphJsonPointerParserBlock"===R.className?(R.config||(R.config={}),R.config.outputValue=!0):"FlowGraphInterpolationBlock"===R.className&&(R.config||(R.config={}),Object.keys(h.values||[]).forEach((l=>{var a;const D=null===(a=h.values)||void 0===a?void 0:a[l];if("value"===l&&D){const h=D.type;void 0!==h&&(R.config.animationType=j.arrays.types[h].flowGraphType)}})))})),a)},"animation/start":{Gu:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",bl:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(h,R)=>[h[0]*R._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(h,R)=>[h[0]*R._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,R,l,j,a,D,U){const F=a[a.length-1];return F.config||(F.config={}),F.config.glTF=U,a}},"animation/stop":{Gu:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",bl:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,R,l,j,a,D,U){const F=a[a.length-1];return F.config||(F.config={}),F.config.glTF=U,a}},"animation/stopAt":{Gu:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",bl:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(h,R)=>[h[0]*R._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,R,l,j,a,D,U){const F=a[a.length-1];return F.config||(F.config={}),F.config.glTF=U,a}},"math/switch":{Gu:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(h){if(h.configuration&&h.configuration.cases){const R=h.configuration.cases.value;if(!R.every((h=>"number"===typeof h&&/^-?\d+$/.test(h.toString()))))return Y.c.Warn("Switch cases should be integers. Using empty array instead."),h.configuration.cases.value=[],{valid:!0};const l=new Set(R);h.configuration.cases.value=Array.from(l)}return{valid:!0}},extraProcessor(h,R,l,j,a){const D=a[0];return D.dataInputs.forEach((h=>{"default"!==h.name&&"case"!==h.name&&(h.name="in_"+h.name)})),D.config||(D.config={}),D.config.treatCasesAsIntegers=!0,a}},"debug/log":{Gu:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function nl(h){let R=arguments.length>2?arguments[2]:void 0;return{Gu:[h],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((h,R)=>(h[R]={name:R},h)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(h,l,j,a,D){var U;if(R){(U=D[0]).config||(U.config={}),D[0].config.preventIntegerFloatArithmetic=!0;let R=-1;Object.keys(h.values||{}).find((l=>{var j;return void 0!==(null===(j=h.values)||void 0===j?void 0:j[l].type)&&(R=h.values[l].type,!0)})),-1!==R&&(D[0].config.type=a.arrays.types[R].flowGraphType)}return D},validation:h=>R?rl(h):{valid:!0}}}function rl(h){if(h.values){const R=Object.keys(h.values).map((R=>h.values[R].type)).filter((h=>void 0!==h));if(!R.every((h=>h===R[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Ll["math/compose"]=Ll["math/matCompose"],Ll["math/decompose"]=Ll["math/matDecompose"];var Pl=l(12855);const zl={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"tR",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class ol{constructor(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=h,this._gltf=R,this._animationTargetFps=l,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const h of this._interactivityGraph.types)this._types.push(zl[h.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const h of this._interactivityGraph.declarations){const R=vl(h);if(!R)throw Y.c.Error(["No mapping found for declaration",h]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:R,fullOperationName:h.extension?h.op+":"+h.extension:h.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const h of this._interactivityGraph.variables){const R=this._parseVariable(h);this._staticVariables.push(R)}}_parseVariable(h,R){const l=this._types[h.type];if(!l)throw Y.c.Error(["No type found for variable",h]),new Error("Error parsing variables");if(h.value&&h.value.length!==l.length)throw Y.c.Error(["Invalid value length for variable",h,l]),new Error("Error parsing variables");const j=h.value||[];if(!j.length)switch(l.flowGraphType){case"boolean":j.push(!1);break;case"FlowGraphInteger":j.push(0);break;case"number":j.push(NaN);break;case"Vector2":j.push(NaN,NaN);break;case"tR":j.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":j.fill(NaN,0,4);break;case"Matrix":j.fill(NaN,0,16);break;case"Matrix3D":j.fill(NaN,0,9)}return"number"===l.elementType&&"string"===typeof j[0]&&(j[0]=parseFloat(j[0])),{type:l.flowGraphType,value:R?R(j,this):j}}_parseEvents(){if(this._interactivityGraph.events)for(const h of this._interactivityGraph.events){const R={eventId:h.id||"internalEvent_"+this._internalEventsCounter++};h.values&&(R.eventData=Object.keys(h.values).map((R=>{var l;const j=null===(l=h.values)||void 0===l?void 0:l[R];if(!j)throw Y.c.Error(["No value found for event key",R]),new Error("Error parsing events");const a=this._types[j.type];if(!a)throw Y.c.Error(["No type found for event value",j]),new Error("Error parsing events");const D="undefined"!==typeof j.value?this._parseVariable(j):void 0;return{id:R,type:a.flowGraphType,eventData:!0,value:D}}))),this._events.push(R)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const R of this._interactivityGraph.nodes){if("number"!==typeof R.declaration)throw Y.c.Error(["No declaration found for node",R]),new Error("Error parsing nodes");const l=this._mappings[R.declaration];if(!l)throw Y.c.Error(["No mapping found for node",R]),new Error("Error parsing nodes");if(l.flowGraphMapping.validation){const j=l.flowGraphMapping.validation(R,this._interactivityGraph,this._gltf);var h;if(!j.valid)throw new Error(`Error validating interactivity node ${null===(h=this._interactivityGraph.declarations)||void 0===h?void 0:h[R.declaration].op} - ${j.error}`)}const j=[];for(const h of l.flowGraphMapping.Gu){const a=this._getEmptyBlock(h,l.fullOperationName);this._parseNodeConfiguration(R,a,l.flowGraphMapping,h),j.push(a)}this._nodes.push({Gu:j,fullOperationName:l.fullOperationName})}}_getEmptyBlock(h,R){return{uniqueId:(0,Pl.e)(),className:h,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:R,metadata:{}}}_parseNodeConfiguration(h,R,l,j){const a=R.config;if(h.configuration){const R=Object.keys(h.configuration);for(const F of R){var D,U;const R=null===(D=h.configuration)||void 0===D?void 0:D[F];if(!R)throw Y.c.Error(["No value found for node configuration",F]),new Error("Error parsing node configuration");const w=null===(U=l.configuration)||void 0===U?void 0:U[F];if(w&&w.bl?w.bl===j:0===l.Gu.indexOf(j)){const h=(null===w||void 0===w?void 0:w.name)||F;R&&"undefined"!==typeof R.value||"undefined"===typeof(null===w||void 0===w?void 0:w.defaultValue)?R.value.length>=0?a[h]={value:1===R.value.length?R.value[0]:R.value}:Y.c.Warn(["Invalid value for node configuration",R]):a[h]={value:w.defaultValue},w&&w.dataTransformer&&(a[h].value=w.dataTransformer([a[h].value],this)[0])}}}}_parseNodeConnections(h){for(let G=0;G<this._nodes.length;G++){var R;const p=null===(R=this._interactivityGraph.nodes)||void 0===R?void 0:R[G];if(!p)throw Y.c.Error(["No node found for interactivity node",this._nodes[G]]),new Error("Error parsing node connections");const O=this._nodes[G],y=this._mappings[p.declaration];if(!y)throw Y.c.Error(["No mapping found for node",p]),new Error("Error parsing node connections");const v=p.flows||{},b=Object.keys(v).sort();for(const h of b){var l,j,a,D;const R=v[h],mh=null===(l=y.flowGraphMapping.outputs)||void 0===l||null===(j=l.flows)||void 0===j?void 0:j[h],u=(null===mh||void 0===mh?void 0:mh.name)||h,c=this._createNewSocketConnection(u,!0);(mh&&mh.bl&&O.Gu.find((h=>h.className===mh.bl))||O.Gu[0]).signalOutputs.push(c);const J=R.node,q=this._nodes[J];if(!q)throw Y.c.Error(["No node found for input node id",J]),new Error("Error parsing node connections");const Q=yl(q.fullOperationName);if(!Q)throw Y.c.Error(["No mapping found for input node",q]),new Error("Error parsing node connections");let s=null===(a=Q.inputs)||void 0===a||null===(D=a.flows)||void 0===D?void 0:D[R.socket||"in"],t=!1;if(!s)for(const h in null===(U=Q.inputs)||void 0===U?void 0:U.flows){var U,F,w;if(h.startsWith("[")&&h.endsWith("]"))t=!0,s=null===(F=Q.inputs)||void 0===F||null===(w=F.flows)||void 0===w?void 0:w[h]}const f=s?t?s.name.replace("$1",R.socket||""):s.name:R.socket||"in",T=s&&s.bl&&q.Gu.find((h=>h.className===s.bl))||q.Gu[0];let E=T.signalInputs.find((h=>h.name===f));E||(E=this._createNewSocketConnection(f),T.signalInputs.push(E)),E.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(E.uniqueId)}const I=p.values||{},L=Object.keys(I);for(const R of L){var mh,u;const l=I[R];let j=null===(mh=y.flowGraphMapping.inputs)||void 0===mh||null===(u=mh.values)||void 0===u?void 0:u[R],a=!1;if(!j)for(const h in null===(c=y.flowGraphMapping.inputs)||void 0===c?void 0:c.values){var c,J,q;if(h.startsWith("[")&&h.endsWith("]"))a=!0,j=null===(J=y.flowGraphMapping.inputs)||void 0===J||null===(q=J.values)||void 0===q?void 0:q[h]}const D=j?a?j.name.replace("$1",R):j.name:R,U=this._createNewSocketConnection(D);if((j&&j.bl&&O.Gu.find((h=>h.className===j.bl))||O.Gu[0]).dataInputs.push(U),void 0!==l.value){const R=this._parseVariable(l,j&&j.dataTransformer);h._connectionValues[U.uniqueId]=R}else{if("undefined"===typeof l.node)throw Y.c.Error(["Invalid value for value connection",l]),new Error("Error parsing node connections");{var Q,s,t;const h=l.node,R=l.socket||"value",j=this._nodes[h];if(!j)throw Y.c.Error(["No node found for output socket reference",l]),new Error("Error parsing node connections");const a=yl(j.fullOperationName);if(!a)throw Y.c.Error(["No mapping found for output socket reference",l]),new Error("Error parsing node connections");let D=null===(Q=a.outputs)||void 0===Q||null===(s=Q.values)||void 0===s?void 0:s[R],F=!1;if(!D)for(const l in null===(f=a.outputs)||void 0===f?void 0:f.values){var f,T,E;if(l.startsWith("[")&&l.endsWith("]"))F=!0,D=null===(T=a.outputs)||void 0===T||null===(E=T.values)||void 0===E?void 0:E[l]}const w=D?F?D.name.replace("$1",R):null===(t=D)||void 0===t?void 0:t.name:R,mh=D&&D.bl&&j.Gu.find((h=>h.className===D.bl))||j.Gu[0];let u=mh.dataOutputs.find((h=>h.name===w));u||(u=this._createNewSocketConnection(w,!0),mh.dataOutputs.push(u)),U.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(U.uniqueId)}}}if(y.flowGraphMapping.interBlockConnectors)for(const h of y.flowGraphMapping.interBlockConnectors){const R=h.input,l=h.output,j=h.isVariable;this._connectFlowGraphNodes(R,l,O.Gu[h.inputBlockIndex],O.Gu[h.outputBlockIndex],j)}if(y.flowGraphMapping.extraProcessor){var x;const R=null===(x=this._interactivityGraph.declarations)||void 0===x?void 0:x[p.declaration];if(!R)throw Y.c.Error(["No declaration found for extra processor",p]),new Error("Error parsing node connections");O.Gu=y.flowGraphMapping.extraProcessor(p,R,y.flowGraphMapping,this,O.Gu,h,this._gltf)}}}_createNewSocketConnection(h,R){return{uniqueId:(0,Pl.e)(),name:h,_connectionType:R?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(h,R,l,j,a){const D=a?l.dataInputs:l.signalInputs,U=a?j.dataOutputs:j.signalOutputs,F=D.find((R=>R.name===h))||this._createNewSocketConnection(h),w=U.find((h=>h.name===R))||this._createNewSocketConnection(R,!0);D.find((R=>R.name===h))||D.push(F),U.find((h=>h.name===R))||U.push(w),F.connectedPointIds.push(w.uniqueId),w.connectedPointIds.push(F.uniqueId)}getVariableName(h){return"staticVariable_"+h}serializeToFlowGraph(){const h={uniqueId:(0,Pl.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(h);for(let R=0;R<this._staticVariables.length;R++){const l=this._staticVariables[R];h._userVariables[this.getVariableName(R)]=l}return{rightHanded:!0,allBlocks:this._nodes.reduce(((h,R)=>h.concat(R.Gu)),[]),executionContexts:[h]}}}const Kl="KHR_interactivity";class Wl{constructor(h){this._loader=h,this.name=Kl,this.enabled=this._loader.isExtensionUsed(Kl),this._pathConverter=(0,g.j)(this._loader.qF),h._skipStartAnimationStep=!0;const R=h.babylonScene;R&&function(h){(0,g.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!h.activeCamera)return new a.Quaternion(NaN,NaN,NaN,NaN);const R=a.Quaternion.FromRotationMatrix(h.activeCamera.getWorldMatrix()).normalize();return h.useRightHandedSystem||(R.w*=-1,R.x*=-1),R},type:"Quaternion",getTarget:()=>h.activeCamera}),(0,g.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!h.activeCamera)return new a.tR(NaN,NaN,NaN);const R=h.activeCamera.getWorldMatrix().getTranslation();return h.useRightHandedSystem||(R.x*=-1),R},type:"tR",getTarget:()=>h.activeCamera}),(0,g.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:h=>{var R;return(null===(R=h._babylonAnimationGroup)||void 0===R?void 0:R.isPlaying)??!1},type:"boolean",getTarget:h=>h._babylonAnimationGroup}),(0,g.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:h=>{var R;return((null===(R=h._babylonAnimationGroup)||void 0===R?void 0:R.from)??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,g.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:h=>{var R;return((null===(R=h._babylonAnimationGroup)||void 0===R?void 0:R.to)??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,g.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:h=>{var R;return((null===(R=h._babylonAnimationGroup)||void 0===R?void 0:R.getCurrentFrame())??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,g.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:h=>{var R;return((null===(R=h._babylonAnimationGroup)||void 0===R?void 0:R.getCurrentFrame())??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup})}(R)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var h;if(!this._loader.babylonScene||!this._pathConverter)return;const R=this._loader.babylonScene,l=null===(h=this._loader.qF.extensions)||void 0===h?void 0:h.KHR_interactivity;if(!l)return;const j=new Ql.b({TR:R});j.dispatchEventsSynchronously=!1;const a=l.graphs.map((h=>new ol(h,this._loader.qF,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(a.map((async h=>await Gl(h,{coordinator:j,pathConverter:this._pathConverter})))),j.start()}}var gl;gl=async()=>(await Promise.resolve().then(l.bind(l,14653))).FlowGraphGLTFDataProvider,Yl[`${Kl}/${"FlowGraphGLTFDataProvider"}`]=gl,W(Kl),K(Kl,!0,(h=>new Wl(h)));const Hl="KHR_node_visibility";(0,g.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:h=>{const R=h._babylonTransformNode;return!R||void 0===R.isVisible||R.isVisible},set:(h,R)=>{var l,j;null===(l=R._primitiveBabylonMeshes)||void 0===l||l.forEach((h=>{h.inheritVisibility=!0})),R._babylonTransformNode&&(R._babylonTransformNode.isVisible=h),null===(j=R._primitiveBabylonMeshes)||void 0===j||j.forEach((R=>{R.isVisible=h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class kl{constructor(h){this.name=Hl,this._loader=h,this.enabled=h.isExtensionUsed(Hl)}async onReady(){var h;null===(h=this._loader.qF.nodes)||void 0===h||h.forEach((h=>{var R,l,j,a;(null===(R=h._primitiveBabylonMeshes)||void 0===R||R.forEach((h=>{h.inheritVisibility=!0})),null!==(l=h.extensions)&&void 0!==l&&l.KHR_node_visibility)&&(!1===(null===(j=h.extensions)||void 0===j?void 0:j.KHR_node_visibility.visible)&&(h._babylonTransformNode&&(h._babylonTransformNode.isVisible=!1),null===(a=h._primitiveBabylonMeshes)||void 0===a||a.forEach((h=>{h.isVisible=!1}))))}))}dispose(){this._loader=null}}W(Hl),K(Hl,!0,(h=>new kl(h)));const Cl="KHR_node_selectability";bl("event/onSelect",Cl,{Gu:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",bl:"FlowGraphGetVariableBlock",dataTransformer:h=>["pickedMesh_"+h[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",bl:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,R,l,j,a,D,U){var F,w,mh,u,c,J;const q=a[a.length-1];q.config=q.config||{},q.config.glTF=U;const Q=null===(F=h.configuration)||void 0===F||null===(w=F.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===Q||"number"!==typeof Q)throw new Error("nodeIndex not found in configuration");const Y="pickedMesh_"+Q;return a[1].config.variable=Y,D._userVariables[Y]={className:"Mesh",id:null===U||void 0===U||null===(mh=U.nodes)||void 0===mh||null===(u=mh[Q]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===U||void 0===U||null===(c=U.nodes)||void 0===c||null===(J=c[Q]._babylonTransformNode)||void 0===J?void 0:J.uniqueId},a}}),(0,g.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:h=>{const R=h._babylonTransformNode;return!R||void 0===R.Sw||R.Sw},set:(h,R)=>{var l;null===(l=R._primitiveBabylonMeshes)||void 0===l||l.forEach((R=>{R.Sw=h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"Sw"],type:"boolean"});class Al{constructor(h){this.name=Cl,this._loader=h,this.enabled=h.isExtensionUsed(Cl)}async onReady(){var h;null===(h=this._loader.qF.nodes)||void 0===h||h.forEach((h=>{var R,l,j;null!==(R=h.extensions)&&void 0!==R&&R.KHR_node_selectability&&!1===(null===(l=h.extensions)||void 0===l?void 0:l.KHR_node_selectability.selectable)&&(null===(j=h._babylonTransformNode)||void 0===j||j.getChildMeshes().forEach((h=>{h.Sw=!1})))}))}dispose(){this._loader=null}}W(Cl),K(Cl,!0,(h=>new Al(h)));const el="KHR_node_hoverability",Sl="targetMeshPointerOver_";bl("event/onHoverIn",el,{Gu:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",bl:"FlowGraphGetVariableBlock",dataTransformer:h=>[Sl+h[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",bl:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,R,l,j,a,D,U){var F,w,mh,u,c,J;const q=a[a.length-1];q.config=q.config||{},q.config.glTF=U;const Q=null===(F=h.configuration)||void 0===F||null===(w=F.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===Q||"number"!==typeof Q)throw new Error("nodeIndex not found in configuration");const Y=Sl+Q;return a[1].config.variable=Y,D._userVariables[Y]={className:"Mesh",id:null===U||void 0===U||null===(mh=U.nodes)||void 0===mh||null===(u=mh[Q]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===U||void 0===U||null===(c=U.nodes)||void 0===c||null===(J=c[Q]._babylonTransformNode)||void 0===J?void 0:J.uniqueId},a}});const Zl="targetMeshPointerOut_";bl("event/onHoverOut",el,{Gu:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",bl:"FlowGraphGetVariableBlock",dataTransformer:h=>[Zl+h[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",bl:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,R,l,j,a,D,U){var F,w,mh,u,c,J;const q=a[a.length-1];q.config=q.config||{},q.config.glTF=U;const Q=null===(F=h.configuration)||void 0===F||null===(w=F.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===Q||"number"!==typeof Q)throw new Error("nodeIndex not found in configuration");const Y=Zl+Q;return a[1].config.variable=Y,D._userVariables[Y]={className:"Mesh",id:null===U||void 0===U||null===(mh=U.nodes)||void 0===mh||null===(u=mh[Q]._babylonTransformNode)||void 0===u?void 0:u.id,uniqueId:null===U||void 0===U||null===(c=U.nodes)||void 0===c||null===(J=c[Q]._babylonTransformNode)||void 0===J?void 0:J.uniqueId},a}}),(0,g.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:h=>{const R=h._babylonTransformNode;return!R||void 0===R.pointerOverDisableMeshTesting||R.pointerOverDisableMeshTesting},set:(h,R)=>{var l;null===(l=R._primitiveBabylonMeshes)||void 0===l||l.forEach((R=>{R.pointerOverDisableMeshTesting=!h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Ml{constructor(h){this.name=el,this._loader=h,this.enabled=h.isExtensionUsed(el)}async onReady(){var h;null===(h=this._loader.qF.nodes)||void 0===h||h.forEach((h=>{var R,l,j;null!==(R=h.extensions)&&void 0!==R&&R.KHR_node_hoverability&&!1===(null===(l=h.extensions)||void 0===l?void 0:l.KHR_node_hoverability.hoverable)&&(null===(j=h._babylonTransformNode)||void 0===j||j.getChildMeshes().forEach((h=>{h.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}W(el),K(el,!0,(h=>new Ml(h)));const il="ExtrasAsMetadata";class dl{_assignExtras(h,R){if(R.extras&&Object.keys(R.extras).length>0){const l=h.metadata=h.metadata||{};(l.qF=l.qF||{}).extras=R.extras}}constructor(h){this.name=il,this.enabled=!0,this._loader=h}dispose(){this._loader=null}loadNodeAsync(h,R,l){return this._loader.loadNodeAsync(h,R,(h=>{this._assignExtras(h,R),l(h)}))}loadCameraAsync(h,R,l){return this._loader.loadCameraAsync(h,R,(h=>{this._assignExtras(h,R),l(h)}))}createMaterial(h,R,l){const j=this._loader.createMaterial(h,R,l);return this._assignExtras(j,R),j}}W(il),K(il,!1,(h=>new dl(h)));l(14653)},14530:(h,R,l)=>{"use strict";l.d(R,{d:()=>r,g:()=>y,h:()=>O,k:()=>v});var j=l(12696),a=l(12689),D=l(14197),U=l(13310),F=l(13284),w=l(13293),mh=l(12711),u=l(12749),c=l(13307),J=l(13417),q=l(13313),Q=l(12944);class Y{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.SJ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Oq=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(h){this._environmentTexture=h}getNodes(){let h=[];h=h.concat(this.meshes),h=h.concat(this.lights),h=h.concat(this.cameras),h=h.concat(this.transformNodes);for(const R of this.skeletons)h=h.concat(R.bones);return h}}class s extends Y{}class t{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const h=this.rootNodes;for(const j of h)j.dispose();h.length=0;const R=this.skeletons;for(const j of R)j.dispose();R.length=0;const l=this.animationGroups;for(const j of l)j.dispose();l.length=0}}class f extends Y{constructor(h){super(),this._wasAddedToScene=!1,(h=h||u.b.LastCreatedScene)&&(this.TR=h,this.proceduralTextures=[],h.mw.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=h.getEngine().onContextRestoredObservable.add((()=>{for(const h of this.geometries)h._rebuild();for(const h of this.meshes)h._rebuild();for(const h of this.SJ)h.rebuild();for(const h of this.textures)h._rebuild()})))}_topologicalSort(h){const R=new Map;for(const U of h)R.set(U.uniqueId,U);const l={dependsOn:new Map,dependedBy:new Map};for(const U of h){const h=U.uniqueId;l.dependsOn.set(h,new Set),l.dependedBy.set(h,new Set)}for(const U of h){const h=U.uniqueId,j=l.dependsOn.get(h);if(U instanceof c.e){const a=U.sourceMesh;R.has(a.uniqueId)&&(j.add(a.uniqueId),l.dependedBy.get(a.uniqueId).add(h))}const a=l.dependedBy.get(h);for(const D of U.getDescendants()){const j=D.uniqueId;if(R.has(j)){a.add(j);l.dependsOn.get(j).add(h)}}}const j=[],a=[];for(const U of h){const h=U.uniqueId;0===l.dependsOn.get(h).size&&(a.push(U),R.delete(h))}const D=a;for(;D.length>0;){const h=D.shift();j.push(h);const a=l.dependedBy.get(h.uniqueId);for(const j of Array.from(a.values())){const a=l.dependsOn.get(j);a.delete(h.uniqueId),0===a.size&&R.get(j)&&(D.push(R.get(j)),R.delete(j))}}return R.size>0&&(mh.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),R.forEach((h=>{mh.c.Error(h.name)}))),j}_addNodeAndDescendantsToList(h,R,l,j){if(l&&(!j||j(l))&&!R.has(l.uniqueId)){h.push(l),R.add(l.uniqueId);for(const a of l.getDescendants(!0))this._addNodeAndDescendantsToList(h,R,a,j)}}_isNodeInContainer(h){return h instanceof w.c&&-1!==this.meshes.indexOf(h)||(h instanceof F.d&&-1!==this.transformNodes.indexOf(h)||(h instanceof J.e&&-1!==this.lights.indexOf(h)||h instanceof q.e&&-1!==this.cameras.indexOf(h)))}_isValidHierarchy(){for(const h of this.meshes)if(h.parent&&!this._isNodeInContainer(h.parent))return mh.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.transformNodes)if(h.parent&&!this._isNodeInContainer(h.parent))return mh.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.lights)if(h.parent&&!this._isNodeInContainer(h.parent))return mh.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.cameras)if(h.parent&&!this._isNodeInContainer(h.parent))return mh.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||a.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const j={},D={},F=new t,w=[],mh=[],u={doNotInstantiate:!0,...l},c=[],J=new Set;for(const a of this.transformNodes)null===a.parent&&this._addNodeAndDescendantsToList(c,J,a,u.predicate);for(const a of this.meshes)null===a.parent&&this._addNodeAndDescendantsToList(c,J,a,u.predicate);const q=this._topologicalSort(c),Q=(l,a)=>{if(((R,l)=>{if(j[R.uniqueId]=l.uniqueId,D[l.uniqueId]=l,h&&(l.name=h(R.name)),l instanceof U.b){const h=l;if(h.morphTargetManager){const l=R.morphTargetManager;h.morphTargetManager=l.clone();for(let R=0;R<l.numTargets;R++){const a=l.getTarget(R),U=h.morphTargetManager.getTarget(R);j[a.uniqueId]=U.uniqueId,D[U.uniqueId]=U}}}})(l,a),l.parent){const h=j[l.parent.uniqueId],R=D[h];a.parent=R||l.parent}if(a.position&&l.position&&a.position.D(l.position),a.rotationQuaternion&&l.rotationQuaternion&&a.rotationQuaternion.D(l.rotationQuaternion),a.rotation&&l.rotation&&a.rotation.D(l.rotation),a.yF&&l.yF&&a.yF.D(l.yF),a.material){const U=a;if(U.material)if(R){const R=l.material;if(-1===mh.indexOf(R)){let l=R.clone(h?h(R.name):"Clone of "+R.name);if(mh.push(R),j[R.uniqueId]=l.uniqueId,D[l.uniqueId]=l,"MultiMaterial"===R.getClassName()){const a=R;for(const R of a.IF)R&&(l=R.clone(h?h(R.name):"Clone of "+R.name),mh.push(R),j[R.uniqueId]=l.uniqueId,D[l.uniqueId]=l);a.IF=a.IF.map((h=>h&&D[j[h.uniqueId]]))}}"InstancedMesh"!==U.getClassName()&&(U.material=D[j[R.uniqueId]])}else"MultiMaterial"===U.material.getClassName()?-1===this.TR.multiMaterials.indexOf(U.material)&&this.TR.addMultiMaterial(U.material):-1===this.TR.materials.indexOf(U.material)&&this.TR.addMaterial(U.material)}null===a.parent&&F.rootNodes.push(a)};for(const a of q)if("InstancedMesh"===a.getClassName()){const h=a,R=h.sourceMesh,l=j[R.uniqueId];Q(h,("number"===typeof l?D[l]:R).createInstance(h.name))}else{let h=!0;"lc"===a.getClassName()||"Node"===a.getClassName()||a.skeleton||!a.getTotalVertices||0===a.getTotalVertices()?h=!1:u.doNotInstantiate&&(h="function"===typeof u.doNotInstantiate?!u.doNotInstantiate(a):!u.doNotInstantiate);const R=h?a.createInstance(`instance of ${a.name}`):a.clone(`Clone of ${a.name}`,null,!0);if(!R)throw new Error(`Could not clone or instantiate node on Asset Container ${a.name}`);Q(a,R)}for(const a of this.skeletons){if(u.predicate&&!u.predicate(a))continue;const R=a.clone(h?h(a.name):"Clone of "+a.name);for(const h of this.meshes)if(h.skeleton===a&&!h.isAnInstance){const l=D[j[h.uniqueId]];if(!l||l.isAnInstance)continue;if(l.skeleton=R,-1!==w.indexOf(R))continue;w.push(R);for(const h of R.bones)h._linkedTransformNode&&(h._linkedTransformNode=D[j[h._linkedTransformNode.uniqueId]])}F.skeletons.push(R)}for(const a of this.animationGroups){if(u.predicate&&!u.predicate(a))continue;const R=a.clone(h?h(a.name):"Clone of "+a.name,(h=>D[j[h.uniqueId]]||h));F.animationGroups.push(R)}return F}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||a.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.TR.environmentTexture=this.environmentTexture);for(const h of this.TR._serializableComponents)h.addFromContainer(this);this.TR.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const R=[];for(const l of this.cameras)h&&!h(l)||(this.TR.addCamera(l),R.push(l));for(const l of this.lights)h&&!h(l)||(this.TR.addLight(l),R.push(l));for(const l of this.meshes)h&&!h(l)||(this.TR.uu(l),R.push(l));for(const l of this.skeletons)h&&!h(l)||this.TR.addSkeleton(l);for(const l of this.animations)h&&!h(l)||this.TR.addAnimation(l);for(const l of this.animationGroups)h&&!h(l)||this.TR.addAnimationGroup(l);for(const l of this.multiMaterials)h&&!h(l)||this.TR.addMultiMaterial(l);for(const l of this.materials)h&&!h(l)||this.TR.addMaterial(l);for(const l of this.morphTargetManagers)h&&!h(l)||this.TR.addMorphTargetManager(l);for(const l of this.geometries)h&&!h(l)||this.TR.addGeometry(l);for(const l of this.transformNodes)h&&!h(l)||(this.TR.addTransformNode(l),R.push(l));for(const l of this.actionManagers)h&&!h(l)||this.TR.addActionManager(l);for(const l of this.textures)h&&!h(l)||this.TR.addTexture(l);for(const l of this.reflectionProbes)h&&!h(l)||this.TR.addReflectionProbe(l);for(const l of R)l.parent&&-1===this.TR.getNodes().indexOf(l.parent)&&(l.setParent?l.setParent(null):l.parent=null)}removeAllFromScene(){this._isValidHierarchy()||a.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.TR.environmentTexture&&(this.TR.environmentTexture=null);for(const h of this.TR._serializableComponents)h.removeFromContainer(this)}removeFromScene(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const R of this.cameras)h&&!h(R)||this.TR.removeCamera(R);for(const R of this.lights)h&&!h(R)||this.TR.removeLight(R);for(const R of this.meshes)h&&!h(R)||this.TR.wu(R,!0);for(const R of this.skeletons)h&&!h(R)||this.TR.removeSkeleton(R);for(const R of this.animations)h&&!h(R)||this.TR.removeAnimation(R);for(const R of this.animationGroups)h&&!h(R)||this.TR.removeAnimationGroup(R);for(const R of this.multiMaterials)h&&!h(R)||this.TR.removeMultiMaterial(R);for(const R of this.materials)h&&!h(R)||this.TR.removeMaterial(R);for(const R of this.morphTargetManagers)h&&!h(R)||this.TR.removeMorphTargetManager(R);for(const R of this.geometries)h&&!h(R)||this.TR.removeGeometry(R);for(const R of this.transformNodes)h&&!h(R)||this.TR.removeTransformNode(R);for(const R of this.actionManagers)h&&!h(R)||this.TR.removeActionManager(R);for(const R of this.textures)h&&!h(R)||this.TR.removeTexture(R);for(const R of this.reflectionProbes)h&&!h(R)||this.TR.removeReflectionProbe(R)}dispose(){const h=this.cameras.slice(0);for(const q of h)q.dispose();this.cameras.length=0;const R=this.lights.slice(0);for(const q of R)q.dispose();this.lights.length=0;const l=this.meshes.slice(0);for(const q of l)q.dispose();this.meshes.length=0;const j=this.skeletons.slice(0);for(const q of j)q.dispose();this.skeletons.length=0;const a=this.animationGroups.slice(0);for(const q of a)q.dispose();this.animationGroups.length=0;const D=this.multiMaterials.slice(0);for(const q of D)q.dispose();this.multiMaterials.length=0;const U=this.materials.slice(0);for(const q of U)q.dispose();this.materials.length=0;const F=this.geometries.slice(0);for(const q of F)q.dispose();this.geometries.length=0;const w=this.transformNodes.slice(0);for(const q of w)q.dispose();this.transformNodes.length=0;const mh=this.actionManagers.slice(0);for(const q of mh)q.dispose();this.actionManagers.length=0;const u=this.textures.slice(0);for(const q of u)q.dispose();this.textures.length=0;const c=this.reflectionProbes.slice(0);for(const q of c)q.dispose();this.reflectionProbes.length=0;const J=this.morphTargetManagers.slice(0);for(const q of J)q.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const q of this.TR._serializableComponents)q.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.TR.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(h,R,l){if(h&&R)for(const j of h){let h=!0;if(l)for(const R of l)if(j===R){h=!1;break}h&&(R.push(j),j._parentContainer=this)}}moveAllFromScene(h){this._wasAddedToScene=!1,void 0===h&&(h=new s);for(const R in this)Object.prototype.hasOwnProperty.call(this,R)&&(this[R]=this[R]||("_environmentTexture"===R?null:[]),this._moveAssets(this.TR[R],this[R],h[R]));this.environmentTexture=this.TR.environmentTexture,this.removeAllFromScene()}createRootMesh(){const h=new U.b("assetContainerRootMesh",this.TR);for(const R of this.meshes)R.parent||h.addChild(R);return this.meshes.unshift(h),h}mergeAnimationsTo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.b.LastCreatedScene,R=arguments.length>1?arguments[1]:void 0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!h)return mh.c.Error("No scene available to merge animations to"),[];const j=l||(R=>{let l=null;const j=R.animations.length?R.animations[0].targetProperty:"",a=R.name.split(".").join("").split("_primitive")[0];switch(j){case"position":case"rotationQuaternion":l=h.getTransformNodeByName(R.name)||h.getTransformNodeByName(a);break;case"influence":l=h.getMorphTargetByName(R.name)||h.getMorphTargetByName(a);break;default:l=h.getNodeByName(R.name)||h.getNodeByName(a)}return l}),a=this.getNodes();for(const F of a){const h=j(F);if(null!==h){for(const R of F.animations){const l=h.animations.filter((h=>h.targetProperty===R.targetProperty));for(const R of l){const l=h.animations.indexOf(R,0);l>-1&&h.animations.splice(l,1)}}h.animations=h.animations.concat(F.animations)}}const D=[],U=this.animationGroups.slice();for(const F of U){D.push(F.clone(F.name,j));for(const h of F.animatables)h.stop()}for(const F of R){const R=j(F.target);R&&(h.beginAnimation(R,F.fromFrame,F.toFrame,F.loopAnimation,F.speedRatio,F.onAnimationEnd?F.onAnimationEnd:void 0,void 0,!0,void 0,F.onAnimationLoop?F.onAnimationLoop:void 0),h.stopAnimation(F.target))}return D}populateRootNodes(){this.rootNodes.length=0;for(const h of this.meshes)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.transformNodes)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.lights)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.cameras)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h)}addAllAssetsToContainer(h){if(!h)return;const R=[],l=new Set;for(R.push(h);R.length>0;){const h=R.pop();if(h instanceof U.b?(h.xF&&-1===this.geometries.indexOf(h.xF)&&this.geometries.push(h.xF),this.meshes.push(h)):h instanceof c.e?this.meshes.push(h):h instanceof F.d?this.transformNodes.push(h):h instanceof J.e?this.lights.push(h):h instanceof q.e&&this.cameras.push(h),h instanceof w.c){if(h.material&&-1===this.materials.indexOf(h.material)){this.materials.push(h.material);for(const R of h.material.getActiveTextures())-1===this.textures.indexOf(R)&&this.textures.push(R)}h.skeleton&&-1===this.skeletons.indexOf(h.skeleton)&&this.skeletons.push(h.skeleton),h.morphTargetManager&&-1===this.morphTargetManagers.indexOf(h.morphTargetManager)&&this.morphTargetManagers.push(h.morphTargetManager)}for(const j of h.getChildren())l.has(j)||R.push(j);l.add(h)}this.populateRootNodes()}_getByTags(h,R,l){if(void 0===R)return h;const j=[];for(const a in h){const D=h[a];Q.e&&Q.e.MatchesQuery(D,R)&&(!l||l(D))&&j.push(D)}return j}getMeshesByTags(h,R){return this._getByTags(this.meshes,h,R)}getCamerasByTags(h,R){return this._getByTags(this.cameras,h,R)}getLightsByTags(h,R){return this._getByTags(this.lights,h,R)}getMaterialsByTags(h,R){return this._getByTags(this.materials,h,R).concat(this._getByTags(this.multiMaterials,h,R))}getTransformNodesByTags(h,R){return this._getByTags(this.transformNodes,h,R)}}var T=l(12774);class E{constructor(h){this.byteOffset=0,this.buffer=h}async loadAsync(h){const R=await this.buffer.readAsync(this.byteOffset,h);this._dataView=new DataView(R.buffer,R.byteOffset,R.byteLength),this._dataByteOffset=0}readUint32(){const h=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,h}readUint8Array(h){const R=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,h);return this._dataByteOffset+=h,this.byteOffset+=h,R}readString(h){return(0,T.j)(this.readUint8Array(h))}skipBytes(h){this._dataByteOffset+=h,this.byteOffset+=h}}var x=l(14533);const G="Z2xURg",p={name:"qF",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:h=>-1!==h.indexOf("asset")&&-1!==h.indexOf("version")||h.startsWith("data:base64,"+G)||h.startsWith("data:;base64,"+G)||h.startsWith("data:application/octet-stream;base64,"+G)||h.startsWith("data:model/gltf-binary;base64,"+G)};var O,y,v,b=l(12758),I=l(12766);function L(h,R,l){try{return Promise.resolve(new Uint8Array(h,R,l))}catch(j){return Promise.reject(j)}}!function(h){h[h.AUTO=0]="AUTO",h[h.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(O||(O={})),function(h){h[h.NONE=0]="NONE",h[h.FIRST=1]="FIRST",h[h.ALL=2]="ALL"}(y||(y={})),function(h){h[h.LOADING=0]="LOADING",h[h.READY=1]="READY",h[h.COMPLETE=2]="COMPLETE"}(v||(v={}));class n{constructor(){this.coordinateSystemMode=O.AUTO,this.animationStartMode=y.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=h=>Promise.resolve(h),this.extensionOptions={}}D(h){h&&(this.onParsed=h.onParsed,this.coordinateSystemMode=h.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=h.animationStartMode??this.animationStartMode,this.loadNodeAnimations=h.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=h.loadSkins??this.loadSkins,this.loadMorphTargets=h.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=h.compileMaterials??this.compileMaterials,this.useClipPlane=h.useClipPlane??this.useClipPlane,this.compileShadowGenerators=h.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=h.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=h.useRangeRequests??this.useRangeRequests,this.createInstances=h.createInstances??this.createInstances,this.alwaysComputeBoundingBox=h.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=h.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=h.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=h.skipMaterials??this.skipMaterials,this.useSRGBBuffers=h.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=h.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=h.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=h.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=h.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=h.customRootNode,this.onMeshLoaded=h.onMeshLoaded,this.onSkinLoaded=h.onSkinLoaded,this.onTextureLoaded=h.onTextureLoaded,this.onMaterialLoaded=h.onMaterialLoaded,this.onCameraLoaded=h.onCameraLoaded,this.extensionOptions=h.extensionOptions??this.extensionOptions)}}class r extends n{constructor(h){super(),this.onParsedObservable=new j.d,this.onMeshLoadedObservable=new j.d,this.onSkinLoadedObservable=new j.d,this.onTextureLoadedObservable=new j.d,this.onMaterialLoadedObservable=new j.d,this.onCameraLoadedObservable=new j.d,this.onCompleteObservable=new j.d,this.onErrorObservable=new j.d,this.mw=new j.d,this.onExtensionLoadedObservable=new j.d,this.validate=!1,this.onValidatedObservable=new j.d,this._loader=null,this._state=null,this._requests=new Array,this.name=p.name,this.extensions=p.extensions,this.onLoaderStateChangedObservable=new j.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.D(h)}set onParsed(h){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),h&&(this._onParsedObserver=this.onParsedObservable.add(h))}set onMeshLoaded(h){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),h&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(h))}set onSkinLoaded(h){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),h&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((R=>h(R.node,R.skinnedNode))))}set onTextureLoaded(h){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),h&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(h))}set onMaterialLoaded(h){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),h&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(h))}set onCameraLoaded(h){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),h&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(h))}set onComplete(h){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(h)}set onError(h){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(h)}set onDispose(h){this._onDisposeObserver&&this.mw.remove(this._onDisposeObserver),this._onDisposeObserver=this.mw.add(h)}set onExtensionLoaded(h){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(h)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(h){this._loggingEnabled!==h&&(this._loggingEnabled=h,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(h){this._capturePerformanceCounters!==h&&(this._capturePerformanceCounters=h,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(h){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(h)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const h of this._requests)h.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=h=>Promise.resolve(h),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.mw.notifyObservers(void 0),this.mw.clear()}loadFile(h,R,l,D,U,F,w,u){if(ArrayBuffer.isView(R))return this._loadBinary(h,R,l,D,w,u),null;this._progressCallback=U;const c=R.name||a.Tools.GetFilename(R);if(F){if(this.useRangeRequests){this.validate&&mh.c.Warn("glTF validation is not supported when range requests are enabled");const l={abort:()=>{},onCompleteObservable:new j.d},a={readAsync:(l,j)=>new Promise(((a,D)=>{this._loadFile(h,R,(h=>{a(new Uint8Array(h))}),!0,(h=>{D(h)}),(h=>{h.setRequestHeader("Range",`bytes=${l}-${l+j-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new E(a)).then((h=>{l.onCompleteObservable.notifyObservers(l),D(h)}),w?h=>w(void 0,h):void 0),l}return this._loadFile(h,R,(R=>{this._validate(h,new Uint8Array(R,0,R.byteLength),l,c),this._unpackBinaryAsync(new E({readAsync:(h,l)=>L(R,h,l),byteLength:R.byteLength})).then((h=>{D(h)}),w?h=>w(void 0,h):void 0)}),!0,w)}return this._loadFile(h,R,(R=>{try{this._validate(h,R,l,c),D({json:this._parseJson(R)})}catch{w&&w()}}),!1,w)}_loadBinary(h,R,l,j,a,D){this._validate(h,new Uint8Array(R.buffer,R.byteOffset,R.byteLength),l,D),this._unpackBinaryAsync(new E({readAsync:(h,l)=>function(h,R,l){try{if(R<0||R>=h.byteLength)throw new RangeError("Offset is out of range.");if(R+l>h.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(h.buffer,h.byteOffset+R,l))}catch(j){return Promise.reject(j)}}(R,h,l),byteLength:R.byteLength})).then((h=>{j(h)}),a?h=>a(void 0,h):void 0)}importMeshAsync(h,R,l,j,a,D){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(l),this.onParsedObservable.clear(),this._log(`Loading ${D||""}`),this._loader=this._getLoader(l),this._loader.importMeshAsync(h,R,null,l,j,a,D))))}loadAsync(h,R,l,j,a){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(R),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(R),this._loader.loadAsync(h,R,l,j,a))))}loadAssetContainerAsync(h,R,l,j,a){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(R),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(R);const D=new f(h),U=[];this.onMaterialLoadedObservable.add((h=>{U.push(h)}));const F=[];this.onTextureLoadedObservable.add((h=>{F.push(h)}));const w=[];this.onCameraLoadedObservable.add((h=>{w.push(h)}));const mh=[];return this.onMeshLoadedObservable.add((h=>{h.morphTargetManager&&mh.push(h.morphTargetManager)})),this._loader.importMeshAsync(null,h,D,R,l,j,a).then((h=>(Array.prototype.push.apply(D.geometries,h.geometries),Array.prototype.push.apply(D.meshes,h.meshes),Array.prototype.push.apply(D.SJ,h.SJ),Array.prototype.push.apply(D.skeletons,h.skeletons),Array.prototype.push.apply(D.animationGroups,h.animationGroups),Array.prototype.push.apply(D.materials,U),Array.prototype.push.apply(D.textures,F),Array.prototype.push.apply(D.lights,h.lights),Array.prototype.push.apply(D.transformNodes,h.transformNodes),Array.prototype.push.apply(D.cameras,w),Array.prototype.push.apply(D.morphTargetManagers,mh),D)))}))}canDirectLoad(h){return p.canDirectLoad(h)}directLoad(h,R){if(R.startsWith("base64,"+G)||R.startsWith(";base64,"+G)||R.startsWith("application/octet-stream;base64,"+G)||R.startsWith("model/gltf-binary;base64,"+G)){const l=(0,b.e)(R);return this._validate(h,new Uint8Array(l,0,l.byteLength)),this._unpackBinaryAsync(new E({readAsync:(h,R)=>L(l,h,R),byteLength:l.byteLength}))}return this._validate(h,R),Promise.resolve({json:this._parseJson(R)})}createPlugin(h){return new r(h[p.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((h,R)=>{this.onCompleteObservable.addOnce((()=>{h()})),this.onErrorObservable.addOnce((h=>{R(h)}))}))}_setState(h){this._state!==h&&(this._state=h,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(v[this._state]))}_loadFile(h,R,l,j,a,D){const U=h._loadFile(R,l,(h=>{this._onProgress(h,U)}),!0,j,a,D);return U.onCompleteObservable.add((()=>{U._lengthComputable=!0,U._total=U._loaded})),this._requests.push(U),U}_onProgress(h,R){if(!this._progressCallback)return;R._lengthComputable=h.lengthComputable,R._loaded=h.loaded,R._total=h.total;let l=!0,j=0,a=0;for(const D of this._requests){if(void 0===D._lengthComputable||void 0===D._loaded||void 0===D._total)return;l=l&&D._lengthComputable,j+=D._loaded,a+=D._total}this._progressCallback({lengthComputable:l,loaded:j,total:l?a:0})}_validate(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),x.b.ValidateAsync(R,l,j,(R=>this.preprocessUrlAsync(l+R).then((R=>h._loadFileAsync(R,void 0,!0,!0).then((h=>new Uint8Array(h,0,h.byteLength))))))).then((h=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(h),this.onValidatedObservable.clear()}),(h=>{this._endPerformanceCounter("Validate JSON"),a.Tools.Warn(`Failed to validate: ${h.message}`),this.onValidatedObservable.clear()})))}_getLoader(h){const R=h.json.asset||{};this._log(`Asset version: ${R.version}`),R.minVersion&&this._log(`Asset minimum version: ${R.minVersion}`),R.generator&&this._log(`Asset generator: ${R.generator}`);const l=r._parseVersion(R.version);if(!l)throw new Error("Invalid version: "+R.version);if(void 0!==R.minVersion){const h=r._parseVersion(R.minVersion);if(!h)throw new Error("Invalid minimum version: "+R.minVersion);if(r._compareVersion(h,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+R.minVersion)}const j={1:r._CreateGLTF1Loader,2:r._CreateGLTF2Loader}[l.major];if(!j)throw new Error("Unsupported version: "+R.version);return j(this)}_parseJson(h){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${h.length}`);const R=JSON.parse(h);return this._endPerformanceCounter("Parse JSON"),R}_unpackBinaryAsync(h){return this._startPerformanceCounter("Unpack Binary"),h.loadAsync(20).then((()=>{const R=h.readUint32();if(1179937895!==R)throw new I.g("Unexpected magic: "+R,I.f.GLTFLoaderUnexpectedMagicError);const l=h.readUint32();this.loggingEnabled&&this._log(`Binary version: ${l}`);const j=h.readUint32();let a;switch(this.useRangeRequests||j===h.buffer.byteLength||mh.c.Warn(`Length in header does not match actual data length: ${j} != ${h.buffer.byteLength}`),l){case 1:a=this._unpackBinaryV1Async(h,j);break;case 2:a=this._unpackBinaryV2Async(h,j);break;default:throw new Error("Unsupported version: "+l)}return this._endPerformanceCounter("Unpack Binary"),a}))}_unpackBinaryV1Async(h,R){const l=h.readUint32(),j=h.readUint32();if(0!==j)throw new Error(`Unexpected content format: ${j}`);const a=R-h.byteOffset,D={json:this._parseJson(h.readString(l)),bin:null};if(0!==a){const R=h.byteOffset;D.bin={readAsync:(l,j)=>h.buffer.readAsync(R+l,j),byteLength:a}}return Promise.resolve(D)}_unpackBinaryV2Async(h,R){const l=1313821514,j=5130562,a=h.readUint32();if(h.readUint32()!==l)throw new Error("First chunk format is not JSON");return h.byteOffset+a===R?h.loadAsync(a).then((()=>({json:this._parseJson(h.readString(a)),bin:null}))):h.loadAsync(a+8).then((()=>{const D={json:this._parseJson(h.readString(a)),bin:null},U=()=>{const a=h.readUint32();switch(h.readUint32()){case l:throw new Error("Unexpected JSON chunk");case j:{const R=h.byteOffset;D.bin={readAsync:(l,j)=>h.buffer.readAsync(R+l,j),byteLength:a},h.skipBytes(a);break}default:h.skipBytes(a)}return h.byteOffset!==R?h.loadAsync(8).then(U):Promise.resolve(D)};return U()}))}static _parseVersion(h){if("1.0"===h||"1.0.1"===h)return{major:1,minor:0};const R=(h+"").match(/^(\d+)\.(\d+)/);return R?{major:parseInt(R[1]),minor:parseInt(R[2])}:null}static _compareVersion(h,R){return h.major>R.major?1:h.major<R.major?-1:h.minor>R.minor?1:h.minor<R.minor?-1:0}_logOpen(h){this._log(h),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(h){const R=r._logSpaces.substring(0,2*this._logIndentLevel);mh.c.Log(`${R}${h}`)}_logDisabled(h){}_startPerformanceCounterEnabled(h){a.Tools.StartPerformanceCounter(h)}_startPerformanceCounterDisabled(h){}_endPerformanceCounterEnabled(h){a.Tools.EndPerformanceCounter(h)}_endPerformanceCounterDisabled(h){}}r.IncrementalLoading=!0,r.HomogeneousCoordinates=!1,r._logSpaces="                                ",(0,D.b)(new r)},14533:(h,R,l)=>{"use strict";l.d(R,{b:()=>U});var j=l(12689);function a(h,R,l,j){const a={externalResourceFunction:j};return l&&(a.uri="file:"===R?l:R+l),ArrayBuffer.isView(h)?GLTFValidator.validateBytes(h,a):GLTFValidator.validateString(h,a)}function D(){const h=[];onmessage=R=>{const l=R.data;switch(l.id){case"init":importScripts(l.url);break;case"validate":a(l.data,l.rootUrl,l.fileName,(R=>new Promise(((l,j)=>{const a=h.length;h.push({resolve:l,reject:j}),postMessage({id:"getExternalResource",index:a,uri:R})})))).then((h=>{postMessage({id:"validate.resolve",value:h})}),(h=>{postMessage({id:"validate.reject",reason:h})}));break;case"getExternalResource.resolve":h[l.index].resolve(l.value);break;case"getExternalResource.reject":h[l.index].reject(l.reason)}}}class U{static ValidateAsync(h,R,l,U){return"function"===typeof Worker?new Promise(((F,w)=>{const mh=`${a}(${D})()`,u=URL.createObjectURL(new Blob([mh],{type:"application/javascript"})),c=new Worker(u),J=h=>{c.removeEventListener("error",J),c.removeEventListener("message",q),w(h)},q=h=>{const R=h.data;switch(R.id){case"getExternalResource":U(R.uri).then((h=>{c.postMessage({id:"getExternalResource.resolve",index:R.index,value:h},[h.buffer])}),(h=>{c.postMessage({id:"getExternalResource.reject",index:R.index,reason:h})}));break;case"validate.resolve":c.removeEventListener("error",J),c.removeEventListener("message",q),F(R.value),c.terminate();break;case"validate.reject":c.removeEventListener("error",J),c.removeEventListener("message",q),w(R.reason),c.terminate()}};if(c.addEventListener("error",J),c.addEventListener("message",q),c.postMessage({id:"init",url:j.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(h)){const j=h.slice();c.postMessage({id:"validate",data:j,rootUrl:R,fileName:l},[j.buffer])}else c.postMessage({id:"validate",data:h,rootUrl:R,fileName:l})})):(this._LoadScriptPromise||(this._LoadScriptPromise=j.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>a(h,R,l,U))))}}U.Configuration={url:`${j.Tools._DefaultCdnUrl}/gltf_validator.js`}},15105:(h,R,l)=>{"use strict";l.d(R,{e:()=>p});var j=l(12882),a=l(12887),D=l(12942),U=l(12900),F=l(13247),w=l(13177),mh=l(12984),u=l(13126),c=l(12852),J=l(12808);l(14305),l(14232),l(14245),l(14240),l(14247),l(14251),l(14254);const q="imageProcessingCompatibility",Q="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";J.d.IncludesShadersStore[q]||(J.d.IncludesShadersStore[q]=Q);const Y="skyPixelShader",s="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";J.d.ShadersStore[Y]||(J.d.ShadersStore[Y]=s);l(14320),l(14261),l(14265),l(14275),l(14268);const t="skyVertexShader",f="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";J.d.ShadersStore[t]||(J.d.ShadersStore[t]=f);var T=l(13175),E=l(13226),x=l(13219);class G extends F.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class p extends w.d{constructor(h,R){super(h,R),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new U.tR(0,100,0),this.useSunPosition=!1,this.cameraOffset=U.tR.Zero(),this.up=U.tR.Up(),this.dithering=!1,this._cameraPosition=U.tR.Zero(),this._skyOrientation=new U.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(h,R){const l=R._drawWrapper;if(this.isFrozen&&l.effect&&l._wasPreviouslyReady)return!0;R.materialDefines||(R.materialDefines=new G);const j=R.materialDefines,a=this.yh();if(this._isReadyForSubMesh(R))return!0;if((0,x.U)(h,a,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,j),(0,x.K)(h,j,!0,!1),j.IMAGEPROCESSINGPOSTPROCESS!==a.imageProcessingConfiguration.applyByPostProcess&&j.markAsMiscDirty(),j.DITHER!==this.dithering&&j.markAsMiscDirty(),j.isDirty){j.markAsProcessed(),a.resetCachedMaterial();const h=new T.d;j.FOG&&h.addFallback(1,"FOG"),j.IMAGEPROCESSINGPOSTPROCESS=a.imageProcessingConfiguration.applyByPostProcess,j.DITHER=this.dithering;const l=[mh.g.PositionKind];j.VERTEXCOLOR&&l.push(mh.g.ColorKind);const D="sky",U=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,E.d)(U);const F=j.toString();R.setEffect(a.getEngine().createEffect(D,l,U,[],F,h,this.onCompiled,this.onError),j,this._materialContext)}return!(!R.effect||!R.effect.isReady())&&(j._renderId=a.getRenderId(),l._wasPreviouslyReady=!0,!0)}bindForSubMesh(h,R,l){const j=this.yh(),a=l.materialDefines;if(!a)return;const D=l.effect;if(!D)return;this._activeEffect=D,this.bindOnlyWorldMatrix(h),this._activeEffect.setMatrix("viewProjection",j.getTransformMatrix()),this._mustRebind(j,D,l)&&((0,E.f)(D,this,j),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.m)(a,D,j)),j.fogEnabled&&R.applyFog&&j.fogMode!==u.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",j.getViewMatrix()),(0,x.g)(j,R,this._activeEffect);const F=j.activeCamera;if(F){const h=F.getWorldMatrix();this._cameraPosition.x=h.m[12],this._cameraPosition.y=h.m[13],this._cameraPosition.z=h.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const h=Math.PI*(this.inclination-.5),R=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(R)*Math.cos(h),this.sunPosition.y=this.distance*Math.sin(-h),this.sunPosition.z=this.distance*Math.sin(R)*Math.cos(h),U.Quaternion.FromUnitVectorsToRef(U.tR.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(R,this._activeEffect,l)}getAnimatables(){return[]}dispose(h){super.dispose(h)}clone(h){return D.c.Clone((()=>new p(h,this.yh())),this)}serialize(){const h=super.serialize();return h.customType="BABYLON.SkyMaterial",h}getClassName(){return"SkyMaterial"}static Parse(h,R,l){return D.c.Parse((()=>new p(h.name,R)),h,R,l)}}(0,j.e)([(0,a.G)()],p.prototype,"luminance",void 0),(0,j.e)([(0,a.G)()],p.prototype,"turbidity",void 0),(0,j.e)([(0,a.G)()],p.prototype,"rayleigh",void 0),(0,j.e)([(0,a.G)()],p.prototype,"mieCoefficient",void 0),(0,j.e)([(0,a.G)()],p.prototype,"mieDirectionalG",void 0),(0,j.e)([(0,a.G)()],p.prototype,"distance",void 0),(0,j.e)([(0,a.G)()],p.prototype,"inclination",void 0),(0,j.e)([(0,a.G)()],p.prototype,"azimuth",void 0),(0,j.e)([(0,a.F)()],p.prototype,"sunPosition",void 0),(0,j.e)([(0,a.G)()],p.prototype,"useSunPosition",void 0),(0,j.e)([(0,a.F)()],p.prototype,"cameraOffset",void 0),(0,j.e)([(0,a.F)()],p.prototype,"up",void 0),(0,j.e)([(0,a.G)()],p.prototype,"dithering",void 0),(0,c.f)("BABYLON.SkyMaterial",p)},13580:(h,R,l)=>{"use strict";function j(h,R){R.headers=h.headers||{},R.statusMessage=h.statusText,R.statusCode=h.status,R.data=h.response}function a(h,R,l){return new Promise((function(a,D){l=l||{};var U,F,w,mh=new XMLHttpRequest,u=l.body,c=l.headers||{};for(U in l.timeout&&(mh.timeout=l.timeout),mh.ontimeout=mh.onerror=function(h){h.timeout="timeout"==h.type,D(h)},mh.open(h,R.href||R),mh.onload=function(){for(w=mh.getAllResponseHeaders().trim().split(/[\r\n]+/),j(mh,mh);F=w.shift();)F=F.split(": "),mh.headers[F.shift().toLowerCase()]=F.join(": ");if((F=mh.headers["content-type"])&&~F.indexOf("application/json"))try{mh.data=JSON.parse(mh.data,l.reviver)}catch(h){return j(mh,h),D(h)}(mh.status>=400?D:a)(mh)},typeof FormData<"u"&&u instanceof FormData||u&&"object"==typeof u&&(c["content-type"]="application/json",u=JSON.stringify(u)),mh.withCredentials=!!l.withCredentials,c)mh.setRequestHeader(U,c[U]);mh.send(u)}))}l.r(R),l.d(R,{del:()=>w,get:()=>D,patch:()=>F,post:()=>U,put:()=>mh,send:()=>a});var D=a.bind(a,"GET"),U=a.bind(a,"POST"),F=a.bind(a,"PATCH"),w=a.bind(a,"DELETE"),mh=a.bind(a,"PUT")},15204:(h,R,l)=>{"use strict";l.d(R,{b:()=>c});const j=.5*(Math.sqrt(3)-1),a=(3-Math.sqrt(3))/6,D=1/3,U=1/6,F=(Math.sqrt(5)-1)/4,w=(5-Math.sqrt(5))/20,mh=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),u=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const c=class{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const R="function"==typeof h?h:function(h){let R=0,l=0,j=0,a=1;const D=function(){let h=4022871197;return function(R){R=R.toString();for(let l=0;l<R.length;l++){h+=R.charCodeAt(l);let j=.02519603282416938*h;h=j>>>0,j-=h,j*=h,h=j>>>0,j-=h,h+=4294967296*j}return 2.3283064365386963e-10*(h>>>0)}}();R=D(" "),l=D(" "),j=D(" "),R-=D(h),R<0&&(R+=1);l-=D(h),l<0&&(l+=1);j-=D(h),j<0&&(j+=1);return function(){const h=2091639*R+2.3283064365386963e-10*a;return R=l,l=j,j=h-(a=0|h)}}(h);this.p=function(h){const R=new Uint8Array(256);for(let l=0;l<256;l++)R[l]=l;for(let l=0;l<255;l++){const j=l+~~(h()*(256-l)),a=R[l];R[l]=R[j],R[j]=a}return R}(R),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let l=0;l<512;l++)this.perm[l]=this.p[255&l],this.permMod12[l]=this.perm[l]%12}noise2D(h,R){const l=this.permMod12,D=this.perm;let U=0,F=0,w=0;const u=(h+R)*j,c=Math.floor(h+u),J=Math.floor(R+u),q=(c+J)*a,Q=h-(c-q),Y=R-(J-q);let s,t;Q>Y?(s=1,t=0):(s=0,t=1);const f=Q-s+a,T=Y-t+a,E=Q-1+2*a,x=Y-1+2*a,G=255&c,p=255&J;let O=.5-Q*Q-Y*Y;if(O>=0){const h=3*l[G+D[p]];O*=O,U=O*O*(mh[h]*Q+mh[h+1]*Y)}let y=.5-f*f-T*T;if(y>=0){const h=3*l[G+s+D[p+t]];y*=y,F=y*y*(mh[h]*f+mh[h+1]*T)}let v=.5-E*E-x*x;if(v>=0){const h=3*l[G+1+D[p+1]];v*=v,w=v*v*(mh[h]*E+mh[h+1]*x)}return 70*(U+F+w)}noise3D(h,R,l){const j=this.permMod12,a=this.perm;let F,w,u,c;const J=(h+R+l)*D,q=Math.floor(h+J),Q=Math.floor(R+J),Y=Math.floor(l+J),s=(q+Q+Y)*U,t=h-(q-s),f=R-(Q-s),T=l-(Y-s);let E,x,G,p,O,y;t>=f?f>=T?(E=1,x=0,G=0,p=1,O=1,y=0):t>=T?(E=1,x=0,G=0,p=1,O=0,y=1):(E=0,x=0,G=1,p=1,O=0,y=1):f<T?(E=0,x=0,G=1,p=0,O=1,y=1):t<T?(E=0,x=1,G=0,p=0,O=1,y=1):(E=0,x=1,G=0,p=1,O=1,y=0);const v=t-E+U,b=f-x+U,I=T-G+U,L=t-p+2*U,n=f-O+2*U,r=T-y+2*U,P=t-1+.5,z=f-1+.5,o=T-1+.5,K=255&q,W=255&Q,g=255&Y;let H=.6-t*t-f*f-T*T;if(H<0)F=0;else{const h=3*j[K+a[W+a[g]]];H*=H,F=H*H*(mh[h]*t+mh[h+1]*f+mh[h+2]*T)}let k=.6-v*v-b*b-I*I;if(k<0)w=0;else{const h=3*j[K+E+a[W+x+a[g+G]]];k*=k,w=k*k*(mh[h]*v+mh[h+1]*b+mh[h+2]*I)}let C=.6-L*L-n*n-r*r;if(C<0)u=0;else{const h=3*j[K+p+a[W+O+a[g+y]]];C*=C,u=C*C*(mh[h]*L+mh[h+1]*n+mh[h+2]*r)}let A=.6-P*P-z*z-o*o;if(A<0)c=0;else{const h=3*j[K+1+a[W+1+a[g+1]]];A*=A,c=A*A*(mh[h]*P+mh[h+1]*z+mh[h+2]*o)}return 32*(F+w+u+c)}noise4D(h,R,l,j){const a=this.perm;let D,U,mh,c,J;const q=(h+R+l+j)*F,Q=Math.floor(h+q),Y=Math.floor(R+q),s=Math.floor(l+q),t=Math.floor(j+q),f=(Q+Y+s+t)*w,T=h-(Q-f),E=R-(Y-f),x=l-(s-f),G=j-(t-f);let p=0,O=0,y=0,v=0;T>E?p++:O++,T>x?p++:y++,T>G?p++:v++,E>x?O++:y++,E>G?O++:v++,x>G?y++:v++;const b=p>=3?1:0,I=O>=3?1:0,L=y>=3?1:0,n=v>=3?1:0,r=p>=2?1:0,P=O>=2?1:0,z=y>=2?1:0,o=v>=2?1:0,K=p>=1?1:0,W=O>=1?1:0,g=y>=1?1:0,H=v>=1?1:0,k=T-b+w,C=E-I+w,A=x-L+w,e=G-n+w,S=T-r+2*w,Z=E-P+2*w,M=x-z+2*w,i=G-o+2*w,d=T-K+3*w,X=E-W+3*w,V=x-g+3*w,B=G-H+3*w,N=T-1+4*w,hh=E-1+4*w,Rh=x-1+4*w,lh=G-1+4*w,jh=255&Q,ah=255&Y,Dh=255&s,Uh=255&t;let Fh=.6-T*T-E*E-x*x-G*G;if(Fh<0)D=0;else{const h=a[jh+a[ah+a[Dh+a[Uh]]]]%32*4;Fh*=Fh,D=Fh*Fh*(u[h]*T+u[h+1]*E+u[h+2]*x+u[h+3]*G)}let wh=.6-k*k-C*C-A*A-e*e;if(wh<0)U=0;else{const h=a[jh+b+a[ah+I+a[Dh+L+a[Uh+n]]]]%32*4;wh*=wh,U=wh*wh*(u[h]*k+u[h+1]*C+u[h+2]*A+u[h+3]*e)}let mR=.6-S*S-Z*Z-M*M-i*i;if(mR<0)mh=0;else{const h=a[jh+r+a[ah+P+a[Dh+z+a[Uh+o]]]]%32*4;mR*=mR,mh=mR*mR*(u[h]*S+u[h+1]*Z+u[h+2]*M+u[h+3]*i)}let uh=.6-d*d-X*X-V*V-B*B;if(uh<0)c=0;else{const h=a[jh+K+a[ah+W+a[Dh+g+a[Uh+H]]]]%32*4;uh*=uh,c=uh*uh*(u[h]*d+u[h+1]*X+u[h+2]*V+u[h+3]*B)}let ch=.6-N*N-hh*hh-Rh*Rh-lh*lh;if(ch<0)J=0;else{const h=a[jh+1+a[ah+1+a[Dh+1+a[Uh+1]]]]%32*4;ch*=ch,J=ch*ch*(u[h]*N+u[h+1]*hh+u[h+2]*Rh+u[h+3]*lh)}return 27*(D+U+mh+c+J)}}}}]);