/*! For license information please see 4mz9cd.32.4566b7f7.chunk.js.LICENSE.txt */
(self.n4ygn1cq9vg=self.n4ygn1cq9vg||[]).push([[32],{14444:(e,d,v)=>{"use strict";var P=v(14451),p=v(14456),L=v(14461);v.g.__TYPEDARRAY_POOL||(v.g.__TYPEDARRAY_POOL={UINT8:p([32,0]),UINT16:p([32,0]),UINT32:p([32,0]),INT8:p([32,0]),INT16:p([32,0]),INT32:p([32,0]),FLOAT:p([32,0]),DOUBLE:p([32,0]),DATA:p([32,0]),UINT8C:p([32,0]),BUFFER:p([32,0])});var B="undefined"!==typeof Uint8ClampedArray,X=v.g.__TYPEDARRAY_POOL;X.UINT8C||(X.UINT8C=p([32,0])),X.BUFFER||(X.BUFFER=p([32,0]));var z=X.DATA,W=X.BUFFER;function V(e){if(e){var d=e.length||e.byteLength,v=P.log2(d);z[v].push(e)}}function k(e){e=P.nextPow2(e);var d=P.log2(e),v=z[d];return v.length>0?v.pop():new ArrayBuffer(e)}function g(e){return new Uint8Array(k(e),0,e)}function F(e){return new Uint16Array(k(2*e),0,e)}function w(e){return new Uint32Array(k(4*e),0,e)}function G(e){return new Int8Array(k(e),0,e)}function U(e){return new Int16Array(k(2*e),0,e)}function D(e){return new Int32Array(k(4*e),0,e)}function C(e){return new Float32Array(k(4*e),0,e)}function q(e){return new Float64Array(k(8*e),0,e)}function h(e){return B?new Uint8ClampedArray(k(e),0,e):g(e)}function l(e){return new DataView(k(e),0,e)}d.free=function(e){if(L(e))W[P.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var d=e.length||e.byteLength,v=0|P.log2(d);z[v].push(e)}},d.freeUint8=d.freeUint16=d.freeUint32=d.freeInt8=d.freeInt16=d.freeInt32=d.freeFloat32=d.freeFloat=d.freeFloat64=d.freeDouble=d.freeUint8Clamped=d.freeDataView=function(e){V(e.buffer)},d.freeArrayBuffer=V,d.freeBuffer=function(e){W[P.log2(e.length)].push(e)},d.malloc=function(e,d){if(void 0===d||"arraybuffer"===d)return k(e);switch(d){case"uint8":return g(e);case"uint16":return F(e);case"uint32":return w(e);case"int8":return G(e);case"int16":return U(e);case"int32":return D(e);case"float":case"float32":return C(e);case"double":case"float64":return q(e);case"uint8_clamped":return h(e);case"buffer":throw"Buffer not supported";case"data":case"dataview":return l(e);default:return null}return null},d.mallocArrayBuffer=k,d.mallocUint8=g,d.mallocUint16=F,d.mallocUint32=w,d.mallocInt8=G,d.mallocInt16=U,d.mallocInt32=D,d.mallocFloat32=d.mallocFloat=C,d.mallocFloat64=d.mallocDouble=q,d.mallocUint8Clamped=h,d.mallocDataView=l,d.clearCache=function(){for(var e=0;e<32;++e)X.UINT8[e].length=0,X.UINT16[e].length=0,X.UINT32[e].length=0,X.INT8[e].length=0,X.INT16[e].length=0,X.INT32[e].length=0,X.FLOAT[e].length=0,X.DOUBLE[e].length=0,X.UINT8C[e].length=0,z[e].length=0,W[e].length=0}},14539:(e,d,v)=>{e.exports=p;var P=v(13235);function p(e,d){if(!(this instanceof p))return new p(e,d);var v=P.create();P.add(v,e,d),this.base=P.min(P.create(),e,v),this.yW=P.clone(d),this.max=P.max(P.create(),e,v),this.mag=P.length(this.yW)}var L=p.prototype;L.width=function(){return this.yW[0]},L.height=function(){return this.yW[1]},L.depth=function(){return this.yW[2]},L.x0=function(){return this.base[0]},L.y0=function(){return this.base[1]},L.z0=function(){return this.base[2]},L.x1=function(){return this.max[0]},L.y1=function(){return this.max[1]},L.z1=function(){return this.max[2]},L.translate=function(e){return P.add(this.max,this.max,e),P.add(this.base,this.base,e),this},L.setPosition=function(e){return P.add(this.max,e,this.yW),P.j(this.base,e),this},L.expand=function(e){var d=P.create(),v=P.create();return P.max(d,e.max,this.max),P.min(v,e.base,this.base),P.Zd(d,d,v),new p(v,d)},L.intersects=function(e){return!(e.base[0]>this.max[0])&&(!(e.base[1]>this.max[1])&&(!(e.base[2]>this.max[2])&&(!(e.max[0]<this.base[0])&&(!(e.max[1]<this.base[1])&&!(e.max[2]<this.base[2])))))},L.touches=function(e){var d=this.union(e);return null!==d&&(0==d.width()||0==d.height()||0==d.depth())},L.union=function(e){if(!this.intersects(e))return null;var d=Math.max(e.base[0],this.base[0]),v=Math.max(e.base[1],this.base[1]),P=Math.max(e.base[2],this.base[2]);return new p([d,v,P],[Math.min(e.max[0],this.max[0])-d,Math.min(e.max[1],this.max[1])-v,Math.min(e.max[2],this.max[2])-P])}},14451:(e,d)=>{"use strict";function v(e){var d=32;return(e&=-e)&&d--,65535&e&&(d-=16),16711935&e&&(d-=8),252645135&e&&(d-=4),858993459&e&&(d-=2),1431655765&e&&(d-=1),d}d.INT_BITS=32,d.INT_MAX=2147483647,d.INT_MIN=-1<<31,d.sign=function(e){return(e>0)-(e<0)},d.abs=function(e){var d=e>>31;return(e^d)-d},d.min=function(e,d){return d^(e^d)&-(e<d)},d.max=function(e,d){return e^(e^d)&-(e<d)},d.isPow2=function(e){return!(e&e-1)&&!!e},d.log2=function(e){var d,v;return d=(e>65535)<<4,d|=v=((e>>>=d)>255)<<3,d|=v=((e>>>=v)>15)<<2,(d|=v=((e>>>=v)>3)<<1)|(e>>>=v)>>1},d.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},d.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},d.countTrailingZeros=v,d.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},d.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},d.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var P=new Array(256);!function(e){for(var d=0;d<256;++d){var v=d,P=d,p=7;for(v>>>=1;v;v>>>=1)P<<=1,P|=1&v,--p;e[d]=P<<p&255}}(P),d.reverse=function(e){return P[255&e]<<24|P[e>>>8&255]<<16|P[e>>>16&255]<<8|P[e>>>24&255]},d.interleave2=function(e,d){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))<<1},d.deinterleave2=function(e,d){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>d&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},d.interleave3=function(e,d,v){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<1)|(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<2},d.deinterleave3=function(e,d){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>d&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},d.nextCombination=function(e){var d=e|e-1;return d+1|(~d&-~d)-1>>>v(e)+1}},14441:(e,d,v)=>{"use strict";e.exports=function(e,d,v){switch(arguments.length){case 1:return P=[],W(p=e,p,V,!0),P;case 2:return"function"===typeof d?W(e,e,d,!0):function(e,d){return P=[],W(e,d,V,!1),P}(e,d);case 3:return W(e,d,v,!1);default:throw new Error("box-intersect: Invalid arguments")}var p};var P,p=v(14444),L=v(14463),B=v(14475);function X(e,d){for(var v=0;v<e;++v)if(!(d[v]<=d[v+e]))return!0;return!1}function z(e,d,v,P){for(var p=0,L=0,B=0,z=e.length;B<z;++B){var W=e[B];if(!X(d,W)){for(var V=0;V<2*d;++V)v[p++]=W[V];P[L++]=B}}return L}function W(e,d,v,P){var X=e.length,W=d.length;if(!(X<=0||W<=0)){var V=e[0].length>>>1;if(!(V<=0)){var k,g=p.mallocDouble(2*V*X),F=p.mallocInt32(X);if((X=z(e,V,g,F))>0){if(1===V&&P)L.init(X),k=L.sweepComplete(V,v,0,X,g,F,0,X,g,F);else{var w=p.mallocDouble(2*V*W),G=p.mallocInt32(W);(W=z(d,V,w,G))>0&&(L.init(X+W),k=1===V?L.sweepBipartite(V,v,0,X,g,F,0,W,w,G):B(V,v,P,X,g,F,W,w,G),p.free(w),p.free(G))}p.free(g),p.free(F)}return k}}}function V(e,d){P.push([e,d])}},14479:(e,d)=>{"use strict";var v="d",P="ax",p="fp",L="es",B="rs",X="re",z="rb",W="bs",V="be",k="bb",g=[v,P,"vv",B,X,z,"ri",W,V,k,"bi"];function F(e){var d="bruteForce"+(e?"Full":"Partial"),P=[],B=g.slice();e||B.splice(3,0,p);var X=["function "+d+"("+B.join()+"){"];function z(d,p){var B=function(e,d,P){var p="bruteForce"+(e?"Red":"Blue")+(d?"Flip":"")+(P?"Full":""),B=["function ",p,"(",g.join(),"){","var ",L,"=2*",v,";"],X="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",z="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(P?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return e?B.push(X,"Q",":",z):B.push(z,"Q",":",X),P?B.push("if(y1<x0||x1<y0)continue;"):d?B.push("if(y0<=x0||x1<y0)continue;"):B.push("if(y0<x0||x1<y0)continue;"),B.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),d?B.push("yi,xi"):B.push("xi,yi"),B.push(");if(rv!==void 0)return rv;}}}"),{name:p,code:B.join("")}}(d,p,e);P.push(B.code),X.push("return "+B.name+"("+g.join()+");")}X.push("if(re-rs>be-bs){"),e?(z(!0,!1),X.push("}else{"),z(!1,!1)):(X.push("if(fp){"),z(!0,!0),X.push("}else{"),z(!0,!1),X.push("}}else{if(fp){"),z(!1,!0),X.push("}else{"),z(!1,!1),X.push("}")),X.push("}}return "+d);var W=P.join("")+X.join("");return new Function(W)()}d.partial=F(!1),d.full=F(!0)},14475:(e,d,v)=>{"use strict";e.exports=function(e,d,v,L,V,r,Z,f,T){!function(e,d){var v=8*p.log2(d+1)*(e+1)|0,L=p.nextPow2(h*v);n.length<L&&(P.free(n),n=P.mallocInt32(L));var B=p.nextPow2(l*v);A.length<B&&(P.free(A),A=P.mallocDouble(B))}(e,L+Z);var S,o=0,K=2*e;x(o++,0,0,L,0,Z,v?16:0,-1/0,1/0),v||x(o++,0,0,Z,0,L,1,-1/0,1/0);for(;o>0;){var Q=(o-=1)*h,N=n[Q],u=n[Q+1],O=n[Q+2],R=n[Q+3],Y=n[Q+4],H=n[Q+5],a=o*l,t=A[a],I=A[a+1],c=1&H,b=!!(16&H),M=V,s=r,y=f,j=T;if(c&&(M=f,s=T,y=V,j=r),!(2&H&&u>=(O=U(e,N,u,O,M,s,I)))&&!(4&H&&(u=D(e,N,u,O,M,s,t))>=O)){var J=O-u,E=Y-R;if(b){if(e*J*(J+E)<F){if(void 0!==(S=z.scanComplete(e,N,d,u,O,M,s,R,Y,y,j)))return S;continue}}else{if(e*Math.min(J,E)<k){if(void 0!==(S=B(e,N,d,c,u,O,M,s,R,Y,y,j)))return S;continue}if(e*J*E<g){if(void 0!==(S=z.scanBipartite(e,N,d,c,u,O,M,s,R,Y,y,j)))return S;continue}}var ee=w(e,N,u,O,M,s,t,I);if(u<ee)if(e*(ee-u)<k){if(void 0!==(S=X(e,N+1,d,u,ee,M,s,R,Y,y,j)))return S}else if(N===e-2){if(void 0!==(S=c?z.sweepBipartite(e,d,R,Y,y,j,u,ee,M,s):z.sweepBipartite(e,d,u,ee,M,s,R,Y,y,j)))return S}else x(o++,N+1,u,ee,R,Y,c,-1/0,1/0),x(o++,N+1,R,Y,u,ee,1^c,-1/0,1/0);if(ee<O){var de=W(e,N,R,Y,y,j),ve=y[K*de+N],Pe=G(e,N,de,Y,y,j,ve);if(Pe<Y&&x(o++,N,ee,O,Pe,Y,(4|c)+(b?16:0),ve,I),R<de&&x(o++,N,ee,O,R,de,(2|c)+(b?16:0),t,ve),de+1===Pe){if(void 0!==(S=b?me(e,N,d,ee,O,M,s,de,y,j[de]):i(e,N,d,c,ee,O,M,s,de,y,j[de])))return S}else if(de<Pe){var pe;if(b){if(ee<(pe=C(e,N,ee,O,M,s,ve))){var Le=G(e,N,ee,pe,M,s,ve);if(N===e-2){if(ee<Le&&void 0!==(S=z.sweepComplete(e,d,ee,Le,M,s,de,Pe,y,j)))return S;if(Le<pe&&void 0!==(S=z.sweepBipartite(e,d,Le,pe,M,s,de,Pe,y,j)))return S}else ee<Le&&x(o++,N+1,ee,Le,de,Pe,16,-1/0,1/0),Le<pe&&(x(o++,N+1,Le,pe,de,Pe,0,-1/0,1/0),x(o++,N+1,de,Pe,Le,pe,1,-1/0,1/0))}}else ee<(pe=c?q(e,N,ee,O,M,s,ve):C(e,N,ee,O,M,s,ve))&&(N===e-2?S=c?z.sweepBipartite(e,d,de,Pe,y,j,ee,pe,M,s):z.sweepBipartite(e,d,ee,pe,M,s,de,Pe,y,j):(x(o++,N+1,ee,pe,de,Pe,c,-1/0,1/0),x(o++,N+1,de,Pe,ee,pe,1^c,-1/0,1/0)))}}}}};var P=v(14444),p=v(14451),L=v(14479),B=L.partial,X=L.full,z=v(14463),W=v(14482),V=v(14491),k=128,g=1<<22,F=1<<22,w=V("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),G=V("lo===p0",["p0"]),U=V("lo<p0",["p0"]),D=V("hi<=p0",["p0"]),C=V("lo<=p0&&p0<=hi",["p0"]),q=V("lo<p0&&p0<=hi",["p0"]),h=6,l=2,n=P.mallocInt32(1024),A=P.mallocDouble(1024);function x(e,d,v,P,p,L,B,X,z){var W=h*e;n[W]=d,n[W+1]=v,n[W+2]=P,n[W+3]=p,n[W+4]=L,n[W+5]=B;var V=l*e;A[V]=X,A[V+1]=z}function i(e,d,v,P,p,L,B,X,z,W,V){var k=2*e,g=z*k,F=W[g+d];e:for(var w=p,G=p*k;w<L;++w,G+=k){var U=B[G+d],D=B[G+d+e];if(!(F<U||D<F)&&(!P||F!==U)){for(var C,q=X[w],h=d+1;h<e;++h){U=B[G+h],D=B[G+h+e];var l=W[g+h],n=W[g+h+e];if(D<l||n<U)continue e}if(void 0!==(C=P?v(V,q):v(q,V)))return C}}}function me(e,d,v,P,p,L,B,X,z,W){var V=2*e,k=X*V,g=z[k+d];e:for(var F=P,w=P*V;F<p;++F,w+=V){var G=B[F];if(G!==W){var U=L[w+d],D=L[w+d+e];if(!(g<U||D<g)){for(var C=d+1;C<e;++C){U=L[w+C],D=L[w+C+e];var q=z[k+C],h=z[k+C+e];if(D<q||h<U)continue e}var l=v(G,W);if(void 0!==l)return l}}}}},14482:(e,d,v)=>{"use strict";e.exports=function(e,d,v,B,X,z){if(B<=v+1)return v;var W=v,V=B,k=B+v>>>1,g=2*e,F=k,w=X[g*k+d];for(;W<V;){if(V-W<p){L(e,d,W,V,X,z),w=X[g*k+d];break}var G=V-W,U=Math.random()*G+W|0,D=X[g*U+d],C=Math.random()*G+W|0,q=X[g*C+d],h=Math.random()*G+W|0,l=X[g*h+d];D<=q?l>=q?(F=C,w=q):D>=l?(F=U,w=D):(F=h,w=l):q>=l?(F=C,w=q):l>=D?(F=U,w=D):(F=h,w=l);for(var n=g*(V-1),A=g*F,x=0;x<g;++x,++n,++A){var i=X[n];X[n]=X[A],X[A]=i}var me=z[V-1];z[V-1]=z[F],z[F]=me;for(n=g*(V-1),A=g*(F=P(e,d,W,V-1,X,z,w)),x=0;x<g;++x,++n,++A){i=X[n];X[n]=X[A],X[A]=i}me=z[V-1];if(z[V-1]=z[F],z[F]=me,k<F){for(V=F-1;W<V&&X[g*(V-1)+d]===w;)V-=1;V+=1}else{if(!(F<k))break;for(W=F+1;W<V&&X[g*W+d]===w;)W+=1}}return P(e,d,v,k,X,z,X[g*k+d])};var P=v(14491)("lo<p0",["p0"]),p=8;function L(e,d,v,P,p,L){for(var B=2*e,X=B*(v+1)+d,z=v+1;z<P;++z,X+=B)for(var W=p[X],V=z,k=B*(z-1);V>v&&p[k+d]>W;--V,k-=B){for(var g=k,F=k+B,w=0;w<B;++w,++g,++F){var G=p[g];p[g]=p[F],p[F]=G}var U=L[V];L[V]=L[V-1],L[V-1]=U}}},14491:e=>{"use strict";e.exports=function(e,v){var P="abcdef".split("").concat(v),p=[];e.indexOf("lo")>=0&&p.push("lo=e[k+n]");e.indexOf("hi")>=0&&p.push("hi=e[k+o]");return P.push(d.replace("_",p.join()).replace("$",e)),Function.apply(void 0,P)};var d="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14472:e=>{"use strict";e.exports=function(e,P){P<=4*d?v(0,P-1,e):W(0,P-1,e)};var d=32;function v(e,d,v){for(var P=2*(e+1),p=e+1;p<=d;++p){for(var L=v[P++],B=v[P++],X=p,z=P-2;X-- >e;){var W=v[z-2],V=v[z-1];if(W<L)break;if(W===L&&V<B)break;v[z]=W,v[z+1]=V,z-=2}v[z]=L,v[z+1]=B}}function P(e,d,v){d*=2;var P=v[e*=2],p=v[e+1];v[e]=v[d],v[e+1]=v[d+1],v[d]=P,v[d+1]=p}function p(e,d,v){d*=2,v[e*=2]=v[d],v[e+1]=v[d+1]}function L(e,d,v,P){d*=2,v*=2;var p=P[e*=2],L=P[e+1];P[e]=P[d],P[e+1]=P[d+1],P[d]=P[v],P[d+1]=P[v+1],P[v]=p,P[v+1]=L}function B(e,d,v,P,p){d*=2,p[e*=2]=p[d],p[d]=v,p[e+1]=p[d+1],p[d+1]=P}function X(e,d,v){d*=2;var P=v[e*=2],p=v[d];return!(P<p)&&(P!==p||v[e+1]>v[d+1])}function z(e,d,v,P){var p=P[e*=2];return p<d||p===d&&P[e+1]<v}function W(e,V,k){var g=(V-e+1)/6|0,F=e+g,w=V-g,G=e+V>>1,U=G-g,D=G+g,C=F,q=U,h=G,l=D,n=w,A=e+1,x=V-1,i=0;X(C,q,k)&&(i=C,C=q,q=i),X(l,n,k)&&(i=l,l=n,n=i),X(C,h,k)&&(i=C,C=h,h=i),X(q,h,k)&&(i=q,q=h,h=i),X(C,l,k)&&(i=C,C=l,l=i),X(h,l,k)&&(i=h,h=l,l=i),X(q,n,k)&&(i=q,q=n,n=i),X(q,h,k)&&(i=q,q=h,h=i),X(l,n,k)&&(i=l,l=n,n=i);for(var me=k[2*q],r=k[2*q+1],Z=k[2*l],f=k[2*l+1],T=2*C,S=2*h,o=2*n,K=2*F,Q=2*G,N=2*w,u=0;u<2;++u){var O=k[T+u],R=k[S+u],Y=k[o+u];k[K+u]=O,k[Q+u]=R,k[N+u]=Y}p(U,e,k),p(D,V,k);for(var H=A;H<=x;++H)if(z(H,me,r,k))H!==A&&P(H,A,k),++A;else if(!z(H,Z,f,k))for(;;){if(z(x,Z,f,k)){z(x,me,r,k)?(L(H,A,x,k),++A,--x):(P(H,x,k),--x);break}if(--x<H)break}B(e,A-1,me,r,k),B(V,x+1,Z,f,k),A-2-e<=d?v(e,A-2,k):W(e,A-2,k),V-(x+2)<=d?v(x+2,V,k):W(x+2,V,k),x-A<=d?v(A,x,k):W(A,x,k)}},14463:(e,d,v)=>{"use strict";e.exports={init:function(e){var d=p.nextPow2(e);z.length<d&&(P.free(z),z=P.mallocInt32(d));W.length<d&&(P.free(W),W=P.mallocInt32(d));V.length<d&&(P.free(V),V=P.mallocInt32(d));k.length<d&&(P.free(k),k=P.mallocInt32(d));g.length<d&&(P.free(g),g=P.mallocInt32(d));F.length<d&&(P.free(F),F=P.mallocInt32(d));var v=8*d;w.length<v&&(P.free(w),w=P.mallocDouble(v))},sweepBipartite:function(e,d,v,P,p,X,g,F,D,C){for(var q=0,h=2*e,l=e-1,n=h-1,A=v;A<P;++A){var x=X[A],i=h*A;w[q++]=p[i+l],w[q++]=-(x+1),w[q++]=p[i+n],w[q++]=x}for(A=g;A<F;++A){x=C[A]+B;var me=h*A;w[q++]=D[me+l],w[q++]=-x,w[q++]=D[me+n],w[q++]=x}var r=q>>>1;L(w,r);var Z=0,f=0;for(A=0;A<r;++A){var T=0|w[2*A+1];if(T>=B)G(V,k,f--,T=T-B|0);else if(T>=0)G(z,W,Z--,T);else if(T<=-B){T=-T-B|0;for(var S=0;S<Z;++S){if(void 0!==(o=d(z[S],T)))return o}U(V,k,f++,T)}else{T=-T-1|0;for(S=0;S<f;++S){var o;if(void 0!==(o=d(T,V[S])))return o}U(z,W,Z++,T)}}},sweepComplete:function(e,d,v,P,p,B,X,D,C,q){for(var h=0,l=2*e,n=e-1,A=l-1,x=v;x<P;++x){var i=B[x]+1<<1,me=l*x;w[h++]=p[me+n],w[h++]=-i,w[h++]=p[me+A],w[h++]=i}for(x=X;x<D;++x){i=q[x]+1<<1;var r=l*x;w[h++]=C[r+n],w[h++]=1|-i,w[h++]=C[r+A],w[h++]=1|i}var Z=h>>>1;L(w,Z);var f=0,T=0,S=0;for(x=0;x<Z;++x){var o=0|w[2*x+1],K=1&o;if(x<Z-1&&o>>1===w[2*x+3]>>1&&(K=2,x+=1),o<0){for(var Q=-(o>>1)-1,N=0;N<S;++N){if(void 0!==(u=d(g[N],Q)))return u}if(0!==K)for(N=0;N<f;++N){if(void 0!==(u=d(z[N],Q)))return u}if(1!==K)for(N=0;N<T;++N){var u;if(void 0!==(u=d(V[N],Q)))return u}0===K?U(z,W,f++,Q):1===K?U(V,k,T++,Q):2===K&&U(g,F,S++,Q)}else{Q=(o>>1)-1;0===K?G(z,W,f--,Q):1===K?G(V,k,T--,Q):2===K&&G(g,F,S--,Q)}}},scanBipartite:function(e,d,v,P,p,X,V,k,g,F,D,C){var q=0,h=2*e,l=d,n=d+e,A=1,x=1;P?x=B:A=B;for(var i=p;i<X;++i){var me=i+A,r=h*i;w[q++]=V[r+l],w[q++]=-me,w[q++]=V[r+n],w[q++]=me}for(i=g;i<F;++i){me=i+x;var Z=h*i;w[q++]=D[Z+l],w[q++]=-me}var f=q>>>1;L(w,f);var T=0;for(i=0;i<f;++i){var S=0|w[2*i+1];if(S<0){var o=!1;if((me=-S)>=B?(o=!P,me-=B):(o=!!P,me-=1),o)U(z,W,T++,me);else{var K=C[me],Q=h*me,N=D[Q+d+1],u=D[Q+d+1+e];e:for(var O=0;O<T;++O){var R=z[O],Y=h*R;if(!(u<V[Y+d+1]||V[Y+d+1+e]<N)){for(var H=d+2;H<e;++H)if(D[Q+H+e]<V[Y+H]||V[Y+H+e]<D[Q+H])continue e;var a,t=k[R];if(void 0!==(a=P?v(K,t):v(t,K)))return a}}}}else G(z,W,T--,S-A)}},scanComplete:function(e,d,v,P,p,X,W,V,k,g,F){for(var G=0,U=2*e,D=d,C=d+e,q=P;q<p;++q){var h=q+B,l=U*q;w[G++]=X[l+D],w[G++]=-h,w[G++]=X[l+C],w[G++]=h}for(q=V;q<k;++q){h=q+1;var n=U*q;w[G++]=g[n+D],w[G++]=-h}var A=G>>>1;L(w,A);var x=0;for(q=0;q<A;++q){var i=0|w[2*q+1];if(i<0){if((h=-i)>=B)z[x++]=h-B;else{var me=F[h-=1],r=U*h,Z=g[r+d+1],f=g[r+d+1+e];e:for(var T=0;T<x;++T){var S=z[T],o=W[S];if(o===me)break;var K=U*S;if(!(f<X[K+d+1]||X[K+d+1+e]<Z)){for(var Q=d+2;Q<e;++Q)if(g[r+Q+e]<X[K+Q]||X[K+Q+e]<g[r+Q])continue e;var N=v(o,me);if(void 0!==N)return N}}}}else{for(h=i-B,T=x-1;T>=0;--T)if(z[T]===h){for(Q=T+1;Q<x;++Q)z[Q-1]=z[Q];break}--x}}}};var P=v(14444),p=v(14451),L=v(14472),B=1<<28,X=1024,z=P.mallocInt32(X),W=P.mallocInt32(X),V=P.mallocInt32(X),k=P.mallocInt32(X),g=P.mallocInt32(X),F=P.mallocInt32(X),w=P.mallocDouble(8192);function G(e,d,v,P){var p=d[P],L=e[v-1];e[p]=L,d[L]=p}function U(e,d,v,P){e[v]=P,d[P]=v}},14456:e=>{"use strict";function d(e,v,P){var p=0|e[P];if(p<=0)return[];var L,B=new Array(p);if(P===e.length-1)for(L=0;L<p;++L)B[L]=v;else for(L=0;L<p;++L)B[L]=d(e,v,P+1);return B}e.exports=function(e,v){switch("undefined"===typeof v&&(v=0),typeof e){case"number":if(e>0)return function(e,d){var v,P;for(v=new Array(e),P=0;P<e;++P)v[P]=d;return v}(0|e,v);break;case"object":if("number"===typeof e.length)return d(e,v,0)}return[]}},14414:(e,d,v)=>{e.exports=function(){var e=this;this.components={},this.comps=this.components;var d=this.components,v=1,p={},L=[],B=[],X={timeout:!1,removals:[],multiComps:[]};function z(e,v){var P=d[v],L=p[v],B=L.hash[e];B&&(L.remove(e),P.Ld&&(P.multi?(B.forEach((d=>{d&&P.Ld(e,d)})),B.length=0):P.Ld(e,B)),X.removals.push(L),W())}function W(){X.timeout||(X.timeout=!0,setTimeout(V,1))}function V(){X.timeout=!1,k()}function k(){X.multiComps.length&&function(e){for(var d=0;d<e.length;d++){var{entID:v,data:P}=e[d],p=P.hash[v];if(p){for(var L=0;L<p.length;L++)p[L]||(p.splice(L,1),L--);0===p.length&&(P.remove(v),X.removals.push(P))}}e.length=0}(X.multiComps),X.removals.length&&function(e){for(var d=0;d<e.length;d++){e[d].flush()}e.length=0}(X.removals)}this.Vk=p,this._systems=L,this._renderSystems=B,this.EW=function(d){var P=v++;return Array.isArray(d)&&d.forEach((d=>e.Kz(P,d))),P},this.deleteEntity=function(d){return Object.keys(p).forEach((e=>{p[e].hash[d]&&z(d,e)})),e},this.wV=function(e){if(!e)throw new Error("Missing component definition");var v=e.name;if(!v)throw new Error("Component definition must have a name property.");if("string"!==typeof v)throw new Error("Component name must be a string.");if(""===v)throw new Error("Component name must be a non-empty string.");if(p[v])throw new Error(`Component ${v} already exists.`);var X={};return X.name=v,X.multi=!!e.multi,X.order=isNaN(e.order)?99:e.order,X.stateConstructor=e.stateConstructor||null,X.state=e.state||{},X.fX=e.fX||null,X.Ld=e.Ld||null,X.system=e.system||null,X.NX=e.NX||null,d[v]=X,p[v]=new P,p[v]._pendingMultiCleanup=!1,p[v]._multiCleanupIDs=X.multi?[]:null,X.system&&(L.push(v),L.sort(((e,v)=>d[e].order-d[v].order))),X.NX&&(B.push(v),B.sort(((e,v)=>d[e].order-d[v].order))),v},this.overwriteComponent=function(e,v){var P=d[e];if(!P)throw new Error(`Unknown component: ${e}`);if(!v)throw new Error("Missing component definition");if(P.name!==v.name)throw new Error("Overwriting component must use the same name property.");var X={};X.name=e,X.multi=!!v.multi,X.order=isNaN(v.order)?99:v.order,X.state=v.state||{},X.fX=v.fX||null,X.Ld=v.Ld||null,X.system=v.system||null,X.NX=v.NX||null,d[e]=X,p[e]._pendingMultiCleanup=!1,p[e]._multiCleanupIDs=X.multi?[]:null;var z=L.indexOf(e);X.system&&z<0&&L.push(e),!X.system&&z>=0&&L.splice(z,1),L.sort(((e,v)=>d[e].order-d[v].order));var W=B.indexOf(e);X.NX&&W<0&&B.push(e),!X.NX&&W>=0&&B.splice(W,1),B.sort(((e,v)=>d[e].order-d[v].order));var V=X.state;return this.KW(e).forEach((e=>{for(var d in V)d in e||(e[d]=V[d]);X.fX&&X.fX(e.KX,e)})),e},this.deleteComponent=function(v){var P=p[v];if(!P)throw new Error(`Unknown component: ${v}`);P.flush(),P.list.forEach((e=>{e&&z(e.KX||e[0].KX,v)}));var X=L.indexOf(v),W=B.indexOf(v);return X>-1&&L.splice(X,1),W>-1&&B.splice(W,1),p[v].dispose(),delete p[v],delete d[v],e},this.Kz=function(e,v,P){var L,B=d[v],X=p[v];if(!X)throw new Error(`Unknown component: ${v}.`);if(X.hash[e]&&!B.multi)throw new Error(`Entity ${e} already has component: ${v}.`);if(B.stateConstructor){if(!(L=new B.stateConstructor).hasOwnProperty("KX"))throw new Error(`Component ${B.name} stateConstructor type does not have property __id`)}else L=Object.assign({},{KX:e},B.state,P);if(L.KX=e,B.multi){var z=X.hash[e];z||(z=[],X.add(e,z)),z.push(L)}else X.add(e,L);return B.fX&&B.fX(e,L),this},this.cz=function(e,d){var v=p[d];if(!v)throw new Error(`Unknown component: ${d}.`);return!!v.hash[e]},this.Oz=function(d,v){if(!p[v])throw new Error(`Unknown component: ${v}.`);return z(d,v),e},this.getState=function(e,d){var v=p[d];if(!v)throw new Error(`Unknown component: ${d}.`);return v.hash[e]},this.KW=function(e){var d=p[e];if(!d)throw new Error(`Unknown component: ${e}.`);return k(),d.list},this.wF=function(e){if(!p[e])throw new Error(`Unknown component: ${e}.`);var d=p[e].hash;return e=>d[e]},this.DF=function(e){if(!p[e])throw new Error(`Unknown component: ${e}.`);var d=p[e].hash;return e=>!!d[e]},this.lX=function(v){k();for(var P=0;P<L.length;P++){var B=L[P],X=d[B],z=p[B];X.system(v,z.list),k()}return e},this.render=function(v){k();for(var P=0;P<B.length;P++){var L=B[P],X=d[L],z=p[L];X.NX(v,z.list),k()}return e},this.removeMultiComponent=function(v,P,L){var B=d[P],z=p[P];if(!z)throw new Error(`Unknown component: ${P}.`);if(!B.multi)throw new Error("removeMultiComponent called on non-multi component");return function(e,d,v,P){var p=v.hash[e];if(p){var L=p[P];L&&(p[P]=null,d.Ld&&d.Ld(e,L),X.multiComps.push({entID:e,data:v}),W())}}(v,B,z,L),e}};var P=v(14417)},14417:e=>{function d(e,d){var v=e._map[d];if(delete e.hash[d],delete e._map[d],v===e.list.length-1)e.list.pop();else{var P=e.list.pop();if(e.list[v]=P,null===P||null===P[0]){var p=e.list.length;for(var L in e._map)if(e._map[L]===p)return void(e._map[L]=v)}else{var B=P.KX||P[0].KX;e._map[B]=v}}}e.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(e,d){if("number"===typeof this._map[e]){var v=this._map[e];this.hash[e]=d,this.list[v]=d}else this._map[e]=this.list.length,this.hash[e]=d,this.list.push(d)}remove(e){var d=this._map[e];this.hash[e]=null,this.list[d]=null,this._pendingRemovals.push(e)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var e=0;e<this._pendingRemovals.length;e++){var v=this._pendingRemovals[e];null===this.hash[v]&&d(this,v)}this._pendingRemovals.length=0}}},14377:e=>{"use strict";var d,v="object"===typeof Reflect?Reflect:null,P=function(e,d,v){return Function.prototype.apply.call(e,d,v)};d=v&&"function"===typeof v.ownKeys?v.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var p=Number.isNaN||function(e){return e!==e};function L(){L.init.call(this)}e.exports=L,e.exports.once=function(e,d){return new Promise((function(v,P){function p(v){e.removeListener(d,L),P(v)}function L(){"function"===typeof e.removeListener&&e.removeListener("error",p),v([].slice.call(arguments))}G(e,d,L,{once:!0}),"error"!==d&&function(e,d,v){"function"===typeof e.on&&G(e,"error",d,v)}(e,p,{once:!0})}))},L.EventEmitter=L,L.prototype._events=void 0,L.prototype._eventsCount=0,L.prototype._maxListeners=void 0;var B=10;function X(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function z(e){return void 0===e._maxListeners?L.defaultMaxListeners:e._maxListeners}function W(e,d,v,P){var p,L,B,W;if(X(v),void 0===(L=e._events)?(L=e._events=Object.create(null),e._eventsCount=0):(void 0!==L.newListener&&(e.emit("newListener",d,v.listener?v.listener:v),L=e._events),B=L[d]),void 0===B)B=L[d]=v,++e._eventsCount;else if("function"===typeof B?B=L[d]=P?[v,B]:[B,v]:P?B.unshift(v):B.push(v),(p=z(e))>0&&B.length>p&&!B.warned){B.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+B.length+" "+String(d)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.Pd=e,V.type=d,V.count=B.length,W=V,console&&console.warn&&console.warn(W)}return e}function V(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function k(e,d,v){var P={fired:!1,wrapFn:void 0,target:e,type:d,listener:v},p=V.bind(P);return p.listener=v,P.wrapFn=p,p}function g(e,d,v){var P=e._events;if(void 0===P)return[];var p=P[d];return void 0===p?[]:"function"===typeof p?v?[p.listener||p]:[p]:v?function(e){for(var d=new Array(e.length),v=0;v<d.length;++v)d[v]=e[v].listener||e[v];return d}(p):w(p,p.length)}function F(e){var d=this._events;if(void 0!==d){var v=d[e];if("function"===typeof v)return 1;if(void 0!==v)return v.length}return 0}function w(e,d){for(var v=new Array(d),P=0;P<d;++P)v[P]=e[P];return v}function G(e,d,v,P){if("function"===typeof e.on)P.once?e.once(d,v):e.on(d,v);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(d,(function p(L){P.once&&e.removeEventListener(d,p),v(L)}))}}Object.defineProperty(L,"defaultMaxListeners",{enumerable:!0,get:function(){return B},set:function(e){if("number"!==typeof e||e<0||p(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");B=e}}),L.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},L.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||p(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},L.prototype.getMaxListeners=function(){return z(this)},L.prototype.emit=function(e){for(var d=[],v=1;v<arguments.length;v++)d.push(arguments[v]);var p="error"===e,L=this._events;if(void 0!==L)p=p&&void 0===L.error;else if(!p)return!1;if(p){var B;if(d.length>0&&(B=d[0]),B instanceof Error)throw B;var X=new Error("Unhandled error."+(B?" ("+B.message+")":""));throw X.context=B,X}var z=L[e];if(void 0===z)return!1;if("function"===typeof z)P(z,this,d);else{var W=z.length,V=w(z,W);for(v=0;v<W;++v)P(V[v],this,d)}return!0},L.prototype.addListener=function(e,d){return W(this,e,d,!1)},L.prototype.on=L.prototype.addListener,L.prototype.prependListener=function(e,d){return W(this,e,d,!0)},L.prototype.once=function(e,d){return X(d),this.on(e,k(this,e,d)),this},L.prototype.prependOnceListener=function(e,d){return X(d),this.prependListener(e,k(this,e,d)),this},L.prototype.removeListener=function(e,d){var v,P,p,L,B;if(X(d),void 0===(P=this._events))return this;if(void 0===(v=P[e]))return this;if(v===d||v.listener===d)0===--this._eventsCount?this._events=Object.create(null):(delete P[e],P.removeListener&&this.emit("removeListener",e,v.listener||d));else if("function"!==typeof v){for(p=-1,L=v.length-1;L>=0;L--)if(v[L]===d||v[L].listener===d){B=v[L].listener,p=L;break}if(p<0)return this;0===p?v.shift():function(e,d){for(;d+1<e.length;d++)e[d]=e[d+1];e.pop()}(v,p),1===v.length&&(P[e]=v[0]),void 0!==P.removeListener&&this.emit("removeListener",e,B||d)}return this},L.prototype.off=L.prototype.removeListener,L.prototype.pd=function(e){var d,v,P;if(void 0===(v=this._events))return this;if(void 0===v.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==v[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete v[e]),this;if(0===arguments.length){var p,L=Object.keys(v);for(P=0;P<L.length;++P)"removeListener"!==(p=L[P])&&this.pd(p);return this.pd("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(d=v[e]))this.removeListener(e,d);else if(void 0!==d)for(P=d.length-1;P>=0;P--)this.removeListener(e,d[P]);return this},L.prototype.listeners=function(e){return g(this,e,!0)},L.prototype.rawListeners=function(e){return g(this,e,!1)},L.listenerCount=function(e,d){return"function"===typeof e.listenerCount?e.listenerCount(d):F.call(e,d)},L.prototype.listenerCount=F,L.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]}},14657:e=>{"use strict";e.exports=function(e,d,v,P,p,L){var B=+d[0],X=+d[1],z=+d[2],W=+v[0],V=+v[1],k=+v[2],g=Math.sqrt(W*W+V*V+k*k);if(0===g)throw new Error("Can't raycast along a zero vector");return function(e,d,v,P,p,L,B,X,z,W){for(var V=0,k=Math.floor,g=0|k(d),F=0|k(v),w=0|k(P),G=p>0?1:-1,U=L>0?1:-1,D=B>0?1:-1,C=Math.abs(1/p),q=Math.abs(1/L),h=Math.abs(1/B),l=C<1/0?C*(G>0?g+1-d:d-g):1/0,n=q<1/0?q*(U>0?F+1-v:v-F):1/0,A=h<1/0?h*(D>0?w+1-P:P-w):1/0,x=-1;V<=X;){var i=e(g,F,w);if(i)return z&&(z[0]=d+V*p,z[1]=v+V*L,z[2]=P+V*B),W&&(W[0]=W[1]=W[2]=0,0===x&&(W[0]=-G),1===x&&(W[1]=-U),2===x&&(W[2]=-D)),i;l<n?l<A?(g+=G,V=l,l+=C,x=0):(w+=D,V=A,A+=h,x=2):n<A?(F+=U,V=n,n+=q,x=1):(w+=D,V=A,A+=h,x=2)}return z&&(z[0]=d+V*p,z[1]=v+V*L,z[2]=P+V*B),W&&(W[0]=W[1]=W[2]=0),0}(e,B,X,z,W/=g,V/=g,k/=g,P="undefined"===typeof P?64:+P,p,L)}},14689:(e,d,v)=>{"use strict";v.d(d,{d:()=>L});var P=v(14377);function p(){this.eg=!1,this.stopPropagation=!1,this.dg=!1,this.disabled=!1}class L{constructor(e,d){this.version="0.7.0";var v=Object.assign({},new p,d||{});this.element=e||document,this.eg=!!v.eg,this.stopPropagation=!!v.stopPropagation,this.dg=!!v.dg,this.disabled=!!v.disabled,this.filterEvents=(e,d)=>!0,this.down=new P.EventEmitter,this.up=new P.EventEmitter,this.state={},this.rW={dx:0,dy:0,LF:0,mV:0,BF:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?X(this):document.addEventListener("DOMContentLoaded",(e=>{X(this)}),{once:!0})}bind(e){for(var d=arguments.length,v=new Array(d>1?d-1:0),P=1;P<d;P++)v[P-1]=arguments[P];v.forEach((d=>{var v=this._keyBindmap[d]||[];v.includes(e)||(v.push(e),this._keyBindmap[d]=v)})),this.state[e]=!!this.state[e],this.pressCount[e]=this.pressCount[e]||0,this.releaseCount[e]=this.releaseCount[e]||0}unbind(e){for(var d in this._keyBindmap){var v=this._keyBindmap[d],P=v.indexOf(e);P>-1&&v.splice(P,1)}}getBindings(){var e={};for(var d in this._keyBindmap){this._keyBindmap[d].forEach((v=>{e[v]=e[v]||[],e[v].push(d)}))}return e}lX(){B(this.rW),B(this.pressCount),B(this.releaseCount)}}function B(e){for(var d in e)e[d]=0}function X(e){window.addEventListener("keydown",w.bind(null,e,!0),!1),window.addEventListener("keyup",w.bind(null,e,!1),!1);var d={passive:!0};e.element.addEventListener("touchstart",k.bind(void 0,e),{passive:!1}),e.element.addEventListener("touchend",F.bind(void 0,e),d),e.element.addEventListener("mousedown",G.bind(null,e,!0),d),window.document.addEventListener("mouseup",G.bind(null,e,!1),d),e.element.addEventListener("touchmove",U.bind(null,e),d),e.element.addEventListener("mousemove",U.bind(null,e),d),window.PointerEvent,e.element.addEventListener("wheel",D.bind(null,e),d),e.element.addEventListener("contextmenu",C.bind(null,e),!1),window.addEventListener("blur",q.bind(null,e),!1)}var z=0,W=0,V=null;function k(e,d){d.preventDefault(),g(d)}function g(e){let d=!1;for(let v=0;v<e.touches.length;++v)if(e.touches[v].identifier===V){d=!0;break}if(!d){const d=e.changedTouches[0];z=d.clientX,W=d.clientY,V=d.identifier}}function F(e,d){for(var v=d.changedTouches,P=0;P<v.length;++P)v[P].identifier===V&&(V=null)}function w(e,d,v){h(v.code,d,e,v)}function G(e,d,v){if("pointerId"in v)if(d){if(null!==e._touches.currID)return;e._touches.currID=v.pointerId}else{if(e._touches.currID!==v.pointerId)return;e._touches.currID=null}return h("Mouse"+("button"in v?v.button+1:1),d,e,v),!1}function U(e,d){var v=d.movementX||d.mozMovementX||0,P=d.movementY||d.mozMovementY||0;if(d.touches&&0===(v|P)){var p=function(e){g(e);for(let d=0;d<e.changedTouches.length;++d)if(e.changedTouches[d].identifier==V){const v=e.changedTouches[d],P=[v.clientX-z,v.clientY-W];return z=v.clientX,W=v.clientY,P}return console.error(`Did not find touch id ${V}`),[0,0]}(d);v=p[0],P=p[1]}e.rW.dx+=v,e.rW.dy+=P}function D(e,d){var v=1;switch(d.deltaMode){case 0:v=1;break;case 1:v=12;break;case 2:v=e.element.clientHeight||window.innerHeight}e.rW.LF+=(d.deltaX||0)*v,e.rW.mV+=(d.deltaY||0)*v,e.rW.BF+=(d.deltaZ||0)*v}function C(e,d){if(!e.dg)return d.preventDefault(),!1}function q(e){for(var d in e._keyStates)e._keyStates[d]&&(/^Mouse\d/.test(d)||h(d,!1,e,{code:d,note:"5lpl5ql2hwe",preventDefault:()=>{},stopPropagation:()=>{}}))}function h(e,d,v,P){var p=v._keyBindmap[e];p&&(l(v._keyStates[e],d)&&(v._keyStates[e]=d,p.forEach((e=>{(!v.filterEvents||v.filterEvents(P,e))&&function(e,d,v,P){var p=d?v.pressCount:v.releaseCount;p[e]=(p[e]||0)+1;var L=v._bindPressCount[e]||0;(L+=d?1:-1)<0&&(L=0);v._bindPressCount[e]=L;var B=v.state[e];if(l(B,L)){v.state[e]=L>0;var X=d?v.down:v.up;v.disabled||X.emit(e,P)}}(e,d,v,P)}))),"button"in P||(v.eg&&!P.defaultPrevented&&P.preventDefault(),v.stopPropagation&&P.stopPropagation()))}function l(e,d){return e?!d:d}},13298:e=>{e.exports=function(e,d,v){return e[0]=d[0]+v[0],e[1]=d[1]+v[1],e[2]=d[2]+v[2],e}},13259:(e,d,v)=>{e.exports=function(e,d){var v=P(e[0],e[1],e[2]),B=P(d[0],d[1],d[2]);p(v,v),p(B,B);var X=L(v,B);return X>1?0:Math.acos(X)};var P=v(13263),p=v(13270),L=v(13273)},13349:e=>{e.exports=function(e,d){return e[0]=Math.ceil(d[0]),e[1]=Math.ceil(d[1]),e[2]=Math.ceil(d[2]),e}},13250:e=>{e.exports=function(e){var d=new Float32Array(3);return d[0]=e[0],d[1]=e[1],d[2]=e[2],d}},13280:e=>{e.exports=function(e,d){return e[0]=d[0],e[1]=d[1],e[2]=d[2],e}},13243:e=>{e.exports=function(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e}},13433:e=>{e.exports=function(e,d,v){var P=d[0],p=d[1],L=d[2],B=v[0],X=v[1],z=v[2];return e[0]=p*z-L*X,e[1]=L*B-P*z,e[2]=P*X-p*B,e}},13380:(e,d,v)=>{e.exports=v(13376)},13376:e=>{e.exports=function(e,d){var v=d[0]-e[0],P=d[1]-e[1],p=d[2]-e[2];return Math.sqrt(v*v+P*P+p*p)}},13329:(e,d,v)=>{e.exports=v(13321)},13321:e=>{e.exports=function(e,d,v){return e[0]=d[0]/v[0],e[1]=d[1]/v[1],e[2]=d[2]/v[2],e}},13273:e=>{e.exports=function(e,d){return e[0]*d[0]+e[1]*d[1]+e[2]*d[2]}},13237:e=>{e.exports=1e-6},13290:(e,d,v)=>{e.exports=function(e,d){var v=e[0],p=e[1],L=e[2],B=d[0],X=d[1],z=d[2];return Math.abs(v-B)<=P*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(p-X)<=P*Math.max(1,Math.abs(p),Math.abs(X))&&Math.abs(L-z)<=P*Math.max(1,Math.abs(L),Math.abs(z))};var P=v(13237)},13292:e=>{e.exports=function(e,d){return e[0]===d[0]&&e[1]===d[1]&&e[2]===d[2]}},13344:e=>{e.exports=function(e,d){return e[0]=Math.floor(d[0]),e[1]=Math.floor(d[1]),e[2]=Math.floor(d[2]),e}},13492:(e,d,v)=>{e.exports=function(e,d,v,p,L,B){var X,z;d||(d=3);v||(v=0);z=p?Math.min(p*d+v,e.length):e.length;for(X=v;X<z;X+=d)P[0]=e[X],P[1]=e[X+1],P[2]=e[X+2],L(P,P,B),e[X]=P[0],e[X+1]=P[1],e[X+2]=P[2];return e};var P=v(13243)()},13263:e=>{e.exports=function(e,d,v){var P=new Float32Array(3);return P[0]=e,P[1]=d,P[2]=v,P}},13235:(e,d,v)=>{e.exports={EPSILON:v(13237),create:v(13243),clone:v(13250),angle:v(13259),gX:v(13263),j:v(13280),set:v(13282),equals:v(13290),exactEquals:v(13292),add:v(13298),Zd:v(13301),sub:v(13303),multiply:v(13308),mul:v(13317),divide:v(13321),div:v(13329),min:v(13334),max:v(13341),floor:v(13344),ceil:v(13349),round:v(13358),scale:v(13363),FX:v(13371),distance:v(13376),k:v(13380),squaredDistance:v(13387),sqrDist:v(13389),length:v(13397),len:v(13406),squaredLength:v(13409),wX:v(13416),negate:v(13420),inverse:v(13427),normalize:v(13270),dot:v(13273),cross:v(13433),WX:v(13440),random:v(13449),transformMat4:v(13457),transformMat3:v(13462),transformQuat:v(13467),GX:v(13474),UX:v(13478),DX:v(13484),forEach:v(13492)}},13427:e=>{e.exports=function(e,d){return e[0]=1/d[0],e[1]=1/d[1],e[2]=1/d[2],e}},13406:(e,d,v)=>{e.exports=v(13397)},13397:e=>{e.exports=function(e){var d=e[0],v=e[1],P=e[2];return Math.sqrt(d*d+v*v+P*P)}},13440:e=>{e.exports=function(e,d,v,P){var p=d[0],L=d[1],B=d[2];return e[0]=p+P*(v[0]-p),e[1]=L+P*(v[1]-L),e[2]=B+P*(v[2]-B),e}},13341:e=>{e.exports=function(e,d,v){return e[0]=Math.max(d[0],v[0]),e[1]=Math.max(d[1],v[1]),e[2]=Math.max(d[2],v[2]),e}},13334:e=>{e.exports=function(e,d,v){return e[0]=Math.min(d[0],v[0]),e[1]=Math.min(d[1],v[1]),e[2]=Math.min(d[2],v[2]),e}},13317:(e,d,v)=>{e.exports=v(13308)},13308:e=>{e.exports=function(e,d,v){return e[0]=d[0]*v[0],e[1]=d[1]*v[1],e[2]=d[2]*v[2],e}},13420:e=>{e.exports=function(e,d){return e[0]=-d[0],e[1]=-d[1],e[2]=-d[2],e}},13270:e=>{e.exports=function(e,d){var v=d[0],P=d[1],p=d[2],L=v*v+P*P+p*p;L>0&&(L=1/Math.sqrt(L),e[0]=d[0]*L,e[1]=d[1]*L,e[2]=d[2]*L);return e}},13449:e=>{e.exports=function(e,d){d=d||1;var v=2*Math.random()*Math.PI,P=2*Math.random()-1,p=Math.sqrt(1-P*P)*d;return e[0]=Math.cos(v)*p,e[1]=Math.sin(v)*p,e[2]=P*d,e}},13474:e=>{e.exports=function(e,d,v,P){var p=v[1],L=v[2],B=d[1]-p,X=d[2]-L,z=Math.sin(P),W=Math.cos(P);return e[0]=d[0],e[1]=p+B*W-X*z,e[2]=L+B*z+X*W,e}},13478:e=>{e.exports=function(e,d,v,P){var p=v[0],L=v[2],B=d[0]-p,X=d[2]-L,z=Math.sin(P),W=Math.cos(P);return e[0]=p+X*z+B*W,e[1]=d[1],e[2]=L+X*W-B*z,e}},13484:e=>{e.exports=function(e,d,v,P){var p=v[0],L=v[1],B=d[0]-p,X=d[1]-L,z=Math.sin(P),W=Math.cos(P);return e[0]=p+B*W-X*z,e[1]=L+B*z+X*W,e[2]=d[2],e}},13358:e=>{e.exports=function(e,d){return e[0]=Math.round(d[0]),e[1]=Math.round(d[1]),e[2]=Math.round(d[2]),e}},13363:e=>{e.exports=function(e,d,v){return e[0]=d[0]*v,e[1]=d[1]*v,e[2]=d[2]*v,e}},13371:e=>{e.exports=function(e,d,v,P){return e[0]=d[0]+v[0]*P,e[1]=d[1]+v[1]*P,e[2]=d[2]+v[2]*P,e}},13282:e=>{e.exports=function(e,d,v,P){return e[0]=d,e[1]=v,e[2]=P,e}},13389:(e,d,v)=>{e.exports=v(13387)},13416:(e,d,v)=>{e.exports=v(13409)},13387:e=>{e.exports=function(e,d){var v=d[0]-e[0],P=d[1]-e[1],p=d[2]-e[2];return v*v+P*P+p*p}},13409:e=>{e.exports=function(e){var d=e[0],v=e[1],P=e[2];return d*d+v*v+P*P}},13303:(e,d,v)=>{e.exports=v(13301)},13301:e=>{e.exports=function(e,d,v){return e[0]=d[0]-v[0],e[1]=d[1]-v[1],e[2]=d[2]-v[2],e}},13462:e=>{e.exports=function(e,d,v){var P=d[0],p=d[1],L=d[2];return e[0]=P*v[0]+p*v[3]+L*v[6],e[1]=P*v[1]+p*v[4]+L*v[7],e[2]=P*v[2]+p*v[5]+L*v[8],e}},13457:e=>{e.exports=function(e,d,v){var P=d[0],p=d[1],L=d[2],B=v[3]*P+v[7]*p+v[11]*L+v[15];return B=B||1,e[0]=(v[0]*P+v[4]*p+v[8]*L+v[12])/B,e[1]=(v[1]*P+v[5]*p+v[9]*L+v[13])/B,e[2]=(v[2]*P+v[6]*p+v[10]*L+v[14])/B,e}},13467:e=>{e.exports=function(e,d,v){var P=d[0],p=d[1],L=d[2],B=v[0],X=v[1],z=v[2],W=v[3],V=W*P+X*L-z*p,k=W*p+z*P-B*L,g=W*L+B*p-X*P,F=-B*P-X*p-z*L;return e[0]=V*W+F*-B+k*-z-g*-X,e[1]=k*W+F*-X+g*-B-V*-z,e[2]=g*W+F*-z+V*-X-k*-B,e}},14392:e=>{"use strict";e.exports=function(e){for(var d=new Array(e),v=0;v<e;++v)d[v]=v;return d}},14461:e=>{e.exports=function(e){return null!=e&&null!=e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},14665:(e,d,v)=>{"use strict";v.d(d,{b:()=>P});class P{constructor(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.QV=!1,this.NV=!1,this.oV=30,this.KV=0,this.IV=!1,this.fullscreen=!1,this.OV=function(e){},this.RV=function(){},this.aV=function(){},this.Bd=function(){},this.YV=function(e){},this.onFullscreenChanged=function(e){},W((()=>{!function(e,d){e._nowObject=performance||Date,e._lastTick=0,e._renderAccum=0,e._rt=0,e._frameCB=X.bind(null,e),requestAnimationFrame(e._frameCB),d>0&&(e._intervalCB=B.bind(null,e),e._interval=setInterval(e._intervalCB,Math.max(d,1e3/e.oV/2)))}(this,d),function(e,d){if(!d)return;var v=!1,P=!1;document.addEventListener("pointerlockchange",(P=>{v=document.pointerLockElement===d,e.YV(v)})),document.addEventListener("fullscreenchange",(v=>{P=document.fullscreenElement===d,e.onFullscreenChanged(P)})),Object.defineProperty(e,"IV",{get:()=>v,set:e=>{e&&!v?z(d):v&&!e&&function(e){e.exitPointerLock&&e.exitPointerLock()}(document)}}),Object.defineProperty(e,"fullscreen",{get:()=>P,set:e=>{e&&!P?d.requestFullscreen():P&&!e&&document.exitFullscreen()}}),d.addEventListener("click",(p=>{e.QV&&!v&&z(d),e.NV&&!P&&d.requestFullscreen()}));var p=()=>e.Bd();if(window.ResizeObserver){new ResizeObserver(p).observe(d)}else window.addEventListener("resize",p)}(this,e),this.aV()}))}}var p=3,L=20;function B(e){for(var d=1e3/e.oV,v=e._nowObject.now()+L,P=0;e._nowObject.now()>=e._lastTick+d&&e._nowObject.now()<v&&++P<=p;)e.OV(d),e._lastTick+=d;var B=5*(d+5),X=e._nowObject.now();if(X-e._lastTick>B)for(;X>=e._lastTick+d;)e._lastTick+=d}function X(e){requestAnimationFrame(e._frameCB),B(e);var d=e._nowObject.now(),v=d-e._rt;if(e._rt=d,e.KV>0){e._renderAccum+=v;var P=1e3/e.KV;if(e._renderAccum<P)return;e._renderAccum=Math.min(e._renderAccum-P,P)}var p=1e3/e.oV,L=(d-e._lastTick)/p;e.RV(v,L,p)}function z(e){e.requestPointerLock&&e.requestPointerLock()}var W=e=>{if("loading"===document.readyState){var d=()=>{document.removeEventListener("readystatechange",d),e()};document.addEventListener("readystatechange",d)}else setTimeout(e,1)}},14390:(e,d,v)=>{var P=v(14392),p=v(14401),L="undefined"!==typeof Float64Array;function B(e,d){return e[0]-d[0]}function X(){var e,d=this.stride,v=new Array(d.length);for(e=0;e<v.length;++e)v[e]=[Math.abs(d[e]),e];v.sort(B);var P=new Array(v.length);for(e=0;e<P.length;++e)P[e]=v[e][1];return P}function z(e,d){var v=["View",d,"d",e].join("");d<0&&(v="View_Nil"+e);var p="generic"===e;if(-1===d){var L="function "+v+"(a){this.data=a;};var proto="+v+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+v+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+v+"(a){return new "+v+"(a);}";return new Function(L)()}if(0===d){L="function "+v+"(a,d) {this.data = a;this.offset = d};var proto="+v+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+v+"_copy() {return new "+v+"(this.data,this.offset)};proto.pick=function "+v+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+v+"_get(){return "+(p?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+v+"_set(v){return "+(p?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+v+"(a,b,c,d){return new "+v+"(a,d)}";return new Function("TrivialArray",L)(W[e][0])}L=["'use strict'"];var B=P(d),z=B.map((function(e){return"i"+e})),V="this.offset+"+B.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),k=B.map((function(e){return"b"+e})).join(","),g=B.map((function(e){return"c"+e})).join(",");L.push("function "+v+"(a,"+k+","+g+",d){this.data=a","this.shape=["+k+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+v+".prototype","proto.dtype='"+e+"'","proto.dimension="+d),L.push("Object.defineProperty(proto,'size',{get:function "+v+"_size(){return "+B.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===d?L.push("proto.order=[0]"):(L.push("Object.defineProperty(proto,'order',{get:"),d<4?(L.push("function "+v+"_order(){"),2===d?L.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===d&&L.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):L.push("ORDER})")),L.push("proto.set=function "+v+"_set("+z.join(",")+",v){"),p?L.push("return this.data.set("+V+",v)}"):L.push("return this.data["+V+"]=v}"),L.push("proto.get=function "+v+"_get("+z.join(",")+"){"),p?L.push("return this.data.get("+V+")}"):L.push("return this.data["+V+"]}"),L.push("proto.index=function "+v+"_index(",z.join(),"){return "+V+"}"),L.push("proto.hi=function "+v+"_hi("+z.join(",")+"){return new "+v+"(this.data,"+B.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+B.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var F=B.map((function(e){return"a"+e+"=this.shape["+e+"]"})),w=B.map((function(e){return"c"+e+"=this.stride["+e+"]"}));L.push("proto.lo=function "+v+"_lo("+z.join(",")+"){var b=this.offset,d=0,"+F.join(",")+","+w.join(","));for(var G=0;G<d;++G)L.push("if(typeof i"+G+"==='number'&&i"+G+">=0){d=i"+G+"|0;b+=c"+G+"*d;a"+G+"-=d}");L.push("return new "+v+"(this.data,"+B.map((function(e){return"a"+e})).join(",")+","+B.map((function(e){return"c"+e})).join(",")+",b)}"),L.push("proto.step=function "+v+"_step("+z.join(",")+"){var "+B.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+B.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(G=0;G<d;++G)L.push("if(typeof i"+G+"==='number'){d=i"+G+"|0;if(d<0){c+=b"+G+"*(a"+G+"-1);a"+G+"=ceil(-a"+G+"/d)}else{a"+G+"=ceil(a"+G+"/d)}b"+G+"*=d}");L.push("return new "+v+"(this.data,"+B.map((function(e){return"a"+e})).join(",")+","+B.map((function(e){return"b"+e})).join(",")+",c)}");var U=new Array(d),D=new Array(d);for(G=0;G<d;++G)U[G]="a[i"+G+"]",D[G]="b[i"+G+"]";L.push("proto.transpose=function "+v+"_transpose("+z+"){"+z.map((function(e,d){return e+"=("+e+"===undefined?"+d+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+v+"(this.data,"+U.join(",")+","+D.join(",")+",this.offset)}"),L.push("proto.pick=function "+v+"_pick("+z+"){var a=[],b=[],c=this.offset");for(G=0;G<d;++G)L.push("if(typeof i"+G+"==='number'&&i"+G+">=0){c=(c+this.stride["+G+"]*i"+G+")|0}else{a.push(this.shape["+G+"]);b.push(this.stride["+G+"])}");return L.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),L.push("return function construct_"+v+"(data,shape,stride,offset){return new "+v+"(data,"+B.map((function(e){return"shape["+e+"]"})).join(",")+","+B.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",L.join("\n"))(W[e],X)}var W={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,d,v,P){if(void 0===e)return(0,W.array[0])([]);"number"===typeof e&&(e=[e]),void 0===d&&(d=[e.length]);var B=d.length;if(void 0===v){v=new Array(B);for(var X=B-1,V=1;X>=0;--X)v[X]=V,V*=d[X]}if(void 0===P){P=0;for(X=0;X<B;++X)v[X]<0&&(P-=(d[X]-1)*v[X])}for(var k=function(e){if(p(e))return"buffer";if(L)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),g=W[k];g.length<=B+1;)g.push(z(k,g.length-1));return(0,g[B+1])(e,d,v,P)}},14401:e=>{function d(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(d(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&d(e.slice(0,0))}(e)||!!e._isBuffer)}},14542:e=>{"use strict";var d=[],v=[],P=[],p=[],L=[],B=[],X=[],z=[],W=[],V=[],k=[],g=[];e.exports=function(e,F,w,G,U,D){for(var C=X,q=W,h=V,l=g,n=0;n<3;n++)C[n]=+w[n],h[n]=+F.max[n],q[n]=+F.base[n];D||(D=1e-10);var A=function(e,X,W,V,g,F){var w=d,G=v,U=P,D=p,C=L,q=B,h=z,l=Math.floor,n=0,A=0,x=0,i=0,me=0;if(r(),0===x)return 0;for(i=T();A<=x;){if(Z(i)&&f())return n;i=T()}for(n+=x,me=0;me<3;me++)V[me]+=W[me],g[me]+=W[me];return n;function r(){if(A=0,0!==(x=Math.sqrt(W[0]*W[0]+W[1]*W[1]+W[2]*W[2])))for(var e=0;e<3;e++){var d=W[e]>=0;D[e]=d?1:-1;var v=d?g[e]:V[e];w[e]=d?V[e]:g[e],G[e]=S(v,D[e]),U[e]=o(w[e],D[e]),h[e]=W[e]/x,C[e]=Math.abs(1/h[e]);var P=d?G[e]+1-v:v-G[e];q[e]=C[e]<1/0?C[e]*P:1/0}}function Z(d){for(var v=D[0],P=0===d?G[0]:U[0],p=G[0]+v,L=D[1],B=1===d?G[1]:U[1],X=G[1]+L,z=D[2],W=2===d?G[2]:U[2],V=G[2]+z,k=P;k!=p;k+=v)for(var g=B;g!=X;g+=L)for(var F=W;F!=V;F+=z)if(e(k,g,F))return!0;return!1}function f(){n+=A;var e=D[i],d=A/x,v=k;for(me=0;me<3;me++){var P=W[me]*d;V[me]+=P,g[me]+=P,v[me]=W[me]-P}if(e>0?g[i]=Math.round(g[i]):V[i]=Math.round(V[i]),X(n,i,e,v))return!0;for(me=0;me<3;me++)W[me]=v[me];return r(),0===x}function T(){var e=q[0]<q[1]?q[0]<q[2]?0:2:q[1]<q[2]?1:2,d=q[e]-A;for(A=q[e],G[e]+=D[e],q[e]+=C[e],me=0;me<3;me++)w[me]+=d*h[me],U[me]=o(w[me],D[me]);return e}function S(e,d){return l(e-d*F)}function o(e,d){return l(e+d*F)}}(e,G,C,q,h,D);if(!U){for(n=0;n<3;n++)l[n]=w[n]>0?h[n]-F.max[n]:q[n]-F.base[n];F.translate(l)}return A}},14698:(e,d,v)=>{"use strict";v.d(d,{c:()=>k});var P=v(14539),p=v(13235);class L{constructor(e,d,v,L,B,X,z){this.oW=new P(e.base,e.yW),this.eL=d,this.friction=v,this.restitution=L,this.vX=B,this.iF=X,this.PX=!!z,this.sW=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Fw=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.XW=p.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=p.create(),this._impulses=p.create(),this._sleepFrameCount=10}loadFromCopy(e){p.j(this.oW.base,e.oW.base),p.j(this.oW.yW,e.oW.yW),p.j(this.oW.max,e.oW.max),this.oW.mag=e.oW.mag,this.eL=e.eL,this.friction=e.friction,this.restitution=e.restitution,this.vX=e.vX,this.iF=e.iF,this.PX=e.PX,this.sW=e.sW,this.fluidDrag=e.fluidDrag,this.Fw=e.Fw,this.preventFallOffEdge=e.preventFallOffEdge,this.rolledBackLastTick=e.rolledBackLastTick,p.j(this.XW,e.XW),p.j(this.resting,e.resting),this.inFluid=e.inFluid,this._ratioInFluid=e._ratioInFluid,p.j(this._forces,e._forces),p.j(this._impulses,e._impulses),this._sleepFrameCount=e._sleepFrameCount}setPosition(e){B(e),p.Zd(e,e,this.oW.base),this.oW.translate(e),this.VW()}Xd(){return p.clone(this.oW.base)}applyForce(e){B(e),p.add(this._forces,this._forces,e),this.VW()}applyImpulse(e){B(e),p.add(this._impulses,this._impulses,e),this.VW()}VW(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var B=e=>{};var X=v(14539),z=v(13235),W=v(14542);function V(){this.sW=.1,this.fluidDrag=.4,this.zX=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function k(e,d,v){e=Object.assign(new V,e),this.gravity=e.gravity||[0,-10,0],this.sW=e.sW||.1,this.zX=e.zX||2,this.fluidDrag=e.fluidDrag||.4,this.minBounceImpulse=e.minBounceImpulse,this.bodies=[],this.bg=e.bg,this.testSolid=d,this.testFluid=v}k.prototype.oF=function(e,d,v,P,p,B){e=e||new X([0,0,0],[1,1,1]),"undefined"==typeof d&&(d=1),"undefined"==typeof v&&(v=1),"undefined"==typeof P&&(P=0),"undefined"==typeof p&&(p=1);var z=new L(e,d,v,P,p,B);return this.bodies.push(z),z},k.prototype.KF=function(e){var d=this.bodies.indexOf(e);d<0||(this.bodies.splice(d,1),e.oW=e.iF=null)};var g=z.create(),F=z.create(),w=z.create(),G=z.create(),U=z.create(),D=z.create(),C=z.create(),q=new X([0,0,0],[1,1,1]),h=new L(q,1,1,0,1,(()=>{}),!1);function l(e,d,v){return d=v,d*=1-(1-e.ratioInFluid)**2}k.prototype.lX=function(e){e/=1e3;var d=O(0,z.squaredLength(this.gravity));this.bodies.forEach((v=>function(e,d,v,P){z.j(U,d.resting),e.bg&&h.loadFromCopy(d);if(d.eL<=0)return z.set(d.XW,0,0,0),z.set(d._forces,0,0,0),void z.set(d._impulses,0,0,0);var p=P||0===d.vX;if(function(e,d,v,P){if(d._sleepFrameCount>0)return!1;if(P)return!0;var p=!1,L=.5*v*v*d.vX;return z.scale(u,e.gravity,L),W(e.testSolid,d.oW,u,(function(){return p=!0,!0}),!0),p}(e,d,v,p))return;d._sleepFrameCount--,function(e,d){var v=d.oW,P=Math.floor(v.base[0]),p=Math.floor(v.base[2]),L=Math.floor(v.base[1]),B=Math.floor(v.max[1]);if(!e.testFluid(P,L,p))return d.inFluid=!1,void(d.ratioInFluid=0);var X=1,W=L+1;for(;W<=B&&e.testFluid(P,W,p);)X++,W++;var V=(L+X-v.base[1])/v.yW[1];V>1&&(V=1);var k=v.yW[0]*v.yW[1]*v.yW[2]*V,g=A;z.scale(g,e.gravity,-e.zX*k*d.vX),d.applyForce(g),d.inFluid=!0,d.ratioInFluid=V}(e,d),Y(d._forces),Y(d._impulses),Y(d.XW),Y(d.resting),z.scale(g,d._forces,1/d.eL),z.FX(g,g,e.gravity,d.vX),z.scale(F,d._impulses,1/d.eL),z.FX(F,F,g,v),z.add(d.XW,d.XW,F),d.friction&&(x(e,0,d,F,v),x(e,1,d,F,v),x(e,2,d,F,v));var L=d.fluidDrag>=0?d.fluidDrag:e.fluidDrag,B=d.sW>=0?d.sW:e.sW,X=B,V=B;d.inFluid&&(X=l(d,X,d.fluidDragHoriz>=0?d.fluidDragHoriz:L),V=l(d,V,d.fluidDragVert>=0?d.fluidDragVert:L));X=Math.max(1-X*v/d.eL,0),V=Math.max(1-V*v/d.eL,0),z.set(n,X,V,X),z.multiply(d.XW,d.XW,n),z.scale(w,d.XW,v),z.set(d._forces,0,0,0),z.set(d._impulses,0,0,0),d.PX&&R(r,d.oW);z.j(D,w),z.set(C,0,0,0),d.preventFallOffEdge&&function(e,d,v,P){if(!d.resting[1]||v[1]>0)return;var p=K;R(p,d.oW);for(var L=0;L<3;L+=2){z.set(o,0,0,0),o[L]=v[L];var B=!0;(B=(B=(B=(B=B&&!N(e,p.base[0]+o[0]+1e-5,p.base[1],p.base[2]+o[2]+1e-5))&&!N(e,p.max[0]+o[0]-1e-5,p.base[1],p.base[2]+o[2]+1e-5))&&!N(e,p.base[0]+o[0]+1e-5,p.base[1],p.max[2]+o[2]-1e-5))&&!N(e,p.max[0]+o[0]-1e-5,p.base[1],p.max[2]+o[2]-1e-5))?(P[L]=v[L]>0?1:-1,v[L]=0):0===L&&(z.set(Q,v[0],0,0),me(e,p,Q,P,d.slideOnCollision))}}(e,d,w,C);me(e,d.oW,w,d.resting,d.slideOnCollision),d.PX&&function(e,d,v,P){if(d.resting[1]>=0&&!d.inFluid)return;var p=0!==d.resting[0],L=0!==d.resting[2];if(!p&&!L)return;var B=Math.abs(P[0]/P[2]),X=4;if(!p&&B>X)return;if(!L&&B<1/X)return;z.add(f,v.base,P);var V=e.testSolid;W(V,v,P,(function(e,d,v,P){if(1!==d)return!0;P[d]=0}));var k=v.base[1],g=d.inFluid?1.951:1.001,F=Math.floor(k+g)-k;z.set(T,0,F,0);var w=!1;if(W(V,v,T,(function(e,d,v,P){return w=!0,!0})),w)return;z.Zd(S,f,v.base),S[1]=0,me(e,v,S,Z,!0);var G=O(v.base[0],f[0]),U=O(v.base[2],f[2]);if(p&&!G&&(!U||!L))return;if(L&&(!G||!p)&&!U)return;var D=!0;if(D=D&&!N(e,v.base[0]+1e-5,v.base[1],v.base[2]+1e-5),D=D&&!N(e,v.max[0]-1e-5,v.base[1],v.base[2]+1e-5),D=D&&!N(e,v.base[0]+1e-5,v.base[1],v.max[2]-1e-5),D=D&&!N(e,v.max[0]-1e-5,v.base[1],v.max[2]-1e-5),D)return;R(d.oW,v),d.resting[0]=Z[0],d.resting[2]=Z[2],d.Fw&&d.Fw()}(e,d,r,D);for(var k=0;k<3;++k)d.resting[k]=d.resting[k]||C[k],G[k]=0,d.resting[k]&&(U[k]||(G[k]=-d.XW[k]),d.XW[k]=0);var q=z.length(G);q>.001&&(z.scale(G,G,d.eL),d.iF&&d.iF(G),d.restitution>0&&q>e.minBounceImpulse&&(z.scale(G,G,d.restitution),d.applyImpulse(G)));var i=z.squaredLength(d.XW);i>1e-5&&d.VW();e.bg&&e.bg(d)?(d.loadFromCopy(h),d.rolledBackLastTick=!0):d.rolledBackLastTick=!1}(this,v,e,d)))};var n=z.create([0,0,0]);var A=z.create();function x(e,d,v,P,p){var L=v.resting[d],B=P[d];if(!v.alwaysApplyHorizFriction||1!==d){if(0===L)return;if(L*B<=0)return}z.j(i,v.XW),i[d]=0;var X=z.length(i);if(!O(X,0)){var W=Math.abs(v.friction*e.gravity[d]*p),V=X>W?(X-W)/X:0;v.XW[(d+1)%3]*=V,v.XW[(d+2)%3]*=V}}var i=z.create();function me(e,d,v,P,p){return z.set(P,0,0,0),W(e.testSolid,d,v,(function(e,d,v,L){P[d]=v,L[d]=0,p||(L[0]=0,L[1]=0,L[2]=0)}))}var r=new X([],[]),Z=z.create(),f=z.create(),T=z.create(),S=z.create();var o=z.create(),K=new X([],[]),Q=z.create();function N(e,d,v,P){return e.testSolid(Math.floor(d),Math.floor(v-1),Math.floor(P))}var u=z.create();function O(e,d){return Math.abs(e-d)<1e-5}function R(e,d){for(var v=0;v<3;v++)e.base[v]=d.base[v],e.max[v]=d.max[v],e.yW[v]=d.yW[v]}var Y=function(e){}},13100:function(e,d){!function(e){"use strict";var d=function(e,v){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,d){e.__proto__=d}||function(e,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(e[v]=d[v])},d(e,v)};function v(e,v){if("function"!==typeof v&&null!==v)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");function P(){this.constructor=e}d(e,v),e.prototype=null===v?Object.create(v):(P.prototype=v.prototype,new P)}function P(e,d,v,P){var p,L=arguments.length,B=L<3?d:null===P?P=Object.getOwnPropertyDescriptor(d,v):P;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)B=Reflect.decorate(e,d,v,P);else for(var X=e.length-1;X>=0;X--)(p=e[X])&&(B=(L<3?p(B):L>3?p(d,v,B):p(d,v))||B);return L>3&&B&&Object.defineProperty(d,v,B),B}function p(e,d,v){if(v||2===arguments.length)for(var P,p=0,L=d.length;p<L;p++)!P&&p in d||(P||(P=Array.prototype.slice.call(d,0,p)),P[p]=d[p]);return e.concat(P||Array.prototype.slice.call(d))}var L,B=255,X=213;e.OPERATION=void 0,(L=e.OPERATION||(e.OPERATION={}))[L.ADD=128]="ADD",L[L.REPLACE=0]="REPLACE",L[L.DELETE=64]="DELETE",L[L.DELETE_AND_ADD=192]="DELETE_AND_ADD",L[L.TOUCH=1]="TOUCH",L[L.CLEAR=10]="CLEAR";var z=function(){function d(e,d,v){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(d,v)}return d.prototype.setParent=function(e,d,v){var P=this;if(this.indexes||(this.indexes=this.ref instanceof Se?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=v,d)if(this.root=d,this.ref instanceof Se){var p=this.ref._definition;for(var L in p.schema){var B=this.ref[L];if(B&&B.$changes){var X=p.indexes[L];B.$changes.setParent(this.ref,d,X)}}}else"object"===typeof this.ref&&this.ref.forEach((function(e,d){if(e instanceof Se){var v=e.$changes,p=P.ref.$changes.indexes[d];v.setParent(P.ref,P.root,p)}}))},d.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},d.prototype.change=function(d,v){void 0===v&&(v=e.OPERATION.ADD);var P="number"===typeof d?d:this.indexes[d];this.assertValidIndex(P,d);var p=this.changes.get(P);p&&p.op!==e.OPERATION.DELETE&&p.op!==e.OPERATION.TOUCH||this.changes.set(P,{op:p&&p.op===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:v,index:P}),this.allChanges.add(P),this.changed=!0,this.touchParents()},d.prototype.touch=function(d){var v="number"===typeof d?d:this.indexes[d];this.assertValidIndex(v,d),this.changes.has(v)||this.changes.set(v,{op:e.OPERATION.TOUCH,index:v}),this.allChanges.add(v),this.touchParents()},d.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},d.prototype.getType=function(e){if(this.ref._definition)return(d=this.ref._definition).schema[d.fieldsByIndex[e]];var d,v=(d=this.parent._definition).schema[d.fieldsByIndex[this.parentIndex]];return Object.values(v)[0]},d.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},d.prototype.getValue=function(e){return this.ref.getByIndex(e)},d.prototype.delete=function(d){var v="number"===typeof d?d:this.indexes[d];if(void 0!==v){var P=this.getValue(v);this.changes.set(v,{op:e.OPERATION.DELETE,index:v}),this.allChanges.delete(v),delete this.caches[v],P&&P.$changes&&(P.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(d," (").concat(v,")"))},d.prototype.discard=function(d,v){var P=this;void 0===d&&(d=!1),void 0===v&&(v=!1),this.ref instanceof Se||this.changes.forEach((function(d){if(d.op===e.OPERATION.DELETE){var v=P.ref.getIndex(d.index);delete P.indexes[v]}})),this.changes.clear(),this.changed=d,v&&this.allChanges.clear(),this.currentCustomOperation=0},d.prototype.discardAll=function(){var e=this;this.changes.forEach((function(d){var v=e.getValue(d.index);v&&v.$changes&&v.$changes.discardAll()})),this.discard()},d.prototype.cache=function(e,d){this.caches[e]=d},d.prototype.clone=function(){return new d(this.ref,this.parent,this.root)},d.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},d.prototype.assertValidIndex=function(e,d){if(void 0===e)throw new Error('ChangeTree: missing index for field "'.concat(d,'"'))},d}();function W(e,d,v,P){return e[d]||(e[d]=[]),e[d].push(v),null===P||void 0===P||P.forEach((function(e,d){return v(e,d)})),function(){return k(e[d],e[d].indexOf(v))}}function V(d){var v=this,P="string"!==typeof this.$changes.getType();this.$items.forEach((function(p,L){d.push({refId:v.$changes.refId,op:e.OPERATION.DELETE,field:L,value:void 0,previousValue:p}),P&&v.$changes.root.removeRef(p.$changes.refId)}))}function k(e,d){if(-1===d||d>=e.length)return!1;for(var v=e.length-1,P=d;P<v;P++)e[P]=e[P+1];return e.length=v,!0}var g=function(e,d){var v=e.toString(),P=d.toString();return v<P?-1:v>P?1:0};function F(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,d){return"symbol"===typeof d||isNaN(d)?e[d]:e.at(d)},set:function(e,d,v){if("symbol"===typeof d||isNaN(d))e[d]=v;else{var P=Array.from(e.$items.keys()),p=parseInt(P[d]||d);void 0===v||null===v?e.deleteAt(p):e.setAt(p,v)}return!0},deleteProperty:function(e,d){return"number"===typeof d?e.deleteAt(d):delete e[d],!0}})}var w=function(){function d(){for(var e=[],d=0;d<arguments.length;d++)e[d]=arguments[d];this.$changes=new z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return d.prototype.fX=function(d,v){return void 0===v&&(v=!0),W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,d,v?this.$items:void 0)},d.prototype.Ld=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,d)},d.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(d.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),d.prototype.push=function(){for(var e,d=this,v=[],P=0;P<arguments.length;P++)v[P]=arguments[P];return v.forEach((function(v){e=d.$refId++,d.setAt(e,v)})),e},d.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var d=this.$items.get(e);return this.$items.delete(e),d}},d.prototype.at=function(e){var d=Array.from(this.$items.keys())[e];return this.$items.get(d)},d.prototype.setAt=function(d,v){var P,p;if(void 0!==v&&null!==v){if(this.$items.get(d)!==v){void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,d);var L=null!==(p=null===(P=this.$changes.indexes[d])||void 0===P?void 0:P.op)&&void 0!==p?p:e.OPERATION.ADD;this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,v),this.$changes.change(d,L)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},d.prototype.deleteAt=function(e){var d=Array.from(this.$items.keys())[e];return void 0!==d&&this.$deleteAt(d)},d.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&V.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.concat=function(){for(var e,v=[],P=0;P<arguments.length;P++)v[P]=arguments[P];return new(d.bind.apply(d,p([void 0],(e=Array.from(this.$items.values())).concat.apply(e,v),!1)))},d.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},d.prototype.reverse=function(){var e=this,d=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(v,P){e.setAt(d[P],v)})),this},d.prototype.shift=function(){var e=Array.from(this.$items.keys()).shift();if(void 0!==e){var d=this.$items.get(e);return this.$deleteAt(e),d}},d.prototype.slice=function(e,v){var P=new d;return P.push.apply(P,Array.from(this.$items.values()).slice(e,v)),P},d.prototype.sort=function(e){var d=this;void 0===e&&(e=g);var v=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach((function(e,P){d.setAt(v[P],e)})),this},d.prototype.splice=function(e,d){void 0===d&&(d=this.length-e);for(var v=Array.from(this.$items.keys()),P=[],p=e;p<e+d;p++)P.push(this.$items.get(v[p])),this.$deleteAt(v[p]);return P},d.prototype.unshift=function(){for(var e=this,d=[],v=0;v<arguments.length;v++)d[v]=arguments[v];var P=this.length,p=d.length,L=Array.from(this.$items.values());return d.forEach((function(d,v){e.setAt(v,d)})),L.forEach((function(d,v){e.setAt(p+v,d)})),P+p},d.prototype.indexOf=function(e,d){return Array.from(this.$items.values()).indexOf(e,d)},d.prototype.lastIndexOf=function(e,d){return void 0===d&&(d=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,d)},d.prototype.every=function(e,d){return Array.from(this.$items.values()).every(e,d)},d.prototype.some=function(e,d){return Array.from(this.$items.values()).some(e,d)},d.prototype.forEach=function(e,d){Array.from(this.$items.values()).forEach(e,d)},d.prototype.map=function(e,d){return Array.from(this.$items.values()).map(e,d)},d.prototype.filter=function(e,d){return Array.from(this.$items.values()).filter(e,d)},d.prototype.reduce=function(e,d){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},d.prototype.reduceRight=function(e,d){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},d.prototype.find=function(e,d){return Array.from(this.$items.values()).find(e,d)},d.prototype.findIndex=function(e,d){return Array.from(this.$items.values()).findIndex(e,d)},d.prototype.fill=function(e,d,v){throw new Error("ArraySchema#fill() not implemented")},d.prototype.copyWithin=function(e,d,v){throw new Error("ArraySchema#copyWithin() not implemented")},d.prototype.toString=function(){return this.$items.toString()},d.prototype.toLocaleString=function(){return this.$items.toLocaleString()},d.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},d.prototype.includes=function(e,d){return Array.from(this.$items.values()).includes(e,d)},d.prototype.flatMap=function(e,d){throw new Error("ArraySchema#flatMap() is not supported.")},d.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},d.prototype.findLast=function(){var e=Array.from(this.$items.values());return e.findLast.apply(e,arguments)},d.prototype.findLastIndex=function(){var e=Array.from(this.$items.values());return e.findLastIndex.apply(e,arguments)},d.prototype.setIndex=function(e,d){this.$indexes.set(e,d)},d.prototype.getIndex=function(e){return this.$indexes.get(e)},d.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},d.prototype.deleteByIndex=function(e){var d=this.$indexes.get(e);this.$items.delete(d),this.$indexes.delete(e)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){return this.toArray().map((function(e){return"function"===typeof e.toJSON?e.toJSON():e}))},d.prototype.clone=function(e){return e?new(d.bind.apply(d,p([void 0],Array.from(this.$items.values()),!1))):new(d.bind.apply(d,p([void 0],this.map((function(e){return e.$changes?e.clone():e})),!1)))},d}();function G(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,d){return"symbol"!==typeof d&&"undefined"===typeof e[d]?e.get(d):e[d]},set:function(e,d,v){return"symbol"!==typeof d&&-1===d.indexOf("$")&&"fX"!==d&&"Ld"!==d&&"onChange"!==d?e.set(d,v):e[d]=v,!0},deleteProperty:function(e,d){return e.delete(d),!0}})}var U=function(){function d(e){var v=this;if(this.$changes=new z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map||e instanceof d)e.forEach((function(e,d){return v.set(d,e)}));else for(var P in e)this.set(P,e[P])}return d.prototype.fX=function(d,v){return void 0===v&&(v=!0),W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,d,v?this.$items:void 0)},d.prototype.Ld=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,d)},d.is=function(e){return void 0!==e.map},d.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(d.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.set=function(d,v){if(void 0===v||null===v)throw new Error("MapSchema#set('".concat(d,"', ").concat(v,"): trying to set ").concat(v," value on '").concat(d,"'."));d=d.toString();var P="undefined"!==typeof this.$changes.indexes[d],p=P?this.$changes.indexes[d]:this.$refId++,L=P?e.OPERATION.REPLACE:e.OPERATION.ADD,B=void 0!==v.$changes;if(B&&v.$changes.setParent(this,this.$changes.root,p),P){if(!B&&this.$items.get(d)===v)return;B&&this.$items.get(d)!==v&&(L=e.OPERATION.ADD)}else this.$changes.indexes[d]=p,this.$indexes.set(p,d);return this.$items.set(d,v),this.$changes.change(d,L),this},d.prototype.get=function(e){return this.$items.get(e)},d.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&V.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(e){return this.$items.has(e)},d.prototype.forEach=function(e){this.$items.forEach(e)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(e,d){this.$indexes.set(e,d)},d.prototype.getIndex=function(e){return this.$indexes.get(e)},d.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},d.prototype.deleteByIndex=function(e){var d=this.$indexes.get(e);this.$items.delete(d),this.$indexes.delete(e)},d.prototype.toJSON=function(){var e={};return this.forEach((function(d,v){e[v]="function"===typeof d.toJSON?d.toJSON():d})),e},d.prototype.clone=function(e){var v;return e?v=Object.assign(new d,this):(v=new d,this.forEach((function(e,d){e.$changes?v.set(d,e.clone()):v.set(d,e)}))),v},d}(),D={};function C(e,d){D[e]=d}function q(e){return D[e]}var h=function(){function e(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return e.create=function(d){var v=new e;return v.schema=Object.assign({},d&&d.schema||{}),v.indexes=Object.assign({},d&&d.indexes||{}),v.fieldsByIndex=Object.assign({},d&&d.fieldsByIndex||{}),v.descriptors=Object.assign({},d&&d.descriptors||{}),v.deprecated=Object.assign({},d&&d.deprecated||{}),v},e.prototype.addField=function(e,d){var v=this.getNextFieldIndex();this.fieldsByIndex[v]=e,this.indexes[e]=v,this.schema[e]=Array.isArray(d)?{array:d[0]}:d},e.prototype.hasField=function(e){return void 0!==this.indexes[e]},e.prototype.addFilter=function(e,d){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=d,this.indexesWithFilters.push(this.indexes[e]),!0},e.prototype.addChildrenFilter=function(e,d){var v=this.indexes[e],P=this.schema[e];if(q(Object.keys(P)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[v]=d,!0;console.warn("@filterChildren: field '".concat(e,"' can't have children. Ignoring filter."))},e.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},e}();function l(e){return e._context&&e._context.useFilters}var n=function(){function e(){this.types={},this.schemas=new Map,this.useFilters=!1}return e.prototype.has=function(e){return this.schemas.has(e)},e.prototype.get=function(e){return this.types[e]},e.prototype.add=function(e,d){void 0===d&&(d=this.schemas.size),e._definition=h.create(e._definition),e._typeid=d,this.types[d]=e,this.schemas.set(e,d)},e.create=function(d){return void 0===d&&(d={}),function(v){return d.context||(d.context=new e),x(v,d)}},e}(),A=new n;function x(e,d){return void 0===d&&(d={}),function(v,P){var L=d.context||A,B=v.constructor;if(B._context=L,!e)throw new Error("".concat(B.name,': @type() reference provided for "').concat(P,"\" is undefined. Make sure you don't have any circular dependencies."));L.has(B)||L.add(B);var X=B._definition;if(X.addField(P,e),X.descriptors[P]){if(X.deprecated[P])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(P,"' definition on '").concat(B.name,"'.\nCheck @type() annotation"))}catch(D){var z=D.stack.split("\n")[4].trim();throw new Error("".concat(D.message," ").concat(z))}}var W=w.is(e),V=!W&&U.is(e);if("string"!==typeof e&&!Se.is(e)){var k=Object.values(e)[0];"string"===typeof k||L.has(k)||L.add(k)}if(d.manual)X.descriptors[P]={enumerable:!0,configurable:!0,writable:!0};else{var g="_".concat(P);X.descriptors[g]={enumerable:!1,configurable:!1,writable:!0},X.descriptors[P]={get:function(){return this[g]},set:function(e){e!==this[g]&&(void 0!==e&&null!==e?(!W||e instanceof w||(e=new(w.bind.apply(w,p([void 0],e,!1)))),!V||e instanceof U||(e=new U(e)),void 0===e.$proxy&&(V?e=G(e):W&&(e=F(e))),this.$changes.change(P),e.$changes&&e.$changes.setParent(this,this.$changes.root,this._definition.indexes[P])):this[g]&&this.$changes.delete(P),this[g]=e)},enumerable:!0,configurable:!0}}}}function i(e){return function(d,v){var P=d.constructor;P._definition.addFilter(v,e)&&(P._context.useFilters=!0)}}function me(e){return function(d,v){var P=d.constructor;P._definition.addChildrenFilter(v,e)&&(P._context.useFilters=!0)}}function r(e){return void 0===e&&(e=!0),function(d,v){var P=d.constructor._definition;P.deprecated[v]=!0,e&&(P.descriptors[v]={get:function(){throw new Error("".concat(v," is deprecated."))},set:function(e){},enumerable:!1,configurable:!0})}}function Z(e,d,v){for(var P in void 0===v&&(v={}),v.context||(v.context=e._context||v.context||A),d)x(d[P],v)(e.prototype,P);return e}function f(e){for(var d=0,v=0,P=0,p=e.length;P<p;P++)(d=e.charCodeAt(P))<128?v+=1:d<2048?v+=2:d<55296||d>=57344?v+=3:(P++,v+=4);return v}function T(e,d,v){for(var P=0,p=0,L=v.length;p<L;p++)(P=v.charCodeAt(p))<128?e[d++]=P:P<2048?(e[d++]=192|P>>6,e[d++]=128|63&P):P<55296||P>=57344?(e[d++]=224|P>>12,e[d++]=128|P>>6&63,e[d++]=128|63&P):(p++,P=65536+((1023&P)<<10|1023&v.charCodeAt(p)),e[d++]=240|P>>18,e[d++]=128|P>>12&63,e[d++]=128|P>>6&63,e[d++]=128|63&P)}function S(e,d){e.push(255&d)}function o(e,d){e.push(255&d)}function K(e,d){e.push(255&d),e.push(d>>8&255)}function Q(e,d){e.push(255&d),e.push(d>>8&255)}function N(e,d){e.push(255&d),e.push(d>>8&255),e.push(d>>16&255),e.push(d>>24&255)}function u(e,d){var v=d>>24,P=d>>16,p=d>>8,L=d;e.push(255&L),e.push(255&p),e.push(255&P),e.push(255&v)}function O(e,d){var v=Math.floor(d/Math.pow(2,32));u(e,d>>>0),u(e,v)}function R(e,d){var v=d/Math.pow(2,32)|0;u(e,d>>>0),u(e,v)}function Y(e,d){c(e,d)}function H(e,d){b(e,d)}var a=new Int32Array(2),t=new Float32Array(a.buffer),I=new Float64Array(a.buffer);function c(e,d){t[0]=d,N(e,a[0])}function b(e,d){I[0]=d,N(e,a[0]),N(e,a[1])}function M(e,d){return o(e,d?1:0)}function s(e,d){d||(d="");var v=f(d),P=0;if(v<32)e.push(160|v),P=1;else if(v<256)e.push(217),o(e,v),P=2;else if(v<65536)e.push(218),Q(e,v),P=3;else{if(!(v<4294967296))throw new Error("String too long");e.push(219),u(e,v),P=5}return T(e,e.length,d),P+v}function y(e,d){return isNaN(d)?y(e,0):isFinite(d)?d!==(0|d)?(e.push(203),b(e,d),9):d>=0?d<128?(o(e,d),1):d<256?(e.push(204),o(e,d),2):d<65536?(e.push(205),Q(e,d),3):d<4294967296?(e.push(206),u(e,d),5):(e.push(207),R(e,d),9):d>=-32?(e.push(224|d+32),1):d>=-128?(e.push(208),S(e,d),2):d>=-32768?(e.push(209),K(e,d),3):d>=-2147483648?(e.push(210),N(e,d),5):(e.push(211),O(e,d),9):y(e,d>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var j=Object.freeze({__proto__:null,utf8Write:T,int8:S,uint8:o,int16:K,uint16:Q,int32:N,uint32:u,int64:O,uint64:R,float32:Y,float64:H,writeFloat32:c,writeFloat64:b,boolean:M,string:s,number:y});function J(e,d,v){for(var P="",p=0,L=d,B=d+v;L<B;L++){var X=e[L];0!==(128&X)?192!==(224&X)?224!==(240&X)?240!==(248&X)?console.error("Invalid byte "+X.toString(16)):(p=(7&X)<<18|(63&e[++L])<<12|(63&e[++L])<<6|63&e[++L])>=65536?(p-=65536,P+=String.fromCharCode(55296+(p>>>10),56320+(1023&p))):P+=String.fromCharCode(p):P+=String.fromCharCode((15&X)<<12|(63&e[++L])<<6|63&e[++L]):P+=String.fromCharCode((31&X)<<6|63&e[++L]):P+=String.fromCharCode(X)}return P}function E(e,d){return ee(e,d)<<24>>24}function ee(e,d){return e[d.offset++]}function de(e,d){return ve(e,d)<<16>>16}function ve(e,d){return e[d.offset++]|e[d.offset++]<<8}function Pe(e,d){return e[d.offset++]|e[d.offset++]<<8|e[d.offset++]<<16|e[d.offset++]<<24}function pe(e,d){return Pe(e,d)>>>0}function Le(e,d){return ge(e,d)}function Be(e,d){return Fe(e,d)}function Xe(e,d){var v=pe(e,d);return Pe(e,d)*Math.pow(2,32)+v}function ze(e,d){var v=pe(e,d);return pe(e,d)*Math.pow(2,32)+v}var We=new Int32Array(2),Ve=new Float32Array(We.buffer),ke=new Float64Array(We.buffer);function ge(e,d){return We[0]=Pe(e,d),Ve[0]}function Fe(e,d){return We[0]=Pe(e,d),We[1]=Pe(e,d),ke[0]}function we(e,d){return ee(e,d)>0}function Ge(e,d){var v,P=e[d.offset++];P<192?v=31&P:217===P?v=ee(e,d):218===P?v=ve(e,d):219===P&&(v=pe(e,d));var p=J(e,d.offset,v);return d.offset+=v,p}function Ue(e,d){var v=e[d.offset];return v<192&&v>160||217===v||218===v||219===v}function De(e,d){var v=e[d.offset++];return v<128?v:202===v?ge(e,d):203===v?Fe(e,d):204===v?ee(e,d):205===v?ve(e,d):206===v?pe(e,d):207===v?ze(e,d):208===v?E(e,d):209===v?de(e,d):210===v?Pe(e,d):211===v?Xe(e,d):v>223?-1*(255-v+1):void 0}function Ce(e,d){var v=e[d.offset];return v<128||v>=202&&v<=211}function qe(e,d){return e[d.offset]<160}function he(e,d){return e[d.offset-1]===B&&(e[d.offset]<128||e[d.offset]>=202&&e[d.offset]<=211)}var le=Object.freeze({__proto__:null,int8:E,uint8:ee,int16:de,uint16:ve,int32:Pe,uint32:pe,float32:Le,float64:Be,int64:Xe,uint64:ze,readFloat32:ge,readFloat64:Fe,boolean:we,string:Ge,stringCheck:Ue,number:De,numberCheck:Ce,arrayCheck:qe,switchStructureCheck:he}),ne=function(){function d(e){var d=this;this.$changes=new z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return d.add(e)}))}return d.prototype.fX=function(d,v){return void 0===v&&(v=!0),W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,d,v?this.$items:void 0)},d.prototype.Ld=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,d)},d.is=function(e){return void 0!==e.collection},d.prototype.add=function(e){var d=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,d),this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,e),this.$changes.change(d),d},d.prototype.at=function(e){var d=Array.from(this.$items.keys())[e];return this.$items.get(d)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(e){for(var d,v,P=this.$items.entries();(v=P.next())&&!v.done;)if(e===v.value[1]){d=v.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&V.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(e){return Array.from(this.$items.values()).some((function(d){return d===e}))},d.prototype.forEach=function(e){var d=this;this.$items.forEach((function(v,P,p){return e(v,P,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(e,d){this.$indexes.set(e,d)},d.prototype.getIndex=function(e){return this.$indexes.get(e)},d.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},d.prototype.deleteByIndex=function(e){var d=this.$indexes.get(e);this.$items.delete(d),this.$indexes.delete(e)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var e=[];return this.forEach((function(d,v){e.push("function"===typeof d.toJSON?d.toJSON():d)})),e},d.prototype.clone=function(e){var v;return e?v=Object.assign(new d,this):(v=new d,this.forEach((function(e){e.$changes?v.add(e.clone()):v.add(e)}))),v},d}(),Ae=function(){function d(e){var d=this;this.$changes=new z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return d.add(e)}))}return d.prototype.fX=function(d,v){return void 0===v&&(v=!0),W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,d,v?this.$items:void 0)},d.prototype.Ld=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,d)},d.is=function(e){return void 0!==e.set},d.prototype.add=function(d){var v,P;if(this.has(d))return!1;var p=this.$refId++;void 0!==d.$changes&&d.$changes.setParent(this,this.$changes.root,p);var L=null!==(P=null===(v=this.$changes.indexes[p])||void 0===v?void 0:v.op)&&void 0!==P?P:e.OPERATION.ADD;return this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,d),this.$changes.change(p,L),p},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(e){for(var d,v,P=this.$items.entries();(v=P.next())&&!v.done;)if(e===v.value[1]){d=v.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&V.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(e){for(var d,v=this.$items.values(),P=!1;(d=v.next())&&!d.done;)if(e===d.value){P=!0;break}return P},d.prototype.forEach=function(e){var d=this;this.$items.forEach((function(v,P,p){return e(v,P,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(e,d){this.$indexes.set(e,d)},d.prototype.getIndex=function(e){return this.$indexes.get(e)},d.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},d.prototype.deleteByIndex=function(e){var d=this.$indexes.get(e);this.$items.delete(d),this.$indexes.delete(e)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var e=[];return this.forEach((function(d,v){e.push("function"===typeof d.toJSON?d.toJSON():d)})),e},d.prototype.clone=function(e){var v;return e?v=Object.assign(new d,this):(v=new d,this.forEach((function(e){e.$changes?v.add(e.clone()):v.add(e)}))),v},d}(),xe=function(){function e(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return e.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},e.get=function(d){return void 0===d.$filterState&&(d.$filterState=new e),d.$filterState},e}(),ie=function(){function e(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return e.prototype.getNextUniqueId=function(){return this.nextUniqueId++},e.prototype.addRef=function(e,d,v){void 0===v&&(v=!0),this.refs.set(e,d),v&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},e.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},e.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},e.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach((function(d){if(!(e.refCounts[d]>0)){var v=e.refs.get(d);if(v instanceof Se)for(var P in v._definition.schema)"string"!==typeof v._definition.schema[P]&&v[P]&&v[P].$changes&&e.removeRef(v[P].$changes.refId);else{var p=v.$changes.parent._definition,L=p.schema[p.fieldsByIndex[v.$changes.parentIndex]];"function"===typeof Object.values(L)[0]&&Array.from(v.values()).forEach((function(d){return e.removeRef(d.$changes.refId)}))}e.refs.delete(d),delete e.refCounts[d]}})),this.deletedRefs.clear()},e}(),md=function(e){function d(){return null!==e&&e.apply(this,arguments)||this}return v(d,e),d}(Error);function re(e,d,v,P){var p,L=!1;switch(d){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":p="number",isNaN(e)&&console.log('trying to encode "NaN" in '.concat(v.constructor.name,"#").concat(P));break;case"string":p="string",L=!0;break;case"boolean":return}if(typeof e!==p&&(!L||L&&null!==e)){var B="'".concat(JSON.stringify(e),"'").concat(e&&e.constructor&&" (".concat(e.constructor.name,")")||"");throw new md("a '".concat(p,"' was expected, but ").concat(B," was provided in ").concat(v.constructor.name,"#").concat(P))}}function Ze(e,d,v,P){if(!(e instanceof d))throw new md("a '".concat(d.name,"' was expected, but '").concat(e.constructor.name,"' was provided in ").concat(v.constructor.name,"#").concat(P))}function fe(e,d,v,P,p){re(v,e,P,p);var L=j[e];if(!L)throw new md("a '".concat(e,"' was expected, but ").concat(v," was provided in ").concat(P.constructor.name,"#").concat(p));L(d,v)}function Te(e,d,v){return le[e](d,v)}var Se=function(){function d(){for(var e=[],d=0;d<arguments.length;d++)e[d]=arguments[d];Object.defineProperties(this,{$changes:{value:new z(this,void 0,new ie),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var v=this._definition.descriptors;v&&Object.defineProperties(this,v),e[0]&&this.assign(e[0])}return d.onError=function(e){console.error(e)},d.is=function(e){return e._definition&&void 0!==e._definition.schema},d.prototype.onChange=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,d)},d.prototype.Ld=function(d){return W(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,d)},d.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(d.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),d.prototype.setDirty=function(e,d){this.$changes.change(e,d)},d.prototype.listen=function(e,d,v){var P=this;return void 0===v&&(v=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[e]||(this.$callbacks[e]=[]),this.$callbacks[e].push(d),v&&void 0!==this[e]&&d(this[e],void 0),function(){return k(P.$callbacks[e],P.$callbacks[e].indexOf(d))}},d.prototype.decode=function(v,P,p){var L;void 0===P&&(P={offset:0}),void 0===p&&(p=this);var X=[],z=this.$changes.root,W=v.length,V=0;for(z.refs.set(V,this);P.offset<W;){var k=v[P.offset++];if(k!=B){var g=p.$changes,F=void 0!==p._definition,G=F?k>>6<<6:k;if(G!==e.OPERATION.CLEAR){var D=F?k%(G||255):De(v,P),C=F?p._definition.fieldsByIndex[D]:"",h=g.getType(D),l=void 0,n=void 0,A=void 0;if(F?n=p["_".concat(C)]:(n=p.getByIndex(D),(G&e.OPERATION.ADD)===e.OPERATION.ADD?(A=p instanceof U?Ge(v,P):D,p.setIndex(D,A)):A=p.getIndex(D)),(G&e.OPERATION.DELETE)===e.OPERATION.DELETE&&(G!==e.OPERATION.DELETE_AND_ADD&&p.deleteByIndex(D),n&&n.$changes&&z.removeRef(n.$changes.refId),l=null),void 0!==C){if(G===e.OPERATION.DELETE);else if(d.is(h)){var x=De(v,P);if(l=z.refs.get(x),G!==e.OPERATION.REPLACE){var i=this.getSchemaType(v,P,h);l||((l=this.createTypeInstance(i)).$changes.refId=x,n&&(l.$callbacks=n.$callbacks,n.$changes.refId&&x!==n.$changes.refId&&z.removeRef(n.$changes.refId))),z.addRef(x,l,l!==n)}}else if("string"===typeof h)l=Te(h,v,P);else{var me=q(Object.keys(h)[0]),r=De(v,P),Z=z.refs.has(r)?n||z.refs.get(r):new me.constructor;if((l=Z.clone(!0)).$changes.refId=r,n&&(l.$callbacks=n.$callbacks,n.$changes.refId&&r!==n.$changes.refId)){z.removeRef(n.$changes.refId);for(var f=n.entries(),T=void 0;(T=f.next())&&!T.done;){var S=(L=T.value)[0],o=L[1];X.push({refId:r,op:e.OPERATION.DELETE,field:S,value:void 0,previousValue:o})}}z.addRef(r,l,Z!==n)}if(null!==l&&void 0!==l)if(l.$changes&&l.$changes.setParent(g.ref,g.root,D),p instanceof d)p[C]=l;else if(p instanceof U)S=A,p.$items.set(S,l),p.$changes.allChanges.add(D);else if(p instanceof w)p.setAt(D,l);else if(p instanceof ne){var K=p.add(l);p.setIndex(D,K)}else p instanceof Ae&&!1!==(K=p.add(l))&&p.setIndex(D,K);n!==l&&X.push({refId:V,op:G,field:C,dynamicIndex:A,value:l,previousValue:n})}else{console.warn("@colyseus/schema: definition mismatch");for(var Q={offset:P.offset};P.offset<W&&(!he(v,P)||(Q.offset=P.offset+1,!z.refs.has(De(v,Q))));)P.offset++}}else p.clear(X)}else{V=De(v,P);var N=z.refs.get(V);if(!N)throw new Error('"refId" not found: '.concat(V));p=N}}return this._triggerChanges(X),z.garbageCollectDeletedRefs(),X},d.prototype.encode=function(v,P,p){void 0===v&&(v=!1),void 0===P&&(P=[]),void 0===p&&(p=!1);for(var L=this.$changes,X=new WeakSet,z=[L],W=1,V=0;V<W;V++){var k=z[V],g=k.ref,F=g instanceof d;k.ensureRefId(),X.add(k),k!==L&&(k.changed||v)&&(o(P,B),y(P,k.refId));for(var w=v?Array.from(k.allChanges):Array.from(k.changes.values()),G=0,D=w.length;G<D;G++){var C=v?{op:e.OPERATION.ADD,index:w[G]}:w[G],h=C.index,l=F?g._definition.fieldsByIndex&&g._definition.fieldsByIndex[h]:h,n=P.length;if(C.op!==e.OPERATION.TOUCH)if(F)o(P,h|C.op);else{if(o(P,C.op),C.op===e.OPERATION.CLEAR)continue;y(P,h)}if(F||(C.op&e.OPERATION.ADD)!=e.OPERATION.ADD||g instanceof U&&s(P,k.ref.$indexes.get(h)),C.op!==e.OPERATION.DELETE){var A=k.getType(h),x=k.getValue(h);if(x&&x.$changes&&!X.has(x.$changes)&&(z.push(x.$changes),x.$changes.ensureRefId(),W++),C.op!==e.OPERATION.TOUCH){if(d.is(A))Ze(x,A,g,l),y(P,x.$changes.refId),(C.op&e.OPERATION.ADD)===e.OPERATION.ADD&&this.tryEncodeTypeId(P,A,x.constructor);else if("string"===typeof A)fe(A,P,x,g,l);else{var i=q(Object.keys(A)[0]);Ze(g["_".concat(l)],i.constructor,g,l),y(P,x.$changes.refId)}p&&k.cache(h,P.slice(n))}}}v||p||k.discard()}return P},d.prototype.encodeAll=function(e){return this.encode(!0,[],e)},d.prototype.applyFilters=function(v,P){var p,L;void 0===P&&(P=!1);for(var X=this,z=new Set,W=xe.get(v),V=[this.$changes],k=1,g=[],F=function(F){var w=V[F];if(z.has(w.refId))return"continue";var G=w.ref,D=G instanceof d;o(g,B),y(g,w.refId);var C=W.refIds.has(w),q=P||!C;W.addRefId(w);var h=W.containerIndexes.get(w),l=q?Array.from(w.allChanges):Array.from(w.changes.values());!P&&D&&G._definition.indexesWithFilters&&G._definition.indexesWithFilters.forEach((function(d){!h.has(d)&&w.allChanges.has(d)&&(q?l.push(d):l.push({op:e.OPERATION.ADD,index:d}))}));for(var n=0,A=l.length;n<A;n++){var x=q?{op:e.OPERATION.ADD,index:l[n]}:l[n];if(x.op!==e.OPERATION.CLEAR){var i=x.index;if(x.op!==e.OPERATION.DELETE){var me=w.getValue(i),r=w.getType(i);if(D){if((Z=G._definition.filters&&G._definition.filters[i])&&!Z.call(G,v,me,X)){me&&me.$changes&&z.add(me.$changes.refId);continue}}else{var Z,f=w.parent;if((Z=w.getChildrenFilter())&&!Z.call(f,v,G.$indexes.get(i),me,X)){me&&me.$changes&&z.add(me.$changes.refId);continue}}if(me.$changes&&(V.push(me.$changes),k++),x.op!==e.OPERATION.TOUCH)if(x.op===e.OPERATION.ADD||D)g.push.apply(g,null!==(p=w.caches[i])&&void 0!==p?p:[]),h.add(i);else if(h.has(i))g.push.apply(g,null!==(L=w.caches[i])&&void 0!==L?L:[]);else{if(h.add(i),o(g,e.OPERATION.ADD),y(g,i),G instanceof U){var T=w.ref.$indexes.get(i);s(g,T)}me.$changes?y(g,me.$changes.refId):j[r](g,me)}else me.$changes&&!D&&(o(g,e.OPERATION.ADD),y(g,i),G instanceof U&&(T=w.ref.$indexes.get(i),s(g,T)),y(g,me.$changes.refId))}else D?o(g,x.op|i):(o(g,x.op),y(g,i))}else o(g,x.op)}},w=0;w<k;w++)F(w);return g},d.prototype.clone=function(){var e,d=new this.constructor,v=this._definition.schema;for(var P in v)"object"===typeof this[P]&&"function"===typeof(null===(e=this[P])||void 0===e?void 0:e.clone)?d[P]=this[P].clone():d[P]=this[P];return d},d.prototype.toJSON=function(){var e=this._definition.schema,d=this._definition.deprecated,v={};for(var P in e)d[P]||null===this[P]||"undefined"===typeof this[P]||(v[P]="function"===typeof this[P].toJSON?this[P].toJSON():this["_".concat(P)]);return v},d.prototype.discardAllChanges=function(){this.$changes.discardAll()},d.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},d.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},d.prototype.tryEncodeTypeId=function(e,d,v){d._typeid!==v._typeid&&(o(e,X),y(e,v._typeid))},d.prototype.getSchemaType=function(e,d,v){var P;return e[d.offset]===X&&(d.offset++,P=this.constructor._context.get(De(e,d))),P||v},d.prototype.createTypeInstance=function(e){var d=new e;return d.$changes.root=this.$changes.root,d},d.prototype._triggerChanges=function(v){for(var P,p,L,B,X,z,W,V,k,g=new Set,F=this.$changes.root.refs,w=function(w){var G=v[w],U=G.refId,D=F.get(U),C=D.$callbacks;if((G.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&G.previousValue instanceof d&&(null===(p=null===(P=G.previousValue.$callbacks)||void 0===P?void 0:P[e.OPERATION.DELETE])||void 0===p||p.forEach((function(e){return e()}))),!C)return"continue";if(D instanceof d){if(!g.has(U))try{null===(L=null===C||void 0===C?void 0:C[e.OPERATION.REPLACE])||void 0===L||L.forEach((function(e){return e()}))}catch(q){d.onError(q)}try{C.hasOwnProperty(G.field)&&(null===(B=C[G.field])||void 0===B||B.forEach((function(e){return e(G.value,G.previousValue)})))}catch(q){d.onError(q)}}else G.op===e.OPERATION.ADD&&void 0===G.previousValue?null===(X=C[e.OPERATION.ADD])||void 0===X||X.forEach((function(e){var d;return e(G.value,null!==(d=G.dynamicIndex)&&void 0!==d?d:G.field)})):G.op===e.OPERATION.DELETE?void 0!==G.previousValue&&(null===(z=C[e.OPERATION.DELETE])||void 0===z||z.forEach((function(e){var d;return e(G.previousValue,null!==(d=G.dynamicIndex)&&void 0!==d?d:G.field)}))):G.op===e.OPERATION.DELETE_AND_ADD&&(void 0!==G.previousValue&&(null===(W=C[e.OPERATION.DELETE])||void 0===W||W.forEach((function(e){var d;return e(G.previousValue,null!==(d=G.dynamicIndex)&&void 0!==d?d:G.field)}))),null===(V=C[e.OPERATION.ADD])||void 0===V||V.forEach((function(e){var d;return e(G.value,null!==(d=G.dynamicIndex)&&void 0!==d?d:G.field)}))),G.value!==G.previousValue&&(null===(k=C[e.OPERATION.REPLACE])||void 0===k||k.forEach((function(e){var d;return e(G.value,null!==(d=G.dynamicIndex)&&void 0!==d?d:G.field)})));g.add(U)},G=0;G<v.length;G++)w(G)},d._definition=h.create(),d}();function oe(e){for(var d=[e.$changes],v=1,P={},p=P,L=function(e){var v=d[e];v.changes.forEach((function(e){var d=v.ref,P=e.index,L=d._definition?d._definition.fieldsByIndex[P]:d.$indexes.get(P);p[L]=v.getValue(P)}))},B=0;B<v;B++)L(B);return P}var Ke={context:new n},Qe=function(e){function d(){return null!==e&&e.apply(this,arguments)||this}return v(d,e),P([x("string",Ke)],d.prototype,"name",void 0),P([x("string",Ke)],d.prototype,"type",void 0),P([x("number",Ke)],d.prototype,"referencedType",void 0),d}(Se),Ne=function(e){function d(){var d=null!==e&&e.apply(this,arguments)||this;return d.fields=new w,d}return v(d,e),P([x("number",Ke)],d.prototype,"id",void 0),P([x([Qe],Ke)],d.prototype,"fields",void 0),d}(Se),ue=function(e){function d(){var d=null!==e&&e.apply(this,arguments)||this;return d.types=new w,d}return v(d,e),d.encode=function(e){var v=e.constructor,P=new d;P.rootType=v._typeid;var p=function(e,d){for(var v in d){var p=new Qe;p.name=v;var L=void 0;if("string"===typeof d[v])L=d[v];else{var B=d[v],X=void 0;Se.is(B)?(L="ref",X=d[v]):"string"===typeof B[L=Object.keys(B)[0]]?L+=":"+B[L]:X=B[L],p.referencedType=X?X._typeid:-1}p.type=L,e.fields.push(p)}P.types.push(e)},L=v._context.types;for(var B in L){var X=new Ne;X.id=Number(B),p(X,L[B]._definition.schema)}return P.encodeAll()},d.decode=function(e,P){var p=new n,L=new d;L.decode(e,P);var B=L.types.reduce((function(e,d){var P=function(e){function d(){return null!==e&&e.apply(this,arguments)||this}return v(d,e),d}(Se),L=d.id;return e[L]=P,p.add(P,L),e}),{});L.types.forEach((function(e){var d=B[e.id];e.fields.forEach((function(e){var v;if(void 0!==e.referencedType){var P=e.type,L=B[e.referencedType];if(!L){var X=e.type.split(":");P=X[0],L=X[1]}"ref"===P?x(L,{context:p})(d.prototype,e.name):x(((v={})[P]=L,v),{context:p})(d.prototype,e.name)}else x(e.type,{context:p})(d.prototype,e.name)}))}));var X=B[L.rootType],z=new X;for(var W in X._definition.schema){var V=X._definition.schema[W];"string"!==typeof V&&(z[W]="function"===typeof V?new V:new(q(Object.keys(V)[0]).constructor))}return z},P([x([Ne],Ke)],d.prototype,"types",void 0),P([x("number",Ke)],d.prototype,"rootType",void 0),d}(Se);C("map",{constructor:U}),C("array",{constructor:w}),C("set",{constructor:Ae}),C("collection",{constructor:ne}),e.ArraySchema=w,e.CollectionSchema=ne,e.Context=n,e.MapSchema=U,e.Reflection=ue,e.ReflectionField=Qe,e.ReflectionType=Ne,e.Schema=Se,e.SchemaDefinition=h,e.SetSchema=Ae,e.decode=le,e.defineTypes=Z,e.deprecated=r,e.dumpChanges=oe,e.encode=j,e.filter=i,e.filterChildren=me,e.hasFilter=l,e.registerType=C,e.type=x,Object.defineProperty(e,"__esModule",{value:!0})}(d)},14573:e=>{"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14568:(e,d,v)=>{var P=v(14573),p=v(14576),L=Object.hasOwnProperty,B=Object.create(null);for(var X in P)L.call(P,X)&&(B[P[X]]=X);var z=e.exports={to:{},get:{}};function W(e,d,v){return Math.min(Math.max(d,e),v)}function V(e){var d=Math.round(e).toString(16).toUpperCase();return d.length<2?"0"+d:d}z.get=function(e){var d,v;switch(e.substring(0,3).toLowerCase()){case"hsl":d=z.get.hsl(e),v="hsl";break;case"hwb":d=z.get.hwb(e),v="hwb";break;default:d=z.get.rgb(e),v="rgb"}return d?{model:v,value:d}:null},z.get.rgb=function(e){if(!e)return null;var d,v,p,B=[0,0,0,1];if(d=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(p=d[2],d=d[1],v=0;v<3;v++){var X=2*v;B[v]=parseInt(d.slice(X,X+2),16)}p&&(B[3]=parseInt(p,16)/255)}else if(d=e.match(/^#([a-f0-9]{3,4})$/i)){for(p=(d=d[1])[3],v=0;v<3;v++)B[v]=parseInt(d[v]+d[v],16);p&&(B[3]=parseInt(p+p,16)/255)}else if(d=e.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(v=0;v<3;v++)B[v]=parseInt(d[v+1],0);d[4]&&(d[5]?B[3]=.01*parseFloat(d[4]):B[3]=parseFloat(d[4]))}else{if(!(d=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(d=e.match(/^(\w+)$/))?"transparent"===d[1]?[0,0,0,0]:L.call(P,d[1])?((B=P[d[1]])[3]=1,B):null:null;for(v=0;v<3;v++)B[v]=Math.round(2.55*parseFloat(d[v+1]));d[4]&&(d[5]?B[3]=.01*parseFloat(d[4]):B[3]=parseFloat(d[4]))}for(v=0;v<3;v++)B[v]=W(B[v],0,255);return B[3]=W(B[3],0,1),B},z.get.hsl=function(e){if(!e)return null;var d=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var v=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,W(parseFloat(d[2]),0,100),W(parseFloat(d[3]),0,100),W(isNaN(v)?1:v,0,1)]}return null},z.get.hwb=function(e){if(!e)return null;var d=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var v=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,W(parseFloat(d[2]),0,100),W(parseFloat(d[3]),0,100),W(isNaN(v)?1:v,0,1)]}return null},z.to.hex=function(){var e=p(arguments);return"#"+V(e[0])+V(e[1])+V(e[2])+(e[3]<1?V(Math.round(255*e[3])):"")},z.to.rgb=function(){var e=p(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},z.to.rgb.percent=function(){var e=p(arguments),d=Math.round(e[0]/255*100),v=Math.round(e[1]/255*100),P=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+d+"%, "+v+"%, "+P+"%)":"rgba("+d+"%, "+v+"%, "+P+"%, "+e[3]+")"},z.to.hsl=function(){var e=p(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},z.to.hwb=function(){var e=p(arguments),d="";return e.length>=4&&1!==e[3]&&(d=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+d+")"},z.to.keyword=function(e){return B[e.slice(0,3)]}},14565:(e,d,v)=>{const P=v(14568),p=v(14583),L=["keyword","gray","hex"],B={};for(const F of Object.keys(p))B[[...p[F].labels].sort().join("")]=F;const X={};function z(e,d){if(!(this instanceof z))return new z(e,d);if(d&&d in L&&(d=null),d&&!(d in p))throw new Error("Unknown model: "+d);let v,W;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof z)this.model=e.model,this.color=[...e.color],this.valpha=e.valpha;else if("string"===typeof e){const d=P.get(e);if(null===d)throw new Error("Unable to parse color from string: "+e);this.model=d.model,W=p[this.model].channels,this.color=d.value.slice(0,W),this.valpha="number"===typeof d.value[W]?d.value[W]:1}else if(e.length>0){this.model=d||"rgb",W=p[this.model].channels;const v=Array.prototype.slice.call(e,0,W);this.color=g(v,W),this.valpha="number"===typeof e[W]?e[W]:1}else if("number"===typeof e)this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;const d=Object.keys(e);"alpha"in e&&(d.splice(d.indexOf("alpha"),1),this.valpha="number"===typeof e.alpha?e.alpha:0);const P=d.sort().join("");if(!(P in B))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=B[P];const{labels:L}=p[this.model],X=[];for(v=0;v<L.length;v++)X.push(e[L[v]]);this.color=g(X)}if(X[this.model])for(W=p[this.model].channels,v=0;v<W;v++){const e=X[this.model][v];e&&(this.color[v]=e(this.color[v]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}z.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(e){let d=this.model in P.to?this:this.rgb();d=d.round("number"===typeof e?e:1);const v=1===d.valpha?d.color:[...d.color,this.valpha];return P.to[d.model](v)},percentString(e){const d=this.rgb().round("number"===typeof e?e:1),v=1===d.valpha?d.color:[...d.color,this.valpha];return P.to.rgb.percent(v)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const e={},{channels:d}=p[this.model],{labels:v}=p[this.model];for(let P=0;P<d;P++)e[v[P]]=this.color[P];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray(){const e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject(){const e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round(e){return e=Math.max(e||0,0),new z([...this.color.map(W(e)),this.valpha],this.model)},alpha(e){return void 0!==e?new z([...this.color,Math.max(0,Math.min(1,e))],this.model):this.valpha},red:V("rgb",0,k(255)),green:V("rgb",1,k(255)),blue:V("rgb",2,k(255)),hue:V(["hsl","hsv","hsl","hwb","hcg"],0,(e=>(e%360+360)%360)),saturationl:V("hsl",1,k(100)),lightness:V("hsl",2,k(100)),saturationv:V("hsv",1,k(100)),value:V("hsv",2,k(100)),chroma:V("hcg",1,k(100)),gray:V("hcg",2,k(100)),white:V("hwb",1,k(100)),wblack:V("hwb",2,k(100)),cyan:V("cmyk",0,k(100)),magenta:V("cmyk",1,k(100)),yellow:V("cmyk",2,k(100)),black:V("cmyk",3,k(100)),x:V("xyz",0,k(95.047)),y:V("xyz",1,k(100)),z:V("xyz",2,k(108.833)),l:V("lab",0,k(100)),a:V("lab",1),b:V("lab",2),keyword(e){return void 0!==e?new z(e):p[this.model].keyword(this.color)},hex(e){return void 0!==e?new z(e):P.to.hex(this.rgb().round().color)},hexa(e){if(void 0!==e)return new z(e);const d=this.rgb().round().color;let v=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===v.length&&(v="0"+v),P.to.hex(d)+v},rgbNumber(){const e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity(){const e=this.rgb().color,d=[];for(const[v,P]of e.entries()){const e=P/255;d[v]=e<=.04045?e/12.92:((e+.055)/1.055)**2.4}return.2126*d[0]+.7152*d[1]+.0722*d[2]},contrast(e){const d=this.luminosity(),v=e.luminosity();return d>v?(d+.05)/(v+.05):(v+.05)/(d+.05)},level(e){const d=this.contrast(e);return d>=7?"AAA":d>=4.5?"AA":""},isDark(){const e=this.rgb().color;return(2126*e[0]+7152*e[1]+722*e[2])/1e4<128},isLight(){return!this.isDark()},negate(){const e=this.rgb();for(let d=0;d<3;d++)e.color[d]=255-e.color[d];return e},lighten(e){const d=this.hsl();return d.color[2]+=d.color[2]*e,d},darken(e){const d=this.hsl();return d.color[2]-=d.color[2]*e,d},saturate(e){const d=this.hsl();return d.color[1]+=d.color[1]*e,d},desaturate(e){const d=this.hsl();return d.color[1]-=d.color[1]*e,d},whiten(e){const d=this.hwb();return d.color[1]+=d.color[1]*e,d},blacken(e){const d=this.hwb();return d.color[2]+=d.color[2]*e,d},grayscale(){const e=this.rgb().color,d=.3*e[0]+.59*e[1]+.11*e[2];return z.rgb(d,d,d)},fade(e){return this.alpha(this.valpha-this.valpha*e)},opaquer(e){return this.alpha(this.valpha+this.valpha*e)},rotate(e){const d=this.hsl();let v=d.color[0];return v=(v+e)%360,v=v<0?360+v:v,d.color[0]=v,d},mix(e,d){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);const v=e.rgb(),P=this.rgb(),p=void 0===d?.5:d,L=2*p-1,B=v.alpha()-P.alpha(),X=((L*B===-1?L:(L+B)/(1+L*B))+1)/2,W=1-X;return z.rgb(X*v.red()+W*P.red(),X*v.green()+W*P.green(),X*v.blue()+W*P.blue(),v.alpha()*p+P.alpha()*(1-p))}};for(const F of Object.keys(p)){if(L.includes(F))continue;const{channels:e}=p[F];z.prototype[F]=function(){if(this.model===F)return new z(this);for(var e=arguments.length,d=new Array(e),v=0;v<e;v++)d[v]=arguments[v];return d.length>0?new z(d,F):new z([...(P=p[this.model][F].raw(this.color),Array.isArray(P)?P:[P]),this.valpha],F);var P},z[F]=function(){for(var d=arguments.length,v=new Array(d),P=0;P<d;P++)v[P]=arguments[P];let p=v[0];return"number"===typeof p&&(p=g(v,e)),new z(p,F)}}function W(e){return function(d){return function(e,d){return Number(e.toFixed(d))}(d,e)}}function V(e,d,v){e=Array.isArray(e)?e:[e];for(const P of e)(X[P]||(X[P]=[]))[d]=v;return e=e[0],function(P){let p;return void 0!==P?(v&&(P=v(P)),p=this[e](),p.color[d]=P,p):(p=this[e]().color[d],v&&(p=v(p)),p)}}function k(e){return function(d){return Math.max(0,Math.min(e,d))}}function g(e,d){for(let v=0;v<d;v++)"number"!==typeof e[v]&&(e[v]=0);return e}e.exports=z},14589:(e,d,v)=>{const P=v(14596),p={};for(const B of Object.keys(P))p[P[B]]=B;const L={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};e.exports=L;for(const B of Object.keys(L)){if(!("channels"in L[B]))throw new Error("missing channels property: "+B);if(!("labels"in L[B]))throw new Error("missing channel labels property: "+B);if(L[B].labels.length!==L[B].channels)throw new Error("channel and label counts mismatch: "+B);const{channels:e,labels:d}=L[B];delete L[B].channels,delete L[B].labels,Object.defineProperty(L[B],"channels",{value:e}),Object.defineProperty(L[B],"labels",{value:d})}L.rgb.hsl=function(e){const d=e[0]/255,v=e[1]/255,P=e[2]/255,p=Math.min(d,v,P),L=Math.max(d,v,P),B=L-p;let X,z;L===p?X=0:d===L?X=(v-P)/B:v===L?X=2+(P-d)/B:P===L&&(X=4+(d-v)/B),X=Math.min(60*X,360),X<0&&(X+=360);const W=(p+L)/2;return z=L===p?0:W<=.5?B/(L+p):B/(2-L-p),[X,100*z,100*W]},L.rgb.hsv=function(e){let d,v,P,p,L;const B=e[0]/255,X=e[1]/255,z=e[2]/255,W=Math.max(B,X,z),V=W-Math.min(B,X,z),k=function(e){return(W-e)/6/V+.5};return 0===V?(p=0,L=0):(L=V/W,d=k(B),v=k(X),P=k(z),B===W?p=P-v:X===W?p=1/3+d-P:z===W&&(p=2/3+v-d),p<0?p+=1:p>1&&(p-=1)),[360*p,100*L,100*W]},L.rgb.hwb=function(e){const d=e[0],v=e[1];let P=e[2];const p=L.rgb.hsl(e)[0],B=1/255*Math.min(d,Math.min(v,P));return P=1-1/255*Math.max(d,Math.max(v,P)),[p,100*B,100*P]},L.rgb.cmyk=function(e){const d=e[0]/255,v=e[1]/255,P=e[2]/255,p=Math.min(1-d,1-v,1-P);return[100*((1-d-p)/(1-p)||0),100*((1-v-p)/(1-p)||0),100*((1-P-p)/(1-p)||0),100*p]},L.rgb.keyword=function(e){const d=p[e];if(d)return d;let v,L=1/0;for(const p of Object.keys(P)){const d=P[p],z=(X=d,((B=e)[0]-X[0])**2+(B[1]-X[1])**2+(B[2]-X[2])**2);z<L&&(L=z,v=p)}var B,X;return v},L.keyword.rgb=function(e){return P[e]},L.rgb.xyz=function(e){let d=e[0]/255,v=e[1]/255,P=e[2]/255;d=d>.04045?((d+.055)/1.055)**2.4:d/12.92,v=v>.04045?((v+.055)/1.055)**2.4:v/12.92,P=P>.04045?((P+.055)/1.055)**2.4:P/12.92;return[100*(.4124*d+.3576*v+.1805*P),100*(.2126*d+.7152*v+.0722*P),100*(.0193*d+.1192*v+.9505*P)]},L.rgb.lab=function(e){const d=L.rgb.xyz(e);let v=d[0],P=d[1],p=d[2];v/=95.047,P/=100,p/=108.883,v=v>.008856?v**(1/3):7.787*v+16/116,P=P>.008856?P**(1/3):7.787*P+16/116,p=p>.008856?p**(1/3):7.787*p+16/116;return[116*P-16,500*(v-P),200*(P-p)]},L.hsl.rgb=function(e){const d=e[0]/360,v=e[1]/100,P=e[2]/100;let p,L,B;if(0===v)return B=255*P,[B,B,B];p=P<.5?P*(1+v):P+v-P*v;const X=2*P-p,z=[0,0,0];for(let W=0;W<3;W++)L=d+1/3*-(W-1),L<0&&L++,L>1&&L--,B=6*L<1?X+6*(p-X)*L:2*L<1?p:3*L<2?X+(p-X)*(2/3-L)*6:X,z[W]=255*B;return z},L.hsl.hsv=function(e){const d=e[0];let v=e[1]/100,P=e[2]/100,p=v;const L=Math.max(P,.01);P*=2,v*=P<=1?P:2-P,p*=L<=1?L:2-L;return[d,100*(0===P?2*p/(L+p):2*v/(P+v)),100*((P+v)/2)]},L.hsv.rgb=function(e){const d=e[0]/60,v=e[1]/100;let P=e[2]/100;const p=Math.floor(d)%6,L=d-Math.floor(d),B=255*P*(1-v),X=255*P*(1-v*L),z=255*P*(1-v*(1-L));switch(P*=255,p){case 0:return[P,z,B];case 1:return[X,P,B];case 2:return[B,P,z];case 3:return[B,X,P];case 4:return[z,B,P];case 5:return[P,B,X]}},L.hsv.hsl=function(e){const d=e[0],v=e[1]/100,P=e[2]/100,p=Math.max(P,.01);let L,B;B=(2-v)*P;const X=(2-v)*p;return L=v*p,L/=X<=1?X:2-X,L=L||0,B/=2,[d,100*L,100*B]},L.hwb.rgb=function(e){const d=e[0]/360;let v=e[1]/100,P=e[2]/100;const p=v+P;let L;p>1&&(v/=p,P/=p);const B=Math.floor(6*d),X=1-P;L=6*d-B,0!==(1&B)&&(L=1-L);const z=v+L*(X-v);let W,V,k;switch(B){default:case 6:case 0:W=X,V=z,k=v;break;case 1:W=z,V=X,k=v;break;case 2:W=v,V=X,k=z;break;case 3:W=v,V=z,k=X;break;case 4:W=z,V=v,k=X;break;case 5:W=X,V=v,k=z}return[255*W,255*V,255*k]},L.cmyk.rgb=function(e){const d=e[0]/100,v=e[1]/100,P=e[2]/100,p=e[3]/100;return[255*(1-Math.min(1,d*(1-p)+p)),255*(1-Math.min(1,v*(1-p)+p)),255*(1-Math.min(1,P*(1-p)+p))]},L.xyz.rgb=function(e){const d=e[0]/100,v=e[1]/100,P=e[2]/100;let p,L,B;return p=3.2406*d+-1.5372*v+-.4986*P,L=-.9689*d+1.8758*v+.0415*P,B=.0557*d+-.204*v+1.057*P,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,p=Math.min(Math.max(0,p),1),L=Math.min(Math.max(0,L),1),B=Math.min(Math.max(0,B),1),[255*p,255*L,255*B]},L.xyz.lab=function(e){let d=e[0],v=e[1],P=e[2];d/=95.047,v/=100,P/=108.883,d=d>.008856?d**(1/3):7.787*d+16/116,v=v>.008856?v**(1/3):7.787*v+16/116,P=P>.008856?P**(1/3):7.787*P+16/116;return[116*v-16,500*(d-v),200*(v-P)]},L.lab.xyz=function(e){let d,v,P;v=(e[0]+16)/116,d=e[1]/500+v,P=v-e[2]/200;const p=v**3,L=d**3,B=P**3;return v=p>.008856?p:(v-16/116)/7.787,d=L>.008856?L:(d-16/116)/7.787,P=B>.008856?B:(P-16/116)/7.787,d*=95.047,v*=100,P*=108.883,[d,v,P]},L.lab.lch=function(e){const d=e[0],v=e[1],P=e[2];let p;p=360*Math.atan2(P,v)/2/Math.PI,p<0&&(p+=360);return[d,Math.sqrt(v*v+P*P),p]},L.lch.lab=function(e){const d=e[0],v=e[1],P=e[2]/360*2*Math.PI;return[d,v*Math.cos(P),v*Math.sin(P)]},L.rgb.ansi16=function(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[v,P,p]=e;let B=null===d?L.rgb.hsv(e)[2]:d;if(B=Math.round(B/50),0===B)return 30;let X=30+(Math.round(p/255)<<2|Math.round(P/255)<<1|Math.round(v/255));return 2===B&&(X+=60),X},L.hsv.ansi16=function(e){return L.rgb.ansi16(L.hsv.rgb(e),e[2])},L.rgb.ansi256=function(e){const d=e[0],v=e[1],P=e[2];if(d===v&&v===P)return d<8?16:d>248?231:Math.round((d-8)/247*24)+232;return 16+36*Math.round(d/255*5)+6*Math.round(v/255*5)+Math.round(P/255*5)},L.ansi16.rgb=function(e){let d=e%10;if(0===d||7===d)return e>50&&(d+=3.5),d=d/10.5*255,[d,d,d];const v=.5*(1+~~(e>50));return[(1&d)*v*255,(d>>1&1)*v*255,(d>>2&1)*v*255]},L.ansi256.rgb=function(e){if(e>=232){const d=10*(e-232)+8;return[d,d,d]}let d;e-=16;return[Math.floor(e/36)/5*255,Math.floor((d=e%36)/6)/5*255,d%6/5*255]},L.rgb.hex=function(e){const d=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(d.length)+d},L.hex.rgb=function(e){const d=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!d)return[0,0,0];let v=d[0];3===d[0].length&&(v=v.split("").map((e=>e+e)).join(""));const P=parseInt(v,16);return[P>>16&255,P>>8&255,255&P]},L.rgb.hcg=function(e){const d=e[0]/255,v=e[1]/255,P=e[2]/255,p=Math.max(Math.max(d,v),P),L=Math.min(Math.min(d,v),P),B=p-L;let X,z;return X=B<1?L/(1-B):0,z=B<=0?0:p===d?(v-P)/B%6:p===v?2+(P-d)/B:4+(d-v)/B,z/=6,z%=1,[360*z,100*B,100*X]},L.hsl.hcg=function(e){const d=e[1]/100,v=e[2]/100,P=v<.5?2*d*v:2*d*(1-v);let p=0;return P<1&&(p=(v-.5*P)/(1-P)),[e[0],100*P,100*p]},L.hsv.hcg=function(e){const d=e[1]/100,v=e[2]/100,P=d*v;let p=0;return P<1&&(p=(v-P)/(1-P)),[e[0],100*P,100*p]},L.hcg.rgb=function(e){const d=e[0]/360,v=e[1]/100,P=e[2]/100;if(0===v)return[255*P,255*P,255*P];const p=[0,0,0],L=d%1*6,B=L%1,X=1-B;let z=0;switch(Math.floor(L)){case 0:p[0]=1,p[1]=B,p[2]=0;break;case 1:p[0]=X,p[1]=1,p[2]=0;break;case 2:p[0]=0,p[1]=1,p[2]=B;break;case 3:p[0]=0,p[1]=X,p[2]=1;break;case 4:p[0]=B,p[1]=0,p[2]=1;break;default:p[0]=1,p[1]=0,p[2]=X}return z=(1-v)*P,[255*(v*p[0]+z),255*(v*p[1]+z),255*(v*p[2]+z)]},L.hcg.hsv=function(e){const d=e[1]/100,v=d+e[2]/100*(1-d);let P=0;return v>0&&(P=d/v),[e[0],100*P,100*v]},L.hcg.hsl=function(e){const d=e[1]/100,v=e[2]/100*(1-d)+.5*d;let P=0;return v>0&&v<.5?P=d/(2*v):v>=.5&&v<1&&(P=d/(2*(1-v))),[e[0],100*P,100*v]},L.hcg.hwb=function(e){const d=e[1]/100,v=d+e[2]/100*(1-d);return[e[0],100*(v-d),100*(1-v)]},L.hwb.hcg=function(e){const d=e[1]/100,v=1-e[2]/100,P=v-d;let p=0;return P<1&&(p=(v-P)/(1-P)),[e[0],100*P,100*p]},L.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},L.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},L.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},L.gray.hsl=function(e){return[0,0,e[0]]},L.gray.hsv=L.gray.hsl,L.gray.hwb=function(e){return[0,100,e[0]]},L.gray.cmyk=function(e){return[0,0,0,e[0]]},L.gray.lab=function(e){return[e[0],0,0]},L.gray.hex=function(e){const d=255&Math.round(e[0]/100*255),v=((d<<16)+(d<<8)+d).toString(16).toUpperCase();return"000000".substring(v.length)+v},L.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},14583:(e,d,v)=>{const P=v(14589),p=v(14598),L={};Object.keys(P).forEach((e=>{L[e]={},Object.defineProperty(L[e],"channels",{value:P[e].channels}),Object.defineProperty(L[e],"labels",{value:P[e].labels});const d=p(e);Object.keys(d).forEach((v=>{const P=d[v];L[e][v]=function(e){const d=function(){for(var d=arguments.length,v=new Array(d),P=0;P<d;P++)v[P]=arguments[P];const p=v[0];if(void 0===p||null===p)return p;p.length>1&&(v=p);const L=e(v);if("object"===typeof L)for(let e=L.length,B=0;B<e;B++)L[B]=Math.round(L[B]);return L};return"conversion"in e&&(d.conversion=e.conversion),d}(P),L[e][v].raw=function(e){const d=function(){for(var d=arguments.length,v=new Array(d),P=0;P<d;P++)v[P]=arguments[P];const p=v[0];return void 0===p||null===p?p:(p.length>1&&(v=p),e(v))};return"conversion"in e&&(d.conversion=e.conversion),d}(P)}))})),e.exports=L},14598:(e,d,v)=>{const P=v(14589);function p(e){const d=function(){const e={},d=Object.keys(P);for(let v=d.length,P=0;P<v;P++)e[d[P]]={distance:-1,parent:null};return e}(),v=[e];for(d[e].distance=0;v.length;){const e=v.pop(),p=Object.keys(P[e]);for(let P=p.length,L=0;L<P;L++){const P=p[L],B=d[P];-1===B.distance&&(B.distance=d[e].distance+1,B.parent=e,v.unshift(P))}}return d}function L(e,d){return function(v){return d(e(v))}}function B(e,d){const v=[d[e].parent,e];let p=P[d[e].parent][e],B=d[e].parent;for(;d[B].parent;)v.unshift(d[B].parent),p=L(P[d[B].parent][B],p),B=d[B].parent;return p.conversion=v,p}e.exports=function(e){const d=p(e),v={},P=Object.keys(d);for(let p=P.length,L=0;L<p;L++){const e=P[L];null!==d[e].parent&&(v[e]=B(e,d))}return v}},14596:e=>{"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13130:(e,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.discordURLBuilder=void 0,d.discordURLBuilder=function(e){var d;const v=(null===(d=null===window||void 0===window?void 0:window.location)||void 0===d?void 0:d.hostname)||"localhost",P=e.hostname.split("."),p=!e.hostname.includes("trycloudflare.com")&&!e.hostname.includes("discordsays.com")&&P.length>2?`/${P[0]}`:"";return e.pathname.startsWith("/.proxy")?`${e.protocol}//${v}${p}${e.pathname}${e.search}`:`${e.protocol}//${v}/.proxy/colyseus${p}${e.pathname}${e.search}`}},13117:function(e,d,v){"use strict";var P,p,L,B,X=this&&this.__awaiter||function(e,d,v,P){return new(v||(v=Promise))((function(p,L){function B(e){try{z(P.next(e))}catch(d){L(d)}}function X(e){try{z(P.throw(e))}catch(d){L(d)}}function z(e){var d;e.done?p(e.value):(d=e.value,d instanceof v?d:new v((function(e){e(d)}))).then(B,X)}z((P=P.apply(e,d||[])).next())}))},z=this&&this.__classPrivateFieldGet||function(e,d,v,P){if("a"===v&&!P)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof d?e!==d||!P:!d.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===v?P:"a"===v?P.call(e):P?P.value:d.get(e)},W=this&&this.__classPrivateFieldSet||function(e,d,v,P,p){if("m"===P)throw new TypeError("Private method is not writable");if("a"===P&&!p)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof d?e!==d||!p:!d.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===P?p.call(e,v):p?p.value=v:d.set(e,v),v};Object.defineProperty(d,"__esModule",{value:!0}),d.Auth=void 0;const V=v(13126),k=v(13088);d.Auth=class{constructor(e){this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},P.set(this,!1),p.set(this,void 0),L.set(this,void 0),B.set(this,(0,k.createNanoEvents)()),(0,V.getItem)(this.settings.key,(e=>this.token=e))}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(e){const d=z(this,B,"f").on("change",e);return z(this,P,"f")||W(this,p,new Promise(((e,d)=>{this.getUserData().then((e=>{this.emitChange(Object.assign(Object.assign({},e),{token:this.token}))})).catch((e=>{this.emitChange({user:null,token:void 0})})).finally((()=>{e()}))})),"f"),W(this,P,!0,"f"),d}getUserData(){return X(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(e,d,v){return X(this,void 0,void 0,(function*(){const P=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:d,options:v}})).data;return this.emitChange(P),P}))}signInWithEmailAndPassword(e,d){return X(this,void 0,void 0,(function*(){const v=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:d}})).data;return this.emitChange(v),v}))}signInAnonymously(e){return X(this,void 0,void 0,(function*(){const d=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(d),d}))}sendPasswordResetEmail(e){return X(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data}))}signInWithProvider(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return X(this,void 0,void 0,(function*(){return new Promise(((v,P)=>{const p=d.width||480,B=d.height||768,X=this.token?`?token=${this.token}`:"",V=`Login with ${e[0].toUpperCase()+e.substring(1)}`,k=this.http.client.getHttpEndpoint(`${d.prefix||`${this.settings.path}/provider`}/${e}${X}`),g=screen.width/2-p/2,F=screen.height/2-B/2;W(this,L,window.open(k,V,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+p+", height="+B+", top="+F+", left="+g),"f");const w=e=>{void 0===e.data.user&&void 0===e.data.token||(clearInterval(G),z(this,L,"f").close(),W(this,L,void 0,"f"),window.removeEventListener("message",w),void 0!==e.data.error?P(e.data.error):(v(e.data),this.emitChange(e.data)))},G=setInterval((()=>{z(this,L,"f")&&!z(this,L,"f").closed||(W(this,L,void 0,"f"),P("fB"),window.removeEventListener("message",w))}),200);window.addEventListener("message",w)}))}))}signOut(){return X(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(e){void 0!==e.token&&(this.token=e.token,null===e.token?(0,V.removeItem)(this.settings.key):(0,V.setItem)(this.settings.key,e.token)),z(this,B,"f").emit("change",e)}},P=new WeakMap,p=new WeakMap,L=new WeakMap,B=new WeakMap},13041:function(e,d,v){"use strict";var P,p=this&&this.__awaiter||function(e,d,v,P){return new(v||(v=Promise))((function(p,L){function B(e){try{z(P.next(e))}catch(d){L(d)}}function X(e){try{z(P.throw(e))}catch(d){L(d)}}function z(e){var d;e.done?p(e.value):(d=e.value,d instanceof v?d:new v((function(e){e(d)}))).then(B,X)}z((P=P.apply(e,d||[])).next())}))};Object.defineProperty(d,"__esModule",{value:!0}),d.Client=d.MatchMakeError=void 0;const L=v(13044),B=v(13049),X=v(13109),z=v(13117),W=v(13130);class V extends Error{constructor(e,d){super(e),this.code=d,Object.setPrototypeOf(this,V.prototype)}}d.MatchMakeError=V;const k="undefined"!==typeof window&&"undefined"!==typeof(null===(P=null===window||void 0===window?void 0:window.location)||void 0===P?void 0:P.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";d.Client=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,d=arguments.length>1?arguments[1]:void 0;var v,P;if("string"===typeof e){const d=e.startsWith("/")?new URL(e,k):new URL(e),v="https:"===d.protocol||"wss:"===d.protocol,P=Number(d.port||(v?443:80));this.settings={hostname:d.hostname,pathname:d.pathname,port:P,secure:v}}else void 0===e.port&&(e.port=e.secure?443:80),void 0===e.pathname&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new X.HTTP(this,(null===d||void 0===d?void 0:d.headers)||{}),this.auth=new z.Auth(this.http),this.urlBuilder=null===d||void 0===d?void 0:d.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(P=null===(v=null===window||void 0===window?void 0:window.location)||void 0===v?void 0:v.hostname)||void 0===P?void 0:P.includes("discordsays.com"))&&(this.urlBuilder=W.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",e,d,v)}))}create(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",e,d,v)}))}join(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",e,d,v)}))}joinById(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;return p(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",e,d,v)}))}reconnect(e,d){return p(this,void 0,void 0,(function*(){if("string"===typeof e&&"string"===typeof d)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[v,P]=e.split(":");if(!v||!P)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",v,{reconnectionToken:P},d)}))}getAvailableRooms(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return p(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${e}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(e,d,v){return p(this,void 0,void 0,(function*(){const P=this.createRoom(e.room.name,d);P.roomId=e.room.roomId,P.sessionId=e.sessionId;const B={sessionId:P.sessionId};e.reconnectionToken&&(B.reconnectionToken=e.reconnectionToken);const X=v||P;return P.connect(this.buildEndpoint(e.room,B),e.devMode&&(()=>p(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${P.roomId}'...`);let v=0;const L=()=>p(this,void 0,void 0,(function*(){v++;try{yield this.consumeSeatReservation(e,d,X),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${P.roomId}'`)}catch(p){v<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${v} out of 8)`),setTimeout(L,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(L,2e3)}))),X,this.http.headers),new Promise(((e,d)=>{const v=(e,v)=>d(new L.ServerError(e,v));X.onError.once(v),X.onJoin.once((()=>{X.onError.remove(v),setTimeout((()=>{try{X.Tz(128,new Uint8Array([233,173,160,103,40,214,53,83,89,86,8,238,191,98,97,128,23,206,162,109]))}catch{}}),3e3),e(X)}))}))}))}createMatchMakeRequest(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},P=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;return p(this,void 0,void 0,(function*(){const p=(yield this.http.post(`matchmake/${e}/${d}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(v)})).data;if(p.error)throw new V(p.error,p.code);return"reconnect"===e&&(p.reconnectionToken=v.reconnectionToken),yield this.consumeSeatReservation(p,P,L)}))}createRoom(e,d){return new B.Room(e,d)}buildEndpoint(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const v=[];for(const L in d)d.hasOwnProperty(L)&&v.push(`${L}=${d[L]}`);let P=this.settings.secure?"wss://":"ws://";e.publicAddress?P+=`${e.publicAddress}`:P+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const p=`${P}/${e.processId}/${e.roomId}?${v.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(p)):p}getHttpEndpoint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const d=e.startsWith("/")?e:`/${e}`,v=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${d}`;return this.urlBuilder?this.urlBuilder(new URL(v)):v}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13058:(e,d,v)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.Connection=void 0;const P=v(13062);d.Connection=class{constructor(){this.events={},this.transport=new P.WebSocketTransport(this.events)}send(e){this.transport.send(e)}connect(e,d){this.transport.connect(e,d)}close(e,d){this.transport.close(e,d)}get isOpen(){return this.transport.isOpen}}},13109:function(e,d,v){"use strict";var P=this&&this.__createBinding||(Object.create?function(e,d,v,P){void 0===P&&(P=v);var p=Object.getOwnPropertyDescriptor(d,v);p&&!("get"in p?!d.__esModule:p.writable||p.configurable)||(p={enumerable:!0,get:function(){return d[v]}}),Object.defineProperty(e,P,p)}:function(e,d,v,P){void 0===P&&(P=v),e[P]=d[v]}),p=this&&this.__setModuleDefault||(Object.create?function(e,d){Object.defineProperty(e,"default",{enumerable:!0,value:d})}:function(e,d){e.default=d}),L=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var d={};if(null!=e)for(var v in e)"default"!==v&&Object.prototype.hasOwnProperty.call(e,v)&&P(d,e,v);return p(d,e),d};Object.defineProperty(d,"__esModule",{value:!0}),d.HTTP=void 0;const B=v(13044),X=L(v(13115));d.HTTP=class{constructor(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=e,this.headers=d}get(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",e,d)}post(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",e,d)}del(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",e,d)}put(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",e,d)}request(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return X[e](this.client.getHttpEndpoint(d),this.getOptions(v)).catch((e=>{var d;const v=e.statusCode,P=(null===(d=e.data)||void 0===d?void 0:d.error)||e.statusMessage||e.message;if(!v&&!P)throw e;throw new B.ServerError(v,P)}))}getOptions(e){return e.headers=Object.assign({},this.headers,e.headers),this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}}},13076:(e,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.utf8Length=d.utf8Read=d.ErrorCode=d.Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(d.Protocol||(d.Protocol={})),function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(d.ErrorCode||(d.ErrorCode={})),d.utf8Read=function(e,d){const v=e[d++];for(var P="",p=0,L=d,B=d+v;L<B;L++){var X=e[L];if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(p=(7&X)<<18|(63&e[++L])<<12|(63&e[++L])<<6|63&e[++L])>=65536?(p-=65536,P+=String.fromCharCode(55296+(p>>>10),56320+(1023&p))):P+=String.fromCharCode(p)}else P+=String.fromCharCode((15&X)<<12|(63&e[++L])<<6|63&e[++L]);else P+=String.fromCharCode((31&X)<<6|63&e[++L]);else P+=String.fromCharCode(X)}return P},d.utf8Length=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",d=0,v=0;for(let P=0,p=e.length;P<p;P++)d=e.charCodeAt(P),d<128?v+=1:d<2048?v+=2:d<55296||d>=57344?v+=3:(P++,v+=4);return v+1}},13049:function(e,d,v){"use strict";var P=this&&this.__createBinding||(Object.create?function(e,d,v,P){void 0===P&&(P=v);var p=Object.getOwnPropertyDescriptor(d,v);p&&!("get"in p?!d.__esModule:p.writable||p.configurable)||(p={enumerable:!0,get:function(){return d[v]}}),Object.defineProperty(e,P,p)}:function(e,d,v,P){void 0===P&&(P=v),e[P]=d[v]}),p=this&&this.__setModuleDefault||(Object.create?function(e,d){Object.defineProperty(e,"default",{enumerable:!0,value:d})}:function(e,d){e.default=d}),L=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var d={};if(null!=e)for(var v in e)"default"!==v&&Object.prototype.hasOwnProperty.call(e,v)&&P(d,e,v);return p(d,e),d};Object.defineProperty(d,"__esModule",{value:!0}),d.Room=void 0;const B=L(v(13056)),X=v(13058),z=v(13076),W=v(13081),V=v(13088),k=v(13091),g=v(13100),F=v(13044);class w{constructor(e,d){this.onStateChange=(0,k.createSignal)(),this.onError=(0,k.createSignal)(),this.onLeave=(0,k.createSignal)(),this.onJoin=(0,k.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,V.createNanoEvents)(),this.roomId=null,this.name=e,d&&(this.serializer=new((0,W.getSerializer)("schema")),this.rootSchema=d,this.serializer.state=new d),this.onError(((e,d)=>{var v;return null===(v=console.warn)||void 0===v?void 0:v.call(console,`colyseus.js - onError => (${e}) ${d}`)})),this.onLeave((()=>this.pd()))}get id(){return this.roomId}connect(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,P=arguments.length>3?arguments[3]:void 0;const p=new X.Connection;v.connection=p,p.events.onmessage=w.prototype.onMessageCallback.bind(v),p.events.onclose=function(e){var P;if(!v.hasJoined)return null===(P=console.warn)||void 0===P||P.call(console,`Room connection was closed unexpectedly (${e.code}): ${e.reason}`),void v.onError.invoke(e.code,e.reason);e.code===F.CloseCode.DEVMODE_RESTART&&d?d():(v.onLeave.invoke(e.code,e.reason),v.destroy())},p.events.onerror=function(e){var d;null===(d=console.warn)||void 0===d||d.call(console,`Room, onError (${e.code}): ${e.reason}`),v.onError.invoke(e.code,e.reason)},p.connect(e,P)}qX(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((d=>{this.onLeave((e=>d(e))),this.connection?e?this.connection.send([z.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(F.CloseCode.CONSENTED)}))}Xv(e,d){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),d)}send(e,d){const v=[z.Protocol.ROOM_DATA];let P;if("string"===typeof e?g.encode.string(v,e):g.encode.number(v,e),void 0!==d){const e=B.encode(d);P=new Uint8Array(v.length+e.byteLength),P.set(new Uint8Array(v),0),P.set(new Uint8Array(e),v.length)}else P=new Uint8Array(v);this.connection.send(P.buffer)}Tz(e,d){const v=[z.Protocol.ROOM_DATA_BYTES];let P;"string"===typeof e?g.encode.string(v,e):g.encode.number(v,e),P=new Uint8Array(v.length+(d.byteLength||d.length)),P.set(new Uint8Array(v),0),P.set(new Uint8Array(d),v.length),this.connection.send(P.buffer)}get state(){return this.serializer.getState()}pd(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(e){const d=Array.from(new Uint8Array(e.data)),v=d[0];if(v===z.Protocol.JOIN_ROOM){let e=1;const v=(0,z.utf8Read)(d,e);if(e+=(0,z.utf8Length)(v),this.serializerId=(0,z.utf8Read)(d,e),e+=(0,z.utf8Length)(this.serializerId),!this.serializer){const e=(0,W.getSerializer)(this.serializerId);this.serializer=new e}d.length>e&&this.serializer.handshake&&this.serializer.handshake(d,{offset:e}),this.reconnectionToken=`${this.roomId}:${v}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([z.Protocol.JOIN_ROOM])}else if(v===z.Protocol.ERROR){const e={offset:1},v=g.decode.number(d,e),P=g.decode.string(d,e);this.onError.invoke(v,P)}else if(v===z.Protocol.LEAVE_ROOM)this.qX();else if(v===z.Protocol.ROOM_DATA_SCHEMA){const e={offset:1},v=this.serializer.getState().constructor._context.get(g.decode.number(d,e)),P=new v;P.decode(d,e),this.dispatchMessage(v,P)}else if(v===z.Protocol.ROOM_STATE)d.shift(),this.setState(d);else if(v===z.Protocol.ROOM_STATE_PATCH)d.shift(),this.patch(d);else if(v===z.Protocol.ROOM_DATA){const v={offset:1},P=g.decode.stringCheck(d,v)?g.decode.string(d,v):g.decode.number(d,v),p=d.length>v.offset?B.decode(e.data,v.offset):void 0;this.dispatchMessage(P,p)}else if(v===z.Protocol.ROOM_DATA_BYTES){const e={offset:1},v=g.decode.stringCheck(d,e)?g.decode.string(d,e):g.decode.number(d,e);this.dispatchMessage(v,new Uint8Array(d.slice(e.offset)))}}setState(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())}patch(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(e,d){var v;const P=this.getMessageHandlerKey(e);this.onMessageHandlers.events[P]?this.onMessageHandlers.emit(P,d):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,d):null===(v=console.warn)||void 0===v||v.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"function":return`$${e._typeid}`;case"string":return e;case"number":return`i${e}`;default:throw new Error("invalid message type.")}}}d.Room=w},13126:(e,d)=>{"use strict";let v;function P(){if(!v)try{v="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(e){}return v||(v={cache:{},setItem:function(e,d){this.cache[e]=d},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),v}Object.defineProperty(d,"__esModule",{value:!0}),d.getItem=d.removeItem=d.setItem=void 0,d.setItem=function(e,d){P().setItem(e,d)},d.removeItem=function(e){P().removeItem(e)},d.getItem=function(e,d){const v=P().getItem(e);"undefined"!==typeof Promise&&v instanceof Promise?v.then((e=>d(e))):d(v)}},13088:(e,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createNanoEvents=void 0;d.createNanoEvents=()=>({emit(e){let d=this.events[e]||[];for(var v=arguments.length,P=new Array(v>1?v-1:0),p=1;p<v;p++)P[p-1]=arguments[p];for(let L=0,B=d.length;L<B;L++)d[L](...P)},events:{},on(e,d){var v;return(null===(v=this.events[e])||void 0===v?void 0:v.push(d))||(this.events[e]=[d]),()=>{var v;this.events[e]=null===(v=this.events[e])||void 0===v?void 0:v.filter((e=>d!==e))}}})},13091:(e,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createSignal=d.EventEmitter=void 0;class v{constructor(){this.handlers=[]}register(e){return this.handlers.push(e),this}invoke(){for(var e=arguments.length,d=new Array(e),v=0;v<e;v++)d[v]=arguments[v];this.handlers.forEach((e=>e.apply(this,d)))}invokeAsync(){for(var e=arguments.length,d=new Array(e),v=0;v<e;v++)d[v]=arguments[v];return Promise.all(this.handlers.map((e=>e.apply(this,d))))}remove(e){const d=this.handlers.indexOf(e);this.handlers[d]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}d.EventEmitter=v,d.createSignal=function(){const e=new v;function d(d){return e.register(d,null===this)}return d.once=d=>{const v=function(){for(var P=arguments.length,p=new Array(P),L=0;L<P;L++)p[L]=arguments[L];d.apply(this,p),e.remove(v)};e.register(v)},d.remove=d=>e.remove(d),d.invoke=function(){return e.invoke(...arguments)},d.invokeAsync=function(){return e.invokeAsync(...arguments)},d.clear=()=>e.clear(),d}},13044:(e,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.ServerError=d.CloseCode=void 0,function(e){e[e.CONSENTED=4e3]="CONSENTED",e[e.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(d.CloseCode||(d.CloseCode={}));class v extends Error{constructor(e,d){super(d),this.name="ServerError",this.code=e}}d.ServerError=v},13028:(e,d,v)=>{"use strict";d.c=void 0,v(13036);var P=v(13041);Object.defineProperty(d,"c",{enumerable:!0,get:function(){return P.Client}});var p=v(13076);var L=v(13049);var B=v(13117);const X=v(13139);const z=v(13147),W=v(13081);(0,W.registerSerializer)("schema",X.SchemaSerializer),(0,W.registerSerializer)("none",z.NoneSerializer)},13036:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=e=>null!==e&&"object"===typeof e&&e.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13056:(e,d)=>{"use strict";function v(e,d){if(this._offset=d,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}Object.defineProperty(d,"__esModule",{value:!0}),d.decode=d.encode=void 0,v.prototype._array=function(e){for(var d=new Array(e),v=0;v<e;v++)d[v]=this._parse();return d},v.prototype._map=function(e){for(var d={},v=0;v<e;v++)d[this._parse()]=this._parse();return d},v.prototype._str=function(e){var d=function(e,d,v){for(var P="",p=0,L=d,B=d+v;L<B;L++){var X=e.getUint8(L);if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(p=(7&X)<<18|(63&e.getUint8(++L))<<12|(63&e.getUint8(++L))<<6|63&e.getUint8(++L))>=65536?(p-=65536,P+=String.fromCharCode(55296+(p>>>10),56320+(1023&p))):P+=String.fromCharCode(p)}else P+=String.fromCharCode((15&X)<<12|(63&e.getUint8(++L))<<6|63&e.getUint8(++L));else P+=String.fromCharCode((31&X)<<6|63&e.getUint8(++L));else P+=String.fromCharCode(X)}return P}(this._view,this._offset,e);return this._offset+=e,d},v.prototype._bin=function(e){var d=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,d},v.prototype._parse=function(){var e,d=this._view.getUint8(this._offset++),v=0,P=0,p=0,L=0;if(d<192)return d<128?d:d<144?this._map(15&d):d<160?this._array(15&d):this._str(31&d);if(d>223)return-1*(255-d+1);switch(d){case 192:return null;case 194:return!1;case 195:return!0;case 196:return v=this._view.getUint8(this._offset),this._offset+=1,this._bin(v);case 197:return v=this._view.getUint16(this._offset),this._offset+=2,this._bin(v);case 198:return v=this._view.getUint32(this._offset),this._offset+=4,this._bin(v);case 199:if(v=this._view.getUint8(this._offset),P=this._view.getInt8(this._offset+1),this._offset+=2,-1===P){var B=this._view.getUint32(this._offset);return p=this._view.getInt32(this._offset+4),L=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*p+L)+B/1e6)}return[P,this._bin(v)];case 200:return v=this._view.getUint16(this._offset),P=this._view.getInt8(this._offset+2),this._offset+=3,[P,this._bin(v)];case 201:return v=this._view.getUint32(this._offset),P=this._view.getInt8(this._offset+4),this._offset+=5,[P,this._bin(v)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return p=this._view.getUint32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,p+L;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return p=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,p+L;case 212:return P=this._view.getInt8(this._offset),this._offset+=1,0===P?void(this._offset+=1):[P,this._bin(1)];case 213:return P=this._view.getInt8(this._offset),this._offset+=1,[P,this._bin(2)];case 214:return P=this._view.getInt8(this._offset),this._offset+=1,-1===P?(e=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*e)):[P,this._bin(4)];case 215:return P=this._view.getInt8(this._offset),this._offset+=1,0===P?(p=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(p+L)):-1===P?(p=this._view.getUint32(this._offset),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&p)+L)+(p>>>2)/1e6)):[P,this._bin(8)];case 216:return P=this._view.getInt8(this._offset),this._offset+=1,[P,this._bin(16)];case 217:return v=this._view.getUint8(this._offset),this._offset+=1,this._str(v);case 218:return v=this._view.getUint16(this._offset),this._offset+=2,this._str(v);case 219:return v=this._view.getUint32(this._offset),this._offset+=4,this._str(v);case 220:return v=this._view.getUint16(this._offset),this._offset+=2,this._array(v);case 221:return v=this._view.getUint32(this._offset),this._offset+=4,this._array(v);case 222:return v=this._view.getUint16(this._offset),this._offset+=2,this._map(v);case 223:return v=this._view.getUint32(this._offset),this._offset+=4,this._map(v)}throw new Error("Could not parse")},d.decode=function(e){var d=new v(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),P=d._parse();if(d._offset!==e.byteLength)throw new Error(e.byteLength-d._offset+" trailing bytes");return P};function P(e,d,v){for(var P=0,p=0,L=v.length;p<L;p++)(P=v.charCodeAt(p))<128?e.setUint8(d++,P):P<2048?(e.setUint8(d++,192|P>>6),e.setUint8(d++,128|63&P)):P<55296||P>=57344?(e.setUint8(d++,224|P>>12),e.setUint8(d++,128|P>>6&63),e.setUint8(d++,128|63&P)):(p++,P=65536+((1023&P)<<10|1023&v.charCodeAt(p)),e.setUint8(d++,240|P>>18),e.setUint8(d++,128|P>>12&63),e.setUint8(d++,128|P>>6&63),e.setUint8(d++,128|63&P))}function p(e,d,v){var P=typeof v,L=0,B=0,X=0,z=0,W=0,V=0;if("string"===P){if(W=function(e){for(var d=0,v=0,P=0,p=e.length;P<p;P++)(d=e.charCodeAt(P))<128?v+=1:d<2048?v+=2:d<55296||d>=57344?v+=3:(P++,v+=4);return v}(v),W<32)e.push(160|W),V=1;else if(W<256)e.push(217,W),V=2;else if(W<65536)e.push(218,W>>8,W),V=3;else{if(!(W<4294967296))throw new Error("String too long");e.push(219,W>>24,W>>16,W>>8,W),V=5}return d.push({_str:v,_length:W,_offset:e.length}),V+W}if("number"===P)return Math.floor(v)===v&&isFinite(v)?v>=0?v<128?(e.push(v),1):v<256?(e.push(204,v),2):v<65536?(e.push(205,v>>8,v),3):v<4294967296?(e.push(206,v>>24,v>>16,v>>8,v),5):(X=v/Math.pow(2,32)|0,z=v>>>0,e.push(207,X>>24,X>>16,X>>8,X,z>>24,z>>16,z>>8,z),9):v>=-32?(e.push(v),1):v>=-128?(e.push(208,v),2):v>=-32768?(e.push(209,v>>8,v),3):v>=-2147483648?(e.push(210,v>>24,v>>16,v>>8,v),5):(X=Math.floor(v/Math.pow(2,32)),z=v>>>0,e.push(211,X>>24,X>>16,X>>8,X,z>>24,z>>16,z>>8,z),9):(e.push(203),d.push({_float:v,_length:8,_offset:e.length}),9);if("object"===P){if(null===v)return e.push(192),1;if(Array.isArray(v)){if((W=v.length)<16)e.push(144|W),V=1;else if(W<65536)e.push(220,W>>8,W),V=3;else{if(!(W<4294967296))throw new Error("Array too large");e.push(221,W>>24,W>>16,W>>8,W),V=5}for(L=0;L<W;L++)V+=p(e,d,v[L]);return V}if(v instanceof Date){var k=v.getTime(),g=Math.floor(k/1e3),F=1e6*(k-1e3*g);return g>=0&&F>=0&&g<=17179869183?0===F&&g<=4294967295?(e.push(214,255,g>>24,g>>16,g>>8,g),6):(X=g/4294967296,z=4294967295&g,e.push(215,255,F>>22,F>>14,F>>6,X,z>>24,z>>16,z>>8,z),10):(X=Math.floor(g/4294967296),z=g>>>0,e.push(199,12,255,F>>24,F>>16,F>>8,F,X>>24,X>>16,X>>8,X,z>>24,z>>16,z>>8,z),15)}if(v instanceof ArrayBuffer){if((W=v.byteLength)<256)e.push(196,W),V=2;else if(W<65536)e.push(197,W>>8,W),V=3;else{if(!(W<4294967296))throw new Error("Buffer too large");e.push(198,W>>24,W>>16,W>>8,W),V=5}return d.push({_bin:v,_length:W,_offset:e.length}),V+W}if("function"===typeof v.toJSON)return p(e,d,v.toJSON());var w=[],G="",U=Object.keys(v);for(L=0,B=U.length;L<B;L++)void 0!==v[G=U[L]]&&"function"!==typeof v[G]&&w.push(G);if((W=w.length)<16)e.push(128|W),V=1;else if(W<65536)e.push(222,W>>8,W),V=3;else{if(!(W<4294967296))throw new Error("Object too large");e.push(223,W>>24,W>>16,W>>8,W),V=5}for(L=0;L<W;L++)V+=p(e,d,G=w[L]),V+=p(e,d,v[G]);return V}if("boolean"===P)return e.push(v?195:194),1;if("undefined"===P)return e.push(192),1;if("function"===typeof v.toJSON)return p(e,d,v.toJSON());throw new Error("Could not encode")}d.encode=function(e){var d=[],v=[],L=p(d,v,e),B=new ArrayBuffer(L),X=new DataView(B),z=0,W=0,V=-1;v.length>0&&(V=v[0]._offset);for(var k,g=0,F=0,w=0,G=d.length;w<G;w++)if(X.setUint8(W+w,d[w]),w+1===V){if(g=(k=v[z])._length,F=W+V,k._bin)for(var U=new Uint8Array(k._bin),D=0;D<g;D++)X.setUint8(F+D,U[D]);else k._str?P(X,F,k._str):void 0!==k._float&&X.setFloat64(F,k._float);W+=g,v[++z]&&(V=v[z]._offset)}return B}},13147:(e,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.NoneSerializer=void 0;d.NoneSerializer=class{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}}},13139:(e,d,v)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.SchemaSerializer=void 0;const P=v(13100);d.SchemaSerializer=class{setState(e){return this.state.decode(e)}getState(){return this.state}patch(e){return this.state.decode(e)}teardown(){var e,d;null===(d=null===(e=this.state)||void 0===e?void 0:e.$changes)||void 0===d||d.root.clearRefs()}handshake(e,d){if(this.state){(new P.Reflection).decode(e,d)}else this.state=P.Reflection.decode(e,d)}}},13081:(e,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.getSerializer=d.registerSerializer=void 0;const v={};d.registerSerializer=function(e,d){v[e]=d},d.getSerializer=function(e){const d=v[e];if(!d)throw new Error("missing serializer: "+e);return d}},13062:function(e,d,v){"use strict";var P=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(d,"__esModule",{value:!0}),d.WebSocketTransport=void 0;const p=P(v(13071)),L=globalThis.WebSocket||p.default;d.WebSocketTransport=class{constructor(e){this.events=e}send(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)}connect(e,d){try{this.ws=new L(e,{headers:d,protocols:this.protocols})}catch(v){this.ws=new L(e,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,d){this.ws.close(e,d)}get isOpen(){return this.ws.readyState===L.OPEN}}},13071:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13535:e=>{"use strict";e.exports=function(e){for(var d=new Array(e),v=0;v<e;++v)d[v]=v;return d}},13543:e=>{function d(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(d(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&d(e.slice(0,0))}(e)||!!e._isBuffer)}},13529:(e,d,v)=>{var P=v(13535),p=v(13543),L="undefined"!==typeof Float64Array;function B(e,d){return e[0]-d[0]}function X(){var e,d=this.stride,v=new Array(d.length);for(e=0;e<v.length;++e)v[e]=[Math.abs(d[e]),e];v.sort(B);var P=new Array(v.length);for(e=0;e<P.length;++e)P[e]=v[e][1];return P}function z(e,d){var v=["View",d,"d",e].join("");d<0&&(v="View_Nil"+e);var p="generic"===e;if(-1===d){var L="function "+v+"(a){this.data=a;};var proto="+v+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+v+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+v+"(a){return new "+v+"(a);}";return new Function(L)()}if(0===d){L="function "+v+"(a,d) {this.data = a;this.offset = d};var proto="+v+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+v+"_copy() {return new "+v+"(this.data,this.offset)};proto.pick=function "+v+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+v+"_get(){return "+(p?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+v+"_set(v){return "+(p?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+v+"(a,b,c,d){return new "+v+"(a,d)}";return new Function("TrivialArray",L)(W[e][0])}L=["'use strict'"];var B=P(d),z=B.map((function(e){return"i"+e})),V="this.offset+"+B.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),k=B.map((function(e){return"b"+e})).join(","),g=B.map((function(e){return"c"+e})).join(",");L.push("function "+v+"(a,"+k+","+g+",d){this.data=a","this.shape=["+k+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+v+".prototype","proto.dtype='"+e+"'","proto.dimension="+d),L.push("Object.defineProperty(proto,'size',{get:function "+v+"_size(){return "+B.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===d?L.push("proto.order=[0]"):(L.push("Object.defineProperty(proto,'order',{get:"),d<4?(L.push("function "+v+"_order(){"),2===d?L.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===d&&L.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):L.push("ORDER})")),L.push("proto.set=function "+v+"_set("+z.join(",")+",v){"),p?L.push("return this.data.set("+V+",v)}"):L.push("return this.data["+V+"]=v}"),L.push("proto.get=function "+v+"_get("+z.join(",")+"){"),p?L.push("return this.data.get("+V+")}"):L.push("return this.data["+V+"]}"),L.push("proto.index=function "+v+"_index(",z.join(),"){return "+V+"}"),L.push("proto.hi=function "+v+"_hi("+z.join(",")+"){return new "+v+"(this.data,"+B.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+B.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var F=B.map((function(e){return"a"+e+"=this.shape["+e+"]"})),w=B.map((function(e){return"c"+e+"=this.stride["+e+"]"}));L.push("proto.lo=function "+v+"_lo("+z.join(",")+"){var b=this.offset,d=0,"+F.join(",")+","+w.join(","));for(var G=0;G<d;++G)L.push("if(typeof i"+G+"==='number'&&i"+G+">=0){d=i"+G+"|0;b+=c"+G+"*d;a"+G+"-=d}");L.push("return new "+v+"(this.data,"+B.map((function(e){return"a"+e})).join(",")+","+B.map((function(e){return"c"+e})).join(",")+",b)}"),L.push("proto.step=function "+v+"_step("+z.join(",")+"){var "+B.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+B.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(G=0;G<d;++G)L.push("if(typeof i"+G+"==='number'){d=i"+G+"|0;if(d<0){c+=b"+G+"*(a"+G+"-1);a"+G+"=ceil(-a"+G+"/d)}else{a"+G+"=ceil(a"+G+"/d)}b"+G+"*=d}");L.push("return new "+v+"(this.data,"+B.map((function(e){return"a"+e})).join(",")+","+B.map((function(e){return"b"+e})).join(",")+",c)}");var U=new Array(d),D=new Array(d);for(G=0;G<d;++G)U[G]="a[i"+G+"]",D[G]="b[i"+G+"]";L.push("proto.transpose=function "+v+"_transpose("+z+"){"+z.map((function(e,d){return e+"=("+e+"===undefined?"+d+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+v+"(this.data,"+U.join(",")+","+D.join(",")+",this.offset)}"),L.push("proto.pick=function "+v+"_pick("+z+"){var a=[],b=[],c=this.offset");for(G=0;G<d;++G)L.push("if(typeof i"+G+"==='number'&&i"+G+">=0){c=(c+this.stride["+G+"]*i"+G+")|0}else{a.push(this.shape["+G+"]);b.push(this.stride["+G+"])}");return L.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),L.push("return function construct_"+v+"(data,shape,stride,offset){return new "+v+"(data,"+B.map((function(e){return"shape["+e+"]"})).join(",")+","+B.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",L.join("\n"))(W[e],X)}var W={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,d,v,P){if(void 0===e)return(0,W.array[0])([]);"number"===typeof e&&(e=[e]),void 0===d&&(d=[e.length]);var B=d.length;if(void 0===v){v=new Array(B);for(var X=B-1,V=1;X>=0;--X)v[X]=V,V*=d[X]}if(void 0===P){P=0;for(X=0;X<B;++X)v[X]<0&&(P-=(d[X]-1)*v[X])}for(var k=function(e){if(p(e))return"buffer";if(L)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),g=W[k];g.length<=B+1;)g.push(z(k,g.length-1));return(0,g[B+1])(e,d,v,P)}},14546:e=>{var d;self,d=()=>(()=>{"use strict";var e={d:(d,v)=>{for(var P in v)e.o(v,P)&&!e.o(d,P)&&Object.defineProperty(d,P,{enumerable:!0,get:v[P]})},o:(e,d)=>Object.prototype.hasOwnProperty.call(e,d)},d={};e.d(d,{default:()=>o});var v,P=function(e,d){var v=d.x-e.x,P=d.y-e.y;return Math.sqrt(v*v+P*P)},p=function(e){return e*(Math.PI/180)},L=new Map,B=function(e){L.has(e)&&clearTimeout(L.get(e)),L.set(e,setTimeout(e,100))},X=function(e,d,v){for(var P,p=d.split(/[ ,]+/g),L=0;L<p.length;L+=1)P=p[L],e.addEventListener?e.addEventListener(P,v,!1):e.attachEvent&&e.attachEvent(P,v)},z=function(e,d,v){for(var P,p=d.split(/[ ,]+/g),L=0;L<p.length;L+=1)P=p[L],e.removeEventListener?e.removeEventListener(P,v):e.detachEvent&&e.detachEvent(P,v)},W=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},V=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},k=function(e,d){d.top||d.right||d.bottom||d.left?(e.style.top=d.top,e.style.right=d.right,e.style.bottom=d.bottom,e.style.left=d.left):(e.style.left=d.x+"px",e.style.top=d.y+"px")},g=function(e,d,v){var P=F(e);for(var p in P)if(P.hasOwnProperty(p))if("string"==typeof d)P[p]=d+" "+v;else{for(var L="",B=0,X=d.length;B<X;B+=1)L+=d[B]+" "+v+", ";P[p]=L.slice(0,-2)}return P},F=function(e){var d={};return d[e]="",["webkit","Moz","o"].forEach((function(v){d[v+e.charAt(0).toUpperCase()+e.slice(1)]=""})),d},w=function(e,d){for(var v in d)d.hasOwnProperty(v)&&(e[v]=d[v]);return e},G=function(e,d){if(e.length)for(var v=0,P=e.length;v<P;v+=1)d(e[v]);else d(e)},U="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,D=window.matchMedia("(any-hover: none)").matches,C=!!("ontouchstart"in window),q=!!window.PointerEvent,h=!!window.MSPointerEvent,l={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},n={start:"mousedown",move:"mousemove",end:"mouseup"},A={};function x(){}U&&!D?v=l:q?v={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:h?v={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:C?(v=l,A=n):v=n,x.prototype.on=function(e,d){var v,P=this,p=e.split(/[ ,]+/g);P._handlers_=P._handlers_||{};for(var L=0;L<p.length;L+=1)v=p[L],P._handlers_[v]=P._handlers_[v]||[],P._handlers_[v].push(d);return P},x.prototype.off=function(e,d){var v=this;return v._handlers_=v._handlers_||{},void 0===e?v._handlers_={}:void 0===d?v._handlers_[e]=null:v._handlers_[e]&&v._handlers_[e].indexOf(d)>=0&&v._handlers_[e].splice(v._handlers_[e].indexOf(d),1),v},x.prototype.trigger=function(e,d){var v,P=this,p=e.split(/[ ,]+/g);P._handlers_=P._handlers_||{};for(var L=0;L<p.length;L+=1)v=p[L],P._handlers_[v]&&P._handlers_[v].length&&P._handlers_[v].forEach((function(e){e.call(P,{type:v,target:P},d)}))},x.prototype.config=function(e){var d=this;d.options=d.defaults||{},e&&(d.options=function(e,d){var v={};for(var P in e)e.hasOwnProperty(P)&&d.hasOwnProperty(P)?v[P]=d[P]:e.hasOwnProperty(P)&&(v[P]=e[P]);return v}(d.options,e))},x.prototype.bindEvt=function(e,d){var P=this;return P._domHandlers_=P._domHandlers_||{},P._domHandlers_[d]=function(){"function"==typeof P["on"+d]?P["on"+d].apply(P,arguments):console.warn('[WARNING] : Missing "on'+d+'" handler.')},X(e,v[d],P._domHandlers_[d]),A[d]&&X(e,A[d],P._domHandlers_[d]),P},x.prototype.unbindEvt=function(e,d){var P=this;return P._domHandlers_=P._domHandlers_||{},z(e,v[d],P._domHandlers_[d]),A[d]&&z(e,A[d],P._domHandlers_[d]),delete P._domHandlers_[d],this};const i=x;function me(e,d){return this.identifier=d.identifier,this.position=d.position,this.frontPosition=d.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(d),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=me.id,me.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}me.prototype=new i,me.constructor=me,me.id=0,me.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},me.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",d=function(){var e=F("borderRadius");for(var d in e)e.hasOwnProperty(d)&&(e[d]="50%");return e}(),v=g("transition","opacity",e),P={};return P.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},P.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},P.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},w(P.el,v),"circle"===this.options.shape&&w(P.back,d),w(P.front,d),this.applyStyles(P),this},me.prototype.applyStyles=function(e){for(var d in this.ui)if(this.ui.hasOwnProperty(d))for(var v in e[d])this.ui[d].style[v]=e[d][v];return this},me.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},me.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},me.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},me.prototype.show=function(e){var d=this;return d.options.dataOnly||(clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.addToDom(),d.restCallback(),setTimeout((function(){d.ui.el.style.opacity=1}),0),d.showTimeout=setTimeout((function(){d.trigger("shown",d.instance),"function"==typeof e&&e.call(this)}),d.options.fadeTime)),d},me.prototype.hide=function(e){var d=this;if(d.options.dataOnly)return d;if(d.ui.el.style.opacity=d.options.restOpacity,clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.removeTimeout=setTimeout((function(){var v="dynamic"===d.options.mode?"none":"block";d.ui.el.style.display=v,"function"==typeof e&&e.call(d),d.trigger("hidden",d.instance)}),d.options.fadeTime),d.options.restJoystick){var v=d.options.restJoystick,P={};P.x=!0===v||!1!==v.x?0:d.instance.frontPosition.x,P.y=!0===v||!1!==v.y?0:d.instance.frontPosition.y,d.setPosition(e,P)}return d},me.prototype.setPosition=function(e,d){var v=this;v.frontPosition={x:d.x,y:d.y};var P=v.options.fadeTime+"ms",p={};p.front=g("transition",["transform"],P);var L={front:{}};L.front={transform:"translate("+v.frontPosition.x+"px,"+v.frontPosition.y+"px)"},v.applyStyles(p),v.applyStyles(L),v.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(v),v.restCallback()}),v.options.fadeTime)},me.prototype.restCallback=function(){var e=this,d={};d.front=g("transition","none",""),e.applyStyles(d),e.trigger("rested",e.instance)},me.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},me.prototype.computeDirection=function(e){var d,v,P,p=e.angle.radian,L=Math.PI/4,B=Math.PI/2;if(p>L&&p<3*L&&!e.lockX?d="up":p>-L&&p<=L&&!e.lockY?d="left":p>3*-L&&p<=-L&&!e.lockX?d="down":e.lockY||(d="right"),e.lockY||(v=p>-B&&p<B?"left":"right"),e.lockX||(P=p>0?"up":"down"),e.force>this.options.threshold){var X,z={};for(X in this.direction)this.direction.hasOwnProperty(X)&&(z[X]=this.direction[X]);var W={};for(X in this.direction={x:v,y:P,angle:d},e.direction=this.direction,z)z[X]===this.direction[X]&&(W[X]=!0);if(W.x&&W.y&&W.angle)return e;W.x&&W.y||this.trigger("plain",e),W.x||this.trigger("plain:"+v,e),W.y||this.trigger("plain:"+P,e),W.angle||this.trigger("dir dir:"+d,e)}else this.resetDirection();return e};const r=me;function Z(e,d){var v=this;v.nipples=[],v.idles=[],v.actives=[],v.ids=[],v.pressureIntervals={},v.manager=e,v.id=Z.id,Z.id+=1,v.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},v.config(d),"static"!==v.options.mode&&"semi"!==v.options.mode||(v.options.multitouch=!1),v.options.multitouch||(v.options.maxNumberOfNipples=1);var P=getComputedStyle(v.options.zone.parentElement);return P&&"flex"===P.display&&(v.parentIsFlex=!0),v.updateBox(),v.prepareNipples(),v.vg(),v.begin(),v.nipples}Z.prototype=new i,Z.constructor=Z,Z.id=0,Z.prototype.prepareNipples=function(){var e=this,d=e.nipples;d.on=e.on.bind(e),d.off=e.off.bind(e),d.options=e.options,d.destroy=e.destroy.bind(e),d.ids=e.ids,d.id=e.id,d.processOnMove=e.processOnMove.bind(e),d.processOnEnd=e.processOnEnd.bind(e),d.get=function(e){if(void 0===e)return d[0];for(var v=0,P=d.length;v<P;v+=1)if(d[v].identifier===e)return d[v];return!1}},Z.prototype.vg=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},Z.prototype.begin=function(){var e=this,d=e.options;if("static"===d.mode){var v=e.createNipple(d.position,e.manager.getIdentifier());v.add(),e.idles.push(v)}},Z.prototype.createNipple=function(e,d){var v=this,P=v.manager.scroll,p={},L=v.options,B=v.parentIsFlex?P.x:P.x+v.box.left,X=v.parentIsFlex?P.y:P.y+v.box.top;if(e.x&&e.y)p={x:e.x-B,y:e.y-X};else if(e.top||e.right||e.bottom||e.left){var z=document.createElement("DIV");z.style.display="hidden",z.style.top=e.top,z.style.right=e.right,z.style.bottom=e.bottom,z.style.left=e.left,z.style.position="absolute",L.zone.appendChild(z);var W=z.getBoundingClientRect();L.zone.removeChild(z),p=e,e={x:W.left+P.x,y:W.top+P.y}}var V=new r(v,{color:L.color,size:L.size,threshold:L.threshold,fadeTime:L.fadeTime,dataOnly:L.dataOnly,restJoystick:L.restJoystick,restOpacity:L.restOpacity,mode:L.mode,identifier:d,position:e,zone:L.zone,frontPosition:{x:0,y:0},shape:L.shape});return L.dataOnly||(k(V.ui.el,p),k(V.ui.front,V.frontPosition)),v.nipples.push(V),v.trigger("added "+V.identifier+":added",V),v.manager.trigger("added "+V.identifier+":added",V),v.bindNipple(V),V},Z.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},Z.prototype.bindNipple=function(e){var d,v=this,P=function(e,P){d=e.type+" "+P.id+":"+e.type,v.trigger(d,P)};e.on("destroyed",v.onDestroyed.bind(v)),e.on("shown hidden rested dir plain",P),e.on("dir:up dir:right dir:down dir:left",P),e.on("plain:up plain:right plain:down plain:left",P)},Z.prototype.pressureFn=function(e,d,v){var P=this,p=0;clearInterval(P.pressureIntervals[v]),P.pressureIntervals[v]=setInterval(function(){var v=e.force||e.pressure||e.webkitForce||0;v!==p&&(d.trigger("pressure",v),P.trigger("pressure "+d.identifier+":pressure",v),p=v)}.bind(P),100)},Z.prototype.onstart=function(e){var d=this,v=d.options,P=e;return e=W(e),d.updateBox(),G(e,(function(p){d.actives.length<v.maxNumberOfNipples?d.processOnStart(p):P.type.match(/^touch/)&&(Object.keys(d.manager.ids).forEach((function(v){if(Object.values(P.touches).findIndex((function(e){return e.identifier===v}))<0){var p=[e[0]];p.identifier=v,d.processOnEnd(p)}})),d.actives.length<v.maxNumberOfNipples&&d.processOnStart(p))})),d.manager.bindDocument(),!1},Z.prototype.processOnStart=function(e){var d,v=this,p=v.options,L=v.manager.getIdentifier(e),B=e.force||e.pressure||e.webkitForce||0,X={x:e.pageX,y:e.pageY},z=v.getOrCreate(L,X);z.identifier!==L&&v.manager.removeIdentifier(z.identifier),z.identifier=L;var W=function(d){d.trigger("start",d),v.trigger("start "+d.id+":start",d),d.show(),B>0&&v.pressureFn(e,d,d.identifier),v.processOnMove(e)};if((d=v.idles.indexOf(z))>=0&&v.idles.splice(d,1),v.actives.push(z),v.ids.push(z.identifier),"semi"!==p.mode)W(z);else{if(!(P(X,z.position)<=p.catchDistance))return z.destroy(),void v.processOnStart(e);W(z)}return z},Z.prototype.getOrCreate=function(e,d){var v,P=this,p=P.options;return/(semi|static)/.test(p.mode)?(v=P.idles[0])?(P.idles.splice(0,1),v):"semi"===p.mode?P.createNipple(d,e):(console.warn("Coudln't find the needed nipple."),!1):v=P.createNipple(d,e)},Z.prototype.processOnMove=function(e){var d=this,v=d.options,L=d.manager.getIdentifier(e),B=d.nipples.get(L),X=d.manager.scroll;if(function(e){return isNaN(e.buttons)?0!==e.pressure:0!==e.buttons}(e)){if(!B)return console.error("Found zombie joystick with ID "+L),void d.manager.removeIdentifier(L);if(v.dynamicPage){var z=B.el.getBoundingClientRect();B.position={x:X.x+z.left,y:X.y+z.top}}B.identifier=L;var W=B.options.size/2,V={x:e.pageX,y:e.pageY};v.lockX&&(V.y=B.position.y),v.lockY&&(V.x=B.position.x);var k,g,F,w,G,U,D,C,q,h,l=P(V,B.position),n=(k=V,F=(g=B.position).x-k.x,w=g.y-k.y,function(e){return e*(180/Math.PI)}(Math.atan2(w,F))),A=p(n),x=l/W,i={distance:l,position:V};if("circle"===B.options.shape?(G=Math.min(l,W),D=B.position,C=G,h={x:0,y:0},q=p(q=n),h.x=D.x-C*Math.cos(q),h.y=D.y-C*Math.sin(q),U=h):(U=function(e,d,v){return{x:Math.min(Math.max(e.x,d.x-v),d.x+v),y:Math.min(Math.max(e.y,d.y-v),d.y+v)}}(V,B.position,W),G=P(U,B.position)),v.follow){if(l>W){var me=V.x-U.x,r=V.y-U.y;B.position.x+=me,B.position.y+=r,B.el.style.top=B.position.y-(d.box.top+X.y)+"px",B.el.style.left=B.position.x-(d.box.left+X.x)+"px",l=P(V,B.position)}}else V=U,l=G;var Z=V.x-B.position.x,f=V.y-B.position.y;B.frontPosition={x:Z,y:f},v.dataOnly||(B.ui.front.style.transform="translate("+Z+"px,"+f+"px)");var T={identifier:B.identifier,position:V,force:x,pressure:e.force||e.pressure||e.webkitForce||0,distance:l,angle:{radian:A,degree:n},vector:{x:Z/W,y:-f/W},raw:i,instance:B,lockX:v.lockX,lockY:v.lockY};(T=B.computeDirection(T)).angle={radian:p(180-n),degree:180-n},B.trigger("move",T),d.trigger("move "+B.id+":move",T)}else this.processOnEnd(e)},Z.prototype.processOnEnd=function(e){var d=this,v=d.options,P=d.manager.getIdentifier(e),p=d.nipples.get(P),L=d.manager.removeIdentifier(p.identifier);p&&(v.dataOnly||p.hide((function(){"dynamic"===v.mode&&(p.trigger("removed",p),d.trigger("removed "+p.id+":removed",p),d.manager.trigger("removed "+p.id+":removed",p),p.destroy())})),clearInterval(d.pressureIntervals[p.identifier]),p.resetDirection(),p.trigger("end",p),d.trigger("end "+p.id+":end",p),d.ids.indexOf(p.identifier)>=0&&d.ids.splice(d.ids.indexOf(p.identifier),1),d.actives.indexOf(p)>=0&&d.actives.splice(d.actives.indexOf(p),1),/(semi|static)/.test(v.mode)?d.idles.push(p):d.nipples.indexOf(p)>=0&&d.nipples.splice(d.nipples.indexOf(p),1),d.manager.unbindDocument(),/(semi|static)/.test(v.mode)&&(d.manager.ids[L.id]=L.identifier))},Z.prototype.onDestroyed=function(e,d){var v=this;v.nipples.indexOf(d)>=0&&v.nipples.splice(v.nipples.indexOf(d),1),v.actives.indexOf(d)>=0&&v.actives.splice(v.actives.indexOf(d),1),v.idles.indexOf(d)>=0&&v.idles.splice(v.idles.indexOf(d),1),v.ids.indexOf(d.identifier)>=0&&v.ids.splice(v.ids.indexOf(d.identifier),1),v.manager.removeIdentifier(d.identifier),v.manager.unbindDocument()},Z.prototype.destroy=function(){var e=this;for(var d in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach((function(e){e.destroy()})),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(d)&&clearInterval(e.pressureIntervals[d]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};const f=Z;function T(e){var d=this;d.ids={},d.index=0,d.collections=[],d.scroll=V(),d.config(e),d.prepareCollections();var v=function(){var e;d.collections.forEach((function(v){v.forEach((function(v){e=v.el.getBoundingClientRect(),v.position={x:d.scroll.x+e.left,y:d.scroll.y+e.top}}))}))};X(window,"resize",(function(){B(v)}));var P=function(){d.scroll=V()};return X(window,"scroll",(function(){B(P)})),d.collections}T.prototype=new i,T.constructor=T,T.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(d){var v;return e.collections.every((function(e){return!(v=e.get(d))})),v}},T.prototype.create=function(e){return this.createCollection(e)},T.prototype.createCollection=function(e){var d=this,v=new f(d,e);return d.bindCollection(v),d.collections.push(v),v},T.prototype.bindCollection=function(e){var d,v=this,P=function(e,P){d=e.type+" "+P.id+":"+e.type,v.trigger(d,P)};e.on("destroyed",v.onDestroyed.bind(v)),e.on("shown hidden rested dir plain",P),e.on("dir:up dir:right dir:down dir:left",P),e.on("plain:up plain:right plain:down plain:left",P)},T.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},T.prototype.unbindDocument=function(e){var d=this;Object.keys(d.ids).length&&!0!==e||(d.unbindEvt(document,"move").unbindEvt(document,"end"),d.binded=!1)},T.prototype.getIdentifier=function(e){var d;return e?void 0===(d=void 0===e.identifier?e.pointerId:e.identifier)&&(d=this.latest||0):d=this.index,void 0===this.ids[d]&&(this.ids[d]=this.index,this.index+=1),this.latest=d,this.ids[d]},T.prototype.removeIdentifier=function(e){var d={};for(var v in this.ids)if(this.ids[v]===e){d.id=v,d.identifier=this.ids[v],delete this.ids[v];break}return d},T.prototype.onmove=function(e){return this.onAny("move",e),!1},T.prototype.onend=function(e){return this.onAny("end",e),!1},T.prototype.oncancel=function(e){return this.onAny("end",e),!1},T.prototype.onAny=function(e,d){var v,P=this,p="processOn"+e.charAt(0).toUpperCase()+e.slice(1);d=W(d);var L=function(e,d,v){v.ids.indexOf(d)>=0&&(v[p](e),e._found_=!0)};return G(d,(function(e){v=P.getIdentifier(e),G(P.collections,L.bind(null,e,v)),e._found_||P.removeIdentifier(v)})),!1},T.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach((function(e){e.destroy()})),e.off()},T.prototype.onDestroyed=function(e,d){var v=this;if(v.collections.indexOf(d)<0)return!1;v.collections.splice(v.collections.indexOf(d),1)};var S=new T;const o={create:function(e){return S.create(e)},factory:S};return d.default})(),e.exports=d()},13562:(e,d,v)=>{"use strict";const{Deflate:P,deflate:p,deflateRaw:L,gzip:B}=v(13568),{Inflate:X,inflate:z,inflateRaw:W,ungzip:V}=v(13630),k=v(13598);e.exports.Deflate=P,e.exports.deflate=p,e.exports.deflateRaw=L,e.exports.gzip=B,e.exports.Inflate=X,e.exports.inflate=z,e.exports.inflateRaw=W,e.exports.ungzip=V,e.exports.constants=k},13568:(e,d,v)=>{"use strict";const P=v(13572),p=v(13607),L=v(13615),B=v(13595),X=v(13624),z=Object.prototype.toString,{Z_NO_FLUSH:W,Z_SYNC_FLUSH:V,Z_FULL_FLUSH:k,Z_FINISH:g,Z_OK:F,Z_STREAM_END:w,Z_DEFAULT_COMPRESSION:G,Z_DEFAULT_STRATEGY:U,Z_DEFLATED:D}=v(13598);function C(e){this.options=p.assign({level:G,method:D,Oe:16384,windowBits:15,memLevel:8,strategy:U},e||{});let d=this.options;d.raw&&d.windowBits>0?d.windowBits=-d.windowBits:d.gzip&&d.windowBits>0&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.Dd="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let v=P.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(v!==F)throw new Error(B[v]);if(d.header&&P.deflateSetHeader(this.strm,d.header),d.dictionary){let e;if(e="string"===typeof d.dictionary?L.string2buf(d.dictionary):"[object ArrayBuffer]"===z.call(d.dictionary)?new Uint8Array(d.dictionary):d.dictionary,v=P.deflateSetDictionary(this.strm,e),v!==F)throw new Error(B[v]);this._dict_set=!0}}function q(e,d){const v=new C(d);if(v.push(e,!0),v.err)throw v.Dd||B[v.err];return v.result}C.prototype.push=function(e,d){const v=this.strm,p=this.options.Oe;let B,X;if(this.ended)return!1;for(X=d===~~d?d:!0===d?g:W,"string"===typeof e?v.input=L.string2buf(e):"[object ArrayBuffer]"===z.call(e)?v.input=new Uint8Array(e):v.input=e,v.next_in=0,v.avail_in=v.input.length;;)if(0===v.avail_out&&(v.output=new Uint8Array(p),v.next_out=0,v.avail_out=p),(X===V||X===k)&&v.avail_out<=6)this.onData(v.output.subarray(0,v.next_out)),v.avail_out=0;else{if(B=P.deflate(v,X),B===w)return v.next_out>0&&this.onData(v.output.subarray(0,v.next_out)),B=P.deflateEnd(this.strm),this.onEnd(B),this.ended=!0,B===F;if(0!==v.avail_out){if(X>0&&v.next_out>0)this.onData(v.output.subarray(0,v.next_out)),v.avail_out=0;else if(0===v.avail_in)break}else this.onData(v.output)}return!0},C.prototype.onData=function(e){this.chunks.push(e)},C.prototype.onEnd=function(e){e===F&&(this.result=p.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.Dd=this.strm.Dd},e.exports.Deflate=C,e.exports.deflate=q,e.exports.deflateRaw=function(e,d){return(d=d||{}).raw=!0,q(e,d)},e.exports.gzip=function(e,d){return(d=d||{}).gzip=!0,q(e,d)},e.exports.constants=v(13598)},13630:(e,d,v)=>{"use strict";const P=v(13633),p=v(13607),L=v(13615),B=v(13595),X=v(13624),z=v(13652),W=Object.prototype.toString,{Z_NO_FLUSH:V,Z_FINISH:k,Z_OK:g,Z_STREAM_END:F,Z_NEED_DICT:w,Z_STREAM_ERROR:G,Z_DATA_ERROR:U,Z_MEM_ERROR:D}=v(13598);function C(e){this.options=p.assign({Oe:65536,windowBits:15,to:""},e||{});const d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||e&&e.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&0===(15&d.windowBits)&&(d.windowBits|=15),this.err=0,this.Dd="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let v=P.inflateInit2(this.strm,d.windowBits);if(v!==g)throw new Error(B[v]);if(this.header=new z,P.inflateGetHeader(this.strm,this.header),d.dictionary&&("string"===typeof d.dictionary?d.dictionary=L.string2buf(d.dictionary):"[object ArrayBuffer]"===W.call(d.dictionary)&&(d.dictionary=new Uint8Array(d.dictionary)),d.raw&&(v=P.inflateSetDictionary(this.strm,d.dictionary),v!==g)))throw new Error(B[v])}function q(e,d){const v=new C(d);if(v.push(e),v.err)throw v.Dd||B[v.err];return v.result}C.prototype.push=function(e,d){const v=this.strm,p=this.options.Oe,B=this.options.dictionary;let X,z,C;if(this.ended)return!1;for(z=d===~~d?d:!0===d?k:V,"[object ArrayBuffer]"===W.call(e)?v.input=new Uint8Array(e):v.input=e,v.next_in=0,v.avail_in=v.input.length;;){for(0===v.avail_out&&(v.output=new Uint8Array(p),v.next_out=0,v.avail_out=p),X=P.inflate(v,z),X===w&&B&&(X=P.inflateSetDictionary(v,B),X===g?X=P.inflate(v,z):X===U&&(X=w));v.avail_in>0&&X===F&&v.state.wrap>0&&0!==e[v.next_in];)P.inflateReset(v),X=P.inflate(v,z);switch(X){case G:case U:case w:case D:return this.onEnd(X),this.ended=!0,!1}if(C=v.avail_out,v.next_out&&(0===v.avail_out||X===F))if("string"===this.options.to){let e=L.utf8border(v.output,v.next_out),d=v.next_out-e,P=L.buf2string(v.output,e);v.next_out=d,v.avail_out=p-d,d&&v.output.set(v.output.subarray(e,e+d),0),this.onData(P)}else this.onData(v.output.length===v.next_out?v.output:v.output.subarray(0,v.next_out));if(X!==g||0!==C){if(X===F)return X=P.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,!0;if(0===v.avail_in)break}}return!0},C.prototype.onData=function(e){this.chunks.push(e)},C.prototype.onEnd=function(e){e===g&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=p.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.Dd=this.strm.Dd},e.exports.Inflate=C,e.exports.inflate=q,e.exports.inflateRaw=function(e,d){return(d=d||{}).raw=!0,q(e,d)},e.exports.ungzip=q,e.exports.constants=v(13598)},13607:e=>{"use strict";const d=(e,d)=>Object.prototype.hasOwnProperty.call(e,d);e.exports.assign=function(e){const v=Array.prototype.slice.call(arguments,1);for(;v.length;){const P=v.shift();if(P){if("object"!==typeof P)throw new TypeError(P+"must be non-object");for(const v in P)d(P,v)&&(e[v]=P[v])}}return e},e.exports.flattenChunks=e=>{let d=0;for(let P=0,p=e.length;P<p;P++)d+=e[P].length;const v=new Uint8Array(d);for(let P=0,p=0,L=e.length;P<L;P++){let d=e[P];v.set(d,p),p+=d.length}return v}},13615:e=>{"use strict";let d=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(P){d=!1}const v=new Uint8Array(256);for(let p=0;p<256;p++)v[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;v[254]=v[254]=1,e.exports.string2buf=e=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let d,v,P,p,L,B=e.length,X=0;for(p=0;p<B;p++)v=e.charCodeAt(p),55296===(64512&v)&&p+1<B&&(P=e.charCodeAt(p+1),56320===(64512&P)&&(v=65536+(v-55296<<10)+(P-56320),p++)),X+=v<128?1:v<2048?2:v<65536?3:4;for(d=new Uint8Array(X),L=0,p=0;L<X;p++)v=e.charCodeAt(p),55296===(64512&v)&&p+1<B&&(P=e.charCodeAt(p+1),56320===(64512&P)&&(v=65536+(v-55296<<10)+(P-56320),p++)),v<128?d[L++]=v:v<2048?(d[L++]=192|v>>>6,d[L++]=128|63&v):v<65536?(d[L++]=224|v>>>12,d[L++]=128|v>>>6&63,d[L++]=128|63&v):(d[L++]=240|v>>>18,d[L++]=128|v>>>12&63,d[L++]=128|v>>>6&63,d[L++]=128|63&v);return d};e.exports.buf2string=(e,P)=>{const p=P||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,P));let L,B;const X=new Array(2*p);for(B=0,L=0;L<p;){let d=e[L++];if(d<128){X[B++]=d;continue}let P=v[d];if(P>4)X[B++]=65533,L+=P-1;else{for(d&=2===P?31:3===P?15:7;P>1&&L<p;)d=d<<6|63&e[L++],P--;P>1?X[B++]=65533:d<65536?X[B++]=d:(d-=65536,X[B++]=55296|d>>10&1023,X[B++]=56320|1023&d)}}return((e,v)=>{if(v<65534&&e.subarray&&d)return String.fromCharCode.apply(null,e.length===v?e:e.subarray(0,v));let P="";for(let d=0;d<v;d++)P+=String.fromCharCode(e[d]);return P})(X,B)},e.exports.utf8border=(e,d)=>{(d=d||e.length)>e.length&&(d=e.length);let P=d-1;for(;P>=0&&128===(192&e[P]);)P--;return P<0||0===P?d:P+v[e[P]]>d?P:d}},13582:e=>{"use strict";e.exports=(e,d,v,P)=>{let p=65535&e,L=e>>>16&65535,B=0;for(;0!==v;){B=v>2e3?2e3:v,v-=B;do{p=p+d[P++]|0,L=L+p|0}while(--B);p%=65521,L%=65521}return p|L<<16}},13598:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13588:e=>{"use strict";const d=new Uint32Array((()=>{let e,d=[];for(var v=0;v<256;v++){e=v;for(var P=0;P<8;P++)e=1&e?3988292384^e>>>1:e>>>1;d[v]=e}return d})());e.exports=(e,v,P,p)=>{const L=d,B=p+P;e^=-1;for(let d=p;d<B;d++)e=e>>>8^L[255&(e^v[d])];return~e}},13572:(e,d,v)=>{"use strict";const{_tr_init:P,_tr_stored_block:p,_tr_flush_block:L,_tr_tally:B,_tr_align:X}=v(13578),z=v(13582),W=v(13588),V=v(13595),{Z_NO_FLUSH:k,Z_PARTIAL_FLUSH:g,Z_FULL_FLUSH:F,Z_FINISH:w,Z_BLOCK:G,Z_OK:U,Z_STREAM_END:D,Z_STREAM_ERROR:C,Z_DATA_ERROR:q,Z_BUF_ERROR:h,Z_DEFAULT_COMPRESSION:l,Z_FILTERED:n,Z_HUFFMAN_ONLY:A,Z_RLE:x,Z_FIXED:i,Z_DEFAULT_STRATEGY:me,Z_UNKNOWN:r,Z_DEFLATED:Z}=v(13598),f=258,T=262,S=103,o=113,K=666,Q=(e,d)=>(e.Dd=V[d],d),N=e=>(e<<1)-(e>4?9:0),u=e=>{let d=e.length;for(;--d>=0;)e[d]=0};let O=(e,d,v)=>(d<<e.hash_shift^v)&e.hash_mask;const R=e=>{const d=e.state;let v=d.pending;v>e.avail_out&&(v=e.avail_out),0!==v&&(e.output.set(d.pending_buf.subarray(d.pending_out,d.pending_out+v),e.next_out),e.next_out+=v,d.pending_out+=v,e.total_out+=v,e.avail_out-=v,d.pending-=v,0===d.pending&&(d.pending_out=0))},Y=(e,d)=>{L(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,d),e.block_start=e.strstart,R(e.strm)},H=(e,d)=>{e.pending_buf[e.pending++]=d},a=(e,d)=>{e.pending_buf[e.pending++]=d>>>8&255,e.pending_buf[e.pending++]=255&d},t=(e,d,v,P)=>{let p=e.avail_in;return p>P&&(p=P),0===p?0:(e.avail_in-=p,d.set(e.input.subarray(e.next_in,e.next_in+p),v),1===e.state.wrap?e.adler=z(e.adler,d,p,v):2===e.state.wrap&&(e.adler=W(e.adler,d,p,v)),e.next_in+=p,e.total_in+=p,p)},I=(e,d)=>{let v,P,p=e.max_chain_length,L=e.strstart,B=e.prev_length,X=e.nice_match;const z=e.strstart>e.w_size-T?e.strstart-(e.w_size-T):0,W=e.window,V=e.w_mask,k=e.prev,g=e.strstart+f;let F=W[L+B-1],w=W[L+B];e.prev_length>=e.good_match&&(p>>=2),X>e.lookahead&&(X=e.lookahead);do{if(v=d,W[v+B]===w&&W[v+B-1]===F&&W[v]===W[L]&&W[++v]===W[L+1]){L+=2,v++;do{}while(W[++L]===W[++v]&&W[++L]===W[++v]&&W[++L]===W[++v]&&W[++L]===W[++v]&&W[++L]===W[++v]&&W[++L]===W[++v]&&W[++L]===W[++v]&&W[++L]===W[++v]&&L<g);if(P=f-(g-L),L=g-f,P>B){if(e.match_start=d,B=P,P>=X)break;F=W[L+B-1],w=W[L+B]}}}while((d=k[d&V])>z&&0!==--p);return B<=e.lookahead?B:e.lookahead},c=e=>{const d=e.w_size;let v,P,p,L,B;do{if(L=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-T)){e.window.set(e.window.subarray(d,d+d),0),e.match_start-=d,e.strstart-=d,e.block_start-=d,P=e.hash_size,v=P;do{p=e.head[--v],e.head[v]=p>=d?p-d:0}while(--P);P=d,v=P;do{p=e.prev[--v],e.prev[v]=p>=d?p-d:0}while(--P);L+=d}if(0===e.strm.avail_in)break;if(P=t(e.strm,e.window,e.strstart+e.lookahead,L),e.lookahead+=P,e.lookahead+e.insert>=3)for(B=e.strstart-e.insert,e.ins_h=e.window[B],e.ins_h=O(e,e.ins_h,e.window[B+1]);e.insert&&(e.ins_h=O(e,e.ins_h,e.window[B+3-1]),e.prev[B&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=B,B++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<T&&0!==e.strm.avail_in)},b=(e,d)=>{let v,P;for(;;){if(e.lookahead<T){if(c(e),e.lookahead<T&&d===k)return 1;if(0===e.lookahead)break}if(v=0,e.lookahead>=3&&(e.ins_h=O(e,e.ins_h,e.window[e.strstart+3-1]),v=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==v&&e.strstart-v<=e.w_size-T&&(e.match_length=I(e,v)),e.match_length>=3)if(P=B(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=O(e,e.ins_h,e.window[e.strstart+3-1]),v=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=O(e,e.ins_h,e.window[e.strstart+1]);else P=B(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(P&&(Y(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,d===w?(Y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Y(e,!1),0===e.strm.avail_out)?1:2},M=(e,d)=>{let v,P,p;for(;;){if(e.lookahead<T){if(c(e),e.lookahead<T&&d===k)return 1;if(0===e.lookahead)break}if(v=0,e.lookahead>=3&&(e.ins_h=O(e,e.ins_h,e.window[e.strstart+3-1]),v=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==v&&e.prev_length<e.max_lazy_match&&e.strstart-v<=e.w_size-T&&(e.match_length=I(e,v),e.match_length<=5&&(e.strategy===n||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){p=e.strstart+e.lookahead-3,P=B(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=p&&(e.ins_h=O(e,e.ins_h,e.window[e.strstart+3-1]),v=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,P&&(Y(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(P=B(e,0,e.window[e.strstart-1]),P&&Y(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(P=B(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,d===w?(Y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Y(e,!1),0===e.strm.avail_out)?1:2};function s(e,d,v,P,p){this.good_length=e,this.max_lazy=d,this.nice_length=v,this.max_chain=P,this.func=p}const y=[new s(0,0,0,0,((e,d)=>{let v=65535;for(v>e.pending_buf_size-5&&(v=e.pending_buf_size-5);;){if(e.lookahead<=1){if(c(e),0===e.lookahead&&d===k)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const P=e.block_start+v;if((0===e.strstart||e.strstart>=P)&&(e.lookahead=e.strstart-P,e.strstart=P,Y(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-T&&(Y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,d===w?(Y(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Y(e,!1),e.strm.avail_out),1)})),new s(4,4,8,4,b),new s(4,5,16,8,b),new s(4,6,32,32,b),new s(4,4,16,16,M),new s(8,16,32,32,M),new s(8,16,128,128,M),new s(8,32,128,256,M),new s(32,128,258,1024,M),new s(32,258,258,4096,M)];function j(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),u(this.dyn_ltree),u(this.dyn_dtree),u(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),u(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),u(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const J=e=>{if(!e||!e.state)return Q(e,C);e.total_in=e.total_out=0,e.data_type=r;const d=e.state;return d.pending=0,d.pending_out=0,d.wrap<0&&(d.wrap=-d.wrap),d.status=d.wrap?42:o,e.adler=2===d.wrap?0:1,d.last_flush=k,P(d),U},E=e=>{const d=J(e);var v;return d===U&&((v=e.state).window_size=2*v.w_size,u(v.head),v.max_lazy_match=y[v.level].max_lazy,v.good_match=y[v.level].good_length,v.nice_match=y[v.level].nice_length,v.max_chain_length=y[v.level].max_chain,v.strstart=0,v.block_start=0,v.lookahead=0,v.insert=0,v.match_length=v.prev_length=2,v.match_available=0,v.ins_h=0),d},ee=(e,d,v,P,p,L)=>{if(!e)return C;let B=1;if(d===l&&(d=6),P<0?(B=0,P=-P):P>15&&(B=2,P-=16),p<1||p>9||v!==Z||P<8||P>15||d<0||d>9||L<0||L>i)return Q(e,C);8===P&&(P=9);const X=new j;return e.state=X,X.strm=e,X.wrap=B,X.gzhead=null,X.w_bits=P,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=p+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+3-1)/3),X.window=new Uint8Array(2*X.w_size),X.head=new Uint16Array(X.hash_size),X.prev=new Uint16Array(X.w_size),X.lit_bufsize=1<<p+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new Uint8Array(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=d,X.strategy=L,X.method=v,E(e)};e.exports.deflateInit=(e,d)=>ee(e,d,Z,15,8,me),e.exports.deflateInit2=ee,e.exports.deflateReset=E,e.exports.deflateResetKeep=J,e.exports.deflateSetHeader=(e,d)=>e&&e.state?2!==e.state.wrap?C:(e.state.gzhead=d,U):C,e.exports.deflate=(e,d)=>{let v,P;if(!e||!e.state||d>G||d<0)return e?Q(e,C):C;const L=e.state;if(!e.output||!e.input&&0!==e.avail_in||L.status===K&&d!==w)return Q(e,0===e.avail_out?h:C);L.strm=e;const z=L.last_flush;if(L.last_flush=d,42===L.status)if(2===L.wrap)e.adler=0,H(L,31),H(L,139),H(L,8),L.gzhead?(H(L,(L.gzhead.text?1:0)+(L.gzhead.hcrc?2:0)+(L.gzhead.extra?4:0)+(L.gzhead.name?8:0)+(L.gzhead.comment?16:0)),H(L,255&L.gzhead.time),H(L,L.gzhead.time>>8&255),H(L,L.gzhead.time>>16&255),H(L,L.gzhead.time>>24&255),H(L,9===L.level?2:L.strategy>=A||L.level<2?4:0),H(L,255&L.gzhead.os),L.gzhead.extra&&L.gzhead.extra.length&&(H(L,255&L.gzhead.extra.length),H(L,L.gzhead.extra.length>>8&255)),L.gzhead.hcrc&&(e.adler=W(e.adler,L.pending_buf,L.pending,0)),L.gzindex=0,L.status=69):(H(L,0),H(L,0),H(L,0),H(L,0),H(L,0),H(L,9===L.level?2:L.strategy>=A||L.level<2?4:0),H(L,3),L.status=o);else{let d=Z+(L.w_bits-8<<4)<<8,v=-1;v=L.strategy>=A||L.level<2?0:L.level<6?1:6===L.level?2:3,d|=v<<6,0!==L.strstart&&(d|=32),d+=31-d%31,L.status=o,a(L,d),0!==L.strstart&&(a(L,e.adler>>>16),a(L,65535&e.adler)),e.adler=1}if(69===L.status)if(L.gzhead.extra){for(v=L.pending;L.gzindex<(65535&L.gzhead.extra.length)&&(L.pending!==L.pending_buf_size||(L.gzhead.hcrc&&L.pending>v&&(e.adler=W(e.adler,L.pending_buf,L.pending-v,v)),R(e),v=L.pending,L.pending!==L.pending_buf_size));)H(L,255&L.gzhead.extra[L.gzindex]),L.gzindex++;L.gzhead.hcrc&&L.pending>v&&(e.adler=W(e.adler,L.pending_buf,L.pending-v,v)),L.gzindex===L.gzhead.extra.length&&(L.gzindex=0,L.status=73)}else L.status=73;if(73===L.status)if(L.gzhead.name){v=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>v&&(e.adler=W(e.adler,L.pending_buf,L.pending-v,v)),R(e),v=L.pending,L.pending===L.pending_buf_size)){P=1;break}P=L.gzindex<L.gzhead.name.length?255&L.gzhead.name.charCodeAt(L.gzindex++):0,H(L,P)}while(0!==P);L.gzhead.hcrc&&L.pending>v&&(e.adler=W(e.adler,L.pending_buf,L.pending-v,v)),0===P&&(L.gzindex=0,L.status=91)}else L.status=91;if(91===L.status)if(L.gzhead.comment){v=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>v&&(e.adler=W(e.adler,L.pending_buf,L.pending-v,v)),R(e),v=L.pending,L.pending===L.pending_buf_size)){P=1;break}P=L.gzindex<L.gzhead.comment.length?255&L.gzhead.comment.charCodeAt(L.gzindex++):0,H(L,P)}while(0!==P);L.gzhead.hcrc&&L.pending>v&&(e.adler=W(e.adler,L.pending_buf,L.pending-v,v)),0===P&&(L.status=S)}else L.status=S;if(L.status===S&&(L.gzhead.hcrc?(L.pending+2>L.pending_buf_size&&R(e),L.pending+2<=L.pending_buf_size&&(H(L,255&e.adler),H(L,e.adler>>8&255),e.adler=0,L.status=o)):L.status=o),0!==L.pending){if(R(e),0===e.avail_out)return L.last_flush=-1,U}else if(0===e.avail_in&&N(d)<=N(z)&&d!==w)return Q(e,h);if(L.status===K&&0!==e.avail_in)return Q(e,h);if(0!==e.avail_in||0!==L.lookahead||d!==k&&L.status!==K){let v=L.strategy===A?((e,d)=>{let v;for(;;){if(0===e.lookahead&&(c(e),0===e.lookahead)){if(d===k)return 1;break}if(e.match_length=0,v=B(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,v&&(Y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,d===w?(Y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Y(e,!1),0===e.strm.avail_out)?1:2})(L,d):L.strategy===x?((e,d)=>{let v,P,p,L;const X=e.window;for(;;){if(e.lookahead<=f){if(c(e),e.lookahead<=f&&d===k)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(p=e.strstart-1,P=X[p],P===X[++p]&&P===X[++p]&&P===X[++p])){L=e.strstart+f;do{}while(P===X[++p]&&P===X[++p]&&P===X[++p]&&P===X[++p]&&P===X[++p]&&P===X[++p]&&P===X[++p]&&P===X[++p]&&p<L);e.match_length=f-(L-p),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(v=B(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(v=B(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),v&&(Y(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,d===w?(Y(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Y(e,!1),0===e.strm.avail_out)?1:2})(L,d):y[L.level].func(L,d);if(3!==v&&4!==v||(L.status=K),1===v||3===v)return 0===e.avail_out&&(L.last_flush=-1),U;if(2===v&&(d===g?X(L):d!==G&&(p(L,0,0,!1),d===F&&(u(L.head),0===L.lookahead&&(L.strstart=0,L.block_start=0,L.insert=0))),R(e),0===e.avail_out))return L.last_flush=-1,U}return d!==w?U:L.wrap<=0?D:(2===L.wrap?(H(L,255&e.adler),H(L,e.adler>>8&255),H(L,e.adler>>16&255),H(L,e.adler>>24&255),H(L,255&e.total_in),H(L,e.total_in>>8&255),H(L,e.total_in>>16&255),H(L,e.total_in>>24&255)):(a(L,e.adler>>>16),a(L,65535&e.adler)),R(e),L.wrap>0&&(L.wrap=-L.wrap),0!==L.pending?U:D)},e.exports.deflateEnd=e=>{if(!e||!e.state)return C;const d=e.state.status;return 42!==d&&69!==d&&73!==d&&91!==d&&d!==S&&d!==o&&d!==K?Q(e,C):(e.state=null,d===o?Q(e,q):U)},e.exports.deflateSetDictionary=(e,d)=>{let v=d.length;if(!e||!e.state)return C;const P=e.state,p=P.wrap;if(2===p||1===p&&42!==P.status||P.lookahead)return C;if(1===p&&(e.adler=z(e.adler,d,v,0)),P.wrap=0,v>=P.w_size){0===p&&(u(P.head),P.strstart=0,P.block_start=0,P.insert=0);let e=new Uint8Array(P.w_size);e.set(d.subarray(v-P.w_size,v),0),d=e,v=P.w_size}const L=e.avail_in,B=e.next_in,X=e.input;for(e.avail_in=v,e.next_in=0,e.input=d,c(P);P.lookahead>=3;){let e=P.strstart,d=P.lookahead-2;do{P.ins_h=O(P,P.ins_h,P.window[e+3-1]),P.prev[e&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=e,e++}while(--d);P.strstart=e,P.lookahead=2,c(P)}return P.strstart+=P.lookahead,P.block_start=P.strstart,P.insert=P.lookahead,P.lookahead=0,P.match_length=P.prev_length=2,P.match_available=0,e.next_in=B,e.input=X,e.avail_in=L,P.wrap=p,U},e.exports.deflateInfo="pako deflate (from Nodeca project)"},13652:e=>{"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13640:e=>{"use strict";e.exports=function(e,d){let v,P,p,L,B,X,z,W,V,k,g,F,w,G,U,D,C,q,h,l,n,A,x,i;const me=e.state;v=e.next_in,x=e.input,P=v+(e.avail_in-5),p=e.next_out,i=e.output,L=p-(d-e.avail_out),B=p+(e.avail_out-257),X=me.dmax,z=me.wsize,W=me.whave,V=me.wnext,k=me.window,g=me.hold,F=me.bits,w=me.lencode,G=me.distcode,U=(1<<me.lenbits)-1,D=(1<<me.distbits)-1;e:do{F<15&&(g+=x[v++]<<F,F+=8,g+=x[v++]<<F,F+=8),C=w[g&U];d:for(;;){if(q=C>>>24,g>>>=q,F-=q,q=C>>>16&255,0===q)i[p++]=65535&C;else{if(!(16&q)){if(0===(64&q)){C=w[(65535&C)+(g&(1<<q)-1)];continue d}if(32&q){me.mode=12;break e}e.Dd="invalid literal/length code",me.mode=30;break e}h=65535&C,q&=15,q&&(F<q&&(g+=x[v++]<<F,F+=8),h+=g&(1<<q)-1,g>>>=q,F-=q),F<15&&(g+=x[v++]<<F,F+=8,g+=x[v++]<<F,F+=8),C=G[g&D];v:for(;;){if(q=C>>>24,g>>>=q,F-=q,q=C>>>16&255,!(16&q)){if(0===(64&q)){C=G[(65535&C)+(g&(1<<q)-1)];continue v}e.Dd="invalid distance code",me.mode=30;break e}if(l=65535&C,q&=15,F<q&&(g+=x[v++]<<F,F+=8,F<q&&(g+=x[v++]<<F,F+=8)),l+=g&(1<<q)-1,l>X){e.Dd="invalid distance too far back",me.mode=30;break e}if(g>>>=q,F-=q,q=p-L,l>q){if(q=l-q,q>W&&me.sane){e.Dd="invalid distance too far back",me.mode=30;break e}if(n=0,A=k,0===V){if(n+=z-q,q<h){h-=q;do{i[p++]=k[n++]}while(--q);n=p-l,A=i}}else if(V<q){if(n+=z+V-q,q-=V,q<h){h-=q;do{i[p++]=k[n++]}while(--q);if(n=0,V<h){q=V,h-=q;do{i[p++]=k[n++]}while(--q);n=p-l,A=i}}}else if(n+=V-q,q<h){h-=q;do{i[p++]=k[n++]}while(--q);n=p-l,A=i}for(;h>2;)i[p++]=A[n++],i[p++]=A[n++],i[p++]=A[n++],h-=3;h&&(i[p++]=A[n++],h>1&&(i[p++]=A[n++]))}else{n=p-l;do{i[p++]=i[n++],i[p++]=i[n++],i[p++]=i[n++],h-=3}while(h>2);h&&(i[p++]=i[n++],h>1&&(i[p++]=i[n++]))}break}}break}}while(v<P&&p<B);h=F>>3,v-=h,F-=h<<3,g&=(1<<F)-1,e.next_in=v,e.next_out=p,e.avail_in=v<P?P-v+5:5-(v-P),e.avail_out=p<B?B-p+257:257-(p-B),me.hold=g,me.bits=F}},13633:(e,d,v)=>{"use strict";const P=v(13582),p=v(13588),L=v(13640),B=v(13644),{Z_FINISH:X,Z_BLOCK:z,Z_TREES:W,Z_OK:V,Z_STREAM_END:k,Z_NEED_DICT:g,Z_STREAM_ERROR:F,Z_DATA_ERROR:w,Z_MEM_ERROR:G,Z_BUF_ERROR:U,Z_DEFLATED:D}=v(13598),C=12,q=30,h=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const n=e=>{if(!e||!e.state)return F;const d=e.state;return e.total_in=e.total_out=d.total=0,e.Dd="",d.wrap&&(e.adler=1&d.wrap),d.mode=1,d.last=0,d.havedict=0,d.dmax=32768,d.head=null,d.hold=0,d.bits=0,d.lencode=d.lendyn=new Int32Array(852),d.distcode=d.distdyn=new Int32Array(592),d.sane=1,d.back=-1,V},A=e=>{if(!e||!e.state)return F;const d=e.state;return d.wsize=0,d.whave=0,d.wnext=0,n(e)},x=(e,d)=>{let v;if(!e||!e.state)return F;const P=e.state;return d<0?(v=0,d=-d):(v=1+(d>>4),d<48&&(d&=15)),d&&(d<8||d>15)?F:(null!==P.window&&P.wbits!==d&&(P.window=null),P.wrap=v,P.wbits=d,A(e))},i=(e,d)=>{if(!e)return F;const v=new l;e.state=v,v.window=null;const P=x(e,d);return P!==V&&(e.state=null),P};let me,r,Z=!0;const f=e=>{if(Z){me=new Int32Array(512),r=new Int32Array(32);let d=0;for(;d<144;)e.lens[d++]=8;for(;d<256;)e.lens[d++]=9;for(;d<280;)e.lens[d++]=7;for(;d<288;)e.lens[d++]=8;for(B(1,e.lens,0,288,me,0,e.work,{bits:9}),d=0;d<32;)e.lens[d++]=5;B(2,e.lens,0,32,r,0,e.work,{bits:5}),Z=!1}e.lencode=me,e.lenbits=9,e.distcode=r,e.distbits=5},T=(e,d,v,P)=>{let p;const L=e.state;return null===L.window&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new Uint8Array(L.wsize)),P>=L.wsize?(L.window.set(d.subarray(v-L.wsize,v),0),L.wnext=0,L.whave=L.wsize):(p=L.wsize-L.wnext,p>P&&(p=P),L.window.set(d.subarray(v-P,v-P+p),L.wnext),(P-=p)?(L.window.set(d.subarray(v-P,v),0),L.wnext=P,L.whave=L.wsize):(L.wnext+=p,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=p))),0};e.exports.inflateReset=A,e.exports.inflateReset2=x,e.exports.inflateResetKeep=n,e.exports.inflateInit=e=>i(e,15),e.exports.inflateInit2=i,e.exports.inflate=(e,d)=>{let v,l,n,A,x,i,me,r,Z,S,o,K,Q,N,u,O,R,Y,H,a,t,I,c=0;const b=new Uint8Array(4);let M,s;const y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return F;v=e.state,v.mode===C&&(v.mode=13),x=e.next_out,n=e.output,me=e.avail_out,A=e.next_in,l=e.input,i=e.avail_in,r=v.hold,Z=v.bits,S=i,o=me,I=V;e:for(;;)switch(v.mode){case 1:if(0===v.wrap){v.mode=13;break}for(;Z<16;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if(2&v.wrap&&35615===r){v.check=0,b[0]=255&r,b[1]=r>>>8&255,v.check=p(v.check,b,2,0),r=0,Z=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&r)<<8)+(r>>8))%31){e.Dd="incorrect header check",v.mode=q;break}if((15&r)!==D){e.Dd="unknown compression method",v.mode=q;break}if(r>>>=4,Z-=4,t=8+(15&r),0===v.wbits)v.wbits=t;else if(t>v.wbits){e.Dd="invalid window size",v.mode=q;break}v.dmax=1<<v.wbits,e.adler=v.check=1,v.mode=512&r?10:C,r=0,Z=0;break;case 2:for(;Z<16;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if(v.flags=r,(255&v.flags)!==D){e.Dd="unknown compression method",v.mode=q;break}if(57344&v.flags){e.Dd="unknown header flags set",v.mode=q;break}v.head&&(v.head.text=r>>8&1),512&v.flags&&(b[0]=255&r,b[1]=r>>>8&255,v.check=p(v.check,b,2,0)),r=0,Z=0,v.mode=3;case 3:for(;Z<32;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}v.head&&(v.head.time=r),512&v.flags&&(b[0]=255&r,b[1]=r>>>8&255,b[2]=r>>>16&255,b[3]=r>>>24&255,v.check=p(v.check,b,4,0)),r=0,Z=0,v.mode=4;case 4:for(;Z<16;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}v.head&&(v.head.xflags=255&r,v.head.os=r>>8),512&v.flags&&(b[0]=255&r,b[1]=r>>>8&255,v.check=p(v.check,b,2,0)),r=0,Z=0,v.mode=5;case 5:if(1024&v.flags){for(;Z<16;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}v.length=r,v.head&&(v.head.extra_len=r),512&v.flags&&(b[0]=255&r,b[1]=r>>>8&255,v.check=p(v.check,b,2,0)),r=0,Z=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(K=v.length,K>i&&(K=i),K&&(v.head&&(t=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Uint8Array(v.head.extra_len)),v.head.extra.set(l.subarray(A,A+K),t)),512&v.flags&&(v.check=p(v.check,l,K,A)),i-=K,A+=K,v.length-=K),v.length))break e;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(0===i)break e;K=0;do{t=l[A+K++],v.head&&t&&v.length<65536&&(v.head.name+=String.fromCharCode(t))}while(t&&K<i);if(512&v.flags&&(v.check=p(v.check,l,K,A)),i-=K,A+=K,t)break e}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(0===i)break e;K=0;do{t=l[A+K++],v.head&&t&&v.length<65536&&(v.head.comment+=String.fromCharCode(t))}while(t&&K<i);if(512&v.flags&&(v.check=p(v.check,l,K,A)),i-=K,A+=K,t)break e}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;Z<16;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if(r!==(65535&v.check)){e.Dd="header crc mismatch",v.mode=q;break}r=0,Z=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),e.adler=v.check=0,v.mode=C;break;case 10:for(;Z<32;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}e.adler=v.check=h(r),r=0,Z=0,v.mode=11;case 11:if(0===v.havedict)return e.next_out=x,e.avail_out=me,e.next_in=A,e.avail_in=i,v.hold=r,v.bits=Z,g;e.adler=v.check=1,v.mode=C;case C:if(d===z||d===W)break e;case 13:if(v.last){r>>>=7&Z,Z-=7&Z,v.mode=27;break}for(;Z<3;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}switch(v.last=1&r,r>>>=1,Z-=1,3&r){case 0:v.mode=14;break;case 1:if(f(v),v.mode=20,d===W){r>>>=2,Z-=2;break e}break;case 2:v.mode=17;break;case 3:e.Dd="invalid block type",v.mode=q}r>>>=2,Z-=2;break;case 14:for(r>>>=7&Z,Z-=7&Z;Z<32;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if((65535&r)!==(r>>>16^65535)){e.Dd="invalid stored block lengths",v.mode=q;break}if(v.length=65535&r,r=0,Z=0,v.mode=15,d===W)break e;case 15:v.mode=16;case 16:if(K=v.length,K){if(K>i&&(K=i),K>me&&(K=me),0===K)break e;n.set(l.subarray(A,A+K),x),i-=K,A+=K,me-=K,x+=K,v.length-=K;break}v.mode=C;break;case 17:for(;Z<14;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if(v.nlen=257+(31&r),r>>>=5,Z-=5,v.ndist=1+(31&r),r>>>=5,Z-=5,v.ncode=4+(15&r),r>>>=4,Z-=4,v.nlen>286||v.ndist>30){e.Dd="too many length or distance symbols",v.mode=q;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;Z<3;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}v.lens[y[v.have++]]=7&r,r>>>=3,Z-=3}for(;v.have<19;)v.lens[y[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,M={bits:v.lenbits},I=B(0,v.lens,0,19,v.lencode,0,v.work,M),v.lenbits=M.bits,I){e.Dd="invalid code lengths set",v.mode=q;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;c=v.lencode[r&(1<<v.lenbits)-1],u=c>>>24,O=c>>>16&255,R=65535&c,!(u<=Z);){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if(R<16)r>>>=u,Z-=u,v.lens[v.have++]=R;else{if(16===R){for(s=u+2;Z<s;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if(r>>>=u,Z-=u,0===v.have){e.Dd="invalid bit length repeat",v.mode=q;break}t=v.lens[v.have-1],K=3+(3&r),r>>>=2,Z-=2}else if(17===R){for(s=u+3;Z<s;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}r>>>=u,Z-=u,t=0,K=3+(7&r),r>>>=3,Z-=3}else{for(s=u+7;Z<s;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}r>>>=u,Z-=u,t=0,K=11+(127&r),r>>>=7,Z-=7}if(v.have+K>v.nlen+v.ndist){e.Dd="invalid bit length repeat",v.mode=q;break}for(;K--;)v.lens[v.have++]=t}}if(v.mode===q)break;if(0===v.lens[256]){e.Dd="invalid code -- missing end-of-block",v.mode=q;break}if(v.lenbits=9,M={bits:v.lenbits},I=B(1,v.lens,0,v.nlen,v.lencode,0,v.work,M),v.lenbits=M.bits,I){e.Dd="invalid literal/lengths set",v.mode=q;break}if(v.distbits=6,v.distcode=v.distdyn,M={bits:v.distbits},I=B(2,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,M),v.distbits=M.bits,I){e.Dd="invalid distances set",v.mode=q;break}if(v.mode=20,d===W)break e;case 20:v.mode=21;case 21:if(i>=6&&me>=258){e.next_out=x,e.avail_out=me,e.next_in=A,e.avail_in=i,v.hold=r,v.bits=Z,L(e,o),x=e.next_out,n=e.output,me=e.avail_out,A=e.next_in,l=e.input,i=e.avail_in,r=v.hold,Z=v.bits,v.mode===C&&(v.back=-1);break}for(v.back=0;c=v.lencode[r&(1<<v.lenbits)-1],u=c>>>24,O=c>>>16&255,R=65535&c,!(u<=Z);){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if(O&&0===(240&O)){for(Y=u,H=O,a=R;c=v.lencode[a+((r&(1<<Y+H)-1)>>Y)],u=c>>>24,O=c>>>16&255,R=65535&c,!(Y+u<=Z);){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}r>>>=Y,Z-=Y,v.back+=Y}if(r>>>=u,Z-=u,v.back+=u,v.length=R,0===O){v.mode=26;break}if(32&O){v.back=-1,v.mode=C;break}if(64&O){e.Dd="invalid literal/length code",v.mode=q;break}v.extra=15&O,v.mode=22;case 22:if(v.extra){for(s=v.extra;Z<s;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}v.length+=r&(1<<v.extra)-1,r>>>=v.extra,Z-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;c=v.distcode[r&(1<<v.distbits)-1],u=c>>>24,O=c>>>16&255,R=65535&c,!(u<=Z);){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if(0===(240&O)){for(Y=u,H=O,a=R;c=v.distcode[a+((r&(1<<Y+H)-1)>>Y)],u=c>>>24,O=c>>>16&255,R=65535&c,!(Y+u<=Z);){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}r>>>=Y,Z-=Y,v.back+=Y}if(r>>>=u,Z-=u,v.back+=u,64&O){e.Dd="invalid distance code",v.mode=q;break}v.offset=R,v.extra=15&O,v.mode=24;case 24:if(v.extra){for(s=v.extra;Z<s;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}v.offset+=r&(1<<v.extra)-1,r>>>=v.extra,Z-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){e.Dd="invalid distance too far back",v.mode=q;break}v.mode=25;case 25:if(0===me)break e;if(K=o-me,v.offset>K){if(K=v.offset-K,K>v.whave&&v.sane){e.Dd="invalid distance too far back",v.mode=q;break}K>v.wnext?(K-=v.wnext,Q=v.wsize-K):Q=v.wnext-K,K>v.length&&(K=v.length),N=v.window}else N=n,Q=x-v.offset,K=v.length;K>me&&(K=me),me-=K,v.length-=K;do{n[x++]=N[Q++]}while(--K);0===v.length&&(v.mode=21);break;case 26:if(0===me)break e;n[x++]=v.length,me--,v.mode=21;break;case 27:if(v.wrap){for(;Z<32;){if(0===i)break e;i--,r|=l[A++]<<Z,Z+=8}if(o-=me,e.total_out+=o,v.total+=o,o&&(e.adler=v.check=v.flags?p(v.check,n,o,x-o):P(v.check,n,o,x-o)),o=me,(v.flags?r:h(r))!==v.check){e.Dd="incorrect data check",v.mode=q;break}r=0,Z=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;Z<32;){if(0===i)break e;i--,r+=l[A++]<<Z,Z+=8}if(r!==(4294967295&v.total)){e.Dd="incorrect length check",v.mode=q;break}r=0,Z=0}v.mode=29;case 29:I=k;break e;case q:I=w;break e;case 31:return G;default:return F}return e.next_out=x,e.avail_out=me,e.next_in=A,e.avail_in=i,v.hold=r,v.bits=Z,(v.wsize||o!==e.avail_out&&v.mode<q&&(v.mode<27||d!==X))&&T(e,e.output,e.next_out,o-e.avail_out)?(v.mode=31,G):(S-=e.avail_in,o-=e.avail_out,e.total_in+=S,e.total_out+=o,v.total+=o,v.wrap&&o&&(e.adler=v.check=v.flags?p(v.check,n,o,e.next_out-o):P(v.check,n,o,e.next_out-o)),e.data_type=v.bits+(v.last?64:0)+(v.mode===C?128:0)+(20===v.mode||15===v.mode?256:0),(0===S&&0===o||d===X)&&I===V&&(I=U),I)},e.exports.inflateEnd=e=>{if(!e||!e.state)return F;let d=e.state;return d.window&&(d.window=null),e.state=null,V},e.exports.inflateGetHeader=(e,d)=>{if(!e||!e.state)return F;const v=e.state;return 0===(2&v.wrap)?F:(v.head=d,d.done=!1,V)},e.exports.inflateSetDictionary=(e,d)=>{const v=d.length;let p,L,B;return e&&e.state?(p=e.state,0!==p.wrap&&11!==p.mode?F:11===p.mode&&(L=1,L=P(L,d,v,0),L!==p.check)?w:(B=T(e,d,v,v),B?(p.mode=31,G):(p.havedict=1,V))):F},e.exports.inflateInfo="pako inflate (from Nodeca project)"},13644:e=>{"use strict";const d=15,v=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),P=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),p=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),L=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);e.exports=(e,B,X,z,W,V,k,g)=>{const F=g.bits;let w,G,U,D,C,q,h=0,l=0,n=0,A=0,x=0,i=0,me=0,r=0,Z=0,f=0,T=null,S=0;const o=new Uint16Array(16),K=new Uint16Array(16);let Q,N,u,O=null,R=0;for(h=0;h<=d;h++)o[h]=0;for(l=0;l<z;l++)o[B[X+l]]++;for(x=F,A=d;A>=1&&0===o[A];A--);if(x>A&&(x=A),0===A)return W[V++]=20971520,W[V++]=20971520,g.bits=1,0;for(n=1;n<A&&0===o[n];n++);for(x<n&&(x=n),r=1,h=1;h<=d;h++)if(r<<=1,r-=o[h],r<0)return-1;if(r>0&&(0===e||1!==A))return-1;for(K[1]=0,h=1;h<d;h++)K[h+1]=K[h]+o[h];for(l=0;l<z;l++)0!==B[X+l]&&(k[K[B[X+l]]++]=l);if(0===e?(T=O=k,q=19):1===e?(T=v,S-=257,O=P,R-=257,q=256):(T=p,O=L,q=-1),f=0,l=0,h=n,C=V,i=x,me=0,U=-1,Z=1<<x,D=Z-1,1===e&&Z>852||2===e&&Z>592)return 1;for(;;){Q=h-me,k[l]<q?(N=0,u=k[l]):k[l]>q?(N=O[R+k[l]],u=T[S+k[l]]):(N=96,u=0),w=1<<h-me,G=1<<i,n=G;do{G-=w,W[C+(f>>me)+G]=Q<<24|N<<16|u}while(0!==G);for(w=1<<h-1;f&w;)w>>=1;if(0!==w?(f&=w-1,f+=w):f=0,l++,0===--o[h]){if(h===A)break;h=B[X+k[l]]}if(h>x&&(f&D)!==U){for(0===me&&(me=x),C+=n,i=h-me,r=1<<i;i+me<A&&(r-=o[i+me],!(r<=0));)i++,r<<=1;if(Z+=1<<i,1===e&&Z>852||2===e&&Z>592)return 1;U=f&D,W[U]=x<<24|i<<16|C-V}}return 0!==f&&(W[C+f]=h-me<<24|64<<16),g.bits=x,0}},13595:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13578:e=>{"use strict";function d(e){let d=e.length;for(;--d>=0;)e[d]=0}const v=256,P=286,p=30,L=15,B=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),X=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),z=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V=new Array(576);d(V);const k=new Array(60);d(k);const g=new Array(512);d(g);const F=new Array(256);d(F);const w=new Array(29);d(w);const G=new Array(p);function U(e,d,v,P,p){this.static_tree=e,this.extra_bits=d,this.extra_base=v,this.elems=P,this.max_length=p,this.has_stree=e&&e.length}let D,C,q;function h(e,d){this.dyn_tree=e,this.max_code=0,this.stat_desc=d}d(G);const l=e=>e<256?g[e]:g[256+(e>>>7)],n=(e,d)=>{e.pending_buf[e.pending++]=255&d,e.pending_buf[e.pending++]=d>>>8&255},A=(e,d,v)=>{e.bi_valid>16-v?(e.bi_buf|=d<<e.bi_valid&65535,n(e,e.bi_buf),e.bi_buf=d>>16-e.bi_valid,e.bi_valid+=v-16):(e.bi_buf|=d<<e.bi_valid&65535,e.bi_valid+=v)},x=(e,d,v)=>{A(e,v[2*d],v[2*d+1])},i=(e,d)=>{let v=0;do{v|=1&e,e>>>=1,v<<=1}while(--d>0);return v>>>1},me=(e,d,v)=>{const P=new Array(16);let p,B,X=0;for(p=1;p<=L;p++)P[p]=X=X+v[p-1]<<1;for(B=0;B<=d;B++){let d=e[2*B+1];0!==d&&(e[2*B]=i(P[d]++,d))}},r=e=>{let d;for(d=0;d<P;d++)e.dyn_ltree[2*d]=0;for(d=0;d<p;d++)e.dyn_dtree[2*d]=0;for(d=0;d<19;d++)e.bl_tree[2*d]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},Z=e=>{e.bi_valid>8?n(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},f=(e,d,v,P)=>{const p=2*d,L=2*v;return e[p]<e[L]||e[p]===e[L]&&P[d]<=P[v]},T=(e,d,v)=>{const P=e.heap[v];let p=v<<1;for(;p<=e.heap_len&&(p<e.heap_len&&f(d,e.heap[p+1],e.heap[p],e.depth)&&p++,!f(d,P,e.heap[p],e.depth));)e.heap[v]=e.heap[p],v=p,p<<=1;e.heap[v]=P},S=(e,d,P)=>{let p,L,z,W,V=0;if(0!==e.last_lit)do{p=e.pending_buf[e.d_buf+2*V]<<8|e.pending_buf[e.d_buf+2*V+1],L=e.pending_buf[e.l_buf+V],V++,0===p?x(e,L,d):(z=F[L],x(e,z+v+1,d),W=B[z],0!==W&&(L-=w[z],A(e,L,W)),p--,z=l(p),x(e,z,P),W=X[z],0!==W&&(p-=G[z],A(e,p,W)))}while(V<e.last_lit);x(e,256,d)},o=(e,d)=>{const v=d.dyn_tree,P=d.stat_desc.static_tree,p=d.stat_desc.has_stree,B=d.stat_desc.elems;let X,z,W,V=-1;for(e.heap_len=0,e.heap_max=573,X=0;X<B;X++)0!==v[2*X]?(e.heap[++e.heap_len]=V=X,e.depth[X]=0):v[2*X+1]=0;for(;e.heap_len<2;)W=e.heap[++e.heap_len]=V<2?++V:0,v[2*W]=1,e.depth[W]=0,e.opt_len--,p&&(e.static_len-=P[2*W+1]);for(d.max_code=V,X=e.heap_len>>1;X>=1;X--)T(e,v,X);W=B;do{X=e.heap[1],e.heap[1]=e.heap[e.heap_len--],T(e,v,1),z=e.heap[1],e.heap[--e.heap_max]=X,e.heap[--e.heap_max]=z,v[2*W]=v[2*X]+v[2*z],e.depth[W]=(e.depth[X]>=e.depth[z]?e.depth[X]:e.depth[z])+1,v[2*X+1]=v[2*z+1]=W,e.heap[1]=W++,T(e,v,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,d)=>{const v=d.dyn_tree,P=d.max_code,p=d.stat_desc.static_tree,B=d.stat_desc.has_stree,X=d.stat_desc.extra_bits,z=d.stat_desc.extra_base,W=d.stat_desc.max_length;let V,k,g,F,w,G,U=0;for(F=0;F<=L;F++)e.bl_count[F]=0;for(v[2*e.heap[e.heap_max]+1]=0,V=e.heap_max+1;V<573;V++)k=e.heap[V],F=v[2*v[2*k+1]+1]+1,F>W&&(F=W,U++),v[2*k+1]=F,k>P||(e.bl_count[F]++,w=0,k>=z&&(w=X[k-z]),G=v[2*k],e.opt_len+=G*(F+w),B&&(e.static_len+=G*(p[2*k+1]+w)));if(0!==U){do{for(F=W-1;0===e.bl_count[F];)F--;e.bl_count[F]--,e.bl_count[F+1]+=2,e.bl_count[W]--,U-=2}while(U>0);for(F=W;0!==F;F--)for(k=e.bl_count[F];0!==k;)g=e.heap[--V],g>P||(v[2*g+1]!==F&&(e.opt_len+=(F-v[2*g+1])*v[2*g],v[2*g+1]=F),k--)}})(e,d),me(v,V,e.bl_count)},K=(e,d,v)=>{let P,p,L=-1,B=d[1],X=0,z=7,W=4;for(0===B&&(z=138,W=3),d[2*(v+1)+1]=65535,P=0;P<=v;P++)p=B,B=d[2*(P+1)+1],++X<z&&p===B||(X<W?e.bl_tree[2*p]+=X:0!==p?(p!==L&&e.bl_tree[2*p]++,e.bl_tree[32]++):X<=10?e.bl_tree[34]++:e.bl_tree[36]++,X=0,L=p,0===B?(z=138,W=3):p===B?(z=6,W=3):(z=7,W=4))},Q=(e,d,v)=>{let P,p,L=-1,B=d[1],X=0,z=7,W=4;for(0===B&&(z=138,W=3),P=0;P<=v;P++)if(p=B,B=d[2*(P+1)+1],!(++X<z&&p===B)){if(X<W)do{x(e,p,e.bl_tree)}while(0!==--X);else 0!==p?(p!==L&&(x(e,p,e.bl_tree),X--),x(e,16,e.bl_tree),A(e,X-3,2)):X<=10?(x(e,17,e.bl_tree),A(e,X-3,3)):(x(e,18,e.bl_tree),A(e,X-11,7));X=0,L=p,0===B?(z=138,W=3):p===B?(z=6,W=3):(z=7,W=4)}};let N=!1;const u=(e,d,v,P)=>{A(e,0+(P?1:0),3),((e,d,v,P)=>{Z(e),P&&(n(e,v),n(e,~v)),e.pending_buf.set(e.window.subarray(d,d+v),e.pending),e.pending+=v})(e,d,v,!0)};e.exports._tr_init=e=>{N||((()=>{let e,d,v,W,h;const l=new Array(16);for(v=0,W=0;W<28;W++)for(w[W]=v,e=0;e<1<<B[W];e++)F[v++]=W;for(F[v-1]=W,h=0,W=0;W<16;W++)for(G[W]=h,e=0;e<1<<X[W];e++)g[h++]=W;for(h>>=7;W<p;W++)for(G[W]=h<<7,e=0;e<1<<X[W]-7;e++)g[256+h++]=W;for(d=0;d<=L;d++)l[d]=0;for(e=0;e<=143;)V[2*e+1]=8,e++,l[8]++;for(;e<=255;)V[2*e+1]=9,e++,l[9]++;for(;e<=279;)V[2*e+1]=7,e++,l[7]++;for(;e<=287;)V[2*e+1]=8,e++,l[8]++;for(me(V,287,l),e=0;e<p;e++)k[2*e+1]=5,k[2*e]=i(e,5);D=new U(V,B,257,P,L),C=new U(k,X,0,p,L),q=new U(new Array(0),z,0,19,7)})(),N=!0),e.l_desc=new h(e.dyn_ltree,D),e.d_desc=new h(e.dyn_dtree,C),e.bl_desc=new h(e.bl_tree,q),e.bi_buf=0,e.bi_valid=0,r(e)},e.exports._tr_stored_block=u,e.exports._tr_flush_block=(e,d,P,p)=>{let L,B,X=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let d,P=4093624447;for(d=0;d<=31;d++,P>>>=1)if(1&P&&0!==e.dyn_ltree[2*d])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(d=32;d<v;d++)if(0!==e.dyn_ltree[2*d])return 1;return 0})(e)),o(e,e.l_desc),o(e,e.d_desc),X=(e=>{let d;for(K(e,e.dyn_ltree,e.l_desc.max_code),K(e,e.dyn_dtree,e.d_desc.max_code),o(e,e.bl_desc),d=18;d>=3&&0===e.bl_tree[2*W[d]+1];d--);return e.opt_len+=3*(d+1)+5+5+4,d})(e),L=e.opt_len+3+7>>>3,B=e.static_len+3+7>>>3,B<=L&&(L=B)):L=B=P+5,P+4<=L&&-1!==d?u(e,d,P,p):4===e.strategy||B===L?(A(e,2+(p?1:0),3),S(e,V,k)):(A(e,4+(p?1:0),3),((e,d,v,P)=>{let p;for(A(e,d-257,5),A(e,v-1,5),A(e,P-4,4),p=0;p<P;p++)A(e,e.bl_tree[2*W[p]+1],3);Q(e,e.dyn_ltree,d-1),Q(e,e.dyn_dtree,v-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,X+1),S(e,e.dyn_ltree,e.dyn_dtree)),r(e),p&&Z(e)},e.exports._tr_tally=(e,d,P)=>(e.pending_buf[e.d_buf+2*e.last_lit]=d>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&d,e.pending_buf[e.l_buf+e.last_lit]=255&P,e.last_lit++,0===d?e.dyn_ltree[2*P]++:(e.matches++,d--,e.dyn_ltree[2*(F[P]+v+1)]++,e.dyn_dtree[2*l(d)]++),e.last_lit===e.lit_bufsize-1),e.exports._tr_align=e=>{A(e,2,3),x(e,256,V),(e=>{16===e.bi_valid?(n(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},13624:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Dd="",this.state=null,this.data_type=2,this.adler=0}},13226:e=>{function d(e,d,v){for(var P=e.length,p=-1/0,L=1/0,B=0;B<P;B++){var X=(v[0][B]-e[B])/d[B],z=(v[1][B]-e[B])/d[B];if(X>z){var W=X;X=z,z=W}if(z<p||X>L)return 1/0;X>p&&(p=X),z<L&&(L=z)}return p>L?1/0:p}e.exports=function(e,v,P,p){var L=d(v,P,p);if(L===1/0)e=null;else{e=e||[];for(var B=0;B<v.length;B++)e[B]=v[B]+P[B]*L}return e},e.exports.distance=d},14615:(e,d,v)=>{"use strict";v.d(d,{b:()=>B});var P=v(37);const p=P.useLayoutEffect;const L=function(e){var d=(0,P.useRef)(e);return p((function(){d.current=e})),d};var B=function(e){var d=L(e);(0,P.wd)((function(){var e=function(e){var v;if(null!=d.current&&(v=d.current(e)),e.defaultPrevented&&(e.returnValue=""),"string"===typeof v)return e.returnValue=v,v};return window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e)}}),[])}},14576:(e,d,v)=>{"use strict";var P=v(14581),p=Array.prototype.concat,L=Array.prototype.slice,B=e.exports=function(e){for(var d=[],v=0,B=e.length;v<B;v++){var X=e[v];P(X)?d=p.call(d,L.call(X)):d.push(X)}return d};B.wrap=function(e){return function(){return e(B(arguments))}}},14581:e=>{e.exports=function(e){return!(!e||"string"===typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))}},13514:(e,d,v)=>{var P=v(13521);function p(e){for(var d,v,p=0,L=e.length,B=0;B<e.length;){for(d=e[B],v=0;B<L&&e[B]===d;)++B,++v;p+=P.log2(v)/7|0,p+=P.log2(d>>>0)/7|0,p+=2}return p}d.size=p,d.encode=function(e,d){d||(d=new Uint8Array(p(e)));for(var v,P,L=0,B=d.length,X=0;X<e.length;){for(v=e[X],P=0;X<e.length&&e[X]===v;)++X,++P;for(;L<B&&P>=128;)d[L++]=128+(127&P),P>>>=7;if(L>=B)throw new Error("RLE buffer overflow");for(d[L++]=P,v>>>=0;L<B&&v>=128;)d[L++]=128+(127&v),v>>>=7;if(L>=B)throw new Error("RLE buffer overflow");d[L++]=v}return d},d.decode=function(e,d){for(var v,P,p,L,B=d.length,X=e.length,z=0,W=0;W<X;){for(v=0,P=0;W<X&&e[W]>=128;)v+=(127&e[W++])<<P,P+=7;if(v+=e[W++]<<P,W>=X)throw new Error("RLE buffer underrun");if(z+v>B)throw new Error("Chunk buffer overflow");for(p=0,P=0;W<X&&e[W]>=128;)p+=(127&e[W++])<<P,P+=7;if(W>=X)throw new Error("RLE buffer underrun");for(p+=e[W++]<<P,L=0;L<v;++L)d[z++]=p}return d}},13521:(e,d)=>{"use strict";function v(e){var d=32;return(e&=-e)&&d--,65535&e&&(d-=16),16711935&e&&(d-=8),252645135&e&&(d-=4),858993459&e&&(d-=2),1431655765&e&&(d-=1),d}d.INT_BITS=32,d.INT_MAX=2147483647,d.INT_MIN=-1<<31,d.sign=function(e){return(e>0)-(e<0)},d.abs=function(e){var d=e>>31;return(e^d)-d},d.min=function(e,d){return d^(e^d)&-(e<d)},d.max=function(e,d){return e^(e^d)&-(e<d)},d.isPow2=function(e){return!(e&e-1)&&!!e},d.log2=function(e){var d,v;return d=(e>65535)<<4,d|=v=((e>>>=d)>255)<<3,d|=v=((e>>>=v)>15)<<2,(d|=v=((e>>>=v)>3)<<1)|(e>>>=v)>>1},d.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},d.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},d.countTrailingZeros=v,d.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},d.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},d.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var P=new Array(256);!function(e){for(var d=0;d<256;++d){var v=d,P=d,p=7;for(v>>>=1;v;v>>>=1)P<<=1,P|=1&v,--p;e[d]=P<<p&255}}(P),d.reverse=function(e){return P[255&e]<<24|P[e>>>8&255]<<16|P[e>>>16&255]<<8|P[e>>>24&255]},d.interleave2=function(e,d){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))<<1},d.deinterleave2=function(e,d){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>d&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},d.interleave3=function(e,d,v){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<1)|(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<2},d.deinterleave3=function(e,d){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>d&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},d.nextCombination=function(e){var d=e|e-1;return d+1|(~d&-~d)-1>>>v(e)+1}},13555:e=>{"use strict";e.exports=function(e,d,v,P){var p=self||window;try{try{var L;try{L=new p.Blob([e])}catch(W){(L=new(p.BlobBuilder||p.WebKitBlobBuilder||p.MozBlobBuilder||p.MSBlobBuilder)).append(e),L=L.getBlob()}var B=p.URL||p.webkitURL,X=B.createObjectURL(L),z=new p[d](X,v);return B.revokeObjectURL(X),z}catch(W){return new p[d]("data:application/javascript,".concat(encodeURIComponent(e)),v)}}catch(W){if(!P)throw Error("Inline worker is not supported");return new p[d](P,v)}}},13210:(e,d,v)=>{"use strict";function P(e,d,v,P,p){var L={};return Object.keys(P).forEach((function(e){L[e]=P[e]})),L.enumerable=!!L.enumerable,L.configurable=!!L.configurable,("value"in L||L.initializer)&&(L.writable=!0),L=v.slice().reverse().reduce((function(v,P){return P(e,d,v)||v}),L),p&&void 0!==L.initializer&&(L.value=L.initializer?L.initializer.call(p):void 0,L.initializer=void 0),void 0===L.initializer&&(Object.defineProperty(e,d,L),L=null),L}v.d(d,{d:()=>P})},13206:(e,d,v)=>{"use strict";function P(e,d,v,P){v&&Object.defineProperty(e,d,{enumerable:v.enumerable,configurable:v.configurable,writable:v.writable,value:v.initializer?v.initializer.call(P):void 0})}v.d(d,{e:()=>P})},14606:(e,d,v)=>{"use strict";v.d(d,{e:()=>B,i:()=>k,l:()=>X,p:()=>L,q:()=>z,t:()=>p,x:()=>W,y:()=>V});var P=v(12627);class p{constructor(){this._easingMode=p.EASINGMODE_EASEIN}setEasingMode(e){const d=Math.min(Math.max(e,0),2);this._easingMode=d}getEasingMode(){return this._easingMode}easeInCore(e){throw new Error("You must implement this method")}ease(e){switch(this._easingMode){case p.EASINGMODE_EASEIN:return this.easeInCore(e);case p.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return e>=.5?.5*(1-this.easeInCore(2*(1-e)))+.5:.5*this.easeInCore(2*e)}}p.EASINGMODE_EASEIN=0,p.EASINGMODE_EASEOUT=1,p.EASINGMODE_EASEINOUT=2;class L extends p{easeInCore(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)}}class B extends p{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=e}easeInCore(e){const d=Math.max(0,this.amplitude);return Math.pow(e,3)-e*d*Math.sin(3.141592653589793*e)}}class X extends p{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=e,this.bounciness=d}easeInCore(e){const d=Math.max(0,this.bounces);let v=this.bounciness;v<=1&&(v=1.001);const P=Math.pow(v,d),p=1-v,L=(1-P)/p+.5*P,B=e*L,X=Math.log(-B*(1-v)+1)/Math.log(v),z=Math.floor(X),W=z+1,V=(1-Math.pow(v,z))/(p*L),k=.5*(V+(1-Math.pow(v,W))/(p*L)),g=e-k,F=k-V;return-Math.pow(1/v,d-z)/(F*F)*(g-F)*(g+F)}}class z extends p{easeInCore(e){return e*e*e}}class W extends p{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=e,this.springiness=d}easeInCore(e){let d;const v=Math.max(0,this.oscillations),P=Math.max(0,this.springiness);return d=0==P?e:(Math.exp(P*e)-1)/(Math.exp(P)-1),d*Math.sin((6.283185307179586*v+1.5707963267948966)*e)}}class V extends p{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=e}easeInCore(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)}}class k extends p{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=e,this.y1=d,this.x2=v,this.y2=P}easeInCore(e){return P.d.Interpolate(e,this.x1,this.y1,this.x2,this.y2)}}},14116:(e,d,v)=>{"use strict";v.d(d,{c:()=>B});var P=v(12420),p=v(12433),L=v(12833);class B extends L.e{get _matrix(){return this._compose(),this.lg}set _matrix(e){(e.updateFlag!==this.lg.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.lg.L(e),this._markAsDirtyAndDecompose())}constructor(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(e,d.Ae(),!1),this.name=e,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=d,this.lg=(null===p||void 0===p?void 0:p.clone())??P.Matrix.Identity(),this._restMatrix=L??this.lg.clone(),this._bindMatrix=B??this.lg.clone(),this._index=X,this._absoluteMatrix=new P.Matrix,this._absoluteBindMatrix=new P.Matrix,this._absoluteInverseBindMatrix=new P.Matrix,this._finalMatrix=new P.Matrix,d.bones.push(this),this.setParent(v,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(e){this.setParent(e)}setParent(e){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==e){if(this.parent){const e=this.parent.children.indexOf(this);-1!==e&&this.parent.children.splice(e,1)}this._parentNode=e,this.parent&&this.parent.children.push(this),d&&this._updateAbsoluteBindMatrices(),this.HW()}}getLocalMatrix(){return this._compose(),this.lg}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(e){this._restMatrix.L(e)}setRestPose(e){this.setRestMatrix(e)}getBindPose(){return this.getBindMatrix()}setBindMatrix(e){this.bd(e)}setBindPose(e){this.setBindMatrix(e)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const e=P.TmpVectors.mv[0],d=P.TmpVectors.Quaternion[0],v=P.TmpVectors.mv[1];this.getRestMatrix().decompose(e,d,v),this._linkedTransformNode.position.L(v),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??P.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.L(d),this._linkedTransformNode.tv.L(e)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.aX}set position(e){this._decompose(),this.aX.L(e),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(e){this.setRotation(e)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(e){this.setRotationQuaternion(e)}get tv(){return this.getScale()}set tv(e){this.setScale(e)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=P.mv.Zero(),this._localRotation=P.Quaternion.Zero(),this.aX=P.mv.Zero()),this.lg.decompose(this._localScaling,this._localRotation,this.aX))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,P.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.aX,this.lg)):this._needToCompose=!1)}bd(e){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.L(e),d&&this._updateAbsoluteBindMatrices(),v?this._matrix=e:this.HW()}_updateAbsoluteBindMatrices(e){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e||(e=this._bindMatrix),this.parent?e.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.L(e),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),d)for(let v=0;v<this.children.length;v++)this.children[v]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}HW(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.HW(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.HW(),this._needToDecompose=!0}_updatePosition(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=this.getLocalMatrix();if(0==d)p?(L.addAtIndex(12,e.x),L.addAtIndex(13,e.y),L.addAtIndex(14,e.z)):L.setTranslationFromFloats(e.x,e.y,e.z);else{let d=null;v&&(d=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=B._TmpMats[0],z=B._TmpVecs[0];this.parent?v&&d?(X.L(this.parent.getAbsoluteMatrix()),X.multiplyToRef(d,X)):X.L(this.parent.getAbsoluteMatrix()):P.Matrix.IdentityToRef(X),p&&X.setTranslationFromFloats(0,0,0),X.invert(),P.mv.TransformCoordinatesToRef(e,X,z),p?(L.addAtIndex(12,z.x),L.addAtIndex(13,z.y),L.addAtIndex(14,z.z)):L.setTranslationFromFloats(z.x,z.y,z.z)}this._markAsDirtyAndDecompose()}translate(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;this._updatePosition(e,d,v,!0)}setPosition(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;this._updatePosition(e,d,v,!1)}setAbsolutePosition(e,d){this.setPosition(e,1,d)}scale(e,d,v){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const L=this.getLocalMatrix(),X=B._TmpMats[0];P.Matrix.ScalingToRef(e,d,v,X),X.multiplyToRef(L,L),X.invert();for(const P of this.children){const p=P.getLocalMatrix();p.multiplyToRef(X,p),p.multiplyAtIndex(12,e),p.multiplyAtIndex(13,d),p.multiplyAtIndex(14,v),P._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),p)for(const P of this.children)P.scale(e,d,v,p)}setScale(e){this._decompose(),this._localScaling.L(e),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(e){this._decompose(),e.L(this._localScaling)}setYawPitchRoll(e,d,v){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4?arguments[4]:void 0;if(0===p){const X=B._TmpQuat;return P.Quaternion.RotationYawPitchRollToRef(e,d,v,X),void this.setRotationQuaternion(X,p,L)}const X=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,L))return;const z=B._TmpMats[1];P.Matrix.RotationYawPitchRollToRef(e,d,v,z),X.multiplyToRef(z,z),this._rotateWithMatrix(z,p,L)}rotate(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3?arguments[3]:void 0;const L=B._TmpMats[0];L.setTranslationFromFloats(0,0,0),P.Matrix.RotationAxisToRef(e,d,L),this._rotateWithMatrix(L,v,p)}setAxisAngle(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,p=arguments.length>3?arguments[3]:void 0;if(0===v){const L=B._TmpQuat;return P.Quaternion.RotationAxisToRef(e,d,L),void this.setRotationQuaternion(L,v,p)}const L=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,p))return;const X=B._TmpMats[1];P.Matrix.RotationAxisToRef(e,d,X),L.multiplyToRef(X,X),this._rotateWithMatrix(X,v,p)}setRotation(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(e.y,e.x,e.z,d,v)}setRotationQuaternion(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;if(0===d)return this._decompose(),this._localRotation.L(e),void this._markAsDirtyAndCompose();const p=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,v))return;const L=B._TmpMats[1];P.Matrix.FromQuaternionToRef(e,L),p.multiplyToRef(L,L),this._rotateWithMatrix(L,d,v)}setRotationMatrix(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;if(0===d){const p=B._TmpQuat;return P.Quaternion.FromRotationMatrixToRef(e,p),void this.setRotationQuaternion(p,d,v)}const p=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,v))return;const L=B._TmpMats[1];L.L(e),p.multiplyToRef(e,L),this._rotateWithMatrix(L,d,v)}_rotateWithMatrix(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;const P=this.getLocalMatrix(),p=P.m[12],L=P.m[13],X=P.m[14],z=this.getParent(),W=B._TmpMats[3],V=B._TmpMats[4];z&&1==d?(v?(W.L(v.getWorldMatrix()),z.getAbsoluteMatrix().multiplyToRef(W,W)):W.L(z.getAbsoluteMatrix()),V.L(W),V.invert(),P.multiplyToRef(W,P),P.multiplyToRef(e,P),P.multiplyToRef(V,P)):1==d&&v?(W.L(v.getWorldMatrix()),V.L(W),V.invert(),P.multiplyToRef(W,P),P.multiplyToRef(e,P),P.multiplyToRef(V,P)):P.multiplyToRef(e,P),P.setTranslationFromFloats(p,L,X),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(e,d){const v=B._TmpMats[2];return e.L(this.getAbsoluteMatrix()),d?(e.multiplyToRef(d.getWorldMatrix(),e),P.Matrix.ScalingToRef(d.tv.x,d.tv.y,d.tv.z,v)):P.Matrix.IdentityToRef(v),e.invert(),!isNaN(e.m[0])&&(v.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(v,e),!0)}Xd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=P.mv.Zero();return this.getPositionToRef(e,d,v),v}getPositionToRef(){let e=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const e=this.getLocalMatrix();d.x=e.m[12],d.y=e.m[13],d.z=e.m[14]}else{let v=null;e&&(v=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let P=B._TmpMats[0];e&&v?(P.L(this.getAbsoluteMatrix()),P.multiplyToRef(v,P)):P=this.getAbsoluteMatrix(),d.x=P.m[12],d.y=P.m[13],d.z=P.m[14]}}getAbsolutePosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=P.mv.Zero();return this.getPositionToRef(1,e,d),d}getAbsolutePositionToRef(e,d){this.getPositionToRef(1,e,d)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.lg.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.L(this.lg);const e=this._skeleton.getPoseMatrix();e&&this._absoluteMatrix.multiplyToRef(e,this._absoluteMatrix)}const e=this.children,d=e.length;for(let v=0;v<d;v++)e[v].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Dz(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=P.mv.Zero();return this.getDirectionToRef(e,d,v),v}getDirectionToRef(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0,p=null;d&&(p=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=B._TmpMats[0];L.L(this.getAbsoluteMatrix()),d&&p&&L.multiplyToRef(p,L),P.mv.TransformNormalToRef(e,L,v),v.normalize()}getRotation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=P.mv.Zero();return this.getRotationToRef(e,d,v),v}getRotationToRef(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0;const P=B._TmpQuat;this.getRotationQuaternionToRef(e,d,P),P.toEulerAnglesToRef(v)}getRotationQuaternion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=P.Quaternion.Identity();return this.getRotationQuaternionToRef(e,d,v),v}getRotationQuaternionToRef(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),d.L(this._localRotation);else{const v=B._TmpMats[0],P=this.getAbsoluteMatrix();e?P.multiplyToRef(e.getWorldMatrix(),v):v.L(P),v.multiplyAtIndex(0,this._scalingDeterminant),v.multiplyAtIndex(1,this._scalingDeterminant),v.multiplyAtIndex(2,this._scalingDeterminant),v.decompose(void 0,d,void 0)}}getRotationMatrix(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1?arguments[1]:void 0;const v=P.Matrix.Identity();return this.getRotationMatrixToRef(e,d,v),v}getRotationMatrixToRef(){let e=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(d);else{const v=B._TmpMats[0],P=this.getAbsoluteMatrix();e?P.multiplyToRef(e.getWorldMatrix(),v):v.L(P),v.multiplyAtIndex(0,this._scalingDeterminant),v.multiplyAtIndex(1,this._scalingDeterminant),v.multiplyAtIndex(2,this._scalingDeterminant),v.getRotationMatrixToRef(d)}}getAbsolutePositionFromLocal(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=P.mv.Zero();return this.getAbsolutePositionFromLocalToRef(e,d,v),v}getAbsolutePositionFromLocalToRef(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0,p=null;d&&(p=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=B._TmpMats[0];L.L(this.getAbsoluteMatrix()),d&&p&&L.multiplyToRef(p,L),P.mv.TransformCoordinatesToRef(e,L,v)}getLocalPositionFromAbsolute(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=P.mv.Zero();return this.getLocalPositionFromAbsoluteToRef(e,d,v),v}getLocalPositionFromAbsoluteToRef(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0,p=null;d&&(p=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=B._TmpMats[0];L.L(this.getAbsoluteMatrix()),d&&p&&L.multiplyToRef(p,L),L.invert(),P.mv.TransformCoordinatesToRef(e,L,v)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const e=this._skeleton.bones.indexOf(this);if(-1!==e&&this._skeleton.bones.splice(e,1),this._parentNode&&this._parentNode.children){const e=this._parentNode.children,d=e.indexOf(this);-1!==d&&e.splice(d,1)}super.dispose()}}B._TmpVecs=(0,p.e)(2,P.mv.Zero),B._TmpQuat=P.Quaternion.Identity(),B._TmpMats=(0,p.e)(5,P.Matrix.Identity)},14601:(e,d,v)=>{"use strict";v.d(d,{c:()=>o});var P=v(12403),p=v(12409),L=v(12248),B=v(12420),X=v(12440),z=v(12833),W=v(12864),V=v(12688),k=v(12265),g=v(12429);class F{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(e){this._idleRotationSpeed=e}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(e){this._idleRotationWaitTime=e}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(e){this._idleRotationSpinupTime=e}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(e){this._attachedCamera=e;const d=this._attachedCamera.Ae();this._onPrePointerObservableObserver=d.onPrePointerObservable.add((e=>{e.type!==V.c.POINTERDOWN?e.type===V.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const e=k.d.Now;let d=0;null!=this._lastFrameTime&&(d=e-this._lastFrameTime),this._lastFrameTime=e,this._applyUserInteraction();const v=e-this._lastInteractionTime-this._idleRotationWaitTime,P=Math.max(Math.min(v/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*P,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(d/1e3))}))}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.Ae();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(e){this._lastInteractionTime=e??k.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<g.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=k.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var w=v(14606),G=v(12948);class U{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(e){if(this._autoTransitionRange===e)return;this._autoTransitionRange=e;const d=this._attachedCamera;d&&(e?this._onMeshTargetChangedObserver=d.onMeshTargetChangedObservable.add((e=>{if(e&&(e.Md(!0),e.getBoundingInfo)){const d=e.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*d,this.upperRadiusTransitionRange=.05*d}})):this._onMeshTargetChangedObserver&&d.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(e){this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(e){return!!this._attachedCamera&&(this._attachedCamera.radius===e&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(e){if(!this._attachedCamera)return;this._radiusBounceTransition||(U.EasingFunction.setEasingMode(U.EasingMode),this._radiusBounceTransition=G.e.CreateAnimation("radius",G.e.ANIMATIONTYPE_FLOAT,60,U.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const d=G.e.TransitionTo("radius",this._attachedCamera.radius+e,this._attachedCamera,this._attachedCamera.Ae(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));d&&this._animatables.push(d)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}U.EasingFunction=new w.e(.3),U.EasingMode=w.t.EASINGMODE_EASEOUT;class D{constructor(){this.onTargetFramingAnimationEndObservable=new L.d,this._mode=D.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(e){this._mode=e}get mode(){return this._mode}set radiusScale(e){this._radiusScale=e}get radiusScale(){return this._radiusScale}set positionScale(e){this._positionScale=e}get positionScale(){return this._positionScale}set defaultElevation(e){this._defaultElevation=e}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(e){this._elevationReturnTime=e}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(e){this._elevationReturnWaitTime=e}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(e){this._zoomStopsAnimation=e}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(e){this._framingTime=e}get framingTime(){return this._framingTime}init(){}attach(e){this._attachedCamera=e;const d=this._attachedCamera.Ae();D.EasingFunction.setEasingMode(D.EasingMode),this._onPrePointerObservableObserver=d.onPrePointerObservable.add((e=>{e.type!==V.c.POINTERDOWN?e.type===V.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add((e=>{e&&e.getBoundingInfo&&this.zoomOnMesh(e,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const e=this._attachedCamera.Ae();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.Md(!0);const P=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(P.minimumWorld,P.maximumWorld,d,v)}zoomOnMeshHierarchy(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.Md(!0);const P=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(P.min,P.max,d,v)}zoomOnMeshesHierarchy(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new B.mv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new B.mv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let L=0;L<e.length;L++){const d=e[L].getHierarchyBoundingVectors(!0);B.mv.CheckExtends(d.min,P,p),B.mv.CheckExtends(d.max,P,p)}this.zoomOnBoundingInfo(P,p,d,v)}zoomOnBoundingInfo(e,d){let v,P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const L=e.y,X=L+(d.y-L)*this._positionScale,z=d.Zd(e).scale(.5);if(!isFinite(X))return!1;if(P)v=new B.mv(0,X,0);else{const d=e.add(z);v=new B.mv(d.x,X,d.z)}this._vectorTransition||(this._vectorTransition=G.e.CreateAnimation("target",G.e.ANIMATIONTYPE_VECTOR3,60,D.EasingFunction)),this._betaIsAnimating=!0;let W=G.e.TransitionTo("target",v,this._attachedCamera,this._attachedCamera.Ae(),60,this._vectorTransition,this._framingTime);W&&this._animatables.push(W);let V=0;if(this._mode===D.FitFrustumSidesMode){const v=this._calculateLowerRadiusFromModelBoundingSphere(e,d);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=z.length()+this._attachedCamera.td),V=v}else this._mode===D.IgnoreBoundsSizeMode&&(V=this._calculateLowerRadiusFromModelBoundingSphere(e,d),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.td));if(this.autoCorrectCameraLimitsAndSensibility){const v=d.Zd(e).length();this._attachedCamera.panningSensibility=5e3/v,this._attachedCamera.wheelPrecision=100/V}return this._radiusTransition||(this._radiusTransition=G.e.CreateAnimation("radius",G.e.ANIMATIONTYPE_FLOAT,60,D.EasingFunction)),W=G.e.TransitionTo("radius",V,this._attachedCamera,this._attachedCamera.Ae(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),p&&p(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),W&&this._animatables.push(W),!0}_calculateLowerRadiusFromModelBoundingSphere(e,d){const v=this._attachedCamera;if(!v)return 0;let P=v._calculateLowerRadiusFromModelBoundingSphere(e,d,this._radiusScale);return v.lowerRadiusLimit&&this._mode===D.IgnoreBoundsSizeMode&&(P=P<v.lowerRadiusLimit?v.lowerRadiusLimit:P),v.upperRadiusLimit&&(P=P>v.upperRadiusLimit?v.upperRadiusLimit:P),P}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const e=k.d.Now-this._lastInteractionTime,d=.5*Math.PI-this._defaultElevation,v=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>v&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=G.e.CreateAnimation("beta",G.e.ANIMATIONTYPE_FLOAT,60,D.EasingFunction));const e=G.e.TransitionTo("beta",d,this._attachedCamera,this._attachedCamera.Ae(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));e&&this._animatables.push(e)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=k.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}D.EasingFunction=new w.y,D.EasingMode=w.t.EASINGMODE_EASEINOUT,D.IgnoreBoundsSizeMode=0,D.FitFrustumSidesMode=1;var C=v(12872),q=v(12905),h=v(14107),l=v(12240);class n{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(e){e=l.Tools.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),v=d.getInputElement();let P=0,p=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=L=>{var B,X;const z=L.event,W="touch"===z.pointerType;if(L.type!==V.c.POINTERMOVE&&-1===this.buttons.indexOf(z.button))return;const k=z.target;if(this._altKey=z.altKey,this._ctrlKey=z.ctrlKey,this._metaKey=z.metaKey,this._shiftKey=z.shiftKey,this._buttonsPressed=z.buttons,d.isPointerLock){const e=z.movementX,d=z.movementY;this.onTouch(null,e,d),this._pointA=null,this._pointB=null}else{if(L.type!==V.c.POINTERDOWN&&L.type!==V.c.POINTERDOUBLETAP&&W&&(null===(B=this._pointA)||void 0===B?void 0:B.pointerId)!==z.pointerId&&(null===(X=this._pointB)||void 0===X?void 0:X.pointerId)!==z.pointerId)return;if(L.type!==V.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!W)if(L.type===V.c.POINTERDOUBLETAP)this.onDoubleTap(z.pointerType);else if(L.type!==V.c.POINTERUP||this._currentMousePointerIdDown!==z.pointerId&&!W){if(L.type===V.c.POINTERMOVE)if(e||z.preventDefault(),this._pointA&&null===this._pointB){const e=z.clientX-this._pointA.x,d=z.clientY-this._pointA.y;this._pointA.x=z.clientX,this._pointA.y=z.clientY,this.onTouch(this._pointA,e,d)}else if(this._pointA&&this._pointB){const e=this._pointA.pointerId===z.pointerId?this._pointA:this._pointB;e.x=z.clientX,e.y=z.clientY;const d=this._pointA.x-this._pointB.x,v=this._pointA.y-this._pointB.y,B=d*d+v*v,X={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:z.pointerId,type:L.type};this.onMultiTouch(this._pointA,this._pointB,P,B,p,X),p=X,P=B}}else{try{null===k||void 0===k||k.releasePointerCapture(z.pointerId)}catch(g){}W||(this._pointB=null),d._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==z.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==z.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==P||p)&&(this.onMultiTouch(this._pointA,this._pointB,P,0,p,null),P=0,p=null),this._currentMousePointerIdDown=-1,this.onButtonUp(z),e||z.preventDefault()}else{try{null===k||void 0===k||k.setPointerCapture(z.pointerId)}catch(g){}if(null===this._pointA)this._pointA={x:z.clientX,y:z.clientY,pointerId:z.pointerId,type:z.pointerType};else{if(null!==this._pointB)return;this._pointB={x:z.clientX,y:z.clientY,pointerId:z.pointerId,type:z.pointerType}}-1!==this._currentMousePointerIdDown||W||(this._currentMousePointerIdDown=z.pointerId),this.onButtonDown(z),e||(z.preventDefault(),v&&v.focus())}}},this._observer=this.camera.Ae()._inputManager._addCameraPointerObserver(this._pointerInput,V.c.POINTERDOWN|V.c.POINTERUP|V.c.POINTERMOVE|V.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,P=0,p=null,this.onLostFocus()},this._contextMenuBind=e=>this.onContextMenu(e),v&&v.addEventListener("contextmenu",this._contextMenuBind,!1);const L=this.camera.Ae().getEngine().getHostWindow();L&&l.Tools.RegisterTopRootEvents(L,[{name:"blur",handler:this._onLostFocus}])}rk(){if(this._onLostFocus){const e=this.camera.Ae().getEngine().getHostWindow();e&&l.Tools.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Ae()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const e=this.camera.Ae().getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(e){}onTouch(e,d,v){}onMultiTouch(e,d,v,P,p,L){}onContextMenu(e){e.preventDefault()}onButtonDown(e){}onButtonUp(e){}onLostFocus(){}}(0,P.e)([(0,p.M)()],n.prototype,"buttons",void 0);class A extends n{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(e,d){if(0!==this.panningSensibility&&e&&d){const v=d.x-e.x,P=d.y-e.y;this.camera.inertialPanningX+=-v/this.panningSensibility,this.camera.inertialPanningY+=P/this.panningSensibility}}_computePinchZoom(e,d){const v=this.camera.radius||A.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=v*Math.sqrt(e)/Math.sqrt(d):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(d-e)*v*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(d-e)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(e,d,v){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-d/this.panningSensibility,this.camera.inertialPanningY+=v/this.panningSensibility):(this.camera.inertialAlphaOffset-=d/this.angularSensibilityX,this.camera.inertialBetaOffset-=v/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(e,d,v,P,p,L){0===v&&null===p||0===P&&null===L||(this.multiTouchPanAndZoom?(this._computePinchZoom(v,P),this._computeMultiTouchPanning(p,L)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(P)-Math.sqrt(v))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(v,P),this._isPinching=!0):this._computeMultiTouchPanning(p,L)):this.multiTouchPanning?this._computeMultiTouchPanning(p,L):this.pinchZoom&&this._computePinchZoom(v,P))}onButtonDown(e){this._isPanClick=e.button===this.camera._panningMouseButton}onButtonUp(e){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}A.MinimumRadiusForPinch=.001,(0,P.e)([(0,p.M)()],A.prototype,"buttons",void 0),(0,P.e)([(0,p.M)()],A.prototype,"angularSensibilityX",void 0),(0,P.e)([(0,p.M)()],A.prototype,"angularSensibilityY",void 0),(0,P.e)([(0,p.M)()],A.prototype,"pinchPrecision",void 0),(0,P.e)([(0,p.M)()],A.prototype,"pinchDeltaPercentage",void 0),(0,P.e)([(0,p.M)()],A.prototype,"useNaturalPinchZoom",void 0),(0,P.e)([(0,p.M)()],A.prototype,"pinchZoom",void 0),(0,P.e)([(0,p.M)()],A.prototype,"panningSensibility",void 0),(0,P.e)([(0,p.M)()],A.prototype,"multiTouchPanning",void 0),(0,P.e)([(0,p.M)()],A.prototype,"multiTouchPanAndZoom",void 0),h.d.ArcRotateCameraPointersInput=A;var x=v(12696);class i{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(e){e=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ae(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const v=d.event;if(!v.metaKey)if(d.type===x.e.KEYDOWN){if(this._ctrlPressed=v.ctrlKey,this._altPressed=v.altKey,-1!==this.keysUp.indexOf(v.keyCode)||-1!==this.keysDown.indexOf(v.keyCode)||-1!==this.keysLeft.indexOf(v.keyCode)||-1!==this.keysRight.indexOf(v.keyCode)||-1!==this.keysReset.indexOf(v.keyCode)){-1===this._keys.indexOf(v.keyCode)&&this._keys.push(v.keyCode),v.preventDefault&&(e||v.preventDefault())}}else if(-1!==this.keysUp.indexOf(v.keyCode)||-1!==this.keysDown.indexOf(v.keyCode)||-1!==this.keysLeft.indexOf(v.keyCode)||-1!==this.keysRight.indexOf(v.keyCode)||-1!==this.keysReset.indexOf(v.keyCode)){const d=this._keys.indexOf(v.keyCode);d>=0&&this._keys.splice(d,1),v.preventDefault&&(e||v.preventDefault())}})))}rk(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let d=0;d<this._keys.length;d++){const v=this._keys[d];-1!==this.keysLeft.indexOf(v)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(v)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(v)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(v)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(v)&&e.useInputToRestoreState&&e.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,P.e)([(0,p.M)()],i.prototype,"keysUp",void 0),(0,P.e)([(0,p.M)()],i.prototype,"keysDown",void 0),(0,P.e)([(0,p.M)()],i.prototype,"keysLeft",void 0),(0,P.e)([(0,p.M)()],i.prototype,"keysRight",void 0),(0,P.e)([(0,p.M)()],i.prototype,"keysReset",void 0),(0,P.e)([(0,p.M)()],i.prototype,"panningSensibility",void 0),(0,P.e)([(0,p.M)()],i.prototype,"zoomingSensibility",void 0),(0,P.e)([(0,p.M)()],i.prototype,"useAltToZoom",void 0),(0,P.e)([(0,p.M)()],i.prototype,"angularSpeed",void 0),h.d.ArcRotateCameraKeyboardMoveInput=i;var me=v(12465),r=v(12702);class Z{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new B.mv(0,0,0),this._globalOffset=new B.mv(0,0,0),this._inertialPanning=B.mv.Zero()}_computeDeltaFromMouseWheelLegacyEvent(e,d){let v=0;const P=.01*e*this.wheelDeltaPercentage*d;return v=e>0?P/(1+this.wheelDeltaPercentage):P*(1+this.wheelDeltaPercentage),v}attachControl(e){e=l.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==V.c.POINTERWHEEL)return;const v=d.event;let P=0;const p=v.deltaMode===r.c.DOM_DELTA_LINE?40:1,L=-v.deltaY*p;if(this.customComputeDeltaFromMouseWheel)P=this.customComputeDeltaFromMouseWheel(L,this,v);else if(this.wheelDeltaPercentage){if(P=this._computeDeltaFromMouseWheelLegacyEvent(L,this.camera.radius),P>0){let e=this.camera.radius,d=this.camera.inertialRadiusOffset+P;for(let v=0;v<20&&!(e<=d)&&!(Math.abs(d*this.camera.inertia)<.001);v++)e-=d,d*=this.camera.inertia;e=(0,X.Clamp)(e,0,Number.MAX_VALUE),P=this._computeDeltaFromMouseWheelLegacyEvent(L,e)}}else P=L/(40*this.wheelPrecision);P&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(P)):this.camera.inertialRadiusOffset+=P),v.preventDefault&&(e||v.preventDefault())},this._observer=this.camera.Ae()._inputManager._addCameraPointerObserver(this._wheel,V.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.dp(0)}rk(){this._observer&&(this.camera.Ae()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const e=this.camera;0+e.inertialAlphaOffset+e.inertialBetaOffset+e.inertialRadiusOffset&&(this._updateHitPlane(),e.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(e.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const e=this.camera,d=e.target.Zd(e.position);this._hitPlane=me.d.FromPositionAndNormal(e.target,d)}_getPosition(){const e=this.camera,d=e.Ae(),v=d.createPickingRay(d.pointerX,d.pointerY,B.Matrix.Identity(),e,!1);0===e.targetScreenOffset.x&&0===e.targetScreenOffset.y||(this._viewOffset.set(e.targetScreenOffset.x,e.targetScreenOffset.y,0),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),this._globalOffset=B.mv.TransformNormal(this._viewOffset,e._cameraTransformMatrix),v.origin.addInPlace(this._globalOffset));let P=0;return this._hitPlane&&(P=v.intersectsPlane(this._hitPlane)??0),v.origin.addInPlace(v.direction.scaleInPlace(P))}_zoomToMouse(e){const d=this.camera,v=1-d.inertia;if(d.lowerRadiusLimit){const P=d.lowerRadiusLimit??0;d.radius-(d.inertialRadiusOffset+e)/v<P&&(e=(d.radius-P)*v-d.inertialRadiusOffset)}if(d.upperRadiusLimit){const P=d.upperRadiusLimit??0;d.radius-(d.inertialRadiusOffset+e)/v>P&&(e=(d.radius-P)*v-d.inertialRadiusOffset)}const P=e/v/d.radius,p=this._getPosition(),L=B.TmpVectors.mv[6];p.subtractToRef(d.target,L),L.scaleInPlace(P),L.scaleInPlace(v),this._inertialPanning.addInPlace(L),d.inertialRadiusOffset+=e}_zeroIfClose(e){Math.abs(e.x)<g.e&&(e.x=0),Math.abs(e.y)<g.e&&(e.y=0),Math.abs(e.z)<g.e&&(e.z=0)}}(0,P.e)([(0,p.M)()],Z.prototype,"wheelPrecision",void 0),(0,P.e)([(0,p.M)()],Z.prototype,"zoomToMouseLocation",void 0),(0,P.e)([(0,p.M)()],Z.prototype,"wheelDeltaPercentage",void 0),h.d.ArcRotateCameraMouseWheelInput=Z;class f extends h.h{constructor(e){super(e)}addMouseWheel(){return this.add(new Z),this}addPointers(){return this.add(new A),this}addKeyboard(){return this.add(new i),this}}var T=v(12381);function S(e,d){return isNaN(e)?d:e}z.e.AddNodeConstructor("ArcRotateCamera",((e,d)=>()=>new o(e,0,0,1,B.mv.Zero(),d)));class o extends q.c{get target(){return this._target}set target(e){this.setTarget(e)}get targetHost(){return this._targetHost}set targetHost(e){e&&this.setTarget(e)}getTarget(){return this.target}get position(){return this._position}set position(e){this.setPosition(e)}set upVector(e){this._upToYMatrix||(this._yToUpMatrix=new B.Matrix,this._upToYMatrix=new B.Matrix,this._upVector=B.mv.Zero()),e.normalize(),this._upVector.L(e),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){B.Matrix.RotationAlignToRef(B.mv.UpReadOnly,this._upVector,this._yToUpMatrix),B.Matrix.RotationAlignToRef(this._upVector,B.mv.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0}set angularSensibilityX(e){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityX=e)}get angularSensibilityY(){const e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0}set angularSensibilityY(e){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityY=e)}get pinchPrecision(){const e=this.inputs.attached.pointers;return e?e.pinchPrecision:0}set pinchPrecision(e){const d=this.inputs.attached.pointers;d&&(d.pinchPrecision=e)}get pinchDeltaPercentage(){const e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0}set pinchDeltaPercentage(e){const d=this.inputs.attached.pointers;d&&(d.pinchDeltaPercentage=e)}get useNaturalPinchZoom(){const e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom}set useNaturalPinchZoom(e){const d=this.inputs.attached.pointers;d&&(d.useNaturalPinchZoom=e)}get panningSensibility(){const e=this.inputs.attached.pointers;return e?e.panningSensibility:0}set panningSensibility(e){const d=this.inputs.attached.pointers;d&&(d.panningSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const d=this.inputs.attached.keyboard;d&&(d.keysUp=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const d=this.inputs.attached.keyboard;d&&(d.keysDown=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const d=this.inputs.attached.keyboard;d&&(d.keysRight=e)}get wheelPrecision(){const e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0}set wheelPrecision(e){const d=this.inputs.attached.mousewheel;d&&(d.wheelPrecision=e)}get zoomToMouseLocation(){const e=this.inputs.attached.mousewheel;return!!e&&e.zoomToMouseLocation}set zoomToMouseLocation(e){const d=this.inputs.attached.mousewheel;d&&(d.zoomToMouseLocation=e)}get wheelDeltaPercentage(){const e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0}set wheelDeltaPercentage(e){const d=this.inputs.attached.mousewheel;d&&(d.wheelDeltaPercentage=e)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new U,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new D,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new F,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(e,d,v,P,p,X){var z;let W=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(e,B.mv.Zero(),X,W),z=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=B.mv.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=B.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new B.Matrix,this.panningAxis=new B.mv(1,1,0),this._transformedDirection=new B.mv,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new L.d,this.checkCollisions=!1,this.collisionRadius=new B.mv(.5,.5,.5),this._previousPosition=B.mv.Zero(),this._collisionVelocity=B.mv.Zero(),this._newPosition=B.mv.Zero(),this._computationVector=B.mv.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new B.mv(NaN,NaN,NaN),this._goalTargetScreenOffset=new B.Vector2(NaN,NaN),this._onCollisionPositionChange=function(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v?(z.setPosition(d),z.iF&&z.iF(v)):z._previousPosition.L(z._position);const P=Math.cos(z.alpha),p=Math.sin(z.alpha),L=Math.cos(z.beta);let B=Math.sin(z.beta);0===B&&(B=1e-4);const X=z._getTargetPosition();z._computationVector.Ed(z.radius*P*B,z.radius*L,z.radius*p*B),X.addToRef(z._computationVector,z._newPosition),z._position.L(z._newPosition);let W=z.upVector;z.allowUpsideDown&&z.beta<0&&(W=W.clone(),W=W.negate()),z._computeViewMatrix(z._position,X,W),z._viewMatrix.addAtIndex(12,z.targetScreenOffset.x),z._viewMatrix.addAtIndex(13,z.targetScreenOffset.y),z._collisionTriggered=!1},this._target=B.mv.Zero(),p&&this.setTarget(p),this.alpha=d,this.beta=v,this.radius=P,this.getViewMatrix(),this.inputs=new f(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new B.mv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=B.Vector2.Zero()}_updateCache(e){e||super._updateCache(),this._cache._target.L(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.L(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.L(e)}const e=this._getLockedTargetPosition();return e||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>g.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,L=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=L?this._currentInterpolationFactor=L:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=S(e,this._goalAlpha),this._goalBeta=S(d,this._goalBeta),this._goalRadius=S(v,this._goalRadius),this._goalTarget.set(S(P.x,this._goalTarget.x),S(P.y,this._goalTarget.y),S(P.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(S(p.x,this._goalTargetScreenOffset.x),S(p.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,X.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,X.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,X.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,X.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(e,d){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const p=arguments;d=l.Tools.BackCompatCameraNoPreventDefault(p),this._useCtrlForPanning=v,this._panningMouseButton=P,"boolean"===typeof p[0]&&(p.length>1&&(this._useCtrlForPanning=p[1]),p.length>2&&(this._panningMouseButton=p[2])),this.inputs.attachElement(d),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}rk(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let e=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){e=!0;const d=this.invertRotation?-1:1,v=this._calculateHandednessMultiplier();let P=this.inertialAlphaOffset*v;this.beta<0&&(P*=-1),this.alpha+=P*d,this.beta+=this.inertialBetaOffset*d,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<g.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<g.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*g.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){e=!0;const d=new B.mv(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),d.multiplyInPlace(this.panningAxis),B.mv.TransformNormalToRef(d,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const e=this.upVector,d=B.mv.CrossToRef(this._transformedDirection,e,this._transformedDirection);B.mv.CrossToRef(e,d,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);B.mv.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.L(this._transformedDirection)}else{if(this.parent){const e=B.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.transposeToRef(e),B.mv.TransformCoordinatesToRef(this._transformedDirection,e,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*g.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*g.e&&(this.inertialPanningY=0)}if(e)this.stopInterpolation();else if(this._isInterpolating){let e=!1;const d=this._scene.getEngine().getDeltaTime()/1e3,v=1-Math.pow(2,-d/this._currentInterpolationFactor),P=S(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const d=B.TmpVectors.mv[0].set(S(this._goalTarget.x,this._target.x),S(this._goalTarget.y,this._target.y),S(this._goalTarget.z,this._target.z));B.mv.LerpToRef(this.target,d,v,this._target),10*B.mv.Distance(this.target,d)/P<g.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.L(d),this.setTarget(this.target,!1,!0,!0)):e=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const d=B.Quaternion.RotationAlphaBetaGammaToRef(S(this._goalAlpha,this.alpha),S(this._goalBeta,this.beta),0,B.TmpVectors.Quaternion[0]),P=B.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,B.TmpVectors.Quaternion[1]),p=B.Quaternion.SlerpToRef(P,d,v,B.TmpVectors.Quaternion[2]);p.normalize();const L=p.toAlphaBetaGammaToRef(B.TmpVectors.mv[0]);if(this.alpha=L.x,this.beta=L.y,p.isApprox(d,g.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const e=d.toAlphaBetaGammaToRef(B.TmpVectors.mv[0]);this.alpha=e.x,this.beta=e.y}else e=!0}if(isNaN(this._goalRadius)||(this.radius+=(P-this.radius)*v,Math.abs(P/this.radius-1)<g.e?(this._goalRadius=NaN,this.radius=P):e=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const d=B.TmpVectors.Vector2[0].set(S(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),S(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));B.Vector2.LerpToRef(this.targetScreenOffset,d,v,this.targetScreenOffset),B.Vector2.Distance(this.targetScreenOffset,d)<g.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.L(d)):e=!0}this._isInterpolating=e}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.mv.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const e=this.alpha;var d,v;this.alpha=function(e){let d=Math.PI/2;return 0===e.x&&0===e.z||(d=Math.acos(e.x/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2)))),e.z<0&&(d=2*Math.PI-d),d}(this._computationVector),this.beta=(d=this._computationVector.y,v=this.radius,Math.acos(d/v));const P=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*P*Math.PI,this._checkLimits()}setPosition(e){this._position.equals(e)||(this._position.L(e),this.rebuildAnglesAndRadius())}setTarget(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(P=this.overrideCloneAlphaBetaRadius??P,e.Md)d&&e.getBoundingInfo?this._targetBoundingCenter=e.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,e.Md(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const d=e,P=this._getTargetPosition();if(P&&!v&&P.equals(d))return;this._targetHost=null,this._target=d,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}P||this.rebuildAnglesAndRadius()}_getViewMatrix(){const e=Math.cos(this.alpha),d=Math.sin(this.alpha),v=Math.cos(this.beta);let P=Math.sin(this.beta);0===P&&(P=1e-4),0===this.radius&&(this.radius=1e-4);const p=this._getTargetPosition();if(this._computationVector.Ed(this.radius*e*P,this.radius*v,this.radius*d*P),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.mv.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),p.addToRef(this._computationVector,this._newPosition),this.Ae().collisionsEnabled&&this.checkCollisions){const e=this.Ae().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,e.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.L(this._newPosition);let e=this.upVector;this.allowUpsideDown&&P<0&&(e=e.negate()),this._computeViewMatrix(this._position,p,e),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.L(p),this._viewMatrix}zoomOn(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e||this.Ae().meshes;const v=W.b.MinMax(e);let P=this._calculateLowerRadiusFromModelBoundingSphere(v.min,v.max);if(P=Math.max(Math.min(P,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=P*this.zoomOnFactor,this.mode===C.c.ORTHOGRAPHIC_CAMERA){const e=this.Ae().getEngine().getAspectRatio(this),d=P*this.zoomOnFactor/2;this.orthoLeft=-d*e,this.orthoRight=d*e,this.orthoBottom=-d,this.orthoTop=d}this.focusOn({min:v.min,max:v.max,distance:P},d)}focusOn(e){let d,v,P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===e.min){const P=e||this.Ae().meshes;d=W.b.MinMax(P),v=B.mv.Distance(d.min,d.max)}else{d=e,v=e.distance}this._target=W.b.Center(d),P||(this.maxZ=2*v)}createRigCamera(e,d){let v=0;switch(this.cameraRigMode){case C.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.c.RIG_MODE_VR:v=this._cameraRigParams.stereoHalfAngle*(0===d?1:-1);break;case C.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:v=this._cameraRigParams.stereoHalfAngle*(0===d?-1:1)}const P=new o(e,this.alpha+v,this.beta,this.radius,this._target,this.Ae());return P._cameraRigParams={},P.isRigCamera=!0,P.rigParent=this,P.upVector=this.upVector,P.mode=this.mode,P.orthoLeft=this.orthoLeft,P.orthoRight=this.orthoRight,P.orthoBottom=this.orthoBottom,P.orthoTop=this.orthoTop,P}_updateRigCameras(){const e=this._rigCameras[0],d=this._rigCameras[1];switch(e.beta=d.beta=this.beta,this.cameraRigMode){case C.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.c.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case C.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const P=B.mv.Distance(e,d),p=this.Ae().getEngine().getAspectRatio(this),L=Math.tan(this.fov/2),X=L*p,z=.5*P*v,W=z*Math.sqrt(1+1/(X*X)),V=z*Math.sqrt(1+1/(L*L));return Math.max(W,V)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,P.e)([(0,p.M)()],o.prototype,"alpha",void 0),(0,P.e)([(0,p.M)()],o.prototype,"beta",void 0),(0,P.e)([(0,p.M)()],o.prototype,"radius",void 0),(0,P.e)([(0,p.M)()],o.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,P.e)([(0,p.J)("target")],o.prototype,"_target",void 0),(0,P.e)([(0,p.x)("targetHost")],o.prototype,"_targetHost",void 0),(0,P.e)([(0,p.M)()],o.prototype,"inertialAlphaOffset",void 0),(0,P.e)([(0,p.M)()],o.prototype,"inertialBetaOffset",void 0),(0,P.e)([(0,p.M)()],o.prototype,"inertialRadiusOffset",void 0),(0,P.e)([(0,p.M)()],o.prototype,"lowerAlphaLimit",void 0),(0,P.e)([(0,p.M)()],o.prototype,"upperAlphaLimit",void 0),(0,P.e)([(0,p.M)()],o.prototype,"lowerBetaLimit",void 0),(0,P.e)([(0,p.M)()],o.prototype,"upperBetaLimit",void 0),(0,P.e)([(0,p.M)()],o.prototype,"lowerRadiusLimit",void 0),(0,P.e)([(0,p.M)()],o.prototype,"upperRadiusLimit",void 0),(0,P.e)([(0,p.M)()],o.prototype,"lowerTargetYLimit",void 0),(0,P.e)([(0,p.M)()],o.prototype,"inertialPanningX",void 0),(0,P.e)([(0,p.M)()],o.prototype,"inertialPanningY",void 0),(0,P.e)([(0,p.M)()],o.prototype,"pinchToPanMaxDistance",void 0),(0,P.e)([(0,p.M)()],o.prototype,"panningDistanceLimit",void 0),(0,P.e)([(0,p.J)()],o.prototype,"panningOriginTarget",void 0),(0,P.e)([(0,p.M)()],o.prototype,"panningInertia",void 0),(0,P.e)([(0,p.M)()],o.prototype,"zoomToMouseLocation",null),(0,P.e)([(0,p.M)()],o.prototype,"zoomOnFactor",void 0),(0,P.e)([(0,p.G)()],o.prototype,"targetScreenOffset",void 0),(0,P.e)([(0,p.M)()],o.prototype,"allowUpsideDown",void 0),(0,P.e)([(0,p.M)()],o.prototype,"useInputToRestoreState",void 0),(0,P.e)([(0,p.M)()],o.prototype,"restoreStateInterpolationFactor",void 0),(0,T.h)("BABYLON.ArcRotateCamera",o)},14107:(e,d,v)=>{"use strict";v.d(d,{d:()=>B,h:()=>X});var P=v(12253),p=v(12453),L=v(12872),B={};class X{constructor(e){this.attachedToElement=!1,this.attached={},this.camera=e,this.checkInputs=()=>{}}add(e){const d=e.getSimpleName();this.attached[d]?P.c.Warn("camera input of type "+d+" already exists on camera"):(this.attached[d]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl(this.noPreventDefault))}remove(e){for(const d in this.attached){const v=this.attached[d];if(v===e)return v.rk(),v.camera=null,delete this.attached[d],void this.rebuildInputCheck()}}removeByType(e){for(const d in this.attached){const v=this.attached[d];v.getClassName()===e&&(v.rk(),v.camera=null,delete this.attached[d],this.rebuildInputCheck())}}_addCheckInputs(e){const d=this.checkInputs;return()=>{d(),e()}}attachInput(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)}attachElement(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){e=!L.c.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedToElement=!0,this.noPreventDefault=e;for(const d in this.attached)this.attached[d].attachControl(e)}}detachElement(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const d in this.attached)this.attached[d].rk(),e&&(this.attached[d].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const e in this.attached){const d=this.attached[e];d.checkInputs&&(this.checkInputs=this._addCheckInputs(d.checkInputs.bind(d)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(e){const d={};for(const v in this.attached){const e=this.attached[v],P=p.c.Serialize(e);d[e.getClassName()]=P}e.inputsmgr=d}parse(e){const d=e.inputsmgr;if(d){this.clear();for(const e in d){const v=B[e];if(v){const P=d[e],L=p.c.Parse((()=>new v),P,null);this.add(L)}}}else for(const v in this.attached){const d=B[this.attached[v].getClassName()];if(d){const P=p.c.Parse((()=>new d),e,null);this.remove(this.attached[v]),this.add(P)}}}}},14102:(e,d,v)=>{"use strict";v.d(d,{c:()=>n});var P=v(12403),p=v(12409),L=v(12420),B=v(12905),X=v(14107),z=v(12696),W=v(12240);class V{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(e){e=W.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ae(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const v=d.event;if(!v.metaKey)if(d.type===z.e.KEYDOWN){if(-1!==this.keysUp.indexOf(v.keyCode)||-1!==this.keysDown.indexOf(v.keyCode)||-1!==this.keysLeft.indexOf(v.keyCode)||-1!==this.keysRight.indexOf(v.keyCode)||-1!==this.keysUpward.indexOf(v.keyCode)||-1!==this.keysDownward.indexOf(v.keyCode)||-1!==this.keysRotateLeft.indexOf(v.keyCode)||-1!==this.keysRotateRight.indexOf(v.keyCode)||-1!==this.keysRotateUp.indexOf(v.keyCode)||-1!==this.keysRotateDown.indexOf(v.keyCode)){-1===this._keys.indexOf(v.keyCode)&&this._keys.push(v.keyCode),e||v.preventDefault()}}else if(-1!==this.keysUp.indexOf(v.keyCode)||-1!==this.keysDown.indexOf(v.keyCode)||-1!==this.keysLeft.indexOf(v.keyCode)||-1!==this.keysRight.indexOf(v.keyCode)||-1!==this.keysUpward.indexOf(v.keyCode)||-1!==this.keysDownward.indexOf(v.keyCode)||-1!==this.keysRotateLeft.indexOf(v.keyCode)||-1!==this.keysRotateRight.indexOf(v.keyCode)||-1!==this.keysRotateUp.indexOf(v.keyCode)||-1!==this.keysRotateDown.indexOf(v.keyCode)){const d=this._keys.indexOf(v.keyCode);d>=0&&this._keys.splice(d,1),e||v.preventDefault()}})))}rk(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const e=this.camera;for(let d=0;d<this._keys.length;d++){const v=this._keys[d],P=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(v)?e._localDirection.Ed(-P,0,0):-1!==this.keysUp.indexOf(v)?e._localDirection.Ed(0,0,P):-1!==this.keysRight.indexOf(v)?e._localDirection.Ed(P,0,0):-1!==this.keysDown.indexOf(v)?e._localDirection.Ed(0,0,-P):-1!==this.keysUpward.indexOf(v)?e._localDirection.Ed(0,P,0):-1!==this.keysDownward.indexOf(v)?e._localDirection.Ed(0,-P,0):-1!==this.keysRotateLeft.indexOf(v)?(e._localDirection.Ed(0,0,0),e.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(v)?(e._localDirection.Ed(0,0,0),e.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(v)?(e._localDirection.Ed(0,0,0),e.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(v)&&(e._localDirection.Ed(0,0,0),e.cameraRotation.x+=this._getLocalRotation()),e.Ae().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),L.mv.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const e=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*e}}(0,P.e)([(0,p.M)()],V.prototype,"keysUp",void 0),(0,P.e)([(0,p.M)()],V.prototype,"keysUpward",void 0),(0,P.e)([(0,p.M)()],V.prototype,"keysDown",void 0),(0,P.e)([(0,p.M)()],V.prototype,"keysDownward",void 0),(0,P.e)([(0,p.M)()],V.prototype,"keysLeft",void 0),(0,P.e)([(0,p.M)()],V.prototype,"keysRight",void 0),(0,P.e)([(0,p.M)()],V.prototype,"rotationSpeed",void 0),(0,P.e)([(0,p.M)()],V.prototype,"keysRotateLeft",void 0),(0,P.e)([(0,p.M)()],V.prototype,"keysRotateRight",void 0),(0,P.e)([(0,p.M)()],V.prototype,"keysRotateUp",void 0),(0,P.e)([(0,p.M)()],V.prototype,"keysRotateDown",void 0),X.d.FreeCameraKeyboardMoveInput=V;var k=v(12248),g=v(12688);class F{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new k.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(e){e=W.Tools.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),v=d.getInputElement();this._pointerInput||(this._pointerInput=P=>{const p=P.event,L="touch"===p.pointerType;if(!this.touchEnabled&&L)return;if(P.type!==g.c.POINTERMOVE&&-1===this.buttons.indexOf(p.button))return;const B=p.target;if(P.type===g.c.POINTERDOWN){if(L&&-1!==this._activePointerId||!L&&-1!==this._currentActiveButton)return;this._activePointerId=p.pointerId;try{null===B||void 0===B||B.setPointerCapture(p.pointerId)}catch(X){}-1===this._currentActiveButton&&(this._currentActiveButton=p.button),this._previousPosition={x:p.clientX,y:p.clientY},e||(p.preventDefault(),v&&v.focus()),d.isPointerLock&&this._onMouseMove&&this._onMouseMove(P.event)}else if(P.type===g.c.POINTERUP){if(L&&this._activePointerId!==p.pointerId||!L&&this._currentActiveButton!==p.button)return;try{null===B||void 0===B||B.releasePointerCapture(p.pointerId)}catch(X){}this._currentActiveButton=-1,this._previousPosition=null,e||p.preventDefault(),this._activePointerId=-1}else if(P.type===g.c.POINTERMOVE&&(this._activePointerId===p.pointerId||!L))if(d.isPointerLock&&this._onMouseMove)this._onMouseMove(P.event);else if(this._previousPosition){const d=this.camera._calculateHandednessMultiplier(),v=(p.clientX-this._previousPosition.x)*d,P=p.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=v/this.angularSensibility,this.camera.cameraRotation.x+=P/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:v,offsetY:P}),this._previousPosition={x:p.clientX,y:p.clientY},e||p.preventDefault()}}),this._onMouseMove=v=>{if(!d.isPointerLock)return;const P=this.camera._calculateHandednessMultiplier(),p=v.movementX*P;this.camera.cameraRotation.y+=p/this.angularSensibility;const L=v.movementY;this.camera.cameraRotation.x+=L/this.angularSensibility,this._previousPosition=null,e||v.preventDefault()},this._observer=this.camera.Ae()._inputManager._addCameraPointerObserver(this._pointerInput,g.c.POINTERDOWN|g.c.POINTERUP|g.c.POINTERMOVE),v&&(this._contextMenuBind=e=>this.onContextMenu(e),v.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(e){e.preventDefault()}rk(){if(this._observer){if(this.camera.Ae()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,P.e)([(0,p.M)()],F.prototype,"buttons",void 0),(0,P.e)([(0,p.M)()],F.prototype,"angularSensibility",void 0),X.d.FreeCameraMouseInput=F;var w,G=v(12702);class U{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new k.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(e){e=W.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==g.c.POINTERWHEEL)return;const v=d.event,P=v.deltaMode===G.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*P*v.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*P*v.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*P*v.deltaZ/this._normalize,v.preventDefault&&(e||v.preventDefault())},this._observer=this.camera.Ae()._inputManager._addCameraPointerObserver(this._wheel,g.c.POINTERWHEEL)}rk(){this._observer&&(this.camera.Ae()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,P.e)([(0,p.M)()],U.prototype,"wheelPrecisionX",void 0),(0,P.e)([(0,p.M)()],U.prototype,"wheelPrecisionY",void 0),(0,P.e)([(0,p.M)()],U.prototype,"wheelPrecisionZ",void 0),function(e){e[e.MoveRelative=0]="MoveRelative",e[e.RotateRelative=1]="RotateRelative",e[e.MoveScene=2]="MoveScene"}(w||(w={}));class D extends U{constructor(){super(...arguments),this._moveRelative=L.mv.Zero(),this._rotateRelative=L.mv.Zero(),this._moveScene=L.mv.Zero(),this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(e){null===e&&this._wheelXAction!==w.MoveRelative||(this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=e)}get wheelXMoveRelative(){return this._wheelXAction!==w.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(e){null===e&&this._wheelYAction!==w.MoveRelative||(this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=e)}get wheelYMoveRelative(){return this._wheelYAction!==w.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(e){null===e&&this._wheelZAction!==w.MoveRelative||(this._wheelZAction=w.MoveRelative,this._wheelZActionCoordinate=e)}get wheelZMoveRelative(){return this._wheelZAction!==w.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(e){null===e&&this._wheelXAction!==w.RotateRelative||(this._wheelXAction=w.RotateRelative,this._wheelXActionCoordinate=e)}get wheelXRotateRelative(){return this._wheelXAction!==w.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(e){null===e&&this._wheelYAction!==w.RotateRelative||(this._wheelYAction=w.RotateRelative,this._wheelYActionCoordinate=e)}get wheelYRotateRelative(){return this._wheelYAction!==w.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(e){null===e&&this._wheelZAction!==w.RotateRelative||(this._wheelZAction=w.RotateRelative,this._wheelZActionCoordinate=e)}get wheelZRotateRelative(){return this._wheelZAction!==w.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(e){null===e&&this._wheelXAction!==w.MoveScene||(this._wheelXAction=w.MoveScene,this._wheelXActionCoordinate=e)}get wheelXMoveScene(){return this._wheelXAction!==w.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(e){null===e&&this._wheelYAction!==w.MoveScene||(this._wheelYAction=w.MoveScene,this._wheelYActionCoordinate=e)}get wheelYMoveScene(){return this._wheelYAction!==w.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(e){null===e&&this._wheelZAction!==w.MoveScene||(this._wheelZAction=w.MoveScene,this._wheelZActionCoordinate=e)}get wheelZMoveScene(){return this._wheelZAction!==w.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.dp(0),this._rotateRelative.dp(0),this._moveScene.dp(0),this._updateCamera(),this.camera.Ae().useRightHandedSystem&&(this._moveRelative.z*=-1);const e=L.Matrix.Zero();this.camera.getViewMatrix().invertToRef(e);const d=L.mv.Zero();L.mv.TransformNormalToRef(this._moveRelative,e,d),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(d),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(e,d,v){if(0===e)return;if(null===d||null===v)return;let P=null;switch(d){case w.MoveRelative:P=this._moveRelative;break;case w.RotateRelative:P=this._rotateRelative;break;case w.MoveScene:P=this._moveScene}switch(v){case 0:P.set(e,0,0);break;case 1:P.set(0,e,0);break;case 2:P.set(0,0,e)}}}(0,P.e)([(0,p.M)()],D.prototype,"wheelXMoveRelative",null),(0,P.e)([(0,p.M)()],D.prototype,"wheelYMoveRelative",null),(0,P.e)([(0,p.M)()],D.prototype,"wheelZMoveRelative",null),(0,P.e)([(0,p.M)()],D.prototype,"wheelXRotateRelative",null),(0,P.e)([(0,p.M)()],D.prototype,"wheelYRotateRelative",null),(0,P.e)([(0,p.M)()],D.prototype,"wheelZRotateRelative",null),(0,P.e)([(0,p.M)()],D.prototype,"wheelXMoveScene",null),(0,P.e)([(0,p.M)()],D.prototype,"wheelYMoveScene",null),(0,P.e)([(0,p.M)()],D.prototype,"wheelZMoveScene",null),X.d.FreeCameraMouseWheelInput=D;class C{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=e,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=W.Tools.IsSafari()}attachControl(e){e=W.Tools.BackCompatCameraNoPreventDefault(arguments);let d=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=v=>{const P=v.event,p="mouse"===P.pointerType||this._isSafari&&"undefined"===typeof P.pointerType;if(this.allowMouse||!p)if(v.type===g.c.POINTERDOWN){if(e||P.preventDefault(),this._pointerPressed.push(P.pointerId),1!==this._pointerPressed.length)return;d={x:P.clientX,y:P.clientY}}else if(v.type===g.c.POINTERUP){e||P.preventDefault();const v=this._pointerPressed.indexOf(P.pointerId);if(-1===v)return;if(this._pointerPressed.splice(v,1),0!=v)return;d=null,this._offsetX=null,this._offsetY=null}else if(v.type===g.c.POINTERMOVE){if(e||P.preventDefault(),!d)return;if(0!=this._pointerPressed.indexOf(P.pointerId))return;this._offsetX=P.clientX-d.x,this._offsetY=-(P.clientY-d.y)}}),this._observer=this.camera.Ae()._inputManager._addCameraPointerObserver(this._pointerInput,g.c.POINTERDOWN|g.c.POINTERUP|g.c.POINTERMOVE),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.addEventListener("blur",this._onLostFocus)}}rk(){if(this._pointerInput){if(this._observer&&(this.camera.Ae()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const e=this.camera,d=e._calculateHandednessMultiplier();e.cameraRotation.y=d*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)e.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const d=e._computeLocalCameraSpeed(),v=new L.mv(0,0,0!==this.touchMoveSensibility?d*this._offsetY/this.touchMoveSensibility:0);L.Matrix.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(L.mv.TransformCoordinates(v,e._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,P.e)([(0,p.M)()],C.prototype,"touchAngularSensibility",void 0),(0,P.e)([(0,p.M)()],C.prototype,"touchMoveSensibility",void 0),X.d.FreeCameraTouchInput=C;class q extends X.h{constructor(e){super(e),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new V),this}addMouse(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new F(e),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new D,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new C),this}clear(){super.clear(),this._mouseInput=null}}var h=v(12381),l=v(12319);class n extends B.c{get angularSensibility(){const e=this.inputs.attached.mouse;return e?e.angularSensibility:0}set angularSensibility(e){const d=this.inputs.attached.mouse;d&&(d.angularSensibility=e)}get keysUp(){const e=this.inputs.attached.keyboard;return e?e.keysUp:[]}set keysUp(e){const d=this.inputs.attached.keyboard;d&&(d.keysUp=e)}get keysUpward(){const e=this.inputs.attached.keyboard;return e?e.keysUpward:[]}set keysUpward(e){const d=this.inputs.attached.keyboard;d&&(d.keysUpward=e)}get keysDown(){const e=this.inputs.attached.keyboard;return e?e.keysDown:[]}set keysDown(e){const d=this.inputs.attached.keyboard;d&&(d.keysDown=e)}get keysDownward(){const e=this.inputs.attached.keyboard;return e?e.keysDownward:[]}set keysDownward(e){const d=this.inputs.attached.keyboard;d&&(d.keysDownward=e)}get keysLeft(){const e=this.inputs.attached.keyboard;return e?e.keysLeft:[]}set keysLeft(e){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=e)}get keysRight(){const e=this.inputs.attached.keyboard;return e?e.keysRight:[]}set keysRight(e){const d=this.inputs.attached.keyboard;d&&(d.keysRight=e)}get keysRotateLeft(){const e=this.inputs.attached.keyboard;return e?e.keysRotateLeft:[]}set keysRotateLeft(e){const d=this.inputs.attached.keyboard;d&&(d.keysRotateLeft=e)}get keysRotateRight(){const e=this.inputs.attached.keyboard;return e?e.keysRotateRight:[]}set keysRotateRight(e){const d=this.inputs.attached.keyboard;d&&(d.keysRotateRight=e)}get keysRotateUp(){const e=this.inputs.attached.keyboard;return e?e.keysRotateUp:[]}set keysRotateUp(e){const d=this.inputs.attached.keyboard;d&&(d.keysRotateUp=e)}get keysRotateDown(){const e=this.inputs.attached.keyboard;return e?e.keysRotateDown:[]}set keysRotateDown(e){const d=this.inputs.attached.keyboard;d&&(d.keysRotateDown=e)}constructor(e,d,v){var P;super(e,d,v,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),P=this,this.ellipsoid=new L.mv(.5,1,.5),this.ellipsoidOffset=new L.mv(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=L.mv.Zero(),this._diffPosition=L.mv.Zero(),this._newPosition=L.mv.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P._newPosition.L(d),P._newPosition.subtractToRef(P._oldPosition,P._diffPosition),P._diffPosition.length()>l.b.CollisionsEpsilon&&(P.position.addToRef(P._diffPosition,P._deferredPositionUpdate),P._deferOnly?P._deferredUpdated=!0:P.position.L(P._deferredPositionUpdate),P.iF&&v&&P.iF(v))},this.inputs=new q(this),this.inputs.addKeyboard().addMouse()}attachControl(e,d){d=W.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(d)}rk(){this.inputs.detachElement(),this.cameraDirection=new L.mv(0,0,0),this.cameraRotation=new L.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(e){this._collisionMask=isNaN(e)?-1:e}_collideWithWorld(e){let d;d=this.parent?L.mv.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,d.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const v=this.Ae().collisionCoordinator;this._collider||(this._collider=v.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let P=e;this.applyGravity&&(P=e.add(this.Ae().gravity)),v.getNewPosition(this._oldPosition,P,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=L.mv.Zero(),this._transformedDirection=L.mv.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(e){this._needMoveForGravity=e}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Ae().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Wg"}}(0,P.e)([(0,p.J)()],n.prototype,"ellipsoid",void 0),(0,P.e)([(0,p.J)()],n.prototype,"ellipsoidOffset",void 0),(0,P.e)([(0,p.M)()],n.prototype,"checkCollisions",void 0),(0,P.e)([(0,p.M)()],n.prototype,"applyGravity",void 0),(0,h.h)("BABYLON.FreeCamera",n)},14674:(e,d,v)=>{"use strict";v.d(d,{e:()=>L});var P=v(12512),p=v(14679);class L{constructor(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=v,this.MV=[],this._maxBlockCapacity=d||64,this._selectionContent=new P.b(1024),this._creationFunc=e}update(e,d,v){p.b._CreateBlocks(e,d,v,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}dV(e){for(let d=0;d<this.FV.length;d++){this.FV[d].addEntry(e)}}eV(e){for(let d=0;d<this.FV.length;d++){this.FV[d].removeEntry(e)}}select(e,d){this._selectionContent.reset();for(let v=0;v<this.FV.length;v++){this.FV[v].select(e,this._selectionContent,d)}return d?this._selectionContent.concat(this.MV):this._selectionContent.concatWithNoDuplicate(this.MV),this._selectionContent}intersects(e,d,v){this._selectionContent.reset();for(let P=0;P<this.FV.length;P++){this.FV[P].intersects(e,d,this._selectionContent,v)}return v?this._selectionContent.concat(this.MV):this._selectionContent.concatWithNoDuplicate(this.MV),this._selectionContent}intersectsRay(e){this._selectionContent.reset();for(let d=0;d<this.FV.length;d++){this.FV[d].intersectsRay(e,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.MV),this._selectionContent}}L.CreationFuncForMeshes=(e,d)=>{const v=e.getBoundingInfo();!e.isBlocked&&v.boundingBox.intersectsMinMax(d.EV,d.ek)&&d.entries.push(e)},L.CreationFuncForSubMeshes=(e,d)=>{e.getBoundingInfo().boundingBox.intersectsMinMax(d.EV,d.ek)&&d.entries.push(e)}},14679:(e,d,v)=>{"use strict";v.d(d,{b:()=>L});var P=v(12420),p=v(12758);class L{constructor(e,d,v,P,p,L){this.entries=[],this.dk=new Array,this._capacity=v,this._depth=P,this._maxDepth=p,this._creationFunc=L,this._minPoint=e,this._maxPoint=d,this.dk.push(e.clone()),this.dk.push(d.clone()),this.dk.push(e.clone()),this.dk[2].x=d.x,this.dk.push(e.clone()),this.dk[3].y=d.y,this.dk.push(e.clone()),this.dk[4].z=d.z,this.dk.push(d.clone()),this.dk[5].z=e.z,this.dk.push(d.clone()),this.dk[6].x=e.x,this.dk.push(d.clone()),this.dk[7].y=e.y}get Od(){return this._capacity}get EV(){return this._minPoint}get ek(){return this._maxPoint}addEntry(e){if(this.FV)for(let d=0;d<this.FV.length;d++){this.FV[d].addEntry(e)}else this._creationFunc(e,this),this.entries.length>this.Od&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(e){if(this.FV){for(let d=0;d<this.FV.length;d++){this.FV[d].removeEntry(e)}return}const d=this.entries.indexOf(e);d>-1&&this.entries.splice(d,1)}addEntries(e){for(let d=0;d<e.length;d++){const v=e[d];this.addEntry(v)}}select(e,d,v){if(p.c.IsInFrustum(this.dk,e)){if(this.FV){for(let P=0;P<this.FV.length;P++){this.FV[P].select(e,d,v)}return}v?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)}}intersects(e,d,v,P){if(p.c.IntersectsSphere(this._minPoint,this._maxPoint,e,d)){if(this.FV){for(let p=0;p<this.FV.length;p++){this.FV[p].intersects(e,d,v,P)}return}P?v.concat(this.entries):v.concatWithNoDuplicate(this.entries)}}intersectsRay(e,d){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.FV){for(let v=0;v<this.FV.length;v++){this.FV[v].intersectsRay(e,d)}return}d.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){L._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(e,d,v,p,B,X,z,W){z.FV=new Array;const V=new P.mv((d.x-e.x)/2,(d.y-e.y)/2,(d.z-e.z)/2);for(let P=0;P<2;P++)for(let d=0;d<2;d++)for(let k=0;k<2;k++){const g=e.add(V.multiplyByFloats(P,d,k)),F=e.add(V.multiplyByFloats(P+1,d+1,k+1)),w=new L(g,F,p,B+1,X,W);w.addEntries(v),z.FV.push(w)}}}},14683:(e,d,v)=>{"use strict";v.d(d,{b:()=>V});var P=v(12653),p=v(12420),L=v(12839),B=v(13868),X=v(12681),z=v(14674),W=v(12281);P.d.prototype.createOrUpdateSelectionOctree=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,v=this._getComponent(X.c.NAME_OCTREE);v||(v=new V(this),this.o(v)),this.cV||(this.cV=new z.e(z.e.CreationFuncForMeshes,e,d));const P=this.getWorldExtends();return this.cV.update(P.min,P.max,this.meshes),this.cV},Object.defineProperty(P.d.prototype,"selectionOctree",{get:function(){return this.cV},enumerable:!0,configurable:!0}),L.d.prototype.createOrUpdateSubmeshesOctree=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const v=this.Ae();let P=v._getComponent(X.c.NAME_OCTREE);P||(P=new V(v),v.o(P)),this._submeshesOctree||(this._submeshesOctree=new z.e(z.e.CreationFuncForSubMeshes,e,d)),this.Md(!0);const p=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(p.minimumWorld,p.maximumWorld,this.Qd),this._submeshesOctree};class V{constructor(e){this.name=X.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new B.b(p.mv.Zero(),new p.mv(1,1,1)),(e=e||W.c.LastCreatedScene)&&(this.fd=e,this.fd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.fd.getActiveSubMeshCandidates=e=>this.getActiveSubMeshCandidates(e),this.fd.getCollidingSubMeshCandidates=(e,d)=>this.getCollidingSubMeshCandidates(e,d),this.fd.getIntersectingSubMeshCandidates=(e,d)=>this.getIntersectingSubMeshCandidates(e,d))}register(){this.fd.onMeshRemovedObservable.add((e=>{const d=this.fd.selectionOctree;if(void 0!==d&&null!==d){const v=d.MV.indexOf(e);-1!==v&&d.MV.splice(v,1)}})),this.fd.onMeshImportedObservable.add((e=>{const d=this.fd.selectionOctree;void 0!==d&&null!==d&&d.dV(e)}))}getActiveMeshCandidates(){var e;return(null===(e=this.fd.cV)||void 0===e?void 0:e.select(this.fd.frustumPlanes))||this.fd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(e){if(e._submeshesOctree&&e.useOctreeForRenderingSelection){return e._submeshesOctree.select(this.fd.frustumPlanes)}return this.fd._getDefaultSubMeshCandidates(e)}getIntersectingSubMeshCandidates(e,d){if(e._submeshesOctree&&e.useOctreeForPicking){B.b.TransformToRef(d,e.getWorldMatrix(),this._tempRay);return e._submeshesOctree.intersectsRay(this._tempRay)}return this.fd._getDefaultSubMeshCandidates(e)}getCollidingSubMeshCandidates(e,d){if(e._submeshesOctree&&e.useOctreeForCollisions){const v=d._velocityWorldLength+Math.max(d._radius.x,d._radius.y,d._radius.z);return e._submeshesOctree.intersects(d._basePointWorld,v)}return this.fd._getDefaultSubMeshCandidates(e)}rebuild(){}dispose(){}}},13868:(e,d,v)=>{"use strict";v.d(d,{b:()=>F});var P=v(12653),p=v(12872),L=v(12429),B=v(12420),X=v(12433),z=v(12744),W=v(12678),V=v(12281),k=v(12706);const g={internalPickerForMesh:void 0};class F{constructor(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.e;this.origin=e,this.direction=d,this.length=v,this.epsilon=P}clone(){return new F(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const P=F._TmpVector3[0].Ed(e.x-v,e.y-v,e.z-v),p=F._TmpVector3[1].Ed(d.x+v,d.y+v,d.z+v);let L,B,X,z,W=0,V=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<P.x||this.origin.x>p.x)return!1}else if(L=1/this.direction.x,B=(P.x-this.origin.x)*L,X=(p.x-this.origin.x)*L,X===-1/0&&(X=1/0),B>X&&(z=B,B=X,X=z),W=Math.max(B,W),V=Math.min(X,V),W>V)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<P.y||this.origin.y>p.y)return!1}else if(L=1/this.direction.y,B=(P.y-this.origin.y)*L,X=(p.y-this.origin.y)*L,X===-1/0&&(X=1/0),B>X&&(z=B,B=X,X=z),W=Math.max(B,W),V=Math.min(X,V),W>V)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<P.z||this.origin.z>p.z)return!1}else if(L=1/this.direction.z,B=(P.z-this.origin.z)*L,X=(p.z-this.origin.z)*L,X===-1/0&&(X=1/0),B>X&&(z=B,B=X,X=z),W=Math.max(B,W),V=Math.min(X,V),W>V)return!1;return!0}intersectsBox(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(e.minimum,e.maximum,d)}intersectsSphere(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const v=e.center.x-this.origin.x,P=e.center.y-this.origin.y,p=e.center.z-this.origin.z,L=v*v+P*P+p*p,B=e.radius+d,X=B*B;if(L<=X)return!0;const z=v*this.direction.x+P*this.direction.y+p*this.direction.z;if(z<0)return!1;return L-z*z<=X}intersectsTriangle(e,d,v){const P=F._TmpVector3[0],p=F._TmpVector3[1],L=F._TmpVector3[2],X=F._TmpVector3[3],W=F._TmpVector3[4];d.subtractToRef(e,P),v.subtractToRef(e,p),B.mv.CrossToRef(this.direction,p,L);const V=B.mv.Dot(P,L);if(0===V)return null;const k=1/V;this.origin.subtractToRef(e,X);const g=B.mv.Dot(X,L)*k;if(g<-this.epsilon||g>1+this.epsilon)return null;B.mv.CrossToRef(X,P,W);const w=B.mv.Dot(this.direction,W)*k;if(w<-this.epsilon||g+w>1+this.epsilon)return null;const G=B.mv.Dot(p,W)*k;return G>this.length?null:new z.e(1-g-w,g,G)}intersectsPlane(e){let d;const v=B.mv.Dot(e.normal,this.direction);if(Math.abs(v)<9.99999997475243e-7)return null;{const P=B.mv.Dot(e.normal,this.origin);return d=(-e.d-P)/v,d<0?d<-9.99999997475243e-7?null:0:d}}intersectsAxis(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(e){case"y":{const e=(this.origin.y-d)/this.direction.y;return e>0?null:new B.mv(this.origin.x+this.direction.x*-e,d,this.origin.z+this.direction.z*-e)}case"x":{const e=(this.origin.x-d)/this.direction.x;return e>0?null:new B.mv(d,this.origin.y+this.direction.y*-e,this.origin.z+this.direction.z*-e)}case"z":{const e=(this.origin.z-d)/this.direction.z;return e>0?null:new B.mv(this.origin.x+this.direction.x*-e,this.origin.y+this.direction.y*-e,d)}default:return null}}intersectsMesh(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=B.TmpVectors.Matrix[0];return e.getWorldMatrix().invertToRef(X),this._tmpRay?F.TransformToRef(this,X,this._tmpRay):this._tmpRay=F.Transform(this,X),e.intersects(this._tmpRay,d,v,P,p,L)}intersectsMeshes(e,d,v){v?v.length=0:v=[];for(let P=0;P<e.length;P++){const p=this.intersectsMesh(e[P],d);p.hit&&v.push(p)}return v.sort(this._comparePickingInfo),v}_comparePickingInfo(e,d){return e.distance<d.distance?-1:e.distance>d.distance?1:0}intersectionSegment(e,d,v){const P=this.origin,p=B.TmpVectors.mv[0],L=B.TmpVectors.mv[1],X=B.TmpVectors.mv[2],z=B.TmpVectors.mv[3];d.subtractToRef(e,p),this.direction.scaleToRef(F._Rayl,X),P.addToRef(X,L),e.subtractToRef(P,z);const W=B.mv.Dot(p,p),V=B.mv.Dot(p,X),k=B.mv.Dot(X,X),g=B.mv.Dot(p,z),w=B.mv.Dot(X,z),G=W*k-V*V;let U,D,C=G,q=G;G<F._Smallnum?(U=0,C=1,D=w,q=k):(U=V*w-k*g,D=W*w-V*g,U<0?(U=0,D=w,q=k):U>C&&(U=C,D=w+V,q=k)),D<0?(D=0,-g<0?U=0:-g>W?U=C:(U=-g,C=W)):D>q&&(D=q,-g+V<0?U=0:-g+V>W?U=C:(U=-g+V,C=W));const h=Math.abs(U)<F._Smallnum?0:U/C,l=Math.abs(D)<F._Smallnum?0:D/q,n=B.TmpVectors.mv[4];X.scaleToRef(l,n);const A=B.TmpVectors.mv[5];p.scaleToRef(h,A),A.addInPlace(z);const x=B.TmpVectors.mv[6];A.subtractToRef(n,x);return l>0&&l<=this.length&&x.lengthSquared()<v*v?A.length():-1}update(e,d,v,P,p,L,X){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){F._RayDistant||(F._RayDistant=F.Zero()),F._RayDistant.unprojectRayToRef(e,d,v,P,B.Matrix.IdentityReadOnly,L,X);const z=B.TmpVectors.Matrix[0];p.invertToRef(z),F.TransformToRef(F._RayDistant,z,this)}else this.unprojectRayToRef(e,d,v,P,p,L,X);return this}static Zero(){return new F(B.mv.Zero(),B.mv.Zero())}static CreateNew(e,d,v,P,p,L,B){return F.Zero().update(e,d,v,P,p,L,B)}static CreateNewFromTo(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.Matrix.IdentityReadOnly;const P=new F(new B.mv(0,0,0),new B.mv(0,0,0));return F.CreateFromToToRef(e,d,P,v)}static CreateFromToToRef(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.Matrix.IdentityReadOnly;v.origin.L(e);const p=d.subtractToRef(e,v.direction),L=Math.sqrt(p.x*p.x+p.y*p.y+p.z*p.z);return v.length=L,v.direction.normalize(),F.TransformToRef(v,P,v)}static Transform(e,d){const v=new F(new B.mv(0,0,0),new B.mv(0,0,0));return F.TransformToRef(e,d,v),v}static TransformToRef(e,d,v){B.mv.TransformCoordinatesToRef(e.origin,d,v.origin),B.mv.TransformNormalToRef(e.direction,d,v.direction),v.length=e.length,v.epsilon=e.epsilon;const P=v.direction,p=P.length();if(0!==p&&1!==p){const e=1/p;P.x*=e,P.y*=e,P.z*=e,v.length*=p}return v}unprojectRayToRef(e,d,v,P,p,L,X){const z=B.TmpVectors.Matrix[0];p.multiplyToRef(L,z),z.multiplyToRef(X,z),z.invert();const W=V.c.LastCreatedEngine,k=B.TmpVectors.mv[0];k.x=e/v*2-1,k.y=-(d/P*2-1),k.z=null!==W&&void 0!==W&&W.Wd?1:null!==W&&void 0!==W&&W.isNDCHalfZRange?0:-1;const g=B.TmpVectors.mv[1].Ed(k.x,k.y,1-1e-8),F=B.TmpVectors.mv[2],w=B.TmpVectors.mv[3];B.mv._UnprojectFromInvertedMatrixToRef(k,z,F),B.mv._UnprojectFromInvertedMatrixToRef(g,z,w),this.origin.L(F),w.subtractToRef(F,this.direction),this.direction.normalize()}}function w(e,d,v,P,p){let L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=F.Zero();return G(e,d,v,P,B,p,L),B}function G(e,d,v,P,p,L){let X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const W=e.getEngine();if(!L&&!(L=e.activeCamera))return e;const V=L.viewport,k=W.getRenderHeight(),{x:g,y:F,width:w,height:G}=V.toGlobal(W.getRenderWidth(),k),U=1/W.getHardwareScalingLevel();return d=d*U-g,v=v*U-(k-F-G),p.update(d,v,w,G,P||B.Matrix.IdentityReadOnly,X?B.Matrix.IdentityReadOnly:L.getViewMatrix(),L.getProjectionMatrix(),z),e}function U(e,d,v,P,p){if(!W.b)return e;const L=e.getEngine();if(!p&&!(p=e.activeCamera))throw new Error("Active camera not set");const X=p.viewport,z=L.getRenderHeight(),{x:V,y:k,width:g,height:F}=X.toGlobal(L.getRenderWidth(),z),w=B.Matrix.Identity(),G=1/L.getHardwareScalingLevel();return d=d*G-V,v=v*G-(z-k-F),P.update(d,v,g,F,w,w,p.getProjectionMatrix()),e}function D(e,d,v,P,p,L,B,X){const z=d(P,v.enableDistantPicking),W=v.intersects(z,p,B,L,P,X);return W&&W.hit?!p&&null!=e&&W.distance>=e.distance?null:W:null}function C(e,d,v,P,p,L){let X=null;const z=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),V=e.cameraToUseForPointers||e.activeCamera,k=g.internalPickerForMesh||D;for(let W=0;W<e.meshes.length;W++){const g=e.meshes[W];if(v){if(!v(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.Nz)continue;const F=z&&g.isWorldMatrixCameraDependent(),w=g.Md(F,V);if(g.hasThinInstances&&g.UW){const e=k(X,d,g,w,!0,!0,L);if(e){if(p)return e;const z=B.TmpVectors.Matrix[1],W=g.thinInstanceGetWorldMatrices();for(let e=0;e<W.length;e++){if(v&&!v(g,e))continue;W[e].multiplyToRef(w,z);const B=k(X,d,g,z,P,p,L,!0);if(B&&(X=B,X.thinInstanceIndex=e,P))return X}}}else{const e=k(X,d,g,w,P,p,L);if(e&&(X=e,P))return X}}return X||new W.b}function q(e,d,v,P){if(!W.b)return null;const p=[],L=!!(e.activeCameras&&e.activeCameras.length>1&&e.cameraToUseForPointers!==e.activeCamera),X=e.cameraToUseForPointers||e.activeCamera,z=g.internalPickerForMesh||D;for(let W=0;W<e.meshes.length;W++){const V=e.meshes[W];if(v){if(!v(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.Nz)continue;const k=L&&V.isWorldMatrixCameraDependent(),g=V.Md(k,X);if(V.hasThinInstances&&V.UW){if(z(null,d,V,g,!0,!0,P)){const e=B.TmpVectors.Matrix[1],L=V.thinInstanceGetWorldMatrices();for(let B=0;B<L.length;B++){if(v&&!v(V,B))continue;L[B].multiplyToRef(g,e);const X=z(null,d,V,e,!1,!1,P,!0);X&&(X.thinInstanceIndex=B,p.push(X))}}}else{const e=z(null,d,V,g,!1,!1,P);e&&p.push(e)}}return p}function h(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,P=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;P||(P=e.getWorldMatrix()),d.length=v,p?d.origin.L(p):d.origin.L(e.position);const L=B.TmpVectors.mv[2];L.set(0,0,e._scene.useRightHandedSystem?-1:1);const X=B.TmpVectors.mv[3];return B.mv.TransformNormalToRef(L,P,X),B.mv.NormalizeToRef(X,d.direction),d}var l,n;F._TmpVector3=(0,X.e)(6,B.mv.Zero),F._RayDistant=F.Zero(),F._Smallnum=1e-8,F._Rayl=1e9,l=P.d,(n=p.c)&&(n.prototype.getForwardRay=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,d=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;return h(this,new F(B.mv.Zero(),B.mv.Zero(),e),e,d,v)},n.prototype.getForwardRayToRef=function(e){return h(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),l&&(k.c._IsPickingAvailable=!0,l.prototype.createPickingRay=function(e,d,v,P){return w(this,e,d,v,P,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),P.d.prototype.createPickingRayToRef=function(e,d,v,P,p){return G(this,e,d,v,P,p,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},P.d.prototype.createPickingRayInCameraSpace=function(e,d,v){return function(e,d,v,P){const p=F.Zero();return U(e,d,v,p,P),p}(this,e,d,v)},P.d.prototype.createPickingRayInCameraSpaceToRef=function(e,d,v,P){return U(this,e,d,v,P)},P.d.prototype.pickWithBoundingInfo=function(e,d,v,P,p){return function(e,d,v,P,p,L){if(!W.b)return null;const X=C(e,(P=>(e._tempPickingRay||(e._tempPickingRay=F.Zero()),G(e,d,v,P,e._tempPickingRay,L||null),e._tempPickingRay)),P,p,!0);return X&&(X.ray=w(e,d,v,B.Matrix.Identity(),L||null)),X}(this,e,d,v,P,p)},P.d.prototype.Rv=function(e,d,v,P,p,L){return function(e,d,v,P,p,L,X){const z=C(e,((P,p)=>(e._tempPickingRay||(e._tempPickingRay=F.Zero()),G(e,d,v,P,e._tempPickingRay,L||null,!1,p),e._tempPickingRay)),P,p,!1,X);return z&&(z.ray=w(e,d,v,B.Matrix.Identity(),L||null)),z}(this,e,d,v,P,p,L)},P.d.prototype.pickWithRay=function(e,d,v,P){return function(e,d,v,P,p){const L=C(e,(v=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=B.Matrix.Identity()),v.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=F.Zero()),F.TransformToRef(d,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform)),v,P,!1,p);return L&&(L.ray=d),L}(this,e,d,v,P)},P.d.prototype.multiPick=function(e,d,v,P,p){return function(e,d,v,P,p,L){return q(e,(P=>w(e,d,v,P,p||null)),P,L)}(this,e,d,v,P,p)},P.d.prototype.multiPickWithRay=function(e,d,v){return function(e,d,v,P){return q(e,(v=>(e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=B.Matrix.Identity()),v.invertToRef(e._pickWithRayInverseMatrix),e._cachedRayForTransform||(e._cachedRayForTransform=F.Zero()),F.TransformToRef(d,e._pickWithRayInverseMatrix,e._cachedRayForTransform),e._cachedRayForTransform)),v,P)}(this,e,d,v)}},14153:(e,d,v)=>{"use strict";var P=v(12357),p=v(12253),L=v(12283),B=v(12384),X=v(12319),z=v(12366);X.b.prototype._partialLoadFile=function(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(e,(e=>{v[d]=e,v._internalCount++,6===v._internalCount&&P(v)}),void 0,void 0,!0,((e,d)=>{p&&e&&p(e.status+" "+e.statusText,d)}))},X.b.prototype._cascadeLoadFiles=function(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const p=[];p._internalCount=0;for(let L=0;L<6;L++)this._partialLoadFile(v[L],L,p,d,P)},X.b.prototype._cascadeLoadImgs=function(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5?arguments[5]:void 0;const B=[];B._internalCount=0;for(let X=0;X<6;X++)this._partialLoadImg(P[X],X,B,e,d,v,p,L)},X.b.prototype._partialLoadImg=function(e,d,v,P,p,X){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7?arguments[7]:void 0;const V=(0,B.b)();(0,L.q)(e,(e=>{v[d]=e,v._internalCount++,P&&P.removePendingData(V),6===v._internalCount&&X&&X(p,v)}),((e,d)=>{P&&P.removePendingData(V),z&&z(e,d)}),P?P.offlineProvider:null,W),P&&P.addPendingData(V)},X.b.prototype.createCubeTextureBase=function(e,d,v,L){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,G=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,U=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,D=arguments.length>14&&void 0!==arguments[14]&&arguments[14],C=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const q=w||new P.b(this,7);q.isCube=!0,q.url=e,q.generateMipMaps=!L,q._lodGenerationScale=g,q._lodGenerationOffset=F,q._useSRGBBuffer=!!D&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!L),q!==w&&(q.label=e.substring(0,60)),this._doNotHandleContextLost||(q._extension=V,q._files=v,q._buffer=C);const h=e;this._transformTextureUrl&&!w&&(e=this._transformTextureUrl(e));const l=V??function(e){const d=e.split("?")[0],v=d.lastIndexOf(".");return v>-1?d.substring(v).toLowerCase():""}(e),n=(0,z.e)(l),A=(e,d)=>{q.dispose(),X?X(e,d):e&&p.c.Warn(e)},x=(P,X)=>{e===h?P&&A(P.status+" "+P.statusText,X):(p.c.Warn(`Failed to load ${e}, falling back to the ${h}`),this.createCubeTextureBase(h,d,v,!!L,B,A,W,V,k,g,F,q,G,U,D,C))};if(n)n.then((P=>{const p=e=>{G&&G(q,e),P.loadCubeData(e,q,k,B,((e,d)=>{A(e,d)}))};C?p(C):v&&6===v.length?P.supportCascades?this._cascadeLoadFiles(d,(e=>p(e.map((e=>new Uint8Array(e))))),v,A):A("Textures type does not support cascades."):this._loadFile(e,(e=>p(new Uint8Array(e))),void 0,void 0,!0,x)}));else{if(!v||0===v.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(d,q,((e,d)=>{U&&U(e,d)}),v,A)}return this._internalTexturesCache.push(q),q}},14686:(e,d,v)=>{"use strict";v(12253);var P=v(12550);v(12357),v(12497),v(12350),v(12599),v(12562);P.b},14179:(e,d,v)=>{"use strict";v.d(d,{d:()=>p});var P=v(12381);class p{constructor(e){this.value=this._toInt(e)}_toInt(e){return 0|e}add(e){return new p(this.value+e.value)}Zd(e){return new p(this.value-e.value)}multiply(e){return new p(Math.imul(this.value,e.value))}divide(e){return new p(this.value/e.value)}getClassName(){return p.ClassName}equals(e){return this.value===e.value}static FromValue(e){return new p(e)}toString(){return this.value.toString()}}p.ClassName="FlowGraphInteger",(0,P.h)("FlowGraphInteger",p)},14185:(e,d,v)=>{"use strict";v.d(d,{c:()=>p,e:()=>L});var P=v(12420);class p{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ld=e}get m(){return this.ld}transformVector(e){return this.transformVectorToRef(e,new P.Vector2)}transformVectorToRef(e,d){return d.x=e.x*this.ld[0]+e.y*this.ld[1],d.y=e.x*this.ld[2]+e.y*this.ld[3],d}Yd(){return this.toArray()}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<4;d++)e[d]=this.ld[d];return e}Yv(e){for(let d=0;d<4;d++)this.ld[d]=e[d];return this}multiplyToRef(e,d){const v=e.ld,P=this.ld,p=d.ld;return p[0]=v[0]*P[0]+v[1]*P[2],p[1]=v[0]*P[1]+v[1]*P[3],p[2]=v[2]*P[0]+v[3]*P[2],p[3]=v[2]*P[1]+v[3]*P[3],d}multiply(e){return this.multiplyToRef(e,new p)}divideToRef(e,d){const v=this.ld,P=e.ld,p=d.ld;return p[0]=v[0]/P[0],p[1]=v[1]/P[1],p[2]=v[2]/P[2],p[3]=v[3]/P[3],d}divide(e){return this.divideToRef(e,new p)}addToRef(e,d){const v=this.ld,P=e.m,p=d.m;return p[0]=v[0]+P[0],p[1]=v[1]+P[1],p[2]=v[2]+P[2],p[3]=v[3]+P[3],d}add(e){return this.addToRef(e,new p)}subtractToRef(e,d){const v=this.ld,P=e.m,p=d.m;return p[0]=v[0]-P[0],p[1]=v[1]-P[1],p[2]=v[2]-P[2],p[3]=v[3]-P[3],d}Zd(e){return this.subtractToRef(e,new p)}transpose(){const e=this.ld;return new p([e[0],e[2],e[1],e[3]])}determinant(){const e=this.ld;return e[0]*e[3]-e[1]*e[2]}inverse(){const e=this.determinant();if(0===e)throw new Error("Matrix is not invertible");const d=this.ld,v=1/e;return new p([d[3]*v,-d[1]*v,-d[2]*v,d[0]*v])}equals(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const v=this.ld,P=e.m;return 0===d?v[0]===P[0]&&v[1]===P[1]&&v[2]===P[2]&&v[3]===P[3]:Math.abs(v[0]-P[0])<d&&Math.abs(v[1]-P[1])<d&&Math.abs(v[2]-P[2])<d&&Math.abs(v[3]-P[3])<d}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ld.join(", ")})`}}class L{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ld=e}get m(){return this.ld}transformVector(e){return this.transformVectorToRef(e,new P.mv)}transformVectorToRef(e,d){const v=this.ld;return d.x=e.x*v[0]+e.y*v[1]+e.z*v[2],d.y=e.x*v[3]+e.y*v[4]+e.z*v[5],d.z=e.x*v[6]+e.y*v[7]+e.z*v[8],d}multiplyToRef(e,d){const v=e.ld,P=this.ld,p=d.m;return p[0]=v[0]*P[0]+v[1]*P[3]+v[2]*P[6],p[1]=v[0]*P[1]+v[1]*P[4]+v[2]*P[7],p[2]=v[0]*P[2]+v[1]*P[5]+v[2]*P[8],p[3]=v[3]*P[0]+v[4]*P[3]+v[5]*P[6],p[4]=v[3]*P[1]+v[4]*P[4]+v[5]*P[7],p[5]=v[3]*P[2]+v[4]*P[5]+v[5]*P[8],p[6]=v[6]*P[0]+v[7]*P[3]+v[8]*P[6],p[7]=v[6]*P[1]+v[7]*P[4]+v[8]*P[7],p[8]=v[6]*P[2]+v[7]*P[5]+v[8]*P[8],d}multiply(e){return this.multiplyToRef(e,new L)}divideToRef(e,d){const v=this.ld,P=e.m,p=d.m;return p[0]=v[0]/P[0],p[1]=v[1]/P[1],p[2]=v[2]/P[2],p[3]=v[3]/P[3],p[4]=v[4]/P[4],p[5]=v[5]/P[5],p[6]=v[6]/P[6],p[7]=v[7]/P[7],p[8]=v[8]/P[8],d}divide(e){return this.divideToRef(e,new L)}addToRef(e,d){const v=this.ld,P=e.m,p=d.m;return p[0]=v[0]+P[0],p[1]=v[1]+P[1],p[2]=v[2]+P[2],p[3]=v[3]+P[3],p[4]=v[4]+P[4],p[5]=v[5]+P[5],p[6]=v[6]+P[6],p[7]=v[7]+P[7],p[8]=v[8]+P[8],d}add(e){return this.addToRef(e,new L)}subtractToRef(e,d){const v=this.ld,P=e.m,p=d.m;return p[0]=v[0]-P[0],p[1]=v[1]-P[1],p[2]=v[2]-P[2],p[3]=v[3]-P[3],p[4]=v[4]-P[4],p[5]=v[5]-P[5],p[6]=v[6]-P[6],p[7]=v[7]-P[7],p[8]=v[8]-P[8],d}Zd(e){return this.subtractToRef(e,new L)}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<9;d++)e[d]=this.ld[d];return e}Yd(){return this.toArray()}Yv(e){for(let d=0;d<9;d++)this.ld[d]=e[d];return this}transpose(){const e=this.ld;return new L([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]])}determinant(){const e=this.ld;return e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6])}inverse(){const e=this.determinant();if(0===e)throw new Error("Matrix is not invertible");const d=this.ld,v=1/e;return new L([(d[4]*d[8]-d[5]*d[7])*v,(d[2]*d[7]-d[1]*d[8])*v,(d[1]*d[5]-d[2]*d[4])*v,(d[5]*d[6]-d[3]*d[8])*v,(d[0]*d[8]-d[2]*d[6])*v,(d[2]*d[3]-d[0]*d[5])*v,(d[3]*d[7]-d[4]*d[6])*v,(d[1]*d[6]-d[0]*d[7])*v,(d[0]*d[4]-d[1]*d[3])*v])}equals(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const v=this.ld,P=e.m;return 0===d?v[0]===P[0]&&v[1]===P[1]&&v[2]===P[2]&&v[3]===P[3]&&v[4]===P[4]&&v[5]===P[5]&&v[6]===P[6]&&v[7]===P[7]&&v[8]===P[8]:Math.abs(v[0]-P[0])<d&&Math.abs(v[1]-P[1])<d&&Math.abs(v[2]-P[2])<d&&Math.abs(v[3]-P[3])<d&&Math.abs(v[4]-P[4])<d&&Math.abs(v[5]-P[5])<d&&Math.abs(v[6]-P[6])<d&&Math.abs(v[7]-P[7])<d&&Math.abs(v[8]-P[8])<d}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ld.join(", ")})`}}},14188:(e,d,v)=>{"use strict";var P;function p(e,d,v,P){switch(d){case"Animation":return P?e.animations.find((e=>e.uniqueId===v))??null:e.animations[v]??null;case"AnimationGroup":return P?e.animationGroups.find((e=>e.uniqueId===v))??null:e.animationGroups[v]??null;case"Mesh":return P?e.meshes.find((e=>e.uniqueId===v))??null:e.meshes[v]??null;case"Material":return P?e.materials.find((e=>e.uniqueId===v))??null:e.materials[v]??null;case"WV":return P?e.cameras.find((e=>e.uniqueId===v))??null:e.cameras[v]??null;case"Light":return P?e.lights.find((e=>e.uniqueId===v))??null:e.lights[v]??null;default:return null}}v.d(d,{c:()=>p}),function(e){e.Animation="Animation",e.AnimationGroup="AnimationGroup",e.Mesh="Mesh",e.Material="Material",e.WV="WV",e.Light="Light"}(P||(P={}))},14216:(e,d,v)=>{"use strict";v.d(d,{d:()=>p});var P=v(14220);class p extends P.c{constructor(e,d){if(super(e),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),d)for(const v of d)this._eventsSignalOutputs[v]=this._registerSignalOutput(v+"Event")}_executeOnTick(e){}_startPendingTasks(e){e._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(e),this._resetAfterCanceled(e)),this._preparePendingTasks(e),e._addPendingBlock(this),this.out._activateSignal(e),e._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(e){e._deleteExecutionVariable(this,"_initialized"),e._removePendingBlock(this)}}},14195:(e,d,v)=>{"use strict";v.d(d,{e:()=>W});var P=v(12384),p=v(12381),L=v(14200),B=v(12248),X=v(14177);class z extends L.b{constructor(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:P.defaultValue,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(e,d,v),this.richType=P,this._defaultValue=p,this._optional=L,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new B.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(e){this._isDisabled!==e&&(this._isDisabled=e,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(e,d){d._getConnectionValue(this)!==e&&(d._setConnectionValue(this,e),this.onValueChangedObservable.notifyObservers(e))}resetToDefaultValue(e){e._setConnectionValue(this,this._defaultValue)}connectTo(e){this._isDisabled||super.connectTo(e)}_getValueOrDefault(e){const d=e._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(d):d}getValue(e){if(1===this.connectionType){e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(e);const d=this._getValueOrDefault(e);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}const d=this.isConnected()?this._connectedPoint[0].getValue(e):this._getValueOrDefault(e);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(e),e.richType={},this.richType.serialize(e.richType),e.optional=this._optional,(0,X.h)("defaultValue",this._defaultValue,e)}}(0,p.h)("FlowGraphDataConnection",z);class W{constructor(e){var d;this.config=e,this.uniqueId=(0,P.b)(),this.name=(null===(d=this.config)||void 0===d?void 0:d.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(e){}registerDataInput(e,d,v){const P=new z(e,0,this,d,v);return this.dataInputs.push(P),P}registerDataOutput(e,d,v){const P=new z(e,1,this,d,v);return this.dataOutputs.push(P),P}getDataInput(e){return this.dataInputs.find((d=>d.name===e))}getDataOutput(e){return this.dataOutputs.find((d=>d.name===e))}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.h;if(e.uniqueId=this.uniqueId,e.config={},this.config){const v=this.config,P=Object.keys(v);for(const p of P)d(p,v[p],e.config)}e.dataInputs=[],e.dataOutputs=[],e.className=this.getClassName();for(const v of this.dataInputs){const d={};v.serialize(d),e.dataInputs.push(d)}for(const v of this.dataOutputs){const d={};v.serialize(d),e.dataOutputs.push(d)}}deserialize(e){}_log(e,d,v){var P;null===(P=e.logger)||void 0===P||P.addLogItem({action:d,Hv:v,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14200:(e,d,v)=>{"use strict";v.d(d,{b:()=>L});var P,p=v(12384);!function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(P||(P={}));class L{constructor(e,d,v){this._ownerBlock=v,this._connectedPoint=[],this.uniqueId=(0,p.b)(),this.connectedPointIds=[],this.name=e,this._connectionType=d}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(e){if(this._connectionType===e._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||e._isSingularConnection()&&e._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(e),e._connectedPoint.push(this)}disconnectFrom(e){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const v=this._connectedPoint.indexOf(e),P=e._connectedPoint.indexOf(this);-1!==v&&-1!==P&&(d&&this._connectedPoint.splice(v,1),e._connectedPoint.splice(P,1))}disconnectFromAll(){for(const e of this._connectedPoint)this.disconnectFrom(e,!1);this._connectedPoint.length=0}dispose(){for(const e of this._connectedPoint)this.disconnectFrom(e)}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.uniqueId=this.uniqueId,e.name=this.name,e._connectionType=this._connectionType,e.connectedPointIds=[],e.className=this.getClassName();for(const d of this._connectedPoint)e.connectedPointIds.push(d.uniqueId)}getClassName(){return"FGConnection"}deserialize(e){this.uniqueId=e.uniqueId,this.name=e.name,this._connectionType=e._connectionType,this.connectedPointIds=e.connectedPointIds}}},14170:(e,d,v)=>{"use strict";v.d(d,{b:()=>q});var P,p=v(12248),L=v(12403),B=v(12409),X=v(12384),z=v(14177),W=v(14188),V=v(12253);!function(e){e.ExecuteBlock="ExecuteBlock",e.ExecuteEvent="ExecuteEvent",e.TriggerConnection="TriggerConnection",e.ContextVariableSet="ContextVariableSet",e.GlobalVariableSet="GlobalVariableSet",e.GlobalVariableDelete="GlobalVariableDelete",e.GlobalVariableGet="GlobalVariableGet",e.AddConnection="AddConnection",e.GetConnectionValue="GetConnectionValue",e.SetConnectionValue="SetConnectionValue",e.ActivateSignal="ActivateSignal",e.ContextVariableGet="ContextVariableGet"}(P||(P={}));class k{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(e){if(e.time||(e.time=Date.now()),this.log.push(e),this.logToConsole){var d;const v=null===(d=e.Hv)||void 0===d?void 0:d.value;"object"===typeof v&&v.getClassName?V.c.Log(`[FGLog] ${e.className}:${e.uniqueId.split("-")[0]} ${e.action} - ${JSON.stringify(v.getClassName())}: ${v.toString()}`):V.c.Log(`[FGLog] ${e.className}:${e.uniqueId.split("-")[0]} ${e.action} - ${JSON.stringify(e.Hv)}`)}}getItemsOfType(e){return this.log.filter((d=>d.action===e))}}class g{get enableLogging(){return this._enableLogging}set enableLogging(e){this._enableLogging!==e&&(this._enableLogging=e,this._enableLogging?(this.logger=new k,this.logger.logToConsole=!0):this.logger=null)}constructor(e){this.uniqueId=(0,X.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new p.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=e,this.assetsContext=e.assetsContext??e.fd}hasVariable(e){return e in this._userVariables}setVariable(e,d){var v;this._userVariables[e]=d,null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Hv:{name:e,value:d}})}getAsset(e,d){return(0,W.c)(this.assetsContext,e,d)}getVariable(e){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Hv:{name:e,value:this._userVariables[e]}}),this._userVariables[e]}get userVariables(){return this._userVariables}Ae(){return this._configuration.fd}_getUniqueIdPrefixedName(e,d){return`${e.uniqueId}_${d}`}_getGlobalContextVariable(e,d){var v;return null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Hv:{name:e,defaultValue:d,possibleValue:this._globalContextVariables[e]}}),this._hasGlobalContextVariable(e)?this._globalContextVariables[e]:d}_setGlobalContextVariable(e,d){var v;null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Hv:{name:e,value:d}}),this._globalContextVariables[e]=d}_deleteGlobalContextVariable(e){var d;null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Hv:{name:e}}),delete this._globalContextVariables[e]}_hasGlobalContextVariable(e){return e in this._globalContextVariables}_setExecutionVariable(e,d,v){this._executionVariables[this._getUniqueIdPrefixedName(e,d)]=v}_getExecutionVariable(e,d,v){return this._hasExecutionVariable(e,d)?this._executionVariables[this._getUniqueIdPrefixedName(e,d)]:v}_deleteExecutionVariable(e,d){delete this._executionVariables[this._getUniqueIdPrefixedName(e,d)]}_hasExecutionVariable(e,d){return this._getUniqueIdPrefixedName(e,d)in this._executionVariables}_hasConnectionValue(e){return e.uniqueId in this._connectionValues}_setConnectionValue(e,d){var v;this._connectionValues[e.uniqueId]=d,null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Hv:{connectionPointId:e.uniqueId,value:d}})}_setConnectionValueByKey(e,d){this._connectionValues[e]=d}_getConnectionValue(e){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Hv:{connectionPointId:e.uniqueId,value:this._connectionValues[e.uniqueId]}}),this._connectionValues[e.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(e){this._pendingBlocks.includes(e)||(this._pendingBlocks.push(e),this._pendingBlocks.sort(((e,d)=>e.priority-d.priority)))}_removePendingBlock(e){const d=this._pendingBlocks.indexOf(e);-1!==d&&this._pendingBlocks.splice(d,1)}_clearPendingBlocks(){for(const e of this._pendingBlocks)e._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(e){var d;this.onNodeExecutedObservable.notifyObservers(e),null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:e.getClassName(),uniqueId:e.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(e){this._setGlobalContextVariable("timeSinceStart",e.timeSinceStart),this._setGlobalContextVariable("deltaTime",e.deltaTime);for(const v of this._pendingBlocks){var d;null===(d=v._executeOnTick)||void 0===d||d.call(v,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.h;e.uniqueId=this.uniqueId,e._userVariables={};for(const P in this._userVariables)d(P,this._userVariables[P],e._userVariables);e._connectionValues={};for(const P in this._connectionValues)d(P,this._connectionValues[P],e._connectionValues);var v;this.assetsContext!==this.Ae()&&(e._assetsContext={meshes:this.assetsContext.meshes.map((e=>e.id)),materials:this.assetsContext.materials.map((e=>e.id)),textures:this.assetsContext.textures.map((e=>e.name)),animations:this.assetsContext.animations.map((e=>e.name)),lights:this.assetsContext.lights.map((e=>e.id)),cameras:this.assetsContext.cameras.map((e=>e.id)),Yg:null===(v=this.assetsContext.Yg)||void 0===v?void 0:v.map((e=>e.name)),skeletons:this.assetsContext.skeletons.map((e=>e.id)),sk:this.assetsContext.sk.map((e=>e.name)),geometries:this.assetsContext.geometries.map((e=>e.id)),multiMaterials:this.assetsContext.multiMaterials.map((e=>e.id)),transformNodes:this.assetsContext.transformNodes.map((e=>e.id))})}getClassName(){return"FlowGraphContext"}}(0,L.e)([(0,B.M)()],g.prototype,"uniqueId",void 0);var F=v(14192),w=v(12688);class G{constructor(e){this.onEventTriggeredObservable=new p.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=e,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Fd.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const e=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Hv:{timeSinceStart:this._startingTime,deltaTime:e}}),this._startingTime+=e})),this._meshPickedObserver=this._scene.onPointerObservable.add((e=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Hv:e})}),w.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((e=>{const d=e.pointerId,v=e.mesh,P=this._pointerUnderMeshState[d];!P&&v?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Hv:{pointerId:d,mesh:v}}):P&&!v?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Hv:{pointerId:d,mesh:P}}):P&&v&&P!==v&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Hv:{pointerId:d,mesh:P,over:v}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Hv:{pointerId:d,mesh:v,out:P}})),this._pointerUnderMeshState[d]=v}),w.c.POINTERMOVE)}dispose(){var e,d,v,P,p;null===(e=this._sceneDisposeObserver)||void 0===e||e.remove(),null===(d=this._sceneReadyObserver)||void 0===d||d.remove(),null===(v=this._sceneOnBeforeRenderObserver)||void 0===v||v.remove(),null===(P=this._meshPickedObserver)||void 0===P||P.remove(),null===(p=this._meshUnderPointerObserver)||void 0===p||p.remove(),this.onEventTriggeredObservable.clear()}}var U,D=v(14208);!function(e){e[e.Stopped=0]="Stopped",e[e.Started=1]="Started"}(U||(U={}));class C{get state(){return this._state}set state(e){this._state=e,this.onStateChangedObservable.notifyObservers(e)}constructor(e){this.onStateChangedObservable=new p.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=e.fd,this._sceneEventCoordinator=new G(this._scene),this._coordinator=e.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((e=>{for(const d of this._executionContexts){const v=this._getContextualOrder(e.type,d);for(const P of v)if(!P._executeEvent(d,e.Hv))break}switch(e.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const d of this._executionContexts)d._notifyOnTick(e.Hv);break;case"SceneDispose":this.dispose()}}))}createContext(){const e=new g({fd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(e),e}getContext(e){return this._executionContexts[e]}addEventBlock(e){if("PointerOver"!==e.type&&"PointerOut"!==e.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==e.type&&this._eventBlocks[e.type].push(e),1===this.state)for(const d of this._executionContexts)e._startPendingTasks(d);else this.onStateChangedObservable.addOnce((d=>{if(1===d)for(const v of this._executionContexts)e._startPendingTasks(v)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((e=>{1===e&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const e of this._executionContexts)for(const d in this._eventBlocks){const v=this._getContextualOrder(d,e);for(const d of v)d._startPendingTasks(e)}}_getContextualOrder(e,d){const v=this._eventBlocks[e].sort(((e,d)=>d.initPriority-e.initPriority));if("MeshPick"===e){const e=[];for(const P of v){const p=P.asset.getValue(d);let L=0;for(;L<v.length;L++){const e=v[L].asset.getValue(d);if(p&&e&&(0,D.l)(p,e))break}e.splice(L,0,P)}return e}return v}dispose(){var e;if(0!==this.state){this.state=0;for(const e of this._executionContexts)e._clearPendingBlocks();this._executionContexts.length=0;for(const e in this._eventBlocks)this._eventBlocks[e].length=0;null===(e=this._eventObserver)||void 0===e||e.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(e){const d=[],v=new Set;for(const P in this._eventBlocks)for(const e of this._eventBlocks[P])d.push(e),v.add(e.uniqueId);for(;d.length>0;){const P=d.pop();e(P);for(const e of P.dataInputs)for(const P of e._connectedPoint)v.has(P._ownerBlock.uniqueId)||(d.push(P._ownerBlock),v.add(P._ownerBlock.uniqueId));if(P instanceof F.c)for(const e of P.signalOutputs)for(const P of e._connectedPoint)v.has(P._ownerBlock.uniqueId)||(d.push(P._ownerBlock),v.add(P._ownerBlock.uniqueId))}}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1?arguments[1]:void 0;e.allBlocks=[],this.visitAllBlocks((d=>{const v={};d.serialize(v),e.allBlocks.push(v)})),e.executionContexts=[];for(const v of this._executionContexts){const P={};v.serialize(P,d),e.executionContexts.push(P)}}}class q{constructor(e){this.config=e,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.fd.Fd.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.fd.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const e=this._executeOnNextFrame.slice(0);if(e.length)for(const d of e){this.notifyCustomEvent(d.id,d.data,!1);const e=this._executeOnNextFrame.findIndex((e=>e.uniqueId===d.uniqueId));-1!==e&&this._executeOnNextFrame.splice(e,1)}}));(q.SceneCoordinators.get(this.config.fd)??[]).push(this)}createGraph(){const e=new C({fd:this.config.fd,coordinator:this});return this._flowGraphs.push(e),e}removeGraph(e){const d=this._flowGraphs.indexOf(e);-1!==d&&(e.dispose(),this._flowGraphs.splice(d,1))}start(){for(const e of this._flowGraphs)e.start()}dispose(){var e,d;for(const p of this._flowGraphs)p.dispose();this._flowGraphs.length=0,null===(e=this._disposeObserver)||void 0===e||e.remove(),null===(d=this._onBeforeRenderObserver)||void 0===d||d.remove();const v=q.SceneCoordinators.get(this.config.fd)??[],P=v.indexOf(this);-1!==P&&v.splice(P,1)}serialize(e,d){e._flowGraphs=[];for(const v of this._flowGraphs){const P={};v.serialize(P,d),e._flowGraphs.push(P)}e.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(e){let d=this._customEventsMap.get(e);return d||(d=new p.d,this._customEventsMap.set(e,d)),d}notifyCustomEvent(e,d){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:e,data:d,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(e)){const d=this._eventExecutionCounter.get(e);if(this._eventExecutionCounter.set(e,d+1),d>=q.MaxEventTypeExecutionPerFrame)return void(d===q.MaxEventTypeExecutionPerFrame&&V.c.Warn(`FlowGraphCoordinator: Too many executions of event "${e}".`))}else this._eventExecutionCounter.set(e,1);const v=this._customEventsMap.get(e);v&&v.notifyObservers(d)}}q.MaxEventsPerType=30,q.MaxEventTypeExecutionPerFrame=30,q.SceneCoordinators=new Map},14214:(e,d,v)=>{"use strict";v.d(d,{e:()=>p});var P=v(14216);class p extends P.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(e){e._notifyExecuteNode(this),this.done._activateSignal(e)}}},14192:(e,d,v)=>{"use strict";v.d(d,{c:()=>X});var P=v(14195),p=v(14200),L=v(12381);class B extends p.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(e){super.connectTo(e),this._connectedPoint.sort(((e,d)=>d.priority-e.priority))}_activateSignal(e){var d;if(null===(d=e.logger)||void 0===d||d.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Hv:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)e._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(e,this),e._increaseExecutionId();else for(const v of this._connectedPoint)v._activateSignal(e)}}(0,L.h)("FlowGraphSignalConnection",B);class X extends P.e{constructor(e){super(e),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(e){const d=new B(e,0,this);return this.signalInputs.push(d),d}_registerSignalOutput(e){const d=new B(e,1,this);return this.signalOutputs.push(d),d}_unregisterSignalInput(e){const d=this.signalInputs.findIndex((d=>d.name===e));-1!==d&&(this.signalInputs[d].dispose(),this.signalInputs.splice(d,1))}_unregisterSignalOutput(e){const d=this.signalOutputs.findIndex((d=>d.name===e));-1!==d&&(this.signalOutputs[d].dispose(),this.signalOutputs.splice(d,1))}_reportError(e,d){this.error.Hv="string"===typeof d?new Error(d):d,this.error._activateSignal(e)}getSignalInput(e){return this.signalInputs.find((d=>d.name===e))}getSignalOutput(e){return this.signalOutputs.find((d=>d.name===e))}serialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(e),e.signalInputs=[],e.signalOutputs=[];for(const d of this.signalInputs){const v={};d.serialize(v),e.signalInputs.push(v)}for(const d of this.signalOutputs){const v={};d.serialize(v),e.signalOutputs.push(v)}}deserialize(e){for(let d=0;d<e.signalInputs.length;d++){const v=this.getSignalInput(e.signalInputs[d].name);if(!v)throw new Error("Could not find signal input with name "+e.signalInputs[d].name+" in block "+e.className);v.deserialize(e.signalInputs[d])}for(let d=0;d<e.signalOutputs.length;d++){const v=this.getSignalOutput(e.signalOutputs[d].name);if(!v)throw new Error("Could not find signal output with name "+e.signalOutputs[d].name+" in block "+e.className);v.deserialize(e.signalOutputs[d])}}getClassName(){return"FlowGraphExecutionBlock"}}},14220:(e,d,v)=>{"use strict";v.d(d,{c:()=>p});var P=v(14192);class p extends P.c{constructor(e){super(e),this.out=this._registerSignalOutput("out")}}},14181:(e,d,v)=>{"use strict";v.d(d,{A:()=>i,B:()=>me,F:()=>x,H:()=>A,b:()=>W,d:()=>g,f:()=>n,g:()=>U,h:()=>D,l:()=>C,n:()=>k,p:()=>l,q:()=>V,t:()=>F,x:()=>w,y:()=>G});var P,p=v(12420),L=v(12463),B=v(14179),X=v(14185);!function(e){e.Any="any",e.String="string",e.Number="number",e.Boolean="boolean",e.Object="object",e.Integer="FlowGraphInteger",e.Vector2="Vector2",e.mv="mv",e.Vector4="Vector4",e.Quaternion="Quaternion",e.Matrix="Matrix",e.Matrix2D="Matrix2D",e.Matrix3D="Matrix3D",e.Kd="Kd",e.Up="Up"}(P||(P={}));class z{constructor(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=e,this.defaultValue=d,this.animationType=v}serialize(e){e.typeName=this.typeName,e.defaultValue=this.defaultValue}}const W=new z("any",void 0),V=new z("string",""),k=new z("number",0,0),g=new z("boolean",!1),F=new z("Vector2",p.Vector2.Zero(),5),w=new z("mv",p.mv.Zero(),1),G=new z("Vector4",p.Vector4.Zero()),U=new z("Matrix",p.Matrix.Identity(),3),D=new z("Matrix2D",new X.c),C=new z("Matrix3D",new X.e),q=new z("Kd",L.Kd.Black(),4),h=new z("Up",new L.Up(0,0,0,0),7),l=new z("Quaternion",p.Quaternion.Identity(),2);l.typeTransformer=e=>{if(e.getClassName){if("Vector4"===e.getClassName())return p.Quaternion.Nd(e.Yd());if("mv"===e.getClassName())return p.Quaternion.FromEulerVector(e);if("Matrix"===e.getClassName())return p.Quaternion.FromRotationMatrix(e)}return e};const n=new z("FlowGraphInteger",new B.d(0),0);function A(e){const d=e;switch(typeof e){case"string":return V;case"number":return k;case"boolean":return g;case"object":if(d.getClassName)switch(d.getClassName()){case"Vector2":return F;case"mv":return w;case"Vector4":return G;case"Matrix":return U;case"Kd":return q;case"Up":return h;case"Quaternion":return l;case"FlowGraphInteger":return n;case"Matrix2D":return D;case"Matrix3D":return C}return W;default:return W}}function x(e){switch(e){case"string":return V;case"number":return k;case"boolean":return g;case"Vector2":return F;case"mv":return w;case"Vector4":return G;case"Matrix":return U;case"Kd":return q;case"Up":return h;case"Quaternion":return l;case"FlowGraphInteger":return n;case"Matrix2D":return D;case"Matrix3D":return C;default:return W}}function i(e){switch(e){case"number":default:return 0;case"Vector2":return 5;case"mv":return 1;case"Matrix":return 3;case"Kd":return 4;case"Up":return 7;case"Quaternion":return 2}}function me(e){switch(e){case 0:return k;case 5:return F;case 1:return w;case 3:return U;case 4:return q;case 7:return h;case 2:return l;default:return W}}},14177:(e,d,v)=>{"use strict";v.d(d,{e:()=>V,h:()=>W,k:()=>k});var P=v(12463),p=v(12420),L=v(14179),B=v(14181),X=v(14185);function z(e){return"Vector2"===e||"mv"===e||"Vector4"===e||"Quaternion"===e||"Kd"===e||"Up"===e}function W(e,d,v){var P;const p=(null===d||void 0===d||null===(P=d.getClassName)||void 0===P?void 0:P.call(d))??"";if(z(p)||function(e){return"Matrix"===e||"Matrix2D"===e||"Matrix3D"===e}(p))v[e]={value:d.Yd(),className:p};else if("FlowGraphInteger"===p)v[e]={value:d.value,className:p};else if(p&&(d.id||d.name))v[e]={id:d.id,name:d.name,className:p};else{if("object"===typeof d)throw new Error(`Could not serialize value ${d}`);v[e]=d}}function V(e,d,v,W){const k=d[e];let g;const F=(null===k||void 0===k?void 0:k.type)??(null===k||void 0===k?void 0:k.className);if(function(e){return"Mesh"===e||"AbstractMesh"===e||"GroundMesh"===e||"InstanceMesh"===e||"LinesMesh"===e||"GoldbergMesh"===e||"GreasedLineMesh"===e||"TrailMesh"===e}(F)){let e=W.meshes.filter((e=>k.id?e.id===k.id:e.name===k.name));0===e.length&&(e=W.transformNodes.filter((e=>k.id?e.id===k.id:e.name===k.name))),g=k.uniqueId?e.find((e=>e.uniqueId===k.uniqueId)):e[0]}else if(z(F))g=function(e,d){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===e)return p.Vector2.Nd(d);if("mv"===e)return v&&(d[2]*=-1),p.mv.Nd(d);if("Vector4"===e)return p.Vector4.Nd(d);if("Quaternion"===e)return v&&(d[2]*=-1,d[3]*=-1),p.Quaternion.Nd(d);if("Kd"===e)return new P.Kd(d[0],d[1],d[2]);if("Up"===e)return new P.Up(d[0],d[1],d[2],d[3]);throw new Error(`Unknown vector class name ${e}`)}(F,k.value);else if(function(e){return"AnimationGroup"===e}(F)){const e=W.animationGroups.filter((e=>e.name===k.name));g=1===e.length?e[0]:e.find((e=>e.uniqueId===k.uniqueId))}else g="Matrix"===F?p.Matrix.Nd(k.value):"Matrix2D"===F?new X.c(k.value):"Matrix3D"===F?new X.e(k.value):"FlowGraphInteger"===F?L.d.FromValue(k.value):"number"===F||"string"===F||"boolean"===F?k.value[0]:k&&void 0!==k.value?k.value:Array.isArray(k)?k.reduce(((e,d)=>d.eventData?(e[d.id]={type:(0,B.F)(d.type)},"undefined"!==typeof d.value&&(e[d.id].value=V("value",d,v,W)),e):e),{}):k;return g}function k(e){return"FlowGraphJsonPointerParserBlock"===e}},14208:(e,d,v)=>{"use strict";function P(e,d){return!(!e.parent||e.parent!==d&&!P(e.parent,d))}function p(e){if(e.getClassName)return e.getClassName()}function L(e,d){return e===d&&("Vector2"===e||"mv"===e||"Vector4"===e||"Quaternion"===e)}function B(e,d){return e===d&&("Matrix"===e||"Matrix2D"===e||"Matrix3D"===e)}function X(e,d){return"FlowGraphInteger"===e&&"FlowGraphInteger"===d}function z(e,d){const v="number"===typeof e||"number"===typeof(null===e||void 0===e?void 0:e.value);return v&&!d?!isNaN(W(e)):v}function W(e){return"number"===typeof e?e:e.value}v.d(d,{c:()=>X,d:()=>B,g:()=>L,h:()=>p,l:()=>P,o:()=>W,p:()=>z})},13547:(e,d,v)=>{"use strict";v.r(d),v.d(d,{SceneInstrumentation:()=>L});var P=v(12240),p=v(12633);class L{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(e){e!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=e,e?(this._onBeforeActiveMeshesEvaluationObserver=this.fd.onBeforeActiveMeshesEvaluationObservable.add((()=>{P.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.fd.onAfterActiveMeshesEvaluationObservable.add((()=>{P.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.fd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.fd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(e){e!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=e,e?(this._onBeforeRenderTargetsRenderObserver=this.fd.onBeforeRenderTargetsRenderObservable.add((()=>{P.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.fd.onAfterRenderTargetsRenderObservable.add((()=>{P.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.fd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.fd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(e){e!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=e,e?(this._onBeforeParticlesRenderingObserver=this.fd.onBeforeParticlesRenderingObservable.add((()=>{P.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.fd.onAfterParticlesRenderingObservable.add((()=>{P.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.fd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.fd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(e){e!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=e,this.fd.spriteManagers&&(e?(this._onBeforeSpritesRenderingObserver=this.fd.onBeforeSpritesRenderingObservable.add((()=>{P.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.fd.onAfterSpritesRenderingObservable.add((()=>{P.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.fd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.fd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(e){e!==this._capturePhysicsTime&&this.fd.onBeforePhysicsObservable&&(this._capturePhysicsTime=e,e?(this._onBeforePhysicsObserver=this.fd.onBeforePhysicsObservable.add((()=>{P.Tools.StartPerformanceCounter("gg"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.fd.onAfterPhysicsObservable.add((()=>{P.Tools.EndPerformanceCounter("gg"),this._physicsTime.endMonitoring()}))):(this.fd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.fd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(e){e!==this._captureAnimationsTime&&(this._captureAnimationsTime=e,e?this._onAfterAnimationsObserver=this.fd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.fd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(e){this._captureFrameTime=e}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(e){this._captureInterFrameTime=e}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(e){e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeforeDrawPhaseObserver=this.fd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),P.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.fd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),P.Tools.EndPerformanceCounter("Main render")}))):(this.fd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.fd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(e){e!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=e,e?(this._onBeforeCameraRenderObserver=this.fd.onBeforeCameraRenderObservable.add((e=>{this._cameraRenderTime.beginMonitoring(),P.Tools.StartPerformanceCounter(`Rendering camera ${e.name}`)})),this._onAfterCameraRenderObserver=this.fd.onAfterCameraRenderObservable.add((e=>{this._cameraRenderTime.endMonitoring(!1),P.Tools.EndPerformanceCounter(`Rendering camera ${e.name}`)}))):(this.fd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.fd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.fd.getEngine()._drawCalls}constructor(e){this.fd=e,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new p.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new p.e,this._captureFrameTime=!1,this._frameTime=new p.e,this._captureRenderTime=!1,this._renderTime=new p.e,this._captureInterFrameTime=!1,this._interFrameTime=new p.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new p.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new p.e,this._capturePhysicsTime=!1,this._physicsTime=new p.e,this._captureAnimationsTime=!1,this._animationsTime=new p.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new p.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=e.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(P.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.fd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=e.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(P.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.gd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.gd(),this._captureParticlesRenderTime&&this._particlesRenderTime.gd(),this._captureSpritesRenderTime&&this._spritesRenderTime.gd(),this._captureRenderTime&&this._renderTime.gd(),this._captureCameraRenderTime&&this._cameraRenderTime.gd()}))}dispose(){this._disposed||(this.fd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.fd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.fd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.fd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.fd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.fd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.fd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.fd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.fd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.fd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.fd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.fd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.fd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.fd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.fd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.fd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.fd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.fd=null,this._disposed=!0)}}},14168:(e,d,v)=>{"use strict";v.d(d,{b:()=>V});var P=v(12403),p=v(12409),L=v(12420),B=v(12833),X=v(12962),z=v(13013),W=v(12381);B.e.AddNodeConstructor("Light_Type_1",((e,d)=>()=>new V(e,L.mv.Zero(),d)));class V extends z.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(e){this._orthoLeft=e}get orthoRight(){return this._orthoRight}set orthoRight(e){this._orthoRight=e}get orthoTop(){return this._orthoTop}set orthoTop(e){this._orthoTop=e}get orthoBottom(){return this._orthoBottom}set orthoBottom(e){this._orthoBottom=e}constructor(e,d,v){super(e,v),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=d.scale(-1),this.direction=d}getClassName(){return"wg"}getTypeID(){return X.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(e,d,v){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,d,v)}_setDefaultFixedFrustumShadowProjectionMatrix(e){const d=this.Ae().activeCamera;d&&L.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:d.td,void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,e,this.Ae().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(e,d,v){const P=this.Ae().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const e=L.mv.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let P=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let B=0;B<v.length;B++){const X=v[B];if(!X)continue;const z=X.getBoundingInfo().boundingBox;for(let v=0;v<z.vectorsWorld.length;v++)L.mv.TransformCoordinatesToRef(z.vectorsWorld[v],d,e),e.x<this._orthoLeft&&(this._orthoLeft=e.x),e.y<this._orthoBottom&&(this._orthoBottom=e.y),e.x>this._orthoRight&&(this._orthoRight=e.x),e.y>this._orthoTop&&(this._orthoTop=e.y),this.autoCalcShadowZBounds&&(e.z<P&&(P=e.z),e.z>p&&(p=e.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=P,this._shadowMaxZ=p)}const p=this._orthoRight-this._orthoLeft,B=this._orthoTop-this._orthoBottom,X=void 0!==this.shadowMinZ?this.shadowMinZ:(null===P||void 0===P?void 0:P.td)||0,z=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===P||void 0===P?void 0:P.maxZ)||1e4,W=this.Ae().getEngine().Wd;L.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-p*this.shadowOrthoScale,this._orthoRight+p*this.shadowOrthoScale,this._orthoBottom-B*this.shadowOrthoScale,this._orthoTop+B*this.shadowOrthoScale,W?z:X,W?X:z,e,this.Ae().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,d){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,d),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,d),this)}transferToNodeMaterialEffect(e,d){return this.computeTransformedInformation()?(e.setFloat3(d,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(d,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(e){const d=this._scene.getEngine();return!d.Wd&&d.isNDCHalfZRange?0:1}getDepthMaxZ(e){const d=this._scene.getEngine();return d.Wd&&d.isNDCHalfZRange?0:1}prepareLightSpecificDefines(e,d){e["DIRLIGHT"+d]=!0}}(0,P.e)([(0,p.M)()],V.prototype,"shadowFrustumSize",null),(0,P.e)([(0,p.M)()],V.prototype,"shadowOrthoScale",null),(0,P.e)([(0,p.M)()],V.prototype,"autoUpdateExtends",void 0),(0,P.e)([(0,p.M)()],V.prototype,"autoCalcShadowZBounds",void 0),(0,P.e)([(0,p.M)("orthoLeft")],V.prototype,"_orthoLeft",void 0),(0,P.e)([(0,p.M)("orthoRight")],V.prototype,"_orthoRight",void 0),(0,P.e)([(0,p.M)("orthoTop")],V.prototype,"_orthoTop",void 0),(0,P.e)([(0,p.M)("orthoBottom")],V.prototype,"_orthoBottom",void 0),(0,W.h)("BABYLON.DirectionalLight",V)},14612:(e,d,v)=>{"use strict";v.d(d,{c:()=>V});var P=v(12403),p=v(12409),L=v(12420),B=v(12463),X=v(12833),z=v(12962),W=v(12381);X.e.AddNodeConstructor("Light_Type_3",((e,d)=>()=>new V(e,L.mv.Zero(),d)));class V extends z.e{constructor(e,d,v){super(e,v),this.groundColor=new B.Kd(0,0,0),this.direction=d||L.mv.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Ag"}setDirectionToTarget(e){return this.direction=L.mv.Normalize(e.Zd(L.mv.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(e,d){const v=L.mv.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",v.x,v.y,v.z,0,d),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.nX),d),this}transferToNodeMaterialEffect(e,d){const v=L.mv.Normalize(this.direction);return e.setFloat3(d,v.x,v.y,v.z),this}Md(){return this._worldMatrix||(this._worldMatrix=L.Matrix.Identity()),this._worldMatrix}getTypeID(){return z.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(e,d){e["HEMILIGHT"+d]=!0}}(0,P.e)([(0,p.l)()],V.prototype,"groundColor",void 0),(0,P.e)([(0,p.J)()],V.prototype,"direction",void 0),(0,W.h)("BABYLON.HemisphericLight",V)},14136:(e,d,v)=>{"use strict";v.d(d,{d:()=>k});var P=v(12403),p=v(12409),L=v(12420),B=v(12833),X=v(12962),z=v(13013),W=v(12399),V=v(12381);B.e.AddNodeConstructor("Light_Type_2",((e,d)=>()=>new k(e,L.mv.Zero(),L.mv.Zero(),0,0,d)));class k extends z.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(e){this._iesProfileTexture!==e&&(this._iesProfileTexture=e,this._iesProfileTexture&&k._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(e){this._innerAngle=e,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(e){this._projectionTexture!==e&&(this._projectionTexture=e,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(k._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):k._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(e){return void 0!==e.onGeneratedObservable}static _IsTexture(e){return void 0!==e.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(e){this._projectionTextureProjectionLightMatrix=e,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(e,d,v,P,p,B){super(e,B),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=L.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=L.mv.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=L.mv.Zero(),this._projectionTextureViewLightMatrix=L.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=L.Matrix.Zero(),this._projectionTextureScalingMatrix=L.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=d,this.direction=v,this.angle=P,this.exponent=p}getClassName(){return"SpotLight"}getTypeID(){return X.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(e){super._setDirection(e),this._projectionTextureViewLightDirty=!0}_setPosition(e){super._setPosition(e),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(e,d,v){const P=this.Ae().activeCamera;if(!P)return;this._shadowAngleScale=this._shadowAngleScale||1;const p=this._shadowAngleScale*this._angle,B=void 0!==this.shadowMinZ?this.shadowMinZ:P.td,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,z=this.Ae().getEngine().Wd;L.Matrix.PerspectiveFovLHToRef(p,1,z?X:B,z?B:X,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,z)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),L.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const e=this.projectionTextureLightFar,d=this.projectionTextureLightNear,v=e/(e-d),P=-v*d,p=1/Math.tan(this._angle/2);L.Matrix.FromValuesToRef(p/1,0,0,0,0,p,0,0,0,0,v,1,0,0,P,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof W.e){const e=this._projectionTexture.uScale/2,d=this._projectionTexture.vScale/2;L.Matrix.FromValuesToRef(e,0,0,0,0,d,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(e,d){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+d,this._projectionTextureMatrix),e.setTexture("projectionLightTexture"+d,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&e.setTexture("iesLightTexture"+d,this._iesProfileTexture),this}transferToEffect(e,d){let v;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,d),v=L.mv.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,d),v=L.mv.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",v.x,v.y,v.z,this._cosHalfAngle,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,d),this}transferToNodeMaterialEffect(e,d){let v;return v=this.computeTransformedInformation()?L.mv.Normalize(this.transformedDirection):L.mv.Normalize(this.direction),this.Ae().useRightHandedSystem?e.setFloat3(d,-v.x,-v.y,-v.z):e.setFloat3(d,v.x,v.y,v.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(e){const d=this._scene.getEngine(),v=void 0!==this.shadowMinZ?this.shadowMinZ:(null===e||void 0===e?void 0:e.td)??0;return d.Wd&&d.isNDCHalfZRange?v:this._scene.getEngine().isNDCHalfZRange?0:v}getDepthMaxZ(e){const d=this._scene.getEngine(),v=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===e||void 0===e?void 0:e.maxZ)??1e4;return d.Wd&&d.isNDCHalfZRange?0:v}prepareLightSpecificDefines(e,d){e["SPOTLIGHT"+d]=!0,e["PROJECTEDLIGHTTEXTURE"+d]=!(!this.projectionTexture||!this.projectionTexture.isReady()),e["IESLIGHTTEXTURE"+d]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,P.e)([(0,p.M)()],k.prototype,"angle",null),(0,P.e)([(0,p.M)()],k.prototype,"innerAngle",null),(0,P.e)([(0,p.M)()],k.prototype,"shadowAngleScale",null),(0,P.e)([(0,p.M)()],k.prototype,"exponent",void 0),(0,P.e)([(0,p.M)()],k.prototype,"projectionTextureLightNear",null),(0,P.e)([(0,p.M)()],k.prototype,"projectionTextureLightFar",null),(0,P.e)([(0,p.M)()],k.prototype,"projectionTextureUpDirection",null),(0,P.e)([(0,p.C)("projectedLightTexture")],k.prototype,"_projectionTexture",void 0),(0,V.h)("BABYLON.SpotLight",k)},13856:(e,d,v)=>{"use strict";v.d(d,{b:()=>B,e:()=>L,f:()=>X});const P={},p={};function L(e,d){P[e]=d}function B(e,d){p[e]=d}function X(e){return p[e]?p[e]:null}},13738:(e,d,v)=>{"use strict";v.d(d,{e:()=>A,g:()=>Q});var P,p=v(12240),L=v(12248),B=v(12653),X=v(12281),z=v(12253),W=v(12880),V=v(12283),k=v(12291),g=v(12384),F=v(12319),w=v(12277);!function(e){e[e.Clean=0]="Clean",e[e.Stop=1]="Stop",e[e.Sync=2]="Sync",e[e.NoSync=3]="NoSync"}(P||(P={}));const G=new L.d,U={};let D=!1;function C(){return U[".babylon"]}function q(e,d){const v=U[e];return v||(z.c.Warn("Unable to find a plugin to load "+e+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),d?C():void 0)}function h(e,d,v){let P="Unable to load from "+(e.rawData?"binary data":e.url);return d?P+=`: ${d}`:v&&(P+=`: ${v}`),P}async function l(e,d,v,P,p,L,B,X,z){var W;const k="data:"===(g=e.url).substring(0,5)?g.substring(5):null;var g;if(e.rawData&&!B)throw"When using ArrayBufferView to load data the file extension must be provided.";const D=k||B?"":function(e){const d=e.indexOf("?");-1!==d&&(e=e.substring(0,d));const v=e.lastIndexOf(".");return e.substring(v,e.length).toLowerCase()}(e.url);let h=B?q(B,!0):k?function(e){for(const d in U){const v=U[d].plugin;if(v.canDirectLoad&&v.canDirectLoad(e))return U[d]}return C()}(e.url):q(D,!1);if(!h&&D){if(e.url&&!e.url.startsWith("blob:")){const d=await async function(e,d){const v=d.method||"GET";return await new Promise(((P,p)=>{const L=new w.d;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const e={};if(d.responseHeaders)for(const v of d.responseHeaders)e[v]=L.getResponseHeader(v)||"";P({response:L.response,headerValues:e})}else p(`Unable to fetch data from ${e}. Error code: ${L.status}`)})),L.open(v,e),L.send()}))}(e.url,{method:"HEAD",responseHeaders:["Content-Type"]}),v=d.headerValues?d.headerValues["Content-Type"]:"";v&&(h=function(e){for(const d in U){const v=U[d];if(v.mimeType===e)return v}}(v))}h||(h=C())}if(!h)throw new Error(`No plugin or fallback for ${B??e.url}`);if(!1===(null===z||void 0===z||null===(W=z[h.plugin.name])||void 0===W?void 0:W.enabled))throw new Error(`The '${h.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(e.rawData&&!h.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(e=>{if(h.plugin.createPlugin){const d=h.plugin.createPlugin(z??{});return d instanceof Promise?(d.then(e).catch((e=>{p("Error instantiating plugin.",e)})),null):(e(d),d)}return e(h.plugin),h.plugin})((z=>{var W;if(!z)throw`The loader plugin corresponding to the '${B}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(G.notifyObservers(z),k&&(z.canDirectLoad&&z.canDirectLoad(e.url)||!(0,V.g)(e.url))){if(z.directLoad){const e=z.directLoad(d,k);e instanceof Promise?e.then((e=>{v(z,e)})).catch((e=>{p("Error in directLoad of _loadData: "+e,e)})):v(z,e)}else v(z,k);return}const g=h.isBinary,w=(e,P)=>{d.W?p("Scene has been disposed"):v(z,e,P)};let U=null,D=!1;null===(W=z.Fd)||void 0===W||W.add((()=>{D=!0,U&&(U.abort(),U=null),L()}));const C=()=>{if(D)return;const v=(e,d)=>{p(null===e||void 0===e?void 0:e.statusText,d)};if(!z.loadFile&&e.rawData)throw"Plugin does not support loading ArrayBufferView.";U=z.loadFile?z.loadFile(d,e.rawData||e.file||e.url,e.rootUrl,w,P,g,v,X):d._loadFile(e.file||e.url,w,P,!0,g,v)},q=d.getEngine();let l=q.enableOfflineSupport;if(l){let v=!1;for(const P of d.disableOfflineSupportExceptionRules)if(P.test(e.url)){v=!0;break}l=!v}l&&F.b.OfflineProviderFactory?d.offlineProvider=F.b.OfflineProviderFactory(e.url,C,q.disableManifestCheck):C()}))}function n(e,d){let v,P,L=null,B=null;if(d)if(d.name)v=`file:${d.name}`,P=d.name,L=d;else if(ArrayBuffer.isView(d))v="",P=(0,g.b)(),B=d;else if(d.startsWith("data:"))v=d,P="";else if(e){const L=d;if("/"===L.substring(0,1))return p.Tools.Error("Wrong sceneFilename parameter"),null;v=e+L,P=L}else v=d,P=p.Tools.GetFilename(d),e=p.Tools.GetFolderPath(d);else v=e,P=p.Tools.GetFilename(e),e=p.Tools.GetFolderPath(e);return{url:v,rootUrl:e,name:P,file:L,rawData:B}}function A(e){if("string"===typeof e.extensions){const d=e.extensions;U[d.toLowerCase()]={plugin:e,isBinary:!1}}else{const d=e.extensions,v=Object.keys(d);for(const P of v)U[P.toLowerCase()]={plugin:e,isBinary:d[P].isBinary,mimeType:d[P].mimeType}}}async function x(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.c.LastCreatedScene,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!P)return z.c.Error("No scene available to import mesh to"),null;const F=n(d,v);if(!F)return null;const w={};P.addPendingData(w);const G=()=>{P.removePendingData(w)},U=(e,d)=>{const v=h(F,e,d);B?B(P,v,new k.i(v,k.h.SceneLoaderError,d)):z.c.Error(v),G()},D=L?e=>{try{L(e)}catch(d){U("Error in onProgress callback: "+d,d)}}:void 0,C=(e,d,v,L,B,X,z,W)=>{if(P.importedMeshesFiles.push(F.url),p)try{p(e,d,v,L,B,X,z,W)}catch(V){U("Error in onSuccess callback: "+V,V)}P.removePendingData(w)};return await l(F,P,((d,v,p)=>{if(d.rewriteRootURL&&(F.rootUrl=d.rewriteRootURL(F.rootUrl,p)),d.importMesh){const p=[],L=[],B=[];if(!d.importMesh(e,P,v,F.rootUrl,p,L,B,U))return;P.loadingPluginName=d.name,C(p,L,B,[],[],[],[],[])}else{d.importMeshAsync(e,P,v,F.rootUrl,D,F.name).then((e=>{P.loadingPluginName=d.name,C(e.meshes,e.sk,e.skeletons,e.animationGroups,e.transformNodes,e.geometries,e.lights,e.spriteManagers)})).catch((e=>{U(e.message,e)}))}}),D,U,G,W,V,g)}async function i(e,d,v,P,p,L,B,X){return await new Promise(((z,W)=>{try{x(e,d,v,P,((e,d,v,P,p,L,B,X)=>{z({meshes:e,sk:d,skeletons:v,animationGroups:P,transformNodes:p,geometries:L,lights:B,spriteManagers:X})}),p,((e,d,v)=>{W(v||new Error(d))}),L,B,X).catch(W)}catch(k){W(k)}}))}async function me(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.c.LastCreatedEngine,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};v?await Z(e,d,new B.d(v),P,L,z,W,V,k):p.Tools.Error("No engine available")}async function r(e,d,v,P,p,L,B){return await new Promise(((X,z)=>{me(e,d,v,(e=>{X(e)}),P,((e,d,v)=>{z(v||new Error(d))}),p,L,B)}))}async function Z(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.c.LastCreatedScene,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!v)return z.c.Error("No scene available to append to"),null;const F=n(e,d);if(!F)return null;const w={};v.addPendingData(w);const G=()=>{v.removePendingData(w)};W.d.ShowLoadingScreen&&!D&&(D=!0,v.getEngine().displayLoadingUI(),v.executeWhenReady((()=>{v.getEngine().hideLoadingUI(),D=!1})));const U=(e,d)=>{const P=h(F,e,d);L?L(v,P,new k.i(P,k.h.SceneLoaderError,d)):z.c.Error(P),G()},C=p?e=>{try{p(e)}catch(d){U("Error in onProgress callback",d)}}:void 0,q=()=>{if(P)try{P(v)}catch(e){U("Error in onSuccess callback",e)}v.removePendingData(w)};return await l(F,v,((e,d)=>{if(e.load){if(!e.load(v,d,F.rootUrl,U))return;v.loadingPluginName=e.name,q()}else{e.loadAsync(v,d,F.rootUrl,C,F.name).then((()=>{v.loadingPluginName=e.name,q()})).catch((e=>{U(e.message,e)}))}}),C,U,G,B,V,g)}async function f(e,d,v,P,p,L,B){return await new Promise(((X,z)=>{try{Z(e,d,v,(e=>{X(e)}),P,((e,d,v)=>{z(v||new Error(d))}),p,L,B).catch(z)}catch(k){z(k)}}))}async function T(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.c.LastCreatedScene,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!v)return z.c.Error("No scene available to load asset container to"),null;const g=n(e,d);if(!g)return null;const F={};v.addPendingData(F);const w=()=>{v.removePendingData(F)},G=(e,d)=>{const P=h(g,e,d);L?L(v,P,new k.i(P,k.h.SceneLoaderError,d)):z.c.Error(P),w()},U=p?e=>{try{p(e)}catch(d){G("Error in onProgress callback",d)}}:void 0,D=e=>{if(P)try{P(e)}catch(d){G("Error in onSuccess callback",d)}v.removePendingData(F)};return await l(g,v,((e,d)=>{if(e.loadAssetContainer){const P=e.loadAssetContainer(v,d,g.rootUrl,G);if(!P)return;P.populateRootNodes(),v.loadingPluginName=e.name,D(P)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(v,d,g.rootUrl,U,g.name).then((d=>{d.populateRootNodes(),v.loadingPluginName=e.name,D(d)})).catch((e=>{G(e.message,e)}))}else G("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),U,G,w,B,W,V)}async function S(e,d,v,P,p,L,B){return await new Promise(((X,z)=>{try{T(e,d,v,(e=>{X(e)}),P,((e,d,v)=>{z(v||new Error(d))}),p,L,B).catch(z)}catch(k){z(k)}}))}async function o(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.c.LastCreatedScene,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!v)return void z.c.Error("No scene available to load animations to");if(P){for(const P of v.animatables)P.reset();v.stopAllAnimations();const e=v.animationGroups.slice();for(const v of e)v.dispose();const d=v.getNodes();for(const v of d)v.animations&&(v.animations=[])}else switch(p){case 0:const e=v.animationGroups.slice();for(const d of e)d.dispose();break;case 1:for(const d of v.animationGroups)d.stop();break;case 2:for(const d of v.animationGroups)d.reset(),d.restart();break;case 3:break;default:return void z.c.Error("Unknown animation group loading mode value '"+p+"'")}const w=v.animatables.length;await T(e,d,v,(e=>{e.mergeAnimationsTo(v,v.animatables.slice(w),L),e.dispose(),v.onAnimationFileImportedObservable.notifyObservers(v),B&&B(v)}),W,V,k,g,F)}async function K(e,d,v,P,p,L,B,X,z,W){return await new Promise(((V,g)=>{try{o(e,d,v,P,p,L,(e=>{V(e)}),B,((e,d,v)=>{g(v||new Error(d))}),X,z,W).catch(g)}catch(k){g(k)}}))}class Q{static get ForceFullSceneLoadingForIncremental(){return W.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){W.d.ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return W.d.ShowLoadingScreen}static set ShowLoadingScreen(e){W.d.ShowLoadingScreen=e}static get loggingLevel(){return W.d.loggingLevel}static set loggingLevel(e){W.d.loggingLevel=e}static get CleanBoneMatrixWeights(){return W.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){W.d.CleanBoneMatrixWeights=e}static GetDefaultPlugin(){return C()}static GetPluginForExtension(e){var d;return null===(d=q(e,!0))||void 0===d?void 0:d.plugin}static IsPluginForExtensionAvailable(e){return function(e){return!!U[e]}(e)}static RegisterPlugin(e){A(e)}static ImportMesh(e,d,v,P,p,L,B,z,W){x(e,d,v,P,p,L,B,z,W).catch((e=>null===B||void 0===B?void 0:B(X.c.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async ImportMeshAsync(e,d,v,P,p,L,B){return await i(e,d,v,P,p,L,B)}static Load(e,d,v,P,p,L,B,z){me(e,d,v,P,p,L,B,z).catch((e=>null===L||void 0===L?void 0:L(X.c.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async LoadAsync(e,d,v,P,p,L){return await r(e,d,v,P,p,L)}static Append(e,d,v,P,p,L,B,z){Z(e,d,v,P,p,L,B,z).catch((e=>null===L||void 0===L?void 0:L(v??X.c.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async AppendAsync(e,d,v,P,p,L){return await f(e,d,v,P,p,L)}static LoadAssetContainer(e,d,v,P,p,L,B,z){T(e,d,v,P,p,L,B,z).catch((e=>null===L||void 0===L?void 0:L(v??X.c.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async LoadAssetContainerAsync(e,d,v,P,p,L){return await S(e,d,v,P,p,L)}static ImportAnimations(e,d,v,P,p,L,B,z,W,V,k){o(e,d,v,P,p,L,B,z,W,V,k).catch((e=>null===W||void 0===W?void 0:W(v??X.c.LastCreatedScene,null===e||void 0===e?void 0:e.message,e)))}static async ImportAnimationsAsync(e,d,v,P,p,L,B,X,z,W,V){return await K(e,d,v,P,p,L,X,W,V)}}Q.NO_LOGGING=0,Q.MINIMAL_LOGGING=1,Q.SUMMARY_LOGGING=2,Q.DETAILED_LOGGING=3,Q.OnPluginActivatedObservable=G},14144:(e,d,v)=>{"use strict";v.d(d,{c:()=>g});var P=v(12403),p=v(12409),L=v(12240),B=v(12420),X=v(12446),z=v(12399),W=v(12381),V=v(12248),k=v(12453);v(14153);class g extends X.d{set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const d=this.Ae();d&&d.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(e){this._rotationY=e,this.setReflectionTextureMatrix(B.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(e,d,v){let P="";for(const p of e)P+=p;return new g(P,d,null,v,e)}static CreateFromPrefilteredData(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=d.useDelayedTextureLoading;d.useDelayedTextureLoading=!1;const L=new g(e,d,null,!1,null,null,null,void 0,!0,v,P);return d.useDelayedTextureLoading=p,L}constructor(e,d){var v;let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,w=arguments.length>10&&void 0!==arguments[10]&&arguments[10],G=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,U=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,D=arguments.length>13?arguments[13]:void 0,C=arguments.length>14?arguments[14]:void 0;super(d),this.onLoadObservable=new V.d,this.boundingBoxPosition=B.mv.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new B.Matrix,this._buffer=null,this.name=e,this.url=e,this._noMipmap=p,this.Hd=!1,this.isCube=!0,this._textureMatrix=B.Matrix.Identity(),this.coordinatesMode=z.e.CUBIC_MODE;let q=null,h=null;null===P||Array.isArray(P)?(this._noMipmap=p,this._format=k,this._createPolynomials=w,q=P,this._loaderOptions=D,this._useSRGBBuffer=C,this._lodScale=G,this._lodOffset=U):(q=P.extensions??null,this._noMipmap=P.noMipmap??!1,L=P.files??null,h=P.buffer??null,this._format=P.format??5,g=P.prefiltered??!1,F=P.forcedExtension??null,this._createPolynomials=P.createPolynomials??!1,this._lodScale=P.lodScale??.8,this._lodOffset=P.lodOffset??0,this._loaderOptions=P.loaderOptions,this._useSRGBBuffer=P.useSRGBBuffer,X=P.I??null,W=P.onError??null),(e||L)&&this.updateURL(e,F,X,g,W,q,null===(v=this.Ae())||void 0===v?void 0:v.useDelayedTextureLoading,L,h)}getClassName(){return"CubeTexture"}updateURL(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,d&&(this._forcedExtension=d);const W=e.lastIndexOf("."),V=d||(W>-1?e.substring(W).toLowerCase():""),k=0===V.indexOf(".dds"),g=0===V.indexOf(".env"),F=0===V.indexOf(".basis");if(g?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=P,P&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),X)this._files=X;else if(F||g||k||L||(L=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,L){for(let d=0;d<L.length;d++)this._files.push(e+L[d]);this._extensions=L}this._buffer=z,B?(this.delayLoadState=4,this._delayedOnLoad=v,this._delayedOnError=p):this._loadTexture(v,p)}delayLoad(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(e){var d,v;if(e.updateFlag===this._textureMatrix.updateFlag)return;e.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(v=this.Ae())||void 0===v||v.markAllMaterialsAsDirty(1,(e=>-1!==e.getActiveTextures().indexOf(this))));if(this._textureMatrix=e,null===(d=this.Ae())||void 0===d||!d.useRightHandedSystem)return;const P=B.TmpVectors.mv[0],p=B.TmpVectors.Quaternion[0],L=B.TmpVectors.mv[1];this._textureMatrix.decompose(P,p,L),p.z*=-1,p.w*=-1,B.Matrix.ComposeToRef(P,p,L,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var e;return null!==(e=this.Ae())&&void 0!==e&&e.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=this.Ae(),P=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const p=()=>{var d;(this.onLoadObservable.notifyObservers(this),P)&&(P.dispose(),null===(d=this.Ae())||void 0===d||d.markAllMaterialsAsDirty(1));e&&e()},B=(e,v)=>{this._loadingError=!0,this._errorObject={message:e,exception:v},d&&d(e,v),z.e.OnTextureLoadErrorObservable.notifyObservers(this)};var X;this._texture?this._texture.isReady?L.Tools.SetImmediate((()=>p())):this._texture.onLoadedObservable.add((()=>p())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,v,this._lodScale,this._lodOffset,e,B,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,v,this._files,this._noMipmap,e,B,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(X=this._texture)||void 0===X||X.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(e,d,v){const P=k.c.Parse((()=>{let P=!1;return e.prefiltered&&(P=e.prefiltered),new g(v+(e.url??e.name),d,e.extensions,!1,e.files||null,null,null,void 0,P,e.forcedExtension)}),e,d);if(e.boundingBoxPosition&&(P.boundingBoxPosition=B.mv.Nd(e.boundingBoxPosition)),e.boundingBoxSize&&(P.boundingBoxSize=B.mv.Nd(e.boundingBoxSize)),e.animations)for(let p=0;p<e.animations.length;p++){const d=e.animations[p],v=(0,W.e)("BABYLON.Animation");v&&P.animations.push(v.Parse(d))}return P}clone(){let e=0;const d=k.c.Clone((()=>{const d=new g(this.url,this.Ae()||this._getEngine(),this._extensions,this._noMipmap,this._files);return e=d.uniqueId,d}),this);return d.uniqueId=e,d}}(0,P.e)([(0,p.M)()],g.prototype,"url",void 0),(0,P.e)([(0,p.J)()],g.prototype,"boundingBoxPosition",void 0),(0,P.e)([(0,p.J)()],g.prototype,"boundingBoxSize",null),(0,P.e)([(0,p.M)("rotationY")],g.prototype,"rotationY",null),(0,P.e)([(0,p.M)("files")],g.prototype,"_files",void 0),(0,P.e)([(0,p.M)("forcedExtension")],g.prototype,"_forcedExtension",void 0),(0,P.e)([(0,p.M)("extensions")],g.prototype,"_extensions",void 0),(0,P.e)([(0,p.u)("textureMatrix")],g.prototype,"_textureMatrix",void 0),(0,P.e)([(0,p.u)("textureMatrixRefraction")],g.prototype,"_textureMatrixRefraction",void 0),z.e._CubeTextureParser=g.Parse,(0,W.h)("BABYLON.CubeTexture",g)},14622:(e,d,v)=>{"use strict";v.d(d,{d:()=>z});var P=v(12253),p=v(12399),L=v(12388),B=v(12553),X=v(12357);B.ThinEngine.prototype.createDynamicTexture=function(e,d,v,P){const p=new X.b(this,4);return p.baseWidth=e,p.baseHeight=d,v&&(e=this.needPOTTextures?(0,L.f)(e,this._caps.maxTextureSize):e,d=this.needPOTTextures?(0,L.f)(d,this._caps.maxTextureSize):d),p.width=e,p.height=d,p.isReady=!1,p.generateMipMaps=v,p.samplingMode=P,this.updateTextureSamplingMode(P,p),this._internalTexturesCache.push(p),p},B.ThinEngine.prototype.updateDynamicTexture=function(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!e)return;const B=this._gl,X=B.TEXTURE_2D,z=this._bindTextureDirectly(X,e,!0,L);this._unpackFlipY(void 0===v?e.invertY:v),P&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const W=this._getWebGLTextureType(e.type),V=this._getInternalFormat(p||e.format),k=this._getRGBABufferInternalSizedFormat(e.type,V);B.texImage2D(X,0,k,V,W,d),e.generateMipMaps&&B.generateMipmap(X),z||this._bindTextureDirectly(X,null),P&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),p&&(e.format=p),e._dynamicTextureSource=d,e._premulAlpha=P,e.invertY=v||!1,e.isReady=!0};class z extends p.e{constructor(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,X=arguments.length>6?arguments[6]:void 0;const z=!v||v._isScene;super(null,z?v:null===v||void 0===v?void 0:v.fd,z?!P:v,X,L,void 0,void 0,void 0,void 0,B),this.name=e,this.wrapU=p.e.CLAMP_ADDRESSMODE,this.wrapV=p.e.CLAMP_ADDRESSMODE,this._generateMipMaps=P;const W=this._getEngine();if(!W)return;if(d.getContext)this._canvas=d,this._ownCanvas=!1,this._texture=W.createDynamicTexture(this._canvas.width,this._canvas.height,P,L);else{this._canvas=W.createCanvas(1,1),this._ownCanvas=!0;const e=d;e.width||0===e.width?this._texture=W.createDynamicTexture(e.width,e.height,P,L):this._texture=W.createDynamicTexture(d,d,P,L)}const V=this.getSize();this._canvas.width!==V.width&&(this._canvas.width=V.width),this._canvas.height!==V.height&&(this._canvas.height=V.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)}scale(e){const d=this.getSize();d.width*=e,d.height*=e,this._recreate(d)}scaleTo(e,d){const v=this.getSize();v.width=e,v.height=d,this._recreate(v)}getContext(){return this._context}clear(e){const d=this.getSize();e&&(this._context.fillStyle=e),this._context.clearRect(0,0,d.width,d.height)}update(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e||e,d,this._format||void 0,void 0,v)}drawText(e,d,v,P,p,L,B){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const z=this.getSize();if(L&&(this._context.fillStyle=L,this._context.fillRect(0,0,z.width,z.height)),this._context.font=P,null===d||void 0===d){const v=this._context.measureText(e);d=(z.width-v.width)/2}if(null===v||void 0===v){const e=parseInt(P.replace(/\D/g,""));v=z.height/2+e/3.65}this._context.fillStyle=p||"",this._context.fillText(e,d,v),X&&this.update(B)}dispose(){var e,d;(super.dispose(),this._ownCanvas)&&(null===(e=this._canvas)||void 0===e||null===(d=e.remove)||void 0===d||d.call(e));this._canvas=null,this._context=null}clone(){const e=this.Ae();if(!e)return this;const d=this.getSize(),v=new z(this.name,d,e,this._generateMipMaps);return v.Hd=this.Hd,v.level=this.level,v.wrapU=this.wrapU,v.wrapV=this.wrapV,v}serialize(){const e=this.Ae();e&&!e.isReady()&&P.c.Warn("The scene must be ready before serializing the dynamic texture");const d=super.serialize();return z._IsCanvasElement(this._canvas)&&(d.base64String=this._canvas.toDataURL()),d.invertY=this._invertY,d.samplingMode=this.samplingMode,d}static _IsCanvasElement(e){return void 0!==e.toDataURL}_rebuild(){this.update()}}},14065:(e,d,v)=>{"use strict";v.d(d,{c:()=>p});var P=v(12399);class p extends P.e{get depth(){return this._depth}constructor(e,d,v,p,L,B){let X=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:P.e.TRILINEAR_SAMPLINGMODE,V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,k=arguments.length>10?arguments[10]:void 0;super(null,B,!X,z),this.format=L,this._texture=B.getEngine().createRawTexture2DArray(e,d,v,p,L,X,z,W,null,V,k),this._depth=p,this.is2DArray=!0}update(e){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(e,d,v,P,L){return new p(e,d,v,P,5,L,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13870:(e,d,v)=>{"use strict";v.d(d,{d:()=>X,f:()=>z,i:()=>L,k:()=>B});var P=v(12440),p=v(12420);function L(e,d){return`{X: ${e.x.toFixed(d)} Y: ${e.y.toFixed(d)}}`}function B(e,d){return`{X: ${e._x.toFixed(d)} Y: ${e._y.toFixed(d)} Z: ${e._z.toFixed(d)}}`}function X(e,d){return 2*Math.acos((0,P.Clamp)(p.Quaternion.Dot(e,d)))}function z(e,d){const v=new p.Quaternion;return function(e,d,v){const L=p.mv.Cross(e,d),B=Math.acos((0,P.Clamp)(p.mv.Dot(e,d),-1,1));p.Quaternion.RotationAxisToRef(L,B,v)}(e,d,v),v}},13690:(e,d,v)=>{"use strict";v.d(d,{b:()=>W});var P=v(12420),p=v(12463),L=v(12864),B=v(12847),X=v(12469);v(13693);function z(e){let d=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const v=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],L=[];let z=[];const W=e.width||e.size||1,V=e.height||e.size||1,k=e.depth||e.size||1,g=e.wrap||!1;let F=void 0===e.topBaseAt?1:e.topBaseAt,w=void 0===e.bottomBaseAt?0:e.bottomBaseAt;F=(F+4)%4,w=(w+4)%4;let G=[2,0,3,1][F],U=[2,0,1,3][w],D=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(g){d=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],D=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let e=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],v=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const P=[17,18,19,16],p=[22,23,20,21];for(;G>0;)e.unshift(e.pop()),P.unshift(P.pop()),G--;for(;U>0;)v.unshift(v.pop()),p.unshift(p.pop()),U--;e=e.flat(),v=v.flat(),D=D.concat(e).concat(v),d.push(P[0],P[2],P[3],P[0],P[1],P[2]),d.push(p[0],p[2],p[3],p[0],p[1],p[2])}const C=[W/2,V/2,k/2];z=D.reduce(((e,d,v)=>e.concat(d*C[v%3])),[]);const q=0===e.sideOrientation?0:e.sideOrientation||B.d.DEFAULTSIDE,h=e.faceUV||new Array(6),l=e.faceColors,n=[];for(let B=0;B<6;B++)void 0===h[B]&&(h[B]=new P.Vector4(0,0,1,1)),l&&void 0===l[B]&&(l[B]=new p.Up(1,1,1,1));for(let P=0;P<6;P++)if(L.push(h[P].z,X.c?1-h[P].w:h[P].w),L.push(h[P].x,X.c?1-h[P].w:h[P].w),L.push(h[P].x,X.c?1-h[P].y:h[P].y),L.push(h[P].z,X.c?1-h[P].y:h[P].y),l)for(let e=0;e<4;e++)n.push(l[P].r,l[P].g,l[P].b,l[P].a);B.d._ComputeSides(q,z,d,v,L,e.frontUVs,e.backUVs);const A=new B.d;if(A.indices=d,A.ie=z,A.md=v,A.Ze=L,l){const e=q===B.d.DOUBLESIDE?n.concat(n):n;A.re=e}return A}function W(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new L.b(e,v);d.sideOrientation=L.b._GetDefaultSideOrientation(d.sideOrientation),P._originalBuilderSideOrientation=d.sideOrientation;return z(d).Te(P,d.updatable),P}B.d.CreateBox=z,L.b.CreateBox=function(e,d){return W(e,{size:d,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13864:(e,d,v)=>{"use strict";v.d(d,{d:()=>X});var P=v(12864),p=v(12847),L=v(12469);function B(e){const d=[],v=[],P=[],B=[],X=e.radius||.5,z=e.tessellation||64,W=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,V=0===e.sideOrientation?0:e.sideOrientation||p.d.DEFAULTSIDE;d.push(0,0,0),B.push(.5,.5);const k=2*Math.PI*W,g=1===W?k/z:k/(z-1);let F=0;for(let p=0;p<z;p++){const e=Math.cos(F),v=Math.sin(F),P=(e+1)/2,p=(1-v)/2;d.push(X*e,X*v,0),B.push(P,L.c?1-p:p),F+=g}1===W&&(d.push(d[3],d[4],d[5]),B.push(B[2],L.c?1-B[3]:B[3]));const w=d.length/3;for(let p=1;p<w-1;p++)v.push(p+1,0,p);p.d.ComputeNormals(d,v,P),p.d._ComputeSides(V,d,v,P,B,e.frontUVs,e.backUVs);const G=new p.d;return G.indices=v,G.ie=d,G.md=P,G.Ze=B,G}function X(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new P.b(e,v);d.sideOrientation=P.b._GetDefaultSideOrientation(d.sideOrientation),p._originalBuilderSideOrientation=d.sideOrientation;return B(d).Te(p,d.updatable),p}p.d.CreateDisc=B,P.b.CreateDisc=function(e,d,v){return X(e,{radius:d,tessellation:v,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13693:(e,d,v)=>{"use strict";v.d(d,{e:()=>U,c:()=>C,h:()=>D});var P=v(12420),p=v(12463),L=v(12864),B=v(12847),X=v(12490);L.b._GroundMeshParser=(e,d)=>z.Parse(e,d);class z extends L.b{constructor(e,d){super(e,d),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);const v=this;v.createOrUpdateSubmeshesOctree&&v.createOrUpdateSubmeshesOctree(d)}getHeightAtCoordinates(e,d){const v=this.getWorldMatrix(),p=P.TmpVectors.Matrix[5];v.invertToRef(p);const L=P.TmpVectors.mv[8];if(P.mv.TransformCoordinatesFromFloatsToRef(e,0,d,p,L),e=L.x,d=L.z,e<this._minX||e>=this._maxX||d<=this._minZ||d>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const B=this._getFacetAt(e,d),X=-(B.x*e+B.z*d+B.w)/B.y;return P.mv.TransformCoordinatesFromFloatsToRef(0,X,0,v,L),L.y}getNormalAtCoordinates(e,d){const v=new P.mv(0,1,0);return this.getNormalAtCoordinatesToRef(e,d,v),v}getNormalAtCoordinatesToRef(e,d,v){const p=this.getWorldMatrix(),L=P.TmpVectors.Matrix[5];p.invertToRef(L);const B=P.TmpVectors.mv[8];if(P.mv.TransformCoordinatesFromFloatsToRef(e,0,d,L,B),e=B.x,d=B.z,e<this._minX||e>this._maxX||d<this._minZ||d>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const X=this._getFacetAt(e,d);return P.mv.TransformNormalFromFloatsToRef(X.x,X.y,X.z,p,v),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(e,d){const v=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),P=Math.floor(-(d+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),p=this._heightQuads[P*this._subdivisionsX+v];let L;return L=d<p.slope.x*e+p.slope.y?p.facet1:p.facet2,L}_initHeightQuads(){const e=this._subdivisionsX,d=this._subdivisionsY;this._heightQuads=[];for(let v=0;v<d;v++)for(let d=0;d<e;d++){const p={slope:P.Vector2.Zero(),facet1:new P.Vector4(0,0,0,0),facet2:new P.Vector4(0,0,0,0)};this._heightQuads[v*e+d]=p}return this}_computeHeightQuads(){const e=this.getVerticesData(X.i.PositionKind);if(!e)return this;const d=P.TmpVectors.mv[3],v=P.TmpVectors.mv[2],p=P.TmpVectors.mv[1],L=P.TmpVectors.mv[0],B=P.TmpVectors.mv[4],z=P.TmpVectors.mv[5],W=P.TmpVectors.mv[6],V=P.TmpVectors.mv[7],k=P.TmpVectors.mv[8];let g=0,F=0,w=0,G=0,U=0,D=0,C=0;const q=this._subdivisionsX,h=this._subdivisionsY;for(let X=0;X<h;X++)for(let h=0;h<q;h++){g=3*h,F=X*(q+1)*3,w=(X+1)*(q+1)*3,d.x=e[F+g],d.y=e[F+g+1],d.z=e[F+g+2],v.x=e[F+g+3],v.y=e[F+g+4],v.z=e[F+g+5],p.x=e[w+g],p.y=e[w+g+1],p.z=e[w+g+2],L.x=e[w+g+3],L.y=e[w+g+4],L.z=e[w+g+5],G=(L.z-d.z)/(L.x-d.x),U=d.z-G*d.x,v.subtractToRef(d,B),p.subtractToRef(d,z),L.subtractToRef(d,W),P.mv.CrossToRef(W,z,V),P.mv.CrossToRef(B,W,k),V.normalize(),k.normalize(),D=-(V.x*d.x+V.y*d.y+V.z*d.z),C=-(k.x*v.x+k.y*v.y+k.z*v.z);const l=this._heightQuads[X*q+h];l.slope.Ed(G,U),l.facet1.Ed(V.x,V.y,V.z,D),l.facet2.Ed(k.x,k.y,k.z,C)}return this}serialize(e){super.serialize(e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.td=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height}static Parse(e,d){const v=new z(e.name,d);return v._subdivisionsX=e.subdivisionsX||1,v._subdivisionsY=e.subdivisionsY||1,v._minX=e.minX,v._maxX=e.maxX,v._minZ=e.td,v._maxZ=e.maxZ,v._width=e.width,v._height=e.height,v}}var W=v(12240),V=v(12281),k=v(12429),g=v(12469);function F(e){const d=[],v=[],p=[],L=[];let X,z;const W=e.width||e.size||1,V=e.height||e.size||1,k=0|(e.subdivisionsX||e.subdivisions||1),F=0|(e.subdivisionsY||e.subdivisions||1);for(X=0;X<=F;X++)for(z=0;z<=k;z++){const e=new P.mv(z*W/k-W/2,0,(F-X)*V/F-V/2),d=new P.mv(0,1,0);v.push(e.x,e.y,e.z),p.push(d.x,d.y,d.z),L.push(z/k,g.c?X/F:1-X/F)}for(X=0;X<F;X++)for(z=0;z<k;z++)d.push(z+1+(X+1)*(k+1)),d.push(z+1+X*(k+1)),d.push(z+X*(k+1)),d.push(z+(X+1)*(k+1)),d.push(z+1+(X+1)*(k+1)),d.push(z+X*(k+1));const w=new B.d;return w.indices=d,w.ie=v,w.md=p,w.Ze=L,w}function w(e){const d=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,v=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,p=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,L=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,X=e.subdivisions||{w:1,h:1},z=e.precision||{w:1,h:1},W=[],V=[],k=[],g=[];let F,w,G,U;X.h=X.h<1?1:X.h,X.w=X.w<1?1:X.w,z.w=z.w<1?1:z.w,z.h=z.h<1?1:z.h;const D=(p-d)/X.w,C=(L-v)/X.h;function q(e,d,v,p){const L=V.length/3,B=z.w+1;for(F=0;F<z.h;F++)for(w=0;w<z.w;w++){const e=[L+w+F*B,L+(w+1)+F*B,L+(w+1)+(F+1)*B,L+w+(F+1)*B];W.push(e[1]),W.push(e[2]),W.push(e[3]),W.push(e[0]),W.push(e[1]),W.push(e[3])}const X=P.mv.Zero(),G=new P.mv(0,1,0);for(F=0;F<=z.h;F++)for(X.z=F*(p-d)/z.h+d,w=0;w<=z.w;w++)X.x=w*(v-e)/z.w+e,X.y=0,V.push(X.x,X.y,X.z),k.push(G.x,G.y,G.z),g.push(w/z.w,F/z.h)}for(G=0;G<X.h;G++)for(U=0;U<X.w;U++)q(d+U*D,v+G*C,d+(U+1)*D,v+(G+1)*C);const h=new B.d;return h.indices=W,h.ie=V,h.md=k,h.Ze=g,h}function G(e){const d=[],v=[],L=[],X=[];let z,W;const V=e.colorFilter||new p.Kd(.3,.59,.11),g=e.alphaFilter||0;let F=!1;if(e.minHeight>e.maxHeight){F=!0;const d=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=d}for(z=0;z<=e.subdivisions;z++)for(W=0;W<=e.subdivisions;W++){const d=new P.mv(W*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-z)*e.height/e.subdivisions-e.height/2),p=4*(((d.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(d.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth);let B=e.buffer[p]/255,w=e.buffer[p+1]/255,G=e.buffer[p+2]/255;const U=e.buffer[p+3]/255;F&&(B=1-B,w=1-w,G=1-G);const D=B*V.r+w*V.g+G*V.b;d.y=U>=g?e.minHeight+(e.maxHeight-e.minHeight)*D:e.minHeight-k.e,e.heightBuffer&&(e.heightBuffer[z*(e.subdivisions+1)+W]=d.y),v.push(d.x,d.y,d.z),L.push(0,0,0),X.push(W/e.subdivisions,1-z/e.subdivisions)}for(z=0;z<e.subdivisions;z++)for(W=0;W<e.subdivisions;W++){const P=W+1+(z+1)*(e.subdivisions+1),p=W+1+z*(e.subdivisions+1),L=W+z*(e.subdivisions+1),B=W+(z+1)*(e.subdivisions+1),X=v[3*P+1]>=e.minHeight,V=v[3*p+1]>=e.minHeight,k=v[3*L+1]>=e.minHeight;X&&V&&k&&(d.push(P),d.push(p),d.push(L));v[3*B+1]>=e.minHeight&&X&&k&&(d.push(B),d.push(P),d.push(L))}B.d.ComputeNormals(v,d,L);const w=new B.d;return w.indices=d,w.ie=v,w.md=L,w.Ze=X,w}function U(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const v=new z(e,arguments.length>2?arguments[2]:void 0);v._setReady(!1),v._subdivisionsX=d.subdivisionsX||d.subdivisions||1,v._subdivisionsY=d.subdivisionsY||d.subdivisions||1,v._width=d.width||1,v._height=d.height||1,v._maxX=v._width/2,v._maxZ=v._height/2,v._minX=-v._maxX,v._minZ=-v._maxZ;return F(d).Te(v,d.updatable),v._setReady(!0),v}function D(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new L.b(e,v);return w(d).Te(P,d.updatable),P}function C(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const L=v.width||10,B=v.height||10,X=v.subdivisions||1,k=v.minHeight||0,g=v.maxHeight||1,F=v.colorFilter||new p.Kd(.3,.59,.11),w=v.alphaFilter||0,U=v.updatable,D=v.onReady;P=P||V.c.LastCreatedScene;const C=new z(e,P);let q;C._subdivisionsX=X,C._subdivisionsY=X,C._width=L,C._height=B,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ,C._setReady(!1),v.passHeightBufferInCallback&&(q=new Float32Array((X+1)*(X+1)));const h=(e,d,v)=>{G({width:L,height:B,subdivisions:X,minHeight:k,maxHeight:g,colorFilter:F,buffer:e,bufferWidth:d,bufferHeight:v,alphaFilter:w,heightBuffer:q}).Te(C,U),D&&D(C,q),C._setReady(!0)};if("string"===typeof d){const e=e=>{var d;const v=e.width,p=e.height;if(P.W)return;const L=null===(d=P)||void 0===d?void 0:d.getEngine().resizeImageBitmap(e,v,p);h(L,v,p)};W.Tools.LoadImage(d,e,v.onError?v.onError:()=>{},P.offlineProvider)}else h(d.data,d.width,d.height);return C}B.d.CreateGround=F,B.d.CreateTiledGround=w,B.d.CreateGroundFromHeightMap=G,L.b.CreateGround=(e,d,v,P,p,L)=>U(e,{width:d,height:v,subdivisions:P,updatable:L},p),L.b.CreateTiledGround=(e,d,v,P,p,L,B,X,z)=>D(e,{xmin:d,zmin:v,xmax:P,zmax:p,subdivisions:L,precision:B,updatable:z},X),L.b.CreateGroundFromHeightMap=(e,d,v,P,p,L,B,X,z,W,V)=>C(e,d,{width:v,height:P,subdivisions:p,minHeight:L,maxHeight:B,updatable:z,onReady:W,alphaFilter:V},X)},14353:(e,d,v)=>{"use strict";v.d(d,{d:()=>F,f:()=>k,g:()=>g});var P=v(12420),p=v(12864),L=v(12847),B=v(12964),X=v(12490),z=v(12253);function W(e){const d=[],v=[],P=e.lines,p=e.re,B=[];let X=0;for(let L=0;L<P.length;L++){const e=P[L];for(let P=0;P<e.length;P++){const{x:z,y:W,z:V}=e[P];if(v.push(z,W,V),p){const e=p[L],{r:d,g:v,b:X,a:z}=e[P];B.push(d,v,X,z)}P>0&&(d.push(X-1),d.push(X)),X++}}const z=new L.d;return z.indices=d,z.ie=v,p&&(z.re=B),z}function V(e){const d=e.dashSize||3,v=e.gapSize||1,p=e.dashNb||200,B=e.points,X=[],z=[],W=P.mv.Zero();let V=0,k=0,g=0,F=0,w=0,G=0,U=0;for(U=0;U<B.length-1;U++)B[U+1].subtractToRef(B[U],W),V+=W.length();for(g=V/p,F=d*g/(d+v),U=0;U<B.length-1;U++){B[U+1].subtractToRef(B[U],W),k=Math.floor(W.length()/g),W.normalize();for(let e=0;e<k;e++)w=g*e,X.push(B[U].x+w*W.x,B[U].y+w*W.y,B[U].z+w*W.z),X.push(B[U].x+(w+F)*W.x,B[U].y+(w+F)*W.y,B[U].z+(w+F)*W.z),z.push(G,G+1),G+=2}const D=new L.d;return D.ie=X,D.indices=z,D}function k(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=d.instance,p=d.lines,L=d.re;if(P){const e=P.getVerticesData(X.i.PositionKind);let d,v;L&&(d=P.getVerticesData(X.i.ColorKind));let B=0,z=0;for(let P=0;P<p.length;P++){const X=p[P];for(let p=0;p<X.length;p++)e[B]=X[p].x,e[B+1]=X[p].y,e[B+2]=X[p].z,L&&d&&(v=L[P],d[z]=v[p].r,d[z+1]=v[p].g,d[z+2]=v[p].b,d[z+3]=v[p].a,z+=4),B+=3}return P.updateVerticesData(X.i.PositionKind,e,!1,!1),L&&d&&P.updateVerticesData(X.i.ColorKind,d,!1,!1),P.refreshBoundingInfo(),P}const z=!!L,V=new B.c(e,v,null,void 0,void 0,z,d.useVertexAlpha,d.material);return W(d).Te(V,d.updatable),V}function g(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=d.re?[d.re]:null;return k(e,{lines:[d.points],updatable:d.updatable,instance:d.instance,re:P,useVertexAlpha:d.useVertexAlpha,material:d.material},v)}function F(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=d.points,X=d.instance,W=d.gapSize||1,k=d.dashSize||3;if(X){const e=e=>{const d=P.mv.Zero(),v=e.length/6;let p=0,B=0,z=0,W=0,V=0,k=0,g=0,F=0;for(g=0;g<L.length-1;g++)L[g+1].subtractToRef(L[g],d),p+=d.length();z=p/v;const w=X._creationDataStorage.dashSize;for(W=w*z/(w+X._creationDataStorage.gapSize),g=0;g<L.length-1;g++)for(L[g+1].subtractToRef(L[g],d),B=Math.floor(d.length()/z),d.normalize(),F=0;F<B&&k<e.length;)V=z*F,e[k]=L[g].x+V*d.x,e[k+1]=L[g].y+V*d.y,e[k+2]=L[g].z+V*d.z,e[k+3]=L[g].x+(V+W)*d.x,e[k+4]=L[g].y+(V+W)*d.y,e[k+5]=L[g].z+(V+W)*d.z,k+=6,F++;for(;k<e.length;)e[k]=L[g].x,e[k+1]=L[g].y,e[k+2]=L[g].z,k+=3};return(d.dashNb||d.dashSize||d.gapSize||d.useVertexAlpha||d.material)&&z.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),X.updateMeshPositions(e,!1),X}const g=new B.c(e,v,null,void 0,void 0,void 0,d.useVertexAlpha,d.material);return V(d).Te(g,d.updatable),g._creationDataStorage=new p.c,g._creationDataStorage.dashSize=k,g._creationDataStorage.gapSize=W,g}L.d.CreateLineSystem=W,L.d.CreateDashedLines=V,p.b.GW=function(e,d){return g(e,{points:d,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},p.b.CreateDashedLines=function(e,d,v,P,p){return F(e,{points:d,dashSize:v,gapSize:P,dashNb:p,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13746:(e,d,v)=>{"use strict";v.d(d,{d:()=>X,e:()=>z});var P=v(12864),p=v(12847),L=v(12469);function B(e){const d=[],v=[],P=[],B=[],X=void 0!==e.width?e.width:void 0!==e.size?e.size:1,z=void 0!==e.height?e.height:void 0!==e.size?e.size:1,W=0===e.sideOrientation?0:e.sideOrientation||p.d.DEFAULTSIDE,V=X/2,k=z/2;v.push(-V,-k,0),P.push(0,0,-1),B.push(0,L.c?1:0),v.push(V,-k,0),P.push(0,0,-1),B.push(1,L.c?1:0),v.push(V,k,0),P.push(0,0,-1),B.push(1,L.c?0:1),v.push(-V,k,0),P.push(0,0,-1),B.push(0,L.c?0:1),d.push(0),d.push(1),d.push(2),d.push(0),d.push(2),d.push(3),p.d._ComputeSides(W,v,d,P,B,e.frontUVs,e.backUVs);const g=new p.d;return g.indices=d,g.ie=v,g.md=P,g.Ze=B,g}function X(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new P.b(e,v);d.sideOrientation=P.b._GetDefaultSideOrientation(d.sideOrientation),p._originalBuilderSideOrientation=d.sideOrientation;return B(d).Te(p,d.updatable),d.sourcePlane&&(p.translate(d.sourcePlane.normal,-d.sourcePlane.d),p.setDirection(d.sourcePlane.normal.scale(-1))),p}const z={qW:X};p.d.qW=B,P.b.qW=(e,d,v,P,p)=>X(e,{size:d,width:d,height:d,sideOrientation:p,updatable:P},v)},13849:(e,d,v)=>{"use strict";v.d(d,{b:()=>z});var P=v(12420),p=v(12864),L=v(12847),B=v(12469);function X(e){const d=0|(e.segments||32),v=e.diameterX||e.diameter||1,p=e.diameterY||e.diameter||1,X=e.diameterZ||e.diameter||1,z=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,W=e.slice&&e.slice<=0?1:e.slice||1,V=0===e.sideOrientation?0:e.sideOrientation||L.d.DEFAULTSIDE,k=!!e.dedupTopBottomIndices,g=new P.mv(v/2,p/2,X/2),F=2+d,w=2*F,G=[],U=[],D=[],C=[];for(let L=0;L<=F;L++){const e=L/F,d=e*Math.PI*W;for(let v=0;v<=w;v++){const p=v/w,L=p*Math.PI*2*z,X=P.Matrix.RotationZ(-d),W=P.Matrix.RotationY(L),V=P.mv.TransformCoordinates(P.mv.Up(),X),k=P.mv.TransformCoordinates(V,W),F=k.multiply(g),G=k.divide(g).normalize();U.push(F.x,F.y,F.z),D.push(G.x,G.y,G.z),C.push(p,B.c?1-e:e)}if(L>0){const e=U.length/3;for(let d=e-2*(w+1);d+w+2<e;d++)k?(L>1&&(G.push(d),G.push(d+1),G.push(d+w+1)),(L<F||W<1)&&(G.push(d+w+1),G.push(d+1),G.push(d+w+2))):(G.push(d),G.push(d+1),G.push(d+w+1),G.push(d+w+1),G.push(d+1),G.push(d+w+2))}}L.d._ComputeSides(V,U,G,D,C,e.frontUVs,e.backUVs);const q=new L.d;return q.indices=G,q.ie=U,q.md=D,q.Ze=C,q}function z(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new p.b(e,v);d.sideOrientation=p.b._GetDefaultSideOrientation(d.sideOrientation),P._originalBuilderSideOrientation=d.sideOrientation;return X(d).Te(P,d.updatable),P}L.d.CreateSphere=X,p.b.CreateSphere=(e,d,v,P,p,L)=>z(e,{segments:d,diameterX:v,diameterY:v,diameterZ:v,sideOrientation:L,updatable:p},P)},14634:(e,d,v)=>{"use strict";v.d(d,{d:()=>X});var P=v(12987),p=v(14161),L=v(13e3),B=v(12847);class X{static get Configuration(){return{get decoder(){return p.e.DefaultConfiguration},set decoder(e){p.e.DefaultConfiguration=e}}}static set Configuration(e){p.e.DefaultConfiguration=e.decoder}static get DecoderAvailable(){return(0,P.j)(p.e.DefaultConfiguration)}static get Default(){return X._Default??(X._Default=new X),X._Default}static ResetDefault(e){X._Default&&(e||X._Default.dispose(),X._Default=null)}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.DefaultNumWorkers;const d="number"===typeof e?{...p.e.DefaultConfiguration,numWorkers:e}:{...p.e.DefaultConfiguration,...e};this._decoder=new p.e(d)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(e,d,v){return this._decoder.decodeMeshToMeshDataAsync(e,d,v)}async decodeMeshToGeometryAsync(e,d,v,P){return await this._decoder.decodeMeshToGeometryAsync(e,d,v,P)}async _decodeMeshToGeometryForGltfAsync(e,d,v,P,p,L){return await this._decoder._decodeMeshToGeometryForGltfAsync(e,d,v,P,p,L)}async decodeMeshAsync(e,d){const v=await this._decoder.decodeMeshToMeshDataAsync(e,d),P=new B.d;v.indices&&(P.indices=v.indices);for(const p of v.attributes){const e=L.b.GetFloatData(p.data,p.size,L.b.GetDataType(p.data),p.byteOffset,p.byteStride,p.normalized,v.totalVertices);P.set(e,p.kind)}return P}}X.DefaultNumWorkers=(0,P.g)(),X._Default=null},14161:(e,d,v)=>{"use strict";v.d(d,{e:()=>W});var P=v(12987),p=v(12240),L=v(12877),B=v(13e3),X=v(12253),z=v(12996);class W extends P.e{static get DefaultAvailable(){return(0,P.j)(W.DefaultConfiguration)}static get Default(){return W._Default??(W._Default=new W),W._Default}static ResetDefault(e){W._Default&&(e||W._Default.dispose(),W._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(e,d){return{module:await(d||DracoDecoderModule)({wasmBinary:e})}}_getWorkerContent(){return`${z.b}(${z.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.DefaultConfiguration)}decodeMeshToMeshDataAsync(e,d,v){const P=e instanceof ArrayBuffer?new Int8Array(e):new Int8Array(e.buffer,e.byteOffset,e.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async e=>await new Promise(((p,L)=>{e.push(((e,B)=>{let z=null;const W=[],V=d=>{e.removeEventListener("error",V),e.removeEventListener("message",k),L(d),B()},k=d=>{const P=d.data;switch(P.id){case"indices":z=P.data;break;case"attribute":W.push({kind:P.kind,data:P.data,size:P.size,byteOffset:P.byteOffset,byteStride:P.byteStride,normalized:(L=P.kind,g=P.normalized,v&&void 0!==v[L]?(g!==v[L]&&X.c.Warn(`Normalized flag from Draco data (${g}) does not match normalized flag from glTF accessor (${v[L]}). Using flag from glTF accessor.`),v[L]):g)});break;case"decodeMeshDone":e.removeEventListener("error",V),e.removeEventListener("message",k),p({indices:z,attributes:W,totalVertices:P.totalVertices}),B()}var L,g};e.addEventListener("error",V),e.addEventListener("message",k);const g=P.slice();e.postMessage({id:"decodeMesh",dataView:g,attributes:d},[g.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((e=>{let v=null;const p=[],L=(0,z.b)(e.module,P,d,(e=>{v=e}),((e,d,v,P,L,B)=>{p.push({kind:e,data:d,size:v,byteOffset:P,byteStride:L,normalized:B})}));return{indices:v,attributes:p,totalVertices:L}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(e,d,v,P){const p=await this.decodeMeshToMeshDataAsync(v,P),X=new L.c(e,d);p.indices&&X.setIndices(p.indices);for(const L of p.attributes)X.setVerticesBuffer(new B.b(d.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),p.totalVertices);return X}async _decodeMeshToGeometryForGltfAsync(e,d,v,P,p,X){const z=await this.decodeMeshToMeshDataAsync(v,P,p),W=new L.c(e,d);X&&(W._boundingInfo=X,W.useBoundingInfoFromGeometry=!0),z.indices&&W.setIndices(z.indices);for(const L of z.attributes)W.setVerticesBuffer(new B.b(d.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),z.totalVertices);return W}}W.DefaultConfiguration={wasmUrl:`${p.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${p.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${p.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},W._Default=null},14348:(e,d,v)=>{"use strict";v.d(d,{d:()=>Xe});var P=v(12420),p=v(12864),L=v(12490),B=v(12847),X=v(12469);function z(e){let d=e.pathArray;const v=e.closeArray||!1,P=e.closePath||!1,p=e.invertUV||!1,z=Math.floor(d[0].length/2);let W=e.offset||z;W=W>z?z:Math.floor(W);const V=0===e.sideOrientation?0:e.sideOrientation||B.d.DEFAULTSIDE,k=e.Ze,g=e.re,F=[],w=[],G=[],U=[],D=[],C=[],q=[],h=[];let l;const n=[],A=[];let x,i,me;if(d.length<2){const e=[],v=[];for(i=0;i<d[0].length-W;i++)e.push(d[0][i]),v.push(d[0][i+W]);d=[e,v]}let r=0;const Z=P?1:0,f=v?1:0;let T,S,o,K,Q,N;for(l=d[0].length,x=0;x<d.length+f;x++){for(q[x]=0,D[x]=[0],T=x===d.length?d[0]:d[x],S=T.length,l=l<S?l:S,me=0;me<S;)F.push(T[me].x,T[me].y,T[me].z),me>0&&(o=T[me].Zd(T[me-1]).length(),K=o+q[x],D[x].push(K),q[x]=K),me++;P&&(me--,F.push(T[0].x,T[0].y,T[0].z),o=T[me].Zd(T[0]).length(),K=o+q[x],D[x].push(K),q[x]=K),n[x]=S+Z,A[x]=r,r+=S+Z}let u,O,R=null,Y=null;for(i=0;i<l+Z;i++)for(h[i]=0,C[i]=[0],x=0;x<d.length-1+f;x++)Q=d[x],N=x===d.length-1?d[0]:d[x+1],i===l?(R=Q[0],Y=N[0]):(R=Q[i],Y=N[i]),o=Y.Zd(R).length(),K=o+h[i],C[i].push(K),h[i]=K;if(k)for(x=0;x<k.length;x++)U.push(k[x].x,X.c?1-k[x].y:k[x].y);else for(x=0;x<d.length+f;x++)for(i=0;i<l+Z;i++)u=0!=q[x]?D[x][i]/q[x]:0,O=0!=h[i]?C[i][x]/h[i]:0,p?U.push(O,u):U.push(u,X.c?1-O:O);x=0;let H=0,a=n[x]-1,t=n[x+1]-1,I=a<t?a:t,c=A[1]-A[0];const b=n.length-1;for(;H<=I&&x<b;)w.push(H,H+c,H+1),w.push(H+c+1,H+1,H+c),H+=1,H===I&&(x++,c=A[x+1]-A[x],a=n[x]-1,t=n[x+1]-1,H=A[x],I=a<t?a+H:t+H);if(B.d.ComputeNormals(F,w,G),P){let e=0,v=0;for(x=0;x<d.length;x++){e=3*A[x],v=x+1<d.length?3*(A[x+1]-1):G.length-3,G[e]=.5*(G[e]+G[v]),G[e+1]=.5*(G[e+1]+G[v+1]),G[e+2]=.5*(G[e+2]+G[v+2]);const P=Math.sqrt(G[e]*G[e]+G[e+1]*G[e+1]+G[e+2]*G[e+2]);G[e]/=P,G[e+1]/=P,G[e+2]/=P,G[v]=G[e],G[v+1]=G[e+1],G[v+2]=G[e+2]}}if(v){let e=3*A[0],v=3*A[d.length];for(i=0;i<l+Z;i++){G[e]=.5*(G[e]+G[v]),G[e+1]=.5*(G[e+1]+G[v+1]),G[e+2]=.5*(G[e+2]+G[v+2]);const d=Math.sqrt(G[e]*G[e]+G[e+1]*G[e+1]+G[e+2]*G[e+2]);G[e]/=d,G[e+1]/=d,G[e+2]/=d,G[v]=G[e],G[v+1]=G[e+1],G[v+2]=G[e+2],e+=3,v+=3}}B.d._ComputeSides(V,F,w,G,U,e.frontUVs,e.backUVs);let M=null;if(g){M=new Float32Array(4*g.length);for(let e=0;e<g.length;e++)M[4*e]=g[e].r,M[4*e+1]=g[e].g,M[4*e+2]=g[e].b,M[4*e+3]=g[e].a}const s=new B.d,y=new Float32Array(F),j=new Float32Array(G),J=new Float32Array(U);return s.indices=w,s.ie=y,s.md=j,s.Ze=J,M&&s.set(M,L.i.ColorKind),P&&(s._idx=A),s}function W(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=d.pathArray,V=d.closeArray,k=d.closePath,g=p.b._GetDefaultSideOrientation(d.sideOrientation),F=d.instance,w=d.updatable;if(F){const e=P.TmpVectors.mv[0].dp(Number.MAX_VALUE),v=P.TmpVectors.mv[1].dp(-Number.MAX_VALUE),z=d=>{let P=W[0].length;const L=F;let B=0;const X=L._originalBuilderSideOrientation===p.b.DOUBLESIDE?2:1;for(let p=1;p<=X;++p)for(let X=0;X<W.length;++X){const p=W[X],z=p.length;P=P<z?P:z;for(let L=0;L<P;++L){const P=p[L];d[B]=P.x,d[B+1]=P.y,d[B+2]=P.z,e.minimizeInPlaceFromFloats(P.x,P.y,P.z),v.maximizeInPlaceFromFloats(P.x,P.y,P.z),B+=3}if(L._creationDataStorage&&L._creationDataStorage.closePath){const e=p[0];d[B]=e.x,d[B+1]=e.y,d[B+2]=e.z,B+=3}}},V=F.getVerticesData(L.i.PositionKind);if(z(V),F.hasBoundingInfo?F.getBoundingInfo().reConstruct(e,v,F._worldMatrix):F.buildBoundingInfo(e,v,F._worldMatrix),F.updateVerticesData(L.i.PositionKind,V,!1,!1),d.re){const e=F.getVerticesData(L.i.ColorKind);for(let v=0,P=0;v<d.re.length;v++,P+=4){const p=d.re[v];e[P]=p.r,e[P+1]=p.g,e[P+2]=p.b,e[P+3]=p.a}F.updateVerticesData(L.i.ColorKind,e,!1,!1)}if(d.Ze){const e=F.getVerticesData(L.i.UVKind);for(let v=0;v<d.Ze.length;v++)e[2*v]=d.Ze[v].x,e[2*v+1]=X.c?1-d.Ze[v].y:d.Ze[v].y;F.updateVerticesData(L.i.UVKind,e,!1,!1)}if(!F.areNormalsFrozen||F.isFacetDataEnabled){const e=F.yd(),d=F.getVerticesData(L.i.NormalKind),v=F.isFacetDataEnabled?F.getFacetDataParameters():null;if(B.d.ComputeNormals(V,e,d,v),F._creationDataStorage&&F._creationDataStorage.closePath){let e=0,v=0;for(let P=0;P<W.length;P++)e=3*F._creationDataStorage.idx[P],v=P+1<W.length?3*(F._creationDataStorage.idx[P+1]-1):d.length-3,d[e]=.5*(d[e]+d[v]),d[e+1]=.5*(d[e+1]+d[v+1]),d[e+2]=.5*(d[e+2]+d[v+2]),d[v]=d[e],d[v+1]=d[e+1],d[v+2]=d[e+2]}F.areNormalsFrozen||F.updateVerticesData(L.i.NormalKind,d,!1,!1)}return F}{const P=new p.b(e,v);P._originalBuilderSideOrientation=g,P._creationDataStorage=new p.c;const L=z(d);return k&&(P._creationDataStorage.idx=L._idx),P._creationDataStorage.closePath=k,P._creationDataStorage.closeArray=V,L.Te(P,w),P}}B.d.CreateRibbon=z,p.b.CreateRibbon=function(e,d){return W(e,{pathArray:d,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var V=v(13864),k=v(13690),g=v(12463);function F(e){const d=e.pattern||p.b.NO_FLIP,v=e.tileWidth||e.tileSize||1,P=e.tileHeight||e.tileSize||1,L=e.alignHorizontal||0,X=e.alignVertical||0,z=e.width||e.size||1,W=Math.floor(z/v);let V=z-W*v;const k=e.height||e.size||1,g=Math.floor(k/P);let F=k-g*P;const w=v*W/2,G=P*g/2;let U=0,D=0,C=0,q=0,h=0,l=0;if(V>0||F>0){switch(C=-w,q=-G,h=w,l=G,L){case p.b.CENTER:V/=2,C-=V,h+=V;break;case p.b.LEFT:h+=V,U=-V/2;break;case p.b.RIGHT:C-=V,U=V/2}switch(X){case p.b.CENTER:F/=2,q-=F,l+=F;break;case p.b.BOTTOM:l+=F,D=-F/2;break;case p.b.TOP:q-=F,D=F/2}}const n=[],A=[],x=[];x[0]=[0,0,1,0,1,1,0,1],x[1]=[0,0,1,0,1,1,0,1],d!==p.b.ROTATE_TILE&&d!==p.b.ROTATE_ROW||(x[1]=[1,1,0,1,0,0,1,0]),d!==p.b.FLIP_TILE&&d!==p.b.FLIP_ROW||(x[1]=[1,0,0,0,0,1,1,1]),d!==p.b.FLIP_N_ROTATE_TILE&&d!==p.b.FLIP_N_ROTATE_ROW||(x[1]=[0,1,1,1,1,0,0,0]);let i=[];const me=[],r=[];let Z=0;for(let B=0;B<g;B++)for(let e=0;e<W;e++)n.push(e*v-w+U,B*P-G+D,0),n.push((e+1)*v-w+U,B*P-G+D,0),n.push((e+1)*v-w+U,(B+1)*P-G+D,0),n.push(e*v-w+U,(B+1)*P-G+D,0),r.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),i=d===p.b.FLIP_TILE||d===p.b.ROTATE_TILE||d===p.b.FLIP_N_ROTATE_TILE?i.concat(x[(e%2+B%2)%2]):d===p.b.FLIP_ROW||d===p.b.ROTATE_ROW||d===p.b.FLIP_N_ROTATE_ROW?i.concat(x[B%2]):i.concat(x[0]),me.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Z+=4;if(V>0||F>0){const e=F>0&&(X===p.b.CENTER||X===p.b.TOP),B=F>0&&(X===p.b.CENTER||X===p.b.BOTTOM),z=V>0&&(L===p.b.CENTER||L===p.b.RIGHT),k=V>0&&(L===p.b.CENTER||L===p.b.LEFT);let x,f,T,S,o=[];if(e&&z&&(n.push(C+U,q+D,0),n.push(-w+U,q+D,0),n.push(-w+U,q+F+D,0),n.push(C+U,q+F+D,0),r.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,x=1-V/v,f=1-F/P,T=1,S=1,o=[x,f,T,f,T,S,x,S],d===p.b.ROTATE_ROW&&(o=[1-x,1-f,1-T,1-f,1-T,1-S,1-x,1-S]),d===p.b.FLIP_ROW&&(o=[1-x,f,1-T,f,1-T,S,1-x,S]),d===p.b.FLIP_N_ROTATE_ROW&&(o=[x,1-f,T,1-f,T,1-S,x,1-S]),i=i.concat(o),me.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e&&k&&(n.push(w+U,q+D,0),n.push(h+U,q+D,0),n.push(h+U,q+F+D,0),n.push(w+U,q+F+D,0),r.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,x=0,f=1-F/P,T=V/v,S=1,o=[x,f,T,f,T,S,x,S],(d===p.b.ROTATE_ROW||d===p.b.ROTATE_TILE&&W%2===0)&&(o=[1-x,1-f,1-T,1-f,1-T,1-S,1-x,1-S]),(d===p.b.FLIP_ROW||d===p.b.FLIP_TILE&&W%2===0)&&(o=[1-x,f,1-T,f,1-T,S,1-x,S]),(d===p.b.FLIP_N_ROTATE_ROW||d===p.b.FLIP_N_ROTATE_TILE&&W%2===0)&&(o=[x,1-f,T,1-f,T,1-S,x,1-S]),i=i.concat(o),me.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&z&&(n.push(C+U,G+D,0),n.push(-w+U,G+D,0),n.push(-w+U,l+D,0),n.push(C+U,l+D,0),r.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,x=1-V/v,f=0,T=1,S=F/P,o=[x,f,T,f,T,S,x,S],(d===p.b.ROTATE_ROW&&g%2===1||d===p.b.ROTATE_TILE&&g%1===0)&&(o=[1-x,1-f,1-T,1-f,1-T,1-S,1-x,1-S]),(d===p.b.FLIP_ROW&&g%2===1||d===p.b.FLIP_TILE&&g%2===0)&&(o=[1-x,f,1-T,f,1-T,S,1-x,S]),(d===p.b.FLIP_N_ROTATE_ROW&&g%2===1||d===p.b.FLIP_N_ROTATE_TILE&&g%2===0)&&(o=[x,1-f,T,1-f,T,1-S,x,1-S]),i=i.concat(o),me.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&k&&(n.push(w+U,G+D,0),n.push(h+U,G+D,0),n.push(h+U,l+D,0),n.push(w+U,l+D,0),r.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,x=0,f=0,T=V/v,S=F/P,o=[x,f,T,f,T,S,x,S],(d===p.b.ROTATE_ROW&&g%2===1||d===p.b.ROTATE_TILE&&(g+W)%2===1)&&(o=[1-x,1-f,1-T,1-f,1-T,1-S,1-x,1-S]),(d===p.b.FLIP_ROW&&g%2===1||d===p.b.FLIP_TILE&&(g+W)%2===1)&&(o=[1-x,f,1-T,f,1-T,S,1-x,S]),(d===p.b.FLIP_N_ROTATE_ROW&&g%2===1||d===p.b.FLIP_N_ROTATE_TILE&&(g+W)%2===1)&&(o=[x,1-f,T,1-f,T,1-S,x,1-S]),i=i.concat(o),me.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),e){const e=[];x=0,f=1-F/P,T=1,S=1,e[0]=[x,f,T,f,T,S,x,S],e[1]=[x,f,T,f,T,S,x,S],d!==p.b.ROTATE_TILE&&d!==p.b.ROTATE_ROW||(e[1]=[1-x,1-f,1-T,1-f,1-T,1-S,1-x,1-S]),d!==p.b.FLIP_TILE&&d!==p.b.FLIP_ROW||(e[1]=[1-x,f,1-T,f,1-T,S,1-x,S]),d!==p.b.FLIP_N_ROTATE_TILE&&d!==p.b.FLIP_N_ROTATE_ROW||(e[1]=[x,1-f,T,1-f,T,1-S,x,1-S]);for(let P=0;P<W;P++)n.push(P*v-w+U,q+D,0),n.push((P+1)*v-w+U,q+D,0),n.push((P+1)*v-w+U,q+F+D,0),n.push(P*v-w+U,q+F+D,0),r.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,i=d===p.b.FLIP_TILE||d===p.b.ROTATE_TILE||d===p.b.FLIP_N_ROTATE_TILE?i.concat(e[(P+1)%2]):d===p.b.FLIP_ROW||d===p.b.ROTATE_ROW||d===p.b.FLIP_N_ROTATE_ROW?i.concat(e[1]):i.concat(e[0]),me.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const e=[];x=0,f=0,T=1,S=F/P,e[0]=[x,f,T,f,T,S,x,S],e[1]=[x,f,T,f,T,S,x,S],d!==p.b.ROTATE_TILE&&d!==p.b.ROTATE_ROW||(e[1]=[1-x,1-f,1-T,1-f,1-T,1-S,1-x,1-S]),d!==p.b.FLIP_TILE&&d!==p.b.FLIP_ROW||(e[1]=[1-x,f,1-T,f,1-T,S,1-x,S]),d!==p.b.FLIP_N_ROTATE_TILE&&d!==p.b.FLIP_N_ROTATE_ROW||(e[1]=[x,1-f,T,1-f,T,1-S,x,1-S]);for(let P=0;P<W;P++)n.push(P*v-w+U,l-F+D,0),n.push((P+1)*v-w+U,l-F+D,0),n.push((P+1)*v-w+U,l+D,0),n.push(P*v-w+U,l+D,0),r.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,i=d===p.b.FLIP_TILE||d===p.b.ROTATE_TILE||d===p.b.FLIP_N_ROTATE_TILE?i.concat(e[(P+g)%2]):d===p.b.FLIP_ROW||d===p.b.ROTATE_ROW||d===p.b.FLIP_N_ROTATE_ROW?i.concat(e[g%2]):i.concat(e[0]),me.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(z){const e=[];x=1-V/v,f=0,T=1,S=1,e[0]=[x,f,T,f,T,S,x,S],e[1]=[x,f,T,f,T,S,x,S],d!==p.b.ROTATE_TILE&&d!==p.b.ROTATE_ROW||(e[1]=[1-x,1-f,1-T,1-f,1-T,1-S,1-x,1-S]),d!==p.b.FLIP_TILE&&d!==p.b.FLIP_ROW||(e[1]=[1-x,f,1-T,f,1-T,S,1-x,S]),d!==p.b.FLIP_N_ROTATE_TILE&&d!==p.b.FLIP_N_ROTATE_ROW||(e[1]=[x,1-f,T,1-f,T,1-S,x,1-S]);for(let v=0;v<g;v++)n.push(C+U,v*P-G+D,0),n.push(C+V+U,v*P-G+D,0),n.push(C+V+U,(v+1)*P-G+D,0),n.push(C+U,(v+1)*P-G+D,0),r.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,i=d===p.b.FLIP_TILE||d===p.b.ROTATE_TILE||d===p.b.FLIP_N_ROTATE_TILE?i.concat(e[(v+1)%2]):d===p.b.FLIP_ROW||d===p.b.ROTATE_ROW||d===p.b.FLIP_N_ROTATE_ROW?i.concat(e[v%2]):i.concat(e[0]),me.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){const e=[];x=0,f=0,T=V/P,S=1,e[0]=[x,f,T,f,T,S,x,S],e[1]=[x,f,T,f,T,S,x,S],d!==p.b.ROTATE_TILE&&d!==p.b.ROTATE_ROW||(e[1]=[1-x,1-f,1-T,1-f,1-T,1-S,1-x,1-S]),d!==p.b.FLIP_TILE&&d!==p.b.FLIP_ROW||(e[1]=[1-x,f,1-T,f,1-T,S,1-x,S]),d!==p.b.FLIP_N_ROTATE_TILE&&d!==p.b.FLIP_N_ROTATE_ROW||(e[1]=[x,1-f,T,1-f,T,1-S,x,1-S]);for(let v=0;v<g;v++)n.push(h-V+U,v*P-G+D,0),n.push(h+U,v*P-G+D,0),n.push(h+U,(v+1)*P-G+D,0),n.push(h-V+U,(v+1)*P-G+D,0),r.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,i=d===p.b.FLIP_TILE||d===p.b.ROTATE_TILE||d===p.b.FLIP_N_ROTATE_TILE?i.concat(e[(v+W)%2]):d===p.b.FLIP_ROW||d===p.b.ROTATE_ROW||d===p.b.FLIP_N_ROTATE_ROW?i.concat(e[v%2]):i.concat(e[0]),me.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),A.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const f=0===e.sideOrientation?0:e.sideOrientation||B.d.DEFAULTSIDE;B.d._ComputeSides(f,n,r,A,i,e.frontUVs,e.backUVs);const T=new B.d;T.indices=r,T.ie=n,T.md=A,T.Ze=i;const S=f===B.d.DOUBLESIDE?me.concat(me):me;return T.re=S,T}function w(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new p.b(e,v);d.sideOrientation=p.b._GetDefaultSideOrientation(d.sideOrientation),P._originalBuilderSideOrientation=d.sideOrientation;return F(d).Te(P,d.updatable),P}function G(e){const d=e.faceUV||new Array(6),v=e.faceColors,L=e.pattern||p.b.NO_FLIP,z=e.width||e.size||1,W=e.height||e.size||1,V=e.depth||e.size||1,k=e.tileWidth||e.tileSize||1,w=e.tileHeight||e.tileSize||1,G=e.alignHorizontal||0,U=e.alignVertical||0,D=0===e.sideOrientation?0:e.sideOrientation||B.d.DEFAULTSIDE;for(let p=0;p<6;p++)void 0===d[p]&&(d[p]=new P.Vector4(0,0,1,1)),v&&void 0===v[p]&&(v[p]=new g.Up(1,1,1,1));const C=z/2,q=W/2,h=V/2,l=[];for(let P=0;P<2;P++)l[P]=F({pattern:L,tileWidth:k,tileHeight:w,width:z,height:W,alignVertical:U,alignHorizontal:G,sideOrientation:D});for(let P=2;P<4;P++)l[P]=F({pattern:L,tileWidth:k,tileHeight:w,width:V,height:W,alignVertical:U,alignHorizontal:G,sideOrientation:D});let n=U;U===p.b.BOTTOM?n=p.b.TOP:U===p.b.TOP&&(n=p.b.BOTTOM);for(let P=4;P<6;P++)l[P]=F({pattern:L,tileWidth:k,tileHeight:w,width:z,height:V,alignVertical:n,alignHorizontal:G,sideOrientation:D});let A=[],x=[],i=[],me=[];const r=[],Z=[],f=[],T=[];let S=0,o=0;for(let p=0;p<6;p++){const e=l[p].ie.length;Z[p]=[],f[p]=[];for(let d=0;d<e/3;d++)Z[p].push(new P.mv(l[p].ie[3*d],l[p].ie[3*d+1],l[p].ie[3*d+2])),f[p].push(new P.mv(l[p].md[3*d],l[p].md[3*d+1],l[p].md[3*d+2]));S=l[p].Ze.length,T[p]=[];for(let v=0;v<S;v+=2)T[p][v]=d[p].x+(d[p].z-d[p].x)*l[p].Ze[v],T[p][v+1]=d[p].y+(d[p].w-d[p].y)*l[p].Ze[v+1],X.c&&(T[p][v+1]=1-T[p][v+1]);if(i=i.concat(T[p]),me=me.concat(l[p].indices.map((e=>e+o))),o+=Z[p].length,v)for(let d=0;d<4;d++)r.push(v[p].r,v[p].g,v[p].b,v[p].a)}const K=new P.mv(0,0,h),Q=P.Matrix.RotationY(Math.PI);A=Z[0].map((e=>P.mv.TransformNormal(e,Q).add(K))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[]),x=f[0].map((e=>P.mv.TransformNormal(e,Q))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[]),A=A.concat(Z[1].map((e=>e.Zd(K))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[])),x=x.concat(f[1].map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[]));const N=new P.mv(C,0,0),u=P.Matrix.RotationY(-Math.PI/2);A=A.concat(Z[2].map((e=>P.mv.TransformNormal(e,u).add(N))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[])),x=x.concat(f[2].map((e=>P.mv.TransformNormal(e,u))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[]));const O=P.Matrix.RotationY(Math.PI/2);A=A.concat(Z[3].map((e=>P.mv.TransformNormal(e,O).Zd(N))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[])),x=x.concat(f[3].map((e=>P.mv.TransformNormal(e,O))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[]));const R=new P.mv(0,q,0),Y=P.Matrix.RotationX(Math.PI/2);A=A.concat(Z[4].map((e=>P.mv.TransformNormal(e,Y).add(R))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[])),x=x.concat(f[4].map((e=>P.mv.TransformNormal(e,Y))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[]));const H=P.Matrix.RotationX(-Math.PI/2);A=A.concat(Z[5].map((e=>P.mv.TransformNormal(e,H).Zd(R))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[])),x=x.concat(f[5].map((e=>P.mv.TransformNormal(e,H))).map((e=>[e.x,e.y,e.z])).reduce(((e,d)=>e.concat(d)),[])),B.d._ComputeSides(D,A,me,x,i);const a=new B.d;if(a.indices=me,a.ie=A,a.md=x,a.Ze=i,v){const e=D===B.d.DOUBLESIDE?r.concat(r):r;a.re=e}return a}function U(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new p.b(e,v);d.sideOrientation=p.b._GetDefaultSideOrientation(d.sideOrientation),P._originalBuilderSideOrientation=d.sideOrientation;return G(d).Te(P,d.updatable),P}B.d.CreateTiledPlane=F;B.d.CreateTiledBox=G;var D=v(13849),C=v(12653),q=v(12620);function h(e){const d=e.height||2;let v=0===e.diameterTop?0:e.diameterTop||e.diameter||1,L=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1;v=v||1e-5,L=L||1e-5;const z=0|(e.tessellation||24),W=0|(e.subdivisions||1),V=!!e.hasRings,k=!!e.enclose,F=0===e.cap?0:e.cap||p.b.CAP_ALL,w=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,G=0===e.sideOrientation?0:e.sideOrientation||B.d.DEFAULTSIDE,U=e.faceUV||new Array(3),D=e.faceColors,C=2+(1+(1!==w&&k?2:0))*(V?W:1);let h;for(h=0;h<C;h++)D&&void 0===D[h]&&(D[h]=new g.Up(1,1,1,1));for(h=0;h<C;h++)U&&void 0===U[h]&&(U[h]=new P.Vector4(0,0,1,1));const l=[],n=[],A=[],x=[],i=[],me=2*Math.PI*w/z;let r,Z,f;const T=(L-v)/2/d,S=P.mv.Zero(),o=P.mv.Zero(),K=P.mv.Zero(),Q=P.mv.Zero(),N=P.mv.Zero(),u=q.d.Y;let O,R,Y,H=1,a=1,t=0,I=0;for(O=0;O<=W;O++)for(Z=O/W,f=(Z*(v-L)+L)/2,H=V&&0!==O&&O!==W?2:1,Y=0;Y<H;Y++){for(V&&(a+=Y),k&&(a+=2*Y),R=0;R<=z;R++)r=R*me,S.x=Math.cos(-r)*f,S.y=-d/2+Z*d,S.z=Math.sin(-r)*f,0===v&&O===W?(o.x=A[A.length-3*(z+1)],o.y=A[A.length-3*(z+1)+1],o.z=A[A.length-3*(z+1)+2]):(o.x=S.x,o.z=S.z,o.y=Math.sqrt(o.x*o.x+o.z*o.z)*T,o.normalize()),0===R&&(K.L(S),Q.L(o)),n.push(S.x,S.y,S.z),A.push(o.x,o.y,o.z),I=V?t!==a?U[a].y:U[a].w:U[a].y+(U[a].w-U[a].y)*Z,x.push(U[a].x+(U[a].z-U[a].x)*R/z,X.c?1-I:I),D&&i.push(D[a].r,D[a].g,D[a].b,D[a].a);1!==w&&k&&(n.push(S.x,S.y,S.z),n.push(0,S.y,0),n.push(0,S.y,0),n.push(K.x,K.y,K.z),P.mv.CrossToRef(u,o,N),N.normalize(),A.push(N.x,N.y,N.z,N.x,N.y,N.z),P.mv.CrossToRef(Q,u,N),N.normalize(),A.push(N.x,N.y,N.z,N.x,N.y,N.z),I=V?t!==a?U[a+1].y:U[a+1].w:U[a+1].y+(U[a+1].w-U[a+1].y)*Z,x.push(U[a+1].x,X.c?1-I:I),x.push(U[a+1].z,X.c?1-I:I),I=V?t!==a?U[a+2].y:U[a+2].w:U[a+2].y+(U[a+2].w-U[a+2].y)*Z,x.push(U[a+2].x,X.c?1-I:I),x.push(U[a+2].z,X.c?1-I:I),D&&(i.push(D[a+1].r,D[a+1].g,D[a+1].b,D[a+1].a),i.push(D[a+1].r,D[a+1].g,D[a+1].b,D[a+1].a),i.push(D[a+2].r,D[a+2].g,D[a+2].b,D[a+2].a),i.push(D[a+2].r,D[a+2].g,D[a+2].b,D[a+2].a))),t!==a&&(t=a)}const c=1!==w&&k?z+4:z;for(O=0,a=0;a<W;a++){let e=0,d=0,v=0,P=0;for(R=0;R<z;R++)e=O*(c+1)+R,d=(O+1)*(c+1)+R,v=O*(c+1)+(R+1),P=(O+1)*(c+1)+(R+1),l.push(e,d,v),l.push(P,v,d);1!==w&&k&&(l.push(e+2,d+2,v+2),l.push(P+2,v+2,d+2),l.push(e+4,d+4,v+4),l.push(P+4,v+4,d+4)),O=V?O+2:O+1}const b=e=>{const p=e?v/2:L/2;if(0===p)return;let B,W,V;const k=e?U[C-1]:U[0];let g=null;D&&(g=e?D[C-1]:D[0]);const F=n.length/3,G=e?d/2:-d/2,q=new P.mv(0,G,0);n.push(q.x,q.y,q.z),A.push(0,e?1:-1,0);const h=k.y+.5*(k.w-k.y);x.push(k.x+.5*(k.z-k.x),X.c?1-h:h),g&&i.push(g.r,g.g,g.b,g.a);const me=new P.Vector2(.5,.5);for(V=0;V<=z;V++){B=2*Math.PI*V*w/z;const d=Math.cos(-B),v=Math.sin(-B);W=new P.mv(d*p,G,v*p);const L=new P.Vector2(d*me.x+.5,v*me.y+.5);n.push(W.x,W.y,W.z),A.push(0,e?1:-1,0);const F=k.y+(k.w-k.y)*L.y;x.push(k.x+(k.z-k.x)*L.x,X.c?1-F:F),g&&i.push(g.r,g.g,g.b,g.a)}for(V=0;V<z;V++)e?(l.push(F),l.push(F+(V+2)),l.push(F+(V+1))):(l.push(F),l.push(F+(V+1)),l.push(F+(V+2)))};F!==p.b.CAP_START&&F!==p.b.CAP_ALL||b(!1),F!==p.b.CAP_END&&F!==p.b.CAP_ALL||b(!0),B.d._ComputeSides(G,n,l,A,x,e.frontUVs,e.backUVs);const M=new B.d;return M.indices=l,M.ie=n,M.md=A,M.Ze=x,D&&(M.re=i),M}function l(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const P=new p.b(e,v);d.sideOrientation=p.b._GetDefaultSideOrientation(d.sideOrientation),P._originalBuilderSideOrientation=d.sideOrientation;return h(d).Te(P,d.updatable),P}function n(e){const d=[],v=[],p=[],L=[],z=e.diameter||1,W=e.thickness||.5,V=0|(e.tessellation||16),k=0===e.sideOrientation?0:e.sideOrientation||B.d.DEFAULTSIDE,g=V+1;for(let B=0;B<=V;B++){const e=B/V,k=B*Math.PI*2/V-Math.PI/2,F=P.Matrix.Translation(z/2,0,0).multiply(P.Matrix.RotationY(k));for(let z=0;z<=V;z++){const k=1-z/V,w=z*Math.PI*2/V+Math.PI,G=Math.cos(w),U=Math.sin(w);let D=new P.mv(G,U,0),C=D.scale(W/2);const q=new P.Vector2(e,k);C=P.mv.TransformCoordinates(C,F),D=P.mv.TransformNormal(D,F),v.push(C.x,C.y,C.z),p.push(D.x,D.y,D.z),L.push(q.x,X.c?1-q.y:q.y);const h=(B+1)%g,l=(z+1)%g;d.push(B*g+z),d.push(B*g+l),d.push(h*g+z),d.push(B*g+l),d.push(h*g+l),d.push(h*g+z)}}B.d._ComputeSides(k,v,d,p,L,e.frontUVs,e.backUVs);const F=new B.d;return F.indices=d,F.ie=v,F.md=p,F.Ze=L,F}function A(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const P=new p.b(e,v);d.sideOrientation=p.b._GetDefaultSideOrientation(d.sideOrientation),P._originalBuilderSideOrientation=d.sideOrientation;return n(d).Te(P,d.updatable),P}B.d.CreateCylinder=h,p.b.CreateCylinder=(e,d,v,P,L,B,X,z,W)=>{void 0!==X&&X instanceof C.d||(void 0!==X&&(W=z||p.b.DEFAULTSIDE,z=X),X=B,B=1);return l(e,{height:d,diameterTop:v,diameterBottom:P,tessellation:L,subdivisions:B,sideOrientation:W,updatable:z},X)};function x(e){const d=[],v=[],p=[],L=[],z=e.radius||2,W=e.tube||.5,V=e.radialSegments||32,k=e.tubularSegments||32,g=e.p||2,F=e.q||3,w=0===e.sideOrientation?0:e.sideOrientation||B.d.DEFAULTSIDE,G=e=>{const d=Math.cos(e),v=Math.sin(e),p=F/g*e,L=Math.cos(p),B=z*(2+L)*.5*d,X=z*(2+L)*v*.5,W=z*Math.sin(p)*.5;return new P.mv(B,X,W)};let U,D;for(U=0;U<=V;U++){const e=U%V/V*2*g*Math.PI,d=G(e),p=G(e+.01),B=p.Zd(d);let z=p.add(d);const F=P.mv.Cross(B,z);for(z=P.mv.Cross(F,B),F.normalize(),z.normalize(),D=0;D<k;D++){const e=D%k/k*2*Math.PI,P=-W*Math.cos(e),p=W*Math.sin(e);v.push(d.x+P*z.x+p*F.x),v.push(d.y+P*z.y+p*F.y),v.push(d.z+P*z.z+p*F.z),L.push(U/V),L.push(X.c?1-D/k:D/k)}}for(U=0;U<V;U++)for(D=0;D<k;D++){const e=(D+1)%k,v=U*k+D,P=(U+1)*k+D,p=(U+1)*k+e,L=U*k+e;d.push(L),d.push(P),d.push(v),d.push(L),d.push(p),d.push(P)}B.d.ComputeNormals(v,d,p),B.d._ComputeSides(w,v,d,p,L,e.frontUVs,e.backUVs);const C=new B.d;return C.indices=d,C.ie=v,C.md=p,C.Ze=L,C}function i(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const P=new p.b(e,v);d.sideOrientation=p.b._GetDefaultSideOrientation(d.sideOrientation),P._originalBuilderSideOrientation=d.sideOrientation;return x(d).Te(P,d.updatable),P}B.d.CreateTorus=n,p.b.CreateTorus=(e,d,v,P,p,L,B)=>A(e,{diameter:d,thickness:v,tessellation:P,sideOrientation:B,updatable:L},p);B.d.CreateTorusKnot=x,p.b.CreateTorusKnot=(e,d,v,P,p,L,B,X,z,W)=>i(e,{radius:d,tube:v,radialSegments:P,tubularSegments:p,p:L,q:B,sideOrientation:W,updatable:z},X);var me=v(14353),r=v(12976),Z=v(12627);function f(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=d.path,L=d.shape,B=d.scale||1,X=d.rotation||0,z=0===d.cap?0:d.cap||p.b.NO_CAP,W=d.updatable,V=p.b._GetDefaultSideOrientation(d.sideOrientation),k=d.instance||null,g=d.invertUV||!1,F=d.closeShape||!1,w=d.closePath||!1,G=d.capFunction||null;return S(e,L,P,B,X,null,null,w,F,z,!1,v,!!W,V,k,g,d.frontUVs||null,d.backUVs||null,d.firstNormal||null,!!d.adjustFrame,G)}function T(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=d.path,L=d.shape,B=d.scaleFunction||(()=>1),X=d.rotationFunction||(()=>0),z=d.closePath||d.ribbonCloseArray||!1,W=d.closeShape||d.ribbonClosePath||!1,V=0===d.cap?0:d.cap||p.b.NO_CAP,k=d.updatable,g=d.firstNormal||null,F=d.adjustFrame||!1,w=p.b._GetDefaultSideOrientation(d.sideOrientation),G=d.instance,U=d.invertUV||!1,D=d.capFunction||null;return S(e,L,P,null,null,B,X,z,W,V,!0,v,!!k,w,G||null,U,d.frontUVs||null,d.backUVs||null,g,F,D||null)}function S(e,d,v,L,B,X,z,V,k,g,F,w,G,U,D,C,q,h,l,n,A){const x=(e,d,v,L,B,X,z,W,V,k,g)=>{const F=v.getTangents(),w=v.getNormals(),G=v.getBinormals(),U=v.getDistances();if(g)for(let p=0;p<F.length;p++)if(0==F[p].x&&0==F[p].y&&0==F[p].z&&F[p].L(F[p-1]),0==w[p].x&&0==w[p].y&&0==w[p].z&&w[p].L(w[p-1]),0==G[p].x&&0==G[p].y&&0==G[p].z&&G[p].L(G[p-1]),p>0){let e=F[p-1];P.mv.Dot(e,F[p])<0&&F[p].scaleInPlace(-1),e=w[p-1],P.mv.Dot(e,w[p])<0&&w[p].scaleInPlace(-1),e=G[p-1],P.mv.Dot(e,G[p])<0&&G[p].scaleInPlace(-1)}let D=0;const C=k&&W?W:()=>null!==X?X:0,q=k&&z?z:()=>null!==B?B:1;let h=V===p.b.NO_CAP||V===p.b.CAP_END?0:2;const l=P.TmpVectors.Matrix[0];for(let p=0;p<d.length;p++){const v=[],B=C(p,U[p]),X=q(p,U[p]);P.Matrix.RotationAxisToRef(F[p],D,l);for(let L=0;L<e.length;L++){const B=F[p].scale(e[L].z).add(w[p].scale(e[L].x)).add(G[p].scale(e[L].y)),z=P.mv.Zero();P.mv.TransformCoordinatesToRef(B,l,z),z.scaleInPlace(X).addInPlace(d[p]),v[L]=z}L[h]=v,D+=B,h++}const n=A||(e=>{const d=Array(),v=P.mv.Zero();let p;for(p=0;p<e.length;p++)v.addInPlace(e[p]);for(v.scaleInPlace(1/e.length),p=0;p<e.length;p++)d.push(v);return d});switch(V){case p.b.NO_CAP:break;case p.b.CAP_START:L[0]=n(L[2]),L[1]=L[2];break;case p.b.CAP_END:L[h]=L[h-1],L[h+1]=n(L[h-1]);break;case p.b.CAP_ALL:L[0]=n(L[2]),L[1]=L[2],L[h]=L[h-1],L[h+1]=n(L[h-1])}return L};let i,me;if(D){const e=D._creationDataStorage;return i=l?e.path3D.update(v,l):e.path3D.update(v),me=x(d,v,e.path3D,e.pathArray,L,B,X,z,e.cap,F,n),D=W("",{pathArray:me,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:D},w||void 0)}i=l?new Z.i(v,l):new Z.i(v);me=x(d,v,i,new Array,L,B,X,z,g=g<0||g>3?0:g,F,n);const r=W(e,{pathArray:me,closeArray:V,closePath:k,updatable:G,sideOrientation:U,invertUV:C,frontUVs:q||void 0,backUVs:h||void 0},w);return r._creationDataStorage.pathArray=me,r._creationDataStorage.path3D=i,r._creationDataStorage.cap=g,r}function o(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=d.arc?d.arc<=0||d.arc>1?1:d.arc:1,B=void 0===d.closed||d.closed,X=d.shape,z=d.radius||1,V=d.tessellation||64,k=d.clip||0,g=d.updatable,F=p.b._GetDefaultSideOrientation(d.sideOrientation),w=d.cap||p.b.NO_CAP,G=2*Math.PI,U=[],D=d.invertUV||!1;let C=0,q=0;const h=G/V*L;let l,n;for(C=0;C<=V-k;C++){for(n=[],w!=p.b.CAP_START&&w!=p.b.CAP_ALL||(n.push(new P.mv(0,X[0].y,0)),n.push(new P.mv(Math.cos(C*h)*X[0].x*z,X[0].y,Math.sin(C*h)*X[0].x*z))),q=0;q<X.length;q++)l=new P.mv(Math.cos(C*h)*X[q].x*z,X[q].y,Math.sin(C*h)*X[q].x*z),n.push(l);w!=p.b.CAP_END&&w!=p.b.CAP_ALL||(n.push(new P.mv(Math.cos(C*h)*X[X.length-1].x*z,X[X.length-1].y,Math.sin(C*h)*X[X.length-1].x*z)),n.push(new P.mv(0,X[X.length-1].y,0))),U.push(n)}return W(e,{pathArray:U,closeArray:B,sideOrientation:F,updatable:g,invertUV:D,frontUVs:d.frontUVs,backUVs:d.backUVs},v)}p.b.ExtrudeShape=function(e,d,v,P,L,B){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7?arguments[7]:void 0,W=arguments.length>8?arguments[8]:void 0,V=arguments.length>9?arguments[9]:void 0;return f(e,{shape:d,path:v,scale:P,rotation:L,cap:0===B?0:B||p.b.NO_CAP,sideOrientation:W,instance:V,updatable:z},X)},p.b.ExtrudeShapeCustom=(e,d,v,P,L,B,X,z,W,V,k,g)=>T(e,{shape:d,path:v,scaleFunction:P,rotationFunction:L,ribbonCloseArray:B,ribbonClosePath:X,cap:0===z?0:z||p.b.NO_CAP,sideOrientation:k,instance:g,updatable:V},W);p.b.CreateLathe=(e,d,v,P,p,L,B)=>o(e,{shape:d,radius:v,tessellation:P,sideOrientation:B,updatable:L},p);var K=v(13746),Q=v(13693);function N(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=d.path;let B=d.instance,X=1;void 0!==d.radius?X=d.radius:B&&(X=B._creationDataStorage.radius);const z=d.tessellation||64,V=d.radiusFunction||null;let k=d.cap||p.b.NO_CAP;const g=d.invertUV||!1,F=d.updatable,w=p.b._GetDefaultSideOrientation(d.sideOrientation);d.arc=d.arc&&(d.arc<=0||d.arc>1)?1:d.arc||1;const G=(e,d,v,L,B,X,z,W)=>{const V=d.getTangents(),k=d.getNormals(),g=d.getDistances(),F=2*Math.PI/B*W,w=X||(()=>L);let G,U,D,C;const q=P.TmpVectors.Matrix[0];let h=z===p.b.NO_CAP||z===p.b.CAP_END?0:2;for(let p=0;p<e.length;p++){U=w(p,g[p]),G=Array(),D=k[p];for(let d=0;d<B;d++)P.Matrix.RotationAxisToRef(V[p],F*d,q),C=G[d]?G[d]:P.mv.Zero(),P.mv.TransformCoordinatesToRef(D,q,C),C.scaleInPlace(U).addInPlace(e[p]),G[d]=C;v[h]=G,h++}const l=(d,v)=>{const P=Array();for(let p=0;p<d;p++)P.push(e[v]);return P};switch(z){case p.b.NO_CAP:break;case p.b.CAP_START:v[0]=l(B,0),v[1]=v[2].slice(0);break;case p.b.CAP_END:v[h]=v[h-1].slice(0),v[h+1]=l(B,e.length-1);break;case p.b.CAP_ALL:v[0]=l(B,0),v[1]=v[2].slice(0),v[h]=v[h-1].slice(0),v[h+1]=l(B,e.length-1)}return v};let U,D;if(B){const e=B._creationDataStorage,v=d.arc||e.arc;return U=e.path3D.update(L),D=G(L,U,e.pathArray,X,e.tessellation,V,e.cap,v),B=W("",{pathArray:D,instance:B}),e.path3D=U,e.pathArray=D,e.arc=v,e.radius=X,B}U=new Z.i(L);k=k<0||k>3?0:k,D=G(L,U,new Array,X,z,V,k,d.arc);const C=W(e,{pathArray:D,closePath:!0,closeArray:!1,updatable:F,sideOrientation:w,invertUV:g,frontUVs:d.frontUVs,backUVs:d.backUVs},v);return C._creationDataStorage.pathArray=D,C._creationDataStorage.path3D=U,C._creationDataStorage.tessellation=z,C._creationDataStorage.cap=k,C._creationDataStorage.arc=d.arc,C._creationDataStorage.radius=X,C}function u(e){const d=[];d[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},d[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},d[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},d[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},d[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},d[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},d[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},d[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},d[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},d[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},d[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},d[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},d[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},d[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},d[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const v=e.type&&(e.type<0||e.type>=d.length)?0:e.type||0,p=e.size,L=e.sizeX||p||1,z=e.sizeY||p||1,W=e.sizeZ||p||1,V=e.custom||d[v],k=V.face.length,F=e.faceUV||new Array(k),w=e.faceColors,G=void 0===e.flat||e.flat,U=0===e.sideOrientation?0:e.sideOrientation||B.d.DEFAULTSIDE,D=[],C=[],q=[],h=[],l=[];let n=0,A=0;const x=[];let i,me,r,Z,f,T,S=0,o=0;if(G)for(o=0;o<k;o++)w&&void 0===w[o]&&(w[o]=new g.Up(1,1,1,1)),F&&void 0===F[o]&&(F[o]=new P.Vector4(0,0,1,1));if(G)for(o=0;o<k;o++){const e=V.face[o].length;for(r=2*Math.PI/e,Z=.5*Math.tan(r/2),f=.5,S=0;S<e;S++)D.push(V.vertex[V.face[o][S]][0]*L,V.vertex[V.face[o][S]][1]*z,V.vertex[V.face[o][S]][2]*W),x.push(n),n++,i=F[o].x+(F[o].z-F[o].x)*(.5+Z),me=F[o].y+(F[o].w-F[o].y)*(f-.5),h.push(i,X.c?1-me:me),T=Z*Math.cos(r)-f*Math.sin(r),f=Z*Math.sin(r)+f*Math.cos(r),Z=T,w&&l.push(w[o].r,w[o].g,w[o].b,w[o].a);for(S=0;S<e-2;S++)C.push(x[0+A],x[S+2+A],x[S+1+A]);A+=e}else{for(S=0;S<V.vertex.length;S++)D.push(V.vertex[S][0]*L,V.vertex[S][1]*z,V.vertex[S][2]*W),h.push(0,X.c?1:0);for(o=0;o<k;o++)for(S=0;S<V.face[o].length-2;S++)C.push(V.face[o][0],V.face[o][S+2],V.face[o][S+1])}B.d.ComputeNormals(D,C,q),B.d._ComputeSides(U,D,C,q,h,e.frontUVs,e.backUVs);const K=new B.d;return K.ie=D,K.indices=C,K.md=q,K.Ze=h,w&&G&&(K.re=l),K}function O(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new p.b(e,v);d.sideOrientation=p.b._GetDefaultSideOrientation(d.sideOrientation),P._originalBuilderSideOrientation=d.sideOrientation;return u(d).Te(P,d.updatable),P}p.b.CreateTube=(e,d,v,P,p,L,B,X,z,W)=>N(e,{path:d,radius:v,tessellation:P,radiusFunction:p,arc:1,cap:L,updatable:X,sideOrientation:z,instance:W},B);function R(e){const d=e.sideOrientation||B.d.DEFAULTSIDE,v=e.radius||1,p=void 0===e.flat||e.flat,L=0|(e.subdivisions||4),z=e.radiusX||v,W=e.radiusY||v,V=e.radiusZ||v,k=(1+Math.sqrt(5))/2,g=[-1,k,-0,1,k,0,-1,-k,0,1,-k,0,0,-1,-k,0,1,-k,0,-1,k,0,1,k,k,0,1,k,0,-1,-k,0,1,-k,0,-1],F=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],w=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],G=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],U=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],D=[],C=[],q=[],h=[];let l=0;const n=new Array(3),A=new Array(3);let x;for(x=0;x<3;x++)n[x]=P.mv.Zero(),A[x]=P.Vector2.Zero();for(let B=0;B<20;B++){for(x=0;x<3;x++){const e=F[3*B+x];n[x].Ed(g[3*w[e]],g[3*w[e]+1],g[3*w[e]+2]),n[x].normalize(),A[x].Ed(.134765625*G[2*e]+.05859375+-.0390625*U[B],.2333984375*G[2*e+1]+.025390625+.01953125*U[B])}const e=(e,d,v,B)=>{const k=P.mv.Lerp(n[0],n[2],d/L),g=P.mv.Lerp(n[1],n[2],d/L),F=L===d?n[2]:P.mv.Lerp(k,g,e/(L-d));let w;if(F.normalize(),p){const e=P.mv.Lerp(n[0],n[2],B/L),d=P.mv.Lerp(n[1],n[2],B/L);w=P.mv.Lerp(e,d,v/(L-B))}else w=new P.mv(F.x,F.y,F.z);w.x/=z,w.y/=W,w.z/=V,w.normalize();const G=P.Vector2.Lerp(A[0],A[2],d/L),U=P.Vector2.Lerp(A[1],A[2],d/L),x=L===d?A[2]:P.Vector2.Lerp(G,U,e/(L-d));C.push(F.x*z,F.y*W,F.z*V),q.push(w.x,w.y,w.z),h.push(x.x,X.c?1-x.y:x.y),D.push(l),l++};for(let d=0;d<L;d++)for(let v=0;v+d<L;v++)e(v,d,v+1/3,d+1/3),e(v+1,d,v+1/3,d+1/3),e(v,d+1,v+1/3,d+1/3),v+d+1<L&&(e(v+1,d,v+2/3,d+2/3),e(v+1,d+1,v+2/3,d+2/3),e(v,d+1,v+2/3,d+2/3))}B.d._ComputeSides(d,C,D,q,h,e.frontUVs,e.backUVs);const i=new B.d;return i.indices=D,i.ie=C,i.md=q,i.Ze=h,i}function Y(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new p.b(e,v);d.sideOrientation=p.b._GetDefaultSideOrientation(d.sideOrientation),P._originalBuilderSideOrientation=d.sideOrientation;return R(d).Te(P,d.updatable),P}B.d.CreatePolyhedron=u,p.b.CreatePolyhedron=(e,d,v)=>O(e,d,v);B.d.CreateIcoSphere=R,p.b.CreateIcoSphere=(e,d,v)=>Y(e,d,v);var H=v(12440);const a=new P.mv(1,0,0),t=new P.mv(-1,0,0),I=new P.mv(0,1,0),c=new P.mv(0,-1,0),b=new P.mv(0,0,1),M=new P.mv(0,0,-1);class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.mv.Zero(),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.mv.Up(),v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.Vector2.Zero(),p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=e,this.normal=d,this.uv=v,this.vertexIdx=p,this.vertexIdxForBones=L,this.localPositionOverride=B,this.localNormalOverride=X,this.matrixIndicesOverride=z,this.matrixWeightsOverride=W}clone(){var e,d,v,P;return new s(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(e=this.localPositionOverride)||void 0===e?void 0:e.slice(),null===(d=this.localNormalOverride)||void 0===d?void 0:d.slice(),null===(v=this.matrixIndicesOverride)||void 0===v?void 0:v.slice(),null===(P=this.matrixWeightsOverride)||void 0===P?void 0:P.slice())}}function y(e,d,v){var z,W,V,k,g;const F=!!d.skeleton,w=!(null===(z=d.morphTargetManager)||void 0===z||!z.numTargets),G=v.localMode||F,U=d.yd(),D=F||w?d.SX(!0,!0):d.getVerticesData(L.i.PositionKind),C=F||w?d.getNormalsData(!0,!0):d.getVerticesData(L.i.NormalKind),q=G?F?d.getVerticesData(L.i.PositionKind):D:null,h=G?F?d.getVerticesData(L.i.NormalKind):C:null,l=d.getVerticesData(L.i.UVKind),n=F?d.getVerticesData(L.i.MatricesIndicesKind):null,A=F?d.getVerticesData(L.i.MatricesWeightsKind):null,x=F?d.getVerticesData(L.i.MatricesIndicesExtraKind):null,i=F?d.getVerticesData(L.i.MatricesWeightsExtraKind):null,me=v.position||P.mv.Zero();let r=v.normal||P.mv.Up();const Z=v.size||P.mv.One(),f=v.angle||0;if(!r){const e=new P.mv(0,0,1),v=d.Ae().activeCamera,p=P.mv.TransformCoordinates(e,v.getWorldMatrix());r=v.globalPosition.Zd(p)}const T=-Math.atan2(r.z,r.x)-Math.PI/2,S=Math.sqrt(r.x*r.x+r.z*r.z),o=Math.atan2(r.y,S),K=new B.d;K.indices=[],K.ie=[],K.md=[],K.Ze=[],K.matricesIndices=F?[]:null,K.matricesWeights=F?[]:null,K.matricesIndicesExtra=x?[]:null,K.matricesWeightsExtra=i?[]:null;let Q=0;const N=(e,d)=>{const p=new s;if(!U||!D||!C)return p;const L=U[e];if(p.vertexIdx=3*L,p.vertexIdxForBones=4*L,p.position=new P.mv(D[3*L],D[3*L+1],D[3*L+2]),P.mv.TransformCoordinatesToRef(p.position,d,p.position),p.normal=new P.mv(C[3*L],C[3*L+1],C[3*L+2]),P.mv.TransformNormalToRef(p.normal,d,p.normal),v.captureUVS&&l){const e=l[2*L+1];p.uv=new P.Vector2(l[2*L],X.c?1-e:e)}return p},u=[0,0,0,0],O=(e,d)=>{if(0===e.length)return e;const v=.5*Math.abs(P.mv.Dot(Z,d)),p=(e,d,v,P)=>{for(let p=0;p<P;++p)if(e[v+p]===d)return v+p;return-1},L=(e,L)=>{const B=P.mv.GetClipFactor(e.position,L.position,d,v);let X=u,z=u;if(n&&A){const d=e.matrixIndicesOverride?0:e.vertexIdxForBones,v=e.matrixIndicesOverride??n,P=e.matrixWeightsOverride??A,W=L.matrixIndicesOverride?0:L.vertexIdxForBones,V=L.matrixIndicesOverride??n,k=L.matrixWeightsOverride??A;X=[0,0,0,0],z=[0,0,0,0];let g=0;for(let e=0;e<4;++e)if(P[d+e]>0){const L=p(V,v[d+e],W,4);X[g]=v[d+e],z[g]=(0,H.Lerp)(P[d+e],L>=0?k[L]:0,B),g++}for(let e=0;e<4&&g<4;++e){const P=V[W+e];-1===p(v,P,d,4)&&(X[g]=P,z[g]=(0,H.Lerp)(0,k[W+e],B),g++)}const F=z[0]+z[1]+z[2]+z[3];z[0]/=F,z[1]/=F,z[2]/=F,z[3]/=F}const W=e.localPositionOverride?e.localPositionOverride[0]:(null===q||void 0===q?void 0:q[e.vertexIdx])??0,V=e.localPositionOverride?e.localPositionOverride[1]:(null===q||void 0===q?void 0:q[e.vertexIdx+1])??0,k=e.localPositionOverride?e.localPositionOverride[2]:(null===q||void 0===q?void 0:q[e.vertexIdx+2])??0,g=L.localPositionOverride?L.localPositionOverride[0]:(null===q||void 0===q?void 0:q[L.vertexIdx])??0,F=L.localPositionOverride?L.localPositionOverride[1]:(null===q||void 0===q?void 0:q[L.vertexIdx+1])??0,w=L.localPositionOverride?L.localPositionOverride[2]:(null===q||void 0===q?void 0:q[L.vertexIdx+2])??0,G=e.localNormalOverride?e.localNormalOverride[0]:(null===h||void 0===h?void 0:h[e.vertexIdx])??0,U=e.localNormalOverride?e.localNormalOverride[1]:(null===h||void 0===h?void 0:h[e.vertexIdx+1])??0,D=e.localNormalOverride?e.localNormalOverride[2]:(null===h||void 0===h?void 0:h[e.vertexIdx+2])??0,C=G+((L.localNormalOverride?L.localNormalOverride[0]:(null===h||void 0===h?void 0:h[L.vertexIdx])??0)-G)*B,l=U+((L.localNormalOverride?L.localNormalOverride[1]:(null===h||void 0===h?void 0:h[L.vertexIdx+1])??0)-U)*B,x=D+((L.localNormalOverride?L.localNormalOverride[2]:(null===h||void 0===h?void 0:h[L.vertexIdx+2])??0)-D)*B,i=Math.sqrt(C*C+l*l+x*x);return new s(P.mv.Lerp(e.position,L.position,B),P.mv.Lerp(e.normal,L.normal,B).normalize(),P.Vector2.Lerp(e.uv,L.uv,B),-1,-1,q?[W+(g-W)*B,V+(F-V)*B,k+(w-k)*B]:null,h?[C/i,l/i,x/i]:null,X,z)};let B=null;e.length>3&&(B=[]);for(let X=0;X<e.length;X+=3){let p=0,z=null,W=null,V=null,k=null;const g=P.mv.Dot(e[X].position,d)-v>0,F=P.mv.Dot(e[X+1].position,d)-v>0,w=P.mv.Dot(e[X+2].position,d)-v>0;switch(p=(g?1:0)+(F?1:0)+(w?1:0),p){case 0:e.length>3?(B.push(e[X]),B.push(e[X+1]),B.push(e[X+2])):B=e;break;case 1:if(B=B??new Array,g&&(z=e[X+1],W=e[X+2],V=L(e[X],z),k=L(e[X],W)),F){z=e[X],W=e[X+2],V=L(e[X+1],z),k=L(e[X+1],W),B.push(V),B.push(W.clone()),B.push(z.clone()),B.push(W.clone()),B.push(V.clone()),B.push(k);break}w&&(z=e[X],W=e[X+1],V=L(e[X+2],z),k=L(e[X+2],W)),z&&W&&V&&k&&(B.push(z.clone()),B.push(W.clone()),B.push(V),B.push(k),B.push(V.clone()),B.push(W.clone()));break;case 2:B=B??new Array,g||(z=e[X].clone(),W=L(z,e[X+1]),V=L(z,e[X+2]),B.push(z),B.push(W),B.push(V)),F||(z=e[X+1].clone(),W=L(z,e[X+2]),V=L(z,e[X]),B.push(z),B.push(W),B.push(V)),w||(z=e[X+2].clone(),W=L(z,e[X]),V=L(z,e[X+1]),B.push(z),B.push(W),B.push(V))}}return B},R=d instanceof p.b?d:null,Y=null===R||void 0===R?void 0:R._thinInstanceDataStorage.matrixData,y=(null===R||void 0===R?void 0:R.XL)||1,j=P.TmpVectors.Matrix[0];j.L(P.Matrix.IdentityReadOnly);for(let p=0;p<y;++p){if(null!==R&&void 0!==R&&R.hasThinInstances&&Y){const e=16*p;j.setRowFromFloats(0,Y[e+0],Y[e+1],Y[e+2],Y[e+3]),j.setRowFromFloats(1,Y[e+4],Y[e+5],Y[e+6],Y[e+7]),j.setRowFromFloats(2,Y[e+8],Y[e+9],Y[e+10],Y[e+11]),j.setRowFromFloats(3,Y[e+12],Y[e+13],Y[e+14],Y[e+15])}const e=P.Matrix.RotationYawPitchRoll(T,o,f).multiply(P.Matrix.Translation(me.x,me.y,me.z)),L=P.Matrix.Invert(e),B=d.getWorldMatrix(),z=j.multiply(B).multiply(L),W=new Array(3);for(let d=0;d<U.length;d+=3){let e=W;if(e[0]=N(d,z),e[1]=N(d+1,z),e[2]=N(d+2,z),!(v.cullBackFaces&&-e[0].normal.z<=0&&-e[1].normal.z<=0&&-e[2].normal.z<=0)&&(e=O(e,a),e&&(e=O(e,t),e&&(e=O(e,I),e&&(e=O(e,c),e&&(e=O(e,b),e&&(e=O(e,M),e)))))))for(let d=0;d<e.length;d++){const P=e[d];if(K.indices.push(Q),G?(P.localPositionOverride?(K.ie[3*Q]=P.localPositionOverride[0],K.ie[3*Q+1]=P.localPositionOverride[1],K.ie[3*Q+2]=P.localPositionOverride[2]):q&&(K.ie[3*Q]=q[P.vertexIdx],K.ie[3*Q+1]=q[P.vertexIdx+1],K.ie[3*Q+2]=q[P.vertexIdx+2]),P.localNormalOverride?(K.md[3*Q]=P.localNormalOverride[0],K.md[3*Q+1]=P.localNormalOverride[1],K.md[3*Q+2]=P.localNormalOverride[2]):h&&(K.md[3*Q]=h[P.vertexIdx],K.md[3*Q+1]=h[P.vertexIdx+1],K.md[3*Q+2]=h[P.vertexIdx+2])):(P.position.toArray(K.ie,3*Q),P.normal.toArray(K.md,3*Q)),K.matricesIndices&&K.matricesWeights&&(P.matrixIndicesOverride?(K.matricesIndices[4*Q]=P.matrixIndicesOverride[0],K.matricesIndices[4*Q+1]=P.matrixIndicesOverride[1],K.matricesIndices[4*Q+2]=P.matrixIndicesOverride[2],K.matricesIndices[4*Q+3]=P.matrixIndicesOverride[3]):(n&&(K.matricesIndices[4*Q]=n[P.vertexIdxForBones],K.matricesIndices[4*Q+1]=n[P.vertexIdxForBones+1],K.matricesIndices[4*Q+2]=n[P.vertexIdxForBones+2],K.matricesIndices[4*Q+3]=n[P.vertexIdxForBones+3]),x&&K.matricesIndicesExtra&&(K.matricesIndicesExtra[4*Q]=x[P.vertexIdxForBones],K.matricesIndicesExtra[4*Q+1]=x[P.vertexIdxForBones+1],K.matricesIndicesExtra[4*Q+2]=x[P.vertexIdxForBones+2],K.matricesIndicesExtra[4*Q+3]=x[P.vertexIdxForBones+3])),P.matrixWeightsOverride?(K.matricesWeights[4*Q]=P.matrixWeightsOverride[0],K.matricesWeights[4*Q+1]=P.matrixWeightsOverride[1],K.matricesWeights[4*Q+2]=P.matrixWeightsOverride[2],K.matricesWeights[4*Q+3]=P.matrixWeightsOverride[3]):(A&&(K.matricesWeights[4*Q]=A[P.vertexIdxForBones],K.matricesWeights[4*Q+1]=A[P.vertexIdxForBones+1],K.matricesWeights[4*Q+2]=A[P.vertexIdxForBones+2],K.matricesWeights[4*Q+3]=A[P.vertexIdxForBones+3]),i&&K.matricesWeightsExtra&&(K.matricesWeightsExtra[4*Q]=i[P.vertexIdxForBones],K.matricesWeightsExtra[4*Q+1]=i[P.vertexIdxForBones+1],K.matricesWeightsExtra[4*Q+2]=i[P.vertexIdxForBones+2],K.matricesWeightsExtra[4*Q+3]=i[P.vertexIdxForBones+3]))),v.captureUVS)P.uv.toArray(K.Ze,2*Q);else{K.Ze.push(.5+P.position.x/Z.x);const e=.5+P.position.y/Z.y;K.Ze.push(X.c?1-e:e)}Q++}}}0===K.indices.length&&(K.indices=null),0===K.ie.length&&(K.ie=null),0===K.md.length&&(K.md=null),0===K.Ze.length&&(K.Ze=null),0===(null===(W=K.matricesIndices)||void 0===W?void 0:W.length)&&(K.matricesIndices=null),0===(null===(V=K.matricesWeights)||void 0===V?void 0:V.length)&&(K.matricesWeights=null),0===(null===(k=K.matricesIndicesExtra)||void 0===k?void 0:k.length)&&(K.matricesIndicesExtra=null),0===(null===(g=K.matricesWeightsExtra)||void 0===g?void 0:g.length)&&(K.matricesWeightsExtra=null);const J=new p.b(e,d.Ae());return K.Te(J),G?(J.skeleton=d.skeleton,J.parent=d):(J.position=me.clone(),J.rotation=new P.mv(o,T,f)),J.Md(!0),J.refreshBoundingInfo(!0,!0),J}function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const d=0|Math.max(e.subdivisions?e.subdivisions:2,1),v=0|Math.max(e.tessellation?e.tessellation:16,3),p=Math.max(e.height?e.height:1,0),L=Math.max(e.radius?e.radius:.25,0),z=0|Math.max(e.capSubdivisions?e.capSubdivisions:6,1),W=v,V=d,k=Math.max(e.radiusTop?e.radiusTop:L,0),g=Math.max(e.radiusBottom?e.radiusBottom:L,0),F=p-(k+g),w=2*Math.PI,G=Math.max(e.topCapSubdivisions?e.topCapSubdivisions:z,1),U=Math.max(e.bottomCapSubdivisions?e.bottomCapSubdivisions:z,1),D=Math.acos((g-k)/p);let C=[];const q=[],h=[],l=[];let n=0;const A=[],x=.5*F,i=.5*Math.PI;let me,r;const Z=P.mv.Zero(),f=P.mv.Zero(),T=Math.cos(D),S=Math.sin(D),o=new P.Vector2(k*S,x+k*T).Zd(new P.Vector2(g*S,g*T-x)).length(),K=k*D+o+g*(i-D);let Q=0;for(r=0;r<=G;r++){const e=[],d=i-D*(r/G);Q+=k*D/G;const v=Math.cos(d),P=Math.sin(d),p=v*k;for(me=0;me<=W;me++){const d=me/W,L=d*w+0,B=Math.sin(L),z=Math.cos(L);f.x=p*B,f.y=x+P*k,f.z=p*z,q.push(f.x,f.y,f.z),Z.set(v*B,P,v*z),h.push(Z.x,Z.y,Z.z),l.push(d,X.c?Q/K:1-Q/K),e.push(n),n++}A.push(e)}const N=p-k-g+T*k-T*g,u=S*(g-k)/N;for(r=1;r<=V;r++){const e=[];Q+=o/V;const d=S*(r*(g-k)/V+k);for(me=0;me<=W;me++){const v=me/W,P=v*w+0,p=Math.sin(P),L=Math.cos(P);f.x=d*p,f.y=x+T*k-r*N/V,f.z=d*L,q.push(f.x,f.y,f.z),Z.set(p,u,L).normalize(),h.push(Z.x,Z.y,Z.z),l.push(v,X.c?Q/K:1-Q/K),e.push(n),n++}A.push(e)}for(r=1;r<=U;r++){const e=[],d=i-D-(Math.PI-D)*(r/U);Q+=g*D/U;const v=Math.cos(d),P=Math.sin(d),p=v*g;for(me=0;me<=W;me++){const d=me/W,L=d*w+0,B=Math.sin(L),z=Math.cos(L);f.x=p*B,f.y=P*g-x,f.z=p*z,q.push(f.x,f.y,f.z),Z.set(v*B,P,v*z),h.push(Z.x,Z.y,Z.z),l.push(d,X.c?Q/K:1-Q/K),e.push(n),n++}A.push(e)}for(me=0;me<W;me++)for(r=0;r<G+V+U;r++){const e=A[r][me],d=A[r+1][me],v=A[r+1][me+1],P=A[r][me+1];C.push(e),C.push(d),C.push(P),C.push(d),C.push(v),C.push(P)}if(C=C.reverse(),e.orientation&&!e.orientation.equals(P.mv.Up())){const d=new P.Matrix;e.orientation.clone().scale(.5*Math.PI).cross(P.mv.Up()).toQuaternion().toRotationMatrix(d);const v=P.mv.Zero();for(let e=0;e<q.length;e+=3)v.set(q[e],q[e+1],q[e+2]),P.mv.TransformCoordinatesToRef(v.clone(),d,v),q[e]=v.x,q[e+1]=v.y,q[e+2]=v.z}const O=new B.d;return O.ie=q,O.md=h,O.Ze=l,O.indices=C,O}function J(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:P.mv.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new p.b(e,v);return j(d).Te(L,d.updatable),L}p.b.CreateDecal=(e,d,v,P,p,L)=>y(e,d,{position:v,normal:P,size:p,angle:L});p.b.CreateCapsule=(e,d,v)=>J(e,d,v),B.d.CreateCapsule=j;var E=v(12253),ee=v(12429);class de{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=e,this.y=d,e!==Math.floor(e)&&(e=Math.floor(e),E.c.Warn("x is not an integer, floor(x) used")),d!==Math.floor(d)&&(d=Math.floor(d),E.c.Warn("y is not an integer, floor(y) used"))}clone(){return new de(this.x,this.y)}rotate60About(e){const d=this.x;return this.x=e.x+e.y-this.y,this.y=d+this.y-e.x,this}rotateNeg60About(e){const d=this.x;return this.x=d+this.y-e.y,this.y=e.x+e.y-d,this}rotate120(e,d){e!==Math.floor(e)&&(e=Math.floor(e),E.c.Warn("m not an integer only floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),E.c.Warn("n not an integer only floor(n) used"));const v=this.x;return this.x=e-v-this.y,this.y=d+v,this}rotateNeg120(e,d){e!==Math.floor(e)&&(e=Math.floor(e),E.c.Warn("m is not an integer, floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),E.c.Warn("n is not an integer,   floor(n) used"));const v=this.x;return this.x=this.y-d,this.y=e+d-v-this.y,this}toCartesianOrigin(e,d){const v=P.mv.Zero();return v.x=e.x+2*this.x*d+this.y*d,v.y=e.y+Math.sqrt(3)*this.y*d,v}static Zero(){return new de(0,0)}}class ve{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Pe("icosahedron","Regular",[[0,ee.i,-1],[-ee.i,1,0],[-1,0,-ee.i],[1,0,-ee.i],[ee.i,1,0],[0,ee.i,1],[-1,0,ee.i],[-ee.i,-1,0],[0,-ee.i,-1],[ee.i,-1,0],[1,0,ee.i],[0,-ee.i,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let e=12;const d={},v=this.m,P=this.n;let p,L,B,X,z,W=v,V=1,k=0;0!==P&&(W=(0,H.HighestCommonFactor)(v,P)),V=v/W,k=P/W;const g=de.Zero(),F=new de(v,P),w=new de(-P,v+P),G=de.Zero(),U=de.Zero(),D=de.Zero();let C,q,h,l,n=[];const A=[],x=this.vertByDist,i=(v,P,p,L)=>{C=v+"|"+p,q=P+"|"+L,C in d||q in d?C in d&&!(q in d)?d[q]=d[C]:q in d&&!(C in d)&&(d[C]=d[q]):(d[C]=e,d[q]=e,e++),x[p][0]>2?A[d[C]]=[-x[p][0],x[p][1],d[C]]:A[d[C]]=[n[x[p][0]],x[p][1],d[C]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let me=0;me<20;me++){if(n=this.IDATA.face[me],B=n[2],X=n[1],z=n[0],h=g.x+"|"+g.y,C=me+"|"+h,C in d||(d[C]=B,A[B]=[n[x[h][0]],x[h][1]]),h=F.x+"|"+F.y,C=me+"|"+h,C in d||(d[C]=X,A[X]=[n[x[h][0]],x[h][1]]),h=w.x+"|"+w.y,C=me+"|"+h,C in d||(d[C]=z,A[z]=[n[x[h][0]],x[h][1]]),p=this.IDATA.edgematch[me][0],L=this.IDATA.edgematch[me][1],"B"===L)for(let e=1;e<W;e++)U.x=v-e*(V+k),U.y=P+e*V,D.x=-e*k,D.y=e*(V+k),h=U.x+"|"+U.y,l=D.x+"|"+D.y,i(me,p,h,l);if("O"===L)for(let e=1;e<W;e++)D.x=-e*k,D.y=e*(V+k),G.x=e*V,G.y=e*k,h=D.x+"|"+D.y,l=G.x+"|"+G.y,i(me,p,h,l);if(p=this.IDATA.edgematch[me][2],L=this.IDATA.edgematch[me][3],L&&"A"===L)for(let e=1;e<W;e++)G.x=e*V,G.y=e*k,U.x=v-(W-e)*(V+k),U.y=P+(W-e)*V,h=G.x+"|"+G.y,l=U.x+"|"+U.y,i(me,p,h,l);for(let v=0;v<this.vertices.length;v++)h=this.vertices[v].x+"|"+this.vertices[v].y,C=me+"|"+h,C in d||(d[C]=e++,x[h][0]>2?A[d[C]]=[-x[h][0],x[h][1],d[C]]:A[d[C]]=[n[x[h][0]],x[h][1],d[C]])}this.closestTo=A,this.vecToidx=d}calcCoeffs(){const e=this.m,d=this.n,v=Math.sqrt(3)/3,P=e*e+d*d+e*d;this.coau=(e+d)/P,this.cobu=-d/P,this.coav=-v*(e-d)/P,this.cobv=v*(2*e+d)/P}createInnerFacets(){const e=this.m,d=this.n;for(let v=0;v<d+e+1;v++)for(let e=this.min[v];e<this.max[v]+1;e++)e<this.max[v]&&e<this.max[v+1]+1&&this.innerFacets.push(["|"+e+"|"+v,"|"+e+"|"+(v+1),"|"+(e+1)+"|"+v]),v>0&&e<this.max[v-1]&&e+1<this.max[v]+1&&this.innerFacets.push(["|"+e+"|"+v,"|"+(e+1)+"|"+v,"|"+(e+1)+"|"+(v-1)])}edgeVecsABOB(){const e=this.m,d=this.n,v=new de(-d,e+d);for(let P=1;P<e+d;P++){const e=new de(this.min[P],P),d=new de(this.min[P-1],P-1),p=new de(this.min[P+1],P+1),L=e.clone(),B=d.clone(),X=p.clone();L.rotate60About(v),B.rotate60About(v),X.rotate60About(v);const z=new de(this.max[L.y],L.y),W=new de(this.max[L.y-1],L.y-1),V=new de(this.max[L.y-1]-1,L.y-1);L.x===z.x&&L.y===z.y||(L.x!==W.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,W,V]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,V,z])):L.y===X.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,d,W]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([e,W,p])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([e,d,W]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([e,W,z])))}}mapABOBtoOBOA(){const e=new de(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const v=[];for(let P=0;P<3;P++)e.x=this.isoVecsABOB[d][P].x,e.y=this.isoVecsABOB[d][P].y,0===this.vertexTypes[d][P]&&e.rotateNeg120(this.m,this.n),v.push(e.clone());this.isoVecsOBOA.push(v)}}mapABOBtoBAOA(){const e=new de(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const v=[];for(let P=0;P<3;P++)e.x=this.isoVecsABOB[d][P].x,e.y=this.isoVecsABOB[d][P].y,1===this.vertexTypes[d][P]&&e.rotate120(this.m,this.n),v.push(e.clone());this.isoVecsBAOA.push(v)}}MapToFace(e,d){const v=this.IDATA.face[e],p=v[2],L=v[1],B=v[0],X=P.mv.Nd(this.IDATA.vertex[p]),z=P.mv.Nd(this.IDATA.vertex[L]),W=P.mv.Nd(this.IDATA.vertex[B]),V=z.Zd(X),k=W.Zd(X),g=V.scale(this.coau).add(k.scale(this.cobu)),F=V.scale(this.coav).add(k.scale(this.cobv)),w=[];let G,U=P.TmpVectors.mv[0];for(let P=0;P<this.cartesian.length;P++)U=g.scale(this.cartesian[P].x).add(F.scale(this.cartesian[P].y)).add(X),w[P]=[U.x,U.y,U.z],G=e+"|"+this.vertices[P].x+"|"+this.vertices[P].y,d.vertex[this.vecToidx[G]]=[U.x,U.y,U.z]}build(e,d){const v=[],P=de.Zero(),p=new de(e,d),L=new de(-d,e+d);v.push(P,p,L);for(let h=d;h<e+1;h++)for(let d=0;d<e+1-h;d++)v.push(new de(d,h));if(d>0){const P=(0,H.HighestCommonFactor)(e,d),p=e/P,L=d/P;for(let X=1;X<P;X++)v.push(new de(X*p,X*L)),v.push(new de(-X*L,X*(p+L))),v.push(new de(e-X*(p+L),d+X*p));const B=e/d;for(let X=1;X<d;X++)for(let P=0;P<X*B;P++)v.push(new de(P,X)),v.push(new de(P,X).rotate120(e,d)),v.push(new de(P,X).rotateNeg120(e,d))}v.sort(((e,d)=>e.x-d.x)),v.sort(((e,d)=>e.y-d.y));const B=new Array(e+d+1),X=new Array(e+d+1);for(let h=0;h<B.length;h++)B[h]=1/0,X[h]=-1/0;let z=0,W=0;const V=v.length;for(let h=0;h<V;h++)W=v[h].x,z=v[h].y,B[z]=Math.min(W,B[z]),X[z]=Math.max(W,X[z]);const k=(v,P)=>{const p=v.clone();return"A"===P&&p.rotateNeg120(e,d),"B"===P&&p.rotate120(e,d),p.x<0?p.y:p.x+p.y},g=[],F=[],w=[],G=[],U={},D=[];let C=-1,q=-1;for(let h=0;h<V;h++)g[h]=v[h].toCartesianOrigin(new de(0,0),.5),F[h]=k(v[h],"O"),w[h]=k(v[h],"A"),G[h]=k(v[h],"B"),F[h]===w[h]&&w[h]===G[h]?(C=3,q=F[h]):F[h]===w[h]?(C=4,q=F[h]):w[h]===G[h]?(C=5,q=w[h]):G[h]===F[h]&&(C=6,q=F[h]),F[h]<w[h]&&F[h]<G[h]&&(C=2,q=F[h]),w[h]<F[h]&&w[h]<G[h]&&(C=1,q=w[h]),G[h]<w[h]&&G[h]<F[h]&&(C=0,q=G[h]),D.push([C,q,v[h].x,v[h].y]);D.sort(((e,d)=>e[2]-d[2])),D.sort(((e,d)=>e[3]-d[3])),D.sort(((e,d)=>e[1]-d[1])),D.sort(((e,d)=>e[0]-d[0]));for(let h=0;h<D.length;h++)U[D[h][2]+"|"+D[h][3]]=[D[h][0],D[h][1],h];return this.m=e,this.n=d,this.vertices=v,this.vertByDist=U,this.cartesian=g,this.min=B,this.max=X,this}}class Pe{constructor(e,d,v,P){this.name=e,this.category=d,this.vertex=v,this.face=P}}class pe extends Pe{innerToData(e,d){for(let v=0;v<d.innerFacets.length;v++)this.face.push(d.innerFacets[v].map((v=>d.vecToidx[e+v])))}mapABOBtoDATA(e,d){const v=d.IDATA.edgematch[e][0];for(let P=0;P<d.isoVecsABOB.length;P++){const p=[];for(let L=0;L<3;L++)0===d.vertexTypes[P][L]?p.push(e+"|"+d.isoVecsABOB[P][L].x+"|"+d.isoVecsABOB[P][L].y):p.push(v+"|"+d.isoVecsABOB[P][L].x+"|"+d.isoVecsABOB[P][L].y);this.face.push([d.vecToidx[p[0]],d.vecToidx[p[1]],d.vecToidx[p[2]]])}}mapOBOAtoDATA(e,d){const v=d.IDATA.edgematch[e][0];for(let P=0;P<d.isoVecsOBOA.length;P++){const p=[];for(let L=0;L<3;L++)1===d.vertexTypes[P][L]?p.push(e+"|"+d.isoVecsOBOA[P][L].x+"|"+d.isoVecsOBOA[P][L].y):p.push(v+"|"+d.isoVecsOBOA[P][L].x+"|"+d.isoVecsOBOA[P][L].y);this.face.push([d.vecToidx[p[0]],d.vecToidx[p[1]],d.vecToidx[p[2]]])}}mapBAOAtoDATA(e,d){const v=d.IDATA.edgematch[e][2];for(let P=0;P<d.isoVecsBAOA.length;P++){const p=[];for(let L=0;L<3;L++)1===d.vertexTypes[P][L]?p.push(e+"|"+d.isoVecsBAOA[P][L].x+"|"+d.isoVecsBAOA[P][L].y):p.push(v+"|"+d.isoVecsBAOA[P][L].x+"|"+d.isoVecsBAOA[P][L].y);this.face.push([d.vecToidx[p[0]],d.vecToidx[p[1]],d.vecToidx[p[2]]])}}orderData(e){const d=[];for(let L=0;L<13;L++)d[L]=[];const v=e.closestTo;for(let L=0;L<v.length;L++)v[L][0]>-1?v[L][1]>0&&d[v[L][0]].push([L,v[L][1]]):d[12].push([L,v[L][0]]);const P=[];for(let L=0;L<12;L++)P[L]=L;let p=12;for(let L=0;L<12;L++){d[L].sort(((e,d)=>e[1]-d[1]));for(let e=0;e<d[L].length;e++)P[d[L][e][0]]=p++}for(let L=0;L<d[12].length;L++)P[d[12][L][0]]=p++;for(let L=0;L<this.vertex.length;L++)this.vertex[L].push(P[L]);this.vertex.sort(((e,d)=>e[3]-d[3]));for(let L=0;L<this.vertex.length;L++)this.vertex[L].pop();for(let L=0;L<this.face.length;L++)for(let e=0;e<this.face[L].length;e++)this.face[L][e]=P[this.face[L][e]];this.sharedNodes=d[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(e,d){const v=[],P=[];let p=d.pop();P.push(p);let L=this.face[p].indexOf(e);L=(L+2)%3;let B=this.face[p][L];v.push(B);let X=0;for(;d.length>0;)p=d[X],this.face[p].indexOf(B)>-1?(L=(this.face[p].indexOf(B)+1)%3,B=this.face[p][L],v.push(B),P.push(p),d.splice(X,1),X=0):X++;return this.adjacentFaces.push(v),P}toGoldbergPolyhedronData(){const e=new Pe("GeoDual","Goldberg",[],[]);e.name="GD dual";const d=this.vertex.length,v=new Array(d);for(let z=0;z<d;z++)v[z]=[];for(let z=0;z<this.face.length;z++)for(let e=0;e<3;e++)v[this.face[z][e]].push(z);let P=0,p=0,L=0,B=[],X=[];this.adjacentFaces=[];for(let z=0;z<v.length;z++){e.face[z]=this.setOrder(z,v[z].concat([]));for(const d of v[z]){P=0,p=0,L=0,B=this.face[d];for(let e=0;e<3;e++)X=this.vertex[B[e]],P+=X[0],p+=X[1],L+=X[2];e.vertex[d]=[P/3,p/3,L/3]}}return e}static BuildGeodesicData(e){const d=new pe("Geodesic-m-n","Geodesic",[[0,ee.i,-1],[-ee.i,1,0],[-1,0,-ee.i],[1,0,-ee.i],[ee.i,1,0],[0,ee.i,1],[-1,0,ee.i],[-ee.i,-1,0],[0,-ee.i,-1],[ee.i,-1,0],[1,0,ee.i],[0,-ee.i,1]],[]);e.setIndices(),e.calcCoeffs(),e.createInnerFacets(),e.edgeVecsABOB(),e.mapABOBtoOBOA(),e.mapABOBtoBAOA();for(let v=0;v<e.IDATA.face.length;v++)e.MapToFace(v,d),d.innerToData(v,e),"B"===e.IDATA.edgematch[v][1]&&d.mapABOBtoDATA(v,e),"O"===e.IDATA.edgematch[v][1]&&d.mapOBOAtoDATA(v,e),"A"===e.IDATA.edgematch[v][3]&&d.mapBAOAtoDATA(v,e);d.orderData(e);return d.vertex=d.vertex.map((function(e){const d=e[0],v=e[1],P=e[2],p=Math.sqrt(d*d+v*v+P*P);return e[0]*=1/p,e[1]*=1/p,e[2]*=1/p,e})),d}}p.b._GoldbergMeshParser=(e,d)=>Le.Parse(e,d);class Le extends p.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(e,d){return void 0===d?(e>this.goldbergData.nbUnsharedFaces-1&&(E.c.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(E.c.Warn("Last pole used"),e=11),d>this.goldbergData.nbFacesAtPole-1&&(E.c.Warn("Maximum number of faces at a pole used"),d=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+d)}_changeGoldbergFaceColors(e){for(let v=0;v<e.length;v++){const d=e[v][0],P=e[v][1],p=e[v][2];for(let e=d;e<P+1;e++)this.goldbergData.faceColors[e]=p}const d=[];for(let v=0;v<12;v++)for(let e=0;e<5;e++)d.push(this.goldbergData.faceColors[v].r,this.goldbergData.faceColors[v].g,this.goldbergData.faceColors[v].b,this.goldbergData.faceColors[v].a);for(let v=12;v<this.goldbergData.faceColors.length;v++)for(let e=0;e<6;e++)d.push(this.goldbergData.faceColors[v].r,this.goldbergData.faceColors[v].g,this.goldbergData.faceColors[v].b,this.goldbergData.faceColors[v].a);return d}setGoldbergFaceColors(e){const d=this._changeGoldbergFaceColors(e);this.Qe(L.i.ColorKind,d)}updateGoldbergFaceColors(e){const d=this._changeGoldbergFaceColors(e);this.updateVerticesData(L.i.ColorKind,d)}_changeGoldbergFaceUVs(e){const d=this.getVerticesData(L.i.UVKind);for(let v=0;v<e.length;v++){const P=e[v][0],p=e[v][1],L=e[v][2],B=e[v][3],X=e[v][4],z=[],W=[];let V,k;for(let e=0;e<5;e++)V=L.x+B*Math.cos(X+e*Math.PI/2.5),k=L.y+B*Math.sin(X+e*Math.PI/2.5),V<0&&(V=0),V>1&&(V=1),z.push(V,k);for(let e=0;e<6;e++)V=L.x+B*Math.cos(X+e*Math.PI/3),k=L.y+B*Math.sin(X+e*Math.PI/3),V<0&&(V=0),V>1&&(V=1),W.push(V,k);for(let e=P;e<Math.min(12,p+1);e++)for(let v=0;v<5;v++)d[10*e+2*v]=z[2*v],d[10*e+2*v+1]=z[2*v+1];for(let e=Math.max(12,P);e<p+1;e++)for(let v=0;v<6;v++)d[12*e-24+2*v]=W[2*v],d[12*e-23+2*v]=W[2*v+1]}return d}setGoldbergFaceUVs(e){const d=this._changeGoldbergFaceUVs(e);this.Qe(L.i.UVKind,d)}updateGoldbergFaceUVs(e){const d=this._changeGoldbergFaceUVs(e);this.updateVerticesData(L.i.UVKind,d)}placeOnGoldbergFaceAt(e,d,v){const p=P.mv.RotationFromAxis(this.goldbergData.faceXaxis[d],this.goldbergData.faceYaxis[d],this.goldbergData.faceZaxis[d]);e.rotation=p,e.position=this.goldbergData.faceCenters[d].add(this.goldbergData.faceXaxis[d].scale(v.x)).add(this.goldbergData.faceYaxis[d].scale(v.y)).add(this.goldbergData.faceZaxis[d].scale(v.z))}serialize(e){super.serialize(e),e.type="GoldbergMesh";const d={};if(d.adjacentFaces=this.goldbergData.adjacentFaces,d.nbSharedFaces=this.goldbergData.nbSharedFaces,d.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,d.nbFaces=this.goldbergData.nbFaces,d.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){d.faceColors=[];for(const e of this.goldbergData.faceColors)d.faceColors.push(e.Yd())}if(this.goldbergData.faceCenters){d.faceCenters=[];for(const e of this.goldbergData.faceCenters)d.faceCenters.push(e.Yd())}if(this.goldbergData.faceZaxis){d.faceZaxis=[];for(const e of this.goldbergData.faceZaxis)d.faceZaxis.push(e.Yd())}if(this.goldbergData.faceYaxis){d.faceYaxis=[];for(const e of this.goldbergData.faceYaxis)d.faceYaxis.push(e.Yd())}if(this.goldbergData.faceXaxis){d.faceXaxis=[];for(const e of this.goldbergData.faceXaxis)d.faceXaxis.push(e.Yd())}e.goldbergData=d}static Parse(e,d){const v=e.goldbergData;v.faceColors=v.faceColors.map((e=>g.Up.Nd(e))),v.faceCenters=v.faceCenters.map((e=>P.mv.Nd(e))),v.faceZaxis=v.faceZaxis.map((e=>P.mv.Nd(e))),v.faceXaxis=v.faceXaxis.map((e=>P.mv.Nd(e))),v.faceYaxis=v.faceYaxis.map((e=>P.mv.Nd(e)));const p=new Le(e.name,d);return p.goldbergData=v,p}}var Be=v(12970);const Xe={CreateBox:k.b,CreateTiledBox:U,CreateSphere:D.b,CreateDisc:V.d,CreateIcoSphere:Y,CreateRibbon:W,CreateCylinder:l,CreateTorus:A,CreateTorusKnot:i,CreateLineSystem:me.f,GW:me.g,CreateDashedLines:me.d,ExtrudeShape:f,ExtrudeShapeCustom:T,CreateLathe:o,CreateTiledPlane:w,qW:K.d,CreateGround:Q.e,CreateTiledGround:Q.h,CreateGroundFromHeightMap:Q.c,CreatePolygon:r.c,ExtrudePolygon:r.g,CreateTube:N,CreatePolyhedron:O,CreateGeodesic:function(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=d.m||1;P!==Math.floor(P)&&(P=Math.floor(P),E.c.Warn("m not an integer only floor(m) used"));let p=d.n||0;if(p!==Math.floor(p)&&(p=Math.floor(p),E.c.Warn("n not an integer only floor(n) used")),p>P){const e=p;p=P,P=e,E.c.Warn("n > m therefore m and n swapped")}const L=new ve;return L.build(P,p),O(e,{custom:pe.BuildGeodesicData(L),size:d.size,sizeX:d.sizeX,sizeY:d.sizeY,sizeZ:d.sizeZ,faceUV:d.faceUV,faceColors:d.faceColors,flat:d.flat,updatable:d.updatable,sideOrientation:d.sideOrientation,frontUVs:d.frontUVs,backUVs:d.backUVs},v)},CreateGoldberg:function(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=d.size,z=d.sizeX||L||1,W=d.sizeY||L||1,V=d.sizeZ||L||1;let k=d.m||1;k!==Math.floor(k)&&(k=Math.floor(k),E.c.Warn("m not an integer only floor(m) used"));let F=d.n||0;if(F!==Math.floor(F)&&(F=Math.floor(F),E.c.Warn("n not an integer only floor(n) used")),F>k){const e=F;F=k,k=e,E.c.Warn("n > m therefore m and n swapped")}const w=new ve;w.build(k,F);const G=pe.BuildGeodesicData(w),U=G.toGoldbergPolyhedronData(),D=new Le(e,v);d.sideOrientation=p.b._GetDefaultSideOrientation(d.sideOrientation),D._originalBuilderSideOrientation=d.sideOrientation;(function(e,d){const v=e.size,p=e.sizeX||v||1,L=e.sizeY||v||1,z=e.sizeZ||v||1,W=0===e.sideOrientation?0:e.sideOrientation||B.d.DEFAULTSIDE,V=[],k=[],g=[],F=[];let w=1/0,G=-1/0,U=1/0,D=-1/0;for(let P=0;P<d.vertex.length;P++)w=Math.min(w,d.vertex[P][0]*p),G=Math.max(G,d.vertex[P][0]*p),U=Math.min(U,d.vertex[P][1]*L),D=Math.max(D,d.vertex[P][1]*L);let C=0;for(let B=0;B<d.face.length;B++){const e=d.face[B],v=P.mv.Nd(d.vertex[e[0]]),W=P.mv.Nd(d.vertex[e[2]]),q=P.mv.Nd(d.vertex[e[1]]),h=W.Zd(v),l=q.Zd(v),n=P.mv.Cross(l,h).normalize();for(let P=0;P<e.length;P++){g.push(n.x,n.y,n.z);const v=d.vertex[e[P]];V.push(v[0]*p,v[1]*L,v[2]*z);const B=(v[1]*L-U)/(D-U);F.push((v[0]*p-w)/(G-w),X.c?1-B:B)}for(let d=0;d<e.length-2;d++)k.push(C,C+d+2,C+d+1);C+=e.length}B.d._ComputeSides(W,V,k,g,F);const q=new B.d;return q.ie=V,q.indices=k,q.md=g,q.Ze=F,q})(d,U).Te(D,d.updatable),D.goldbergData.nbSharedFaces=G.sharedNodes,D.goldbergData.nbUnsharedFaces=G.poleNodes,D.goldbergData.adjacentFaces=G.adjacentFaces,D.goldbergData.nbFaces=D.goldbergData.nbSharedFaces+D.goldbergData.nbUnsharedFaces,D.goldbergData.nbFacesAtPole=(D.goldbergData.nbUnsharedFaces-12)/12;for(let p=0;p<G.vertex.length;p++)D.goldbergData.faceCenters.push(P.mv.Nd(G.vertex[p])),D.goldbergData.faceCenters[p].x*=z,D.goldbergData.faceCenters[p].y*=W,D.goldbergData.faceCenters[p].z*=V,D.goldbergData.faceColors.push(new g.Up(1,1,1,1));for(let p=0;p<U.face.length;p++){const e=U.face[p],d=P.mv.Nd(U.vertex[e[0]]),v=P.mv.Nd(U.vertex[e[2]]),L=P.mv.Nd(U.vertex[e[1]]),B=v.Zd(d),X=L.Zd(d),z=P.mv.Cross(X,B).normalize(),W=P.mv.Cross(X,z).normalize();D.goldbergData.faceXaxis.push(X.normalize()),D.goldbergData.faceYaxis.push(z),D.goldbergData.faceZaxis.push(W)}return D},CreateDecal:y,CreateCapsule:J,CreateText:Be.d}},13763:(e,d,v)=>{"use strict";v.d(d,{d:()=>Xd});var P=v(12420),p=v(12795);class L extends p.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var B=v(12463),X=(v(12586),v(12381));class z{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(e){this._targetStopDuration!==e&&(this._targetStopDuration=e)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(e){this._noiseTexture!==e&&(this._noiseTexture=e,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(e){this._animationSheetEnabled!==e&&(this._animationSheetEnabled=e)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(e){this._isAnimationSheetEnabled!=e&&(this._isAnimationSheetEnabled=e,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){this._useLogarithmicDepth=e&&this.Ae().getEngine().getCaps().fragmentDepthSupported}Ae(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(e){switch(e){case z.BLENDMODE_MULTIPLYADD:return;case z.BLENDMODE_ADD:e=1;break;case z.BLENDMODE_ONEONE:e=6;break;case z.BLENDMODE_STANDARD:e=2;break;case z.BLENDMODE_MULTIPLY:e=4;break;case z.BLENDMODE_SUBTRACT:e=3}this._engine.setAlphaMode(e)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:P.mv.Zero()}set direction1(e){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=e)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:P.mv.Zero()}set direction2(e){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=e)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:P.mv.Zero()}set minEmitBox(e){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=e)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:P.mv.Zero()}set maxEmitBox(e){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=e)}get billboardMode(){return this._billboardMode}set billboardMode(e){this._billboardMode!==e&&(this._billboardMode=e,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(e){this._isBillboardBased!==e&&(this._isBillboardBased=e,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e)}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(!e&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=e)}_reset(){}_removeGradientAndTexture(e,d,v){if(!d)return this;let P=0;for(const p of d){if(p.gradient===e){d.splice(P,1);break}P++}return v&&v.dispose(),this}constructor(e){this.animations=[],this.renderingGroupId=0,this.Pd=P.mv.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new P.mv(10,10,10),this.onAnimationEnd=null,this.blendMode=z.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new P.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.gW=new P.mv(0,0,0),this._useLogarithmicDepth=!1,this.gravity=P.mv.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new B.Up(1,1,1,1),this.color2=new B.Up(1,1,1,1),this.colorDead=new B.Up(0,0,0,1),this.textureMask=new B.Up(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new L,this.id=e,this.name=e}createPointEmitter(e,d){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new P.mv(0,1,0),arguments.length>2&&void 0!==arguments[2]||new P.mv(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new P.mv(0,1,0),arguments.length>4&&void 0!==arguments[4]||new P.mv(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new P.mv(0,1,0),arguments.length>3&&void 0!==arguments[3]||new P.mv(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(e,d,v,P){throw new Error("Method not implemented.")}}z.BLENDMODE_ONEONE=0,z.BLENDMODE_STANDARD=1,z.BLENDMODE_ADD=2,z.BLENDMODE_MULTIPLY=3,z.BLENDMODE_MULTIPLYADD=4,z.BLENDMODE_SUBTRACT=-1,(0,X.h)("BABYLON.BaseParticleSystem",z);var W=v(12440),V=v(12262);class k{constructor(){this.direction1=new P.mv(0,1,0),this.direction2=new P.mv(0,1,0),this.minEmitBox=new P.mv(-.5,-.5,-.5),this.maxEmitBox=new P.mv(.5,.5,.5)}startDirectionFunction(e,d,v,p){const L=(0,W.RandomRange)(this.direction1.x,this.direction2.x),B=(0,W.RandomRange)(this.direction1.y,this.direction2.y),X=(0,W.RandomRange)(this.direction1.z,this.direction2.z);if(p)return d.x=L,d.y=B,void(d.z=X);P.mv.TransformNormalFromFloatsToRef(L,B,X,e,d)}startPositionFunction(e,d,v,p){const L=(0,W.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),B=(0,W.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),X=(0,W.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(p)return d.x=L,d.y=B,void(d.z=X);P.mv.TransformCoordinatesFromFloatsToRef(L,B,X,e,d)}clone(){const e=new k;return V.e.DeepCopy(this,e),e}applyToShader(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2),e.setVector3("minEmitBox",this.minEmitBox),e.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(e){e.addUniform("direction1",3),e.addUniform("direction2",3),e.addUniform("minEmitBox",3),e.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.direction1=this.direction1.Yd(),e.direction2=this.direction2.Yd(),e.minEmitBox=this.minEmitBox.Yd(),e.maxEmitBox=this.maxEmitBox.Yd(),e}parse(e){P.mv.FromArrayToRef(e.direction1,0,this.direction1),P.mv.FromArrayToRef(e.direction2,0,this.direction2),P.mv.FromArrayToRef(e.minEmitBox,0,this.minEmitBox),P.mv.FromArrayToRef(e.maxEmitBox,0,this.maxEmitBox)}}class g{get radius(){return this._radius}set radius(e){this._radius=e,this._buildHeight()}get angle(){return this._angle}set angle(e){this._angle=e,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=v,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=d,this.radius=e}startDirectionFunction(e,d,v,p){p?P.TmpVectors.mv[0].L(v.aX).normalize():v.position.subtractToRef(e.getTranslation(),P.TmpVectors.mv[0]).normalize();const L=(0,W.RandomRange)(0,this.directionRandomizer),B=(0,W.RandomRange)(0,this.directionRandomizer),X=(0,W.RandomRange)(0,this.directionRandomizer);d.x=P.TmpVectors.mv[0].x+L,d.y=P.TmpVectors.mv[0].y+B,d.z=P.TmpVectors.mv[0].z+X,d.normalize()}startPositionFunction(e,d,v,p){const L=(0,W.RandomRange)(0,2*Math.PI);let B;this.emitFromSpawnPointOnly?B=1e-4:(B=(0,W.RandomRange)(0,this.heightRange),B=1-B*B);let X=this._radius-(0,W.RandomRange)(0,this._radius*this.radiusRange);X*=B;const z=X*Math.sin(L),V=X*Math.cos(L),k=B*this._height;if(p)return d.x=z,d.y=k,void(d.z=V);P.mv.TransformCoordinatesFromFloatsToRef(z,k,V,e,d)}clone(){const e=new g(this._radius,this._angle,this.directionRandomizer);return V.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat2("radius",this._radius,this.radiusRange),e.setFloat("coneAngle",this._angle),e.setFloat2("height",this._height,this.heightRange),e.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(e){e.addUniform("radius",2),e.addUniform("coneAngle",1),e.addUniform("height",2),e.addUniform("directionRandomizer",1)}getEffectDefines(){let e="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(e+="\n#define CONEEMITTERSPAWNPOINT"),e}getClassName(){return"ConeParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.radius=this._radius,e.angle=this._angle,e.directionRandomizer=this.directionRandomizer,e.radiusRange=this.radiusRange,e.heightRange=this.heightRange,e.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,e}parse(e){this.radius=e.radius,this.angle=e.angle,this.directionRandomizer=e.directionRandomizer,this.radiusRange=void 0!==e.radiusRange?e.radiusRange:1,this.heightRange=void 0!==e.radiusRange?e.heightRange:1,this.emitFromSpawnPointOnly=void 0!==e.emitFromSpawnPointOnly&&e.emitFromSpawnPointOnly}}class F extends g{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.mv(0,1,0),p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.mv(0,1,0);super(e,d),this.direction1=v,this.direction2=p}startDirectionFunction(e,d){const v=(0,W.RandomRange)(this.direction1.x,this.direction2.x),p=(0,W.RandomRange)(this.direction1.y,this.direction2.y),L=(0,W.RandomRange)(this.direction1.z,this.direction2.z);P.mv.TransformNormalFromFloatsToRef(v,p,L,e,d)}clone(){const e=new F(this.radius,this.angle,this.direction1,this.direction2);return V.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("radiusRange",1),e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const e=super.serialize();return e.direction1=this.direction1.Yd(),e.direction2=this.direction2.Yd(),e}parse(e){super.parse(e),this.direction1.L(e.direction1),this.direction2.L(e.direction2)}}class w{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=e,this.height=d,this.radiusRange=v,this.directionRandomizer=p,this._tempVector=P.mv.Zero()}startDirectionFunction(e,d,v,p,L){v.position.subtractToRef(e.getTranslation(),this._tempVector),this._tempVector.normalize(),P.mv.TransformNormalToRef(this._tempVector,L,this._tempVector);const B=(0,W.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let X=Math.atan2(this._tempVector.x,this._tempVector.z);X+=(0,W.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=B,this._tempVector.x=Math.sin(X),this._tempVector.z=Math.cos(X),this._tempVector.normalize(),p?d.L(this._tempVector):P.mv.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,e,d)}startPositionFunction(e,d,v,p){const L=(0,W.RandomRange)(-this.height/2,this.height/2),B=(0,W.RandomRange)(0,2*Math.PI),X=(0,W.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),z=Math.sqrt(X)*this.radius,V=z*Math.cos(B),k=z*Math.sin(B);p?d.Ed(V,L,k):P.mv.TransformCoordinatesFromFloatsToRef(V,L,k,e,d)}clone(){const e=new w(this.radius,this.directionRandomizer);return V.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("height",1),e.addUniform("radiusRange",1),e.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.radius=this.radius,e.height=this.height,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e}parse(e){this.radius=e.radius,this.height=e.height,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer}}class G extends w{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.mv(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.mv(0,1,0);super(e,d,v),this.direction1=p,this.direction2=L}startDirectionFunction(e,d,v,p){const L=(0,W.RandomRange)(this.direction1.x,this.direction2.x),B=(0,W.RandomRange)(this.direction1.y,this.direction2.y),X=(0,W.RandomRange)(this.direction1.z,this.direction2.z);p?d.Ed(L,B,X):P.mv.TransformNormalFromFloatsToRef(L,B,X,e,d)}clone(){const e=new G(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return V.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("height",1),e.addUniform("radiusRange",1),e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const e=super.serialize();return e.direction1=this.direction1.Yd(),e.direction2=this.direction2.Yd(),e}parse(e){super.parse(e),P.mv.FromArrayToRef(e.direction1,0,this.direction1),P.mv.FromArrayToRef(e.direction2,0,this.direction2)}}class U{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.radiusRange=d,this.directionRandomizer=v}startDirectionFunction(e,d,v,p){const L=v.position.Zd(e.getTranslation()).normalize(),B=(0,W.RandomRange)(0,this.directionRandomizer),X=(0,W.RandomRange)(0,this.directionRandomizer),z=(0,W.RandomRange)(0,this.directionRandomizer);L.x+=B,L.y+=X,L.z+=z,L.normalize(),p?d.L(L):P.mv.TransformNormalFromFloatsToRef(L.x,L.y,L.z,e,d)}startPositionFunction(e,d,v,p){const L=this.radius-(0,W.RandomRange)(0,this.radius*this.radiusRange),B=(0,W.RandomRange)(0,1),X=(0,W.RandomRange)(0,2*Math.PI),z=Math.acos(2*B-1),V=L*Math.cos(X)*Math.sin(z),k=L*Math.cos(z),g=L*Math.sin(X)*Math.sin(z);p?d.Ed(V,Math.abs(k),g):P.mv.TransformCoordinatesFromFloatsToRef(V,Math.abs(k),g,e,d)}clone(){const e=new U(this.radius,this.directionRandomizer);return V.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("radiusRange",1),e.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e}parse(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer}}class D{constructor(){this.direction1=new P.mv(0,1,0),this.direction2=new P.mv(0,1,0)}startDirectionFunction(e,d,v,p){const L=(0,W.RandomRange)(this.direction1.x,this.direction2.x),B=(0,W.RandomRange)(this.direction1.y,this.direction2.y),X=(0,W.RandomRange)(this.direction1.z,this.direction2.z);p?d.Ed(L,B,X):P.mv.TransformNormalFromFloatsToRef(L,B,X,e,d)}startPositionFunction(e,d,v,p){p?d.Ed(0,0,0):P.mv.TransformCoordinatesFromFloatsToRef(0,0,0,e,d)}clone(){const e=new D;return V.e.DeepCopy(this,e),e}applyToShader(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.direction1=this.direction1.Yd(),e.direction2=this.direction2.Yd(),e}parse(e){P.mv.FromArrayToRef(e.direction1,0,this.direction1),P.mv.FromArrayToRef(e.direction2,0,this.direction2)}}class C{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.radiusRange=d,this.directionRandomizer=v}startDirectionFunction(e,d,v,p){const L=v.position.Zd(e.getTranslation()).normalize(),B=(0,W.RandomRange)(0,this.directionRandomizer),X=(0,W.RandomRange)(0,this.directionRandomizer),z=(0,W.RandomRange)(0,this.directionRandomizer);L.x+=B,L.y+=X,L.z+=z,L.normalize(),p?d.L(L):P.mv.TransformNormalFromFloatsToRef(L.x,L.y,L.z,e,d)}startPositionFunction(e,d,v,p){const L=this.radius-(0,W.RandomRange)(0,this.radius*this.radiusRange),B=(0,W.RandomRange)(0,1),X=(0,W.RandomRange)(0,2*Math.PI),z=Math.acos(2*B-1),V=L*Math.cos(X)*Math.sin(z),k=L*Math.cos(z),g=L*Math.sin(X)*Math.sin(z);p?d.Ed(V,k,g):P.mv.TransformCoordinatesFromFloatsToRef(V,k,g,e,d)}clone(){const e=new C(this.radius,this.directionRandomizer);return V.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("radiusRange",1),e.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e}parse(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer}}class q extends C{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.mv(0,1,0),v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.mv(0,1,0);super(e),this.direction1=d,this.direction2=v}startDirectionFunction(e,d){const v=(0,W.RandomRange)(this.direction1.x,this.direction2.x),p=(0,W.RandomRange)(this.direction1.y,this.direction2.y),L=(0,W.RandomRange)(this.direction1.z,this.direction2.z);P.mv.TransformNormalFromFloatsToRef(v,p,L,e,d)}clone(){const e=new q(this.radius,this.direction1,this.direction2);return V.e.DeepCopy(this,e),e}applyToShader(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("radius",1),e.addUniform("radiusRange",1),e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const e=super.serialize();return e.direction1=this.direction1.Yd(),e.direction2=this.direction2.Yd(),e}parse(e){super.parse(e),this.direction1.L(e.direction1),this.direction2.L(e.direction2)}}class h{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(e,d,v,p){const L=P.TmpVectors.mv[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,v,L);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,v,L);const e=P.TmpVectors.mv[1];L.subtractToRef(v.position,e),e.scaleToRef(1/v.lifeTime,L)}else L.set(0,0,0);p?d.L(L):P.mv.TransformNormalToRef(L,e,d)}startPositionFunction(e,d,v,p){const L=P.TmpVectors.mv[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,v,L):L.set(0,0,0),p?d.L(L):P.mv.TransformCoordinatesToRef(L,e,d)}clone(){const e=new h;return V.e.DeepCopy(this,e),e}applyToShader(e){}buildUniformLayout(e){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const e={};return e.type=this.getClassName(),e.particlePositionGenerator=this.particlePositionGenerator,e.particleDestinationGenerator=this.particleDestinationGenerator,e}parse(e){e.particlePositionGenerator&&(this.particlePositionGenerator=e.particlePositionGenerator),e.particleDestinationGenerator&&(this.particleDestinationGenerator=e.particleDestinationGenerator)}}var l=v(12490);class n{get mesh(){return this._mesh}set mesh(e){this._mesh!==e&&(this._mesh=e,e?(this._indices=e.yd(),this._positions=e.getVerticesData(l.i.PositionKind),this._normals=e.getVerticesData(l.i.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=P.mv.Zero(),this._mesh=null,this.direction1=new P.mv(0,1,0),this.direction2=new P.mv(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=e}startDirectionFunction(e,d,v,p){if(this.useMeshNormalsForDirection&&this._normals)return void P.mv.TransformNormalToRef(this._storedNormal,e,d);const L=(0,W.RandomRange)(this.direction1.x,this.direction2.x),B=(0,W.RandomRange)(this.direction1.y,this.direction2.y),X=(0,W.RandomRange)(this.direction1.z,this.direction2.z);p?d.Ed(L,B,X):P.mv.TransformNormalFromFloatsToRef(L,B,X,e,d)}startPositionFunction(e,d,v,p){if(!this._indices||!this._positions)return;const L=3*(Math.random()*(this._indices.length/3)|0),B=Math.random(),X=Math.random()*(1-B),z=1-B-X,W=this._indices[L],V=this._indices[L+1],k=this._indices[L+2],g=P.TmpVectors.mv[0],F=P.TmpVectors.mv[1],w=P.TmpVectors.mv[2],G=P.TmpVectors.mv[3];P.mv.FromArrayToRef(this._positions,3*W,g),P.mv.FromArrayToRef(this._positions,3*V,F),P.mv.FromArrayToRef(this._positions,3*k,w),G.x=B*g.x+X*F.x+z*w.x,G.y=B*g.y+X*F.y+z*w.y,G.z=B*g.z+X*F.z+z*w.z,p?d.Ed(G.x,G.y,G.z):P.mv.TransformCoordinatesFromFloatsToRef(G.x,G.y,G.z,e,d),this.useMeshNormalsForDirection&&this._normals&&(P.mv.FromArrayToRef(this._normals,3*W,g),P.mv.FromArrayToRef(this._normals,3*V,F),P.mv.FromArrayToRef(this._normals,3*k,w),this._storedNormal.x=B*g.x+X*F.x+z*w.x,this._storedNormal.y=B*g.y+X*F.y+z*w.y,this._storedNormal.z=B*g.z+X*F.z+z*w.z)}clone(){const e=new n(this.mesh);return V.e.DeepCopy(this,e),e}applyToShader(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)}buildUniformLayout(e){e.addUniform("direction1",3),e.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var e;const d={};return d.type=this.getClassName(),d.direction1=this.direction1.Yd(),d.direction2=this.direction2.Yd(),d.meshId=null===(e=this.mesh)||void 0===e?void 0:e.id,d.useMeshNormalsForDirection=this.useMeshNormalsForDirection,d}parse(e,d){P.mv.FromArrayToRef(e.direction1,0,this.direction1),P.mv.FromArrayToRef(e.direction2,0,this.direction2),e.meshId&&d&&(this.mesh=d.getLastMeshById(e.meshId)),this.useMeshNormalsForDirection=e.useMeshNormalsForDirection}}class A{_isUbo(e){return void 0!==e.addUniform}constructor(e){this._isUbo(e)?(this.setMatrix3x3=e.updateMatrix3x3.bind(e),this.setMatrix2x2=e.updateMatrix2x2.bind(e),this.setFloat=e.updateFloat.bind(e),this.setFloat2=e.updateFloat2.bind(e),this.setFloat3=e.updateFloat3.bind(e),this.setFloat4=e.updateFloat4.bind(e),this.setFloatArray=e.updateFloatArray.bind(e),this.setArray=e.updateArray.bind(e),this.setIntArray=e.updateIntArray.bind(e),this.setMatrix=e.bd.bind(e),this.setMatrices=e.updateMatrices.bind(e),this.setVector3=e.updateVector3.bind(e),this.setVector4=e.updateVector4.bind(e),this.setColor3=e.updateColor3.bind(e),this.setColor4=e.updateColor4.bind(e),this.setDirectColor4=e.updateDirectColor4.bind(e),this.setInt=e.updateInt.bind(e),this.setInt2=e.updateInt2.bind(e),this.setInt3=e.updateInt3.bind(e),this.setInt4=e.updateInt4.bind(e)):(this.setMatrix3x3=e.setMatrix3x3.bind(e),this.setMatrix2x2=e.setMatrix2x2.bind(e),this.setFloat=e.setFloat.bind(e),this.setFloat2=e.setFloat2.bind(e),this.setFloat3=e.setFloat3.bind(e),this.setFloat4=e.setFloat4.bind(e),this.setFloatArray=e.setFloatArray.bind(e),this.setArray=e.setArray.bind(e),this.setIntArray=e.setIntArray.bind(e),this.setMatrix=e.setMatrix.bind(e),this.setMatrices=e.setMatrices.bind(e),this.setVector3=e.setVector3.bind(e),this.setVector4=e.setVector4.bind(e),this.setColor3=e.setColor3.bind(e),this.setColor4=e.setColor4.bind(e),this.setDirectColor4=e.setDirectColor4.bind(e),this.setInt=e.setInt.bind(e),this.setInt2=e.setInt2.bind(e),this.setInt3=e.setInt3.bind(e),this.setInt4=e.setInt4.bind(e))}}var x=v(12328);const i="gpuUpdateParticlesPixelShader",me="#version 300 es\nvoid main() {discard;}\n";x.d.ShadersStore[i]||(x.d.ShadersStore[i]=me);const r="gpuUpdateParticlesVertexShader",Z="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";x.d.ShadersStore[r]||(x.d.ShadersStore[r]=Z);(0,X.h)("BABYLON.WebGL2ParticleSystem",class{constructor(e,d){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=e,this._engine=d,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var e;return(null===(e=this._updateEffect)||void 0===e?void 0:e.isReady())??!1}createUpdateBuffer(e){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof h&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=e,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new A(this._updateEffect)}createVertexBuffers(e,d){this._updateVAO.push(this._createUpdateVAO(e)),this._renderVAO.push(this._engine.recordVertexArrayObject(d,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=d}createParticleBuffer(e){return e}bindDrawBuffers(e,d,v){v?this._engine.bindBuffers(this._renderVertexBuffers,v,d):this._engine.bindVertexArrayObject(this._renderVAO[e],null)}preUpdateParticleBuffer(){const e=this._engine;if(this._engine.enableEffect(this._updateEffect),!e.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(e,d,v){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[e],null);const P=this._engine;P.bindTransformFeedbackBuffer(d.getBuffer()),P.setRasterizerState(!1),P.beginTransformFeedback(!0),P.drawArraysType(3,0,v),P.endTransformFeedback(),P.setRasterizerState(!0),P.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let e=0;e<this._updateVAO.length;e++)this._engine.releaseVertexArrayObject(this._updateVAO[e]);this._updateVAO.length=0;for(let e=0;e<this._renderVAO.length;e++)this._engine.releaseVertexArrayObject(this._renderVAO[e]);this._renderVAO.length=0}_createUpdateVAO(e){const d={};d.position=e.createVertexBuffer("position",0,3);let v=3;d.age=e.createVertexBuffer("age",v,1),v+=1,d.size=e.createVertexBuffer("size",v,3),v+=3,d.life=e.createVertexBuffer("life",v,1),v+=1,d.seed=e.createVertexBuffer("seed",v,4),v+=4,d.direction=e.createVertexBuffer("direction",v,3),v+=3,this._parent.particleEmitterType instanceof h&&(d.initialPosition=e.createVertexBuffer("initialPosition",v,3),v+=3),this._parent._colorGradientsTexture||(d.color=e.createVertexBuffer("color",v,4),v+=4),this._parent._isBillboardBased||(d.initialDirection=e.createVertexBuffer("initialDirection",v,3),v+=3),this._parent.noiseTexture&&(d.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",v,3),v+=3,d.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",v,3),v+=3),this._parent._angularSpeedGradientsTexture?(d.angle=e.createVertexBuffer("angle",v,1),v+=1):(d.angle=e.createVertexBuffer("angle",v,2),v+=2),this._parent._isAnimationSheetEnabled&&(d.cellIndex=e.createVertexBuffer("cellIndex",v,1),v+=1,this._parent.spriteRandomStartCell&&(d.cellStartOffset=e.createVertexBuffer("cellStartOffset",v,1),v+=1));const P=this._engine.recordVertexArrayObject(d,null,this._updateEffect);return this._engine.bindArrayBuffer(null),P}});class f{constructor(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,P=arguments.length>3?arguments[3]:void 0;this._engine=e,this._label=P,this._engine._storageBuffers.push(this),this._create(d,v)}_create(e,d){this._bufferSize=e,this._creationFlags=d,this._buffer=this._engine.createStorageBuffer(e,d,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(e,d,v){this._buffer&&this._engine.updateStorageBuffer(this._buffer,e,d,v)}async read(e,d,v,P){return await this._engine.readFromStorageBuffer(this._buffer,e,d,v,P)}dispose(){const e=this._engine._storageBuffers,d=e.indexOf(this);-1!==d&&(e[d]=e[e.length-1],e.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var T=v(12403),S=v(12409),o=v(12453),K=v(12399),Q=v(12709),N=v(12253),u=v(12359),O=v(12633);class R{constructor(){this._gpuTimeInFrameId=-1,this.counter=new O.e}_addDuration(e,d){e<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==e?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(d,!1),this._gpuTimeInFrameId=e):this.counter.addCount(d,!1))}}var Y=v(12314);class H{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=e,this._engine=d,this.uniqueId=Q.c.UniqueId,d.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new R),this._engine.getCaps().supportComputeShaders?P.bindingsMapping?(this._context=d.createComputeContext(),this._shaderPath=v,this._options={bindingsMapping:{},defines:[],...P}):N.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):N.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(e,d){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const P=this._bindings[e];this._bindings[e]={type:v?0:4,object:d,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!P||P.object!==d||P.type!==this._bindings[e].type)}setStorageTexture(e,d){const v=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!v||v.object!==d),this._bindings[e]={type:1,object:d,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}setExternalTexture(e,d){const v=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!v||v.object!==d),this._bindings[e]={type:6,object:d,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}setVideoTexture(e,d){return!!d.externalTexture&&(this.setExternalTexture(e,d.externalTexture),!0)}setUniformBuffer(e,d){const v=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!v||v.object!==d),this._bindings[e]={type:H._BufferIsDataBuffer(d)?7:2,object:d,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}setStorageBuffer(e,d){const v=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!v||v.object!==d),this._bindings[e]={type:H._BufferIsDataBuffer(d)?7:3,object:d,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}setTextureSampler(e,d){const v=this._bindings[e];this._contextIsDirty||(this._contextIsDirty=!v||!d.compareSampler(v.object)),this._bindings[e]={type:5,object:d,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries}}isReady(){let e=this._effect;for(const p in this._bindings){const e=this._bindings[p],d=e.type,v=e.object;switch(d){case 0:case 4:case 1:if(!v.isReady())return!1;break;case 6:if(!v.isReady())return!1;break}}const d=[],v=this._shaderPath;if(this._options.defines)for(let p=0;p<this._options.defines.length;p++)d.push(this._options.defines[p]);const P=d.join("\n");return this._cachedDefines!==P&&(this._cachedDefines=P,e=this._engine.createComputeEffect(v,{defines:P,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=e),!!e.isReady()}dispatch(e,d,v){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,e,d,v,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const v=H._BufferIsDataBuffer(e)?e:e.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,v,d,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const d in this._bindings){const v=this._bindings[d];if(!this._options.bindingsMapping[d])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+d+"'");switch(v.type){case 0:{const P=this._samplers[d],p=v.object;var e;if(!P||!p._texture||!P.compareSampler(p._texture))this._samplers[d]=(new u.b).setParameters(p.wrapU,p.wrapV,p.wrapR,p.anisotropicFilteringLevel,p._texture.samplingMode,null===(e=p._texture)||void 0===e?void 0:e._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const e=v.object;e.getBuffer()!==v.buffer&&(v.buffer=e.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((p=>{(0,Y.g)((()=>this.dispatch(e,d,v)),p,void 0,P)}))}serialize(){const e=o.c.Serialize(this);e.options=this._options,e.shaderPath=this._shaderPath,e.vg={},e.textures={};for(const d in this._bindings){const v=this._bindings[d],P=v.object;switch(v.type){case 0:case 4:case 1:{const p=P.serialize();p&&(e.textures[d]=p,e.vg[d]={type:v.type});break}}}return e}static Parse(e,d,v){const P=o.c.Parse((()=>new H(e.name,d.getEngine(),e.shaderPath,e.options)),e,d,v);for(const p in e.textures){const L=e.vg[p],B=K.e.Parse(e.textures[p],d,v);0===L.type?P.setTexture(p,B):4===L.type?P.setTexture(p,B,!1):P.setStorageTexture(p,B)}return P}static _BufferIsDataBuffer(e){return void 0!==e.underlyingResource}}(0,T.e)([(0,S.M)()],H.prototype,"name",void 0),(0,T.e)([(0,S.M)()],H.prototype,"fastMode",void 0),(0,X.h)("BABYLON.ComputeShader",H);var a=v(12674);const t="gpuUpdateParticlesComputeShader",I="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";x.d.ShadersStoreWGSL[t]||(x.d.ShadersStoreWGSL[t]=I);(0,X.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(e,d){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=e,this._engine=d}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var e;return(null===(e=this._updateComputeShader)||void 0===e?void 0:e.isReady())??!1}createUpdateBuffer(e){var d;const v={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(v.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(v.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(v.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(v.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(v.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(v.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(v.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new H("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:v,defines:e.split("\n")}),null===(d=this._simParamsComputeShader)||void 0===d||d.dispose(),this._simParamsComputeShader=new a.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new A(this._simParamsComputeShader)}createVertexBuffers(e,d){this._renderVertexBuffers.push(d)}createParticleBuffer(e){const d=new f(this._engine,4*e.length,11,"ComputeShaderParticleSystemBuffer");return d.update(e),this._bufferComputeShader.push(d),d.getBuffer()}bindDrawBuffers(e,d,v){this._engine.bindBuffers(this._renderVertexBuffers[e],v,d)}preUpdateParticleBuffer(){}updateParticleBuffer(e,d,v){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[e]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^e]),this._updateComputeShader.dispatch(Math.ceil(v/64))}releaseBuffers(){var e;for(let d=0;d<this._bufferComputeShader.length;++d)this._bufferComputeShader[d].dispose();this._bufferComputeShader.length=0,null===(e=this._simParamsComputeShader)||void 0===e||e.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class c{constructor(e,d,v){this.gradient=e,this.color1=d,this.color2=v}getColorToRef(e){this.color2?B.Up.LerpToRef(this.color1,this.color2,Math.random(),e):e.L(this.color1)}}class b{constructor(e,d){this.gradient=e,this.color=d}}class M{constructor(e,d,v){this.gradient=e,this.factor1=d,this.factor2=v}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class s{static GetCurrentGradient(e,d,v){if(d[0].gradient>e)return void v(d[0],d[0],1);for(let p=0;p<d.length-1;p++){const P=d[p],L=d[p+1];if(e>=P.gradient&&e<=L.gradient){return void v(P,L,(e-P.gradient)/(L.gradient-P.gradient))}}const P=d.length-1;v(d[P],d[P],1)}}var y=v(12248),j=v(12893),J=v(12281);class E{constructor(e){this.particleSystem=e,this.position=P.mv.Zero(),this.direction=P.mv.Zero(),this.color=new B.Up(0,0,0,0),this.colorStep=new B.Up(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new P.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new B.Up(0,0,0,0),this._currentColor2=new B.Up(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=E._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let e=this.age,d=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===d?(d=1,e=this._randomCellOffset):e+=this._randomCellOffset);const v=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let P;P=this._initialSpriteCellLoop?(0,W.Clamp)(e*d%this.lifeTime/this.lifeTime):(0,W.Clamp)(e*d/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+P*v|0}_inheritParticleInfoToSubEmitter(e){if(e.particleSystem.Pd.position){const d=e.particleSystem.Pd;if(d.position.L(this.position),e.inheritDirection){const e=P.TmpVectors.mv[0];this.direction.normalizeToRef(e),d.setDirection(e,0,Math.PI/2)}}else{e.particleSystem.Pd.L(this.position)}this.direction.scaleToRef(e.inheritedVelocityAmount/2,P.TmpVectors.mv[0]),e.particleSystem._inheritedVelocityOffset.L(P.TmpVectors.mv[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const e of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(e)}_reset(){this.age=0,this.id=E._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(e){e.position.L(this.position),this._initialDirection?e._initialDirection?e._initialDirection.L(this._initialDirection):e._initialDirection=this._initialDirection.clone():e._initialDirection=null,e.direction.L(this.direction),this.aX&&(e.aX?e.aX.L(this.aX):e.aX=this.aX.clone()),e.color.L(this.color),e.colorStep.L(this.colorStep),e.lifeTime=this.lifeTime,e.age=this.age,e._randomCellOffset=this._randomCellOffset,e.size=this.size,e.scale.L(this.scale),e.angle=this.angle,e.angularSpeed=this.angularSpeed,e.particleSystem=this.particleSystem,e.cellIndex=this.cellIndex,e.id=this.id,e._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(e._currentColorGradient=this._currentColorGradient,e._currentColor1.L(this._currentColor1),e._currentColor2.L(this._currentColor2)),this._currentSizeGradient&&(e._currentSizeGradient=this._currentSizeGradient,e._currentSize1=this._currentSize1,e._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(e._currentAngularSpeedGradient=this._currentAngularSpeedGradient,e._currentAngularSpeed1=this._currentAngularSpeed1,e._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(e._currentVelocityGradient=this._currentVelocityGradient,e._currentVelocity1=this._currentVelocity1,e._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(e._currentLimitVelocityGradient=this._currentLimitVelocityGradient,e._currentLimitVelocity1=this._currentLimitVelocity1,e._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(e._currentDragGradient=this._currentDragGradient,e._currentDrag1=this._currentDrag1,e._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(e._initialStartSpriteCellId=this._initialStartSpriteCellId,e._initialEndSpriteCellId=this._initialEndSpriteCellId,e._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(e.remapData&&this.remapData?e.remapData.L(this.remapData):e.remapData=new P.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(e._randomNoiseCoordinates1?(e._randomNoiseCoordinates1.L(this._randomNoiseCoordinates1),e._randomNoiseCoordinates2.L(this._randomNoiseCoordinates2)):(e._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),e._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}E._Count=0;var ee=v(12540),de=(v(12584),v(12775)),ve=v(12767),Pe=v(12672);function pe(e,d){const v=(0,W.RandomRange)(0,1);B.Up.LerpToRef(d.color1,d.color2,v,e.color),d.colorDead.subtractToRef(e.color,d._colorDiff),d._colorDiff.scaleToRef(1/e.lifeTime,e.colorStep)}function Le(e,d){e._currentColorGradient=d._colorGradients[0],e._currentColorGradient.getColorToRef(e.color),e._currentColor1.L(e.color),d._colorGradients.length>1?d._colorGradients[1].getColorToRef(e._currentColor2):e._currentColor2.L(e.color)}function Be(e,d){const v=d._colorGradients;s.GetCurrentGradient(d._ratio,v,((d,v,P)=>{d!==e._currentColorGradient&&(e._currentColor1.L(e._currentColor2),v.getColorToRef(e._currentColor2),e._currentColorGradient=d),B.Up.LerpToRef(e._currentColor1,e._currentColor2,P,e.color)}))}function Xe(e,d){e.colorStep.scaleToRef(d._scaledUpdateSpeed,d._scaledColorStep),e.color.addInPlace(d._scaledColorStep),e.color.a<0&&(e.color.a=0)}function ze(e,d){s.GetCurrentGradient(d._ratio,d._angularSpeedGradients,((d,v,P)=>{d!==e._currentAngularSpeedGradient&&(e._currentAngularSpeed1=e._currentAngularSpeed2,e._currentAngularSpeed2=v.getFactor(),e._currentAngularSpeedGradient=d),e.angularSpeed=(0,W.Lerp)(e._currentAngularSpeed1,e._currentAngularSpeed2,P)}))}function We(e,d){e.angle+=e.angularSpeed*d._scaledUpdateSpeed}function Ve(e,d){d.particleEmitterType.startDirectionFunction(d._emitterWorldMatrix,e.direction,e,d.isLocal,d._emitterInverseWorldMatrix)}function ke(e,d){d.startDirectionFunction(d._emitterWorldMatrix,e.direction,e,d.isLocal)}function ge(e,d){e._currentVelocityGradient=d._velocityGradients[0],e._currentVelocity1=e._currentVelocityGradient.getFactor(),d._velocityGradients.length>1?e._currentVelocity2=d._velocityGradients[1].getFactor():e._currentVelocity2=e._currentVelocity1}function Fe(e,d){e._currentLimitVelocityGradient=d._limitVelocityGradients[0],e._currentLimitVelocity1=e._currentLimitVelocityGradient.getFactor(),d._limitVelocityGradients.length>1?e._currentLimitVelocity2=d._limitVelocityGradients[1].getFactor():e._currentLimitVelocity2=e._currentLimitVelocity1}function we(e,d){s.GetCurrentGradient(d._ratio,d._velocityGradients,((v,P,p)=>{v!==e._currentVelocityGradient&&(e._currentVelocity1=e._currentVelocity2,e._currentVelocity2=P.getFactor(),e._currentVelocityGradient=v),d._directionScale*=(0,W.Lerp)(e._currentVelocity1,e._currentVelocity2,p)}))}function Ge(e,d){s.GetCurrentGradient(d._ratio,d._limitVelocityGradients,((v,P,p)=>{v!==e._currentLimitVelocityGradient&&(e._currentLimitVelocity1=e._currentLimitVelocity2,e._currentLimitVelocity2=P.getFactor(),e._currentLimitVelocityGradient=v);const L=(0,W.Lerp)(e._currentLimitVelocity1,e._currentLimitVelocity2,p);e.direction.length()>L&&e.direction.scaleInPlace(d.limitVelocityDamping)}))}function Ue(e,d){e.direction.scaleToRef(d._directionScale,d._scaledDirection)}function De(e,d){d.particleEmitterType.startPositionFunction(d._emitterWorldMatrix,e.position,e,d.isLocal)}function Ce(e,d){d.startPositionFunction(d._emitterWorldMatrix,e.position,e,d.isLocal)}function qe(e,d){e.aX?e.aX.L(e.position):e.aX=e.position.clone(),P.mv.TransformCoordinatesToRef(e.aX,d._emitterWorldMatrix,e.position)}function he(e,d){d.isLocal&&e.aX?(e.aX.addInPlace(d._scaledDirection),P.mv.TransformCoordinatesToRef(e.aX,d._emitterWorldMatrix,e.position)):e.position.addInPlace(d._scaledDirection)}function le(e,d){e._currentDragGradient=d._dragGradients[0],e._currentDrag1=e._currentDragGradient.getFactor(),d._dragGradients.length>1?e._currentDrag2=d._dragGradients[1].getFactor():e._currentDrag2=e._currentDrag1}function ne(e,d){s.GetCurrentGradient(d._ratio,d._dragGradients,((v,P,p)=>{v!==e._currentDragGradient&&(e._currentDrag1=e._currentDrag2,e._currentDrag2=P.getFactor(),e._currentDragGradient=v);const L=(0,W.Lerp)(e._currentDrag1,e._currentDrag2,p);d._scaledDirection.scaleInPlace(1-L)}))}function Ae(e,d){e._randomNoiseCoordinates1?(e._randomNoiseCoordinates1.Ed(Math.random(),Math.random(),Math.random()),e._randomNoiseCoordinates2.Ed(Math.random(),Math.random(),Math.random())):(e._randomNoiseCoordinates1=new P.mv(Math.random(),Math.random(),Math.random()),e._randomNoiseCoordinates2=new P.mv(Math.random(),Math.random(),Math.random()))}function xe(e,d){const v=d._noiseTextureData,p=d._noiseTextureSize;if(v&&p&&e._randomNoiseCoordinates1){const L=d._fetchR(e._randomNoiseCoordinates1.x,e._randomNoiseCoordinates1.y,p.width,p.height,v),B=d._fetchR(e._randomNoiseCoordinates1.z,e._randomNoiseCoordinates2.x,p.width,p.height,v),X=d._fetchR(e._randomNoiseCoordinates2.y,e._randomNoiseCoordinates2.z,p.width,p.height,v),z=P.TmpVectors.mv[0],W=P.TmpVectors.mv[1];z.Ed((2*L-1)*d.noiseStrength.x,(2*B-1)*d.noiseStrength.y,(2*X-1)*d.noiseStrength.z),z.scaleToRef(d._tempScaledUpdateSpeed,W),e.direction.addInPlace(W)}}function ie(e,d){d.gravity.scaleToRef(d._tempScaledUpdateSpeed,d._scaledGravity),e.direction.addInPlace(d._scaledGravity)}function md(e,d){e.size=(0,W.RandomRange)(d.minSize,d.maxSize),e.scale.Ed((0,W.RandomRange)(d.minScaleX,d.maxScaleX),(0,W.RandomRange)(d.minScaleY,d.maxScaleY))}function re(e,d){e._currentSizeGradient=d._sizeGradients[0],e._currentSize1=e._currentSizeGradient.getFactor(),e.size=e._currentSize1,d._sizeGradients.length>1?e._currentSize2=d._sizeGradients[1].getFactor():e._currentSize2=e._currentSize1,e.scale.Ed((0,W.RandomRange)(d.minScaleX,d.maxScaleX),(0,W.RandomRange)(d.minScaleY,d.maxScaleY))}function Ze(e,d){const v=d._actualFrame/d.targetStopDuration;s.GetCurrentGradient(v,d._startSizeGradients,((v,P,p)=>{v!==d._currentStartSizeGradient&&(d._currentStartSize1=d._currentStartSize2,d._currentStartSize2=P.getFactor(),d._currentStartSizeGradient=v);const L=(0,W.Lerp)(d._currentStartSize1,d._currentStartSize2,p);e.scale.scaleInPlace(L)}))}function fe(e,d){s.GetCurrentGradient(d._ratio,d._sizeGradients,((d,v,P)=>{d!==e._currentSizeGradient&&(e._currentSize1=e._currentSize2,e._currentSize2=v.getFactor(),e._currentSizeGradient=d),e.size=(0,W.Lerp)(e._currentSize1,e._currentSize2,P)}))}function Te(e,d){e.remapData=new P.Vector4(0,1,0,1)}function Se(e,d){d._colorRemapGradients&&d._colorRemapGradients.length>0&&s.GetCurrentGradient(d._ratio,d._colorRemapGradients,((d,v,P)=>{const p=(0,W.Lerp)(d.factor1,v.factor1,P),L=(0,W.Lerp)(d.factor2,v.factor2,P);e.remapData.x=p,e.remapData.y=L-p})),d._alphaRemapGradients&&d._alphaRemapGradients.length>0&&s.GetCurrentGradient(d._ratio,d._alphaRemapGradients,((d,v,P)=>{const p=(0,W.Lerp)(d.factor1,v.factor1,P),L=(0,W.Lerp)(d.factor2,v.factor2,P);e.remapData.z=p,e.remapData.w=L-p}))}function oe(e,d){const v=(0,W.Clamp)(d._actualFrame/d.targetStopDuration);s.GetCurrentGradient(v,d._lifeTimeGradients,((d,P)=>{const p=d,L=P,B=p.getFactor(),X=L.getFactor(),z=(v-p.gradient)/(L.gradient-p.gradient);e.lifeTime=(0,W.Lerp)(B,X,z)})),d._emitPower=(0,W.RandomRange)(d.minEmitPower,d.maxEmitPower)}function Ke(e,d){e.lifeTime=(0,W.RandomRange)(d.minLifeTime,d.maxLifeTime),d._emitPower=(0,W.RandomRange)(d.minEmitPower,d.maxEmitPower)}function Qe(e,d){0===d._emitPower?(e._initialDirection?e._initialDirection.L(e.direction):e._initialDirection=e.direction.clone(),e.direction.set(0,0,0)):(e._initialDirection=null,e.direction.scaleInPlace(d._emitPower)),e.direction.addInPlace(d._inheritedVelocityOffset)}function Ne(e,d){e.angularSpeed=(0,W.RandomRange)(d.minAngularSpeed,d.maxAngularSpeed),e.angle=(0,W.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function ue(e,d){e._currentAngularSpeedGradient=d._angularSpeedGradients[0],e.angularSpeed=e._currentAngularSpeedGradient.getFactor(),e._currentAngularSpeed1=e.angularSpeed,d._angularSpeedGradients.length>1?e._currentAngularSpeed2=d._angularSpeedGradients[1].getFactor():e._currentAngularSpeed2=e._currentAngularSpeed1,e.angle=(0,W.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function Oe(e,d){e._initialStartSpriteCellId=d.startSpriteCellID,e._initialEndSpriteCellId=d.endSpriteCellID,e._initialSpriteCellLoop=d.spriteCellLoop}function Re(e,d){e.previousItem=d.previousItem,e.nextItem=d,d.previousItem&&(d.previousItem.nextItem=e),d.previousItem=e}function Ye(e,d){e.previousItem=d,e.nextItem=d.nextItem,d.nextItem&&(d.nextItem.previousItem=e),d.nextItem=e}function He(e,d){let v=d;for(;v.nextItem;)v=v.nextItem;e.previousItem=v,e.nextItem=v.nextItem,v.nextItem=e}function ae(e){e.previousItem&&(e.previousItem.nextItem=e.nextItem),e.nextItem&&(e.nextItem.previousItem=e.previousItem)}class te extends z{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(e){this._startDirectionFunction!==e&&(this._startDirectionFunction=e,this._directionProcessing.process=e?ke:Ve)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(e){this._startPositionFunction!==e&&(this._startPositionFunction=e,this._positionCreation.process=e?Ce:De)}set onDispose(e){this._onDisposeObserver&&this.Fd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fd.add(e)}get W(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(e){this._useRampGradients!==e&&(this._useRampGradients=e,this._resetEffect(),e?(this._rampCreation={process:Te,previousItem:null,nextItem:null},Ye(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Se,previousItem:null,nextItem:null},Ye(this._remapGradientProcessing,this._gravityProcessing)):(ae(this._rampCreation),ae(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(e){this._isLocal!==e&&(this._isLocal=e,e?(this._isLocalCreation={process:qe,previousItem:null,nextItem:null},Ye(this._isLocalCreation,this._positionCreation)):ae(this._isLocalCreation))}get particles(){return this.jk}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(e){this._animationSheetEnabled!==e&&(this._animationSheetEnabled=e,e?(this._sheetCreation={process:Oe,previousItem:null,nextItem:null},Ye(this._sheetCreation,this._colorCreation)):ae(this._sheetCreation),this._reset())}getActiveCount(){return this.jk.length}getClassName(){return"pz"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var e;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(e=this._customWrappers[d])||void 0===e?void 0:e.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[e]??this._customWrappers[0]}setCustomEffect(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new ee.b(this._engine),this._customWrappers[d].effect=e,this._customWrappers[d].drawContext&&(this._customWrappers[d].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new y.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(e){if(this.noiseTexture!==e){if(this._noiseTexture=e,!e)return ae(this._noiseCreation),void ae(this._noiseProcessing);this._noiseCreation={process:Ae,previousItem:null,nextItem:null},Ye(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:xe,previousItem:null,nextItem:null},Ye(this._noiseProcessing,this._positionProcessing)}}constructor(e,d,v){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4],X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(e),this._emitterInverseWorldMatrix=P.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new P.mv,this.Fd=new y.d,this.onStoppedObservable=new y.d,this.onStartedObservable=new y.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.jk=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new B.Up(0,0,0,0),this._colorDiff=new B.Up(0,0,0,0),this._scaledDirection=P.mv.Zero(),this._scaledGravity=P.mv.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=e=>{},this.recycleParticle=e=>{const d=this.jk.pop();d!==e&&d.copyTo(e),this._stockParticles.push(d)},this._createParticle=()=>{let e;return 0!==this._stockParticles.length?(e=this._stockParticles.pop(),e._reset()):e=new E(this),this._prepareParticle(e),e},this.paused=!1,this._shadersLoaded=!1,this._capacity=d,this._epsilon=X,v&&"Scene"!==v.getClassName()?(this._engine=v,this.defaultProjectionMatrix=P.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=v||J.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.sk.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Ke,previousItem:null,nextItem:null},this._positionCreation={process:De,previousItem:null,nextItem:null},Ye(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Ve,previousItem:null,nextItem:null},Ye(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Qe,previousItem:null,nextItem:null},Ye(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:md,previousItem:null,nextItem:null},Ye(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Ne,previousItem:null,nextItem:null},Ye(this._angleCreation,this._sizeCreation),this._colorCreation={process:pe,previousItem:null,nextItem:null},Ye(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,z||(this._colorProcessing={process:Xe,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:We,previousItem:null,nextItem:null},Ye(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Ue,previousItem:null,nextItem:null},Ye(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:he,previousItem:null,nextItem:null},Ye(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:ie,previousItem:null,nextItem:null},Ye(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=L,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ee.b(this._engine)},this._customWrappers[0].effect=p,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new k,this.updateFunction=e=>{var d;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(d=this.noiseTexture.getContent())||void 0===d||d.then((e=>{this._noiseTextureData=e})));const v=e===this.jk;for(let P=0;P<e.length;P++){const d=e[P];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const p=d.age;if(d.age+=this._tempScaledUpdateSpeed,d.age>d.lifeTime){const e=d.age-p,v=d.lifeTime-p;this._tempScaledUpdateSpeed=v*this._tempScaledUpdateSpeed/e,d.age=d.lifeTime}this._ratio=d.age/d.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let L=this._updateQueueStart;for(;L;)L.process(d,this),L=L.nextItem;if(this._isAnimationSheetEnabled&&!z&&d.updateCellIndex(),d._inheritParticleInfoToSubEmitters(),d.age>=d.lifeTime){if(this._emitFromParticle(d),d._attachedSubEmitters){for(const e of d._attachedSubEmitters)e.particleSystem.disposeOnStop=!0,e.particleSystem.stop();d._attachedSubEmitters=null}this.recycleParticle(d),v&&P--}else;}}}serialize(e){throw new Error("Method not implemented.")}clone(e,d){throw new Error("Method not implemented.")}_addFactorGradient(e,d,v,P){const p=new M(d,v,P);e.push(p),e.sort(((e,d)=>e.gradient<d.gradient?-1:e.gradient>d.gradient?1:0))}_removeFactorGradient(e,d){if(!e)return;let v=0;for(const P of e){if(P.gradient===d){e.splice(v,1);break}v++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=oe:this._lifeTimeCreation.process=Ke}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Ze,previousItem:null,nextItem:null},Ye(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(ae(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(e){this.targetStopDuration!==e&&(this._targetStopDuration=e,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(e,d,v){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,e,d,v),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(e){return this._removeFactorGradient(this._lifeTimeGradients,e),this._syncLifeTimeCreation(),this}addSizeGradient(e,d,v){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=re,this._sizeGradientProcessing={process:fe,previousItem:null,nextItem:null},Re(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,e,d,v),this}removeSizeGradient(e){var d;return this._removeFactorGradient(this._sizeGradients,e),0===(null===(d=this._sizeGradients)||void 0===d?void 0:d.length)&&(ae(this._sizeGradientProcessing),this._sizeCreation.process=md),this}addColorRemapGradient(e,d,v){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,e,d,v),this}removeColorRemapGradient(e){return this._removeFactorGradient(this._colorRemapGradients,e),this}addAlphaRemapGradient(e,d,v){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,e,d,v),this}removeAlphaRemapGradient(e){return this._removeFactorGradient(this._alphaRemapGradients,e),this}addAngularSpeedGradient(e,d,v){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=ue,this._angularSpeedGradientProcessing={process:ze,previousItem:null,nextItem:null},Re(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,e,d,v),this}removeAngularSpeedGradient(e){var d;return this._removeFactorGradient(this._angularSpeedGradients,e),0===(null===(d=this._angularSpeedGradients)||void 0===d?void 0:d.length)&&(this._angleCreation.process=Ne,ae(this._angularSpeedGradientProcessing)),this}addVelocityGradient(e,d,v){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:ge,previousItem:null,nextItem:null},Ye(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:we,previousItem:null,nextItem:null},Re(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,e,d,v),this}removeVelocityGradient(e){var d;return this._removeFactorGradient(this._velocityGradients,e),0===(null===(d=this._velocityGradients)||void 0===d?void 0:d.length)&&(ae(this._velocityCreation),ae(this._velocityGradientProcessing)),this}addLimitVelocityGradient(e,d,v){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Fe,previousItem:null,nextItem:null},Ye(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Ge,previousItem:null,nextItem:null},Ye(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,e,d,v),this}removeLimitVelocityGradient(e){var d;return this._removeFactorGradient(this._limitVelocityGradients,e),0===(null===(d=this._limitVelocityGradients)||void 0===d?void 0:d.length)&&(ae(this._limitVelocityCreation),ae(this._limitVelocityGradientProcessing)),this}addDragGradient(e,d,v){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:le,previousItem:null,nextItem:null},Re(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:ne,previousItem:null,nextItem:null},Re(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,e,d,v),this}removeDragGradient(e){var d;return this._removeFactorGradient(this._dragGradients,e),0===(null===(d=this._dragGradients)||void 0===d?void 0:d.length)&&(ae(this._dragCreation),ae(this._dragGradientProcessing)),this}addEmitRateGradient(e,d,v){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,e,d,v),this}removeEmitRateGradient(e){return this._removeFactorGradient(this._emitRateGradients,e),this}addStartSizeGradient(e,d,v){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,e,d,v),this._syncStartSizeCreation(),this}removeStartSizeGradient(e){return this._removeFactorGradient(this._startSizeGradients,e),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const e=new Uint8Array(4*this._rawTextureWidth),d=B.TmpColors.Kd[0];for(let v=0;v<this._rawTextureWidth;v++){const P=v/this._rawTextureWidth;s.GetCurrentGradient(P,this._rampGradients,((P,p,L)=>{B.Kd.LerpToRef(P.color,p.color,L,d),e[4*v]=255*d.r,e[4*v+1]=255*d.g,e[4*v+2]=255*d.b,e[4*v+3]=255}))}this._rampGradientsTexture=j.b.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((e,d)=>e.gradient<d.gradient?-1:e.gradient>d.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(e,d){this._rampGradients||(this._rampGradients=[]);const v=new b(e,d);return this._rampGradients.push(v),this._syncRampGradientTexture(),this}removeRampGradient(e){return this._removeGradientAndTexture(e,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(e,d,v){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Le,this._colorProcessing.process=Be);const P=new c(e,d,v);return this._colorGradients.push(P),this._colorGradients.sort(((e,d)=>e.gradient<d.gradient?-1:e.gradient>d.gradient?1:0)),this}removeColorGradient(e){if(!this._colorGradients)return this;let d=0;for(const v of this._colorGradients){if(v.gradient===e){this._colorGradients.splice(d,1);break}d++}return 0===this._colorGradients.length&&(this._colorCreation.process=pe,this._colorProcessing.process=Xe),this}resetDrawCache(){if(this._drawWrappers){for(const e of this._drawWrappers)if(e)for(const d of e)null===d||void 0===d||d.dispose();this._drawWrappers=[]}}_fetchR(e,d,v,P,p){return p[4*(((e=.5*Math.abs(e)+.5)*v%v|0)+((d=.5*Math.abs(d)+.5)*P%P|0)*v)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const e=this._engine,d=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*d),this._vertexBuffer=new l.e(e,this._vertexData,!0,d);let v=0;const P=this._vertexBuffer.createVertexBuffer(l.i.PositionKind,v,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.i.PositionKind]=P,v+=3;const p=this._vertexBuffer.createVertexBuffer(l.i.ColorKind,v,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.i.ColorKind]=p,v+=4;const L=this._vertexBuffer.createVertexBuffer("angle",v,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=L,v+=1;const B=this._vertexBuffer.createVertexBuffer("size",v,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=B,v+=2,this._isAnimationSheetEnabled){const e=this._vertexBuffer.createVertexBuffer("cellIndex",v,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=e,v+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const e=this._vertexBuffer.createVertexBuffer("direction",v,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=e,v+=3}if(this._useRampGradients){const e=this._vertexBuffer.createVertexBuffer("remapData",v,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=e,v+=4}let X;if(this._useInstancing){const d=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new l.e(e,d,!1,2),X=this._spriteBuffer.createVertexBuffer("offset",0,2)}else X=this._vertexBuffer.createVertexBuffer("offset",v,2,this._vertexBufferSize,this._useInstancing),v+=2;this._vertexBuffers.offset=X,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const e=[],d=[];let v=0;for(let P=0;P<this._capacity;P++)e.push(v),e.push(v+1),e.push(v+2),e.push(v),e.push(v+2),e.push(v+3),d.push(v,v+1,v+1,v+2,v+2,v+3,v+3,v,v,v+3),v+=4;this._indexBuffer=this._engine.createIndexBuffer(e),this._linesIndexBuffer=this._engine.createIndexBuffer(d)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(e)setTimeout((()=>{this.start(0)}),e);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var d;-1!==(null===(d=this.Pd)||void 0===d?void 0:d.getClassName().indexOf("Mesh"))&&this.Pd.Md(!0);const e=this.noiseTexture;if(e&&e.onGeneratedObservable)e.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let d=0;d<this.preWarmCycles;d++)this.animate(!0),e.render()}))}));else for(let d=0;d<this.preWarmCycles;d++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(e))}_postStop(e){}reset(){this._stockParticles.length=0,this.jk.length=0}_appendParticleVertex(e,d,v,p){let L=e*this._vertexBufferSize;if(this._vertexData[L++]=d.position.x+this.gW.x,this._vertexData[L++]=d.position.y+this.gW.y,this._vertexData[L++]=d.position.z+this.gW.z,this._vertexData[L++]=d.color.r,this._vertexData[L++]=d.color.g,this._vertexData[L++]=d.color.b,this._vertexData[L++]=d.color.a,this._vertexData[L++]=d.angle,this._vertexData[L++]=d.scale.x*d.size,this._vertexData[L++]=d.scale.y*d.size,this._isAnimationSheetEnabled&&(this._vertexData[L++]=d.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[L++]=d.direction.x,this._vertexData[L++]=d.direction.y,this._vertexData[L++]=d.direction.z);else if(d._initialDirection){let e=d._initialDirection;this.isLocal&&(P.mv.TransformNormalToRef(e,this._emitterWorldMatrix,P.TmpVectors.mv[0]),e=P.TmpVectors.mv[0]),0===e.x&&0===e.z&&(e.x=.001),this._vertexData[L++]=e.x,this._vertexData[L++]=e.y,this._vertexData[L++]=e.z}else{let e=d.direction;this.isLocal&&(P.mv.TransformNormalToRef(e,this._emitterWorldMatrix,P.TmpVectors.mv[0]),e=P.TmpVectors.mv[0]),0===e.x&&0===e.z&&(e.x=.001),this._vertexData[L++]=e.x,this._vertexData[L++]=e.y,this._vertexData[L++]=e.z}this._useRampGradients&&d.remapData&&(this._vertexData[L++]=d.remapData.x,this._vertexData[L++]=d.remapData.y,this._vertexData[L++]=d.remapData.z,this._vertexData[L++]=d.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===v?v=this._epsilon:1===v&&(v=1-this._epsilon),0===p?p=this._epsilon:1===p&&(p=1-this._epsilon)),this._vertexData[L++]=v,this._vertexData[L++]=p)}_prepareParticle(e){}_createNewOnes(e){let d;for(let v=0;v<e&&this.jk.length!==this._capacity;v++){d=this._createParticle(),this.jk.push(d);let e=this._createQueueStart;for(;e;)e.process(d,this),e=e.nextItem;d._inheritParticleInfoToSubEmitters()}}_update(e){if(this._alive=this.jk.length>0,this.Pd.position){const e=this.Pd;this._emitterWorldMatrix=e.getWorldMatrix()}else{const e=this.Pd;this._emitterWorldMatrix=P.Matrix.Translation(e.x,e.y,e.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.jk),this._createNewOnes(e)}static _GetAttributeNamesOrOptions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=[l.i.PositionKind,l.i.ColorKind,"angle","offset","size"];return e&&P.push("cellIndex"),d||P.push("direction"),v&&P.push("remapData"),P}static _GetEffectCreationOptions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,de.c)(P),e&&P.push("particlesInfos"),d&&P.push("logarithmicDepthConstant"),v&&(P.push("vFogInfos"),P.push("vFogColor")),P}fillDefines(e,d){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,de.j)(this,this._scene,e),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&e.push("#define FOG")),this._isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&e.push("#define LOGARITHMICDEPTH"),d===z.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&e.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case 2:e.push("#define BILLBOARDY");break;case 8:case 9:e.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&e.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:e.push("#define BILLBOARDMODE_ALL")}v&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(e,d,v){d.push(...te._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),e.push(...te._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),v.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Pe.c)(e,this._imageProcessingConfigurationDefines),(0,Pe.b)(v,this._imageProcessingConfigurationDefines))}_getWrapper(e){const d=this._getCustomDrawWrapper(e);if(null!==d&&void 0!==d&&d.effect)return d;const v=[];this.fillDefines(v,e);const P=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let p=this._drawWrappers[P];p||(p=this._drawWrappers[P]=[]);let L=p[e];L||(L=new ee.b(this._engine),L.drawContext&&(L.drawContext.useInstancing=this._useInstancing),p[e]=L);const B=v.join("\n");if(L.defines!==B){const e=[],d=[],v=[];this.fillUniformsAttributesAndSamplerNames(d,e,v),L.setEffect(this._engine.createEffect("particles",e,d,v,B,void 0,void 0,void 0,void 0,this._shaderLanguage),B)}return L}animate(){var e;let d,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!v&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(v?this.preWarmStepOffset:(null===(e=this._scene)||void 0===e?void 0:e.getAnimationRatio())||1),this.manualEmitCount>-1)d=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let e=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const d=this._actualFrame/this.targetStopDuration;s.GetCurrentGradient(d,this._emitRateGradients,((d,v,P)=>{d!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=v.getFactor(),this._currentEmitRateGradient=d),e=(0,W.Lerp)(this._currentEmitRate1,this._currentEmitRate2,P)}))}d=e*this._scaledUpdateSpeed|0,this._newPartsExcess+=e*this._scaledUpdateSpeed-d}if(this._newPartsExcess>1&&(d+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?d=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(d),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!v){let e=0;for(let d=0;d<this.jk.length;d++){const v=this.jk[d];this._appendParticleVertices(e,v),e+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.jk.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(e,d){this._appendParticleVertex(e++,d,0,0),this._useInstancing||(this._appendParticleVertex(e++,d,1,0),this._appendParticleVertex(e++,d,1,1),this._appendParticleVertex(e++,d,0,1))}rebuild(){var e;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(e=this._spriteBuffer)||void 0===e||e._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!te.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(v.bind(v,13968)),Promise.resolve().then(v.bind(v,13903))])):await Promise.all([Promise.resolve().then(v.bind(v,13889)),Promise.resolve().then(v.bind(v,13877))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Pd||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==z.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(z.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(z.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(e){const d=this._getWrapper(e),v=d.effect,p=this._engine;p.enableEffect(d);const L=this.defaultViewMatrix??this._scene.getViewMatrix();if(v.setTexture("diffuseSampler",this.particleTexture),v.setMatrix("view",L),v.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const e=this.particleTexture.getBaseSize();v.setFloat3("particlesInfos",this.spriteCellWidth/e.width,this.spriteCellHeight/e.height,this.spriteCellWidth/e.width)}if(v.setVector2("translationPivot",this.translationPivot),v.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const e=this._scene.activeCamera;v.setVector3("eyePosition",e.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),v.setTexture("rampSampler",this._rampGradientsTexture));const B=v.defines;var X,z,W,V,k,g;(this._scene&&((0,de.d)(v,this,this._scene),this.applyFog&&(0,ve.e)(this._scene,void 0,v)),B.indexOf("#define BILLBOARDMODE_ALL")>=0&&(L.invertToRef(P.TmpVectors.Matrix[0]),v.setMatrix("invView",P.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?p.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,v):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,v)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?p.bindBuffers(this._vertexBuffers,null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._linesIndexBuffer:this._indexBuffer,v):p.bindBuffers(this._vertexBuffers,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBufferUseInstancing:null,v);(this.useLogarithmicDepth&&this._scene&&(0,ve.i)(B,v,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(v),this._setEngineBasedOnBlendMode(e),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(v),this._useInstancing)?null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?p.drawElementsType(6,0,10,this.jk.length):p.drawArraysType(7,0,4,this.jk.length):null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?p.drawElementsType(1,0,10*this.jk.length):p.drawElementsType(0,0,6*this.jk.length);return this.jk.length}render(){if(!this.isReady()||!this.jk.length)return 0;const e=this._engine;e.setState&&(e.setState(!1),this.forceDepthWrite&&e.setDepthWrite(!0));let d=0;return d=this.blendMode===z.BLENDMODE_MULTIPLYADD?this._render(z.BLENDMODE_MULTIPLY)+this._render(z.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),d}_onDispose(){}dispose(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(d,v),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const e=this._scene.sk.indexOf(this);e>-1&&this._scene.sk.splice(e,1),this._scene._activeParticleSystems.dispose()}this.Fd.notifyObservers(this),this.Fd.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}te.ForceGLSL=!1;var Ie,ce=v(12268);!function(e){e[e.ATTACHED=0]="ATTACHED",e[e.END=1]="END"}(Ie||(Ie={}));class be{constructor(e){if(this.particleSystem=e,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!e.Pd||!e.Pd.dispose){const d=(0,X.e)("BABYLON.AbstractMesh");e.Pd=new d("SubemitterSystemEmitter",e.Ae()),e._disposeEmitterOnDispose=!0}}clone(){let e=this.particleSystem.Pd;if(e){if(e instanceof P.mv)e=e.clone();else if(-1!==e.getClassName().indexOf("Mesh")){e=new((0,X.e)("BABYLON.Mesh"))("",e.Ae()),e.isVisible=!1}}else e=new P.mv;const d=new be(this.particleSystem.clone(this.particleSystem.name,e));return d.particleSystem.name+="Clone",d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem._disposeEmitterOnDispose=!0,d.particleSystem.disposeOnStop=!0,d}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem=this.particleSystem.serialize(e),d}static _ParseParticleSystem(e,d,v){throw(0,ce.e)("ParseParticle")}static Parse(e,d,v){const P=e.particleSystem,p=new be(be._ParseParticleSystem(P,d,v,!0));return p.type=e.type,p.inheritDirection=e.inheritDirection,p.inheritedVelocityAmount=e.inheritedVelocityAmount,p.particleSystem._isSubEmitter=!0,p}dispose(){this.particleSystem.dispose()}}var Me=v(12319);function se(e,d){const v=new D;return v.direction1=e,v.direction2=d,v}function ye(){return new U(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function je(){return new C(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Je(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.mv(0,1,0),v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.mv(0,1,0);return new q(e,d,v)}function Ee(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function ed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.mv(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.mv(0,1,0);return new G(e,d,v,p,L)}function dd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new g(e,d)}function vd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.mv(0,1,0),p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.mv(0,1,0);return new F(e,d,v,p)}const Pd=P.mv.Zero(),pd=P.mv.Zero(),Ld=P.mv.Zero();class Bd{constructor(){this.strength=0,this.position=P.mv.Zero()}_processParticle(e,d){this.position.subtractToRef(e.position,Pd);const v=Pd.lengthSquared()+1;Pd.normalize().scaleToRef(this.strength/v,pd),pd.scaleToRef(d._tempScaledUpdateSpeed,Ld),e.direction.addInPlace(Ld)}serialize(){return{position:this.position.Yd(),strength:this.strength}}}class Xd extends te{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=e=>{if(!this._subEmitters||0===this._subEmitters.length)return;const d=Math.floor(Math.random()*this._subEmitters.length);for(const v of this._subEmitters[d])if(1===v.type){const d=v.clone();e._inheritParticleInfoToSubEmitter(d),d.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(d.particleSystem),d.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(e,d){const v=se(e,d);return this.particleEmitterType=v,v}get flowMap(){return this._flowMap}set flowMap(e){this._flowMap!==e&&(this._flowMap=e,this._flowMapUpdate&&(ae(this._flowMapUpdate),this._flowMapUpdate=null),e&&(this._flowMapUpdate={process:e=>{var d;const v=null===(d=this.Ae())||void 0===d?void 0:d.getTransformMatrix();this._flowMap._processParticle(e,this.flowMapStrength*this._tempScaledUpdateSpeed,v)},previousItem:null,nextItem:null},Ye(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(e){this._attractors.push(e),1===this._attractors.length&&(this._attractorUpdate={process:e=>{for(const d of this._attractors)d._processParticle(e,this)},previousItem:null,nextItem:null},Ye(this._attractorUpdate,this._directionProcessing))}removeAttractor(e){const d=this._attractors.indexOf(e);-1!==d&&this._attractors.splice(d,1),0===this._attractors.length&&ae(this._attractorUpdate)}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(e)}createHemisphericEmitter(){const e=ye(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=e,e}createSphereEmitter(){const e=je(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=e,e}createDirectedSphereEmitter(){const e=Je(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.mv(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.mv(0,1,0));return this.particleEmitterType=e,e}createCylinderEmitter(){const e=Ee(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=e,e}createDirectedCylinderEmitter(){const e=ed(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.mv(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.mv(0,1,0));return this.particleEmitterType=e,e}createConeEmitter(){const e=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=e,e}createDirectedConeEmitter(){const e=vd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.mv(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.mv(0,1,0));return this.particleEmitterType=e,e}createBoxEmitter(e,d,v,P){const p=new k;return this.particleEmitterType=p,this.direction1=e,this.direction2=d,this.minEmitBox=v,this.maxEmitBox=P,p}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const e of this.subEmitters)e instanceof Xd?this._subEmitters.push([new be(e)]):e instanceof be?this._subEmitters.push([e]):e instanceof Array&&this._subEmitters.push(e)}_stopSubEmitters(){if(this.activeSubSystems){for(const e of this.activeSubSystems)e.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const e=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==e&&this._rootParticleSystem.activeSubSystems.splice(e,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(e){e&&this._stopSubEmitters()}_prepareParticle(e){if(this._subEmitters&&this._subEmitters.length>0){const d=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];e._attachedSubEmitters=[];for(const v of d)if(0===v.type){const d=v.clone();e._attachedSubEmitters.push(d),d.particleSystem.start()}}}_onDispose(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),e&&this.particles)for(const v of this.particles)if(v._attachedSubEmitters)for(let e=v._attachedSubEmitters.length-1;e>=0;e-=1)v._attachedSubEmitters[e].dispose();if(d&&this.activeSubSystems)for(let v=this.activeSubSystems.length-1;v>=0;v-=1)this.activeSubSystems[v].dispose();if(this._subEmitters&&this._subEmitters.length){for(let e=0;e<this._subEmitters.length;e++)for(const d of this._subEmitters[e])d.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Pd&&this.Pd.dispose&&this.Pd.dispose(!0)}static _Parse(e,d,v,p){let L;L=v instanceof Me.b?null:v;const z=(0,X.e)("BABYLON.Texture");if(z&&L&&(e.texture?d.particleTexture=z.Parse(e.texture,L,p):e.textureName&&(d.particleTexture=new z(p+e.textureName,L,!1,void 0===e.invertY||e.invertY),d.particleTexture.name=e.textureName)),e.emitterId||0===e.emitterId||void 0!==e.Pd?e.emitterId&&L?d.Pd=L.getLastMeshById(e.emitterId):d.Pd=P.mv.Nd(e.Pd):d.Pd=P.mv.Zero(),d.isLocal=!!e.isLocal,void 0!==e.renderingGroupId&&(d.renderingGroupId=e.renderingGroupId),void 0!==e.isBillboardBased&&(d.isBillboardBased=e.isBillboardBased),void 0!==e.billboardMode&&(d.billboardMode=e.billboardMode),void 0!==e.useLogarithmicDepth&&(d.useLogarithmicDepth=e.useLogarithmicDepth),e.animations){for(let v=0;v<e.animations.length;v++){const P=e.animations[v],p=(0,X.e)("BABYLON.Animation");p&&d.animations.push(p.Parse(P))}d.beginAnimationOnStart=e.beginAnimationOnStart,d.beginAnimationFrom=e.beginAnimationFrom,d.beginAnimationTo=e.beginAnimationTo,d.beginAnimationLoop=e.beginAnimationLoop}if(e.autoAnimate&&L&&L.beginAnimation(d,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),d.startDelay=0|e.startDelay,d.minAngularSpeed=e.minAngularSpeed,d.maxAngularSpeed=e.maxAngularSpeed,d.minSize=e.minSize,d.maxSize=e.maxSize,e.minScaleX&&(d.minScaleX=e.minScaleX,d.maxScaleX=e.maxScaleX,d.minScaleY=e.minScaleY,d.maxScaleY=e.maxScaleY),void 0!==e.preWarmCycles&&(d.preWarmCycles=e.preWarmCycles,d.preWarmStepOffset=e.preWarmStepOffset),void 0!==e.minInitialRotation&&(d.minInitialRotation=e.minInitialRotation,d.maxInitialRotation=e.maxInitialRotation),d.minLifeTime=e.minLifeTime,d.maxLifeTime=e.maxLifeTime,d.minEmitPower=e.minEmitPower,d.maxEmitPower=e.maxEmitPower,d.emitRate=e.emitRate,d.gravity=P.mv.Nd(e.gravity),e.noiseStrength&&(d.noiseStrength=P.mv.Nd(e.noiseStrength)),d.color1=B.Up.Nd(e.color1),d.color2=B.Up.Nd(e.color2),d.colorDead=B.Up.Nd(e.colorDead),d.updateSpeed=e.updateSpeed,d.targetStopDuration=e.targetStopDuration,d.blendMode=e.blendMode,e.colorGradients)for(const P of e.colorGradients)d.addColorGradient(P.gradient,B.Up.Nd(P.color1),P.color2?B.Up.Nd(P.color2):void 0);if(e.rampGradients){for(const v of e.rampGradients)d.addRampGradient(v.gradient,B.Kd.Nd(v.color));d.useRampGradients=e.useRampGradients}if(e.colorRemapGradients)for(const P of e.colorRemapGradients)d.addColorRemapGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(e.alphaRemapGradients)for(const P of e.alphaRemapGradients)d.addAlphaRemapGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(e.sizeGradients)for(const P of e.sizeGradients)d.addSizeGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(e.angularSpeedGradients)for(const P of e.angularSpeedGradients)d.addAngularSpeedGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(e.velocityGradients)for(const P of e.velocityGradients)d.addVelocityGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(e.dragGradients)for(const P of e.dragGradients)d.addDragGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(e.emitRateGradients)for(const P of e.emitRateGradients)d.addEmitRateGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(e.startSizeGradients)for(const P of e.startSizeGradients)d.addStartSizeGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(e.lifeTimeGradients)for(const P of e.lifeTimeGradients)d.addLifeTimeGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(e.limitVelocityGradients){for(const v of e.limitVelocityGradients)d.addLimitVelocityGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);d.limitVelocityDamping=e.limitVelocityDamping}if(e.noiseTexture&&L){const v=(0,X.e)("BABYLON.ProceduralTexture");d.noiseTexture=v.Parse(e.noiseTexture,L,p)}let W;if(e.particleEmitterType){switch(e.particleEmitterType.type){case"SphereParticleEmitter":W=new C;break;case"SphereDirectedParticleEmitter":W=new q;break;case"ConeEmitter":case"ConeParticleEmitter":W=new g;break;case"ConeDirectedParticleEmitter":W=new F;break;case"CylinderParticleEmitter":W=new w;break;case"CylinderDirectedParticleEmitter":W=new G;break;case"HemisphericParticleEmitter":W=new U;break;case"PointParticleEmitter":W=new D;break;case"MeshParticleEmitter":W=new n;break;case"CustomParticleEmitter":W=new h;break;default:W=new k}W.parse(e.particleEmitterType,L)}else W=new k,W.parse(e,L);d.particleEmitterType=W,d.startSpriteCellID=e.startSpriteCellID,d.endSpriteCellID=e.endSpriteCellID,d.spriteCellLoop=e.spriteCellLoop??!0,d.spriteCellWidth=e.spriteCellWidth,d.spriteCellHeight=e.spriteCellHeight,d.spriteCellChangeSpeed=e.spriteCellChangeSpeed,d.spriteRandomStartCell=e.spriteRandomStartCell,d.disposeOnStop=e.disposeOnStop??!1,d.manualEmitCount=e.manualEmitCount??-1}static Parse(e,d,v){let p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0;const X=e.name;let z,W,V=null,k=null;if(d instanceof Me.b?z=d:(W=d,z=W.getEngine()),e.customShader&&z.createEffectForParticles){k=e.customShader;const d=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"";V=z.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,d)}const g=new Xd(X,L||e.Od,d,V,e.isAnimationSheetEnabled);if(g.customShader=k,g._rootUrl=v,e.id&&(g.id=e.id),e.subEmitters){g.subEmitters=[];for(const P of e.subEmitters){const e=[];for(const p of P)e.push(be.Parse(p,d,v));g.subEmitters.push(e)}}if(e.attractors)for(const B of e.attractors){const e=new Bd;e.position=P.mv.Nd(B.position),e.strength=B.strength,g.addAttractor(e)}return Xd._Parse(e,g,d,v),e.textureMask&&(g.textureMask=B.Up.Nd(e.textureMask)),e.gW&&(g.gW=P.mv.Nd(e.gW)),e.preventAutoStart&&(g.preventAutoStart=e.preventAutoStart),p||g.preventAutoStart||g.start(),g}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};if(Xd._Serialize(d,this,e),d.textureMask=this.textureMask.Yd(),d.customShader=this.customShader,d.preventAutoStart=this.preventAutoStart,d.gW=this.gW.Yd(),this.subEmitters){d.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const v of this._subEmitters){const P=[];for(const d of v)P.push(d.serialize(e));d.subEmitters.push(P)}}if(this._attractors&&this._attractors.length){d.attractors=[];for(const e of this._attractors)d.attractors.push(e.serialize())}return d}static _Serialize(e,d,v){if(e.name=d.name,e.id=d.id,e.Od=d.getCapacity(),e.disposeOnStop=d.disposeOnStop,e.manualEmitCount=d.manualEmitCount,d.Pd.position){const v=d.Pd;e.emitterId=v.id}else{const v=d.Pd;e.Pd=v.Yd()}d.particleEmitterType&&(e.particleEmitterType=d.particleEmitterType.serialize()),d.particleTexture&&(v?e.texture=d.particleTexture.serialize():(e.textureName=d.particleTexture.name,e.invertY=!!d.particleTexture._invertY)),e.isLocal=d.isLocal,o.c.AppendSerializedAnimations(d,e),e.beginAnimationOnStart=d.beginAnimationOnStart,e.beginAnimationFrom=d.beginAnimationFrom,e.beginAnimationTo=d.beginAnimationTo,e.beginAnimationLoop=d.beginAnimationLoop,e.startDelay=d.startDelay,e.renderingGroupId=d.renderingGroupId,e.isBillboardBased=d.isBillboardBased,e.billboardMode=d.billboardMode,e.minAngularSpeed=d.minAngularSpeed,e.maxAngularSpeed=d.maxAngularSpeed,e.minSize=d.minSize,e.maxSize=d.maxSize,e.minScaleX=d.minScaleX,e.maxScaleX=d.maxScaleX,e.minScaleY=d.minScaleY,e.maxScaleY=d.maxScaleY,e.minEmitPower=d.minEmitPower,e.maxEmitPower=d.maxEmitPower,e.minLifeTime=d.minLifeTime,e.maxLifeTime=d.maxLifeTime,e.emitRate=d.emitRate,e.gravity=d.gravity.Yd(),e.noiseStrength=d.noiseStrength.Yd(),e.color1=d.color1.Yd(),e.color2=d.color2.Yd(),e.colorDead=d.colorDead.Yd(),e.updateSpeed=d.updateSpeed,e.targetStopDuration=d.targetStopDuration,e.blendMode=d.blendMode,e.preWarmCycles=d.preWarmCycles,e.preWarmStepOffset=d.preWarmStepOffset,e.minInitialRotation=d.minInitialRotation,e.maxInitialRotation=d.maxInitialRotation,e.startSpriteCellID=d.startSpriteCellID,e.spriteCellLoop=d.spriteCellLoop,e.endSpriteCellID=d.endSpriteCellID,e.spriteCellChangeSpeed=d.spriteCellChangeSpeed,e.spriteCellWidth=d.spriteCellWidth,e.spriteCellHeight=d.spriteCellHeight,e.spriteRandomStartCell=d.spriteRandomStartCell,e.isAnimationSheetEnabled=d.isAnimationSheetEnabled,e.useLogarithmicDepth=d.useLogarithmicDepth;const P=d.getColorGradients();if(P){e.colorGradients=[];for(const d of P){const v={gradient:d.gradient,color1:d.color1.Yd()};d.color2?v.color2=d.color2.Yd():v.color2=d.color1.Yd(),e.colorGradients.push(v)}}const p=d.getRampGradients();if(p){e.rampGradients=[];for(const d of p){const v={gradient:d.gradient,color:d.color.Yd()};e.rampGradients.push(v)}e.useRampGradients=d.useRampGradients}const L=d.getColorRemapGradients();if(L){e.colorRemapGradients=[];for(const d of L){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.colorRemapGradients.push(v)}}const B=d.getAlphaRemapGradients();if(B){e.alphaRemapGradients=[];for(const d of B){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.alphaRemapGradients.push(v)}}const X=d.getSizeGradients();if(X){e.sizeGradients=[];for(const d of X){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.sizeGradients.push(v)}}const z=d.getAngularSpeedGradients();if(z){e.angularSpeedGradients=[];for(const d of z){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.angularSpeedGradients.push(v)}}const W=d.getVelocityGradients();if(W){e.velocityGradients=[];for(const d of W){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.velocityGradients.push(v)}}const V=d.getDragGradients();if(V){e.dragGradients=[];for(const d of V){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.dragGradients.push(v)}}const k=d.getEmitRateGradients();if(k){e.emitRateGradients=[];for(const d of k){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.emitRateGradients.push(v)}}const g=d.getStartSizeGradients();if(g){e.startSizeGradients=[];for(const d of g){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.startSizeGradients.push(v)}}const F=d.getLifeTimeGradients();if(F){e.lifeTimeGradients=[];for(const d of F){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.lifeTimeGradients.push(v)}}const w=d.getLimitVelocityGradients();if(w){e.limitVelocityGradients=[];for(const d of w){const v={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?v.factor2=d.factor2:v.factor2=d.factor1,e.limitVelocityGradients.push(v)}e.limitVelocityDamping=d.limitVelocityDamping}d.noiseTexture&&(e.noiseTexture=d.noiseTexture.serialize())}clone(e,d){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P={...this._customWrappers};let p=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){p=this.customShader;const e=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"",d=L.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,e);P[0]?P[0].effect=d:this.setCustomEffect(d,0)}const B=this.serialize(v),X=Xd.Parse(B,this._scene||this._engine,this._rootUrl);return X.name=e,X.customShader=p,X._customWrappers=P,void 0===d&&(d=this.Pd),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.Pd=d,this.preventAutoStart||X.start(),X}}Xd.BILLBOARDMODE_Y=2,Xd.BILLBOARDMODE_ALL=7,Xd.BILLBOARDMODE_STRETCHED=8,Xd.BILLBOARDMODE_STRETCHED_LOCAL=9,be._ParseParticleSystem=Xd.Parse;var zd=v(12659),Wd=v(12653),Vd=v(12550);Vd.b.prototype.createTransformFeedback=function(){const e=this._gl.createTransformFeedback();if(!e)throw new Error("Unable to create Transform Feedback");return e},Vd.b.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},Vd.b.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},Vd.b.prototype.beginTransformFeedback=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},Vd.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Vd.b.prototype.setTranformFeedbackVaryings=function(e,d){this._gl.transformFeedbackVaryings(e,d,this._gl.INTERLEAVED_ATTRIBS)},Vd.b.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e?e.underlyingResource:null)},Vd.b.prototype.readTransformFeedbackBuffer=function(e){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e)};const kd="clipPlaneFragmentDeclaration2",gd="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";x.d.IncludesShadersStore[kd]||(x.d.IncludesShadersStore[kd]=gd);v(13765),v(13772),v(13781),v(13784),v(13792),v(13798),v(13806),v(13811);const Fd="gpuRenderParticlesPixelShader",wd="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";x.d.ShadersStore[Fd]||(x.d.ShadersStore[Fd]=wd);const Gd="clipPlaneVertexDeclaration2",Ud="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";x.d.IncludesShadersStore[Gd]||(x.d.IncludesShadersStore[Gd]=Ud);v(13820),v(13826),v(13831),v(13840);const Dd="gpuRenderParticlesVertexShader",Cd="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";x.d.ShadersStore[Dd]||(x.d.ShadersStore[Dd]=Cd);class qd extends z{static get IsSupported(){if(!J.c.LastCreatedEngine)return!1;const e=J.c.LastCreatedEngine.getCaps();return e.supportTransformFeedbacks||e.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(e){this._maxActiveParticleCount=Math.min(e,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(e){this.maxActiveParticleCount=e}createPointEmitter(e,d){const v=se(e,d);return this.particleEmitterType=v,v}createHemisphericEmitter(){const e=ye(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=e,e}createSphereEmitter(){const e=je(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=e,e}createDirectedSphereEmitter(){const e=Je(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.mv(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.mv(0,1,0));return this.particleEmitterType=e,e}createCylinderEmitter(){const e=Ee(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=e,e}createDirectedCylinderEmitter(){const e=ed(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.mv(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.mv(0,1,0));return this.particleEmitterType=e,e}createConeEmitter(){const e=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=e,e}createDirectedConeEmitter(){const e=vd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.mv(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.mv(0,1,0));return this.particleEmitterType=e,e}createBoxEmitter(e,d,v,P){const p=new k;return this.particleEmitterType=p,this.direction1=e,this.direction2=d,this.minEmitBox=v,this.maxEmitBox=P,p}get flowMap(){return this._flowMap}set flowMap(e){this._flowMap!==e&&(this._flowMap=e)}isReady(){if(!this.Pd||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Xd.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Xd.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Xd.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";e?setTimeout((()=>{this.start(0)}),e):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var e;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(e=this._customWrappers[d])||void 0===e?void 0:e.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[e]??this._customWrappers[0]}setCustomEffect(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new ee.b(this._engine),this._customWrappers[d].effect=e}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new y.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(e,d,v){return super._removeGradientAndTexture(e,d,v),this._releaseBuffers(),this}addColorGradient(e,d){this._colorGradients||(this._colorGradients=[]);const v=new c(e,d);return this._colorGradients.push(v),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(e&&this._colorGradients.sort(((e,d)=>e.gradient<d.gradient?-1:e.gradient>d.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(e){return this._removeGradientAndTexture(e,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const d in this._drawWrappers){var e;null===(e=this._drawWrappers[d].drawContext)||void 0===e||e.reset()}}_addFactorGradient(e,d,v){const P=new M(d,v);e.push(P),this._releaseBuffers()}addSizeGradient(e,d){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,d),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(e){return this._removeGradientAndTexture(e,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(e,d){if(!e)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&e.sort(((e,d)=>e.gradient<d.gradient?-1:e.gradient>d.gradient?1:0));const v=this;v[d]&&(v[d].dispose(),v[d]=null)}addAngularSpeedGradient(e,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,d),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(e){return this._removeGradientAndTexture(e,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(e,d){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,d),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(e){return this._removeGradientAndTexture(e,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(e,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,d),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(e){return this._removeGradientAndTexture(e,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(e,d){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,d),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(e){return this._removeGradientAndTexture(e,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(e){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(e,d,v){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(e),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Fd=new y.d,this.onStoppedObservable=new y.d,this.onStartedObservable=new y.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,v&&"Scene"!==v.getClassName()?(this._engine=v,this.defaultProjectionMatrix=P.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=v||J.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.sk.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,X.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,X.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ee.b(this._engine)},this._customWrappers[0].effect=p,this._drawWrappers={0:new ee.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(d=d??{}).randomTextureSize||delete d.randomTextureSize;const B={Od:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...d},z=d;isFinite(z)&&(B.Od=z),this._capacity=B.Od,this._maxActiveParticleCount=B.Od,this._currentActiveCount=0,this._isAnimationSheetEnabled=L,this.particleEmitterType=new k;const W=Math.min(this._engine.getCaps().maxTextureSize,B.randomTextureSize);let V=[];for(let P=0;P<W;++P)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture=new j.b(new Float32Array(V),W,1,5,v,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,V=[];for(let P=0;P<W;++P)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture2=new j.b(new Float32Array(V),W,1,5,v,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=W}_reset(){this._releaseBuffers()}_createVertexBuffers(e,d,v){const P={};P.position=d.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let p=3;P.age=d.createVertexBuffer("age",p,1,this._attributesStrideSize,!0),p+=1,P.size=d.createVertexBuffer("size",p,3,this._attributesStrideSize,!0),p+=3,P.life=d.createVertexBuffer("life",p,1,this._attributesStrideSize,!0),p+=1,p+=4,this.billboardMode===Xd.BILLBOARDMODE_STRETCHED&&(P.direction=d.createVertexBuffer("direction",p,3,this._attributesStrideSize,!0)),p+=3,this._platform.alignDataInBuffer&&(p+=1),this.particleEmitterType instanceof h&&(p+=3,this._platform.alignDataInBuffer&&(p+=1)),this._colorGradientsTexture||(P.color=d.createVertexBuffer("color",p,4,this._attributesStrideSize,!0),p+=4),this._isBillboardBased||(P.initialDirection=d.createVertexBuffer("initialDirection",p,3,this._attributesStrideSize,!0),p+=3,this._platform.alignDataInBuffer&&(p+=1)),this.noiseTexture&&(P.noiseCoordinates1=d.createVertexBuffer("noiseCoordinates1",p,3,this._attributesStrideSize,!0),p+=3,this._platform.alignDataInBuffer&&(p+=1),P.noiseCoordinates2=d.createVertexBuffer("noiseCoordinates2",p,3,this._attributesStrideSize,!0),p+=3,this._platform.alignDataInBuffer&&(p+=1)),P.angle=d.createVertexBuffer("angle",p,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?p++:p+=2,this._isAnimationSheetEnabled&&(P.cellIndex=d.createVertexBuffer("cellIndex",p,1,this._attributesStrideSize,!0),p+=1,this.spriteRandomStartCell&&(P.cellStartOffset=d.createVertexBuffer("cellStartOffset",p,1,this._attributesStrideSize,!0),p+=1)),P.offset=v.createVertexBuffer("offset",0,2),P.uv=v.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(P),this._platform.createVertexBuffers(e,P),this.resetDrawCache()}_initialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!e)return;const d=this._engine,v=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof h&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const p=this.particleEmitterType instanceof h,L=P.TmpVectors.mv[0];let B=0;for(let P=0;P<this._capacity;P++)if(v.push(0),v.push(0),v.push(0),v.push(0),v.push(0),v.push(0),v.push(0),v.push(0),v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),p?(this.particleEmitterType.particleDestinationGenerator(P,null,L),v.push(L.x),v.push(L.y),v.push(L.z)):(v.push(0),v.push(0),v.push(0)),this._platform.alignDataInBuffer&&v.push(0),B+=16,p&&(this.particleEmitterType.particlePositionGenerator(P,null,L),v.push(L.x),v.push(L.y),v.push(L.z),this._platform.alignDataInBuffer&&v.push(0),B+=4),this._colorGradientsTexture||(v.push(0),v.push(0),v.push(0),v.push(0),B+=4),this.isBillboardBased||(v.push(0),v.push(0),v.push(0),this._platform.alignDataInBuffer&&v.push(0),B+=4),this.noiseTexture&&(v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),this._platform.alignDataInBuffer&&v.push(0),v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),this._platform.alignDataInBuffer&&v.push(0),B+=8),v.push(0),B+=1,this._angularSpeedGradientsTexture||(v.push(0),B+=1),this._isAnimationSheetEnabled&&(v.push(0),B+=1,this.spriteRandomStartCell&&(v.push(0),B+=1)),this._platform.alignDataInBuffer){let e=3-(B+3&3);for(B+=e;e-- >0;)v.push(0)}const X=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),z=this._platform.createParticleBuffer(v),W=this._platform.createParticleBuffer(v);this._buffer0=new l.e(d,z,!1,this._attributesStrideSize),this._buffer1=new l.e(d,W,!1,this._attributesStrideSize),this._spriteBuffer=new l.e(d,X,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let e=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(e+="\n#define BILLBOARD"),this._colorGradientsTexture&&(e+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(e+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(e+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(e+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(e+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(e+="\n#define DRAGGRADIENTS"),this._flowMap&&(e+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(e+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(e+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(e+="\n#define NOISE"),this.isLocal&&(e+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===e||(this._cachedUpdateDefines=e,this._updateBuffer=this._platform.createUpdateBuffer(e)),this._platform.isUpdateBufferReady()}_getWrapper(e){const d=this._getCustomDrawWrapper(e);if(null!==d&&void 0!==d&&d.effect)return d;const v=[];this.fillDefines(v,e);let P=this._drawWrappers[e];P||(P=new ee.b(this._engine),P.drawContext&&(P.drawContext.useInstancing=!0),this._drawWrappers[e]=P);const p=v.join("\n");if(P.defines!==p){const e=[],d=[],v=[];this.fillUniformsAttributesAndSamplerNames(d,e,v),P.setEffect(this._engine.createEffect("gpuRenderParticles",e,d,v,p),p)}return P}static _GetAttributeNamesOrOptions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const p=[l.i.PositionKind,"age","life","size","angle"];return e||p.push(l.i.ColorKind),d&&p.push("cellIndex"),v||p.push("initialDirection"),P&&p.push("direction"),p.push("offset",l.i.UVKind),p}static _GetEffectCreationOptions(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=["emitterWM","gW","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,de.c)(P),e&&P.push("sheetInfos"),d&&P.push("logarithmicDepthConstant"),v&&(P.push("vFogInfos"),P.push("vFogColor")),P}fillDefines(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,de.j)(this,this._scene,e),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Wd.d.FOGMODE_NONE&&e.push("#define FOG")),d===Xd.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this.isLocal&&e.push("#define LOCAL"),this.useLogarithmicDepth&&e.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case Xd.BILLBOARDMODE_Y:e.push("#define BILLBOARDY");break;case Xd.BILLBOARDMODE_STRETCHED:e.push("#define BILLBOARDSTRETCHED");break;case Xd.BILLBOARDMODE_ALL:e.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&e.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),v&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(e,d,v){d.push(...qd._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Xd.BILLBOARDMODE_STRETCHED)),e.push(...qd._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),v.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(zd.e.PrepareUniforms(e,this._imageProcessingConfigurationDefines),zd.e.PrepareSamplers(v,this._imageProcessingConfigurationDefines))}animate(){var e;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(d?this.preWarmStepOffset:(null===(e=this._scene)||void 0===e?void 0:e.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(e,d){const v=this[d];if(!e||!e.length||v)return;const P=new Float32Array(this._rawTextureWidth);for(let p=0;p<this._rawTextureWidth;p++){const d=p/this._rawTextureWidth;s.GetCurrentGradient(d,e,((e,d,v)=>{P[p]=(0,W.Lerp)(e.factor1,d.factor1,v)}))}this[d]=j.b.CreateRTexture(P,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[d].name=d.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const e=new Uint8Array(4*this._rawTextureWidth),d=B.TmpColors.Up[0];for(let v=0;v<this._rawTextureWidth;v++){const P=v/this._rawTextureWidth;s.GetCurrentGradient(P,this._colorGradients,((P,p,L)=>{B.Up.LerpToRef(P.color1,p.color1,L,d),e[4*v]=255*d.r,e[4*v+1]=255*d.g,e[4*v+2]=255*d.b,e[4*v+3]=255*d.a}))}this._colorGradientsTexture=j.b.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(e,d){var v,p,L,B;const X=this._getWrapper(e),z=X.effect;this._engine.enableEffect(X);const W=(null===(v=this._scene)||void 0===v?void 0:v.getViewMatrix())||P.Matrix.IdentityReadOnly;if(z.setMatrix("view",W),z.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),z.setTexture("diffuseSampler",this.particleTexture),z.setVector2("translationPivot",this.translationPivot),z.setVector3("gW",this.gW),this.isLocal&&z.setMatrix("emitterWM",d),this._colorGradientsTexture?z.setTexture("colorGradientSampler",this._colorGradientsTexture):z.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const e=this.particleTexture.getBaseSize();z.setFloat3("sheetInfos",this.spriteCellWidth/e.width,this.spriteCellHeight/e.height,e.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const e=this._scene.activeCamera;z.setVector3("eyePosition",e.globalPosition)}const V=z.defines;if(this._scene&&((0,de.d)(z,this,this._scene),this.applyFog&&(0,ve.e)(this._scene,void 0,z)),V.indexOf("#define BILLBOARDMODE_ALL")>=0){const e=W.clone();e.invert(),z.setMatrix("invView",e)}return this.useLogarithmicDepth&&this._scene&&(0,ve.i)(V,z,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(z),this._setEngineBasedOnBlendMode(e),this._platform.bindDrawBuffers(this._targetIndex,z,null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(z),null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(e){if(!this.Pd||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!e)if(this.Pd.position){e=this.Pd.getWorldMatrix()}else{const d=this.Pd;e=P.TmpVectors.Matrix[0],P.Matrix.TranslationToRef(d.x,d.y,d.z,e)}const d=this._engine,v=d.getDepthWrite();if(d.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const e=this.Ae();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",e.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",e),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const p=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=p,d.setDepthWrite(v)}render(){let e,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!d&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let e=0;e<this.preWarmCycles;e++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const e=0|this._accumulatedCount;this._accumulatedCount-=e,this._currentActiveCount+=e}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Pd.position){e=this.Pd.getWorldMatrix()}else{const d=this.Pd;e=P.TmpVectors.Matrix[0],P.Matrix.TranslationToRef(d.x,d.y,d.z,e)}const p=this._engine;this.updateInAnimate||this._update(e);let L=0;return d||v||(p.setState(!1),this.forceDepthWrite&&p.setDepthWrite(!0),L=this.blendMode===Xd.BLENDMODE_MULTIPLYADD?this._render(Xd.BLENDMODE_MULTIPLY,e)+this._render(Xd.BLENDMODE_ADD,e):this._render(this.blendMode,e),this._engine.setAlphaMode(0)),L}rebuild(){const e=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(e,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,e()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const d in this._drawWrappers){this._drawWrappers[d].dispose()}if(this._drawWrappers={},this._scene){const e=this._scene.sk.indexOf(this);e>-1&&this._scene.sk.splice(e,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let d=0;d<this._renderVertexBuffers.length;++d){const e=this._renderVertexBuffers[d];for(const d in e)e[d].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Fd.notifyObservers(this),this.Fd.clear()}clone(e,d){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P={...this._customWrappers};let p=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){p=this.customShader;const e=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"";P[0]=L.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,e,void 0,void 0,void 0,this)}const B=this.serialize(v),X=qd.Parse(B,this._scene||this._engine,this._rootUrl);return X.name=e,X.customShader=p,X._customWrappers=P,void 0===d&&(d=this.Pd),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.Pd=d,X}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return Xd._Serialize(d,this,e),d.activeParticleCount=this.activeParticleCount,d.randomTextureSize=this._randomTextureSize,d.customShader=this.customShader,d}static Parse(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0;const L=e.name;let B,X;d instanceof Me.b?B=d:(X=d,B=X.getEngine());const z=new qd(L,{Od:p||e.Od,randomTextureSize:e.randomTextureSize},d,null,e.isAnimationSheetEnabled);if(z._rootUrl=v,e.customShader&&B.createEffectForParticles){const d=e.customShader,v=d.shaderOptions.defines.length>0?d.shaderOptions.defines.join("\n"):"",P=B.createEffectForParticles(d.shaderPath.fragmentElement,d.shaderOptions.uniforms,d.shaderOptions.samplers,v,void 0,void 0,void 0,z);z.setCustomEffect(P,0),z.customShader=d}return e.id&&(z.id=e.id),e.activeParticleCount&&(z.activeParticleCount=e.activeParticleCount),Xd._Parse(e,z,d,v),e.preventAutoStart&&(z.preventAutoStart=e.preventAutoStart),P||z.preventAutoStart||z.start(),z}}var hd=v(12240),ld=v(13849),nd=v(12782);class Ad{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(e){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const d of this.systems)d.Pd=e;this._emitterNode=e}setEmitterAsSphere(e,d,v){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:e,renderingGroupId:d};const P=(0,ld.b)("emitterSphere",{diameter:e.diameter,segments:e.segments},v);P.renderingGroupId=d;const p=new nd.Sd("emitterSphereMaterial",v);p.emissiveColor=e.color,P.material=p;for(const L of this.systems)L.Pd=P;this._emitterNode=P}start(e){for(const d of this.systems)e&&(d.Pd=e),d.start()}dispose(){for(const e of this.systems)e.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={systems:[]};for(const v of this.systems)d.systems.push(v.serialize(e));return this._emitterNode&&(d.Pd=this._emitterCreationOptions),d}static Parse(e,d){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0;const p=new Ad,L=this.BaseAssetsUrl+"/textures/";d=d||J.c.LastCreatedScene;for(const B of e.systems)p.systems.push(v?qd.Parse(B,d,L,!0,P):Xd.Parse(B,d,L,!0,P));if(e.Pd){const v=e.Pd.options;if("Sphere"===e.Pd.kind)p.setEmitterAsSphere({diameter:v.diameter,segments:v.segments,color:B.Kd.Nd(v.color)},e.Pd.renderingGroupId,d)}return p}}Ad.BaseAssetsUrl="https://assets.babylonjs.com/particles";var xd=v(12277);class id{static CreateDefault(e){let d,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,P=arguments.length>2?arguments[2]:void 0;d=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new qd("default system",{Od:v},P):new Xd("default system",v,P),d.Pd=e;const p=hd.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return d.particleTexture=new K.e(p,d.Ae()),d.createConeEmitter(.1,Math.PI/4),d.color1=new B.Up(1,1,1,1),d.color2=new B.Up(1,1,1,1),d.colorDead=new B.Up(1,1,1,0),d.minSize=.1,d.maxSize=.1,d.minEmitPower=2,d.maxEmitPower=2,d.updateSpeed=1/60,d.emitRate=30,d}static CreateAsync(e,d){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0;d||(d=J.c.LastCreatedScene);const p={};return d.addPendingData(p),new Promise(((L,B)=>{if(v&&!qd.IsSupported)return d.removePendingData(p),B("Particle system with GPU is not supported.");hd.Tools.LoadFile(`${id.BaseAssetsUrl}/systems/${e}.json`,(e=>{d.removePendingData(p);const B=JSON.parse(e.toString());return L(Ad.Parse(B,d,v,P))}),void 0,void 0,void 0,(()=>(d.removePendingData(p),B(`An error occurred with the creation of your particle system. Check if your type '${e}' exists.`))))}))}static ExportSet(e){const d=new Ad;for(const v of e)d.systems.push(v);return d}static ParseFromFileAsync(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",L=arguments.length>5?arguments[5]:void 0;return new Promise(((B,X)=>{const z=new xd.d;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const d=JSON.parse(z.responseText);let X;X=P?qd.Parse(d,v,p,!1,L):Xd.Parse(d,v,p,!1,L),e&&(X.name=e),B(X)}else X("Unable to load the particle system")})),z.open("GET",d),z.send()}))}static ParseFromSnippetAsync(e,d){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",p=arguments.length>4?arguments[4]:void 0;if("_BLANK"===e){const e=this.CreateDefault(null);return e.start(),Promise.resolve(e)}return new Promise(((L,B)=>{const X=new xd.d;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const B=JSON.parse(JSON.parse(X.responseText).jsonPayload),z=JSON.parse(B.particleSystem);let W;W=v?qd.Parse(z,d,P,!1,p):Xd.Parse(z,d,P,!1,p),W.snippetId=e,L(W)}else B("Unable to load the snippet "+e)})),X.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),X.send()}))}}id.BaseAssetsUrl=Ad.BaseAssetsUrl,id.SnippetUrl="https://snippet.babylonjs.com",id.CreateFromSnippetAsync=id.ParseFromSnippetAsync;var mv=v(12864),rd=v(12681),Zd=v(13856);(0,Zd.e)(rd.c.NAME_PARTICLESYSTEM,((e,d,v,P)=>{const p=(0,Zd.f)(rd.c.NAME_PARTICLESYSTEM);if(p&&void 0!==e.sk&&null!==e.sk)for(let L=0,B=e.sk.length;L<B;L++){const B=e.sk[L];v.sk.push(p(B,d,P))}})),(0,Zd.b)(rd.c.NAME_PARTICLESYSTEM,((e,d,v)=>{if(e.activeParticleCount){return qd.Parse(e,d,v)}return Xd.Parse(e,d,v)})),Me.b.prototype.createEffectForParticles=function(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",L=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0,z=arguments.length>7?arguments[7]:void 0,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,V=arguments.length>9?arguments[9]:void 0,k=[],g=[];const F=[];return z?z.fillUniformsAttributesAndSamplerNames(g,k,F):(k=Xd._GetAttributeNamesOrOptions(),g=Xd._GetEffectCreationOptions()),-1===p.indexOf(" BILLBOARD")&&(p+="\n#define BILLBOARD\n"),null!==z&&void 0!==z&&z.isAnimationSheetEnabled&&-1===p.indexOf(" ANIMATESHEET")&&(p+="\n#define ANIMATESHEET\n"),-1===P.indexOf("diffuseSampler")&&P.push("diffuseSampler"),this.createEffect({vertex:V??(null===z||void 0===z?void 0:z.vertexShaderName)??"particles",fragmentElement:e},k,g.concat(d),F.concat(P),p,L,B,X,void 0,W,(async()=>{0===W?await Promise.resolve().then(v.bind(v,13889)):await Promise.resolve().then(v.bind(v,13968))}))},mv.b.prototype.getEmittedParticleSystems=function(){const e=[];for(let d=0;d<this.Ae().sk.length;d++){const v=this.Ae().sk[d];v.Pd===this&&e.push(v)}return e},mv.b.prototype.getHierarchyEmittedParticleSystems=function(){const e=[],d=this.getDescendants();d.push(this);for(let v=0;v<this.Ae().sk.length;v++){const P=this.Ae().sk[v],p=P.Pd;p.position&&-1!==d.indexOf(p)&&e.push(P)}return e};v(12752),v(12760),v(12839);v(12847),v(13864),v(12620),v(12742),v(12888);v(12615);var fd;v(13868),v(12446);!function(e){e[e.Color=2]="Color",e[e.UV=1]="UV",e[e.Random=0]="Random",e[e.Stated=3]="Stated"}(fd||(fd={}));var Td=v(12643);const Sd=new P.mv(0,0,0),od=new P.mv(0,0,0),Kd=new P.mv(0,0,0);class Qd{constructor(e,d,v){this.width=e,this.height=d,this.data=v}processFlowable(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2?arguments[2]:void 0;if(!v)return;v instanceof P.Matrix?P.mv.TransformCoordinatesToRef(e.position,v,Kd):(Kd.x=v.x,Kd.y=v.y,Kd.z=v.z);const p=.5*Kd.x+.5,L=1-(.5*Kd.y+.5),B=Math.floor(p*this.width),X=Math.floor(L*this.height);if(B<0||B>=this.width||X<0||X>=this.height)return;const z=4*(X*this.width+B),W=this.data[z]/255*2-1,V=this.data[z+1]/255*2-1,k=this.data[z+2]/255*2-1,g=this.data[z+3]/255;Sd.set(W,V,k),Sd.scaleToRef(d*g,od),e.direction.addInPlace(od)}_processParticle(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2?arguments[2]:void 0;this.processFlowable(e,d,v)}static async FromUrlAsync(e){return await new Promise(((d,v)=>{const P=document.createElement("canvas"),p=P.getContext("2d");let L=null;const B=new Image;B.crossOrigin="anonymous",B.src=e,B.onerror=d=>{v(new Error(`Failed to load image: ${e} : ${d}`))},B.onload=()=>{P.width=B.width,P.height=B.height,p.drawImage(B,0,0),L=p.getImageData(0,0,P.width,P.height),d(new Qd(P.width,P.height,L.data))}}))}static async ExtractFromTextureAsync(e){return await new Promise(((d,v)=>{if(!e.isReady())return void e.onLoadObservable.addOnce((async()=>{try{const v=await this.ExtractFromTextureAsync(e);d(v)}catch(P){v(P)}}));const P=e.getSize();Td.h.GetTextureDataAsync(e,P.width,P.height).then((e=>{d(new Qd(P.width,P.height,new Uint8ClampedArray(e)))})).catch(v)}))}}var Nd,ud,Od,Rd,Yd,Hd,ad,td,Id;!function(e){e[e.Int=1]="Int",e[e.Float=2]="Float",e[e.Vector2=4]="Vector2",e[e.mv=8]="mv",e[e.Matrix=16]="Matrix",e[e.Particle=32]="Particle",e[e.Texture=64]="Texture",e[e.Up=128]="Up",e[e.FloatGradient=256]="FloatGradient",e[e.Vector2Gradient=512]="Vector2Gradient",e[e.Vector3Gradient=1024]="Vector3Gradient",e[e.Color4Gradient=2048]="Color4Gradient",e[e.System=4096]="System",e[e.AutoDetect=8192]="AutoDetect",e[e.BasedOnInput=16384]="BasedOnInput",e[e.Undefined=32768]="Undefined",e[e.All=65535]="All"}(Nd||(Nd={})),function(e){e[e.Compatible=0]="Compatible",e[e.TypeIncompatible=1]="TypeIncompatible",e[e.HierarchyIssue=2]="HierarchyIssue"}(ud||(ud={})),function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(Od||(Od={}));class cd{get direction(){return this._direction}get type(){if(this._type===Nd.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Nd.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(e){this._type=e}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((e=>e.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(e,d,v){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Nd.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new y.d,this.onDisconnectionObservable=new y.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=d,this.name=e,this._direction=v}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(e){var d;return this.isConnected?null!==(d=this._connectedPoint)&&void 0!==d&&d._storedFunction?this._connectedPoint._storedFunction(e):this._connectedPoint._storedValue:this.value}canConnectTo(e){return 0===this.checkCompatibilityState(e)}checkCompatibilityState(e){const d=this._ownerBlock,v=e.ownerBlock;if(this.type!==e.type&&e.innerType!==Nd.AutoDetect)return e.acceptedConnectionPointTypes&&-1!==e.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(e.excludedConnectionPointTypes&&-1!==e.excludedConnectionPointTypes.indexOf(this.type))return 1;let P=v,p=d;return 0===this.direction&&(P=d,p=v),P.isAnAncestorOf(p)?2:0}connectTo(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(e))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${e.ownerBlock.name}".${e.name}`;return this._endpoints.push(e),e._connectedPoint=this,this.onConnectionObservable.notifyObservers(e),e.onConnectionObservable.notifyObservers(this),this}disconnectFrom(e){const d=this._endpoints.indexOf(e);return-1===d||(this._endpoints.splice(d,1),e._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(e),e.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(e){let d=1;for(;d<Nd.All;)e&d||this.excludedConnectionPointTypes.push(d),d<<=1}serialize(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const d={};return d.name=this.name,d.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Yd?(d.valueType="BABYLON."+this.value.getClassName(),d.value=this.value.Yd()):(d.valueType="number",d.value=this.value)),e&&this.connectedPoint&&(d.inputName=this.name,d.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,d.targetConnectionName=this.connectedPoint.name,d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),d}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class bd{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(e){this._name=e}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(e){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new y.d,this.Fd=new y.d,this.onInputChangedObservable=new y.d,this.visibleOnFrame=!1,this._name=e,this.uniqueId=Q.c.UniqueId}_inputRename(e){return e}_outputRename(e){return e}isAnAncestorOf(e){for(const d of this._outputs)if(d.hasEndpoints)for(const v of d.endpoints){if(v.ownerBlock===e)return!0;if(v.ownerBlock.isAnAncestorOf(e))return!0}return!1}isAnAncestorOfType(e){if(this.getClassName()===e)return!0;for(const d of this._outputs)if(d.hasEndpoints)for(const v of d.endpoints)if(v.ownerBlock.isAnAncestorOfType(e))return!0;return!1}getInputByName(e){const d=this._inputs.filter((d=>d.name===e));return d.length?d[0]:null}_linkConnectionTypes(e,d){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[d]._acceptedConnectionPointType=this._inputs[e]:(this._inputs[e]._linkedConnectionSource=this._inputs[d],this._inputs[e]._isMainLinkSource=!0),this._inputs[d]._linkedConnectionSource=this._inputs[e]}registerInput(e,d){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0;const B=new cd(e,this,0);return B.type=d,B.isOptional=v,B.defaultValue=P,B.value=P,B.valueMin=p,B.valueMax=L,this._inputs.push(B),this.onInputChangedObservable.notifyObservers(B),this}registerOutput(e,d,v){return(v=v??new cd(e,this,1)).type=d,this._outputs.push(v),this}_build(e){}_customBuildStep(e){}build(e){if(this._buildId===e.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((e=>e.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=e.buildId;for(const d of this._inputs){if(!d.connectedPoint){d.isOptional||e.notConnectedNonOptionalInputs.push(d);continue}const v=d.connectedPoint.ownerBlock;v&&v!==this&&!v.isSystem&&v.build(e)}return this._customBuildStep(e),e.verbose&&N.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(e),this.onBuildObservable.notifyObservers(this),!1}serialize(){const e={};e.customType="BABYLON."+this.getClassName(),e.id=this.uniqueId,e.name=this.name,e.visibleOnFrame=this.visibleOnFrame,e.inputs=[],e.outputs=[];for(const d of this.inputs)e.inputs.push(d.serialize());for(const d of this.outputs)e.outputs.push(d.serialize(!1));return e}_deserialize(e){this._name=e.name,this.comments=e.comments,this.visibleOnFrame=!!e.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(e)}_deserializePortDisplayNamesAndExposedOnFrame(e){const d=e.inputs,v=e.outputs;if(d)for(const P of d){const e=this.inputs.find((e=>e.name===P.name));if(!e)return;if(P.displayName&&(e.displayName=P.displayName),P.isExposedOnFrame&&(e.isExposedOnFrame=P.isExposedOnFrame,e.exposedPortPosition=P.exposedPortPosition),void 0!==P.value&&null!==P.value)if("number"===P.valueType)e.value=P.value;else{const d=(0,X.e)(P.valueType);d&&(e.value=d.Nd(P.value))}}if(v)for(let P=0;P<v.length;P++){const e=v[P];e.displayName&&(this.outputs[P].displayName=e.displayName),e.isExposedOnFrame&&(this.outputs[P].isExposedOnFrame=e.isExposedOnFrame,this.outputs[P].exposedPortPosition=e.exposedPortPosition)}}clone(){const e=this.serialize(),d=(0,X.e)(e.customType);if(d){const v=new d;return v._deserialize(e),v}return null}dispose(){this.Fd.notifyObservers(this),this.Fd.clear();for(const e of this.inputs)e.dispose();for(const e of this.outputs)e.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Md(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",P=arguments.length>3?arguments[3]:void 0;return(p,L)=>{let B=p._propStore;B||(B=[],p._propStore=B),B.push({propertyName:L,displayName:e,type:d,groupName:v,options:P??{},className:p.getClassName()})}}(0,T.e)([(0,S.M)("comment")],bd.prototype,"comments",void 0),function(e){e[e.Boolean=0]="Boolean",e[e.Float=1]="Float",e[e.Int=2]="Int",e[e.Vector2=3]="Vector2",e[e.List=4]="List",e[e.Up=5]="Up",e[e.SamplingMode=6]="SamplingMode",e[e.TextureFormat=7]="TextureFormat",e[e.TextureType=8]="TextureType"}(Rd||(Rd={})),function(e){e[e.None=0]="None",e[e.Position=1]="Position",e[e.Direction=2]="Direction",e[e.Age=3]="Age",e[e.Lifetime=4]="Lifetime",e[e.Color=5]="Color",e[e.ScaledDirection=6]="ScaledDirection",e[e.Scale=7]="Scale",e[e.AgeGradient=8]="AgeGradient",e[e.Angle=9]="Angle",e[e.SpriteCellIndex=16]="SpriteCellIndex",e[e.SpriteCellStart=17]="SpriteCellStart",e[e.SpriteCellEnd=18]="SpriteCellEnd"}(Yd||(Yd={})),function(e){e[e.None=0]="None",e[e.Time=1]="Time",e[e.Delta=2]="Delta",e[e.Emitter=3]="Emitter"}(Hd||(Hd={}));class sd{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let e="";for(const d of this.notConnectedNonOptionalInputs)e+=`input ${d.name} from block ${d.ownerBlock.name}[${d.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(e)throw"Build of Node Particle System Set failed:\n"+e}adapt(e,d){const v=e.getConnectedValue(this)||0;if(e.type===d)return v;switch(d){case Nd.Vector2:return new P.Vector2(v,v);case Nd.mv:return new P.mv(v,v,v);case Nd.Up:return new B.Up(v,v,v,v)}return null}getContextualValue(e){if(!this.particleContext||!this.systemContext)return null;switch(e){case Yd.Position:return this.particleContext.position;case Yd.Direction:return this.particleContext.direction;case Yd.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Yd.Color:return this.particleContext.color;case Yd.Age:return this.particleContext.age;case Yd.Lifetime:return this.particleContext.lifeTime;case Yd.Angle:return this.particleContext.angle;case Yd.Scale:return this.particleContext.scale;case Yd.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Yd.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Yd.SpriteCellIndex:return this.particleContext.cellIndex;case Yd.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Pd.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Pd.absolutePosition:this.systemContext.Pd:null}getSystemValue(e){if(!this.particleContext||!this.systemContext)return null;switch(e){case Hd.Time:return this.systemContext._actualFrame;case Hd.Delta:return this.systemContext._scaledUpdateSpeed;case Hd.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Pd.absolutePosition}return this.systemContext.Pd}return null}}function yd(e,d,v){const P=new sd;P.fd=d;const p=e.createSystem(P);return p.canStart=()=>!0,p.Pd=v.clone(),p.disposeOnStop=!0,p.start(),p}class jd extends bd{constructor(e){super(e),this.blendMode=z.BLENDMODE_ONEONE,this.Od=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Nd.Particle),this.registerInput("texture",Nd.Texture),this.registerInput("onStart",Nd.System,!0),this.registerInput("onEnd",Nd.System,!0),this.registerOutput("system",Nd.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(e){e.Od=this.Od,e.buildId=this._buildId++,this.build(e);const d=this.particle.getConnectedValue(e);return d.particleTexture=this.texture.getConnectedValue(e),d.emitRate=this.emitRate,d.blendMode=this.blendMode,d.name=this.name,d._nodeGenerated=!0,d._targetStopDuration=this.targetStopDuration,d.startDelay=this.startDelay,this.system._storedValue=this,d.canStart=()=>!this.doNoStart,d.onStartedObservable.add((v=>{const P=this.onStart.getConnectedValue(e);P&&v.onStartedObservable.addOnce((()=>{e.systemContext=d;const v=yd(P,e.fd,e.emitterPosition);this.Fd.addOnce((()=>{v.dispose()}))}));const p=this.onEnd.getConnectedValue(e);p&&v.onStoppedObservable.addOnce((()=>{e.systemContext=d;const v=yd(p,e.fd,e.emitterPosition);this.Fd.addOnce((()=>{v.dispose()}))}))})),this.Fd.addOnce((()=>{d.dispose()})),d}serialize(){const e=super.serialize();return e.Od=this.Od,e.emitRate=this.emitRate,e.blendMode=this.blendMode,e.doNoStart=this.doNoStart,e.targetStopDuration=this.targetStopDuration,e.startDelay=this.startDelay,e}_deserialize(e){super._deserialize(e),this.Od=e.Od,this.emitRate=e.emitRate,this.doNoStart=!!e.doNoStart,void 0!==e.blendMode&&(this.blendMode=e.blendMode),void 0!==e.targetStopDuration&&(this.targetStopDuration=e.targetStopDuration),void 0!==e.startDelay&&(this.startDelay=e.startDelay)}}(0,T.e)([Md("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:z.BLENDMODE_ONEONE},{label:"Standard",value:z.BLENDMODE_STANDARD},{label:"Add",value:z.BLENDMODE_ADD},{label:"Multiply",value:z.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:z.BLENDMODE_MULTIPLYADD}]})],jd.prototype,"blendMode",void 0),(0,T.e)([Md("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],jd.prototype,"Od",void 0),(0,T.e)([Md("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jd.prototype,"emitRate",void 0),(0,T.e)([Md("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jd.prototype,"targetStopDuration",void 0),(0,T.e)([Md("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jd.prototype,"startDelay",void 0),(0,T.e)([Md("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],jd.prototype,"doNoStart",void 0),(0,X.h)("BABYLON.SystemBlock",jd);class Jd extends bd{get type(){if(this._type===Nd.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Nd.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Nd.Vector2,this._type;case"mv":return this._type=Nd.mv,this._type;case"Up":return this._type=Nd.Up,this._type;case"Matrix":return this._type=Nd.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Yd.None&&this._systemSource!==Hd.None}get systemSource(){return this._systemSource}set systemSource(e){if(this._systemSource=e,e!==Hd.None){switch(this._contextualSource=Yd.None,this._type=Nd.Float,e){case Hd.Time:case Hd.Delta:this._type=Nd.Float;break;case Hd.Emitter:this._type=Nd.mv}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Yd.None}get contextualValue(){return this._contextualSource}set contextualValue(e){if(this._contextualSource=e,e!==Yd.None){switch(this._systemSource=Hd.None,e){case Yd.Scale:this._type=Nd.Vector2;break;case Yd.Position:case Yd.Direction:case Yd.ScaledDirection:this._type=Nd.mv;break;case Yd.Color:this._type=Nd.Up;break;case Yd.Age:case Yd.Lifetime:case Yd.Angle:case Yd.AgeGradient:this._type=Nd.Float;break;case Yd.SpriteCellEnd:case Yd.SpriteCellStart:case Yd.SpriteCellIndex:this._type=Nd.Int}this.output&&(this.output.type=this._type)}}constructor(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nd.AutoDetect;super(e),this._type=Nd.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new y.d,this._systemSource=Hd.None,this._contextualSource=Yd.None,this._type=d,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",d)}get value(){return this._storedValue}set value(e){this.type===Nd.Float&&this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e)),this._storedValue=e,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(e){this._valueCallback=e}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Nd.Int:case Nd.Float:this.value=0;break;case Nd.Vector2:this.value=P.Vector2.Zero();break;case Nd.mv:this.value=P.mv.Zero();break;case Nd.Up:this.value=new B.Up(1,1,1,1);break;case Nd.Matrix:this.value=P.Matrix.Identity()}}_build(e){super._build(e),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=e=>e.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=e=>e.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const e=super.serialize();return e.type=this.type,e.contextualValue=this.contextualValue,e.systemSource=this.systemSource,e.min=this.min,e.max=this.max,e.groupInInspector=this.groupInInspector,e.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Yd?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.Yd()):(e.valueType="number",e.value=this._storedValue)),e}_deserialize(e){if(super._deserialize(e),this._type=e.type,this.contextualValue=e.contextualValue,this.systemSource=e.systemSource||Hd.None,this.min=e.min||0,this.max=e.max||0,this.groupInInspector=e.groupInInspector||"",void 0!==e.displayInInspector&&(this.displayInInspector=e.displayInInspector),e.valueType)if("number"===e.valueType)this._storedValue=e.value;else{const d=(0,X.e)(e.valueType);d&&(this._storedValue=d.Nd(e.value))}}}(0,X.h)("BABYLON.ParticleInputBlock",Jd);class Ed extends bd{get url(){return this._url}set url(e){this._url!==e&&(this._cachedData=null,this._url=e,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(e){this._textureDataUrl!==e&&(this._cachedData=null,this._textureDataUrl=e,this._url="",this._sourceTexture=null)}set sourceTexture(e){this._sourceTexture!==e&&(this._cachedData=null,this._sourceTexture=e,this._url="",this._textureDataUrl="")}constructor(e){super(e),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Nd.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const e=this.texture._storedValue;return await new Promise(((d,v)=>{if(!e.isReady())return void e.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),d(this._cachedData)}catch(e){v(e)}}));const P=e.getSize();Td.h.GetTextureDataAsync(e,P.width,P.height).then((v=>{this._cachedData={width:P.width,height:P.height,data:new Uint8ClampedArray(v)},e.dispose(),d(this._cachedData)})).catch(v)}))}_build(e){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new K.e(this._textureDataUrl,e.fd):this.texture._storedValue=new K.e(this._url,e.fd):this.texture._storedValue=null}serialize(){const e=super.serialize();return e.url=this.url,e.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(e.textureDataUrl=this.textureDataUrl),e}_deserialize(e){super._deserialize(e),this.url=e.url,this.serializedCachedData=!!e.serializedCachedData,e.textureDataUrl&&(this.textureDataUrl=e.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,X.h)("BABYLON.ParticleTextureSourceBlock",Ed);class ev extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerInput("position",Nd.mv),this.registerOutput("output",Nd.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(e){const d=this.particle.getConnectedValue(e);if(this.output._storedValue=d,!this.position.isConnected)return;const v={process:v=>{e.particleContext=v,e.systemContext=d,v.position.L(this.position.getConnectedValue(e))},previousItem:null,nextItem:null};d._updateQueueStart?He(v,d._updateQueueStart):d._updateQueueStart=v}}(0,X.h)("BABYLON.UpdatePositionBlock",ev),function(e){e[e.Add=0]="Add",e[e.Subtract=1]="Subtract",e[e.Multiply=2]="Multiply",e[e.Divide=3]="Divide",e[e.Max=4]="Max",e[e.Min=5]="Min"}(ad||(ad={}));class dv extends bd{constructor(e){super(e),this.operation=ad.Add,this.registerInput("left",Nd.AutoDetect),this.registerInput("right",Nd.AutoDetect),this.registerOutput("output",Nd.BasedOnInput),this.output._typeConnectionSource=this.left;const d=[Nd.Matrix,Nd.Particle,Nd.Texture,Nd.System,Nd.FloatGradient,Nd.Color4Gradient,Nd.Vector2Gradient,Nd.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...d),this.right.excludedConnectionPointTypes.push(...d),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(e){let d;const v=this.left,p=this.right;if(!v.isConnected||!p.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const L=v.type===Nd.Float||v.type===Nd.Int,X=p.type===Nd.Float||p.type===Nd.Int,z=L&&X;switch(this.operation){case ad.Add:d=z?e=>v.getConnectedValue(e)+p.getConnectedValue(e):L?e=>e.adapt(v,p.type).add(p.getConnectedValue(e)):e=>v.getConnectedValue(e).add(e.adapt(p,v.type));break;case ad.Subtract:d=z?e=>v.getConnectedValue(e)-p.getConnectedValue(e):L?e=>e.adapt(v,p.type).Zd(p.getConnectedValue(e)):e=>v.getConnectedValue(e).Zd(e.adapt(p,v.type));break;case ad.Multiply:d=z?e=>v.getConnectedValue(e)*p.getConnectedValue(e):L?e=>e.adapt(v,p.type).multiply(p.getConnectedValue(e)):e=>v.getConnectedValue(e).multiply(e.adapt(p,v.type));break;case ad.Divide:d=z?e=>v.getConnectedValue(e)/p.getConnectedValue(e):L?e=>e.adapt(v,p.type).divide(p.getConnectedValue(e)):e=>v.getConnectedValue(e).divide(e.adapt(p,v.type));break;case ad.Min:if(z)d=e=>Math.min(v.getConnectedValue(e),p.getConnectedValue(e));else{const[e,X]=L?[p,v]:[v,p];switch(e.type){case Nd.Vector2:d=d=>P.Vector2.Minimize(e.getConnectedValue(d),d.adapt(X,e.type));break;case Nd.mv:d=d=>P.mv.Minimize(e.getConnectedValue(d),d.adapt(X,e.type));break;case Nd.Up:d=d=>{const v=e.getConnectedValue(d),{r:P,g:p,b:L,a:z}=d.adapt(X,e.type);return new B.Up(Math.min(v.r,P),Math.min(v.g,p),Math.min(v.b,L),Math.min(v.a,z))}}}break;case ad.Max:if(!z){const[e,X]=L?[p,v]:[v,p];switch(e.type){case Nd.Vector2:d=d=>P.Vector2.Maximize(e.getConnectedValue(d),d.adapt(X,e.type));break;case Nd.mv:d=d=>P.mv.Maximize(e.getConnectedValue(d),d.adapt(X,e.type));break;case Nd.Up:d=d=>{const v=e.getConnectedValue(d),{r:P,g:p,b:L,a:z}=d.adapt(X,e.type);return new B.Up(Math.max(v.r,P),Math.min(v.g,p),Math.min(v.b,L),Math.min(v.a,z))}}break}d=e=>Math.max(v.getConnectedValue(e),p.getConnectedValue(e))}this.output._storedFunction=e=>v.type===Nd.Int?0|d(e):d(e)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Nd.Int||this.left.type===Nd.Float&&this.right.type!==Nd.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[e,d]of[[this.left,this.right],[this.right,this.left]])e.acceptedConnectionPointTypes=[Nd.Int,Nd.Float],d.isConnected&&(e.acceptedConnectionPointTypes.push(d.type),d.type!==Nd.Int&&d.type!==Nd.Float||e.acceptedConnectionPointTypes.push(Nd.Vector2,Nd.mv,Nd.Up))}dispose(){super.dispose();for(const e of this._connectionObservers)e.remove();this._connectionObservers.length=0}serialize(){const e=super.serialize();return e.operation=this.operation,e}_deserialize(e){super._deserialize(e),this.operation=e.operation}}(0,T.e)([Md("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:ad.Add},{label:"Subtract",value:ad.Subtract},{label:"Multiply",value:ad.Multiply},{label:"Divide",value:ad.Divide},{label:"Max",value:ad.Max},{label:"Min",value:ad.Min}]})],dv.prototype,"operation",void 0),(0,X.h)("BABYLON.ParticleMathBlock",dv);class vv extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerInput("direction1",Nd.mv,!0,new P.mv(0,1,0)),this.registerInput("direction2",Nd.mv,!0,new P.mv(0,1,0)),this.registerInput("minEmitBox",Nd.mv,!0,new P.mv(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Nd.mv,!0,new P.mv(.5,.5,.5)),this.registerOutput("output",Nd.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(e){const d=this.particle.getConnectedValue(e);d._directionCreation.process=v=>{e.particleContext=v,e.systemContext=d;const p=this.direction1.getConnectedValue(e),L=this.direction2.getConnectedValue(e),B=(0,W.RandomRange)(p.x,L.x),X=(0,W.RandomRange)(p.y,L.y),z=(0,W.RandomRange)(p.z,L.z);e.isEmitterTransformNode?P.mv.TransformNormalFromFloatsToRef(B,X,z,e.emitterWorldMatrix,v.direction):v.direction.Ed(B,X,z)},d._positionCreation.process=v=>{e.particleContext=v,e.systemContext=d;const p=this.minEmitBox.getConnectedValue(e),L=this.maxEmitBox.getConnectedValue(e),B=(0,W.RandomRange)(p.x,L.x),X=(0,W.RandomRange)(p.y,L.y),z=(0,W.RandomRange)(p.z,L.z);e.isEmitterTransformNode?P.mv.TransformCoordinatesFromFloatsToRef(B,X,z,e.emitterWorldMatrix,v.position):(v.position.Ed(B,X,z),v.position.addInPlace(e.emitterPosition))},this.output._storedValue=d}}(0,X.h)("BABYLON.BoxShapeBlock",vv);class Pv extends bd{constructor(e){super(e),this.registerInput("emitPower",Nd.Float,!0,1),this.registerInput("lifeTime",Nd.Float,!0,1),this.registerInput("color",Nd.Up,!0,new B.Up(1,1,1,1)),this.registerInput("scale",Nd.Vector2,!0,new P.Vector2(1,1)),this.registerInput("angle",Nd.Float,!0,0),this.registerOutput("particle",Nd.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(e){const d=new Xd(this.name,e.Od,e.fd,null,!1,void 0,!0);d.particleEmitterType=new D,d._lifeTimeCreation.process=(d,v)=>{e.particleContext=d,d.lifeTime=this.lifeTime.getConnectedValue(e),v._emitPower=this.emitPower.getConnectedValue(e)},d._colorCreation.process=d=>{e.particleContext=d,d.color.L(this.color.getConnectedValue(e))},d._sizeCreation.process=d=>{e.particleContext=d,d.size=1,d.scale.L(this.scale.getConnectedValue(e))},d._angleCreation.process=d=>{e.particleContext=d,d.angle=this.angle.getConnectedValue(e)},this.particle._storedValue=d}}(0,X.h)("BABYLON.CreateParticleBlock",Pv);class pv{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const e=[];for(const d of this.attachedBlocks)d.isInput&&e.push(d);return e}constructor(e){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new y.d,this.name=e}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(e){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(e)&&this.attachedBlocks.push(e);for(const v of e.inputs){const P=v.connectedPoint;if(P){const v=P.ownerBlock;v!==e&&this._initializeBlock(v,d)}}}async buildAsync(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((v=>{const P=new Ad;for(const e of this._systemBlocks)this._initializeBlock(e);for(const p of this.systemBlocks){const v=new sd;v.buildId=this._buildId++,v.fd=e,v.verbose=d;const L=p.createSystem(v);v.emitErrors(),P.systems.push(L)}this.onBuildObservable.notifyObservers(this),v(P)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const e=new jd("Particle system"),d=new ev("Update position");d.output.connectTo(e.particle);const v=new Jd("Position");v.contextualValue=Yd.Position;const P=new Jd("Scaled direction");P.contextualValue=Yd.ScaledDirection;const p=new dv("Add");p.operation=ad.Add,v.output.connectTo(p.left),P.output.connectTo(p.right),p.output.connectTo(d.position);const L=new Pv("Create particle"),B=new vv("Box shape");L.particle.connectTo(B.particle),B.output.connectTo(d.particle);const X=new Ed("Texture");X.texture.connectTo(e.texture),X.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(e)}removeBlock(e){const d=this.attachedBlocks.indexOf(e);if(d>-1&&this.attachedBlocks.splice(d,1),e.isSystem){const d=this._systemBlocks.indexOf(e);d>-1&&this._systemBlocks.splice(d,1)}}parseSerializedObject(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d||this.clear();const v={};for(const P of e.FV){const e=(0,X.e)(P.customType);if(e){const d=new e;d._deserialize(P),v[P.id]=d,this.attachedBlocks.push(d),d.isSystem&&this._systemBlocks.push(d)}}for(const P of this.attachedBlocks)if(P.isTeleportOut){const e=P,d=e._tempEntryPointUniqueId;if(d){const P=v[d];P&&P.attachToEndpoint(e)}}for(let P=0;P<e.FV.length;P++){const p=e.FV[P],L=v[p.id];L&&(L.inputs.length&&p.inputs.some((e=>e.targetConnectionName))&&!d||this._restoreConnections(L,e,v))}if(e.locations||e.editorData&&e.editorData.locations){const P=e.locations||e.editorData.locations;for(const e of P)v[e.oP]&&(e.oP=v[e.oP].uniqueId);d&&this.editorData&&this.editorData.locations&&P.concat(this.editorData.locations),e.locations?this.editorData={locations:P}:(this.editorData=e.editorData,this.editorData.locations=P);const p=[];for(const e in v)p[e]=v[e].uniqueId;this.editorData.map=p}this.comment=e.comment}_restoreConnections(e,d,v){for(const P of e.outputs)for(const p of d.FV){const L=v[p.id];if(L)for(const B of p.inputs)if(v[B.targetBlockId]!==e||B.targetConnectionName!==P.name);else{const e=L.getInputByName(B.inputName);if(!e||e.isConnected)continue;P.connectTo(e,!0),this._restoreConnections(L,d,v)}}}serialize(e){const d=e?{}:o.c.Serialize(this);d.editorData=JSON.parse(JSON.stringify(this.editorData));let v=[];e?v=e:d.customType="BABYLON.NodeParticleSystemSet",d.FV=[];for(const P of v)d.FV.push(P.serialize());if(!e)for(const P of this.attachedBlocks)-1===v.indexOf(P)&&d.FV.push(P.serialize());return d}dispose(){for(const e of this.attachedBlocks)e.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(e){const d=new pv(e);return d.setToDefault(),d}static Parse(e){const d=o.c.Parse((()=>new pv(e.name)),e,null);return d.parseSerializedObject(e),d}static ParseFromSnippetAsync(e,d){return"_BLANK"===e?Promise.resolve(pv.CreateDefault("blank")):new Promise(((v,P)=>{const p=new xd.d;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const B=JSON.parse(JSON.parse(p.responseText).jsonPayload),X=JSON.parse(B.nodeParticle);d||(d=o.c.Parse((()=>new pv(e)),X,null)),d.parseSerializedObject(X),d.snippetId=e;try{v(d)}catch(L){P(L)}}else P("Unable to load the snippet "+e)})),p.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),p.send()}))}}pv.EditorURL=`${hd.Tools._DefaultCdnUrl}/v${Me.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,pv.SnippetUrl="https://snippet.babylonjs.com",(0,T.e)([(0,S.M)()],pv.prototype,"name",void 0),(0,T.e)([(0,S.M)("comment")],pv.prototype,"comment",void 0),function(e){e[e.None=0]="None",e[e.PerParticle=1]="PerParticle",e[e.PerSystem=2]="PerSystem"}(td||(td={}));class Lv extends bd{constructor(e){super(e),this._currentLockId=-2,this.lockMode=td.PerParticle,this.registerInput("min",Nd.AutoDetect,!0,0),this.registerInput("max",Nd.AutoDetect,!0,1),this.registerOutput("output",Nd.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Nd.Float|Nd.Int|Nd.Vector2|Nd.mv|Nd.Up),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Nd.Float|Nd.Int|Nd.Vector2|Nd.mv|Nd.Up),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Nd.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let e=null;switch(this._currentLockId=-2,this.min.type){case Nd.AutoDetect:case Nd.Int:case Nd.Float:e=e=>{const d=this.min.getConnectedValue(e)||0,v=this.max.getConnectedValue(e)||1;return d+Math.random()*(v-d)};break;case Nd.Vector2:e=e=>{const d=this.min.getConnectedValue(e)||P.Vector2.Zero(),v=this.max.getConnectedValue(e)||P.Vector2.One();return new P.Vector2(d.x+Math.random()*(v.x-d.x),d.y+Math.random()*(v.y-d.y))};break;case Nd.mv:e=e=>{const d=this.min.getConnectedValue(e)||P.mv.Zero(),v=this.max.getConnectedValue(e)||P.mv.One();return new P.mv(d.x+Math.random()*(v.x-d.x),d.y+Math.random()*(v.y-d.y),d.z+Math.random()*(v.z-d.z))};break;case Nd.Up:e=e=>{const d=this.min.getConnectedValue(e)||new B.Up(0,0,0,0),v=this.max.getConnectedValue(e)||new B.Up(1,1,1,1);return new B.Up(d.x+Math.random()*(v.x-d.x),d.y+Math.random()*(v.y-d.y),d.z+Math.random()*(v.z-d.z),d.w+Math.random()*(v.w-d.w))}}this.output._storedFunction=d=>{var v;let P=0;switch(this.lockMode){case td.PerParticle:P=(null===(v=d.particleContext)||void 0===v?void 0:v.id)||-1;break;case td.PerSystem:P=d.buildId||0}return this._currentLockId!==P&&(this.lockMode!==td.None&&(this._currentLockId=P),this.output._storedValue=e(d)),this.output._storedValue}}serialize(){const e=super.serialize();return e.lockMode=this.lockMode,e}_deserialize(e){super._deserialize(e),this.lockMode=e.lockMode}}(0,T.e)([Md("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:td.None},{label:"Per particle",value:td.PerParticle},{label:"Per system",value:td.PerSystem}]})],Lv.prototype,"lockMode",void 0),(0,X.h)("BABYLON.ParticleRandomBlock",Lv);class Bv extends bd{constructor(e){super(e),this._currentLockId=-2,this.lockMode=td.PerParticle,this.registerInput("min",Nd.AutoDetect),this.registerInput("max",Nd.AutoDetect),this.registerOutput("output",Nd.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const d=[Nd.Matrix,Nd.Particle,Nd.Texture,Nd.System,Nd.FloatGradient,Nd.Color4Gradient,Nd.Vector2Gradient,Nd.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...d),this.max.excludedConnectionPointTypes.push(...d)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let e=null;switch(this._currentLockId=-2,this.min.type){case Nd.Float:case Nd.Int:e=e=>{const d=this.min.getConnectedValue(e),v=this.max.getConnectedValue(e);return Math.random()*(v-d)+d};break;case Nd.Vector2:e=e=>{const d=this.min.getConnectedValue(e),v=this.max.getConnectedValue(e);return new P.Vector2(Math.random()*(v.x-d.x)+d.x,Math.random()*(v.y-d.y)+d.y)};break;case Nd.mv:e=e=>{const d=this.min.getConnectedValue(e),v=this.max.getConnectedValue(e);return new P.mv(Math.random()*(v.x-d.x)+d.x,Math.random()*(v.y-d.y)+d.y,Math.random()*(v.z-d.z)+d.z)};break;case Nd.Up:e=e=>{const d=this.min.getConnectedValue(e),v=this.max.getConnectedValue(e);return new B.Up(Math.random()*(v.r-d.r)+d.r,Math.random()*(v.g-d.g)+d.g,Math.random()*(v.b-d.b)+d.b,Math.random()*(v.a-d.a)+d.a)}}this.output._storedFunction=d=>{var v;let P=0;switch(this.lockMode){case td.PerParticle:P=(null===(v=d.particleContext)||void 0===v?void 0:v.id)||-1;break;case td.PerSystem:P=d.buildId||0}return this._currentLockId!==P&&(this.lockMode!==td.None&&(this._currentLockId=P),this.output._storedValue=e(d)),this.output._storedValue}}serialize(){const e=super.serialize();return e.lockMode=this.lockMode,e}_deserialize(e){super._deserialize(e),void 0!==e.lockMode&&(this.lockMode=e.lockMode)}}(0,T.e)([Md("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:td.None},{label:"Per particle",value:td.PerParticle},{label:"Per system",value:td.PerSystem}]})],Bv.prototype,"lockMode",void 0),(0,X.h)("BABYLON.RandomRangeBlock",Bv);(0,X.h)("BABYLON.ParticleLerpBlock",class extends bd{constructor(e){super(e),this.registerInput("left",Nd.AutoDetect),this.registerInput("right",Nd.AutoDetect),this.registerInput("gradient",Nd.Float,!0,0,0,1),this.registerOutput("output",Nd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Nd.Float|Nd.Int|Nd.Vector2|Nd.mv|Nd.Up)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const e=(e,d,v)=>(1-e)*d+e*v;this.output._storedFunction=d=>{const v=this.left.getConnectedValue(d),p=this.right.getConnectedValue(d),L=this.gradient.getConnectedValue(d);switch(this.left.type){case Nd.Int:case Nd.Float:return e(L,v,p);case Nd.Vector2:return new P.Vector2(e(L,v.x,p.x),e(L,v.y,p.y));case Nd.mv:return new P.mv(e(L,v.x,p.x),e(L,v.y,p.y),e(L,v.z,p.z));case Nd.Up:return new B.Up(e(L,v.r,p.r),e(L,v.g,p.g),e(L,v.b,p.b),e(L,v.a,p.a))}return 0}}});(0,X.h)("BABYLON.UpdateDirectionBlock",class extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerInput("direction",Nd.mv),this.registerOutput("output",Nd.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(e){const d=this.particle.getConnectedValue(e);if(this.output._storedValue=d,!this.direction.isConnected)return;const v={process:v=>{e.particleContext=v,e.systemContext=d,v.direction.L(this.direction.getConnectedValue(e))},previousItem:null,nextItem:null};d._updateQueueStart?He(v,d._updateQueueStart):d._updateQueueStart=v}});(0,X.h)("BABYLON.UpdateColorBlock",class extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerInput("color",Nd.Up),this.registerOutput("output",Nd.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(e){const d=this.particle.getConnectedValue(e);if(this.output._storedValue=d,!this.color.isConnected)return;const v={process:v=>{e.particleContext=v,e.systemContext=d,v.color.L(this.color.getConnectedValue(e))},previousItem:null,nextItem:null};d._updateQueueStart?He(v,d._updateQueueStart):d._updateQueueStart=v}});(0,X.h)("BABYLON.UpdateScaleBlock",class extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerInput("scale",Nd.Vector2),this.registerOutput("output",Nd.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(e){const d=this.particle.getConnectedValue(e);if(this.output._storedValue=d,!this.scale.isConnected)return;const v={process:v=>{e.particleContext=v,e.systemContext=d,v.scale.L(this.scale.getConnectedValue(e))},previousItem:null,nextItem:null};d._updateQueueStart?He(v,d._updateQueueStart):d._updateQueueStart=v}});(0,X.h)("BABYLON.UpdateAngleBlock",class extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerInput("angle",Nd.Float),this.registerOutput("output",Nd.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(e){const d=this.particle.getConnectedValue(e);if(this.output._storedValue=d,!this.angle.isConnected)return;const v={process:v=>{e.particleContext=v,e.systemContext=d,v.angle=this.angle.getConnectedValue(e)},previousItem:null,nextItem:null};d._updateQueueStart?He(v,d._updateQueueStart):d._updateQueueStart=v}});(0,X.h)("BABYLON.BasicPositionUpdateBlock",class extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerOutput("output",Nd.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(e){const d=this.particle.getConnectedValue(e),v={process:v=>{e.particleContext=v,e.systemContext=d,v.direction.scaleToRef(d._directionScale,d._scaledDirection),v.position.addInPlace(d._scaledDirection)},previousItem:null,nextItem:null};d._updateQueueStart?He(v,d._updateQueueStart):d._updateQueueStart=v,this.output._storedValue=d}});(0,X.h)("BABYLON.BasicSpriteUpdateBlock",class extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerOutput("output",Nd.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(e){const d=this.particle.getConnectedValue(e),v={process:v=>{e.particleContext=v,e.systemContext=d,v.updateCellIndex()},previousItem:null,nextItem:null};d._updateQueueStart?He(v,d._updateQueueStart):d._updateQueueStart=v,this.output._storedValue=d}});(0,X.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerInput("cellIndex",Nd.Int),this.registerOutput("output",Nd.Particle),this.cellIndex.acceptedConnectionPointTypes=[Nd.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(e){const d=this.particle.getConnectedValue(e);if(this.output._storedValue=d,!this.cellIndex.isConnected)return;const v={process:v=>{e.particleContext=v,e.systemContext=d,v.cellIndex=Math.floor(this.cellIndex.getConnectedValue(e))},previousItem:null,nextItem:null};d._updateQueueStart?He(v,d._updateQueueStart):d._updateQueueStart=v}});class Xv extends bd{constructor(e){super(e),this.strength=1,this.registerInput("particle",Nd.Particle),this.registerInput("flowMap",Nd.Texture),this.registerOutput("output",Nd.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(e){var d;const v=this.particle.getConnectedValue(e),P=e.fd;let p;(null===(d=this.flowMap.connectedPoint)||void 0===d?void 0:d.ownerBlock).extractTextureContentAsync().then((e=>{e&&(p=new Qd(e.width,e.height,e.data))}));const L={process:e=>{const d=P.getTransformMatrix();p&&p._processParticle(e,this.strength*v._tempScaledUpdateSpeed,d)},previousItem:null,nextItem:null};v._updateQueueStart?He(L,v._updateQueueStart):v._updateQueueStart=L,this.output._storedValue=v}serialize(){const e=super.serialize();return e.strength=this.strength,e}_deserialize(e){super._deserialize(e),this.strength=e.strength}}(0,T.e)([Md("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Xv.prototype,"strength",void 0),(0,X.h)("BABYLON.UpdateFlowMapBlock",Xv);(0,X.h)("BABYLON.SphereShapeBlock",class extends bd{constructor(e){super(e),this.registerInput("input",Nd.Particle),this.registerInput("radius",Nd.Float,!0,1),this.registerInput("radiusRange",Nd.Float,!0,1,0,1),this.registerInput("directionRandomizer",Nd.Float,!0,0,0,1),this.registerOutput("output",Nd.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(e){const d=this.input.getConnectedValue(e);d._directionCreation.process=v=>{e.particleContext=v,e.systemContext=d;const p=this.directionRandomizer.getConnectedValue(e),L=v.position.Zd(e.emitterPosition).normalize(),B=(0,W.RandomRange)(0,p),X=(0,W.RandomRange)(0,p),z=(0,W.RandomRange)(0,p);L.x+=B,L.y+=X,L.z+=z,L.normalize(),e.isEmitterTransformNode?P.mv.TransformNormalFromFloatsToRef(B,X,z,e.emitterWorldMatrix,v.direction):v.direction.Ed(B,X,z)},d._positionCreation.process=v=>{e.particleContext=v,e.systemContext=d;const p=this.radius.getConnectedValue(e),L=this.radiusRange.getConnectedValue(e),B=p-(0,W.RandomRange)(0,p*L),X=(0,W.RandomRange)(0,1),z=(0,W.RandomRange)(0,2*Math.PI),V=Math.acos(2*X-1),k=B*Math.cos(z)*Math.sin(V),g=B*Math.cos(V),F=B*Math.sin(z)*Math.sin(V);e.isEmitterTransformNode?P.mv.TransformCoordinatesFromFloatsToRef(k,g,F,e.emitterWorldMatrix,v.position):(v.position.Ed(k,g,F),v.position.addInPlace(e.emitterPosition))},this.output._storedValue=d}});(0,X.h)("BABYLON.PointShapeBlock",class extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerInput("direction1",Nd.mv,!0,new P.mv(0,1,0)),this.registerInput("direction2",Nd.mv,!0,new P.mv(0,1,0)),this.registerOutput("output",Nd.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(e){const d=this.particle.getConnectedValue(e);d._directionCreation.process=v=>{e.particleContext=v,e.systemContext=d;const p=this.direction1.getConnectedValue(e),L=this.direction2.getConnectedValue(e),B=(0,W.RandomRange)(p.x,L.x),X=(0,W.RandomRange)(p.y,L.y),z=(0,W.RandomRange)(p.z,L.z);e.isEmitterTransformNode?P.mv.TransformNormalFromFloatsToRef(B,X,z,e.emitterWorldMatrix,v.direction):v.direction.Ed(B,X,z)},d._positionCreation.process=v=>{e.systemContext=d,e.isEmitterTransformNode?P.mv.TransformCoordinatesFromFloatsToRef(0,0,0,e.emitterWorldMatrix,v.position):v.position.L(e.emitterPosition)},this.output._storedValue=d}});(0,X.h)("BABYLON.CustomShapeBlock",class extends bd{constructor(e){super(e),this.registerInput("particle",Nd.Particle),this.registerInput("position",Nd.mv,!0,new P.mv(0,0,0)),this.registerInput("direction",Nd.mv,!0,new P.mv(0,1,0)),this.registerOutput("output",Nd.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(e){const d=this.particle.getConnectedValue(e);d._directionCreation.process=v=>{e.particleContext=v,e.systemContext=d;const p=this.direction.getConnectedValue(e);e.isEmitterTransformNode?P.mv.TransformNormalToRef(p,e.emitterWorldMatrix,v.direction):v.direction.L(p)},d._positionCreation.process=v=>{e.particleContext=v,e.systemContext=d;const p=this.position.getConnectedValue(e);e.isEmitterTransformNode?P.mv.TransformCoordinatesToRef(p,e.emitterWorldMatrix,v.position):(v.position.L(p),v.position.addInPlace(e.emitterPosition))},this.output._storedValue=d}});(0,X.h)("BABYLON.CylinderShapeBlock",class extends bd{constructor(e){super(e),this._tempVector=P.mv.Zero(),this.registerInput("particle",Nd.Particle),this.registerInput("radius",Nd.Float,!0,1),this.registerInput("height",Nd.Float,!0,1,0),this.registerInput("radiusRange",Nd.Float,!0,1,0,1),this.registerInput("directionRandomizer",Nd.Float,!0,0,0,1),this.registerOutput("output",Nd.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(e){const d=this.particle.getConnectedValue(e);d._directionCreation.process=v=>{e.particleContext=v,e.systemContext=d;const p=this.directionRandomizer.getConnectedValue(e);v.position.subtractToRef(e.emitterPosition,this._tempVector),this._tempVector.normalize(),e.isEmitterTransformNode&&P.mv.TransformNormalToRef(this._tempVector,e.emitterInverseWorldMatrix,this._tempVector);const L=(0,W.RandomRange)(-p/2,p/2);let B=Math.atan2(this._tempVector.x,this._tempVector.z);B+=(0,W.RandomRange)(-Math.PI/2,Math.PI/2)*p,this._tempVector.y=L,this._tempVector.x=Math.sin(B),this._tempVector.z=Math.cos(B),this._tempVector.normalize(),e.isEmitterTransformNode?P.mv.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,e.emitterWorldMatrix,v.direction):v.direction.L(this._tempVector)},d._positionCreation.process=v=>{e.particleContext=v,e.systemContext=d;const p=this.height.getConnectedValue(e),L=this.radiusRange.getConnectedValue(e),B=this.radius.getConnectedValue(e),X=(0,W.RandomRange)(-p/2,p/2),z=(0,W.RandomRange)(0,2*Math.PI),V=(0,W.RandomRange)((1-L)*(1-L),1),k=Math.sqrt(V)*B,g=k*Math.cos(z),F=k*Math.sin(z);e.isEmitterTransformNode?P.mv.TransformCoordinatesFromFloatsToRef(g,X,F,e.emitterWorldMatrix,v.position):(v.position.Ed(g,X,F),v.position.addInPlace(e.emitterPosition))},this.output._storedValue=d}});class zv extends bd{constructor(e){super(e),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Nd.Particle),this.registerOutput("output",Nd.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(e){super._build(e);const d=this.particle.getConnectedValue(e);d._isAnimationSheetEnabled=!0,d.spriteCellWidth=this.width,d.spriteCellHeight=this.height,d.startSpriteCellID=this.start,d.endSpriteCellID=this.end,d.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=d}serialize(){const e=super.serialize();return e.width=this.width,e.height=this.height,e.start=this.start,e.end=this.end,e.randomStartCell=this.randomStartCell,e}_deserialize(e){super._deserialize(e),this.width=e.width,this.height=e.height,this.start=e.start,this.end=e.end,this.randomStartCell=e.randomStartCell}}(0,T.e)([Md("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zv.prototype,"start",void 0),(0,T.e)([Md("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zv.prototype,"end",void 0),(0,T.e)([Md("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zv.prototype,"width",void 0),(0,T.e)([Md("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zv.prototype,"height",void 0),(0,T.e)([Md("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],zv.prototype,"loop",void 0),(0,T.e)([Md("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],zv.prototype,"randomStartCell",void 0),(0,X.h)("BABYLON.SetupSpriteSheetBlock",zv);class Wv extends bd{constructor(e){super(e),this.reference=0,this.registerInput("value",Nd.AutoDetect),this.registerOutput("output",Nd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=e=>{switch(e){case Nd.Float:return Nd.FloatGradient;case Nd.Vector2:return Nd.Vector2Gradient;case Nd.mv:return Nd.Vector3Gradient;case Nd.Up:return Nd.Color4Gradient}return e},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Nd.Float|Nd.Vector2|Nd.mv|Nd.Up)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=e=>null}serialize(){const e=super.serialize();return e.reference=this.reference,e}_deserialize(e){super._deserialize(e),this.reference=e.reference}}(0,T.e)([Md("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Wv.prototype,"reference",void 0),(0,X.h)("BABYLON.ParticleGradientValueBlock",Wv);(0,X.h)("BABYLON.ParticleGradientBlock",class extends bd{constructor(e){super(e),this._entryCount=1,this.registerInput("gradient",Nd.Float,!0,1,0,1),this.registerInput("value0",Nd.AutoDetect),this.registerOutput("output",Nd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=e=>{switch(e){case Nd.FloatGradient:return Nd.Float;case Nd.Vector2Gradient:return Nd.Vector2;case Nd.Vector3Gradient:return Nd.mv;case Nd.Color4Gradient:return Nd.Up}return e},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Nd.FloatGradient|Nd.Vector2Gradient|Nd.Vector3Gradient|Nd.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(e){this._inputs[e].onConnectionObservable.add((()=>{this._entryCount>e||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Nd.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const e=[];for(let v=1;v<this._inputs.length;v++){var d;if(this._inputs[v].isConnected)e.push(null===(d=this._inputs[v].connectedPoint)||void 0===d?void 0:d.ownerBlock)}e.sort(((e,d)=>e.reference-d.reference)),this.output._storedFunction=d=>{const v=this.gradient.getConnectedValue(d);if(1===e.length)return e[0].value.getConnectedValue(d);let p=null;for(let L=e.length-1;L>=0;L--){const X=e[L];if(X.reference<=v){const e=X.value.getConnectedValue(d);if(p){const L=p.value.getConnectedValue(d),z=p.reference,V=X.reference,k=Math.max(0,Math.min(1,(v-V)/(z-V)));switch(this.output.type){case Nd.Float:return(0,W.Lerp)(e,L,k);case Nd.Vector2:return P.Vector2.Lerp(e,L,k);case Nd.mv:return P.mv.Lerp(e,L,k);case Nd.Up:return B.Up.Lerp(e,L,k)}}return e}p=X}return 0}}});(0,X.h)("BABYLON.ParticleConverterBlock",class extends bd{constructor(e){super(e),this.registerInput("color ",Nd.Up,!0),this.registerInput("xyz ",Nd.mv,!0),this.registerInput("xy ",Nd.Vector2,!0),this.registerInput("zw ",Nd.Vector2,!0),this.registerInput("x ",Nd.Float,!0),this.registerInput("y ",Nd.Float,!0),this.registerInput("z ",Nd.Float,!0),this.registerInput("w ",Nd.Float,!0),this.registerOutput("color",Nd.Up),this.registerOutput("xyz",Nd.mv),this.registerOutput("xy",Nd.Vector2),this.registerOutput("zw",Nd.Vector2),this.registerOutput("x",Nd.Float),this.registerOutput("y",Nd.Float),this.registerOutput("z",Nd.Float),this.registerOutput("w",Nd.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(e){return"color "===e?"colorIn":"xyz "===e?"xyzIn":"xy "===e?"xyIn":"zw "===e?"zwIn":"x "===e?"xIn":"y "===e?"yIn":"z "===e?"zIn":"w "===e?"wIn":e}_outputRename(e){switch(e){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return e}}_build(e){super._build(e);const d=this.xIn,v=this.yIn,p=this.zIn,L=this.wIn,X=this.xyIn,z=this.zwIn,W=this.xyzIn,V=this.colorIn,k=this.colorOut,g=this.xyzOut,F=this.xyOut,w=this.zwOut,G=this.xOut,U=this.yOut,D=this.zOut,C=this.wOut,q=e=>{if(V.isConnected)return V.getConnectedValue(e);let P=0,k=0,g=0,F=0;if(d.isConnected&&(P=d.getConnectedValue(e)),v.isConnected&&(k=v.getConnectedValue(e)),p.isConnected&&(g=p.getConnectedValue(e)),L.isConnected&&(F=L.getConnectedValue(e)),X.isConnected){const d=X.getConnectedValue(e);d&&(P=d.x,k=d.y)}if(z.isConnected){const d=z.getConnectedValue(e);d&&(g=d.x,F=d.y)}if(W.isConnected){const d=W.getConnectedValue(e);d&&(P=d.x,k=d.y,g=d.z)}return new B.Up(P,k,g,F)};k._storedFunction=e=>q(e),g._storedFunction=e=>{const d=q(e);return new P.mv(d.r,d.g,d.b)},F._storedFunction=e=>{const d=q(e);return new P.Vector2(d.r,d.g)},w._storedFunction=e=>{const d=q(e);return new P.Vector2(d.b,d.a)},G._storedFunction=e=>q(e).r,U._storedFunction=e=>q(e).g,D._storedFunction=e=>q(e).b,C._storedFunction=e=>q(e).a}}),function(e){e[e.Cos=0]="Cos",e[e.Sin=1]="Sin",e[e.Abs=2]="Abs",e[e.Exp=3]="Exp",e[e.Exp2=4]="Exp2",e[e.Round=5]="Round",e[e.Floor=6]="Floor",e[e.Ceiling=7]="Ceiling",e[e.Sqrt=8]="Sqrt",e[e.Log=9]="Log",e[e.Tan=10]="Tan",e[e.ArcTan=11]="ArcTan",e[e.ArcCos=12]="ArcCos",e[e.ArcSin=13]="ArcSin",e[e.Sign=14]="Sign",e[e.Negate=15]="Negate",e[e.OneMinus=16]="OneMinus",e[e.Reciprocal=17]="Reciprocal",e[e.ToDegrees=18]="ToDegrees",e[e.ToRadians=19]="ToRadians",e[e.Fract=20]="Fract"}(Id||(Id={}));class Vv extends bd{constructor(e){super(e),this.operation=Id.Cos,this.registerInput("input",Nd.AutoDetect),this.registerOutput("output",Nd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Nd.Float|Nd.Int|Nd.Vector2|Nd.mv|Nd.Up)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(e){super._build(e);let d=null;switch(this.operation){case Id.Cos:d=e=>Math.cos(e);break;case Id.Sin:d=e=>Math.sin(e);break;case Id.Abs:d=e=>Math.abs(e);break;case Id.Exp:d=e=>Math.exp(e);break;case Id.Exp2:d=e=>Math.pow(2,e);break;case Id.Round:d=e=>Math.round(e);break;case Id.Floor:d=e=>Math.floor(e);break;case Id.Ceiling:d=e=>Math.ceil(e);break;case Id.Sqrt:d=e=>Math.sqrt(e);break;case Id.Log:d=e=>Math.log(e);break;case Id.Tan:d=e=>Math.tan(e);break;case Id.ArcTan:d=e=>Math.atan(e);break;case Id.ArcCos:d=e=>Math.acos(e);break;case Id.ArcSin:d=e=>Math.asin(e);break;case Id.Sign:d=e=>Math.sign(e);break;case Id.Negate:d=e=>-e;break;case Id.OneMinus:d=e=>1-e;break;case Id.Reciprocal:d=e=>1/e;break;case Id.ToRadians:d=e=>e*Math.PI/180;break;case Id.ToDegrees:d=e=>180*e/Math.PI;break;case Id.Fract:d=e=>e>=0?e-Math.floor(e):e-Math.ceil(e)}if(!d)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Nd.Int:case Nd.Float:this.output._storedFunction=e=>{const v=this.input.getConnectedValue(e);return d(v)};break;case Nd.Vector2:this.output._storedFunction=e=>{const v=this.input.getConnectedValue(e);return new P.Vector2(d(v.x),d(v.y))};break;case Nd.mv:this.output._storedFunction=e=>{const v=this.input.getConnectedValue(e);return new P.mv(d(v.x),d(v.y),d(v.z))};break;case Nd.Up:this.output._storedFunction=e=>{const v=this.input.getConnectedValue(e);return new B.Up(d(v.r),d(v.g),d(v.b),d(v.a))}}return this}serialize(){const e=super.serialize();return e.operation=this.operation,e}_deserialize(e){super._deserialize(e),this.operation=e.operation}}(0,T.e)([Md("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Id.Cos},{label:"Sin",value:Id.Sin},{label:"Abs",value:Id.Abs},{label:"Exp",value:Id.Exp},{label:"Exp2",value:Id.Exp2},{label:"Round",value:Id.Round},{label:"Floor",value:Id.Floor},{label:"Ceiling",value:Id.Ceiling},{label:"Sqrt",value:Id.Sqrt},{label:"Log",value:Id.Log},{label:"Tan",value:Id.Tan},{label:"ArcTan",value:Id.ArcTan},{label:"ArcCos",value:Id.ArcCos},{label:"ArcSin",value:Id.ArcSin},{label:"Sign",value:Id.Sign},{label:"Negate",value:Id.Negate},{label:"OneMinus",value:Id.OneMinus},{label:"Reciprocal",value:Id.Reciprocal},{label:"ToDegrees",value:Id.ToDegrees},{label:"ToRadians",value:Id.ToRadians},{label:"Fract",value:Id.Fract}]})],Vv.prototype,"operation",void 0),(0,X.h)("BABYLON.ParticleTrigonometryBlock",Vv);var kv,gv=v(13870);class Fv extends bd{constructor(e){super(e),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Nd.AutoDetect),this.registerOutput("output",Nd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Nd.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Nd.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Nd.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Nd.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Nd.System),this._inputs[0].excludedConnectionPointTypes.push(Nd.Particle),this._inputs[0].excludedConnectionPointTypes.push(Nd.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(e){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const d=e=>{const d=this.input.getConnectedValue(e);if(this.log.length>=this.stackSize)return d;if(null===d||void 0===d)return this.log.push(["null",""]),d;switch(this.input.type){case Nd.Vector2:this.log.push([(0,gv.i)(d,4),d.toString()]);break;case Nd.mv:this.log.push([(0,gv.k)(d,4),d.toString()]);break;case Nd.Up:this.log.push([`{R: ${d.r.toFixed(4)} G: ${d.g.toFixed(4)} B: ${d.b.toFixed(4)} A: ${d.a.toFixed(4)}}`,d.toString()]);break;default:this.log.push([d.toString(),d.toString()])}return d};this.output.isConnected?this.output._storedFunction=d:this.output._storedValue=d(e)}serialize(){const e=super.serialize();return e.stackSize=this.stackSize,e}_deserialize(e){super._deserialize(e),this.stackSize=e.stackSize}}(0,T.e)([Md("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Fv.prototype,"stackSize",void 0),(0,X.h)("BABYLON.ParticleDebugBlock",Fv);(0,X.h)("BABYLON.ParticleElbowBlock",class extends bd{constructor(e){super(e),this.registerInput("input",Nd.AutoDetect),this.registerOutput("output",Nd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(e){super._build(e);const d=this._outputs[0],v=this._inputs[0];d._storedFunction=e=>v.getConnectedValue(e)}});(0,X.h)("BABYLON.ParticleTeleportInBlock",class extends bd{get endpoints(){return this._endpoints}constructor(e){super(e),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Nd.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(e){if(this.getClassName()===e)return!0;for(const d of this.endpoints)if(d.isAnAncestorOfType(e))return!0;return!1}isAnAncestorOf(e){for(const d of this.endpoints){if(d===e)return!0;if(d.isAnAncestorOf(e))return!0}return!1}attachToEndpoint(e){e.detach(),this._endpoints.push(e),e._entryPoint=this,e._outputs[0]._typeConnectionSource=this._inputs[0],e._tempEntryPointUniqueId=null,e.name="> "+this.name}detachFromEndpoint(e){const d=this._endpoints.indexOf(e);-1!==d&&(this._endpoints.splice(d,1),e._outputs[0]._typeConnectionSource=null,e._entryPoint=null)}_build(){for(const e of this._endpoints)e.output._storedFunction=e=>this.input.getConnectedValue(e)}});(0,X.h)("BABYLON.ParticleTeleportOutBlock",class extends bd{constructor(e){super(e),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Nd.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(e){this.entryPoint&&this.entryPoint.build(e)}clone(){const e=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(e),e}serialize(){var e;const d=super.serialize();return d.entryPoint=(null===(e=this.entryPoint)||void 0===e?void 0:e.uniqueId)??"",d}_deserialize(e){super._deserialize(e),this._tempEntryPointUniqueId=e.entryPoint}}),function(e){e[e.Equal=0]="Equal",e[e.NotEqual=1]="NotEqual",e[e.LessThan=2]="LessThan",e[e.GreaterThan=3]="GreaterThan",e[e.LessOrEqual=4]="LessOrEqual",e[e.GreaterOrEqual=5]="GreaterOrEqual",e[e.Xor=6]="Xor",e[e.Or=7]="Or",e[e.And=8]="And"}(kv||(kv={}));class wv extends bd{constructor(e){super(e),this.test=kv.Equal,this.epsilon=0,this.registerInput("left",Nd.Float),this.registerInput("right",Nd.Float,!0,0),this.registerInput("ifTrue",Nd.AutoDetect,!0,1),this.registerInput("ifFalse",Nd.AutoDetect,!0,0),this.registerOutput("output",Nd.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Nd.Float,this._inputs[0].acceptedConnectionPointTypes.push(Nd.Int),this._inputs[1].acceptedConnectionPointTypes.push(Nd.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const e=e=>{const d=this.left.getConnectedValue(e),v=this.right.getConnectedValue(e);let P=!1;switch(this.test){case kv.Equal:P=(0,W.WithinEpsilon)(d,v,this.epsilon);break;case kv.NotEqual:P=!(0,W.WithinEpsilon)(d,v,this.epsilon);break;case kv.LessThan:P=d<v+this.epsilon;break;case kv.GreaterThan:P=d>v-this.epsilon;break;case kv.LessOrEqual:P=d<=v+this.epsilon;break;case kv.GreaterOrEqual:P=d>=v-this.epsilon;break;case kv.Xor:P=!!d&&!v||!d&&!!v;break;case kv.Or:P=!!d||!!v;break;case kv.And:P=!!d&&!!v}return P};this.output._storedFunction=d=>e(d)?this.ifTrue.getConnectedValue(d):this.ifFalse.getConnectedValue(d)}serialize(){const e=super.serialize();return e.test=this.test,e.epsilon=this.epsilon,e}_deserialize(e){super._deserialize(e),this.test=e.test,void 0!==e.epsilon&&(this.epsilon=e.epsilon)}}(0,T.e)([Md("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:kv.Equal},{label:"NotEqual",value:kv.NotEqual},{label:"LessThan",value:kv.LessThan},{label:"GreaterThan",value:kv.GreaterThan},{label:"LessOrEqual",value:kv.LessOrEqual},{label:"GreaterOrEqual",value:kv.GreaterOrEqual},{label:"Xor",value:kv.Xor},{label:"Or",value:kv.Or},{label:"And",value:kv.And}]})],wv.prototype,"test",void 0),(0,T.e)([Md("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wv.prototype,"epsilon",void 0),(0,X.h)("BABYLON.ParticleConditionBlock",wv);class Gv extends bd{constructor(e){super(e),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Nd.Particle),this.registerInput("condition",Nd.Float,!0,0),this.registerInput("system",Nd.System),this.registerOutput("output",Nd.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(e){this._triggerCount=0;const d=this.input.getConnectedValue(e),v={process:v=>{if(e.particleContext=v,e.systemContext=d,0!==this.condition.getConnectedValue(e)&&(0===this.limit||this._triggerCount<this.limit)){const P=(new Date).getTime();if(this._previousOne&&P-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=P;const p=this.system.getConnectedValue(e);if(p){const P=yd(p,e.fd,v.position);P.Fd.addOnce((()=>{this._triggerCount--})),d.Fd.addOnce((()=>{P.dispose()}))}}},previousItem:null,nextItem:null};d._updateQueueStart?He(v,d._updateQueueStart):d._updateQueueStart=v,this.output._storedValue=d}serialize(){const e=super.serialize();return e.limit=this.limit,e.delay=this.delay,e}_deserialize(e){super._deserialize(e),void 0!==e.limit&&(this.limit=e.limit),void 0!==e.delay&&(this.delay=e.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,T.e)([Md("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gv.prototype,"limit",void 0),(0,T.e)([Md("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gv.prototype,"delay",void 0),(0,X.h)("BABYLON.ParticleTriggerBlock",Gv);v(13877),v(13889),v(13903),v(13968)},13948:(e,d,v)=>{"use strict";var P=v(12328);const p="clipPlaneFragment",L="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13908:(e,d,v)=>{"use strict";var P=v(12328);const p="clipPlaneFragmentDeclaration",L="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13986:(e,d,v)=>{"use strict";var P=v(12328);const p="clipPlaneVertex",L="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13975:(e,d,v)=>{"use strict";var P=v(12328);const p="clipPlaneVertexDeclaration",L="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13961:(e,d,v)=>{"use strict";var P=v(12328);const p="fogFragment",L="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13940:(e,d,v)=>{"use strict";var P=v(12328);const p="fogFragmentDeclaration",L="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13988:(e,d,v)=>{"use strict";var P=v(12328);const p="fogVertex",L="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13981:(e,d,v)=>{"use strict";var P=v(12328);const p="fogVertexDeclaration",L="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13925:(e,d,v)=>{"use strict";var P=v(12328);const p="helperFunctions",L="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13912:(e,d,v)=>{"use strict";var P=v(12328);const p="imageProcessingDeclaration",L="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13933:(e,d,v)=>{"use strict";var P=v(12328);const p="imageProcessingFunctions",L="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13919:(e,d,v)=>{"use strict";var P=v(12328);const p="logDepthDeclaration",L="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13957:(e,d,v)=>{"use strict";var P=v(12328);const p="logDepthFragment",L="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13997:(e,d,v)=>{"use strict";var P=v(12328);const p="logDepthVertex",L="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";P.d.IncludesShadersStoreWGSL[p]||(P.d.IncludesShadersStoreWGSL[p]=L)},13903:(e,d,v)=>{"use strict";v.r(d),v.d(d,{particlesPixelShaderWGSL:()=>B});var P=v(12328);v(13908),v(13912),v(13919),v(13925),v(13933),v(13940),v(13948),v(13957),v(13961);const p="particlesPixelShader",L="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";P.d.ShadersStoreWGSL[p]||(P.d.ShadersStoreWGSL[p]=L);const B={name:p,shader:L}},13968:(e,d,v)=>{"use strict";v.r(d),v.d(d,{particlesVertexShaderWGSL:()=>B});var P=v(12328);v(13975),v(13981),v(13919),v(13986),v(13988),v(13997);const p="particlesVertexShader",L="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";P.d.ShadersStoreWGSL[p]||(P.d.ShadersStoreWGSL[p]=L);const B={name:p,shader:L}},13798:(e,d,v)=>{"use strict";var P=v(12328);const p="clipPlaneFragment",L="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13886:(e,d,v)=>{"use strict";var P=v(12328);const p="clipPlaneFragmentDeclaration",L="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13826:(e,d,v)=>{"use strict";var P=v(12328);const p="clipPlaneVertex",L="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13895:(e,d,v)=>{"use strict";var P=v(12328);const p="clipPlaneVertexDeclaration",L="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13811:(e,d,v)=>{"use strict";var P=v(12328);const p="fogFragment",L="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13792:(e,d,v)=>{"use strict";var P=v(12328);const p="fogFragmentDeclaration",L="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13831:(e,d,v)=>{"use strict";var P=v(12328);const p="fogVertex",L="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13820:(e,d,v)=>{"use strict";var P=v(12328);const p="fogVertexDeclaration",L="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13781:(e,d,v)=>{"use strict";var P=v(12328);const p="helperFunctions",L="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13765:(e,d,v)=>{"use strict";var P=v(12328);const p="imageProcessingDeclaration",L="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13784:(e,d,v)=>{"use strict";var P=v(12328);const p="imageProcessingFunctions",L="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13772:(e,d,v)=>{"use strict";var P=v(12328);const p="logDepthDeclaration",L="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13806:(e,d,v)=>{"use strict";var P=v(12328);const p="logDepthFragment",L="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13840:(e,d,v)=>{"use strict";var P=v(12328);const p="logDepthVertex",L="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";P.d.IncludesShadersStore[p]||(P.d.IncludesShadersStore[p]=L)},13877:(e,d,v)=>{"use strict";v.r(d),v.d(d,{particlesPixelShader:()=>B});var P=v(12328);v(13886),v(13765),v(13772),v(13781),v(13784),v(13792),v(13798),v(13806),v(13811);const p="particlesPixelShader",L="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";P.d.ShadersStore[p]||(P.d.ShadersStore[p]=L);const B={name:p,shader:L}},13889:(e,d,v)=>{"use strict";v.r(d),v.d(d,{particlesVertexShader:()=>B});var P=v(12328);v(13895),v(13820),v(13772),v(13826),v(13831),v(13840);const p="particlesVertexShader",L="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";P.d.ShadersStore[p]||(P.d.ShadersStore[p]=L);const B={name:p,shader:L}},14223:(e,d,v)=>{"use strict";v.r(d),v.d(d,{FlowGraphGLTFDataProvider:()=>L});var P=v(14195),p=v(14181);class L extends P.e{constructor(e){var d,v;super();const P=e.glTF,L=(null===(d=P.animations)||void 0===d?void 0:d.map((e=>e._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",p.b,L);const B=(null===(v=P.nodes)||void 0===v?void 0:v.map((e=>e._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",p.b,B)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14129:(e,d,v)=>{"use strict";v.d(d,{d:()=>U,g:()=>w,j:()=>F,m:()=>G});var P=v(12420),p=v(12897),L=v(12463),B=v(14136);const X=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class z{constructor(e,d){this._gltf=e,this._infoTree=d}convert(e){let d,v=this._gltf,P=this._infoTree;if(!e.startsWith("/"))throw new Error("Path must start with a /");const p=e.split("/");if(p.shift(),p[p.length-1].includes(".length")){const e=p[p.length-1].split(".");p.pop(),p.push(...e)}let L=!1;for(const z of p){const p="length"===z;if(p&&!P.__array__)throw new Error(`Path ${e} is invalid`);if(P.__ignoreObjectTree__&&(L=!0),P.__array__&&!p)P=P.__array__;else if(P=P[z],!P)throw new Error(`Path ${e} is invalid`);if(!L)if(void 0===v){if(!X.find((d=>d.regex.test(e))))throw new Error(`Path ${e} is invalid`)}else if(!p){var B;v=null===(B=v)||void 0===B?void 0:B[z]}(P.__target__||p)&&(d=v)}return{object:d,info:P}}}function W(e,d,v,P){const p=V(e,d);return P?p[v][P]:p[v]}function V(e,d,v){var P,L;return null===(P=e._data)||void 0===P||null===(L=P[(null===v||void 0===v?void 0:v.fillMode)??p.b.MATERIAL_TriangleFillMode])||void 0===L?void 0:L.babylonMaterial}function k(e,d){return{offset:{componentsCount:2,type:"Vector2",get:(v,p,L)=>{const B=W(v,L,e,d);return new P.Vector2(null===B||void 0===B?void 0:B.uOffset,null===B||void 0===B?void 0:B.vOffset)},getTarget:V,set:(v,P,p,L)=>{const B=W(P,L,e,d);B.uOffset=v.x,B.vOffset=v.y},getPropertyName:[()=>`${e}${d?"."+d:""}.uOffset`,()=>`${e}${d?"."+d:""}.vOffset`]},rotation:{type:"number",get:(v,P,p)=>{var L;return null===(L=W(v,p,e,d))||void 0===L?void 0:L.wAng},getTarget:V,set:(v,P,p,L)=>W(P,L,e,d).wAng=v,getPropertyName:[()=>`${e}${d?"."+d:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(v,p,L)=>{const B=W(v,L,e,d);return new P.Vector2(null===B||void 0===B?void 0:B.uScale,null===B||void 0===B?void 0:B.vScale)},getTarget:V,set:(v,P,p,L)=>{const B=W(P,L,e,d);B.uScale=v.x,B.vScale=v.y},getPropertyName:[()=>`${e}${d?"."+d:""}.uScale`,()=>`${e}${d?"."+d:""}.vScale`]}}}const g={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:e=>{var d,v;return new P.Vector2((null===(d=e._babylonCamera)||void 0===d?void 0:d.orthoLeft)??0,(null===(v=e._babylonCamera)||void 0===v?void 0:v.orthoRight)??0)},set:(e,d)=>{d._babylonCamera&&(d._babylonCamera.orthoLeft=e.x,d._babylonCamera.orthoRight=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:e=>{var d,v;return new P.Vector2((null===(d=e._babylonCamera)||void 0===d?void 0:d.orthoBottom)??0,(null===(v=e._babylonCamera)||void 0===v?void 0:v.orthoTop)??0)},set:(e,d)=>{d._babylonCamera&&(d._babylonCamera.orthoBottom=e.x,d._babylonCamera.orthoTop=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:e=>{var d;return null===(d=e._babylonCamera)||void 0===d?void 0:d.maxZ},set:(e,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>{var d;return null===(d=e._babylonCamera)||void 0===d?void 0:d.td},set:(e,d)=>{d._babylonCamera&&(d._babylonCamera.td=e)},getTarget:e=>e,getPropertyName:[()=>"td"]}},perspective:{aspectRatio:{type:"number",get:e=>{var d;return null===(d=e._babylonCamera)||void 0===d?void 0:d.getEngine().getAspectRatio(e._babylonCamera)},getTarget:e=>e,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:e=>{var d;return null===(d=e._babylonCamera)||void 0===d?void 0:d.fov},set:(e,d)=>{d._babylonCamera&&(d._babylonCamera.fov=e)},getTarget:e=>e,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:e=>{var d;return null===(d=e._babylonCamera)||void 0===d?void 0:d.maxZ},set:(e,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>{var d;return null===(d=e._babylonCamera)||void 0===d?void 0:d.td},set:(e,d)=>{d._babylonCamera&&(d._babylonCamera.td=e)},getTarget:e=>e,getPropertyName:[()=>"td"]}}}},nodes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"mv",get:e=>{var d;return null===(d=e._babylonTransformNode)||void 0===d?void 0:d.position},set:(e,d)=>{var v;return null===(v=d._babylonTransformNode)||void 0===v?void 0:v.position.L(e)},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:e=>{var d;return null===(d=e._babylonTransformNode)||void 0===d?void 0:d.rotationQuaternion},set:(e,d)=>{var v,P;return null===(v=d._babylonTransformNode)||void 0===v||null===(P=v.rotationQuaternion)||void 0===P?void 0:P.L(e)},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"mv",get:e=>{var d;return null===(d=e._babylonTransformNode)||void 0===d?void 0:d.tv},set:(e,d)=>{var v;return null===(v=d._babylonTransformNode)||void 0===v?void 0:v.tv.L(e)},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"tv"]},weights:{length:{type:"number",get:e=>e._numMorphTargets,getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(e,d)=>{var v,P;return void 0!==d?null===(v=e._primitiveBabylonMeshes)||void 0===v||null===(P=v[0].morphTargetManager)||void 0===P?void 0:P.getTarget(d).influence:void 0},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(e,d)=>[0],getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:e=>{var d,v,p;return P.Matrix.Compose(null===(d=e._babylonTransformNode)||void 0===d?void 0:d.tv,null===(v=e._babylonTransformNode)||void 0===v?void 0:v.rotationQuaternion,null===(p=e._babylonTransformNode)||void 0===p?void 0:p.position)},getTarget:e=>e._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:e=>{var d,v,p,L;const B=P.Matrix.Identity();let X=e.parent;for(;X&&X.parent;)X=X.parent;const z=(null===(d=e._babylonTransformNode)||void 0===d?void 0:d.position._isDirty)||(null===(v=e._babylonTransformNode)||void 0===v||null===(p=v.rotationQuaternion)||void 0===p?void 0:p._isDirty)||(null===(L=e._babylonTransformNode)||void 0===L?void 0:L.tv._isDirty);if(X){var W;const d=null===(W=X._babylonTransformNode)||void 0===W?void 0:W.Md(!0).invert();var V,k;if(d)null===(V=e._babylonTransformNode)||void 0===V||null===(k=V.Md(z))||void 0===k||k.multiplyToRef(d,B)}else e._babylonTransformNode&&B.L(e._babylonTransformNode.Md(z));return B},getTarget:e=>e._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:e=>{var d,v;return null===(d=e._babylonTransformNode)||void 0===d||null===(v=d.getChildren((e=>e instanceof B.d),!0)[0])||void 0===v?void 0:v.nX},getTarget:e=>{var d;return null===(d=e._babylonTransformNode)||void 0===d?void 0:d.getChildren((e=>e instanceof B.d),!0)[0]},set:(e,d)=>{if(d._babylonTransformNode){const v=d._babylonTransformNode.getChildren((e=>e instanceof B.d),!0)[0];v&&(v.nX=e)}}},color:{type:"Kd",get:e=>{var d,v;return null===(d=e._babylonTransformNode)||void 0===d||null===(v=d.getChildren((e=>e instanceof B.d),!0)[0])||void 0===v?void 0:v.AX},getTarget:e=>{var d;return null===(d=e._babylonTransformNode)||void 0===d?void 0:d.getChildren((e=>e instanceof B.d),!0)[0]},set:(e,d)=>{if(d._babylonTransformNode){const v=d._babylonTransformNode.getChildren((e=>e instanceof B.d),!0)[0];v&&(v.AX=e)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Kd",get:(e,d,v)=>V(e,d,v).emissiveColor,set:(e,d,v,P)=>V(d,v,P).emissiveColor.L(e),getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:k("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(e,d,v)=>{var P;return null===(P=W(e,v,"bumpTexture"))||void 0===P?void 0:P.level},set:(e,d,v,P)=>{const p=W(d,P,"bumpTexture");p&&(p.level=e)},getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:k("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(e,d,v)=>V(e,d,v).ambientTextureStrength,set:(e,d,v,P)=>{const p=V(d,v,P);p&&(p.ambientTextureStrength=e)},getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:k("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Up",get:(e,d,v)=>{const P=V(e,d,v);return L.Up.FromColor3(P.albedoColor,P.alpha)},set:(e,d,v,P)=>{const p=V(d,v,P);p.albedoColor.set(e.r,e.g,e.b),p.alpha=e.a},getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:k("albedoTexture")}},metallicFactor:{type:"number",get:(e,d,v)=>V(e,d,v).metallic,set:(e,d,v,P)=>{const p=V(d,v,P);p&&(p.metallic=e)},getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(e,d,v)=>V(e,d,v).roughness,set:(e,d,v,P)=>{const p=V(d,v,P);p&&(p.roughness=e)},getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:k("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(e,d,v)=>V(e,d,v).anisotropy.nX,set:(e,d,v,P)=>{V(d,v,P).anisotropy.nX=e},getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(e,d,v)=>V(e,d,v).anisotropy.angle,set:(e,d,v,P)=>{V(d,v,P).anisotropy.angle=e},getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:k("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(e,d,v)=>V(e,d,v).clearCoat.nX,set:(e,d,v,P)=>{V(d,v,P).clearCoat.nX=e},getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(e,d,v)=>V(e,d,v).clearCoat.roughness,set:(e,d,v,P)=>{V(d,v,P).clearCoat.roughness=e},getTarget:(e,d,v)=>V(e,d,v),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:k("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(e,d,v)=>{var P;return null===(P=V(e,d,v).clearCoat.bumpTexture)||void 0===P?void 0:P.level},getTarget:V,set:(e,d,v,P)=>V(d,v,P).clearCoat.bumpTexture.level=e},extensions:{KHR_texture_transform:k("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:k("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(e,d,v)=>V(e,d,v).subSurface.dispersion,getTarget:V,set:(e,d,v,P)=>V(d,v,P).subSurface.dispersion=e}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(e,d,v)=>V(e,d,v).emissiveIntensity,getTarget:V,set:(e,d,v,P)=>V(d,v,P).emissiveIntensity=e}},KHR_materials_ior:{ior:{type:"number",get:(e,d,v)=>V(e,d,v).indexOfRefraction,getTarget:V,set:(e,d,v,P)=>V(d,v,P).indexOfRefraction=e}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(e,d,v)=>V(e,d,v).iridescence.nX,getTarget:V,set:(e,d,v,P)=>V(d,v,P).iridescence.nX=e},iridescenceIor:{type:"number",get:(e,d,v)=>V(e,d,v).iridescence.indexOfRefraction,getTarget:V,set:(e,d,v,P)=>V(d,v,P).iridescence.indexOfRefraction=e},iridescenceTexture:{extensions:{KHR_texture_transform:k("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(e,d,v)=>V(e,d,v).iridescence.maximumThickness,getTarget:V,set:(e,d,v,P)=>V(d,v,P).iridescence.maximumThickness=e},iridescenceThicknessMinimum:{type:"number",get:(e,d,v)=>V(e,d,v).iridescence.minimumThickness,getTarget:V,set:(e,d,v,P)=>V(d,v,P).iridescence.minimumThickness=e},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:k("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Kd",get:(e,d,v)=>V(e,d,v).sheen.color,getTarget:V,set:(e,d,v,P)=>V(d,v,P).sheen.color.L(e)},sheenColorTexture:{extensions:{KHR_texture_transform:k("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(e,d,v)=>V(e,d,v).sheen.nX,getTarget:V,set:(e,d,v,P)=>V(d,v,P).sheen.nX=e},sheenRoughnessTexture:{extensions:{KHR_texture_transform:k("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(e,d,v)=>V(e,d,v).metallicF0Factor,getTarget:V,set:(e,d,v,P)=>V(d,v,P).metallicF0Factor=e,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Kd",get:(e,d,v)=>V(e,d,v).metallicReflectanceColor,getTarget:V,set:(e,d,v,P)=>V(d,v,P).metallicReflectanceColor.L(e),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:k("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:k("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(e,d,v)=>V(e,d,v).subSurface.refractionIntensity,getTarget:V,set:(e,d,v,P)=>V(d,v,P).subSurface.refractionIntensity=e,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:k("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(e,d,v)=>V(e,d,v).subSurface.translucencyIntensity,getTarget:V,set:(e,d,v,P)=>V(d,v,P).subSurface.translucencyIntensity=e},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:k("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Kd",get:(e,d,v)=>V(e,d,v).subSurface.translucencyColor,getTarget:V,set:(e,d,v,P)=>{var p;return e&&(null===(p=V(d,v,P).subSurface.translucencyColor)||void 0===p?void 0:p.L(e))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:k("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Kd",get:(e,d,v)=>V(e,d,v).subSurface.tintColor,getTarget:V,set:(e,d,v,P)=>V(d,v,P).subSurface.tintColor.L(e)},attenuationDistance:{type:"number",get:(e,d,v)=>V(e,d,v).subSurface.tintColorAtDistance,getTarget:V,set:(e,d,v,P)=>V(d,v,P).subSurface.tintColorAtDistance=e},thicknessFactor:{type:"number",get:(e,d,v)=>V(e,d,v).subSurface.maximumThickness,getTarget:V,set:(e,d,v,P)=>V(d,v,P).subSurface.maximumThickness=e},thicknessTexture:{extensions:{KHR_texture_transform:k("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonLight)),getPropertyName:[e=>"length"]},__array__:{__target__:!0,color:{type:"Kd",get:e=>{var d;return null===(d=e._babylonLight)||void 0===d?void 0:d.AX},set:(e,d)=>{var v;return null===(v=d._babylonLight)||void 0===v?void 0:v.AX.L(e)},getTarget:e=>e._babylonLight,getPropertyName:[e=>"diffuse"]},nX:{type:"number",get:e=>{var d;return null===(d=e._babylonLight)||void 0===d?void 0:d.nX},set:(e,d)=>d._babylonLight?d._babylonLight.nX=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"intensity"]},range:{type:"number",get:e=>{var d;return null===(d=e._babylonLight)||void 0===d?void 0:d.range},set:(e,d)=>d._babylonLight?d._babylonLight.range=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"range"]},spot:{innerConeAngle:{type:"number",get:e=>{var d;return null===(d=e._babylonLight)||void 0===d?void 0:d.innerAngle},set:(e,d)=>d._babylonLight?d._babylonLight.innerAngle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"innerConeAngle"]},outerConeAngle:{type:"number",get:e=>{var d;return null===(d=e._babylonLight)||void 0===d?void 0:d.angle},set:(e,d)=>d._babylonLight?d._babylonLight.angle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonLight)),getPropertyName:[e=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonTexture)),getPropertyName:[e=>"length"]},__array__:{__target__:!0,nX:{type:"number",get:e=>{var d;return null===(d=e._babylonTexture)||void 0===d?void 0:d.level},set:(e,d)=>{d._babylonTexture&&(d._babylonTexture.level=e)},getTarget:e=>e._babylonTexture},rotation:{type:"Quaternion",get:e=>{var d;return e._babylonTexture&&P.Quaternion.FromRotationMatrix(null===(d=e._babylonTexture)||void 0===d?void 0:d.getReflectionTextureMatrix())},set:(e,d)=>{var v;d._babylonTexture&&(null!==(v=d._babylonTexture.Ae())&&void 0!==v&&v.useRightHandedSystem||(e=P.Quaternion.Inverse(e)),P.Matrix.FromQuaternionToRef(e,d._babylonTexture.getReflectionTextureMatrix()))},getTarget:e=>e._babylonTexture}}}}},animations:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>{var d;return null===(d=e.primitives[0]._instanceData)||void 0===d?void 0:d.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function F(e){return new z(e,g)}function w(e){const d=e.split("/").map((e=>e.replace(/{}/g,"__array__")));let v=g;for(const P of d)P&&(v=v[P]);if(v&&v.type&&v.get)return v}function G(e,d){const v=e.split("/").map((e=>e.replace(/{}/g,"__array__")));let P=g;for(const p of v)p&&(P=P[p]);P&&P.type&&P.get&&(P.interpolation=d)}function U(e,d){const v=e.split("/").map((e=>e.replace(/{}/g,"__array__")));let P=g;for(const p of v)if(p){if(!P[p]){if("?"===p){P.__ignoreObjectTree__=!0;continue}P[p]={},"__array__"===p&&(P[p].__target__=!0)}P=P[p]}Object.assign(P,d)}},14139:(e,d,v)=>{"use strict";v.r(d),v.d(d,{AnimationPropertyInfo:()=>W,TransformNodeAnimationPropertyInfo:()=>V,WeightAnimationPropertyInfo:()=>k,getQuaternion:()=>X,getVector3:()=>B,getWeights:()=>z});var P=v(12948),p=v(12420),L=v(14129);function B(e,d,v,P){return p.mv.Nd(d,v).scaleInPlace(P)}function X(e,d,v,P){return p.Quaternion.Nd(d,v).scaleInPlace(P)}function z(e,d,v,P){const p=new Array(e._numMorphTargets);for(let L=0;L<p.length;L++)p[L]=d[v++]*P;return p}class W{constructor(e,d,v,P){this.type=e,this.name=d,this.getValue=v,this.getStride=P}_buildAnimation(e,d,v){const p=new P.e(e,this.name,d,this.type);return p.setKeys(v),p}}class V extends W{buildAnimations(e,d,v,P){const p=[];return p.push({babylonAnimatable:e._babylonTransformNode,babylonAnimation:this._buildAnimation(d,v,P)}),p}}class k extends W{buildAnimations(e,d,v,p){const L=[];if(e._numMorphTargets)for(let B=0;B<e._numMorphTargets;B++){const X=new P.e(`${d}_${B}`,this.name,v,this.type);if(X.setKeys(p.map((e=>({frame:e.frame,inTangent:e.inTangent?e.inTangent[B]:void 0,value:e.value[B],outTangent:e.outTangent?e.outTangent[B]:void 0,interpolation:e.interpolation})))),e._primitiveBabylonMeshes)for(const d of e._primitiveBabylonMeshes)if(d.morphTargetManager){const e=d.morphTargetManager.getTarget(B),v=X.clone();e.animations.push(v),L.push({babylonAnimatable:e,babylonAnimation:v})}}return L}}(0,L.m)("/nodes/{}/translation",[new V(P.e.ANIMATIONTYPE_VECTOR3,"position",B,(()=>3))]),(0,L.m)("/nodes/{}/rotation",[new V(P.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",X,(()=>4))]),(0,L.m)("/nodes/{}/scale",[new V(P.e.ANIMATIONTYPE_VECTOR3,"tv",B,(()=>3))]),(0,L.m)("/nodes/{}/weights",[new k(P.e.ANIMATIONTYPE_FLOAT,"influence",z,(e=>e._numMorphTargets))])},14100:(e,d,v)=>{"use strict";class P{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((e,d)=>{this._resolve=e,this._reject=d}))}}var p=v(12420),L=v(12463),B=v(12240),X=v(12872),z=v(14102),W=v(14116),V=v(12248),k=v(12893),g=v(12948),F=v(12950),w=v(12281),G=v(12253),U=v(12262);class D{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(e){this._useTextureToStoreBoneMatrices=e,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(e,d,v){this.name=e,this.id=d,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=p.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new V.d,this.bones=[],this._scene=v||w.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const P=this._scene.getEngine().getCaps();this._canUseTextureForBones=P.textureFloat&&P.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((e=>!e.getParent()))}getTransformMatrices(e){if(this.needInitialSkinMatrix){if(!e)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return e._bonesTransformMatrices||this.prepare(!0),e._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(e){return this.needInitialSkinMatrix&&e._transformMatrixTexture?e._transformMatrixTexture:this._transformMatrixTexture}Ae(){return this._scene}toString(e){let d=`Name: ${this.name}, nBones: ${this.bones.length}`;if(d+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,e){d+=", Ranges: {";let e=!0;for(const v in this._ranges)e&&(d+=", ",e=!1),d+=v;d+="}"}return d}getBoneIndexByName(e){for(let d=0,v=this.bones.length;d<v;d++)if(this.bones[d].name===e)return d;return-1}createAnimationRange(e,d,v){if(!this._ranges[e]){this._ranges[e]=new F.b(e,d,v);for(let P=0,p=this.bones.length;P<p;P++)this.bones[P].animations[0]&&this.bones[P].animations[0].createRange(e,d,v)}}deleteAnimationRange(e){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let v=0,P=this.bones.length;v<P;v++)this.bones[v].animations[0]&&this.bones[v].animations[0].deleteRange(e,d);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}getAnimationRanges(){const e=[];let d;for(d in this._ranges)e.push(this._ranges[d]);return e}copyAnimationRange(e,d){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[d]||!e.getAnimationRange(d))return!1;let P=!0;const p=this._getHighestAnimationFrame()+1,L={},B=e.bones;let X,z;for(z=0,X=B.length;z<X;z++)L[B[z].name]=B[z];this.bones.length!==B.length&&(G.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${B.length}`),P=!1);const W=v&&this.dimensionsAtRest&&e.dimensionsAtRest?this.dimensionsAtRest.divide(e.dimensionsAtRest):null;for(z=0,X=this.bones.length;z<X;z++){const e=this.bones[z].name,B=L[e];B?P=P&&this.bones[z].copyAnimationRange(B,d,p,v,W):(G.c.Warn("copyAnimationRange: not same rig, missing source bone "+e),P=!1)}const V=e.getAnimationRange(d);return V&&(this._ranges[d]=new F.b(d,V.from+p,V.to+p)),P}returnToRest(){for(const e of this.bones)-1!==e._index&&e.returnToRest()}_getHighestAnimationFrame(){let e=0;for(let d=0,v=this.bones.length;d<v;d++)if(this.bones[d].animations[0]){const v=this.bones[d].animations[0].getHighestFrame();e<v&&(e=v)}return e}beginAnimation(e,d,v,P){const p=this.getAnimationRange(e);return p?this._scene.beginAnimation(this,p.from,p.to,d,v,P):null}static MakeAnimationAdditive(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2?arguments[2]:void 0;const P=e.getAnimationRange(v);if(!P)return null;const p=e._scene.getAllAnimatablesByTarget(e);let L=null;for(let X=0;X<p.length;X++){const e=p[X];if(e.fromFrame===(null===P||void 0===P?void 0:P.from)&&e.toFrame===(null===P||void 0===P?void 0:P.to)){L=e;break}}const B=e.getAnimatables();for(let X=0;X<B.length;X++){const e=B[X].animations;if(e)for(let P=0;P<e.length;P++)g.e.MakeAnimationAdditive(e[P],d,v)}return L&&(L.isAdditive=!0),e}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(e){this._meshesWithPoseMatrix.push(e)}_unregisterMeshWithPoseMatrix(e){const d=this._meshesWithPoseMatrix.indexOf(e);d>-1&&this._meshesWithPoseMatrix.splice(d,1)}_computeTransformMatrices(e,d){this.onBeforeComputeObservable.notifyObservers(this);for(let v=0;v<this.bones.length;v++){const P=this.bones[v];P._childUpdateId++;const p=P.getParent();if(p?P.getLocalMatrix().multiplyToRef(p.getFinalMatrix(),P.getFinalMatrix()):d?P.getLocalMatrix().multiplyToRef(d,P.getFinalMatrix()):P.getFinalMatrix().L(P.getLocalMatrix()),-1!==P._index){const d=null===P._index?v:P._index;P.getAbsoluteInverseBindMatrix().multiplyToArray(P.getFinalMatrix(),e,16*d)}}this._identity.copyToArray(e,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const e=this.Ae().getRenderId();if(this._currentRenderId===e)return;this._currentRenderId=e}if(this._numBonesWithLinkedTransformNode>0)for(const e of this.bones)if(e._linkedTransformNode){const d=e._linkedTransformNode;e.position=d.position,d.rotationQuaternion?e.rotationQuaternion=d.rotationQuaternion:e.rotation=d.rotation,e.tv=d.tv}if(this.needInitialSkinMatrix)for(const e of this._meshesWithPoseMatrix){const d=e.getPoseMatrix();let v=this._isDirty;if(e._bonesTransformMatrices&&e._bonesTransformMatrices.length===16*(this.bones.length+1)||(e._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),v=!0),v){if(this._synchronizedWithMesh!==e){this._synchronizedWithMesh=e;for(const e of this.bones)if(!e.getParent()){e.getBindMatrix().multiplyToRef(d,p.TmpVectors.Matrix[1]),e._updateAbsoluteBindMatrices(p.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const d=4*(this.bones.length+1);e._transformMatrixTexture&&e._transformMatrixTexture.getSize().width===d||(e._transformMatrixTexture&&e._transformMatrixTexture.dispose(),e._transformMatrixTexture=k.b.CreateRGBATexture(e._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(e._bonesTransformMatrices,d),this.isUsingTextureForMatrices&&e._transformMatrixTexture&&e._transformMatrixTexture.update(e._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=k.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables}clone(e,d){const v=new D(e,d||e,this._scene);v.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let P=0;P<this.bones.length;P++){const e=this.bones[P];let d=null;const p=e.getParent();if(p){const e=this.bones.indexOf(p);d=v.bones[e]}const L=new W.c(e.name,v,d,e.getBindMatrix().clone(),e.getRestMatrix().clone());L._index=e._index,e._linkedTransformNode&&L.linkTransformNode(e._linkedTransformNode),U.e.DeepCopy(e.animations,L.animations)}if(this._ranges){v._ranges={};for(const e in this._ranges){const d=this._ranges[e];d&&(v._ranges[e]=d.clone())}}return this._isDirty=!0,v.prepare(!0),v}enableBlending(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const d of this.bones)for(const v of d.animations)v.enableBlending=!0,v.blendingSpeed=e}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Ae().stopAnimation(this),this.Ae().removeSkeleton(this),this._parentContainer){const e=this._parentContainer.skeletons.indexOf(this);e>-1&&this._parentContainer.skeletons.splice(e,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.Yd()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let v=0;v<this.bones.length;v++){var d;const P=this.bones[v],p=P.getParent(),L={parentBoneIndex:p?this.bones.indexOf(p):-1,index:P.getIndex(),name:P.name,id:P.id,matrix:P.getBindMatrix().Yd(),rest:P.getRestMatrix().Yd(),linkedTransformNodeId:null===(d=P.getTransformNode())||void 0===d?void 0:d.id};e.bones.push(L),P.length&&(L.length=P.length),P.metadata&&(L.metadata=P.metadata),P.animations&&P.animations.length>0&&(L.animation=P.animations[0].serialize()),e.ranges=[];for(const d in this._ranges){const v=this._ranges[d];if(!v)continue;const P={};P.name=d,P.from=v.from,P.to=v.to,e.ranges.push(P)}}return e}static Parse(e,d){const v=new D(e.name,e.id,d);let P;for(e.dimensionsAtRest&&(v.dimensionsAtRest=p.mv.Nd(e.dimensionsAtRest)),v.needInitialSkinMatrix=e.needInitialSkinMatrix,P=0;P<e.bones.length;P++){const d=e.bones[P],L=e.bones[P].index;let B=null;d.parentBoneIndex>-1&&(B=v.bones[d.parentBoneIndex]);const X=d.rest?p.Matrix.Nd(d.rest):null,z=new W.c(d.name,v,B,p.Matrix.Nd(d.matrix),X,null,L);void 0!==d.id&&null!==d.id&&(z.id=d.id),d.length&&(z.length=d.length),d.metadata&&(z.metadata=d.metadata),d.animation&&z.animations.push(g.e.Parse(d.animation)),void 0!==d.linkedTransformNodeId&&null!==d.linkedTransformNodeId&&(v._hasWaitingData=!0,z._waitingTransformNodeId=d.linkedTransformNodeId)}if(e.ranges)for(P=0;P<e.ranges.length;P++){const d=e.ranges[P];v.createAnimationRange(d.name,d.from,d.to)}return v}computeAbsoluteMatrices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||e)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(e)}getPoseMatrix(){let e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e}sortBones(){const e=[],d=new Array(this.bones.length);for(let v=0;v<this.bones.length;v++)this._sortBones(v,e,d);this.bones=e}_sortBones(e,d,v){if(v[e])return;v[e]=!0;const P=this.bones[e];if(!P)return;void 0===P._index&&(P._index=e);const p=P.getParent();p&&this._sortBones(this.bones.indexOf(p),d,v),d.push(P)}setCurrentPoseAsRest(){for(const e of this.bones)e.setCurrentPoseAsRest()}}var C=v(12734),q=v(12911),h=v(12399),l=v(12829),n=v(12490),A=v(12877),x=v(12839),i=v(12864),me=v(12955),r=v(12512),Z=v(14065);class f{set areUpdatesFrozen(e){e?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new r.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,e||(e=w.c.LastCreatedScene),this._scene=e,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const e=this._scene.getEngine().getCaps();this._canUseTextureForTargets=e.canUseGLVertexID&&e.textureFloat&&e.maxVertexTextureImageUnits>0&&e.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return f.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?f.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(e){this._numMaxInfluencers!==e&&(this._numMaxInfluencers=e,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(e){this._useTextureToStoreTargets!==e&&(this._useTextureToStoreTargets=e,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var e;return f.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(e=this._scene)&&void 0!==e&&e.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(e){return this._activeTargets.data[e]}getTarget(e){return this._targets[e]}getTargetByName(e){for(const d of this._targets)if(d.name===e)return d;return null}addTarget(e){this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add((e=>{this.areUpdatesFrozen&&e&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(e)}))),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(e){const d=this._targets.indexOf(e);d>=0&&(this._targets.splice(d,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(d,1)[0]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(d,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(e)}_bind(e){e.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),e.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),e.setTexture("morphTargets",this._targetStoreTexture),e.setInt("morphTargetCount",this.numInfluencers)}clone(){const e=new f(this._scene);for(const d of this._targets)e.addTarget(d.clone());return e.enablePositionMorphing=this.enablePositionMorphing,e.enableNormalMorphing=this.enableNormalMorphing,e.enableTangentMorphing=this.enableTangentMorphing,e.enableUVMorphing=this.enableUVMorphing,e.enableUV2Morphing=this.enableUV2Morphing,e.enableColorMorphing=this.enableColorMorphing,e}serialize(){const e={};e.id=this.uniqueId,e.targets=[];for(const d of this._targets)e.targets.push(d.serialize());return e}_syncActiveTargets(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const d=!!this._targetStoreTexture,v=this.isUsingTextureForTargets;(this._mustSynchronize||d!==v)&&(this._mustSynchronize=!1,this.synchronize());let P=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let p=-1;for(const L of this._targets)if(p++,0!==L.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=f.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(L),this._morphTargetTextureIndices[P]=p,this._tempInfluences[P++]=L.influence}this._morphTargetTextureIndices.length!==P&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,P)),this._influences&&this._influences.length===P||(this._influences=new Float32Array(P));for(let L=0;L<P;L++)this._influences[L]=this._tempInfluences[L];if(e&&this._scene)for(const L of this._scene.meshes)L.morphTargetManager===this&&(v?L._markSubMeshesAsAttributesDirty():L._syncGeometryWithMorphTargetManager())}synchronize(){var e;if(!this._scene||this.areUpdatesFrozen)return;const d=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(e=this._targetStoreTexture)||void 0===e||e.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>d.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const v of this._targets){this._supportsPositions=this._supportsPositions&&v.hasPositions,this._supportsNormals=this._supportsNormals&&v.hasNormals,this._supportsTangents=this._supportsTangents&&v.hasTangents,this._supportsUVs=this._supportsUVs&&v.hasUVs,this._supportsUV2s=this._supportsUV2s&&v.hasUV2s,this._supportsColors=this._supportsColors&&v.hasColors;const e=v.vertexCount;if(0===this._vertexCount)this._vertexCount=e;else if(this._vertexCount!==e)return void G.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${v.name}": ${e}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const e=d.getCaps().maxTextureSize;this._textureWidth>e&&(this._textureHeight=Math.ceil(this._textureWidth/e),this._textureWidth=e);const v=this._targets.length,P=new Float32Array(v*this._textureWidth*this._textureHeight*4);let p=0;for(let d=0;d<v;d++){const e=this._targets[d],v=e.getPositions(),L=e.getNormals(),B=e.getUVs(),X=e.getTangents(),z=e.getUV2s(),W=e.getColors();p=d*this._textureWidth*this._textureHeight*4;for(let d=0;d<this._vertexCount;d++)this._supportsPositions&&v&&(P[p]=v[3*d],P[p+1]=v[3*d+1],P[p+2]=v[3*d+2],p+=4),this._supportsNormals&&L&&(P[p]=L[3*d],P[p+1]=L[3*d+1],P[p+2]=L[3*d+2],p+=4),this._supportsUVs&&B&&(P[p]=B[2*d],P[p+1]=B[2*d+1],p+=4),this._supportsTangents&&X&&(P[p]=X[3*d],P[p+1]=X[3*d+1],P[p+2]=X[3*d+2],p+=4),this._supportsUV2s&&z&&(P[p]=z[2*d],P[p+1]=z[2*d+1],p+=4),this._supportsColors&&W&&(P[p]=W[4*d],P[p+1]=W[4*d+1],P[p+2]=W[4*d+2],P[p+3]=W[4*d+3],p+=4)}this._targetStoreTexture=Z.c.CreateRGBATexture(P,this._textureWidth,this._textureHeight,v,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const v of this._scene.meshes)v.morphTargetManager===this&&v._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const e=this._parentContainer.morphTargetManagers.indexOf(this);e>-1&&this._parentContainer.morphTargetManagers.splice(e,1),this._parentContainer=null}for(const e of this._targets)this._scene.stopAnimation(e)}}static Parse(e,d){const v=new f(d);for(const P of e.targets)v.addTarget(me.e.Parse(P,d));return v}}f.EnableTextureStorage=!0,f.MaxActiveMorphTargetsInVertexAttributeMode=8,f.ConstantTargetCountForTextureMode=0;var T=v(14119),S=v(12283),o=v(12752);const K=new Map,Q=K;function N(e,d,v){u(e)&&G.c.Warn(`Extension with the name '${e}' already exists`),K.set(e,{isGLTFExtension:d,factory:v})}function u(e){return K.delete(e)}var O=v(14129),R=v(13007),Y=v(12499);class H{static Get(e,d,v){if(!d||void 0==v||!d[v])throw new Error(`${e}: Failed to find index (${v})`);return d[v]}static TryGet(e,d){return e&&void 0!=d&&e[d]?e[d]:null}static Assign(e){if(e)for(let d=0;d<e.length;d++)e[d].index=d}}function a(e){if(e.min&&e.max){const d=e.min,v=e.max,P=p.TmpVectors.mv[0].Ed(d[0],d[1],d[2]),L=p.TmpVectors.mv[1].Ed(v[0],v[1],v[2]);if(e.normalized&&5126!==e.componentType){let d=1;switch(e.componentType){case 5120:d=127;break;case 5121:d=255;break;case 5122:d=32767;break;case 5123:d=65535}const v=1/d;P.scaleInPlace(v),L.scaleInPlace(v)}return new o.b(P,L)}return null}class t{static RegisterExtension(e,d){N(e,!1,d)}static UnregisterExtension(e){return u(e)}get rd(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(e){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=e}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((e=>e.dispose&&e.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(e,d,v,P,p,L){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=d,this._assetContainer=v,this._loadData(P);let L=null;if(e){const d={};if(this._gltf.nodes)for(const e of this._gltf.nodes)e.name&&(d[e.name]=e.index);L=(e instanceof Array?e:[e]).map((e=>{const v=d[e];if(void 0===v)throw new Error(`Failed to find node '${e}'`);return v}))}return await this._loadAsync(p,B,L,(()=>({meshes:this._getMeshes(),sk:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=e,this._loadData(d),await this._loadAsync(v,p,null,(()=>{}))}async _loadAsync(e,d,v,P){return await Promise.resolve().then((async()=>{this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&d?e:`${e}${Date.now()}/`,this._fileName=d,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const p=`${T.j[T.j.LOADING]} => ${T.j[T.j.READY]}`,L=`${T.j[T.j.LOADING]} => ${T.j[T.j.COMPLETE]}`;this._parent._startPerformanceCounter(p),this._parent._startPerformanceCounter(L),this._parent._setState(T.j.LOADING),this._extensionsOnLoading();const X=new Array;if(!this.parent.loadOnlyMaterials)if(v)X.push(this.loadSceneAsync("/nodes",{nodes:v,index:-1}));else if(void 0!=this._gltf.fd||this._gltf.scenes&&this._gltf.scenes[0]){const e=H.Get("/scene",this._gltf.scenes,this._gltf.fd||0);X.push(this.loadSceneAsync(`/scenes/${e.index}`,e))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let e=0;e<this._gltf.materials.length;++e){const d=this._gltf.materials[e],v="/materials/"+e,P=C.b.TriangleFillMode;X.push(this._loadMaterialAsync(v,d,null,P,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&X.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&X.push(this._compileShadowGeneratorsAsync());const z=Promise.all(X).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.YX(!0);for(const e of this._babylonScene.materials){const d=e;void 0!==d.maxSimultaneousLights&&(d.maxSimultaneousLights=Math.max(d.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(T.j.READY),this._skipStartAnimationStep||this._startAnimations(),P()}));return await z.then((e=>(this._parent._endPerformanceCounter(p),B.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(L),this._parent._setState(T.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(e=>{this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()}))})),e)))})).catch((e=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()),e}))}_loadData(e){if(this._gltf=e.json,this._setupData(),e.bin){const d=this._gltf.buffers;if(d&&d[0]&&!d[0].uri){const v=d[0];(v.byteLength<e.bin.byteLength-3||v.byteLength>e.bin.byteLength)&&G.c.Warn(`Binary buffer length (${v.byteLength}) from JSON does not match chunk length (${e.bin.byteLength})`),this._bin=e.bin}else G.c.Warn("Unexpected BIN chunk")}}_setupData(){if(H.Assign(this._gltf.accessors),H.Assign(this._gltf.animations),H.Assign(this._gltf.buffers),H.Assign(this._gltf.bufferViews),H.Assign(this._gltf.cameras),H.Assign(this._gltf.images),H.Assign(this._gltf.materials),H.Assign(this._gltf.meshes),H.Assign(this._gltf.nodes),H.Assign(this._gltf.samplers),H.Assign(this._gltf.scenes),H.Assign(this._gltf.skins),H.Assign(this._gltf.textures),this._gltf.nodes){const e={};for(const v of this._gltf.nodes)if(v.children)for(const d of v.children)e[d]=v.index;const d=this._createRootNode();for(const v of this._gltf.nodes){const P=e[v.index];v.parent=void 0===P?d:this._gltf.nodes[P]}}}async _loadExtensionsAsync(){const e=[];if(Q.forEach(((d,v)=>{var P;!1===(null===(P=this.parent.extensionOptions[v])||void 0===P?void 0:P.enabled)?d.isGLTFExtension&&this.isExtensionUsed(v)&&G.c.Warn(`Extension ${v} is used but has been explicitly disabled.`):d.isGLTFExtension&&!this.isExtensionUsed(v)||e.push((async()=>{const e=await d.factory(this);return e.name!==v&&G.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${e.name} !== ${v}`),this._parent.onExtensionLoadedObservable.notifyObservers(e),e})())})),this._extensions.push(...await Promise.all(e)),this._extensions.sort(((e,d)=>(e.order||Number.MAX_VALUE)-(d.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const v of this._gltf.extensionsRequired){if(!this._extensions.some((e=>e.name===v&&e.enabled))){var d;if(!1===(null===(d=this.parent.extensionOptions[v])||void 0===d?void 0:d.enabled))throw new Error(`Required extension ${v} is disabled`);throw new Error(`Required extension ${v} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new i.b("__root__",this._babylonScene);this._rootBabylonMesh=e,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.YX(!1);const d={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case T.h.AUTO:this._babylonScene.useRightHandedSystem||(d.rotation=[0,1,0,0],d.scale=[1,1,-1],t._LoadTransform(d,this._rootBabylonMesh));break;case T.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(e),d}loadSceneAsync(e,d){const v=this._extensionsLoadSceneAsync(e,d);if(v)return v;const P=new Array;if(this.logOpen(`${e} ${d.name||""}`),d.nodes)for(const p of d.nodes){const d=H.Get(`${e}/nodes/${p}`,this._gltf.nodes,p);P.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(e=>{e.parent=this._rootBabylonMesh})))}for(const p of this._postSceneLoadActions)p();return P.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(P).then((()=>{}))}_forEachPrimitive(e,d){if(e._primitiveBabylonMeshes)for(const v of e._primitiveBabylonMeshes)d(v)}_getGeometries(){const e=[],d=this._gltf.nodes;if(d)for(const v of d)this._forEachPrimitive(v,(d=>{const v=d.sd;v&&-1===e.indexOf(v)&&e.push(v)}));return e}_getMeshes(){const e=[];this._rootBabylonMesh instanceof x.d&&e.push(this._rootBabylonMesh);const d=this._gltf.nodes;if(d)for(const v of d)this._forEachPrimitive(v,(d=>{e.push(d)}));return e}_getTransformNodes(){const e=[],d=this._gltf.nodes;if(d)for(const v of d)v._babylonTransformNode&&"pg"===v._babylonTransformNode.getClassName()&&e.push(v._babylonTransformNode),v._babylonTransformNodeForSkin&&e.push(v._babylonTransformNodeForSkin);return e}_getSkeletons(){const e=[],d=this._gltf.skins;if(d)for(const v of d)v._data&&e.push(v._data.babylonSkeleton);return e}_getAnimationGroups(){const e=[],d=this._gltf.animations;if(d)for(const v of d)v._babylonAnimationGroup&&e.push(v._babylonAnimationGroup);return e}_startAnimations(){switch(this._parent.animationStartMode){case T.f.NONE:break;case T.f.FIRST:{const e=this._getAnimationGroups();0!==e.length&&e[0].start(!0);break}case T.f.ALL:{const e=this._getAnimationGroups();for(const d of e)d.start(!0);break}default:return void G.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadNodeAsync(e,d,v);if(P)return P;if(d._babylonTransformNode)throw new Error(`${e}: Invalid recursive node hierarchy`);const p=new Array;this.logOpen(`${e} ${d.name||""}`);const L=P=>{if(t.AddPointerMetadata(P,e),t._LoadTransform(d,P),void 0!=d.camera){const v=H.Get(`${e}/camera`,this._gltf.cameras,d.camera);p.push(this.loadCameraAsync(`/cameras/${v.index}`,v,(e=>{e.parent=P,this._babylonScene.useRightHandedSystem||(P.tv.x=-1)})))}if(d.children)for(const v of d.children){const d=H.Get(`${e}/children/${v}`,this._gltf.nodes,v);p.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(e=>{e.parent=P})))}v(P)},B=void 0!=d.mesh,X=this._parent.loadSkins&&void 0!=d.skin;if(!B||X){const e=d.name||`node${d.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new l.c(e,this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==d.mesh?d._babylonTransformNode=v:d._babylonTransformNodeForSkin=v,L(v)}if(B)if(X){const v=H.Get(`${e}/mesh`,this._gltf.meshes,d.mesh);p.push(this._loadMeshAsync(`/meshes/${v.index}`,d,v,(v=>{const P=d._babylonTransformNodeForSkin;v.metadata=(0,R.c)(P.metadata,v.metadata||{});const L=H.Get(`${e}/skin`,this._gltf.skins,d.skin);p.push(this._loadSkinAsync(`/skins/${L.index}`,d,L,(e=>{this._forEachPrimitive(d,(d=>{d.skeleton=e})),this._postSceneLoadActions.push((()=>{if(void 0!=L.skeleton){const e=H.Get(`/skins/${L.index}/skeleton`,this._gltf.nodes,L.skeleton).parent;d.index===e.index?v.parent=P.parent:v.parent=e._babylonTransformNode}else v.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:P,skinnedNode:v})}))})))})))}else{const v=H.Get(`${e}/mesh`,this._gltf.meshes,d.mesh);p.push(this._loadMeshAsync(`/meshes/${v.index}`,d,v,L))}return this.logClose(),Promise.all(p).then((()=>(this._forEachPrimitive(d,(e=>{const d=e;!d.isAnInstance&&d.sd&&d.sd.useBoundingInfoFromGeometry?e.oe():e.refreshBoundingInfo(!0,!0)})),d._babylonTransformNode)))}_loadMeshAsync(e,d,v,P){const p=v.primitives;if(!p||!p.length)throw new Error(`${e}: Primitives are missing`);void 0==p[0].index&&H.Assign(p);const L=new Array;this.logOpen(`${e} ${v.name||""}`);const B=d.name||`node${d.index}`;if(1===p.length){const P=v.primitives[0];L.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${P.index}`,B,d,v,P,(e=>{d._babylonTransformNode=e,d._primitiveBabylonMeshes=[e]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,d._babylonTransformNode=new l.c(B,this._babylonScene),d._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._primitiveBabylonMeshes=[];for(const P of p)L.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${P.index}`,`${B}_primitive${P.index}`,d,v,P,(e=>{e.parent=d._babylonTransformNode,d._primitiveBabylonMeshes.push(e)})))}return P(d._babylonTransformNode),this.logClose(),Promise.all(L).then((()=>d._babylonTransformNode))}_loadMeshPrimitiveAsync(e,d,v,P,p,L){const B=this._extensionsLoadMeshPrimitiveAsync(e,d,v,P,p,L);if(B)return B;this.logOpen(`${e}`);const X=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==v.skin&&!P.primitives[0].targets;let z,W;if(X&&p._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,z=p._instanceData.babylonSourceMesh.createInstance(d),z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W=p._instanceData.promise;else{const L=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new i.b(d,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.sideOrientation=this._babylonScene.useRightHandedSystem?C.b.CounterClockWiseSideOrientation:C.b.ClockWiseSideOrientation,this._createMorphTargets(e,v,P,p,B),L.push(this._loadVertexDataAsync(e,p,B).then((async d=>await this._loadMorphTargetsAsync(e,p,B,d).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,d.Te(B),d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const V=t._GetDrawMode(e,p.mode);if(void 0==p.material){let e=this._defaultBabylonMaterialData[V];e||(e=this._createDefaultMaterial("__GLTFLoader._default",V),this._parent.onMaterialLoadedObservable.notifyObservers(e),this._defaultBabylonMaterialData[V]=e),B.material=e}else if(!this.parent.skipMaterials){const d=H.Get(`${e}/material`,this._gltf.materials,p.material);L.push(this._loadMaterialAsync(`/materials/${d.index}`,d,B,V,(e=>{B.material=e})))}W=Promise.all(L),X&&(p._instanceData={babylonSourceMesh:B,promise:W}),z=B}return t.AddPointerMetadata(z,e),this._parent.onMeshLoadedObservable.notifyObservers(z),L(z),this.logClose(),W.then((()=>z))}_loadVertexDataAsync(e,d,v){const P=this._extensionsLoadVertexDataAsync(e,d,v);if(P)return P;const p=d.attributes;if(!p)throw new Error(`${e}: Attributes are missing`);const L=new Array,B=new A.c(v.name,this._babylonScene);if(void 0==d.indices)v.isUnIndexed=!0;else{const v=H.Get(`${e}/indices`,this._gltf.accessors,d.indices);L.push(this._loadIndicesAccessorAsync(`/accessors/${v.index}`,v).then((e=>{B.setIndices(e)})))}const X=(d,P,X)=>{if(void 0==p[d])return;v._delayInfo=v._delayInfo||[],-1===v._delayInfo.indexOf(P)&&v._delayInfo.push(P);const z=H.Get(`${e}/attributes/${d}`,this._gltf.accessors,p[d]);L.push(this._loadVertexAccessorAsync(`/accessors/${z.index}`,z,P).then((e=>{if(e.getKind()===n.i.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!v.skeleton){const e=a(z);e&&(B._boundingInfo=e,B.useBoundingInfoFromGeometry=!0)}B.setVerticesBuffer(e,z.count)}))),P==n.i.MatricesIndicesExtraKind&&(v.numBoneInfluencers=8),X&&X(z)};return X("POSITION",n.i.PositionKind),X("NORMAL",n.i.NormalKind),X("TANGENT",n.i.TangentKind),X("TEXCOORD_0",n.i.UVKind),X("TEXCOORD_1",n.i.UV2Kind),X("TEXCOORD_2",n.i.UV3Kind),X("TEXCOORD_3",n.i.UV4Kind),X("TEXCOORD_4",n.i.UV5Kind),X("TEXCOORD_5",n.i.UV6Kind),X("JOINTS_0",n.i.MatricesIndicesKind),X("WEIGHTS_0",n.i.MatricesWeightsKind),X("JOINTS_1",n.i.MatricesIndicesExtraKind),X("WEIGHTS_1",n.i.MatricesWeightsExtraKind),X("COLOR_0",n.i.ColorKind,(e=>{"VEC4"===e.type&&(v.hasVertexAlpha=!0)})),Promise.all(L).then((()=>B))}_createMorphTargets(e,d,v,P,p){if(!P.targets||!this._parent.loadMorphTargets)return;if(void 0==d._numMorphTargets)d._numMorphTargets=P.targets.length;else if(P.targets.length!==d._numMorphTargets)throw new Error(`${e}: Primitives do not have the same number of targets`);const L=v.extras?v.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,p.morphTargetManager=new f(this._babylonScene),p.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.morphTargetManager.areUpdatesFrozen=!0;for(let B=0;B<P.targets.length;B++){const e=d.weights?d.weights[B]:v.weights?v.weights[B]:0,P=L?L[B]:`morphTarget${B}`;p.morphTargetManager.addTarget(new me.e(P,e,p.Ae()))}}_loadMorphTargetsAsync(e,d,v,P){if(!d.targets||!this._parent.loadMorphTargets)return Promise.resolve();const p=new Array,L=v.morphTargetManager;for(let B=0;B<L.numTargets;B++){const v=L.getTarget(B);p.push(this._loadMorphTargetVertexDataAsync(`${e}/targets/${B}`,P,d.targets[B],v))}return Promise.all(p).then((()=>{L.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(e,d,v,P){const p=new Array,L=(P,L,B)=>{if(void 0==v[P])return;const X=d.getVertexBuffer(L);if(!X)return;const z=H.Get(`${e}/${P}`,this._gltf.accessors,v[P]);p.push(this._loadFloatAccessorAsync(`/accessors/${z.index}`,z).then((e=>{B(X,e)})))};return L("POSITION",n.i.PositionKind,((e,d)=>{const v=new Float32Array(d.length);e.forEach(d.length,((e,P)=>{v[P]=d[P]+e})),P.setPositions(v)})),L("NORMAL",n.i.NormalKind,((e,d)=>{const v=new Float32Array(d.length);e.forEach(v.length,((e,P)=>{v[P]=d[P]+e})),P.setNormals(v)})),L("TANGENT",n.i.TangentKind,((e,d)=>{const v=new Float32Array(d.length/3*4);let p=0;e.forEach(d.length/3*4,((e,P)=>{(P+1)%4!==0&&(v[p]=d[p]+e,p++)})),P.setTangents(v)})),L("TEXCOORD_0",n.i.UVKind,((e,d)=>{const v=new Float32Array(d.length);e.forEach(d.length,((e,P)=>{v[P]=d[P]+e})),P.setUVs(v)})),L("TEXCOORD_1",n.i.UV2Kind,((e,d)=>{const v=new Float32Array(d.length);e.forEach(d.length,((e,P)=>{v[P]=d[P]+e})),P.setUV2s(v)})),L("COLOR_0",n.i.ColorKind,((d,v)=>{let p=null;const L=d.getSize();if(3===L){p=new Float32Array(v.length/3*4),d.forEach(v.length,((e,d)=>{const P=Math.floor(d/3),L=d%3;p[4*P+L]=v[3*P+L]+e}));for(let e=0;e<v.length/3;++e)p[4*e+3]=1}else{if(4!==L)throw new Error(`${e}: Invalid number of components (${L}) for COLOR_0 attribute`);p=new Float32Array(v.length),d.forEach(v.length,((e,d)=>{p[d]=v[d]+e}))}P.setColors(p)})),await Promise.all(p).then((()=>{}))}static _LoadTransform(e,d){if(void 0!=e.skin)return;let v=p.mv.Zero(),P=p.Quaternion.Identity(),L=p.mv.One();if(e.matrix){p.Matrix.Nd(e.matrix).decompose(L,P,v)}else e.translation&&(v=p.mv.Nd(e.translation)),e.rotation&&(P=p.Quaternion.Nd(e.rotation)),e.scale&&(L=p.mv.Nd(e.scale));d.position=v,d.rotationQuaternion=P,d.tv=L}_loadSkinAsync(e,d,v,P){if(!this._parent.loadSkins)return Promise.resolve();const p=this._extensionsLoadSkinAsync(e,d,v);if(p)return p;if(v._data)return P(v._data.babylonSkeleton),v._data.promise;const L=`skeleton${v.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new D(v.name||L,L,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,v,B);const X=this._loadSkinInverseBindMatricesDataAsync(e,v).then((e=>{this._updateBoneMatrices(B,e)}));return v._data={babylonSkeleton:B,promise:X},P(B),X}_loadBones(e,d,v){if(void 0==d.skeleton||this._parent.alwaysComputeSkeletonRootNode){const v=this._findSkeletonRootNode(`${e}/joints`,d.joints);if(v)if(void 0===d.skeleton)d.skeleton=v.index;else{const P=(e,d)=>{for(;d.parent;d=d.parent)if(d.parent===e)return!0;return!1},p=H.Get(`${e}/skeleton`,this._gltf.nodes,d.skeleton);p===v||P(p,v)||(G.c.Warn(`${e}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),d.skeleton=v.index)}else G.c.Warn(`${e}: Failed to find common root`)}const P={};for(const p of d.joints){const L=H.Get(`${e}/joints/${p}`,this._gltf.nodes,p);this._loadBone(L,d,v,P)}}_findSkeletonRootNode(e,d){if(0===d.length)return null;const v={};for(const p of d){const d=[];let P=H.Get(`${e}/${p}`,this._gltf.nodes,p);for(;-1!==P.index;)d.unshift(P),P=P.parent;v[p]=d}let P=null;for(let p=0;;++p){let e=v[d[0]];if(p>=e.length)return P;const L=e[p];for(let B=1;B<d.length;++B)if(e=v[d[B]],p>=e.length||L!==e[p])return P;P=L}}_loadBone(e,d,v,P){e._isJoint=!0;let p=P[e.index];if(p)return p;let L=null;e.index!==d.skeleton&&(e.parent&&-1!==e.parent.index?L=this._loadBone(e.parent,d,v,P):void 0!==d.skeleton&&G.c.Warn(`/skins/${d.index}/skeleton: Skeleton node is not a common root`));const B=d.joints.indexOf(e.index);return p=new W.c(e.name||`joint${e.index}`,v,L,this._getNodeMatrix(e),null,null,B),P[e.index]=p,this._postSceneLoadActions.push((()=>{p.linkTransformNode(e._babylonTransformNode)})),p}_loadSkinInverseBindMatricesDataAsync(e,d){if(void 0==d.inverseBindMatrices)return Promise.resolve(null);const v=H.Get(`${e}/inverseBindMatrices`,this._gltf.accessors,d.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${v.index}`,v)}_updateBoneMatrices(e,d){for(const v of e.bones){const e=p.Matrix.Identity(),P=v._index;d&&-1!==P&&(p.Matrix.FromArrayToRef(d,16*P,e),e.invertToRef(e));const L=v.getParent();L&&e.multiplyToRef(L.getAbsoluteInverseBindMatrix(),e),v.bd(e,!1,!1),v._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(e){return e.matrix?p.Matrix.Nd(e.matrix):p.Matrix.Compose(e.scale?p.mv.Nd(e.scale):p.mv.One(),e.rotation?p.Quaternion.Nd(e.rotation):p.Quaternion.Identity(),e.translation?p.mv.Nd(e.translation):p.mv.Zero())}loadCameraAsync(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadCameraAsync(e,d,v);if(P)return P;const L=new Array;this.logOpen(`${e} ${d.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new z.c(d.name||`camera${d.index}`,p.mv.Zero(),this._babylonScene,!1);switch(B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonCamera=B,B.setTarget(new p.mv(0,0,-1)),d.type){case"perspective":{const v=d.perspective;if(!v)throw new Error(`${e}: Camera perspective properties are missing`);B.fov=v.yfov,B.td=v.znear,B.maxZ=v.zfar||0;break}case"orthographic":if(!d.orthographic)throw new Error(`${e}: Camera orthographic properties are missing`);B.mode=X.c.ORTHOGRAPHIC_CAMERA,B.orthoLeft=-d.orthographic.xmag,B.orthoRight=d.orthographic.xmag,B.orthoBottom=-d.orthographic.ymag,B.orthoTop=d.orthographic.ymag,B.td=d.orthographic.znear,B.maxZ=d.orthographic.zfar;break;default:throw new Error(`${e}: Invalid camera type (${d.type})`)}return t.AddPointerMetadata(B,e),this._parent.onCameraLoadedObservable.notifyObservers(B),v(B),this.logClose(),Promise.all(L).then((()=>B))}_loadAnimationsAsync(){const e=this._gltf.animations;if(!e)return Promise.resolve();const d=new Array;for(let v=0;v<e.length;v++){const P=e[v];d.push(this.loadAnimationAsync(`/animations/${P.index}`,P).then((e=>{0===e.targetedAnimations.length&&e.dispose()})))}return Promise.all(d).then((()=>{}))}loadAnimationAsync(e,d){const P=this._extensionsLoadAnimationAsync(e,d);return P||v.e(78).then(v.bind(v,15598)).then((v=>{let{AnimationGroup:P}=v;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new P(d.name||`animation${d.index}`,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonAnimationGroup=p;const L=new Array;H.Assign(d.channels),H.Assign(d.samplers);for(const B of d.channels)L.push(this._loadAnimationChannelAsync(`${e}/channels/${B.index}`,e,d,B,((e,d)=>{e.animations=e.animations||[],e.animations.push(d),p.addTargetedAnimation(d,e)})));return Promise.all(L).then((()=>(p.normalize(0),p)))}))}async _loadAnimationChannelAsync(e,d,P,p,L){const B=this._extensionsLoadAnimationChannelAsync(e,d,P,p,L);if(B)return await B;if(void 0==p.target.node)return await Promise.resolve();const X=H.Get(`${e}/target/node`,this._gltf.nodes,p.target.node),z=p.target.path,W="weights"===z;if(W&&!X._numMorphTargets||!W&&!X._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!W&&!X._isJoint)return await Promise.resolve();let V;switch(await Promise.resolve().then(v.bind(v,14139)),z){case"translation":var k;V=null===(k=(0,O.g)("/nodes/{}/translation"))||void 0===k?void 0:k.interpolation;break;case"rotation":var g;V=null===(g=(0,O.g)("/nodes/{}/rotation"))||void 0===g?void 0:g.interpolation;break;case"scale":var F;V=null===(F=(0,O.g)("/nodes/{}/scale"))||void 0===F?void 0:F.interpolation;break;case"weights":var w;V=null===(w=(0,O.g)("/nodes/{}/weights"))||void 0===w?void 0:w.interpolation;break;default:throw new Error(`${e}/target/path: Invalid value (${p.target.path})`)}if(!V)throw new Error(`${e}/target/path: Could not find interpolation properties for target path (${p.target.path})`);const G={object:X,info:V};return await this._loadAnimationChannelFromTargetInfoAsync(e,d,P,p,G,L)}_loadAnimationChannelFromTargetInfoAsync(e,d,v,P,p,L){const B=this.parent.targetFps,X=1/B,z=H.Get(`${e}/sampler`,v.samplers,P.sampler);return this._loadAnimationSamplerAsync(`${d}/samplers/${P.sampler}`,z).then((e=>{let d=0;const z=p.object,W=p.info;for(const p of W){const W=p.getStride(z),V=e.input,k=e.output,g=new Array(V.length);let F=0;switch(e.interpolation){case"STEP":for(let e=0;e<V.length;e++){const d=p.getValue(z,k,F,1);F+=W,g[e]={frame:V[e]*B,value:d,interpolation:1}}break;case"CUBICSPLINE":for(let e=0;e<V.length;e++){const d=p.getValue(z,k,F,X);F+=W;const v=p.getValue(z,k,F,1);F+=W;const P=p.getValue(z,k,F,X);F+=W,g[e]={frame:V[e]*B,inTangent:d,value:v,outTangent:P}}break;case"LINEAR":for(let e=0;e<V.length;e++){const d=p.getValue(z,k,F,1);F+=W,g[e]={frame:V[e]*B,value:d}}}if(F>0){const e=`${v.name||`animation${v.index}`}_channel${P.index}_${d}`,X=p.buildAnimations(z,e,B,g);for(const v of X)d++,L(v.babylonAnimatable,v.babylonAnimation)}}}))}_loadAnimationSamplerAsync(e,d){if(d._data)return d._data;const v=d.interpolation||"LINEAR";switch(v){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${e}/interpolation: Invalid value (${d.interpolation})`)}const P=H.Get(`${e}/input`,this._gltf.accessors,d.input),p=H.Get(`${e}/output`,this._gltf.accessors,d.output);return d._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${P.index}`,P),this._loadFloatAccessorAsync(`/accessors/${p.index}`,p)]).then((e=>{let[d,P]=e;return{input:d,interpolation:v,output:P}})),d._data}loadBufferAsync(e,d,v,P){const p=this._extensionsLoadBufferAsync(e,d,v,P);if(p)return p;if(!d._data)if(d.uri)d._data=this.loadUriAsync(`${e}/uri`,d,d.uri);else{if(!this._bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);d._data=this._bin.readAsync(0,d.byteLength)}return d._data.then((d=>{try{return new Uint8Array(d.buffer,d.byteOffset+v,P)}catch(p){throw new Error(`${e}: ${p.message}`)}}))}loadBufferViewAsync(e,d){const v=this._extensionsLoadBufferViewAsync(e,d);if(v)return v;if(d._data)return d._data;const P=H.Get(`${e}/buffer`,this._gltf.buffers,d.buffer);return d._data=this.loadBufferAsync(`/buffers/${P.index}`,P,d.byteOffset||0,d.byteLength),d._data}_loadAccessorAsync(e,d,v){if(d._data)return d._data;const P=t._GetNumComponents(e,d.type),p=P*n.i.GetTypeByteLength(d.componentType),L=P*d.count;if(void 0==d.bufferView)d._data=Promise.resolve(new v(L));else{const B=H.Get(`${e}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((X=>{if(5126!==d.componentType||d.normalized||B.byteStride&&B.byteStride!==p){const e=new v(L);return n.i.ForEach(X,d.byteOffset||0,B.byteStride||p,P,d.componentType,e.length,d.normalized||!1,((d,v)=>{e[v]=d})),e}return t._GetTypedArray(e,d.componentType,X,d.byteOffset,L)}))}if(d.sparse){const L=d.sparse;d._data=d._data.then((B=>{const X=B,z=H.Get(`${e}/sparse/indices/bufferView`,this._gltf.bufferViews,L.indices.bufferView),W=H.Get(`${e}/sparse/values/bufferView`,this._gltf.bufferViews,L.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${z.index}`,z),this.loadBufferViewAsync(`/bufferViews/${W.index}`,W)]).then((B=>{let[z,W]=B;const V=t._GetTypedArray(`${e}/sparse/indices`,L.indices.componentType,z,L.indices.byteOffset,L.count),k=P*L.count;let g;if(5126!==d.componentType||d.normalized){const B=t._GetTypedArray(`${e}/sparse/values`,d.componentType,W,L.values.byteOffset,k);g=new v(k),n.i.ForEach(B,0,p,P,d.componentType,g.length,d.normalized||!1,((e,d)=>{g[d]=e}))}else g=t._GetTypedArray(`${e}/sparse/values`,d.componentType,W,L.values.byteOffset,k);let F=0;for(let e=0;e<V.length;e++){let d=V[e]*P;for(let e=0;e<P;e++)X[d++]=g[F++]}return X}))}))}return d._data}_loadFloatAccessorAsync(e,d){return this._loadAccessorAsync(e,d,Float32Array)}_loadIndicesAccessorAsync(e,d){if("SCALAR"!==d.type)throw new Error(`${e}/type: Invalid value ${d.type}`);if(5121!==d.componentType&&5123!==d.componentType&&5125!==d.componentType)throw new Error(`${e}/componentType: Invalid value ${d.componentType}`);if(d._data)return d._data;if(d.sparse){const v=t._GetTypedArrayConstructor(`${e}/componentType`,d.componentType);d._data=this._loadAccessorAsync(e,d,v)}else{const v=H.Get(`${e}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v).then((v=>t._GetTypedArray(e,d.componentType,v,d.byteOffset,d.count)))}return d._data}_loadVertexBufferViewAsync(e){if(e._babylonBuffer)return e._babylonBuffer;const d=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((e=>new n.e(d,e,!1))),e._babylonBuffer}_loadVertexAccessorAsync(e,d,v){var P;if(null!==(P=d._babylonVertexBuffer)&&void 0!==P&&P[v])return d._babylonVertexBuffer[v];d._babylonVertexBuffer||(d._babylonVertexBuffer={});const p=this._babylonScene.getEngine();if(d.sparse||void 0==d.bufferView)d._babylonVertexBuffer[v]=this._loadFloatAccessorAsync(e,d).then((e=>new n.i(p,e,v,!1)));else{const P=H.Get(`${e}/bufferView`,this._gltf.bufferViews,d.bufferView);d._babylonVertexBuffer[v]=this._loadVertexBufferViewAsync(P).then((L=>{const B=t._GetNumComponents(e,d.type);return new n.i(p,L,v,!1,void 0,P.byteStride,void 0,d.byteOffset,B,d.componentType,d.normalized,!0,void 0,!0)}))}return d._babylonVertexBuffer[v]}_loadMaterialMetallicRoughnessPropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;return d&&(d.baseColorFactor?(v.albedoColor=L.Kd.Nd(d.baseColorFactor),v.alpha=d.baseColorFactor[3]):v.albedoColor=L.Kd.White(),v.metallic=void 0==d.metallicFactor?1:d.metallicFactor,v.roughness=void 0==d.roughnessFactor?1:d.roughnessFactor,d.baseColorTexture&&P.push(this.loadTextureInfoAsync(`${e}/baseColorTexture`,d.baseColorTexture,(e=>{e.name=`${v.name} (Base Color)`,v.albedoTexture=e}))),d.metallicRoughnessTexture&&(d.metallicRoughnessTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync(`${e}/metallicRoughnessTexture`,d.metallicRoughnessTexture,(e=>{e.name=`${v.name} (Metallic Roughness)`,v.metallicTexture=e}))),v.useMetallnessFromMetallicTextureBlue=!0,v.useRoughnessFromMetallicTextureGreen=!0,v.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(P).then((()=>{}))}_loadMaterialAsync(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const L=this._extensionsLoadMaterialAsync(e,d,v,P,p);if(L)return L;d._data=d._data||{};let B=d._data[P];if(!B){this.logOpen(`${e} ${d.name||""}`);const v=this.createMaterial(e,d,P);B={babylonMaterial:v,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(e,d,v)},d._data[P]=B,t.AddPointerMetadata(v,e),this._parent.onMaterialLoadedObservable.notifyObservers(v),this.logClose()}return v&&(B.babylonMeshes.push(v),v.Fd.addOnce((()=>{const e=B.babylonMeshes.indexOf(v);-1!==e&&B.babylonMeshes.splice(e,1)}))),p(B.babylonMaterial),B.promise.then((()=>B.babylonMaterial))}_createDefaultMaterial(e,d){this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new q.e(e,this._babylonScene);return v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v.fillMode=d,v.enableSpecularAntiAliasing=!0,v.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,v.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,v.transparencyMode=q.e.PBRMATERIAL_OPAQUE,v.metallic=1,v.roughness=1,v}createMaterial(e,d,v){const P=this._extensionsCreateMaterial(e,d,v);if(P)return P;const p=d.name||`material${d.index}`;return this._createDefaultMaterial(p,v)}loadMaterialPropertiesAsync(e,d,v){const P=this._extensionsLoadMaterialPropertiesAsync(e,d,v);if(P)return P;const p=new Array;return p.push(this.loadMaterialBasePropertiesAsync(e,d,v)),d.pbrMetallicRoughness&&p.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${e}/pbrMetallicRoughness`,d.pbrMetallicRoughness,v)),this.loadMaterialAlphaProperties(e,d,v),Promise.all(p).then((()=>{}))}loadMaterialBasePropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;return v.emissiveColor=d.emissiveFactor?L.Kd.Nd(d.emissiveFactor):new L.Kd(0,0,0),d.doubleSided&&(v.Jd=!1,v.twoSidedLighting=!0),d.normalTexture&&(d.normalTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync(`${e}/normalTexture`,d.normalTexture,(e=>{e.name=`${v.name} (Normal)`,v.bumpTexture=e}))),v.invertNormalMapX=!this._babylonScene.useRightHandedSystem,v.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=d.normalTexture.scale&&v.bumpTexture&&(v.bumpTexture.level=d.normalTexture.scale),v.forceIrradianceInFragment=!0),d.occlusionTexture&&(d.occlusionTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync(`${e}/occlusionTexture`,d.occlusionTexture,(e=>{e.name=`${v.name} (Occlusion)`,v.ambientTexture=e}))),v.useAmbientInGrayScale=!0,void 0!=d.occlusionTexture.strength&&(v.ambientTextureStrength=d.occlusionTexture.strength)),d.emissiveTexture&&P.push(this.loadTextureInfoAsync(`${e}/emissiveTexture`,d.emissiveTexture,(e=>{e.name=`${v.name} (Emissive)`,v.emissiveTexture=e}))),Promise.all(P).then((()=>{}))}loadMaterialAlphaProperties(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);switch(d.alphaMode||"OPAQUE"){case"OPAQUE":v.transparencyMode=q.e.PBRMATERIAL_OPAQUE,v.alpha=1;break;case"MASK":v.transparencyMode=q.e.PBRMATERIAL_ALPHATEST,v.alphaCutOff=void 0==d.alphaCutoff?.5:d.alphaCutoff,v.albedoTexture&&(v.albedoTexture.Hd=!0);break;case"BLEND":v.transparencyMode=q.e.PBRMATERIAL_ALPHABLEND,v.albedoTexture&&(v.albedoTexture.Hd=!0,v.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${e}/alphaMode: Invalid value (${d.alphaMode})`)}}loadTextureInfoAsync(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadTextureInfoAsync(e,d,v);if(P)return P;if(this.logOpen(`${e}`),d.texCoord>=6)throw new Error(`${e}/texCoord: Invalid value (${d.texCoord})`);const p=H.Get(`${e}/index`,this._gltf.textures,d.index);p._textureInfo=d;const L=this._loadTextureAsync(`/textures/${d.index}`,p,(P=>{P.coordinatesIndex=d.texCoord||0,t.AddPointerMetadata(P,e),this._parent.onTextureLoadedObservable.notifyObservers(P),v(P)}));return this.logClose(),L}_loadTextureAsync(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadTextureAsync(e,d,v);if(P)return P;this.logOpen(`${e} ${d.name||""}`);const p=void 0==d.sampler?t.DefaultSampler:H.Get(`${e}/sampler`,this._gltf.samplers,d.sampler),L=H.Get(`${e}/source`,this._gltf.images,d.source),B=this._createTextureAsync(e,p,L,v,void 0,!d._textureInfo.nonColorData);return this.logClose(),B}_createTextureAsync(e,d,v){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},L=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;const X=this._loadSampler(`/samplers/${d.index}`,d),z=new Array,W=new P;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V={noMipmap:X.noMipMaps,invertY:!1,samplingMode:X.samplingMode,I:()=>{this._disposed||W.resolve()},onError:(d,v)=>{this._disposed||W.reject(new Error(`${e}: ${v&&v.message?v.message:d||"Failed to load texture"}`))},mimeType:v.mimeType??(0,S.f)(v.uri??""),loaderOptions:L,useSRGBBuffer:!!B&&this._parent.useSRGBBuffers},k=new h.e(null,this._babylonScene,V);return k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.push(W.promise),z.push(this.loadImageAsync(`/images/${v.index}`,v).then((e=>{const d=v.uri||`${this._fileName}#image${v.index}`,P=`data:${this._uniqueRootUrl}${d}`;k.updateURL(P,e);const p=k.getInternalTexture();p&&(p.label=v.name)}))),k.wrapU=X.wrapU,k.wrapV=X.wrapV,p(k),this._parent.useGltfTextureNames&&(k.name=v.name||v.uri||`image${v.index}`),Promise.all(z).then((()=>k))}_loadSampler(e,d){return d._data||(d._data={noMipMaps:9728===d.minFilter||9729===d.minFilter,samplingMode:t._GetTextureSamplingMode(e,d),wrapU:t._GetTextureWrapMode(`${e}/wrapS`,d.wrapS),wrapV:t._GetTextureWrapMode(`${e}/wrapT`,d.wrapT)}),d._data}loadImageAsync(e,d){if(!d._data){if(this.logOpen(`${e} ${d.name||""}`),d.uri)d._data=this.loadUriAsync(`${e}/uri`,d,d.uri);else{const v=H.Get(`${e}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v)}this.logClose()}return d._data}loadUriAsync(e,d,v){const P=this._extensionsLoadUriAsync(e,d,v);if(P)return P;if(!t._ValidateUri(v))throw new Error(`${e}: '${v}' is invalid`);if((0,S.g)(v)){const d=new Uint8Array((0,S.c)(v));return this.log(`${e}: Decoded ${v.substring(0,64)}... (${d.length} bytes)`),Promise.resolve(d)}return this.log(`${e}: Loading ${v}`),this._parent.preprocessUrlAsync(this._rootUrl+v).then((d=>new Promise(((P,p)=>{this._parent._loadFile(this._babylonScene,d,(d=>{this._disposed||(this.log(`${e}: Loaded ${v} (${d.byteLength} bytes)`),P(new Uint8Array(d)))}),!0,(d=>{p(new S.k(`${e}: Failed to load '${v}'${d?": "+d.status+" "+d.statusText:""}`,d))}))}))))}static AddPointerMetadata(e,d){e.metadata=e.metadata||{};const v=e._internalMetadata=e._internalMetadata||{},P=v.rd=v.rd||{};(P.pointers=P.pointers||[]).push(d)}static _GetTextureWrapMode(e,d){switch(d=void 0==d?10497:d){case 33071:return h.e.CLAMP_ADDRESSMODE;case 33648:return h.e.MIRROR_ADDRESSMODE;case 10497:return h.e.WRAP_ADDRESSMODE;default:return G.c.Warn(`${e}: Invalid value (${d})`),h.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(e,d){const v=void 0==d.magFilter?9729:d.magFilter,P=void 0==d.minFilter?9987:d.minFilter;if(9729===v)switch(P){case 9728:return h.e.LINEAR_NEAREST;case 9729:return h.e.LINEAR_LINEAR;case 9984:return h.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return h.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return h.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return h.e.LINEAR_LINEAR_MIPLINEAR;default:return G.c.Warn(`${e}/minFilter: Invalid value (${P})`),h.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==v&&G.c.Warn(`${e}/magFilter: Invalid value (${v})`),P){case 9728:return h.e.NEAREST_NEAREST;case 9729:return h.e.NEAREST_LINEAR;case 9984:return h.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return h.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return h.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return h.e.NEAREST_LINEAR_MIPLINEAR;default:return G.c.Warn(`${e}/minFilter: Invalid value (${P})`),h.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(e,d){try{return(0,Y.o)(d)}catch(v){throw new Error(`${e}: ${v.message}`)}}static _GetTypedArray(e,d,v,P,p){const L=v.buffer;P=v.byteOffset+(P||0);const B=t._GetTypedArrayConstructor(`${e}/componentType`,d),X=n.i.GetTypeByteLength(d);return P%X!==0?(G.c.Warn(`${e}: Copying buffer as byte offset (${P}) is not a multiple of component type byte length (${X})`),new B(L.slice(P,P+p*X),0)):new B(L,P,p)}static _GetNumComponents(e,d){switch(d){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${e}: Invalid type (${d})`)}static _ValidateUri(e){return B.Tools.IsBase64(e)||-1===e.indexOf("..")}static _GetDrawMode(e,d){switch(void 0==d&&(d=4),d){case 0:return C.b.PointListDrawMode;case 1:return C.b.LineListDrawMode;case 2:return C.b.LineLoopDrawMode;case 3:return C.b.LineStripDrawMode;case 4:return C.b.TriangleFillMode;case 5:return C.b.TriangleStripDrawMode;case 6:return C.b.TriangleFanDrawMode}throw new Error(`${e}: Invalid mesh primitive mode (${d})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const e=new Array;if(this._gltf.materials)for(const d of this._gltf.materials)if(d._data)for(const v in d._data){const P=d._data[v];for(const d of P.babylonMeshes){d.Md(!0);const v=P.babylonMaterial;e.push(v.forceCompilationAsync(d)),e.push(v.forceCompilationAsync(d,{useInstances:!0})),this._parent.useClipPlane&&(e.push(v.forceCompilationAsync(d,{clipPlane:!0})),e.push(v.forceCompilationAsync(d,{clipPlane:!0,useInstances:!0})))}}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const e=new Array,d=this._babylonScene.lights;for(const v of d){const d=v.getShadowGenerator();d&&e.push(d.forceCompilationAsync())}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(e){for(const d of this._extensions)d.enabled&&e(d)}_applyExtensions(e,d,v){for(const P of this._extensions)if(P.enabled){const p=`${P.name}.${d}`,L=e;L._activeLoaderExtensionFunctions=L._activeLoaderExtensionFunctions||{};const B=L._activeLoaderExtensionFunctions;if(!B[p]){B[p]=!0;try{const e=v(P);if(e)return e}finally{delete B[p]}}}return null}_extensionsOnLoading(){this._forEachExtensions((e=>e.onLoading&&e.onLoading()))}_extensionsOnReady(){this._forEachExtensions((e=>e.onReady&&e.onReady()))}_extensionsLoadSceneAsync(e,d){return this._applyExtensions(d,"loadScene",(v=>v.loadSceneAsync&&v.loadSceneAsync(e,d)))}_extensionsLoadNodeAsync(e,d,v){return this._applyExtensions(d,"loadNode",(P=>P.loadNodeAsync&&P.loadNodeAsync(e,d,v)))}_extensionsLoadCameraAsync(e,d,v){return this._applyExtensions(d,"loadCamera",(P=>P.loadCameraAsync&&P.loadCameraAsync(e,d,v)))}_extensionsLoadVertexDataAsync(e,d,v){return this._applyExtensions(d,"loadVertexData",(P=>P._loadVertexDataAsync&&P._loadVertexDataAsync(e,d,v)))}_extensionsLoadMeshPrimitiveAsync(e,d,v,P,p,L){return this._applyExtensions(p,"loadMeshPrimitive",(B=>B._loadMeshPrimitiveAsync&&B._loadMeshPrimitiveAsync(e,d,v,P,p,L)))}_extensionsLoadMaterialAsync(e,d,v,P,p){return this._applyExtensions(d,"loadMaterial",(L=>L._loadMaterialAsync&&L._loadMaterialAsync(e,d,v,P,p)))}_extensionsCreateMaterial(e,d,v){return this._applyExtensions(d,"createMaterial",(P=>P.createMaterial&&P.createMaterial(e,d,v)))}_extensionsLoadMaterialPropertiesAsync(e,d,v){return this._applyExtensions(d,"loadMaterialProperties",(P=>P.loadMaterialPropertiesAsync&&P.loadMaterialPropertiesAsync(e,d,v)))}_extensionsLoadTextureInfoAsync(e,d,v){return this._applyExtensions(d,"loadTextureInfo",(P=>P.loadTextureInfoAsync&&P.loadTextureInfoAsync(e,d,v)))}_extensionsLoadTextureAsync(e,d,v){return this._applyExtensions(d,"loadTexture",(P=>P._loadTextureAsync&&P._loadTextureAsync(e,d,v)))}_extensionsLoadAnimationAsync(e,d){return this._applyExtensions(d,"loadAnimation",(v=>v.loadAnimationAsync&&v.loadAnimationAsync(e,d)))}_extensionsLoadAnimationChannelAsync(e,d,v,P,p){return this._applyExtensions(v,"loadAnimationChannel",(L=>L._loadAnimationChannelAsync&&L._loadAnimationChannelAsync(e,d,v,P,p)))}_extensionsLoadSkinAsync(e,d,v){return this._applyExtensions(v,"loadSkin",(P=>P._loadSkinAsync&&P._loadSkinAsync(e,d,v)))}_extensionsLoadUriAsync(e,d,v){return this._applyExtensions(d,"loadUri",(P=>P._loadUriAsync&&P._loadUriAsync(e,d,v)))}_extensionsLoadBufferViewAsync(e,d){return this._applyExtensions(d,"loadBufferView",(v=>v.loadBufferViewAsync&&v.loadBufferViewAsync(e,d)))}_extensionsLoadBufferAsync(e,d,v,P){return this._applyExtensions(d,"loadBuffer",(p=>p.loadBufferAsync&&p.loadBufferAsync(e,d,v,P)))}static LoadExtensionAsync(e,d,v,P){if(!d.extensions)return null;const p=d.extensions[v];return p?P(`${e}/extensions/${v}`,p):null}static LoadExtraAsync(e,d,v,P){if(!d.extras)return null;const p=d.extras[v];return p?P(`${e}/extras/${v}`,p):null}isExtensionUsed(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)}logOpen(e){this._parent._logOpen(e)}logClose(){this._parent._logClose()}log(e){this._parent._log(e)}startPerformanceCounter(e){this._parent._startPerformanceCounter(e)}endPerformanceCounter(e){this._parent._endPerformanceCounter(e)}}t.DefaultSampler={index:-1},T.d._CreateGLTF2Loader=e=>new t(e);var I=v(14139),c=v(12609),b=v(12453),M=v(14142),s=v(14144);class y extends s.c{constructor(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",e),this._texture=e.getEngine().createRawCubeTexture(d,v,P,p,L,B,X,z)}update(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,e,d,v,P,p)}updateRGBDAsync(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,M.k)(this._texture,e,d,v,P).then((()=>{}))}clone(){return b.c.Clone((()=>{const e=this.Ae(),d=this._texture,v=new y(e,d._bufferViewArray,d.width,d.format,d.type,d.generateMipMaps,d.invertY,d.samplingMode,d._compression);return 13===d.source&&v.updateRGBDAsync(d._bufferViewArrayArray,d._sphericalPolynomial,d._lodGenerationScale,d._lodGenerationOffset),v}),this)}}const j="EXT_lights_image_based";class J{constructor(e){this.name=j,this._loader=e,this.enabled=this._loader.isExtensionUsed(j)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.rd.extensions;if(e&&e[this.name]){const d=e[this.name];this._lights=d.lights}}loadSceneAsync(e,d){return t.LoadExtensionAsync(e,d,this.name,(async(v,P)=>{this._loader._allMaterialsDirtyRequired=!0;const p=new Array;p.push(this._loader.loadSceneAsync(e,d)),this._loader.logOpen(`${v}`);const L=H.Get(`${v}/light`,this._lights,P.zd);return p.push(this._loadLightAsync(`/extensions/${this.name}/lights/${P.zd}`,L).then((e=>{this._loader.babylonScene.environmentTexture=e}))),this._loader.logClose(),await Promise.all(p).then((()=>{}))}))}_loadLightAsync(e,d){if(!d._loaded){const v=new Array;this._loader.logOpen(`${e}`);const P=new Array(d.specularImages.length);for(let p=0;p<d.specularImages.length;p++){const L=d.specularImages[p];P[p]=new Array(L.length);for(let d=0;d<L.length;d++){const B=`${e}/specularImages/${p}/${d}`;this._loader.logOpen(`${B}`);const X=L[d],z=H.Get(B,this._loader.rd.images,X);v.push(this._loader.loadImageAsync(`/images/${X}`,z).then((e=>{P[p][d]=e}))),this._loader.logClose()}}this._loader.logClose(),d._loaded=Promise.all(v).then((async()=>{const v=new y(this._loader.babylonScene,null,d.specularImageSize);if(v.name=d.name||"environment",d._babylonTexture=v,void 0!=d.nX&&(v.level=d.nX),d.rotation){let e=p.Quaternion.Nd(d.rotation);this._loader.babylonScene.useRightHandedSystem||(e=p.Quaternion.Inverse(e)),p.Matrix.FromQuaternionToRef(e,v.getReflectionTextureMatrix())}if(!d.irradianceCoefficients)throw new Error(`${e}: Irradiance coefficients are missing`);const L=c.c.Nd(d.irradianceCoefficients);L.scaleInPlace(d.nX),L.convertIrradianceToLambertianRadiance();const B=c.f.FromHarmonics(L),X=(P.length-1)/Math.log2(d.specularImageSize);return await v.updateRGBDAsync(P,B,X)}))}return d._loaded.then((()=>d._babylonTexture))}}u(j),N(j,!0,(e=>new J(e)));v(12980);const E="EXT_mesh_gpu_instancing";class ee{constructor(e){this.name=E,this._loader=e,this.enabled=this._loader.isExtensionUsed(E)}dispose(){this._loader=null}loadNodeAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(e,P)=>{this._loader._disableInstancedMesh++;const L=this._loader.loadNodeAsync(`/nodes/${d.index}`,d,v);if(this._loader._disableInstancedMesh--,!d._primitiveBabylonMeshes)return await L;const B=new Array;let X=0;const z=d=>{if(void 0==P.attributes[d])return void B.push(Promise.resolve(null));const v=H.Get(`${e}/attributes/${d}`,this._loader.rd.accessors,P.attributes[d]);if(B.push(this._loader._loadFloatAccessorAsync(`/accessors/${v.bufferView}`,v)),0===X)X=v.count;else if(X!==v.count)throw new Error(`${e}/attributes: Instance buffer accessors do not have the same count.`)};return z("TRANSLATION"),z("ROTATION"),z("SCALE"),await L.then((async e=>{const[v,P,L]=await Promise.all(B),z=new Float32Array(16*X);p.TmpVectors.mv[0].Ed(0,0,0),p.TmpVectors.Quaternion[0].Ed(0,0,0,1),p.TmpVectors.mv[1].Ed(1,1,1);for(let d=0;d<X;++d)v&&p.mv.FromArrayToRef(v,3*d,p.TmpVectors.mv[0]),P&&p.Quaternion.FromArrayToRef(P,4*d,p.TmpVectors.Quaternion[0]),L&&p.mv.FromArrayToRef(L,3*d,p.TmpVectors.mv[1]),p.Matrix.ComposeToRef(p.TmpVectors.mv[1],p.TmpVectors.Quaternion[0],p.TmpVectors.mv[0],p.TmpVectors.Matrix[0]),p.TmpVectors.Matrix[0].copyToArray(z,16*d);for(const p of d._primitiveBabylonMeshes)p.wk("matrix",z,16,!0);return e}))}))}}u(E),N(E,!0,(e=>new ee(e)));let de=0,ve=null;class Pe{static get Default(){return Pe._Default||(Pe._Default=new Pe),Pe._Default}constructor(){const e=Pe.Configuration.decoder;this._decoderModulePromise=B.Tools.LoadBabylonScriptAsync(e.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(e,d,v,P,p){await this._decoderModulePromise,0===de&&(MeshoptDecoder.useWorkers(1),de=1);const L=await MeshoptDecoder.decodeGltfBufferAsync(d,v,e,P,p);return null!==ve&&clearTimeout(ve),ve=setTimeout((()=>{MeshoptDecoder.useWorkers(0),de=0,ve=null}),1e3),L}}Pe.Configuration={decoder:{url:`${B.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Pe._Default=null;const pe="EXT_meshopt_compression";class Le{constructor(e){this.name=pe,this.enabled=e.isExtensionUsed(pe),this._loader=e}dispose(){this._loader=null}loadBufferViewAsync(e,d){return t.LoadExtensionAsync(e,d,this.name,(async(v,P)=>{const p=d;if(p._meshOptData)return await p._meshOptData;const L=H.Get(`${e}/buffer`,this._loader.rd.buffers,P.buffer);return p._meshOptData=this._loader.loadBufferAsync(`/buffers/${L.index}`,L,P.byteOffset||0,P.byteLength).then((async e=>await Pe.Default.decodeGltfBufferAsync(e,P.count,P.byteStride,P.mode,P.filter))),await p._meshOptData}))}}u(pe),N(pe,!0,(e=>new Le(e)));const Be="EXT_texture_webp";class Xe{constructor(e){this.name=Be,this._loader=e,this.enabled=e.isExtensionUsed(Be)}dispose(){this._loader=null}_loadTextureAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=void 0==d.sampler?t.DefaultSampler:H.Get(`${e}/sampler`,this._loader.rd.samplers,d.sampler),B=H.Get(`${P}/source`,this._loader.rd.images,p.source);return await this._loader._createTextureAsync(e,L,B,(e=>{v(e)}),void 0,!d._textureInfo.nonColorData)}))}}u(Be),N(Be,!0,(e=>new Xe(e)));const ze="EXT_texture_avif";class We{constructor(e){this.name=ze,this._loader=e,this.enabled=e.isExtensionUsed(ze)}dispose(){this._loader=null}_loadTextureAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=void 0==d.sampler?t.DefaultSampler:H.Get(`${e}/sampler`,this._loader.rd.samplers,d.sampler),B=H.Get(`${P}/source`,this._loader.rd.images,p.source);return await this._loader._createTextureAsync(e,L,B,(e=>{v(e)}),void 0,!d._textureInfo.nonColorData)}))}}u(ze),N(ze,!0,(e=>new We(e)));var Ve=v(14136),ke=v(12962);const ge="EXT_lights_ies";class Fe{constructor(e){this.name=ge,this._loader=e,this.enabled=this._loader.isExtensionUsed(ge)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.rd.extensions;if(e&&e[this.name]){const d=e[this.name];this._lights=d.lights,H.Assign(this._lights)}}loadNodeAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,B)=>{let X,z;this._loader._allMaterialsDirtyRequired=!0;const W=await this._loader.loadNodeAsync(e,d,(e=>{z=H.Get(P,this._lights,B.zd);const d=z.name||e.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X=new Ve.d(d,p.mv.Zero(),p.mv.Backward(),0,1,this._loader.babylonScene),X.angle=Math.PI/2,X.innerAngle=0,X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,z._babylonLight=X,X.falloffType=ke.e.FALLOFF_GLTF,X.AX=B.color?L.Kd.Nd(B.color):L.Kd.White(),X.nX=B.multiplier||1,X.range=Number.MAX_VALUE,X.parent=e,this._loader._babylonLights.push(X),t.AddPointerMetadata(X,P),v(e)}));let V;if(z.uri)V=await this._loader.loadUriAsync(e,z,z.uri);else{const d=H.Get(`${e}/bufferView`,this._loader.rd.bufferViews,z.bufferView);V=await this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}return X.iesProfileTexture=new h.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,V,!0,void 0,void 0,void 0,void 0,".ies"),W}))}}u(ge),N(ge,!0,(e=>new Fe(e)));var we=v(14161);const Ge="KHR_draco_mesh_compression";class Ue{constructor(e){this.name=Ge,this.useNormalizedFlagFromAccessor=!0,this._loader=e,this.enabled=we.e.DefaultAvailable&&this._loader.isExtensionUsed(Ge)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{if(void 0!=d.mode&&4!==d.mode&&5!==d.mode)throw new Error(`${e}: Unsupported mode ${d.mode}`);const L={},B={},X=(e,P)=>{const X=p.attributes[e];if(void 0!=X&&(v._delayInfo=v._delayInfo||[],-1===v._delayInfo.indexOf(P)&&v._delayInfo.push(P),L[P]=X,this.useNormalizedFlagFromAccessor)){const v=H.TryGet(this._loader.rd.accessors,d.attributes[e]);v&&(B[P]=v.normalized||!1)}};X("POSITION",n.i.PositionKind),X("NORMAL",n.i.NormalKind),X("TANGENT",n.i.TangentKind),X("TEXCOORD_0",n.i.UVKind),X("TEXCOORD_1",n.i.UV2Kind),X("TEXCOORD_2",n.i.UV3Kind),X("TEXCOORD_3",n.i.UV4Kind),X("TEXCOORD_4",n.i.UV5Kind),X("TEXCOORD_5",n.i.UV6Kind),X("JOINTS_0",n.i.MatricesIndicesKind),X("WEIGHTS_0",n.i.MatricesWeightsKind),X("COLOR_0",n.i.ColorKind);const z=H.Get(P,this._loader.rd.bufferViews,p.bufferView);return z._dracoBabylonGeometry||(z._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${z.index}`,z).then((async P=>{const p=this.dracoDecoder||we.e.Default,X=H.TryGet(this._loader.rd.accessors,d.attributes.POSITION),z=this._loader.parent.alwaysComputeBoundingBox||v.skeleton||!X?null:a(X);return await p._decodeMeshToGeometryForGltfAsync(v.name,this._loader.babylonScene,P,L,B,z).catch((d=>{throw new Error(`${e}: ${d.message}`)}))}))),await z._dracoBabylonGeometry}))}}u(Ge),N(Ge,!0,(e=>new Ue(e)));var De=v(14168),Ce=v(12403),qe=v(12409),he=v(12833),le=v(13013),ne=v(12381);he.e.AddNodeConstructor("Light_Type_0",((e,d)=>()=>new Ae(e,p.mv.Zero(),d)));class Ae extends le.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(e){const d=this.needCube();if(this._direction=e,this.needCube()!==d&&this._shadowGenerators){const e=this._shadowGenerators.values();for(let d=e.next();!0!==d.done;d=e.next()){d.value.recreateShadowMap()}}}constructor(e,d,v){super(e,v),this._shadowAngle=Math.PI/2,this.position=d}getClassName(){return"PointLight"}getTypeID(){return ke.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(e){if(this.direction)return super.getShadowDirection(e);switch(e){case 0:return new p.mv(1,0,0);case 1:return new p.mv(-1,0,0);case 2:return new p.mv(0,-1,0);case 3:return new p.mv(0,1,0);case 4:return new p.mv(0,0,1);case 5:return new p.mv(0,0,-1)}return p.mv.Zero()}_setDefaultShadowProjectionMatrix(e,d,v){const P=this.Ae().activeCamera;if(!P)return;const L=void 0!==this.shadowMinZ?this.shadowMinZ:P.td,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,X=this.Ae().getEngine().Wd;p.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,X?B:L,X?L:B,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,X)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,d){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,d):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,d),this}transferToNodeMaterialEffect(e,d){return this.computeTransformedInformation()?e.setFloat3(d,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(d,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(e,d){e["POINTLIGHT"+d]=!0}}(0,Ce.e)([(0,qe.M)()],Ae.prototype,"shadowAngle",null),(0,ne.h)("BABYLON.PointLight",Ae);const xe="KHR_lights_punctual";class ie{constructor(e){this.name=xe,this._loader=e,this.enabled=this._loader.isExtensionUsed(xe)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.rd.extensions;if(e&&e[this.name]){const d=e[this.name];this._lights=d.lights,H.Assign(this._lights)}}loadNodeAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,B)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(e,d,(e=>{let d;const X=H.Get(P,this._lights,B.zd),z=X.name||e.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X.type){case"directional":{const e=new De.b(z,p.mv.Backward(),this._loader.babylonScene);e.position.dp(0),d=e;break}case"point":d=new Ae(z,p.mv.Zero(),this._loader.babylonScene);break;case"spot":{const e=new Ve.d(z,p.mv.Zero(),p.mv.Backward(),0,1,this._loader.babylonScene);e.angle=2*(X.spot&&X.spot.outerConeAngle||Math.PI/4),e.innerAngle=2*(X.spot&&X.spot.innerConeAngle||0),d=e;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${P}: Invalid light type (${X.type})`)}d._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,X._babylonLight=d,d.falloffType=ke.e.FALLOFF_GLTF,d.AX=X.color?L.Kd.Nd(X.color):L.Kd.White(),d.nX=void 0==X.nX?1:X.nX,d.range=void 0==X.range?Number.MAX_VALUE:X.range,d.parent=e,this._loader._babylonLights.push(d),t.AddPointerMetadata(d,P),v(e)})))))}}u(xe),N(xe,!0,(e=>new ie(e)));const md="KHR_materials_pbrSpecularGlossiness";class re{constructor(e){this.name=md,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(md)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;return L.push(this._loader.loadMaterialBasePropertiesAsync(e,d,v)),L.push(this._loadSpecularGlossinessPropertiesAsync(P,p,v)),this._loader.loadMaterialAlphaProperties(e,d,v),await Promise.all(L).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;return v.metallic=null,v.roughness=null,d.diffuseFactor?(v.albedoColor=L.Kd.Nd(d.diffuseFactor),v.alpha=d.diffuseFactor[3]):v.albedoColor=L.Kd.White(),v.reflectivityColor=d.specularFactor?L.Kd.Nd(d.specularFactor):L.Kd.White(),v.microSurface=void 0==d.glossinessFactor?1:d.glossinessFactor,d.diffuseTexture&&P.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTexture`,d.diffuseTexture,(e=>{e.name=`${v.name} (Diffuse)`,v.albedoTexture=e}))),d.specularGlossinessTexture&&(P.push(this._loader.loadTextureInfoAsync(`${e}/specularGlossinessTexture`,d.specularGlossinessTexture,(e=>{e.name=`${v.name} (Specular Glossiness)`,v.reflectivityTexture=e,v.reflectivityTexture.Hd=!0}))),v.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(P).then((()=>{}))}}u(md),N(md,!0,(e=>new re(e)));const Ze="KHR_materials_unlit";class fe{constructor(e){this.name=Ze,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ze)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async()=>await this._loadUnlitPropertiesAsync(e,d,v)))}_loadUnlitPropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;v.unlit=!0;const p=d.pbrMetallicRoughness;return p&&(p.baseColorFactor?(v.albedoColor=L.Kd.Nd(p.baseColorFactor),v.alpha=p.baseColorFactor[3]):v.albedoColor=L.Kd.White(),p.baseColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${e}/baseColorTexture`,p.baseColorTexture,(e=>{e.name=`${v.name} (Base Color)`,v.albedoTexture=e})))),d.doubleSided&&(v.Jd=!1,v.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,d,v),Promise.all(P).then((()=>{}))}}u(Ze),N(Ze,!0,(e=>new fe(e)));const Te="KHR_materials_clearcoat";class Se{constructor(e){this.name=Te,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(Te)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadClearCoatPropertiesAsync(P,p,v)),await Promise.all(L)}))}_loadClearCoatPropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;return v.clearCoat.isEnabled=!0,v.clearCoat.useRoughnessFromMainTexture=!1,v.clearCoat.remapF0OnInterfaceChange=!1,void 0!=d.clearcoatFactor?v.clearCoat.nX=d.clearcoatFactor:v.clearCoat.nX=0,d.clearcoatTexture&&P.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,d.clearcoatTexture,(e=>{e.name=`${v.name} (ClearCoat)`,v.clearCoat.texture=e}))),void 0!=d.clearcoatRoughnessFactor?v.clearCoat.roughness=d.clearcoatRoughnessFactor:v.clearCoat.roughness=0,d.clearcoatRoughnessTexture&&(d.clearcoatRoughnessTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,d.clearcoatRoughnessTexture,(e=>{e.name=`${v.name} (ClearCoat Roughness)`,v.clearCoat.textureRoughness=e})))),d.clearcoatNormalTexture&&(d.clearcoatNormalTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,d.clearcoatNormalTexture,(e=>{e.name=`${v.name} (ClearCoat Normal)`,v.clearCoat.bumpTexture=e}))),v.invertNormalMapX=!v.Ae().useRightHandedSystem,v.invertNormalMapY=v.Ae().useRightHandedSystem,void 0!=d.clearcoatNormalTexture.scale&&(v.clearCoat.bumpTexture.level=d.clearcoatNormalTexture.scale)),Promise.all(P).then((()=>{}))}}u(Te),N(Te,!0,(e=>new Se(e)));const oe="KHR_materials_iridescence";class Ke{constructor(e){this.name=oe,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(oe)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadIridescencePropertiesAsync(P,p,v)),await Promise.all(L).then((()=>{}))}))}_loadIridescencePropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;return v.iridescence.isEnabled=!0,v.iridescence.nX=d.iridescenceFactor??0,v.iridescence.indexOfRefraction=d.iridescenceIor??d.iridescenceIOR??1.3,v.iridescence.minimumThickness=d.iridescenceThicknessMinimum??100,v.iridescence.maximumThickness=d.iridescenceThicknessMaximum??400,d.iridescenceTexture&&P.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceTexture`,d.iridescenceTexture,(e=>{e.name=`${v.name} (Iridescence)`,v.iridescence.texture=e}))),d.iridescenceThicknessTexture&&P.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceThicknessTexture`,d.iridescenceThicknessTexture,(e=>{e.name=`${v.name} (Iridescence Thickness)`,v.iridescence.thicknessTexture=e}))),Promise.all(P).then((()=>{}))}}u(oe),N(oe,!0,(e=>new Ke(e)));const Qe="KHR_materials_anisotropy";class Ne{constructor(e){this.name=Qe,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(Qe)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadIridescencePropertiesAsync(P,p,v)),await Promise.all(L)}))}async _loadIridescencePropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;v.anisotropy.isEnabled=!0,v.anisotropy.nX=d.anisotropyStrength??0,v.anisotropy.angle=d.anisotropyRotation??0,d.anisotropyTexture&&(d.anisotropyTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${e}/anisotropyTexture`,d.anisotropyTexture,(e=>{e.name=`${v.name} (Anisotropy Intensity)`,v.anisotropy.texture=e})))),await Promise.all(P)}}u(Qe),N(Qe,!0,(e=>new Ne(e)));const ue="KHR_materials_emissive_strength";class Oe{constructor(e){this.name=ue,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(ue)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>await this._loader.loadMaterialPropertiesAsync(e,d,v).then((()=>{this._loadEmissiveProperties(P,p,v)}))))}_loadEmissiveProperties(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);void 0!==d.emissiveStrength&&(v.emissiveIntensity=d.emissiveStrength)}}u(ue),N(ue,!0,(e=>new Oe(e)));const Re="KHR_materials_sheen";class Ye{constructor(e){this.name=Re,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(Re)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadSheenPropertiesAsync(P,p,v)),await Promise.all(L).then((()=>{}))}))}_loadSheenPropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;return v.sheen.isEnabled=!0,v.sheen.nX=1,void 0!=d.sheenColorFactor?v.sheen.color=L.Kd.Nd(d.sheenColorFactor):v.sheen.color=L.Kd.Black(),d.sheenColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${e}/sheenColorTexture`,d.sheenColorTexture,(e=>{e.name=`${v.name} (Sheen Color)`,v.sheen.texture=e}))),void 0!==d.sheenRoughnessFactor?v.sheen.roughness=d.sheenRoughnessFactor:v.sheen.roughness=0,d.sheenRoughnessTexture&&(d.sheenRoughnessTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${e}/sheenRoughnessTexture`,d.sheenRoughnessTexture,(e=>{e.name=`${v.name} (Sheen Roughness)`,v.sheen.textureRoughness=e})))),v.sheen.albedoScaling=!0,v.sheen.useRoughnessFromMainTexture=!1,Promise.all(P).then((()=>{}))}}u(Re),N(Re,!0,(e=>new Ye(e)));var He=v(12897);const ae="KHR_materials_specular";class te{constructor(e){this.name=ae,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(ae)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;if(L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadSpecularPropertiesAsync(P,p,v)),p.extensions&&p.extensions.EXT_materials_specular_edge_color&&v instanceof q.e){p.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(v.brdf.dielectricSpecularModel=He.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,v.brdf.conductorSpecularModel=He.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(L).then((()=>{}))}))}_loadSpecularPropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;return void 0!==d.specularFactor&&(v.metallicF0Factor=d.specularFactor),void 0!==d.specularColorFactor&&(v.metallicReflectanceColor=L.Kd.Nd(d.specularColorFactor)),d.specularTexture&&(d.specularTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${e}/specularTexture`,d.specularTexture,(e=>{e.name=`${v.name} (Specular)`,v.metallicReflectanceTexture=e,v.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),d.specularColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${e}/specularColorTexture`,d.specularColorTexture,(e=>{e.name=`${v.name} (Specular Color)`,v.reflectanceTexture=e}))),Promise.all(P).then((()=>{}))}}u(ae),N(ae,!0,(e=>new te(e)));const Ie="KHR_materials_ior";class ce{constructor(e){this.name=Ie,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ie)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadIorPropertiesAsync(P,p,v)),await Promise.all(L).then((()=>{}))}))}_loadIorPropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);return void 0!==d.ior?v.indexOfRefraction=d.ior:v.indexOfRefraction=ce._DEFAULT_IOR,Promise.resolve()}}ce._DEFAULT_IOR=1.5,u(Ie),N(Ie,!0,(e=>new ce(e)));const be="KHR_materials_variants";class Me{constructor(e){this.name=be,this._loader=e,this.enabled=this._loader.isExtensionUsed(be)}dispose(){this._loader=null}static GetAvailableVariants(e){const d=this._GetExtensionMetadata(e);return d?Object.keys(d.variants):[]}getAvailableVariants(e){return Me.GetAvailableVariants(e)}static SelectVariant(e,d){const v=this._GetExtensionMetadata(e);if(!v)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${be} extension`);const P=e=>{const d=v.variants[e];if(d)for(const v of d)v.mesh.material=v.material};if(d instanceof Array)for(const p of d)P(p);else P(d);v.lastSelected=d}selectVariant(e,d){Me.SelectVariant(e,d)}static Reset(e){const d=this._GetExtensionMetadata(e);if(!d)throw new Error(`Cannot reset on a glTF mesh that does not have the ${be} extension`);for(const v of d.original)v.mesh.material=v.material;d.lastSelected=null}reset(e){Me.Reset(e)}static GetLastSelectedVariant(e){const d=this._GetExtensionMetadata(e);if(!d)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${be} extension`);return d.lastSelected}getLastSelectedVariant(e){return Me.GetLastSelectedVariant(e)}static _GetExtensionMetadata(e){var d,v;return(null===e||void 0===e||null===(d=e._internalMetadata)||void 0===d||null===(v=d.rd)||void 0===v?void 0:v[be])||null}onLoading(){const e=this._loader.rd.extensions;if(e&&e[this.name]){const d=e[this.name];this._variants=d.variants}}onReady(){const e=this._loader.rootBabylonMesh;if(e){var d;const v=this._loader.parent.extensionOptions[be];null!==v&&void 0!==v&&v.defaultVariant&&Me.SelectVariant(e,v.defaultVariant),null===v||void 0===v||null===(d=v.onLoaded)||void 0===d||d.call(v,{get variants(){return Me.GetAvailableVariants(e)},get selectedVariant(){const d=Me.GetLastSelectedVariant(e);return d?Array.isArray(d)?d[0]:d:Me.GetAvailableVariants(e)[0]},set selectedVariant(d){Me.SelectVariant(e,d)}})}}_loadMeshPrimitiveAsync(e,d,v,P,p,L){return t.LoadExtensionAsync(e,p,this.name,(async(B,X)=>{const z=new Array;return z.push(this._loader._loadMeshPrimitiveAsync(e,d,v,P,p,(d=>{if(L(d),d instanceof i.b){const v=t._GetDrawMode(e,p.mode),P=this._loader.rootBabylonMesh,L=P?P._internalMetadata=P._internalMetadata||{}:{},W=L.rd=L.rd||{},V=W[be]=W[be]||{lastSelected:null,original:[],variants:{}};V.original.push({mesh:d,material:d.material});for(let e=0;e<X.mappings.length;++e){const p=X.mappings[e],L=H.Get(`${B}/mappings/${e}/material`,this._loader.rd.materials,p.material);z.push(this._loader._loadMaterialAsync(`#/materials/${p.material}`,L,d,v,(e=>{for(let v=0;v<p.variants.length;++v){const L=p.variants[v],B=H.Get(`/extensions/${be}/variants/${L}`,this._variants,L);V.variants[B.name]=V.variants[B.name]||[],V.variants[B.name].push({mesh:d,material:e}),d.onClonedObservable.add((e=>{const v=e;let p=null,L=v;do{if(L=L.parent,!L)return;p=Me._GetExtensionMetadata(L)}while(null===p);if(P&&p===Me._GetExtensionMetadata(P)){L._internalMetadata={};for(const e in P._internalMetadata)L._internalMetadata[e]=P._internalMetadata[e];L._internalMetadata.rd=[];for(const e in P._internalMetadata.rd)L._internalMetadata.rd[e]=P._internalMetadata.rd[e];L._internalMetadata.rd[be]={lastSelected:null,original:[],variants:{}};for(const e of p.original)L._internalMetadata.rd[be].original.push({mesh:e.mesh,material:e.material});for(const e in p.variants)if(Object.prototype.hasOwnProperty.call(p.variants,e)){L._internalMetadata.rd[be].variants[e]=[];for(const d of p.variants[e])L._internalMetadata.rd[be].variants[e].push({mesh:d.mesh,material:d.material})}p=L._internalMetadata.rd[be]}for(const P of p.original)P.mesh===d&&(P.mesh=v);for(const P of p.variants[B.name])P.mesh===d&&(P.mesh=v)}))}})))}}}))),await Promise.all(z).then((e=>{let[d]=e;return d}))}))}}u(be),N(be,!0,(e=>new Me(e)));var se=v(12476);class ye{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:He.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(e,d){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...ye._GetDefaultOptions(),...e},this._scene=d,this._scene._transmissionHelper=this,this.onErrorObservable=new V.d,this._scene.Fd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(e){if(!Object.keys(e).filter((d=>this._options[d]!==e[d])).length)return;const d={...this._options,...e},v=this._options;this._options=d,d.renderSize===v.renderSize&&d.renderTargetTextureType===v.renderTargetTextureType&&d.generateMipmaps===v.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=d.samples,this._opaqueRenderTarget.lodGenerationScale=d.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=d.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(e){return!!e&&!!(e instanceof q.e&&e.subSurface.isRefractionEnabled)}_addMesh(e){this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),B.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(e)&&this._transparentMeshesCache.push(e)):-1===this._opaqueMeshesCache.indexOf(e)&&this._opaqueMeshesCache.push(e)}))}_removeMesh(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];let d=this._transparentMeshesCache.indexOf(e);-1!==d&&this._transparentMeshesCache.splice(d,1),d=this._opaqueMeshesCache.indexOf(e),-1!==d&&this._opaqueMeshesCache.splice(d,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(e){const d=this._transparentMeshesCache.indexOf(e),v=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof q.e&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==v?(this._opaqueMeshesCache.splice(v,1),this._transparentMeshesCache.push(e)):-1===d&&this._transparentMeshesCache.push(e)):-1!==d?(this._transparentMeshesCache.splice(d,1),this._opaqueMeshesCache.push(e)):-1===v&&this._opaqueMeshesCache.push(e)}_isRenderTargetValid(){var e;return null!==(null===(e=this._opaqueRenderTarget)||void 0===e?void 0:e.getInternalTexture())}_setupRenderTargets(){var e;let d;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new se.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(e=this._options.clearColor)||void 0===e?void 0:e.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((e=>{d=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?e.clearColor.L(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(e.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=d}));for(const v of this._transparentMeshesCache)this._shouldRenderAsTransmission(v.material)&&(v.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const je="KHR_materials_transmission";class Je{constructor(e){this.name=je,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(je),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadTransparentPropertiesAsync(P,d,v,p)),await Promise.all(L).then((()=>{}))}))}_loadTransparentPropertiesAsync(e,d,v,P){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const p=v;if(p.subSurface.isRefractionEnabled=!0,p.subSurface.volumeIndexOfRefraction=1,p.subSurface.useAlbedoToTintRefraction=!0,void 0===P.transmissionFactor)return p.subSurface.refractionIntensity=0,p.subSurface.isRefractionEnabled=!1,Promise.resolve();{var L;p.subSurface.refractionIntensity=P.transmissionFactor;const e=p.Ae();if(p.subSurface.refractionIntensity&&!e._transmissionHelper)new ye({},p.Ae());else if(p.subSurface.refractionIntensity&&(null===(L=e._transmissionHelper)||void 0===L||!L._isRenderTargetValid())){var B;null===(B=e._transmissionHelper)||void 0===B||B._setupRenderTargets()}}return p.subSurface.minimumThickness=0,p.subSurface.maximumThickness=0,P.transmissionTexture?(P.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/transmissionTexture`,P.transmissionTexture,void 0).then((e=>{e.name=`${v.name} (Transmission)`,p.subSurface.refractionIntensityTexture=e,p.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}u(je),N(je,!0,(e=>new Je(e)));const Ee="KHR_materials_diffuse_transmission";class ed{constructor(e){this.name=Ee,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ee),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadTranslucentPropertiesAsync(P,d,v,p)),await Promise.all(L).then((()=>{}))}))}_loadTranslucentPropertiesAsync(e,d,v,P){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const p=v;if(p.subSurface.isTranslucencyEnabled=!0,p.subSurface.volumeIndexOfRefraction=1,p.subSurface.minimumThickness=0,p.subSurface.maximumThickness=0,p.subSurface.useAlbedoToTintTranslucency=!1,void 0===P.diffuseTransmissionFactor)return p.subSurface.translucencyIntensity=0,p.subSurface.isTranslucencyEnabled=!1,Promise.resolve();p.subSurface.translucencyIntensity=P.diffuseTransmissionFactor;const B=new Array;return p.subSurface.useGltfStyleTextures=!0,P.diffuseTransmissionTexture&&(P.diffuseTransmissionTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionTexture`,P.diffuseTransmissionTexture).then((e=>{e.name=`${v.name} (Diffuse Transmission)`,p.subSurface.translucencyIntensityTexture=e})))),void 0!==P.diffuseTransmissionColorFactor?p.subSurface.translucencyColor=L.Kd.Nd(P.diffuseTransmissionColorFactor):p.subSurface.translucencyColor=L.Kd.White(),P.diffuseTransmissionColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionColorTexture`,P.diffuseTransmissionColorTexture).then((e=>{e.name=`${v.name} (Diffuse Transmission Color)`,p.subSurface.translucencyColorTexture=e}))),Promise.all(B).then((()=>{}))}}u(Ee),N(Ee,!0,(e=>new ed(e)));const dd="KHR_materials_volume";class vd{constructor(e){this.name=dd,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(dd),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadVolumePropertiesAsync(P,d,v,p)),await Promise.all(L).then((()=>{}))}))}_loadVolumePropertiesAsync(e,d,v,P){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);if(!v.subSurface.isRefractionEnabled&&!v.subSurface.isTranslucencyEnabled||!P.thicknessFactor)return Promise.resolve();v.subSurface.volumeIndexOfRefraction=v.indexOfRefraction;const p=void 0!==P.attenuationDistance?P.attenuationDistance:Number.MAX_VALUE;return v.subSurface.tintColorAtDistance=p,void 0!==P.attenuationColor&&3==P.attenuationColor.length&&v.subSurface.tintColor.Ed(P.attenuationColor[0],P.attenuationColor[1],P.attenuationColor[2]),v.subSurface.minimumThickness=0,v.subSurface.maximumThickness=P.thicknessFactor,v.subSurface.useThicknessAsDepth=!0,P.thicknessTexture?(P.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/thicknessTexture`,P.thicknessTexture).then((e=>{e.name=`${v.name} (Thickness)`,v.subSurface.thicknessTexture=e,v.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}u(dd),N(dd,!0,(e=>new vd(e)));const Pd="KHR_materials_dispersion";class pd{constructor(e){this.name=Pd,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(Pd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadDispersionPropertiesAsync(P,d,v,p)),await Promise.all(L).then((()=>{}))}))}_loadDispersionPropertiesAsync(e,d,v,P){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);return v.subSurface.isRefractionEnabled&&P.dispersion?(v.subSurface.isDispersionEnabled=!0,v.subSurface.dispersion=P.dispersion,Promise.resolve()):Promise.resolve()}}u(Pd),N(Pd,!0,(e=>new pd(e)));const Ld="EXT_materials_diffuse_roughness";class Bd{constructor(e){this.name=Ld,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ld)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(e,d,v)),L.push(this._loadDiffuseRoughnessPropertiesAsync(P,p,v)),await Promise.all(L).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(e,d,v){if(!(v instanceof q.e))throw new Error(`${e}: Material type not supported`);const P=new Array;return v.brdf.baseDiffuseModel=He.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=d.diffuseRoughnessFactor?v.baseDiffuseRoughness=d.diffuseRoughnessFactor:v.baseDiffuseRoughness=0,d.diffuseRoughnessTexture&&P.push(this._loader.loadTextureInfoAsync(`${e}/diffuseRoughnessTexture`,d.diffuseRoughnessTexture,(e=>{e.name=`${v.name} (Diffuse Roughness)`,v.baseDiffuseRoughnessTexture=e}))),Promise.all(P).then((()=>{}))}}u(Ld),N(Ld,!0,(e=>new Bd(e)));const Xd="KHR_mesh_quantization";class zd{constructor(e){this.name=Xd,this.enabled=e.isExtensionUsed(Xd)}dispose(){}}u(Xd),N(Xd,!0,(e=>new zd(e)));const Wd="KHR_texture_basisu";class Vd{constructor(e){this.name=Wd,this._loader=e,this.enabled=e.isExtensionUsed(Wd)}dispose(){this._loader=null}_loadTextureAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>{const L=void 0==d.sampler?t.DefaultSampler:H.Get(`${e}/sampler`,this._loader.rd.samplers,d.sampler),B=H.Get(`${P}/source`,this._loader.rd.images,p.source);return await this._loader._createTextureAsync(e,L,B,(e=>{v(e)}),d._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!d._textureInfo.nonColorData)}))}}u(Wd),N(Wd,!0,(e=>new Vd(e)));const kd="KHR_texture_transform";class gd{constructor(e){this.name=kd,this._loader=e,this.enabled=this._loader.isExtensionUsed(kd)}dispose(){this._loader=null}loadTextureInfoAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(P,p)=>await this._loader.loadTextureInfoAsync(e,d,(e=>{if(!(e instanceof h.e))throw new Error(`${P}: Texture type not supported`);p.offset&&(e.uOffset=p.offset[0],e.vOffset=p.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,p.rotation&&(e.wAng=-p.rotation),p.scale&&(e.uScale=p.scale[0],e.vScale=p.scale[1]),void 0!=p.texCoord&&(e.coordinatesIndex=p.texCoord),v(e)}))))}}u(kd),N(kd,!0,(e=>new gd(e)));const Fd="KHR_xmp_json_ld";class wd{constructor(e){this.name=Fd,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(Fd)}dispose(){this._loader=null}onLoading(){var e,d,v;if(null===this._loader.rootBabylonMesh)return;const P=null===(e=this._loader.rd.extensions)||void 0===e?void 0:e.KHR_xmp_json_ld,p=null===(d=this._loader.rd.asset)||void 0===d||null===(v=d.extensions)||void 0===v?void 0:v.KHR_xmp_json_ld;if(P&&p){const e=+p.packet;P.packets&&e<P.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=P.packets[e])}}}function Gd(e,d,v,P){return L.Kd.Nd(d,v).scale(P)}function Ud(e,d,v,P){return d[v]*P}function Dd(e,d,v,P){return-d[v]*P}function Cd(e,d,v,P){return d[v+1]*P}function qd(e,d,v,P){return d[v]*P*2}function hd(e){return{scale:[new nd(g.e.ANIMATIONTYPE_FLOAT,`${e}.uScale`,Ud,(()=>2)),new nd(g.e.ANIMATIONTYPE_FLOAT,`${e}.vScale`,Cd,(()=>2))],offset:[new nd(g.e.ANIMATIONTYPE_FLOAT,`${e}.uOffset`,Ud,(()=>2)),new nd(g.e.ANIMATIONTYPE_FLOAT,`${e}.vOffset`,Cd,(()=>2))],rotation:[new nd(g.e.ANIMATIONTYPE_FLOAT,`${e}.wAng`,Dd,(()=>1))]}}u(Fd),N(Fd,!0,(e=>new wd(e)));class ld extends I.AnimationPropertyInfo{buildAnimations(e,d,v,P){return[{babylonAnimatable:e._babylonCamera,babylonAnimation:this._buildAnimation(d,v,P)}]}}class nd extends I.AnimationPropertyInfo{buildAnimations(e,d,v,P){const p=[];for(const L in e._data)p.push({babylonAnimatable:e._data[L].babylonMaterial,babylonAnimation:this._buildAnimation(d,v,P)});return p}}class Ad extends I.AnimationPropertyInfo{buildAnimations(e,d,v,P){return[{babylonAnimatable:e._babylonLight,babylonAnimation:this._buildAnimation(d,v,P)}]}}(0,O.m)("/cameras/{}/orthographic/xmag",[new ld(g.e.ANIMATIONTYPE_FLOAT,"orthoLeft",Dd,(()=>1)),new ld(g.e.ANIMATIONTYPE_FLOAT,"orthoRight",Cd,(()=>1))]),(0,O.m)("/cameras/{}/orthographic/ymag",[new ld(g.e.ANIMATIONTYPE_FLOAT,"orthoBottom",Dd,(()=>1)),new ld(g.e.ANIMATIONTYPE_FLOAT,"orthoTop",Cd,(()=>1))]),(0,O.m)("/cameras/{}/orthographic/zfar",[new ld(g.e.ANIMATIONTYPE_FLOAT,"maxZ",Ud,(()=>1))]),(0,O.m)("/cameras/{}/orthographic/znear",[new ld(g.e.ANIMATIONTYPE_FLOAT,"td",Ud,(()=>1))]),(0,O.m)("/cameras/{}/perspective/yfov",[new ld(g.e.ANIMATIONTYPE_FLOAT,"fov",Ud,(()=>1))]),(0,O.m)("/cameras/{}/perspective/zfar",[new ld(g.e.ANIMATIONTYPE_FLOAT,"maxZ",Ud,(()=>1))]),(0,O.m)("/cameras/{}/perspective/znear",[new ld(g.e.ANIMATIONTYPE_FLOAT,"td",Ud,(()=>1))]),(0,O.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new nd(g.e.ANIMATIONTYPE_COLOR3,"albedoColor",Gd,(()=>4)),new nd(g.e.ANIMATIONTYPE_FLOAT,"alpha",(function(e,d,v,P){return d[v+3]*P}),(()=>4))]),(0,O.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"metallic",Ud,(()=>1))]),(0,O.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"roughness",Ud,(()=>1))]);const xd=hd("albedoTexture");(0,O.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",xd.scale),(0,O.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",xd.offset),(0,O.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",xd.rotation);const id=hd("metallicTexture");(0,O.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",id.scale),(0,O.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",id.offset),(0,O.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",id.rotation),(0,O.m)("/materials/{}/emissiveFactor",[new nd(g.e.ANIMATIONTYPE_COLOR3,"emissiveColor",Gd,(()=>3))]);const mv=hd("bumpTexture");(0,O.m)("/materials/{}/normalTexture/scale",[new nd(g.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Ud,(()=>1))]),(0,O.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",mv.scale),(0,O.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",mv.offset),(0,O.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",mv.rotation),(0,O.m)("/materials/{}/occlusionTexture/strength",[new nd(g.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Ud,(()=>1))]);const rd=hd("ambientTexture");(0,O.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",rd.scale),(0,O.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",rd.offset),(0,O.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",rd.rotation);const Zd=hd("emissiveTexture");(0,O.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Zd.scale),(0,O.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Zd.offset),(0,O.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Zd.rotation),(0,O.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new nd(g.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new nd(g.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Ud,(()=>1))]);const fd=hd("anisotropy.texture");(0,O.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",fd.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",fd.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",fd.rotation),(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Ud,(()=>1))]);const Td=hd("clearCoat.texture");(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Td.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Td.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Td.rotation);const Sd=hd("clearCoat.bumpTexture");(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new nd(g.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Sd.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Sd.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Sd.rotation);const od=hd("clearCoat.textureRoughness");(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",od.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",od.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",od.rotation),(0,O.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new nd(g.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new nd(g.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new nd(g.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new nd(g.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Ud,(()=>1))]);const Kd=hd("iridescence.texture");(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Kd.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Kd.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Kd.rotation);const Qd=hd("iridescence.thicknessTexture");(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Qd.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Qd.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Qd.rotation),(0,O.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new nd(g.e.ANIMATIONTYPE_COLOR3,"sheen.color",Gd,(()=>3))]),(0,O.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",Ud,(()=>1))]);const Nd=hd("sheen.texture");(0,O.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Nd.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Nd.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Nd.rotation);const ud=hd("sheen.textureRoughness");(0,O.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",ud.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",ud.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",ud.rotation),(0,O.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new nd(g.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Gd,(()=>3))]);const Od=hd("metallicReflectanceTexture");(0,O.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Od.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Od.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Od.rotation);const Rd=hd("reflectanceTexture");(0,O.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Rd.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Rd.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Rd.rotation),(0,O.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Ud,(()=>1))]);const Yd=hd("subSurface.refractionIntensityTexture");(0,O.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Yd.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Yd.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Yd.rotation),(0,O.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new nd(g.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Gd,(()=>3))]),(0,O.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new nd(g.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Ud,(()=>1))]),(0,O.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Ud,(()=>1))]);const Hd=hd("subSurface.thicknessTexture");(0,O.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Hd.scale),(0,O.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Hd.offset),(0,O.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Hd.rotation),(0,O.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new nd(g.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Ud,(()=>1))]);const ad=hd("subSurface.translucencyIntensityTexture");(0,O.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",ad.scale),(0,O.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",ad.offset),(0,O.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",ad.rotation),(0,O.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new nd(g.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Gd,(()=>3))]);const td=hd("subSurface.translucencyColorTexture");(0,O.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",td.scale),(0,O.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",td.offset),(0,O.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",td.rotation),(0,O.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new Ad(g.e.ANIMATIONTYPE_COLOR3,"diffuse",Gd,(()=>3))]),(0,O.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Ad(g.e.ANIMATIONTYPE_FLOAT,"intensity",Ud,(()=>1))]),(0,O.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new Ad(g.e.ANIMATIONTYPE_FLOAT,"range",Ud,(()=>1))]),(0,O.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Ad(g.e.ANIMATIONTYPE_FLOAT,"innerAngle",qd,(()=>1))]),(0,O.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Ad(g.e.ANIMATIONTYPE_FLOAT,"angle",qd,(()=>1))]),(0,O.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new Ad(g.e.ANIMATIONTYPE_COLOR3,"diffuse",Gd,(()=>3))]),(0,O.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Ad(g.e.ANIMATIONTYPE_FLOAT,"intensity",Ud,(()=>1))]);const Id="KHR_animation_pointer";class cd{constructor(e){this.name=Id,this._loader=e,this._pathToObjectConverter=(0,O.j)(this._loader.rd)}get enabled(){return this._loader.isExtensionUsed(Id)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(e,d,v,P,p){var L;const B=null===(L=P.target.extensions)||void 0===L?void 0:L.KHR_animation_pointer;if(!B||!this._pathToObjectConverter)return null;"pointer"!==P.target.path&&G.c.Warn(`${e}/target/path: Value (${P.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=P.target.node&&G.c.Warn(`${e}/target/node: Value (${P.target.node}) must not be present when using the ${this.name} extension`);const X=`${e}/extensions/${this.name}`,z=B.pointer;if(!z)throw new Error(`${X}: Pointer is missing`);try{const L=this._pathToObjectConverter.convert(z);if(!L.info.interpolation)throw new Error(`${X}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(e,d,v,P,{object:L.object,info:L.info.interpolation},p)}catch(W){return G.c.Warn(`${X}/pointer: Invalid pointer (${z}) skipped`),null}}}u(Id),N(Id,!0,(e=>new cd(e)));class bd{constructor(e,d,v){this.frame=e,this.action=d,this.onlyOnce=v,this.isDone=!1}_clone(){return new bd(this.frame,this.action,this.onlyOnce)}}var Md=v(12268),sd=v(12319),yd=v(12314);class jd{get loop(){return this._loop}set loop(e){e!==this._loop&&(this._loop=e,this.updateOptions({loop:e}))}get currentTime(){var e;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(e=sd.b.audioEngine)&&void 0!==e&&e.audioContext&&(this.isPlaying||this.isPaused)){const e=this.isPaused?0:sd.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+e}return 0}get spatialSound(){return this._spatialSound}set spatialSound(e){if(e==this._spatialSound)return;const d=this.isPlaying;this.pause(),e?(this._spatialSound=e,this._updateSpatialParameters()):this._disableSpatialSound(),d&&this.play()}constructor(e,d,v){var P;let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new V.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=p.mv.Zero(),this._localDirection=new p.mv(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=e,v=v||w.c.LastCreatedScene)if(this._scene=v,jd._SceneComponentInitialization(v),this._readyToPlayCallback=L,this._customAttenuationFunction=(e,d,v,P,p)=>d<v?e*(1-d/v):0,X&&(this.autoplay=X.autoplay||!1,this._loop=X.loop||!1,void 0!==X.volume&&(this._volume=X.volume),this._spatialSound=X.spatialSound??!1,this.maxDistance=X.maxDistance??100,this.useCustomAttenuation=X.useCustomAttenuation??!1,this.rolloffFactor=X.rolloffFactor||1,this.refDistance=X.refDistance||1,this.distanceModel=X.distanceModel||"linear",this._playbackRate=X.playbackRate||1,this._streaming=X.streaming??!1,this._length=X.length,this._offset=X.offset),null!==(P=sd.b.audioEngine)&&void 0!==P&&P.canUseWebAudio&&sd.b.audioEngine.audioContext){this._soundGain=sd.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let e=!0;if(d)try{"string"===typeof d?(this._urlType="String",this._url=d):d instanceof ArrayBuffer?this._urlType="ArrayBuffer":d instanceof HTMLMediaElement?this._urlType="MediaElement":d instanceof MediaStream?this._urlType="MediaStream":d instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(d)&&(this._urlType="Array");let v=[],P=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=sd.b.audioEngine.audioContext.createMediaElementSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=sd.b.audioEngine.audioContext.createMediaStreamSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":d.byteLength>0&&(P=!0,this._soundLoaded(d));break;case"AudioBuffer":this._audioBufferLoaded(d);break;case"String":v.push(d);case"Array":0===v.length&&(v=d);for(let e=0;e<v.length;e++){const d=v[e];if(P=X&&X.skipCodecCheck||-1!==d.indexOf(".mp3",d.length-4)&&sd.b.audioEngine.isMP3supported||-1!==d.indexOf(".ogg",d.length-4)&&sd.b.audioEngine.isOGGsupported||-1!==d.indexOf(".wav",d.length-4)||-1!==d.indexOf(".m4a",d.length-4)||-1!==d.indexOf(".mp4",d.length-4)||-1!==d.indexOf("blob:"),P){this._streaming?(this._htmlAudioElement=new Audio(d),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,B.Tools.SetCorsBehavior(d,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(d,(e=>{this._soundLoaded(e)}),void 0,!0,!0,(e=>{e&&G.c.Error("XHR "+e.status+" error on: "+d+"."),G.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:e=!1}e?P||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):G.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(z){G.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),sd.b.audioEngine&&!sd.b.audioEngine.WarnedWebAudioUnsupported&&(G.c.Error("Web Audio is not supported by your browser."),sd.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var e;null!==(e=sd.b.audioEngine)&&void 0!==e&&e.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(e){var d;null!==(d=sd.b.audioEngine)&&void 0!==d&&d.audioContext&&(this._audioBuffer=e,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(e){var d;null!==(d=sd.b.audioEngine)&&void 0!==d&&d.audioContext&&sd.b.audioEngine.audioContext.decodeAudioData(e,(e=>{this._audioBufferLoaded(e)}),(e=>{G.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+e)}))}setAudioBuffer(e){var d;null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&(this._audioBuffer=e,this._isReadyToPlay=!0)}updateOptions(e){e&&(this.loop=e.loop??this.loop,this.maxDistance=e.maxDistance??this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor??this.rolloffFactor,this.refDistance=e.refDistance??this.refDistance,this.distanceModel=e.distanceModel??this.distanceModel,this._playbackRate=e.playbackRate??this._playbackRate,this._length=e.length??void 0,this.spatialSound=e.spatialSound??this._spatialSound,this._setOffset(e.offset??void 0),this.setVolume(e.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var e;null!==(e=sd.b.audioEngine)&&void 0!==e&&e.canUseWebAudio&&sd.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??sd.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var e;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(e=this._soundPanner)||void 0===e||e.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var e;null!==(e=sd.b.audioEngine)&&void 0!==e&&e.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(e){var d;null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(e),this._isOutputConnected=!0)}setDirectionalCone(e,d,v){d<e?G.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=e,this._coneOuterAngle=d,this._coneOuterGain=v,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(e){if(e!=this._coneInnerAngle){var d;if(this._coneOuterAngle<e)return void G.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e,null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(e){if(e!=this._coneOuterAngle){var d;if(e<this._coneInnerAngle)return void G.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e,null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(e){var d;e.equals(this._position)||(this._position.L(e),null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(e){var d;this._localDirection=e,null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const e=this._connectedTransformNode.getWorldMatrix(),d=p.mv.TransformNormal(this._localDirection,e);d.normalize(),this._soundPanner.orientationX.value=d.x,this._soundPanner.orientationY.value=d.y,this._soundPanner.orientationZ.value=d.z}updateDistanceFromListener(){var e;if(null!==(e=sd.b.audioEngine)&&void 0!==e&&e.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const e=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Zd(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,e,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(e){this._customAttenuationFunction=e}play(e,d,v){var P;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(P=sd.b.audioEngine)&&void 0!==P&&P.audioContext)try{var p,L;this._clearTimeoutsAndObservers();let P=e?(null===(p=sd.b.audioEngine)||void 0===p?void 0:p.audioContext.currentTime)+e:null===(L=sd.b.audioEngine)||void 0===L?void 0:L.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=sd.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const e=()=>{var v;if(null!==(v=sd.b.audioEngine)&&void 0!==v&&v.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=d??0;const v=this._htmlAudioElement.play();void 0!==v&&v.catch((()=>{var d,v;(null===(d=sd.b.audioEngine)||void 0===d||d.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(v=sd.b.audioEngine)||void 0===v?void 0:v.onAudioUnlockedObservable.addOnce((()=>{e()})))}))}else{var P;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(P=sd.b.audioEngine)||void 0===P?void 0:P.onAudioUnlockedObservable.addOnce((()=>{e()}))}};e()}}else{var B;const p=()=>{var p;if(null!==(p=sd.b.audioEngine)&&void 0!==p&&p.audioContext){var L;if(v=v||this._length,void 0!==d&&this._setOffset(d),this._soundSource){const e=this._soundSource;e.onended=()=>{e.disconnect()}}if(this._soundSource=null===(L=sd.b.audioEngine)||void 0===L?void 0:L.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var B;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==d&&(this._soundSource.loopStart=d),void 0!==v&&(this._soundSource.loopEnd=(0|d)+v),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},P=e?(null===(B=sd.b.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+e:sd.b.audioEngine.audioContext.currentTime;const p=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(P,p,this.loop?void 0:v)}}};"suspended"===(null===(B=sd.b.audioEngine)||void 0===B?void 0:B.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var e;"suspended"===(null===(e=sd.b.audioEngine)||void 0===e?void 0:e.audioContext.state)?(sd.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=sd.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{p()})))):p()}),500):p()}this._startTime=P,this.isPlaying=!0,this.isPaused=!1}catch(X){G.c.Error("Error while trying to play audio: "+this.name+", "+X.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(e){var d;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var v;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(v=this._streamingSource)||void 0===v||v.disconnect();this.isPlaying=!1}else if(null!==(d=sd.b.audioEngine)&&void 0!==d&&d.audioContext&&this._soundSource){const d=e?sd.b.audioEngine.audioContext.currentTime+e:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(d)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var e;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var d;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(d=this._streamingSource)||void 0===d||d.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(e=sd.b.audioEngine)&&void 0!==e&&e.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=sd.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(e,d){var v;null!==(v=sd.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._soundGain&&(d&&sd.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(sd.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,sd.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(e,sd.b.audioEngine.audioContext.currentTime+d)):this._soundGain.gain.value=e),this._volume=e}setPlaybackRate(e){this._playbackRate=e,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(e){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=e,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=e=>this._onRegisterAfterWorldMatrixUpdate(e),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(e){var d;if(e.getBoundingInfo){const d=e.getBoundingInfo();this.setPosition(d.boundingSphere.centerWorld)}else this.setPosition(e.absolutePosition);null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const e=()=>{(0,yd.g)((()=>this._isReadyToPlay),(()=>{v._audioBuffer=this.getAudioBuffer(),v._isReadyToPlay=!0,v.autoplay&&v.play(0,this._offset,this._length)}),void 0,300)},d={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},v=new jd(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,d);return this.useCustomAttenuation&&v.setAttenuationFunction(this._customAttenuationFunction),v.setPosition(this._position),v.setPlaybackRate(this._playbackRate),e(),v}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const e={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(e.connectedMeshId=this._connectedTransformNode.id),e.position=this._position.Yd(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.Yd(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e}static Parse(e,d,v,P){const L=e.name;let B;B=e.url?v+e.url:v+L;const X={autoplay:e.autoplay,loop:e.loop,volume:e.volume,spatialSound:e.spatialSound,maxDistance:e.maxDistance,rolloffFactor:e.rolloffFactor,refDistance:e.refDistance,distanceModel:e.distanceModel,playbackRate:e.playbackRate};let z;if(P){const e=()=>{(0,yd.g)((()=>P._isReadyToPlay),(()=>{z._audioBuffer=P.getAudioBuffer(),z._isReadyToPlay=!0,z.autoplay&&z.play(0,z._offset,z._length)}),void 0,300)};z=new jd(L,new ArrayBuffer(0),d,null,X),e()}else z=new jd(L,B,d,(()=>{d.removePendingData(z)}),X),d.addPendingData(z);if(e.position){const d=p.mv.Nd(e.position);z.setPosition(d)}if(e.isDirectional&&(z.setDirectionalCone(e.coneInnerAngle||360,e.coneOuterAngle||360,e.coneOuterGain||0),e.localDirectionToMesh)){const d=p.mv.Nd(e.localDirectionToMesh);z.setLocalDirectionToMesh(d)}if(e.connectedMeshId){const v=d.getMeshById(e.connectedMeshId);v&&z.attachToMesh(v)}return e.metadata&&(z.metadata=e.metadata),z}_setOffset(e){this._offset!==e&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=e)}_clearTimeoutsAndObservers(){var e;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(e=sd.b.audioEngine)||void 0===e||e.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}jd._SceneComponentInitialization=e=>{throw(0,Md.e)("AudioSceneComponent")},(0,ne.h)("BABYLON.Sound",jd);class Jd{constructor(e,d,v){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],d.length!==v.length)throw new Error("Sounds length does not equal weights length");this.loop=e,this._weights=v;let P=0;for(const L of v)P+=L;const p=P>0?1/P:0;for(let L=0;L<this._weights.length;L++)this._weights[L]*=p;this._sounds=d;for(const L of this._sounds)L.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(e){if(e!==this._coneInnerAngle){if(this._coneOuterAngle<e)return void G.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e;for(const d of this._sounds)d.directionalConeInnerAngle=e}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(e){if(e!==this._coneOuterAngle){if(e<this._coneInnerAngle)return void G.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e;for(const d of this._sounds)d.directionalConeOuterAngle=e}}get volume(){return this._volume}set volume(e){if(e!==this._volume)for(const d of this._sounds)d.setVolume(e)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(e){if(!this.isPaused){this.stop();const e=Math.random();let d=0;for(let v=0;v<this._weights.length;v++)if(d+=this._weights[v],e<=d){this._currentIndex=v;break}}const d=this._sounds[this._currentIndex??0];d.isReady()?d.play(0,this.isPaused?void 0:e):d.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Ed{constructor(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(e=e||w.c.LastCreatedScene)&&(this._scene=e,this.soundCollection=[],this._options=d,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var e;null!==(e=sd.b.audioEngine)&&void 0!==e&&e.canUseWebAudio&&sd.b.audioEngine.audioContext&&(this._outputAudioNode=sd.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(sd.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(sd.b.audioEngine&&sd.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(e){var d;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&e.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==e.soundTrackId&&(-1===e.soundTrackId?this._scene.mainSoundTrack.removeSound(e):this._scene.soundTracks&&this._scene.soundTracks[e.soundTrackId].removeSound(e)),this.soundCollection.push(e),e.soundTrackId=this.id}removeSound(e){const d=this.soundCollection.indexOf(e);-1!==d&&this.soundCollection.splice(d,1)}setVolume(e){var d;null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=e)}switchPanningModelToHRTF(){var e;if(null!==(e=sd.b.audioEngine)&&void 0!==e&&e.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var e;if(null!==(e=sd.b.audioEngine)&&void 0!==e&&e.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToEqualPower()}connectToAnalyser(e){var d;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,null!==(d=sd.b.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,sd.b.audioEngine.masterGain))}}var ev=v(12681),dv=v(12653),vv=v(12250);sd.b.AudioEngineFactory=(e,d,v)=>new Pv(e,d,v);class Pv{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new V.d,this.onAudioLockedObservable=new V.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,vv.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const P=document.createElement("audio");this._hostElement=e,this._audioContext=d,this._audioDestination=v;try{P&&P.canPlayType&&(P.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||P.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(p){}try{P&&P.canPlayType&&P.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(p){}}lock(){this._triggerSuspendedState()}unlock(){var e,d;if("running"===(null===(e=this._audioContext)||void 0===e?void 0:e.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(d=this._audioContext)||void 0===d||d.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{G.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var e;null===(e=this._audioContext)||void 0===e||e.addEventListener("statechange",(()=>{var e;this.unlocked&&"running"!==(null===(e=this._audioContext)||void 0===e?void 0:e.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var e;return null!==(e=this._audioContext)&&void 0!==e&&e.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(e){this.canUseWebAudio=!1,G.c.Error("Web Audio: "+e.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(e){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const e=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",d=document.createElement("style");d.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(d),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var e;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(e=this._audioContext)||void 0===e||e.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)}connectToAnalyser(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var pv=v(12265);(0,v(13856).e)(ev.c.NAME_AUDIO,((e,d,v,P)=>{let p,L=[];if(v.Yg=v.Yg||[],void 0!==e.Yg&&null!==e.Yg)for(let X=0,z=e.Yg.length;X<z;X++){var B;const z=e.Yg[X];null!==(B=sd.b.audioEngine)&&void 0!==B&&B.canUseWebAudio?(z.url||(z.url=z.name),L[z.url]?v.Yg.push(jd.Parse(z,d,P,L[z.url])):(p=jd.Parse(z,d,P),L[z.url]=p,v.Yg.push(p))):v.Yg.push(new jd(z.name,null,d))}L=[]})),Object.defineProperty(dv.d.prototype,"mainSoundTrack",{get:function(){let e=this._getComponent(ev.c.NAME_AUDIO);return e||(e=new Lv(this),this.o(e)),this._mainSoundTrack||(this._mainSoundTrack=new Ed(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),dv.d.prototype.getSoundByName=function(e){let d;for(d=0;d<this.mainSoundTrack.soundCollection.length;d++)if(this.mainSoundTrack.soundCollection[d].name===e)return this.mainSoundTrack.soundCollection[d];if(this.soundTracks)for(let v=0;v<this.soundTracks.length;v++)for(d=0;d<this.soundTracks[v].soundCollection.length;d++)if(this.soundTracks[v].soundCollection[d].name===e)return this.soundTracks[v].soundCollection[d];return null},Object.defineProperty(dv.d.prototype,"audioEnabled",{get:function(){let e=this._getComponent(ev.c.NAME_AUDIO);return e||(e=new Lv(this),this.o(e)),e.audioEnabled},set:function(e){let d=this._getComponent(ev.c.NAME_AUDIO);d||(d=new Lv(this),this.o(d)),e?d.enableAudio():d.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(dv.d.prototype,"headphone",{get:function(){let e=this._getComponent(ev.c.NAME_AUDIO);return e||(e=new Lv(this),this.o(e)),e.headphone},set:function(e){let d=this._getComponent(ev.c.NAME_AUDIO);d||(d=new Lv(this),this.o(d)),e?d.switchAudioModeForHeadphones():d.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(dv.d.prototype,"audioListenerPositionProvider",{get:function(){let e=this._getComponent(ev.c.NAME_AUDIO);return e||(e=new Lv(this),this.o(e)),e.audioListenerPositionProvider},set:function(e){let d=this._getComponent(ev.c.NAME_AUDIO);if(d||(d=new Lv(this),this.o(d)),e&&"function"!==typeof e)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");d.audioListenerPositionProvider=e},enumerable:!0,configurable:!0}),Object.defineProperty(dv.d.prototype,"audioListenerRotationProvider",{get:function(){let e=this._getComponent(ev.c.NAME_AUDIO);return e||(e=new Lv(this),this.o(e)),e.audioListenerRotationProvider},set:function(e){let d=this._getComponent(ev.c.NAME_AUDIO);if(d||(d=new Lv(this),this.o(d)),e&&"function"!==typeof e)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");d.audioListenerRotationProvider=e},enumerable:!0,configurable:!0}),Object.defineProperty(dv.d.prototype,"audioPositioningRefreshRate",{get:function(){let e=this._getComponent(ev.c.NAME_AUDIO);return e||(e=new Lv(this),this.o(e)),e.audioPositioningRefreshRate},set:function(e){let d=this._getComponent(ev.c.NAME_AUDIO);d||(d=new Lv(this),this.o(d)),d.audioPositioningRefreshRate=e},enumerable:!0,configurable:!0});class Lv{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(e){this.name=ev.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new p.mv,this._cachedCameraPosition=new p.mv,this._lastCheck=0,this._invertMatrixTemp=new p.Matrix,this._cameraDirectionTemp=new p.mv,(e=e||w.c.LastCreatedScene)&&(this.fd=e,e.soundTracks=[],e.Yg=[])}register(){this.fd._afterRenderStage.registerStep(ev.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(e){if(e.Yg=[],this.fd.soundTracks)for(let d=0;d<this.fd.soundTracks.length;d++){const v=this.fd.soundTracks[d];for(let d=0;d<v.soundCollection.length;d++)e.Yg.push(v.soundCollection[d].serialize())}}addFromContainer(e){if(e.Yg)for(const d of e.Yg)d.play(),d.autoplay=!0,this.fd.mainSoundTrack.addSound(d)}removeFromContainer(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.Yg)for(const v of e.Yg)v.stop(),v.autoplay=!1,this.fd.mainSoundTrack.removeSound(v),d&&v.dispose()}dispose(){const e=this.fd;if(e._mainSoundTrack&&e.mainSoundTrack.dispose(),e.soundTracks)for(let d=0;d<e.soundTracks.length;d++)e.soundTracks[d].dispose()}disableAudio(){const e=this.fd;let d;for(this._audioEnabled=!1,sd.b.audioEngine&&sd.b.audioEngine.audioContext&&sd.b.audioEngine.audioContext.suspend(),d=0;d<e.mainSoundTrack.soundCollection.length;d++)e.mainSoundTrack.soundCollection[d].pause();if(e.soundTracks)for(d=0;d<e.soundTracks.length;d++)for(let v=0;v<e.soundTracks[d].soundCollection.length;v++)e.soundTracks[d].soundCollection[v].pause()}enableAudio(){const e=this.fd;let d;for(this._audioEnabled=!0,sd.b.audioEngine&&sd.b.audioEngine.audioContext&&sd.b.audioEngine.audioContext.resume(),d=0;d<e.mainSoundTrack.soundCollection.length;d++)e.mainSoundTrack.soundCollection[d].isPaused&&e.mainSoundTrack.soundCollection[d].play();if(e.soundTracks)for(d=0;d<e.soundTracks.length;d++)for(let v=0;v<e.soundTracks[d].soundCollection.length;v++)e.soundTracks[d].soundCollection[v].isPaused&&e.soundTracks[d].soundCollection[v].play()}switchAudioModeForHeadphones(){const e=this.fd;if(this._headphone=!0,e.mainSoundTrack.switchPanningModelToHRTF(),e.soundTracks)for(let d=0;d<e.soundTracks.length;d++)e.soundTracks[d].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const e=this.fd;if(this._headphone=!1,e.mainSoundTrack.switchPanningModelToEqualPower(),e.soundTracks)for(let d=0;d<e.soundTracks.length;d++)e.soundTracks[d].switchPanningModelToEqualPower()}_afterRender(){const e=pv.d.Now;if(this._lastCheck&&e-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=e;const d=this.fd;if(!this._audioEnabled||!d._mainSoundTrack||!d.soundTracks||0===d._mainSoundTrack.soundCollection.length&&1===d.soundTracks.length)return;const v=sd.b.audioEngine;if(v&&v.audioContext){let e,P=d.activeCamera;if(d.activeCameras&&d.activeCameras.length>0&&(P=d.activeCameras[0]),this.audioListenerPositionProvider){const e=this.audioListenerPositionProvider();v.audioContext.listener.setPosition(e.x||0,e.y||0,e.z||0)}else P?this._cachedCameraPosition.equals(P.globalPosition)||(this._cachedCameraPosition.L(P.globalPosition),v.audioContext.listener.setPosition(P.globalPosition.x,P.globalPosition.y,P.globalPosition.z)):v.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const e=this.audioListenerRotationProvider();v.audioContext.listener.setOrientation(e.x||0,e.y||0,e.z||0,0,1,0)}else P?(P.rigCameras&&P.rigCameras.length>0&&(P=P.rigCameras[0]),P.getViewMatrix().invertToRef(this._invertMatrixTemp),p.mv.TransformNormalToRef(Lv._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.L(this._cameraDirectionTemp),v.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):v.audioContext.listener.setOrientation(0,0,0,0,1,0);for(e=0;e<d.mainSoundTrack.soundCollection.length;e++){const v=d.mainSoundTrack.soundCollection[e];v.useCustomAttenuation&&v.updateDistanceFromListener()}if(d.soundTracks)for(e=0;e<d.soundTracks.length;e++)for(let v=0;v<d.soundTracks[e].soundCollection.length;v++){const P=d.soundTracks[e].soundCollection[v];P.useCustomAttenuation&&P.updateDistanceFromListener()}}}}Lv._CameraDirection=new p.mv(0,0,-1),jd._SceneComponentInitialization=e=>{let d=e._getComponent(ev.c.NAME_AUDIO);d||(d=new Lv(e),e.o(d))};const Bv="MSFT_audio_emitter";class Xv{constructor(e){this.name=Bv,this._loader=e,this.enabled=this._loader.isExtensionUsed(Bv)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const e=this._loader.rd.extensions;if(e&&e[this.name]){const d=e[this.name];this._clips=d.clips,this._emitters=d.emitters,H.Assign(this._clips),H.Assign(this._emitters)}}loadSceneAsync(e,d){return t.LoadExtensionAsync(e,d,this.name,(async(v,P)=>{const p=new Array;p.push(this._loader.loadSceneAsync(e,d));for(const e of P.emitters){const d=H.Get(`${v}/emitters`,this._emitters,e);if(void 0!=d.refDistance||void 0!=d.maxDistance||void 0!=d.rolloffFactor||void 0!=d.distanceModel||void 0!=d.innerAngle||void 0!=d.outerAngle)throw new Error(`${v}: Direction or Distance properties are not allowed on emitters attached to a scene`);p.push(this._loadEmitterAsync(`${v}/emitters/${d.index}`,d))}await Promise.all(p)}))}loadNodeAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(e,P)=>{const L=new Array,X=await this._loader.loadNodeAsync(e,d,(d=>{for(const v of P.emitters){const P=H.Get(`${e}/emitters`,this._emitters,v);L.push(this._loadEmitterAsync(`${e}/emitters/${P.index}`,P).then((()=>{for(const e of P._babylonSounds)e.attachToMesh(d),void 0==P.innerAngle&&void 0==P.outerAngle||(e.setLocalDirectionToMesh(p.mv.Forward()),e.setDirectionalCone(2*B.Tools.ToDegrees(void 0==P.innerAngle?Math.PI:P.innerAngle),2*B.Tools.ToDegrees(void 0==P.outerAngle?Math.PI:P.outerAngle),0))})))}v(d)}));return await Promise.all(L),X}))}loadAnimationAsync(e,d){return t.LoadExtensionAsync(e,d,this.name,(async(v,P)=>{const p=await this._loader.loadAnimationAsync(e,d),L=new Array;H.Assign(P.events);for(const B of P.events)L.push(this._loadAnimationEventAsync(`${v}/events/${B.index}`,e,d,B,p));return await Promise.all(L),p}))}_loadClipAsync(e,d){if(d._objectURL)return d._objectURL;let v;if(d.uri)v=this._loader.loadUriAsync(e,d,d.uri);else{const P=H.Get(`${e}/bufferView`,this._loader.rd.bufferViews,d.bufferView);v=this._loader.loadBufferViewAsync(`/bufferViews/${P.index}`,P)}return d._objectURL=v.then((e=>URL.createObjectURL(new Blob([e],{type:d.mimeType})))),d._objectURL}_loadEmitterAsync(e,d){if(d._babylonSounds=d._babylonSounds||[],!d._babylonData){const e=new Array,v=d.name||`emitter${d.index}`,P={loop:!1,autoplay:!1,volume:void 0==d.volume?1:d.volume};for(let L=0;L<d.clips.length;L++){const p=`/extensions/${this.name}/clips`,B=H.Get(p,this._clips,d.clips[L].clip);e.push(this._loadClipAsync(`${p}/${d.clips[L].clip}`,B).then((e=>{const p=d._babylonSounds[L]=new jd(v,e,this._loader.babylonScene,null,P);p.refDistance=d.refDistance||1,p.maxDistance=d.maxDistance||256,p.rolloffFactor=d.rolloffFactor||1,p.distanceModel=d.distanceModel||"exponential"})))}const p=Promise.all(e).then((()=>{const e=d.clips.map((e=>e.weight||1)),v=new Jd(d.loop||!1,d._babylonSounds,e);d.innerAngle&&(v.directionalConeInnerAngle=2*B.Tools.ToDegrees(d.innerAngle)),d.outerAngle&&(v.directionalConeOuterAngle=2*B.Tools.ToDegrees(d.outerAngle)),d.volume&&(v.volume=d.volume),d._babylonData.sound=v}));d._babylonData={loaded:p}}return d._babylonData.loaded}_getEventAction(e,d,v,P,p){switch(v){case"play":return e=>{const v=(p||0)+(e-P);d.play(v)};case"stop":return()=>{d.stop()};case"pause":return()=>{d.pause()};default:throw new Error(`${e}: Unsupported action ${v}`)}}_loadAnimationEventAsync(e,d,v,P,p){if(0==p.targetedAnimations.length)return Promise.resolve();const L=p.targetedAnimations[0],B=P.Pd,X=H.Get(`/extensions/${this.name}/emitters`,this._emitters,B);return this._loadEmitterAsync(e,X).then((()=>{const d=X._babylonData.sound;if(d){const v=new bd(P.time,this._getEventAction(e,d,P.action,P.time,P.startOffset));L.animation.addEvent(v),p.onAnimationGroupEndObservable.add((()=>{d.stop()})),p.onAnimationGroupPauseObservable.add((()=>{d.pause()}))}}))}}u(Bv),N(Bv,!0,(e=>new Xv(e)));const zv="MSFT_lod";class Wv{constructor(e){var d;this.name=zv,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new V.d,this.onMaterialLODsLoadedObservable=new V.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=e,this.maxLODsToLoad=(null===(d=this._loader.parent.extensionOptions[zv])||void 0===d?void 0:d.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(zv)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let e=0;e<this._nodePromiseLODs.length;e++){const d=Promise.all(this._nodePromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Node LOD ${e}`),this._loader.log(`Loaded node LOD ${e}`)),this.onNodeLODsLoadedObservable.notifyObservers(e),e!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${e+1}`),this._loadBufferLOD(this._nodeBufferLODs,e+1),this._nodeSignalLODs[e]&&this._nodeSignalLODs[e].resolve())}));this._loader._completePromises.push(d)}for(let e=0;e<this._materialPromiseLODs.length;e++){const d=Promise.all(this._materialPromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Material LOD ${e}`),this._loader.log(`Loaded material LOD ${e}`)),this.onMaterialLODsLoadedObservable.notifyObservers(e),e!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${e+1}`),this._loadBufferLOD(this._materialBufferLODs,e+1),this._materialSignalLODs[e]&&this._materialSignalLODs[e].resolve())}));this._loader._completePromises.push(d)}}loadSceneAsync(e,d){const v=this._loader.loadSceneAsync(e,d);return this._loadBufferLOD(this._bufferLODs,0),v}loadNodeAsync(e,d,v){return t.LoadExtensionAsync(e,d,this.name,(async(e,p)=>{let L;const B=this._getLODs(e,d,this._loader.rd.nodes,p.ids);this._loader.logOpen(`${e}`);for(let d=0;d<B.length;d++){const e=B[d];0!==d&&(this._nodeIndexLOD=d,this._nodeSignalLODs[d]=this._nodeSignalLODs[d]||new P);const p=e=>{v(e),e.YX(!1)},X=this._loader.loadNodeAsync(`/nodes/${e.index}`,e,p).then((e=>{if(0!==d){const e=B[d-1];e._babylonTransformNode&&(this._disposeTransformNode(e._babylonTransformNode),delete e._babylonTransformNode)}return e.YX(!0),e}));this._nodePromiseLODs[d]=this._nodePromiseLODs[d]||[],0===d?L=X:(this._nodeIndexLOD=null,this._nodePromiseLODs[d].push(X))}return this._loader.logClose(),await L}))}_loadMaterialAsync(e,d,v,P,p){return this._nodeIndexLOD?null:t.LoadExtensionAsync(e,d,this.name,(async(e,L)=>{let B;const X=this._getLODs(e,d,this._loader.rd.materials,L.ids);this._loader.logOpen(`${e}`);for(let d=0;d<X.length;d++){const e=X[d];0!==d&&(this._materialIndexLOD=d);const L=this._loader._loadMaterialAsync(`/materials/${e.index}`,e,v,P,(e=>{0===d&&p(e)})).then((e=>{if(0!==d){p(e);const v=X[d-1]._data;v[P]&&(this._disposeMaterials([v[P].babylonMaterial]),delete v[P])}return e}));this._materialPromiseLODs[d]=this._materialPromiseLODs[d]||[],0===d?B=L:(this._materialIndexLOD=null,this._materialPromiseLODs[d].push(L))}return this._loader.logClose(),await B}))}_loadUriAsync(e,d,v){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const p=this._nodeIndexLOD-1;return this._nodeSignalLODs[p]=this._nodeSignalLODs[p]||new P,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(e,d,v)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const p=this._materialIndexLOD-1;return this._materialSignalLODs[p]=this._materialSignalLODs[p]||new P,this._materialSignalLODs[p].promise.then((async()=>await this._loader.loadUriAsync(e,d,v)))}return null}loadBufferAsync(e,d,v,p){if(this._loader.parent.useRangeRequests&&!d.uri){if(!this._loader.bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);const d=async(e,d)=>{const L=v,B=L+p-1;let X=e[d];return X?(X.start=Math.min(X.start,L),X.end=Math.max(X.end,B)):(X={start:L,end:B,loaded:new P},e[d]=X),await X.loaded.promise.then((e=>new Uint8Array(e.buffer,e.byteOffset+v-X.start,p)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?d(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?d(this._materialBufferLODs,this._materialIndexLOD):d(this._bufferLODs,0)}return null}_loadBufferLOD(e,d){const v=e[d];v&&(this._loader.log(`Loading buffer range [${v.start}-${v.end}]`),this._loader.bin.readAsync(v.start,v.end-v.start+1).then((e=>{v.loaded.resolve(e)}),(e=>{v.loaded.reject(e)})))}_getLODs(e,d,v,P){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const p=[];for(let L=P.length-1;L>=0;L--)if(p.push(H.Get(`${e}/ids/${P[L]}`,v,P[L])),p.length===this.maxLODsToLoad)return p;return p.push(d),p}_disposeTransformNode(e){const d=[],v=e.material;v&&d.push(v);for(const p of e.getChildMeshes())p.material&&d.push(p.material);e.dispose();const P=d.filter((e=>this._loader.babylonScene.meshes.every((d=>d.material!=e))));this._disposeMaterials(P)}_disposeMaterials(e){const d={};for(const v of e){for(const e of v.getActiveTextures())d[e.uniqueId]=e;v.dispose()}for(const v in d)for(const e of this._loader.babylonScene.materials)e.hasTexture(d[v])&&delete d[v];for(const v in d)d[v].dispose()}}u(zv),N(zv,!0,(e=>new Wv(e)));const Vv="MSFT_minecraftMesh";class kv{constructor(e){this.name=Vv,this._loader=e,this.enabled=this._loader.isExtensionUsed(Vv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtraAsync(e,d,this.name,(async(P,p)=>{if(p){if(!(v instanceof q.e))throw new Error(`${P}: Material type not supported`);const p=this._loader.loadMaterialPropertiesAsync(e,d,v);return v.needAlphaBlending()&&(v.forceDepthWrite=!0,v.separateCullingPass=!0),v.Jd=v.forceDepthWrite,v.twoSidedLighting=!0,await p}}))}}u(Vv),N(Vv,!0,(e=>new kv(e)));const gv="MSFT_sRGBFactors";class Fv{constructor(e){this.name=gv,this._loader=e,this.enabled=this._loader.isExtensionUsed(gv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,d,v){return t.LoadExtraAsync(e,d,this.name,(async(P,p)=>{if(p){if(!(v instanceof q.e))throw new Error(`${P}: Material type not supported`);const p=this._loader.loadMaterialPropertiesAsync(e,d,v),L=v.Ae().getEngine().useExactSrgbConversions;return v.albedoTexture||v.albedoColor.toLinearSpaceToRef(v.albedoColor,L),v.reflectivityTexture||v.reflectivityColor.toLinearSpaceToRef(v.reflectivityColor,L),await p}}))}}u(gv),N(gv,!0,(e=>new Fv(e)));var wv=v(14170);const Gv={};var Uv=v(14214),Dv=v(14192),Cv=v(14177),qv=v(14181);function hv(e,d){for(const v of e)for(const e of v.dataOutputs)if(e.uniqueId===d)return e;throw new Error("Could not find data out connection with unique id "+d)}function lv(e,d){for(const v of e)if(v instanceof Dv.c)for(const e of v.signalInputs)if(e.uniqueId===d)return e;throw new Error("Could not find signal in connection with unique id "+d)}async function nv(e,d){const P=await Promise.all(e.allBlocks.map((async e=>{const d=function(e){switch(e){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([v.e(78),v.e(79)]).then(v.bind(v,15606))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await v.e(80).then(v.bind(v,15614))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await v.e(81).then(v.bind(v,15617))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await v.e(82).then(v.bind(v,15621))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await v.e(83).then(v.bind(v,15628))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await v.e(84).then(v.bind(v,15632))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await v.e(85).then(v.bind(v,15639))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await v.e(86).then(v.bind(v,15642))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await v.e(87).then(v.bind(v,15650))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await v.e(90).then(v.bind(v,15689))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await v.e(90).then(v.bind(v,15689))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await v.e(90).then(v.bind(v,15689))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await v.e(90).then(v.bind(v,15689))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await v.e(95).then(v.bind(v,15693))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await v.e(96).then(v.bind(v,15697))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await v.e(97).then(v.bind(v,15700))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await v.e(98).then(v.bind(v,15705))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await v.e(99).then(v.bind(v,15710))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await v.e(100).then(v.bind(v,15716))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await v.e(101).then(v.bind(v,15723))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await v.e(102).then(v.bind(v,15730))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await v.e(103).then(v.bind(v,15734))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await v.e(104).then(v.bind(v,15741))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await v.e(105).then(v.bind(v,15747))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await v.e(106).then(v.bind(v,15755))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await v.e(107).then(v.bind(v,15764))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await v.e(108).then(v.bind(v,15767))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await v.e(109).then(v.bind(v,15774))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await v.e(110).then(v.bind(v,15776))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await v.e(111).then(v.bind(v,15780))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await v.e(112).then(v.bind(v,15783))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await v.e(113).then(v.bind(v,15788))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await v.e(92).then(v.bind(v,15791))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await v.e(114).then(v.bind(v,15799))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await v.e(115).then(v.bind(v,15804))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await v.e(116).then(v.bind(v,15813))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await v.e(93).then(v.bind(v,15818))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await v.e(88).then(v.bind(v,15653))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await v.e(94).then(v.bind(v,15822))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await v.e(94).then(v.bind(v,15822))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await v.e(94).then(v.bind(v,15822))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await v.e(94).then(v.bind(v,15822))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await v.e(94).then(v.bind(v,15822))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await v.e(94).then(v.bind(v,15822))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await v.e(94).then(v.bind(v,15822))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await v.e(94).then(v.bind(v,15822))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await v.e(89).then(v.bind(v,15681))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await v.e(90).then(v.bind(v,15689))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await v.e(90).then(v.bind(v,15689))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await v.e(91).then(v.bind(v,15825))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await v.e(91).then(v.bind(v,15825))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await v.e(91).then(v.bind(v,15825))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await v.e(91).then(v.bind(v,15825))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await v.e(91).then(v.bind(v,15825))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await v.e(91).then(v.bind(v,15825))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await v.e(117).then(v.bind(v,15834))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await v.e(118).then(v.bind(v,15839))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await v.e(119).then(v.bind(v,15845))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await v.e(120).then(v.bind(v,15853))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await v.e(121).then(v.bind(v,15860))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await v.e(122).then(v.bind(v,15868))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await v.e(123).then(v.bind(v,15876))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await v.e(124).then(v.bind(v,15883))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await v.e(125).then(v.bind(v,15885))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await v.e(126).then(v.bind(v,15889))).FlowGraphDataSwitchBlock;default:if(Gv[e])return Gv[e];throw new Error(`Unknown block name ${e}`)}}(e.className);return await d()})));return function(e,d,v){const P=d.coordinator.createGraph(),p=[],L=d.valueParseFunction??Cv.e;for(let B=0;B<e.allBlocks.length;B++){const X=xv(e.allBlocks[B],{fd:d.coordinator.config.fd,pathConverter:d.pathConverter,assetsContainer:d.coordinator.config.fd,valueParseFunction:L},v[B]);p.push(X),X instanceof Uv.e&&P.addEventBlock(X)}for(const B of p){for(const e of B.dataInputs)for(const d of e.connectedPointIds){const v=hv(p,d);e.connectTo(v)}if(B instanceof Dv.c)for(const e of B.signalOutputs)for(const d of e.connectedPointIds){const v=lv(p,d);e.connectTo(v)}}for(const B of e.executionContexts)Av(B,{graph:P,valueParseFunction:L},e.rightHanded);return P}(e,d,P)}function Av(e,d,v){const P=d.graph.createContext();e.enableLogging&&(P.enableLogging=!0),P.treatDataAsRightHanded=v||!1;const p=d.valueParseFunction??Cv.e;P.uniqueId=e.uniqueId;const L=P.Ae();if(e._assetsContext){var B,X,z,W,V,k,g,F,w,G;const d=e._assetsContext,v={meshes:null===(B=d.meshes)||void 0===B?void 0:B.map((e=>L.getMeshById(e))),lights:null===(X=d.lights)||void 0===X?void 0:X.map((e=>L.getLightByName(e))),cameras:null===(z=d.cameras)||void 0===z?void 0:z.map((e=>L.getCameraByName(e))),materials:null===(W=d.materials)||void 0===W?void 0:W.map((e=>L.getMaterialById(e))),textures:null===(V=d.textures)||void 0===V?void 0:V.map((e=>L.getTextureByName(e))),animations:null===(k=d.animations)||void 0===k?void 0:k.map((e=>L.animations.find((d=>d.name===e)))),skeletons:null===(g=d.skeletons)||void 0===g?void 0:g.map((e=>L.getSkeletonByName(e))),sk:null===(F=d.sk)||void 0===F?void 0:F.map((e=>L.getParticleSystemById(e))),animationGroups:null===(w=d.animationGroups)||void 0===w?void 0:w.map((e=>L.getAnimationGroupByName(e))),transformNodes:null===(G=d.transformNodes)||void 0===G?void 0:G.map((e=>L.getTransformNodeById(e))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Yg:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};P.assetsContext=v}for(const U in e._userVariables){const d=p(U,e._userVariables,P.assetsContext,L);P.userVariables[U]=d}for(const U in e._connectionValues){const d=p(U,e._connectionValues,P.assetsContext,L);P._setConnectionValueByKey(U,d)}return P}function xv(e,d,v){const P={},p=d.valueParseFunction??Cv.e;if(e.config)for(const B in e.config)P[B]=p(B,e.config,d.assetsContainer||d.fd,d.fd);if((0,Cv.k)(e.className)){if(!d.pathConverter)throw new Error("Path converter is required for this block");P.pathConverter=d.pathConverter}const L=new v(P);L.uniqueId=e.uniqueId;for(let B=0;B<e.dataInputs.length;B++){const d=L.getDataInput(e.dataInputs[B].name);if(!d)throw new Error("Could not find data input with name "+e.dataInputs[B].name+" in block "+e.className);d.deserialize(e.dataInputs[B])}for(let B=0;B<e.dataOutputs.length;B++){const d=L.getDataOutput(e.dataOutputs[B].name);if(!d)throw new Error("Could not find data output with name "+e.dataOutputs[B].name+" in block "+e.className);d.deserialize(e.dataOutputs[B])}return L.metadata=e.metadata,L.deserialize&&L.deserialize(e),L}function iv(e){const[d,v]=e.split(":");return mP({op:d,extension:v})}function mP(e){var d;let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const P=e.extension?null===(d=Zv[e.extension])||void 0===d?void 0:d[e.op]:fv[e.op];if(!P&&(G.c.Warn(`No mapping found for operation ${e.op} and extension ${e.extension||"KHR_interactivity"}`),v)){const d={},v={flows:{}};if(e.inputValueSockets){d.values={};for(const v in e.inputValueSockets)d.values[v]={name:v}}return e.outputValueSockets&&(v.values={},Object.keys(e.outputValueSockets).forEach((e=>{v.values[e]={name:e}}))),{FV:[],inputs:d,outputs:v}}return P}function rv(e,d,v){Zv[d]||(Zv[d]={}),Zv[d][e]=v}const Zv={BABYLON:{"flow/log":{FV:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},fv={"event/onStart":{FV:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{FV:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{FV:["FlowGraphSendCustomEventBlock"],extraProcessor(e,d,v,P,p){if("event/send"!==d.op||!e.configuration||1!==Object.keys(e.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const L=e.configuration.event.value[0];if("number"!==typeof L)throw new Error("Event id should be a number");const B=P.arrays.events[L],X=p[0];return X.config||(X.config={}),X.config.eventId=B.eventId,X.config.eventData=B.eventData,p}},"event/receive":{FV:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(e,d){var v;if(!e.configuration)return G.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const P=e.configuration.event;if(!P)return G.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const p=P.value[0];if("number"!==typeof p)return G.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(v=d.events)||void 0===v?void 0:v[p])?{valid:!0}:(G.c.Error(`Event with id ${p} not found`),{valid:!1,error:`Event with id ${p} not found`})},extraProcessor(e,d,v,P,p){if("event/receive"!==d.op||!e.configuration||1!==Object.keys(e.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const L=e.configuration.event.value[0];if("number"!==typeof L)throw new Error("Event id should be a number");const B=P.arrays.events[L],X=p[0];return X.config||(X.config={}),X.config.eventId=B.eventId,X.config.eventData=B.eventData,p}},"math/e":Tv("FlowGraphEBlock"),"math/pi":Tv("FlowGraphPIBlock"),"math/inf":Tv("FlowGraphInfBlock"),"math/nan":Tv("FlowGraphNaNBlock"),"math/abs":Tv("FlowGraphAbsBlock"),"math/sign":Tv("FlowGraphSignBlock"),"math/trunc":Tv("FlowGraphTruncBlock"),"math/floor":Tv("FlowGraphFloorBlock"),"math/ceil":Tv("FlowGraphCeilBlock"),"math/round":{FV:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p){var L;return(L=p[0]).config||(L.config={}),p[0].config.roundHalfAwayFromZero=!0,p}},"math/fract":Tv("FlowGraphFractBlock"),"math/neg":Tv("FlowGraphNegationBlock"),"math/add":Tv("FlowGraphAddBlock",["a","b"],!0),"math/sub":Tv("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{FV:["FlowGraphMultiplyBlock"],extraProcessor(e,d,v,P,p){var L;(L=p[0]).config||(L.config={}),p[0].config.useMatrixPerComponent=!0,p[0].config.preventIntegerFloatArithmetic=!0;let B=-1;return Object.keys(e.values||{}).find((d=>{var v;return void 0!==(null===(v=e.values)||void 0===v?void 0:v[d].type)&&(B=e.values[d].type,!0)})),-1!==B&&(p[0].config.type=P.arrays.types[B].flowGraphType),p},validation:e=>e.values?Sv(e):{valid:!0}},"math/div":Tv("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Tv("FlowGraphModuloBlock",["a","b"]),"math/min":Tv("FlowGraphMinBlock",["a","b"]),"math/max":Tv("FlowGraphMaxBlock",["a","b"]),"math/clamp":Tv("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Tv("FlowGraphSaturateBlock"),"math/mix":Tv("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Tv("FlowGraphEqualityBlock",["a","b"]),"math/lt":Tv("FlowGraphLessThanBlock",["a","b"]),"math/le":Tv("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Tv("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Tv("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Tv("FlowGraphIsNaNBlock"),"math/isinf":Tv("FlowGraphIsInfBlock"),"math/select":{FV:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{FV:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Tv("FlowGraphSinBlock"),"math/cos":Tv("FlowGraphCosBlock"),"math/tan":Tv("FlowGraphTanBlock"),"math/asin":Tv("FlowGraphASinBlock"),"math/acos":Tv("FlowGraphACosBlock"),"math/atan":Tv("FlowGraphATanBlock"),"math/atan2":Tv("FlowGraphATan2Block",["a","b"]),"math/sinh":Tv("FlowGraphSinhBlock"),"math/cosh":Tv("FlowGraphCoshBlock"),"math/tanh":Tv("FlowGraphTanhBlock"),"math/asinh":Tv("FlowGraphASinhBlock"),"math/acosh":Tv("FlowGraphACoshBlock"),"math/atanh":Tv("FlowGraphATanhBlock"),"math/exp":Tv("FlowGraphExponentialBlock"),"math/log":Tv("FlowGraphLogBlock"),"math/log2":Tv("FlowGraphLog2Block"),"math/log10":Tv("FlowGraphLog10Block"),"math/sqrt":Tv("FlowGraphSquareRootBlock"),"math/cbrt":Tv("FlowGraphCubeRootBlock"),"math/pow":Tv("FlowGraphPowerBlock",["a","b"]),"math/length":Tv("FlowGraphLengthBlock"),"math/normalize":Tv("FlowGraphNormalizeBlock"),"math/dot":Tv("FlowGraphDotBlock",["a","b"]),"math/cross":Tv("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Tv("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Tv("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{FV:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{FV:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{FV:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{FV:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{FV:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{FV:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{FV:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Tv("FlowGraphTransposeBlock"),"math/determinant":Tv("FlowGraphDeterminantBlock"),"math/inverse":Tv("FlowGraphInvertMatrixBlock"),"math/matmul":Tv("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{FV:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"tv",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p,L){const B=p[0].dataInputs.find((e=>"rotationQuaternion"===e.name));if(!B)throw new Error("Rotation quaternion input not found");return L._connectionValues[B.uniqueId]&&(L._connectionValues[B.uniqueId].type="Quaternion"),p}},"math/matDecompose":{FV:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"tv"}}}},"math/quatConjugate":Tv("FlowGraphConjugateBlock",["a"]),"math/quatMul":{FV:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p){var L;return(L=p[0]).config||(L.config={}),p[0].config.type="Quaternion",p}},"math/quatAngleBetween":Tv("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{FV:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Tv("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Tv("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{FV:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p){var L;return(L=p[0]).config||(L.config={}),p[0].config.inputIsColumnMajor=!0,p}},"math/extract2x2":{FV:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{FV:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p){var L;return(L=p[0]).config||(L.config={}),p[0].config.inputIsColumnMajor=!0,p}},"math/extract3x3":{FV:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{FV:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p){var L;return(L=p[0]).config||(L.config={}),p[0].config.inputIsColumnMajor=!0,p}},"math/extract4x4":{FV:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{FV:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p,L){var B,X;(X=p[0]).config||(X.config={});const z=p[0].dataInputs[0];return p[0].config.valueType=(null===(B=L._connectionValues[z.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",p}},"math/and":{FV:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p,L){var B,X,z;(z=p[0]).config||(z.config={});const W=p[0].dataInputs[0],V=p[0].dataInputs[1];return p[0].config.valueType=(null===(B=L._connectionValues[W.uniqueId])||void 0===B?void 0:B.type)??(null===(X=L._connectionValues[V.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",p}},"math/or":{FV:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p,L){var B,X,z;(z=p[0]).config||(z.config={});const W=p[0].dataInputs[0],V=p[0].dataInputs[1];return p[0].config.valueType=(null===(B=L._connectionValues[W.uniqueId])||void 0===B?void 0:B.type)??(null===(X=L._connectionValues[V.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",p}},"math/xor":{FV:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,d,v,P,p,L){var B,X,z;(z=p[0]).config||(z.config={});const W=p[0].dataInputs[0],V=p[0].dataInputs[1];return p[0].config.valueType=(null===(B=L._connectionValues[W.uniqueId])||void 0===B?void 0:B.type)??(null===(X=L._connectionValues[V.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",p}},"math/asr":Tv("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Tv("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Tv("FlowGraphLeadingZerosBlock"),"math/ctz":Tv("FlowGraphTrailingZerosBlock"),"math/popcnt":Tv("FlowGraphOneBitsCounterBlock"),"math/rad":Tv("FlowGraphDegToRadBlock"),"math/deg":Tv("FlowGraphRadToDegBlock"),"type/boolToInt":Tv("FlowGraphBooleanToInt"),"type/boolToFloat":Tv("FlowGraphBooleanToFloat"),"type/intToBool":Tv("FlowGraphIntToBoolean"),"type/intToFloat":Tv("FlowGraphIntToFloat"),"type/floatToInt":Tv("FlowGraphFloatToInt"),"type/floatToBool":Tv("FlowGraphFloatToBoolean"),"flow/sequence":{FV:["FlowGraphSequenceBlock"],extraProcessor(e,d,v,P,p){const L=p[0];return L.config||(L.config={}),L.config.outputSignalCount=Object.keys(e.flows||[]).length,L.signalOutputs.forEach(((e,d)=>{e.name="out_"+d})),p}},"flow/branch":{FV:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{FV:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(e){if(e.configuration&&e.configuration.cases){const d=e.configuration.cases.value;if(!d.every((e=>"number"===typeof e&&/^-?\d+$/.test(e.toString()))))return G.c.Warn("Switch cases should be integers. Using empty array instead."),e.configuration.cases.value=[],{valid:!0};const v=new Set(d);e.configuration.cases.value=Array.from(v)}return{valid:!0}},extraProcessor(e,d,v,P,p){if("flow/switch"!==d.op||!e.flows||0===Object.keys(e.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return p[0].signalOutputs.forEach((e=>{"default"!==e.name&&(e.name="out_"+e.name)})),p}},"flow/while":{FV:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{FV:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(e,d,v,P,p){const L=p[0];return L.config||(L.config={}),L.config.incrementIndexWhenLoopDone=!0,p}},"flow/doN":{FV:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{FV:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(e,d,v,P,p){if("flow/multiGate"!==d.op||!e.flows||0===Object.keys(e.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const L=p[0];return L.config||(L.config={}),L.config.outputSignalCount=Object.keys(e.flows).length,L.signalOutputs.forEach(((e,d)=>{e.name="out_"+d})),p}},"flow/waitAll":{FV:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(e){var d,v;return"number"!==typeof(null===(d=e.configuration)||void 0===d||null===(v=d.inputFlows)||void 0===v?void 0:v.value[0])&&(e.configuration=e.configuration||{inputFlows:{value:[0]}},e.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{FV:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{FV:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{FV:["FlowGraphCancelDelayBlock"]},"variable/get":{FV:["FlowGraphGetVariableBlock"],validation(e){var d,v;return null!==(d=e.configuration)&&void 0!==d&&null!==(v=d.variable)&&void 0!==v&&v.value?{valid:!0}:(G.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(e,d)=>[d.getVariableName(e[0])]}}},"variable/set":{FV:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(e,d)=>[d.getVariableName(e[0])]}}},"variable/setMultiple":{FV:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(e,d)=>[e[0].map((e=>d.getVariableName(e)))]}},extraProcessor:(e,d,v,P,p)=>(p[0].dataInputs.forEach((e=>{e.name=P.getVariableName(+e.name)})),p)},"variable/interpolate":{FV:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(e,d)=>[d.getVariableName(e[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:e=>!0===e[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",cv:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",cv:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",cv:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",cv:"FlowGraphPlayAnimationBlock"},out:{name:"out",cv:"FlowGraphPlayAnimationBlock"},done:{name:"done",cv:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(e,d,v,P,p){var L,B,X;const z=p[0],W=null===(L=e.configuration)||void 0===L?void 0:L.variable.value[0];if("number"!==typeof W)throw G.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const V=P.arrays.staticVariables[W];"undefined"===typeof z.config.animationType.value&&(P.arrays.staticVariables,z.config.animationType.value=(0,qv.A)(V.type));const k=p[4];return k.config||(k.config={}),(B=k.config).variable||(B.variable={}),k.config.variable.value=P.getVariableName(W),(X=p[3]).config||(X.config={}),p}},"pointer/get":{FV:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",cv:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",cv:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,d,v,P,p)=>(p.forEach((e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)})),p)},"pointer/set":{FV:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",cv:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",cv:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,d,v,P,p)=>(p.forEach((e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)})),p)},"pointer/interpolate":{FV:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",cv:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",cv:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",cv:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",cv:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",cv:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",cv:"FlowGraphPlayAnimationBlock"},out:{name:"out",cv:"FlowGraphPlayAnimationBlock"},done:{name:"done",cv:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,d,v,P,p)=>(p.forEach((d=>{"FlowGraphJsonPointerParserBlock"===d.className?(d.config||(d.config={}),d.config.outputValue=!0):"FlowGraphInterpolationBlock"===d.className&&(d.config||(d.config={}),Object.keys(e.values||[]).forEach((v=>{var p;const L=null===(p=e.values)||void 0===p?void 0:p[v];if("value"===v&&L){const e=L.type;void 0!==e&&(d.config.animationType=P.arrays.types[e].flowGraphType)}})))})),p)},"animation/start":{FV:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",cv:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(e,d)=>[e[0]*d._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(e,d)=>[e[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,d,v,P,p,L,B){const X=p[p.length-1];return X.config||(X.config={}),X.config.glTF=B,p}},"animation/stop":{FV:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",cv:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,d,v,P,p,L,B){const X=p[p.length-1];return X.config||(X.config={}),X.config.glTF=B,p}},"animation/stopAt":{FV:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",cv:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(e,d)=>[e[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,d,v,P,p,L,B){const X=p[p.length-1];return X.config||(X.config={}),X.config.glTF=B,p}},"math/switch":{FV:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(e){if(e.configuration&&e.configuration.cases){const d=e.configuration.cases.value;if(!d.every((e=>"number"===typeof e&&/^-?\d+$/.test(e.toString()))))return G.c.Warn("Switch cases should be integers. Using empty array instead."),e.configuration.cases.value=[],{valid:!0};const v=new Set(d);e.configuration.cases.value=Array.from(v)}return{valid:!0}},extraProcessor(e,d,v,P,p){const L=p[0];return L.dataInputs.forEach((e=>{"default"!==e.name&&"case"!==e.name&&(e.name="in_"+e.name)})),L.config||(L.config={}),L.config.treatCasesAsIntegers=!0,p}},"debug/log":{FV:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Tv(e){let d=arguments.length>2?arguments[2]:void 0;return{FV:[e],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((e,d)=>(e[d]={name:d},e)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(e,v,P,p,L){var B;if(d){(B=L[0]).config||(B.config={}),L[0].config.preventIntegerFloatArithmetic=!0;let d=-1;Object.keys(e.values||{}).find((v=>{var P;return void 0!==(null===(P=e.values)||void 0===P?void 0:P[v].type)&&(d=e.values[v].type,!0)})),-1!==d&&(L[0].config.type=p.arrays.types[d].flowGraphType)}return L},validation:e=>d?Sv(e):{valid:!0}}}function Sv(e){if(e.values){const d=Object.keys(e.values).map((d=>e.values[d].type)).filter((e=>void 0!==e));if(!d.every((e=>e===d[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}fv["math/compose"]=fv["math/matCompose"],fv["math/decompose"]=fv["math/matDecompose"];var ov=v(12384);const Kv={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"mv",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Qv{constructor(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=e,this._gltf=d,this._animationTargetFps=v,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const e of this._interactivityGraph.types)this._types.push(Kv[e.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const e of this._interactivityGraph.declarations){const d=mP(e);if(!d)throw G.c.Error(["No mapping found for declaration",e]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:d,fullOperationName:e.extension?e.op+":"+e.extension:e.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const e of this._interactivityGraph.variables){const d=this._parseVariable(e);this._staticVariables.push(d)}}_parseVariable(e,d){const v=this._types[e.type];if(!v)throw G.c.Error(["No type found for variable",e]),new Error("Error parsing variables");if(e.value&&e.value.length!==v.length)throw G.c.Error(["Invalid value length for variable",e,v]),new Error("Error parsing variables");const P=e.value||[];if(!P.length)switch(v.flowGraphType){case"boolean":P.push(!1);break;case"FlowGraphInteger":P.push(0);break;case"number":P.push(NaN);break;case"Vector2":P.push(NaN,NaN);break;case"mv":P.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":P.fill(NaN,0,4);break;case"Matrix":P.fill(NaN,0,16);break;case"Matrix3D":P.fill(NaN,0,9)}return"number"===v.elementType&&"string"===typeof P[0]&&(P[0]=parseFloat(P[0])),{type:v.flowGraphType,value:d?d(P,this):P}}_parseEvents(){if(this._interactivityGraph.events)for(const e of this._interactivityGraph.events){const d={eventId:e.id||"internalEvent_"+this._internalEventsCounter++};e.values&&(d.eventData=Object.keys(e.values).map((d=>{var v;const P=null===(v=e.values)||void 0===v?void 0:v[d];if(!P)throw G.c.Error(["No value found for event key",d]),new Error("Error parsing events");const p=this._types[P.type];if(!p)throw G.c.Error(["No type found for event value",P]),new Error("Error parsing events");const L="undefined"!==typeof P.value?this._parseVariable(P):void 0;return{id:d,type:p.flowGraphType,eventData:!0,value:L}}))),this._events.push(d)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const d of this._interactivityGraph.nodes){if("number"!==typeof d.declaration)throw G.c.Error(["No declaration found for node",d]),new Error("Error parsing nodes");const v=this._mappings[d.declaration];if(!v)throw G.c.Error(["No mapping found for node",d]),new Error("Error parsing nodes");if(v.flowGraphMapping.validation){const P=v.flowGraphMapping.validation(d,this._interactivityGraph,this._gltf);var e;if(!P.valid)throw new Error(`Error validating interactivity node ${null===(e=this._interactivityGraph.declarations)||void 0===e?void 0:e[d.declaration].op} - ${P.error}`)}const P=[];for(const e of v.flowGraphMapping.FV){const p=this._getEmptyBlock(e,v.fullOperationName);this._parseNodeConfiguration(d,p,v.flowGraphMapping,e),P.push(p)}this._nodes.push({FV:P,fullOperationName:v.fullOperationName})}}_getEmptyBlock(e,d){return{uniqueId:(0,ov.b)(),className:e,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:d,metadata:{}}}_parseNodeConfiguration(e,d,v,P){const p=d.config;if(e.configuration){const d=Object.keys(e.configuration);for(const X of d){var L,B;const d=null===(L=e.configuration)||void 0===L?void 0:L[X];if(!d)throw G.c.Error(["No value found for node configuration",X]),new Error("Error parsing node configuration");const z=null===(B=v.configuration)||void 0===B?void 0:B[X];if(z&&z.cv?z.cv===P:0===v.FV.indexOf(P)){const e=(null===z||void 0===z?void 0:z.name)||X;d&&"undefined"!==typeof d.value||"undefined"===typeof(null===z||void 0===z?void 0:z.defaultValue)?d.value.length>=0?p[e]={value:1===d.value.length?d.value[0]:d.value}:G.c.Warn(["Invalid value for node configuration",d]):p[e]={value:z.defaultValue},z&&z.dataTransformer&&(p[e].value=z.dataTransformer([p[e].value],this)[0])}}}}_parseNodeConnections(e){for(let n=0;n<this._nodes.length;n++){var d;const A=null===(d=this._interactivityGraph.nodes)||void 0===d?void 0:d[n];if(!A)throw G.c.Error(["No node found for interactivity node",this._nodes[n]]),new Error("Error parsing node connections");const x=this._nodes[n],i=this._mappings[A.declaration];if(!i)throw G.c.Error(["No mapping found for node",A]),new Error("Error parsing node connections");const me=A.flows||{},r=Object.keys(me).sort();for(const e of r){var v,P,p,L;const d=me[e],W=null===(v=i.flowGraphMapping.outputs)||void 0===v||null===(P=v.flows)||void 0===P?void 0:P[e],V=(null===W||void 0===W?void 0:W.name)||e,k=this._createNewSocketConnection(V,!0);(W&&W.cv&&x.FV.find((e=>e.className===W.cv))||x.FV[0]).signalOutputs.push(k);const g=d.node,F=this._nodes[g];if(!F)throw G.c.Error(["No node found for input node id",g]),new Error("Error parsing node connections");const w=iv(F.fullOperationName);if(!w)throw G.c.Error(["No mapping found for input node",F]),new Error("Error parsing node connections");let U=null===(p=w.inputs)||void 0===p||null===(L=p.flows)||void 0===L?void 0:L[d.socket||"in"],D=!1;if(!U)for(const e in null===(B=w.inputs)||void 0===B?void 0:B.flows){var B,X,z;if(e.startsWith("[")&&e.endsWith("]"))D=!0,U=null===(X=w.inputs)||void 0===X||null===(z=X.flows)||void 0===z?void 0:z[e]}const C=U?D?U.name.replace("$1",d.socket||""):U.name:d.socket||"in",q=U&&U.cv&&F.FV.find((e=>e.className===U.cv))||F.FV[0];let h=q.signalInputs.find((e=>e.name===C));h||(h=this._createNewSocketConnection(C),q.signalInputs.push(h)),h.connectedPointIds.push(k.uniqueId),k.connectedPointIds.push(h.uniqueId)}const Z=A.values||{},f=Object.keys(Z);for(const d of f){var W,V;const v=Z[d];let P=null===(W=i.flowGraphMapping.inputs)||void 0===W||null===(V=W.values)||void 0===V?void 0:V[d],p=!1;if(!P)for(const e in null===(k=i.flowGraphMapping.inputs)||void 0===k?void 0:k.values){var k,g,F;if(e.startsWith("[")&&e.endsWith("]"))p=!0,P=null===(g=i.flowGraphMapping.inputs)||void 0===g||null===(F=g.values)||void 0===F?void 0:F[e]}const L=P?p?P.name.replace("$1",d):P.name:d,B=this._createNewSocketConnection(L);if((P&&P.cv&&x.FV.find((e=>e.className===P.cv))||x.FV[0]).dataInputs.push(B),void 0!==v.value){const d=this._parseVariable(v,P&&P.dataTransformer);e._connectionValues[B.uniqueId]=d}else{if("undefined"===typeof v.node)throw G.c.Error(["Invalid value for value connection",v]),new Error("Error parsing node connections");{var w,U,D;const e=v.node,d=v.socket||"value",P=this._nodes[e];if(!P)throw G.c.Error(["No node found for output socket reference",v]),new Error("Error parsing node connections");const p=iv(P.fullOperationName);if(!p)throw G.c.Error(["No mapping found for output socket reference",v]),new Error("Error parsing node connections");let L=null===(w=p.outputs)||void 0===w||null===(U=w.values)||void 0===U?void 0:U[d],X=!1;if(!L)for(const v in null===(C=p.outputs)||void 0===C?void 0:C.values){var C,q,h;if(v.startsWith("[")&&v.endsWith("]"))X=!0,L=null===(q=p.outputs)||void 0===q||null===(h=q.values)||void 0===h?void 0:h[v]}const z=L?X?L.name.replace("$1",d):null===(D=L)||void 0===D?void 0:D.name:d,W=L&&L.cv&&P.FV.find((e=>e.className===L.cv))||P.FV[0];let V=W.dataOutputs.find((e=>e.name===z));V||(V=this._createNewSocketConnection(z,!0),W.dataOutputs.push(V)),B.connectedPointIds.push(V.uniqueId),V.connectedPointIds.push(B.uniqueId)}}}if(i.flowGraphMapping.interBlockConnectors)for(const e of i.flowGraphMapping.interBlockConnectors){const d=e.input,v=e.output,P=e.isVariable;this._connectFlowGraphNodes(d,v,x.FV[e.inputBlockIndex],x.FV[e.outputBlockIndex],P)}if(i.flowGraphMapping.extraProcessor){var l;const d=null===(l=this._interactivityGraph.declarations)||void 0===l?void 0:l[A.declaration];if(!d)throw G.c.Error(["No declaration found for extra processor",A]),new Error("Error parsing node connections");x.FV=i.flowGraphMapping.extraProcessor(A,d,i.flowGraphMapping,this,x.FV,e,this._gltf)}}}_createNewSocketConnection(e,d){return{uniqueId:(0,ov.b)(),name:e,_connectionType:d?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(e,d,v,P,p){const L=p?v.dataInputs:v.signalInputs,B=p?P.dataOutputs:P.signalOutputs,X=L.find((d=>d.name===e))||this._createNewSocketConnection(e),z=B.find((e=>e.name===d))||this._createNewSocketConnection(d,!0);L.find((d=>d.name===e))||L.push(X),B.find((e=>e.name===d))||B.push(z),X.connectedPointIds.push(z.uniqueId),z.connectedPointIds.push(X.uniqueId)}getVariableName(e){return"staticVariable_"+e}serializeToFlowGraph(){const e={uniqueId:(0,ov.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(e);for(let d=0;d<this._staticVariables.length;d++){const v=this._staticVariables[d];e._userVariables[this.getVariableName(d)]=v}return{rightHanded:!0,allBlocks:this._nodes.reduce(((e,d)=>e.concat(d.FV)),[]),executionContexts:[e]}}}const Nv="KHR_interactivity";class uv{constructor(e){this._loader=e,this.name=Nv,this.enabled=this._loader.isExtensionUsed(Nv),this._pathConverter=(0,O.j)(this._loader.rd),e._skipStartAnimationStep=!0;const d=e.babylonScene;d&&function(e){(0,O.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!e.activeCamera)return new p.Quaternion(NaN,NaN,NaN,NaN);const d=p.Quaternion.FromRotationMatrix(e.activeCamera.getWorldMatrix()).normalize();return e.useRightHandedSystem||(d.w*=-1,d.x*=-1),d},type:"Quaternion",getTarget:()=>e.activeCamera}),(0,O.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!e.activeCamera)return new p.mv(NaN,NaN,NaN);const d=e.activeCamera.getWorldMatrix().getTranslation();return e.useRightHandedSystem||(d.x*=-1),d},type:"mv",getTarget:()=>e.activeCamera}),(0,O.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:e=>{var d;return(null===(d=e._babylonAnimationGroup)||void 0===d?void 0:d.isPlaying)??!1},type:"boolean",getTarget:e=>e._babylonAnimationGroup}),(0,O.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:e=>{var d;return((null===(d=e._babylonAnimationGroup)||void 0===d?void 0:d.from)??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,O.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:e=>{var d;return((null===(d=e._babylonAnimationGroup)||void 0===d?void 0:d.to)??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,O.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:e=>{var d;return((null===(d=e._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,O.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:e=>{var d;return((null===(d=e._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup})}(d)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var e;if(!this._loader.babylonScene||!this._pathConverter)return;const d=this._loader.babylonScene,v=null===(e=this._loader.rd.extensions)||void 0===e?void 0:e.KHR_interactivity;if(!v)return;const P=new wv.b({fd:d});P.dispatchEventsSynchronously=!1;const p=v.graphs.map((e=>new Qv(e,this._loader.rd,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(p.map((async e=>await nv(e,{coordinator:P,pathConverter:this._pathConverter})))),P.start()}}var Ov;Ov=async()=>(await Promise.resolve().then(v.bind(v,14223))).FlowGraphGLTFDataProvider,Gv[`${Nv}/${"FlowGraphGLTFDataProvider"}`]=Ov,u(Nv),N(Nv,!0,(e=>new uv(e)));const Rv="KHR_node_visibility";(0,O.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:e=>{const d=e._babylonTransformNode;return!d||void 0===d.isVisible||d.isVisible},set:(e,d)=>{var v,P;null===(v=d._primitiveBabylonMeshes)||void 0===v||v.forEach((e=>{e.inheritVisibility=!0})),d._babylonTransformNode&&(d._babylonTransformNode.isVisible=e),null===(P=d._primitiveBabylonMeshes)||void 0===P||P.forEach((d=>{d.isVisible=e}))},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Yv{constructor(e){this.name=Rv,this._loader=e,this.enabled=e.isExtensionUsed(Rv)}async onReady(){var e;null===(e=this._loader.rd.nodes)||void 0===e||e.forEach((e=>{var d,v,P,p;(null===(d=e._primitiveBabylonMeshes)||void 0===d||d.forEach((e=>{e.inheritVisibility=!0})),null!==(v=e.extensions)&&void 0!==v&&v.KHR_node_visibility)&&(!1===(null===(P=e.extensions)||void 0===P?void 0:P.KHR_node_visibility.visible)&&(e._babylonTransformNode&&(e._babylonTransformNode.isVisible=!1),null===(p=e._primitiveBabylonMeshes)||void 0===p||p.forEach((e=>{e.isVisible=!1}))))}))}dispose(){this._loader=null}}u(Rv),N(Rv,!0,(e=>new Yv(e)));const Hv="KHR_node_selectability";rv("event/onSelect",Hv,{FV:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",cv:"FlowGraphGetVariableBlock",dataTransformer:e=>["pickedMesh_"+e[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",cv:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,d,v,P,p,L,B){var X,z,W,V,k,g;const F=p[p.length-1];F.config=F.config||{},F.config.glTF=B;const w=null===(X=e.configuration)||void 0===X||null===(z=X.nodeIndex)||void 0===z?void 0:z.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const G="pickedMesh_"+w;return p[1].config.variable=G,L._userVariables[G]={className:"Mesh",id:null===B||void 0===B||null===(W=B.nodes)||void 0===W||null===(V=W[w]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===B||void 0===B||null===(k=B.nodes)||void 0===k||null===(g=k[w]._babylonTransformNode)||void 0===g?void 0:g.uniqueId},p}}),(0,O.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:e=>{const d=e._babylonTransformNode;return!d||void 0===d.Nz||d.Nz},set:(e,d)=>{var v;null===(v=d._primitiveBabylonMeshes)||void 0===v||v.forEach((d=>{d.Nz=e}))},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"Nz"],type:"boolean"});class av{constructor(e){this.name=Hv,this._loader=e,this.enabled=e.isExtensionUsed(Hv)}async onReady(){var e;null===(e=this._loader.rd.nodes)||void 0===e||e.forEach((e=>{var d,v,P;null!==(d=e.extensions)&&void 0!==d&&d.KHR_node_selectability&&!1===(null===(v=e.extensions)||void 0===v?void 0:v.KHR_node_selectability.selectable)&&(null===(P=e._babylonTransformNode)||void 0===P||P.getChildMeshes().forEach((e=>{e.Nz=!1})))}))}dispose(){this._loader=null}}u(Hv),N(Hv,!0,(e=>new av(e)));const tv="KHR_node_hoverability",Iv="targetMeshPointerOver_";rv("event/onHoverIn",tv,{FV:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",cv:"FlowGraphGetVariableBlock",dataTransformer:e=>[Iv+e[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",cv:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,d,v,P,p,L,B){var X,z,W,V,k,g;const F=p[p.length-1];F.config=F.config||{},F.config.glTF=B;const w=null===(X=e.configuration)||void 0===X||null===(z=X.nodeIndex)||void 0===z?void 0:z.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const G=Iv+w;return p[1].config.variable=G,L._userVariables[G]={className:"Mesh",id:null===B||void 0===B||null===(W=B.nodes)||void 0===W||null===(V=W[w]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===B||void 0===B||null===(k=B.nodes)||void 0===k||null===(g=k[w]._babylonTransformNode)||void 0===g?void 0:g.uniqueId},p}});const cv="targetMeshPointerOut_";rv("event/onHoverOut",tv,{FV:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",cv:"FlowGraphGetVariableBlock",dataTransformer:e=>[cv+e[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",cv:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,d,v,P,p,L,B){var X,z,W,V,k,g;const F=p[p.length-1];F.config=F.config||{},F.config.glTF=B;const w=null===(X=e.configuration)||void 0===X||null===(z=X.nodeIndex)||void 0===z?void 0:z.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const G=cv+w;return p[1].config.variable=G,L._userVariables[G]={className:"Mesh",id:null===B||void 0===B||null===(W=B.nodes)||void 0===W||null===(V=W[w]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===B||void 0===B||null===(k=B.nodes)||void 0===k||null===(g=k[w]._babylonTransformNode)||void 0===g?void 0:g.uniqueId},p}}),(0,O.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:e=>{const d=e._babylonTransformNode;return!d||void 0===d.pointerOverDisableMeshTesting||d.pointerOverDisableMeshTesting},set:(e,d)=>{var v;null===(v=d._primitiveBabylonMeshes)||void 0===v||v.forEach((d=>{d.pointerOverDisableMeshTesting=!e}))},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class bv{constructor(e){this.name=tv,this._loader=e,this.enabled=e.isExtensionUsed(tv)}async onReady(){var e;null===(e=this._loader.rd.nodes)||void 0===e||e.forEach((e=>{var d,v,P;null!==(d=e.extensions)&&void 0!==d&&d.KHR_node_hoverability&&!1===(null===(v=e.extensions)||void 0===v?void 0:v.KHR_node_hoverability.hoverable)&&(null===(P=e._babylonTransformNode)||void 0===P||P.getChildMeshes().forEach((e=>{e.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}u(tv),N(tv,!0,(e=>new bv(e)));const Mv="ExtrasAsMetadata";class sv{_assignExtras(e,d){if(d.extras&&Object.keys(d.extras).length>0){const v=e.metadata=e.metadata||{};(v.rd=v.rd||{}).extras=d.extras}}constructor(e){this.name=Mv,this.enabled=!0,this._loader=e}dispose(){this._loader=null}loadNodeAsync(e,d,v){return this._loader.loadNodeAsync(e,d,(e=>{this._assignExtras(e,d),v(e)}))}loadCameraAsync(e,d,v){return this._loader.loadCameraAsync(e,d,(e=>{this._assignExtras(e,d),v(e)}))}createMaterial(e,d,v){const P=this._loader.createMaterial(e,d,v);return this._assignExtras(P,d),P}}u(Mv),N(Mv,!1,(e=>new sv(e)));v(14223)},14119:(e,d,v)=>{"use strict";v.d(d,{d:()=>S,f:()=>i,h:()=>x,j:()=>me});var P=v(12248),p=v(12240),L=v(13738),B=v(12864),X=v(12829),z=v(12839),W=v(12253),V=v(12281),k=v(12860),g=v(12962),F=v(12872),w=v(12457);class G{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.sk=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Yg=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture=e}getNodes(){let e=[];e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes);for(const d of this.skeletons)e=e.concat(d.bones);return e}}class U extends G{}class D{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const e=this.rootNodes;for(const P of e)P.dispose();e.length=0;const d=this.skeletons;for(const P of d)P.dispose();d.length=0;const v=this.animationGroups;for(const P of v)P.dispose();v.length=0}}class C extends G{constructor(e){super(),this._wasAddedToScene=!1,(e=e||V.c.LastCreatedScene)&&(this.fd=e,this.proceduralTextures=[],e.Fd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add((()=>{for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();for(const e of this.sk)e.rebuild();for(const e of this.textures)e._rebuild()})))}_topologicalSort(e){const d=new Map;for(const B of e)d.set(B.uniqueId,B);const v={dependsOn:new Map,dependedBy:new Map};for(const B of e){const e=B.uniqueId;v.dependsOn.set(e,new Set),v.dependedBy.set(e,new Set)}for(const B of e){const e=B.uniqueId,P=v.dependsOn.get(e);if(B instanceof k.e){const p=B.sourceMesh;d.has(p.uniqueId)&&(P.add(p.uniqueId),v.dependedBy.get(p.uniqueId).add(e))}const p=v.dependedBy.get(e);for(const L of B.getDescendants()){const P=L.uniqueId;if(d.has(P)){p.add(P);v.dependsOn.get(P).add(e)}}}const P=[],p=[];for(const B of e){const e=B.uniqueId;0===v.dependsOn.get(e).size&&(p.push(B),d.delete(e))}const L=p;for(;L.length>0;){const e=L.shift();P.push(e);const p=v.dependedBy.get(e.uniqueId);for(const P of Array.from(p.values())){const p=v.dependsOn.get(P);p.delete(e.uniqueId),0===p.size&&d.get(P)&&(L.push(d.get(P)),d.delete(P))}}return d.size>0&&(W.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),d.forEach((e=>{W.c.Error(e.name)}))),P}_addNodeAndDescendantsToList(e,d,v,P){if(v&&(!P||P(v))&&!d.has(v.uniqueId)){e.push(v),d.add(v.uniqueId);for(const p of v.getDescendants(!0))this._addNodeAndDescendantsToList(e,d,p,P)}}_isNodeInContainer(e){return e instanceof z.d&&-1!==this.meshes.indexOf(e)||(e instanceof X.c&&-1!==this.transformNodes.indexOf(e)||(e instanceof g.e&&-1!==this.lights.indexOf(e)||e instanceof F.c&&-1!==this.cameras.indexOf(e)))}_isValidHierarchy(){for(const e of this.meshes)if(e.parent&&!this._isNodeInContainer(e.parent))return W.c.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.transformNodes)if(e.parent&&!this._isNodeInContainer(e.parent))return W.c.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.lights)if(e.parent&&!this._isNodeInContainer(e.parent))return W.c.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.cameras)if(e.parent&&!this._isNodeInContainer(e.parent))return W.c.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||p.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const P={},L={},X=new D,z=[],W=[],V={doNotInstantiate:!0,...v},k=[],g=new Set;for(const p of this.transformNodes)null===p.parent&&this._addNodeAndDescendantsToList(k,g,p,V.predicate);for(const p of this.meshes)null===p.parent&&this._addNodeAndDescendantsToList(k,g,p,V.predicate);const F=this._topologicalSort(k),w=(v,p)=>{if(((d,v)=>{if(P[d.uniqueId]=v.uniqueId,L[v.uniqueId]=v,e&&(v.name=e(d.name)),v instanceof B.b){const e=v;if(e.morphTargetManager){const v=d.morphTargetManager;e.morphTargetManager=v.clone();for(let d=0;d<v.numTargets;d++){const p=v.getTarget(d),B=e.morphTargetManager.getTarget(d);P[p.uniqueId]=B.uniqueId,L[B.uniqueId]=B}}}})(v,p),v.parent){const e=P[v.parent.uniqueId],d=L[e];p.parent=d||v.parent}if(p.position&&v.position&&p.position.L(v.position),p.rotationQuaternion&&v.rotationQuaternion&&p.rotationQuaternion.L(v.rotationQuaternion),p.rotation&&v.rotation&&p.rotation.L(v.rotation),p.tv&&v.tv&&p.tv.L(v.tv),p.material){const B=p;if(B.material)if(d){const d=v.material;if(-1===W.indexOf(d)){let v=d.clone(e?e(d.name):"Clone of "+d.name);if(W.push(d),P[d.uniqueId]=v.uniqueId,L[v.uniqueId]=v,"MultiMaterial"===d.getClassName()){const p=d;for(const d of p.ip)d&&(v=d.clone(e?e(d.name):"Clone of "+d.name),W.push(d),P[d.uniqueId]=v.uniqueId,L[v.uniqueId]=v);p.ip=p.ip.map((e=>e&&L[P[e.uniqueId]]))}}"InstancedMesh"!==B.getClassName()&&(B.material=L[P[d.uniqueId]])}else"MultiMaterial"===B.material.getClassName()?-1===this.fd.multiMaterials.indexOf(B.material)&&this.fd.addMultiMaterial(B.material):-1===this.fd.materials.indexOf(B.material)&&this.fd.addMaterial(B.material)}null===p.parent&&X.rootNodes.push(p)};for(const p of F)if("InstancedMesh"===p.getClassName()){const e=p,d=e.sourceMesh,v=P[d.uniqueId];w(e,("number"===typeof v?L[v]:d).createInstance(e.name))}else{let e=!0;"pg"===p.getClassName()||"Node"===p.getClassName()||p.skeleton||!p.getTotalVertices||0===p.getTotalVertices()?e=!1:V.doNotInstantiate&&(e="function"===typeof V.doNotInstantiate?!V.doNotInstantiate(p):!V.doNotInstantiate);const d=e?p.createInstance(`instance of ${p.name}`):p.clone(`Clone of ${p.name}`,null,!0);if(!d)throw new Error(`Could not clone or instantiate node on Asset Container ${p.name}`);w(p,d)}for(const p of this.skeletons){if(V.predicate&&!V.predicate(p))continue;const d=p.clone(e?e(p.name):"Clone of "+p.name);for(const e of this.meshes)if(e.skeleton===p&&!e.isAnInstance){const v=L[P[e.uniqueId]];if(!v||v.isAnInstance)continue;if(v.skeleton=d,-1!==z.indexOf(d))continue;z.push(d);for(const e of d.bones)e._linkedTransformNode&&(e._linkedTransformNode=L[P[e._linkedTransformNode.uniqueId]])}X.skeletons.push(d)}for(const p of this.animationGroups){if(V.predicate&&!V.predicate(p))continue;const d=p.clone(e?e(p.name):"Clone of "+p.name,(e=>L[P[e.uniqueId]]||e));X.animationGroups.push(d)}return X}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||p.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.fd.environmentTexture=this.environmentTexture);for(const e of this.fd._serializableComponents)e.addFromContainer(this);this.fd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=[];for(const v of this.cameras)e&&!e(v)||(this.fd.addCamera(v),d.push(v));for(const v of this.lights)e&&!e(v)||(this.fd.addLight(v),d.push(v));for(const v of this.meshes)e&&!e(v)||(this.fd.dV(v),d.push(v));for(const v of this.skeletons)e&&!e(v)||this.fd.addSkeleton(v);for(const v of this.animations)e&&!e(v)||this.fd.addAnimation(v);for(const v of this.animationGroups)e&&!e(v)||this.fd.addAnimationGroup(v);for(const v of this.multiMaterials)e&&!e(v)||this.fd.addMultiMaterial(v);for(const v of this.materials)e&&!e(v)||this.fd.addMaterial(v);for(const v of this.morphTargetManagers)e&&!e(v)||this.fd.addMorphTargetManager(v);for(const v of this.geometries)e&&!e(v)||this.fd.addGeometry(v);for(const v of this.transformNodes)e&&!e(v)||(this.fd.addTransformNode(v),d.push(v));for(const v of this.actionManagers)e&&!e(v)||this.fd.addActionManager(v);for(const v of this.textures)e&&!e(v)||this.fd.addTexture(v);for(const v of this.reflectionProbes)e&&!e(v)||this.fd.addReflectionProbe(v);for(const v of d)v.parent&&-1===this.fd.getNodes().indexOf(v.parent)&&(v.setParent?v.setParent(null):v.parent=null)}removeAllFromScene(){this._isValidHierarchy()||p.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.fd.environmentTexture&&(this.fd.environmentTexture=null);for(const e of this.fd._serializableComponents)e.removeFromContainer(this)}removeFromScene(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const d of this.cameras)e&&!e(d)||this.fd.removeCamera(d);for(const d of this.lights)e&&!e(d)||this.fd.removeLight(d);for(const d of this.meshes)e&&!e(d)||this.fd.eV(d,!0);for(const d of this.skeletons)e&&!e(d)||this.fd.removeSkeleton(d);for(const d of this.animations)e&&!e(d)||this.fd.removeAnimation(d);for(const d of this.animationGroups)e&&!e(d)||this.fd.removeAnimationGroup(d);for(const d of this.multiMaterials)e&&!e(d)||this.fd.removeMultiMaterial(d);for(const d of this.materials)e&&!e(d)||this.fd.removeMaterial(d);for(const d of this.morphTargetManagers)e&&!e(d)||this.fd.removeMorphTargetManager(d);for(const d of this.geometries)e&&!e(d)||this.fd.removeGeometry(d);for(const d of this.transformNodes)e&&!e(d)||this.fd.removeTransformNode(d);for(const d of this.actionManagers)e&&!e(d)||this.fd.removeActionManager(d);for(const d of this.textures)e&&!e(d)||this.fd.removeTexture(d);for(const d of this.reflectionProbes)e&&!e(d)||this.fd.removeReflectionProbe(d)}dispose(){const e=this.cameras.slice(0);for(const F of e)F.dispose();this.cameras.length=0;const d=this.lights.slice(0);for(const F of d)F.dispose();this.lights.length=0;const v=this.meshes.slice(0);for(const F of v)F.dispose();this.meshes.length=0;const P=this.skeletons.slice(0);for(const F of P)F.dispose();this.skeletons.length=0;const p=this.animationGroups.slice(0);for(const F of p)F.dispose();this.animationGroups.length=0;const L=this.multiMaterials.slice(0);for(const F of L)F.dispose();this.multiMaterials.length=0;const B=this.materials.slice(0);for(const F of B)F.dispose();this.materials.length=0;const X=this.geometries.slice(0);for(const F of X)F.dispose();this.geometries.length=0;const z=this.transformNodes.slice(0);for(const F of z)F.dispose();this.transformNodes.length=0;const W=this.actionManagers.slice(0);for(const F of W)F.dispose();this.actionManagers.length=0;const V=this.textures.slice(0);for(const F of V)F.dispose();this.textures.length=0;const k=this.reflectionProbes.slice(0);for(const F of k)F.dispose();this.reflectionProbes.length=0;const g=this.morphTargetManagers.slice(0);for(const F of g)F.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const F of this.fd._serializableComponents)F.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.fd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(e,d,v){if(e&&d)for(const P of e){let e=!0;if(v)for(const d of v)if(P===d){e=!1;break}e&&(d.push(P),P._parentContainer=this)}}moveAllFromScene(e){this._wasAddedToScene=!1,void 0===e&&(e=new U);for(const d in this)Object.prototype.hasOwnProperty.call(this,d)&&(this[d]=this[d]||("_environmentTexture"===d?null:[]),this._moveAssets(this.fd[d],this[d],e[d]));this.environmentTexture=this.fd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const e=new B.b("assetContainerRootMesh",this.fd);for(const d of this.meshes)d.parent||e.addChild(d);return this.meshes.unshift(e),e}mergeAnimationsTo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.c.LastCreatedScene,d=arguments.length>1?arguments[1]:void 0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return W.c.Error("No scene available to merge animations to"),[];const P=v||(d=>{let v=null;const P=d.animations.length?d.animations[0].targetProperty:"",p=d.name.split(".").join("").split("_primitive")[0];switch(P){case"position":case"rotationQuaternion":v=e.getTransformNodeByName(d.name)||e.getTransformNodeByName(p);break;case"influence":v=e.getMorphTargetByName(d.name)||e.getMorphTargetByName(p);break;default:v=e.getNodeByName(d.name)||e.getNodeByName(p)}return v}),p=this.getNodes();for(const X of p){const e=P(X);if(null!==e){for(const d of X.animations){const v=e.animations.filter((e=>e.targetProperty===d.targetProperty));for(const d of v){const v=e.animations.indexOf(d,0);v>-1&&e.animations.splice(v,1)}}e.animations=e.animations.concat(X.animations)}}const L=[],B=this.animationGroups.slice();for(const X of B){L.push(X.clone(X.name,P));for(const e of X.animatables)e.stop()}for(const X of d){const d=P(X.target);d&&(e.beginAnimation(d,X.fromFrame,X.toFrame,X.loopAnimation,X.speedRatio,X.onAnimationEnd?X.onAnimationEnd:void 0,void 0,!0,void 0,X.onAnimationLoop?X.onAnimationLoop:void 0),e.stopAnimation(X.target))}return L}populateRootNodes(){this.rootNodes.length=0;for(const e of this.meshes)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e);for(const e of this.transformNodes)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e);for(const e of this.lights)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e);for(const e of this.cameras)e.parent||-1!==this.rootNodes.indexOf(e)||this.rootNodes.push(e)}addAllAssetsToContainer(e){if(!e)return;const d=[],v=new Set;for(d.push(e);d.length>0;){const e=d.pop();if(e instanceof B.b?(e.sd&&-1===this.geometries.indexOf(e.sd)&&this.geometries.push(e.sd),this.meshes.push(e)):e instanceof k.e?this.meshes.push(e):e instanceof X.c?this.transformNodes.push(e):e instanceof g.e?this.lights.push(e):e instanceof F.c&&this.cameras.push(e),e instanceof z.d){if(e.material&&-1===this.materials.indexOf(e.material)){this.materials.push(e.material);for(const d of e.material.getActiveTextures())-1===this.textures.indexOf(d)&&this.textures.push(d)}e.skeleton&&-1===this.skeletons.indexOf(e.skeleton)&&this.skeletons.push(e.skeleton),e.morphTargetManager&&-1===this.morphTargetManagers.indexOf(e.morphTargetManager)&&this.morphTargetManagers.push(e.morphTargetManager)}for(const P of e.getChildren())v.has(P)||d.push(P);v.add(e)}this.populateRootNodes()}_getByTags(e,d,v){if(void 0===d)return e;const P=[];for(const p in e){const L=e[p];w.d&&w.d.MatchesQuery(L,d)&&(!v||v(L))&&P.push(L)}return P}getMeshesByTags(e,d){return this._getByTags(this.meshes,e,d)}getCamerasByTags(e,d){return this._getByTags(this.cameras,e,d)}getLightsByTags(e,d){return this._getByTags(this.lights,e,d)}getMaterialsByTags(e,d){return this._getByTags(this.materials,e,d).concat(this._getByTags(this.multiMaterials,e,d))}getTransformNodesByTags(e,d){return this._getByTags(this.transformNodes,e,d)}}var q=v(12295);class h{constructor(e){this.byteOffset=0,this.buffer=e}async loadAsync(e){const d=await this.buffer.readAsync(this.byteOffset,e);this._dataView=new DataView(d.buffer,d.byteOffset,d.byteLength),this._dataByteOffset=0}readUint32(){const e=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,e}readUint8Array(e){const d=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,e);return this._dataByteOffset+=e,this.byteOffset+=e,d}readString(e){return(0,q.j)(this.readUint8Array(e))}skipBytes(e){this._dataByteOffset+=e,this.byteOffset+=e}}var l=v(14125);const n="Z2xURg",A={name:"rd",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:e=>-1!==e.indexOf("asset")&&-1!==e.indexOf("version")||e.startsWith("data:base64,"+n)||e.startsWith("data:;base64,"+n)||e.startsWith("data:application/octet-stream;base64,"+n)||e.startsWith("data:model/gltf-binary;base64,"+n)};var x,i,me,r=v(12283),Z=v(12291);function f(e,d,v){try{return Promise.resolve(new Uint8Array(e,d,v))}catch(P){return Promise.reject(P)}}!function(e){e[e.AUTO=0]="AUTO",e[e.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(x||(x={})),function(e){e[e.NONE=0]="NONE",e[e.FIRST=1]="FIRST",e[e.ALL=2]="ALL"}(i||(i={})),function(e){e[e.LOADING=0]="LOADING",e[e.READY=1]="READY",e[e.COMPLETE=2]="COMPLETE"}(me||(me={}));class T{constructor(){this.coordinateSystemMode=x.AUTO,this.animationStartMode=i.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=e=>Promise.resolve(e),this.extensionOptions={}}L(e){e&&(this.onParsed=e.onParsed,this.coordinateSystemMode=e.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=e.animationStartMode??this.animationStartMode,this.loadNodeAnimations=e.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=e.loadSkins??this.loadSkins,this.loadMorphTargets=e.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=e.compileMaterials??this.compileMaterials,this.useClipPlane=e.useClipPlane??this.useClipPlane,this.compileShadowGenerators=e.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=e.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=e.useRangeRequests??this.useRangeRequests,this.createInstances=e.createInstances??this.createInstances,this.alwaysComputeBoundingBox=e.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=e.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=e.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=e.skipMaterials??this.skipMaterials,this.useSRGBBuffers=e.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=e.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=e.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=e.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=e.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=e.customRootNode,this.onMeshLoaded=e.onMeshLoaded,this.onSkinLoaded=e.onSkinLoaded,this.onTextureLoaded=e.onTextureLoaded,this.onMaterialLoaded=e.onMaterialLoaded,this.onCameraLoaded=e.onCameraLoaded,this.extensionOptions=e.extensionOptions??this.extensionOptions)}}class S extends T{constructor(e){super(),this.onParsedObservable=new P.d,this.onMeshLoadedObservable=new P.d,this.onSkinLoadedObservable=new P.d,this.onTextureLoadedObservable=new P.d,this.onMaterialLoadedObservable=new P.d,this.onCameraLoadedObservable=new P.d,this.onCompleteObservable=new P.d,this.onErrorObservable=new P.d,this.Fd=new P.d,this.onExtensionLoadedObservable=new P.d,this.validate=!1,this.onValidatedObservable=new P.d,this._loader=null,this._state=null,this._requests=new Array,this.name=A.name,this.extensions=A.extensions,this.onLoaderStateChangedObservable=new P.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.L(e)}set onParsed(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),e&&(this._onParsedObserver=this.onParsedObservable.add(e))}set onMeshLoaded(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),e&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e))}set onSkinLoaded(e){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),e&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((d=>e(d.node,d.skinnedNode))))}set onTextureLoaded(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),e&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e))}set onMaterialLoaded(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),e&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e))}set onCameraLoaded(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),e&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e))}set onComplete(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)}set onError(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)}set onDispose(e){this._onDisposeObserver&&this.Fd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fd.add(e)}set onExtensionLoaded(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const e of this._requests)e.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Fd.notifyObservers(void 0),this.Fd.clear()}loadFile(e,d,v,L,B,X,z,V){if(ArrayBuffer.isView(d))return this._loadBinary(e,d,v,L,z,V),null;this._progressCallback=B;const k=d.name||p.Tools.GetFilename(d);if(X){if(this.useRangeRequests){this.validate&&W.c.Warn("glTF validation is not supported when range requests are enabled");const v={abort:()=>{},onCompleteObservable:new P.d},p={readAsync:(v,P)=>new Promise(((p,L)=>{this._loadFile(e,d,(e=>{p(new Uint8Array(e))}),!0,(e=>{L(e)}),(e=>{e.setRequestHeader("Range",`bytes=${v}-${v+P-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new h(p)).then((e=>{v.onCompleteObservable.notifyObservers(v),L(e)}),z?e=>z(void 0,e):void 0),v}return this._loadFile(e,d,(d=>{this._validate(e,new Uint8Array(d,0,d.byteLength),v,k),this._unpackBinaryAsync(new h({readAsync:(e,v)=>f(d,e,v),byteLength:d.byteLength})).then((e=>{L(e)}),z?e=>z(void 0,e):void 0)}),!0,z)}return this._loadFile(e,d,(d=>{try{this._validate(e,d,v,k),L({json:this._parseJson(d)})}catch{z&&z()}}),!1,z)}_loadBinary(e,d,v,P,p,L){this._validate(e,new Uint8Array(d.buffer,d.byteOffset,d.byteLength),v,L),this._unpackBinaryAsync(new h({readAsync:(e,v)=>function(e,d,v){try{if(d<0||d>=e.byteLength)throw new RangeError("Offset is out of range.");if(d+v>e.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(e.buffer,e.byteOffset+d,v))}catch(P){return Promise.reject(P)}}(d,e,v),byteLength:d.byteLength})).then((e=>{P(e)}),p?e=>p(void 0,e):void 0)}importMeshAsync(e,d,v,P,p,L){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(v),this._loader.importMeshAsync(e,d,null,v,P,p,L))))}loadAsync(e,d,v,P,p){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${p||""}`),this._loader=this._getLoader(d),this._loader.loadAsync(e,d,v,P,p))))}loadAssetContainerAsync(e,d,v,P,p){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${p||""}`),this._loader=this._getLoader(d);const L=new C(e),B=[];this.onMaterialLoadedObservable.add((e=>{B.push(e)}));const X=[];this.onTextureLoadedObservable.add((e=>{X.push(e)}));const z=[];this.onCameraLoadedObservable.add((e=>{z.push(e)}));const W=[];return this.onMeshLoadedObservable.add((e=>{e.morphTargetManager&&W.push(e.morphTargetManager)})),this._loader.importMeshAsync(null,e,L,d,v,P,p).then((e=>(Array.prototype.push.apply(L.geometries,e.geometries),Array.prototype.push.apply(L.meshes,e.meshes),Array.prototype.push.apply(L.sk,e.sk),Array.prototype.push.apply(L.skeletons,e.skeletons),Array.prototype.push.apply(L.animationGroups,e.animationGroups),Array.prototype.push.apply(L.materials,B),Array.prototype.push.apply(L.textures,X),Array.prototype.push.apply(L.lights,e.lights),Array.prototype.push.apply(L.transformNodes,e.transformNodes),Array.prototype.push.apply(L.cameras,z),Array.prototype.push.apply(L.morphTargetManagers,W),L)))}))}canDirectLoad(e){return A.canDirectLoad(e)}directLoad(e,d){if(d.startsWith("base64,"+n)||d.startsWith(";base64,"+n)||d.startsWith("application/octet-stream;base64,"+n)||d.startsWith("model/gltf-binary;base64,"+n)){const v=(0,r.c)(d);return this._validate(e,new Uint8Array(v,0,v.byteLength)),this._unpackBinaryAsync(new h({readAsync:(e,d)=>f(v,e,d),byteLength:v.byteLength}))}return this._validate(e,d),Promise.resolve({json:this._parseJson(d)})}createPlugin(e){return new S(e[A.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((e,d)=>{this.onCompleteObservable.addOnce((()=>{e()})),this.onErrorObservable.addOnce((e=>{d(e)}))}))}_setState(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(me[this._state]))}_loadFile(e,d,v,P,p,L){const B=e._loadFile(d,v,(e=>{this._onProgress(e,B)}),!0,P,p,L);return B.onCompleteObservable.add((()=>{B._lengthComputable=!0,B._total=B._loaded})),this._requests.push(B),B}_onProgress(e,d){if(!this._progressCallback)return;d._lengthComputable=e.lengthComputable,d._loaded=e.loaded,d._total=e.total;let v=!0,P=0,p=0;for(const L of this._requests){if(void 0===L._lengthComputable||void 0===L._loaded||void 0===L._total)return;v=v&&L._lengthComputable,P+=L._loaded,p+=L._total}this._progressCallback({lengthComputable:v,loaded:P,total:v?p:0})}_validate(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),l.e.ValidateAsync(d,v,P,(d=>this.preprocessUrlAsync(v+d).then((d=>e._loadFileAsync(d,void 0,!0,!0).then((e=>new Uint8Array(e,0,e.byteLength))))))).then((e=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(e),this.onValidatedObservable.clear()}),(e=>{this._endPerformanceCounter("Validate JSON"),p.Tools.Warn(`Failed to validate: ${e.message}`),this.onValidatedObservable.clear()})))}_getLoader(e){const d=e.json.asset||{};this._log(`Asset version: ${d.version}`),d.minVersion&&this._log(`Asset minimum version: ${d.minVersion}`),d.generator&&this._log(`Asset generator: ${d.generator}`);const v=S._parseVersion(d.version);if(!v)throw new Error("Invalid version: "+d.version);if(void 0!==d.minVersion){const e=S._parseVersion(d.minVersion);if(!e)throw new Error("Invalid minimum version: "+d.minVersion);if(S._compareVersion(e,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+d.minVersion)}const P={1:S._CreateGLTF1Loader,2:S._CreateGLTF2Loader}[v.major];if(!P)throw new Error("Unsupported version: "+d.version);return P(this)}_parseJson(e){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${e.length}`);const d=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),d}_unpackBinaryAsync(e){return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then((()=>{const d=e.readUint32();if(1179937895!==d)throw new Z.i("Unexpected magic: "+d,Z.h.GLTFLoaderUnexpectedMagicError);const v=e.readUint32();this.loggingEnabled&&this._log(`Binary version: ${v}`);const P=e.readUint32();let p;switch(this.useRangeRequests||P===e.buffer.byteLength||W.c.Warn(`Length in header does not match actual data length: ${P} != ${e.buffer.byteLength}`),v){case 1:p=this._unpackBinaryV1Async(e,P);break;case 2:p=this._unpackBinaryV2Async(e,P);break;default:throw new Error("Unsupported version: "+v)}return this._endPerformanceCounter("Unpack Binary"),p}))}_unpackBinaryV1Async(e,d){const v=e.readUint32(),P=e.readUint32();if(0!==P)throw new Error(`Unexpected content format: ${P}`);const p=d-e.byteOffset,L={json:this._parseJson(e.readString(v)),bin:null};if(0!==p){const d=e.byteOffset;L.bin={readAsync:(v,P)=>e.buffer.readAsync(d+v,P),byteLength:p}}return Promise.resolve(L)}_unpackBinaryV2Async(e,d){const v=1313821514,P=5130562,p=e.readUint32();if(e.readUint32()!==v)throw new Error("First chunk format is not JSON");return e.byteOffset+p===d?e.loadAsync(p).then((()=>({json:this._parseJson(e.readString(p)),bin:null}))):e.loadAsync(p+8).then((()=>{const L={json:this._parseJson(e.readString(p)),bin:null},B=()=>{const p=e.readUint32();switch(e.readUint32()){case v:throw new Error("Unexpected JSON chunk");case P:{const d=e.byteOffset;L.bin={readAsync:(v,P)=>e.buffer.readAsync(d+v,P),byteLength:p},e.skipBytes(p);break}default:e.skipBytes(p)}return e.byteOffset!==d?e.loadAsync(8).then(B):Promise.resolve(L)};return B()}))}static _parseVersion(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};const d=(e+"").match(/^(\d+)\.(\d+)/);return d?{major:parseInt(d[1]),minor:parseInt(d[2])}:null}static _compareVersion(e,d){return e.major>d.major?1:e.major<d.major?-1:e.minor>d.minor?1:e.minor<d.minor?-1:0}_logOpen(e){this._log(e),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(e){const d=S._logSpaces.substring(0,2*this._logIndentLevel);W.c.Log(`${d}${e}`)}_logDisabled(e){}_startPerformanceCounterEnabled(e){p.Tools.StartPerformanceCounter(e)}_startPerformanceCounterDisabled(e){}_endPerformanceCounterEnabled(e){p.Tools.EndPerformanceCounter(e)}_endPerformanceCounterDisabled(e){}}S.IncrementalLoading=!0,S.HomogeneousCoordinates=!1,S._logSpaces="                                ",(0,L.e)(new S)},14125:(e,d,v)=>{"use strict";v.d(d,{e:()=>B});var P=v(12240);function p(e,d,v,P){const p={externalResourceFunction:P};return v&&(p.uri="file:"===d?v:d+v),ArrayBuffer.isView(e)?GLTFValidator.validateBytes(e,p):GLTFValidator.validateString(e,p)}function L(){const e=[];onmessage=d=>{const v=d.data;switch(v.id){case"init":importScripts(v.url);break;case"validate":p(v.data,v.rootUrl,v.fileName,(d=>new Promise(((v,P)=>{const p=e.length;e.push({resolve:v,reject:P}),postMessage({id:"getExternalResource",index:p,uri:d})})))).then((e=>{postMessage({id:"validate.resolve",value:e})}),(e=>{postMessage({id:"validate.reject",reason:e})}));break;case"getExternalResource.resolve":e[v.index].resolve(v.value);break;case"getExternalResource.reject":e[v.index].reject(v.reason)}}}class B{static ValidateAsync(e,d,v,B){return"function"===typeof Worker?new Promise(((X,z)=>{const W=`${p}(${L})()`,V=URL.createObjectURL(new Blob([W],{type:"application/javascript"})),k=new Worker(V),g=e=>{k.removeEventListener("error",g),k.removeEventListener("message",F),z(e)},F=e=>{const d=e.data;switch(d.id){case"getExternalResource":B(d.uri).then((e=>{k.postMessage({id:"getExternalResource.resolve",index:d.index,value:e},[e.buffer])}),(e=>{k.postMessage({id:"getExternalResource.reject",index:d.index,reason:e})}));break;case"validate.resolve":k.removeEventListener("error",g),k.removeEventListener("message",F),X(d.value),k.terminate();break;case"validate.reject":k.removeEventListener("error",g),k.removeEventListener("message",F),z(d.reason),k.terminate()}};if(k.addEventListener("error",g),k.addEventListener("message",F),k.postMessage({id:"init",url:P.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(e)){const P=e.slice();k.postMessage({id:"validate",data:P,rootUrl:d,fileName:v},[P.buffer])}else k.postMessage({id:"validate",data:e,rootUrl:d,fileName:v})})):(this._LoadScriptPromise||(this._LoadScriptPromise=P.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>p(e,d,v,B))))}}B.Configuration={url:`${P.Tools._DefaultCdnUrl}/gltf_validator.js`}},14630:(e,d,v)=>{"use strict";v.d(d,{b:()=>A});var P=v(12403),p=v(12409),L=v(12453),B=v(12420),X=v(12795),z=v(12731),W=v(12490),V=v(12653),k=v(12381),g=v(12328);v(13886),v(13772),v(13792),v(13781),v(13798),v(13806),v(13811);const F="imageProcessingCompatibility",w="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";g.d.IncludesShadersStore[F]||(g.d.IncludesShadersStore[F]=w);const G="skyPixelShader",U="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";g.d.ShadersStore[G]||(g.d.ShadersStore[G]=U);v(13895),v(13820),v(13826),v(13840),v(13831);const D="skyVertexShader",C="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";g.d.ShadersStore[D]||(g.d.ShadersStore[D]=C);var q=v(12722),h=v(12775),l=v(12767);class n extends X.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class A extends z.c{constructor(e,d){super(e,d),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new B.mv(0,100,0),this.useSunPosition=!1,this.cameraOffset=B.mv.Zero(),this.up=B.mv.Up(),this.dithering=!1,this._cameraPosition=B.mv.Zero(),this._skyOrientation=new B.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,d){const v=d._drawWrapper;if(this.isFrozen&&v.effect&&v._wasPreviouslyReady)return!0;d.materialDefines||(d.materialDefines=new n);const P=d.materialDefines,p=this.Ae();if(this._isReadyForSubMesh(d))return!0;if((0,l.V)(e,p,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,P),(0,l.M)(e,P,!0,!1),P.IMAGEPROCESSINGPOSTPROCESS!==p.imageProcessingConfiguration.applyByPostProcess&&P.markAsMiscDirty(),P.DITHER!==this.dithering&&P.markAsMiscDirty(),P.isDirty){P.markAsProcessed(),p.resetCachedMaterial();const e=new q.d;P.FOG&&e.addFallback(1,"FOG"),P.IMAGEPROCESSINGPOSTPROCESS=p.imageProcessingConfiguration.applyByPostProcess,P.DITHER=this.dithering;const v=[W.i.PositionKind];P.VERTEXCOLOR&&v.push(W.i.ColorKind);const L="sky",B=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,h.c)(B);const X=P.toString();d.setEffect(p.getEngine().createEffect(L,v,B,[],X,e,this.onCompiled,this.onError),P,this._materialContext)}return!(!d.effect||!d.effect.isReady())&&(P._renderId=p.getRenderId(),v._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,d,v){const P=this.Ae(),p=v.materialDefines;if(!p)return;const L=v.effect;if(!L)return;this._activeEffect=L,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",P.getTransformMatrix()),this._mustRebind(P,L,v)&&((0,h.d)(L,this,P),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,l.i)(p,L,P)),P.fogEnabled&&d.applyFog&&P.fogMode!==V.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",P.getViewMatrix()),(0,l.e)(P,d,this._activeEffect);const X=P.activeCamera;if(X){const e=X.getWorldMatrix();this._cameraPosition.x=e.m[12],this._cameraPosition.y=e.m[13],this._cameraPosition.z=e.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const e=Math.PI*(this.inclination-.5),d=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(d)*Math.cos(e),this.sunPosition.y=this.distance*Math.sin(-e),this.sunPosition.z=this.distance*Math.sin(d)*Math.cos(e),B.Quaternion.FromUnitVectorsToRef(B.mv.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(d,this._activeEffect,v)}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return L.c.Clone((()=>new A(e,this.Ae())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.SkyMaterial",e}getClassName(){return"SkyMaterial"}static Parse(e,d,v){return L.c.Parse((()=>new A(e.name,d)),e,d,v)}}(0,P.e)([(0,p.M)()],A.prototype,"luminance",void 0),(0,P.e)([(0,p.M)()],A.prototype,"turbidity",void 0),(0,P.e)([(0,p.M)()],A.prototype,"rayleigh",void 0),(0,P.e)([(0,p.M)()],A.prototype,"mieCoefficient",void 0),(0,P.e)([(0,p.M)()],A.prototype,"mieDirectionalG",void 0),(0,P.e)([(0,p.M)()],A.prototype,"distance",void 0),(0,P.e)([(0,p.M)()],A.prototype,"inclination",void 0),(0,P.e)([(0,p.M)()],A.prototype,"azimuth",void 0),(0,P.e)([(0,p.J)()],A.prototype,"sunPosition",void 0),(0,P.e)([(0,p.M)()],A.prototype,"useSunPosition",void 0),(0,P.e)([(0,p.J)()],A.prototype,"cameraOffset",void 0),(0,P.e)([(0,p.J)()],A.prototype,"up",void 0),(0,P.e)([(0,p.M)()],A.prototype,"dithering",void 0),(0,k.h)("BABYLON.SkyMaterial",A)},13115:(e,d,v)=>{"use strict";function P(e,d){d.headers=e.headers||{},d.statusMessage=e.statusText,d.statusCode=e.status,d.data=e.response}function p(e,d,v){return new Promise((function(p,L){v=v||{};var B,X,z,W=new XMLHttpRequest,V=v.body,k=v.headers||{};for(B in v.timeout&&(W.timeout=v.timeout),W.ontimeout=W.onerror=function(e){e.timeout="timeout"==e.type,L(e)},W.open(e,d.href||d),W.onload=function(){for(z=W.getAllResponseHeaders().trim().split(/[\r\n]+/),P(W,W);X=z.shift();)X=X.split(": "),W.headers[X.shift().toLowerCase()]=X.join(": ");if((X=W.headers["content-type"])&&~X.indexOf("application/json"))try{W.data=JSON.parse(W.data,v.reviver)}catch(e){return P(W,e),L(e)}(W.status>=400?L:p)(W)},typeof FormData<"u"&&V instanceof FormData||V&&"object"==typeof V&&(k["content-type"]="application/json",V=JSON.stringify(V)),W.withCredentials=!!v.withCredentials,k)W.setRequestHeader(B,k[B]);W.send(V)}))}v.r(d),v.d(d,{del:()=>z,get:()=>L,patch:()=>X,post:()=>B,put:()=>W,send:()=>p});var L=p.bind(p,"GET"),B=p.bind(p,"POST"),X=p.bind(p,"PATCH"),z=p.bind(p,"DELETE"),W=p.bind(p,"PUT")},14745:(e,d,v)=>{"use strict";v.d(d,{d:()=>k});const P=.5*(Math.sqrt(3)-1),p=(3-Math.sqrt(3))/6,L=1/3,B=1/6,X=(Math.sqrt(5)-1)/4,z=(5-Math.sqrt(5))/20,W=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),V=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const k=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const d="function"==typeof e?e:function(e){let d=0,v=0,P=0,p=1;const L=function(){let e=4022871197;return function(d){d=d.toString();for(let v=0;v<d.length;v++){e+=d.charCodeAt(v);let P=.02519603282416938*e;e=P>>>0,P-=e,P*=e,e=P>>>0,P-=e,e+=4294967296*P}return 2.3283064365386963e-10*(e>>>0)}}();d=L(" "),v=L(" "),P=L(" "),d-=L(e),d<0&&(d+=1);v-=L(e),v<0&&(v+=1);P-=L(e),P<0&&(P+=1);return function(){const e=2091639*d+2.3283064365386963e-10*p;return d=v,v=P,P=e-(p=0|e)}}(e);this.p=function(e){const d=new Uint8Array(256);for(let v=0;v<256;v++)d[v]=v;for(let v=0;v<255;v++){const P=v+~~(e()*(256-v)),p=d[v];d[v]=d[P],d[P]=p}return d}(d),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let v=0;v<512;v++)this.perm[v]=this.p[255&v],this.permMod12[v]=this.perm[v]%12}noise2D(e,d){const v=this.permMod12,L=this.perm;let B=0,X=0,z=0;const V=(e+d)*P,k=Math.floor(e+V),g=Math.floor(d+V),F=(k+g)*p,w=e-(k-F),G=d-(g-F);let U,D;w>G?(U=1,D=0):(U=0,D=1);const C=w-U+p,q=G-D+p,h=w-1+2*p,l=G-1+2*p,n=255&k,A=255&g;let x=.5-w*w-G*G;if(x>=0){const e=3*v[n+L[A]];x*=x,B=x*x*(W[e]*w+W[e+1]*G)}let i=.5-C*C-q*q;if(i>=0){const e=3*v[n+U+L[A+D]];i*=i,X=i*i*(W[e]*C+W[e+1]*q)}let me=.5-h*h-l*l;if(me>=0){const e=3*v[n+1+L[A+1]];me*=me,z=me*me*(W[e]*h+W[e+1]*l)}return 70*(B+X+z)}noise3D(e,d,v){const P=this.permMod12,p=this.perm;let X,z,V,k;const g=(e+d+v)*L,F=Math.floor(e+g),w=Math.floor(d+g),G=Math.floor(v+g),U=(F+w+G)*B,D=e-(F-U),C=d-(w-U),q=v-(G-U);let h,l,n,A,x,i;D>=C?C>=q?(h=1,l=0,n=0,A=1,x=1,i=0):D>=q?(h=1,l=0,n=0,A=1,x=0,i=1):(h=0,l=0,n=1,A=1,x=0,i=1):C<q?(h=0,l=0,n=1,A=0,x=1,i=1):D<q?(h=0,l=1,n=0,A=0,x=1,i=1):(h=0,l=1,n=0,A=1,x=1,i=0);const me=D-h+B,r=C-l+B,Z=q-n+B,f=D-A+2*B,T=C-x+2*B,S=q-i+2*B,o=D-1+.5,K=C-1+.5,Q=q-1+.5,N=255&F,u=255&w,O=255&G;let R=.6-D*D-C*C-q*q;if(R<0)X=0;else{const e=3*P[N+p[u+p[O]]];R*=R,X=R*R*(W[e]*D+W[e+1]*C+W[e+2]*q)}let Y=.6-me*me-r*r-Z*Z;if(Y<0)z=0;else{const e=3*P[N+h+p[u+l+p[O+n]]];Y*=Y,z=Y*Y*(W[e]*me+W[e+1]*r+W[e+2]*Z)}let H=.6-f*f-T*T-S*S;if(H<0)V=0;else{const e=3*P[N+A+p[u+x+p[O+i]]];H*=H,V=H*H*(W[e]*f+W[e+1]*T+W[e+2]*S)}let a=.6-o*o-K*K-Q*Q;if(a<0)k=0;else{const e=3*P[N+1+p[u+1+p[O+1]]];a*=a,k=a*a*(W[e]*o+W[e+1]*K+W[e+2]*Q)}return 32*(X+z+V+k)}noise4D(e,d,v,P){const p=this.perm;let L,B,W,k,g;const F=(e+d+v+P)*X,w=Math.floor(e+F),G=Math.floor(d+F),U=Math.floor(v+F),D=Math.floor(P+F),C=(w+G+U+D)*z,q=e-(w-C),h=d-(G-C),l=v-(U-C),n=P-(D-C);let A=0,x=0,i=0,me=0;q>h?A++:x++,q>l?A++:i++,q>n?A++:me++,h>l?x++:i++,h>n?x++:me++,l>n?i++:me++;const r=A>=3?1:0,Z=x>=3?1:0,f=i>=3?1:0,T=me>=3?1:0,S=A>=2?1:0,o=x>=2?1:0,K=i>=2?1:0,Q=me>=2?1:0,N=A>=1?1:0,u=x>=1?1:0,O=i>=1?1:0,R=me>=1?1:0,Y=q-r+z,H=h-Z+z,a=l-f+z,t=n-T+z,I=q-S+2*z,c=h-o+2*z,b=l-K+2*z,M=n-Q+2*z,s=q-N+3*z,y=h-u+3*z,j=l-O+3*z,J=n-R+3*z,E=q-1+4*z,ee=h-1+4*z,de=l-1+4*z,ve=n-1+4*z,Pe=255&w,pe=255&G,Le=255&U,Be=255&D;let Xe=.6-q*q-h*h-l*l-n*n;if(Xe<0)L=0;else{const e=p[Pe+p[pe+p[Le+p[Be]]]]%32*4;Xe*=Xe,L=Xe*Xe*(V[e]*q+V[e+1]*h+V[e+2]*l+V[e+3]*n)}let ze=.6-Y*Y-H*H-a*a-t*t;if(ze<0)B=0;else{const e=p[Pe+r+p[pe+Z+p[Le+f+p[Be+T]]]]%32*4;ze*=ze,B=ze*ze*(V[e]*Y+V[e+1]*H+V[e+2]*a+V[e+3]*t)}let We=.6-I*I-c*c-b*b-M*M;if(We<0)W=0;else{const e=p[Pe+S+p[pe+o+p[Le+K+p[Be+Q]]]]%32*4;We*=We,W=We*We*(V[e]*I+V[e+1]*c+V[e+2]*b+V[e+3]*M)}let Ve=.6-s*s-y*y-j*j-J*J;if(Ve<0)k=0;else{const e=p[Pe+N+p[pe+u+p[Le+O+p[Be+R]]]]%32*4;Ve*=Ve,k=Ve*Ve*(V[e]*s+V[e+1]*y+V[e+2]*j+V[e+3]*J)}let ke=.6-E*E-ee*ee-de*de-ve*ve;if(ke<0)g=0;else{const e=p[Pe+1+p[pe+1+p[Le+1+p[Be+1]]]]%32*4;ke*=ke,g=ke*ke*(V[e]*E+V[e+1]*ee+V[e+2]*de+V[e+3]*ve)}return 27*(L+B+W+k+g)}}}}]);