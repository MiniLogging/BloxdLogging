/*! For license information please see 23hpdp.32.c47149e8.chunk.js.LICENSE.txt */
(self.wy695la1oic=self.wy695la1oic||[]).push([[32],{13377:(S,v,D)=>{"use strict";var z=D(13383),e=D(13386),N=D(13388);D.g.__TYPEDARRAY_POOL||(D.g.__TYPEDARRAY_POOL={UINT8:e([32,0]),UINT16:e([32,0]),UINT32:e([32,0]),INT8:e([32,0]),INT16:e([32,0]),INT32:e([32,0]),FLOAT:e([32,0]),DOUBLE:e([32,0]),DATA:e([32,0]),UINT8C:e([32,0]),BUFFER:e([32,0])});var m="undefined"!==typeof Uint8ClampedArray,B=D.g.__TYPEDARRAY_POOL;B.UINT8C||(B.UINT8C=e([32,0])),B.BUFFER||(B.BUFFER=e([32,0]));var g=B.DATA,E=B.BUFFER;function h(S){if(S){var v=S.length||S.byteLength,D=z.log2(v);g[D].push(S)}}function A(S){S=z.nextPow2(S);var v=z.log2(S),D=g[v];return D.length>0?D.pop():new ArrayBuffer(S)}function w(S){return new Uint8Array(A(S),0,S)}function n(S){return new Uint16Array(A(2*S),0,S)}function R(S){return new Uint32Array(A(4*S),0,S)}function O(S){return new Int8Array(A(S),0,S)}function I(S){return new Int16Array(A(2*S),0,S)}function K(S){return new Int32Array(A(4*S),0,S)}function q(S){return new Float32Array(A(4*S),0,S)}function u(S){return new Float64Array(A(8*S),0,S)}function s(S){return m?new Uint8ClampedArray(A(S),0,S):w(S)}function r(S){return new DataView(A(S),0,S)}v.free=function(S){if(N(S))E[z.log2(S.length)].push(S);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(S)&&(S=S.buffer),!S)return;var v=S.length||S.byteLength,D=0|z.log2(v);g[D].push(S)}},v.freeUint8=v.freeUint16=v.freeUint32=v.freeInt8=v.freeInt16=v.freeInt32=v.freeFloat32=v.freeFloat=v.freeFloat64=v.freeDouble=v.freeUint8Clamped=v.freeDataView=function(S){h(S.buffer)},v.freeArrayBuffer=h,v.freeBuffer=function(S){E[z.log2(S.length)].push(S)},v.malloc=function(S,v){if(void 0===v||"arraybuffer"===v)return A(S);switch(v){case"uint8":return w(S);case"uint16":return n(S);case"uint32":return R(S);case"int8":return O(S);case"int16":return I(S);case"int32":return K(S);case"float":case"float32":return q(S);case"double":case"float64":return u(S);case"uint8_clamped":return s(S);case"buffer":throw"Buffer not supported";case"data":case"dataview":return r(S);default:return null}return null},v.mallocArrayBuffer=A,v.mallocUint8=w,v.mallocUint16=n,v.mallocUint32=R,v.mallocInt8=O,v.mallocInt16=I,v.mallocInt32=K,v.mallocFloat32=v.mallocFloat=q,v.mallocFloat64=v.mallocDouble=u,v.mallocUint8Clamped=s,v.mallocDataView=r,v.clearCache=function(){for(var S=0;S<32;++S)B.UINT8[S].length=0,B.UINT16[S].length=0,B.UINT32[S].length=0,B.INT8[S].length=0,B.INT16[S].length=0,B.INT32[S].length=0,B.FLOAT[S].length=0,B.DOUBLE[S].length=0,B.UINT8C[S].length=0,g[S].length=0,E[S].length=0}},13457:(S,v,D)=>{S.exports=e;var z=D(12213);function e(S,v){if(!(this instanceof e))return new e(S,v);var D=z.create();z.add(D,S,v),this.base=z.min(z.create(),S,D),this.Ah=z.clone(v),this.max=z.max(z.create(),S,D),this.mag=z.length(this.Ah)}var N=e.prototype;N.width=function(){return this.Ah[0]},N.height=function(){return this.Ah[1]},N.depth=function(){return this.Ah[2]},N.x0=function(){return this.base[0]},N.y0=function(){return this.base[1]},N.z0=function(){return this.base[2]},N.x1=function(){return this.max[0]},N.y1=function(){return this.max[1]},N.z1=function(){return this.max[2]},N.translate=function(S){return z.add(this.max,this.max,S),z.add(this.base,this.base,S),this},N.setPosition=function(S){return z.add(this.max,S,this.Ah),z.j(this.base,S),this},N.expand=function(S){var v=z.create(),D=z.create();return z.max(v,S.max,this.max),z.min(D,S.base,this.base),z.Ov(v,v,D),new e(D,v)},N.intersects=function(S){return!(S.base[0]>this.max[0])&&(!(S.base[1]>this.max[1])&&(!(S.base[2]>this.max[2])&&(!(S.max[0]<this.base[0])&&(!(S.max[1]<this.base[1])&&!(S.max[2]<this.base[2])))))},N.touches=function(S){var v=this.union(S);return null!==v&&(0==v.width()||0==v.height()||0==v.depth())},N.union=function(S){if(!this.intersects(S))return null;var v=Math.max(S.base[0],this.base[0]),D=Math.max(S.base[1],this.base[1]),z=Math.max(S.base[2],this.base[2]);return new e([v,D,z],[Math.min(S.max[0],this.max[0])-v,Math.min(S.max[1],this.max[1])-D,Math.min(S.max[2],this.max[2])-z])}},13383:(S,v)=>{"use strict";function D(S){var v=32;return(S&=-S)&&v--,65535&S&&(v-=16),16711935&S&&(v-=8),252645135&S&&(v-=4),858993459&S&&(v-=2),1431655765&S&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(S){return(S>0)-(S<0)},v.abs=function(S){var v=S>>31;return(S^v)-v},v.min=function(S,v){return v^(S^v)&-(S<v)},v.max=function(S,v){return S^(S^v)&-(S<v)},v.isPow2=function(S){return!(S&S-1)&&!!S},v.log2=function(S){var v,D;return v=(S>65535)<<4,v|=D=((S>>>=v)>255)<<3,v|=D=((S>>>=D)>15)<<2,(v|=D=((S>>>=D)>3)<<1)|(S>>>=D)>>1},v.log10=function(S){return S>=1e9?9:S>=1e8?8:S>=1e7?7:S>=1e6?6:S>=1e5?5:S>=1e4?4:S>=1e3?3:S>=100?2:S>=10?1:0},v.popCount=function(S){return 16843009*((S=(858993459&(S-=S>>>1&1431655765))+(S>>>2&858993459))+(S>>>4)&252645135)>>>24},v.countTrailingZeros=D,v.nextPow2=function(S){return S+=0===S,--S,S|=S>>>1,S|=S>>>2,S|=S>>>4,S|=S>>>8,(S|=S>>>16)+1},v.prevPow2=function(S){return S|=S>>>1,S|=S>>>2,S|=S>>>4,S|=S>>>8,(S|=S>>>16)-(S>>>1)},v.parity=function(S){return S^=S>>>16,S^=S>>>8,S^=S>>>4,27030>>>(S&=15)&1};var z=new Array(256);!function(S){for(var v=0;v<256;++v){var D=v,z=v,e=7;for(D>>>=1;D;D>>>=1)z<<=1,z|=1&D,--e;S[v]=z<<e&255}}(z),v.reverse=function(S){return z[255&S]<<24|z[S>>>8&255]<<16|z[S>>>16&255]<<8|z[S>>>24&255]},v.interleave2=function(S,v){return(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S&=65535)|S<<8))|S<<4))|S<<2))|S<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(S,v){return(S=65535&((S=16711935&((S=252645135&((S=858993459&((S=S>>>v&1431655765)|S>>>1))|S>>>2))|S>>>4))|S>>>16))<<16>>16},v.interleave3=function(S,v,D){return S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2),(S|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2))<<2},v.deinterleave3=function(S,v){return(S=1023&((S=4278190335&((S=251719695&((S=3272356035&((S=S>>>v&1227133513)|S>>>2))|S>>>4))|S>>>8))|S>>>16))<<22>>22},v.nextCombination=function(S){var v=S|S-1;return v+1|(~v&-~v)-1>>>D(S)+1}},13368:(S,v,D)=>{"use strict";S.exports=function(S,v,D){switch(arguments.length){case 1:return z=[],E(e=S,e,h,!0),z;case 2:return"function"===typeof v?E(S,S,v,!0):function(S,v){return z=[],E(S,v,h,!1),z}(S,v);case 3:return E(S,v,D,!1);default:throw new Error("box-intersect: Invalid arguments")}var e};var z,e=D(13377),N=D(13396),m=D(13402);function B(S,v){for(var D=0;D<S;++D)if(!(v[D]<=v[D+S]))return!0;return!1}function g(S,v,D,z){for(var e=0,N=0,m=0,g=S.length;m<g;++m){var E=S[m];if(!B(v,E)){for(var h=0;h<2*v;++h)D[e++]=E[h];z[N++]=m}}return N}function E(S,v,D,z){var B=S.length,E=v.length;if(!(B<=0||E<=0)){var h=S[0].length>>>1;if(!(h<=0)){var A,w=e.mallocDouble(2*h*B),n=e.mallocInt32(B);if((B=g(S,h,w,n))>0){if(1===h&&z)N.init(B),A=N.sweepComplete(h,D,0,B,w,n,0,B,w,n);else{var R=e.mallocDouble(2*h*E),O=e.mallocInt32(E);(E=g(v,h,R,O))>0&&(N.init(B+E),A=1===h?N.sweepBipartite(h,D,0,B,w,n,0,E,R,O):m(h,D,z,B,w,n,E,R,O),e.free(R),e.free(O))}e.free(w),e.free(n)}return A}}}function h(S,v){z.push([S,v])}},13409:(S,v)=>{"use strict";var D="d",z="ax",e="fp",N="es",m="rs",B="re",g="rb",E="bs",h="be",A="bb",w=[D,z,"vv",m,B,g,"ri",E,h,A,"bi"];function n(S){var v="bruteForce"+(S?"Full":"Partial"),z=[],m=w.slice();S||m.splice(3,0,e);var B=["function "+v+"("+m.join()+"){"];function g(v,e){var m=function(S,v,z){var e="bruteForce"+(S?"Red":"Blue")+(v?"Flip":"")+(z?"Full":""),m=["function ",e,"(",w.join(),"){","var ",N,"=2*",D,";"],B="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",g="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(z?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return S?m.push(B,"Q",":",g):m.push(g,"Q",":",B),z?m.push("if(y1<x0||x1<y0)continue;"):v?m.push("if(y0<=x0||x1<y0)continue;"):m.push("if(y0<x0||x1<y0)continue;"),m.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),v?m.push("yi,xi"):m.push("xi,yi"),m.push(");if(rv!==void 0)return rv;}}}"),{name:e,code:m.join("")}}(v,e,S);z.push(m.code),B.push("return "+m.name+"("+w.join()+");")}B.push("if(re-rs>be-bs){"),S?(g(!0,!1),B.push("}else{"),g(!1,!1)):(B.push("if(fp){"),g(!0,!0),B.push("}else{"),g(!0,!1),B.push("}}else{if(fp){"),g(!1,!0),B.push("}else{"),g(!1,!1),B.push("}")),B.push("}}return "+v);var E=z.join("")+B.join("");return new Function(E)()}v.partial=n(!1),v.full=n(!0)},13402:(S,v,D)=>{"use strict";S.exports=function(S,v,D,N,h,k,Z,i,t){!function(S,v){var D=8*e.log2(v+1)*(S+1)|0,N=e.nextPow2(s*D);d.length<N&&(z.free(d),d=z.mallocInt32(N));var m=e.nextPow2(r*D);x.length<m&&(z.free(x),x=z.mallocDouble(m))}(S,N+Z);var X,a=0,o=2*S;W(a++,0,0,N,0,Z,D?16:0,-1/0,1/0),D||W(a++,0,0,Z,0,N,1,-1/0,1/0);for(;a>0;){var M=(a-=1)*s,c=d[M],J=d[M+1],H=d[M+2],T=d[M+3],G=d[M+4],Y=d[M+5],j=a*r,V=x[j],U=x[j+1],y=1&Y,f=!!(16&Y),C=h,F=k,l=i,P=t;if(y&&(C=i,F=t,l=h,P=k),!(2&Y&&J>=(H=I(S,c,J,H,C,F,U)))&&!(4&Y&&(J=K(S,c,J,H,C,F,V))>=H)){var Q=H-J,L=G-T;if(f){if(S*Q*(Q+L)<n){if(void 0!==(X=g.scanComplete(S,c,v,J,H,C,F,T,G,l,P)))return X;continue}}else{if(S*Math.min(Q,L)<A){if(void 0!==(X=m(S,c,v,y,J,H,C,F,T,G,l,P)))return X;continue}if(S*Q*L<w){if(void 0!==(X=g.scanBipartite(S,c,v,y,J,H,C,F,T,G,l,P)))return X;continue}}var SS=R(S,c,J,H,C,F,V,U);if(J<SS)if(S*(SS-J)<A){if(void 0!==(X=B(S,c+1,v,J,SS,C,F,T,G,l,P)))return X}else if(c===S-2){if(void 0!==(X=y?g.sweepBipartite(S,v,T,G,l,P,J,SS,C,F):g.sweepBipartite(S,v,J,SS,C,F,T,G,l,P)))return X}else W(a++,c+1,J,SS,T,G,y,-1/0,1/0),W(a++,c+1,T,G,J,SS,1^y,-1/0,1/0);if(SS<H){var vS=E(S,c,T,G,l,P),DS=l[o*vS+c],zS=O(S,c,vS,G,l,P,DS);if(zS<G&&W(a++,c,SS,H,zS,G,(4|y)+(f?16:0),DS,U),T<vS&&W(a++,c,SS,H,T,vS,(2|y)+(f?16:0),V,DS),vS+1===zS){if(void 0!==(X=f?b(S,c,v,SS,H,C,F,vS,l,P[vS]):p(S,c,v,y,SS,H,C,F,vS,l,P[vS])))return X}else if(vS<zS){var eS;if(f){if(SS<(eS=q(S,c,SS,H,C,F,DS))){var NS=O(S,c,SS,eS,C,F,DS);if(c===S-2){if(SS<NS&&void 0!==(X=g.sweepComplete(S,v,SS,NS,C,F,vS,zS,l,P)))return X;if(NS<eS&&void 0!==(X=g.sweepBipartite(S,v,NS,eS,C,F,vS,zS,l,P)))return X}else SS<NS&&W(a++,c+1,SS,NS,vS,zS,16,-1/0,1/0),NS<eS&&(W(a++,c+1,NS,eS,vS,zS,0,-1/0,1/0),W(a++,c+1,vS,zS,NS,eS,1,-1/0,1/0))}}else SS<(eS=y?u(S,c,SS,H,C,F,DS):q(S,c,SS,H,C,F,DS))&&(c===S-2?X=y?g.sweepBipartite(S,v,vS,zS,l,P,SS,eS,C,F):g.sweepBipartite(S,v,SS,eS,C,F,vS,zS,l,P):(W(a++,c+1,SS,eS,vS,zS,y,-1/0,1/0),W(a++,c+1,vS,zS,SS,eS,1^y,-1/0,1/0)))}}}}};var z=D(13377),e=D(13383),N=D(13409),m=N.partial,B=N.full,g=D(13396),E=D(13418),h=D(13422),A=128,w=1<<22,n=1<<22,R=h("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),O=h("lo===p0",["p0"]),I=h("lo<p0",["p0"]),K=h("hi<=p0",["p0"]),q=h("lo<=p0&&p0<=hi",["p0"]),u=h("lo<p0&&p0<=hi",["p0"]),s=6,r=2,d=z.mallocInt32(1024),x=z.mallocDouble(1024);function W(S,v,D,z,e,N,m,B,g){var E=s*S;d[E]=v,d[E+1]=D,d[E+2]=z,d[E+3]=e,d[E+4]=N,d[E+5]=m;var h=r*S;x[h]=B,x[h+1]=g}function p(S,v,D,z,e,N,m,B,g,E,h){var A=2*S,w=g*A,n=E[w+v];S:for(var R=e,O=e*A;R<N;++R,O+=A){var I=m[O+v],K=m[O+v+S];if(!(n<I||K<n)&&(!z||n!==I)){for(var q,u=B[R],s=v+1;s<S;++s){I=m[O+s],K=m[O+s+S];var r=E[w+s],d=E[w+s+S];if(K<r||d<I)continue S}if(void 0!==(q=z?D(h,u):D(u,h)))return q}}}function b(S,v,D,z,e,N,m,B,g,E){var h=2*S,A=B*h,w=g[A+v];S:for(var n=z,R=z*h;n<e;++n,R+=h){var O=m[n];if(O!==E){var I=N[R+v],K=N[R+v+S];if(!(w<I||K<w)){for(var q=v+1;q<S;++q){I=N[R+q],K=N[R+q+S];var u=g[A+q],s=g[A+q+S];if(K<u||s<I)continue S}var r=D(O,E);if(void 0!==r)return r}}}}},13418:(S,v,D)=>{"use strict";S.exports=function(S,v,D,m,B,g){if(m<=D+1)return D;var E=D,h=m,A=m+D>>>1,w=2*S,n=A,R=B[w*A+v];for(;E<h;){if(h-E<e){N(S,v,E,h,B,g),R=B[w*A+v];break}var O=h-E,I=Math.random()*O+E|0,K=B[w*I+v],q=Math.random()*O+E|0,u=B[w*q+v],s=Math.random()*O+E|0,r=B[w*s+v];K<=u?r>=u?(n=q,R=u):K>=r?(n=I,R=K):(n=s,R=r):u>=r?(n=q,R=u):r>=K?(n=I,R=K):(n=s,R=r);for(var d=w*(h-1),x=w*n,W=0;W<w;++W,++d,++x){var p=B[d];B[d]=B[x],B[x]=p}var b=g[h-1];g[h-1]=g[n],g[n]=b;for(d=w*(h-1),x=w*(n=z(S,v,E,h-1,B,g,R)),W=0;W<w;++W,++d,++x){p=B[d];B[d]=B[x],B[x]=p}b=g[h-1];if(g[h-1]=g[n],g[n]=b,A<n){for(h=n-1;E<h&&B[w*(h-1)+v]===R;)h-=1;h+=1}else{if(!(n<A))break;for(E=n+1;E<h&&B[w*E+v]===R;)E+=1}}return z(S,v,D,A,B,g,B[w*A+v])};var z=D(13422)("lo<p0",["p0"]),e=8;function N(S,v,D,z,e,N){for(var m=2*S,B=m*(D+1)+v,g=D+1;g<z;++g,B+=m)for(var E=e[B],h=g,A=m*(g-1);h>D&&e[A+v]>E;--h,A-=m){for(var w=A,n=A+m,R=0;R<m;++R,++w,++n){var O=e[w];e[w]=e[n],e[n]=O}var I=N[h];N[h]=N[h-1],N[h-1]=I}}},13422:S=>{"use strict";S.exports=function(S,D){var z="abcdef".split("").concat(D),e=[];S.indexOf("lo")>=0&&e.push("lo=e[k+n]");S.indexOf("hi")>=0&&e.push("hi=e[k+o]");return z.push(v.replace("_",e.join()).replace("$",S)),Function.apply(void 0,z)};var v="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13398:S=>{"use strict";S.exports=function(S,z){z<=4*v?D(0,z-1,S):E(0,z-1,S)};var v=32;function D(S,v,D){for(var z=2*(S+1),e=S+1;e<=v;++e){for(var N=D[z++],m=D[z++],B=e,g=z-2;B-- >S;){var E=D[g-2],h=D[g-1];if(E<N)break;if(E===N&&h<m)break;D[g]=E,D[g+1]=h,g-=2}D[g]=N,D[g+1]=m}}function z(S,v,D){v*=2;var z=D[S*=2],e=D[S+1];D[S]=D[v],D[S+1]=D[v+1],D[v]=z,D[v+1]=e}function e(S,v,D){v*=2,D[S*=2]=D[v],D[S+1]=D[v+1]}function N(S,v,D,z){v*=2,D*=2;var e=z[S*=2],N=z[S+1];z[S]=z[v],z[S+1]=z[v+1],z[v]=z[D],z[v+1]=z[D+1],z[D]=e,z[D+1]=N}function m(S,v,D,z,e){v*=2,e[S*=2]=e[v],e[v]=D,e[S+1]=e[v+1],e[v+1]=z}function B(S,v,D){v*=2;var z=D[S*=2],e=D[v];return!(z<e)&&(z!==e||D[S+1]>D[v+1])}function g(S,v,D,z){var e=z[S*=2];return e<v||e===v&&z[S+1]<D}function E(S,h,A){var w=(h-S+1)/6|0,n=S+w,R=h-w,O=S+h>>1,I=O-w,K=O+w,q=n,u=I,s=O,r=K,d=R,x=S+1,W=h-1,p=0;B(q,u,A)&&(p=q,q=u,u=p),B(r,d,A)&&(p=r,r=d,d=p),B(q,s,A)&&(p=q,q=s,s=p),B(u,s,A)&&(p=u,u=s,s=p),B(q,r,A)&&(p=q,q=r,r=p),B(s,r,A)&&(p=s,s=r,r=p),B(u,d,A)&&(p=u,u=d,d=p),B(u,s,A)&&(p=u,u=s,s=p),B(r,d,A)&&(p=r,r=d,d=p);for(var b=A[2*u],k=A[2*u+1],Z=A[2*r],i=A[2*r+1],t=2*q,X=2*s,a=2*d,o=2*n,M=2*O,c=2*R,J=0;J<2;++J){var H=A[t+J],T=A[X+J],G=A[a+J];A[o+J]=H,A[M+J]=T,A[c+J]=G}e(I,S,A),e(K,h,A);for(var Y=x;Y<=W;++Y)if(g(Y,b,k,A))Y!==x&&z(Y,x,A),++x;else if(!g(Y,Z,i,A))for(;;){if(g(W,Z,i,A)){g(W,b,k,A)?(N(Y,x,W,A),++x,--W):(z(Y,W,A),--W);break}if(--W<Y)break}m(S,x-1,b,k,A),m(h,W+1,Z,i,A),x-2-S<=v?D(S,x-2,A):E(S,x-2,A),h-(W+2)<=v?D(W+2,h,A):E(W+2,h,A),W-x<=v?D(x,W,A):E(x,W,A)}},13396:(S,v,D)=>{"use strict";S.exports={init:function(S){var v=e.nextPow2(S);g.length<v&&(z.free(g),g=z.mallocInt32(v));E.length<v&&(z.free(E),E=z.mallocInt32(v));h.length<v&&(z.free(h),h=z.mallocInt32(v));A.length<v&&(z.free(A),A=z.mallocInt32(v));w.length<v&&(z.free(w),w=z.mallocInt32(v));n.length<v&&(z.free(n),n=z.mallocInt32(v));var D=8*v;R.length<D&&(z.free(R),R=z.mallocDouble(D))},sweepBipartite:function(S,v,D,z,e,B,w,n,K,q){for(var u=0,s=2*S,r=S-1,d=s-1,x=D;x<z;++x){var W=B[x],p=s*x;R[u++]=e[p+r],R[u++]=-(W+1),R[u++]=e[p+d],R[u++]=W}for(x=w;x<n;++x){W=q[x]+m;var b=s*x;R[u++]=K[b+r],R[u++]=-W,R[u++]=K[b+d],R[u++]=W}var k=u>>>1;N(R,k);var Z=0,i=0;for(x=0;x<k;++x){var t=0|R[2*x+1];if(t>=m)O(h,A,i--,t=t-m|0);else if(t>=0)O(g,E,Z--,t);else if(t<=-m){t=-t-m|0;for(var X=0;X<Z;++X){if(void 0!==(a=v(g[X],t)))return a}I(h,A,i++,t)}else{t=-t-1|0;for(X=0;X<i;++X){var a;if(void 0!==(a=v(t,h[X])))return a}I(g,E,Z++,t)}}},sweepComplete:function(S,v,D,z,e,m,B,K,q,u){for(var s=0,r=2*S,d=S-1,x=r-1,W=D;W<z;++W){var p=m[W]+1<<1,b=r*W;R[s++]=e[b+d],R[s++]=-p,R[s++]=e[b+x],R[s++]=p}for(W=B;W<K;++W){p=u[W]+1<<1;var k=r*W;R[s++]=q[k+d],R[s++]=1|-p,R[s++]=q[k+x],R[s++]=1|p}var Z=s>>>1;N(R,Z);var i=0,t=0,X=0;for(W=0;W<Z;++W){var a=0|R[2*W+1],o=1&a;if(W<Z-1&&a>>1===R[2*W+3]>>1&&(o=2,W+=1),a<0){for(var M=-(a>>1)-1,c=0;c<X;++c){if(void 0!==(J=v(w[c],M)))return J}if(0!==o)for(c=0;c<i;++c){if(void 0!==(J=v(g[c],M)))return J}if(1!==o)for(c=0;c<t;++c){var J;if(void 0!==(J=v(h[c],M)))return J}0===o?I(g,E,i++,M):1===o?I(h,A,t++,M):2===o&&I(w,n,X++,M)}else{M=(a>>1)-1;0===o?O(g,E,i--,M):1===o?O(h,A,t--,M):2===o&&O(w,n,X--,M)}}},scanBipartite:function(S,v,D,z,e,B,h,A,w,n,K,q){var u=0,s=2*S,r=v,d=v+S,x=1,W=1;z?W=m:x=m;for(var p=e;p<B;++p){var b=p+x,k=s*p;R[u++]=h[k+r],R[u++]=-b,R[u++]=h[k+d],R[u++]=b}for(p=w;p<n;++p){b=p+W;var Z=s*p;R[u++]=K[Z+r],R[u++]=-b}var i=u>>>1;N(R,i);var t=0;for(p=0;p<i;++p){var X=0|R[2*p+1];if(X<0){var a=!1;if((b=-X)>=m?(a=!z,b-=m):(a=!!z,b-=1),a)I(g,E,t++,b);else{var o=q[b],M=s*b,c=K[M+v+1],J=K[M+v+1+S];S:for(var H=0;H<t;++H){var T=g[H],G=s*T;if(!(J<h[G+v+1]||h[G+v+1+S]<c)){for(var Y=v+2;Y<S;++Y)if(K[M+Y+S]<h[G+Y]||h[G+Y+S]<K[M+Y])continue S;var j,V=A[T];if(void 0!==(j=z?D(o,V):D(V,o)))return j}}}}else O(g,E,t--,X-x)}},scanComplete:function(S,v,D,z,e,B,E,h,A,w,n){for(var O=0,I=2*S,K=v,q=v+S,u=z;u<e;++u){var s=u+m,r=I*u;R[O++]=B[r+K],R[O++]=-s,R[O++]=B[r+q],R[O++]=s}for(u=h;u<A;++u){s=u+1;var d=I*u;R[O++]=w[d+K],R[O++]=-s}var x=O>>>1;N(R,x);var W=0;for(u=0;u<x;++u){var p=0|R[2*u+1];if(p<0){if((s=-p)>=m)g[W++]=s-m;else{var b=n[s-=1],k=I*s,Z=w[k+v+1],i=w[k+v+1+S];S:for(var t=0;t<W;++t){var X=g[t],a=E[X];if(a===b)break;var o=I*X;if(!(i<B[o+v+1]||B[o+v+1+S]<Z)){for(var M=v+2;M<S;++M)if(w[k+M+S]<B[o+M]||B[o+M+S]<w[k+M])continue S;var c=D(a,b);if(void 0!==c)return c}}}}else{for(s=p-m,t=W-1;t>=0;--t)if(g[t]===s){for(M=t+1;M<W;++M)g[M-1]=g[M];break}--W}}}};var z=D(13377),e=D(13383),N=D(13398),m=1<<28,B=1024,g=z.mallocInt32(B),E=z.mallocInt32(B),h=z.mallocInt32(B),A=z.mallocInt32(B),w=z.mallocInt32(B),n=z.mallocInt32(B),R=z.mallocDouble(8192);function O(S,v,D,z){var e=v[z],N=S[D-1];S[e]=N,v[N]=e}function I(S,v,D,z){S[D]=z,v[z]=D}},13386:S=>{"use strict";function v(S,D,z){var e=0|S[z];if(e<=0)return[];var N,m=new Array(e);if(z===S.length-1)for(N=0;N<e;++N)m[N]=D;else for(N=0;N<e;++N)m[N]=v(S,D,z+1);return m}S.exports=function(S,D){switch("undefined"===typeof D&&(D=0),typeof S){case"number":if(S>0)return function(S,v){var D,z;for(D=new Array(S),z=0;z<S;++z)D[z]=v;return D}(0|S,D);break;case"object":if("number"===typeof S.length)return v(S,D,0)}return[]}},13339:(S,v,D)=>{S.exports=function(){var S=this;this.components={},this.comps=this.components;var v=this.components,D=1,e={},N=[],m=[],B={timeout:!1,removals:[],multiComps:[]};function g(S,D){var z=v[D],N=e[D],m=N.hash[S];m&&(N.remove(S),z.tv&&(z.multi?(m.forEach((v=>{v&&z.tv(S,v)})),m.length=0):z.tv(S,m)),B.removals.push(N),E())}function E(){B.timeout||(B.timeout=!0,setTimeout(h,1))}function h(){B.timeout=!1,A()}function A(){B.multiComps.length&&function(S){for(var v=0;v<S.length;v++){var{entID:D,data:z}=S[v],e=z.hash[D];if(e){for(var N=0;N<e.length;N++)e[N]||(e.splice(N,1),N--);0===e.length&&(z.remove(D),B.removals.push(z))}}S.length=0}(B.multiComps),B.removals.length&&function(S){for(var v=0;v<S.length;v++){S[v].flush()}S.length=0}(B.removals)}this.VA=e,this._systems=N,this._renderSystems=m,this.Oh=function(v){var z=D++;return Array.isArray(v)&&v.forEach((v=>S.Ug(z,v))),z},this.deleteEntity=function(v){return Object.keys(e).forEach((S=>{e[S].hash[v]&&g(v,S)})),S},this.Vh=function(S){if(!S)throw new Error("Missing component definition");var D=S.name;if(!D)throw new Error("Component definition must have a name property.");if("string"!==typeof D)throw new Error("Component name must be a string.");if(""===D)throw new Error("Component name must be a non-empty string.");if(e[D])throw new Error(`Component ${D} already exists.`);var B={};return B.name=D,B.multi=!!S.multi,B.order=isNaN(S.order)?99:S.order,B.stateConstructor=S.stateConstructor||null,B.state=S.state||{},B.bB=S.bB||null,B.tv=S.tv||null,B.system=S.system||null,B.aB=S.aB||null,v[D]=B,e[D]=new z,e[D]._pendingMultiCleanup=!1,e[D]._multiCleanupIDs=B.multi?[]:null,B.system&&(N.push(D),N.sort(((S,D)=>v[S].order-v[D].order))),B.aB&&(m.push(D),m.sort(((S,D)=>v[S].order-v[D].order))),D},this.overwriteComponent=function(S,D){var z=v[S];if(!z)throw new Error(`Unknown component: ${S}`);if(!D)throw new Error("Missing component definition");if(z.name!==D.name)throw new Error("Overwriting component must use the same name property.");var B={};B.name=S,B.multi=!!D.multi,B.order=isNaN(D.order)?99:D.order,B.state=D.state||{},B.bB=D.bB||null,B.tv=D.tv||null,B.system=D.system||null,B.aB=D.aB||null,v[S]=B,e[S]._pendingMultiCleanup=!1,e[S]._multiCleanupIDs=B.multi?[]:null;var g=N.indexOf(S);B.system&&g<0&&N.push(S),!B.system&&g>=0&&N.splice(g,1),N.sort(((S,D)=>v[S].order-v[D].order));var E=m.indexOf(S);B.aB&&E<0&&m.push(S),!B.aB&&E>=0&&m.splice(E,1),m.sort(((S,D)=>v[S].order-v[D].order));var h=B.state;return this.VE(S).forEach((S=>{for(var v in h)v in S||(S[v]=h[v]);B.bB&&B.bB(S.tB,S)})),S},this.deleteComponent=function(D){var z=e[D];if(!z)throw new Error(`Unknown component: ${D}`);z.flush(),z.list.forEach((S=>{S&&g(S.tB||S[0].tB,D)}));var B=N.indexOf(D),E=m.indexOf(D);return B>-1&&N.splice(B,1),E>-1&&m.splice(E,1),e[D].dispose(),delete e[D],delete v[D],S},this.Ug=function(S,D,z){var N,m=v[D],B=e[D];if(!B)throw new Error(`Unknown component: ${D}.`);if(B.hash[S]&&!m.multi)throw new Error(`Entity ${S} already has component: ${D}.`);if(m.stateConstructor){if(!(N=new m.stateConstructor).hasOwnProperty("tB"))throw new Error(`Component ${m.name} stateConstructor type does not have property __id`)}else N=Object.assign({},{tB:S},m.state,z);if(N.tB=S,m.multi){var g=B.hash[S];g||(g=[],B.add(S,g)),g.push(N)}else B.add(S,N);return m.bB&&m.bB(S,N),this},this.zE=function(S,v){var D=e[v];if(!D)throw new Error(`Unknown component: ${v}.`);return!!D.hash[S]},this.lg=function(v,D){if(!e[D])throw new Error(`Unknown component: ${D}.`);return g(v,D),S},this.getState=function(S,v){var D=e[v];if(!D)throw new Error(`Unknown component: ${v}.`);return D.hash[S]},this.VE=function(S){var v=e[S];if(!v)throw new Error(`Unknown component: ${S}.`);return A(),v.list},this.Mn=function(S){if(!e[S])throw new Error(`Unknown component: ${S}.`);var v=e[S].hash;return S=>v[S]},this.Hn=function(S){if(!e[S])throw new Error(`Unknown component: ${S}.`);var v=e[S].hash;return S=>!!v[S]},this.uB=function(D){A();for(var z=0;z<N.length;z++){var m=N[z],B=v[m],g=e[m];B.system(D,g.list),A()}return S},this.render=function(D){A();for(var z=0;z<m.length;z++){var N=m[z],B=v[N],g=e[N];B.aB(D,g.list),A()}return S},this.removeMultiComponent=function(D,z,N){var m=v[z],g=e[z];if(!g)throw new Error(`Unknown component: ${z}.`);if(!m.multi)throw new Error("removeMultiComponent called on non-multi component");return function(S,v,D,z){var e=D.hash[S];if(e){var N=e[z];N&&(e[z]=null,v.tv&&v.tv(S,N),B.multiComps.push({entID:S,data:D}),E())}}(D,m,g,N),S}};var z=D(13348)},13348:S=>{function v(S,v){var D=S._map[v];if(delete S.hash[v],delete S._map[v],D===S.list.length-1)S.list.pop();else{var z=S.list.pop();if(S.list[D]=z,null===z||null===z[0]){var e=S.list.length;for(var N in S._map)if(S._map[N]===e)return void(S._map[N]=D)}else{var m=z.tB||z[0].tB;S._map[m]=D}}}S.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(S,v){if("number"===typeof this._map[S]){var D=this._map[S];this.hash[S]=v,this.list[D]=v}else this._map[S]=this.list.length,this.hash[S]=v,this.list.push(v)}remove(S){var v=this._map[S];this.hash[S]=null,this.list[v]=null,this._pendingRemovals.push(S)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var S=0;S<this._pendingRemovals.length;S++){var D=this._pendingRemovals[S];null===this.hash[D]&&v(this,D)}this._pendingRemovals.length=0}}},13309:S=>{"use strict";var v,D="object"===typeof Reflect?Reflect:null,z=function(S,v,D){return Function.prototype.apply.call(S,v,D)};v=D&&"function"===typeof D.ownKeys?D.ownKeys:Object.getOwnPropertySymbols?function(S){return Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S))}:function(S){return Object.getOwnPropertyNames(S)};var e=Number.isNaN||function(S){return S!==S};function N(){N.init.call(this)}S.exports=N,S.exports.once=function(S,v){return new Promise((function(D,z){function e(D){S.removeListener(v,N),z(D)}function N(){"function"===typeof S.removeListener&&S.removeListener("error",e),D([].slice.call(arguments))}O(S,v,N,{once:!0}),"error"!==v&&function(S,v,D){"function"===typeof S.on&&O(S,"error",v,D)}(S,e,{once:!0})}))},N.EventEmitter=N,N.prototype._events=void 0,N.prototype._eventsCount=0,N.prototype._maxListeners=void 0;var m=10;function B(S){if("function"!==typeof S)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof S)}function g(S){return void 0===S._maxListeners?N.defaultMaxListeners:S._maxListeners}function E(S,v,D,z){var e,N,m,E;if(B(D),void 0===(N=S._events)?(N=S._events=Object.create(null),S._eventsCount=0):(void 0!==N.newListener&&(S.emit("newListener",v,D.listener?D.listener:D),N=S._events),m=N[v]),void 0===m)m=N[v]=D,++S._eventsCount;else if("function"===typeof m?m=N[v]=z?[D,m]:[m,D]:z?m.unshift(D):m.push(D),(e=g(S))>0&&m.length>e&&!m.warned){m.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.zv=S,h.type=v,h.count=m.length,E=h,console&&console.warn&&console.warn(E)}return S}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function A(S,v,D){var z={fired:!1,wrapFn:void 0,target:S,type:v,listener:D},e=h.bind(z);return e.listener=D,z.wrapFn=e,e}function w(S,v,D){var z=S._events;if(void 0===z)return[];var e=z[v];return void 0===e?[]:"function"===typeof e?D?[e.listener||e]:[e]:D?function(S){for(var v=new Array(S.length),D=0;D<v.length;++D)v[D]=S[D].listener||S[D];return v}(e):R(e,e.length)}function n(S){var v=this._events;if(void 0!==v){var D=v[S];if("function"===typeof D)return 1;if(void 0!==D)return D.length}return 0}function R(S,v){for(var D=new Array(v),z=0;z<v;++z)D[z]=S[z];return D}function O(S,v,D,z){if("function"===typeof S.on)z.once?S.once(v,D):S.on(v,D);else{if("function"!==typeof S.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof S);S.addEventListener(v,(function e(N){z.once&&S.removeEventListener(v,e),D(N)}))}}Object.defineProperty(N,"defaultMaxListeners",{enumerable:!0,get:function(){return m},set:function(S){if("number"!==typeof S||S<0||e(S))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+S+".");m=S}}),N.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},N.prototype.setMaxListeners=function(S){if("number"!==typeof S||S<0||e(S))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+S+".");return this._maxListeners=S,this},N.prototype.getMaxListeners=function(){return g(this)},N.prototype.emit=function(S){for(var v=[],D=1;D<arguments.length;D++)v.push(arguments[D]);var e="error"===S,N=this._events;if(void 0!==N)e=e&&void 0===N.error;else if(!e)return!1;if(e){var m;if(v.length>0&&(m=v[0]),m instanceof Error)throw m;var B=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw B.context=m,B}var g=N[S];if(void 0===g)return!1;if("function"===typeof g)z(g,this,v);else{var E=g.length,h=R(g,E);for(D=0;D<E;++D)z(h[D],this,v)}return!0},N.prototype.addListener=function(S,v){return E(this,S,v,!1)},N.prototype.on=N.prototype.addListener,N.prototype.prependListener=function(S,v){return E(this,S,v,!0)},N.prototype.once=function(S,v){return B(v),this.on(S,A(this,S,v)),this},N.prototype.prependOnceListener=function(S,v){return B(v),this.prependListener(S,A(this,S,v)),this},N.prototype.removeListener=function(S,v){var D,z,e,N,m;if(B(v),void 0===(z=this._events))return this;if(void 0===(D=z[S]))return this;if(D===v||D.listener===v)0===--this._eventsCount?this._events=Object.create(null):(delete z[S],z.removeListener&&this.emit("removeListener",S,D.listener||v));else if("function"!==typeof D){for(e=-1,N=D.length-1;N>=0;N--)if(D[N]===v||D[N].listener===v){m=D[N].listener,e=N;break}if(e<0)return this;0===e?D.shift():function(S,v){for(;v+1<S.length;v++)S[v]=S[v+1];S.pop()}(D,e),1===D.length&&(z[S]=D[0]),void 0!==z.removeListener&&this.emit("removeListener",S,m||v)}return this},N.prototype.off=N.prototype.removeListener,N.prototype.ev=function(S){var v,D,z;if(void 0===(D=this._events))return this;if(void 0===D.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==D[S]&&(0===--this._eventsCount?this._events=Object.create(null):delete D[S]),this;if(0===arguments.length){var e,N=Object.keys(D);for(z=0;z<N.length;++z)"removeListener"!==(e=N[z])&&this.ev(e);return this.ev("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(v=D[S]))this.removeListener(S,v);else if(void 0!==v)for(z=v.length-1;z>=0;z--)this.removeListener(S,v[z]);return this},N.prototype.listeners=function(S){return w(this,S,!0)},N.prototype.rawListeners=function(S){return w(this,S,!1)},N.listenerCount=function(S,v){return"function"===typeof S.listenerCount?S.listenerCount(v):n.call(S,v)},N.prototype.listenerCount=n,N.prototype.eventNames=function(){return this._eventsCount>0?v(this._events):[]}},13597:S=>{"use strict";S.exports=function(S,v,D,z,e,N){var m=+v[0],B=+v[1],g=+v[2],E=+D[0],h=+D[1],A=+D[2],w=Math.sqrt(E*E+h*h+A*A);if(0===w)throw new Error("Can't raycast along a zero vector");return function(S,v,D,z,e,N,m,B,g,E){for(var h=0,A=Math.floor,w=0|A(v),n=0|A(D),R=0|A(z),O=e>0?1:-1,I=N>0?1:-1,K=m>0?1:-1,q=Math.abs(1/e),u=Math.abs(1/N),s=Math.abs(1/m),r=q<1/0?q*(O>0?w+1-v:v-w):1/0,d=u<1/0?u*(I>0?n+1-D:D-n):1/0,x=s<1/0?s*(K>0?R+1-z:z-R):1/0,W=-1;h<=B;){var p=S(w,n,R);if(p)return g&&(g[0]=v+h*e,g[1]=D+h*N,g[2]=z+h*m),E&&(E[0]=E[1]=E[2]=0,0===W&&(E[0]=-O),1===W&&(E[1]=-I),2===W&&(E[2]=-K)),p;r<d?r<x?(w+=O,h=r,r+=q,W=0):(R+=K,h=x,x+=s,W=2):d<x?(n+=I,h=d,d+=u,W=1):(R+=K,h=x,x+=s,W=2)}return g&&(g[0]=v+h*e,g[1]=D+h*N,g[2]=z+h*m),E&&(E[0]=E[1]=E[2]=0),0}(S,m,B,g,E/=w,h/=w,A/=w,z="undefined"===typeof z?64:+z,e,N)}},13630:(S,v,D)=>{"use strict";D.d(v,{d:()=>N});var z=D(13309);function e(){this.ow=!1,this.stopPropagation=!1,this.Mw=!1,this.disabled=!1}class N{constructor(S,v){this.version="0.7.0";var D=Object.assign({},new e,v||{});this.element=S||document,this.ow=!!D.ow,this.stopPropagation=!!D.stopPropagation,this.Mw=!!D.Mw,this.disabled=!!D.disabled,this.filterEvents=(S,v)=>!0,this.down=new z.EventEmitter,this.up=new z.EventEmitter,this.state={},this.JE={dx:0,dy:0,xn:0,cE:0,Wn:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?B(this):document.addEventListener("DOMContentLoaded",(S=>{B(this)}),{once:!0})}bind(S){for(var v=arguments.length,D=new Array(v>1?v-1:0),z=1;z<v;z++)D[z-1]=arguments[z];D.forEach((v=>{var D=this._keyBindmap[v]||[];D.includes(S)||(D.push(S),this._keyBindmap[v]=D)})),this.state[S]=!!this.state[S],this.pressCount[S]=this.pressCount[S]||0,this.releaseCount[S]=this.releaseCount[S]||0}unbind(S){for(var v in this._keyBindmap){var D=this._keyBindmap[v],z=D.indexOf(S);z>-1&&D.splice(z,1)}}getBindings(){var S={};for(var v in this._keyBindmap){this._keyBindmap[v].forEach((D=>{S[D]=S[D]||[],S[D].push(v)}))}return S}uB(){m(this.JE),m(this.pressCount),m(this.releaseCount)}}function m(S){for(var v in S)S[v]=0}function B(S){window.addEventListener("keydown",R.bind(null,S,!0),!1),window.addEventListener("keyup",R.bind(null,S,!1),!1);var v={passive:!0};S.element.addEventListener("touchstart",A.bind(void 0,S),{passive:!1}),S.element.addEventListener("touchend",n.bind(void 0,S),v),S.element.addEventListener("mousedown",O.bind(null,S,!0),v),window.document.addEventListener("mouseup",O.bind(null,S,!1),v),S.element.addEventListener("touchmove",I.bind(null,S),v),S.element.addEventListener("mousemove",I.bind(null,S),v),window.PointerEvent,S.element.addEventListener("wheel",K.bind(null,S),v),S.element.addEventListener("contextmenu",q.bind(null,S),!1),window.addEventListener("blur",u.bind(null,S),!1)}var g=0,E=0,h=null;function A(S,v){v.preventDefault(),w(v)}function w(S){let v=!1;for(let D=0;D<S.touches.length;++D)if(S.touches[D].identifier===h){v=!0;break}if(!v){const v=S.changedTouches[0];g=v.clientX,E=v.clientY,h=v.identifier}}function n(S,v){for(var D=v.changedTouches,z=0;z<D.length;++z)D[z].identifier===h&&(h=null)}function R(S,v,D){s(D.code,v,S,D)}function O(S,v,D){if("pointerId"in D)if(v){if(null!==S._touches.currID)return;S._touches.currID=D.pointerId}else{if(S._touches.currID!==D.pointerId)return;S._touches.currID=null}return s("Mouse"+("button"in D?D.button+1:1),v,S,D),!1}function I(S,v){var D=v.movementX||v.mozMovementX||0,z=v.movementY||v.mozMovementY||0;if(v.touches&&0===(D|z)){var e=function(S){w(S);for(let v=0;v<S.changedTouches.length;++v)if(S.changedTouches[v].identifier==h){const D=S.changedTouches[v],z=[D.clientX-g,D.clientY-E];return g=D.clientX,E=D.clientY,z}return console.error(`Did not find touch id ${h}`),[0,0]}(v);D=e[0],z=e[1]}S.JE.dx+=D,S.JE.dy+=z}function K(S,v){var D=1;switch(v.deltaMode){case 0:D=1;break;case 1:D=12;break;case 2:D=S.element.clientHeight||window.innerHeight}S.JE.xn+=(v.deltaX||0)*D,S.JE.cE+=(v.deltaY||0)*D,S.JE.Wn+=(v.deltaZ||0)*D}function q(S,v){if(!S.Mw)return v.preventDefault(),!1}function u(S){for(var v in S._keyStates)S._keyStates[v]&&(/^Mouse\d/.test(v)||s(v,!1,S,{code:v,note:"n8mmrft0uc",preventDefault:()=>{},stopPropagation:()=>{}}))}function s(S,v,D,z){var e=D._keyBindmap[S];e&&(r(D._keyStates[S],v)&&(D._keyStates[S]=v,e.forEach((S=>{(!D.filterEvents||D.filterEvents(z,S))&&function(S,v,D,z){var e=v?D.pressCount:D.releaseCount;e[S]=(e[S]||0)+1;var N=D._bindPressCount[S]||0;(N+=v?1:-1)<0&&(N=0);D._bindPressCount[S]=N;var m=D.state[S];if(r(m,N)){D.state[S]=N>0;var B=v?D.down:D.up;D.disabled||B.emit(S,z)}}(S,v,D,z)}))),"button"in z||(D.ow&&!z.defaultPrevented&&z.preventDefault(),D.stopPropagation&&z.stopPropagation()))}function r(S,v){return S?!v:v}},12268:S=>{S.exports=function(S,v,D){return S[0]=v[0]+D[0],S[1]=v[1]+D[1],S[2]=v[2]+D[2],S}},12232:(S,v,D)=>{S.exports=function(S,v){var D=z(S[0],S[1],S[2]),m=z(v[0],v[1],v[2]);e(D,D),e(m,m);var B=N(D,m);return B>1?0:Math.acos(B)};var z=D(12239),e=D(12242),N=D(12246)},12325:S=>{S.exports=function(S,v){return S[0]=Math.ceil(v[0]),S[1]=Math.ceil(v[1]),S[2]=Math.ceil(v[2]),S}},12226:S=>{S.exports=function(S){var v=new Float32Array(3);return v[0]=S[0],v[1]=S[1],v[2]=S[2],v}},12249:S=>{S.exports=function(S,v){return S[0]=v[0],S[1]=v[1],S[2]=v[2],S}},12224:S=>{S.exports=function(){var S=new Float32Array(3);return S[0]=0,S[1]=0,S[2]=0,S}},12403:S=>{S.exports=function(S,v,D){var z=v[0],e=v[1],N=v[2],m=D[0],B=D[1],g=D[2];return S[0]=e*g-N*B,S[1]=N*m-z*g,S[2]=z*B-e*m,S}},12354:(S,v,D)=>{S.exports=D(12351)},12351:S=>{S.exports=function(S,v){var D=v[0]-S[0],z=v[1]-S[1],e=v[2]-S[2];return Math.sqrt(D*D+z*z+e*e)}},12307:(S,v,D)=>{S.exports=D(12305)},12305:S=>{S.exports=function(S,v,D){return S[0]=v[0]/D[0],S[1]=v[1]/D[1],S[2]=v[2]/D[2],S}},12246:S=>{S.exports=function(S,v){return S[0]*v[0]+S[1]*v[1]+S[2]*v[2]}},12215:S=>{S.exports=1e-6},12259:(S,v,D)=>{S.exports=function(S,v){var D=S[0],e=S[1],N=S[2],m=v[0],B=v[1],g=v[2];return Math.abs(D-m)<=z*Math.max(1,Math.abs(D),Math.abs(m))&&Math.abs(e-B)<=z*Math.max(1,Math.abs(e),Math.abs(B))&&Math.abs(N-g)<=z*Math.max(1,Math.abs(N),Math.abs(g))};var z=D(12215)},12265:S=>{S.exports=function(S,v){return S[0]===v[0]&&S[1]===v[1]&&S[2]===v[2]}},12319:S=>{S.exports=function(S,v){return S[0]=Math.floor(v[0]),S[1]=Math.floor(v[1]),S[2]=Math.floor(v[2]),S}},12456:(S,v,D)=>{S.exports=function(S,v,D,e,N,m){var B,g;v||(v=3);D||(D=0);g=e?Math.min(e*v+D,S.length):S.length;for(B=D;B<g;B+=v)z[0]=S[B],z[1]=S[B+1],z[2]=S[B+2],N(z,z,m),S[B]=z[0],S[B+1]=z[1],S[B+2]=z[2];return S};var z=D(12224)()},12239:S=>{S.exports=function(S,v,D){var z=new Float32Array(3);return z[0]=S,z[1]=v,z[2]=D,z}},12213:(S,v,D)=>{S.exports={EPSILON:D(12215),create:D(12224),clone:D(12226),angle:D(12232),hB:D(12239),j:D(12249),set:D(12256),equals:D(12259),exactEquals:D(12265),add:D(12268),Ov:D(12277),sub:D(12283),multiply:D(12287),mul:D(12296),divide:D(12305),div:D(12307),min:D(12313),max:D(12315),floor:D(12319),ceil:D(12325),round:D(12327),scale:D(12336),AB:D(12343),distance:D(12351),k:D(12354),squaredDistance:D(12363),sqrDist:D(12369),length:D(12372),len:D(12376),squaredLength:D(12378),wB:D(12384),negate:D(12390),inverse:D(12394),normalize:D(12242),dot:D(12246),cross:D(12403),BB:D(12410),random:D(12413),transformMat4:D(12418),transformMat3:D(12422),transformQuat:D(12431),nB:D(12438),RB:D(12447),OB:D(12452),forEach:D(12456)}},12394:S=>{S.exports=function(S,v){return S[0]=1/v[0],S[1]=1/v[1],S[2]=1/v[2],S}},12376:(S,v,D)=>{S.exports=D(12372)},12372:S=>{S.exports=function(S){var v=S[0],D=S[1],z=S[2];return Math.sqrt(v*v+D*D+z*z)}},12410:S=>{S.exports=function(S,v,D,z){var e=v[0],N=v[1],m=v[2];return S[0]=e+z*(D[0]-e),S[1]=N+z*(D[1]-N),S[2]=m+z*(D[2]-m),S}},12315:S=>{S.exports=function(S,v,D){return S[0]=Math.max(v[0],D[0]),S[1]=Math.max(v[1],D[1]),S[2]=Math.max(v[2],D[2]),S}},12313:S=>{S.exports=function(S,v,D){return S[0]=Math.min(v[0],D[0]),S[1]=Math.min(v[1],D[1]),S[2]=Math.min(v[2],D[2]),S}},12296:(S,v,D)=>{S.exports=D(12287)},12287:S=>{S.exports=function(S,v,D){return S[0]=v[0]*D[0],S[1]=v[1]*D[1],S[2]=v[2]*D[2],S}},12390:S=>{S.exports=function(S,v){return S[0]=-v[0],S[1]=-v[1],S[2]=-v[2],S}},12242:S=>{S.exports=function(S,v){var D=v[0],z=v[1],e=v[2],N=D*D+z*z+e*e;N>0&&(N=1/Math.sqrt(N),S[0]=v[0]*N,S[1]=v[1]*N,S[2]=v[2]*N);return S}},12413:S=>{S.exports=function(S,v){v=v||1;var D=2*Math.random()*Math.PI,z=2*Math.random()-1,e=Math.sqrt(1-z*z)*v;return S[0]=Math.cos(D)*e,S[1]=Math.sin(D)*e,S[2]=z*v,S}},12438:S=>{S.exports=function(S,v,D,z){var e=D[1],N=D[2],m=v[1]-e,B=v[2]-N,g=Math.sin(z),E=Math.cos(z);return S[0]=v[0],S[1]=e+m*E-B*g,S[2]=N+m*g+B*E,S}},12447:S=>{S.exports=function(S,v,D,z){var e=D[0],N=D[2],m=v[0]-e,B=v[2]-N,g=Math.sin(z),E=Math.cos(z);return S[0]=e+B*g+m*E,S[1]=v[1],S[2]=N+B*E-m*g,S}},12452:S=>{S.exports=function(S,v,D,z){var e=D[0],N=D[1],m=v[0]-e,B=v[1]-N,g=Math.sin(z),E=Math.cos(z);return S[0]=e+m*E-B*g,S[1]=N+m*g+B*E,S[2]=v[2],S}},12327:S=>{S.exports=function(S,v){return S[0]=Math.round(v[0]),S[1]=Math.round(v[1]),S[2]=Math.round(v[2]),S}},12336:S=>{S.exports=function(S,v,D){return S[0]=v[0]*D,S[1]=v[1]*D,S[2]=v[2]*D,S}},12343:S=>{S.exports=function(S,v,D,z){return S[0]=v[0]+D[0]*z,S[1]=v[1]+D[1]*z,S[2]=v[2]+D[2]*z,S}},12256:S=>{S.exports=function(S,v,D,z){return S[0]=v,S[1]=D,S[2]=z,S}},12369:(S,v,D)=>{S.exports=D(12363)},12384:(S,v,D)=>{S.exports=D(12378)},12363:S=>{S.exports=function(S,v){var D=v[0]-S[0],z=v[1]-S[1],e=v[2]-S[2];return D*D+z*z+e*e}},12378:S=>{S.exports=function(S){var v=S[0],D=S[1],z=S[2];return v*v+D*D+z*z}},12283:(S,v,D)=>{S.exports=D(12277)},12277:S=>{S.exports=function(S,v,D){return S[0]=v[0]-D[0],S[1]=v[1]-D[1],S[2]=v[2]-D[2],S}},12422:S=>{S.exports=function(S,v,D){var z=v[0],e=v[1],N=v[2];return S[0]=z*D[0]+e*D[3]+N*D[6],S[1]=z*D[1]+e*D[4]+N*D[7],S[2]=z*D[2]+e*D[5]+N*D[8],S}},12418:S=>{S.exports=function(S,v,D){var z=v[0],e=v[1],N=v[2],m=D[3]*z+D[7]*e+D[11]*N+D[15];return m=m||1,S[0]=(D[0]*z+D[4]*e+D[8]*N+D[12])/m,S[1]=(D[1]*z+D[5]*e+D[9]*N+D[13])/m,S[2]=(D[2]*z+D[6]*e+D[10]*N+D[14])/m,S}},12431:S=>{S.exports=function(S,v,D){var z=v[0],e=v[1],N=v[2],m=D[0],B=D[1],g=D[2],E=D[3],h=E*z+B*N-g*e,A=E*e+g*z-m*N,w=E*N+m*e-B*z,n=-m*z-B*e-g*N;return S[0]=h*E+n*-m+A*-g-w*-B,S[1]=A*E+n*-B+w*-m-h*-g,S[2]=w*E+n*-g+h*-B-A*-m,S}},13324:S=>{"use strict";S.exports=function(S){for(var v=new Array(S),D=0;D<S;++D)v[D]=D;return v}},13388:S=>{S.exports=function(S){return null!=S&&null!=S.constructor&&"function"===typeof S.constructor.isBuffer&&S.constructor.isBuffer(S)}},13603:(S,v,D)=>{"use strict";D.d(v,{e:()=>z});class z{constructor(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.RA=!1,this.OA=!1,this.wA=30,this.nA=0,this.xA=!1,this.fullscreen=!1,this.KA=function(S){},this.qA=function(){},this.rA=function(){},this.CD=function(){},this.uA=function(S){},this.onFullscreenChanged=function(S){},E((()=>{!function(S,v){S._nowObject=performance||Date,S._lastTick=0,S._renderAccum=0,S._rt=0,S._frameCB=B.bind(null,S),requestAnimationFrame(S._frameCB),v>0&&(S._intervalCB=m.bind(null,S),S._interval=setInterval(S._intervalCB,Math.max(v,1e3/S.wA/2)))}(this,v),function(S,v){if(!v)return;var D=!1,z=!1;document.addEventListener("pointerlockchange",(z=>{D=document.pointerLockElement===v,S.uA(D)})),document.addEventListener("fullscreenchange",(D=>{z=document.fullscreenElement===v,S.onFullscreenChanged(z)})),Object.defineProperty(S,"xA",{get:()=>D,set:S=>{S&&!D?g(v):D&&!S&&function(S){S.exitPointerLock&&S.exitPointerLock()}(document)}}),Object.defineProperty(S,"fullscreen",{get:()=>z,set:S=>{S&&!z?v.requestFullscreen():z&&!S&&document.exitFullscreen()}}),v.addEventListener("click",(e=>{S.RA&&!D&&g(v),S.OA&&!z&&v.requestFullscreen()}));var e=()=>S.CD();if(window.ResizeObserver){new ResizeObserver(e).observe(v)}else window.addEventListener("resize",e)}(this,S),this.rA()}))}}var e=3,N=20;function m(S){for(var v=1e3/S.wA,D=S._nowObject.now()+N,z=0;S._nowObject.now()>=S._lastTick+v&&S._nowObject.now()<D&&++z<=e;)S.KA(v),S._lastTick+=v;var m=5*(v+5),B=S._nowObject.now();if(B-S._lastTick>m)for(;B>=S._lastTick+v;)S._lastTick+=v}function B(S){requestAnimationFrame(S._frameCB),m(S);var v=S._nowObject.now(),D=v-S._rt;if(S._rt=v,S.nA>0){S._renderAccum+=D;var z=1e3/S.nA;if(S._renderAccum<z)return;S._renderAccum=Math.min(S._renderAccum-z,z)}var e=1e3/S.wA,N=(v-S._lastTick)/e;S.qA(D,N,e)}function g(S){S.requestPointerLock&&S.requestPointerLock()}var E=S=>{if("loading"===document.readyState){var v=()=>{document.removeEventListener("readystatechange",v),S()};document.addEventListener("readystatechange",v)}else setTimeout(S,1)}},13321:(S,v,D)=>{var z=D(13324),e=D(13328),N="undefined"!==typeof Float64Array;function m(S,v){return S[0]-v[0]}function B(){var S,v=this.stride,D=new Array(v.length);for(S=0;S<D.length;++S)D[S]=[Math.abs(v[S]),S];D.sort(m);var z=new Array(D.length);for(S=0;S<z.length;++S)z[S]=D[S][1];return z}function g(S,v){var D=["View",v,"d",S].join("");v<0&&(D="View_Nil"+S);var e="generic"===S;if(-1===v){var N="function "+D+"(a){this.data=a;};var proto="+D+".prototype;proto.dtype='"+S+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+D+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+D+"(a){return new "+D+"(a);}";return new Function(N)()}if(0===v){N="function "+D+"(a,d) {this.data = a;this.offset = d};var proto="+D+".prototype;proto.dtype='"+S+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+D+"_copy() {return new "+D+"(this.data,this.offset)};proto.pick=function "+D+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+D+"_get(){return "+(e?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+D+"_set(v){return "+(e?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+D+"(a,b,c,d){return new "+D+"(a,d)}";return new Function("TrivialArray",N)(E[S][0])}N=["'use strict'"];var m=z(v),g=m.map((function(S){return"i"+S})),h="this.offset+"+m.map((function(S){return"this.stride["+S+"]*i"+S})).join("+"),A=m.map((function(S){return"b"+S})).join(","),w=m.map((function(S){return"c"+S})).join(",");N.push("function "+D+"(a,"+A+","+w+",d){this.data=a","this.shape=["+A+"]","this.stride=["+w+"]","this.offset=d|0}","var proto="+D+".prototype","proto.dtype='"+S+"'","proto.dimension="+v),N.push("Object.defineProperty(proto,'size',{get:function "+D+"_size(){return "+m.map((function(S){return"this.shape["+S+"]"})).join("*"),"}})"),1===v?N.push("proto.order=[0]"):(N.push("Object.defineProperty(proto,'order',{get:"),v<4?(N.push("function "+D+"_order(){"),2===v?N.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===v&&N.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):N.push("ORDER})")),N.push("proto.set=function "+D+"_set("+g.join(",")+",v){"),e?N.push("return this.data.set("+h+",v)}"):N.push("return this.data["+h+"]=v}"),N.push("proto.get=function "+D+"_get("+g.join(",")+"){"),e?N.push("return this.data.get("+h+")}"):N.push("return this.data["+h+"]}"),N.push("proto.index=function "+D+"_index(",g.join(),"){return "+h+"}"),N.push("proto.hi=function "+D+"_hi("+g.join(",")+"){return new "+D+"(this.data,"+m.map((function(S){return["(typeof i",S,"!=='number'||i",S,"<0)?this.shape[",S,"]:i",S,"|0"].join("")})).join(",")+","+m.map((function(S){return"this.stride["+S+"]"})).join(",")+",this.offset)}");var n=m.map((function(S){return"a"+S+"=this.shape["+S+"]"})),R=m.map((function(S){return"c"+S+"=this.stride["+S+"]"}));N.push("proto.lo=function "+D+"_lo("+g.join(",")+"){var b=this.offset,d=0,"+n.join(",")+","+R.join(","));for(var O=0;O<v;++O)N.push("if(typeof i"+O+"==='number'&&i"+O+">=0){d=i"+O+"|0;b+=c"+O+"*d;a"+O+"-=d}");N.push("return new "+D+"(this.data,"+m.map((function(S){return"a"+S})).join(",")+","+m.map((function(S){return"c"+S})).join(",")+",b)}"),N.push("proto.step=function "+D+"_step("+g.join(",")+"){var "+m.map((function(S){return"a"+S+"=this.shape["+S+"]"})).join(",")+","+m.map((function(S){return"b"+S+"=this.stride["+S+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(O=0;O<v;++O)N.push("if(typeof i"+O+"==='number'){d=i"+O+"|0;if(d<0){c+=b"+O+"*(a"+O+"-1);a"+O+"=ceil(-a"+O+"/d)}else{a"+O+"=ceil(a"+O+"/d)}b"+O+"*=d}");N.push("return new "+D+"(this.data,"+m.map((function(S){return"a"+S})).join(",")+","+m.map((function(S){return"b"+S})).join(",")+",c)}");var I=new Array(v),K=new Array(v);for(O=0;O<v;++O)I[O]="a[i"+O+"]",K[O]="b[i"+O+"]";N.push("proto.transpose=function "+D+"_transpose("+g+"){"+g.map((function(S,v){return S+"=("+S+"===undefined?"+v+":"+S+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+D+"(this.data,"+I.join(",")+","+K.join(",")+",this.offset)}"),N.push("proto.pick=function "+D+"_pick("+g+"){var a=[],b=[],c=this.offset");for(O=0;O<v;++O)N.push("if(typeof i"+O+"==='number'&&i"+O+">=0){c=(c+this.stride["+O+"]*i"+O+")|0}else{a.push(this.shape["+O+"]);b.push(this.stride["+O+"])}");return N.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),N.push("return function construct_"+D+"(data,shape,stride,offset){return new "+D+"(data,"+m.map((function(S){return"shape["+S+"]"})).join(",")+","+m.map((function(S){return"stride["+S+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",N.join("\n"))(E[S],B)}var E={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};S.exports=function(S,v,D,z){if(void 0===S)return(0,E.array[0])([]);"number"===typeof S&&(S=[S]),void 0===v&&(v=[S.length]);var m=v.length;if(void 0===D){D=new Array(m);for(var B=m-1,h=1;B>=0;--B)D[B]=h,h*=v[B]}if(void 0===z){z=0;for(B=0;B<m;++B)D[B]<0&&(z-=(v[B]-1)*D[B])}for(var A=function(S){if(e(S))return"buffer";if(N)switch(Object.prototype.toString.call(S)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(S)?"array":"generic"}(S),w=E[A];w.length<=m+1;)w.push(g(A,w.length-1));return(0,w[m+1])(S,v,D,z)}},13328:S=>{function v(S){return!!S.constructor&&"function"===typeof S.constructor.isBuffer&&S.constructor.isBuffer(S)}S.exports=function(S){return null!=S&&(v(S)||function(S){return"function"===typeof S.readFloatLE&&"function"===typeof S.slice&&v(S.slice(0,0))}(S)||!!S._isBuffer)}},13464:S=>{"use strict";var v=[],D=[],z=[],e=[],N=[],m=[],B=[],g=[],E=[],h=[],A=[],w=[];S.exports=function(S,n,R,O,I,K){for(var q=B,u=E,s=h,r=w,d=0;d<3;d++)q[d]=+R[d],s[d]=+n.max[d],u[d]=+n.base[d];K||(K=1e-10);var x=function(S,B,E,h,w,n){var R=v,O=D,I=z,K=e,q=N,u=m,s=g,r=Math.floor,d=0,x=0,W=0,p=0,b=0;if(k(),0===W)return 0;for(p=t();x<=W;){if(Z(p)&&i())return d;p=t()}for(d+=W,b=0;b<3;b++)h[b]+=E[b],w[b]+=E[b];return d;function k(){if(x=0,0!==(W=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2])))for(var S=0;S<3;S++){var v=E[S]>=0;K[S]=v?1:-1;var D=v?w[S]:h[S];R[S]=v?h[S]:w[S],O[S]=X(D,K[S]),I[S]=a(R[S],K[S]),s[S]=E[S]/W,q[S]=Math.abs(1/s[S]);var z=v?O[S]+1-D:D-O[S];u[S]=q[S]<1/0?q[S]*z:1/0}}function Z(v){for(var D=K[0],z=0===v?O[0]:I[0],e=O[0]+D,N=K[1],m=1===v?O[1]:I[1],B=O[1]+N,g=K[2],E=2===v?O[2]:I[2],h=O[2]+g,A=z;A!=e;A+=D)for(var w=m;w!=B;w+=N)for(var n=E;n!=h;n+=g)if(S(A,w,n))return!0;return!1}function i(){d+=x;var S=K[p],v=x/W,D=A;for(b=0;b<3;b++){var z=E[b]*v;h[b]+=z,w[b]+=z,D[b]=E[b]-z}if(S>0?w[p]=Math.round(w[p]):h[p]=Math.round(h[p]),B(d,p,S,D))return!0;for(b=0;b<3;b++)E[b]=D[b];return k(),0===W}function t(){var S=u[0]<u[1]?u[0]<u[2]?0:2:u[1]<u[2]?1:2,v=u[S]-x;for(x=u[S],O[S]+=K[S],u[S]+=q[S],b=0;b<3;b++)R[b]+=v*s[b],I[b]=a(R[b],K[b]);return S}function X(S,v){return r(S-v*n)}function a(S,v){return r(S+v*n)}}(S,O,q,u,s,K);if(!I){for(d=0;d<3;d++)r[d]=R[d]>0?s[d]-n.max[d]:u[d]-n.base[d];n.translate(r)}return x}},13637:(S,v,D)=>{"use strict";D.d(v,{c:()=>A});var z=D(13457),e=D(12213);class N{constructor(S,v,D,N,m,B,g){this.jE=new z(S.base,S.Ah),this.kz=v,this.friction=D,this.restitution=N,this.SB=m,this.fn=B,this.vB=!!g,this.hh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.aR=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.qE=e.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=e.create(),this._impulses=e.create(),this._sleepFrameCount=10}loadFromCopy(S){e.j(this.jE.base,S.jE.base),e.j(this.jE.Ah,S.jE.Ah),e.j(this.jE.max,S.jE.max),this.jE.mag=S.jE.mag,this.kz=S.kz,this.friction=S.friction,this.restitution=S.restitution,this.SB=S.SB,this.fn=S.fn,this.vB=S.vB,this.hh=S.hh,this.fluidDrag=S.fluidDrag,this.aR=S.aR,this.preventFallOffEdge=S.preventFallOffEdge,this.rolledBackLastTick=S.rolledBackLastTick,e.j(this.qE,S.qE),e.j(this.resting,S.resting),this.inFluid=S.inFluid,this._ratioInFluid=S._ratioInFluid,e.j(this._forces,S._forces),e.j(this._impulses,S._impulses),this._sleepFrameCount=S._sleepFrameCount}setPosition(S){m(S),e.Ov(S,S,this.jE.base),this.jE.translate(S),this.rE()}mz(){return e.clone(this.jE.base)}applyForce(S){m(S),e.add(this._forces,this._forces,S),this.rE()}applyImpulse(S){m(S),e.add(this._impulses,this._impulses,S),this.rE()}rE(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var m=S=>{};var B=D(13457),g=D(12213),E=D(13464);function h(){this.hh=.1,this.fluidDrag=.4,this.mB=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function A(S,v,D){S=Object.assign(new h,S),this.gravity=S.gravity||[0,-10,0],this.hh=S.hh||.1,this.mB=S.mB||2,this.fluidDrag=S.fluidDrag||.4,this.minBounceImpulse=S.minBounceImpulse,this.bodies=[],this.nn=S.nn,this.testSolid=v,this.testFluid=D}A.prototype.SR=function(S,v,D,z,e,m){S=S||new B([0,0,0],[1,1,1]),"undefined"==typeof v&&(v=1),"undefined"==typeof D&&(D=1),"undefined"==typeof z&&(z=0),"undefined"==typeof e&&(e=1);var g=new N(S,v,D,z,e,m);return this.bodies.push(g),g},A.prototype.vR=function(S){var v=this.bodies.indexOf(S);v<0||(this.bodies.splice(v,1),S.jE=S.fn=null)};var w=g.create(),n=g.create(),R=g.create(),O=g.create(),I=g.create(),K=g.create(),q=g.create(),u=new B([0,0,0],[1,1,1]),s=new N(u,1,1,0,1,(()=>{}),!1);function r(S,v,D){return v=D,v*=1-(1-S.ratioInFluid)**2}A.prototype.uB=function(S){S/=1e3;var v=H(0,g.squaredLength(this.gravity));this.bodies.forEach((D=>function(S,v,D,z){g.j(I,v.resting),S.nn&&s.loadFromCopy(v);if(v.kz<=0)return g.set(v.qE,0,0,0),g.set(v._forces,0,0,0),void g.set(v._impulses,0,0,0);var e=z||0===v.SB;if(function(S,v,D,z){if(v._sleepFrameCount>0)return!1;if(z)return!0;var e=!1,N=.5*D*D*v.SB;return g.scale(J,S.gravity,N),E(S.testSolid,v.jE,J,(function(){return e=!0,!0}),!0),e}(S,v,D,e))return;v._sleepFrameCount--,function(S,v){var D=v.jE,z=Math.floor(D.base[0]),e=Math.floor(D.base[2]),N=Math.floor(D.base[1]),m=Math.floor(D.max[1]);if(!S.testFluid(z,N,e))return v.inFluid=!1,void(v.ratioInFluid=0);var B=1,E=N+1;for(;E<=m&&S.testFluid(z,E,e);)B++,E++;var h=(N+B-D.base[1])/D.Ah[1];h>1&&(h=1);var A=D.Ah[0]*D.Ah[1]*D.Ah[2]*h,w=x;g.scale(w,S.gravity,-S.mB*A*v.SB),v.applyForce(w),v.inFluid=!0,v.ratioInFluid=h}(S,v),G(v._forces),G(v._impulses),G(v.qE),G(v.resting),g.scale(w,v._forces,1/v.kz),g.AB(w,w,S.gravity,v.SB),g.scale(n,v._impulses,1/v.kz),g.AB(n,n,w,D),g.add(v.qE,v.qE,n),v.friction&&(W(S,0,v,n,D),W(S,1,v,n,D),W(S,2,v,n,D));var N=v.fluidDrag>=0?v.fluidDrag:S.fluidDrag,m=v.hh>=0?v.hh:S.hh,B=m,h=m;v.inFluid&&(B=r(v,B,v.fluidDragHoriz>=0?v.fluidDragHoriz:N),h=r(v,h,v.fluidDragVert>=0?v.fluidDragVert:N));B=Math.max(1-B*D/v.kz,0),h=Math.max(1-h*D/v.kz,0),g.set(d,B,h,B),g.multiply(v.qE,v.qE,d),g.scale(R,v.qE,D),g.set(v._forces,0,0,0),g.set(v._impulses,0,0,0),v.vB&&T(k,v.jE);g.j(K,R),g.set(q,0,0,0),v.preventFallOffEdge&&function(S,v,D,z){if(!v.resting[1]||D[1]>0)return;var e=o;T(e,v.jE);for(var N=0;N<3;N+=2){g.set(a,0,0,0),a[N]=D[N];var m=!0;(m=(m=(m=(m=m&&!c(S,e.base[0]+a[0]+1e-5,e.base[1],e.base[2]+a[2]+1e-5))&&!c(S,e.max[0]+a[0]-1e-5,e.base[1],e.base[2]+a[2]+1e-5))&&!c(S,e.base[0]+a[0]+1e-5,e.base[1],e.max[2]+a[2]-1e-5))&&!c(S,e.max[0]+a[0]-1e-5,e.base[1],e.max[2]+a[2]-1e-5))?(z[N]=D[N]>0?1:-1,D[N]=0):0===N&&(g.set(M,D[0],0,0),b(S,e,M,z,v.slideOnCollision))}}(S,v,R,q);b(S,v.jE,R,v.resting,v.slideOnCollision),v.vB&&function(S,v,D,z){if(v.resting[1]>=0&&!v.inFluid)return;var e=0!==v.resting[0],N=0!==v.resting[2];if(!e&&!N)return;var m=Math.abs(z[0]/z[2]),B=4;if(!e&&m>B)return;if(!N&&m<1/B)return;g.add(i,D.base,z);var h=S.testSolid;E(h,D,z,(function(S,v,D,z){if(1!==v)return!0;z[v]=0}));var A=D.base[1],w=v.inFluid?1.951:1.001,n=Math.floor(A+w)-A;g.set(t,0,n,0);var R=!1;if(E(h,D,t,(function(S,v,D,z){return R=!0,!0})),R)return;g.Ov(X,i,D.base),X[1]=0,b(S,D,X,Z,!0);var O=H(D.base[0],i[0]),I=H(D.base[2],i[2]);if(e&&!O&&(!I||!N))return;if(N&&(!O||!e)&&!I)return;var K=!0;if(K=K&&!c(S,D.base[0]+1e-5,D.base[1],D.base[2]+1e-5),K=K&&!c(S,D.max[0]-1e-5,D.base[1],D.base[2]+1e-5),K=K&&!c(S,D.base[0]+1e-5,D.base[1],D.max[2]-1e-5),K=K&&!c(S,D.max[0]-1e-5,D.base[1],D.max[2]-1e-5),K)return;T(v.jE,D),v.resting[0]=Z[0],v.resting[2]=Z[2],v.aR&&v.aR()}(S,v,k,K);for(var A=0;A<3;++A)v.resting[A]=v.resting[A]||q[A],O[A]=0,v.resting[A]&&(I[A]||(O[A]=-v.qE[A]),v.qE[A]=0);var u=g.length(O);u>.001&&(g.scale(O,O,v.kz),v.fn&&v.fn(O),v.restitution>0&&u>S.minBounceImpulse&&(g.scale(O,O,v.restitution),v.applyImpulse(O)));var p=g.squaredLength(v.qE);p>1e-5&&v.rE();S.nn&&S.nn(v)?(v.loadFromCopy(s),v.rolledBackLastTick=!0):v.rolledBackLastTick=!1}(this,D,S,v)))};var d=g.create([0,0,0]);var x=g.create();function W(S,v,D,z,e){var N=D.resting[v],m=z[v];if(!D.alwaysApplyHorizFriction||1!==v){if(0===N)return;if(N*m<=0)return}g.j(p,D.qE),p[v]=0;var B=g.length(p);if(!H(B,0)){var E=Math.abs(D.friction*S.gravity[v]*e),h=B>E?(B-E)/B:0;D.qE[(v+1)%3]*=h,D.qE[(v+2)%3]*=h}}var p=g.create();function b(S,v,D,z,e){return g.set(z,0,0,0),E(S.testSolid,v,D,(function(S,v,D,N){z[v]=D,N[v]=0,e||(N[0]=0,N[1]=0,N[2]=0)}))}var k=new B([],[]),Z=g.create(),i=g.create(),t=g.create(),X=g.create();var a=g.create(),o=new B([],[]),M=g.create();function c(S,v,D,z){return S.testSolid(Math.floor(v),Math.floor(D-1),Math.floor(z))}var J=g.create();function H(S,v){return Math.abs(S-v)<1e-5}function T(S,v){for(var D=0;D<3;D++)S.base[D]=v.base[D],S.max[D]=v.max[D],S.Ah[D]=v.Ah[D]}var G=function(S){}},12045:function(S,v){!function(S){"use strict";var v=function(S,D){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,v){S.__proto__=v}||function(S,v){for(var D in v)Object.prototype.hasOwnProperty.call(v,D)&&(S[D]=v[D])},v(S,D)};function D(S,D){if("function"!==typeof D&&null!==D)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function z(){this.constructor=S}v(S,D),S.prototype=null===D?Object.create(D):(z.prototype=D.prototype,new z)}function z(S,v,D,z){var e,N=arguments.length,m=N<3?v:null===z?z=Object.getOwnPropertyDescriptor(v,D):z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)m=Reflect.decorate(S,v,D,z);else for(var B=S.length-1;B>=0;B--)(e=S[B])&&(m=(N<3?e(m):N>3?e(v,D,m):e(v,D))||m);return N>3&&m&&Object.defineProperty(v,D,m),m}function e(S,v,D){if(D||2===arguments.length)for(var z,e=0,N=v.length;e<N;e++)!z&&e in v||(z||(z=Array.prototype.slice.call(v,0,e)),z[e]=v[e]);return S.concat(z||Array.prototype.slice.call(v))}var N,m=255,B=213;S.OPERATION=void 0,(N=S.OPERATION||(S.OPERATION={}))[N.ADD=128]="ADD",N[N.REPLACE=0]="REPLACE",N[N.DELETE=64]="DELETE",N[N.DELETE_AND_ADD=192]="DELETE_AND_ADD",N[N.TOUCH=1]="TOUCH",N[N.CLEAR=10]="CLEAR";var g=function(){function v(S,v,D){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=S,this.setParent(v,D)}return v.prototype.setParent=function(S,v,D){var z=this;if(this.indexes||(this.indexes=this.ref instanceof XS?this.ref._definition.indexes:{}),this.parent=S,this.parentIndex=D,v)if(this.root=v,this.ref instanceof XS){var e=this.ref._definition;for(var N in e.schema){var m=this.ref[N];if(m&&m.$changes){var B=e.indexes[N];m.$changes.setParent(this.ref,v,B)}}}else"object"===typeof this.ref&&this.ref.forEach((function(S,v){if(S instanceof XS){var D=S.$changes,e=z.ref.$changes.indexes[v];D.setParent(z.ref,z.root,e)}}))},v.prototype.operation=function(S){this.changes.set(--this.currentCustomOperation,S)},v.prototype.change=function(v,D){void 0===D&&(D=S.OPERATION.ADD);var z="number"===typeof v?v:this.indexes[v];this.assertValidIndex(z,v);var e=this.changes.get(z);e&&e.op!==S.OPERATION.DELETE&&e.op!==S.OPERATION.TOUCH||this.changes.set(z,{op:e&&e.op===S.OPERATION.DELETE?S.OPERATION.DELETE_AND_ADD:D,index:z}),this.allChanges.add(z),this.changed=!0,this.touchParents()},v.prototype.touch=function(v){var D="number"===typeof v?v:this.indexes[v];this.assertValidIndex(D,v),this.changes.has(D)||this.changes.set(D,{op:S.OPERATION.TOUCH,index:D}),this.allChanges.add(D),this.touchParents()},v.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},v.prototype.getType=function(S){if(this.ref._definition)return(v=this.ref._definition).schema[v.fieldsByIndex[S]];var v,D=(v=this.parent._definition).schema[v.fieldsByIndex[this.parentIndex]];return Object.values(D)[0]},v.prototype.getChildrenFilter=function(){var S=this.parent._definition.childFilters;return S&&S[this.parentIndex]},v.prototype.getValue=function(S){return this.ref.getByIndex(S)},v.prototype.delete=function(v){var D="number"===typeof v?v:this.indexes[v];if(void 0!==D){var z=this.getValue(D);this.changes.set(D,{op:S.OPERATION.DELETE,index:D}),this.allChanges.delete(D),delete this.caches[D],z&&z.$changes&&(z.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(v," (").concat(D,")"))},v.prototype.discard=function(v,D){var z=this;void 0===v&&(v=!1),void 0===D&&(D=!1),this.ref instanceof XS||this.changes.forEach((function(v){if(v.op===S.OPERATION.DELETE){var D=z.ref.getIndex(v.index);delete z.indexes[D]}})),this.changes.clear(),this.changed=v,D&&this.allChanges.clear(),this.currentCustomOperation=0},v.prototype.discardAll=function(){var S=this;this.changes.forEach((function(v){var D=S.getValue(v.index);D&&D.$changes&&D.$changes.discardAll()})),this.discard()},v.prototype.cache=function(S,v){this.caches[S]=v},v.prototype.clone=function(){return new v(this.ref,this.parent,this.root)},v.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},v.prototype.assertValidIndex=function(S,v){if(void 0===S)throw new Error('ChangeTree: missing index for field "'.concat(v,'"'))},v}();function E(S,v,D,z){return S[v]||(S[v]=[]),S[v].push(D),null===z||void 0===z||z.forEach((function(S,v){return D(S,v)})),function(){return A(S[v],S[v].indexOf(D))}}function h(v){var D=this,z="string"!==typeof this.$changes.getType();this.$items.forEach((function(e,N){v.push({refId:D.$changes.refId,op:S.OPERATION.DELETE,field:N,value:void 0,previousValue:e}),z&&D.$changes.root.removeRef(e.$changes.refId)}))}function A(S,v){if(-1===v||v>=S.length)return!1;for(var D=S.length-1,z=v;z<D;z++)S[z]=S[z+1];return S.length=D,!0}var w=function(S,v){var D=S.toString(),z=v.toString();return D<z?-1:D>z?1:0};function n(S){return S.$proxy=!0,S=new Proxy(S,{get:function(S,v){return"symbol"===typeof v||isNaN(v)?S[v]:S.at(v)},set:function(S,v,D){if("symbol"===typeof v||isNaN(v))S[v]=D;else{var z=Array.from(S.$items.keys()),e=parseInt(z[v]||v);void 0===D||null===D?S.deleteAt(e):S.setAt(e,D)}return!0},deleteProperty:function(S,v){return"number"===typeof v?S.deleteAt(v):delete S[v],!0}})}var R=function(){function v(){for(var S=[],v=0;v<arguments.length;v++)S[v]=arguments[v];this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,S)}return v.prototype.bB=function(v,D){return void 0===D&&(D=!0),E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.ADD,v,D?this.$items:void 0)},v.prototype.tv=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.REPLACE,v)},v.is=function(S){return Array.isArray(S)||void 0!==S.array},Object.defineProperty(v.prototype,"length",{get:function(){return this.$items.size},set:function(S){0===S?this.clear():this.splice(S,this.length-S)},enumerable:!1,configurable:!0}),v.prototype.push=function(){for(var S,v=this,D=[],z=0;z<arguments.length;z++)D[z]=arguments[z];return D.forEach((function(D){S=v.$refId++,v.setAt(S,D)})),S},v.prototype.pop=function(){var S=Array.from(this.$indexes.values()).pop();if(void 0!==S){this.$changes.delete(S),this.$indexes.delete(S);var v=this.$items.get(S);return this.$items.delete(S),v}},v.prototype.at=function(S){var v=Array.from(this.$items.keys())[S];return this.$items.get(v)},v.prototype.setAt=function(v,D){var z,e;if(void 0!==D&&null!==D){if(this.$items.get(v)!==D){void 0!==D.$changes&&D.$changes.setParent(this,this.$changes.root,v);var N=null!==(e=null===(z=this.$changes.indexes[v])||void 0===z?void 0:z.op)&&void 0!==e?e:S.OPERATION.ADD;this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,D),this.$changes.change(v,N)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},v.prototype.deleteAt=function(S){var v=Array.from(this.$items.keys())[S];return void 0!==v&&this.$deleteAt(v)},v.prototype.$deleteAt=function(S){return this.$changes.delete(S),this.$indexes.delete(S),this.$items.delete(S)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&h.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:S.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.concat=function(){for(var S,D=[],z=0;z<arguments.length;z++)D[z]=arguments[z];return new(v.bind.apply(v,e([void 0],(S=Array.from(this.$items.values())).concat.apply(S,D),!1)))},v.prototype.join=function(S){return Array.from(this.$items.values()).join(S)},v.prototype.reverse=function(){var S=this,v=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(D,z){S.setAt(v[z],D)})),this},v.prototype.shift=function(){var S=Array.from(this.$items.keys()).shift();if(void 0!==S){var v=this.$items.get(S);return this.$deleteAt(S),v}},v.prototype.slice=function(S,D){var z=new v;return z.push.apply(z,Array.from(this.$items.values()).slice(S,D)),z},v.prototype.sort=function(S){var v=this;void 0===S&&(S=w);var D=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(S).forEach((function(S,z){v.setAt(D[z],S)})),this},v.prototype.splice=function(S,v){void 0===v&&(v=this.length-S);for(var D=Array.from(this.$items.keys()),z=[],e=S;e<S+v;e++)z.push(this.$items.get(D[e])),this.$deleteAt(D[e]);return z},v.prototype.unshift=function(){for(var S=this,v=[],D=0;D<arguments.length;D++)v[D]=arguments[D];var z=this.length,e=v.length,N=Array.from(this.$items.values());return v.forEach((function(v,D){S.setAt(D,v)})),N.forEach((function(v,D){S.setAt(e+D,v)})),z+e},v.prototype.indexOf=function(S,v){return Array.from(this.$items.values()).indexOf(S,v)},v.prototype.lastIndexOf=function(S,v){return void 0===v&&(v=this.length-1),Array.from(this.$items.values()).lastIndexOf(S,v)},v.prototype.every=function(S,v){return Array.from(this.$items.values()).every(S,v)},v.prototype.some=function(S,v){return Array.from(this.$items.values()).some(S,v)},v.prototype.forEach=function(S,v){Array.from(this.$items.values()).forEach(S,v)},v.prototype.map=function(S,v){return Array.from(this.$items.values()).map(S,v)},v.prototype.filter=function(S,v){return Array.from(this.$items.values()).filter(S,v)},v.prototype.reduce=function(S,v){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},v.prototype.reduceRight=function(S,v){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},v.prototype.find=function(S,v){return Array.from(this.$items.values()).find(S,v)},v.prototype.findIndex=function(S,v){return Array.from(this.$items.values()).findIndex(S,v)},v.prototype.fill=function(S,v,D){throw new Error("ArraySchema#fill() not implemented")},v.prototype.copyWithin=function(S,v,D){throw new Error("ArraySchema#copyWithin() not implemented")},v.prototype.toString=function(){return this.$items.toString()},v.prototype.toLocaleString=function(){return this.$items.toLocaleString()},v.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},v.prototype.includes=function(S,v){return Array.from(this.$items.values()).includes(S,v)},v.prototype.flatMap=function(S,v){throw new Error("ArraySchema#flatMap() is not supported.")},v.prototype.flat=function(S){throw new Error("ArraySchema#flat() is not supported.")},v.prototype.findLast=function(){var S=Array.from(this.$items.values());return S.findLast.apply(S,arguments)},v.prototype.findLastIndex=function(){var S=Array.from(this.$items.values());return S.findLastIndex.apply(S,arguments)},v.prototype.setIndex=function(S,v){this.$indexes.set(S,v)},v.prototype.getIndex=function(S){return this.$indexes.get(S)},v.prototype.getByIndex=function(S){return this.$items.get(this.$indexes.get(S))},v.prototype.deleteByIndex=function(S){var v=this.$indexes.get(S);this.$items.delete(v),this.$indexes.delete(S)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){return this.toArray().map((function(S){return"function"===typeof S.toJSON?S.toJSON():S}))},v.prototype.clone=function(S){return S?new(v.bind.apply(v,e([void 0],Array.from(this.$items.values()),!1))):new(v.bind.apply(v,e([void 0],this.map((function(S){return S.$changes?S.clone():S})),!1)))},v}();function O(S){return S.$proxy=!0,S=new Proxy(S,{get:function(S,v){return"symbol"!==typeof v&&"undefined"===typeof S[v]?S.get(v):S[v]},set:function(S,v,D){return"symbol"!==typeof v&&-1===v.indexOf("$")&&"bB"!==v&&"tv"!==v&&"onChange"!==v?S.set(v,D):S[v]=D,!0},deleteProperty:function(S,v){return S.delete(v),!0}})}var I=function(){function v(S){var D=this;if(this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,S)if(S instanceof Map||S instanceof v)S.forEach((function(S,v){return D.set(v,S)}));else for(var z in S)this.set(z,S[z])}return v.prototype.bB=function(v,D){return void 0===D&&(D=!0),E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.ADD,v,D?this.$items:void 0)},v.prototype.tv=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.REPLACE,v)},v.is=function(S){return void 0!==S.map},v.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(v.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.set=function(v,D){if(void 0===D||null===D)throw new Error("MapSchema#set('".concat(v,"', ").concat(D,"): trying to set ").concat(D," value on '").concat(v,"'."));v=v.toString();var z="undefined"!==typeof this.$changes.indexes[v],e=z?this.$changes.indexes[v]:this.$refId++,N=z?S.OPERATION.REPLACE:S.OPERATION.ADD,m=void 0!==D.$changes;if(m&&D.$changes.setParent(this,this.$changes.root,e),z){if(!m&&this.$items.get(v)===D)return;m&&this.$items.get(v)!==D&&(N=S.OPERATION.ADD)}else this.$changes.indexes[v]=e,this.$indexes.set(e,v);return this.$items.set(v,D),this.$changes.change(v,N),this},v.prototype.get=function(S){return this.$items.get(S)},v.prototype.delete=function(S){return this.$changes.delete(S),this.$items.delete(S)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&h.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:S.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(S){return this.$items.has(S)},v.prototype.forEach=function(S){this.$items.forEach(S)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(S,v){this.$indexes.set(S,v)},v.prototype.getIndex=function(S){return this.$indexes.get(S)},v.prototype.getByIndex=function(S){return this.$items.get(this.$indexes.get(S))},v.prototype.deleteByIndex=function(S){var v=this.$indexes.get(S);this.$items.delete(v),this.$indexes.delete(S)},v.prototype.toJSON=function(){var S={};return this.forEach((function(v,D){S[D]="function"===typeof v.toJSON?v.toJSON():v})),S},v.prototype.clone=function(S){var D;return S?D=Object.assign(new v,this):(D=new v,this.forEach((function(S,v){S.$changes?D.set(v,S.clone()):D.set(v,S)}))),D},v}(),K={};function q(S,v){K[S]=v}function u(S){return K[S]}var s=function(){function S(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return S.create=function(v){var D=new S;return D.schema=Object.assign({},v&&v.schema||{}),D.indexes=Object.assign({},v&&v.indexes||{}),D.fieldsByIndex=Object.assign({},v&&v.fieldsByIndex||{}),D.descriptors=Object.assign({},v&&v.descriptors||{}),D.deprecated=Object.assign({},v&&v.deprecated||{}),D},S.prototype.addField=function(S,v){var D=this.getNextFieldIndex();this.fieldsByIndex[D]=S,this.indexes[S]=D,this.schema[S]=Array.isArray(v)?{array:v[0]}:v},S.prototype.hasField=function(S){return void 0!==this.indexes[S]},S.prototype.addFilter=function(S,v){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[S]]=v,this.indexesWithFilters.push(this.indexes[S]),!0},S.prototype.addChildrenFilter=function(S,v){var D=this.indexes[S],z=this.schema[S];if(u(Object.keys(z)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[D]=v,!0;console.warn("@filterChildren: field '".concat(S,"' can't have children. Ignoring filter."))},S.prototype.getChildrenFilter=function(S){return this.childFilters&&this.childFilters[this.indexes[S]]},S.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},S}();function r(S){return S._context&&S._context.useFilters}var d=function(){function S(){this.types={},this.schemas=new Map,this.useFilters=!1}return S.prototype.has=function(S){return this.schemas.has(S)},S.prototype.get=function(S){return this.types[S]},S.prototype.add=function(S,v){void 0===v&&(v=this.schemas.size),S._definition=s.create(S._definition),S._typeid=v,this.types[v]=S,this.schemas.set(S,v)},S.create=function(v){return void 0===v&&(v={}),function(D){return v.context||(v.context=new S),W(D,v)}},S}(),x=new d;function W(S,v){return void 0===v&&(v={}),function(D,z){var N=v.context||x,m=D.constructor;if(m._context=N,!S)throw new Error("".concat(m.name,': @type() reference provided for "').concat(z,"\" is undefined. Make sure you don't have any circular dependencies."));N.has(m)||N.add(m);var B=m._definition;if(B.addField(z,S),B.descriptors[z]){if(B.deprecated[z])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(z,"' definition on '").concat(m.name,"'.\nCheck @type() annotation"))}catch(K){var g=K.stack.split("\n")[4].trim();throw new Error("".concat(K.message," ").concat(g))}}var E=R.is(S),h=!E&&I.is(S);if("string"!==typeof S&&!XS.is(S)){var A=Object.values(S)[0];"string"===typeof A||N.has(A)||N.add(A)}if(v.manual)B.descriptors[z]={enumerable:!0,configurable:!0,writable:!0};else{var w="_".concat(z);B.descriptors[w]={enumerable:!1,configurable:!1,writable:!0},B.descriptors[z]={get:function(){return this[w]},set:function(S){S!==this[w]&&(void 0!==S&&null!==S?(!E||S instanceof R||(S=new(R.bind.apply(R,e([void 0],S,!1)))),!h||S instanceof I||(S=new I(S)),void 0===S.$proxy&&(h?S=O(S):E&&(S=n(S))),this.$changes.change(z),S.$changes&&S.$changes.setParent(this,this.$changes.root,this._definition.indexes[z])):this[w]&&this.$changes.delete(z),this[w]=S)},enumerable:!0,configurable:!0}}}}function p(S){return function(v,D){var z=v.constructor;z._definition.addFilter(D,S)&&(z._context.useFilters=!0)}}function b(S){return function(v,D){var z=v.constructor;z._definition.addChildrenFilter(D,S)&&(z._context.useFilters=!0)}}function k(S){return void 0===S&&(S=!0),function(v,D){var z=v.constructor._definition;z.deprecated[D]=!0,S&&(z.descriptors[D]={get:function(){throw new Error("".concat(D," is deprecated."))},set:function(S){},enumerable:!1,configurable:!0})}}function Z(S,v,D){for(var z in void 0===D&&(D={}),D.context||(D.context=S._context||D.context||x),v)W(v[z],D)(S.prototype,z);return S}function i(S){for(var v=0,D=0,z=0,e=S.length;z<e;z++)(v=S.charCodeAt(z))<128?D+=1:v<2048?D+=2:v<55296||v>=57344?D+=3:(z++,D+=4);return D}function t(S,v,D){for(var z=0,e=0,N=D.length;e<N;e++)(z=D.charCodeAt(e))<128?S[v++]=z:z<2048?(S[v++]=192|z>>6,S[v++]=128|63&z):z<55296||z>=57344?(S[v++]=224|z>>12,S[v++]=128|z>>6&63,S[v++]=128|63&z):(e++,z=65536+((1023&z)<<10|1023&D.charCodeAt(e)),S[v++]=240|z>>18,S[v++]=128|z>>12&63,S[v++]=128|z>>6&63,S[v++]=128|63&z)}function X(S,v){S.push(255&v)}function a(S,v){S.push(255&v)}function o(S,v){S.push(255&v),S.push(v>>8&255)}function M(S,v){S.push(255&v),S.push(v>>8&255)}function c(S,v){S.push(255&v),S.push(v>>8&255),S.push(v>>16&255),S.push(v>>24&255)}function J(S,v){var D=v>>24,z=v>>16,e=v>>8,N=v;S.push(255&N),S.push(255&e),S.push(255&z),S.push(255&D)}function H(S,v){var D=Math.floor(v/Math.pow(2,32));J(S,v>>>0),J(S,D)}function T(S,v){var D=v/Math.pow(2,32)|0;J(S,v>>>0),J(S,D)}function G(S,v){y(S,v)}function Y(S,v){f(S,v)}var j=new Int32Array(2),V=new Float32Array(j.buffer),U=new Float64Array(j.buffer);function y(S,v){V[0]=v,c(S,j[0])}function f(S,v){U[0]=v,c(S,j[0]),c(S,j[1])}function C(S,v){return a(S,v?1:0)}function F(S,v){v||(v="");var D=i(v),z=0;if(D<32)S.push(160|D),z=1;else if(D<256)S.push(217),a(S,D),z=2;else if(D<65536)S.push(218),M(S,D),z=3;else{if(!(D<4294967296))throw new Error("String too long");S.push(219),J(S,D),z=5}return t(S,S.length,v),z+D}function l(S,v){return isNaN(v)?l(S,0):isFinite(v)?v!==(0|v)?(S.push(203),f(S,v),9):v>=0?v<128?(a(S,v),1):v<256?(S.push(204),a(S,v),2):v<65536?(S.push(205),M(S,v),3):v<4294967296?(S.push(206),J(S,v),5):(S.push(207),T(S,v),9):v>=-32?(S.push(224|v+32),1):v>=-128?(S.push(208),X(S,v),2):v>=-32768?(S.push(209),o(S,v),3):v>=-2147483648?(S.push(210),c(S,v),5):(S.push(211),H(S,v),9):l(S,v>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var P=Object.freeze({__proto__:null,utf8Write:t,int8:X,uint8:a,int16:o,uint16:M,int32:c,uint32:J,int64:H,uint64:T,float32:G,float64:Y,writeFloat32:y,writeFloat64:f,boolean:C,string:F,number:l});function Q(S,v,D){for(var z="",e=0,N=v,m=v+D;N<m;N++){var B=S[N];0!==(128&B)?192!==(224&B)?224!==(240&B)?240!==(248&B)?console.error("Invalid byte "+B.toString(16)):(e=(7&B)<<18|(63&S[++N])<<12|(63&S[++N])<<6|63&S[++N])>=65536?(e-=65536,z+=String.fromCharCode(55296+(e>>>10),56320+(1023&e))):z+=String.fromCharCode(e):z+=String.fromCharCode((15&B)<<12|(63&S[++N])<<6|63&S[++N]):z+=String.fromCharCode((31&B)<<6|63&S[++N]):z+=String.fromCharCode(B)}return z}function L(S,v){return SS(S,v)<<24>>24}function SS(S,v){return S[v.offset++]}function vS(S,v){return DS(S,v)<<16>>16}function DS(S,v){return S[v.offset++]|S[v.offset++]<<8}function zS(S,v){return S[v.offset++]|S[v.offset++]<<8|S[v.offset++]<<16|S[v.offset++]<<24}function eS(S,v){return zS(S,v)>>>0}function NS(S,v){return wS(S,v)}function mS(S,v){return nS(S,v)}function BS(S,v){var D=eS(S,v);return zS(S,v)*Math.pow(2,32)+D}function gS(S,v){var D=eS(S,v);return eS(S,v)*Math.pow(2,32)+D}var ES=new Int32Array(2),hS=new Float32Array(ES.buffer),AS=new Float64Array(ES.buffer);function wS(S,v){return ES[0]=zS(S,v),hS[0]}function nS(S,v){return ES[0]=zS(S,v),ES[1]=zS(S,v),AS[0]}function RS(S,v){return SS(S,v)>0}function OS(S,v){var D,z=S[v.offset++];z<192?D=31&z:217===z?D=SS(S,v):218===z?D=DS(S,v):219===z&&(D=eS(S,v));var e=Q(S,v.offset,D);return v.offset+=D,e}function IS(S,v){var D=S[v.offset];return D<192&&D>160||217===D||218===D||219===D}function KS(S,v){var D=S[v.offset++];return D<128?D:202===D?wS(S,v):203===D?nS(S,v):204===D?SS(S,v):205===D?DS(S,v):206===D?eS(S,v):207===D?gS(S,v):208===D?L(S,v):209===D?vS(S,v):210===D?zS(S,v):211===D?BS(S,v):D>223?-1*(255-D+1):void 0}function qS(S,v){var D=S[v.offset];return D<128||D>=202&&D<=211}function uS(S,v){return S[v.offset]<160}function sS(S,v){return S[v.offset-1]===m&&(S[v.offset]<128||S[v.offset]>=202&&S[v.offset]<=211)}var rS=Object.freeze({__proto__:null,int8:L,uint8:SS,int16:vS,uint16:DS,int32:zS,uint32:eS,float32:NS,float64:mS,int64:BS,uint64:gS,readFloat32:wS,readFloat64:nS,boolean:RS,string:OS,stringCheck:IS,number:KS,numberCheck:qS,arrayCheck:uS,switchStructureCheck:sS}),dS=function(){function v(S){var v=this;this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,S&&S.forEach((function(S){return v.add(S)}))}return v.prototype.bB=function(v,D){return void 0===D&&(D=!0),E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.ADD,v,D?this.$items:void 0)},v.prototype.tv=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.REPLACE,v)},v.is=function(S){return void 0!==S.collection},v.prototype.add=function(S){var v=this.$refId++;return void 0!==S.$changes&&S.$changes.setParent(this,this.$changes.root,v),this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,S),this.$changes.change(v),v},v.prototype.at=function(S){var v=Array.from(this.$items.keys())[S];return this.$items.get(v)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(S){for(var v,D,z=this.$items.entries();(D=z.next())&&!D.done;)if(S===D.value[1]){v=D.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&h.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:S.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(S){return Array.from(this.$items.values()).some((function(v){return v===S}))},v.prototype.forEach=function(S){var v=this;this.$items.forEach((function(D,z,e){return S(D,z,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(S,v){this.$indexes.set(S,v)},v.prototype.getIndex=function(S){return this.$indexes.get(S)},v.prototype.getByIndex=function(S){return this.$items.get(this.$indexes.get(S))},v.prototype.deleteByIndex=function(S){var v=this.$indexes.get(S);this.$items.delete(v),this.$indexes.delete(S)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var S=[];return this.forEach((function(v,D){S.push("function"===typeof v.toJSON?v.toJSON():v)})),S},v.prototype.clone=function(S){var D;return S?D=Object.assign(new v,this):(D=new v,this.forEach((function(S){S.$changes?D.add(S.clone()):D.add(S)}))),D},v}(),xS=function(){function v(S){var v=this;this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,S&&S.forEach((function(S){return v.add(S)}))}return v.prototype.bB=function(v,D){return void 0===D&&(D=!0),E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.ADD,v,D?this.$items:void 0)},v.prototype.tv=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.REPLACE,v)},v.is=function(S){return void 0!==S.set},v.prototype.add=function(v){var D,z;if(this.has(v))return!1;var e=this.$refId++;void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,e);var N=null!==(z=null===(D=this.$changes.indexes[e])||void 0===D?void 0:D.op)&&void 0!==z?z:S.OPERATION.ADD;return this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,v),this.$changes.change(e,N),e},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(S){for(var v,D,z=this.$items.entries();(D=z.next())&&!D.done;)if(S===D.value[1]){v=D.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&h.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:S.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(S){for(var v,D=this.$items.values(),z=!1;(v=D.next())&&!v.done;)if(S===v.value){z=!0;break}return z},v.prototype.forEach=function(S){var v=this;this.$items.forEach((function(D,z,e){return S(D,z,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(S,v){this.$indexes.set(S,v)},v.prototype.getIndex=function(S){return this.$indexes.get(S)},v.prototype.getByIndex=function(S){return this.$items.get(this.$indexes.get(S))},v.prototype.deleteByIndex=function(S){var v=this.$indexes.get(S);this.$items.delete(v),this.$indexes.delete(S)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var S=[];return this.forEach((function(v,D){S.push("function"===typeof v.toJSON?v.toJSON():v)})),S},v.prototype.clone=function(S){var D;return S?D=Object.assign(new v,this):(D=new v,this.forEach((function(S){S.$changes?D.add(S.clone()):D.add(S)}))),D},v}(),WS=function(){function S(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return S.prototype.addRefId=function(S){this.refIds.has(S)||(this.refIds.add(S),this.containerIndexes.set(S,new Set))},S.get=function(v){return void 0===v.$filterState&&(v.$filterState=new S),v.$filterState},S}(),pS=function(){function S(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return S.prototype.getNextUniqueId=function(){return this.nextUniqueId++},S.prototype.addRef=function(S,v,D){void 0===D&&(D=!0),this.refs.set(S,v),D&&(this.refCounts[S]=(this.refCounts[S]||0)+1)},S.prototype.removeRef=function(S){this.refCounts[S]=this.refCounts[S]-1,this.deletedRefs.add(S)},S.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},S.prototype.garbageCollectDeletedRefs=function(){var S=this;this.deletedRefs.forEach((function(v){if(!(S.refCounts[v]>0)){var D=S.refs.get(v);if(D instanceof XS)for(var z in D._definition.schema)"string"!==typeof D._definition.schema[z]&&D[z]&&D[z].$changes&&S.removeRef(D[z].$changes.refId);else{var e=D.$changes.parent._definition,N=e.schema[e.fieldsByIndex[D.$changes.parentIndex]];"function"===typeof Object.values(N)[0]&&Array.from(D.values()).forEach((function(v){return S.removeRef(v.$changes.refId)}))}S.refs.delete(v),delete S.refCounts[v]}})),this.deletedRefs.clear()},S}(),bS=function(S){function v(){return null!==S&&S.apply(this,arguments)||this}return D(v,S),v}(Error);function kS(S,v,D,z){var e,N=!1;switch(v){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":e="number",isNaN(S)&&console.log('trying to encode "NaN" in '.concat(D.constructor.name,"#").concat(z));break;case"string":e="string",N=!0;break;case"boolean":return}if(typeof S!==e&&(!N||N&&null!==S)){var m="'".concat(JSON.stringify(S),"'").concat(S&&S.constructor&&" (".concat(S.constructor.name,")")||"");throw new bS("a '".concat(e,"' was expected, but ").concat(m," was provided in ").concat(D.constructor.name,"#").concat(z))}}function ZS(S,v,D,z){if(!(S instanceof v))throw new bS("a '".concat(v.name,"' was expected, but '").concat(S.constructor.name,"' was provided in ").concat(D.constructor.name,"#").concat(z))}function iS(S,v,D,z,e){kS(D,S,z,e);var N=P[S];if(!N)throw new bS("a '".concat(S,"' was expected, but ").concat(D," was provided in ").concat(z.constructor.name,"#").concat(e));N(v,D)}function tS(S,v,D){return rS[S](v,D)}var XS=function(){function v(){for(var S=[],v=0;v<arguments.length;v++)S[v]=arguments[v];Object.defineProperties(this,{$changes:{value:new g(this,void 0,new pS),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var D=this._definition.descriptors;D&&Object.defineProperties(this,D),S[0]&&this.assign(S[0])}return v.onError=function(S){console.error(S)},v.is=function(S){return S._definition&&void 0!==S._definition.schema},v.prototype.onChange=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.REPLACE,v)},v.prototype.tv=function(v){return E(this.$callbacks||(this.$callbacks=[]),S.OPERATION.DELETE,v)},v.prototype.assign=function(S){return Object.assign(this,S),this},Object.defineProperty(v.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),v.prototype.setDirty=function(S,v){this.$changes.change(S,v)},v.prototype.listen=function(S,v,D){var z=this;return void 0===D&&(D=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[S]||(this.$callbacks[S]=[]),this.$callbacks[S].push(v),D&&void 0!==this[S]&&v(this[S],void 0),function(){return A(z.$callbacks[S],z.$callbacks[S].indexOf(v))}},v.prototype.decode=function(D,z,e){var N;void 0===z&&(z={offset:0}),void 0===e&&(e=this);var B=[],g=this.$changes.root,E=D.length,h=0;for(g.refs.set(h,this);z.offset<E;){var A=D[z.offset++];if(A!=m){var w=e.$changes,n=void 0!==e._definition,O=n?A>>6<<6:A;if(O!==S.OPERATION.CLEAR){var K=n?A%(O||255):KS(D,z),q=n?e._definition.fieldsByIndex[K]:"",s=w.getType(K),r=void 0,d=void 0,x=void 0;if(n?d=e["_".concat(q)]:(d=e.getByIndex(K),(O&S.OPERATION.ADD)===S.OPERATION.ADD?(x=e instanceof I?OS(D,z):K,e.setIndex(K,x)):x=e.getIndex(K)),(O&S.OPERATION.DELETE)===S.OPERATION.DELETE&&(O!==S.OPERATION.DELETE_AND_ADD&&e.deleteByIndex(K),d&&d.$changes&&g.removeRef(d.$changes.refId),r=null),void 0!==q){if(O===S.OPERATION.DELETE);else if(v.is(s)){var W=KS(D,z);if(r=g.refs.get(W),O!==S.OPERATION.REPLACE){var p=this.getSchemaType(D,z,s);r||((r=this.createTypeInstance(p)).$changes.refId=W,d&&(r.$callbacks=d.$callbacks,d.$changes.refId&&W!==d.$changes.refId&&g.removeRef(d.$changes.refId))),g.addRef(W,r,r!==d)}}else if("string"===typeof s)r=tS(s,D,z);else{var b=u(Object.keys(s)[0]),k=KS(D,z),Z=g.refs.has(k)?d||g.refs.get(k):new b.constructor;if((r=Z.clone(!0)).$changes.refId=k,d&&(r.$callbacks=d.$callbacks,d.$changes.refId&&k!==d.$changes.refId)){g.removeRef(d.$changes.refId);for(var i=d.entries(),t=void 0;(t=i.next())&&!t.done;){var X=(N=t.value)[0],a=N[1];B.push({refId:k,op:S.OPERATION.DELETE,field:X,value:void 0,previousValue:a})}}g.addRef(k,r,Z!==d)}if(null!==r&&void 0!==r)if(r.$changes&&r.$changes.setParent(w.ref,w.root,K),e instanceof v)e[q]=r;else if(e instanceof I)X=x,e.$items.set(X,r),e.$changes.allChanges.add(K);else if(e instanceof R)e.setAt(K,r);else if(e instanceof dS){var o=e.add(r);e.setIndex(K,o)}else e instanceof xS&&!1!==(o=e.add(r))&&e.setIndex(K,o);d!==r&&B.push({refId:h,op:O,field:q,dynamicIndex:x,value:r,previousValue:d})}else{console.warn("@colyseus/schema: definition mismatch");for(var M={offset:z.offset};z.offset<E&&(!sS(D,z)||(M.offset=z.offset+1,!g.refs.has(KS(D,M))));)z.offset++}}else e.clear(B)}else{h=KS(D,z);var c=g.refs.get(h);if(!c)throw new Error('"refId" not found: '.concat(h));e=c}}return this._triggerChanges(B),g.garbageCollectDeletedRefs(),B},v.prototype.encode=function(D,z,e){void 0===D&&(D=!1),void 0===z&&(z=[]),void 0===e&&(e=!1);for(var N=this.$changes,B=new WeakSet,g=[N],E=1,h=0;h<E;h++){var A=g[h],w=A.ref,n=w instanceof v;A.ensureRefId(),B.add(A),A!==N&&(A.changed||D)&&(a(z,m),l(z,A.refId));for(var R=D?Array.from(A.allChanges):Array.from(A.changes.values()),O=0,K=R.length;O<K;O++){var q=D?{op:S.OPERATION.ADD,index:R[O]}:R[O],s=q.index,r=n?w._definition.fieldsByIndex&&w._definition.fieldsByIndex[s]:s,d=z.length;if(q.op!==S.OPERATION.TOUCH)if(n)a(z,s|q.op);else{if(a(z,q.op),q.op===S.OPERATION.CLEAR)continue;l(z,s)}if(n||(q.op&S.OPERATION.ADD)!=S.OPERATION.ADD||w instanceof I&&F(z,A.ref.$indexes.get(s)),q.op!==S.OPERATION.DELETE){var x=A.getType(s),W=A.getValue(s);if(W&&W.$changes&&!B.has(W.$changes)&&(g.push(W.$changes),W.$changes.ensureRefId(),E++),q.op!==S.OPERATION.TOUCH){if(v.is(x))ZS(W,x,w,r),l(z,W.$changes.refId),(q.op&S.OPERATION.ADD)===S.OPERATION.ADD&&this.tryEncodeTypeId(z,x,W.constructor);else if("string"===typeof x)iS(x,z,W,w,r);else{var p=u(Object.keys(x)[0]);ZS(w["_".concat(r)],p.constructor,w,r),l(z,W.$changes.refId)}e&&A.cache(s,z.slice(d))}}}D||e||A.discard()}return z},v.prototype.encodeAll=function(S){return this.encode(!0,[],S)},v.prototype.applyFilters=function(D,z){var e,N;void 0===z&&(z=!1);for(var B=this,g=new Set,E=WS.get(D),h=[this.$changes],A=1,w=[],n=function(n){var R=h[n];if(g.has(R.refId))return"continue";var O=R.ref,K=O instanceof v;a(w,m),l(w,R.refId);var q=E.refIds.has(R),u=z||!q;E.addRefId(R);var s=E.containerIndexes.get(R),r=u?Array.from(R.allChanges):Array.from(R.changes.values());!z&&K&&O._definition.indexesWithFilters&&O._definition.indexesWithFilters.forEach((function(v){!s.has(v)&&R.allChanges.has(v)&&(u?r.push(v):r.push({op:S.OPERATION.ADD,index:v}))}));for(var d=0,x=r.length;d<x;d++){var W=u?{op:S.OPERATION.ADD,index:r[d]}:r[d];if(W.op!==S.OPERATION.CLEAR){var p=W.index;if(W.op!==S.OPERATION.DELETE){var b=R.getValue(p),k=R.getType(p);if(K){if((Z=O._definition.filters&&O._definition.filters[p])&&!Z.call(O,D,b,B)){b&&b.$changes&&g.add(b.$changes.refId);continue}}else{var Z,i=R.parent;if((Z=R.getChildrenFilter())&&!Z.call(i,D,O.$indexes.get(p),b,B)){b&&b.$changes&&g.add(b.$changes.refId);continue}}if(b.$changes&&(h.push(b.$changes),A++),W.op!==S.OPERATION.TOUCH)if(W.op===S.OPERATION.ADD||K)w.push.apply(w,null!==(e=R.caches[p])&&void 0!==e?e:[]),s.add(p);else if(s.has(p))w.push.apply(w,null!==(N=R.caches[p])&&void 0!==N?N:[]);else{if(s.add(p),a(w,S.OPERATION.ADD),l(w,p),O instanceof I){var t=R.ref.$indexes.get(p);F(w,t)}b.$changes?l(w,b.$changes.refId):P[k](w,b)}else b.$changes&&!K&&(a(w,S.OPERATION.ADD),l(w,p),O instanceof I&&(t=R.ref.$indexes.get(p),F(w,t)),l(w,b.$changes.refId))}else K?a(w,W.op|p):(a(w,W.op),l(w,p))}else a(w,W.op)}},R=0;R<A;R++)n(R);return w},v.prototype.clone=function(){var S,v=new this.constructor,D=this._definition.schema;for(var z in D)"object"===typeof this[z]&&"function"===typeof(null===(S=this[z])||void 0===S?void 0:S.clone)?v[z]=this[z].clone():v[z]=this[z];return v},v.prototype.toJSON=function(){var S=this._definition.schema,v=this._definition.deprecated,D={};for(var z in S)v[z]||null===this[z]||"undefined"===typeof this[z]||(D[z]="function"===typeof this[z].toJSON?this[z].toJSON():this["_".concat(z)]);return D},v.prototype.discardAllChanges=function(){this.$changes.discardAll()},v.prototype.getByIndex=function(S){return this[this._definition.fieldsByIndex[S]]},v.prototype.deleteByIndex=function(S){this[this._definition.fieldsByIndex[S]]=void 0},v.prototype.tryEncodeTypeId=function(S,v,D){v._typeid!==D._typeid&&(a(S,B),l(S,D._typeid))},v.prototype.getSchemaType=function(S,v,D){var z;return S[v.offset]===B&&(v.offset++,z=this.constructor._context.get(KS(S,v))),z||D},v.prototype.createTypeInstance=function(S){var v=new S;return v.$changes.root=this.$changes.root,v},v.prototype._triggerChanges=function(D){for(var z,e,N,m,B,g,E,h,A,w=new Set,n=this.$changes.root.refs,R=function(R){var O=D[R],I=O.refId,K=n.get(I),q=K.$callbacks;if((O.op&S.OPERATION.DELETE)===S.OPERATION.DELETE&&O.previousValue instanceof v&&(null===(e=null===(z=O.previousValue.$callbacks)||void 0===z?void 0:z[S.OPERATION.DELETE])||void 0===e||e.forEach((function(S){return S()}))),!q)return"continue";if(K instanceof v){if(!w.has(I))try{null===(N=null===q||void 0===q?void 0:q[S.OPERATION.REPLACE])||void 0===N||N.forEach((function(S){return S()}))}catch(u){v.onError(u)}try{q.hasOwnProperty(O.field)&&(null===(m=q[O.field])||void 0===m||m.forEach((function(S){return S(O.value,O.previousValue)})))}catch(u){v.onError(u)}}else O.op===S.OPERATION.ADD&&void 0===O.previousValue?null===(B=q[S.OPERATION.ADD])||void 0===B||B.forEach((function(S){var v;return S(O.value,null!==(v=O.dynamicIndex)&&void 0!==v?v:O.field)})):O.op===S.OPERATION.DELETE?void 0!==O.previousValue&&(null===(g=q[S.OPERATION.DELETE])||void 0===g||g.forEach((function(S){var v;return S(O.previousValue,null!==(v=O.dynamicIndex)&&void 0!==v?v:O.field)}))):O.op===S.OPERATION.DELETE_AND_ADD&&(void 0!==O.previousValue&&(null===(E=q[S.OPERATION.DELETE])||void 0===E||E.forEach((function(S){var v;return S(O.previousValue,null!==(v=O.dynamicIndex)&&void 0!==v?v:O.field)}))),null===(h=q[S.OPERATION.ADD])||void 0===h||h.forEach((function(S){var v;return S(O.value,null!==(v=O.dynamicIndex)&&void 0!==v?v:O.field)}))),O.value!==O.previousValue&&(null===(A=q[S.OPERATION.REPLACE])||void 0===A||A.forEach((function(S){var v;return S(O.value,null!==(v=O.dynamicIndex)&&void 0!==v?v:O.field)})));w.add(I)},O=0;O<D.length;O++)R(O)},v._definition=s.create(),v}();function aS(S){for(var v=[S.$changes],D=1,z={},e=z,N=function(S){var D=v[S];D.changes.forEach((function(S){var v=D.ref,z=S.index,N=v._definition?v._definition.fieldsByIndex[z]:v.$indexes.get(z);e[N]=D.getValue(z)}))},m=0;m<D;m++)N(m);return z}var oS={context:new d},MS=function(S){function v(){return null!==S&&S.apply(this,arguments)||this}return D(v,S),z([W("string",oS)],v.prototype,"name",void 0),z([W("string",oS)],v.prototype,"type",void 0),z([W("number",oS)],v.prototype,"referencedType",void 0),v}(XS),cS=function(S){function v(){var v=null!==S&&S.apply(this,arguments)||this;return v.fields=new R,v}return D(v,S),z([W("number",oS)],v.prototype,"id",void 0),z([W([MS],oS)],v.prototype,"fields",void 0),v}(XS),JS=function(S){function v(){var v=null!==S&&S.apply(this,arguments)||this;return v.types=new R,v}return D(v,S),v.encode=function(S){var D=S.constructor,z=new v;z.rootType=D._typeid;var e=function(S,v){for(var D in v){var e=new MS;e.name=D;var N=void 0;if("string"===typeof v[D])N=v[D];else{var m=v[D],B=void 0;XS.is(m)?(N="ref",B=v[D]):"string"===typeof m[N=Object.keys(m)[0]]?N+=":"+m[N]:B=m[N],e.referencedType=B?B._typeid:-1}e.type=N,S.fields.push(e)}z.types.push(S)},N=D._context.types;for(var m in N){var B=new cS;B.id=Number(m),e(B,N[m]._definition.schema)}return z.encodeAll()},v.decode=function(S,z){var e=new d,N=new v;N.decode(S,z);var m=N.types.reduce((function(S,v){var z=function(S){function v(){return null!==S&&S.apply(this,arguments)||this}return D(v,S),v}(XS),N=v.id;return S[N]=z,e.add(z,N),S}),{});N.types.forEach((function(S){var v=m[S.id];S.fields.forEach((function(S){var D;if(void 0!==S.referencedType){var z=S.type,N=m[S.referencedType];if(!N){var B=S.type.split(":");z=B[0],N=B[1]}"ref"===z?W(N,{context:e})(v.prototype,S.name):W(((D={})[z]=N,D),{context:e})(v.prototype,S.name)}else W(S.type,{context:e})(v.prototype,S.name)}))}));var B=m[N.rootType],g=new B;for(var E in B._definition.schema){var h=B._definition.schema[E];"string"!==typeof h&&(g[E]="function"===typeof h?new h:new(u(Object.keys(h)[0]).constructor))}return g},z([W([cS],oS)],v.prototype,"types",void 0),z([W("number",oS)],v.prototype,"rootType",void 0),v}(XS);q("map",{constructor:I}),q("array",{constructor:R}),q("set",{constructor:xS}),q("collection",{constructor:dS}),S.ArraySchema=R,S.CollectionSchema=dS,S.Context=d,S.MapSchema=I,S.Reflection=JS,S.ReflectionField=MS,S.ReflectionType=cS,S.Schema=XS,S.SchemaDefinition=s,S.SetSchema=xS,S.decode=rS,S.defineTypes=Z,S.deprecated=k,S.dumpChanges=aS,S.encode=P,S.filter=p,S.filterChildren=b,S.hasFilter=r,S.registerType=q,S.type=W,Object.defineProperty(S,"__esModule",{value:!0})}(v)},13500:S=>{"use strict";S.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13491:(S,v,D)=>{var z=D(13500),e=D(13504),N=Object.hasOwnProperty,m=Object.create(null);for(var B in z)N.call(z,B)&&(m[z[B]]=B);var g=S.exports={to:{},get:{}};function E(S,v,D){return Math.min(Math.max(v,S),D)}function h(S){var v=Math.round(S).toString(16).toUpperCase();return v.length<2?"0"+v:v}g.get=function(S){var v,D;switch(S.substring(0,3).toLowerCase()){case"hsl":v=g.get.hsl(S),D="hsl";break;case"hwb":v=g.get.hwb(S),D="hwb";break;default:v=g.get.rgb(S),D="rgb"}return v?{model:D,value:v}:null},g.get.rgb=function(S){if(!S)return null;var v,D,e,m=[0,0,0,1];if(v=S.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(e=v[2],v=v[1],D=0;D<3;D++){var B=2*D;m[D]=parseInt(v.slice(B,B+2),16)}e&&(m[3]=parseInt(e,16)/255)}else if(v=S.match(/^#([a-f0-9]{3,4})$/i)){for(e=(v=v[1])[3],D=0;D<3;D++)m[D]=parseInt(v[D]+v[D],16);e&&(m[3]=parseInt(e+e,16)/255)}else if(v=S.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(D=0;D<3;D++)m[D]=parseInt(v[D+1],0);v[4]&&(v[5]?m[3]=.01*parseFloat(v[4]):m[3]=parseFloat(v[4]))}else{if(!(v=S.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(v=S.match(/^(\w+)$/))?"transparent"===v[1]?[0,0,0,0]:N.call(z,v[1])?((m=z[v[1]])[3]=1,m):null:null;for(D=0;D<3;D++)m[D]=Math.round(2.55*parseFloat(v[D+1]));v[4]&&(v[5]?m[3]=.01*parseFloat(v[4]):m[3]=parseFloat(v[4]))}for(D=0;D<3;D++)m[D]=E(m[D],0,255);return m[3]=E(m[3],0,1),m},g.get.hsl=function(S){if(!S)return null;var v=S.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var D=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,E(parseFloat(v[2]),0,100),E(parseFloat(v[3]),0,100),E(isNaN(D)?1:D,0,1)]}return null},g.get.hwb=function(S){if(!S)return null;var v=S.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var D=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,E(parseFloat(v[2]),0,100),E(parseFloat(v[3]),0,100),E(isNaN(D)?1:D,0,1)]}return null},g.to.hex=function(){var S=e(arguments);return"#"+h(S[0])+h(S[1])+h(S[2])+(S[3]<1?h(Math.round(255*S[3])):"")},g.to.rgb=function(){var S=e(arguments);return S.length<4||1===S[3]?"rgb("+Math.round(S[0])+", "+Math.round(S[1])+", "+Math.round(S[2])+")":"rgba("+Math.round(S[0])+", "+Math.round(S[1])+", "+Math.round(S[2])+", "+S[3]+")"},g.to.rgb.percent=function(){var S=e(arguments),v=Math.round(S[0]/255*100),D=Math.round(S[1]/255*100),z=Math.round(S[2]/255*100);return S.length<4||1===S[3]?"rgb("+v+"%, "+D+"%, "+z+"%)":"rgba("+v+"%, "+D+"%, "+z+"%, "+S[3]+")"},g.to.hsl=function(){var S=e(arguments);return S.length<4||1===S[3]?"hsl("+S[0]+", "+S[1]+"%, "+S[2]+"%)":"hsla("+S[0]+", "+S[1]+"%, "+S[2]+"%, "+S[3]+")"},g.to.hwb=function(){var S=e(arguments),v="";return S.length>=4&&1!==S[3]&&(v=", "+S[3]),"hwb("+S[0]+", "+S[1]+"%, "+S[2]+"%"+v+")"},g.to.keyword=function(S){return m[S.slice(0,3)]}},13486:(S,v,D)=>{const z=D(13491),e=D(13520),N=["keyword","gray","hex"],m={};for(const n of Object.keys(e))m[[...e[n].labels].sort().join("")]=n;const B={};function g(S,v){if(!(this instanceof g))return new g(S,v);if(v&&v in N&&(v=null),v&&!(v in e))throw new Error("Unknown model: "+v);let D,E;if(null==S)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(S instanceof g)this.model=S.model,this.color=[...S.color],this.valpha=S.valpha;else if("string"===typeof S){const v=z.get(S);if(null===v)throw new Error("Unable to parse color from string: "+S);this.model=v.model,E=e[this.model].channels,this.color=v.value.slice(0,E),this.valpha="number"===typeof v.value[E]?v.value[E]:1}else if(S.length>0){this.model=v||"rgb",E=e[this.model].channels;const D=Array.prototype.slice.call(S,0,E);this.color=w(D,E),this.valpha="number"===typeof S[E]?S[E]:1}else if("number"===typeof S)this.model="rgb",this.color=[S>>16&255,S>>8&255,255&S],this.valpha=1;else{this.valpha=1;const v=Object.keys(S);"alpha"in S&&(v.splice(v.indexOf("alpha"),1),this.valpha="number"===typeof S.alpha?S.alpha:0);const z=v.sort().join("");if(!(z in m))throw new Error("Unable to parse color from object: "+JSON.stringify(S));this.model=m[z];const{labels:N}=e[this.model],B=[];for(D=0;D<N.length;D++)B.push(S[N[D]]);this.color=w(B)}if(B[this.model])for(E=e[this.model].channels,D=0;D<E;D++){const S=B[this.model][D];S&&(this.color[D]=S(this.color[D]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}g.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(S){let v=this.model in z.to?this:this.rgb();v=v.round("number"===typeof S?S:1);const D=1===v.valpha?v.color:[...v.color,this.valpha];return z.to[v.model](D)},percentString(S){const v=this.rgb().round("number"===typeof S?S:1),D=1===v.valpha?v.color:[...v.color,this.valpha];return z.to.rgb.percent(D)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const S={},{channels:v}=e[this.model],{labels:D}=e[this.model];for(let z=0;z<v;z++)S[D[z]]=this.color[z];return 1!==this.valpha&&(S.alpha=this.valpha),S},unitArray(){const S=this.rgb().color;return S[0]/=255,S[1]/=255,S[2]/=255,1!==this.valpha&&S.push(this.valpha),S},unitObject(){const S=this.rgb().object();return S.r/=255,S.g/=255,S.b/=255,1!==this.valpha&&(S.alpha=this.valpha),S},round(S){return S=Math.max(S||0,0),new g([...this.color.map(E(S)),this.valpha],this.model)},alpha(S){return void 0!==S?new g([...this.color,Math.max(0,Math.min(1,S))],this.model):this.valpha},red:h("rgb",0,A(255)),green:h("rgb",1,A(255)),blue:h("rgb",2,A(255)),hue:h(["hsl","hsv","hsl","hwb","hcg"],0,(S=>(S%360+360)%360)),saturationl:h("hsl",1,A(100)),lightness:h("hsl",2,A(100)),saturationv:h("hsv",1,A(100)),value:h("hsv",2,A(100)),chroma:h("hcg",1,A(100)),gray:h("hcg",2,A(100)),white:h("hwb",1,A(100)),wblack:h("hwb",2,A(100)),cyan:h("cmyk",0,A(100)),magenta:h("cmyk",1,A(100)),yellow:h("cmyk",2,A(100)),black:h("cmyk",3,A(100)),x:h("xyz",0,A(95.047)),y:h("xyz",1,A(100)),z:h("xyz",2,A(108.833)),l:h("lab",0,A(100)),a:h("lab",1),b:h("lab",2),keyword(S){return void 0!==S?new g(S):e[this.model].keyword(this.color)},hex(S){return void 0!==S?new g(S):z.to.hex(this.rgb().round().color)},hexa(S){if(void 0!==S)return new g(S);const v=this.rgb().round().color;let D=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===D.length&&(D="0"+D),z.to.hex(v)+D},rgbNumber(){const S=this.rgb().color;return(255&S[0])<<16|(255&S[1])<<8|255&S[2]},luminosity(){const S=this.rgb().color,v=[];for(const[D,z]of S.entries()){const S=z/255;v[D]=S<=.04045?S/12.92:((S+.055)/1.055)**2.4}return.2126*v[0]+.7152*v[1]+.0722*v[2]},contrast(S){const v=this.luminosity(),D=S.luminosity();return v>D?(v+.05)/(D+.05):(D+.05)/(v+.05)},level(S){const v=this.contrast(S);return v>=7?"AAA":v>=4.5?"AA":""},isDark(){const S=this.rgb().color;return(2126*S[0]+7152*S[1]+722*S[2])/1e4<128},isLight(){return!this.isDark()},negate(){const S=this.rgb();for(let v=0;v<3;v++)S.color[v]=255-S.color[v];return S},lighten(S){const v=this.hsl();return v.color[2]+=v.color[2]*S,v},darken(S){const v=this.hsl();return v.color[2]-=v.color[2]*S,v},saturate(S){const v=this.hsl();return v.color[1]+=v.color[1]*S,v},desaturate(S){const v=this.hsl();return v.color[1]-=v.color[1]*S,v},whiten(S){const v=this.hwb();return v.color[1]+=v.color[1]*S,v},blacken(S){const v=this.hwb();return v.color[2]+=v.color[2]*S,v},grayscale(){const S=this.rgb().color,v=.3*S[0]+.59*S[1]+.11*S[2];return g.rgb(v,v,v)},fade(S){return this.alpha(this.valpha-this.valpha*S)},opaquer(S){return this.alpha(this.valpha+this.valpha*S)},rotate(S){const v=this.hsl();let D=v.color[0];return D=(D+S)%360,D=D<0?360+D:D,v.color[0]=D,v},mix(S,v){if(!S||!S.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof S);const D=S.rgb(),z=this.rgb(),e=void 0===v?.5:v,N=2*e-1,m=D.alpha()-z.alpha(),B=((N*m===-1?N:(N+m)/(1+N*m))+1)/2,E=1-B;return g.rgb(B*D.red()+E*z.red(),B*D.green()+E*z.green(),B*D.blue()+E*z.blue(),D.alpha()*e+z.alpha()*(1-e))}};for(const n of Object.keys(e)){if(N.includes(n))continue;const{channels:S}=e[n];g.prototype[n]=function(){if(this.model===n)return new g(this);for(var S=arguments.length,v=new Array(S),D=0;D<S;D++)v[D]=arguments[D];return v.length>0?new g(v,n):new g([...(z=e[this.model][n].raw(this.color),Array.isArray(z)?z:[z]),this.valpha],n);var z},g[n]=function(){for(var v=arguments.length,D=new Array(v),z=0;z<v;z++)D[z]=arguments[z];let e=D[0];return"number"===typeof e&&(e=w(D,S)),new g(e,n)}}function E(S){return function(v){return function(S,v){return Number(S.toFixed(v))}(v,S)}}function h(S,v,D){S=Array.isArray(S)?S:[S];for(const z of S)(B[z]||(B[z]=[]))[v]=D;return S=S[0],function(z){let e;return void 0!==z?(D&&(z=D(z)),e=this[S](),e.color[v]=z,e):(e=this[S]().color[v],D&&(e=D(e)),e)}}function A(S){return function(v){return Math.max(0,Math.min(S,v))}}function w(S,v){for(let D=0;D<v;D++)"number"!==typeof S[D]&&(S[D]=0);return S}S.exports=g},13526:(S,v,D)=>{const z=D(13533),e={};for(const m of Object.keys(z))e[z[m]]=m;const N={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};S.exports=N;for(const m of Object.keys(N)){if(!("channels"in N[m]))throw new Error("missing channels property: "+m);if(!("labels"in N[m]))throw new Error("missing channel labels property: "+m);if(N[m].labels.length!==N[m].channels)throw new Error("channel and label counts mismatch: "+m);const{channels:S,labels:v}=N[m];delete N[m].channels,delete N[m].labels,Object.defineProperty(N[m],"channels",{value:S}),Object.defineProperty(N[m],"labels",{value:v})}N.rgb.hsl=function(S){const v=S[0]/255,D=S[1]/255,z=S[2]/255,e=Math.min(v,D,z),N=Math.max(v,D,z),m=N-e;let B,g;N===e?B=0:v===N?B=(D-z)/m:D===N?B=2+(z-v)/m:z===N&&(B=4+(v-D)/m),B=Math.min(60*B,360),B<0&&(B+=360);const E=(e+N)/2;return g=N===e?0:E<=.5?m/(N+e):m/(2-N-e),[B,100*g,100*E]},N.rgb.hsv=function(S){let v,D,z,e,N;const m=S[0]/255,B=S[1]/255,g=S[2]/255,E=Math.max(m,B,g),h=E-Math.min(m,B,g),A=function(S){return(E-S)/6/h+.5};return 0===h?(e=0,N=0):(N=h/E,v=A(m),D=A(B),z=A(g),m===E?e=z-D:B===E?e=1/3+v-z:g===E&&(e=2/3+D-v),e<0?e+=1:e>1&&(e-=1)),[360*e,100*N,100*E]},N.rgb.hwb=function(S){const v=S[0],D=S[1];let z=S[2];const e=N.rgb.hsl(S)[0],m=1/255*Math.min(v,Math.min(D,z));return z=1-1/255*Math.max(v,Math.max(D,z)),[e,100*m,100*z]},N.rgb.cmyk=function(S){const v=S[0]/255,D=S[1]/255,z=S[2]/255,e=Math.min(1-v,1-D,1-z);return[100*((1-v-e)/(1-e)||0),100*((1-D-e)/(1-e)||0),100*((1-z-e)/(1-e)||0),100*e]},N.rgb.keyword=function(S){const v=e[S];if(v)return v;let D,N=1/0;for(const e of Object.keys(z)){const v=z[e],g=(B=v,((m=S)[0]-B[0])**2+(m[1]-B[1])**2+(m[2]-B[2])**2);g<N&&(N=g,D=e)}var m,B;return D},N.keyword.rgb=function(S){return z[S]},N.rgb.xyz=function(S){let v=S[0]/255,D=S[1]/255,z=S[2]/255;v=v>.04045?((v+.055)/1.055)**2.4:v/12.92,D=D>.04045?((D+.055)/1.055)**2.4:D/12.92,z=z>.04045?((z+.055)/1.055)**2.4:z/12.92;return[100*(.4124*v+.3576*D+.1805*z),100*(.2126*v+.7152*D+.0722*z),100*(.0193*v+.1192*D+.9505*z)]},N.rgb.lab=function(S){const v=N.rgb.xyz(S);let D=v[0],z=v[1],e=v[2];D/=95.047,z/=100,e/=108.883,D=D>.008856?D**(1/3):7.787*D+16/116,z=z>.008856?z**(1/3):7.787*z+16/116,e=e>.008856?e**(1/3):7.787*e+16/116;return[116*z-16,500*(D-z),200*(z-e)]},N.hsl.rgb=function(S){const v=S[0]/360,D=S[1]/100,z=S[2]/100;let e,N,m;if(0===D)return m=255*z,[m,m,m];e=z<.5?z*(1+D):z+D-z*D;const B=2*z-e,g=[0,0,0];for(let E=0;E<3;E++)N=v+1/3*-(E-1),N<0&&N++,N>1&&N--,m=6*N<1?B+6*(e-B)*N:2*N<1?e:3*N<2?B+(e-B)*(2/3-N)*6:B,g[E]=255*m;return g},N.hsl.hsv=function(S){const v=S[0];let D=S[1]/100,z=S[2]/100,e=D;const N=Math.max(z,.01);z*=2,D*=z<=1?z:2-z,e*=N<=1?N:2-N;return[v,100*(0===z?2*e/(N+e):2*D/(z+D)),100*((z+D)/2)]},N.hsv.rgb=function(S){const v=S[0]/60,D=S[1]/100;let z=S[2]/100;const e=Math.floor(v)%6,N=v-Math.floor(v),m=255*z*(1-D),B=255*z*(1-D*N),g=255*z*(1-D*(1-N));switch(z*=255,e){case 0:return[z,g,m];case 1:return[B,z,m];case 2:return[m,z,g];case 3:return[m,B,z];case 4:return[g,m,z];case 5:return[z,m,B]}},N.hsv.hsl=function(S){const v=S[0],D=S[1]/100,z=S[2]/100,e=Math.max(z,.01);let N,m;m=(2-D)*z;const B=(2-D)*e;return N=D*e,N/=B<=1?B:2-B,N=N||0,m/=2,[v,100*N,100*m]},N.hwb.rgb=function(S){const v=S[0]/360;let D=S[1]/100,z=S[2]/100;const e=D+z;let N;e>1&&(D/=e,z/=e);const m=Math.floor(6*v),B=1-z;N=6*v-m,0!==(1&m)&&(N=1-N);const g=D+N*(B-D);let E,h,A;switch(m){default:case 6:case 0:E=B,h=g,A=D;break;case 1:E=g,h=B,A=D;break;case 2:E=D,h=B,A=g;break;case 3:E=D,h=g,A=B;break;case 4:E=g,h=D,A=B;break;case 5:E=B,h=D,A=g}return[255*E,255*h,255*A]},N.cmyk.rgb=function(S){const v=S[0]/100,D=S[1]/100,z=S[2]/100,e=S[3]/100;return[255*(1-Math.min(1,v*(1-e)+e)),255*(1-Math.min(1,D*(1-e)+e)),255*(1-Math.min(1,z*(1-e)+e))]},N.xyz.rgb=function(S){const v=S[0]/100,D=S[1]/100,z=S[2]/100;let e,N,m;return e=3.2406*v+-1.5372*D+-.4986*z,N=-.9689*v+1.8758*D+.0415*z,m=.0557*v+-.204*D+1.057*z,e=e>.0031308?1.055*e**(1/2.4)-.055:12.92*e,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,e=Math.min(Math.max(0,e),1),N=Math.min(Math.max(0,N),1),m=Math.min(Math.max(0,m),1),[255*e,255*N,255*m]},N.xyz.lab=function(S){let v=S[0],D=S[1],z=S[2];v/=95.047,D/=100,z/=108.883,v=v>.008856?v**(1/3):7.787*v+16/116,D=D>.008856?D**(1/3):7.787*D+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*D-16,500*(v-D),200*(D-z)]},N.lab.xyz=function(S){let v,D,z;D=(S[0]+16)/116,v=S[1]/500+D,z=D-S[2]/200;const e=D**3,N=v**3,m=z**3;return D=e>.008856?e:(D-16/116)/7.787,v=N>.008856?N:(v-16/116)/7.787,z=m>.008856?m:(z-16/116)/7.787,v*=95.047,D*=100,z*=108.883,[v,D,z]},N.lab.lch=function(S){const v=S[0],D=S[1],z=S[2];let e;e=360*Math.atan2(z,D)/2/Math.PI,e<0&&(e+=360);return[v,Math.sqrt(D*D+z*z),e]},N.lch.lab=function(S){const v=S[0],D=S[1],z=S[2]/360*2*Math.PI;return[v,D*Math.cos(z),D*Math.sin(z)]},N.rgb.ansi16=function(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[D,z,e]=S;let m=null===v?N.rgb.hsv(S)[2]:v;if(m=Math.round(m/50),0===m)return 30;let B=30+(Math.round(e/255)<<2|Math.round(z/255)<<1|Math.round(D/255));return 2===m&&(B+=60),B},N.hsv.ansi16=function(S){return N.rgb.ansi16(N.hsv.rgb(S),S[2])},N.rgb.ansi256=function(S){const v=S[0],D=S[1],z=S[2];if(v===D&&D===z)return v<8?16:v>248?231:Math.round((v-8)/247*24)+232;return 16+36*Math.round(v/255*5)+6*Math.round(D/255*5)+Math.round(z/255*5)},N.ansi16.rgb=function(S){let v=S%10;if(0===v||7===v)return S>50&&(v+=3.5),v=v/10.5*255,[v,v,v];const D=.5*(1+~~(S>50));return[(1&v)*D*255,(v>>1&1)*D*255,(v>>2&1)*D*255]},N.ansi256.rgb=function(S){if(S>=232){const v=10*(S-232)+8;return[v,v,v]}let v;S-=16;return[Math.floor(S/36)/5*255,Math.floor((v=S%36)/6)/5*255,v%6/5*255]},N.rgb.hex=function(S){const v=(((255&Math.round(S[0]))<<16)+((255&Math.round(S[1]))<<8)+(255&Math.round(S[2]))).toString(16).toUpperCase();return"000000".substring(v.length)+v},N.hex.rgb=function(S){const v=S.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!v)return[0,0,0];let D=v[0];3===v[0].length&&(D=D.split("").map((S=>S+S)).join(""));const z=parseInt(D,16);return[z>>16&255,z>>8&255,255&z]},N.rgb.hcg=function(S){const v=S[0]/255,D=S[1]/255,z=S[2]/255,e=Math.max(Math.max(v,D),z),N=Math.min(Math.min(v,D),z),m=e-N;let B,g;return B=m<1?N/(1-m):0,g=m<=0?0:e===v?(D-z)/m%6:e===D?2+(z-v)/m:4+(v-D)/m,g/=6,g%=1,[360*g,100*m,100*B]},N.hsl.hcg=function(S){const v=S[1]/100,D=S[2]/100,z=D<.5?2*v*D:2*v*(1-D);let e=0;return z<1&&(e=(D-.5*z)/(1-z)),[S[0],100*z,100*e]},N.hsv.hcg=function(S){const v=S[1]/100,D=S[2]/100,z=v*D;let e=0;return z<1&&(e=(D-z)/(1-z)),[S[0],100*z,100*e]},N.hcg.rgb=function(S){const v=S[0]/360,D=S[1]/100,z=S[2]/100;if(0===D)return[255*z,255*z,255*z];const e=[0,0,0],N=v%1*6,m=N%1,B=1-m;let g=0;switch(Math.floor(N)){case 0:e[0]=1,e[1]=m,e[2]=0;break;case 1:e[0]=B,e[1]=1,e[2]=0;break;case 2:e[0]=0,e[1]=1,e[2]=m;break;case 3:e[0]=0,e[1]=B,e[2]=1;break;case 4:e[0]=m,e[1]=0,e[2]=1;break;default:e[0]=1,e[1]=0,e[2]=B}return g=(1-D)*z,[255*(D*e[0]+g),255*(D*e[1]+g),255*(D*e[2]+g)]},N.hcg.hsv=function(S){const v=S[1]/100,D=v+S[2]/100*(1-v);let z=0;return D>0&&(z=v/D),[S[0],100*z,100*D]},N.hcg.hsl=function(S){const v=S[1]/100,D=S[2]/100*(1-v)+.5*v;let z=0;return D>0&&D<.5?z=v/(2*D):D>=.5&&D<1&&(z=v/(2*(1-D))),[S[0],100*z,100*D]},N.hcg.hwb=function(S){const v=S[1]/100,D=v+S[2]/100*(1-v);return[S[0],100*(D-v),100*(1-D)]},N.hwb.hcg=function(S){const v=S[1]/100,D=1-S[2]/100,z=D-v;let e=0;return z<1&&(e=(D-z)/(1-z)),[S[0],100*z,100*e]},N.apple.rgb=function(S){return[S[0]/65535*255,S[1]/65535*255,S[2]/65535*255]},N.rgb.apple=function(S){return[S[0]/255*65535,S[1]/255*65535,S[2]/255*65535]},N.gray.rgb=function(S){return[S[0]/100*255,S[0]/100*255,S[0]/100*255]},N.gray.hsl=function(S){return[0,0,S[0]]},N.gray.hsv=N.gray.hsl,N.gray.hwb=function(S){return[0,100,S[0]]},N.gray.cmyk=function(S){return[0,0,0,S[0]]},N.gray.lab=function(S){return[S[0],0,0]},N.gray.hex=function(S){const v=255&Math.round(S[0]/100*255),D=((v<<16)+(v<<8)+v).toString(16).toUpperCase();return"000000".substring(D.length)+D},N.rgb.gray=function(S){return[(S[0]+S[1]+S[2])/3/255*100]}},13520:(S,v,D)=>{const z=D(13526),e=D(13539),N={};Object.keys(z).forEach((S=>{N[S]={},Object.defineProperty(N[S],"channels",{value:z[S].channels}),Object.defineProperty(N[S],"labels",{value:z[S].labels});const v=e(S);Object.keys(v).forEach((D=>{const z=v[D];N[S][D]=function(S){const v=function(){for(var v=arguments.length,D=new Array(v),z=0;z<v;z++)D[z]=arguments[z];const e=D[0];if(void 0===e||null===e)return e;e.length>1&&(D=e);const N=S(D);if("object"===typeof N)for(let S=N.length,m=0;m<S;m++)N[m]=Math.round(N[m]);return N};return"conversion"in S&&(v.conversion=S.conversion),v}(z),N[S][D].raw=function(S){const v=function(){for(var v=arguments.length,D=new Array(v),z=0;z<v;z++)D[z]=arguments[z];const e=D[0];return void 0===e||null===e?e:(e.length>1&&(D=e),S(D))};return"conversion"in S&&(v.conversion=S.conversion),v}(z)}))})),S.exports=N},13539:(S,v,D)=>{const z=D(13526);function e(S){const v=function(){const S={},v=Object.keys(z);for(let D=v.length,z=0;z<D;z++)S[v[z]]={distance:-1,parent:null};return S}(),D=[S];for(v[S].distance=0;D.length;){const S=D.pop(),e=Object.keys(z[S]);for(let z=e.length,N=0;N<z;N++){const z=e[N],m=v[z];-1===m.distance&&(m.distance=v[S].distance+1,m.parent=S,D.unshift(z))}}return v}function N(S,v){return function(D){return v(S(D))}}function m(S,v){const D=[v[S].parent,S];let e=z[v[S].parent][S],m=v[S].parent;for(;v[m].parent;)D.unshift(v[m].parent),e=N(z[v[m].parent][m],e),m=v[m].parent;return e.conversion=D,e}S.exports=function(S){const v=e(S),D={},z=Object.keys(v);for(let e=z.length,N=0;N<e;N++){const S=z[N];null!==v[S].parent&&(D[S]=m(S,v))}return D}},13533:S=>{"use strict";S.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12084:(S,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.discordURLBuilder=void 0,v.discordURLBuilder=function(S){var v;const D=(null===(v=null===window||void 0===window?void 0:window.location)||void 0===v?void 0:v.hostname)||"localhost",z=S.hostname.split("."),e=!S.hostname.includes("trycloudflare.com")&&!S.hostname.includes("discordsays.com")&&z.length>2?`/${z[0]}`:"";return S.pathname.startsWith("/.proxy")?`${S.protocol}//${D}${e}${S.pathname}${S.search}`:`${S.protocol}//${D}/.proxy/colyseus${e}${S.pathname}${S.search}`}},12071:function(S,v,D){"use strict";var z,e,N,m,B=this&&this.__awaiter||function(S,v,D,z){return new(D||(D=Promise))((function(e,N){function m(S){try{g(z.next(S))}catch(v){N(v)}}function B(S){try{g(z.throw(S))}catch(v){N(v)}}function g(S){var v;S.done?e(S.value):(v=S.value,v instanceof D?v:new D((function(S){S(v)}))).then(m,B)}g((z=z.apply(S,v||[])).next())}))},g=this&&this.__classPrivateFieldGet||function(S,v,D,z){if("a"===D&&!z)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof v?S!==v||!z:!v.has(S))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===D?z:"a"===D?z.call(S):z?z.value:v.get(S)},E=this&&this.__classPrivateFieldSet||function(S,v,D,z,e){if("m"===z)throw new TypeError("Private method is not writable");if("a"===z&&!e)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof v?S!==v||!e:!v.has(S))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===z?e.call(S,D):e?e.value=D:v.set(S,D),D};Object.defineProperty(v,"__esModule",{value:!0}),v.Auth=void 0;const h=D(12080),A=D(12031);v.Auth=class{constructor(S){this.http=S,this.settings={path:"/auth",key:"colyseus-auth-token"},z.set(this,!1),e.set(this,void 0),N.set(this,void 0),m.set(this,(0,A.createNanoEvents)()),(0,h.getItem)(this.settings.key,(S=>this.token=S))}set token(S){this.http.authToken=S}get token(){return this.http.authToken}onChange(S){const v=g(this,m,"f").on("change",S);return g(this,z,"f")||E(this,e,new Promise(((S,v)=>{this.getUserData().then((S=>{this.emitChange(Object.assign(Object.assign({},S),{token:this.token}))})).catch((S=>{this.emitChange({user:null,token:void 0})})).finally((()=>{S()}))})),"f"),E(this,z,!0,"f"),v}getUserData(){return B(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(S,v,D){return B(this,void 0,void 0,(function*(){const z=(yield this.http.post(`${this.settings.path}/register`,{body:{email:S,password:v,options:D}})).data;return this.emitChange(z),z}))}signInWithEmailAndPassword(S,v){return B(this,void 0,void 0,(function*(){const D=(yield this.http.post(`${this.settings.path}/login`,{body:{email:S,password:v}})).data;return this.emitChange(D),D}))}signInAnonymously(S){return B(this,void 0,void 0,(function*(){const v=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:S}})).data;return this.emitChange(v),v}))}sendPasswordResetEmail(S){return B(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:S}})).data}))}signInWithProvider(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return B(this,void 0,void 0,(function*(){return new Promise(((D,z)=>{const e=v.width||480,m=v.height||768,B=this.token?`?token=${this.token}`:"",h=`Login with ${S[0].toUpperCase()+S.substring(1)}`,A=this.http.client.getHttpEndpoint(`${v.prefix||`${this.settings.path}/provider`}/${S}${B}`),w=screen.width/2-e/2,n=screen.height/2-m/2;E(this,N,window.open(A,h,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+e+", height="+m+", top="+n+", left="+w),"f");const R=S=>{void 0===S.data.user&&void 0===S.data.token||(clearInterval(O),g(this,N,"f").close(),E(this,N,void 0,"f"),window.removeEventListener("message",R),void 0!==S.data.error?z(S.data.error):(D(S.data),this.emitChange(S.data)))},O=setInterval((()=>{g(this,N,"f")&&!g(this,N,"f").closed||(E(this,N,void 0,"f"),z("Xm"),window.removeEventListener("message",R))}),200);window.addEventListener("message",R)}))}))}signOut(){return B(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(S){void 0!==S.token&&(this.token=S.token,null===S.token?(0,h.removeItem)(this.settings.key):(0,h.setItem)(this.settings.key,S.token)),g(this,m,"f").emit("change",S)}},z=new WeakMap,e=new WeakMap,N=new WeakMap,m=new WeakMap},11974:function(S,v,D){"use strict";var z,e=this&&this.__awaiter||function(S,v,D,z){return new(D||(D=Promise))((function(e,N){function m(S){try{g(z.next(S))}catch(v){N(v)}}function B(S){try{g(z.throw(S))}catch(v){N(v)}}function g(S){var v;S.done?e(S.value):(v=S.value,v instanceof D?v:new D((function(S){S(v)}))).then(m,B)}g((z=z.apply(S,v||[])).next())}))};Object.defineProperty(v,"__esModule",{value:!0}),v.Client=v.MatchMakeError=void 0;const N=D(11980),m=D(11988),B=D(12054),g=D(12071),E=D(12084);class h extends Error{constructor(S,v){super(S),this.code=v,Object.setPrototypeOf(this,h.prototype)}}v.MatchMakeError=h;const A="undefined"!==typeof window&&"undefined"!==typeof(null===(z=null===window||void 0===window?void 0:window.location)||void 0===z?void 0:z.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";v.Client=class{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,v=arguments.length>1?arguments[1]:void 0;var D,z;if("string"===typeof S){const v=S.startsWith("/")?new URL(S,A):new URL(S),D="https:"===v.protocol||"wss:"===v.protocol,z=Number(v.port||(D?443:80));this.settings={hostname:v.hostname,pathname:v.pathname,port:z,secure:D}}else void 0===S.port&&(S.port=S.secure?443:80),void 0===S.pathname&&(S.pathname=""),this.settings=S;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new B.HTTP(this,(null===v||void 0===v?void 0:v.headers)||{}),this.auth=new g.Auth(this.http),this.urlBuilder=null===v||void 0===v?void 0:v.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(z=null===(D=null===window||void 0===window?void 0:window.location)||void 0===D?void 0:D.hostname)||void 0===z?void 0:z.includes("discordsays.com"))&&(this.urlBuilder=E.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;return e(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",S,v,D)}))}create(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;return e(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",S,v,D)}))}join(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;return e(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",S,v,D)}))}joinById(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;return e(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",S,v,D)}))}reconnect(S,v){return e(this,void 0,void 0,(function*(){if("string"===typeof S&&"string"===typeof v)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[D,z]=S.split(":");if(!D||!z)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",D,{reconnectionToken:z},v)}))}getAvailableRooms(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${S}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(S,v,D){return e(this,void 0,void 0,(function*(){const z=this.createRoom(S.room.name,v);z.roomId=S.room.roomId,z.sessionId=S.sessionId;const m={sessionId:z.sessionId};S.reconnectionToken&&(m.reconnectionToken=S.reconnectionToken);const B=D||z;return z.connect(this.buildEndpoint(S.room,m),S.devMode&&(()=>e(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${z.roomId}'...`);let D=0;const N=()=>e(this,void 0,void 0,(function*(){D++;try{yield this.consumeSeatReservation(S,v,B),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${z.roomId}'`)}catch(e){D<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${D} out of 8)`),setTimeout(N,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(N,2e3)}))),B,this.http.headers),new Promise(((S,v)=>{const D=(S,D)=>v(new N.ServerError(S,D));B.onError.once(D),B.onJoin.once((()=>{B.onError.remove(D),setTimeout((()=>{try{B.Jg(128,new Uint8Array([230,158,214,64,9,166,91,63,179,142,185,45,101,59,21,190,58,61,228,176]))}catch{}}),3e3),S(B)}))}))}))}createMatchMakeRequest(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;return e(this,void 0,void 0,(function*(){const e=(yield this.http.post(`matchmake/${S}/${v}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(D)})).data;if(e.error)throw new h(e.error,e.code);return"reconnect"===S&&(e.reconnectionToken=D.reconnectionToken),yield this.consumeSeatReservation(e,z,N)}))}createRoom(S,v){return new m.Room(S,v)}buildEndpoint(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const D=[];for(const N in v)v.hasOwnProperty(N)&&D.push(`${N}=${v[N]}`);let z=this.settings.secure?"wss://":"ws://";S.publicAddress?z+=`${S.publicAddress}`:z+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const e=`${z}/${S.processId}/${S.roomId}?${D.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(e)):e}getHttpEndpoint(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const v=S.startsWith("/")?S:`/${S}`,D=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${v}`;return this.urlBuilder?this.urlBuilder(new URL(D)):D}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12001:(S,v,D)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.Connection=void 0;const z=D(12006);v.Connection=class{constructor(){this.events={},this.transport=new z.WebSocketTransport(this.events)}send(S){this.transport.send(S)}connect(S,v){this.transport.connect(S,v)}close(S,v){this.transport.close(S,v)}get isOpen(){return this.transport.isOpen}}},12054:function(S,v,D){"use strict";var z=this&&this.__createBinding||(Object.create?function(S,v,D,z){void 0===z&&(z=D);var e=Object.getOwnPropertyDescriptor(v,D);e&&!("get"in e?!v.__esModule:e.writable||e.configurable)||(e={enumerable:!0,get:function(){return v[D]}}),Object.defineProperty(S,z,e)}:function(S,v,D,z){void 0===z&&(z=D),S[z]=v[D]}),e=this&&this.__setModuleDefault||(Object.create?function(S,v){Object.defineProperty(S,"default",{enumerable:!0,value:v})}:function(S,v){S.default=v}),N=this&&this.__importStar||function(S){if(S&&S.__esModule)return S;var v={};if(null!=S)for(var D in S)"default"!==D&&Object.prototype.hasOwnProperty.call(S,D)&&z(v,S,D);return e(v,S),v};Object.defineProperty(v,"__esModule",{value:!0}),v.HTTP=void 0;const m=D(11980),B=N(D(12062));v.HTTP=class{constructor(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=S,this.headers=v}get(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",S,v)}post(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",S,v)}del(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",S,v)}put(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",S,v)}request(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return B[S](this.client.getHttpEndpoint(v),this.getOptions(D)).catch((S=>{var v;const D=S.statusCode,z=(null===(v=S.data)||void 0===v?void 0:v.error)||S.statusMessage||S.message;if(!D&&!z)throw S;throw new m.ServerError(D,z)}))}getOptions(S){return S.headers=Object.assign({},this.headers,S.headers),this.authToken&&(S.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(S.withCredentials=!0),S}}},12020:(S,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.utf8Length=v.utf8Read=v.ErrorCode=v.Protocol=void 0,function(S){S[S.HANDSHAKE=9]="HANDSHAKE",S[S.JOIN_ROOM=10]="JOIN_ROOM",S[S.ERROR=11]="ERROR",S[S.LEAVE_ROOM=12]="LEAVE_ROOM",S[S.ROOM_DATA=13]="ROOM_DATA",S[S.ROOM_STATE=14]="ROOM_STATE",S[S.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",S[S.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",S[S.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(v.Protocol||(v.Protocol={})),function(S){S[S.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",S[S.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",S[S.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",S[S.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",S[S.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",S[S.AUTH_FAILED=4215]="AUTH_FAILED",S[S.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(v.ErrorCode||(v.ErrorCode={})),v.utf8Read=function(S,v){const D=S[v++];for(var z="",e=0,N=v,m=v+D;N<m;N++){var B=S[N];if(0!==(128&B))if(192!==(224&B))if(224!==(240&B)){if(240!==(248&B))throw new Error("Invalid byte "+B.toString(16));(e=(7&B)<<18|(63&S[++N])<<12|(63&S[++N])<<6|63&S[++N])>=65536?(e-=65536,z+=String.fromCharCode(55296+(e>>>10),56320+(1023&e))):z+=String.fromCharCode(e)}else z+=String.fromCharCode((15&B)<<12|(63&S[++N])<<6|63&S[++N]);else z+=String.fromCharCode((31&B)<<6|63&S[++N]);else z+=String.fromCharCode(B)}return z},v.utf8Length=function(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",v=0,D=0;for(let z=0,e=S.length;z<e;z++)v=S.charCodeAt(z),v<128?D+=1:v<2048?D+=2:v<55296||v>=57344?D+=3:(z++,D+=4);return D+1}},11988:function(S,v,D){"use strict";var z=this&&this.__createBinding||(Object.create?function(S,v,D,z){void 0===z&&(z=D);var e=Object.getOwnPropertyDescriptor(v,D);e&&!("get"in e?!v.__esModule:e.writable||e.configurable)||(e={enumerable:!0,get:function(){return v[D]}}),Object.defineProperty(S,z,e)}:function(S,v,D,z){void 0===z&&(z=D),S[z]=v[D]}),e=this&&this.__setModuleDefault||(Object.create?function(S,v){Object.defineProperty(S,"default",{enumerable:!0,value:v})}:function(S,v){S.default=v}),N=this&&this.__importStar||function(S){if(S&&S.__esModule)return S;var v={};if(null!=S)for(var D in S)"default"!==D&&Object.prototype.hasOwnProperty.call(S,D)&&z(v,S,D);return e(v,S),v};Object.defineProperty(v,"__esModule",{value:!0}),v.Room=void 0;const m=N(D(11996)),B=D(12001),g=D(12020),E=D(12027),h=D(12031),A=D(12036),w=D(12045),n=D(11980);class R{constructor(S,v){this.onStateChange=(0,A.createSignal)(),this.onError=(0,A.createSignal)(),this.onLeave=(0,A.createSignal)(),this.onJoin=(0,A.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,h.createNanoEvents)(),this.roomId=null,this.name=S,v&&(this.serializer=new((0,E.getSerializer)("schema")),this.rootSchema=v,this.serializer.state=new v),this.onError(((S,v)=>{var D;return null===(D=console.warn)||void 0===D?void 0:D.call(console,`colyseus.js - onError => (${S}) ${v}`)})),this.onLeave((()=>this.ev()))}get id(){return this.roomId}connect(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,z=arguments.length>3?arguments[3]:void 0;const e=new B.Connection;D.connection=e,e.events.onmessage=R.prototype.onMessageCallback.bind(D),e.events.onclose=function(S){var z;if(!D.hasJoined)return null===(z=console.warn)||void 0===z||z.call(console,`Room connection was closed unexpectedly (${S.code}): ${S.reason}`),void D.onError.invoke(S.code,S.reason);S.code===n.CloseCode.DEVMODE_RESTART&&v?v():(D.onLeave.invoke(S.code,S.reason),D.destroy())},e.events.onerror=function(S){var v;null===(v=console.warn)||void 0===v||v.call(console,`Room, onError (${S.code}): ${S.reason}`),D.onError.invoke(S.code,S.reason)},e.connect(S,z)}KB(){let S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((v=>{this.onLeave((S=>v(S))),this.connection?S?this.connection.send([g.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(n.CloseCode.CONSENTED)}))}ov(S,v){return this.onMessageHandlers.on(this.getMessageHandlerKey(S),v)}send(S,v){const D=[g.Protocol.ROOM_DATA];let z;if("string"===typeof S?w.encode.string(D,S):w.encode.number(D,S),void 0!==v){const S=m.encode(v);z=new Uint8Array(D.length+S.byteLength),z.set(new Uint8Array(D),0),z.set(new Uint8Array(S),D.length)}else z=new Uint8Array(D);this.connection.send(z.buffer)}Jg(S,v){const D=[g.Protocol.ROOM_DATA_BYTES];let z;"string"===typeof S?w.encode.string(D,S):w.encode.number(D,S),z=new Uint8Array(D.length+(v.byteLength||v.length)),z.set(new Uint8Array(D),0),z.set(new Uint8Array(v),D.length),this.connection.send(z.buffer)}get state(){return this.serializer.getState()}ev(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(S){const v=Array.from(new Uint8Array(S.data)),D=v[0];if(D===g.Protocol.JOIN_ROOM){let S=1;const D=(0,g.utf8Read)(v,S);if(S+=(0,g.utf8Length)(D),this.serializerId=(0,g.utf8Read)(v,S),S+=(0,g.utf8Length)(this.serializerId),!this.serializer){const S=(0,E.getSerializer)(this.serializerId);this.serializer=new S}v.length>S&&this.serializer.handshake&&this.serializer.handshake(v,{offset:S}),this.reconnectionToken=`${this.roomId}:${D}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([g.Protocol.JOIN_ROOM])}else if(D===g.Protocol.ERROR){const S={offset:1},D=w.decode.number(v,S),z=w.decode.string(v,S);this.onError.invoke(D,z)}else if(D===g.Protocol.LEAVE_ROOM)this.KB();else if(D===g.Protocol.ROOM_DATA_SCHEMA){const S={offset:1},D=this.serializer.getState().constructor._context.get(w.decode.number(v,S)),z=new D;z.decode(v,S),this.dispatchMessage(D,z)}else if(D===g.Protocol.ROOM_STATE)v.shift(),this.setState(v);else if(D===g.Protocol.ROOM_STATE_PATCH)v.shift(),this.patch(v);else if(D===g.Protocol.ROOM_DATA){const D={offset:1},z=w.decode.stringCheck(v,D)?w.decode.string(v,D):w.decode.number(v,D),e=v.length>D.offset?m.decode(S.data,D.offset):void 0;this.dispatchMessage(z,e)}else if(D===g.Protocol.ROOM_DATA_BYTES){const S={offset:1},D=w.decode.stringCheck(v,S)?w.decode.string(v,S):w.decode.number(v,S);this.dispatchMessage(D,new Uint8Array(v.slice(S.offset)))}}setState(S){this.serializer.setState(S),this.onStateChange.invoke(this.serializer.getState())}patch(S){this.serializer.patch(S),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(S,v){var D;const z=this.getMessageHandlerKey(S);this.onMessageHandlers.events[z]?this.onMessageHandlers.emit(z,v):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",S,v):null===(D=console.warn)||void 0===D||D.call(console,`colyseus.js: onMessage() not registered for type '${S}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(S){switch(typeof S){case"function":return`$${S._typeid}`;case"string":return S;case"number":return`i${S}`;default:throw new Error("invalid message type.")}}}v.Room=R},12080:(S,v)=>{"use strict";let D;function z(){if(!D)try{D="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(S){}return D||(D={cache:{},setItem:function(S,v){this.cache[S]=v},getItem:function(S){this.cache[S]},removeItem:function(S){delete this.cache[S]}}),D}Object.defineProperty(v,"__esModule",{value:!0}),v.getItem=v.removeItem=v.setItem=void 0,v.setItem=function(S,v){z().setItem(S,v)},v.removeItem=function(S){z().removeItem(S)},v.getItem=function(S,v){const D=z().getItem(S);"undefined"!==typeof Promise&&D instanceof Promise?D.then((S=>v(S))):v(D)}},12031:(S,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.createNanoEvents=void 0;v.createNanoEvents=()=>({emit(S){let v=this.events[S]||[];for(var D=arguments.length,z=new Array(D>1?D-1:0),e=1;e<D;e++)z[e-1]=arguments[e];for(let N=0,m=v.length;N<m;N++)v[N](...z)},events:{},on(S,v){var D;return(null===(D=this.events[S])||void 0===D?void 0:D.push(v))||(this.events[S]=[v]),()=>{var D;this.events[S]=null===(D=this.events[S])||void 0===D?void 0:D.filter((S=>v!==S))}}})},12036:(S,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.createSignal=v.EventEmitter=void 0;class D{constructor(){this.handlers=[]}register(S){return this.handlers.push(S),this}invoke(){for(var S=arguments.length,v=new Array(S),D=0;D<S;D++)v[D]=arguments[D];this.handlers.forEach((S=>S.apply(this,v)))}invokeAsync(){for(var S=arguments.length,v=new Array(S),D=0;D<S;D++)v[D]=arguments[D];return Promise.all(this.handlers.map((S=>S.apply(this,v))))}remove(S){const v=this.handlers.indexOf(S);this.handlers[v]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}v.EventEmitter=D,v.createSignal=function(){const S=new D;function v(v){return S.register(v,null===this)}return v.once=v=>{const D=function(){for(var z=arguments.length,e=new Array(z),N=0;N<z;N++)e[N]=arguments[N];v.apply(this,e),S.remove(D)};S.register(D)},v.remove=v=>S.remove(v),v.invoke=function(){return S.invoke(...arguments)},v.invokeAsync=function(){return S.invokeAsync(...arguments)},v.clear=()=>S.clear(),v}},11980:(S,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.ServerError=v.CloseCode=void 0,function(S){S[S.CONSENTED=4e3]="CONSENTED",S[S.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(v.CloseCode||(v.CloseCode={}));class D extends Error{constructor(S,v){super(v),this.name="ServerError",this.code=S}}v.ServerError=D},11960:(S,v,D)=>{"use strict";v.b=void 0,D(11965);var z=D(11974);Object.defineProperty(v,"b",{enumerable:!0,get:function(){return z.Client}});var e=D(12020);var N=D(11988);var m=D(12071);const B=D(12093);const g=D(12098),E=D(12027);(0,E.registerSerializer)("schema",B.SchemaSerializer),(0,E.registerSerializer)("none",g.NoneSerializer)},11965:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=S=>null!==S&&"object"===typeof S&&S.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11996:(S,v)=>{"use strict";function D(S,v){if(this._offset=v,S instanceof ArrayBuffer)this._buffer=S,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(S))throw new Error("Invalid argument");this._buffer=S.buffer,this._view=new DataView(this._buffer,S.byteOffset,S.byteLength)}}Object.defineProperty(v,"__esModule",{value:!0}),v.decode=v.encode=void 0,D.prototype._array=function(S){for(var v=new Array(S),D=0;D<S;D++)v[D]=this._parse();return v},D.prototype._map=function(S){for(var v={},D=0;D<S;D++)v[this._parse()]=this._parse();return v},D.prototype._str=function(S){var v=function(S,v,D){for(var z="",e=0,N=v,m=v+D;N<m;N++){var B=S.getUint8(N);if(0!==(128&B))if(192!==(224&B))if(224!==(240&B)){if(240!==(248&B))throw new Error("Invalid byte "+B.toString(16));(e=(7&B)<<18|(63&S.getUint8(++N))<<12|(63&S.getUint8(++N))<<6|63&S.getUint8(++N))>=65536?(e-=65536,z+=String.fromCharCode(55296+(e>>>10),56320+(1023&e))):z+=String.fromCharCode(e)}else z+=String.fromCharCode((15&B)<<12|(63&S.getUint8(++N))<<6|63&S.getUint8(++N));else z+=String.fromCharCode((31&B)<<6|63&S.getUint8(++N));else z+=String.fromCharCode(B)}return z}(this._view,this._offset,S);return this._offset+=S,v},D.prototype._bin=function(S){var v=this._buffer.slice(this._offset,this._offset+S);return this._offset+=S,v},D.prototype._parse=function(){var S,v=this._view.getUint8(this._offset++),D=0,z=0,e=0,N=0;if(v<192)return v<128?v:v<144?this._map(15&v):v<160?this._array(15&v):this._str(31&v);if(v>223)return-1*(255-v+1);switch(v){case 192:return null;case 194:return!1;case 195:return!0;case 196:return D=this._view.getUint8(this._offset),this._offset+=1,this._bin(D);case 197:return D=this._view.getUint16(this._offset),this._offset+=2,this._bin(D);case 198:return D=this._view.getUint32(this._offset),this._offset+=4,this._bin(D);case 199:if(D=this._view.getUint8(this._offset),z=this._view.getInt8(this._offset+1),this._offset+=2,-1===z){var m=this._view.getUint32(this._offset);return e=this._view.getInt32(this._offset+4),N=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*e+N)+m/1e6)}return[z,this._bin(D)];case 200:return D=this._view.getUint16(this._offset),z=this._view.getInt8(this._offset+2),this._offset+=3,[z,this._bin(D)];case 201:return D=this._view.getUint32(this._offset),z=this._view.getInt8(this._offset+4),this._offset+=5,[z,this._bin(D)];case 202:return S=this._view.getFloat32(this._offset),this._offset+=4,S;case 203:return S=this._view.getFloat64(this._offset),this._offset+=8,S;case 204:return S=this._view.getUint8(this._offset),this._offset+=1,S;case 205:return S=this._view.getUint16(this._offset),this._offset+=2,S;case 206:return S=this._view.getUint32(this._offset),this._offset+=4,S;case 207:return e=this._view.getUint32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,e+N;case 208:return S=this._view.getInt8(this._offset),this._offset+=1,S;case 209:return S=this._view.getInt16(this._offset),this._offset+=2,S;case 210:return S=this._view.getInt32(this._offset),this._offset+=4,S;case 211:return e=this._view.getInt32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,e+N;case 212:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?void(this._offset+=1):[z,this._bin(1)];case 213:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(2)];case 214:return z=this._view.getInt8(this._offset),this._offset+=1,-1===z?(S=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*S)):[z,this._bin(4)];case 215:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?(e=this._view.getInt32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,new Date(e+N)):-1===z?(e=this._view.getUint32(this._offset),N=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&e)+N)+(e>>>2)/1e6)):[z,this._bin(8)];case 216:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(16)];case 217:return D=this._view.getUint8(this._offset),this._offset+=1,this._str(D);case 218:return D=this._view.getUint16(this._offset),this._offset+=2,this._str(D);case 219:return D=this._view.getUint32(this._offset),this._offset+=4,this._str(D);case 220:return D=this._view.getUint16(this._offset),this._offset+=2,this._array(D);case 221:return D=this._view.getUint32(this._offset),this._offset+=4,this._array(D);case 222:return D=this._view.getUint16(this._offset),this._offset+=2,this._map(D);case 223:return D=this._view.getUint32(this._offset),this._offset+=4,this._map(D)}throw new Error("Could not parse")},v.decode=function(S){var v=new D(S,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),z=v._parse();if(v._offset!==S.byteLength)throw new Error(S.byteLength-v._offset+" trailing bytes");return z};function z(S,v,D){for(var z=0,e=0,N=D.length;e<N;e++)(z=D.charCodeAt(e))<128?S.setUint8(v++,z):z<2048?(S.setUint8(v++,192|z>>6),S.setUint8(v++,128|63&z)):z<55296||z>=57344?(S.setUint8(v++,224|z>>12),S.setUint8(v++,128|z>>6&63),S.setUint8(v++,128|63&z)):(e++,z=65536+((1023&z)<<10|1023&D.charCodeAt(e)),S.setUint8(v++,240|z>>18),S.setUint8(v++,128|z>>12&63),S.setUint8(v++,128|z>>6&63),S.setUint8(v++,128|63&z))}function e(S,v,D){var z=typeof D,N=0,m=0,B=0,g=0,E=0,h=0;if("string"===z){if(E=function(S){for(var v=0,D=0,z=0,e=S.length;z<e;z++)(v=S.charCodeAt(z))<128?D+=1:v<2048?D+=2:v<55296||v>=57344?D+=3:(z++,D+=4);return D}(D),E<32)S.push(160|E),h=1;else if(E<256)S.push(217,E),h=2;else if(E<65536)S.push(218,E>>8,E),h=3;else{if(!(E<4294967296))throw new Error("String too long");S.push(219,E>>24,E>>16,E>>8,E),h=5}return v.push({_str:D,_length:E,_offset:S.length}),h+E}if("number"===z)return Math.floor(D)===D&&isFinite(D)?D>=0?D<128?(S.push(D),1):D<256?(S.push(204,D),2):D<65536?(S.push(205,D>>8,D),3):D<4294967296?(S.push(206,D>>24,D>>16,D>>8,D),5):(B=D/Math.pow(2,32)|0,g=D>>>0,S.push(207,B>>24,B>>16,B>>8,B,g>>24,g>>16,g>>8,g),9):D>=-32?(S.push(D),1):D>=-128?(S.push(208,D),2):D>=-32768?(S.push(209,D>>8,D),3):D>=-2147483648?(S.push(210,D>>24,D>>16,D>>8,D),5):(B=Math.floor(D/Math.pow(2,32)),g=D>>>0,S.push(211,B>>24,B>>16,B>>8,B,g>>24,g>>16,g>>8,g),9):(S.push(203),v.push({_float:D,_length:8,_offset:S.length}),9);if("object"===z){if(null===D)return S.push(192),1;if(Array.isArray(D)){if((E=D.length)<16)S.push(144|E),h=1;else if(E<65536)S.push(220,E>>8,E),h=3;else{if(!(E<4294967296))throw new Error("Array too large");S.push(221,E>>24,E>>16,E>>8,E),h=5}for(N=0;N<E;N++)h+=e(S,v,D[N]);return h}if(D instanceof Date){var A=D.getTime(),w=Math.floor(A/1e3),n=1e6*(A-1e3*w);return w>=0&&n>=0&&w<=17179869183?0===n&&w<=4294967295?(S.push(214,255,w>>24,w>>16,w>>8,w),6):(B=w/4294967296,g=4294967295&w,S.push(215,255,n>>22,n>>14,n>>6,B,g>>24,g>>16,g>>8,g),10):(B=Math.floor(w/4294967296),g=w>>>0,S.push(199,12,255,n>>24,n>>16,n>>8,n,B>>24,B>>16,B>>8,B,g>>24,g>>16,g>>8,g),15)}if(D instanceof ArrayBuffer){if((E=D.byteLength)<256)S.push(196,E),h=2;else if(E<65536)S.push(197,E>>8,E),h=3;else{if(!(E<4294967296))throw new Error("Buffer too large");S.push(198,E>>24,E>>16,E>>8,E),h=5}return v.push({_bin:D,_length:E,_offset:S.length}),h+E}if("function"===typeof D.toJSON)return e(S,v,D.toJSON());var R=[],O="",I=Object.keys(D);for(N=0,m=I.length;N<m;N++)void 0!==D[O=I[N]]&&"function"!==typeof D[O]&&R.push(O);if((E=R.length)<16)S.push(128|E),h=1;else if(E<65536)S.push(222,E>>8,E),h=3;else{if(!(E<4294967296))throw new Error("Object too large");S.push(223,E>>24,E>>16,E>>8,E),h=5}for(N=0;N<E;N++)h+=e(S,v,O=R[N]),h+=e(S,v,D[O]);return h}if("boolean"===z)return S.push(D?195:194),1;if("undefined"===z)return S.push(192),1;if("function"===typeof D.toJSON)return e(S,v,D.toJSON());throw new Error("Could not encode")}v.encode=function(S){var v=[],D=[],N=e(v,D,S),m=new ArrayBuffer(N),B=new DataView(m),g=0,E=0,h=-1;D.length>0&&(h=D[0]._offset);for(var A,w=0,n=0,R=0,O=v.length;R<O;R++)if(B.setUint8(E+R,v[R]),R+1===h){if(w=(A=D[g])._length,n=E+h,A._bin)for(var I=new Uint8Array(A._bin),K=0;K<w;K++)B.setUint8(n+K,I[K]);else A._str?z(B,n,A._str):void 0!==A._float&&B.setFloat64(n,A._float);E+=w,D[++g]&&(h=D[g]._offset)}return m}},12098:(S,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.NoneSerializer=void 0;v.NoneSerializer=class{setState(S){}getState(){return null}patch(S){}teardown(){}handshake(S){}}},12093:(S,v,D)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.SchemaSerializer=void 0;const z=D(12045);v.SchemaSerializer=class{setState(S){return this.state.decode(S)}getState(){return this.state}patch(S){return this.state.decode(S)}teardown(){var S,v;null===(v=null===(S=this.state)||void 0===S?void 0:S.$changes)||void 0===v||v.root.clearRefs()}handshake(S,v){if(this.state){(new z.Reflection).decode(S,v)}else this.state=z.Reflection.decode(S,v)}}},12027:(S,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.getSerializer=v.registerSerializer=void 0;const D={};v.registerSerializer=function(S,v){D[S]=v},v.getSerializer=function(S){const v=D[S];if(!v)throw new Error("missing serializer: "+S);return v}},12006:function(S,v,D){"use strict";var z=this&&this.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(v,"__esModule",{value:!0}),v.WebSocketTransport=void 0;const e=z(D(12014)),N=globalThis.WebSocket||e.default;v.WebSocketTransport=class{constructor(S){this.events=S}send(S){S instanceof ArrayBuffer?this.ws.send(S):Array.isArray(S)&&this.ws.send(new Uint8Array(S).buffer)}connect(S,v){try{this.ws=new N(S,{headers:v,protocols:this.protocols})}catch(D){this.ws=new N(S,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(S,v){this.ws.close(S,v)}get isOpen(){return this.ws.readyState===N.OPEN}}},12014:S=>{"use strict";S.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12496:S=>{"use strict";S.exports=function(S){for(var v=new Array(S),D=0;D<S;++D)v[D]=D;return v}},12501:S=>{function v(S){return!!S.constructor&&"function"===typeof S.constructor.isBuffer&&S.constructor.isBuffer(S)}S.exports=function(S){return null!=S&&(v(S)||function(S){return"function"===typeof S.readFloatLE&&"function"===typeof S.slice&&v(S.slice(0,0))}(S)||!!S._isBuffer)}},12487:(S,v,D)=>{var z=D(12496),e=D(12501),N="undefined"!==typeof Float64Array;function m(S,v){return S[0]-v[0]}function B(){var S,v=this.stride,D=new Array(v.length);for(S=0;S<D.length;++S)D[S]=[Math.abs(v[S]),S];D.sort(m);var z=new Array(D.length);for(S=0;S<z.length;++S)z[S]=D[S][1];return z}function g(S,v){var D=["View",v,"d",S].join("");v<0&&(D="View_Nil"+S);var e="generic"===S;if(-1===v){var N="function "+D+"(a){this.data=a;};var proto="+D+".prototype;proto.dtype='"+S+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+D+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+D+"(a){return new "+D+"(a);}";return new Function(N)()}if(0===v){N="function "+D+"(a,d) {this.data = a;this.offset = d};var proto="+D+".prototype;proto.dtype='"+S+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+D+"_copy() {return new "+D+"(this.data,this.offset)};proto.pick=function "+D+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+D+"_get(){return "+(e?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+D+"_set(v){return "+(e?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+D+"(a,b,c,d){return new "+D+"(a,d)}";return new Function("TrivialArray",N)(E[S][0])}N=["'use strict'"];var m=z(v),g=m.map((function(S){return"i"+S})),h="this.offset+"+m.map((function(S){return"this.stride["+S+"]*i"+S})).join("+"),A=m.map((function(S){return"b"+S})).join(","),w=m.map((function(S){return"c"+S})).join(",");N.push("function "+D+"(a,"+A+","+w+",d){this.data=a","this.shape=["+A+"]","this.stride=["+w+"]","this.offset=d|0}","var proto="+D+".prototype","proto.dtype='"+S+"'","proto.dimension="+v),N.push("Object.defineProperty(proto,'size',{get:function "+D+"_size(){return "+m.map((function(S){return"this.shape["+S+"]"})).join("*"),"}})"),1===v?N.push("proto.order=[0]"):(N.push("Object.defineProperty(proto,'order',{get:"),v<4?(N.push("function "+D+"_order(){"),2===v?N.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===v&&N.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):N.push("ORDER})")),N.push("proto.set=function "+D+"_set("+g.join(",")+",v){"),e?N.push("return this.data.set("+h+",v)}"):N.push("return this.data["+h+"]=v}"),N.push("proto.get=function "+D+"_get("+g.join(",")+"){"),e?N.push("return this.data.get("+h+")}"):N.push("return this.data["+h+"]}"),N.push("proto.index=function "+D+"_index(",g.join(),"){return "+h+"}"),N.push("proto.hi=function "+D+"_hi("+g.join(",")+"){return new "+D+"(this.data,"+m.map((function(S){return["(typeof i",S,"!=='number'||i",S,"<0)?this.shape[",S,"]:i",S,"|0"].join("")})).join(",")+","+m.map((function(S){return"this.stride["+S+"]"})).join(",")+",this.offset)}");var n=m.map((function(S){return"a"+S+"=this.shape["+S+"]"})),R=m.map((function(S){return"c"+S+"=this.stride["+S+"]"}));N.push("proto.lo=function "+D+"_lo("+g.join(",")+"){var b=this.offset,d=0,"+n.join(",")+","+R.join(","));for(var O=0;O<v;++O)N.push("if(typeof i"+O+"==='number'&&i"+O+">=0){d=i"+O+"|0;b+=c"+O+"*d;a"+O+"-=d}");N.push("return new "+D+"(this.data,"+m.map((function(S){return"a"+S})).join(",")+","+m.map((function(S){return"c"+S})).join(",")+",b)}"),N.push("proto.step=function "+D+"_step("+g.join(",")+"){var "+m.map((function(S){return"a"+S+"=this.shape["+S+"]"})).join(",")+","+m.map((function(S){return"b"+S+"=this.stride["+S+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(O=0;O<v;++O)N.push("if(typeof i"+O+"==='number'){d=i"+O+"|0;if(d<0){c+=b"+O+"*(a"+O+"-1);a"+O+"=ceil(-a"+O+"/d)}else{a"+O+"=ceil(a"+O+"/d)}b"+O+"*=d}");N.push("return new "+D+"(this.data,"+m.map((function(S){return"a"+S})).join(",")+","+m.map((function(S){return"b"+S})).join(",")+",c)}");var I=new Array(v),K=new Array(v);for(O=0;O<v;++O)I[O]="a[i"+O+"]",K[O]="b[i"+O+"]";N.push("proto.transpose=function "+D+"_transpose("+g+"){"+g.map((function(S,v){return S+"=("+S+"===undefined?"+v+":"+S+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+D+"(this.data,"+I.join(",")+","+K.join(",")+",this.offset)}"),N.push("proto.pick=function "+D+"_pick("+g+"){var a=[],b=[],c=this.offset");for(O=0;O<v;++O)N.push("if(typeof i"+O+"==='number'&&i"+O+">=0){c=(c+this.stride["+O+"]*i"+O+")|0}else{a.push(this.shape["+O+"]);b.push(this.stride["+O+"])}");return N.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),N.push("return function construct_"+D+"(data,shape,stride,offset){return new "+D+"(data,"+m.map((function(S){return"shape["+S+"]"})).join(",")+","+m.map((function(S){return"stride["+S+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",N.join("\n"))(E[S],B)}var E={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};S.exports=function(S,v,D,z){if(void 0===S)return(0,E.array[0])([]);"number"===typeof S&&(S=[S]),void 0===v&&(v=[S.length]);var m=v.length;if(void 0===D){D=new Array(m);for(var B=m-1,h=1;B>=0;--B)D[B]=h,h*=v[B]}if(void 0===z){z=0;for(B=0;B<m;++B)D[B]<0&&(z-=(v[B]-1)*D[B])}for(var A=function(S){if(e(S))return"buffer";if(N)switch(Object.prototype.toString.call(S)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(S)?"array":"generic"}(S),w=E[A];w.length<=m+1;)w.push(g(A,w.length-1));return(0,w[m+1])(S,v,D,z)}},13469:S=>{var v;self,v=()=>(()=>{"use strict";var S={d:(v,D)=>{for(var z in D)S.o(D,z)&&!S.o(v,z)&&Object.defineProperty(v,z,{enumerable:!0,get:D[z]})},o:(S,v)=>Object.prototype.hasOwnProperty.call(S,v)},v={};S.d(v,{default:()=>a});var D,z=function(S,v){var D=v.x-S.x,z=v.y-S.y;return Math.sqrt(D*D+z*z)},e=function(S){return S*(Math.PI/180)},N=new Map,m=function(S){N.has(S)&&clearTimeout(N.get(S)),N.set(S,setTimeout(S,100))},B=function(S,v,D){for(var z,e=v.split(/[ ,]+/g),N=0;N<e.length;N+=1)z=e[N],S.addEventListener?S.addEventListener(z,D,!1):S.attachEvent&&S.attachEvent(z,D)},g=function(S,v,D){for(var z,e=v.split(/[ ,]+/g),N=0;N<e.length;N+=1)z=e[N],S.removeEventListener?S.removeEventListener(z,D):S.detachEvent&&S.detachEvent(z,D)},E=function(S){return S.preventDefault(),S.type.match(/^touch/)?S.changedTouches:S},h=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},A=function(S,v){v.top||v.right||v.bottom||v.left?(S.style.top=v.top,S.style.right=v.right,S.style.bottom=v.bottom,S.style.left=v.left):(S.style.left=v.x+"px",S.style.top=v.y+"px")},w=function(S,v,D){var z=n(S);for(var e in z)if(z.hasOwnProperty(e))if("string"==typeof v)z[e]=v+" "+D;else{for(var N="",m=0,B=v.length;m<B;m+=1)N+=v[m]+" "+D+", ";z[e]=N.slice(0,-2)}return z},n=function(S){var v={};return v[S]="",["webkit","Moz","o"].forEach((function(D){v[D+S.charAt(0).toUpperCase()+S.slice(1)]=""})),v},R=function(S,v){for(var D in v)v.hasOwnProperty(D)&&(S[D]=v[D]);return S},O=function(S,v){if(S.length)for(var D=0,z=S.length;D<z;D+=1)v(S[D]);else v(S)},I="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,K=window.matchMedia("(any-hover: none)").matches,q=!!("ontouchstart"in window),u=!!window.PointerEvent,s=!!window.MSPointerEvent,r={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},d={start:"mousedown",move:"mousemove",end:"mouseup"},x={};function W(){}I&&!K?D=r:u?D={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?D={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:q?(D=r,x=d):D=d,W.prototype.on=function(S,v){var D,z=this,e=S.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var N=0;N<e.length;N+=1)D=e[N],z._handlers_[D]=z._handlers_[D]||[],z._handlers_[D].push(v);return z},W.prototype.off=function(S,v){var D=this;return D._handlers_=D._handlers_||{},void 0===S?D._handlers_={}:void 0===v?D._handlers_[S]=null:D._handlers_[S]&&D._handlers_[S].indexOf(v)>=0&&D._handlers_[S].splice(D._handlers_[S].indexOf(v),1),D},W.prototype.trigger=function(S,v){var D,z=this,e=S.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var N=0;N<e.length;N+=1)D=e[N],z._handlers_[D]&&z._handlers_[D].length&&z._handlers_[D].forEach((function(S){S.call(z,{type:D,target:z},v)}))},W.prototype.config=function(S){var v=this;v.options=v.defaults||{},S&&(v.options=function(S,v){var D={};for(var z in S)S.hasOwnProperty(z)&&v.hasOwnProperty(z)?D[z]=v[z]:S.hasOwnProperty(z)&&(D[z]=S[z]);return D}(v.options,S))},W.prototype.bindEvt=function(S,v){var z=this;return z._domHandlers_=z._domHandlers_||{},z._domHandlers_[v]=function(){"function"==typeof z["on"+v]?z["on"+v].apply(z,arguments):console.warn('[WARNING] : Missing "on'+v+'" handler.')},B(S,D[v],z._domHandlers_[v]),x[v]&&B(S,x[v],z._domHandlers_[v]),z},W.prototype.unbindEvt=function(S,v){var z=this;return z._domHandlers_=z._domHandlers_||{},g(S,D[v],z._domHandlers_[v]),x[v]&&g(S,x[v],z._domHandlers_[v]),delete z._domHandlers_[v],this};const p=W;function b(S,v){return this.identifier=v.identifier,this.position=v.position,this.frontPosition=v.frontPosition,this.collection=S,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(v),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=b.id,b.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}b.prototype=new p,b.constructor=b,b.id=0,b.prototype.buildEl=function(S){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},b.prototype.stylize=function(){if(this.options.dataOnly)return this;var S=this.options.fadeTime+"ms",v=function(){var S=n("borderRadius");for(var v in S)S.hasOwnProperty(v)&&(S[v]="50%");return S}(),D=w("transition","opacity",S),z={};return z.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},z.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},z.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},R(z.el,D),"circle"===this.options.shape&&R(z.back,v),R(z.front,v),this.applyStyles(z),this},b.prototype.applyStyles=function(S){for(var v in this.ui)if(this.ui.hasOwnProperty(v))for(var D in S[v])this.ui[v].style[D]=S[v][D];return this},b.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},b.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},b.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},b.prototype.show=function(S){var v=this;return v.options.dataOnly||(clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.addToDom(),v.restCallback(),setTimeout((function(){v.ui.el.style.opacity=1}),0),v.showTimeout=setTimeout((function(){v.trigger("shown",v.instance),"function"==typeof S&&S.call(this)}),v.options.fadeTime)),v},b.prototype.hide=function(S){var v=this;if(v.options.dataOnly)return v;if(v.ui.el.style.opacity=v.options.restOpacity,clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.removeTimeout=setTimeout((function(){var D="dynamic"===v.options.mode?"none":"block";v.ui.el.style.display=D,"function"==typeof S&&S.call(v),v.trigger("hidden",v.instance)}),v.options.fadeTime),v.options.restJoystick){var D=v.options.restJoystick,z={};z.x=!0===D||!1!==D.x?0:v.instance.frontPosition.x,z.y=!0===D||!1!==D.y?0:v.instance.frontPosition.y,v.setPosition(S,z)}return v},b.prototype.setPosition=function(S,v){var D=this;D.frontPosition={x:v.x,y:v.y};var z=D.options.fadeTime+"ms",e={};e.front=w("transition",["transform"],z);var N={front:{}};N.front={transform:"translate("+D.frontPosition.x+"px,"+D.frontPosition.y+"px)"},D.applyStyles(e),D.applyStyles(N),D.restTimeout=setTimeout((function(){"function"==typeof S&&S.call(D),D.restCallback()}),D.options.fadeTime)},b.prototype.restCallback=function(){var S=this,v={};v.front=w("transition","none",""),S.applyStyles(v),S.trigger("rested",S.instance)},b.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},b.prototype.computeDirection=function(S){var v,D,z,e=S.angle.radian,N=Math.PI/4,m=Math.PI/2;if(e>N&&e<3*N&&!S.lockX?v="up":e>-N&&e<=N&&!S.lockY?v="left":e>3*-N&&e<=-N&&!S.lockX?v="down":S.lockY||(v="right"),S.lockY||(D=e>-m&&e<m?"left":"right"),S.lockX||(z=e>0?"up":"down"),S.force>this.options.threshold){var B,g={};for(B in this.direction)this.direction.hasOwnProperty(B)&&(g[B]=this.direction[B]);var E={};for(B in this.direction={x:D,y:z,angle:v},S.direction=this.direction,g)g[B]===this.direction[B]&&(E[B]=!0);if(E.x&&E.y&&E.angle)return S;E.x&&E.y||this.trigger("plain",S),E.x||this.trigger("plain:"+D,S),E.y||this.trigger("plain:"+z,S),E.angle||this.trigger("dir dir:"+v,S)}else this.resetDirection();return S};const k=b;function Z(S,v){var D=this;D.nipples=[],D.idles=[],D.actives=[],D.ids=[],D.pressureIntervals={},D.manager=S,D.id=Z.id,Z.id+=1,D.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},D.config(v),"static"!==D.options.mode&&"semi"!==D.options.mode||(D.options.multitouch=!1),D.options.multitouch||(D.options.maxNumberOfNipples=1);var z=getComputedStyle(D.options.zone.parentElement);return z&&"flex"===z.display&&(D.parentIsFlex=!0),D.updateBox(),D.prepareNipples(),D.cw(),D.begin(),D.nipples}Z.prototype=new p,Z.constructor=Z,Z.id=0,Z.prototype.prepareNipples=function(){var S=this,v=S.nipples;v.on=S.on.bind(S),v.off=S.off.bind(S),v.options=S.options,v.destroy=S.destroy.bind(S),v.ids=S.ids,v.id=S.id,v.processOnMove=S.processOnMove.bind(S),v.processOnEnd=S.processOnEnd.bind(S),v.get=function(S){if(void 0===S)return v[0];for(var D=0,z=v.length;D<z;D+=1)if(v[D].identifier===S)return v[D];return!1}},Z.prototype.cw=function(){var S=this;S.bindEvt(S.options.zone,"start"),S.options.zone.style.touchAction="none",S.options.zone.style.msTouchAction="none"},Z.prototype.begin=function(){var S=this,v=S.options;if("static"===v.mode){var D=S.createNipple(v.position,S.manager.getIdentifier());D.add(),S.idles.push(D)}},Z.prototype.createNipple=function(S,v){var D=this,z=D.manager.scroll,e={},N=D.options,m=D.parentIsFlex?z.x:z.x+D.box.left,B=D.parentIsFlex?z.y:z.y+D.box.top;if(S.x&&S.y)e={x:S.x-m,y:S.y-B};else if(S.top||S.right||S.bottom||S.left){var g=document.createElement("DIV");g.style.display="hidden",g.style.top=S.top,g.style.right=S.right,g.style.bottom=S.bottom,g.style.left=S.left,g.style.position="absolute",N.zone.appendChild(g);var E=g.getBoundingClientRect();N.zone.removeChild(g),e=S,S={x:E.left+z.x,y:E.top+z.y}}var h=new k(D,{color:N.color,size:N.size,threshold:N.threshold,fadeTime:N.fadeTime,dataOnly:N.dataOnly,restJoystick:N.restJoystick,restOpacity:N.restOpacity,mode:N.mode,identifier:v,position:S,zone:N.zone,frontPosition:{x:0,y:0},shape:N.shape});return N.dataOnly||(A(h.ui.el,e),A(h.ui.front,h.frontPosition)),D.nipples.push(h),D.trigger("added "+h.identifier+":added",h),D.manager.trigger("added "+h.identifier+":added",h),D.bindNipple(h),h},Z.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},Z.prototype.bindNipple=function(S){var v,D=this,z=function(S,z){v=S.type+" "+z.id+":"+S.type,D.trigger(v,z)};S.on("destroyed",D.onDestroyed.bind(D)),S.on("shown hidden rested dir plain",z),S.on("dir:up dir:right dir:down dir:left",z),S.on("plain:up plain:right plain:down plain:left",z)},Z.prototype.pressureFn=function(S,v,D){var z=this,e=0;clearInterval(z.pressureIntervals[D]),z.pressureIntervals[D]=setInterval(function(){var D=S.force||S.pressure||S.webkitForce||0;D!==e&&(v.trigger("pressure",D),z.trigger("pressure "+v.identifier+":pressure",D),e=D)}.bind(z),100)},Z.prototype.onstart=function(S){var v=this,D=v.options,z=S;return S=E(S),v.updateBox(),O(S,(function(e){v.actives.length<D.maxNumberOfNipples?v.processOnStart(e):z.type.match(/^touch/)&&(Object.keys(v.manager.ids).forEach((function(D){if(Object.values(z.touches).findIndex((function(S){return S.identifier===D}))<0){var e=[S[0]];e.identifier=D,v.processOnEnd(e)}})),v.actives.length<D.maxNumberOfNipples&&v.processOnStart(e))})),v.manager.bindDocument(),!1},Z.prototype.processOnStart=function(S){var v,D=this,e=D.options,N=D.manager.getIdentifier(S),m=S.force||S.pressure||S.webkitForce||0,B={x:S.pageX,y:S.pageY},g=D.getOrCreate(N,B);g.identifier!==N&&D.manager.removeIdentifier(g.identifier),g.identifier=N;var E=function(v){v.trigger("start",v),D.trigger("start "+v.id+":start",v),v.show(),m>0&&D.pressureFn(S,v,v.identifier),D.processOnMove(S)};if((v=D.idles.indexOf(g))>=0&&D.idles.splice(v,1),D.actives.push(g),D.ids.push(g.identifier),"semi"!==e.mode)E(g);else{if(!(z(B,g.position)<=e.catchDistance))return g.destroy(),void D.processOnStart(S);E(g)}return g},Z.prototype.getOrCreate=function(S,v){var D,z=this,e=z.options;return/(semi|static)/.test(e.mode)?(D=z.idles[0])?(z.idles.splice(0,1),D):"semi"===e.mode?z.createNipple(v,S):(console.warn("Coudln't find the needed nipple."),!1):D=z.createNipple(v,S)},Z.prototype.processOnMove=function(S){var v=this,D=v.options,N=v.manager.getIdentifier(S),m=v.nipples.get(N),B=v.manager.scroll;if(function(S){return isNaN(S.buttons)?0!==S.pressure:0!==S.buttons}(S)){if(!m)return console.error("Found zombie joystick with ID "+N),void v.manager.removeIdentifier(N);if(D.dynamicPage){var g=m.el.getBoundingClientRect();m.position={x:B.x+g.left,y:B.y+g.top}}m.identifier=N;var E=m.options.size/2,h={x:S.pageX,y:S.pageY};D.lockX&&(h.y=m.position.y),D.lockY&&(h.x=m.position.x);var A,w,n,R,O,I,K,q,u,s,r=z(h,m.position),d=(A=h,n=(w=m.position).x-A.x,R=w.y-A.y,function(S){return S*(180/Math.PI)}(Math.atan2(R,n))),x=e(d),W=r/E,p={distance:r,position:h};if("circle"===m.options.shape?(O=Math.min(r,E),K=m.position,q=O,s={x:0,y:0},u=e(u=d),s.x=K.x-q*Math.cos(u),s.y=K.y-q*Math.sin(u),I=s):(I=function(S,v,D){return{x:Math.min(Math.max(S.x,v.x-D),v.x+D),y:Math.min(Math.max(S.y,v.y-D),v.y+D)}}(h,m.position,E),O=z(I,m.position)),D.follow){if(r>E){var b=h.x-I.x,k=h.y-I.y;m.position.x+=b,m.position.y+=k,m.el.style.top=m.position.y-(v.box.top+B.y)+"px",m.el.style.left=m.position.x-(v.box.left+B.x)+"px",r=z(h,m.position)}}else h=I,r=O;var Z=h.x-m.position.x,i=h.y-m.position.y;m.frontPosition={x:Z,y:i},D.dataOnly||(m.ui.front.style.transform="translate("+Z+"px,"+i+"px)");var t={identifier:m.identifier,position:h,force:W,pressure:S.force||S.pressure||S.webkitForce||0,distance:r,angle:{radian:x,degree:d},vector:{x:Z/E,y:-i/E},raw:p,instance:m,lockX:D.lockX,lockY:D.lockY};(t=m.computeDirection(t)).angle={radian:e(180-d),degree:180-d},m.trigger("move",t),v.trigger("move "+m.id+":move",t)}else this.processOnEnd(S)},Z.prototype.processOnEnd=function(S){var v=this,D=v.options,z=v.manager.getIdentifier(S),e=v.nipples.get(z),N=v.manager.removeIdentifier(e.identifier);e&&(D.dataOnly||e.hide((function(){"dynamic"===D.mode&&(e.trigger("removed",e),v.trigger("removed "+e.id+":removed",e),v.manager.trigger("removed "+e.id+":removed",e),e.destroy())})),clearInterval(v.pressureIntervals[e.identifier]),e.resetDirection(),e.trigger("end",e),v.trigger("end "+e.id+":end",e),v.ids.indexOf(e.identifier)>=0&&v.ids.splice(v.ids.indexOf(e.identifier),1),v.actives.indexOf(e)>=0&&v.actives.splice(v.actives.indexOf(e),1),/(semi|static)/.test(D.mode)?v.idles.push(e):v.nipples.indexOf(e)>=0&&v.nipples.splice(v.nipples.indexOf(e),1),v.manager.unbindDocument(),/(semi|static)/.test(D.mode)&&(v.manager.ids[N.id]=N.identifier))},Z.prototype.onDestroyed=function(S,v){var D=this;D.nipples.indexOf(v)>=0&&D.nipples.splice(D.nipples.indexOf(v),1),D.actives.indexOf(v)>=0&&D.actives.splice(D.actives.indexOf(v),1),D.idles.indexOf(v)>=0&&D.idles.splice(D.idles.indexOf(v),1),D.ids.indexOf(v.identifier)>=0&&D.ids.splice(D.ids.indexOf(v.identifier),1),D.manager.removeIdentifier(v.identifier),D.manager.unbindDocument()},Z.prototype.destroy=function(){var S=this;for(var v in S.unbindEvt(S.options.zone,"start"),S.nipples.forEach((function(S){S.destroy()})),S.pressureIntervals)S.pressureIntervals.hasOwnProperty(v)&&clearInterval(S.pressureIntervals[v]);S.trigger("destroyed",S.nipples),S.manager.unbindDocument(),S.off()};const i=Z;function t(S){var v=this;v.ids={},v.index=0,v.collections=[],v.scroll=h(),v.config(S),v.prepareCollections();var D=function(){var S;v.collections.forEach((function(D){D.forEach((function(D){S=D.el.getBoundingClientRect(),D.position={x:v.scroll.x+S.left,y:v.scroll.y+S.top}}))}))};B(window,"resize",(function(){m(D)}));var z=function(){v.scroll=h()};return B(window,"scroll",(function(){m(z)})),v.collections}t.prototype=new p,t.constructor=t,t.prototype.prepareCollections=function(){var S=this;S.collections.create=S.create.bind(S),S.collections.on=S.on.bind(S),S.collections.off=S.off.bind(S),S.collections.destroy=S.destroy.bind(S),S.collections.get=function(v){var D;return S.collections.every((function(S){return!(D=S.get(v))})),D}},t.prototype.create=function(S){return this.createCollection(S)},t.prototype.createCollection=function(S){var v=this,D=new i(v,S);return v.bindCollection(D),v.collections.push(D),D},t.prototype.bindCollection=function(S){var v,D=this,z=function(S,z){v=S.type+" "+z.id+":"+S.type,D.trigger(v,z)};S.on("destroyed",D.onDestroyed.bind(D)),S.on("shown hidden rested dir plain",z),S.on("dir:up dir:right dir:down dir:left",z),S.on("plain:up plain:right plain:down plain:left",z)},t.prototype.bindDocument=function(){var S=this;S.binded||(S.bindEvt(document,"move").bindEvt(document,"end"),S.binded=!0)},t.prototype.unbindDocument=function(S){var v=this;Object.keys(v.ids).length&&!0!==S||(v.unbindEvt(document,"move").unbindEvt(document,"end"),v.binded=!1)},t.prototype.getIdentifier=function(S){var v;return S?void 0===(v=void 0===S.identifier?S.pointerId:S.identifier)&&(v=this.latest||0):v=this.index,void 0===this.ids[v]&&(this.ids[v]=this.index,this.index+=1),this.latest=v,this.ids[v]},t.prototype.removeIdentifier=function(S){var v={};for(var D in this.ids)if(this.ids[D]===S){v.id=D,v.identifier=this.ids[D],delete this.ids[D];break}return v},t.prototype.onmove=function(S){return this.onAny("move",S),!1},t.prototype.onend=function(S){return this.onAny("end",S),!1},t.prototype.oncancel=function(S){return this.onAny("end",S),!1},t.prototype.onAny=function(S,v){var D,z=this,e="processOn"+S.charAt(0).toUpperCase()+S.slice(1);v=E(v);var N=function(S,v,D){D.ids.indexOf(v)>=0&&(D[e](S),S._found_=!0)};return O(v,(function(S){D=z.getIdentifier(S),O(z.collections,N.bind(null,S,D)),S._found_||z.removeIdentifier(D)})),!1},t.prototype.destroy=function(){var S=this;S.unbindDocument(!0),S.ids={},S.index=0,S.collections.forEach((function(S){S.destroy()})),S.off()},t.prototype.onDestroyed=function(S,v){var D=this;if(D.collections.indexOf(v)<0)return!1;D.collections.splice(D.collections.indexOf(v),1)};var X=new t;const a={create:function(S){return X.create(S)},factory:X};return v.default})(),S.exports=v()},12520:(S,v,D)=>{"use strict";const{Deflate:z,deflate:e,deflateRaw:N,gzip:m}=D(12522),{Inflate:B,inflate:g,inflateRaw:E,ungzip:h}=D(12584),A=D(12557);S.exports.Deflate=z,S.exports.deflate=e,S.exports.deflateRaw=N,S.exports.gzip=m,S.exports.Inflate=B,S.exports.inflate=g,S.exports.inflateRaw=E,S.exports.ungzip=h,S.exports.constants=A},12522:(S,v,D)=>{"use strict";const z=D(12525),e=D(12564),N=D(12573),m=D(12552),B=D(12582),g=Object.prototype.toString,{Z_NO_FLUSH:E,Z_SYNC_FLUSH:h,Z_FULL_FLUSH:A,Z_FINISH:w,Z_OK:n,Z_STREAM_END:R,Z_DEFAULT_COMPRESSION:O,Z_DEFAULT_STRATEGY:I,Z_DEFLATED:K}=D(12557);function q(S){this.options=e.assign({level:O,method:K,HS:16384,windowBits:15,memLevel:8,strategy:I},S||{});let v=this.options;v.raw&&v.windowBits>0?v.windowBits=-v.windowBits:v.gzip&&v.windowBits>0&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.Ev="",this.ended=!1,this.chunks=[],this.strm=new B,this.strm.avail_out=0;let D=z.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(D!==n)throw new Error(m[D]);if(v.header&&z.deflateSetHeader(this.strm,v.header),v.dictionary){let S;if(S="string"===typeof v.dictionary?N.string2buf(v.dictionary):"[object ArrayBuffer]"===g.call(v.dictionary)?new Uint8Array(v.dictionary):v.dictionary,D=z.deflateSetDictionary(this.strm,S),D!==n)throw new Error(m[D]);this._dict_set=!0}}function u(S,v){const D=new q(v);if(D.push(S,!0),D.err)throw D.Ev||m[D.err];return D.result}q.prototype.push=function(S,v){const D=this.strm,e=this.options.HS;let m,B;if(this.ended)return!1;for(B=v===~~v?v:!0===v?w:E,"string"===typeof S?D.input=N.string2buf(S):"[object ArrayBuffer]"===g.call(S)?D.input=new Uint8Array(S):D.input=S,D.next_in=0,D.avail_in=D.input.length;;)if(0===D.avail_out&&(D.output=new Uint8Array(e),D.next_out=0,D.avail_out=e),(B===h||B===A)&&D.avail_out<=6)this.onData(D.output.subarray(0,D.next_out)),D.avail_out=0;else{if(m=z.deflate(D,B),m===R)return D.next_out>0&&this.onData(D.output.subarray(0,D.next_out)),m=z.deflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===n;if(0!==D.avail_out){if(B>0&&D.next_out>0)this.onData(D.output.subarray(0,D.next_out)),D.avail_out=0;else if(0===D.avail_in)break}else this.onData(D.output)}return!0},q.prototype.onData=function(S){this.chunks.push(S)},q.prototype.onEnd=function(S){S===n&&(this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=S,this.Ev=this.strm.Ev},S.exports.Deflate=q,S.exports.deflate=u,S.exports.deflateRaw=function(S,v){return(v=v||{}).raw=!0,u(S,v)},S.exports.gzip=function(S,v){return(v=v||{}).gzip=!0,u(S,v)},S.exports.constants=D(12557)},12584:(S,v,D)=>{"use strict";const z=D(12587),e=D(12564),N=D(12573),m=D(12552),B=D(12582),g=D(12601),E=Object.prototype.toString,{Z_NO_FLUSH:h,Z_FINISH:A,Z_OK:w,Z_STREAM_END:n,Z_NEED_DICT:R,Z_STREAM_ERROR:O,Z_DATA_ERROR:I,Z_MEM_ERROR:K}=D(12557);function q(S){this.options=e.assign({HS:65536,windowBits:15,to:""},S||{});const v=this.options;v.raw&&v.windowBits>=0&&v.windowBits<16&&(v.windowBits=-v.windowBits,0===v.windowBits&&(v.windowBits=-15)),!(v.windowBits>=0&&v.windowBits<16)||S&&S.windowBits||(v.windowBits+=32),v.windowBits>15&&v.windowBits<48&&0===(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.Ev="",this.ended=!1,this.chunks=[],this.strm=new B,this.strm.avail_out=0;let D=z.inflateInit2(this.strm,v.windowBits);if(D!==w)throw new Error(m[D]);if(this.header=new g,z.inflateGetHeader(this.strm,this.header),v.dictionary&&("string"===typeof v.dictionary?v.dictionary=N.string2buf(v.dictionary):"[object ArrayBuffer]"===E.call(v.dictionary)&&(v.dictionary=new Uint8Array(v.dictionary)),v.raw&&(D=z.inflateSetDictionary(this.strm,v.dictionary),D!==w)))throw new Error(m[D])}function u(S,v){const D=new q(v);if(D.push(S),D.err)throw D.Ev||m[D.err];return D.result}q.prototype.push=function(S,v){const D=this.strm,e=this.options.HS,m=this.options.dictionary;let B,g,q;if(this.ended)return!1;for(g=v===~~v?v:!0===v?A:h,"[object ArrayBuffer]"===E.call(S)?D.input=new Uint8Array(S):D.input=S,D.next_in=0,D.avail_in=D.input.length;;){for(0===D.avail_out&&(D.output=new Uint8Array(e),D.next_out=0,D.avail_out=e),B=z.inflate(D,g),B===R&&m&&(B=z.inflateSetDictionary(D,m),B===w?B=z.inflate(D,g):B===I&&(B=R));D.avail_in>0&&B===n&&D.state.wrap>0&&0!==S[D.next_in];)z.inflateReset(D),B=z.inflate(D,g);switch(B){case O:case I:case R:case K:return this.onEnd(B),this.ended=!0,!1}if(q=D.avail_out,D.next_out&&(0===D.avail_out||B===n))if("string"===this.options.to){let S=N.utf8border(D.output,D.next_out),v=D.next_out-S,z=N.buf2string(D.output,S);D.next_out=v,D.avail_out=e-v,v&&D.output.set(D.output.subarray(S,S+v),0),this.onData(z)}else this.onData(D.output.length===D.next_out?D.output:D.output.subarray(0,D.next_out));if(B!==w||0!==q){if(B===n)return B=z.inflateEnd(this.strm),this.onEnd(B),this.ended=!0,!0;if(0===D.avail_in)break}}return!0},q.prototype.onData=function(S){this.chunks.push(S)},q.prototype.onEnd=function(S){S===w&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=S,this.Ev=this.strm.Ev},S.exports.Inflate=q,S.exports.inflate=u,S.exports.inflateRaw=function(S,v){return(v=v||{}).raw=!0,u(S,v)},S.exports.ungzip=u,S.exports.constants=D(12557)},12564:S=>{"use strict";const v=(S,v)=>Object.prototype.hasOwnProperty.call(S,v);S.exports.assign=function(S){const D=Array.prototype.slice.call(arguments,1);for(;D.length;){const z=D.shift();if(z){if("object"!==typeof z)throw new TypeError(z+"must be non-object");for(const D in z)v(z,D)&&(S[D]=z[D])}}return S},S.exports.flattenChunks=S=>{let v=0;for(let z=0,e=S.length;z<e;z++)v+=S[z].length;const D=new Uint8Array(v);for(let z=0,e=0,N=S.length;z<N;z++){let v=S[z];D.set(v,e),e+=v.length}return D}},12573:S=>{"use strict";let v=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(z){v=!1}const D=new Uint8Array(256);for(let e=0;e<256;e++)D[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;D[254]=D[254]=1,S.exports.string2buf=S=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(S);let v,D,z,e,N,m=S.length,B=0;for(e=0;e<m;e++)D=S.charCodeAt(e),55296===(64512&D)&&e+1<m&&(z=S.charCodeAt(e+1),56320===(64512&z)&&(D=65536+(D-55296<<10)+(z-56320),e++)),B+=D<128?1:D<2048?2:D<65536?3:4;for(v=new Uint8Array(B),N=0,e=0;N<B;e++)D=S.charCodeAt(e),55296===(64512&D)&&e+1<m&&(z=S.charCodeAt(e+1),56320===(64512&z)&&(D=65536+(D-55296<<10)+(z-56320),e++)),D<128?v[N++]=D:D<2048?(v[N++]=192|D>>>6,v[N++]=128|63&D):D<65536?(v[N++]=224|D>>>12,v[N++]=128|D>>>6&63,v[N++]=128|63&D):(v[N++]=240|D>>>18,v[N++]=128|D>>>12&63,v[N++]=128|D>>>6&63,v[N++]=128|63&D);return v};S.exports.buf2string=(S,z)=>{const e=z||S.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(S.subarray(0,z));let N,m;const B=new Array(2*e);for(m=0,N=0;N<e;){let v=S[N++];if(v<128){B[m++]=v;continue}let z=D[v];if(z>4)B[m++]=65533,N+=z-1;else{for(v&=2===z?31:3===z?15:7;z>1&&N<e;)v=v<<6|63&S[N++],z--;z>1?B[m++]=65533:v<65536?B[m++]=v:(v-=65536,B[m++]=55296|v>>10&1023,B[m++]=56320|1023&v)}}return((S,D)=>{if(D<65534&&S.subarray&&v)return String.fromCharCode.apply(null,S.length===D?S:S.subarray(0,D));let z="";for(let v=0;v<D;v++)z+=String.fromCharCode(S[v]);return z})(B,m)},S.exports.utf8border=(S,v)=>{(v=v||S.length)>S.length&&(v=S.length);let z=v-1;for(;z>=0&&128===(192&S[z]);)z--;return z<0||0===z?v:z+D[S[z]]>v?z:v}},12539:S=>{"use strict";S.exports=(S,v,D,z)=>{let e=65535&S,N=S>>>16&65535,m=0;for(;0!==D;){m=D>2e3?2e3:D,D-=m;do{e=e+v[z++]|0,N=N+e|0}while(--m);e%=65521,N%=65521}return e|N<<16}},12557:S=>{"use strict";S.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12543:S=>{"use strict";const v=new Uint32Array((()=>{let S,v=[];for(var D=0;D<256;D++){S=D;for(var z=0;z<8;z++)S=1&S?3988292384^S>>>1:S>>>1;v[D]=S}return v})());S.exports=(S,D,z,e)=>{const N=v,m=e+z;S^=-1;for(let v=e;v<m;v++)S=S>>>8^N[255&(S^D[v])];return~S}},12525:(S,v,D)=>{"use strict";const{_tr_init:z,_tr_stored_block:e,_tr_flush_block:N,_tr_tally:m,_tr_align:B}=D(12531),g=D(12539),E=D(12543),h=D(12552),{Z_NO_FLUSH:A,Z_PARTIAL_FLUSH:w,Z_FULL_FLUSH:n,Z_FINISH:R,Z_BLOCK:O,Z_OK:I,Z_STREAM_END:K,Z_STREAM_ERROR:q,Z_DATA_ERROR:u,Z_BUF_ERROR:s,Z_DEFAULT_COMPRESSION:r,Z_FILTERED:d,Z_HUFFMAN_ONLY:x,Z_RLE:W,Z_FIXED:p,Z_DEFAULT_STRATEGY:b,Z_UNKNOWN:k,Z_DEFLATED:Z}=D(12557),i=258,t=262,X=103,a=113,o=666,M=(S,v)=>(S.Ev=h[v],v),c=S=>(S<<1)-(S>4?9:0),J=S=>{let v=S.length;for(;--v>=0;)S[v]=0};let H=(S,v,D)=>(v<<S.hash_shift^D)&S.hash_mask;const T=S=>{const v=S.state;let D=v.pending;D>S.avail_out&&(D=S.avail_out),0!==D&&(S.output.set(v.pending_buf.subarray(v.pending_out,v.pending_out+D),S.next_out),S.next_out+=D,v.pending_out+=D,S.total_out+=D,S.avail_out-=D,v.pending-=D,0===v.pending&&(v.pending_out=0))},G=(S,v)=>{N(S,S.block_start>=0?S.block_start:-1,S.strstart-S.block_start,v),S.block_start=S.strstart,T(S.strm)},Y=(S,v)=>{S.pending_buf[S.pending++]=v},j=(S,v)=>{S.pending_buf[S.pending++]=v>>>8&255,S.pending_buf[S.pending++]=255&v},V=(S,v,D,z)=>{let e=S.avail_in;return e>z&&(e=z),0===e?0:(S.avail_in-=e,v.set(S.input.subarray(S.next_in,S.next_in+e),D),1===S.state.wrap?S.adler=g(S.adler,v,e,D):2===S.state.wrap&&(S.adler=E(S.adler,v,e,D)),S.next_in+=e,S.total_in+=e,e)},U=(S,v)=>{let D,z,e=S.max_chain_length,N=S.strstart,m=S.prev_length,B=S.nice_match;const g=S.strstart>S.w_size-t?S.strstart-(S.w_size-t):0,E=S.window,h=S.w_mask,A=S.prev,w=S.strstart+i;let n=E[N+m-1],R=E[N+m];S.prev_length>=S.good_match&&(e>>=2),B>S.lookahead&&(B=S.lookahead);do{if(D=v,E[D+m]===R&&E[D+m-1]===n&&E[D]===E[N]&&E[++D]===E[N+1]){N+=2,D++;do{}while(E[++N]===E[++D]&&E[++N]===E[++D]&&E[++N]===E[++D]&&E[++N]===E[++D]&&E[++N]===E[++D]&&E[++N]===E[++D]&&E[++N]===E[++D]&&E[++N]===E[++D]&&N<w);if(z=i-(w-N),N=w-i,z>m){if(S.match_start=v,m=z,z>=B)break;n=E[N+m-1],R=E[N+m]}}}while((v=A[v&h])>g&&0!==--e);return m<=S.lookahead?m:S.lookahead},y=S=>{const v=S.w_size;let D,z,e,N,m;do{if(N=S.window_size-S.lookahead-S.strstart,S.strstart>=v+(v-t)){S.window.set(S.window.subarray(v,v+v),0),S.match_start-=v,S.strstart-=v,S.block_start-=v,z=S.hash_size,D=z;do{e=S.head[--D],S.head[D]=e>=v?e-v:0}while(--z);z=v,D=z;do{e=S.prev[--D],S.prev[D]=e>=v?e-v:0}while(--z);N+=v}if(0===S.strm.avail_in)break;if(z=V(S.strm,S.window,S.strstart+S.lookahead,N),S.lookahead+=z,S.lookahead+S.insert>=3)for(m=S.strstart-S.insert,S.ins_h=S.window[m],S.ins_h=H(S,S.ins_h,S.window[m+1]);S.insert&&(S.ins_h=H(S,S.ins_h,S.window[m+3-1]),S.prev[m&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=m,m++,S.insert--,!(S.lookahead+S.insert<3)););}while(S.lookahead<t&&0!==S.strm.avail_in)},f=(S,v)=>{let D,z;for(;;){if(S.lookahead<t){if(y(S),S.lookahead<t&&v===A)return 1;if(0===S.lookahead)break}if(D=0,S.lookahead>=3&&(S.ins_h=H(S,S.ins_h,S.window[S.strstart+3-1]),D=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),0!==D&&S.strstart-D<=S.w_size-t&&(S.match_length=U(S,D)),S.match_length>=3)if(z=m(S,S.strstart-S.match_start,S.match_length-3),S.lookahead-=S.match_length,S.match_length<=S.max_lazy_match&&S.lookahead>=3){S.match_length--;do{S.strstart++,S.ins_h=H(S,S.ins_h,S.window[S.strstart+3-1]),D=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart}while(0!==--S.match_length);S.strstart++}else S.strstart+=S.match_length,S.match_length=0,S.ins_h=S.window[S.strstart],S.ins_h=H(S,S.ins_h,S.window[S.strstart+1]);else z=m(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++;if(z&&(G(S,!1),0===S.strm.avail_out))return 1}return S.insert=S.strstart<2?S.strstart:2,v===R?(G(S,!0),0===S.strm.avail_out?3:4):S.last_lit&&(G(S,!1),0===S.strm.avail_out)?1:2},C=(S,v)=>{let D,z,e;for(;;){if(S.lookahead<t){if(y(S),S.lookahead<t&&v===A)return 1;if(0===S.lookahead)break}if(D=0,S.lookahead>=3&&(S.ins_h=H(S,S.ins_h,S.window[S.strstart+3-1]),D=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),S.prev_length=S.match_length,S.prev_match=S.match_start,S.match_length=2,0!==D&&S.prev_length<S.max_lazy_match&&S.strstart-D<=S.w_size-t&&(S.match_length=U(S,D),S.match_length<=5&&(S.strategy===d||3===S.match_length&&S.strstart-S.match_start>4096)&&(S.match_length=2)),S.prev_length>=3&&S.match_length<=S.prev_length){e=S.strstart+S.lookahead-3,z=m(S,S.strstart-1-S.prev_match,S.prev_length-3),S.lookahead-=S.prev_length-1,S.prev_length-=2;do{++S.strstart<=e&&(S.ins_h=H(S,S.ins_h,S.window[S.strstart+3-1]),D=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart)}while(0!==--S.prev_length);if(S.match_available=0,S.match_length=2,S.strstart++,z&&(G(S,!1),0===S.strm.avail_out))return 1}else if(S.match_available){if(z=m(S,0,S.window[S.strstart-1]),z&&G(S,!1),S.strstart++,S.lookahead--,0===S.strm.avail_out)return 1}else S.match_available=1,S.strstart++,S.lookahead--}return S.match_available&&(z=m(S,0,S.window[S.strstart-1]),S.match_available=0),S.insert=S.strstart<2?S.strstart:2,v===R?(G(S,!0),0===S.strm.avail_out?3:4):S.last_lit&&(G(S,!1),0===S.strm.avail_out)?1:2};function F(S,v,D,z,e){this.good_length=S,this.max_lazy=v,this.nice_length=D,this.max_chain=z,this.func=e}const l=[new F(0,0,0,0,((S,v)=>{let D=65535;for(D>S.pending_buf_size-5&&(D=S.pending_buf_size-5);;){if(S.lookahead<=1){if(y(S),0===S.lookahead&&v===A)return 1;if(0===S.lookahead)break}S.strstart+=S.lookahead,S.lookahead=0;const z=S.block_start+D;if((0===S.strstart||S.strstart>=z)&&(S.lookahead=S.strstart-z,S.strstart=z,G(S,!1),0===S.strm.avail_out))return 1;if(S.strstart-S.block_start>=S.w_size-t&&(G(S,!1),0===S.strm.avail_out))return 1}return S.insert=0,v===R?(G(S,!0),0===S.strm.avail_out?3:4):(S.strstart>S.block_start&&(G(S,!1),S.strm.avail_out),1)})),new F(4,4,8,4,f),new F(4,5,16,8,f),new F(4,6,32,32,f),new F(4,4,16,16,C),new F(8,16,32,32,C),new F(8,16,128,128,C),new F(8,32,128,256,C),new F(32,128,258,1024,C),new F(32,258,258,4096,C)];function P(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Q=S=>{if(!S||!S.state)return M(S,q);S.total_in=S.total_out=0,S.data_type=k;const v=S.state;return v.pending=0,v.pending_out=0,v.wrap<0&&(v.wrap=-v.wrap),v.status=v.wrap?42:a,S.adler=2===v.wrap?0:1,v.last_flush=A,z(v),I},L=S=>{const v=Q(S);var D;return v===I&&((D=S.state).window_size=2*D.w_size,J(D.head),D.max_lazy_match=l[D.level].max_lazy,D.good_match=l[D.level].good_length,D.nice_match=l[D.level].nice_length,D.max_chain_length=l[D.level].max_chain,D.strstart=0,D.block_start=0,D.lookahead=0,D.insert=0,D.match_length=D.prev_length=2,D.match_available=0,D.ins_h=0),v},SS=(S,v,D,z,e,N)=>{if(!S)return q;let m=1;if(v===r&&(v=6),z<0?(m=0,z=-z):z>15&&(m=2,z-=16),e<1||e>9||D!==Z||z<8||z>15||v<0||v>9||N<0||N>p)return M(S,q);8===z&&(z=9);const B=new P;return S.state=B,B.strm=S,B.wrap=m,B.gzhead=null,B.w_bits=z,B.w_size=1<<B.w_bits,B.w_mask=B.w_size-1,B.hash_bits=e+7,B.hash_size=1<<B.hash_bits,B.hash_mask=B.hash_size-1,B.hash_shift=~~((B.hash_bits+3-1)/3),B.window=new Uint8Array(2*B.w_size),B.head=new Uint16Array(B.hash_size),B.prev=new Uint16Array(B.w_size),B.lit_bufsize=1<<e+6,B.pending_buf_size=4*B.lit_bufsize,B.pending_buf=new Uint8Array(B.pending_buf_size),B.d_buf=1*B.lit_bufsize,B.l_buf=3*B.lit_bufsize,B.level=v,B.strategy=N,B.method=D,L(S)};S.exports.deflateInit=(S,v)=>SS(S,v,Z,15,8,b),S.exports.deflateInit2=SS,S.exports.deflateReset=L,S.exports.deflateResetKeep=Q,S.exports.deflateSetHeader=(S,v)=>S&&S.state?2!==S.state.wrap?q:(S.state.gzhead=v,I):q,S.exports.deflate=(S,v)=>{let D,z;if(!S||!S.state||v>O||v<0)return S?M(S,q):q;const N=S.state;if(!S.output||!S.input&&0!==S.avail_in||N.status===o&&v!==R)return M(S,0===S.avail_out?s:q);N.strm=S;const g=N.last_flush;if(N.last_flush=v,42===N.status)if(2===N.wrap)S.adler=0,Y(N,31),Y(N,139),Y(N,8),N.gzhead?(Y(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),Y(N,255&N.gzhead.time),Y(N,N.gzhead.time>>8&255),Y(N,N.gzhead.time>>16&255),Y(N,N.gzhead.time>>24&255),Y(N,9===N.level?2:N.strategy>=x||N.level<2?4:0),Y(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(Y(N,255&N.gzhead.extra.length),Y(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(S.adler=E(S.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(Y(N,0),Y(N,0),Y(N,0),Y(N,0),Y(N,0),Y(N,9===N.level?2:N.strategy>=x||N.level<2?4:0),Y(N,3),N.status=a);else{let v=Z+(N.w_bits-8<<4)<<8,D=-1;D=N.strategy>=x||N.level<2?0:N.level<6?1:6===N.level?2:3,v|=D<<6,0!==N.strstart&&(v|=32),v+=31-v%31,N.status=a,j(N,v),0!==N.strstart&&(j(N,S.adler>>>16),j(N,65535&S.adler)),S.adler=1}if(69===N.status)if(N.gzhead.extra){for(D=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>D&&(S.adler=E(S.adler,N.pending_buf,N.pending-D,D)),T(S),D=N.pending,N.pending!==N.pending_buf_size));)Y(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>D&&(S.adler=E(S.adler,N.pending_buf,N.pending-D,D)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(73===N.status)if(N.gzhead.name){D=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>D&&(S.adler=E(S.adler,N.pending_buf,N.pending-D,D)),T(S),D=N.pending,N.pending===N.pending_buf_size)){z=1;break}z=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,Y(N,z)}while(0!==z);N.gzhead.hcrc&&N.pending>D&&(S.adler=E(S.adler,N.pending_buf,N.pending-D,D)),0===z&&(N.gzindex=0,N.status=91)}else N.status=91;if(91===N.status)if(N.gzhead.comment){D=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>D&&(S.adler=E(S.adler,N.pending_buf,N.pending-D,D)),T(S),D=N.pending,N.pending===N.pending_buf_size)){z=1;break}z=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,Y(N,z)}while(0!==z);N.gzhead.hcrc&&N.pending>D&&(S.adler=E(S.adler,N.pending_buf,N.pending-D,D)),0===z&&(N.status=X)}else N.status=X;if(N.status===X&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&T(S),N.pending+2<=N.pending_buf_size&&(Y(N,255&S.adler),Y(N,S.adler>>8&255),S.adler=0,N.status=a)):N.status=a),0!==N.pending){if(T(S),0===S.avail_out)return N.last_flush=-1,I}else if(0===S.avail_in&&c(v)<=c(g)&&v!==R)return M(S,s);if(N.status===o&&0!==S.avail_in)return M(S,s);if(0!==S.avail_in||0!==N.lookahead||v!==A&&N.status!==o){let D=N.strategy===x?((S,v)=>{let D;for(;;){if(0===S.lookahead&&(y(S),0===S.lookahead)){if(v===A)return 1;break}if(S.match_length=0,D=m(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++,D&&(G(S,!1),0===S.strm.avail_out))return 1}return S.insert=0,v===R?(G(S,!0),0===S.strm.avail_out?3:4):S.last_lit&&(G(S,!1),0===S.strm.avail_out)?1:2})(N,v):N.strategy===W?((S,v)=>{let D,z,e,N;const B=S.window;for(;;){if(S.lookahead<=i){if(y(S),S.lookahead<=i&&v===A)return 1;if(0===S.lookahead)break}if(S.match_length=0,S.lookahead>=3&&S.strstart>0&&(e=S.strstart-1,z=B[e],z===B[++e]&&z===B[++e]&&z===B[++e])){N=S.strstart+i;do{}while(z===B[++e]&&z===B[++e]&&z===B[++e]&&z===B[++e]&&z===B[++e]&&z===B[++e]&&z===B[++e]&&z===B[++e]&&e<N);S.match_length=i-(N-e),S.match_length>S.lookahead&&(S.match_length=S.lookahead)}if(S.match_length>=3?(D=m(S,1,S.match_length-3),S.lookahead-=S.match_length,S.strstart+=S.match_length,S.match_length=0):(D=m(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++),D&&(G(S,!1),0===S.strm.avail_out))return 1}return S.insert=0,v===R?(G(S,!0),0===S.strm.avail_out?3:4):S.last_lit&&(G(S,!1),0===S.strm.avail_out)?1:2})(N,v):l[N.level].func(N,v);if(3!==D&&4!==D||(N.status=o),1===D||3===D)return 0===S.avail_out&&(N.last_flush=-1),I;if(2===D&&(v===w?B(N):v!==O&&(e(N,0,0,!1),v===n&&(J(N.head),0===N.lookahead&&(N.strstart=0,N.block_start=0,N.insert=0))),T(S),0===S.avail_out))return N.last_flush=-1,I}return v!==R?I:N.wrap<=0?K:(2===N.wrap?(Y(N,255&S.adler),Y(N,S.adler>>8&255),Y(N,S.adler>>16&255),Y(N,S.adler>>24&255),Y(N,255&S.total_in),Y(N,S.total_in>>8&255),Y(N,S.total_in>>16&255),Y(N,S.total_in>>24&255)):(j(N,S.adler>>>16),j(N,65535&S.adler)),T(S),N.wrap>0&&(N.wrap=-N.wrap),0!==N.pending?I:K)},S.exports.deflateEnd=S=>{if(!S||!S.state)return q;const v=S.state.status;return 42!==v&&69!==v&&73!==v&&91!==v&&v!==X&&v!==a&&v!==o?M(S,q):(S.state=null,v===a?M(S,u):I)},S.exports.deflateSetDictionary=(S,v)=>{let D=v.length;if(!S||!S.state)return q;const z=S.state,e=z.wrap;if(2===e||1===e&&42!==z.status||z.lookahead)return q;if(1===e&&(S.adler=g(S.adler,v,D,0)),z.wrap=0,D>=z.w_size){0===e&&(J(z.head),z.strstart=0,z.block_start=0,z.insert=0);let S=new Uint8Array(z.w_size);S.set(v.subarray(D-z.w_size,D),0),v=S,D=z.w_size}const N=S.avail_in,m=S.next_in,B=S.input;for(S.avail_in=D,S.next_in=0,S.input=v,y(z);z.lookahead>=3;){let S=z.strstart,v=z.lookahead-2;do{z.ins_h=H(z,z.ins_h,z.window[S+3-1]),z.prev[S&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=S,S++}while(--v);z.strstart=S,z.lookahead=2,y(z)}return z.strstart+=z.lookahead,z.block_start=z.strstart,z.insert=z.lookahead,z.lookahead=0,z.match_length=z.prev_length=2,z.match_available=0,S.next_in=m,S.input=B,S.avail_in=N,z.wrap=e,I},S.exports.deflateInfo="pako deflate (from Nodeca project)"},12601:S=>{"use strict";S.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12589:S=>{"use strict";S.exports=function(S,v){let D,z,e,N,m,B,g,E,h,A,w,n,R,O,I,K,q,u,s,r,d,x,W,p;const b=S.state;D=S.next_in,W=S.input,z=D+(S.avail_in-5),e=S.next_out,p=S.output,N=e-(v-S.avail_out),m=e+(S.avail_out-257),B=b.dmax,g=b.wsize,E=b.whave,h=b.wnext,A=b.window,w=b.hold,n=b.bits,R=b.lencode,O=b.distcode,I=(1<<b.lenbits)-1,K=(1<<b.distbits)-1;S:do{n<15&&(w+=W[D++]<<n,n+=8,w+=W[D++]<<n,n+=8),q=R[w&I];v:for(;;){if(u=q>>>24,w>>>=u,n-=u,u=q>>>16&255,0===u)p[e++]=65535&q;else{if(!(16&u)){if(0===(64&u)){q=R[(65535&q)+(w&(1<<u)-1)];continue v}if(32&u){b.mode=12;break S}S.Ev="invalid literal/length code",b.mode=30;break S}s=65535&q,u&=15,u&&(n<u&&(w+=W[D++]<<n,n+=8),s+=w&(1<<u)-1,w>>>=u,n-=u),n<15&&(w+=W[D++]<<n,n+=8,w+=W[D++]<<n,n+=8),q=O[w&K];D:for(;;){if(u=q>>>24,w>>>=u,n-=u,u=q>>>16&255,!(16&u)){if(0===(64&u)){q=O[(65535&q)+(w&(1<<u)-1)];continue D}S.Ev="invalid distance code",b.mode=30;break S}if(r=65535&q,u&=15,n<u&&(w+=W[D++]<<n,n+=8,n<u&&(w+=W[D++]<<n,n+=8)),r+=w&(1<<u)-1,r>B){S.Ev="invalid distance too far back",b.mode=30;break S}if(w>>>=u,n-=u,u=e-N,r>u){if(u=r-u,u>E&&b.sane){S.Ev="invalid distance too far back",b.mode=30;break S}if(d=0,x=A,0===h){if(d+=g-u,u<s){s-=u;do{p[e++]=A[d++]}while(--u);d=e-r,x=p}}else if(h<u){if(d+=g+h-u,u-=h,u<s){s-=u;do{p[e++]=A[d++]}while(--u);if(d=0,h<s){u=h,s-=u;do{p[e++]=A[d++]}while(--u);d=e-r,x=p}}}else if(d+=h-u,u<s){s-=u;do{p[e++]=A[d++]}while(--u);d=e-r,x=p}for(;s>2;)p[e++]=x[d++],p[e++]=x[d++],p[e++]=x[d++],s-=3;s&&(p[e++]=x[d++],s>1&&(p[e++]=x[d++]))}else{d=e-r;do{p[e++]=p[d++],p[e++]=p[d++],p[e++]=p[d++],s-=3}while(s>2);s&&(p[e++]=p[d++],s>1&&(p[e++]=p[d++]))}break}}break}}while(D<z&&e<m);s=n>>3,D-=s,n-=s<<3,w&=(1<<n)-1,S.next_in=D,S.next_out=e,S.avail_in=D<z?z-D+5:5-(D-z),S.avail_out=e<m?m-e+257:257-(e-m),b.hold=w,b.bits=n}},12587:(S,v,D)=>{"use strict";const z=D(12539),e=D(12543),N=D(12589),m=D(12595),{Z_FINISH:B,Z_BLOCK:g,Z_TREES:E,Z_OK:h,Z_STREAM_END:A,Z_NEED_DICT:w,Z_STREAM_ERROR:n,Z_DATA_ERROR:R,Z_MEM_ERROR:O,Z_BUF_ERROR:I,Z_DEFLATED:K}=D(12557),q=12,u=30,s=S=>(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24);function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const d=S=>{if(!S||!S.state)return n;const v=S.state;return S.total_in=S.total_out=v.total=0,S.Ev="",v.wrap&&(S.adler=1&v.wrap),v.mode=1,v.last=0,v.havedict=0,v.dmax=32768,v.head=null,v.hold=0,v.bits=0,v.lencode=v.lendyn=new Int32Array(852),v.distcode=v.distdyn=new Int32Array(592),v.sane=1,v.back=-1,h},x=S=>{if(!S||!S.state)return n;const v=S.state;return v.wsize=0,v.whave=0,v.wnext=0,d(S)},W=(S,v)=>{let D;if(!S||!S.state)return n;const z=S.state;return v<0?(D=0,v=-v):(D=1+(v>>4),v<48&&(v&=15)),v&&(v<8||v>15)?n:(null!==z.window&&z.wbits!==v&&(z.window=null),z.wrap=D,z.wbits=v,x(S))},p=(S,v)=>{if(!S)return n;const D=new r;S.state=D,D.window=null;const z=W(S,v);return z!==h&&(S.state=null),z};let b,k,Z=!0;const i=S=>{if(Z){b=new Int32Array(512),k=new Int32Array(32);let v=0;for(;v<144;)S.lens[v++]=8;for(;v<256;)S.lens[v++]=9;for(;v<280;)S.lens[v++]=7;for(;v<288;)S.lens[v++]=8;for(m(1,S.lens,0,288,b,0,S.work,{bits:9}),v=0;v<32;)S.lens[v++]=5;m(2,S.lens,0,32,k,0,S.work,{bits:5}),Z=!1}S.lencode=b,S.lenbits=9,S.distcode=k,S.distbits=5},t=(S,v,D,z)=>{let e;const N=S.state;return null===N.window&&(N.wsize=1<<N.wbits,N.wnext=0,N.whave=0,N.window=new Uint8Array(N.wsize)),z>=N.wsize?(N.window.set(v.subarray(D-N.wsize,D),0),N.wnext=0,N.whave=N.wsize):(e=N.wsize-N.wnext,e>z&&(e=z),N.window.set(v.subarray(D-z,D-z+e),N.wnext),(z-=e)?(N.window.set(v.subarray(D-z,D),0),N.wnext=z,N.whave=N.wsize):(N.wnext+=e,N.wnext===N.wsize&&(N.wnext=0),N.whave<N.wsize&&(N.whave+=e))),0};S.exports.inflateReset=x,S.exports.inflateReset2=W,S.exports.inflateResetKeep=d,S.exports.inflateInit=S=>p(S,15),S.exports.inflateInit2=p,S.exports.inflate=(S,v)=>{let D,r,d,x,W,p,b,k,Z,X,a,o,M,c,J,H,T,G,Y,j,V,U,y=0;const f=new Uint8Array(4);let C,F;const l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!S||!S.state||!S.output||!S.input&&0!==S.avail_in)return n;D=S.state,D.mode===q&&(D.mode=13),W=S.next_out,d=S.output,b=S.avail_out,x=S.next_in,r=S.input,p=S.avail_in,k=D.hold,Z=D.bits,X=p,a=b,U=h;S:for(;;)switch(D.mode){case 1:if(0===D.wrap){D.mode=13;break}for(;Z<16;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if(2&D.wrap&&35615===k){D.check=0,f[0]=255&k,f[1]=k>>>8&255,D.check=e(D.check,f,2,0),k=0,Z=0,D.mode=2;break}if(D.flags=0,D.head&&(D.head.done=!1),!(1&D.wrap)||(((255&k)<<8)+(k>>8))%31){S.Ev="incorrect header check",D.mode=u;break}if((15&k)!==K){S.Ev="unknown compression method",D.mode=u;break}if(k>>>=4,Z-=4,V=8+(15&k),0===D.wbits)D.wbits=V;else if(V>D.wbits){S.Ev="invalid window size",D.mode=u;break}D.dmax=1<<D.wbits,S.adler=D.check=1,D.mode=512&k?10:q,k=0,Z=0;break;case 2:for(;Z<16;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if(D.flags=k,(255&D.flags)!==K){S.Ev="unknown compression method",D.mode=u;break}if(57344&D.flags){S.Ev="unknown header flags set",D.mode=u;break}D.head&&(D.head.text=k>>8&1),512&D.flags&&(f[0]=255&k,f[1]=k>>>8&255,D.check=e(D.check,f,2,0)),k=0,Z=0,D.mode=3;case 3:for(;Z<32;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}D.head&&(D.head.time=k),512&D.flags&&(f[0]=255&k,f[1]=k>>>8&255,f[2]=k>>>16&255,f[3]=k>>>24&255,D.check=e(D.check,f,4,0)),k=0,Z=0,D.mode=4;case 4:for(;Z<16;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}D.head&&(D.head.xflags=255&k,D.head.os=k>>8),512&D.flags&&(f[0]=255&k,f[1]=k>>>8&255,D.check=e(D.check,f,2,0)),k=0,Z=0,D.mode=5;case 5:if(1024&D.flags){for(;Z<16;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}D.length=k,D.head&&(D.head.extra_len=k),512&D.flags&&(f[0]=255&k,f[1]=k>>>8&255,D.check=e(D.check,f,2,0)),k=0,Z=0}else D.head&&(D.head.extra=null);D.mode=6;case 6:if(1024&D.flags&&(o=D.length,o>p&&(o=p),o&&(D.head&&(V=D.head.extra_len-D.length,D.head.extra||(D.head.extra=new Uint8Array(D.head.extra_len)),D.head.extra.set(r.subarray(x,x+o),V)),512&D.flags&&(D.check=e(D.check,r,o,x)),p-=o,x+=o,D.length-=o),D.length))break S;D.length=0,D.mode=7;case 7:if(2048&D.flags){if(0===p)break S;o=0;do{V=r[x+o++],D.head&&V&&D.length<65536&&(D.head.name+=String.fromCharCode(V))}while(V&&o<p);if(512&D.flags&&(D.check=e(D.check,r,o,x)),p-=o,x+=o,V)break S}else D.head&&(D.head.name=null);D.length=0,D.mode=8;case 8:if(4096&D.flags){if(0===p)break S;o=0;do{V=r[x+o++],D.head&&V&&D.length<65536&&(D.head.comment+=String.fromCharCode(V))}while(V&&o<p);if(512&D.flags&&(D.check=e(D.check,r,o,x)),p-=o,x+=o,V)break S}else D.head&&(D.head.comment=null);D.mode=9;case 9:if(512&D.flags){for(;Z<16;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if(k!==(65535&D.check)){S.Ev="header crc mismatch",D.mode=u;break}k=0,Z=0}D.head&&(D.head.hcrc=D.flags>>9&1,D.head.done=!0),S.adler=D.check=0,D.mode=q;break;case 10:for(;Z<32;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}S.adler=D.check=s(k),k=0,Z=0,D.mode=11;case 11:if(0===D.havedict)return S.next_out=W,S.avail_out=b,S.next_in=x,S.avail_in=p,D.hold=k,D.bits=Z,w;S.adler=D.check=1,D.mode=q;case q:if(v===g||v===E)break S;case 13:if(D.last){k>>>=7&Z,Z-=7&Z,D.mode=27;break}for(;Z<3;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}switch(D.last=1&k,k>>>=1,Z-=1,3&k){case 0:D.mode=14;break;case 1:if(i(D),D.mode=20,v===E){k>>>=2,Z-=2;break S}break;case 2:D.mode=17;break;case 3:S.Ev="invalid block type",D.mode=u}k>>>=2,Z-=2;break;case 14:for(k>>>=7&Z,Z-=7&Z;Z<32;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if((65535&k)!==(k>>>16^65535)){S.Ev="invalid stored block lengths",D.mode=u;break}if(D.length=65535&k,k=0,Z=0,D.mode=15,v===E)break S;case 15:D.mode=16;case 16:if(o=D.length,o){if(o>p&&(o=p),o>b&&(o=b),0===o)break S;d.set(r.subarray(x,x+o),W),p-=o,x+=o,b-=o,W+=o,D.length-=o;break}D.mode=q;break;case 17:for(;Z<14;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if(D.nlen=257+(31&k),k>>>=5,Z-=5,D.ndist=1+(31&k),k>>>=5,Z-=5,D.ncode=4+(15&k),k>>>=4,Z-=4,D.nlen>286||D.ndist>30){S.Ev="too many length or distance symbols",D.mode=u;break}D.have=0,D.mode=18;case 18:for(;D.have<D.ncode;){for(;Z<3;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}D.lens[l[D.have++]]=7&k,k>>>=3,Z-=3}for(;D.have<19;)D.lens[l[D.have++]]=0;if(D.lencode=D.lendyn,D.lenbits=7,C={bits:D.lenbits},U=m(0,D.lens,0,19,D.lencode,0,D.work,C),D.lenbits=C.bits,U){S.Ev="invalid code lengths set",D.mode=u;break}D.have=0,D.mode=19;case 19:for(;D.have<D.nlen+D.ndist;){for(;y=D.lencode[k&(1<<D.lenbits)-1],J=y>>>24,H=y>>>16&255,T=65535&y,!(J<=Z);){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if(T<16)k>>>=J,Z-=J,D.lens[D.have++]=T;else{if(16===T){for(F=J+2;Z<F;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if(k>>>=J,Z-=J,0===D.have){S.Ev="invalid bit length repeat",D.mode=u;break}V=D.lens[D.have-1],o=3+(3&k),k>>>=2,Z-=2}else if(17===T){for(F=J+3;Z<F;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}k>>>=J,Z-=J,V=0,o=3+(7&k),k>>>=3,Z-=3}else{for(F=J+7;Z<F;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}k>>>=J,Z-=J,V=0,o=11+(127&k),k>>>=7,Z-=7}if(D.have+o>D.nlen+D.ndist){S.Ev="invalid bit length repeat",D.mode=u;break}for(;o--;)D.lens[D.have++]=V}}if(D.mode===u)break;if(0===D.lens[256]){S.Ev="invalid code -- missing end-of-block",D.mode=u;break}if(D.lenbits=9,C={bits:D.lenbits},U=m(1,D.lens,0,D.nlen,D.lencode,0,D.work,C),D.lenbits=C.bits,U){S.Ev="invalid literal/lengths set",D.mode=u;break}if(D.distbits=6,D.distcode=D.distdyn,C={bits:D.distbits},U=m(2,D.lens,D.nlen,D.ndist,D.distcode,0,D.work,C),D.distbits=C.bits,U){S.Ev="invalid distances set",D.mode=u;break}if(D.mode=20,v===E)break S;case 20:D.mode=21;case 21:if(p>=6&&b>=258){S.next_out=W,S.avail_out=b,S.next_in=x,S.avail_in=p,D.hold=k,D.bits=Z,N(S,a),W=S.next_out,d=S.output,b=S.avail_out,x=S.next_in,r=S.input,p=S.avail_in,k=D.hold,Z=D.bits,D.mode===q&&(D.back=-1);break}for(D.back=0;y=D.lencode[k&(1<<D.lenbits)-1],J=y>>>24,H=y>>>16&255,T=65535&y,!(J<=Z);){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if(H&&0===(240&H)){for(G=J,Y=H,j=T;y=D.lencode[j+((k&(1<<G+Y)-1)>>G)],J=y>>>24,H=y>>>16&255,T=65535&y,!(G+J<=Z);){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}k>>>=G,Z-=G,D.back+=G}if(k>>>=J,Z-=J,D.back+=J,D.length=T,0===H){D.mode=26;break}if(32&H){D.back=-1,D.mode=q;break}if(64&H){S.Ev="invalid literal/length code",D.mode=u;break}D.extra=15&H,D.mode=22;case 22:if(D.extra){for(F=D.extra;Z<F;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}D.length+=k&(1<<D.extra)-1,k>>>=D.extra,Z-=D.extra,D.back+=D.extra}D.was=D.length,D.mode=23;case 23:for(;y=D.distcode[k&(1<<D.distbits)-1],J=y>>>24,H=y>>>16&255,T=65535&y,!(J<=Z);){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if(0===(240&H)){for(G=J,Y=H,j=T;y=D.distcode[j+((k&(1<<G+Y)-1)>>G)],J=y>>>24,H=y>>>16&255,T=65535&y,!(G+J<=Z);){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}k>>>=G,Z-=G,D.back+=G}if(k>>>=J,Z-=J,D.back+=J,64&H){S.Ev="invalid distance code",D.mode=u;break}D.offset=T,D.extra=15&H,D.mode=24;case 24:if(D.extra){for(F=D.extra;Z<F;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}D.offset+=k&(1<<D.extra)-1,k>>>=D.extra,Z-=D.extra,D.back+=D.extra}if(D.offset>D.dmax){S.Ev="invalid distance too far back",D.mode=u;break}D.mode=25;case 25:if(0===b)break S;if(o=a-b,D.offset>o){if(o=D.offset-o,o>D.whave&&D.sane){S.Ev="invalid distance too far back",D.mode=u;break}o>D.wnext?(o-=D.wnext,M=D.wsize-o):M=D.wnext-o,o>D.length&&(o=D.length),c=D.window}else c=d,M=W-D.offset,o=D.length;o>b&&(o=b),b-=o,D.length-=o;do{d[W++]=c[M++]}while(--o);0===D.length&&(D.mode=21);break;case 26:if(0===b)break S;d[W++]=D.length,b--,D.mode=21;break;case 27:if(D.wrap){for(;Z<32;){if(0===p)break S;p--,k|=r[x++]<<Z,Z+=8}if(a-=b,S.total_out+=a,D.total+=a,a&&(S.adler=D.check=D.flags?e(D.check,d,a,W-a):z(D.check,d,a,W-a)),a=b,(D.flags?k:s(k))!==D.check){S.Ev="incorrect data check",D.mode=u;break}k=0,Z=0}D.mode=28;case 28:if(D.wrap&&D.flags){for(;Z<32;){if(0===p)break S;p--,k+=r[x++]<<Z,Z+=8}if(k!==(4294967295&D.total)){S.Ev="incorrect length check",D.mode=u;break}k=0,Z=0}D.mode=29;case 29:U=A;break S;case u:U=R;break S;case 31:return O;default:return n}return S.next_out=W,S.avail_out=b,S.next_in=x,S.avail_in=p,D.hold=k,D.bits=Z,(D.wsize||a!==S.avail_out&&D.mode<u&&(D.mode<27||v!==B))&&t(S,S.output,S.next_out,a-S.avail_out)?(D.mode=31,O):(X-=S.avail_in,a-=S.avail_out,S.total_in+=X,S.total_out+=a,D.total+=a,D.wrap&&a&&(S.adler=D.check=D.flags?e(D.check,d,a,S.next_out-a):z(D.check,d,a,S.next_out-a)),S.data_type=D.bits+(D.last?64:0)+(D.mode===q?128:0)+(20===D.mode||15===D.mode?256:0),(0===X&&0===a||v===B)&&U===h&&(U=I),U)},S.exports.inflateEnd=S=>{if(!S||!S.state)return n;let v=S.state;return v.window&&(v.window=null),S.state=null,h},S.exports.inflateGetHeader=(S,v)=>{if(!S||!S.state)return n;const D=S.state;return 0===(2&D.wrap)?n:(D.head=v,v.done=!1,h)},S.exports.inflateSetDictionary=(S,v)=>{const D=v.length;let e,N,m;return S&&S.state?(e=S.state,0!==e.wrap&&11!==e.mode?n:11===e.mode&&(N=1,N=z(N,v,D,0),N!==e.check)?R:(m=t(S,v,D,D),m?(e.mode=31,O):(e.havedict=1,h))):n},S.exports.inflateInfo="pako inflate (from Nodeca project)"},12595:S=>{"use strict";const v=15,D=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),N=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);S.exports=(S,m,B,g,E,h,A,w)=>{const n=w.bits;let R,O,I,K,q,u,s=0,r=0,d=0,x=0,W=0,p=0,b=0,k=0,Z=0,i=0,t=null,X=0;const a=new Uint16Array(16),o=new Uint16Array(16);let M,c,J,H=null,T=0;for(s=0;s<=v;s++)a[s]=0;for(r=0;r<g;r++)a[m[B+r]]++;for(W=n,x=v;x>=1&&0===a[x];x--);if(W>x&&(W=x),0===x)return E[h++]=20971520,E[h++]=20971520,w.bits=1,0;for(d=1;d<x&&0===a[d];d++);for(W<d&&(W=d),k=1,s=1;s<=v;s++)if(k<<=1,k-=a[s],k<0)return-1;if(k>0&&(0===S||1!==x))return-1;for(o[1]=0,s=1;s<v;s++)o[s+1]=o[s]+a[s];for(r=0;r<g;r++)0!==m[B+r]&&(A[o[m[B+r]]++]=r);if(0===S?(t=H=A,u=19):1===S?(t=D,X-=257,H=z,T-=257,u=256):(t=e,H=N,u=-1),i=0,r=0,s=d,q=h,p=W,b=0,I=-1,Z=1<<W,K=Z-1,1===S&&Z>852||2===S&&Z>592)return 1;for(;;){M=s-b,A[r]<u?(c=0,J=A[r]):A[r]>u?(c=H[T+A[r]],J=t[X+A[r]]):(c=96,J=0),R=1<<s-b,O=1<<p,d=O;do{O-=R,E[q+(i>>b)+O]=M<<24|c<<16|J}while(0!==O);for(R=1<<s-1;i&R;)R>>=1;if(0!==R?(i&=R-1,i+=R):i=0,r++,0===--a[s]){if(s===x)break;s=m[B+A[r]]}if(s>W&&(i&K)!==I){for(0===b&&(b=W),q+=d,p=s-b,k=1<<p;p+b<x&&(k-=a[p+b],!(k<=0));)p++,k<<=1;if(Z+=1<<p,1===S&&Z>852||2===S&&Z>592)return 1;I=i&K,E[I]=W<<24|p<<16|q-h}}return 0!==i&&(E[q+i]=s-b<<24|64<<16),w.bits=W,0}},12552:S=>{"use strict";S.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12531:S=>{"use strict";function v(S){let v=S.length;for(;--v>=0;)S[v]=0}const D=256,z=286,e=30,N=15,m=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),B=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),g=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=new Array(576);v(h);const A=new Array(60);v(A);const w=new Array(512);v(w);const n=new Array(256);v(n);const R=new Array(29);v(R);const O=new Array(e);function I(S,v,D,z,e){this.static_tree=S,this.extra_bits=v,this.extra_base=D,this.elems=z,this.max_length=e,this.has_stree=S&&S.length}let K,q,u;function s(S,v){this.dyn_tree=S,this.max_code=0,this.stat_desc=v}v(O);const r=S=>S<256?w[S]:w[256+(S>>>7)],d=(S,v)=>{S.pending_buf[S.pending++]=255&v,S.pending_buf[S.pending++]=v>>>8&255},x=(S,v,D)=>{S.bi_valid>16-D?(S.bi_buf|=v<<S.bi_valid&65535,d(S,S.bi_buf),S.bi_buf=v>>16-S.bi_valid,S.bi_valid+=D-16):(S.bi_buf|=v<<S.bi_valid&65535,S.bi_valid+=D)},W=(S,v,D)=>{x(S,D[2*v],D[2*v+1])},p=(S,v)=>{let D=0;do{D|=1&S,S>>>=1,D<<=1}while(--v>0);return D>>>1},b=(S,v,D)=>{const z=new Array(16);let e,m,B=0;for(e=1;e<=N;e++)z[e]=B=B+D[e-1]<<1;for(m=0;m<=v;m++){let v=S[2*m+1];0!==v&&(S[2*m]=p(z[v]++,v))}},k=S=>{let v;for(v=0;v<z;v++)S.dyn_ltree[2*v]=0;for(v=0;v<e;v++)S.dyn_dtree[2*v]=0;for(v=0;v<19;v++)S.bl_tree[2*v]=0;S.dyn_ltree[512]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0},Z=S=>{S.bi_valid>8?d(S,S.bi_buf):S.bi_valid>0&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0},i=(S,v,D,z)=>{const e=2*v,N=2*D;return S[e]<S[N]||S[e]===S[N]&&z[v]<=z[D]},t=(S,v,D)=>{const z=S.heap[D];let e=D<<1;for(;e<=S.heap_len&&(e<S.heap_len&&i(v,S.heap[e+1],S.heap[e],S.depth)&&e++,!i(v,z,S.heap[e],S.depth));)S.heap[D]=S.heap[e],D=e,e<<=1;S.heap[D]=z},X=(S,v,z)=>{let e,N,g,E,h=0;if(0!==S.last_lit)do{e=S.pending_buf[S.d_buf+2*h]<<8|S.pending_buf[S.d_buf+2*h+1],N=S.pending_buf[S.l_buf+h],h++,0===e?W(S,N,v):(g=n[N],W(S,g+D+1,v),E=m[g],0!==E&&(N-=R[g],x(S,N,E)),e--,g=r(e),W(S,g,z),E=B[g],0!==E&&(e-=O[g],x(S,e,E)))}while(h<S.last_lit);W(S,256,v)},a=(S,v)=>{const D=v.dyn_tree,z=v.stat_desc.static_tree,e=v.stat_desc.has_stree,m=v.stat_desc.elems;let B,g,E,h=-1;for(S.heap_len=0,S.heap_max=573,B=0;B<m;B++)0!==D[2*B]?(S.heap[++S.heap_len]=h=B,S.depth[B]=0):D[2*B+1]=0;for(;S.heap_len<2;)E=S.heap[++S.heap_len]=h<2?++h:0,D[2*E]=1,S.depth[E]=0,S.opt_len--,e&&(S.static_len-=z[2*E+1]);for(v.max_code=h,B=S.heap_len>>1;B>=1;B--)t(S,D,B);E=m;do{B=S.heap[1],S.heap[1]=S.heap[S.heap_len--],t(S,D,1),g=S.heap[1],S.heap[--S.heap_max]=B,S.heap[--S.heap_max]=g,D[2*E]=D[2*B]+D[2*g],S.depth[E]=(S.depth[B]>=S.depth[g]?S.depth[B]:S.depth[g])+1,D[2*B+1]=D[2*g+1]=E,S.heap[1]=E++,t(S,D,1)}while(S.heap_len>=2);S.heap[--S.heap_max]=S.heap[1],((S,v)=>{const D=v.dyn_tree,z=v.max_code,e=v.stat_desc.static_tree,m=v.stat_desc.has_stree,B=v.stat_desc.extra_bits,g=v.stat_desc.extra_base,E=v.stat_desc.max_length;let h,A,w,n,R,O,I=0;for(n=0;n<=N;n++)S.bl_count[n]=0;for(D[2*S.heap[S.heap_max]+1]=0,h=S.heap_max+1;h<573;h++)A=S.heap[h],n=D[2*D[2*A+1]+1]+1,n>E&&(n=E,I++),D[2*A+1]=n,A>z||(S.bl_count[n]++,R=0,A>=g&&(R=B[A-g]),O=D[2*A],S.opt_len+=O*(n+R),m&&(S.static_len+=O*(e[2*A+1]+R)));if(0!==I){do{for(n=E-1;0===S.bl_count[n];)n--;S.bl_count[n]--,S.bl_count[n+1]+=2,S.bl_count[E]--,I-=2}while(I>0);for(n=E;0!==n;n--)for(A=S.bl_count[n];0!==A;)w=S.heap[--h],w>z||(D[2*w+1]!==n&&(S.opt_len+=(n-D[2*w+1])*D[2*w],D[2*w+1]=n),A--)}})(S,v),b(D,h,S.bl_count)},o=(S,v,D)=>{let z,e,N=-1,m=v[1],B=0,g=7,E=4;for(0===m&&(g=138,E=3),v[2*(D+1)+1]=65535,z=0;z<=D;z++)e=m,m=v[2*(z+1)+1],++B<g&&e===m||(B<E?S.bl_tree[2*e]+=B:0!==e?(e!==N&&S.bl_tree[2*e]++,S.bl_tree[32]++):B<=10?S.bl_tree[34]++:S.bl_tree[36]++,B=0,N=e,0===m?(g=138,E=3):e===m?(g=6,E=3):(g=7,E=4))},M=(S,v,D)=>{let z,e,N=-1,m=v[1],B=0,g=7,E=4;for(0===m&&(g=138,E=3),z=0;z<=D;z++)if(e=m,m=v[2*(z+1)+1],!(++B<g&&e===m)){if(B<E)do{W(S,e,S.bl_tree)}while(0!==--B);else 0!==e?(e!==N&&(W(S,e,S.bl_tree),B--),W(S,16,S.bl_tree),x(S,B-3,2)):B<=10?(W(S,17,S.bl_tree),x(S,B-3,3)):(W(S,18,S.bl_tree),x(S,B-11,7));B=0,N=e,0===m?(g=138,E=3):e===m?(g=6,E=3):(g=7,E=4)}};let c=!1;const J=(S,v,D,z)=>{x(S,0+(z?1:0),3),((S,v,D,z)=>{Z(S),z&&(d(S,D),d(S,~D)),S.pending_buf.set(S.window.subarray(v,v+D),S.pending),S.pending+=D})(S,v,D,!0)};S.exports._tr_init=S=>{c||((()=>{let S,v,D,E,s;const r=new Array(16);for(D=0,E=0;E<28;E++)for(R[E]=D,S=0;S<1<<m[E];S++)n[D++]=E;for(n[D-1]=E,s=0,E=0;E<16;E++)for(O[E]=s,S=0;S<1<<B[E];S++)w[s++]=E;for(s>>=7;E<e;E++)for(O[E]=s<<7,S=0;S<1<<B[E]-7;S++)w[256+s++]=E;for(v=0;v<=N;v++)r[v]=0;for(S=0;S<=143;)h[2*S+1]=8,S++,r[8]++;for(;S<=255;)h[2*S+1]=9,S++,r[9]++;for(;S<=279;)h[2*S+1]=7,S++,r[7]++;for(;S<=287;)h[2*S+1]=8,S++,r[8]++;for(b(h,287,r),S=0;S<e;S++)A[2*S+1]=5,A[2*S]=p(S,5);K=new I(h,m,257,z,N),q=new I(A,B,0,e,N),u=new I(new Array(0),g,0,19,7)})(),c=!0),S.l_desc=new s(S.dyn_ltree,K),S.d_desc=new s(S.dyn_dtree,q),S.bl_desc=new s(S.bl_tree,u),S.bi_buf=0,S.bi_valid=0,k(S)},S.exports._tr_stored_block=J,S.exports._tr_flush_block=(S,v,z,e)=>{let N,m,B=0;S.level>0?(2===S.strm.data_type&&(S.strm.data_type=(S=>{let v,z=4093624447;for(v=0;v<=31;v++,z>>>=1)if(1&z&&0!==S.dyn_ltree[2*v])return 0;if(0!==S.dyn_ltree[18]||0!==S.dyn_ltree[20]||0!==S.dyn_ltree[26])return 1;for(v=32;v<D;v++)if(0!==S.dyn_ltree[2*v])return 1;return 0})(S)),a(S,S.l_desc),a(S,S.d_desc),B=(S=>{let v;for(o(S,S.dyn_ltree,S.l_desc.max_code),o(S,S.dyn_dtree,S.d_desc.max_code),a(S,S.bl_desc),v=18;v>=3&&0===S.bl_tree[2*E[v]+1];v--);return S.opt_len+=3*(v+1)+5+5+4,v})(S),N=S.opt_len+3+7>>>3,m=S.static_len+3+7>>>3,m<=N&&(N=m)):N=m=z+5,z+4<=N&&-1!==v?J(S,v,z,e):4===S.strategy||m===N?(x(S,2+(e?1:0),3),X(S,h,A)):(x(S,4+(e?1:0),3),((S,v,D,z)=>{let e;for(x(S,v-257,5),x(S,D-1,5),x(S,z-4,4),e=0;e<z;e++)x(S,S.bl_tree[2*E[e]+1],3);M(S,S.dyn_ltree,v-1),M(S,S.dyn_dtree,D-1)})(S,S.l_desc.max_code+1,S.d_desc.max_code+1,B+1),X(S,S.dyn_ltree,S.dyn_dtree)),k(S),e&&Z(S)},S.exports._tr_tally=(S,v,z)=>(S.pending_buf[S.d_buf+2*S.last_lit]=v>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&v,S.pending_buf[S.l_buf+S.last_lit]=255&z,S.last_lit++,0===v?S.dyn_ltree[2*z]++:(S.matches++,v--,S.dyn_ltree[2*(n[z]+D+1)]++,S.dyn_dtree[2*r(v)]++),S.last_lit===S.lit_bufsize-1),S.exports._tr_align=S=>{x(S,2,3),W(S,256,h),(S=>{16===S.bi_valid?(d(S,S.bi_buf),S.bi_buf=0,S.bi_valid=0):S.bi_valid>=8&&(S.pending_buf[S.pending++]=255&S.bi_buf,S.bi_buf>>=8,S.bi_valid-=8)})(S)}},12582:S=>{"use strict";S.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Ev="",this.state=null,this.data_type=2,this.adler=0}},12202:S=>{function v(S,v,D){for(var z=S.length,e=-1/0,N=1/0,m=0;m<z;m++){var B=(D[0][m]-S[m])/v[m],g=(D[1][m]-S[m])/v[m];if(B>g){var E=B;B=g,g=E}if(g<e||B>N)return 1/0;B>e&&(e=B),g<N&&(N=g)}return e>N?1/0:e}S.exports=function(S,D,z,e){var N=v(D,z,e);if(N===1/0)S=null;else{S=S||[];for(var m=0;m<D.length;m++)S[m]=D[m]+z[m]*N}return S},S.exports.distance=v},13559:(S,v,D)=>{"use strict";D.d(v,{e:()=>m});var z=D(31);const e=z.useLayoutEffect;const N=function(S){var v=(0,z.useRef)(S);return e((function(){v.current=S})),v};var m=function(S){var v=N(S);(0,z.mv)((function(){var S=function(S){var D;if(null!=v.current&&(D=v.current(S)),S.defaultPrevented&&(S.returnValue=""),"string"===typeof D)return S.returnValue=D,D};return window.addEventListener("beforeunload",S),function(){window.removeEventListener("beforeunload",S)}}),[])}},13504:(S,v,D)=>{"use strict";var z=D(13513),e=Array.prototype.concat,N=Array.prototype.slice,m=S.exports=function(S){for(var v=[],D=0,m=S.length;D<m;D++){var B=S[D];z(B)?v=e.call(v,N.call(B)):v.push(B)}return v};m.wrap=function(S){return function(){return S(m(arguments))}}},13513:S=>{S.exports=function(S){return!(!S||"string"===typeof S)&&(S instanceof Array||Array.isArray(S)||S.length>=0&&(S.splice instanceof Function||Object.getOwnPropertyDescriptor(S,S.length-1)&&"String"!==S.constructor.name))}},12474:(S,v,D)=>{var z=D(12482);function e(S){for(var v,D,e=0,N=S.length,m=0;m<S.length;){for(v=S[m],D=0;m<N&&S[m]===v;)++m,++D;e+=z.log2(D)/7|0,e+=z.log2(v>>>0)/7|0,e+=2}return e}v.size=e,v.encode=function(S,v){v||(v=new Uint8Array(e(S)));for(var D,z,N=0,m=v.length,B=0;B<S.length;){for(D=S[B],z=0;B<S.length&&S[B]===D;)++B,++z;for(;N<m&&z>=128;)v[N++]=128+(127&z),z>>>=7;if(N>=m)throw new Error("RLE buffer overflow");for(v[N++]=z,D>>>=0;N<m&&D>=128;)v[N++]=128+(127&D),D>>>=7;if(N>=m)throw new Error("RLE buffer overflow");v[N++]=D}return v},v.decode=function(S,v){for(var D,z,e,N,m=v.length,B=S.length,g=0,E=0;E<B;){for(D=0,z=0;E<B&&S[E]>=128;)D+=(127&S[E++])<<z,z+=7;if(D+=S[E++]<<z,E>=B)throw new Error("RLE buffer underrun");if(g+D>m)throw new Error("Chunk buffer overflow");for(e=0,z=0;E<B&&S[E]>=128;)e+=(127&S[E++])<<z,z+=7;if(E>=B)throw new Error("RLE buffer underrun");for(e+=S[E++]<<z,N=0;N<D;++N)v[g++]=e}return v}},12482:(S,v)=>{"use strict";function D(S){var v=32;return(S&=-S)&&v--,65535&S&&(v-=16),16711935&S&&(v-=8),252645135&S&&(v-=4),858993459&S&&(v-=2),1431655765&S&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(S){return(S>0)-(S<0)},v.abs=function(S){var v=S>>31;return(S^v)-v},v.min=function(S,v){return v^(S^v)&-(S<v)},v.max=function(S,v){return S^(S^v)&-(S<v)},v.isPow2=function(S){return!(S&S-1)&&!!S},v.log2=function(S){var v,D;return v=(S>65535)<<4,v|=D=((S>>>=v)>255)<<3,v|=D=((S>>>=D)>15)<<2,(v|=D=((S>>>=D)>3)<<1)|(S>>>=D)>>1},v.log10=function(S){return S>=1e9?9:S>=1e8?8:S>=1e7?7:S>=1e6?6:S>=1e5?5:S>=1e4?4:S>=1e3?3:S>=100?2:S>=10?1:0},v.popCount=function(S){return 16843009*((S=(858993459&(S-=S>>>1&1431655765))+(S>>>2&858993459))+(S>>>4)&252645135)>>>24},v.countTrailingZeros=D,v.nextPow2=function(S){return S+=0===S,--S,S|=S>>>1,S|=S>>>2,S|=S>>>4,S|=S>>>8,(S|=S>>>16)+1},v.prevPow2=function(S){return S|=S>>>1,S|=S>>>2,S|=S>>>4,S|=S>>>8,(S|=S>>>16)-(S>>>1)},v.parity=function(S){return S^=S>>>16,S^=S>>>8,S^=S>>>4,27030>>>(S&=15)&1};var z=new Array(256);!function(S){for(var v=0;v<256;++v){var D=v,z=v,e=7;for(D>>>=1;D;D>>>=1)z<<=1,z|=1&D,--e;S[v]=z<<e&255}}(z),v.reverse=function(S){return z[255&S]<<24|z[S>>>8&255]<<16|z[S>>>16&255]<<8|z[S>>>24&255]},v.interleave2=function(S,v){return(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S&=65535)|S<<8))|S<<4))|S<<2))|S<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(S,v){return(S=65535&((S=16711935&((S=252645135&((S=858993459&((S=S>>>v&1431655765)|S>>>1))|S>>>2))|S>>>4))|S>>>16))<<16>>16},v.interleave3=function(S,v,D){return S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2),(S|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2))<<2},v.deinterleave3=function(S,v){return(S=1023&((S=4278190335&((S=251719695&((S=3272356035&((S=S>>>v&1227133513)|S>>>2))|S>>>4))|S>>>8))|S>>>16))<<22>>22},v.nextCombination=function(S){var v=S|S-1;return v+1|(~v&-~v)-1>>>D(S)+1}},12512:S=>{"use strict";S.exports=function(S,v,D,z){var e=self||window;try{try{var N;try{N=new e.Blob([S])}catch(E){(N=new(e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder)).append(S),N=N.getBlob()}var m=e.URL||e.webkitURL,B=m.createObjectURL(N),g=new e[v](B,D);return m.revokeObjectURL(B),g}catch(E){return new e[v]("data:application/javascript,".concat(encodeURIComponent(S)),D)}}catch(E){if(!z)throw Error("Inline worker is not supported");return new e[v](z,D)}}},12181:(S,v,D)=>{"use strict";function z(S,v,D,z,e){var N={};return Object.keys(z).forEach((function(S){N[S]=z[S]})),N.enumerable=!!N.enumerable,N.configurable=!!N.configurable,("value"in N||N.initializer)&&(N.writable=!0),N=D.slice().reverse().reduce((function(D,z){return z(S,v,D)||D}),N),e&&void 0!==N.initializer&&(N.value=N.initializer?N.initializer.call(e):void 0,N.initializer=void 0),void 0===N.initializer&&(Object.defineProperty(S,v,N),N=null),N}D.d(v,{b:()=>z})},12174:(S,v,D)=>{"use strict";function z(S,v,D,z){D&&Object.defineProperty(S,v,{enumerable:D.enumerable,configurable:D.configurable,writable:D.writable,value:D.initializer?D.initializer.call(z):void 0})}D.d(v,{b:()=>z})},13549:(S,v,D)=>{"use strict";D.d(v,{d:()=>m,h:()=>A,i:()=>B,j:()=>N,n:()=>g,p:()=>e,t:()=>E,v:()=>h});var z=D(11595);class e{constructor(){this._easingMode=e.EASINGMODE_EASEIN}setEasingMode(S){const v=Math.min(Math.max(S,0),2);this._easingMode=v}getEasingMode(){return this._easingMode}easeInCore(S){throw new Error("You must implement this method")}ease(S){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(S);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-S)}return S>=.5?.5*(1-this.easeInCore(2*(1-S)))+.5:.5*this.easeInCore(2*S)}}e.EASINGMODE_EASEIN=0,e.EASINGMODE_EASEOUT=1,e.EASINGMODE_EASEINOUT=2;class N extends e{easeInCore(S){return S=Math.max(0,Math.min(1,S)),1-Math.sqrt(1-S*S)}}class m extends e{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=S}easeInCore(S){const v=Math.max(0,this.amplitude);return Math.pow(S,3)-S*v*Math.sin(3.141592653589793*S)}}class B extends e{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=S,this.bounciness=v}easeInCore(S){const v=Math.max(0,this.bounces);let D=this.bounciness;D<=1&&(D=1.001);const z=Math.pow(D,v),e=1-D,N=(1-z)/e+.5*z,m=S*N,B=Math.log(-m*(1-D)+1)/Math.log(D),g=Math.floor(B),E=g+1,h=(1-Math.pow(D,g))/(e*N),A=.5*(h+(1-Math.pow(D,E))/(e*N)),w=S-A,n=A-h;return-Math.pow(1/D,v-g)/(n*n)*(w-n)*(w+n)}}class g extends e{easeInCore(S){return S*S*S}}class E extends e{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=S,this.springiness=v}easeInCore(S){let v;const D=Math.max(0,this.oscillations),z=Math.max(0,this.springiness);return v=0==z?S:(Math.exp(z*S)-1)/(Math.exp(z)-1),v*Math.sin((6.283185307179586*D+1.5707963267948966)*S)}}class h extends e{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=S}easeInCore(S){return this.exponent<=0?S:(Math.exp(this.exponent*S)-1)/(Math.exp(this.exponent)-1)}}class A extends e{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=S,this.y1=v,this.x2=D,this.y2=z}easeInCore(S){return z.d.Interpolate(S,this.x1,this.y1,this.x2,this.y2)}}},13036:(S,v,D)=>{"use strict";D.d(v,{d:()=>m});var z=D(11371),e=D(11386),N=D(11797);class m extends N.b{get _matrix(){return this._compose(),this.Qw}set _matrix(S){(S.updateFlag!==this.Qw.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Qw.N(S),this._markAsDirtyAndDecompose())}constructor(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(S,v.xS(),!1),this.name=S,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=v,this.Qw=(null===e||void 0===e?void 0:e.clone())??z.Matrix.Identity(),this._restMatrix=N??this.Qw.clone(),this._bindMatrix=m??this.Qw.clone(),this._index=B,this._absoluteMatrix=new z.Matrix,this._absoluteBindMatrix=new z.Matrix,this._absoluteInverseBindMatrix=new z.Matrix,this._finalMatrix=new z.Matrix,v.bones.push(this),this.setParent(D,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(S){this.setParent(S)}setParent(S){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==S){if(this.parent){const S=this.parent.children.indexOf(this);-1!==S&&this.parent.children.splice(S,1)}this._parentNode=S,this.parent&&this.parent.children.push(this),v&&this._updateAbsoluteBindMatrices(),this.PE()}}getLocalMatrix(){return this._compose(),this.Qw}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(S){this._restMatrix.N(S)}setRestPose(S){this.setRestMatrix(S)}getBindPose(){return this.getBindMatrix()}setBindMatrix(S){this.pe(S)}setBindPose(S){this.setBindMatrix(S)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const S=z.TmpVectors.Rv[0],v=z.TmpVectors.Quaternion[0],D=z.TmpVectors.Rv[1];this.getRestMatrix().decompose(S,v,D),this._linkedTransformNode.position.N(D),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??z.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.N(v),this._linkedTransformNode.Me.N(S)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(S){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=S,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.TB}set position(S){this._decompose(),this.TB.N(S),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(S){this.setRotation(S)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(S){this.setRotationQuaternion(S)}get Me(){return this.getScale()}set Me(S){this.setScale(S)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=z.Rv.Zero(),this._localRotation=z.Quaternion.Zero(),this.TB=z.Rv.Zero()),this.Qw.decompose(this._localScaling,this._localRotation,this.TB))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,z.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.TB,this.Qw)):this._needToCompose=!1)}pe(S){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.N(S),v&&this._updateAbsoluteBindMatrices(),D?this._matrix=S:this.PE()}_updateAbsoluteBindMatrices(S){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(S||(S=this._bindMatrix),this.parent?S.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.N(S),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),v)for(let D=0;D<this.children.length;D++)this.children[D]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}PE(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.PE(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.PE(),this._needToDecompose=!0}_updatePosition(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=this.getLocalMatrix();if(0==v)e?(N.addAtIndex(12,S.x),N.addAtIndex(13,S.y),N.addAtIndex(14,S.z)):N.setTranslationFromFloats(S.x,S.y,S.z);else{let v=null;D&&(v=D.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=m._TmpMats[0],g=m._TmpVecs[0];this.parent?D&&v?(B.N(this.parent.getAbsoluteMatrix()),B.multiplyToRef(v,B)):B.N(this.parent.getAbsoluteMatrix()):z.Matrix.IdentityToRef(B),e&&B.setTranslationFromFloats(0,0,0),B.invert(),z.Rv.TransformCoordinatesToRef(S,B,g),e?(N.addAtIndex(12,g.x),N.addAtIndex(13,g.y),N.addAtIndex(14,g.z)):N.setTranslationFromFloats(g.x,g.y,g.z)}this._markAsDirtyAndDecompose()}translate(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;this._updatePosition(S,v,D,!0)}setPosition(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;this._updatePosition(S,v,D,!1)}setAbsolutePosition(S,v){this.setPosition(S,1,v)}scale(S,v,D){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.getLocalMatrix(),B=m._TmpMats[0];z.Matrix.ScalingToRef(S,v,D,B),B.multiplyToRef(N,N),B.invert();for(const z of this.children){const e=z.getLocalMatrix();e.multiplyToRef(B,e),e.multiplyAtIndex(12,S),e.multiplyAtIndex(13,v),e.multiplyAtIndex(14,D),z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),e)for(const z of this.children)z.scale(S,v,D,e)}setScale(S){this._decompose(),this._localScaling.N(S),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(S){this._decompose(),S.N(this._localScaling)}setYawPitchRoll(S,v,D){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4?arguments[4]:void 0;if(0===e){const B=m._TmpQuat;return z.Quaternion.RotationYawPitchRollToRef(S,v,D,B),void this.setRotationQuaternion(B,e,N)}const B=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,N))return;const g=m._TmpMats[1];z.Matrix.RotationYawPitchRollToRef(S,v,D,g),B.multiplyToRef(g,g),this._rotateWithMatrix(g,e,N)}rotate(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3?arguments[3]:void 0;const N=m._TmpMats[0];N.setTranslationFromFloats(0,0,0),z.Matrix.RotationAxisToRef(S,v,N),this._rotateWithMatrix(N,D,e)}setAxisAngle(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3?arguments[3]:void 0;if(0===D){const N=m._TmpQuat;return z.Quaternion.RotationAxisToRef(S,v,N),void this.setRotationQuaternion(N,D,e)}const N=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,e))return;const B=m._TmpMats[1];z.Matrix.RotationAxisToRef(S,v,B),N.multiplyToRef(B,B),this._rotateWithMatrix(B,D,e)}setRotation(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(S.y,S.x,S.z,v,D)}setRotationQuaternion(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;if(0===v)return this._decompose(),this._localRotation.N(S),void this._markAsDirtyAndCompose();const e=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(e,D))return;const N=m._TmpMats[1];z.Matrix.FromQuaternionToRef(S,N),e.multiplyToRef(N,N),this._rotateWithMatrix(N,v,D)}setRotationMatrix(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;if(0===v){const e=m._TmpQuat;return z.Quaternion.FromRotationMatrixToRef(S,e),void this.setRotationQuaternion(e,v,D)}const e=m._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(e,D))return;const N=m._TmpMats[1];N.N(S),e.multiplyToRef(S,N),this._rotateWithMatrix(N,v,D)}_rotateWithMatrix(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;const z=this.getLocalMatrix(),e=z.m[12],N=z.m[13],B=z.m[14],g=this.getParent(),E=m._TmpMats[3],h=m._TmpMats[4];g&&1==v?(D?(E.N(D.getWorldMatrix()),g.getAbsoluteMatrix().multiplyToRef(E,E)):E.N(g.getAbsoluteMatrix()),h.N(E),h.invert(),z.multiplyToRef(E,z),z.multiplyToRef(S,z),z.multiplyToRef(h,z)):1==v&&D?(E.N(D.getWorldMatrix()),h.N(E),h.invert(),z.multiplyToRef(E,z),z.multiplyToRef(S,z),z.multiplyToRef(h,z)):z.multiplyToRef(S,z),z.setTranslationFromFloats(e,N,B),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(S,v){const D=m._TmpMats[2];return S.N(this.getAbsoluteMatrix()),v?(S.multiplyToRef(v.getWorldMatrix(),S),z.Matrix.ScalingToRef(v.Me.x,v.Me.y,v.Me.z,D)):z.Matrix.IdentityToRef(D),S.invert(),!isNaN(S.m[0])&&(D.multiplyAtIndex(0,this._scalingDeterminant),S.multiplyToRef(D,S),!0)}mz(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=z.Rv.Zero();return this.getPositionToRef(S,v,D),D}getPositionToRef(){let S=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const S=this.getLocalMatrix();v.x=S.m[12],v.y=S.m[13],v.z=S.m[14]}else{let D=null;S&&(D=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let z=m._TmpMats[0];S&&D?(z.N(this.getAbsoluteMatrix()),z.multiplyToRef(D,z)):z=this.getAbsoluteMatrix(),v.x=z.m[12],v.y=z.m[13],v.z=z.m[14]}}getAbsolutePosition(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const v=z.Rv.Zero();return this.getPositionToRef(1,S,v),v}getAbsolutePositionToRef(S,v){this.getPositionToRef(1,S,v)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Qw.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.N(this.Qw);const S=this._skeleton.getPoseMatrix();S&&this._absoluteMatrix.multiplyToRef(S,this._absoluteMatrix)}const S=this.children,v=S.length;for(let D=0;D<v;D++)S[D].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Kg(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=z.Rv.Zero();return this.getDirectionToRef(S,v,D),D}getDirectionToRef(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0,e=null;v&&(e=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=m._TmpMats[0];N.N(this.getAbsoluteMatrix()),v&&e&&N.multiplyToRef(e,N),z.Rv.TransformNormalToRef(S,N,D),D.normalize()}getRotation(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=z.Rv.Zero();return this.getRotationToRef(S,v,D),D}getRotationToRef(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0;const z=m._TmpQuat;this.getRotationQuaternionToRef(S,v,z),z.toEulerAnglesToRef(D)}getRotationQuaternion(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=z.Quaternion.Identity();return this.getRotationQuaternionToRef(S,v,D),D}getRotationQuaternionToRef(){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),v.N(this._localRotation);else{const D=m._TmpMats[0],z=this.getAbsoluteMatrix();S?z.multiplyToRef(S.getWorldMatrix(),D):D.N(z),D.multiplyAtIndex(0,this._scalingDeterminant),D.multiplyAtIndex(1,this._scalingDeterminant),D.multiplyAtIndex(2,this._scalingDeterminant),D.decompose(void 0,v,void 0)}}getRotationMatrix(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1?arguments[1]:void 0;const D=z.Matrix.Identity();return this.getRotationMatrixToRef(S,v,D),D}getRotationMatrixToRef(){let S=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(v);else{const D=m._TmpMats[0],z=this.getAbsoluteMatrix();S?z.multiplyToRef(S.getWorldMatrix(),D):D.N(z),D.multiplyAtIndex(0,this._scalingDeterminant),D.multiplyAtIndex(1,this._scalingDeterminant),D.multiplyAtIndex(2,this._scalingDeterminant),D.getRotationMatrixToRef(v)}}getAbsolutePositionFromLocal(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=z.Rv.Zero();return this.getAbsolutePositionFromLocalToRef(S,v,D),D}getAbsolutePositionFromLocalToRef(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0,e=null;v&&(e=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=m._TmpMats[0];N.N(this.getAbsoluteMatrix()),v&&e&&N.multiplyToRef(e,N),z.Rv.TransformCoordinatesToRef(S,N,D)}getLocalPositionFromAbsolute(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=z.Rv.Zero();return this.getLocalPositionFromAbsoluteToRef(S,v,D),D}getLocalPositionFromAbsoluteToRef(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0,e=null;v&&(e=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=m._TmpMats[0];N.N(this.getAbsoluteMatrix()),v&&e&&N.multiplyToRef(e,N),N.invert(),z.Rv.TransformCoordinatesToRef(S,N,D)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const S=this._skeleton.bones.indexOf(this);if(-1!==S&&this._skeleton.bones.splice(S,1),this._parentNode&&this._parentNode.children){const S=this._parentNode.children,v=S.indexOf(this);-1!==v&&S.splice(v,1)}super.dispose()}}m._TmpVecs=(0,e.d)(2,z.Rv.Zero),m._TmpQuat=z.Quaternion.Identity(),m._TmpMats=(0,e.d)(5,z.Matrix.Identity)},13543:(S,v,D)=>{"use strict";D.d(v,{b:()=>a});var z=D(11358),e=D(11364),N=D(11179),m=D(11371),B=D(11393),g=D(11797),E=D(11819),h=D(11652),A=D(11199),w=D(11377);class n{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(S){this._zoomStopsAnimation=S}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(S){this._idleRotationSpeed=S}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(S){this._idleRotationWaitTime=S}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(S){this._idleRotationSpinupTime=S}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(S){this._attachedCamera=S;const v=this._attachedCamera.xS();this._onPrePointerObservableObserver=v.onPrePointerObservable.add((S=>{S.type!==h.c.POINTERDOWN?S.type===h.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=S.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const S=A.c.Now;let v=0;null!=this._lastFrameTime&&(v=S-this._lastFrameTime),this._lastFrameTime=S,this._applyUserInteraction();const D=S-this._lastInteractionTime-this._idleRotationWaitTime,z=Math.max(Math.min(D/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*z,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(v/1e3))}))}detach(){if(!this._attachedCamera)return;const S=this._attachedCamera.xS();this._onPrePointerObservableObserver&&S.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(S){this._lastInteractionTime=S??A.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<w.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let S=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(S=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?S:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=A.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var R=D(13549),O=D(11884);class I{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(S){if(this._autoTransitionRange===S)return;this._autoTransitionRange=S;const v=this._attachedCamera;v&&(S?this._onMeshTargetChangedObserver=v.onMeshTargetChangedObservable.add((S=>{if(S&&(S.ke(!0),S.getBoundingInfo)){const v=S.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*v,this.upperRadiusTransitionRange=.05*v}})):this._onMeshTargetChangedObserver&&v.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(S){this._attachedCamera=S,this._onAfterCheckInputsObserver=S.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(S){return!!this._attachedCamera&&(this._attachedCamera.radius===S&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(S){if(!this._attachedCamera)return;this._radiusBounceTransition||(I.EasingFunction.setEasingMode(I.EasingMode),this._radiusBounceTransition=O.b.CreateAnimation("radius",O.b.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const v=O.b.TransitionTo("radius",this._attachedCamera.radius+S,this._attachedCamera,this._attachedCamera.xS(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));v&&this._animatables.push(v)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}I.EasingFunction=new R.d(.3),I.EasingMode=R.p.EASINGMODE_EASEOUT;class K{constructor(){this.onTargetFramingAnimationEndObservable=new N.d,this._mode=K.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(S){this._mode=S}get mode(){return this._mode}set radiusScale(S){this._radiusScale=S}get radiusScale(){return this._radiusScale}set positionScale(S){this._positionScale=S}get positionScale(){return this._positionScale}set defaultElevation(S){this._defaultElevation=S}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(S){this._elevationReturnTime=S}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(S){this._elevationReturnWaitTime=S}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(S){this._zoomStopsAnimation=S}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(S){this._framingTime=S}get framingTime(){return this._framingTime}init(){}attach(S){this._attachedCamera=S;const v=this._attachedCamera.xS();K.EasingFunction.setEasingMode(K.EasingMode),this._onPrePointerObservableObserver=v.onPrePointerObservable.add((S=>{S.type!==h.c.POINTERDOWN?S.type===h.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=S.onMeshTargetChangedObservable.add((S=>{S&&S.getBoundingInfo&&this.zoomOnMesh(S,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=S.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const S=this._attachedCamera.xS();this._onPrePointerObservableObserver&&S.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S.ke(!0);const z=S.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(z.minimumWorld,z.maximumWorld,v,D)}zoomOnMeshHierarchy(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S.ke(!0);const z=S.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(z.min,z.max,v,D)}zoomOnMeshesHierarchy(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new m.Rv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new m.Rv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let N=0;N<S.length;N++){const v=S[N].getHierarchyBoundingVectors(!0);m.Rv.CheckExtends(v.min,z,e),m.Rv.CheckExtends(v.max,z,e)}this.zoomOnBoundingInfo(z,e,v,D)}zoomOnBoundingInfo(S,v){let D,z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const N=S.y,B=N+(v.y-N)*this._positionScale,g=v.Ov(S).scale(.5);if(!isFinite(B))return!1;if(z)D=new m.Rv(0,B,0);else{const v=S.add(g);D=new m.Rv(v.x,B,v.z)}this._vectorTransition||(this._vectorTransition=O.b.CreateAnimation("target",O.b.ANIMATIONTYPE_VECTOR3,60,K.EasingFunction)),this._betaIsAnimating=!0;let E=O.b.TransitionTo("target",D,this._attachedCamera,this._attachedCamera.xS(),60,this._vectorTransition,this._framingTime);E&&this._animatables.push(E);let h=0;if(this._mode===K.FitFrustumSidesMode){const D=this._calculateLowerRadiusFromModelBoundingSphere(S,v);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=g.length()+this._attachedCamera.xe),h=D}else this._mode===K.IgnoreBoundsSizeMode&&(h=this._calculateLowerRadiusFromModelBoundingSphere(S,v),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.xe));if(this.autoCorrectCameraLimitsAndSensibility){const D=v.Ov(S).length();this._attachedCamera.panningSensibility=5e3/D,this._attachedCamera.wheelPrecision=100/h}return this._radiusTransition||(this._radiusTransition=O.b.CreateAnimation("radius",O.b.ANIMATIONTYPE_FLOAT,60,K.EasingFunction)),E=O.b.TransitionTo("radius",h,this._attachedCamera,this._attachedCamera.xS(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),e&&e(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),E&&this._animatables.push(E),!0}_calculateLowerRadiusFromModelBoundingSphere(S,v){const D=this._attachedCamera;if(!D)return 0;let z=D._calculateLowerRadiusFromModelBoundingSphere(S,v,this._radiusScale);return D.lowerRadiusLimit&&this._mode===K.IgnoreBoundsSizeMode&&(z=z<D.lowerRadiusLimit?D.lowerRadiusLimit:z),D.upperRadiusLimit&&(z=z>D.upperRadiusLimit?D.upperRadiusLimit:z),z}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const S=A.c.Now-this._lastInteractionTime,v=.5*Math.PI-this._defaultElevation,D=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>D&&S>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=O.b.CreateAnimation("beta",O.b.ANIMATIONTYPE_FLOAT,60,K.EasingFunction));const S=O.b.TransitionTo("beta",v,this._attachedCamera,this._attachedCamera.xS(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));S&&this._animatables.push(S)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=A.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}K.EasingFunction=new R.v,K.EasingMode=R.p.EASINGMODE_EASEINOUT,K.IgnoreBoundsSizeMode=0,K.FitFrustumSidesMode=1;var q=D(11827),u=D(11852),s=D(13030),r=D(11175);class d{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(S){S=r.Tools.BackCompatCameraNoPreventDefault(arguments);const v=this.camera.getEngine(),D=v.getInputElement();let z=0,e=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=N=>{var m,B;const g=N.event,E="touch"===g.pointerType;if(N.type!==h.c.POINTERMOVE&&-1===this.buttons.indexOf(g.button))return;const A=g.target;if(this._altKey=g.altKey,this._ctrlKey=g.ctrlKey,this._metaKey=g.metaKey,this._shiftKey=g.shiftKey,this._buttonsPressed=g.buttons,v.isPointerLock){const S=g.movementX,v=g.movementY;this.onTouch(null,S,v),this._pointA=null,this._pointB=null}else{if(N.type!==h.c.POINTERDOWN&&N.type!==h.c.POINTERDOUBLETAP&&E&&(null===(m=this._pointA)||void 0===m?void 0:m.pointerId)!==g.pointerId&&(null===(B=this._pointB)||void 0===B?void 0:B.pointerId)!==g.pointerId)return;if(N.type!==h.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!E)if(N.type===h.c.POINTERDOUBLETAP)this.onDoubleTap(g.pointerType);else if(N.type!==h.c.POINTERUP||this._currentMousePointerIdDown!==g.pointerId&&!E){if(N.type===h.c.POINTERMOVE)if(S||g.preventDefault(),this._pointA&&null===this._pointB){const S=g.clientX-this._pointA.x,v=g.clientY-this._pointA.y;this._pointA.x=g.clientX,this._pointA.y=g.clientY,this.onTouch(this._pointA,S,v)}else if(this._pointA&&this._pointB){const S=this._pointA.pointerId===g.pointerId?this._pointA:this._pointB;S.x=g.clientX,S.y=g.clientY;const v=this._pointA.x-this._pointB.x,D=this._pointA.y-this._pointB.y,m=v*v+D*D,B={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:g.pointerId,type:N.type};this.onMultiTouch(this._pointA,this._pointB,z,m,e,B),e=B,z=m}}else{try{null===A||void 0===A||A.releasePointerCapture(g.pointerId)}catch(w){}E||(this._pointB=null),v._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==g.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==g.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==z||e)&&(this.onMultiTouch(this._pointA,this._pointB,z,0,e,null),z=0,e=null),this._currentMousePointerIdDown=-1,this.onButtonUp(g),S||g.preventDefault()}else{try{null===A||void 0===A||A.setPointerCapture(g.pointerId)}catch(w){}if(null===this._pointA)this._pointA={x:g.clientX,y:g.clientY,pointerId:g.pointerId,type:g.pointerType};else{if(null!==this._pointB)return;this._pointB={x:g.clientX,y:g.clientY,pointerId:g.pointerId,type:g.pointerType}}-1!==this._currentMousePointerIdDown||E||(this._currentMousePointerIdDown=g.pointerId),this.onButtonDown(g),S||(g.preventDefault(),D&&D.focus())}}},this._observer=this.camera.xS()._inputManager._addCameraPointerObserver(this._pointerInput,h.c.POINTERDOWN|h.c.POINTERUP|h.c.POINTERMOVE|h.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,z=0,e=null,this.onLostFocus()},this._contextMenuBind=S=>this.onContextMenu(S),D&&D.addEventListener("contextmenu",this._contextMenuBind,!1);const N=this.camera.xS().getEngine().getHostWindow();N&&r.Tools.RegisterTopRootEvents(N,[{name:"blur",handler:this._onLostFocus}])}gw(){if(this._onLostFocus){const S=this.camera.xS().getEngine().getHostWindow();S&&r.Tools.UnregisterTopRootEvents(S,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.xS()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const S=this.camera.xS().getEngine().getInputElement();S&&S.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(S){}onTouch(S,v,D){}onMultiTouch(S,v,D,z,e,N){}onContextMenu(S){S.preventDefault()}onButtonDown(S){}onButtonUp(S){}onLostFocus(){}}(0,z.b)([(0,e.L)()],d.prototype,"buttons",void 0);class x extends d{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(S,v){if(0!==this.panningSensibility&&S&&v){const D=v.x-S.x,z=v.y-S.y;this.camera.inertialPanningX+=-D/this.panningSensibility,this.camera.inertialPanningY+=z/this.panningSensibility}}_computePinchZoom(S,v){const D=this.camera.radius||x.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=D*Math.sqrt(S)/Math.sqrt(v):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(v-S)*D*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(v-S)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(S,v,D){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-v/this.panningSensibility,this.camera.inertialPanningY+=D/this.panningSensibility):(this.camera.inertialAlphaOffset-=v/this.angularSensibilityX,this.camera.inertialBetaOffset-=D/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(S,v,D,z,e,N){0===D&&null===e||0===z&&null===N||(this.multiTouchPanAndZoom?(this._computePinchZoom(D,z),this._computeMultiTouchPanning(e,N)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(z)-Math.sqrt(D))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(D,z),this._isPinching=!0):this._computeMultiTouchPanning(e,N)):this.multiTouchPanning?this._computeMultiTouchPanning(e,N):this.pinchZoom&&this._computePinchZoom(D,z))}onButtonDown(S){this._isPanClick=S.button===this.camera._panningMouseButton}onButtonUp(S){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}x.MinimumRadiusForPinch=.001,(0,z.b)([(0,e.L)()],x.prototype,"buttons",void 0),(0,z.b)([(0,e.L)()],x.prototype,"angularSensibilityX",void 0),(0,z.b)([(0,e.L)()],x.prototype,"angularSensibilityY",void 0),(0,z.b)([(0,e.L)()],x.prototype,"pinchPrecision",void 0),(0,z.b)([(0,e.L)()],x.prototype,"pinchDeltaPercentage",void 0),(0,z.b)([(0,e.L)()],x.prototype,"useNaturalPinchZoom",void 0),(0,z.b)([(0,e.L)()],x.prototype,"pinchZoom",void 0),(0,z.b)([(0,e.L)()],x.prototype,"panningSensibility",void 0),(0,z.b)([(0,e.L)()],x.prototype,"multiTouchPanning",void 0),(0,z.b)([(0,e.L)()],x.prototype,"multiTouchPanAndZoom",void 0),s.c.ArcRotateCameraPointersInput=x;var W=D(11659);class p{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(S){S=r.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.xS(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((v=>{const D=v.event;if(!D.metaKey)if(v.type===W.d.KEYDOWN){if(this._ctrlPressed=D.ctrlKey,this._altPressed=D.altKey,-1!==this.keysUp.indexOf(D.keyCode)||-1!==this.keysDown.indexOf(D.keyCode)||-1!==this.keysLeft.indexOf(D.keyCode)||-1!==this.keysRight.indexOf(D.keyCode)||-1!==this.keysReset.indexOf(D.keyCode)){-1===this._keys.indexOf(D.keyCode)&&this._keys.push(D.keyCode),D.preventDefault&&(S||D.preventDefault())}}else if(-1!==this.keysUp.indexOf(D.keyCode)||-1!==this.keysDown.indexOf(D.keyCode)||-1!==this.keysLeft.indexOf(D.keyCode)||-1!==this.keysRight.indexOf(D.keyCode)||-1!==this.keysReset.indexOf(D.keyCode)){const v=this._keys.indexOf(D.keyCode);v>=0&&this._keys.splice(v,1),D.preventDefault&&(S||D.preventDefault())}})))}gw(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const S=this.camera;for(let v=0;v<this._keys.length;v++){const D=this._keys[v];-1!==this.keysLeft.indexOf(D)?this._ctrlPressed&&this.camera._useCtrlForPanning?S.inertialPanningX-=1/this.panningSensibility:S.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(D)?this._ctrlPressed&&this.camera._useCtrlForPanning?S.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?S.inertialRadiusOffset+=1/this.zoomingSensibility:S.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(D)?this._ctrlPressed&&this.camera._useCtrlForPanning?S.inertialPanningX+=1/this.panningSensibility:S.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(D)?this._ctrlPressed&&this.camera._useCtrlForPanning?S.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?S.inertialRadiusOffset-=1/this.zoomingSensibility:S.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(D)&&S.useInputToRestoreState&&S.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,z.b)([(0,e.L)()],p.prototype,"keysUp",void 0),(0,z.b)([(0,e.L)()],p.prototype,"keysDown",void 0),(0,z.b)([(0,e.L)()],p.prototype,"keysLeft",void 0),(0,z.b)([(0,e.L)()],p.prototype,"keysRight",void 0),(0,z.b)([(0,e.L)()],p.prototype,"keysReset",void 0),(0,z.b)([(0,e.L)()],p.prototype,"panningSensibility",void 0),(0,z.b)([(0,e.L)()],p.prototype,"zoomingSensibility",void 0),(0,z.b)([(0,e.L)()],p.prototype,"useAltToZoom",void 0),(0,z.b)([(0,e.L)()],p.prototype,"angularSpeed",void 0),s.c.ArcRotateCameraKeyboardMoveInput=p;var b=D(11431),k=D(11663);class Z{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new m.Rv(0,0,0),this._globalOffset=new m.Rv(0,0,0),this._inertialPanning=m.Rv.Zero()}_computeDeltaFromMouseWheelLegacyEvent(S,v){let D=0;const z=.01*S*this.wheelDeltaPercentage*v;return D=S>0?z/(1+this.wheelDeltaPercentage):z*(1+this.wheelDeltaPercentage),D}attachControl(S){S=r.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=v=>{if(v.type!==h.c.POINTERWHEEL)return;const D=v.event;let z=0;const e=D.deltaMode===k.c.DOM_DELTA_LINE?40:1,N=-D.deltaY*e;if(this.customComputeDeltaFromMouseWheel)z=this.customComputeDeltaFromMouseWheel(N,this,D);else if(this.wheelDeltaPercentage){if(z=this._computeDeltaFromMouseWheelLegacyEvent(N,this.camera.radius),z>0){let S=this.camera.radius,v=this.camera.inertialRadiusOffset+z;for(let D=0;D<20&&!(S<=v)&&!(Math.abs(v*this.camera.inertia)<.001);D++)S-=v,v*=this.camera.inertia;S=(0,B.Clamp)(S,0,Number.MAX_VALUE),z=this._computeDeltaFromMouseWheelLegacyEvent(N,S)}}else z=N/(40*this.wheelPrecision);z&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(z)):this.camera.inertialRadiusOffset+=z),D.preventDefault&&(S||D.preventDefault())},this._observer=this.camera.xS()._inputManager._addCameraPointerObserver(this._wheel,h.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Je(0)}gw(){this._observer&&(this.camera.xS()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const S=this.camera;0+S.inertialAlphaOffset+S.inertialBetaOffset+S.inertialRadiusOffset&&(this._updateHitPlane(),S.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(S.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const S=this.camera,v=S.target.Ov(S.position);this._hitPlane=b.c.FromPositionAndNormal(S.target,v)}_getPosition(){const S=this.camera,v=S.xS(),D=v.createPickingRay(v.pointerX,v.pointerY,m.Matrix.Identity(),S,!1);0===S.targetScreenOffset.x&&0===S.targetScreenOffset.y||(this._viewOffset.set(S.targetScreenOffset.x,S.targetScreenOffset.y,0),S.getViewMatrix().invertToRef(S._cameraTransformMatrix),this._globalOffset=m.Rv.TransformNormal(this._viewOffset,S._cameraTransformMatrix),D.origin.addInPlace(this._globalOffset));let z=0;return this._hitPlane&&(z=D.intersectsPlane(this._hitPlane)??0),D.origin.addInPlace(D.direction.scaleInPlace(z))}_zoomToMouse(S){const v=this.camera,D=1-v.inertia;if(v.lowerRadiusLimit){const z=v.lowerRadiusLimit??0;v.radius-(v.inertialRadiusOffset+S)/D<z&&(S=(v.radius-z)*D-v.inertialRadiusOffset)}if(v.upperRadiusLimit){const z=v.upperRadiusLimit??0;v.radius-(v.inertialRadiusOffset+S)/D>z&&(S=(v.radius-z)*D-v.inertialRadiusOffset)}const z=S/D/v.radius,e=this._getPosition(),N=m.TmpVectors.Rv[6];e.subtractToRef(v.target,N),N.scaleInPlace(z),N.scaleInPlace(D),this._inertialPanning.addInPlace(N),v.inertialRadiusOffset+=S}_zeroIfClose(S){Math.abs(S.x)<w.e&&(S.x=0),Math.abs(S.y)<w.e&&(S.y=0),Math.abs(S.z)<w.e&&(S.z=0)}}(0,z.b)([(0,e.L)()],Z.prototype,"wheelPrecision",void 0),(0,z.b)([(0,e.L)()],Z.prototype,"zoomToMouseLocation",void 0),(0,z.b)([(0,e.L)()],Z.prototype,"wheelDeltaPercentage",void 0),s.c.ArcRotateCameraMouseWheelInput=Z;class i extends s.e{constructor(S){super(S)}addMouseWheel(){return this.add(new Z),this}addPointers(){return this.add(new x),this}addKeyboard(){return this.add(new p),this}}var t=D(11329);function X(S,v){return isNaN(S)?v:S}g.b.AddNodeConstructor("ArcRotateCamera",((S,v)=>()=>new a(S,0,0,1,m.Rv.Zero(),v)));class a extends u.d{get target(){return this._target}set target(S){this.setTarget(S)}get targetHost(){return this._targetHost}set targetHost(S){S&&this.setTarget(S)}getTarget(){return this.target}get position(){return this._position}set position(S){this.setPosition(S)}set upVector(S){this._upToYMatrix||(this._yToUpMatrix=new m.Matrix,this._upToYMatrix=new m.Matrix,this._upVector=m.Rv.Zero()),S.normalize(),this._upVector.N(S),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){m.Matrix.RotationAlignToRef(m.Rv.UpReadOnly,this._upVector,this._yToUpMatrix),m.Matrix.RotationAlignToRef(this._upVector,m.Rv.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const S=this.inputs.attached.pointers;return S?S.angularSensibilityX:0}set angularSensibilityX(S){const v=this.inputs.attached.pointers;v&&(v.angularSensibilityX=S)}get angularSensibilityY(){const S=this.inputs.attached.pointers;return S?S.angularSensibilityY:0}set angularSensibilityY(S){const v=this.inputs.attached.pointers;v&&(v.angularSensibilityY=S)}get pinchPrecision(){const S=this.inputs.attached.pointers;return S?S.pinchPrecision:0}set pinchPrecision(S){const v=this.inputs.attached.pointers;v&&(v.pinchPrecision=S)}get pinchDeltaPercentage(){const S=this.inputs.attached.pointers;return S?S.pinchDeltaPercentage:0}set pinchDeltaPercentage(S){const v=this.inputs.attached.pointers;v&&(v.pinchDeltaPercentage=S)}get useNaturalPinchZoom(){const S=this.inputs.attached.pointers;return!!S&&S.useNaturalPinchZoom}set useNaturalPinchZoom(S){const v=this.inputs.attached.pointers;v&&(v.useNaturalPinchZoom=S)}get panningSensibility(){const S=this.inputs.attached.pointers;return S?S.panningSensibility:0}set panningSensibility(S){const v=this.inputs.attached.pointers;v&&(v.panningSensibility=S)}get keysUp(){const S=this.inputs.attached.keyboard;return S?S.keysUp:[]}set keysUp(S){const v=this.inputs.attached.keyboard;v&&(v.keysUp=S)}get keysDown(){const S=this.inputs.attached.keyboard;return S?S.keysDown:[]}set keysDown(S){const v=this.inputs.attached.keyboard;v&&(v.keysDown=S)}get keysLeft(){const S=this.inputs.attached.keyboard;return S?S.keysLeft:[]}set keysLeft(S){const v=this.inputs.attached.keyboard;v&&(v.keysLeft=S)}get keysRight(){const S=this.inputs.attached.keyboard;return S?S.keysRight:[]}set keysRight(S){const v=this.inputs.attached.keyboard;v&&(v.keysRight=S)}get wheelPrecision(){const S=this.inputs.attached.mousewheel;return S?S.wheelPrecision:0}set wheelPrecision(S){const v=this.inputs.attached.mousewheel;v&&(v.wheelPrecision=S)}get zoomToMouseLocation(){const S=this.inputs.attached.mousewheel;return!!S&&S.zoomToMouseLocation}set zoomToMouseLocation(S){const v=this.inputs.attached.mousewheel;v&&(v.zoomToMouseLocation=S)}get wheelDeltaPercentage(){const S=this.inputs.attached.mousewheel;return S?S.wheelDeltaPercentage:0}set wheelDeltaPercentage(S){const v=this.inputs.attached.mousewheel;v&&(v.wheelDeltaPercentage=S)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(S){S!==this.useBouncingBehavior&&(S?(this._bouncingBehavior=new I,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(S){S!==this.useFramingBehavior&&(S?(this._framingBehavior=new K,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(S){S!==this.useAutoRotationBehavior&&(S?(this._autoRotationBehavior=new n,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(S,v,D,z,e,B){var g;let E=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(S,m.Rv.Zero(),B,E),g=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=m.Rv.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=m.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new m.Matrix,this.panningAxis=new m.Rv(1,1,0),this._transformedDirection=new m.Rv,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new N.d,this.checkCollisions=!1,this.collisionRadius=new m.Rv(.5,.5,.5),this._previousPosition=m.Rv.Zero(),this._collisionVelocity=m.Rv.Zero(),this._newPosition=m.Rv.Zero(),this._computationVector=m.Rv.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new m.Rv(NaN,NaN,NaN),this._goalTargetScreenOffset=new m.Vector2(NaN,NaN),this._onCollisionPositionChange=function(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;D?(g.setPosition(v),g.fn&&g.fn(D)):g._previousPosition.N(g._position);const z=Math.cos(g.alpha),e=Math.sin(g.alpha),N=Math.cos(g.beta);let m=Math.sin(g.beta);0===m&&(m=1e-4);const B=g._getTargetPosition();g._computationVector.oe(g.radius*z*m,g.radius*N,g.radius*e*m),B.addToRef(g._computationVector,g._newPosition),g._position.N(g._newPosition);let E=g.upVector;g.allowUpsideDown&&g.beta<0&&(E=E.clone(),E=E.negate()),g._computeViewMatrix(g._position,B,E),g._viewMatrix.addAtIndex(12,g.targetScreenOffset.x),g._viewMatrix.addAtIndex(13,g.targetScreenOffset.y),g._collisionTriggered=!1},this._target=m.Rv.Zero(),e&&this.setTarget(e),this.alpha=v,this.beta=D,this.radius=z,this.getViewMatrix(),this.inputs=new i(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new m.Rv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=m.Vector2.Zero()}_updateCache(S){S||super._updateCache(),this._cache._target.N(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.N(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const S=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?S.addToRef(this._targetBoundingCenter,this._target):this._target.N(S)}const S=this._getLockedTargetPosition();return S||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>w.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,N=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=N?this._currentInterpolationFactor=N:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=X(S,this._goalAlpha),this._goalBeta=X(v,this._goalBeta),this._goalRadius=X(D,this._goalRadius),this._goalTarget.set(X(z.x,this._goalTarget.x),X(z.y,this._goalTarget.y),X(z.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(X(e.x,this._goalTargetScreenOffset.x),X(e.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,B.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,B.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,B.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,B.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(S,v){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const e=arguments;v=r.Tools.BackCompatCameraNoPreventDefault(e),this._useCtrlForPanning=D,this._panningMouseButton=z,"boolean"===typeof e[0]&&(e.length>1&&(this._useCtrlForPanning=e[1]),e.length>2&&(this._panningMouseButton=e[2])),this.inputs.attachElement(v),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}gw(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let S=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){S=!0;const v=this.invertRotation?-1:1,D=this._calculateHandednessMultiplier();let z=this.inertialAlphaOffset*D;this.beta<0&&(z*=-1),this.alpha+=z*v,this.beta+=this.inertialBetaOffset*v,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<w.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<w.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*w.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){S=!0;const v=new m.Rv(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),v.multiplyInPlace(this.panningAxis),m.Rv.TransformNormalToRef(v,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const S=this.upVector,v=m.Rv.CrossToRef(this._transformedDirection,S,this._transformedDirection);m.Rv.CrossToRef(S,v,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);m.Rv.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.N(this._transformedDirection)}else{if(this.parent){const S=m.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(S),S.transposeToRef(S),m.Rv.TransformCoordinatesToRef(this._transformedDirection,S,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*w.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*w.e&&(this.inertialPanningY=0)}if(S)this.stopInterpolation();else if(this._isInterpolating){let S=!1;const v=this._scene.getEngine().getDeltaTime()/1e3,D=1-Math.pow(2,-v/this._currentInterpolationFactor),z=X(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const v=m.TmpVectors.Rv[0].set(X(this._goalTarget.x,this._target.x),X(this._goalTarget.y,this._target.y),X(this._goalTarget.z,this._target.z));m.Rv.LerpToRef(this.target,v,D,this._target),10*m.Rv.Distance(this.target,v)/z<w.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.N(v),this.setTarget(this.target,!1,!0,!0)):S=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const v=m.Quaternion.RotationAlphaBetaGammaToRef(X(this._goalAlpha,this.alpha),X(this._goalBeta,this.beta),0,m.TmpVectors.Quaternion[0]),z=m.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,m.TmpVectors.Quaternion[1]),e=m.Quaternion.SlerpToRef(z,v,D,m.TmpVectors.Quaternion[2]);e.normalize();const N=e.toAlphaBetaGammaToRef(m.TmpVectors.Rv[0]);if(this.alpha=N.x,this.beta=N.y,e.isApprox(v,w.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const S=v.toAlphaBetaGammaToRef(m.TmpVectors.Rv[0]);this.alpha=S.x,this.beta=S.y}else S=!0}if(isNaN(this._goalRadius)||(this.radius+=(z-this.radius)*D,Math.abs(z/this.radius-1)<w.e?(this._goalRadius=NaN,this.radius=z):S=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const v=m.TmpVectors.Vector2[0].set(X(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),X(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));m.Vector2.LerpToRef(this.targetScreenOffset,v,D,this.targetScreenOffset),m.Vector2.Distance(this.targetScreenOffset,v)<w.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.N(v)):S=!0}this._isInterpolating=S}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||m.Rv.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const S=this.alpha;var v,D;this.alpha=function(S){let v=Math.PI/2;return 0===S.x&&0===S.z||(v=Math.acos(S.x/Math.sqrt(Math.pow(S.x,2)+Math.pow(S.z,2)))),S.z<0&&(v=2*Math.PI-v),v}(this._computationVector),this.beta=(v=this._computationVector.y,D=this.radius,Math.acos(v/D));const z=Math.round((S-this.alpha)/(2*Math.PI));this.alpha+=2*z*Math.PI,this._checkLimits()}setPosition(S){this._position.equals(S)||(this._position.N(S),this.rebuildAnglesAndRadius())}setTarget(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(z=this.overrideCloneAlphaBetaRadius??z,S.ke)v&&S.getBoundingInfo?this._targetBoundingCenter=S.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,S.ke(),this._targetHost=S,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const v=S,z=this._getTargetPosition();if(z&&!D&&z.equals(v))return;this._targetHost=null,this._target=v,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}z||this.rebuildAnglesAndRadius()}_getViewMatrix(){const S=Math.cos(this.alpha),v=Math.sin(this.alpha),D=Math.cos(this.beta);let z=Math.sin(this.beta);0===z&&(z=1e-4),0===this.radius&&(this.radius=1e-4);const e=this._getTargetPosition();if(this._computationVector.oe(this.radius*S*z,this.radius*D,this.radius*v*z),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||m.Rv.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),e.addToRef(this._computationVector,this._newPosition),this.xS().collisionsEnabled&&this.checkCollisions){const S=this.xS().collisionCoordinator;this._collider||(this._collider=S.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,S.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.N(this._newPosition);let S=this.upVector;this.allowUpsideDown&&z<0&&(S=S.negate()),this._computeViewMatrix(this._position,e,S),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.N(e),this._viewMatrix}zoomOn(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];S=S||this.xS().meshes;const D=E.e.MinMax(S);let z=this._calculateLowerRadiusFromModelBoundingSphere(D.min,D.max);if(z=Math.max(Math.min(z,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=z*this.zoomOnFactor,this.mode===q.b.ORTHOGRAPHIC_CAMERA){const S=this.xS().getEngine().getAspectRatio(this),v=z*this.zoomOnFactor/2;this.orthoLeft=-v*S,this.orthoRight=v*S,this.orthoBottom=-v,this.orthoTop=v}this.focusOn({min:D.min,max:D.max,distance:z},v)}focusOn(S){let v,D,z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===S.min){const z=S||this.xS().meshes;v=E.e.MinMax(z),D=m.Rv.Distance(v.min,v.max)}else{v=S,D=S.distance}this._target=E.e.Center(v),z||(this.maxZ=2*D)}createRigCamera(S,v){let D=0;switch(this.cameraRigMode){case q.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case q.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case q.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case q.b.RIG_MODE_VR:D=this._cameraRigParams.stereoHalfAngle*(0===v?1:-1);break;case q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:D=this._cameraRigParams.stereoHalfAngle*(0===v?-1:1)}const z=new a(S,this.alpha+D,this.beta,this.radius,this._target,this.xS());return z._cameraRigParams={},z.isRigCamera=!0,z.rigParent=this,z.upVector=this.upVector,z.mode=this.mode,z.orthoLeft=this.orthoLeft,z.orthoRight=this.orthoRight,z.orthoBottom=this.orthoBottom,z.orthoTop=this.orthoTop,z}_updateRigCameras(){const S=this._rigCameras[0],v=this._rigCameras[1];switch(S.beta=v.beta=this.beta,this.cameraRigMode){case q.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case q.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case q.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case q.b.RIG_MODE_VR:S.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,v.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:S.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,v.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const z=m.Rv.Distance(S,v),e=this.xS().getEngine().getAspectRatio(this),N=Math.tan(this.fov/2),B=N*e,g=.5*z*D,E=g*Math.sqrt(1+1/(B*B)),h=g*Math.sqrt(1+1/(N*N));return Math.max(E,h)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,z.b)([(0,e.L)()],a.prototype,"alpha",void 0),(0,z.b)([(0,e.L)()],a.prototype,"beta",void 0),(0,z.b)([(0,e.L)()],a.prototype,"radius",void 0),(0,z.b)([(0,e.L)()],a.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,z.b)([(0,e.H)("target")],a.prototype,"_target",void 0),(0,z.b)([(0,e.y)("targetHost")],a.prototype,"_targetHost",void 0),(0,z.b)([(0,e.L)()],a.prototype,"inertialAlphaOffset",void 0),(0,z.b)([(0,e.L)()],a.prototype,"inertialBetaOffset",void 0),(0,z.b)([(0,e.L)()],a.prototype,"inertialRadiusOffset",void 0),(0,z.b)([(0,e.L)()],a.prototype,"lowerAlphaLimit",void 0),(0,z.b)([(0,e.L)()],a.prototype,"upperAlphaLimit",void 0),(0,z.b)([(0,e.L)()],a.prototype,"lowerBetaLimit",void 0),(0,z.b)([(0,e.L)()],a.prototype,"upperBetaLimit",void 0),(0,z.b)([(0,e.L)()],a.prototype,"lowerRadiusLimit",void 0),(0,z.b)([(0,e.L)()],a.prototype,"upperRadiusLimit",void 0),(0,z.b)([(0,e.L)()],a.prototype,"lowerTargetYLimit",void 0),(0,z.b)([(0,e.L)()],a.prototype,"inertialPanningX",void 0),(0,z.b)([(0,e.L)()],a.prototype,"inertialPanningY",void 0),(0,z.b)([(0,e.L)()],a.prototype,"pinchToPanMaxDistance",void 0),(0,z.b)([(0,e.L)()],a.prototype,"panningDistanceLimit",void 0),(0,z.b)([(0,e.H)()],a.prototype,"panningOriginTarget",void 0),(0,z.b)([(0,e.L)()],a.prototype,"panningInertia",void 0),(0,z.b)([(0,e.L)()],a.prototype,"zoomToMouseLocation",null),(0,z.b)([(0,e.L)()],a.prototype,"zoomOnFactor",void 0),(0,z.b)([(0,e.G)()],a.prototype,"targetScreenOffset",void 0),(0,z.b)([(0,e.L)()],a.prototype,"allowUpsideDown",void 0),(0,z.b)([(0,e.L)()],a.prototype,"useInputToRestoreState",void 0),(0,z.b)([(0,e.L)()],a.prototype,"restoreStateInterpolationFactor",void 0),(0,t.f)("BABYLON.ArcRotateCamera",a)},13030:(S,v,D)=>{"use strict";D.d(v,{c:()=>m,e:()=>B});var z=D(11190),e=D(11415),N=D(11827),m={};class B{constructor(S){this.attachedToElement=!1,this.attached={},this.camera=S,this.checkInputs=()=>{}}add(S){const v=S.getSimpleName();this.attached[v]?z.b.Warn("camera input of type "+v+" already exists on camera"):(this.attached[v]=S,S.camera=this.camera,S.checkInputs&&(this.checkInputs=this._addCheckInputs(S.checkInputs.bind(S))),this.attachedToElement&&S.attachControl(this.noPreventDefault))}remove(S){for(const v in this.attached){const D=this.attached[v];if(D===S)return D.gw(),D.camera=null,delete this.attached[v],void this.rebuildInputCheck()}}removeByType(S){for(const v in this.attached){const D=this.attached[v];D.getClassName()===S&&(D.gw(),D.camera=null,delete this.attached[v],this.rebuildInputCheck())}}_addCheckInputs(S){const v=this.checkInputs;return()=>{v(),S()}}attachInput(S){this.attachedToElement&&S.attachControl(this.noPreventDefault)}attachElement(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){S=!N.b.ForceAttachControlToAlwaysPreventDefault&&S,this.attachedToElement=!0,this.noPreventDefault=S;for(const v in this.attached)this.attached[v].attachControl(S)}}detachElement(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const v in this.attached)this.attached[v].gw(),S&&(this.attached[v].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const S in this.attached){const v=this.attached[S];v.checkInputs&&(this.checkInputs=this._addCheckInputs(v.checkInputs.bind(v)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(S){const v={};for(const D in this.attached){const S=this.attached[D],z=e.b.Serialize(S);v[S.getClassName()]=z}S.inputsmgr=v}parse(S){const v=S.inputsmgr;if(v){this.clear();for(const S in v){const D=m[S];if(D){const z=v[S],N=e.b.Parse((()=>new D),z,null);this.add(N)}}}else for(const D in this.attached){const v=m[this.attached[D].getClassName()];if(v){const z=e.b.Parse((()=>new v),S,null);this.remove(this.attached[D]),this.add(z)}}}}},13026:(S,v,D)=>{"use strict";D.d(v,{c:()=>d});var z=D(11358),e=D(11364),N=D(11371),m=D(11852),B=D(13030),g=D(11659),E=D(11175);class h{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(S){S=E.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.xS(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((v=>{const D=v.event;if(!D.metaKey)if(v.type===g.d.KEYDOWN){if(-1!==this.keysUp.indexOf(D.keyCode)||-1!==this.keysDown.indexOf(D.keyCode)||-1!==this.keysLeft.indexOf(D.keyCode)||-1!==this.keysRight.indexOf(D.keyCode)||-1!==this.keysUpward.indexOf(D.keyCode)||-1!==this.keysDownward.indexOf(D.keyCode)||-1!==this.keysRotateLeft.indexOf(D.keyCode)||-1!==this.keysRotateRight.indexOf(D.keyCode)||-1!==this.keysRotateUp.indexOf(D.keyCode)||-1!==this.keysRotateDown.indexOf(D.keyCode)){-1===this._keys.indexOf(D.keyCode)&&this._keys.push(D.keyCode),S||D.preventDefault()}}else if(-1!==this.keysUp.indexOf(D.keyCode)||-1!==this.keysDown.indexOf(D.keyCode)||-1!==this.keysLeft.indexOf(D.keyCode)||-1!==this.keysRight.indexOf(D.keyCode)||-1!==this.keysUpward.indexOf(D.keyCode)||-1!==this.keysDownward.indexOf(D.keyCode)||-1!==this.keysRotateLeft.indexOf(D.keyCode)||-1!==this.keysRotateRight.indexOf(D.keyCode)||-1!==this.keysRotateUp.indexOf(D.keyCode)||-1!==this.keysRotateDown.indexOf(D.keyCode)){const v=this._keys.indexOf(D.keyCode);v>=0&&this._keys.splice(v,1),S||D.preventDefault()}})))}gw(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const S=this.camera;for(let v=0;v<this._keys.length;v++){const D=this._keys[v],z=S._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(D)?S._localDirection.oe(-z,0,0):-1!==this.keysUp.indexOf(D)?S._localDirection.oe(0,0,z):-1!==this.keysRight.indexOf(D)?S._localDirection.oe(z,0,0):-1!==this.keysDown.indexOf(D)?S._localDirection.oe(0,0,-z):-1!==this.keysUpward.indexOf(D)?S._localDirection.oe(0,z,0):-1!==this.keysDownward.indexOf(D)?S._localDirection.oe(0,-z,0):-1!==this.keysRotateLeft.indexOf(D)?(S._localDirection.oe(0,0,0),S.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(D)?(S._localDirection.oe(0,0,0),S.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(D)?(S._localDirection.oe(0,0,0),S.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(D)&&(S._localDirection.oe(0,0,0),S.cameraRotation.x+=this._getLocalRotation()),S.xS().useRightHandedSystem&&(S._localDirection.z*=-1),S.getViewMatrix().invertToRef(S._cameraTransformMatrix),N.Rv.TransformNormalToRef(S._localDirection,S._cameraTransformMatrix,S._transformedDirection),S.cameraDirection.addInPlace(S._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const S=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*S}}(0,z.b)([(0,e.L)()],h.prototype,"keysUp",void 0),(0,z.b)([(0,e.L)()],h.prototype,"keysUpward",void 0),(0,z.b)([(0,e.L)()],h.prototype,"keysDown",void 0),(0,z.b)([(0,e.L)()],h.prototype,"keysDownward",void 0),(0,z.b)([(0,e.L)()],h.prototype,"keysLeft",void 0),(0,z.b)([(0,e.L)()],h.prototype,"keysRight",void 0),(0,z.b)([(0,e.L)()],h.prototype,"rotationSpeed",void 0),(0,z.b)([(0,e.L)()],h.prototype,"keysRotateLeft",void 0),(0,z.b)([(0,e.L)()],h.prototype,"keysRotateRight",void 0),(0,z.b)([(0,e.L)()],h.prototype,"keysRotateUp",void 0),(0,z.b)([(0,e.L)()],h.prototype,"keysRotateDown",void 0),B.c.FreeCameraKeyboardMoveInput=h;var A=D(11179),w=D(11652);class n{constructor(){let S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=S,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new A.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(S){S=E.Tools.BackCompatCameraNoPreventDefault(arguments);const v=this.camera.getEngine(),D=v.getInputElement();this._pointerInput||(this._pointerInput=z=>{const e=z.event,N="touch"===e.pointerType;if(!this.touchEnabled&&N)return;if(z.type!==w.c.POINTERMOVE&&-1===this.buttons.indexOf(e.button))return;const m=e.target;if(z.type===w.c.POINTERDOWN){if(N&&-1!==this._activePointerId||!N&&-1!==this._currentActiveButton)return;this._activePointerId=e.pointerId;try{null===m||void 0===m||m.setPointerCapture(e.pointerId)}catch(B){}-1===this._currentActiveButton&&(this._currentActiveButton=e.button),this._previousPosition={x:e.clientX,y:e.clientY},S||(e.preventDefault(),D&&D.focus()),v.isPointerLock&&this._onMouseMove&&this._onMouseMove(z.event)}else if(z.type===w.c.POINTERUP){if(N&&this._activePointerId!==e.pointerId||!N&&this._currentActiveButton!==e.button)return;try{null===m||void 0===m||m.releasePointerCapture(e.pointerId)}catch(B){}this._currentActiveButton=-1,this._previousPosition=null,S||e.preventDefault(),this._activePointerId=-1}else if(z.type===w.c.POINTERMOVE&&(this._activePointerId===e.pointerId||!N))if(v.isPointerLock&&this._onMouseMove)this._onMouseMove(z.event);else if(this._previousPosition){const v=this.camera._calculateHandednessMultiplier(),D=(e.clientX-this._previousPosition.x)*v,z=e.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=D/this.angularSensibility,this.camera.cameraRotation.x+=z/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:D,offsetY:z}),this._previousPosition={x:e.clientX,y:e.clientY},S||e.preventDefault()}}),this._onMouseMove=D=>{if(!v.isPointerLock)return;const z=this.camera._calculateHandednessMultiplier(),e=D.movementX*z;this.camera.cameraRotation.y+=e/this.angularSensibility;const N=D.movementY;this.camera.cameraRotation.x+=N/this.angularSensibility,this._previousPosition=null,S||D.preventDefault()},this._observer=this.camera.xS()._inputManager._addCameraPointerObserver(this._pointerInput,w.c.POINTERDOWN|w.c.POINTERUP|w.c.POINTERMOVE),D&&(this._contextMenuBind=S=>this.onContextMenu(S),D.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(S){S.preventDefault()}gw(){if(this._observer){if(this.camera.xS()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const S=this.camera.getEngine().getInputElement();S&&S.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,z.b)([(0,e.L)()],n.prototype,"buttons",void 0),(0,z.b)([(0,e.L)()],n.prototype,"angularSensibility",void 0),B.c.FreeCameraMouseInput=n;var R,O=D(11663);class I{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new A.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(S){S=E.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=v=>{if(v.type!==w.c.POINTERWHEEL)return;const D=v.event,z=D.deltaMode===O.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*z*D.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*z*D.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*z*D.deltaZ/this._normalize,D.preventDefault&&(S||D.preventDefault())},this._observer=this.camera.xS()._inputManager._addCameraPointerObserver(this._wheel,w.c.POINTERWHEEL)}gw(){this._observer&&(this.camera.xS()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,z.b)([(0,e.L)()],I.prototype,"wheelPrecisionX",void 0),(0,z.b)([(0,e.L)()],I.prototype,"wheelPrecisionY",void 0),(0,z.b)([(0,e.L)()],I.prototype,"wheelPrecisionZ",void 0),function(S){S[S.MoveRelative=0]="MoveRelative",S[S.RotateRelative=1]="RotateRelative",S[S.MoveScene=2]="MoveScene"}(R||(R={}));class K extends I{constructor(){super(...arguments),this._moveRelative=N.Rv.Zero(),this._rotateRelative=N.Rv.Zero(),this._moveScene=N.Rv.Zero(),this._wheelXAction=R.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=R.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(S){null===S&&this._wheelXAction!==R.MoveRelative||(this._wheelXAction=R.MoveRelative,this._wheelXActionCoordinate=S)}get wheelXMoveRelative(){return this._wheelXAction!==R.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(S){null===S&&this._wheelYAction!==R.MoveRelative||(this._wheelYAction=R.MoveRelative,this._wheelYActionCoordinate=S)}get wheelYMoveRelative(){return this._wheelYAction!==R.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(S){null===S&&this._wheelZAction!==R.MoveRelative||(this._wheelZAction=R.MoveRelative,this._wheelZActionCoordinate=S)}get wheelZMoveRelative(){return this._wheelZAction!==R.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(S){null===S&&this._wheelXAction!==R.RotateRelative||(this._wheelXAction=R.RotateRelative,this._wheelXActionCoordinate=S)}get wheelXRotateRelative(){return this._wheelXAction!==R.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(S){null===S&&this._wheelYAction!==R.RotateRelative||(this._wheelYAction=R.RotateRelative,this._wheelYActionCoordinate=S)}get wheelYRotateRelative(){return this._wheelYAction!==R.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(S){null===S&&this._wheelZAction!==R.RotateRelative||(this._wheelZAction=R.RotateRelative,this._wheelZActionCoordinate=S)}get wheelZRotateRelative(){return this._wheelZAction!==R.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(S){null===S&&this._wheelXAction!==R.MoveScene||(this._wheelXAction=R.MoveScene,this._wheelXActionCoordinate=S)}get wheelXMoveScene(){return this._wheelXAction!==R.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(S){null===S&&this._wheelYAction!==R.MoveScene||(this._wheelYAction=R.MoveScene,this._wheelYActionCoordinate=S)}get wheelYMoveScene(){return this._wheelYAction!==R.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(S){null===S&&this._wheelZAction!==R.MoveScene||(this._wheelZAction=R.MoveScene,this._wheelZActionCoordinate=S)}get wheelZMoveScene(){return this._wheelZAction!==R.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Je(0),this._rotateRelative.Je(0),this._moveScene.Je(0),this._updateCamera(),this.camera.xS().useRightHandedSystem&&(this._moveRelative.z*=-1);const S=N.Matrix.Zero();this.camera.getViewMatrix().invertToRef(S);const v=N.Rv.Zero();N.Rv.TransformNormalToRef(this._moveRelative,S,v),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(v),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(S,v,D){if(0===S)return;if(null===v||null===D)return;let z=null;switch(v){case R.MoveRelative:z=this._moveRelative;break;case R.RotateRelative:z=this._rotateRelative;break;case R.MoveScene:z=this._moveScene}switch(D){case 0:z.set(S,0,0);break;case 1:z.set(0,S,0);break;case 2:z.set(0,0,S)}}}(0,z.b)([(0,e.L)()],K.prototype,"wheelXMoveRelative",null),(0,z.b)([(0,e.L)()],K.prototype,"wheelYMoveRelative",null),(0,z.b)([(0,e.L)()],K.prototype,"wheelZMoveRelative",null),(0,z.b)([(0,e.L)()],K.prototype,"wheelXRotateRelative",null),(0,z.b)([(0,e.L)()],K.prototype,"wheelYRotateRelative",null),(0,z.b)([(0,e.L)()],K.prototype,"wheelZRotateRelative",null),(0,z.b)([(0,e.L)()],K.prototype,"wheelXMoveScene",null),(0,z.b)([(0,e.L)()],K.prototype,"wheelYMoveScene",null),(0,z.b)([(0,e.L)()],K.prototype,"wheelZMoveScene",null),B.c.FreeCameraMouseWheelInput=K;class q{constructor(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=S,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=E.Tools.IsSafari()}attachControl(S){S=E.Tools.BackCompatCameraNoPreventDefault(arguments);let v=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=D=>{const z=D.event,e="mouse"===z.pointerType||this._isSafari&&"undefined"===typeof z.pointerType;if(this.allowMouse||!e)if(D.type===w.c.POINTERDOWN){if(S||z.preventDefault(),this._pointerPressed.push(z.pointerId),1!==this._pointerPressed.length)return;v={x:z.clientX,y:z.clientY}}else if(D.type===w.c.POINTERUP){S||z.preventDefault();const D=this._pointerPressed.indexOf(z.pointerId);if(-1===D)return;if(this._pointerPressed.splice(D,1),0!=D)return;v=null,this._offsetX=null,this._offsetY=null}else if(D.type===w.c.POINTERMOVE){if(S||z.preventDefault(),!v)return;if(0!=this._pointerPressed.indexOf(z.pointerId))return;this._offsetX=z.clientX-v.x,this._offsetY=-(z.clientY-v.y)}}),this._observer=this.camera.xS()._inputManager._addCameraPointerObserver(this._pointerInput,w.c.POINTERDOWN|w.c.POINTERUP|w.c.POINTERMOVE),this._onLostFocus){const S=this.camera.getEngine().getInputElement();S&&S.addEventListener("blur",this._onLostFocus)}}gw(){if(this._pointerInput){if(this._observer&&(this.camera.xS()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const S=this.camera.getEngine().getInputElement();S&&S.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const S=this.camera,v=S._calculateHandednessMultiplier();S.cameraRotation.y=v*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)S.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const v=S._computeLocalCameraSpeed(),D=new N.Rv(0,0,0!==this.touchMoveSensibility?v*this._offsetY/this.touchMoveSensibility:0);N.Matrix.RotationYawPitchRollToRef(S.rotation.y,S.rotation.x,0,S._cameraRotationMatrix),S.cameraDirection.addInPlace(N.Rv.TransformCoordinates(D,S._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,z.b)([(0,e.L)()],q.prototype,"touchAngularSensibility",void 0),(0,z.b)([(0,e.L)()],q.prototype,"touchMoveSensibility",void 0),B.c.FreeCameraTouchInput=q;class u extends B.e{constructor(S){super(S),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new h),this}addMouse(){let S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new n(S),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new K,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new q),this}clear(){super.clear(),this._mouseInput=null}}var s=D(11329),r=D(11269);class d extends m.d{get angularSensibility(){const S=this.inputs.attached.mouse;return S?S.angularSensibility:0}set angularSensibility(S){const v=this.inputs.attached.mouse;v&&(v.angularSensibility=S)}get keysUp(){const S=this.inputs.attached.keyboard;return S?S.keysUp:[]}set keysUp(S){const v=this.inputs.attached.keyboard;v&&(v.keysUp=S)}get keysUpward(){const S=this.inputs.attached.keyboard;return S?S.keysUpward:[]}set keysUpward(S){const v=this.inputs.attached.keyboard;v&&(v.keysUpward=S)}get keysDown(){const S=this.inputs.attached.keyboard;return S?S.keysDown:[]}set keysDown(S){const v=this.inputs.attached.keyboard;v&&(v.keysDown=S)}get keysDownward(){const S=this.inputs.attached.keyboard;return S?S.keysDownward:[]}set keysDownward(S){const v=this.inputs.attached.keyboard;v&&(v.keysDownward=S)}get keysLeft(){const S=this.inputs.attached.keyboard;return S?S.keysLeft:[]}set keysLeft(S){const v=this.inputs.attached.keyboard;v&&(v.keysLeft=S)}get keysRight(){const S=this.inputs.attached.keyboard;return S?S.keysRight:[]}set keysRight(S){const v=this.inputs.attached.keyboard;v&&(v.keysRight=S)}get keysRotateLeft(){const S=this.inputs.attached.keyboard;return S?S.keysRotateLeft:[]}set keysRotateLeft(S){const v=this.inputs.attached.keyboard;v&&(v.keysRotateLeft=S)}get keysRotateRight(){const S=this.inputs.attached.keyboard;return S?S.keysRotateRight:[]}set keysRotateRight(S){const v=this.inputs.attached.keyboard;v&&(v.keysRotateRight=S)}get keysRotateUp(){const S=this.inputs.attached.keyboard;return S?S.keysRotateUp:[]}set keysRotateUp(S){const v=this.inputs.attached.keyboard;v&&(v.keysRotateUp=S)}get keysRotateDown(){const S=this.inputs.attached.keyboard;return S?S.keysRotateDown:[]}set keysRotateDown(S){const v=this.inputs.attached.keyboard;v&&(v.keysRotateDown=S)}constructor(S,v,D){var z;super(S,v,D,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),z=this,this.ellipsoid=new N.Rv(.5,1,.5),this.ellipsoidOffset=new N.Rv(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=N.Rv.Zero(),this._diffPosition=N.Rv.Zero(),this._newPosition=N.Rv.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z._newPosition.N(v),z._newPosition.subtractToRef(z._oldPosition,z._diffPosition),z._diffPosition.length()>r.d.CollisionsEpsilon&&(z.position.addToRef(z._diffPosition,z._deferredPositionUpdate),z._deferOnly?z._deferredUpdated=!0:z.position.N(z._deferredPositionUpdate),z.fn&&D&&z.fn(D))},this.inputs=new u(this),this.inputs.addKeyboard().addMouse()}attachControl(S,v){v=E.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(v)}gw(){this.inputs.detachElement(),this.cameraDirection=new N.Rv(0,0,0),this.cameraRotation=new N.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(S){this._collisionMask=isNaN(S)?-1:S}_collideWithWorld(S){let v;v=this.parent?N.Rv.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,v.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const D=this.xS().collisionCoordinator;this._collider||(this._collider=D.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let z=S;this.applyGravity&&(z=S.add(this.xS().gravity)),D.getNewPosition(this._oldPosition,z,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=N.Rv.Zero(),this._transformedDirection=N.Rv.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(S){this._needMoveForGravity=S}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.xS().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ng"}}(0,z.b)([(0,e.H)()],d.prototype,"ellipsoid",void 0),(0,z.b)([(0,e.H)()],d.prototype,"ellipsoidOffset",void 0),(0,z.b)([(0,e.L)()],d.prototype,"checkCollisions",void 0),(0,z.b)([(0,e.L)()],d.prototype,"applyGravity",void 0),(0,s.f)("BABYLON.FreeCamera",d)},13612:(S,v,D)=>{"use strict";D.d(v,{d:()=>N});var z=D(11483),e=D(13621);class N{constructor(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=D,this.bA=[],this._maxBlockCapacity=v||64,this._selectionContent=new z.e(1024),this._creationFunc=S}update(S,v,D){e.e._CreateBlocks(S,v,D,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Kh(S){for(let v=0;v<this.jh.length;v++){this.jh[v].addEntry(S)}}Ih(S){for(let v=0;v<this.jh.length;v++){this.jh[v].removeEntry(S)}}select(S,v){this._selectionContent.reset();for(let D=0;D<this.jh.length;D++){this.jh[D].select(S,this._selectionContent,v)}return v?this._selectionContent.concat(this.bA):this._selectionContent.concatWithNoDuplicate(this.bA),this._selectionContent}intersects(S,v,D){this._selectionContent.reset();for(let z=0;z<this.jh.length;z++){this.jh[z].intersects(S,v,this._selectionContent,D)}return D?this._selectionContent.concat(this.bA):this._selectionContent.concatWithNoDuplicate(this.bA),this._selectionContent}intersectsRay(S){this._selectionContent.reset();for(let v=0;v<this.jh.length;v++){this.jh[v].intersectsRay(S,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.bA),this._selectionContent}}N.CreationFuncForMeshes=(S,v)=>{const D=S.getBoundingInfo();!S.isBlocked&&D.boundingBox.intersectsMinMax(v.XA,v.aA)&&v.entries.push(S)},N.CreationFuncForSubMeshes=(S,v)=>{S.getBoundingInfo().boundingBox.intersectsMinMax(v.XA,v.aA)&&v.entries.push(S)}},13621:(S,v,D)=>{"use strict";D.d(v,{e:()=>N});var z=D(11371),e=D(11718);class N{constructor(S,v,D,z,e,N){this.entries=[],this.oA=new Array,this._capacity=D,this._depth=z,this._maxDepth=e,this._creationFunc=N,this._minPoint=S,this._maxPoint=v,this.oA.push(S.clone()),this.oA.push(v.clone()),this.oA.push(S.clone()),this.oA[2].x=v.x,this.oA.push(S.clone()),this.oA[3].y=v.y,this.oA.push(S.clone()),this.oA[4].z=v.z,this.oA.push(v.clone()),this.oA[5].z=S.z,this.oA.push(v.clone()),this.oA[6].x=S.x,this.oA.push(v.clone()),this.oA[7].y=S.y}get Jv(){return this._capacity}get XA(){return this._minPoint}get aA(){return this._maxPoint}addEntry(S){if(this.jh)for(let v=0;v<this.jh.length;v++){this.jh[v].addEntry(S)}else this._creationFunc(S,this),this.entries.length>this.Jv&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(S){if(this.jh){for(let v=0;v<this.jh.length;v++){this.jh[v].removeEntry(S)}return}const v=this.entries.indexOf(S);v>-1&&this.entries.splice(v,1)}addEntries(S){for(let v=0;v<S.length;v++){const D=S[v];this.addEntry(D)}}select(S,v,D){if(e.c.IsInFrustum(this.oA,S)){if(this.jh){for(let z=0;z<this.jh.length;z++){this.jh[z].select(S,v,D)}return}D?v.concat(this.entries):v.concatWithNoDuplicate(this.entries)}}intersects(S,v,D,z){if(e.c.IntersectsSphere(this._minPoint,this._maxPoint,S,v)){if(this.jh){for(let e=0;e<this.jh.length;e++){this.jh[e].intersects(S,v,D,z)}return}z?D.concat(this.entries):D.concatWithNoDuplicate(this.entries)}}intersectsRay(S,v){if(S.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.jh){for(let D=0;D<this.jh.length;D++){this.jh[D].intersectsRay(S,v)}return}v.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){N._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(S,v,D,e,m,B,g,E){g.jh=new Array;const h=new z.Rv((v.x-S.x)/2,(v.y-S.y)/2,(v.z-S.z)/2);for(let z=0;z<2;z++)for(let v=0;v<2;v++)for(let A=0;A<2;A++){const w=S.add(h.multiplyByFloats(z,v,A)),n=S.add(h.multiplyByFloats(z+1,v+1,A+1)),R=new N(w,n,e,m+1,B,E);R.addEntries(D),g.jh.push(R)}}}},13623:(S,v,D)=>{"use strict";D.d(v,{d:()=>h});var z=D(11619),e=D(11371),N=D(11802),m=D(12793),B=D(11645),g=D(13612),E=D(11222);z.d.prototype.createOrUpdateSelectionOctree=function(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,D=this._getComponent(B.e.NAME_OCTREE);D||(D=new h(this),this.o(D)),this.WA||(this.WA=new g.d(g.d.CreationFuncForMeshes,S,v));const z=this.getWorldExtends();return this.WA.update(z.min,z.max,this.meshes),this.WA},Object.defineProperty(z.d.prototype,"selectionOctree",{get:function(){return this.WA},enumerable:!0,configurable:!0}),N.e.prototype.createOrUpdateSubmeshesOctree=function(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const D=this.xS();let z=D._getComponent(B.e.NAME_OCTREE);z||(z=new h(D),D.o(z)),this._submeshesOctree||(this._submeshesOctree=new g.d(g.d.CreationFuncForSubMeshes,S,v)),this.ke(!0);const e=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(e.minimumWorld,e.maximumWorld,this.he),this._submeshesOctree};class h{constructor(S){this.name=B.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new m.e(e.Rv.Zero(),new e.Rv(1,1,1)),(S=S||E.c.LastCreatedScene)&&(this.Iv=S,this.Iv.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Iv.getActiveSubMeshCandidates=S=>this.getActiveSubMeshCandidates(S),this.Iv.getCollidingSubMeshCandidates=(S,v)=>this.getCollidingSubMeshCandidates(S,v),this.Iv.getIntersectingSubMeshCandidates=(S,v)=>this.getIntersectingSubMeshCandidates(S,v))}register(){this.Iv.onMeshRemovedObservable.add((S=>{const v=this.Iv.selectionOctree;if(void 0!==v&&null!==v){const D=v.bA.indexOf(S);-1!==D&&v.bA.splice(D,1)}})),this.Iv.onMeshImportedObservable.add((S=>{const v=this.Iv.selectionOctree;void 0!==v&&null!==v&&v.Kh(S)}))}getActiveMeshCandidates(){var S;return(null===(S=this.Iv.WA)||void 0===S?void 0:S.select(this.Iv.frustumPlanes))||this.Iv._getDefaultMeshCandidates()}getActiveSubMeshCandidates(S){if(S._submeshesOctree&&S.useOctreeForRenderingSelection){return S._submeshesOctree.select(this.Iv.frustumPlanes)}return this.Iv._getDefaultSubMeshCandidates(S)}getIntersectingSubMeshCandidates(S,v){if(S._submeshesOctree&&S.useOctreeForPicking){m.e.TransformToRef(v,S.getWorldMatrix(),this._tempRay);return S._submeshesOctree.intersectsRay(this._tempRay)}return this.Iv._getDefaultSubMeshCandidates(S)}getCollidingSubMeshCandidates(S,v){if(S._submeshesOctree&&S.useOctreeForCollisions){const D=v._velocityWorldLength+Math.max(v._radius.x,v._radius.y,v._radius.z);return S._submeshesOctree.intersects(v._basePointWorld,D)}return this.Iv._getDefaultSubMeshCandidates(S)}rebuild(){}dispose(){}}},12793:(S,v,D)=>{"use strict";D.d(v,{e:()=>n});var z=D(11619),e=D(11827),N=D(11377),m=D(11371),B=D(11386),g=D(11710),E=D(11642),h=D(11222),A=D(11669);const w={internalPickerForMesh:void 0};class n{constructor(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.e;this.origin=S,this.direction=v,this.length=D,this.epsilon=z}clone(){return new n(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const z=n._TmpVector3[0].oe(S.x-D,S.y-D,S.z-D),e=n._TmpVector3[1].oe(v.x+D,v.y+D,v.z+D);let N,m,B,g,E=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<z.x||this.origin.x>e.x)return!1}else if(N=1/this.direction.x,m=(z.x-this.origin.x)*N,B=(e.x-this.origin.x)*N,B===-1/0&&(B=1/0),m>B&&(g=m,m=B,B=g),E=Math.max(m,E),h=Math.min(B,h),E>h)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<z.y||this.origin.y>e.y)return!1}else if(N=1/this.direction.y,m=(z.y-this.origin.y)*N,B=(e.y-this.origin.y)*N,B===-1/0&&(B=1/0),m>B&&(g=m,m=B,B=g),E=Math.max(m,E),h=Math.min(B,h),E>h)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<z.z||this.origin.z>e.z)return!1}else if(N=1/this.direction.z,m=(z.z-this.origin.z)*N,B=(e.z-this.origin.z)*N,B===-1/0&&(B=1/0),m>B&&(g=m,m=B,B=g),E=Math.max(m,E),h=Math.min(B,h),E>h)return!1;return!0}intersectsBox(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(S.minimum,S.maximum,v)}intersectsSphere(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const D=S.center.x-this.origin.x,z=S.center.y-this.origin.y,e=S.center.z-this.origin.z,N=D*D+z*z+e*e,m=S.radius+v,B=m*m;if(N<=B)return!0;const g=D*this.direction.x+z*this.direction.y+e*this.direction.z;if(g<0)return!1;return N-g*g<=B}intersectsTriangle(S,v,D){const z=n._TmpVector3[0],e=n._TmpVector3[1],N=n._TmpVector3[2],B=n._TmpVector3[3],E=n._TmpVector3[4];v.subtractToRef(S,z),D.subtractToRef(S,e),m.Rv.CrossToRef(this.direction,e,N);const h=m.Rv.Dot(z,N);if(0===h)return null;const A=1/h;this.origin.subtractToRef(S,B);const w=m.Rv.Dot(B,N)*A;if(w<-this.epsilon||w>1+this.epsilon)return null;m.Rv.CrossToRef(B,z,E);const R=m.Rv.Dot(this.direction,E)*A;if(R<-this.epsilon||w+R>1+this.epsilon)return null;const O=m.Rv.Dot(e,E)*A;return O>this.length?null:new g.b(1-w-R,w,O)}intersectsPlane(S){let v;const D=m.Rv.Dot(S.normal,this.direction);if(Math.abs(D)<9.99999997475243e-7)return null;{const z=m.Rv.Dot(S.normal,this.origin);return v=(-S.d-z)/D,v<0?v<-9.99999997475243e-7?null:0:v}}intersectsAxis(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(S){case"y":{const S=(this.origin.y-v)/this.direction.y;return S>0?null:new m.Rv(this.origin.x+this.direction.x*-S,v,this.origin.z+this.direction.z*-S)}case"x":{const S=(this.origin.x-v)/this.direction.x;return S>0?null:new m.Rv(v,this.origin.y+this.direction.y*-S,this.origin.z+this.direction.z*-S)}case"z":{const S=(this.origin.z-v)/this.direction.z;return S>0?null:new m.Rv(this.origin.x+this.direction.x*-S,this.origin.y+this.direction.y*-S,v)}default:return null}}intersectsMesh(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],e=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=m.TmpVectors.Matrix[0];return S.getWorldMatrix().invertToRef(B),this._tmpRay?n.TransformToRef(this,B,this._tmpRay):this._tmpRay=n.Transform(this,B),S.intersects(this._tmpRay,v,D,z,e,N)}intersectsMeshes(S,v,D){D?D.length=0:D=[];for(let z=0;z<S.length;z++){const e=this.intersectsMesh(S[z],v);e.hit&&D.push(e)}return D.sort(this._comparePickingInfo),D}_comparePickingInfo(S,v){return S.distance<v.distance?-1:S.distance>v.distance?1:0}intersectionSegment(S,v,D){const z=this.origin,e=m.TmpVectors.Rv[0],N=m.TmpVectors.Rv[1],B=m.TmpVectors.Rv[2],g=m.TmpVectors.Rv[3];v.subtractToRef(S,e),this.direction.scaleToRef(n._Rayl,B),z.addToRef(B,N),S.subtractToRef(z,g);const E=m.Rv.Dot(e,e),h=m.Rv.Dot(e,B),A=m.Rv.Dot(B,B),w=m.Rv.Dot(e,g),R=m.Rv.Dot(B,g),O=E*A-h*h;let I,K,q=O,u=O;O<n._Smallnum?(I=0,q=1,K=R,u=A):(I=h*R-A*w,K=E*R-h*w,I<0?(I=0,K=R,u=A):I>q&&(I=q,K=R+h,u=A)),K<0?(K=0,-w<0?I=0:-w>E?I=q:(I=-w,q=E)):K>u&&(K=u,-w+h<0?I=0:-w+h>E?I=q:(I=-w+h,q=E));const s=Math.abs(I)<n._Smallnum?0:I/q,r=Math.abs(K)<n._Smallnum?0:K/u,d=m.TmpVectors.Rv[4];B.scaleToRef(r,d);const x=m.TmpVectors.Rv[5];e.scaleToRef(s,x),x.addInPlace(g);const W=m.TmpVectors.Rv[6];x.subtractToRef(d,W);return r>0&&r<=this.length&&W.lengthSquared()<D*D?x.length():-1}update(S,v,D,z,e,N,B){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){n._RayDistant||(n._RayDistant=n.Zero()),n._RayDistant.unprojectRayToRef(S,v,D,z,m.Matrix.IdentityReadOnly,N,B);const g=m.TmpVectors.Matrix[0];e.invertToRef(g),n.TransformToRef(n._RayDistant,g,this)}else this.unprojectRayToRef(S,v,D,z,e,N,B);return this}static Zero(){return new n(m.Rv.Zero(),m.Rv.Zero())}static CreateNew(S,v,D,z,e,N,m){return n.Zero().update(S,v,D,z,e,N,m)}static CreateNewFromTo(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.Matrix.IdentityReadOnly;const z=new n(new m.Rv(0,0,0),new m.Rv(0,0,0));return n.CreateFromToToRef(S,v,z,D)}static CreateFromToToRef(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.Matrix.IdentityReadOnly;D.origin.N(S);const e=v.subtractToRef(S,D.direction),N=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return D.length=N,D.direction.normalize(),n.TransformToRef(D,z,D)}static Transform(S,v){const D=new n(new m.Rv(0,0,0),new m.Rv(0,0,0));return n.TransformToRef(S,v,D),D}static TransformToRef(S,v,D){m.Rv.TransformCoordinatesToRef(S.origin,v,D.origin),m.Rv.TransformNormalToRef(S.direction,v,D.direction),D.length=S.length,D.epsilon=S.epsilon;const z=D.direction,e=z.length();if(0!==e&&1!==e){const S=1/e;z.x*=S,z.y*=S,z.z*=S,D.length*=e}return D}unprojectRayToRef(S,v,D,z,e,N,B){const g=m.TmpVectors.Matrix[0];e.multiplyToRef(N,g),g.multiplyToRef(B,g),g.invert();const E=h.c.LastCreatedEngine,A=m.TmpVectors.Rv[0];A.x=S/D*2-1,A.y=-(v/z*2-1),A.z=null!==E&&void 0!==E&&E.useReverseDepthBuffer?1:null!==E&&void 0!==E&&E.isNDCHalfZRange?0:-1;const w=m.TmpVectors.Rv[1].oe(A.x,A.y,1-1e-8),n=m.TmpVectors.Rv[2],R=m.TmpVectors.Rv[3];m.Rv._UnprojectFromInvertedMatrixToRef(A,g,n),m.Rv._UnprojectFromInvertedMatrixToRef(w,g,R),this.origin.N(n),R.subtractToRef(n,this.direction),this.direction.normalize()}}function R(S,v,D,z,e){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const m=n.Zero();return O(S,v,D,z,m,e,N),m}function O(S,v,D,z,e,N){let B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const E=S.getEngine();if(!N&&!(N=S.activeCamera))return S;const h=N.viewport,A=E.getRenderHeight(),{x:w,y:n,width:R,height:O}=h.toGlobal(E.getRenderWidth(),A),I=1/E.getHardwareScalingLevel();return v=v*I-w,D=D*I-(A-n-O),e.update(v,D,R,O,z||m.Matrix.IdentityReadOnly,B?m.Matrix.IdentityReadOnly:N.getViewMatrix(),N.getProjectionMatrix(),g),S}function I(S,v,D,z,e){if(!E.b)return S;const N=S.getEngine();if(!e&&!(e=S.activeCamera))throw new Error("Active camera not set");const B=e.viewport,g=N.getRenderHeight(),{x:h,y:A,width:w,height:n}=B.toGlobal(N.getRenderWidth(),g),R=m.Matrix.Identity(),O=1/N.getHardwareScalingLevel();return v=v*O-h,D=D*O-(g-A-n),z.update(v,D,w,n,R,R,e.getProjectionMatrix()),S}function K(S,v,D,z,e,N,m,B){const g=v(z,D.enableDistantPicking),E=D.intersects(g,e,m,N,z,B);return E&&E.hit?!e&&null!=S&&E.distance>=S.distance?null:E:null}function q(S,v,D,z,e,N){let B=null;const g=!!(S.activeCameras&&S.activeCameras.length>1&&S.cameraToUseForPointers!==S.activeCamera),h=S.cameraToUseForPointers||S.activeCamera,A=w.internalPickerForMesh||K;for(let E=0;E<S.meshes.length;E++){const w=S.meshes[E];if(D){if(!D(w,-1))continue}else if(!w.isEnabled()||!w.isVisible||!w.Cg)continue;const n=g&&w.isWorldMatrixCameraDependent(),R=w.ke(n,h);if(w.hasThinInstances&&w.thinInstanceEnablePicking){const S=A(B,v,w,R,!0,!0,N);if(S){if(e)return S;const g=m.TmpVectors.Matrix[1],E=w.thinInstanceGetWorldMatrices();for(let S=0;S<E.length;S++){if(D&&!D(w,S))continue;E[S].multiplyToRef(R,g);const m=A(B,v,w,g,z,e,N,!0);if(m&&(B=m,B.thinInstanceIndex=S,z))return B}}}else{const S=A(B,v,w,R,z,e,N);if(S&&(B=S,z))return B}}return B||new E.b}function u(S,v,D,z){if(!E.b)return null;const e=[],N=!!(S.activeCameras&&S.activeCameras.length>1&&S.cameraToUseForPointers!==S.activeCamera),B=S.cameraToUseForPointers||S.activeCamera,g=w.internalPickerForMesh||K;for(let E=0;E<S.meshes.length;E++){const h=S.meshes[E];if(D){if(!D(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.Cg)continue;const A=N&&h.isWorldMatrixCameraDependent(),w=h.ke(A,B);if(h.hasThinInstances&&h.thinInstanceEnablePicking){if(g(null,v,h,w,!0,!0,z)){const S=m.TmpVectors.Matrix[1],N=h.thinInstanceGetWorldMatrices();for(let m=0;m<N.length;m++){if(D&&!D(h,m))continue;N[m].multiplyToRef(w,S);const B=g(null,v,h,S,!1,!1,z,!0);B&&(B.thinInstanceIndex=m,e.push(B))}}}else{const S=g(null,v,h,w,!1,!1,z);S&&e.push(S)}}return e}function s(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,z=arguments.length>3?arguments[3]:void 0,e=arguments.length>4?arguments[4]:void 0;z||(z=S.getWorldMatrix()),v.length=D,e?v.origin.N(e):v.origin.N(S.position);const N=m.TmpVectors.Rv[2];N.set(0,0,S._scene.useRightHandedSystem?-1:1);const B=m.TmpVectors.Rv[3];return m.Rv.TransformNormalToRef(N,z,B),m.Rv.NormalizeToRef(B,v.direction),v}var r,d;n._TmpVector3=(0,B.d)(6,m.Rv.Zero),n._RayDistant=n.Zero(),n._Smallnum=1e-8,n._Rayl=1e9,r=z.d,(d=e.b)&&(d.prototype.getForwardRay=function(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,v=arguments.length>1?arguments[1]:void 0,D=arguments.length>2?arguments[2]:void 0;return s(this,new n(m.Rv.Zero(),m.Rv.Zero(),S),S,v,D)},d.prototype.getForwardRayToRef=function(S){return s(this,S,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),r&&(A.d._IsPickingAvailable=!0,r.prototype.createPickingRay=function(S,v,D,z){return R(this,S,v,D,z,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),z.d.prototype.createPickingRayToRef=function(S,v,D,z,e){return O(this,S,v,D,z,e,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},z.d.prototype.createPickingRayInCameraSpace=function(S,v,D){return function(S,v,D,z){const e=n.Zero();return I(S,v,D,e,z),e}(this,S,v,D)},z.d.prototype.createPickingRayInCameraSpaceToRef=function(S,v,D,z){return I(this,S,v,D,z)},z.d.prototype.pickWithBoundingInfo=function(S,v,D,z,e){return function(S,v,D,z,e,N){if(!E.b)return null;const B=q(S,(z=>(S._tempPickingRay||(S._tempPickingRay=n.Zero()),O(S,v,D,z,S._tempPickingRay,N||null),S._tempPickingRay)),z,e,!0);return B&&(B.ray=R(S,v,D,m.Matrix.Identity(),N||null)),B}(this,S,v,D,z,e)},z.d.prototype.nD=function(S,v,D,z,e,N){return function(S,v,D,z,e,N,B){const g=q(S,((z,e)=>(S._tempPickingRay||(S._tempPickingRay=n.Zero()),O(S,v,D,z,S._tempPickingRay,N||null,!1,e),S._tempPickingRay)),z,e,!1,B);return g&&(g.ray=R(S,v,D,m.Matrix.Identity(),N||null)),g}(this,S,v,D,z,e,N)},z.d.prototype.pickWithRay=function(S,v,D,z){return function(S,v,D,z,e){const N=q(S,(D=>(S._pickWithRayInverseMatrix||(S._pickWithRayInverseMatrix=m.Matrix.Identity()),D.invertToRef(S._pickWithRayInverseMatrix),S._cachedRayForTransform||(S._cachedRayForTransform=n.Zero()),n.TransformToRef(v,S._pickWithRayInverseMatrix,S._cachedRayForTransform),S._cachedRayForTransform)),D,z,!1,e);return N&&(N.ray=v),N}(this,S,v,D,z)},z.d.prototype.multiPick=function(S,v,D,z,e){return function(S,v,D,z,e,N){return u(S,(z=>R(S,v,D,z,e||null)),z,N)}(this,S,v,D,z,e)},z.d.prototype.multiPickWithRay=function(S,v,D){return function(S,v,D,z){return u(S,(D=>(S._pickWithRayInverseMatrix||(S._pickWithRayInverseMatrix=m.Matrix.Identity()),D.invertToRef(S._pickWithRayInverseMatrix),S._cachedRayForTransform||(S._cachedRayForTransform=n.Zero()),n.TransformToRef(v,S._pickWithRayInverseMatrix,S._cachedRayForTransform),S._cachedRayForTransform)),D,z)}(this,S,v,D)}},13082:(S,v,D)=>{"use strict";var z=D(11301),e=D(11190),N=D(11229),m=D(11336),B=D(11269),g=D(11314);B.d.prototype._partialLoadFile=function(S,v,D,z){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(S,(S=>{D[v]=S,D._internalCount++,6===D._internalCount&&z(D)}),void 0,void 0,!0,((S,v)=>{e&&S&&e(S.status+" "+S.statusText,v)}))},B.d.prototype._cascadeLoadFiles=function(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const e=[];e._internalCount=0;for(let N=0;N<6;N++)this._partialLoadFile(D[N],N,e,v,z)},B.d.prototype._cascadeLoadImgs=function(S,v,D,z){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5?arguments[5]:void 0;const m=[];m._internalCount=0;for(let B=0;B<6;B++)this._partialLoadImg(z[B],B,m,S,v,D,e,N)},B.d.prototype._partialLoadImg=function(S,v,D,z,e,B){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7?arguments[7]:void 0;const h=(0,m.e)();(0,N.n)(S,(S=>{D[v]=S,D._internalCount++,z&&z.removePendingData(h),6===D._internalCount&&B&&B(e,D)}),((S,v)=>{z&&z.removePendingData(h),g&&g(S,v)}),z?z.offlineProvider:null,E),z&&z.addPendingData(h)},B.d.prototype.createCubeTextureBase=function(S,v,D,N){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8],w=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,n=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,O=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,I=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,K=arguments.length>14&&void 0!==arguments[14]&&arguments[14],q=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const u=R||new z.b(this,7);u.isCube=!0,u.url=S,u.generateMipMaps=!N,u._lodGenerationScale=w,u._lodGenerationOffset=n,u._useSRGBBuffer=!!K&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!N),u!==R&&(u.label=S.substring(0,60)),this._doNotHandleContextLost||(u._extension=h,u._files=D,u._buffer=q);const s=S;this._transformTextureUrl&&!R&&(S=this._transformTextureUrl(S));const r=h??function(S){const v=S.split("?")[0],D=v.lastIndexOf(".");return D>-1?v.substring(D).toLowerCase():""}(S),d=(0,g.c)(r),x=(S,v)=>{u.dispose(),B?B(S,v):S&&e.b.Warn(S)},W=(z,B)=>{S===s?z&&x(z.status+" "+z.statusText,B):(e.b.Warn(`Failed to load ${S}, falling back to the ${s}`),this.createCubeTextureBase(s,v,D,!!N,m,x,E,h,A,w,n,u,O,I,K,q))};if(d)d.then((z=>{const e=S=>{O&&O(u,S),z.loadCubeData(S,u,A,m,((S,v)=>{x(S,v)}))};q?e(q):D&&6===D.length?z.supportCascades?this._cascadeLoadFiles(v,(S=>e(S.map((S=>new Uint8Array(S))))),D,x):x("Textures type does not support cascades."):this._loadFile(S,(S=>e(new Uint8Array(S))),void 0,void 0,!0,W)}));else{if(!D||0===D.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(v,u,((S,v)=>{I&&I(S,v)}),D,x)}return this._internalTexturesCache.push(u),u}},13625:(S,v,D)=>{"use strict";D(11190);var z=D(11505);D(11301),D(11461),D(11294),D(11561),D(11512);z.e},13103:(S,v,D)=>{"use strict";D.d(v,{b:()=>e});var z=D(11329);class e{constructor(S){this.value=this._toInt(S)}_toInt(S){return 0|S}add(S){return new e(this.value+S.value)}Ov(S){return new e(this.value-S.value)}multiply(S){return new e(Math.imul(this.value,S.value))}divide(S){return new e(this.value/S.value)}getClassName(){return e.ClassName}equals(S){return this.value===S.value}static FromValue(S){return new e(S)}toString(){return this.value.toString()}}e.ClassName="FlowGraphInteger",(0,z.f)("FlowGraphInteger",e)},13112:(S,v,D)=>{"use strict";D.d(v,{d:()=>e,f:()=>N});var z=D(11371);class e{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ve=S}get m(){return this.ve}transformVector(S){return this.transformVectorToRef(S,new z.Vector2)}transformVectorToRef(S,v){return v.x=S.x*this.ve[0]+S.y*this.ve[1],v.y=S.x*this.ve[2]+S.y*this.ve[3],v}Oe(){return this.toArray()}toArray(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let v=0;v<4;v++)S[v]=this.ve[v];return S}RD(S){for(let v=0;v<4;v++)this.ve[v]=S[v];return this}multiplyToRef(S,v){const D=S.ve,z=this.ve,e=v.ve;return e[0]=D[0]*z[0]+D[1]*z[2],e[1]=D[0]*z[1]+D[1]*z[3],e[2]=D[2]*z[0]+D[3]*z[2],e[3]=D[2]*z[1]+D[3]*z[3],v}multiply(S){return this.multiplyToRef(S,new e)}divideToRef(S,v){const D=this.ve,z=S.ve,e=v.ve;return e[0]=D[0]/z[0],e[1]=D[1]/z[1],e[2]=D[2]/z[2],e[3]=D[3]/z[3],v}divide(S){return this.divideToRef(S,new e)}addToRef(S,v){const D=this.ve,z=S.m,e=v.m;return e[0]=D[0]+z[0],e[1]=D[1]+z[1],e[2]=D[2]+z[2],e[3]=D[3]+z[3],v}add(S){return this.addToRef(S,new e)}subtractToRef(S,v){const D=this.ve,z=S.m,e=v.m;return e[0]=D[0]-z[0],e[1]=D[1]-z[1],e[2]=D[2]-z[2],e[3]=D[3]-z[3],v}Ov(S){return this.subtractToRef(S,new e)}transpose(){const S=this.ve;return new e([S[0],S[2],S[1],S[3]])}determinant(){const S=this.ve;return S[0]*S[3]-S[1]*S[2]}inverse(){const S=this.determinant();if(0===S)throw new Error("Matrix is not invertible");const v=this.ve,D=1/S;return new e([v[3]*D,-v[1]*D,-v[2]*D,v[0]*D])}equals(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const D=this.ve,z=S.m;return 0===v?D[0]===z[0]&&D[1]===z[1]&&D[2]===z[2]&&D[3]===z[3]:Math.abs(D[0]-z[0])<v&&Math.abs(D[1]-z[1])<v&&Math.abs(D[2]-z[2])<v&&Math.abs(D[3]-z[3])<v}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ve.join(", ")})`}}class N{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ve=S}get m(){return this.ve}transformVector(S){return this.transformVectorToRef(S,new z.Rv)}transformVectorToRef(S,v){const D=this.ve;return v.x=S.x*D[0]+S.y*D[1]+S.z*D[2],v.y=S.x*D[3]+S.y*D[4]+S.z*D[5],v.z=S.x*D[6]+S.y*D[7]+S.z*D[8],v}multiplyToRef(S,v){const D=S.ve,z=this.ve,e=v.m;return e[0]=D[0]*z[0]+D[1]*z[3]+D[2]*z[6],e[1]=D[0]*z[1]+D[1]*z[4]+D[2]*z[7],e[2]=D[0]*z[2]+D[1]*z[5]+D[2]*z[8],e[3]=D[3]*z[0]+D[4]*z[3]+D[5]*z[6],e[4]=D[3]*z[1]+D[4]*z[4]+D[5]*z[7],e[5]=D[3]*z[2]+D[4]*z[5]+D[5]*z[8],e[6]=D[6]*z[0]+D[7]*z[3]+D[8]*z[6],e[7]=D[6]*z[1]+D[7]*z[4]+D[8]*z[7],e[8]=D[6]*z[2]+D[7]*z[5]+D[8]*z[8],v}multiply(S){return this.multiplyToRef(S,new N)}divideToRef(S,v){const D=this.ve,z=S.m,e=v.m;return e[0]=D[0]/z[0],e[1]=D[1]/z[1],e[2]=D[2]/z[2],e[3]=D[3]/z[3],e[4]=D[4]/z[4],e[5]=D[5]/z[5],e[6]=D[6]/z[6],e[7]=D[7]/z[7],e[8]=D[8]/z[8],v}divide(S){return this.divideToRef(S,new N)}addToRef(S,v){const D=this.ve,z=S.m,e=v.m;return e[0]=D[0]+z[0],e[1]=D[1]+z[1],e[2]=D[2]+z[2],e[3]=D[3]+z[3],e[4]=D[4]+z[4],e[5]=D[5]+z[5],e[6]=D[6]+z[6],e[7]=D[7]+z[7],e[8]=D[8]+z[8],v}add(S){return this.addToRef(S,new N)}subtractToRef(S,v){const D=this.ve,z=S.m,e=v.m;return e[0]=D[0]-z[0],e[1]=D[1]-z[1],e[2]=D[2]-z[2],e[3]=D[3]-z[3],e[4]=D[4]-z[4],e[5]=D[5]-z[5],e[6]=D[6]-z[6],e[7]=D[7]-z[7],e[8]=D[8]-z[8],v}Ov(S){return this.subtractToRef(S,new N)}toArray(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let v=0;v<9;v++)S[v]=this.ve[v];return S}Oe(){return this.toArray()}RD(S){for(let v=0;v<9;v++)this.ve[v]=S[v];return this}transpose(){const S=this.ve;return new N([S[0],S[3],S[6],S[1],S[4],S[7],S[2],S[5],S[8]])}determinant(){const S=this.ve;return S[0]*(S[4]*S[8]-S[5]*S[7])-S[1]*(S[3]*S[8]-S[5]*S[6])+S[2]*(S[3]*S[7]-S[4]*S[6])}inverse(){const S=this.determinant();if(0===S)throw new Error("Matrix is not invertible");const v=this.ve,D=1/S;return new N([(v[4]*v[8]-v[5]*v[7])*D,(v[2]*v[7]-v[1]*v[8])*D,(v[1]*v[5]-v[2]*v[4])*D,(v[5]*v[6]-v[3]*v[8])*D,(v[0]*v[8]-v[2]*v[6])*D,(v[2]*v[3]-v[0]*v[5])*D,(v[3]*v[7]-v[4]*v[6])*D,(v[1]*v[6]-v[0]*v[7])*D,(v[0]*v[4]-v[1]*v[3])*D])}equals(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const D=this.ve,z=S.m;return 0===v?D[0]===z[0]&&D[1]===z[1]&&D[2]===z[2]&&D[3]===z[3]&&D[4]===z[4]&&D[5]===z[5]&&D[6]===z[6]&&D[7]===z[7]&&D[8]===z[8]:Math.abs(D[0]-z[0])<v&&Math.abs(D[1]-z[1])<v&&Math.abs(D[2]-z[2])<v&&Math.abs(D[3]-z[3])<v&&Math.abs(D[4]-z[4])<v&&Math.abs(D[5]-z[5])<v&&Math.abs(D[6]-z[6])<v&&Math.abs(D[7]-z[7])<v&&Math.abs(D[8]-z[8])<v}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ve.join(", ")})`}}},13116:(S,v,D)=>{"use strict";var z;function e(S,v,D,z){switch(v){case"Animation":return z?S.animations.find((S=>S.uniqueId===D))??null:S.animations[D]??null;case"AnimationGroup":return z?S.animationGroups.find((S=>S.uniqueId===D))??null:S.animationGroups[D]??null;case"Mesh":return z?S.meshes.find((S=>S.uniqueId===D))??null:S.meshes[D]??null;case"Material":return z?S.materials.find((S=>S.uniqueId===D))??null:S.materials[D]??null;case"Mh":return z?S.cameras.find((S=>S.uniqueId===D))??null:S.cameras[D]??null;case"Light":return z?S.lights.find((S=>S.uniqueId===D))??null:S.lights[D]??null;default:return null}}D.d(v,{c:()=>e}),function(S){S.Animation="Animation",S.AnimationGroup="AnimationGroup",S.Mesh="Mesh",S.Material="Material",S.Mh="Mh",S.Light="Light"}(z||(z={}))},13146:(S,v,D)=>{"use strict";D.d(v,{e:()=>e});var z=D(13151);class e extends z.c{constructor(S,v){if(super(S),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),v)for(const D of v)this._eventsSignalOutputs[D]=this._registerSignalOutput(D+"Event")}_executeOnTick(S){}_startPendingTasks(S){S._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(S),this._resetAfterCanceled(S)),this._preparePendingTasks(S),S._addPendingBlock(this),this.out._activateSignal(S),S._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(S){S._deleteExecutionVariable(this,"_initialized"),S._removePendingBlock(this)}}},13123:(S,v,D)=>{"use strict";D.d(v,{d:()=>E});var z=D(11336),e=D(11329),N=D(13131),m=D(11179),B=D(13097);class g extends N.d{constructor(S,v,D,z){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:z.defaultValue,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(S,v,D),this.richType=z,this._defaultValue=e,this._optional=N,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new m.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(S){this._isDisabled!==S&&(this._isDisabled=S,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(S,v){v._getConnectionValue(this)!==S&&(v._setConnectionValue(this,S),this.onValueChangedObservable.notifyObservers(S))}resetToDefaultValue(S){S._setConnectionValue(this,this._defaultValue)}connectTo(S){this._isDisabled||super.connectTo(S)}_getValueOrDefault(S){const v=S._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(v):v}getValue(S){if(1===this.connectionType){S._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(S);const v=this._getValueOrDefault(S);return this._lastValue=v,this.richType.typeTransformer?this.richType.typeTransformer(v):v}const v=this.isConnected()?this._connectedPoint[0].getValue(S):this._getValueOrDefault(S);return this._lastValue=v,this.richType.typeTransformer?this.richType.typeTransformer(v):v}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(S),S.richType={},this.richType.serialize(S.richType),S.optional=this._optional,(0,B.e)("defaultValue",this._defaultValue,S)}}(0,e.f)("FlowGraphDataConnection",g);class E{constructor(S){var v;this.config=S,this.uniqueId=(0,z.e)(),this.name=(null===(v=this.config)||void 0===v?void 0:v.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(S){}registerDataInput(S,v,D){const z=new g(S,0,this,v,D);return this.dataInputs.push(z),z}registerDataOutput(S,v,D){const z=new g(S,1,this,v,D);return this.dataOutputs.push(z),z}getDataInput(S){return this.dataInputs.find((v=>v.name===S))}getDataOutput(S){return this.dataOutputs.find((v=>v.name===S))}serialize(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.e;if(S.uniqueId=this.uniqueId,S.config={},this.config){const D=this.config,z=Object.keys(D);for(const e of z)v(e,D[e],S.config)}S.dataInputs=[],S.dataOutputs=[],S.className=this.getClassName();for(const D of this.dataInputs){const v={};D.serialize(v),S.dataInputs.push(v)}for(const D of this.dataOutputs){const v={};D.serialize(v),S.dataOutputs.push(v)}}deserialize(S){}_log(S,v,D){var z;null===(z=S.logger)||void 0===z||z.addLogItem({action:v,OD:D,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13131:(S,v,D)=>{"use strict";D.d(v,{d:()=>N});var z,e=D(11336);!function(S){S[S.Input=0]="Input",S[S.Output=1]="Output"}(z||(z={}));class N{constructor(S,v,D){this._ownerBlock=D,this._connectedPoint=[],this.uniqueId=(0,e.e)(),this.connectedPointIds=[],this.name=S,this._connectionType=v}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(S){if(this._connectionType===S._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||S._isSingularConnection()&&S._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(S),S._connectedPoint.push(this)}disconnectFrom(S){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const D=this._connectedPoint.indexOf(S),z=S._connectedPoint.indexOf(this);-1!==D&&-1!==z&&(v&&this._connectedPoint.splice(D,1),S._connectedPoint.splice(z,1))}disconnectFromAll(){for(const S of this._connectedPoint)this.disconnectFrom(S,!1);this._connectedPoint.length=0}dispose(){for(const S of this._connectedPoint)this.disconnectFrom(S)}serialize(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};S.uniqueId=this.uniqueId,S.name=this.name,S._connectionType=this._connectionType,S.connectedPointIds=[],S.className=this.getClassName();for(const v of this._connectedPoint)S.connectedPointIds.push(v.uniqueId)}getClassName(){return"FGConnection"}deserialize(S){this.uniqueId=S.uniqueId,this.name=S.name,this._connectionType=S._connectionType,this.connectedPointIds=S.connectedPointIds}}},13094:(S,v,D)=>{"use strict";D.d(v,{b:()=>u});var z,e=D(11179),N=D(11358),m=D(11364),B=D(11336),g=D(13097),E=D(13116),h=D(11190);!function(S){S.ExecuteBlock="ExecuteBlock",S.ExecuteEvent="ExecuteEvent",S.TriggerConnection="TriggerConnection",S.ContextVariableSet="ContextVariableSet",S.GlobalVariableSet="GlobalVariableSet",S.GlobalVariableDelete="GlobalVariableDelete",S.GlobalVariableGet="GlobalVariableGet",S.AddConnection="AddConnection",S.GetConnectionValue="GetConnectionValue",S.SetConnectionValue="SetConnectionValue",S.ActivateSignal="ActivateSignal",S.ContextVariableGet="ContextVariableGet"}(z||(z={}));class A{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(S){if(S.time||(S.time=Date.now()),this.log.push(S),this.logToConsole){var v;const D=null===(v=S.OD)||void 0===v?void 0:v.value;"object"===typeof D&&D.getClassName?h.b.Log(`[FGLog] ${S.className}:${S.uniqueId.split("-")[0]} ${S.action} - ${JSON.stringify(D.getClassName())}: ${D.toString()}`):h.b.Log(`[FGLog] ${S.className}:${S.uniqueId.split("-")[0]} ${S.action} - ${JSON.stringify(S.OD)}`)}}getItemsOfType(S){return this.log.filter((v=>v.action===S))}}class w{get enableLogging(){return this._enableLogging}set enableLogging(S){this._enableLogging!==S&&(this._enableLogging=S,this._enableLogging?(this.logger=new A,this.logger.logToConsole=!0):this.logger=null)}constructor(S){this.uniqueId=(0,B.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new e.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=S,this.assetsContext=S.assetsContext??S.Iv}hasVariable(S){return S in this._userVariables}setVariable(S,v){var D;this._userVariables[S]=v,null===(D=this.logger)||void 0===D||D.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",OD:{name:S,value:v}})}getAsset(S,v){return(0,E.c)(this.assetsContext,S,v)}getVariable(S){var v;return null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",OD:{name:S,value:this._userVariables[S]}}),this._userVariables[S]}get userVariables(){return this._userVariables}xS(){return this._configuration.Iv}_getUniqueIdPrefixedName(S,v){return`${S.uniqueId}_${v}`}_getGlobalContextVariable(S,v){var D;return null===(D=this.logger)||void 0===D||D.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",OD:{name:S,defaultValue:v,possibleValue:this._globalContextVariables[S]}}),this._hasGlobalContextVariable(S)?this._globalContextVariables[S]:v}_setGlobalContextVariable(S,v){var D;null===(D=this.logger)||void 0===D||D.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",OD:{name:S,value:v}}),this._globalContextVariables[S]=v}_deleteGlobalContextVariable(S){var v;null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",OD:{name:S}}),delete this._globalContextVariables[S]}_hasGlobalContextVariable(S){return S in this._globalContextVariables}_setExecutionVariable(S,v,D){this._executionVariables[this._getUniqueIdPrefixedName(S,v)]=D}_getExecutionVariable(S,v,D){return this._hasExecutionVariable(S,v)?this._executionVariables[this._getUniqueIdPrefixedName(S,v)]:D}_deleteExecutionVariable(S,v){delete this._executionVariables[this._getUniqueIdPrefixedName(S,v)]}_hasExecutionVariable(S,v){return this._getUniqueIdPrefixedName(S,v)in this._executionVariables}_hasConnectionValue(S){return S.uniqueId in this._connectionValues}_setConnectionValue(S,v){var D;this._connectionValues[S.uniqueId]=v,null===(D=this.logger)||void 0===D||D.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",OD:{connectionPointId:S.uniqueId,value:v}})}_setConnectionValueByKey(S,v){this._connectionValues[S]=v}_getConnectionValue(S){var v;return null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",OD:{connectionPointId:S.uniqueId,value:this._connectionValues[S.uniqueId]}}),this._connectionValues[S.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(S){this._pendingBlocks.includes(S)||(this._pendingBlocks.push(S),this._pendingBlocks.sort(((S,v)=>S.priority-v.priority)))}_removePendingBlock(S){const v=this._pendingBlocks.indexOf(S);-1!==v&&this._pendingBlocks.splice(v,1)}_clearPendingBlocks(){for(const S of this._pendingBlocks)S._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(S){var v;this.onNodeExecutedObservable.notifyObservers(S),null===(v=this.logger)||void 0===v||v.addLogItem({time:Date.now(),className:S.getClassName(),uniqueId:S.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(S){this._setGlobalContextVariable("timeSinceStart",S.timeSinceStart),this._setGlobalContextVariable("deltaTime",S.deltaTime);for(const D of this._pendingBlocks){var v;null===(v=D._executeOnTick)||void 0===v||v.call(D,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.e;S.uniqueId=this.uniqueId,S._userVariables={};for(const z in this._userVariables)v(z,this._userVariables[z],S._userVariables);S._connectionValues={};for(const z in this._connectionValues)v(z,this._connectionValues[z],S._connectionValues);var D;this.assetsContext!==this.xS()&&(S._assetsContext={meshes:this.assetsContext.meshes.map((S=>S.id)),materials:this.assetsContext.materials.map((S=>S.id)),textures:this.assetsContext.textures.map((S=>S.name)),animations:this.assetsContext.animations.map((S=>S.name)),lights:this.assetsContext.lights.map((S=>S.id)),cameras:this.assetsContext.cameras.map((S=>S.id)),En:null===(D=this.assetsContext.En)||void 0===D?void 0:D.map((S=>S.name)),skeletons:this.assetsContext.skeletons.map((S=>S.id)),Zw:this.assetsContext.Zw.map((S=>S.name)),geometries:this.assetsContext.geometries.map((S=>S.id)),multiMaterials:this.assetsContext.multiMaterials.map((S=>S.id)),transformNodes:this.assetsContext.transformNodes.map((S=>S.id))})}getClassName(){return"FlowGraphContext"}}(0,N.b)([(0,m.L)()],w.prototype,"uniqueId",void 0);var n=D(13119),R=D(11652);class O{constructor(S){this.onEventTriggeredObservable=new e.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=S,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Se.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const S=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",OD:{timeSinceStart:this._startingTime,deltaTime:S}}),this._startingTime+=S})),this._meshPickedObserver=this._scene.onPointerObservable.add((S=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",OD:S})}),R.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((S=>{const v=S.pointerId,D=S.mesh,z=this._pointerUnderMeshState[v];!z&&D?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",OD:{pointerId:v,mesh:D}}):z&&!D?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",OD:{pointerId:v,mesh:z}}):z&&D&&z!==D&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",OD:{pointerId:v,mesh:z,over:D}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",OD:{pointerId:v,mesh:D,out:z}})),this._pointerUnderMeshState[v]=D}),R.c.POINTERMOVE)}dispose(){var S,v,D,z,e;null===(S=this._sceneDisposeObserver)||void 0===S||S.remove(),null===(v=this._sceneReadyObserver)||void 0===v||v.remove(),null===(D=this._sceneOnBeforeRenderObserver)||void 0===D||D.remove(),null===(z=this._meshPickedObserver)||void 0===z||z.remove(),null===(e=this._meshUnderPointerObserver)||void 0===e||e.remove(),this.onEventTriggeredObservable.clear()}}var I,K=D(13139);!function(S){S[S.Stopped=0]="Stopped",S[S.Started=1]="Started"}(I||(I={}));class q{get state(){return this._state}set state(S){this._state=S,this.onStateChangedObservable.notifyObservers(S)}constructor(S){this.onStateChangedObservable=new e.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=S.Iv,this._sceneEventCoordinator=new O(this._scene),this._coordinator=S.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((S=>{for(const v of this._executionContexts){const D=this._getContextualOrder(S.type,v);for(const z of D)if(!z._executeEvent(v,S.OD))break}switch(S.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const v of this._executionContexts)v._notifyOnTick(S.OD);break;case"SceneDispose":this.dispose()}}))}createContext(){const S=new w({Iv:this._scene,coordinator:this._coordinator});return this._executionContexts.push(S),S}getContext(S){return this._executionContexts[S]}addEventBlock(S){if("PointerOver"!==S.type&&"PointerOut"!==S.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==S.type&&this._eventBlocks[S.type].push(S),1===this.state)for(const v of this._executionContexts)S._startPendingTasks(v);else this.onStateChangedObservable.addOnce((v=>{if(1===v)for(const D of this._executionContexts)S._startPendingTasks(D)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((S=>{1===S&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const S of this._executionContexts)for(const v in this._eventBlocks){const D=this._getContextualOrder(v,S);for(const v of D)v._startPendingTasks(S)}}_getContextualOrder(S,v){const D=this._eventBlocks[S].sort(((S,v)=>v.initPriority-S.initPriority));if("MeshPick"===S){const S=[];for(const z of D){const e=z.asset.getValue(v);let N=0;for(;N<D.length;N++){const S=D[N].asset.getValue(v);if(e&&S&&(0,K.m)(e,S))break}S.splice(N,0,z)}return S}return D}dispose(){var S;if(0!==this.state){this.state=0;for(const S of this._executionContexts)S._clearPendingBlocks();this._executionContexts.length=0;for(const S in this._eventBlocks)this._eventBlocks[S].length=0;null===(S=this._eventObserver)||void 0===S||S.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(S){const v=[],D=new Set;for(const z in this._eventBlocks)for(const S of this._eventBlocks[z])v.push(S),D.add(S.uniqueId);for(;v.length>0;){const z=v.pop();S(z);for(const S of z.dataInputs)for(const z of S._connectedPoint)D.has(z._ownerBlock.uniqueId)||(v.push(z._ownerBlock),D.add(z._ownerBlock.uniqueId));if(z instanceof n.e)for(const S of z.signalOutputs)for(const z of S._connectedPoint)D.has(z._ownerBlock.uniqueId)||(v.push(z._ownerBlock),D.add(z._ownerBlock.uniqueId))}}serialize(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1?arguments[1]:void 0;S.allBlocks=[],this.visitAllBlocks((v=>{const D={};v.serialize(D),S.allBlocks.push(D)})),S.executionContexts=[];for(const D of this._executionContexts){const z={};D.serialize(z,v),S.executionContexts.push(z)}}}class u{constructor(S){this.config=S,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Iv.Se.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Iv.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const S=this._executeOnNextFrame.slice(0);if(S.length)for(const v of S){this.notifyCustomEvent(v.id,v.data,!1);const S=this._executeOnNextFrame.findIndex((S=>S.uniqueId===v.uniqueId));-1!==S&&this._executeOnNextFrame.splice(S,1)}}));(u.SceneCoordinators.get(this.config.Iv)??[]).push(this)}createGraph(){const S=new q({Iv:this.config.Iv,coordinator:this});return this._flowGraphs.push(S),S}removeGraph(S){const v=this._flowGraphs.indexOf(S);-1!==v&&(S.dispose(),this._flowGraphs.splice(v,1))}start(){for(const S of this._flowGraphs)S.start()}dispose(){var S,v;for(const e of this._flowGraphs)e.dispose();this._flowGraphs.length=0,null===(S=this._disposeObserver)||void 0===S||S.remove(),null===(v=this._onBeforeRenderObserver)||void 0===v||v.remove();const D=u.SceneCoordinators.get(this.config.Iv)??[],z=D.indexOf(this);-1!==z&&D.splice(z,1)}serialize(S,v){S._flowGraphs=[];for(const D of this._flowGraphs){const z={};D.serialize(z,v),S._flowGraphs.push(z)}S.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(S){let v=this._customEventsMap.get(S);return v||(v=new e.d,this._customEventsMap.set(S,v)),v}notifyCustomEvent(S,v){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:S,data:v,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(S)){const v=this._eventExecutionCounter.get(S);if(this._eventExecutionCounter.set(S,v+1),v>=u.MaxEventTypeExecutionPerFrame)return void(v===u.MaxEventTypeExecutionPerFrame&&h.b.Warn(`FlowGraphCoordinator: Too many executions of event "${S}".`))}else this._eventExecutionCounter.set(S,1);const D=this._customEventsMap.get(S);D&&D.notifyObservers(v)}}u.MaxEventsPerType=30,u.MaxEventTypeExecutionPerFrame=30,u.SceneCoordinators=new Map},13143:(S,v,D)=>{"use strict";D.d(v,{c:()=>e});var z=D(13146);class e extends z.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(S){S._notifyExecuteNode(this),this.done._activateSignal(S)}}},13119:(S,v,D)=>{"use strict";D.d(v,{e:()=>B});var z=D(13123),e=D(13131),N=D(11329);class m extends e.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(S){super.connectTo(S),this._connectedPoint.sort(((S,v)=>v.priority-S.priority))}_activateSignal(S){var v;if(null===(v=S.logger)||void 0===v||v.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,OD:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)S._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(S,this),S._increaseExecutionId();else for(const D of this._connectedPoint)D._activateSignal(S)}}(0,N.f)("FlowGraphSignalConnection",m);class B extends z.d{constructor(S){super(S),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(S){const v=new m(S,0,this);return this.signalInputs.push(v),v}_registerSignalOutput(S){const v=new m(S,1,this);return this.signalOutputs.push(v),v}_unregisterSignalInput(S){const v=this.signalInputs.findIndex((v=>v.name===S));-1!==v&&(this.signalInputs[v].dispose(),this.signalInputs.splice(v,1))}_unregisterSignalOutput(S){const v=this.signalOutputs.findIndex((v=>v.name===S));-1!==v&&(this.signalOutputs[v].dispose(),this.signalOutputs.splice(v,1))}_reportError(S,v){this.error.OD="string"===typeof v?new Error(v):v,this.error._activateSignal(S)}getSignalInput(S){return this.signalInputs.find((v=>v.name===S))}getSignalOutput(S){return this.signalOutputs.find((v=>v.name===S))}serialize(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(S),S.signalInputs=[],S.signalOutputs=[];for(const v of this.signalInputs){const D={};v.serialize(D),S.signalInputs.push(D)}for(const v of this.signalOutputs){const D={};v.serialize(D),S.signalOutputs.push(D)}}deserialize(S){for(let v=0;v<S.signalInputs.length;v++){const D=this.getSignalInput(S.signalInputs[v].name);if(!D)throw new Error("Could not find signal input with name "+S.signalInputs[v].name+" in block "+S.className);D.deserialize(S.signalInputs[v])}for(let v=0;v<S.signalOutputs.length;v++){const D=this.getSignalOutput(S.signalOutputs[v].name);if(!D)throw new Error("Could not find signal output with name "+S.signalOutputs[v].name+" in block "+S.className);D.deserialize(S.signalOutputs[v])}}getClassName(){return"FlowGraphExecutionBlock"}}},13151:(S,v,D)=>{"use strict";D.d(v,{c:()=>e});var z=D(13119);class e extends z.e{constructor(S){super(S),this.out=this._registerSignalOutput("out")}}},13108:(S,v,D)=>{"use strict";D.d(v,{A:()=>n,E:()=>R,I:()=>O,J:()=>p,K:()=>b,L:()=>W,N:()=>x,d:()=>E,e:()=>w,i:()=>d,m:()=>I,o:()=>K,p:()=>q,q:()=>A,u:()=>r,w:()=>h});var z,e=D(11371),N=D(11425),m=D(13103),B=D(13112);!function(S){S.Any="any",S.String="string",S.Number="number",S.Boolean="boolean",S.Object="object",S.Integer="FlowGraphInteger",S.Vector2="Vector2",S.Rv="Rv",S.Vector4="Vector4",S.Quaternion="Quaternion",S.Matrix="Matrix",S.Matrix2D="Matrix2D",S.Matrix3D="Matrix3D",S.qv="qv",S.Ge="Ge"}(z||(z={}));class g{constructor(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=S,this.defaultValue=v,this.animationType=D}serialize(S){S.typeName=this.typeName,S.defaultValue=this.defaultValue}}const E=new g("any",void 0),h=new g("string",""),A=new g("number",0,0),w=new g("boolean",!1),n=new g("Vector2",e.Vector2.Zero(),5),R=new g("Rv",e.Rv.Zero(),1),O=new g("Vector4",e.Vector4.Zero()),I=new g("Matrix",e.Matrix.Identity(),3),K=new g("Matrix2D",new B.d),q=new g("Matrix3D",new B.f),u=new g("qv",N.qv.Black(),4),s=new g("Ge",new N.Ge(0,0,0,0),7),r=new g("Quaternion",e.Quaternion.Identity(),2);r.typeTransformer=S=>{if(S.getClassName){if("Vector4"===S.getClassName())return e.Quaternion.uv(S.Oe());if("Rv"===S.getClassName())return e.Quaternion.FromEulerVector(S);if("Matrix"===S.getClassName())return e.Quaternion.FromRotationMatrix(S)}return S};const d=new g("FlowGraphInteger",new m.b(0),0);function x(S){const v=S;switch(typeof S){case"string":return h;case"number":return A;case"boolean":return w;case"object":if(v.getClassName)switch(v.getClassName()){case"Vector2":return n;case"Rv":return R;case"Vector4":return O;case"Matrix":return I;case"qv":return u;case"Ge":return s;case"Quaternion":return r;case"FlowGraphInteger":return d;case"Matrix2D":return K;case"Matrix3D":return q}return E;default:return E}}function W(S){switch(S){case"string":return h;case"number":return A;case"boolean":return w;case"Vector2":return n;case"Rv":return R;case"Vector4":return O;case"Matrix":return I;case"qv":return u;case"Ge":return s;case"Quaternion":return r;case"FlowGraphInteger":return d;case"Matrix2D":return K;case"Matrix3D":return q;default:return E}}function p(S){switch(S){case"number":default:return 0;case"Vector2":return 5;case"Rv":return 1;case"Matrix":return 3;case"qv":return 4;case"Ge":return 7;case"Quaternion":return 2}}function b(S){switch(S){case 0:return A;case 5:return n;case 1:return R;case 3:return I;case 4:return u;case 7:return s;case 2:return r;default:return E}}},13097:(S,v,D)=>{"use strict";D.d(v,{c:()=>h,e:()=>E,g:()=>A});var z=D(11425),e=D(11371),N=D(13103),m=D(13108),B=D(13112);function g(S){return"Vector2"===S||"Rv"===S||"Vector4"===S||"Quaternion"===S||"qv"===S||"Ge"===S}function E(S,v,D){var z;const e=(null===v||void 0===v||null===(z=v.getClassName)||void 0===z?void 0:z.call(v))??"";if(g(e)||function(S){return"Matrix"===S||"Matrix2D"===S||"Matrix3D"===S}(e))D[S]={value:v.Oe(),className:e};else if("FlowGraphInteger"===e)D[S]={value:v.value,className:e};else if(e&&(v.id||v.name))D[S]={id:v.id,name:v.name,className:e};else{if("object"===typeof v)throw new Error(`Could not serialize value ${v}`);D[S]=v}}function h(S,v,D,E){const A=v[S];let w;const n=(null===A||void 0===A?void 0:A.type)??(null===A||void 0===A?void 0:A.className);if(function(S){return"Mesh"===S||"AbstractMesh"===S||"GroundMesh"===S||"InstanceMesh"===S||"LinesMesh"===S||"GoldbergMesh"===S||"GreasedLineMesh"===S||"TrailMesh"===S}(n)){let S=E.meshes.filter((S=>A.id?S.id===A.id:S.name===A.name));0===S.length&&(S=E.transformNodes.filter((S=>A.id?S.id===A.id:S.name===A.name))),w=A.uniqueId?S.find((S=>S.uniqueId===A.uniqueId)):S[0]}else if(g(n))w=function(S,v){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===S)return e.Vector2.uv(v);if("Rv"===S)return D&&(v[2]*=-1),e.Rv.uv(v);if("Vector4"===S)return e.Vector4.uv(v);if("Quaternion"===S)return D&&(v[2]*=-1,v[3]*=-1),e.Quaternion.uv(v);if("qv"===S)return new z.qv(v[0],v[1],v[2]);if("Ge"===S)return new z.Ge(v[0],v[1],v[2],v[3]);throw new Error(`Unknown vector class name ${S}`)}(n,A.value);else if(function(S){return"AnimationGroup"===S}(n)){const S=E.animationGroups.filter((S=>S.name===A.name));w=1===S.length?S[0]:S.find((S=>S.uniqueId===A.uniqueId))}else w="Matrix"===n?e.Matrix.uv(A.value):"Matrix2D"===n?new B.d(A.value):"Matrix3D"===n?new B.f(A.value):"FlowGraphInteger"===n?N.b.FromValue(A.value):"number"===n||"string"===n||"boolean"===n?A.value[0]:A&&void 0!==A.value?A.value:Array.isArray(A)?A.reduce(((S,v)=>v.eventData?(S[v.id]={type:(0,m.L)(v.type)},"undefined"!==typeof v.value&&(S[v.id].value=h("value",v,D,E)),S):S),{}):A;return w}function A(S){return"FlowGraphJsonPointerParserBlock"===S}},13139:(S,v,D)=>{"use strict";function z(S,v){return!(!S.parent||S.parent!==v&&!z(S.parent,v))}function e(S){if(S.getClassName)return S.getClassName()}function N(S,v){return S===v&&("Vector2"===S||"Rv"===S||"Vector4"===S||"Quaternion"===S)}function m(S,v){return S===v&&("Matrix"===S||"Matrix2D"===S||"Matrix3D"===S)}function B(S,v){return"FlowGraphInteger"===S&&"FlowGraphInteger"===v}function g(S,v){const D="number"===typeof S||"number"===typeof(null===S||void 0===S?void 0:S.value);return D&&!v?!isNaN(E(S)):D}function E(S){return"number"===typeof S?S:S.value}D.d(v,{c:()=>B,d:()=>m,g:()=>N,k:()=>e,m:()=>z,q:()=>E,u:()=>g})},12505:(S,v,D)=>{"use strict";D.r(v),D.d(v,{SceneInstrumentation:()=>N});var z=D(11175),e=D(11601);class N{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(S){S!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=S,S?(this._onBeforeActiveMeshesEvaluationObserver=this.Iv.onBeforeActiveMeshesEvaluationObservable.add((()=>{z.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Iv.onAfterActiveMeshesEvaluationObservable.add((()=>{z.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Iv.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Iv.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(S){S!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=S,S?(this._onBeforeRenderTargetsRenderObserver=this.Iv.onBeforeRenderTargetsRenderObservable.add((()=>{z.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Iv.onAfterRenderTargetsRenderObservable.add((()=>{z.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Iv.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Iv.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(S){S!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=S,S?(this._onBeforeParticlesRenderingObserver=this.Iv.onBeforeParticlesRenderingObservable.add((()=>{z.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Iv.onAfterParticlesRenderingObservable.add((()=>{z.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Iv.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Iv.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(S){S!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=S,this.Iv.spriteManagers&&(S?(this._onBeforeSpritesRenderingObserver=this.Iv.onBeforeSpritesRenderingObservable.add((()=>{z.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Iv.onAfterSpritesRenderingObservable.add((()=>{z.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Iv.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Iv.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(S){S!==this._capturePhysicsTime&&this.Iv.onBeforePhysicsObservable&&(this._capturePhysicsTime=S,S?(this._onBeforePhysicsObserver=this.Iv.onBeforePhysicsObservable.add((()=>{z.Tools.StartPerformanceCounter("qg"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Iv.onAfterPhysicsObservable.add((()=>{z.Tools.EndPerformanceCounter("qg"),this._physicsTime.endMonitoring()}))):(this.Iv.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Iv.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(S){S!==this._captureAnimationsTime&&(this._captureAnimationsTime=S,S?this._onAfterAnimationsObserver=this.Iv.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Iv.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(S){this._captureFrameTime=S}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(S){this._captureInterFrameTime=S}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(S){S!==this._captureRenderTime&&(this._captureRenderTime=S,S?(this._onBeforeDrawPhaseObserver=this.Iv.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),z.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Iv.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),z.Tools.EndPerformanceCounter("Main render")}))):(this.Iv.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Iv.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(S){S!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=S,S?(this._onBeforeCameraRenderObserver=this.Iv.onBeforeCameraRenderObservable.add((S=>{this._cameraRenderTime.beginMonitoring(),z.Tools.StartPerformanceCounter(`Rendering camera ${S.name}`)})),this._onAfterCameraRenderObserver=this.Iv.onAfterCameraRenderObservable.add((S=>{this._cameraRenderTime.endMonitoring(!1),z.Tools.EndPerformanceCounter(`Rendering camera ${S.name}`)}))):(this.Iv.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Iv.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Iv.getEngine()._drawCalls}constructor(S){this.Iv=S,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new e.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new e.b,this._captureFrameTime=!1,this._frameTime=new e.b,this._captureRenderTime=!1,this._renderTime=new e.b,this._captureInterFrameTime=!1,this._interFrameTime=new e.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new e.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new e.b,this._capturePhysicsTime=!1,this._physicsTime=new e.b,this._captureAnimationsTime=!1,this._animationsTime=new e.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new e.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=S.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(z.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Iv.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=S.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(z.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.tz(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.tz(),this._captureParticlesRenderTime&&this._particlesRenderTime.tz(),this._captureSpritesRenderTime&&this._spritesRenderTime.tz(),this._captureRenderTime&&this._renderTime.tz(),this._captureCameraRenderTime&&this._cameraRenderTime.tz()}))}dispose(){this._disposed||(this.Iv.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Iv.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Iv.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Iv.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Iv.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Iv.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Iv.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Iv.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Iv.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Iv.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Iv.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Iv.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Iv.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Iv.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Iv.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Iv.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Iv.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Iv=null,this._disposed=!0)}}},13090:(S,v,D)=>{"use strict";D.d(v,{e:()=>h});var z=D(11358),e=D(11364),N=D(11371),m=D(11797),B=D(11901),g=D(11944),E=D(11329);m.b.AddNodeConstructor("Light_Type_1",((S,v)=>()=>new h(S,N.Rv.Zero(),v)));class h extends g.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(S){this._shadowFrustumSize=S,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(S){this._shadowOrthoScale=S,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(S){this._orthoLeft=S}get orthoRight(){return this._orthoRight}set orthoRight(S){this._orthoRight=S}get orthoTop(){return this._orthoTop}set orthoTop(S){this._orthoTop=S}get orthoBottom(){return this._orthoBottom}set orthoBottom(S){this._orthoBottom=S}constructor(S,v,D){super(S,D),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=v.scale(-1),this.direction=v}getClassName(){return"sg"}getTypeID(){return B.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(S,v,D){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(S):this._setDefaultAutoExtendShadowProjectionMatrix(S,v,D)}_setDefaultFixedFrustumShadowProjectionMatrix(S){const v=this.xS().activeCamera;v&&N.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:v.xe,void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,S,this.xS().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(S,v,D){const z=this.xS().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const S=N.Rv.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let z=Number.MAX_VALUE,e=-Number.MAX_VALUE;for(let m=0;m<D.length;m++){const B=D[m];if(!B)continue;const g=B.getBoundingInfo().boundingBox;for(let D=0;D<g.vectorsWorld.length;D++)N.Rv.TransformCoordinatesToRef(g.vectorsWorld[D],v,S),S.x<this._orthoLeft&&(this._orthoLeft=S.x),S.y<this._orthoBottom&&(this._orthoBottom=S.y),S.x>this._orthoRight&&(this._orthoRight=S.x),S.y>this._orthoTop&&(this._orthoTop=S.y),this.autoCalcShadowZBounds&&(S.z<z&&(z=S.z),S.z>e&&(e=S.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=z,this._shadowMaxZ=e)}const e=this._orthoRight-this._orthoLeft,m=this._orthoTop-this._orthoBottom,B=void 0!==this.shadowMinZ?this.shadowMinZ:(null===z||void 0===z?void 0:z.xe)||0,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===z||void 0===z?void 0:z.maxZ)||1e4,E=this.xS().getEngine().useReverseDepthBuffer;N.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-e*this.shadowOrthoScale,this._orthoRight+e*this.shadowOrthoScale,this._orthoBottom-m*this.shadowOrthoScale,this._orthoTop+m*this.shadowOrthoScale,E?g:B,E?B:g,S,this.xS().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(S,v){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,v),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,v),this)}transferToNodeMaterialEffect(S,v){return this.computeTransformedInformation()?(S.setFloat3(v,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(S.setFloat3(v,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(S){const v=this._scene.getEngine();return!v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:1}getDepthMaxZ(S){const v=this._scene.getEngine();return v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:1}prepareLightSpecificDefines(S,v){S["DIRLIGHT"+v]=!0}}(0,z.b)([(0,e.L)()],h.prototype,"shadowFrustumSize",null),(0,z.b)([(0,e.L)()],h.prototype,"shadowOrthoScale",null),(0,z.b)([(0,e.L)()],h.prototype,"autoUpdateExtends",void 0),(0,z.b)([(0,e.L)()],h.prototype,"autoCalcShadowZBounds",void 0),(0,z.b)([(0,e.L)("orthoLeft")],h.prototype,"_orthoLeft",void 0),(0,z.b)([(0,e.L)("orthoRight")],h.prototype,"_orthoRight",void 0),(0,z.b)([(0,e.L)("orthoTop")],h.prototype,"_orthoTop",void 0),(0,z.b)([(0,e.L)("orthoBottom")],h.prototype,"_orthoBottom",void 0),(0,E.f)("BABYLON.DirectionalLight",h)},13556:(S,v,D)=>{"use strict";D.d(v,{c:()=>h});var z=D(11358),e=D(11364),N=D(11371),m=D(11425),B=D(11797),g=D(11901),E=D(11329);B.b.AddNodeConstructor("Light_Type_3",((S,v)=>()=>new h(S,N.Rv.Zero(),v)));class h extends g.b{constructor(S,v,D){super(S,D),this.groundColor=new m.qv(0,0,0),this.direction=v||N.Rv.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"pg"}setDirectionToTarget(S){return this.direction=N.Rv.Normalize(S.Ov(N.Rv.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(S,v){const D=N.Rv.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",D.x,D.y,D.z,0,v),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.le),v),this}transferToNodeMaterialEffect(S,v){const D=N.Rv.Normalize(this.direction);return S.setFloat3(v,D.x,D.y,D.z),this}ke(){return this._worldMatrix||(this._worldMatrix=N.Matrix.Identity()),this._worldMatrix}getTypeID(){return g.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(S,v){S["HEMILIGHT"+v]=!0}}(0,z.b)([(0,e.k)()],h.prototype,"groundColor",void 0),(0,z.b)([(0,e.H)()],h.prototype,"direction",void 0),(0,E.f)("BABYLON.HemisphericLight",h)},13055:(S,v,D)=>{"use strict";D.d(v,{d:()=>A});var z=D(11358),e=D(11364),N=D(11371),m=D(11797),B=D(11901),g=D(11944),E=D(11350),h=D(11329);m.b.AddNodeConstructor("Light_Type_2",((S,v)=>()=>new A(S,N.Rv.Zero(),N.Rv.Zero(),0,0,v)));class A extends g.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(S){this._iesProfileTexture!==S&&(this._iesProfileTexture=S,this._iesProfileTexture&&A._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(S){this._angle=S,this._cosHalfAngle=Math.cos(.5*S),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(S){this._innerAngle=S,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(S){this._shadowAngleScale=S,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(S){this._projectionTextureLightNear=S,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(S){this._projectionTextureLightFar=S,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(S){this._projectionTextureUpDirection=S,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(S){this._projectionTexture!==S&&(this._projectionTexture=S,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(A._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):A._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(S){return void 0!==S.onGeneratedObservable}static _IsTexture(S){return void 0!==S.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(S){this._projectionTextureProjectionLightMatrix=S,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(S,v,D,z,e,m){super(S,m),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=N.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=N.Rv.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=N.Rv.Zero(),this._projectionTextureViewLightMatrix=N.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=N.Matrix.Zero(),this._projectionTextureScalingMatrix=N.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=v,this.direction=D,this.angle=z,this.exponent=e}getClassName(){return"SpotLight"}getTypeID(){return B.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(S){super._setDirection(S),this._projectionTextureViewLightDirty=!0}_setPosition(S){super._setPosition(S),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(S,v,D){const z=this.xS().activeCamera;if(!z)return;this._shadowAngleScale=this._shadowAngleScale||1;const e=this._shadowAngleScale*this._angle,m=void 0!==this.shadowMinZ?this.shadowMinZ:z.xe,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,g=this.xS().getEngine().useReverseDepthBuffer;N.Matrix.PerspectiveFovLHToRef(e,1,g?B:m,g?m:B,S,!0,this._scene.getEngine().isNDCHalfZRange,void 0,g)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),N.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const S=this.projectionTextureLightFar,v=this.projectionTextureLightNear,D=S/(S-v),z=-D*v,e=1/Math.tan(this._angle/2);N.Matrix.FromValuesToRef(e/1,0,0,0,0,e,0,0,0,0,D,1,0,0,z,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof E.d){const S=this._projectionTexture.uScale/2,v=this._projectionTexture.vScale/2;N.Matrix.FromValuesToRef(S,0,0,0,0,v,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(S,v){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),S.setMatrix("textureProjectionMatrix"+v,this._projectionTextureMatrix),S.setTexture("projectionLightTexture"+v,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&S.setTexture("iesLightTexture"+v,this._iesProfileTexture),this}transferToEffect(S,v){let D;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,v),D=N.Rv.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,v),D=N.Rv.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",D.x,D.y,D.z,this._cosHalfAngle,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,v),this}transferToNodeMaterialEffect(S,v){let D;return D=this.computeTransformedInformation()?N.Rv.Normalize(this.transformedDirection):N.Rv.Normalize(this.direction),this.xS().useRightHandedSystem?S.setFloat3(v,-D.x,-D.y,-D.z):S.setFloat3(v,D.x,D.y,D.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(S){const v=this._scene.getEngine(),D=void 0!==this.shadowMinZ?this.shadowMinZ:(null===S||void 0===S?void 0:S.xe)??0;return v.useReverseDepthBuffer&&v.isNDCHalfZRange?D:this._scene.getEngine().isNDCHalfZRange?0:D}getDepthMaxZ(S){const v=this._scene.getEngine(),D=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===S||void 0===S?void 0:S.maxZ)??1e4;return v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:D}prepareLightSpecificDefines(S,v){S["SPOTLIGHT"+v]=!0,S["PROJECTEDLIGHTTEXTURE"+v]=!(!this.projectionTexture||!this.projectionTexture.isReady()),S["IESLIGHTTEXTURE"+v]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,z.b)([(0,e.L)()],A.prototype,"angle",null),(0,z.b)([(0,e.L)()],A.prototype,"innerAngle",null),(0,z.b)([(0,e.L)()],A.prototype,"shadowAngleScale",null),(0,z.b)([(0,e.L)()],A.prototype,"exponent",void 0),(0,z.b)([(0,e.L)()],A.prototype,"projectionTextureLightNear",null),(0,z.b)([(0,e.L)()],A.prototype,"projectionTextureLightFar",null),(0,z.b)([(0,e.L)()],A.prototype,"projectionTextureUpDirection",null),(0,z.b)([(0,e.D)("projectedLightTexture")],A.prototype,"_projectionTexture",void 0),(0,h.f)("BABYLON.SpotLight",A)},12785:(S,v,D)=>{"use strict";D.d(v,{c:()=>m,g:()=>N,h:()=>B});const z={},e={};function N(S,v){z[S]=v}function m(S,v){e[S]=v}function B(S){return e[S]?e[S]:null}},12677:(S,v,D)=>{"use strict";D.d(v,{d:()=>x,g:()=>M});var z,e=D(11175),N=D(11179),m=D(11619),B=D(11222),g=D(11190),E=D(11831),h=D(11229),A=D(11237),w=D(11336),n=D(11269),R=D(11214);!function(S){S[S.Clean=0]="Clean",S[S.Stop=1]="Stop",S[S.Sync=2]="Sync",S[S.NoSync=3]="NoSync"}(z||(z={}));const O=new N.d,I={};let K=!1;function q(){return I[".babylon"]}function u(S,v){const D=I[S];return D||(g.b.Warn("Unable to find a plugin to load "+S+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),v?q():void 0)}function s(S,v,D){let z="Unable to load from "+(S.rawData?"binary data":S.url);return v?z+=`: ${v}`:D&&(z+=`: ${D}`),z}async function r(S,v,D,z,e,N,m,B,g){var E;const A="data:"===(w=S.url).substring(0,5)?w.substring(5):null;var w;if(S.rawData&&!m)throw"When using ArrayBufferView to load data the file extension must be provided.";const K=A||m?"":function(S){const v=S.indexOf("?");-1!==v&&(S=S.substring(0,v));const D=S.lastIndexOf(".");return S.substring(D,S.length).toLowerCase()}(S.url);let s=m?u(m,!0):A?function(S){for(const v in I){const D=I[v].plugin;if(D.canDirectLoad&&D.canDirectLoad(S))return I[v]}return q()}(S.url):u(K,!1);if(!s&&K){if(S.url&&!S.url.startsWith("blob:")){const v=await async function(S,v){const D=v.method||"GET";return await new Promise(((z,e)=>{const N=new R.c;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const S={};if(v.responseHeaders)for(const D of v.responseHeaders)S[D]=N.getResponseHeader(D)||"";z({response:N.response,headerValues:S})}else e(`Unable to fetch data from ${S}. Error code: ${N.status}`)})),N.open(D,S),N.send()}))}(S.url,{method:"HEAD",responseHeaders:["Content-Type"]}),D=v.headerValues?v.headerValues["Content-Type"]:"";D&&(s=function(S){for(const v in I){const D=I[v];if(D.mimeType===S)return D}}(D))}s||(s=q())}if(!s)throw new Error(`No plugin or fallback for ${m??S.url}`);if(!1===(null===g||void 0===g||null===(E=g[s.plugin.name])||void 0===E?void 0:E.enabled))throw new Error(`The '${s.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(S.rawData&&!s.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(S=>{if(s.plugin.createPlugin){const v=s.plugin.createPlugin(g??{});return v instanceof Promise?(v.then(S).catch((S=>{e("Error instantiating plugin.",S)})),null):(S(v),v)}return S(s.plugin),s.plugin})((g=>{var E;if(!g)throw`The loader plugin corresponding to the '${m}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(O.notifyObservers(g),A&&(g.canDirectLoad&&g.canDirectLoad(S.url)||!(0,h.j)(S.url))){if(g.directLoad){const S=g.directLoad(v,A);S instanceof Promise?S.then((S=>{D(g,S)})).catch((S=>{e("Error in directLoad of _loadData: "+S,S)})):D(g,S)}else D(g,A);return}const w=s.isBinary,R=(S,z)=>{v.h?e("Scene has been disposed"):D(g,S,z)};let I=null,K=!1;null===(E=g.Se)||void 0===E||E.add((()=>{K=!0,I&&(I.abort(),I=null),N()}));const q=()=>{if(K)return;const D=(S,v)=>{e(null===S||void 0===S?void 0:S.statusText,v)};if(!g.loadFile&&S.rawData)throw"Plugin does not support loading ArrayBufferView.";I=g.loadFile?g.loadFile(v,S.rawData||S.file||S.url,S.rootUrl,R,z,w,D,B):v._loadFile(S.file||S.url,R,z,!0,w,D)},u=v.getEngine();let r=u.enableOfflineSupport;if(r){let D=!1;for(const z of v.disableOfflineSupportExceptionRules)if(z.test(S.url)){D=!0;break}r=!D}r&&n.d.OfflineProviderFactory?v.offlineProvider=n.d.OfflineProviderFactory(S.url,q,u.disableManifestCheck):q()}))}function d(S,v){let D,z,N=null,m=null;if(v)if(v.name)D=`file:${v.name}`,z=v.name,N=v;else if(ArrayBuffer.isView(v))D="",z=(0,w.e)(),m=v;else if(v.startsWith("data:"))D=v,z="";else if(S){const N=v;if("/"===N.substring(0,1))return e.Tools.Error("Wrong sceneFilename parameter"),null;D=S+N,z=N}else D=v,z=e.Tools.GetFilename(v),S=e.Tools.GetFolderPath(v);else D=S,z=e.Tools.GetFilename(S),S=e.Tools.GetFolderPath(S);return{url:D,rootUrl:S,name:z,file:N,rawData:m}}function x(S){if("string"===typeof S.extensions){const v=S.extensions;I[v.toLowerCase()]={plugin:S,isBinary:!1}}else{const v=S.extensions,D=Object.keys(v);for(const z of D)I[z.toLowerCase()]={plugin:S,isBinary:v[z].isBinary,mimeType:v[z].mimeType}}}async function W(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.c.LastCreatedScene,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",w=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!z)return g.b.Error("No scene available to import mesh to"),null;const n=d(v,D);if(!n)return null;const R={};z.addPendingData(R);const O=()=>{z.removePendingData(R)},I=(S,v)=>{const D=s(n,S,v);m?m(z,D,new A.g(D,A.f.SceneLoaderError,v)):g.b.Error(D),O()},K=N?S=>{try{N(S)}catch(v){I("Error in onProgress callback: "+v,v)}}:void 0,q=(S,v,D,N,m,B,g,E)=>{if(z.importedMeshesFiles.push(n.url),e)try{e(S,v,D,N,m,B,g,E)}catch(h){I("Error in onSuccess callback: "+h,h)}z.removePendingData(R)};return await r(n,z,((v,D,e)=>{if(v.rewriteRootURL&&(n.rootUrl=v.rewriteRootURL(n.rootUrl,e)),v.importMesh){const e=[],N=[],m=[];if(!v.importMesh(S,z,D,n.rootUrl,e,N,m,I))return;z.loadingPluginName=v.name,q(e,N,m,[],[],[],[],[])}else{v.importMeshAsync(S,z,D,n.rootUrl,K,n.name).then((S=>{z.loadingPluginName=v.name,q(S.meshes,S.Zw,S.skeletons,S.animationGroups,S.transformNodes,S.geometries,S.lights,S.spriteManagers)})).catch((S=>{I(S.message,S)}))}}),K,I,O,E,h,w)}async function p(S,v,D,z,e,N,m,B){return await new Promise(((g,E)=>{try{W(S,v,D,z,((S,v,D,z,e,N,m,B)=>{g({meshes:S,Zw:v,skeletons:D,animationGroups:z,transformNodes:e,geometries:N,lights:m,spriteManagers:B})}),e,((S,v,D)=>{E(D||new Error(v))}),N,m,B).catch(E)}catch(A){E(A)}}))}async function b(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.c.LastCreatedEngine,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};D?await Z(S,v,new m.d(D),z,N,g,E,h,A):e.Tools.Error("No engine available")}async function k(S,v,D,z,e,N,m){return await new Promise(((B,g)=>{b(S,v,D,(S=>{B(S)}),z,((S,v,D)=>{g(D||new Error(v))}),e,N,m)}))}async function Z(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.c.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!D)return g.b.Error("No scene available to append to"),null;const n=d(S,v);if(!n)return null;const R={};D.addPendingData(R);const O=()=>{D.removePendingData(R)};E.c.ShowLoadingScreen&&!K&&(K=!0,D.getEngine().displayLoadingUI(),D.executeWhenReady((()=>{D.getEngine().hideLoadingUI(),K=!1})));const I=(S,v)=>{const z=s(n,S,v);N?N(D,z,new A.g(z,A.f.SceneLoaderError,v)):g.b.Error(z),O()},q=e?S=>{try{e(S)}catch(v){I("Error in onProgress callback",v)}}:void 0,u=()=>{if(z)try{z(D)}catch(S){I("Error in onSuccess callback",S)}D.removePendingData(R)};return await r(n,D,((S,v)=>{if(S.load){if(!S.load(D,v,n.rootUrl,I))return;D.loadingPluginName=S.name,u()}else{S.loadAsync(D,v,n.rootUrl,q,n.name).then((()=>{D.loadingPluginName=S.name,u()})).catch((S=>{I(S.message,S)}))}}),q,I,O,m,h,w)}async function i(S,v,D,z,e,N,m){return await new Promise(((B,g)=>{try{Z(S,v,D,(S=>{B(S)}),z,((S,v,D)=>{g(D||new Error(v))}),e,N,m).catch(g)}catch(A){g(A)}}))}async function t(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.c.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!D)return g.b.Error("No scene available to load asset container to"),null;const w=d(S,v);if(!w)return null;const n={};D.addPendingData(n);const R=()=>{D.removePendingData(n)},O=(S,v)=>{const z=s(w,S,v);N?N(D,z,new A.g(z,A.f.SceneLoaderError,v)):g.b.Error(z),R()},I=e?S=>{try{e(S)}catch(v){O("Error in onProgress callback",v)}}:void 0,K=S=>{if(z)try{z(S)}catch(v){O("Error in onSuccess callback",v)}D.removePendingData(n)};return await r(w,D,((S,v)=>{if(S.loadAssetContainer){const z=S.loadAssetContainer(D,v,w.rootUrl,O);if(!z)return;z.populateRootNodes(),D.loadingPluginName=S.name,K(z)}else if(S.loadAssetContainerAsync){S.loadAssetContainerAsync(D,v,w.rootUrl,I,w.name).then((v=>{v.populateRootNodes(),D.loadingPluginName=S.name,K(v)})).catch((S=>{O(S.message,S)}))}else O("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),I,O,R,m,E,h)}async function X(S,v,D,z,e,N,m){return await new Promise(((B,g)=>{try{t(S,v,D,(S=>{B(S)}),z,((S,v,D)=>{g(D||new Error(v))}),e,N,m).catch(g)}catch(A){g(A)}}))}async function a(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.c.LastCreatedScene,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,w=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!D)return void g.b.Error("No scene available to load animations to");if(z){for(const z of D.animatables)z.reset();D.stopAllAnimations();const S=D.animationGroups.slice();for(const D of S)D.dispose();const v=D.getNodes();for(const D of v)D.animations&&(D.animations=[])}else switch(e){case 0:const S=D.animationGroups.slice();for(const v of S)v.dispose();break;case 1:for(const v of D.animationGroups)v.stop();break;case 2:for(const v of D.animationGroups)v.reset(),v.restart();break;case 3:break;default:return void g.b.Error("Unknown animation group loading mode value '"+e+"'")}const R=D.animatables.length;await t(S,v,D,(S=>{S.mergeAnimationsTo(D,D.animatables.slice(R),N),S.dispose(),D.onAnimationFileImportedObservable.notifyObservers(D),m&&m(D)}),E,h,A,w,n)}async function o(S,v,D,z,e,N,m,B,g,E){return await new Promise(((h,w)=>{try{a(S,v,D,z,e,N,(S=>{h(S)}),m,((S,v,D)=>{w(D||new Error(v))}),B,g,E).catch(w)}catch(A){w(A)}}))}class M{static get ForceFullSceneLoadingForIncremental(){return E.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(S){E.c.ForceFullSceneLoadingForIncremental=S}static get ShowLoadingScreen(){return E.c.ShowLoadingScreen}static set ShowLoadingScreen(S){E.c.ShowLoadingScreen=S}static get loggingLevel(){return E.c.loggingLevel}static set loggingLevel(S){E.c.loggingLevel=S}static get CleanBoneMatrixWeights(){return E.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(S){E.c.CleanBoneMatrixWeights=S}static GetDefaultPlugin(){return q()}static GetPluginForExtension(S){var v;return null===(v=u(S,!0))||void 0===v?void 0:v.plugin}static IsPluginForExtensionAvailable(S){return function(S){return!!I[S]}(S)}static RegisterPlugin(S){x(S)}static ImportMesh(S,v,D,z,e,N,m,g,E){W(S,v,D,z,e,N,m,g,E).catch((S=>null===m||void 0===m?void 0:m(B.c.LastCreatedScene,null===S||void 0===S?void 0:S.message,S)))}static async ImportMeshAsync(S,v,D,z,e,N,m){return await p(S,v,D,z,e,N,m)}static Load(S,v,D,z,e,N,m,g){b(S,v,D,z,e,N,m,g).catch((S=>null===N||void 0===N?void 0:N(B.c.LastCreatedScene,null===S||void 0===S?void 0:S.message,S)))}static async LoadAsync(S,v,D,z,e,N){return await k(S,v,D,z,e,N)}static Append(S,v,D,z,e,N,m,g){Z(S,v,D,z,e,N,m,g).catch((S=>null===N||void 0===N?void 0:N(D??B.c.LastCreatedScene,null===S||void 0===S?void 0:S.message,S)))}static async AppendAsync(S,v,D,z,e,N){return await i(S,v,D,z,e,N)}static LoadAssetContainer(S,v,D,z,e,N,m,g){t(S,v,D,z,e,N,m,g).catch((S=>null===N||void 0===N?void 0:N(D??B.c.LastCreatedScene,null===S||void 0===S?void 0:S.message,S)))}static async LoadAssetContainerAsync(S,v,D,z,e,N){return await X(S,v,D,z,e,N)}static ImportAnimations(S,v,D,z,e,N,m,g,E,h,A){a(S,v,D,z,e,N,m,g,E,h,A).catch((S=>null===E||void 0===E?void 0:E(D??B.c.LastCreatedScene,null===S||void 0===S?void 0:S.message,S)))}static async ImportAnimationsAsync(S,v,D,z,e,N,m,B,g,E,h){return await o(S,v,D,z,e,N,B,E,h)}}M.NO_LOGGING=0,M.MINIMAL_LOGGING=1,M.SUMMARY_LOGGING=2,M.DETAILED_LOGGING=3,M.OnPluginActivatedObservable=O},13074:(S,v,D)=>{"use strict";D.d(v,{d:()=>w});var z=D(11358),e=D(11364),N=D(11175),m=D(11371),B=D(11400),g=D(11350),E=D(11329),h=D(11179),A=D(11415);D(13082);class w extends B.e{set boundingBoxSize(S){if(this._boundingBoxSize&&this._boundingBoxSize.equals(S))return;this._boundingBoxSize=S;const v=this.xS();v&&v.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(S){this._rotationY=S,this.setReflectionTextureMatrix(m.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(S,v,D){let z="";for(const e of S)z+=e;return new w(z,v,null,D,S)}static CreateFromPrefilteredData(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const e=v.useDelayedTextureLoading;v.useDelayedTextureLoading=!1;const N=new w(S,v,null,!1,null,null,null,void 0,!0,D,z);return v.useDelayedTextureLoading=e,N}constructor(S,v){var D;let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,w=arguments.length>8&&void 0!==arguments[8]&&arguments[8],n=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,R=arguments.length>10&&void 0!==arguments[10]&&arguments[10],O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,I=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,K=arguments.length>13?arguments[13]:void 0,q=arguments.length>14?arguments[14]:void 0;super(v),this.onLoadObservable=new h.d,this.boundingBoxPosition=m.Rv.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new m.Matrix,this._buffer=null,this.name=S,this.url=S,this._noMipmap=e,this.de=!1,this.isCube=!0,this._textureMatrix=m.Matrix.Identity(),this.coordinatesMode=g.d.CUBIC_MODE;let u=null,s=null;null===z||Array.isArray(z)?(this._noMipmap=e,this._format=A,this._createPolynomials=R,u=z,this._loaderOptions=K,this._useSRGBBuffer=q,this._lodScale=O,this._lodOffset=I):(u=z.extensions??null,this._noMipmap=z.noMipmap??!1,N=z.files??null,s=z.buffer??null,this._format=z.format??5,w=z.prefiltered??!1,n=z.forcedExtension??null,this._createPolynomials=z.createPolynomials??!1,this._lodScale=z.lodScale??.8,this._lodOffset=z.lodOffset??0,this._loaderOptions=z.loaderOptions,this._useSRGBBuffer=z.useSRGBBuffer,B=z.l??null,E=z.onError??null),(S||N)&&this.updateURL(S,n,B,w,E,u,null===(D=this.xS())||void 0===D?void 0:D.useDelayedTextureLoading,N,s)}getClassName(){return"CubeTexture"}updateURL(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=S),this.url=S,v&&(this._forcedExtension=v);const E=S.lastIndexOf("."),h=v||(E>-1?S.substring(E).toLowerCase():""),A=0===h.indexOf(".dds"),w=0===h.indexOf(".env"),n=0===h.indexOf(".basis");if(w?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=z,z&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),B)this._files=B;else if(n||w||A||N||(N=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,N){for(let v=0;v<N.length;v++)this._files.push(S+N[v]);this._extensions=N}this._buffer=g,m?(this.delayLoadState=4,this._delayedOnLoad=D,this._delayedOnError=e):this._loadTexture(D,e)}delayLoad(S){4===this.delayLoadState&&(S&&(this._forcedExtension=S),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(S){var v,D;if(S.updateFlag===this._textureMatrix.updateFlag)return;S.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(D=this.xS())||void 0===D||D.markAllMaterialsAsDirty(1,(S=>-1!==S.getActiveTextures().indexOf(this))));if(this._textureMatrix=S,null===(v=this.xS())||void 0===v||!v.useRightHandedSystem)return;const z=m.TmpVectors.Rv[0],e=m.TmpVectors.Quaternion[0],N=m.TmpVectors.Rv[1];this._textureMatrix.decompose(z,e,N),e.z*=-1,e.w*=-1,m.Matrix.ComposeToRef(z,e,N,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var S;return null!==(S=this.xS())&&void 0!==S&&S.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=this.xS(),z=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const e=()=>{var v;(this.onLoadObservable.notifyObservers(this),z)&&(z.dispose(),null===(v=this.xS())||void 0===v||v.markAllMaterialsAsDirty(1));S&&S()},m=(S,D)=>{this._loadingError=!0,this._errorObject={message:S,exception:D},v&&v(S,D),g.d.OnTextureLoadErrorObservable.notifyObservers(this)};var B;this._texture?this._texture.isReady?N.Tools.SetImmediate((()=>e())):this._texture.onLoadedObservable.add((()=>e())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,D,this._lodScale,this._lodOffset,S,m,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,D,this._files,this._noMipmap,S,m,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(B=this._texture)||void 0===B||B.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(S,v,D){const z=A.b.Parse((()=>{let z=!1;return S.prefiltered&&(z=S.prefiltered),new w(D+(S.url??S.name),v,S.extensions,!1,S.files||null,null,null,void 0,z,S.forcedExtension)}),S,v);if(S.boundingBoxPosition&&(z.boundingBoxPosition=m.Rv.uv(S.boundingBoxPosition)),S.boundingBoxSize&&(z.boundingBoxSize=m.Rv.uv(S.boundingBoxSize)),S.animations)for(let e=0;e<S.animations.length;e++){const v=S.animations[e],D=(0,E.e)("BABYLON.Animation");D&&z.animations.push(D.Parse(v))}return z}clone(){let S=0;const v=A.b.Clone((()=>{const v=new w(this.url,this.xS()||this._getEngine(),this._extensions,this._noMipmap,this._files);return S=v.uniqueId,v}),this);return v.uniqueId=S,v}}(0,z.b)([(0,e.L)()],w.prototype,"url",void 0),(0,z.b)([(0,e.H)()],w.prototype,"boundingBoxPosition",void 0),(0,z.b)([(0,e.H)()],w.prototype,"boundingBoxSize",null),(0,z.b)([(0,e.L)("rotationY")],w.prototype,"rotationY",null),(0,z.b)([(0,e.L)("files")],w.prototype,"_files",void 0),(0,z.b)([(0,e.L)("forcedExtension")],w.prototype,"_forcedExtension",void 0),(0,z.b)([(0,e.L)("extensions")],w.prototype,"_extensions",void 0),(0,z.b)([(0,e.w)("textureMatrix")],w.prototype,"_textureMatrix",void 0),(0,z.b)([(0,e.w)("textureMatrixRefraction")],w.prototype,"_textureMatrixRefraction",void 0),g.d._CubeTextureParser=w.Parse,(0,E.f)("BABYLON.CubeTexture",w)},13566:(S,v,D)=>{"use strict";D.d(v,{d:()=>g});var z=D(11190),e=D(11350),N=D(11345),m=D(11510),B=D(11301);m.ThinEngine.prototype.createDynamicTexture=function(S,v,D,z){const e=new B.b(this,4);return e.baseWidth=S,e.baseHeight=v,D&&(S=this.needPOTTextures?(0,N.d)(S,this._caps.maxTextureSize):S,v=this.needPOTTextures?(0,N.d)(v,this._caps.maxTextureSize):v),e.width=S,e.height=v,e.isReady=!1,e.generateMipMaps=D,e.samplingMode=z,this.updateTextureSamplingMode(z,e),this._internalTexturesCache.push(e),e},m.ThinEngine.prototype.updateDynamicTexture=function(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],e=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!S)return;const m=this._gl,B=m.TEXTURE_2D,g=this._bindTextureDirectly(B,S,!0,N);this._unpackFlipY(void 0===D?S.invertY:D),z&&m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const E=this._getWebGLTextureType(S.type),h=this._getInternalFormat(e||S.format),A=this._getRGBABufferInternalSizedFormat(S.type,h);m.texImage2D(B,0,A,h,E,v),S.generateMipMaps&&m.generateMipmap(B),g||this._bindTextureDirectly(B,null),z&&m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e&&(S.format=e),S._dynamicTextureSource=v,S._premulAlpha=z,S.invertY=D||!1,S.isReady=!0};class g extends e.d{constructor(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,B=arguments.length>6?arguments[6]:void 0;const g=!D||D._isScene;super(null,g?D:null===D||void 0===D?void 0:D.Iv,g?!z:D,B,N,void 0,void 0,void 0,void 0,m),this.name=S,this.wrapU=e.d.CLAMP_ADDRESSMODE,this.wrapV=e.d.CLAMP_ADDRESSMODE,this._generateMipMaps=z;const E=this._getEngine();if(!E)return;if(v.getContext)this._canvas=v,this._ownCanvas=!1,this._texture=E.createDynamicTexture(this._canvas.width,this._canvas.height,z,N);else{this._canvas=E.createCanvas(1,1),this._ownCanvas=!0;const S=v;S.width||0===S.width?this._texture=E.createDynamicTexture(S.width,S.height,z,N):this._texture=E.createDynamicTexture(v,v,z,N)}const h=this.getSize();this._canvas.width!==h.width&&(this._canvas.width=h.width),this._canvas.height!==h.height&&(this._canvas.height=h.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(S){this._canvas.width=S.width,this._canvas.height=S.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(S.width,S.height,this._generateMipMaps,this.samplingMode)}scale(S){const v=this.getSize();v.width*=S,v.height*=S,this._recreate(v)}scaleTo(S,v){const D=this.getSize();D.width=S,D.height=v,this._recreate(D)}getContext(){return this._context}clear(S){const v=this.getSize();S&&(this._context.fillStyle=S),this._context.clearRect(0,0,v.width,v.height)}update(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===S||S,v,this._format||void 0,void 0,D)}drawText(S,v,D,z,e,N,m){let B=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const g=this.getSize();if(N&&(this._context.fillStyle=N,this._context.fillRect(0,0,g.width,g.height)),this._context.font=z,null===v||void 0===v){const D=this._context.measureText(S);v=(g.width-D.width)/2}if(null===D||void 0===D){const S=parseInt(z.replace(/\D/g,""));D=g.height/2+S/3.65}this._context.fillStyle=e||"",this._context.fillText(S,v,D),B&&this.update(m)}dispose(){var S,v;(super.dispose(),this._ownCanvas)&&(null===(S=this._canvas)||void 0===S||null===(v=S.remove)||void 0===v||v.call(S));this._canvas=null,this._context=null}clone(){const S=this.xS();if(!S)return this;const v=this.getSize(),D=new g(this.name,v,S,this._generateMipMaps);return D.de=this.de,D.level=this.level,D.wrapU=this.wrapU,D.wrapV=this.wrapV,D}serialize(){const S=this.xS();S&&!S.isReady()&&z.b.Warn("The scene must be ready before serializing the dynamic texture");const v=super.serialize();return g._IsCanvasElement(this._canvas)&&(v.base64String=this._canvas.toDataURL()),v.invertY=this._invertY,v.samplingMode=this.samplingMode,v}static _IsCanvasElement(S){return void 0!==S.toDataURL}_rebuild(){this.update()}}},12989:(S,v,D)=>{"use strict";D.d(v,{d:()=>e});var z=D(11350);class e extends z.d{get depth(){return this._depth}constructor(S,v,D,e,N,m){let B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],g=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:z.d.TRILINEAR_SAMPLINGMODE,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,A=arguments.length>10?arguments[10]:void 0;super(null,m,!B,g),this.format=N,this._texture=m.getEngine().createRawTexture2DArray(S,v,D,e,N,B,g,E,null,h,A),this._depth=e,this.is2DArray=!0}update(S){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,S,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(S,v,D,z,N){return new e(S,v,D,z,5,N,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12796:(S,v,D)=>{"use strict";D.d(v,{e:()=>B,g:()=>g,h:()=>N,j:()=>m});var z=D(11393),e=D(11371);function N(S,v){return`{X: ${S.x.toFixed(v)} Y: ${S.y.toFixed(v)}}`}function m(S,v){return`{X: ${S._x.toFixed(v)} Y: ${S._y.toFixed(v)} Z: ${S._z.toFixed(v)}}`}function B(S,v){return 2*Math.acos((0,z.Clamp)(e.Quaternion.Dot(S,v)))}function g(S,v){const D=new e.Quaternion;return function(S,v,D){const N=e.Rv.Cross(S,v),m=Math.acos((0,z.Clamp)(e.Rv.Dot(S,v),-1,1));e.Quaternion.RotationAxisToRef(N,m,D)}(S,v,D),D}},12621:(S,v,D)=>{"use strict";D.d(v,{b:()=>E});var z=D(11371),e=D(11425),N=D(11819),m=D(11806),B=D(11433);D(12630);function g(S){let v=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const D=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],N=[];let g=[];const E=S.width||S.size||1,h=S.height||S.size||1,A=S.depth||S.size||1,w=S.wrap||!1;let n=void 0===S.topBaseAt?1:S.topBaseAt,R=void 0===S.bottomBaseAt?0:S.bottomBaseAt;n=(n+4)%4,R=(R+4)%4;let O=[2,0,3,1][n],I=[2,0,1,3][R],K=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(w){v=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],K=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let S=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],D=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const z=[17,18,19,16],e=[22,23,20,21];for(;O>0;)S.unshift(S.pop()),z.unshift(z.pop()),O--;for(;I>0;)D.unshift(D.pop()),e.unshift(e.pop()),I--;S=S.flat(),D=D.flat(),K=K.concat(S).concat(D),v.push(z[0],z[2],z[3],z[0],z[1],z[2]),v.push(e[0],e[2],e[3],e[0],e[1],e[2])}const q=[E/2,h/2,A/2];g=K.reduce(((S,v,D)=>S.concat(v*q[D%3])),[]);const u=0===S.sideOrientation?0:S.sideOrientation||m.e.DEFAULTSIDE,s=S.faceUV||new Array(6),r=S.faceColors,d=[];for(let m=0;m<6;m++)void 0===s[m]&&(s[m]=new z.Vector4(0,0,1,1)),r&&void 0===r[m]&&(r[m]=new e.Ge(1,1,1,1));for(let z=0;z<6;z++)if(N.push(s[z].z,B.b?1-s[z].w:s[z].w),N.push(s[z].x,B.b?1-s[z].w:s[z].w),N.push(s[z].x,B.b?1-s[z].y:s[z].y),N.push(s[z].z,B.b?1-s[z].y:s[z].y),r)for(let S=0;S<4;S++)d.push(r[z].r,r[z].g,r[z].b,r[z].a);m.e._ComputeSides(u,g,v,D,N,S.frontUVs,S.backUVs);const x=new m.e;if(x.indices=v,x.pS=g,x.bS=D,x.ZS=N,r){const S=u===m.e.DOUBLESIDE?d.concat(d):d;x.kS=S}return x}function E(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new N.e(S,D);v.sideOrientation=N.e._GetDefaultSideOrientation(v.sideOrientation),z._originalBuilderSideOrientation=v.sideOrientation;return g(v).tS(z,v.updatable),z}m.e.CreateBox=g,N.e.CreateBox=function(S,v){return E(S,{size:v,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12788:(S,v,D)=>{"use strict";D.d(v,{d:()=>B});var z=D(11819),e=D(11806),N=D(11433);function m(S){const v=[],D=[],z=[],m=[],B=S.radius||.5,g=S.tessellation||64,E=S.arc&&(S.arc<=0||S.arc>1)?1:S.arc||1,h=0===S.sideOrientation?0:S.sideOrientation||e.e.DEFAULTSIDE;v.push(0,0,0),m.push(.5,.5);const A=2*Math.PI*E,w=1===E?A/g:A/(g-1);let n=0;for(let e=0;e<g;e++){const S=Math.cos(n),D=Math.sin(n),z=(S+1)/2,e=(1-D)/2;v.push(B*S,B*D,0),m.push(z,N.b?1-e:e),n+=w}1===E&&(v.push(v[3],v[4],v[5]),m.push(m[2],N.b?1-m[3]:m[3]));const R=v.length/3;for(let e=1;e<R-1;e++)D.push(e+1,0,e);e.e.ComputeNormals(v,D,z),e.e._ComputeSides(h,v,D,z,m,S.frontUVs,S.backUVs);const O=new e.e;return O.indices=D,O.pS=v,O.bS=z,O.ZS=m,O}function B(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new z.e(S,D);v.sideOrientation=z.e._GetDefaultSideOrientation(v.sideOrientation),e._originalBuilderSideOrientation=v.sideOrientation;return m(v).tS(e,v.updatable),e}e.e.CreateDisc=m,z.e.CreateDisc=function(S,v,D){return B(S,{radius:v,tessellation:D,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12630:(S,v,D)=>{"use strict";D.d(v,{e:()=>I,c:()=>q,h:()=>K});var z=D(11371),e=D(11425),N=D(11819),m=D(11806),B=D(11452);N.e._GroundMeshParser=(S,v)=>g.Parse(S,v);class g extends N.e{constructor(S,v){super(S,v),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=S,this._subdivisionsY=S,this.subdivide(S);const D=this;D.createOrUpdateSubmeshesOctree&&D.createOrUpdateSubmeshesOctree(v)}getHeightAtCoordinates(S,v){const D=this.getWorldMatrix(),e=z.TmpVectors.Matrix[5];D.invertToRef(e);const N=z.TmpVectors.Rv[8];if(z.Rv.TransformCoordinatesFromFloatsToRef(S,0,v,e,N),S=N.x,v=N.z,S<this._minX||S>=this._maxX||v<=this._minZ||v>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const m=this._getFacetAt(S,v),B=-(m.x*S+m.z*v+m.w)/m.y;return z.Rv.TransformCoordinatesFromFloatsToRef(0,B,0,D,N),N.y}getNormalAtCoordinates(S,v){const D=new z.Rv(0,1,0);return this.getNormalAtCoordinatesToRef(S,v,D),D}getNormalAtCoordinatesToRef(S,v,D){const e=this.getWorldMatrix(),N=z.TmpVectors.Matrix[5];e.invertToRef(N);const m=z.TmpVectors.Rv[8];if(z.Rv.TransformCoordinatesFromFloatsToRef(S,0,v,N,m),S=m.x,v=m.z,S<this._minX||S>this._maxX||v<this._minZ||v>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const B=this._getFacetAt(S,v);return z.Rv.TransformNormalFromFloatsToRef(B.x,B.y,B.z,e,D),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(S,v){const D=Math.floor((S+this._maxX)*this._subdivisionsX/this._width),z=Math.floor(-(v+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),e=this._heightQuads[z*this._subdivisionsX+D];let N;return N=v<e.slope.x*S+e.slope.y?e.facet1:e.facet2,N}_initHeightQuads(){const S=this._subdivisionsX,v=this._subdivisionsY;this._heightQuads=[];for(let D=0;D<v;D++)for(let v=0;v<S;v++){const e={slope:z.Vector2.Zero(),facet1:new z.Vector4(0,0,0,0),facet2:new z.Vector4(0,0,0,0)};this._heightQuads[D*S+v]=e}return this}_computeHeightQuads(){const S=this.getVerticesData(B.d.PositionKind);if(!S)return this;const v=z.TmpVectors.Rv[3],D=z.TmpVectors.Rv[2],e=z.TmpVectors.Rv[1],N=z.TmpVectors.Rv[0],m=z.TmpVectors.Rv[4],g=z.TmpVectors.Rv[5],E=z.TmpVectors.Rv[6],h=z.TmpVectors.Rv[7],A=z.TmpVectors.Rv[8];let w=0,n=0,R=0,O=0,I=0,K=0,q=0;const u=this._subdivisionsX,s=this._subdivisionsY;for(let B=0;B<s;B++)for(let s=0;s<u;s++){w=3*s,n=B*(u+1)*3,R=(B+1)*(u+1)*3,v.x=S[n+w],v.y=S[n+w+1],v.z=S[n+w+2],D.x=S[n+w+3],D.y=S[n+w+4],D.z=S[n+w+5],e.x=S[R+w],e.y=S[R+w+1],e.z=S[R+w+2],N.x=S[R+w+3],N.y=S[R+w+4],N.z=S[R+w+5],O=(N.z-v.z)/(N.x-v.x),I=v.z-O*v.x,D.subtractToRef(v,m),e.subtractToRef(v,g),N.subtractToRef(v,E),z.Rv.CrossToRef(E,g,h),z.Rv.CrossToRef(m,E,A),h.normalize(),A.normalize(),K=-(h.x*v.x+h.y*v.y+h.z*v.z),q=-(A.x*D.x+A.y*D.y+A.z*D.z);const r=this._heightQuads[B*u+s];r.slope.oe(O,I),r.facet1.oe(h.x,h.y,h.z,K),r.facet2.oe(A.x,A.y,A.z,q)}return this}serialize(S){super.serialize(S),S.subdivisionsX=this._subdivisionsX,S.subdivisionsY=this._subdivisionsY,S.minX=this._minX,S.maxX=this._maxX,S.xe=this._minZ,S.maxZ=this._maxZ,S.width=this._width,S.height=this._height}static Parse(S,v){const D=new g(S.name,v);return D._subdivisionsX=S.subdivisionsX||1,D._subdivisionsY=S.subdivisionsY||1,D._minX=S.minX,D._maxX=S.maxX,D._minZ=S.xe,D._maxZ=S.maxZ,D._width=S.width,D._height=S.height,D}}var E=D(11175),h=D(11222),A=D(11377),w=D(11433);function n(S){const v=[],D=[],e=[],N=[];let B,g;const E=S.width||S.size||1,h=S.height||S.size||1,A=0|(S.subdivisionsX||S.subdivisions||1),n=0|(S.subdivisionsY||S.subdivisions||1);for(B=0;B<=n;B++)for(g=0;g<=A;g++){const S=new z.Rv(g*E/A-E/2,0,(n-B)*h/n-h/2),v=new z.Rv(0,1,0);D.push(S.x,S.y,S.z),e.push(v.x,v.y,v.z),N.push(g/A,w.b?B/n:1-B/n)}for(B=0;B<n;B++)for(g=0;g<A;g++)v.push(g+1+(B+1)*(A+1)),v.push(g+1+B*(A+1)),v.push(g+B*(A+1)),v.push(g+(B+1)*(A+1)),v.push(g+1+(B+1)*(A+1)),v.push(g+B*(A+1));const R=new m.e;return R.indices=v,R.pS=D,R.bS=e,R.ZS=N,R}function R(S){const v=void 0!==S.xmin&&null!==S.xmin?S.xmin:-1,D=void 0!==S.zmin&&null!==S.zmin?S.zmin:-1,e=void 0!==S.xmax&&null!==S.xmax?S.xmax:1,N=void 0!==S.zmax&&null!==S.zmax?S.zmax:1,B=S.subdivisions||{w:1,h:1},g=S.precision||{w:1,h:1},E=[],h=[],A=[],w=[];let n,R,O,I;B.h=B.h<1?1:B.h,B.w=B.w<1?1:B.w,g.w=g.w<1?1:g.w,g.h=g.h<1?1:g.h;const K=(e-v)/B.w,q=(N-D)/B.h;function u(S,v,D,e){const N=h.length/3,m=g.w+1;for(n=0;n<g.h;n++)for(R=0;R<g.w;R++){const S=[N+R+n*m,N+(R+1)+n*m,N+(R+1)+(n+1)*m,N+R+(n+1)*m];E.push(S[1]),E.push(S[2]),E.push(S[3]),E.push(S[0]),E.push(S[1]),E.push(S[3])}const B=z.Rv.Zero(),O=new z.Rv(0,1,0);for(n=0;n<=g.h;n++)for(B.z=n*(e-v)/g.h+v,R=0;R<=g.w;R++)B.x=R*(D-S)/g.w+S,B.y=0,h.push(B.x,B.y,B.z),A.push(O.x,O.y,O.z),w.push(R/g.w,n/g.h)}for(O=0;O<B.h;O++)for(I=0;I<B.w;I++)u(v+I*K,D+O*q,v+(I+1)*K,D+(O+1)*q);const s=new m.e;return s.indices=E,s.pS=h,s.bS=A,s.ZS=w,s}function O(S){const v=[],D=[],N=[],B=[];let g,E;const h=S.colorFilter||new e.qv(.3,.59,.11),w=S.alphaFilter||0;let n=!1;if(S.minHeight>S.maxHeight){n=!0;const v=S.maxHeight;S.maxHeight=S.minHeight,S.minHeight=v}for(g=0;g<=S.subdivisions;g++)for(E=0;E<=S.subdivisions;E++){const v=new z.Rv(E*S.width/S.subdivisions-S.width/2,0,(S.subdivisions-g)*S.height/S.subdivisions-S.height/2),e=4*(((v.x+S.width/2)/S.width*(S.bufferWidth-1)|0)+((1-(v.z+S.height/2)/S.height)*(S.bufferHeight-1)|0)*S.bufferWidth);let m=S.buffer[e]/255,R=S.buffer[e+1]/255,O=S.buffer[e+2]/255;const I=S.buffer[e+3]/255;n&&(m=1-m,R=1-R,O=1-O);const K=m*h.r+R*h.g+O*h.b;v.y=I>=w?S.minHeight+(S.maxHeight-S.minHeight)*K:S.minHeight-A.e,S.heightBuffer&&(S.heightBuffer[g*(S.subdivisions+1)+E]=v.y),D.push(v.x,v.y,v.z),N.push(0,0,0),B.push(E/S.subdivisions,1-g/S.subdivisions)}for(g=0;g<S.subdivisions;g++)for(E=0;E<S.subdivisions;E++){const z=E+1+(g+1)*(S.subdivisions+1),e=E+1+g*(S.subdivisions+1),N=E+g*(S.subdivisions+1),m=E+(g+1)*(S.subdivisions+1),B=D[3*z+1]>=S.minHeight,h=D[3*e+1]>=S.minHeight,A=D[3*N+1]>=S.minHeight;B&&h&&A&&(v.push(z),v.push(e),v.push(N));D[3*m+1]>=S.minHeight&&B&&A&&(v.push(m),v.push(z),v.push(N))}m.e.ComputeNormals(D,v,N);const R=new m.e;return R.indices=v,R.pS=D,R.bS=N,R.ZS=B,R}function I(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const D=new g(S,arguments.length>2?arguments[2]:void 0);D._setReady(!1),D._subdivisionsX=v.subdivisionsX||v.subdivisions||1,D._subdivisionsY=v.subdivisionsY||v.subdivisions||1,D._width=v.width||1,D._height=v.height||1,D._maxX=D._width/2,D._maxZ=D._height/2,D._minX=-D._maxX,D._minZ=-D._maxZ;return n(v).tS(D,v.updatable),D._setReady(!0),D}function K(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new N.e(S,D);return R(v).tS(z,v.updatable),z}function q(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=D.width||10,m=D.height||10,B=D.subdivisions||1,A=D.minHeight||0,w=D.maxHeight||1,n=D.colorFilter||new e.qv(.3,.59,.11),R=D.alphaFilter||0,I=D.updatable,K=D.onReady;z=z||h.c.LastCreatedScene;const q=new g(S,z);let u;q._subdivisionsX=B,q._subdivisionsY=B,q._width=N,q._height=m,q._maxX=q._width/2,q._maxZ=q._height/2,q._minX=-q._maxX,q._minZ=-q._maxZ,q._setReady(!1),D.passHeightBufferInCallback&&(u=new Float32Array((B+1)*(B+1)));const s=(S,v,D)=>{O({width:N,height:m,subdivisions:B,minHeight:A,maxHeight:w,colorFilter:n,buffer:S,bufferWidth:v,bufferHeight:D,alphaFilter:R,heightBuffer:u}).tS(q,I),K&&K(q,u),q._setReady(!0)};if("string"===typeof v){const S=S=>{var v;const D=S.width,e=S.height;if(z.h)return;const N=null===(v=z)||void 0===v?void 0:v.getEngine().resizeImageBitmap(S,D,e);s(N,D,e)};E.Tools.LoadImage(v,S,D.onError?D.onError:()=>{},z.offlineProvider)}else s(v.data,v.width,v.height);return q}m.e.CreateGround=n,m.e.CreateTiledGround=R,m.e.CreateGroundFromHeightMap=O,N.e.CreateGround=(S,v,D,z,e,N)=>I(S,{width:v,height:D,subdivisions:z,updatable:N},e),N.e.CreateTiledGround=(S,v,D,z,e,N,m,B,g)=>K(S,{xmin:v,zmin:D,xmax:z,zmax:e,subdivisions:N,precision:m,updatable:g},B),N.e.CreateGroundFromHeightMap=(S,v,D,z,e,N,m,B,g,E,h)=>q(S,v,{width:D,height:z,subdivisions:e,minHeight:N,maxHeight:m,updatable:g,onReady:E,alphaFilter:h},B)},13280:(S,v,D)=>{"use strict";D.d(v,{e:()=>n,i:()=>A,m:()=>w});var z=D(11371),e=D(11819),N=D(11806),m=D(11904),B=D(11452),g=D(11190);function E(S){const v=[],D=[],z=S.lines,e=S.kS,m=[];let B=0;for(let N=0;N<z.length;N++){const S=z[N];for(let z=0;z<S.length;z++){const{x:g,y:E,z:h}=S[z];if(D.push(g,E,h),e){const S=e[N],{r:v,g:D,b:B,a:g}=S[z];m.push(v,D,B,g)}z>0&&(v.push(B-1),v.push(B)),B++}}const g=new N.e;return g.indices=v,g.pS=D,e&&(g.kS=m),g}function h(S){const v=S.dashSize||3,D=S.gapSize||1,e=S.dashNb||200,m=S.points,B=[],g=[],E=z.Rv.Zero();let h=0,A=0,w=0,n=0,R=0,O=0,I=0;for(I=0;I<m.length-1;I++)m[I+1].subtractToRef(m[I],E),h+=E.length();for(w=h/e,n=v*w/(v+D),I=0;I<m.length-1;I++){m[I+1].subtractToRef(m[I],E),A=Math.floor(E.length()/w),E.normalize();for(let S=0;S<A;S++)R=w*S,B.push(m[I].x+R*E.x,m[I].y+R*E.y,m[I].z+R*E.z),B.push(m[I].x+(R+n)*E.x,m[I].y+(R+n)*E.y,m[I].z+(R+n)*E.z),g.push(O,O+1),O+=2}const K=new N.e;return K.pS=B,K.indices=g,K}function A(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=v.instance,e=v.lines,N=v.kS;if(z){const S=z.getVerticesData(B.d.PositionKind);let v,D;N&&(v=z.getVerticesData(B.d.ColorKind));let m=0,g=0;for(let z=0;z<e.length;z++){const B=e[z];for(let e=0;e<B.length;e++)S[m]=B[e].x,S[m+1]=B[e].y,S[m+2]=B[e].z,N&&v&&(D=N[z],v[g]=D[e].r,v[g+1]=D[e].g,v[g+2]=D[e].b,v[g+3]=D[e].a,g+=4),m+=3}return z.updateVerticesData(B.d.PositionKind,S,!1,!1),N&&v&&z.updateVerticesData(B.d.ColorKind,v,!1,!1),z.refreshBoundingInfo(),z}const g=!!N,h=new m.b(S,D,null,void 0,void 0,g,v.useVertexAlpha,v.material);return E(v).tS(h,v.updatable),h}function w(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=v.kS?[v.kS]:null;return A(S,{lines:[v.points],updatable:v.updatable,instance:v.instance,kS:z,useVertexAlpha:v.useVertexAlpha,material:v.material},D)}function n(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=v.points,B=v.instance,E=v.gapSize||1,A=v.dashSize||3;if(B){const S=S=>{const v=z.Rv.Zero(),D=S.length/6;let e=0,m=0,g=0,E=0,h=0,A=0,w=0,n=0;for(w=0;w<N.length-1;w++)N[w+1].subtractToRef(N[w],v),e+=v.length();g=e/D;const R=B._creationDataStorage.dashSize;for(E=R*g/(R+B._creationDataStorage.gapSize),w=0;w<N.length-1;w++)for(N[w+1].subtractToRef(N[w],v),m=Math.floor(v.length()/g),v.normalize(),n=0;n<m&&A<S.length;)h=g*n,S[A]=N[w].x+h*v.x,S[A+1]=N[w].y+h*v.y,S[A+2]=N[w].z+h*v.z,S[A+3]=N[w].x+(h+E)*v.x,S[A+4]=N[w].y+(h+E)*v.y,S[A+5]=N[w].z+(h+E)*v.z,A+=6,n++;for(;A<S.length;)S[A]=N[w].x,S[A+1]=N[w].y,S[A+2]=N[w].z,A+=3};return(v.dashNb||v.dashSize||v.gapSize||v.useVertexAlpha||v.material)&&g.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),B.updateMeshPositions(S,!1),B}const w=new m.b(S,D,null,void 0,void 0,void 0,v.useVertexAlpha,v.material);return h(v).tS(w,v.updatable),w._creationDataStorage=new e.g,w._creationDataStorage.dashSize=A,w._creationDataStorage.gapSize=E,w}N.e.CreateLineSystem=E,N.e.CreateDashedLines=h,e.e.bE=function(S,v){return w(S,{points:v,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},e.e.CreateDashedLines=function(S,v,D,z,e){return n(S,{points:v,dashSize:D,gapSize:z,dashNb:e,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12683:(S,v,D)=>{"use strict";D.d(v,{e:()=>B,g:()=>g});var z=D(11819),e=D(11806),N=D(11433);function m(S){const v=[],D=[],z=[],m=[],B=void 0!==S.width?S.width:void 0!==S.size?S.size:1,g=void 0!==S.height?S.height:void 0!==S.size?S.size:1,E=0===S.sideOrientation?0:S.sideOrientation||e.e.DEFAULTSIDE,h=B/2,A=g/2;D.push(-h,-A,0),z.push(0,0,-1),m.push(0,N.b?1:0),D.push(h,-A,0),z.push(0,0,-1),m.push(1,N.b?1:0),D.push(h,A,0),z.push(0,0,-1),m.push(1,N.b?0:1),D.push(-h,A,0),z.push(0,0,-1),m.push(0,N.b?0:1),v.push(0),v.push(1),v.push(2),v.push(0),v.push(2),v.push(3),e.e._ComputeSides(E,D,v,z,m,S.frontUVs,S.backUVs);const w=new e.e;return w.indices=v,w.pS=D,w.bS=z,w.ZS=m,w}function B(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new z.e(S,D);v.sideOrientation=z.e._GetDefaultSideOrientation(v.sideOrientation),e._originalBuilderSideOrientation=v.sideOrientation;return m(v).tS(e,v.updatable),v.sourcePlane&&(e.translate(v.sourcePlane.normal,-v.sourcePlane.d),e.setDirection(v.sourcePlane.normal.scale(-1))),e}const g={ZE:B};e.e.ZE=m,z.e.ZE=(S,v,D,z,e)=>B(S,{size:v,width:v,height:v,sideOrientation:e,updatable:z},D)},12780:(S,v,D)=>{"use strict";D.d(v,{d:()=>g});var z=D(11371),e=D(11819),N=D(11806),m=D(11433);function B(S){const v=0|(S.segments||32),D=S.diameterX||S.diameter||1,e=S.diameterY||S.diameter||1,B=S.diameterZ||S.diameter||1,g=S.arc&&(S.arc<=0||S.arc>1)?1:S.arc||1,E=S.slice&&S.slice<=0?1:S.slice||1,h=0===S.sideOrientation?0:S.sideOrientation||N.e.DEFAULTSIDE,A=!!S.dedupTopBottomIndices,w=new z.Rv(D/2,e/2,B/2),n=2+v,R=2*n,O=[],I=[],K=[],q=[];for(let N=0;N<=n;N++){const S=N/n,v=S*Math.PI*E;for(let D=0;D<=R;D++){const e=D/R,N=e*Math.PI*2*g,B=z.Matrix.RotationZ(-v),E=z.Matrix.RotationY(N),h=z.Rv.TransformCoordinates(z.Rv.Up(),B),A=z.Rv.TransformCoordinates(h,E),n=A.multiply(w),O=A.divide(w).normalize();I.push(n.x,n.y,n.z),K.push(O.x,O.y,O.z),q.push(e,m.b?1-S:S)}if(N>0){const S=I.length/3;for(let v=S-2*(R+1);v+R+2<S;v++)A?(N>1&&(O.push(v),O.push(v+1),O.push(v+R+1)),(N<n||E<1)&&(O.push(v+R+1),O.push(v+1),O.push(v+R+2))):(O.push(v),O.push(v+1),O.push(v+R+1),O.push(v+R+1),O.push(v+1),O.push(v+R+2))}}N.e._ComputeSides(h,I,O,K,q,S.frontUVs,S.backUVs);const u=new N.e;return u.indices=O,u.pS=I,u.bS=K,u.ZS=q,u}function g(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new e.e(S,D);v.sideOrientation=e.e._GetDefaultSideOrientation(v.sideOrientation),z._originalBuilderSideOrientation=v.sideOrientation;return B(v).tS(z,v.updatable),z}N.e.CreateSphere=B,e.e.CreateSphere=(S,v,D,z,e,N)=>g(S,{segments:v,diameterX:D,diameterY:D,diameterZ:D,sideOrientation:N,updatable:e},z)},13578:(S,v,D)=>{"use strict";D.d(v,{c:()=>B});var z=D(11917),e=D(13088),N=D(11929),m=D(11806);class B{static get Configuration(){return{get decoder(){return e.d.DefaultConfiguration},set decoder(S){e.d.DefaultConfiguration=S}}}static set Configuration(S){e.d.DefaultConfiguration=S.decoder}static get DecoderAvailable(){return(0,z.k)(e.d.DefaultConfiguration)}static get Default(){return B._Default??(B._Default=new B),B._Default}static ResetDefault(S){B._Default&&(S||B._Default.dispose(),B._Default=null)}constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.DefaultNumWorkers;const v="number"===typeof S?{...e.d.DefaultConfiguration,numWorkers:S}:{...e.d.DefaultConfiguration,...S};this._decoder=new e.d(v)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(S,v,D){return this._decoder.decodeMeshToMeshDataAsync(S,v,D)}async decodeMeshToGeometryAsync(S,v,D,z){return await this._decoder.decodeMeshToGeometryAsync(S,v,D,z)}async _decodeMeshToGeometryForGltfAsync(S,v,D,z,e,N){return await this._decoder._decodeMeshToGeometryForGltfAsync(S,v,D,z,e,N)}async decodeMeshAsync(S,v){const D=await this._decoder.decodeMeshToMeshDataAsync(S,v),z=new m.e;D.indices&&(z.indices=D.indices);for(const e of D.attributes){const S=N.b.GetFloatData(e.data,e.size,N.b.GetDataType(e.data),e.byteOffset,e.byteStride,e.normalized,D.totalVertices);z.set(S,e.kind)}return z}}B.DefaultNumWorkers=(0,z.g)(),B._Default=null},13088:(S,v,D)=>{"use strict";D.d(v,{d:()=>E});var z=D(11917),e=D(11175),N=D(11829),m=D(11929),B=D(11190),g=D(11922);class E extends z.c{static get DefaultAvailable(){return(0,z.k)(E.DefaultConfiguration)}static get Default(){return E._Default??(E._Default=new E),E._Default}static ResetDefault(S){E._Default&&(S||E._Default.dispose(),E._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(S,v){return{module:await(v||DracoDecoderModule)({wasmBinary:S})}}_getWorkerContent(){return`${g.e}(${g.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.DefaultConfiguration)}decodeMeshToMeshDataAsync(S,v,D){const z=S instanceof ArrayBuffer?new Int8Array(S):new Int8Array(S.buffer,S.byteOffset,S.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async S=>await new Promise(((e,N)=>{S.push(((S,m)=>{let g=null;const E=[],h=v=>{S.removeEventListener("error",h),S.removeEventListener("message",A),N(v),m()},A=v=>{const z=v.data;switch(z.id){case"indices":g=z.data;break;case"attribute":E.push({kind:z.kind,data:z.data,size:z.size,byteOffset:z.byteOffset,byteStride:z.byteStride,normalized:(N=z.kind,w=z.normalized,D&&void 0!==D[N]?(w!==D[N]&&B.b.Warn(`Normalized flag from Draco data (${w}) does not match normalized flag from glTF accessor (${D[N]}). Using flag from glTF accessor.`),D[N]):w)});break;case"decodeMeshDone":S.removeEventListener("error",h),S.removeEventListener("message",A),e({indices:g,attributes:E,totalVertices:z.totalVertices}),m()}var N,w};S.addEventListener("error",h),S.addEventListener("message",A);const w=z.slice();S.postMessage({id:"decodeMesh",dataView:w,attributes:v},[w.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((S=>{let D=null;const e=[],N=(0,g.e)(S.module,z,v,(S=>{D=S}),((S,v,D,z,N,m)=>{e.push({kind:S,data:v,size:D,byteOffset:z,byteStride:N,normalized:m})}));return{indices:D,attributes:e,totalVertices:N}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(S,v,D,z){const e=await this.decodeMeshToMeshDataAsync(D,z),B=new N.c(S,v);e.indices&&B.setIndices(e.indices);for(const N of e.attributes)B.setVerticesBuffer(new m.b(v.getEngine(),N.data,N.kind,!1,void 0,N.byteStride,void 0,N.byteOffset,N.size,void 0,N.normalized,!0),e.totalVertices);return B}async _decodeMeshToGeometryForGltfAsync(S,v,D,z,e,B){const g=await this.decodeMeshToMeshDataAsync(D,z,e),E=new N.c(S,v);B&&(E._boundingInfo=B,E.useBoundingInfoFromGeometry=!0),g.indices&&E.setIndices(g.indices);for(const N of g.attributes)E.setVerticesBuffer(new m.b(v.getEngine(),N.data,N.kind,!1,void 0,N.byteStride,void 0,N.byteOffset,N.size,void 0,N.normalized,!0),g.totalVertices);return E}}E.DefaultConfiguration={wasmUrl:`${e.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${e.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${e.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},E._Default=null},13274:(S,v,D)=>{"use strict";D.d(v,{d:()=>BS});var z=D(11371),e=D(11819),N=D(11452),m=D(11806),B=D(11433);function g(S){let v=S.pathArray;const D=S.closeArray||!1,z=S.closePath||!1,e=S.invertUV||!1,g=Math.floor(v[0].length/2);let E=S.offset||g;E=E>g?g:Math.floor(E);const h=0===S.sideOrientation?0:S.sideOrientation||m.e.DEFAULTSIDE,A=S.ZS,w=S.kS,n=[],R=[],O=[],I=[],K=[],q=[],u=[],s=[];let r;const d=[],x=[];let W,p,b;if(v.length<2){const S=[],D=[];for(p=0;p<v[0].length-E;p++)S.push(v[0][p]),D.push(v[0][p+E]);v=[S,D]}let k=0;const Z=z?1:0,i=D?1:0;let t,X,a,o,M,c;for(r=v[0].length,W=0;W<v.length+i;W++){for(u[W]=0,K[W]=[0],t=W===v.length?v[0]:v[W],X=t.length,r=r<X?r:X,b=0;b<X;)n.push(t[b].x,t[b].y,t[b].z),b>0&&(a=t[b].Ov(t[b-1]).length(),o=a+u[W],K[W].push(o),u[W]=o),b++;z&&(b--,n.push(t[0].x,t[0].y,t[0].z),a=t[b].Ov(t[0]).length(),o=a+u[W],K[W].push(o),u[W]=o),d[W]=X+Z,x[W]=k,k+=X+Z}let J,H,T=null,G=null;for(p=0;p<r+Z;p++)for(s[p]=0,q[p]=[0],W=0;W<v.length-1+i;W++)M=v[W],c=W===v.length-1?v[0]:v[W+1],p===r?(T=M[0],G=c[0]):(T=M[p],G=c[p]),a=G.Ov(T).length(),o=a+s[p],q[p].push(o),s[p]=o;if(A)for(W=0;W<A.length;W++)I.push(A[W].x,B.b?1-A[W].y:A[W].y);else for(W=0;W<v.length+i;W++)for(p=0;p<r+Z;p++)J=0!=u[W]?K[W][p]/u[W]:0,H=0!=s[p]?q[p][W]/s[p]:0,e?I.push(H,J):I.push(J,B.b?1-H:H);W=0;let Y=0,j=d[W]-1,V=d[W+1]-1,U=j<V?j:V,y=x[1]-x[0];const f=d.length-1;for(;Y<=U&&W<f;)R.push(Y,Y+y,Y+1),R.push(Y+y+1,Y+1,Y+y),Y+=1,Y===U&&(W++,y=x[W+1]-x[W],j=d[W]-1,V=d[W+1]-1,Y=x[W],U=j<V?j+Y:V+Y);if(m.e.ComputeNormals(n,R,O),z){let S=0,D=0;for(W=0;W<v.length;W++){S=3*x[W],D=W+1<v.length?3*(x[W+1]-1):O.length-3,O[S]=.5*(O[S]+O[D]),O[S+1]=.5*(O[S+1]+O[D+1]),O[S+2]=.5*(O[S+2]+O[D+2]);const z=Math.sqrt(O[S]*O[S]+O[S+1]*O[S+1]+O[S+2]*O[S+2]);O[S]/=z,O[S+1]/=z,O[S+2]/=z,O[D]=O[S],O[D+1]=O[S+1],O[D+2]=O[S+2]}}if(D){let S=3*x[0],D=3*x[v.length];for(p=0;p<r+Z;p++){O[S]=.5*(O[S]+O[D]),O[S+1]=.5*(O[S+1]+O[D+1]),O[S+2]=.5*(O[S+2]+O[D+2]);const v=Math.sqrt(O[S]*O[S]+O[S+1]*O[S+1]+O[S+2]*O[S+2]);O[S]/=v,O[S+1]/=v,O[S+2]/=v,O[D]=O[S],O[D+1]=O[S+1],O[D+2]=O[S+2],S+=3,D+=3}}m.e._ComputeSides(h,n,R,O,I,S.frontUVs,S.backUVs);let C=null;if(w){C=new Float32Array(4*w.length);for(let S=0;S<w.length;S++)C[4*S]=w[S].r,C[4*S+1]=w[S].g,C[4*S+2]=w[S].b,C[4*S+3]=w[S].a}const F=new m.e,l=new Float32Array(n),P=new Float32Array(O),Q=new Float32Array(I);return F.indices=R,F.pS=l,F.bS=P,F.ZS=Q,C&&F.set(C,N.d.ColorKind),z&&(F._idx=x),F}function E(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=v.pathArray,h=v.closeArray,A=v.closePath,w=e.e._GetDefaultSideOrientation(v.sideOrientation),n=v.instance,R=v.updatable;if(n){const S=z.TmpVectors.Rv[0].Je(Number.MAX_VALUE),D=z.TmpVectors.Rv[1].Je(-Number.MAX_VALUE),g=v=>{let z=E[0].length;const N=n;let m=0;const B=N._originalBuilderSideOrientation===e.e.DOUBLESIDE?2:1;for(let e=1;e<=B;++e)for(let B=0;B<E.length;++B){const e=E[B],g=e.length;z=z<g?z:g;for(let N=0;N<z;++N){const z=e[N];v[m]=z.x,v[m+1]=z.y,v[m+2]=z.z,S.minimizeInPlaceFromFloats(z.x,z.y,z.z),D.maximizeInPlaceFromFloats(z.x,z.y,z.z),m+=3}if(N._creationDataStorage&&N._creationDataStorage.closePath){const S=e[0];v[m]=S.x,v[m+1]=S.y,v[m+2]=S.z,m+=3}}},h=n.getVerticesData(N.d.PositionKind);if(g(h),n.hasBoundingInfo?n.getBoundingInfo().reConstruct(S,D,n._worldMatrix):n.buildBoundingInfo(S,D,n._worldMatrix),n.updateVerticesData(N.d.PositionKind,h,!1,!1),v.kS){const S=n.getVerticesData(N.d.ColorKind);for(let D=0,z=0;D<v.kS.length;D++,z+=4){const e=v.kS[D];S[z]=e.r,S[z+1]=e.g,S[z+2]=e.b,S[z+3]=e.a}n.updateVerticesData(N.d.ColorKind,S,!1,!1)}if(v.ZS){const S=n.getVerticesData(N.d.UVKind);for(let D=0;D<v.ZS.length;D++)S[2*D]=v.ZS[D].x,S[2*D+1]=B.b?1-v.ZS[D].y:v.ZS[D].y;n.updateVerticesData(N.d.UVKind,S,!1,!1)}if(!n.areNormalsFrozen||n.isFacetDataEnabled){const S=n.te(),v=n.getVerticesData(N.d.NormalKind),D=n.isFacetDataEnabled?n.getFacetDataParameters():null;if(m.e.ComputeNormals(h,S,v,D),n._creationDataStorage&&n._creationDataStorage.closePath){let S=0,D=0;for(let z=0;z<E.length;z++)S=3*n._creationDataStorage.idx[z],D=z+1<E.length?3*(n._creationDataStorage.idx[z+1]-1):v.length-3,v[S]=.5*(v[S]+v[D]),v[S+1]=.5*(v[S+1]+v[D+1]),v[S+2]=.5*(v[S+2]+v[D+2]),v[D]=v[S],v[D+1]=v[S+1],v[D+2]=v[S+2]}n.areNormalsFrozen||n.updateVerticesData(N.d.NormalKind,v,!1,!1)}return n}{const z=new e.e(S,D);z._originalBuilderSideOrientation=w,z._creationDataStorage=new e.g;const N=g(v);return A&&(z._creationDataStorage.idx=N._idx),z._creationDataStorage.closePath=A,z._creationDataStorage.closeArray=h,N.tS(z,R),z}}m.e.CreateRibbon=g,e.e.CreateRibbon=function(S,v){return E(S,{pathArray:v,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var h=D(12788),A=D(12621),w=D(11425);function n(S){const v=S.pattern||e.e.NO_FLIP,D=S.tileWidth||S.tileSize||1,z=S.tileHeight||S.tileSize||1,N=S.alignHorizontal||0,B=S.alignVertical||0,g=S.width||S.size||1,E=Math.floor(g/D);let h=g-E*D;const A=S.height||S.size||1,w=Math.floor(A/z);let n=A-w*z;const R=D*E/2,O=z*w/2;let I=0,K=0,q=0,u=0,s=0,r=0;if(h>0||n>0){switch(q=-R,u=-O,s=R,r=O,N){case e.e.CENTER:h/=2,q-=h,s+=h;break;case e.e.LEFT:s+=h,I=-h/2;break;case e.e.RIGHT:q-=h,I=h/2}switch(B){case e.e.CENTER:n/=2,u-=n,r+=n;break;case e.e.BOTTOM:r+=n,K=-n/2;break;case e.e.TOP:u-=n,K=n/2}}const d=[],x=[],W=[];W[0]=[0,0,1,0,1,1,0,1],W[1]=[0,0,1,0,1,1,0,1],v!==e.e.ROTATE_TILE&&v!==e.e.ROTATE_ROW||(W[1]=[1,1,0,1,0,0,1,0]),v!==e.e.FLIP_TILE&&v!==e.e.FLIP_ROW||(W[1]=[1,0,0,0,0,1,1,1]),v!==e.e.FLIP_N_ROTATE_TILE&&v!==e.e.FLIP_N_ROTATE_ROW||(W[1]=[0,1,1,1,1,0,0,0]);let p=[];const b=[],k=[];let Z=0;for(let m=0;m<w;m++)for(let S=0;S<E;S++)d.push(S*D-R+I,m*z-O+K,0),d.push((S+1)*D-R+I,m*z-O+K,0),d.push((S+1)*D-R+I,(m+1)*z-O+K,0),d.push(S*D-R+I,(m+1)*z-O+K,0),k.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),p=v===e.e.FLIP_TILE||v===e.e.ROTATE_TILE||v===e.e.FLIP_N_ROTATE_TILE?p.concat(W[(S%2+m%2)%2]):v===e.e.FLIP_ROW||v===e.e.ROTATE_ROW||v===e.e.FLIP_N_ROTATE_ROW?p.concat(W[m%2]):p.concat(W[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),x.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Z+=4;if(h>0||n>0){const S=n>0&&(B===e.e.CENTER||B===e.e.TOP),m=n>0&&(B===e.e.CENTER||B===e.e.BOTTOM),g=h>0&&(N===e.e.CENTER||N===e.e.RIGHT),A=h>0&&(N===e.e.CENTER||N===e.e.LEFT);let W,i,t,X,a=[];if(S&&g&&(d.push(q+I,u+K,0),d.push(-R+I,u+K,0),d.push(-R+I,u+n+K,0),d.push(q+I,u+n+K,0),k.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,W=1-h/D,i=1-n/z,t=1,X=1,a=[W,i,t,i,t,X,W,X],v===e.e.ROTATE_ROW&&(a=[1-W,1-i,1-t,1-i,1-t,1-X,1-W,1-X]),v===e.e.FLIP_ROW&&(a=[1-W,i,1-t,i,1-t,X,1-W,X]),v===e.e.FLIP_N_ROTATE_ROW&&(a=[W,1-i,t,1-i,t,1-X,W,1-X]),p=p.concat(a),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),x.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S&&A&&(d.push(R+I,u+K,0),d.push(s+I,u+K,0),d.push(s+I,u+n+K,0),d.push(R+I,u+n+K,0),k.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,W=0,i=1-n/z,t=h/D,X=1,a=[W,i,t,i,t,X,W,X],(v===e.e.ROTATE_ROW||v===e.e.ROTATE_TILE&&E%2===0)&&(a=[1-W,1-i,1-t,1-i,1-t,1-X,1-W,1-X]),(v===e.e.FLIP_ROW||v===e.e.FLIP_TILE&&E%2===0)&&(a=[1-W,i,1-t,i,1-t,X,1-W,X]),(v===e.e.FLIP_N_ROTATE_ROW||v===e.e.FLIP_N_ROTATE_TILE&&E%2===0)&&(a=[W,1-i,t,1-i,t,1-X,W,1-X]),p=p.concat(a),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),x.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),m&&g&&(d.push(q+I,O+K,0),d.push(-R+I,O+K,0),d.push(-R+I,r+K,0),d.push(q+I,r+K,0),k.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,W=1-h/D,i=0,t=1,X=n/z,a=[W,i,t,i,t,X,W,X],(v===e.e.ROTATE_ROW&&w%2===1||v===e.e.ROTATE_TILE&&w%1===0)&&(a=[1-W,1-i,1-t,1-i,1-t,1-X,1-W,1-X]),(v===e.e.FLIP_ROW&&w%2===1||v===e.e.FLIP_TILE&&w%2===0)&&(a=[1-W,i,1-t,i,1-t,X,1-W,X]),(v===e.e.FLIP_N_ROTATE_ROW&&w%2===1||v===e.e.FLIP_N_ROTATE_TILE&&w%2===0)&&(a=[W,1-i,t,1-i,t,1-X,W,1-X]),p=p.concat(a),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),x.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),m&&A&&(d.push(R+I,O+K,0),d.push(s+I,O+K,0),d.push(s+I,r+K,0),d.push(R+I,r+K,0),k.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,W=0,i=0,t=h/D,X=n/z,a=[W,i,t,i,t,X,W,X],(v===e.e.ROTATE_ROW&&w%2===1||v===e.e.ROTATE_TILE&&(w+E)%2===1)&&(a=[1-W,1-i,1-t,1-i,1-t,1-X,1-W,1-X]),(v===e.e.FLIP_ROW&&w%2===1||v===e.e.FLIP_TILE&&(w+E)%2===1)&&(a=[1-W,i,1-t,i,1-t,X,1-W,X]),(v===e.e.FLIP_N_ROTATE_ROW&&w%2===1||v===e.e.FLIP_N_ROTATE_TILE&&(w+E)%2===1)&&(a=[W,1-i,t,1-i,t,1-X,W,1-X]),p=p.concat(a),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),x.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),S){const S=[];W=0,i=1-n/z,t=1,X=1,S[0]=[W,i,t,i,t,X,W,X],S[1]=[W,i,t,i,t,X,W,X],v!==e.e.ROTATE_TILE&&v!==e.e.ROTATE_ROW||(S[1]=[1-W,1-i,1-t,1-i,1-t,1-X,1-W,1-X]),v!==e.e.FLIP_TILE&&v!==e.e.FLIP_ROW||(S[1]=[1-W,i,1-t,i,1-t,X,1-W,X]),v!==e.e.FLIP_N_ROTATE_TILE&&v!==e.e.FLIP_N_ROTATE_ROW||(S[1]=[W,1-i,t,1-i,t,1-X,W,1-X]);for(let z=0;z<E;z++)d.push(z*D-R+I,u+K,0),d.push((z+1)*D-R+I,u+K,0),d.push((z+1)*D-R+I,u+n+K,0),d.push(z*D-R+I,u+n+K,0),k.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,p=v===e.e.FLIP_TILE||v===e.e.ROTATE_TILE||v===e.e.FLIP_N_ROTATE_TILE?p.concat(S[(z+1)%2]):v===e.e.FLIP_ROW||v===e.e.ROTATE_ROW||v===e.e.FLIP_N_ROTATE_ROW?p.concat(S[1]):p.concat(S[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),x.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(m){const S=[];W=0,i=0,t=1,X=n/z,S[0]=[W,i,t,i,t,X,W,X],S[1]=[W,i,t,i,t,X,W,X],v!==e.e.ROTATE_TILE&&v!==e.e.ROTATE_ROW||(S[1]=[1-W,1-i,1-t,1-i,1-t,1-X,1-W,1-X]),v!==e.e.FLIP_TILE&&v!==e.e.FLIP_ROW||(S[1]=[1-W,i,1-t,i,1-t,X,1-W,X]),v!==e.e.FLIP_N_ROTATE_TILE&&v!==e.e.FLIP_N_ROTATE_ROW||(S[1]=[W,1-i,t,1-i,t,1-X,W,1-X]);for(let z=0;z<E;z++)d.push(z*D-R+I,r-n+K,0),d.push((z+1)*D-R+I,r-n+K,0),d.push((z+1)*D-R+I,r+K,0),d.push(z*D-R+I,r+K,0),k.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,p=v===e.e.FLIP_TILE||v===e.e.ROTATE_TILE||v===e.e.FLIP_N_ROTATE_TILE?p.concat(S[(z+w)%2]):v===e.e.FLIP_ROW||v===e.e.ROTATE_ROW||v===e.e.FLIP_N_ROTATE_ROW?p.concat(S[w%2]):p.concat(S[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),x.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const S=[];W=1-h/D,i=0,t=1,X=1,S[0]=[W,i,t,i,t,X,W,X],S[1]=[W,i,t,i,t,X,W,X],v!==e.e.ROTATE_TILE&&v!==e.e.ROTATE_ROW||(S[1]=[1-W,1-i,1-t,1-i,1-t,1-X,1-W,1-X]),v!==e.e.FLIP_TILE&&v!==e.e.FLIP_ROW||(S[1]=[1-W,i,1-t,i,1-t,X,1-W,X]),v!==e.e.FLIP_N_ROTATE_TILE&&v!==e.e.FLIP_N_ROTATE_ROW||(S[1]=[W,1-i,t,1-i,t,1-X,W,1-X]);for(let D=0;D<w;D++)d.push(q+I,D*z-O+K,0),d.push(q+h+I,D*z-O+K,0),d.push(q+h+I,(D+1)*z-O+K,0),d.push(q+I,(D+1)*z-O+K,0),k.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,p=v===e.e.FLIP_TILE||v===e.e.ROTATE_TILE||v===e.e.FLIP_N_ROTATE_TILE?p.concat(S[(D+1)%2]):v===e.e.FLIP_ROW||v===e.e.ROTATE_ROW||v===e.e.FLIP_N_ROTATE_ROW?p.concat(S[D%2]):p.concat(S[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),x.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(A){const S=[];W=0,i=0,t=h/z,X=1,S[0]=[W,i,t,i,t,X,W,X],S[1]=[W,i,t,i,t,X,W,X],v!==e.e.ROTATE_TILE&&v!==e.e.ROTATE_ROW||(S[1]=[1-W,1-i,1-t,1-i,1-t,1-X,1-W,1-X]),v!==e.e.FLIP_TILE&&v!==e.e.FLIP_ROW||(S[1]=[1-W,i,1-t,i,1-t,X,1-W,X]),v!==e.e.FLIP_N_ROTATE_TILE&&v!==e.e.FLIP_N_ROTATE_ROW||(S[1]=[W,1-i,t,1-i,t,1-X,W,1-X]);for(let D=0;D<w;D++)d.push(s-h+I,D*z-O+K,0),d.push(s+I,D*z-O+K,0),d.push(s+I,(D+1)*z-O+K,0),d.push(s-h+I,(D+1)*z-O+K,0),k.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,p=v===e.e.FLIP_TILE||v===e.e.ROTATE_TILE||v===e.e.FLIP_N_ROTATE_TILE?p.concat(S[(D+E)%2]):v===e.e.FLIP_ROW||v===e.e.ROTATE_ROW||v===e.e.FLIP_N_ROTATE_ROW?p.concat(S[D%2]):p.concat(S[0]),b.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),x.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const i=0===S.sideOrientation?0:S.sideOrientation||m.e.DEFAULTSIDE;m.e._ComputeSides(i,d,k,x,p,S.frontUVs,S.backUVs);const t=new m.e;t.indices=k,t.pS=d,t.bS=x,t.ZS=p;const X=i===m.e.DOUBLESIDE?b.concat(b):b;return t.kS=X,t}function R(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new e.e(S,D);v.sideOrientation=e.e._GetDefaultSideOrientation(v.sideOrientation),z._originalBuilderSideOrientation=v.sideOrientation;return n(v).tS(z,v.updatable),z}function O(S){const v=S.faceUV||new Array(6),D=S.faceColors,N=S.pattern||e.e.NO_FLIP,g=S.width||S.size||1,E=S.height||S.size||1,h=S.depth||S.size||1,A=S.tileWidth||S.tileSize||1,R=S.tileHeight||S.tileSize||1,O=S.alignHorizontal||0,I=S.alignVertical||0,K=0===S.sideOrientation?0:S.sideOrientation||m.e.DEFAULTSIDE;for(let e=0;e<6;e++)void 0===v[e]&&(v[e]=new z.Vector4(0,0,1,1)),D&&void 0===D[e]&&(D[e]=new w.Ge(1,1,1,1));const q=g/2,u=E/2,s=h/2,r=[];for(let z=0;z<2;z++)r[z]=n({pattern:N,tileWidth:A,tileHeight:R,width:g,height:E,alignVertical:I,alignHorizontal:O,sideOrientation:K});for(let z=2;z<4;z++)r[z]=n({pattern:N,tileWidth:A,tileHeight:R,width:h,height:E,alignVertical:I,alignHorizontal:O,sideOrientation:K});let d=I;I===e.e.BOTTOM?d=e.e.TOP:I===e.e.TOP&&(d=e.e.BOTTOM);for(let z=4;z<6;z++)r[z]=n({pattern:N,tileWidth:A,tileHeight:R,width:g,height:h,alignVertical:d,alignHorizontal:O,sideOrientation:K});let x=[],W=[],p=[],b=[];const k=[],Z=[],i=[],t=[];let X=0,a=0;for(let e=0;e<6;e++){const S=r[e].pS.length;Z[e]=[],i[e]=[];for(let v=0;v<S/3;v++)Z[e].push(new z.Rv(r[e].pS[3*v],r[e].pS[3*v+1],r[e].pS[3*v+2])),i[e].push(new z.Rv(r[e].bS[3*v],r[e].bS[3*v+1],r[e].bS[3*v+2]));X=r[e].ZS.length,t[e]=[];for(let D=0;D<X;D+=2)t[e][D]=v[e].x+(v[e].z-v[e].x)*r[e].ZS[D],t[e][D+1]=v[e].y+(v[e].w-v[e].y)*r[e].ZS[D+1],B.b&&(t[e][D+1]=1-t[e][D+1]);if(p=p.concat(t[e]),b=b.concat(r[e].indices.map((S=>S+a))),a+=Z[e].length,D)for(let v=0;v<4;v++)k.push(D[e].r,D[e].g,D[e].b,D[e].a)}const o=new z.Rv(0,0,s),M=z.Matrix.RotationY(Math.PI);x=Z[0].map((S=>z.Rv.TransformNormal(S,M).add(o))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[]),W=i[0].map((S=>z.Rv.TransformNormal(S,M))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[]),x=x.concat(Z[1].map((S=>S.Ov(o))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[])),W=W.concat(i[1].map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[]));const c=new z.Rv(q,0,0),J=z.Matrix.RotationY(-Math.PI/2);x=x.concat(Z[2].map((S=>z.Rv.TransformNormal(S,J).add(c))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[])),W=W.concat(i[2].map((S=>z.Rv.TransformNormal(S,J))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[]));const H=z.Matrix.RotationY(Math.PI/2);x=x.concat(Z[3].map((S=>z.Rv.TransformNormal(S,H).Ov(c))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[])),W=W.concat(i[3].map((S=>z.Rv.TransformNormal(S,H))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[]));const T=new z.Rv(0,u,0),G=z.Matrix.RotationX(Math.PI/2);x=x.concat(Z[4].map((S=>z.Rv.TransformNormal(S,G).add(T))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[])),W=W.concat(i[4].map((S=>z.Rv.TransformNormal(S,G))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[]));const Y=z.Matrix.RotationX(-Math.PI/2);x=x.concat(Z[5].map((S=>z.Rv.TransformNormal(S,Y).Ov(T))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[])),W=W.concat(i[5].map((S=>z.Rv.TransformNormal(S,Y))).map((S=>[S.x,S.y,S.z])).reduce(((S,v)=>S.concat(v)),[])),m.e._ComputeSides(K,x,b,W,p);const j=new m.e;if(j.indices=b,j.pS=x,j.bS=W,j.ZS=p,D){const S=K===m.e.DOUBLESIDE?k.concat(k):k;j.kS=S}return j}function I(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new e.e(S,D);v.sideOrientation=e.e._GetDefaultSideOrientation(v.sideOrientation),z._originalBuilderSideOrientation=v.sideOrientation;return O(v).tS(z,v.updatable),z}m.e.CreateTiledPlane=n;m.e.CreateTiledBox=O;var K=D(12780),q=D(11619),u=D(11584);function s(S){const v=S.height||2;let D=0===S.diameterTop?0:S.diameterTop||S.diameter||1,N=0===S.diameterBottom?0:S.diameterBottom||S.diameter||1;D=D||1e-5,N=N||1e-5;const g=0|(S.tessellation||24),E=0|(S.subdivisions||1),h=!!S.hasRings,A=!!S.enclose,n=0===S.cap?0:S.cap||e.e.CAP_ALL,R=S.arc&&(S.arc<=0||S.arc>1)?1:S.arc||1,O=0===S.sideOrientation?0:S.sideOrientation||m.e.DEFAULTSIDE,I=S.faceUV||new Array(3),K=S.faceColors,q=2+(1+(1!==R&&A?2:0))*(h?E:1);let s;for(s=0;s<q;s++)K&&void 0===K[s]&&(K[s]=new w.Ge(1,1,1,1));for(s=0;s<q;s++)I&&void 0===I[s]&&(I[s]=new z.Vector4(0,0,1,1));const r=[],d=[],x=[],W=[],p=[],b=2*Math.PI*R/g;let k,Z,i;const t=(N-D)/2/v,X=z.Rv.Zero(),a=z.Rv.Zero(),o=z.Rv.Zero(),M=z.Rv.Zero(),c=z.Rv.Zero(),J=u.c.Y;let H,T,G,Y=1,j=1,V=0,U=0;for(H=0;H<=E;H++)for(Z=H/E,i=(Z*(D-N)+N)/2,Y=h&&0!==H&&H!==E?2:1,G=0;G<Y;G++){for(h&&(j+=G),A&&(j+=2*G),T=0;T<=g;T++)k=T*b,X.x=Math.cos(-k)*i,X.y=-v/2+Z*v,X.z=Math.sin(-k)*i,0===D&&H===E?(a.x=x[x.length-3*(g+1)],a.y=x[x.length-3*(g+1)+1],a.z=x[x.length-3*(g+1)+2]):(a.x=X.x,a.z=X.z,a.y=Math.sqrt(a.x*a.x+a.z*a.z)*t,a.normalize()),0===T&&(o.N(X),M.N(a)),d.push(X.x,X.y,X.z),x.push(a.x,a.y,a.z),U=h?V!==j?I[j].y:I[j].w:I[j].y+(I[j].w-I[j].y)*Z,W.push(I[j].x+(I[j].z-I[j].x)*T/g,B.b?1-U:U),K&&p.push(K[j].r,K[j].g,K[j].b,K[j].a);1!==R&&A&&(d.push(X.x,X.y,X.z),d.push(0,X.y,0),d.push(0,X.y,0),d.push(o.x,o.y,o.z),z.Rv.CrossToRef(J,a,c),c.normalize(),x.push(c.x,c.y,c.z,c.x,c.y,c.z),z.Rv.CrossToRef(M,J,c),c.normalize(),x.push(c.x,c.y,c.z,c.x,c.y,c.z),U=h?V!==j?I[j+1].y:I[j+1].w:I[j+1].y+(I[j+1].w-I[j+1].y)*Z,W.push(I[j+1].x,B.b?1-U:U),W.push(I[j+1].z,B.b?1-U:U),U=h?V!==j?I[j+2].y:I[j+2].w:I[j+2].y+(I[j+2].w-I[j+2].y)*Z,W.push(I[j+2].x,B.b?1-U:U),W.push(I[j+2].z,B.b?1-U:U),K&&(p.push(K[j+1].r,K[j+1].g,K[j+1].b,K[j+1].a),p.push(K[j+1].r,K[j+1].g,K[j+1].b,K[j+1].a),p.push(K[j+2].r,K[j+2].g,K[j+2].b,K[j+2].a),p.push(K[j+2].r,K[j+2].g,K[j+2].b,K[j+2].a))),V!==j&&(V=j)}const y=1!==R&&A?g+4:g;for(H=0,j=0;j<E;j++){let S=0,v=0,D=0,z=0;for(T=0;T<g;T++)S=H*(y+1)+T,v=(H+1)*(y+1)+T,D=H*(y+1)+(T+1),z=(H+1)*(y+1)+(T+1),r.push(S,v,D),r.push(z,D,v);1!==R&&A&&(r.push(S+2,v+2,D+2),r.push(z+2,D+2,v+2),r.push(S+4,v+4,D+4),r.push(z+4,D+4,v+4)),H=h?H+2:H+1}const f=S=>{const e=S?D/2:N/2;if(0===e)return;let m,E,h;const A=S?I[q-1]:I[0];let w=null;K&&(w=S?K[q-1]:K[0]);const n=d.length/3,O=S?v/2:-v/2,u=new z.Rv(0,O,0);d.push(u.x,u.y,u.z),x.push(0,S?1:-1,0);const s=A.y+.5*(A.w-A.y);W.push(A.x+.5*(A.z-A.x),B.b?1-s:s),w&&p.push(w.r,w.g,w.b,w.a);const b=new z.Vector2(.5,.5);for(h=0;h<=g;h++){m=2*Math.PI*h*R/g;const v=Math.cos(-m),D=Math.sin(-m);E=new z.Rv(v*e,O,D*e);const N=new z.Vector2(v*b.x+.5,D*b.y+.5);d.push(E.x,E.y,E.z),x.push(0,S?1:-1,0);const n=A.y+(A.w-A.y)*N.y;W.push(A.x+(A.z-A.x)*N.x,B.b?1-n:n),w&&p.push(w.r,w.g,w.b,w.a)}for(h=0;h<g;h++)S?(r.push(n),r.push(n+(h+2)),r.push(n+(h+1))):(r.push(n),r.push(n+(h+1)),r.push(n+(h+2)))};n!==e.e.CAP_START&&n!==e.e.CAP_ALL||f(!1),n!==e.e.CAP_END&&n!==e.e.CAP_ALL||f(!0),m.e._ComputeSides(O,d,r,x,W,S.frontUVs,S.backUVs);const C=new m.e;return C.indices=r,C.pS=d,C.bS=x,C.ZS=W,K&&(C.kS=p),C}function r(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;const z=new e.e(S,D);v.sideOrientation=e.e._GetDefaultSideOrientation(v.sideOrientation),z._originalBuilderSideOrientation=v.sideOrientation;return s(v).tS(z,v.updatable),z}function d(S){const v=[],D=[],e=[],N=[],g=S.diameter||1,E=S.thickness||.5,h=0|(S.tessellation||16),A=0===S.sideOrientation?0:S.sideOrientation||m.e.DEFAULTSIDE,w=h+1;for(let m=0;m<=h;m++){const S=m/h,A=m*Math.PI*2/h-Math.PI/2,n=z.Matrix.Translation(g/2,0,0).multiply(z.Matrix.RotationY(A));for(let g=0;g<=h;g++){const A=1-g/h,R=g*Math.PI*2/h+Math.PI,O=Math.cos(R),I=Math.sin(R);let K=new z.Rv(O,I,0),q=K.scale(E/2);const u=new z.Vector2(S,A);q=z.Rv.TransformCoordinates(q,n),K=z.Rv.TransformNormal(K,n),D.push(q.x,q.y,q.z),e.push(K.x,K.y,K.z),N.push(u.x,B.b?1-u.y:u.y);const s=(m+1)%w,r=(g+1)%w;v.push(m*w+g),v.push(m*w+r),v.push(s*w+g),v.push(m*w+r),v.push(s*w+r),v.push(s*w+g)}}m.e._ComputeSides(A,D,v,e,N,S.frontUVs,S.backUVs);const n=new m.e;return n.indices=v,n.pS=D,n.bS=e,n.ZS=N,n}function x(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;const z=new e.e(S,D);v.sideOrientation=e.e._GetDefaultSideOrientation(v.sideOrientation),z._originalBuilderSideOrientation=v.sideOrientation;return d(v).tS(z,v.updatable),z}m.e.CreateCylinder=s,e.e.CreateCylinder=(S,v,D,z,N,m,B,g,E)=>{void 0!==B&&B instanceof q.d||(void 0!==B&&(E=g||e.e.DEFAULTSIDE,g=B),B=m,m=1);return r(S,{height:v,diameterTop:D,diameterBottom:z,tessellation:N,subdivisions:m,sideOrientation:E,updatable:g},B)};function W(S){const v=[],D=[],e=[],N=[],g=S.radius||2,E=S.tube||.5,h=S.radialSegments||32,A=S.tubularSegments||32,w=S.p||2,n=S.q||3,R=0===S.sideOrientation?0:S.sideOrientation||m.e.DEFAULTSIDE,O=S=>{const v=Math.cos(S),D=Math.sin(S),e=n/w*S,N=Math.cos(e),m=g*(2+N)*.5*v,B=g*(2+N)*D*.5,E=g*Math.sin(e)*.5;return new z.Rv(m,B,E)};let I,K;for(I=0;I<=h;I++){const S=I%h/h*2*w*Math.PI,v=O(S),e=O(S+.01),m=e.Ov(v);let g=e.add(v);const n=z.Rv.Cross(m,g);for(g=z.Rv.Cross(n,m),n.normalize(),g.normalize(),K=0;K<A;K++){const S=K%A/A*2*Math.PI,z=-E*Math.cos(S),e=E*Math.sin(S);D.push(v.x+z*g.x+e*n.x),D.push(v.y+z*g.y+e*n.y),D.push(v.z+z*g.z+e*n.z),N.push(I/h),N.push(B.b?1-K/A:K/A)}}for(I=0;I<h;I++)for(K=0;K<A;K++){const S=(K+1)%A,D=I*A+K,z=(I+1)*A+K,e=(I+1)*A+S,N=I*A+S;v.push(N),v.push(z),v.push(D),v.push(N),v.push(e),v.push(z)}m.e.ComputeNormals(D,v,e),m.e._ComputeSides(R,D,v,e,N,S.frontUVs,S.backUVs);const q=new m.e;return q.indices=v,q.pS=D,q.bS=e,q.ZS=N,q}function p(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;const z=new e.e(S,D);v.sideOrientation=e.e._GetDefaultSideOrientation(v.sideOrientation),z._originalBuilderSideOrientation=v.sideOrientation;return W(v).tS(z,v.updatable),z}m.e.CreateTorus=d,e.e.CreateTorus=(S,v,D,z,e,N,m)=>x(S,{diameter:v,thickness:D,tessellation:z,sideOrientation:m,updatable:N},e);m.e.CreateTorusKnot=W,e.e.CreateTorusKnot=(S,v,D,z,e,N,m,B,g,E)=>p(S,{radius:v,tube:D,radialSegments:z,tubularSegments:e,p:N,q:m,sideOrientation:E,updatable:g},B);var b=D(13280),k=D(11909),Z=D(11595);function i(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=v.path,N=v.shape,m=v.scale||1,B=v.rotation||0,g=0===v.cap?0:v.cap||e.e.NO_CAP,E=v.updatable,h=e.e._GetDefaultSideOrientation(v.sideOrientation),A=v.instance||null,w=v.invertUV||!1,n=v.closeShape||!1,R=v.closePath||!1,O=v.capFunction||null;return X(S,N,z,m,B,null,null,R,n,g,!1,D,!!E,h,A,w,v.frontUVs||null,v.backUVs||null,v.firstNormal||null,!!v.adjustFrame,O)}function t(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=v.path,N=v.shape,m=v.scaleFunction||(()=>1),B=v.rotationFunction||(()=>0),g=v.closePath||v.ribbonCloseArray||!1,E=v.closeShape||v.ribbonClosePath||!1,h=0===v.cap?0:v.cap||e.e.NO_CAP,A=v.updatable,w=v.firstNormal||null,n=v.adjustFrame||!1,R=e.e._GetDefaultSideOrientation(v.sideOrientation),O=v.instance,I=v.invertUV||!1,K=v.capFunction||null;return X(S,N,z,null,null,m,B,g,E,h,!0,D,!!A,R,O||null,I,v.frontUVs||null,v.backUVs||null,w,n,K||null)}function X(S,v,D,N,m,B,g,h,A,w,n,R,O,I,K,q,u,s,r,d,x){const W=(S,v,D,N,m,B,g,E,h,A,w)=>{const n=D.getTangents(),R=D.getNormals(),O=D.getBinormals(),I=D.getDistances();if(w)for(let e=0;e<n.length;e++)if(0==n[e].x&&0==n[e].y&&0==n[e].z&&n[e].N(n[e-1]),0==R[e].x&&0==R[e].y&&0==R[e].z&&R[e].N(R[e-1]),0==O[e].x&&0==O[e].y&&0==O[e].z&&O[e].N(O[e-1]),e>0){let S=n[e-1];z.Rv.Dot(S,n[e])<0&&n[e].scaleInPlace(-1),S=R[e-1],z.Rv.Dot(S,R[e])<0&&R[e].scaleInPlace(-1),S=O[e-1],z.Rv.Dot(S,O[e])<0&&O[e].scaleInPlace(-1)}let K=0;const q=A&&E?E:()=>null!==B?B:0,u=A&&g?g:()=>null!==m?m:1;let s=h===e.e.NO_CAP||h===e.e.CAP_END?0:2;const r=z.TmpVectors.Matrix[0];for(let e=0;e<v.length;e++){const D=[],m=q(e,I[e]),B=u(e,I[e]);z.Matrix.RotationAxisToRef(n[e],K,r);for(let N=0;N<S.length;N++){const m=n[e].scale(S[N].z).add(R[e].scale(S[N].x)).add(O[e].scale(S[N].y)),g=z.Rv.Zero();z.Rv.TransformCoordinatesToRef(m,r,g),g.scaleInPlace(B).addInPlace(v[e]),D[N]=g}N[s]=D,K+=m,s++}const d=x||(S=>{const v=Array(),D=z.Rv.Zero();let e;for(e=0;e<S.length;e++)D.addInPlace(S[e]);for(D.scaleInPlace(1/S.length),e=0;e<S.length;e++)v.push(D);return v});switch(h){case e.e.NO_CAP:break;case e.e.CAP_START:N[0]=d(N[2]),N[1]=N[2];break;case e.e.CAP_END:N[s]=N[s-1],N[s+1]=d(N[s-1]);break;case e.e.CAP_ALL:N[0]=d(N[2]),N[1]=N[2],N[s]=N[s-1],N[s+1]=d(N[s-1])}return N};let p,b;if(K){const S=K._creationDataStorage;return p=r?S.path3D.update(D,r):S.path3D.update(D),b=W(v,D,S.path3D,S.pathArray,N,m,B,g,S.cap,n,d),K=E("",{pathArray:b,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:K},R||void 0)}p=r?new Z.k(D,r):new Z.k(D);b=W(v,D,p,new Array,N,m,B,g,w=w<0||w>3?0:w,n,d);const k=E(S,{pathArray:b,closeArray:h,closePath:A,updatable:O,sideOrientation:I,invertUV:q,frontUVs:u||void 0,backUVs:s||void 0},R);return k._creationDataStorage.pathArray=b,k._creationDataStorage.path3D=p,k._creationDataStorage.cap=w,k}function a(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=v.arc?v.arc<=0||v.arc>1?1:v.arc:1,m=void 0===v.closed||v.closed,B=v.shape,g=v.radius||1,h=v.tessellation||64,A=v.clip||0,w=v.updatable,n=e.e._GetDefaultSideOrientation(v.sideOrientation),R=v.cap||e.e.NO_CAP,O=2*Math.PI,I=[],K=v.invertUV||!1;let q=0,u=0;const s=O/h*N;let r,d;for(q=0;q<=h-A;q++){for(d=[],R!=e.e.CAP_START&&R!=e.e.CAP_ALL||(d.push(new z.Rv(0,B[0].y,0)),d.push(new z.Rv(Math.cos(q*s)*B[0].x*g,B[0].y,Math.sin(q*s)*B[0].x*g))),u=0;u<B.length;u++)r=new z.Rv(Math.cos(q*s)*B[u].x*g,B[u].y,Math.sin(q*s)*B[u].x*g),d.push(r);R!=e.e.CAP_END&&R!=e.e.CAP_ALL||(d.push(new z.Rv(Math.cos(q*s)*B[B.length-1].x*g,B[B.length-1].y,Math.sin(q*s)*B[B.length-1].x*g)),d.push(new z.Rv(0,B[B.length-1].y,0))),I.push(d)}return E(S,{pathArray:I,closeArray:m,sideOrientation:n,updatable:w,invertUV:K,frontUVs:v.frontUVs,backUVs:v.backUVs},D)}e.e.ExtrudeShape=function(S,v,D,z,N,m){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7?arguments[7]:void 0,E=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0;return i(S,{shape:v,path:D,scale:z,rotation:N,cap:0===m?0:m||e.e.NO_CAP,sideOrientation:E,instance:h,updatable:g},B)},e.e.ExtrudeShapeCustom=(S,v,D,z,N,m,B,g,E,h,A,w)=>t(S,{shape:v,path:D,scaleFunction:z,rotationFunction:N,ribbonCloseArray:m,ribbonClosePath:B,cap:0===g?0:g||e.e.NO_CAP,sideOrientation:A,instance:w,updatable:h},E);e.e.CreateLathe=(S,v,D,z,e,N,m)=>a(S,{shape:v,radius:D,tessellation:z,sideOrientation:m,updatable:N},e);var o=D(12683),M=D(12630);function c(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=v.path;let m=v.instance,B=1;void 0!==v.radius?B=v.radius:m&&(B=m._creationDataStorage.radius);const g=v.tessellation||64,h=v.radiusFunction||null;let A=v.cap||e.e.NO_CAP;const w=v.invertUV||!1,n=v.updatable,R=e.e._GetDefaultSideOrientation(v.sideOrientation);v.arc=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1;const O=(S,v,D,N,m,B,g,E)=>{const h=v.getTangents(),A=v.getNormals(),w=v.getDistances(),n=2*Math.PI/m*E,R=B||(()=>N);let O,I,K,q;const u=z.TmpVectors.Matrix[0];let s=g===e.e.NO_CAP||g===e.e.CAP_END?0:2;for(let e=0;e<S.length;e++){I=R(e,w[e]),O=Array(),K=A[e];for(let v=0;v<m;v++)z.Matrix.RotationAxisToRef(h[e],n*v,u),q=O[v]?O[v]:z.Rv.Zero(),z.Rv.TransformCoordinatesToRef(K,u,q),q.scaleInPlace(I).addInPlace(S[e]),O[v]=q;D[s]=O,s++}const r=(v,D)=>{const z=Array();for(let e=0;e<v;e++)z.push(S[D]);return z};switch(g){case e.e.NO_CAP:break;case e.e.CAP_START:D[0]=r(m,0),D[1]=D[2].slice(0);break;case e.e.CAP_END:D[s]=D[s-1].slice(0),D[s+1]=r(m,S.length-1);break;case e.e.CAP_ALL:D[0]=r(m,0),D[1]=D[2].slice(0),D[s]=D[s-1].slice(0),D[s+1]=r(m,S.length-1)}return D};let I,K;if(m){const S=m._creationDataStorage,D=v.arc||S.arc;return I=S.path3D.update(N),K=O(N,I,S.pathArray,B,S.tessellation,h,S.cap,D),m=E("",{pathArray:K,instance:m}),S.path3D=I,S.pathArray=K,S.arc=D,S.radius=B,m}I=new Z.k(N);A=A<0||A>3?0:A,K=O(N,I,new Array,B,g,h,A,v.arc);const q=E(S,{pathArray:K,closePath:!0,closeArray:!1,updatable:n,sideOrientation:R,invertUV:w,frontUVs:v.frontUVs,backUVs:v.backUVs},D);return q._creationDataStorage.pathArray=K,q._creationDataStorage.path3D=I,q._creationDataStorage.tessellation=g,q._creationDataStorage.cap=A,q._creationDataStorage.arc=v.arc,q._creationDataStorage.radius=B,q}function J(S){const v=[];v[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},v[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},v[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},v[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},v[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},v[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},v[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},v[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},v[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},v[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},v[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},v[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},v[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},v[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},v[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const D=S.type&&(S.type<0||S.type>=v.length)?0:S.type||0,e=S.size,N=S.sizeX||e||1,g=S.sizeY||e||1,E=S.sizeZ||e||1,h=S.custom||v[D],A=h.face.length,n=S.faceUV||new Array(A),R=S.faceColors,O=void 0===S.flat||S.flat,I=0===S.sideOrientation?0:S.sideOrientation||m.e.DEFAULTSIDE,K=[],q=[],u=[],s=[],r=[];let d=0,x=0;const W=[];let p,b,k,Z,i,t,X=0,a=0;if(O)for(a=0;a<A;a++)R&&void 0===R[a]&&(R[a]=new w.Ge(1,1,1,1)),n&&void 0===n[a]&&(n[a]=new z.Vector4(0,0,1,1));if(O)for(a=0;a<A;a++){const S=h.face[a].length;for(k=2*Math.PI/S,Z=.5*Math.tan(k/2),i=.5,X=0;X<S;X++)K.push(h.vertex[h.face[a][X]][0]*N,h.vertex[h.face[a][X]][1]*g,h.vertex[h.face[a][X]][2]*E),W.push(d),d++,p=n[a].x+(n[a].z-n[a].x)*(.5+Z),b=n[a].y+(n[a].w-n[a].y)*(i-.5),s.push(p,B.b?1-b:b),t=Z*Math.cos(k)-i*Math.sin(k),i=Z*Math.sin(k)+i*Math.cos(k),Z=t,R&&r.push(R[a].r,R[a].g,R[a].b,R[a].a);for(X=0;X<S-2;X++)q.push(W[0+x],W[X+2+x],W[X+1+x]);x+=S}else{for(X=0;X<h.vertex.length;X++)K.push(h.vertex[X][0]*N,h.vertex[X][1]*g,h.vertex[X][2]*E),s.push(0,B.b?1:0);for(a=0;a<A;a++)for(X=0;X<h.face[a].length-2;X++)q.push(h.face[a][0],h.face[a][X+2],h.face[a][X+1])}m.e.ComputeNormals(K,q,u),m.e._ComputeSides(I,K,q,u,s,S.frontUVs,S.backUVs);const o=new m.e;return o.pS=K,o.indices=q,o.bS=u,o.ZS=s,R&&O&&(o.kS=r),o}function H(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new e.e(S,D);v.sideOrientation=e.e._GetDefaultSideOrientation(v.sideOrientation),z._originalBuilderSideOrientation=v.sideOrientation;return J(v).tS(z,v.updatable),z}e.e.CreateTube=(S,v,D,z,e,N,m,B,g,E)=>c(S,{path:v,radius:D,tessellation:z,radiusFunction:e,arc:1,cap:N,updatable:B,sideOrientation:g,instance:E},m);function T(S){const v=S.sideOrientation||m.e.DEFAULTSIDE,D=S.radius||1,e=void 0===S.flat||S.flat,N=0|(S.subdivisions||4),g=S.radiusX||D,E=S.radiusY||D,h=S.radiusZ||D,A=(1+Math.sqrt(5))/2,w=[-1,A,-0,1,A,0,-1,-A,0,1,-A,0,0,-1,-A,0,1,-A,0,-1,A,0,1,A,A,0,1,A,0,-1,-A,0,1,-A,0,-1],n=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],R=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],O=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],I=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],K=[],q=[],u=[],s=[];let r=0;const d=new Array(3),x=new Array(3);let W;for(W=0;W<3;W++)d[W]=z.Rv.Zero(),x[W]=z.Vector2.Zero();for(let m=0;m<20;m++){for(W=0;W<3;W++){const S=n[3*m+W];d[W].oe(w[3*R[S]],w[3*R[S]+1],w[3*R[S]+2]),d[W].normalize(),x[W].oe(.134765625*O[2*S]+.05859375+-.0390625*I[m],.2333984375*O[2*S+1]+.025390625+.01953125*I[m])}const S=(S,v,D,m)=>{const A=z.Rv.Lerp(d[0],d[2],v/N),w=z.Rv.Lerp(d[1],d[2],v/N),n=N===v?d[2]:z.Rv.Lerp(A,w,S/(N-v));let R;if(n.normalize(),e){const S=z.Rv.Lerp(d[0],d[2],m/N),v=z.Rv.Lerp(d[1],d[2],m/N);R=z.Rv.Lerp(S,v,D/(N-m))}else R=new z.Rv(n.x,n.y,n.z);R.x/=g,R.y/=E,R.z/=h,R.normalize();const O=z.Vector2.Lerp(x[0],x[2],v/N),I=z.Vector2.Lerp(x[1],x[2],v/N),W=N===v?x[2]:z.Vector2.Lerp(O,I,S/(N-v));q.push(n.x*g,n.y*E,n.z*h),u.push(R.x,R.y,R.z),s.push(W.x,B.b?1-W.y:W.y),K.push(r),r++};for(let v=0;v<N;v++)for(let D=0;D+v<N;D++)S(D,v,D+1/3,v+1/3),S(D+1,v,D+1/3,v+1/3),S(D,v+1,D+1/3,v+1/3),D+v+1<N&&(S(D+1,v,D+2/3,v+2/3),S(D+1,v+1,D+2/3,v+2/3),S(D,v+1,D+2/3,v+2/3))}m.e._ComputeSides(v,q,K,u,s,S.frontUVs,S.backUVs);const p=new m.e;return p.indices=K,p.pS=q,p.bS=u,p.ZS=s,p}function G(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new e.e(S,D);v.sideOrientation=e.e._GetDefaultSideOrientation(v.sideOrientation),z._originalBuilderSideOrientation=v.sideOrientation;return T(v).tS(z,v.updatable),z}m.e.CreatePolyhedron=J,e.e.CreatePolyhedron=(S,v,D)=>H(S,v,D);m.e.CreateIcoSphere=T,e.e.CreateIcoSphere=(S,v,D)=>G(S,v,D);var Y=D(11393);const j=new z.Rv(1,0,0),V=new z.Rv(-1,0,0),U=new z.Rv(0,1,0),y=new z.Rv(0,-1,0),f=new z.Rv(0,0,1),C=new z.Rv(0,0,-1);class F{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.Rv.Zero(),v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.Rv.Up(),D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.Vector2.Zero(),e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=S,this.normal=v,this.uv=D,this.vertexIdx=e,this.vertexIdxForBones=N,this.localPositionOverride=m,this.localNormalOverride=B,this.matrixIndicesOverride=g,this.matrixWeightsOverride=E}clone(){var S,v,D,z;return new F(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(S=this.localPositionOverride)||void 0===S?void 0:S.slice(),null===(v=this.localNormalOverride)||void 0===v?void 0:v.slice(),null===(D=this.matrixIndicesOverride)||void 0===D?void 0:D.slice(),null===(z=this.matrixWeightsOverride)||void 0===z?void 0:z.slice())}}function l(S,v,D){var g,E,h,A,w;const n=!!v.skeleton,R=!(null===(g=v.morphTargetManager)||void 0===g||!g.numTargets),O=D.localMode||n,I=v.te(),K=n||R?v.ZB(!0,!0):v.getVerticesData(N.d.PositionKind),q=n||R?v.getNormalsData(!0,!0):v.getVerticesData(N.d.NormalKind),u=O?n?v.getVerticesData(N.d.PositionKind):K:null,s=O?n?v.getVerticesData(N.d.NormalKind):q:null,r=v.getVerticesData(N.d.UVKind),d=n?v.getVerticesData(N.d.MatricesIndicesKind):null,x=n?v.getVerticesData(N.d.MatricesWeightsKind):null,W=n?v.getVerticesData(N.d.MatricesIndicesExtraKind):null,p=n?v.getVerticesData(N.d.MatricesWeightsExtraKind):null,b=D.position||z.Rv.Zero();let k=D.normal||z.Rv.Up();const Z=D.size||z.Rv.One(),i=D.angle||0;if(!k){const S=new z.Rv(0,0,1),D=v.xS().activeCamera,e=z.Rv.TransformCoordinates(S,D.getWorldMatrix());k=D.globalPosition.Ov(e)}const t=-Math.atan2(k.z,k.x)-Math.PI/2,X=Math.sqrt(k.x*k.x+k.z*k.z),a=Math.atan2(k.y,X),o=new m.e;o.indices=[],o.pS=[],o.bS=[],o.ZS=[],o.matricesIndices=n?[]:null,o.matricesWeights=n?[]:null,o.matricesIndicesExtra=W?[]:null,o.matricesWeightsExtra=p?[]:null;let M=0;const c=(S,v)=>{const e=new F;if(!I||!K||!q)return e;const N=I[S];if(e.vertexIdx=3*N,e.vertexIdxForBones=4*N,e.position=new z.Rv(K[3*N],K[3*N+1],K[3*N+2]),z.Rv.TransformCoordinatesToRef(e.position,v,e.position),e.normal=new z.Rv(q[3*N],q[3*N+1],q[3*N+2]),z.Rv.TransformNormalToRef(e.normal,v,e.normal),D.captureUVS&&r){const S=r[2*N+1];e.uv=new z.Vector2(r[2*N],B.b?1-S:S)}return e},J=[0,0,0,0],H=(S,v)=>{if(0===S.length)return S;const D=.5*Math.abs(z.Rv.Dot(Z,v)),e=(S,v,D,z)=>{for(let e=0;e<z;++e)if(S[D+e]===v)return D+e;return-1},N=(S,N)=>{const m=z.Rv.GetClipFactor(S.position,N.position,v,D);let B=J,g=J;if(d&&x){const v=S.matrixIndicesOverride?0:S.vertexIdxForBones,D=S.matrixIndicesOverride??d,z=S.matrixWeightsOverride??x,E=N.matrixIndicesOverride?0:N.vertexIdxForBones,h=N.matrixIndicesOverride??d,A=N.matrixWeightsOverride??x;B=[0,0,0,0],g=[0,0,0,0];let w=0;for(let S=0;S<4;++S)if(z[v+S]>0){const N=e(h,D[v+S],E,4);B[w]=D[v+S],g[w]=(0,Y.Lerp)(z[v+S],N>=0?A[N]:0,m),w++}for(let S=0;S<4&&w<4;++S){const z=h[E+S];-1===e(D,z,v,4)&&(B[w]=z,g[w]=(0,Y.Lerp)(0,A[E+S],m),w++)}const n=g[0]+g[1]+g[2]+g[3];g[0]/=n,g[1]/=n,g[2]/=n,g[3]/=n}const E=S.localPositionOverride?S.localPositionOverride[0]:(null===u||void 0===u?void 0:u[S.vertexIdx])??0,h=S.localPositionOverride?S.localPositionOverride[1]:(null===u||void 0===u?void 0:u[S.vertexIdx+1])??0,A=S.localPositionOverride?S.localPositionOverride[2]:(null===u||void 0===u?void 0:u[S.vertexIdx+2])??0,w=N.localPositionOverride?N.localPositionOverride[0]:(null===u||void 0===u?void 0:u[N.vertexIdx])??0,n=N.localPositionOverride?N.localPositionOverride[1]:(null===u||void 0===u?void 0:u[N.vertexIdx+1])??0,R=N.localPositionOverride?N.localPositionOverride[2]:(null===u||void 0===u?void 0:u[N.vertexIdx+2])??0,O=S.localNormalOverride?S.localNormalOverride[0]:(null===s||void 0===s?void 0:s[S.vertexIdx])??0,I=S.localNormalOverride?S.localNormalOverride[1]:(null===s||void 0===s?void 0:s[S.vertexIdx+1])??0,K=S.localNormalOverride?S.localNormalOverride[2]:(null===s||void 0===s?void 0:s[S.vertexIdx+2])??0,q=O+((N.localNormalOverride?N.localNormalOverride[0]:(null===s||void 0===s?void 0:s[N.vertexIdx])??0)-O)*m,r=I+((N.localNormalOverride?N.localNormalOverride[1]:(null===s||void 0===s?void 0:s[N.vertexIdx+1])??0)-I)*m,W=K+((N.localNormalOverride?N.localNormalOverride[2]:(null===s||void 0===s?void 0:s[N.vertexIdx+2])??0)-K)*m,p=Math.sqrt(q*q+r*r+W*W);return new F(z.Rv.Lerp(S.position,N.position,m),z.Rv.Lerp(S.normal,N.normal,m).normalize(),z.Vector2.Lerp(S.uv,N.uv,m),-1,-1,u?[E+(w-E)*m,h+(n-h)*m,A+(R-A)*m]:null,s?[q/p,r/p,W/p]:null,B,g)};let m=null;S.length>3&&(m=[]);for(let B=0;B<S.length;B+=3){let e=0,g=null,E=null,h=null,A=null;const w=z.Rv.Dot(S[B].position,v)-D>0,n=z.Rv.Dot(S[B+1].position,v)-D>0,R=z.Rv.Dot(S[B+2].position,v)-D>0;switch(e=(w?1:0)+(n?1:0)+(R?1:0),e){case 0:S.length>3?(m.push(S[B]),m.push(S[B+1]),m.push(S[B+2])):m=S;break;case 1:if(m=m??new Array,w&&(g=S[B+1],E=S[B+2],h=N(S[B],g),A=N(S[B],E)),n){g=S[B],E=S[B+2],h=N(S[B+1],g),A=N(S[B+1],E),m.push(h),m.push(E.clone()),m.push(g.clone()),m.push(E.clone()),m.push(h.clone()),m.push(A);break}R&&(g=S[B],E=S[B+1],h=N(S[B+2],g),A=N(S[B+2],E)),g&&E&&h&&A&&(m.push(g.clone()),m.push(E.clone()),m.push(h),m.push(A),m.push(h.clone()),m.push(E.clone()));break;case 2:m=m??new Array,w||(g=S[B].clone(),E=N(g,S[B+1]),h=N(g,S[B+2]),m.push(g),m.push(E),m.push(h)),n||(g=S[B+1].clone(),E=N(g,S[B+2]),h=N(g,S[B]),m.push(g),m.push(E),m.push(h)),R||(g=S[B+2].clone(),E=N(g,S[B]),h=N(g,S[B+1]),m.push(g),m.push(E),m.push(h))}}return m},T=v instanceof e.e?v:null,G=null===T||void 0===T?void 0:T._thinInstanceDataStorage.matrixData,l=(null===T||void 0===T?void 0:T.Ue)||1,P=z.TmpVectors.Matrix[0];P.N(z.Matrix.IdentityReadOnly);for(let e=0;e<l;++e){if(null!==T&&void 0!==T&&T.hasThinInstances&&G){const S=16*e;P.setRowFromFloats(0,G[S+0],G[S+1],G[S+2],G[S+3]),P.setRowFromFloats(1,G[S+4],G[S+5],G[S+6],G[S+7]),P.setRowFromFloats(2,G[S+8],G[S+9],G[S+10],G[S+11]),P.setRowFromFloats(3,G[S+12],G[S+13],G[S+14],G[S+15])}const S=z.Matrix.RotationYawPitchRoll(t,a,i).multiply(z.Matrix.Translation(b.x,b.y,b.z)),N=z.Matrix.Invert(S),m=v.getWorldMatrix(),g=P.multiply(m).multiply(N),E=new Array(3);for(let v=0;v<I.length;v+=3){let S=E;if(S[0]=c(v,g),S[1]=c(v+1,g),S[2]=c(v+2,g),!(D.cullBackFaces&&-S[0].normal.z<=0&&-S[1].normal.z<=0&&-S[2].normal.z<=0)&&(S=H(S,j),S&&(S=H(S,V),S&&(S=H(S,U),S&&(S=H(S,y),S&&(S=H(S,f),S&&(S=H(S,C),S)))))))for(let v=0;v<S.length;v++){const z=S[v];if(o.indices.push(M),O?(z.localPositionOverride?(o.pS[3*M]=z.localPositionOverride[0],o.pS[3*M+1]=z.localPositionOverride[1],o.pS[3*M+2]=z.localPositionOverride[2]):u&&(o.pS[3*M]=u[z.vertexIdx],o.pS[3*M+1]=u[z.vertexIdx+1],o.pS[3*M+2]=u[z.vertexIdx+2]),z.localNormalOverride?(o.bS[3*M]=z.localNormalOverride[0],o.bS[3*M+1]=z.localNormalOverride[1],o.bS[3*M+2]=z.localNormalOverride[2]):s&&(o.bS[3*M]=s[z.vertexIdx],o.bS[3*M+1]=s[z.vertexIdx+1],o.bS[3*M+2]=s[z.vertexIdx+2])):(z.position.toArray(o.pS,3*M),z.normal.toArray(o.bS,3*M)),o.matricesIndices&&o.matricesWeights&&(z.matrixIndicesOverride?(o.matricesIndices[4*M]=z.matrixIndicesOverride[0],o.matricesIndices[4*M+1]=z.matrixIndicesOverride[1],o.matricesIndices[4*M+2]=z.matrixIndicesOverride[2],o.matricesIndices[4*M+3]=z.matrixIndicesOverride[3]):(d&&(o.matricesIndices[4*M]=d[z.vertexIdxForBones],o.matricesIndices[4*M+1]=d[z.vertexIdxForBones+1],o.matricesIndices[4*M+2]=d[z.vertexIdxForBones+2],o.matricesIndices[4*M+3]=d[z.vertexIdxForBones+3]),W&&o.matricesIndicesExtra&&(o.matricesIndicesExtra[4*M]=W[z.vertexIdxForBones],o.matricesIndicesExtra[4*M+1]=W[z.vertexIdxForBones+1],o.matricesIndicesExtra[4*M+2]=W[z.vertexIdxForBones+2],o.matricesIndicesExtra[4*M+3]=W[z.vertexIdxForBones+3])),z.matrixWeightsOverride?(o.matricesWeights[4*M]=z.matrixWeightsOverride[0],o.matricesWeights[4*M+1]=z.matrixWeightsOverride[1],o.matricesWeights[4*M+2]=z.matrixWeightsOverride[2],o.matricesWeights[4*M+3]=z.matrixWeightsOverride[3]):(x&&(o.matricesWeights[4*M]=x[z.vertexIdxForBones],o.matricesWeights[4*M+1]=x[z.vertexIdxForBones+1],o.matricesWeights[4*M+2]=x[z.vertexIdxForBones+2],o.matricesWeights[4*M+3]=x[z.vertexIdxForBones+3]),p&&o.matricesWeightsExtra&&(o.matricesWeightsExtra[4*M]=p[z.vertexIdxForBones],o.matricesWeightsExtra[4*M+1]=p[z.vertexIdxForBones+1],o.matricesWeightsExtra[4*M+2]=p[z.vertexIdxForBones+2],o.matricesWeightsExtra[4*M+3]=p[z.vertexIdxForBones+3]))),D.captureUVS)z.uv.toArray(o.ZS,2*M);else{o.ZS.push(.5+z.position.x/Z.x);const S=.5+z.position.y/Z.y;o.ZS.push(B.b?1-S:S)}M++}}}0===o.indices.length&&(o.indices=null),0===o.pS.length&&(o.pS=null),0===o.bS.length&&(o.bS=null),0===o.ZS.length&&(o.ZS=null),0===(null===(E=o.matricesIndices)||void 0===E?void 0:E.length)&&(o.matricesIndices=null),0===(null===(h=o.matricesWeights)||void 0===h?void 0:h.length)&&(o.matricesWeights=null),0===(null===(A=o.matricesIndicesExtra)||void 0===A?void 0:A.length)&&(o.matricesIndicesExtra=null),0===(null===(w=o.matricesWeightsExtra)||void 0===w?void 0:w.length)&&(o.matricesWeightsExtra=null);const Q=new e.e(S,v.xS());return o.tS(Q),O?(Q.skeleton=v.skeleton,Q.parent=v):(Q.position=b.clone(),Q.rotation=new z.Rv(a,t,i)),Q.ke(!0),Q.refreshBoundingInfo(!0,!0),Q}function P(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const v=0|Math.max(S.subdivisions?S.subdivisions:2,1),D=0|Math.max(S.tessellation?S.tessellation:16,3),e=Math.max(S.height?S.height:1,0),N=Math.max(S.radius?S.radius:.25,0),g=0|Math.max(S.capSubdivisions?S.capSubdivisions:6,1),E=D,h=v,A=Math.max(S.radiusTop?S.radiusTop:N,0),w=Math.max(S.radiusBottom?S.radiusBottom:N,0),n=e-(A+w),R=2*Math.PI,O=Math.max(S.topCapSubdivisions?S.topCapSubdivisions:g,1),I=Math.max(S.bottomCapSubdivisions?S.bottomCapSubdivisions:g,1),K=Math.acos((w-A)/e);let q=[];const u=[],s=[],r=[];let d=0;const x=[],W=.5*n,p=.5*Math.PI;let b,k;const Z=z.Rv.Zero(),i=z.Rv.Zero(),t=Math.cos(K),X=Math.sin(K),a=new z.Vector2(A*X,W+A*t).Ov(new z.Vector2(w*X,w*t-W)).length(),o=A*K+a+w*(p-K);let M=0;for(k=0;k<=O;k++){const S=[],v=p-K*(k/O);M+=A*K/O;const D=Math.cos(v),z=Math.sin(v),e=D*A;for(b=0;b<=E;b++){const v=b/E,N=v*R+0,m=Math.sin(N),g=Math.cos(N);i.x=e*m,i.y=W+z*A,i.z=e*g,u.push(i.x,i.y,i.z),Z.set(D*m,z,D*g),s.push(Z.x,Z.y,Z.z),r.push(v,B.b?M/o:1-M/o),S.push(d),d++}x.push(S)}const c=e-A-w+t*A-t*w,J=X*(w-A)/c;for(k=1;k<=h;k++){const S=[];M+=a/h;const v=X*(k*(w-A)/h+A);for(b=0;b<=E;b++){const D=b/E,z=D*R+0,e=Math.sin(z),N=Math.cos(z);i.x=v*e,i.y=W+t*A-k*c/h,i.z=v*N,u.push(i.x,i.y,i.z),Z.set(e,J,N).normalize(),s.push(Z.x,Z.y,Z.z),r.push(D,B.b?M/o:1-M/o),S.push(d),d++}x.push(S)}for(k=1;k<=I;k++){const S=[],v=p-K-(Math.PI-K)*(k/I);M+=w*K/I;const D=Math.cos(v),z=Math.sin(v),e=D*w;for(b=0;b<=E;b++){const v=b/E,N=v*R+0,m=Math.sin(N),g=Math.cos(N);i.x=e*m,i.y=z*w-W,i.z=e*g,u.push(i.x,i.y,i.z),Z.set(D*m,z,D*g),s.push(Z.x,Z.y,Z.z),r.push(v,B.b?M/o:1-M/o),S.push(d),d++}x.push(S)}for(b=0;b<E;b++)for(k=0;k<O+h+I;k++){const S=x[k][b],v=x[k+1][b],D=x[k+1][b+1],z=x[k][b+1];q.push(S),q.push(v),q.push(z),q.push(v),q.push(D),q.push(z)}if(q=q.reverse(),S.orientation&&!S.orientation.equals(z.Rv.Up())){const v=new z.Matrix;S.orientation.clone().scale(.5*Math.PI).cross(z.Rv.Up()).toQuaternion().toRotationMatrix(v);const D=z.Rv.Zero();for(let S=0;S<u.length;S+=3)D.set(u[S],u[S+1],u[S+2]),z.Rv.TransformCoordinatesToRef(D.clone(),v,D),u[S]=D.x,u[S+1]=D.y,u[S+2]=D.z}const H=new m.e;return H.pS=u,H.bS=s,H.ZS=r,H.indices=q,H}function Q(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:z.Rv.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new e.e(S,D);return P(v).tS(N,v.updatable),N}e.e.CreateDecal=(S,v,D,z,e,N)=>l(S,v,{position:D,normal:z,size:e,angle:N});e.e.CreateCapsule=(S,v,D)=>Q(S,v,D),m.e.CreateCapsule=P;var L=D(11190),SS=D(11377);class vS{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=S,this.y=v,S!==Math.floor(S)&&(S=Math.floor(S),L.b.Warn("x is not an integer, floor(x) used")),v!==Math.floor(v)&&(v=Math.floor(v),L.b.Warn("y is not an integer, floor(y) used"))}clone(){return new vS(this.x,this.y)}rotate60About(S){const v=this.x;return this.x=S.x+S.y-this.y,this.y=v+this.y-S.x,this}rotateNeg60About(S){const v=this.x;return this.x=v+this.y-S.y,this.y=S.x+S.y-v,this}rotate120(S,v){S!==Math.floor(S)&&(S=Math.floor(S),L.b.Warn("m not an integer only floor(m) used")),v!==Math.floor(v)&&(v=Math.floor(v),L.b.Warn("n not an integer only floor(n) used"));const D=this.x;return this.x=S-D-this.y,this.y=v+D,this}rotateNeg120(S,v){S!==Math.floor(S)&&(S=Math.floor(S),L.b.Warn("m is not an integer, floor(m) used")),v!==Math.floor(v)&&(v=Math.floor(v),L.b.Warn("n is not an integer,   floor(n) used"));const D=this.x;return this.x=this.y-v,this.y=S+v-D-this.y,this}toCartesianOrigin(S,v){const D=z.Rv.Zero();return D.x=S.x+2*this.x*v+this.y*v,D.y=S.y+Math.sqrt(3)*this.y*v,D}static Zero(){return new vS(0,0)}}class DS{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new zS("icosahedron","Regular",[[0,SS.f,-1],[-SS.f,1,0],[-1,0,-SS.f],[1,0,-SS.f],[SS.f,1,0],[0,SS.f,1],[-1,0,SS.f],[-SS.f,-1,0],[0,-SS.f,-1],[SS.f,-1,0],[1,0,SS.f],[0,-SS.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let S=12;const v={},D=this.m,z=this.n;let e,N,m,B,g,E=D,h=1,A=0;0!==z&&(E=(0,Y.HighestCommonFactor)(D,z)),h=D/E,A=z/E;const w=vS.Zero(),n=new vS(D,z),R=new vS(-z,D+z),O=vS.Zero(),I=vS.Zero(),K=vS.Zero();let q,u,s,r,d=[];const x=[],W=this.vertByDist,p=(D,z,e,N)=>{q=D+"|"+e,u=z+"|"+N,q in v||u in v?q in v&&!(u in v)?v[u]=v[q]:u in v&&!(q in v)&&(v[q]=v[u]):(v[q]=S,v[u]=S,S++),W[e][0]>2?x[v[q]]=[-W[e][0],W[e][1],v[q]]:x[v[q]]=[d[W[e][0]],W[e][1],v[q]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let b=0;b<20;b++){if(d=this.IDATA.face[b],m=d[2],B=d[1],g=d[0],s=w.x+"|"+w.y,q=b+"|"+s,q in v||(v[q]=m,x[m]=[d[W[s][0]],W[s][1]]),s=n.x+"|"+n.y,q=b+"|"+s,q in v||(v[q]=B,x[B]=[d[W[s][0]],W[s][1]]),s=R.x+"|"+R.y,q=b+"|"+s,q in v||(v[q]=g,x[g]=[d[W[s][0]],W[s][1]]),e=this.IDATA.edgematch[b][0],N=this.IDATA.edgematch[b][1],"B"===N)for(let S=1;S<E;S++)I.x=D-S*(h+A),I.y=z+S*h,K.x=-S*A,K.y=S*(h+A),s=I.x+"|"+I.y,r=K.x+"|"+K.y,p(b,e,s,r);if("O"===N)for(let S=1;S<E;S++)K.x=-S*A,K.y=S*(h+A),O.x=S*h,O.y=S*A,s=K.x+"|"+K.y,r=O.x+"|"+O.y,p(b,e,s,r);if(e=this.IDATA.edgematch[b][2],N=this.IDATA.edgematch[b][3],N&&"A"===N)for(let S=1;S<E;S++)O.x=S*h,O.y=S*A,I.x=D-(E-S)*(h+A),I.y=z+(E-S)*h,s=O.x+"|"+O.y,r=I.x+"|"+I.y,p(b,e,s,r);for(let D=0;D<this.vertices.length;D++)s=this.vertices[D].x+"|"+this.vertices[D].y,q=b+"|"+s,q in v||(v[q]=S++,W[s][0]>2?x[v[q]]=[-W[s][0],W[s][1],v[q]]:x[v[q]]=[d[W[s][0]],W[s][1],v[q]])}this.closestTo=x,this.vecToidx=v}calcCoeffs(){const S=this.m,v=this.n,D=Math.sqrt(3)/3,z=S*S+v*v+S*v;this.coau=(S+v)/z,this.cobu=-v/z,this.coav=-D*(S-v)/z,this.cobv=D*(2*S+v)/z}createInnerFacets(){const S=this.m,v=this.n;for(let D=0;D<v+S+1;D++)for(let S=this.min[D];S<this.max[D]+1;S++)S<this.max[D]&&S<this.max[D+1]+1&&this.innerFacets.push(["|"+S+"|"+D,"|"+S+"|"+(D+1),"|"+(S+1)+"|"+D]),D>0&&S<this.max[D-1]&&S+1<this.max[D]+1&&this.innerFacets.push(["|"+S+"|"+D,"|"+(S+1)+"|"+D,"|"+(S+1)+"|"+(D-1)])}edgeVecsABOB(){const S=this.m,v=this.n,D=new vS(-v,S+v);for(let z=1;z<S+v;z++){const S=new vS(this.min[z],z),v=new vS(this.min[z-1],z-1),e=new vS(this.min[z+1],z+1),N=S.clone(),m=v.clone(),B=e.clone();N.rotate60About(D),m.rotate60About(D),B.rotate60About(D);const g=new vS(this.max[N.y],N.y),E=new vS(this.max[N.y-1],N.y-1),h=new vS(this.max[N.y-1]-1,N.y-1);N.x===g.x&&N.y===g.y||(N.x!==E.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([S,E,h]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([S,h,g])):N.y===B.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([S,v,E]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([S,E,e])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([S,v,E]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([S,E,g])))}}mapABOBtoOBOA(){const S=new vS(0,0);for(let v=0;v<this.isoVecsABOB.length;v++){const D=[];for(let z=0;z<3;z++)S.x=this.isoVecsABOB[v][z].x,S.y=this.isoVecsABOB[v][z].y,0===this.vertexTypes[v][z]&&S.rotateNeg120(this.m,this.n),D.push(S.clone());this.isoVecsOBOA.push(D)}}mapABOBtoBAOA(){const S=new vS(0,0);for(let v=0;v<this.isoVecsABOB.length;v++){const D=[];for(let z=0;z<3;z++)S.x=this.isoVecsABOB[v][z].x,S.y=this.isoVecsABOB[v][z].y,1===this.vertexTypes[v][z]&&S.rotate120(this.m,this.n),D.push(S.clone());this.isoVecsBAOA.push(D)}}MapToFace(S,v){const D=this.IDATA.face[S],e=D[2],N=D[1],m=D[0],B=z.Rv.uv(this.IDATA.vertex[e]),g=z.Rv.uv(this.IDATA.vertex[N]),E=z.Rv.uv(this.IDATA.vertex[m]),h=g.Ov(B),A=E.Ov(B),w=h.scale(this.coau).add(A.scale(this.cobu)),n=h.scale(this.coav).add(A.scale(this.cobv)),R=[];let O,I=z.TmpVectors.Rv[0];for(let z=0;z<this.cartesian.length;z++)I=w.scale(this.cartesian[z].x).add(n.scale(this.cartesian[z].y)).add(B),R[z]=[I.x,I.y,I.z],O=S+"|"+this.vertices[z].x+"|"+this.vertices[z].y,v.vertex[this.vecToidx[O]]=[I.x,I.y,I.z]}build(S,v){const D=[],z=vS.Zero(),e=new vS(S,v),N=new vS(-v,S+v);D.push(z,e,N);for(let s=v;s<S+1;s++)for(let v=0;v<S+1-s;v++)D.push(new vS(v,s));if(v>0){const z=(0,Y.HighestCommonFactor)(S,v),e=S/z,N=v/z;for(let B=1;B<z;B++)D.push(new vS(B*e,B*N)),D.push(new vS(-B*N,B*(e+N))),D.push(new vS(S-B*(e+N),v+B*e));const m=S/v;for(let B=1;B<v;B++)for(let z=0;z<B*m;z++)D.push(new vS(z,B)),D.push(new vS(z,B).rotate120(S,v)),D.push(new vS(z,B).rotateNeg120(S,v))}D.sort(((S,v)=>S.x-v.x)),D.sort(((S,v)=>S.y-v.y));const m=new Array(S+v+1),B=new Array(S+v+1);for(let s=0;s<m.length;s++)m[s]=1/0,B[s]=-1/0;let g=0,E=0;const h=D.length;for(let s=0;s<h;s++)E=D[s].x,g=D[s].y,m[g]=Math.min(E,m[g]),B[g]=Math.max(E,B[g]);const A=(D,z)=>{const e=D.clone();return"A"===z&&e.rotateNeg120(S,v),"B"===z&&e.rotate120(S,v),e.x<0?e.y:e.x+e.y},w=[],n=[],R=[],O=[],I={},K=[];let q=-1,u=-1;for(let s=0;s<h;s++)w[s]=D[s].toCartesianOrigin(new vS(0,0),.5),n[s]=A(D[s],"O"),R[s]=A(D[s],"A"),O[s]=A(D[s],"B"),n[s]===R[s]&&R[s]===O[s]?(q=3,u=n[s]):n[s]===R[s]?(q=4,u=n[s]):R[s]===O[s]?(q=5,u=R[s]):O[s]===n[s]&&(q=6,u=n[s]),n[s]<R[s]&&n[s]<O[s]&&(q=2,u=n[s]),R[s]<n[s]&&R[s]<O[s]&&(q=1,u=R[s]),O[s]<R[s]&&O[s]<n[s]&&(q=0,u=O[s]),K.push([q,u,D[s].x,D[s].y]);K.sort(((S,v)=>S[2]-v[2])),K.sort(((S,v)=>S[3]-v[3])),K.sort(((S,v)=>S[1]-v[1])),K.sort(((S,v)=>S[0]-v[0]));for(let s=0;s<K.length;s++)I[K[s][2]+"|"+K[s][3]]=[K[s][0],K[s][1],s];return this.m=S,this.n=v,this.vertices=D,this.vertByDist=I,this.cartesian=w,this.min=m,this.max=B,this}}class zS{constructor(S,v,D,z){this.name=S,this.category=v,this.vertex=D,this.face=z}}class eS extends zS{innerToData(S,v){for(let D=0;D<v.innerFacets.length;D++)this.face.push(v.innerFacets[D].map((D=>v.vecToidx[S+D])))}mapABOBtoDATA(S,v){const D=v.IDATA.edgematch[S][0];for(let z=0;z<v.isoVecsABOB.length;z++){const e=[];for(let N=0;N<3;N++)0===v.vertexTypes[z][N]?e.push(S+"|"+v.isoVecsABOB[z][N].x+"|"+v.isoVecsABOB[z][N].y):e.push(D+"|"+v.isoVecsABOB[z][N].x+"|"+v.isoVecsABOB[z][N].y);this.face.push([v.vecToidx[e[0]],v.vecToidx[e[1]],v.vecToidx[e[2]]])}}mapOBOAtoDATA(S,v){const D=v.IDATA.edgematch[S][0];for(let z=0;z<v.isoVecsOBOA.length;z++){const e=[];for(let N=0;N<3;N++)1===v.vertexTypes[z][N]?e.push(S+"|"+v.isoVecsOBOA[z][N].x+"|"+v.isoVecsOBOA[z][N].y):e.push(D+"|"+v.isoVecsOBOA[z][N].x+"|"+v.isoVecsOBOA[z][N].y);this.face.push([v.vecToidx[e[0]],v.vecToidx[e[1]],v.vecToidx[e[2]]])}}mapBAOAtoDATA(S,v){const D=v.IDATA.edgematch[S][2];for(let z=0;z<v.isoVecsBAOA.length;z++){const e=[];for(let N=0;N<3;N++)1===v.vertexTypes[z][N]?e.push(S+"|"+v.isoVecsBAOA[z][N].x+"|"+v.isoVecsBAOA[z][N].y):e.push(D+"|"+v.isoVecsBAOA[z][N].x+"|"+v.isoVecsBAOA[z][N].y);this.face.push([v.vecToidx[e[0]],v.vecToidx[e[1]],v.vecToidx[e[2]]])}}orderData(S){const v=[];for(let N=0;N<13;N++)v[N]=[];const D=S.closestTo;for(let N=0;N<D.length;N++)D[N][0]>-1?D[N][1]>0&&v[D[N][0]].push([N,D[N][1]]):v[12].push([N,D[N][0]]);const z=[];for(let N=0;N<12;N++)z[N]=N;let e=12;for(let N=0;N<12;N++){v[N].sort(((S,v)=>S[1]-v[1]));for(let S=0;S<v[N].length;S++)z[v[N][S][0]]=e++}for(let N=0;N<v[12].length;N++)z[v[12][N][0]]=e++;for(let N=0;N<this.vertex.length;N++)this.vertex[N].push(z[N]);this.vertex.sort(((S,v)=>S[3]-v[3]));for(let N=0;N<this.vertex.length;N++)this.vertex[N].pop();for(let N=0;N<this.face.length;N++)for(let S=0;S<this.face[N].length;S++)this.face[N][S]=z[this.face[N][S]];this.sharedNodes=v[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(S,v){const D=[],z=[];let e=v.pop();z.push(e);let N=this.face[e].indexOf(S);N=(N+2)%3;let m=this.face[e][N];D.push(m);let B=0;for(;v.length>0;)e=v[B],this.face[e].indexOf(m)>-1?(N=(this.face[e].indexOf(m)+1)%3,m=this.face[e][N],D.push(m),z.push(e),v.splice(B,1),B=0):B++;return this.adjacentFaces.push(D),z}toGoldbergPolyhedronData(){const S=new zS("GeoDual","Goldberg",[],[]);S.name="GD dual";const v=this.vertex.length,D=new Array(v);for(let g=0;g<v;g++)D[g]=[];for(let g=0;g<this.face.length;g++)for(let S=0;S<3;S++)D[this.face[g][S]].push(g);let z=0,e=0,N=0,m=[],B=[];this.adjacentFaces=[];for(let g=0;g<D.length;g++){S.face[g]=this.setOrder(g,D[g].concat([]));for(const v of D[g]){z=0,e=0,N=0,m=this.face[v];for(let S=0;S<3;S++)B=this.vertex[m[S]],z+=B[0],e+=B[1],N+=B[2];S.vertex[v]=[z/3,e/3,N/3]}}return S}static BuildGeodesicData(S){const v=new eS("Geodesic-m-n","Geodesic",[[0,SS.f,-1],[-SS.f,1,0],[-1,0,-SS.f],[1,0,-SS.f],[SS.f,1,0],[0,SS.f,1],[-1,0,SS.f],[-SS.f,-1,0],[0,-SS.f,-1],[SS.f,-1,0],[1,0,SS.f],[0,-SS.f,1]],[]);S.setIndices(),S.calcCoeffs(),S.createInnerFacets(),S.edgeVecsABOB(),S.mapABOBtoOBOA(),S.mapABOBtoBAOA();for(let D=0;D<S.IDATA.face.length;D++)S.MapToFace(D,v),v.innerToData(D,S),"B"===S.IDATA.edgematch[D][1]&&v.mapABOBtoDATA(D,S),"O"===S.IDATA.edgematch[D][1]&&v.mapOBOAtoDATA(D,S),"A"===S.IDATA.edgematch[D][3]&&v.mapBAOAtoDATA(D,S);v.orderData(S);return v.vertex=v.vertex.map((function(S){const v=S[0],D=S[1],z=S[2],e=Math.sqrt(v*v+D*D+z*z);return S[0]*=1/e,S[1]*=1/e,S[2]*=1/e,S})),v}}e.e._GoldbergMeshParser=(S,v)=>NS.Parse(S,v);class NS extends e.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(S,v){return void 0===v?(S>this.goldbergData.nbUnsharedFaces-1&&(L.b.Warn("Maximum number of unshared faces used"),S=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+S):(S>11&&(L.b.Warn("Last pole used"),S=11),v>this.goldbergData.nbFacesAtPole-1&&(L.b.Warn("Maximum number of faces at a pole used"),v=this.goldbergData.nbFacesAtPole-1),12+S*this.goldbergData.nbFacesAtPole+v)}_changeGoldbergFaceColors(S){for(let D=0;D<S.length;D++){const v=S[D][0],z=S[D][1],e=S[D][2];for(let S=v;S<z+1;S++)this.goldbergData.faceColors[S]=e}const v=[];for(let D=0;D<12;D++)for(let S=0;S<5;S++)v.push(this.goldbergData.faceColors[D].r,this.goldbergData.faceColors[D].g,this.goldbergData.faceColors[D].b,this.goldbergData.faceColors[D].a);for(let D=12;D<this.goldbergData.faceColors.length;D++)for(let S=0;S<6;S++)v.push(this.goldbergData.faceColors[D].r,this.goldbergData.faceColors[D].g,this.goldbergData.faceColors[D].b,this.goldbergData.faceColors[D].a);return v}setGoldbergFaceColors(S){const v=this._changeGoldbergFaceColors(S);this.MS(N.d.ColorKind,v)}updateGoldbergFaceColors(S){const v=this._changeGoldbergFaceColors(S);this.updateVerticesData(N.d.ColorKind,v)}_changeGoldbergFaceUVs(S){const v=this.getVerticesData(N.d.UVKind);for(let D=0;D<S.length;D++){const z=S[D][0],e=S[D][1],N=S[D][2],m=S[D][3],B=S[D][4],g=[],E=[];let h,A;for(let S=0;S<5;S++)h=N.x+m*Math.cos(B+S*Math.PI/2.5),A=N.y+m*Math.sin(B+S*Math.PI/2.5),h<0&&(h=0),h>1&&(h=1),g.push(h,A);for(let S=0;S<6;S++)h=N.x+m*Math.cos(B+S*Math.PI/3),A=N.y+m*Math.sin(B+S*Math.PI/3),h<0&&(h=0),h>1&&(h=1),E.push(h,A);for(let S=z;S<Math.min(12,e+1);S++)for(let D=0;D<5;D++)v[10*S+2*D]=g[2*D],v[10*S+2*D+1]=g[2*D+1];for(let S=Math.max(12,z);S<e+1;S++)for(let D=0;D<6;D++)v[12*S-24+2*D]=E[2*D],v[12*S-23+2*D]=E[2*D+1]}return v}setGoldbergFaceUVs(S){const v=this._changeGoldbergFaceUVs(S);this.MS(N.d.UVKind,v)}updateGoldbergFaceUVs(S){const v=this._changeGoldbergFaceUVs(S);this.updateVerticesData(N.d.UVKind,v)}placeOnGoldbergFaceAt(S,v,D){const e=z.Rv.RotationFromAxis(this.goldbergData.faceXaxis[v],this.goldbergData.faceYaxis[v],this.goldbergData.faceZaxis[v]);S.rotation=e,S.position=this.goldbergData.faceCenters[v].add(this.goldbergData.faceXaxis[v].scale(D.x)).add(this.goldbergData.faceYaxis[v].scale(D.y)).add(this.goldbergData.faceZaxis[v].scale(D.z))}serialize(S){super.serialize(S),S.type="GoldbergMesh";const v={};if(v.adjacentFaces=this.goldbergData.adjacentFaces,v.nbSharedFaces=this.goldbergData.nbSharedFaces,v.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,v.nbFaces=this.goldbergData.nbFaces,v.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){v.faceColors=[];for(const S of this.goldbergData.faceColors)v.faceColors.push(S.Oe())}if(this.goldbergData.faceCenters){v.faceCenters=[];for(const S of this.goldbergData.faceCenters)v.faceCenters.push(S.Oe())}if(this.goldbergData.faceZaxis){v.faceZaxis=[];for(const S of this.goldbergData.faceZaxis)v.faceZaxis.push(S.Oe())}if(this.goldbergData.faceYaxis){v.faceYaxis=[];for(const S of this.goldbergData.faceYaxis)v.faceYaxis.push(S.Oe())}if(this.goldbergData.faceXaxis){v.faceXaxis=[];for(const S of this.goldbergData.faceXaxis)v.faceXaxis.push(S.Oe())}S.goldbergData=v}static Parse(S,v){const D=S.goldbergData;D.faceColors=D.faceColors.map((S=>w.Ge.uv(S))),D.faceCenters=D.faceCenters.map((S=>z.Rv.uv(S))),D.faceZaxis=D.faceZaxis.map((S=>z.Rv.uv(S))),D.faceXaxis=D.faceXaxis.map((S=>z.Rv.uv(S))),D.faceYaxis=D.faceYaxis.map((S=>z.Rv.uv(S)));const e=new NS(S.name,v);return e.goldbergData=D,e}}var mS=D(11906);const BS={CreateBox:A.b,CreateTiledBox:I,CreateSphere:K.d,CreateDisc:h.d,CreateIcoSphere:G,CreateRibbon:E,CreateCylinder:r,CreateTorus:x,CreateTorusKnot:p,CreateLineSystem:b.i,bE:b.m,CreateDashedLines:b.e,ExtrudeShape:i,ExtrudeShapeCustom:t,CreateLathe:a,CreateTiledPlane:R,ZE:o.e,CreateGround:M.e,CreateTiledGround:M.h,CreateGroundFromHeightMap:M.c,CreatePolygon:k.b,ExtrudePolygon:k.c,CreateTube:c,CreatePolyhedron:H,CreateGeodesic:function(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=v.m||1;z!==Math.floor(z)&&(z=Math.floor(z),L.b.Warn("m not an integer only floor(m) used"));let e=v.n||0;if(e!==Math.floor(e)&&(e=Math.floor(e),L.b.Warn("n not an integer only floor(n) used")),e>z){const S=e;e=z,z=S,L.b.Warn("n > m therefore m and n swapped")}const N=new DS;return N.build(z,e),H(S,{custom:eS.BuildGeodesicData(N),size:v.size,sizeX:v.sizeX,sizeY:v.sizeY,sizeZ:v.sizeZ,faceUV:v.faceUV,faceColors:v.faceColors,flat:v.flat,updatable:v.updatable,sideOrientation:v.sideOrientation,frontUVs:v.frontUVs,backUVs:v.backUVs},D)},CreateGoldberg:function(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=v.size,g=v.sizeX||N||1,E=v.sizeY||N||1,h=v.sizeZ||N||1;let A=v.m||1;A!==Math.floor(A)&&(A=Math.floor(A),L.b.Warn("m not an integer only floor(m) used"));let n=v.n||0;if(n!==Math.floor(n)&&(n=Math.floor(n),L.b.Warn("n not an integer only floor(n) used")),n>A){const S=n;n=A,A=S,L.b.Warn("n > m therefore m and n swapped")}const R=new DS;R.build(A,n);const O=eS.BuildGeodesicData(R),I=O.toGoldbergPolyhedronData(),K=new NS(S,D);v.sideOrientation=e.e._GetDefaultSideOrientation(v.sideOrientation),K._originalBuilderSideOrientation=v.sideOrientation;(function(S,v){const D=S.size,e=S.sizeX||D||1,N=S.sizeY||D||1,g=S.sizeZ||D||1,E=0===S.sideOrientation?0:S.sideOrientation||m.e.DEFAULTSIDE,h=[],A=[],w=[],n=[];let R=1/0,O=-1/0,I=1/0,K=-1/0;for(let z=0;z<v.vertex.length;z++)R=Math.min(R,v.vertex[z][0]*e),O=Math.max(O,v.vertex[z][0]*e),I=Math.min(I,v.vertex[z][1]*N),K=Math.max(K,v.vertex[z][1]*N);let q=0;for(let m=0;m<v.face.length;m++){const S=v.face[m],D=z.Rv.uv(v.vertex[S[0]]),E=z.Rv.uv(v.vertex[S[2]]),u=z.Rv.uv(v.vertex[S[1]]),s=E.Ov(D),r=u.Ov(D),d=z.Rv.Cross(r,s).normalize();for(let z=0;z<S.length;z++){w.push(d.x,d.y,d.z);const D=v.vertex[S[z]];h.push(D[0]*e,D[1]*N,D[2]*g);const m=(D[1]*N-I)/(K-I);n.push((D[0]*e-R)/(O-R),B.b?1-m:m)}for(let v=0;v<S.length-2;v++)A.push(q,q+v+2,q+v+1);q+=S.length}m.e._ComputeSides(E,h,A,w,n);const u=new m.e;return u.pS=h,u.indices=A,u.bS=w,u.ZS=n,u})(v,I).tS(K,v.updatable),K.goldbergData.nbSharedFaces=O.sharedNodes,K.goldbergData.nbUnsharedFaces=O.poleNodes,K.goldbergData.adjacentFaces=O.adjacentFaces,K.goldbergData.nbFaces=K.goldbergData.nbSharedFaces+K.goldbergData.nbUnsharedFaces,K.goldbergData.nbFacesAtPole=(K.goldbergData.nbUnsharedFaces-12)/12;for(let e=0;e<O.vertex.length;e++)K.goldbergData.faceCenters.push(z.Rv.uv(O.vertex[e])),K.goldbergData.faceCenters[e].x*=g,K.goldbergData.faceCenters[e].y*=E,K.goldbergData.faceCenters[e].z*=h,K.goldbergData.faceColors.push(new w.Ge(1,1,1,1));for(let e=0;e<I.face.length;e++){const S=I.face[e],v=z.Rv.uv(I.vertex[S[0]]),D=z.Rv.uv(I.vertex[S[2]]),N=z.Rv.uv(I.vertex[S[1]]),m=D.Ov(v),B=N.Ov(v),g=z.Rv.Cross(B,m).normalize(),E=z.Rv.Cross(B,g).normalize();K.goldbergData.faceXaxis.push(B.normalize()),K.goldbergData.faceYaxis.push(g),K.goldbergData.faceZaxis.push(E)}return K},CreateDecal:l,CreateCapsule:Q,CreateText:mS.f}},12704:(S,v,D)=>{"use strict";D.d(v,{c:()=>Bv});var z=D(11371),e=D(11757);class N extends e.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var m=D(11425),B=(D(11544),D(11329));class g{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(S){this._targetStopDuration!==S&&(this._targetStopDuration=S)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(S){this._noiseTexture!==S&&(this._noiseTexture=S,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(S){this._animationSheetEnabled!==S&&(this._animationSheetEnabled=S)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(S){this._isAnimationSheetEnabled!=S&&(this._isAnimationSheetEnabled=S,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(S){this._useLogarithmicDepth=S&&this.xS().getEngine().getCaps().fragmentDepthSupported}xS(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(S){switch(S){case g.BLENDMODE_MULTIPLYADD:return;case g.BLENDMODE_ADD:S=1;break;case g.BLENDMODE_ONEONE:S=6;break;case g.BLENDMODE_STANDARD:S=2;break;case g.BLENDMODE_MULTIPLY:S=4;break;case g.BLENDMODE_SUBTRACT:S=3}this._engine.setAlphaMode(S)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:z.Rv.Zero()}set direction1(S){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=S)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:z.Rv.Zero()}set direction2(S){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=S)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:z.Rv.Zero()}set minEmitBox(S){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=S)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:z.Rv.Zero()}set maxEmitBox(S){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=S)}get billboardMode(){return this._billboardMode}set billboardMode(S){this._billboardMode!==S&&(this._billboardMode=S,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(S){this._isBillboardBased!==S&&(this._isBillboardBased=S,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(S){this._attachImageProcessingConfiguration(S)}_attachImageProcessingConfiguration(S){S!==this._imageProcessingConfiguration&&(!S&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=S)}_reset(){}_removeGradientAndTexture(S,v,D){if(!v)return this;let z=0;for(const e of v){if(e.gradient===S){v.splice(z,1);break}z++}return D&&D.dispose(),this}constructor(S){this.animations=[],this.renderingGroupId=0,this.zv=z.Rv.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new z.Rv(10,10,10),this.onAnimationEnd=null,this.blendMode=g.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new z.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.xE=new z.Rv(0,0,0),this._useLogarithmicDepth=!1,this.gravity=z.Rv.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new m.Ge(1,1,1,1),this.color2=new m.Ge(1,1,1,1),this.colorDead=new m.Ge(0,0,0,1),this.textureMask=new m.Ge(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new N,this.id=S,this.name=S}createPointEmitter(S,v){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new z.Rv(0,1,0),arguments.length>2&&void 0!==arguments[2]||new z.Rv(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new z.Rv(0,1,0),arguments.length>4&&void 0!==arguments[4]||new z.Rv(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new z.Rv(0,1,0),arguments.length>3&&void 0!==arguments[3]||new z.Rv(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(S,v,D,z){throw new Error("Method not implemented.")}}g.BLENDMODE_ONEONE=0,g.BLENDMODE_STANDARD=1,g.BLENDMODE_ADD=2,g.BLENDMODE_MULTIPLY=3,g.BLENDMODE_MULTIPLYADD=4,g.BLENDMODE_SUBTRACT=-1,(0,B.f)("BABYLON.BaseParticleSystem",g);var E=D(11393),h=D(11193);class A{constructor(){this.direction1=new z.Rv(0,1,0),this.direction2=new z.Rv(0,1,0),this.minEmitBox=new z.Rv(-.5,-.5,-.5),this.maxEmitBox=new z.Rv(.5,.5,.5)}startDirectionFunction(S,v,D,e){const N=(0,E.RandomRange)(this.direction1.x,this.direction2.x),m=(0,E.RandomRange)(this.direction1.y,this.direction2.y),B=(0,E.RandomRange)(this.direction1.z,this.direction2.z);if(e)return v.x=N,v.y=m,void(v.z=B);z.Rv.TransformNormalFromFloatsToRef(N,m,B,S,v)}startPositionFunction(S,v,D,e){const N=(0,E.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),m=(0,E.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),B=(0,E.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(e)return v.x=N,v.y=m,void(v.z=B);z.Rv.TransformCoordinatesFromFloatsToRef(N,m,B,S,v)}clone(){const S=new A;return h.e.DeepCopy(this,S),S}applyToShader(S){S.setVector3("direction1",this.direction1),S.setVector3("direction2",this.direction2),S.setVector3("minEmitBox",this.minEmitBox),S.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(S){S.addUniform("direction1",3),S.addUniform("direction2",3),S.addUniform("minEmitBox",3),S.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const S={};return S.type=this.getClassName(),S.direction1=this.direction1.Oe(),S.direction2=this.direction2.Oe(),S.minEmitBox=this.minEmitBox.Oe(),S.maxEmitBox=this.maxEmitBox.Oe(),S}parse(S){z.Rv.FromArrayToRef(S.direction1,0,this.direction1),z.Rv.FromArrayToRef(S.direction2,0,this.direction2),z.Rv.FromArrayToRef(S.minEmitBox,0,this.minEmitBox),z.Rv.FromArrayToRef(S.maxEmitBox,0,this.maxEmitBox)}}class w{get radius(){return this._radius}set radius(S){this._radius=S,this._buildHeight()}get angle(){return this._angle}set angle(S){this._angle=S,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=D,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=v,this.radius=S}startDirectionFunction(S,v,D,e){e?z.TmpVectors.Rv[0].N(D.TB).normalize():D.position.subtractToRef(S.getTranslation(),z.TmpVectors.Rv[0]).normalize();const N=(0,E.RandomRange)(0,this.directionRandomizer),m=(0,E.RandomRange)(0,this.directionRandomizer),B=(0,E.RandomRange)(0,this.directionRandomizer);v.x=z.TmpVectors.Rv[0].x+N,v.y=z.TmpVectors.Rv[0].y+m,v.z=z.TmpVectors.Rv[0].z+B,v.normalize()}startPositionFunction(S,v,D,e){const N=(0,E.RandomRange)(0,2*Math.PI);let m;this.emitFromSpawnPointOnly?m=1e-4:(m=(0,E.RandomRange)(0,this.heightRange),m=1-m*m);let B=this._radius-(0,E.RandomRange)(0,this._radius*this.radiusRange);B*=m;const g=B*Math.sin(N),h=B*Math.cos(N),A=m*this._height;if(e)return v.x=g,v.y=A,void(v.z=h);z.Rv.TransformCoordinatesFromFloatsToRef(g,A,h,S,v)}clone(){const S=new w(this._radius,this._angle,this.directionRandomizer);return h.e.DeepCopy(this,S),S}applyToShader(S){S.setFloat2("radius",this._radius,this.radiusRange),S.setFloat("coneAngle",this._angle),S.setFloat2("height",this._height,this.heightRange),S.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(S){S.addUniform("radius",2),S.addUniform("coneAngle",1),S.addUniform("height",2),S.addUniform("directionRandomizer",1)}getEffectDefines(){let S="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(S+="\n#define CONEEMITTERSPAWNPOINT"),S}getClassName(){return"ConeParticleEmitter"}serialize(){const S={};return S.type=this.getClassName(),S.radius=this._radius,S.angle=this._angle,S.directionRandomizer=this.directionRandomizer,S.radiusRange=this.radiusRange,S.heightRange=this.heightRange,S.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,S}parse(S){this.radius=S.radius,this.angle=S.angle,this.directionRandomizer=S.directionRandomizer,this.radiusRange=void 0!==S.radiusRange?S.radiusRange:1,this.heightRange=void 0!==S.radiusRange?S.heightRange:1,this.emitFromSpawnPointOnly=void 0!==S.emitFromSpawnPointOnly&&S.emitFromSpawnPointOnly}}class n extends w{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.Rv(0,1,0),e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.Rv(0,1,0);super(S,v),this.direction1=D,this.direction2=e}startDirectionFunction(S,v){const D=(0,E.RandomRange)(this.direction1.x,this.direction2.x),e=(0,E.RandomRange)(this.direction1.y,this.direction2.y),N=(0,E.RandomRange)(this.direction1.z,this.direction2.z);z.Rv.TransformNormalFromFloatsToRef(D,e,N,S,v)}clone(){const S=new n(this.radius,this.angle,this.direction1,this.direction2);return h.e.DeepCopy(this,S),S}applyToShader(S){S.setFloat("radius",this.radius),S.setFloat("radiusRange",this.radiusRange),S.setVector3("direction1",this.direction1),S.setVector3("direction2",this.direction2)}buildUniformLayout(S){S.addUniform("radius",1),S.addUniform("radiusRange",1),S.addUniform("direction1",3),S.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const S=super.serialize();return S.direction1=this.direction1.Oe(),S.direction2=this.direction2.Oe(),S}parse(S){super.parse(S),this.direction1.N(S.direction1),this.direction2.N(S.direction2)}}class R{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=S,this.height=v,this.radiusRange=D,this.directionRandomizer=e,this._tempVector=z.Rv.Zero()}startDirectionFunction(S,v,D,e,N){D.position.subtractToRef(S.getTranslation(),this._tempVector),this._tempVector.normalize(),z.Rv.TransformNormalToRef(this._tempVector,N,this._tempVector);const m=(0,E.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let B=Math.atan2(this._tempVector.x,this._tempVector.z);B+=(0,E.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=m,this._tempVector.x=Math.sin(B),this._tempVector.z=Math.cos(B),this._tempVector.normalize(),e?v.N(this._tempVector):z.Rv.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,S,v)}startPositionFunction(S,v,D,e){const N=(0,E.RandomRange)(-this.height/2,this.height/2),m=(0,E.RandomRange)(0,2*Math.PI),B=(0,E.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),g=Math.sqrt(B)*this.radius,h=g*Math.cos(m),A=g*Math.sin(m);e?v.oe(h,N,A):z.Rv.TransformCoordinatesFromFloatsToRef(h,N,A,S,v)}clone(){const S=new R(this.radius,this.directionRandomizer);return h.e.DeepCopy(this,S),S}applyToShader(S){S.setFloat("radius",this.radius),S.setFloat("height",this.height),S.setFloat("radiusRange",this.radiusRange),S.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(S){S.addUniform("radius",1),S.addUniform("height",1),S.addUniform("radiusRange",1),S.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const S={};return S.type=this.getClassName(),S.radius=this.radius,S.height=this.height,S.radiusRange=this.radiusRange,S.directionRandomizer=this.directionRandomizer,S}parse(S){this.radius=S.radius,this.height=S.height,this.radiusRange=S.radiusRange,this.directionRandomizer=S.directionRandomizer}}class O extends R{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.Rv(0,1,0),N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.Rv(0,1,0);super(S,v,D),this.direction1=e,this.direction2=N}startDirectionFunction(S,v,D,e){const N=(0,E.RandomRange)(this.direction1.x,this.direction2.x),m=(0,E.RandomRange)(this.direction1.y,this.direction2.y),B=(0,E.RandomRange)(this.direction1.z,this.direction2.z);e?v.oe(N,m,B):z.Rv.TransformNormalFromFloatsToRef(N,m,B,S,v)}clone(){const S=new O(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return h.e.DeepCopy(this,S),S}applyToShader(S){S.setFloat("radius",this.radius),S.setFloat("height",this.height),S.setFloat("radiusRange",this.radiusRange),S.setVector3("direction1",this.direction1),S.setVector3("direction2",this.direction2)}buildUniformLayout(S){S.addUniform("radius",1),S.addUniform("height",1),S.addUniform("radiusRange",1),S.addUniform("direction1",3),S.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const S=super.serialize();return S.direction1=this.direction1.Oe(),S.direction2=this.direction2.Oe(),S}parse(S){super.parse(S),z.Rv.FromArrayToRef(S.direction1,0,this.direction1),z.Rv.FromArrayToRef(S.direction2,0,this.direction2)}}class I{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=S,this.radiusRange=v,this.directionRandomizer=D}startDirectionFunction(S,v,D,e){const N=D.position.Ov(S.getTranslation()).normalize(),m=(0,E.RandomRange)(0,this.directionRandomizer),B=(0,E.RandomRange)(0,this.directionRandomizer),g=(0,E.RandomRange)(0,this.directionRandomizer);N.x+=m,N.y+=B,N.z+=g,N.normalize(),e?v.N(N):z.Rv.TransformNormalFromFloatsToRef(N.x,N.y,N.z,S,v)}startPositionFunction(S,v,D,e){const N=this.radius-(0,E.RandomRange)(0,this.radius*this.radiusRange),m=(0,E.RandomRange)(0,1),B=(0,E.RandomRange)(0,2*Math.PI),g=Math.acos(2*m-1),h=N*Math.cos(B)*Math.sin(g),A=N*Math.cos(g),w=N*Math.sin(B)*Math.sin(g);e?v.oe(h,Math.abs(A),w):z.Rv.TransformCoordinatesFromFloatsToRef(h,Math.abs(A),w,S,v)}clone(){const S=new I(this.radius,this.directionRandomizer);return h.e.DeepCopy(this,S),S}applyToShader(S){S.setFloat("radius",this.radius),S.setFloat("radiusRange",this.radiusRange),S.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(S){S.addUniform("radius",1),S.addUniform("radiusRange",1),S.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const S={};return S.type=this.getClassName(),S.radius=this.radius,S.radiusRange=this.radiusRange,S.directionRandomizer=this.directionRandomizer,S}parse(S){this.radius=S.radius,this.radiusRange=S.radiusRange,this.directionRandomizer=S.directionRandomizer}}class K{constructor(){this.direction1=new z.Rv(0,1,0),this.direction2=new z.Rv(0,1,0)}startDirectionFunction(S,v,D,e){const N=(0,E.RandomRange)(this.direction1.x,this.direction2.x),m=(0,E.RandomRange)(this.direction1.y,this.direction2.y),B=(0,E.RandomRange)(this.direction1.z,this.direction2.z);e?v.oe(N,m,B):z.Rv.TransformNormalFromFloatsToRef(N,m,B,S,v)}startPositionFunction(S,v,D,e){e?v.oe(0,0,0):z.Rv.TransformCoordinatesFromFloatsToRef(0,0,0,S,v)}clone(){const S=new K;return h.e.DeepCopy(this,S),S}applyToShader(S){S.setVector3("direction1",this.direction1),S.setVector3("direction2",this.direction2)}buildUniformLayout(S){S.addUniform("direction1",3),S.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const S={};return S.type=this.getClassName(),S.direction1=this.direction1.Oe(),S.direction2=this.direction2.Oe(),S}parse(S){z.Rv.FromArrayToRef(S.direction1,0,this.direction1),z.Rv.FromArrayToRef(S.direction2,0,this.direction2)}}class q{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=S,this.radiusRange=v,this.directionRandomizer=D}startDirectionFunction(S,v,D,e){const N=D.position.Ov(S.getTranslation()).normalize(),m=(0,E.RandomRange)(0,this.directionRandomizer),B=(0,E.RandomRange)(0,this.directionRandomizer),g=(0,E.RandomRange)(0,this.directionRandomizer);N.x+=m,N.y+=B,N.z+=g,N.normalize(),e?v.N(N):z.Rv.TransformNormalFromFloatsToRef(N.x,N.y,N.z,S,v)}startPositionFunction(S,v,D,e){const N=this.radius-(0,E.RandomRange)(0,this.radius*this.radiusRange),m=(0,E.RandomRange)(0,1),B=(0,E.RandomRange)(0,2*Math.PI),g=Math.acos(2*m-1),h=N*Math.cos(B)*Math.sin(g),A=N*Math.cos(g),w=N*Math.sin(B)*Math.sin(g);e?v.oe(h,A,w):z.Rv.TransformCoordinatesFromFloatsToRef(h,A,w,S,v)}clone(){const S=new q(this.radius,this.directionRandomizer);return h.e.DeepCopy(this,S),S}applyToShader(S){S.setFloat("radius",this.radius),S.setFloat("radiusRange",this.radiusRange),S.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(S){S.addUniform("radius",1),S.addUniform("radiusRange",1),S.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const S={};return S.type=this.getClassName(),S.radius=this.radius,S.radiusRange=this.radiusRange,S.directionRandomizer=this.directionRandomizer,S}parse(S){this.radius=S.radius,this.radiusRange=S.radiusRange,this.directionRandomizer=S.directionRandomizer}}class u extends q{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.Rv(0,1,0),D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.Rv(0,1,0);super(S),this.direction1=v,this.direction2=D}startDirectionFunction(S,v){const D=(0,E.RandomRange)(this.direction1.x,this.direction2.x),e=(0,E.RandomRange)(this.direction1.y,this.direction2.y),N=(0,E.RandomRange)(this.direction1.z,this.direction2.z);z.Rv.TransformNormalFromFloatsToRef(D,e,N,S,v)}clone(){const S=new u(this.radius,this.direction1,this.direction2);return h.e.DeepCopy(this,S),S}applyToShader(S){S.setFloat("radius",this.radius),S.setFloat("radiusRange",this.radiusRange),S.setVector3("direction1",this.direction1),S.setVector3("direction2",this.direction2)}buildUniformLayout(S){S.addUniform("radius",1),S.addUniform("radiusRange",1),S.addUniform("direction1",3),S.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const S=super.serialize();return S.direction1=this.direction1.Oe(),S.direction2=this.direction2.Oe(),S}parse(S){super.parse(S),this.direction1.N(S.direction1),this.direction2.N(S.direction2)}}class s{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(S,v,D,e){const N=z.TmpVectors.Rv[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,D,N);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,D,N);const S=z.TmpVectors.Rv[1];N.subtractToRef(D.position,S),S.scaleToRef(1/D.lifeTime,N)}else N.set(0,0,0);e?v.N(N):z.Rv.TransformNormalToRef(N,S,v)}startPositionFunction(S,v,D,e){const N=z.TmpVectors.Rv[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,D,N):N.set(0,0,0),e?v.N(N):z.Rv.TransformCoordinatesToRef(N,S,v)}clone(){const S=new s;return h.e.DeepCopy(this,S),S}applyToShader(S){}buildUniformLayout(S){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const S={};return S.type=this.getClassName(),S.particlePositionGenerator=this.particlePositionGenerator,S.particleDestinationGenerator=this.particleDestinationGenerator,S}parse(S){S.particlePositionGenerator&&(this.particlePositionGenerator=S.particlePositionGenerator),S.particleDestinationGenerator&&(this.particleDestinationGenerator=S.particleDestinationGenerator)}}var r=D(11452);class d{get mesh(){return this._mesh}set mesh(S){this._mesh!==S&&(this._mesh=S,S?(this._indices=S.te(),this._positions=S.getVerticesData(r.d.PositionKind),this._normals=S.getVerticesData(r.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=z.Rv.Zero(),this._mesh=null,this.direction1=new z.Rv(0,1,0),this.direction2=new z.Rv(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=S}startDirectionFunction(S,v,D,e){if(this.useMeshNormalsForDirection&&this._normals)return void z.Rv.TransformNormalToRef(this._storedNormal,S,v);const N=(0,E.RandomRange)(this.direction1.x,this.direction2.x),m=(0,E.RandomRange)(this.direction1.y,this.direction2.y),B=(0,E.RandomRange)(this.direction1.z,this.direction2.z);e?v.oe(N,m,B):z.Rv.TransformNormalFromFloatsToRef(N,m,B,S,v)}startPositionFunction(S,v,D,e){if(!this._indices||!this._positions)return;const N=3*(Math.random()*(this._indices.length/3)|0),m=Math.random(),B=Math.random()*(1-m),g=1-m-B,E=this._indices[N],h=this._indices[N+1],A=this._indices[N+2],w=z.TmpVectors.Rv[0],n=z.TmpVectors.Rv[1],R=z.TmpVectors.Rv[2],O=z.TmpVectors.Rv[3];z.Rv.FromArrayToRef(this._positions,3*E,w),z.Rv.FromArrayToRef(this._positions,3*h,n),z.Rv.FromArrayToRef(this._positions,3*A,R),O.x=m*w.x+B*n.x+g*R.x,O.y=m*w.y+B*n.y+g*R.y,O.z=m*w.z+B*n.z+g*R.z,e?v.oe(O.x,O.y,O.z):z.Rv.TransformCoordinatesFromFloatsToRef(O.x,O.y,O.z,S,v),this.useMeshNormalsForDirection&&this._normals&&(z.Rv.FromArrayToRef(this._normals,3*E,w),z.Rv.FromArrayToRef(this._normals,3*h,n),z.Rv.FromArrayToRef(this._normals,3*A,R),this._storedNormal.x=m*w.x+B*n.x+g*R.x,this._storedNormal.y=m*w.y+B*n.y+g*R.y,this._storedNormal.z=m*w.z+B*n.z+g*R.z)}clone(){const S=new d(this.mesh);return h.e.DeepCopy(this,S),S}applyToShader(S){S.setVector3("direction1",this.direction1),S.setVector3("direction2",this.direction2)}buildUniformLayout(S){S.addUniform("direction1",3),S.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var S;const v={};return v.type=this.getClassName(),v.direction1=this.direction1.Oe(),v.direction2=this.direction2.Oe(),v.meshId=null===(S=this.mesh)||void 0===S?void 0:S.id,v.useMeshNormalsForDirection=this.useMeshNormalsForDirection,v}parse(S,v){z.Rv.FromArrayToRef(S.direction1,0,this.direction1),z.Rv.FromArrayToRef(S.direction2,0,this.direction2),S.meshId&&v&&(this.mesh=v.getLastMeshById(S.meshId)),this.useMeshNormalsForDirection=S.useMeshNormalsForDirection}}class x{_isUbo(S){return void 0!==S.addUniform}constructor(S){this._isUbo(S)?(this.setMatrix3x3=S.updateMatrix3x3.bind(S),this.setMatrix2x2=S.updateMatrix2x2.bind(S),this.setFloat=S.updateFloat.bind(S),this.setFloat2=S.updateFloat2.bind(S),this.setFloat3=S.updateFloat3.bind(S),this.setFloat4=S.updateFloat4.bind(S),this.setFloatArray=S.updateFloatArray.bind(S),this.setArray=S.updateArray.bind(S),this.setIntArray=S.updateIntArray.bind(S),this.setMatrix=S.pe.bind(S),this.setMatrices=S.updateMatrices.bind(S),this.setVector3=S.updateVector3.bind(S),this.setVector4=S.updateVector4.bind(S),this.setColor3=S.updateColor3.bind(S),this.setColor4=S.updateColor4.bind(S),this.setDirectColor4=S.updateDirectColor4.bind(S),this.setInt=S.updateInt.bind(S),this.setInt2=S.updateInt2.bind(S),this.setInt3=S.updateInt3.bind(S),this.setInt4=S.updateInt4.bind(S)):(this.setMatrix3x3=S.setMatrix3x3.bind(S),this.setMatrix2x2=S.setMatrix2x2.bind(S),this.setFloat=S.setFloat.bind(S),this.setFloat2=S.setFloat2.bind(S),this.setFloat3=S.setFloat3.bind(S),this.setFloat4=S.setFloat4.bind(S),this.setFloatArray=S.setFloatArray.bind(S),this.setArray=S.setArray.bind(S),this.setIntArray=S.setIntArray.bind(S),this.setMatrix=S.setMatrix.bind(S),this.setMatrices=S.setMatrices.bind(S),this.setVector3=S.setVector3.bind(S),this.setVector4=S.setVector4.bind(S),this.setColor3=S.setColor3.bind(S),this.setColor4=S.setColor4.bind(S),this.setDirectColor4=S.setDirectColor4.bind(S),this.setInt=S.setInt.bind(S),this.setInt2=S.setInt2.bind(S),this.setInt3=S.setInt3.bind(S),this.setInt4=S.setInt4.bind(S))}}var W=D(11280);const p="gpuUpdateParticlesPixelShader",b="#version 300 es\nvoid main() {discard;}\n";W.b.ShadersStore[p]||(W.b.ShadersStore[p]=b);const k="gpuUpdateParticlesVertexShader",Z="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";W.b.ShadersStore[k]||(W.b.ShadersStore[k]=Z);(0,B.f)("BABYLON.WebGL2ParticleSystem",class{constructor(S,v){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=S,this._engine=v,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var S;return(null===(S=this._updateEffect)||void 0===S?void 0:S.isReady())??!1}createUpdateBuffer(S){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof s&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=S,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new x(this._updateEffect)}createVertexBuffers(S,v){this._updateVAO.push(this._createUpdateVAO(S)),this._renderVAO.push(this._engine.recordVertexArrayObject(v,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=v}createParticleBuffer(S){return S}bindDrawBuffers(S,v,D){D?this._engine.bindBuffers(this._renderVertexBuffers,D,v):this._engine.bindVertexArrayObject(this._renderVAO[S],null)}preUpdateParticleBuffer(){const S=this._engine;if(this._engine.enableEffect(this._updateEffect),!S.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(S,v,D){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[S],null);const z=this._engine;z.bindTransformFeedbackBuffer(v.getBuffer()),z.setRasterizerState(!1),z.beginTransformFeedback(!0),z.drawArraysType(3,0,D),z.endTransformFeedback(),z.setRasterizerState(!0),z.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let S=0;S<this._updateVAO.length;S++)this._engine.releaseVertexArrayObject(this._updateVAO[S]);this._updateVAO.length=0;for(let S=0;S<this._renderVAO.length;S++)this._engine.releaseVertexArrayObject(this._renderVAO[S]);this._renderVAO.length=0}_createUpdateVAO(S){const v={};v.position=S.createVertexBuffer("position",0,3);let D=3;v.age=S.createVertexBuffer("age",D,1),D+=1,v.size=S.createVertexBuffer("size",D,3),D+=3,v.life=S.createVertexBuffer("life",D,1),D+=1,v.seed=S.createVertexBuffer("seed",D,4),D+=4,v.direction=S.createVertexBuffer("direction",D,3),D+=3,this._parent.particleEmitterType instanceof s&&(v.initialPosition=S.createVertexBuffer("initialPosition",D,3),D+=3),this._parent._colorGradientsTexture||(v.color=S.createVertexBuffer("color",D,4),D+=4),this._parent._isBillboardBased||(v.initialDirection=S.createVertexBuffer("initialDirection",D,3),D+=3),this._parent.noiseTexture&&(v.noiseCoordinates1=S.createVertexBuffer("noiseCoordinates1",D,3),D+=3,v.noiseCoordinates2=S.createVertexBuffer("noiseCoordinates2",D,3),D+=3),this._parent._angularSpeedGradientsTexture?(v.angle=S.createVertexBuffer("angle",D,1),D+=1):(v.angle=S.createVertexBuffer("angle",D,2),D+=2),this._parent._isAnimationSheetEnabled&&(v.cellIndex=S.createVertexBuffer("cellIndex",D,1),D+=1,this._parent.spriteRandomStartCell&&(v.cellStartOffset=S.createVertexBuffer("cellStartOffset",D,1),D+=1));const z=this._engine.recordVertexArrayObject(v,null,this._updateEffect);return this._engine.bindArrayBuffer(null),z}});class i{constructor(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,z=arguments.length>3?arguments[3]:void 0;this._engine=S,this._label=z,this._engine._storageBuffers.push(this),this._create(v,D)}_create(S,v){this._bufferSize=S,this._creationFlags=v,this._buffer=this._engine.createStorageBuffer(S,v,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(S,v,D){this._buffer&&this._engine.updateStorageBuffer(this._buffer,S,v,D)}async read(S,v,D,z){return await this._engine.readFromStorageBuffer(this._buffer,S,v,D,z)}dispose(){const S=this._engine._storageBuffers,v=S.indexOf(this);-1!==v&&(S[v]=S[S.length-1],S.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var t=D(11358),X=D(11364),a=D(11415),o=D(11350),M=D(11674),c=D(11190),J=D(11309),H=D(11601);class T{constructor(){this._gpuTimeInFrameId=-1,this.counter=new H.b}_addDuration(S,v){S<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==S?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(v,!1),this._gpuTimeInFrameId=S):this.counter.addCount(v,!1))}}var G=D(11262);class Y{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=S,this._engine=v,this.uniqueId=M.c.UniqueId,v.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new T),this._engine.getCaps().supportComputeShaders?z.bindingsMapping?(this._context=v.createComputeContext(),this._shaderPath=D,this._options={bindingsMapping:{},defines:[],...z}):c.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):c.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(S,v){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=this._bindings[S];this._bindings[S]={type:D?0:4,object:v,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!z||z.object!==v||z.type!==this._bindings[S].type)}setStorageTexture(S,v){const D=this._bindings[S];this._contextIsDirty||(this._contextIsDirty=!D||D.object!==v),this._bindings[S]={type:1,object:v,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}setExternalTexture(S,v){const D=this._bindings[S];this._contextIsDirty||(this._contextIsDirty=!D||D.object!==v),this._bindings[S]={type:6,object:v,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}setVideoTexture(S,v){return!!v.externalTexture&&(this.setExternalTexture(S,v.externalTexture),!0)}setUniformBuffer(S,v){const D=this._bindings[S];this._contextIsDirty||(this._contextIsDirty=!D||D.object!==v),this._bindings[S]={type:Y._BufferIsDataBuffer(v)?7:2,object:v,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}setStorageBuffer(S,v){const D=this._bindings[S];this._contextIsDirty||(this._contextIsDirty=!D||D.object!==v),this._bindings[S]={type:Y._BufferIsDataBuffer(v)?7:3,object:v,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}setTextureSampler(S,v){const D=this._bindings[S];this._contextIsDirty||(this._contextIsDirty=!D||!v.compareSampler(D.object)),this._bindings[S]={type:5,object:v,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}isReady(){let S=this._effect;for(const e in this._bindings){const S=this._bindings[e],v=S.type,D=S.object;switch(v){case 0:case 4:case 1:if(!D.isReady())return!1;break;case 6:if(!D.isReady())return!1;break}}const v=[],D=this._shaderPath;if(this._options.defines)for(let e=0;e<this._options.defines.length;e++)v.push(this._options.defines[e]);const z=v.join("\n");return this._cachedDefines!==z&&(this._cachedDefines=z,S=this._engine.createComputeEffect(D,{defines:z,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=S),!!S.isReady()}dispatch(S,v,D){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,S,v,D,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const D=Y._BufferIsDataBuffer(S)?S:S.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,D,v,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const v in this._bindings){const D=this._bindings[v];if(!this._options.bindingsMapping[v])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+v+"'");switch(D.type){case 0:{const z=this._samplers[v],e=D.object;var S;if(!z||!e._texture||!z.compareSampler(e._texture))this._samplers[v]=(new J.b).setParameters(e.wrapU,e.wrapV,e.wrapR,e.anisotropicFilteringLevel,e._texture.samplingMode,null===(S=e._texture)||void 0===S?void 0:S._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const S=D.object;S.getBuffer()!==D.buffer&&(D.buffer=S.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((e=>{(0,G.e)((()=>this.dispatch(S,v,D)),e,void 0,z)}))}serialize(){const S=a.b.Serialize(this);S.options=this._options,S.shaderPath=this._shaderPath,S.cw={},S.textures={};for(const v in this._bindings){const D=this._bindings[v],z=D.object;switch(D.type){case 0:case 4:case 1:{const e=z.serialize();e&&(S.textures[v]=e,S.cw[v]={type:D.type});break}}}return S}static Parse(S,v,D){const z=a.b.Parse((()=>new Y(S.name,v.getEngine(),S.shaderPath,S.options)),S,v,D);for(const e in S.textures){const N=S.cw[e],m=o.d.Parse(S.textures[e],v,D);0===N.type?z.setTexture(e,m):4===N.type?z.setTexture(e,m,!1):z.setStorageTexture(e,m)}return z}static _BufferIsDataBuffer(S){return void 0!==S.underlyingResource}}(0,t.b)([(0,X.L)()],Y.prototype,"name",void 0),(0,t.b)([(0,X.L)()],Y.prototype,"fastMode",void 0),(0,B.f)("BABYLON.ComputeShader",Y);var j=D(11639);const V="gpuUpdateParticlesComputeShader",U="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";W.b.ShadersStoreWGSL[V]||(W.b.ShadersStoreWGSL[V]=U);(0,B.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(S,v){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=S,this._engine=v}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var S;return(null===(S=this._updateComputeShader)||void 0===S?void 0:S.isReady())??!1}createUpdateBuffer(S){var v;const D={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(D.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(D.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(D.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(D.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(D.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(D.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(D.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new Y("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:D,defines:S.split("\n")}),null===(v=this._simParamsComputeShader)||void 0===v||v.dispose(),this._simParamsComputeShader=new j.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new x(this._simParamsComputeShader)}createVertexBuffers(S,v){this._renderVertexBuffers.push(v)}createParticleBuffer(S){const v=new i(this._engine,4*S.length,11,"ComputeShaderParticleSystemBuffer");return v.update(S),this._bufferComputeShader.push(v),v.getBuffer()}bindDrawBuffers(S,v,D){this._engine.bindBuffers(this._renderVertexBuffers[S],D,v)}preUpdateParticleBuffer(){}updateParticleBuffer(S,v,D){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[S]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^S]),this._updateComputeShader.dispatch(Math.ceil(D/64))}releaseBuffers(){var S;for(let v=0;v<this._bufferComputeShader.length;++v)this._bufferComputeShader[v].dispose();this._bufferComputeShader.length=0,null===(S=this._simParamsComputeShader)||void 0===S||S.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class y{constructor(S,v,D){this.gradient=S,this.color1=v,this.color2=D}getColorToRef(S){this.color2?m.Ge.LerpToRef(this.color1,this.color2,Math.random(),S):S.N(this.color1)}}class f{constructor(S,v){this.gradient=S,this.color=v}}class C{constructor(S,v,D){this.gradient=S,this.factor1=v,this.factor2=D}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class F{static GetCurrentGradient(S,v,D){if(v[0].gradient>S)return void D(v[0],v[0],1);for(let e=0;e<v.length-1;e++){const z=v[e],N=v[e+1];if(S>=z.gradient&&S<=N.gradient){return void D(z,N,(S-z.gradient)/(N.gradient-z.gradient))}}const z=v.length-1;D(v[z],v[z],1)}}var l=D(11179),P=D(11841),Q=D(11222);class L{constructor(S){this.particleSystem=S,this.position=z.Rv.Zero(),this.direction=z.Rv.Zero(),this.color=new m.Ge(0,0,0,0),this.colorStep=new m.Ge(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new z.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new m.Ge(0,0,0,0),this._currentColor2=new m.Ge(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=L._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let S=this.age,v=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===v?(v=1,S=this._randomCellOffset):S+=this._randomCellOffset);const D=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let z;z=this._initialSpriteCellLoop?(0,E.Clamp)(S*v%this.lifeTime/this.lifeTime):(0,E.Clamp)(S*v/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+z*D|0}_inheritParticleInfoToSubEmitter(S){if(S.particleSystem.zv.position){const v=S.particleSystem.zv;if(v.position.N(this.position),S.inheritDirection){const S=z.TmpVectors.Rv[0];this.direction.normalizeToRef(S),v.setDirection(S,0,Math.PI/2)}}else{S.particleSystem.zv.N(this.position)}this.direction.scaleToRef(S.inheritedVelocityAmount/2,z.TmpVectors.Rv[0]),S.particleSystem._inheritedVelocityOffset.N(z.TmpVectors.Rv[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const S of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(S)}_reset(){this.age=0,this.id=L._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(S){S.position.N(this.position),this._initialDirection?S._initialDirection?S._initialDirection.N(this._initialDirection):S._initialDirection=this._initialDirection.clone():S._initialDirection=null,S.direction.N(this.direction),this.TB&&(S.TB?S.TB.N(this.TB):S.TB=this.TB.clone()),S.color.N(this.color),S.colorStep.N(this.colorStep),S.lifeTime=this.lifeTime,S.age=this.age,S._randomCellOffset=this._randomCellOffset,S.size=this.size,S.scale.N(this.scale),S.angle=this.angle,S.angularSpeed=this.angularSpeed,S.particleSystem=this.particleSystem,S.cellIndex=this.cellIndex,S.id=this.id,S._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(S._currentColorGradient=this._currentColorGradient,S._currentColor1.N(this._currentColor1),S._currentColor2.N(this._currentColor2)),this._currentSizeGradient&&(S._currentSizeGradient=this._currentSizeGradient,S._currentSize1=this._currentSize1,S._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(S._currentAngularSpeedGradient=this._currentAngularSpeedGradient,S._currentAngularSpeed1=this._currentAngularSpeed1,S._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(S._currentVelocityGradient=this._currentVelocityGradient,S._currentVelocity1=this._currentVelocity1,S._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(S._currentLimitVelocityGradient=this._currentLimitVelocityGradient,S._currentLimitVelocity1=this._currentLimitVelocity1,S._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(S._currentDragGradient=this._currentDragGradient,S._currentDrag1=this._currentDrag1,S._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(S._initialStartSpriteCellId=this._initialStartSpriteCellId,S._initialEndSpriteCellId=this._initialEndSpriteCellId,S._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(S.remapData&&this.remapData?S.remapData.N(this.remapData):S.remapData=new z.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(S._randomNoiseCoordinates1?(S._randomNoiseCoordinates1.N(this._randomNoiseCoordinates1),S._randomNoiseCoordinates2.N(this._randomNoiseCoordinates2)):(S._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),S._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}L._Count=0;var SS=D(11494),vS=(D(11538),D(11738)),DS=D(11736),zS=D(11635);function eS(S,v){const D=(0,E.RandomRange)(0,1);m.Ge.LerpToRef(v.color1,v.color2,D,S.color),v.colorDead.subtractToRef(S.color,v._colorDiff),v._colorDiff.scaleToRef(1/S.lifeTime,S.colorStep)}function NS(S,v){S._currentColorGradient=v._colorGradients[0],S._currentColorGradient.getColorToRef(S.color),S._currentColor1.N(S.color),v._colorGradients.length>1?v._colorGradients[1].getColorToRef(S._currentColor2):S._currentColor2.N(S.color)}function mS(S,v){const D=v._colorGradients;F.GetCurrentGradient(v._ratio,D,((v,D,z)=>{v!==S._currentColorGradient&&(S._currentColor1.N(S._currentColor2),D.getColorToRef(S._currentColor2),S._currentColorGradient=v),m.Ge.LerpToRef(S._currentColor1,S._currentColor2,z,S.color)}))}function BS(S,v){S.colorStep.scaleToRef(v._scaledUpdateSpeed,v._scaledColorStep),S.color.addInPlace(v._scaledColorStep),S.color.a<0&&(S.color.a=0)}function gS(S,v){F.GetCurrentGradient(v._ratio,v._angularSpeedGradients,((v,D,z)=>{v!==S._currentAngularSpeedGradient&&(S._currentAngularSpeed1=S._currentAngularSpeed2,S._currentAngularSpeed2=D.getFactor(),S._currentAngularSpeedGradient=v),S.angularSpeed=(0,E.Lerp)(S._currentAngularSpeed1,S._currentAngularSpeed2,z)}))}function ES(S,v){S.angle+=S.angularSpeed*v._scaledUpdateSpeed}function hS(S,v){v.particleEmitterType.startDirectionFunction(v._emitterWorldMatrix,S.direction,S,v.isLocal,v._emitterInverseWorldMatrix)}function AS(S,v){v.startDirectionFunction(v._emitterWorldMatrix,S.direction,S,v.isLocal)}function wS(S,v){S._currentVelocityGradient=v._velocityGradients[0],S._currentVelocity1=S._currentVelocityGradient.getFactor(),v._velocityGradients.length>1?S._currentVelocity2=v._velocityGradients[1].getFactor():S._currentVelocity2=S._currentVelocity1}function nS(S,v){S._currentLimitVelocityGradient=v._limitVelocityGradients[0],S._currentLimitVelocity1=S._currentLimitVelocityGradient.getFactor(),v._limitVelocityGradients.length>1?S._currentLimitVelocity2=v._limitVelocityGradients[1].getFactor():S._currentLimitVelocity2=S._currentLimitVelocity1}function RS(S,v){F.GetCurrentGradient(v._ratio,v._velocityGradients,((D,z,e)=>{D!==S._currentVelocityGradient&&(S._currentVelocity1=S._currentVelocity2,S._currentVelocity2=z.getFactor(),S._currentVelocityGradient=D),v._directionScale*=(0,E.Lerp)(S._currentVelocity1,S._currentVelocity2,e)}))}function OS(S,v){F.GetCurrentGradient(v._ratio,v._limitVelocityGradients,((D,z,e)=>{D!==S._currentLimitVelocityGradient&&(S._currentLimitVelocity1=S._currentLimitVelocity2,S._currentLimitVelocity2=z.getFactor(),S._currentLimitVelocityGradient=D);const N=(0,E.Lerp)(S._currentLimitVelocity1,S._currentLimitVelocity2,e);S.direction.length()>N&&S.direction.scaleInPlace(v.limitVelocityDamping)}))}function IS(S,v){S.direction.scaleToRef(v._directionScale,v._scaledDirection)}function KS(S,v){v.particleEmitterType.startPositionFunction(v._emitterWorldMatrix,S.position,S,v.isLocal)}function qS(S,v){v.startPositionFunction(v._emitterWorldMatrix,S.position,S,v.isLocal)}function uS(S,v){S.TB?S.TB.N(S.position):S.TB=S.position.clone(),z.Rv.TransformCoordinatesToRef(S.TB,v._emitterWorldMatrix,S.position)}function sS(S,v){v.isLocal&&S.TB?(S.TB.addInPlace(v._scaledDirection),z.Rv.TransformCoordinatesToRef(S.TB,v._emitterWorldMatrix,S.position)):S.position.addInPlace(v._scaledDirection)}function rS(S,v){S._currentDragGradient=v._dragGradients[0],S._currentDrag1=S._currentDragGradient.getFactor(),v._dragGradients.length>1?S._currentDrag2=v._dragGradients[1].getFactor():S._currentDrag2=S._currentDrag1}function dS(S,v){F.GetCurrentGradient(v._ratio,v._dragGradients,((D,z,e)=>{D!==S._currentDragGradient&&(S._currentDrag1=S._currentDrag2,S._currentDrag2=z.getFactor(),S._currentDragGradient=D);const N=(0,E.Lerp)(S._currentDrag1,S._currentDrag2,e);v._scaledDirection.scaleInPlace(1-N)}))}function xS(S,v){S._randomNoiseCoordinates1?(S._randomNoiseCoordinates1.oe(Math.random(),Math.random(),Math.random()),S._randomNoiseCoordinates2.oe(Math.random(),Math.random(),Math.random())):(S._randomNoiseCoordinates1=new z.Rv(Math.random(),Math.random(),Math.random()),S._randomNoiseCoordinates2=new z.Rv(Math.random(),Math.random(),Math.random()))}function WS(S,v){const D=v._noiseTextureData,e=v._noiseTextureSize;if(D&&e&&S._randomNoiseCoordinates1){const N=v._fetchR(S._randomNoiseCoordinates1.x,S._randomNoiseCoordinates1.y,e.width,e.height,D),m=v._fetchR(S._randomNoiseCoordinates1.z,S._randomNoiseCoordinates2.x,e.width,e.height,D),B=v._fetchR(S._randomNoiseCoordinates2.y,S._randomNoiseCoordinates2.z,e.width,e.height,D),g=z.TmpVectors.Rv[0],E=z.TmpVectors.Rv[1];g.oe((2*N-1)*v.noiseStrength.x,(2*m-1)*v.noiseStrength.y,(2*B-1)*v.noiseStrength.z),g.scaleToRef(v._tempScaledUpdateSpeed,E),S.direction.addInPlace(E)}}function pS(S,v){v.gravity.scaleToRef(v._tempScaledUpdateSpeed,v._scaledGravity),S.direction.addInPlace(v._scaledGravity)}function bS(S,v){S.size=(0,E.RandomRange)(v.minSize,v.maxSize),S.scale.oe((0,E.RandomRange)(v.minScaleX,v.maxScaleX),(0,E.RandomRange)(v.minScaleY,v.maxScaleY))}function kS(S,v){S._currentSizeGradient=v._sizeGradients[0],S._currentSize1=S._currentSizeGradient.getFactor(),S.size=S._currentSize1,v._sizeGradients.length>1?S._currentSize2=v._sizeGradients[1].getFactor():S._currentSize2=S._currentSize1,S.scale.oe((0,E.RandomRange)(v.minScaleX,v.maxScaleX),(0,E.RandomRange)(v.minScaleY,v.maxScaleY))}function ZS(S,v){const D=v._actualFrame/v.targetStopDuration;F.GetCurrentGradient(D,v._startSizeGradients,((D,z,e)=>{D!==v._currentStartSizeGradient&&(v._currentStartSize1=v._currentStartSize2,v._currentStartSize2=z.getFactor(),v._currentStartSizeGradient=D);const N=(0,E.Lerp)(v._currentStartSize1,v._currentStartSize2,e);S.scale.scaleInPlace(N)}))}function iS(S,v){F.GetCurrentGradient(v._ratio,v._sizeGradients,((v,D,z)=>{v!==S._currentSizeGradient&&(S._currentSize1=S._currentSize2,S._currentSize2=D.getFactor(),S._currentSizeGradient=v),S.size=(0,E.Lerp)(S._currentSize1,S._currentSize2,z)}))}function tS(S,v){S.remapData=new z.Vector4(0,1,0,1)}function XS(S,v){v._colorRemapGradients&&v._colorRemapGradients.length>0&&F.GetCurrentGradient(v._ratio,v._colorRemapGradients,((v,D,z)=>{const e=(0,E.Lerp)(v.factor1,D.factor1,z),N=(0,E.Lerp)(v.factor2,D.factor2,z);S.remapData.x=e,S.remapData.y=N-e})),v._alphaRemapGradients&&v._alphaRemapGradients.length>0&&F.GetCurrentGradient(v._ratio,v._alphaRemapGradients,((v,D,z)=>{const e=(0,E.Lerp)(v.factor1,D.factor1,z),N=(0,E.Lerp)(v.factor2,D.factor2,z);S.remapData.z=e,S.remapData.w=N-e}))}function aS(S,v){const D=(0,E.Clamp)(v._actualFrame/v.targetStopDuration);F.GetCurrentGradient(D,v._lifeTimeGradients,((v,z)=>{const e=v,N=z,m=e.getFactor(),B=N.getFactor(),g=(D-e.gradient)/(N.gradient-e.gradient);S.lifeTime=(0,E.Lerp)(m,B,g)})),v._emitPower=(0,E.RandomRange)(v.minEmitPower,v.maxEmitPower)}function oS(S,v){S.lifeTime=(0,E.RandomRange)(v.minLifeTime,v.maxLifeTime),v._emitPower=(0,E.RandomRange)(v.minEmitPower,v.maxEmitPower)}function MS(S,v){0===v._emitPower?(S._initialDirection?S._initialDirection.N(S.direction):S._initialDirection=S.direction.clone(),S.direction.set(0,0,0)):(S._initialDirection=null,S.direction.scaleInPlace(v._emitPower)),S.direction.addInPlace(v._inheritedVelocityOffset)}function cS(S,v){S.angularSpeed=(0,E.RandomRange)(v.minAngularSpeed,v.maxAngularSpeed),S.angle=(0,E.RandomRange)(v.minInitialRotation,v.maxInitialRotation)}function JS(S,v){S._currentAngularSpeedGradient=v._angularSpeedGradients[0],S.angularSpeed=S._currentAngularSpeedGradient.getFactor(),S._currentAngularSpeed1=S.angularSpeed,v._angularSpeedGradients.length>1?S._currentAngularSpeed2=v._angularSpeedGradients[1].getFactor():S._currentAngularSpeed2=S._currentAngularSpeed1,S.angle=(0,E.RandomRange)(v.minInitialRotation,v.maxInitialRotation)}function HS(S,v){S._initialStartSpriteCellId=v.startSpriteCellID,S._initialEndSpriteCellId=v.endSpriteCellID,S._initialSpriteCellLoop=v.spriteCellLoop}function TS(S,v){S.previousItem=v.previousItem,S.nextItem=v,v.previousItem&&(v.previousItem.nextItem=S),v.previousItem=S}function GS(S,v){S.previousItem=v,S.nextItem=v.nextItem,v.nextItem&&(v.nextItem.previousItem=S),v.nextItem=S}function YS(S,v){let D=v;for(;D.nextItem;)D=D.nextItem;S.previousItem=D,S.nextItem=D.nextItem,D.nextItem=S}function jS(S){S.previousItem&&(S.previousItem.nextItem=S.nextItem),S.nextItem&&(S.nextItem.previousItem=S.previousItem)}class VS extends g{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(S){this._startDirectionFunction!==S&&(this._startDirectionFunction=S,this._directionProcessing.process=S?AS:hS)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(S){this._startPositionFunction!==S&&(this._startPositionFunction=S,this._positionCreation.process=S?qS:KS)}set onDispose(S){this._onDisposeObserver&&this.Se.remove(this._onDisposeObserver),this._onDisposeObserver=this.Se.add(S)}get h(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(S){this._useRampGradients!==S&&(this._useRampGradients=S,this._resetEffect(),S?(this._rampCreation={process:tS,previousItem:null,nextItem:null},GS(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:XS,previousItem:null,nextItem:null},GS(this._remapGradientProcessing,this._gravityProcessing)):(jS(this._rampCreation),jS(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(S){this._isLocal!==S&&(this._isLocal=S,S?(this._isLocalCreation={process:uS,previousItem:null,nextItem:null},GS(this._isLocalCreation,this._positionCreation)):jS(this._isLocalCreation))}get particles(){return this.tw}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(S){this._animationSheetEnabled!==S&&(this._animationSheetEnabled=S,S?(this._sheetCreation={process:HS,previousItem:null,nextItem:null},GS(this._sheetCreation,this._colorCreation)):jS(this._sheetCreation),this._reset())}getActiveCount(){return this.tw.length}getClassName(){return"Sg"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var S;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(S=this._customWrappers[v])||void 0===S?void 0:S.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[S]??this._customWrappers[0]}setCustomEffect(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[v]=new SS.b(this._engine),this._customWrappers[v].effect=S,this._customWrappers[v].drawContext&&(this._customWrappers[v].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new l.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(S){if(this.noiseTexture!==S){if(this._noiseTexture=S,!S)return jS(this._noiseCreation),void jS(this._noiseProcessing);this._noiseCreation={process:xS,previousItem:null,nextItem:null},GS(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:WS,previousItem:null,nextItem:null},GS(this._noiseProcessing,this._positionProcessing)}}constructor(S,v,D){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(S),this._emitterInverseWorldMatrix=z.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new z.Rv,this.Se=new l.d,this.onStoppedObservable=new l.d,this.onStartedObservable=new l.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.tw=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new m.Ge(0,0,0,0),this._colorDiff=new m.Ge(0,0,0,0),this._scaledDirection=z.Rv.Zero(),this._scaledGravity=z.Rv.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=S=>{},this.recycleParticle=S=>{const v=this.tw.pop();v!==S&&v.copyTo(S),this._stockParticles.push(v)},this._createParticle=()=>{let S;return 0!==this._stockParticles.length?(S=this._stockParticles.pop(),S._reset()):S=new L(this),this._prepareParticle(S),S},this.paused=!1,this._shadersLoaded=!1,this._capacity=v,this._epsilon=B,D&&"Scene"!==D.getClassName()?(this._engine=D,this.defaultProjectionMatrix=z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=D||Q.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Zw.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:oS,previousItem:null,nextItem:null},this._positionCreation={process:KS,previousItem:null,nextItem:null},GS(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:hS,previousItem:null,nextItem:null},GS(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:MS,previousItem:null,nextItem:null},GS(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:bS,previousItem:null,nextItem:null},GS(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:cS,previousItem:null,nextItem:null},GS(this._angleCreation,this._sizeCreation),this._colorCreation={process:eS,previousItem:null,nextItem:null},GS(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,g||(this._colorProcessing={process:BS,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:ES,previousItem:null,nextItem:null},GS(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:IS,previousItem:null,nextItem:null},GS(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:sS,previousItem:null,nextItem:null},GS(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:pS,previousItem:null,nextItem:null},GS(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=N,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new SS.b(this._engine)},this._customWrappers[0].effect=e,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new A,this.updateFunction=S=>{var v;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(v=this.noiseTexture.getContent())||void 0===v||v.then((S=>{this._noiseTextureData=S})));const D=S===this.tw;for(let z=0;z<S.length;z++){const v=S[z];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const e=v.age;if(v.age+=this._tempScaledUpdateSpeed,v.age>v.lifeTime){const S=v.age-e,D=v.lifeTime-e;this._tempScaledUpdateSpeed=D*this._tempScaledUpdateSpeed/S,v.age=v.lifeTime}this._ratio=v.age/v.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let N=this._updateQueueStart;for(;N;)N.process(v,this),N=N.nextItem;if(this._isAnimationSheetEnabled&&!g&&v.updateCellIndex(),v._inheritParticleInfoToSubEmitters(),v.age>=v.lifeTime){if(this._emitFromParticle(v),v._attachedSubEmitters){for(const S of v._attachedSubEmitters)S.particleSystem.disposeOnStop=!0,S.particleSystem.stop();v._attachedSubEmitters=null}this.recycleParticle(v),D&&z--}else;}}}serialize(S){throw new Error("Method not implemented.")}clone(S,v){throw new Error("Method not implemented.")}_addFactorGradient(S,v,D,z){const e=new C(v,D,z);S.push(e),S.sort(((S,v)=>S.gradient<v.gradient?-1:S.gradient>v.gradient?1:0))}_removeFactorGradient(S,v){if(!S)return;let D=0;for(const z of S){if(z.gradient===v){S.splice(D,1);break}D++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=aS:this._lifeTimeCreation.process=oS}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:ZS,previousItem:null,nextItem:null},GS(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(jS(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(S){this.targetStopDuration!==S&&(this._targetStopDuration=S,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(S,v,D){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,S,v,D),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(S){return this._removeFactorGradient(this._lifeTimeGradients,S),this._syncLifeTimeCreation(),this}addSizeGradient(S,v,D){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=kS,this._sizeGradientProcessing={process:iS,previousItem:null,nextItem:null},TS(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,S,v,D),this}removeSizeGradient(S){var v;return this._removeFactorGradient(this._sizeGradients,S),0===(null===(v=this._sizeGradients)||void 0===v?void 0:v.length)&&(jS(this._sizeGradientProcessing),this._sizeCreation.process=bS),this}addColorRemapGradient(S,v,D){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,S,v,D),this}removeColorRemapGradient(S){return this._removeFactorGradient(this._colorRemapGradients,S),this}addAlphaRemapGradient(S,v,D){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,S,v,D),this}removeAlphaRemapGradient(S){return this._removeFactorGradient(this._alphaRemapGradients,S),this}addAngularSpeedGradient(S,v,D){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=JS,this._angularSpeedGradientProcessing={process:gS,previousItem:null,nextItem:null},TS(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,S,v,D),this}removeAngularSpeedGradient(S){var v;return this._removeFactorGradient(this._angularSpeedGradients,S),0===(null===(v=this._angularSpeedGradients)||void 0===v?void 0:v.length)&&(this._angleCreation.process=cS,jS(this._angularSpeedGradientProcessing)),this}addVelocityGradient(S,v,D){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:wS,previousItem:null,nextItem:null},GS(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:RS,previousItem:null,nextItem:null},TS(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,S,v,D),this}removeVelocityGradient(S){var v;return this._removeFactorGradient(this._velocityGradients,S),0===(null===(v=this._velocityGradients)||void 0===v?void 0:v.length)&&(jS(this._velocityCreation),jS(this._velocityGradientProcessing)),this}addLimitVelocityGradient(S,v,D){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:nS,previousItem:null,nextItem:null},GS(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:OS,previousItem:null,nextItem:null},GS(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,S,v,D),this}removeLimitVelocityGradient(S){var v;return this._removeFactorGradient(this._limitVelocityGradients,S),0===(null===(v=this._limitVelocityGradients)||void 0===v?void 0:v.length)&&(jS(this._limitVelocityCreation),jS(this._limitVelocityGradientProcessing)),this}addDragGradient(S,v,D){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:rS,previousItem:null,nextItem:null},TS(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:dS,previousItem:null,nextItem:null},TS(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,S,v,D),this}removeDragGradient(S){var v;return this._removeFactorGradient(this._dragGradients,S),0===(null===(v=this._dragGradients)||void 0===v?void 0:v.length)&&(jS(this._dragCreation),jS(this._dragGradientProcessing)),this}addEmitRateGradient(S,v,D){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,S,v,D),this}removeEmitRateGradient(S){return this._removeFactorGradient(this._emitRateGradients,S),this}addStartSizeGradient(S,v,D){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,S,v,D),this._syncStartSizeCreation(),this}removeStartSizeGradient(S){return this._removeFactorGradient(this._startSizeGradients,S),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const S=new Uint8Array(4*this._rawTextureWidth),v=m.TmpColors.qv[0];for(let D=0;D<this._rawTextureWidth;D++){const z=D/this._rawTextureWidth;F.GetCurrentGradient(z,this._rampGradients,((z,e,N)=>{m.qv.LerpToRef(z.color,e.color,N,v),S[4*D]=255*v.r,S[4*D+1]=255*v.g,S[4*D+2]=255*v.b,S[4*D+3]=255}))}this._rampGradientsTexture=P.e.CreateRGBATexture(S,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((S,v)=>S.gradient<v.gradient?-1:S.gradient>v.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(S,v){this._rampGradients||(this._rampGradients=[]);const D=new f(S,v);return this._rampGradients.push(D),this._syncRampGradientTexture(),this}removeRampGradient(S){return this._removeGradientAndTexture(S,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(S,v,D){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=NS,this._colorProcessing.process=mS);const z=new y(S,v,D);return this._colorGradients.push(z),this._colorGradients.sort(((S,v)=>S.gradient<v.gradient?-1:S.gradient>v.gradient?1:0)),this}removeColorGradient(S){if(!this._colorGradients)return this;let v=0;for(const D of this._colorGradients){if(D.gradient===S){this._colorGradients.splice(v,1);break}v++}return 0===this._colorGradients.length&&(this._colorCreation.process=eS,this._colorProcessing.process=BS),this}resetDrawCache(){if(this._drawWrappers){for(const S of this._drawWrappers)if(S)for(const v of S)null===v||void 0===v||v.dispose();this._drawWrappers=[]}}_fetchR(S,v,D,z,e){return e[4*(((S=.5*Math.abs(S)+.5)*D%D|0)+((v=.5*Math.abs(v)+.5)*z%z|0)*D)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const S=this._engine,v=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*v),this._vertexBuffer=new r.b(S,this._vertexData,!0,v);let D=0;const z=this._vertexBuffer.createVertexBuffer(r.d.PositionKind,D,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[r.d.PositionKind]=z,D+=3;const e=this._vertexBuffer.createVertexBuffer(r.d.ColorKind,D,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[r.d.ColorKind]=e,D+=4;const N=this._vertexBuffer.createVertexBuffer("angle",D,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=N,D+=1;const m=this._vertexBuffer.createVertexBuffer("size",D,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=m,D+=2,this._isAnimationSheetEnabled){const S=this._vertexBuffer.createVertexBuffer("cellIndex",D,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=S,D+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const S=this._vertexBuffer.createVertexBuffer("direction",D,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=S,D+=3}if(this._useRampGradients){const S=this._vertexBuffer.createVertexBuffer("remapData",D,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=S,D+=4}let B;if(this._useInstancing){const v=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new r.b(S,v,!1,2),B=this._spriteBuffer.createVertexBuffer("offset",0,2)}else B=this._vertexBuffer.createVertexBuffer("offset",D,2,this._vertexBufferSize,this._useInstancing),D+=2;this._vertexBuffers.offset=B,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const S=[],v=[];let D=0;for(let z=0;z<this._capacity;z++)S.push(D),S.push(D+1),S.push(D+2),S.push(D),S.push(D+2),S.push(D+3),v.push(D,D+1,D+1,D+2,D+2,D+3,D+3,D,D,D+3),D+=4;this._indexBuffer=this._engine.createIndexBuffer(S),this._linesIndexBuffer=this._engine.createIndexBuffer(v)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(S)setTimeout((()=>{this.start(0)}),S);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var v;-1!==(null===(v=this.zv)||void 0===v?void 0:v.getClassName().indexOf("Mesh"))&&this.zv.ke(!0);const S=this.noiseTexture;if(S&&S.onGeneratedObservable)S.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let v=0;v<this.preWarmCycles;v++)this.animate(!0),S.render()}))}));else for(let v=0;v<this.preWarmCycles;v++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(S))}_postStop(S){}reset(){this._stockParticles.length=0,this.tw.length=0}_appendParticleVertex(S,v,D,e){let N=S*this._vertexBufferSize;if(this._vertexData[N++]=v.position.x+this.xE.x,this._vertexData[N++]=v.position.y+this.xE.y,this._vertexData[N++]=v.position.z+this.xE.z,this._vertexData[N++]=v.color.r,this._vertexData[N++]=v.color.g,this._vertexData[N++]=v.color.b,this._vertexData[N++]=v.color.a,this._vertexData[N++]=v.angle,this._vertexData[N++]=v.scale.x*v.size,this._vertexData[N++]=v.scale.y*v.size,this._isAnimationSheetEnabled&&(this._vertexData[N++]=v.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[N++]=v.direction.x,this._vertexData[N++]=v.direction.y,this._vertexData[N++]=v.direction.z);else if(v._initialDirection){let S=v._initialDirection;this.isLocal&&(z.Rv.TransformNormalToRef(S,this._emitterWorldMatrix,z.TmpVectors.Rv[0]),S=z.TmpVectors.Rv[0]),0===S.x&&0===S.z&&(S.x=.001),this._vertexData[N++]=S.x,this._vertexData[N++]=S.y,this._vertexData[N++]=S.z}else{let S=v.direction;this.isLocal&&(z.Rv.TransformNormalToRef(S,this._emitterWorldMatrix,z.TmpVectors.Rv[0]),S=z.TmpVectors.Rv[0]),0===S.x&&0===S.z&&(S.x=.001),this._vertexData[N++]=S.x,this._vertexData[N++]=S.y,this._vertexData[N++]=S.z}this._useRampGradients&&v.remapData&&(this._vertexData[N++]=v.remapData.x,this._vertexData[N++]=v.remapData.y,this._vertexData[N++]=v.remapData.z,this._vertexData[N++]=v.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===D?D=this._epsilon:1===D&&(D=1-this._epsilon),0===e?e=this._epsilon:1===e&&(e=1-this._epsilon)),this._vertexData[N++]=D,this._vertexData[N++]=e)}_prepareParticle(S){}_createNewOnes(S){let v;for(let D=0;D<S&&this.tw.length!==this._capacity;D++){v=this._createParticle(),this.tw.push(v);let S=this._createQueueStart;for(;S;)S.process(v,this),S=S.nextItem;v._inheritParticleInfoToSubEmitters()}}_update(S){if(this._alive=this.tw.length>0,this.zv.position){const S=this.zv;this._emitterWorldMatrix=S.getWorldMatrix()}else{const S=this.zv;this._emitterWorldMatrix=z.Matrix.Translation(S.x,S.y,S.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.tw),this._createNewOnes(S)}static _GetAttributeNamesOrOptions(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=[r.d.PositionKind,r.d.ColorKind,"angle","offset","size"];return S&&z.push("cellIndex"),v||z.push("direction"),D&&z.push("remapData"),z}static _GetEffectCreationOptions(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,vS.d)(z),S&&z.push("particlesInfos"),v&&z.push("logarithmicDepthConstant"),D&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(S,v){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,vS.h)(this,this._scene,S),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&S.push("#define FOG")),this._isAnimationSheetEnabled&&S.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&S.push("#define LOGARITHMICDEPTH"),v===g.BLENDMODE_MULTIPLY&&S.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&S.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(S.push("#define BILLBOARD"),this.billboardMode){case 2:S.push("#define BILLBOARDY");break;case 8:case 9:S.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&S.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:S.push("#define BILLBOARDMODE_ALL")}D&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),S.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(S,v,D){v.push(...VS._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),S.push(...VS._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),D.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,zS.g)(S,this._imageProcessingConfigurationDefines),(0,zS.d)(D,this._imageProcessingConfigurationDefines))}_getWrapper(S){const v=this._getCustomDrawWrapper(S);if(null!==v&&void 0!==v&&v.effect)return v;const D=[];this.fillDefines(D,S);const z=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let e=this._drawWrappers[z];e||(e=this._drawWrappers[z]=[]);let N=e[S];N||(N=new SS.b(this._engine),N.drawContext&&(N.drawContext.useInstancing=this._useInstancing),e[S]=N);const m=D.join("\n");if(N.defines!==m){const S=[],v=[],D=[];this.fillUniformsAttributesAndSamplerNames(v,S,D),N.setEffect(this._engine.createEffect("particles",S,v,D,m,void 0,void 0,void 0,void 0,this._shaderLanguage),m)}return N}animate(){var S;let v,D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!D&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(D?this.preWarmStepOffset:(null===(S=this._scene)||void 0===S?void 0:S.getAnimationRatio())||1),this.manualEmitCount>-1)v=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let S=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const v=this._actualFrame/this.targetStopDuration;F.GetCurrentGradient(v,this._emitRateGradients,((v,D,z)=>{v!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=D.getFactor(),this._currentEmitRateGradient=v),S=(0,E.Lerp)(this._currentEmitRate1,this._currentEmitRate2,z)}))}v=S*this._scaledUpdateSpeed|0,this._newPartsExcess+=S*this._scaledUpdateSpeed-v}if(this._newPartsExcess>1&&(v+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?v=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(v),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!D){let S=0;for(let v=0;v<this.tw.length;v++){const D=this.tw[v];this._appendParticleVertices(S,D),S+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.tw.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(S,v){this._appendParticleVertex(S++,v,0,0),this._useInstancing||(this._appendParticleVertex(S++,v,1,0),this._appendParticleVertex(S++,v,1,1),this._appendParticleVertex(S++,v,0,1))}rebuild(){var S;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(S=this._spriteBuffer)||void 0===S||S._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!VS.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(D.bind(D,12881)),Promise.resolve().then(D.bind(D,12821))])):await Promise.all([Promise.resolve().then(D.bind(D,12811)),Promise.resolve().then(D.bind(D,12804))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.zv||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==g.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(g.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(g.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(S){const v=this._getWrapper(S),D=v.effect,e=this._engine;e.enableEffect(v);const N=this.defaultViewMatrix??this._scene.getViewMatrix();if(D.setTexture("diffuseSampler",this.particleTexture),D.setMatrix("view",N),D.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const S=this.particleTexture.getBaseSize();D.setFloat3("particlesInfos",this.spriteCellWidth/S.width,this.spriteCellHeight/S.height,this.spriteCellWidth/S.width)}if(D.setVector2("translationPivot",this.translationPivot),D.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const S=this._scene.activeCamera;D.setVector3("eyePosition",S.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),D.setTexture("rampSampler",this._rampGradientsTexture));const m=D.defines;var B,g,E,h,A,w;(this._scene&&((0,vS.e)(D,this,this._scene),this.applyFog&&(0,DS.h)(this._scene,void 0,D)),m.indexOf("#define BILLBOARDMODE_ALL")>=0&&(N.invertToRef(z.TmpVectors.Matrix[0]),D.setMatrix("invView",z.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?e.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,D):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,D)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?e.bindBuffers(this._vertexBuffers,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBuffer:this._indexBuffer,D):e.bindBuffers(this._vertexBuffers,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:null,D);(this.useLogarithmicDepth&&this._scene&&(0,DS.m)(m,D,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(D),this._setEngineBasedOnBlendMode(S),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(D),this._useInstancing)?null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?e.drawElementsType(6,0,10,this.tw.length):e.drawArraysType(7,0,4,this.tw.length):null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?e.drawElementsType(1,0,10*this.tw.length):e.drawElementsType(0,0,6*this.tw.length);return this.tw.length}render(){if(!this.isReady()||!this.tw.length)return 0;const S=this._engine;S.setState&&(S.setState(!1),this.forceDepthWrite&&S.setDepthWrite(!0));let v=0;return v=this.blendMode===g.BLENDMODE_MULTIPLYADD?this._render(g.BLENDMODE_MULTIPLY)+this._render(g.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),v}_onDispose(){}dispose(){let S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),S&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),S&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(v,D),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const S=this._scene.Zw.indexOf(this);S>-1&&this._scene.Zw.splice(S,1),this._scene._activeParticleSystems.dispose()}this.Se.notifyObservers(this),this.Se.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}VS.ForceGLSL=!1;var US,yS=D(11207);!function(S){S[S.ATTACHED=0]="ATTACHED",S[S.END=1]="END"}(US||(US={}));class fS{constructor(S){if(this.particleSystem=S,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!S.zv||!S.zv.dispose){const v=(0,B.e)("BABYLON.AbstractMesh");S.zv=new v("SubemitterSystemEmitter",S.xS()),S._disposeEmitterOnDispose=!0}}clone(){let S=this.particleSystem.zv;if(S){if(S instanceof z.Rv)S=S.clone();else if(-1!==S.getClassName().indexOf("Mesh")){S=new((0,B.e)("BABYLON.Mesh"))("",S.xS()),S.isVisible=!1}}else S=new z.Rv;const v=new fS(this.particleSystem.clone(this.particleSystem.name,S));return v.particleSystem.name+="Clone",v.type=this.type,v.inheritDirection=this.inheritDirection,v.inheritedVelocityAmount=this.inheritedVelocityAmount,v.particleSystem._disposeEmitterOnDispose=!0,v.particleSystem.disposeOnStop=!0,v}serialize(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};return v.type=this.type,v.inheritDirection=this.inheritDirection,v.inheritedVelocityAmount=this.inheritedVelocityAmount,v.particleSystem=this.particleSystem.serialize(S),v}static _ParseParticleSystem(S,v,D){throw(0,yS.e)("ParseParticle")}static Parse(S,v,D){const z=S.particleSystem,e=new fS(fS._ParseParticleSystem(z,v,D,!0));return e.type=S.type,e.inheritDirection=S.inheritDirection,e.inheritedVelocityAmount=S.inheritedVelocityAmount,e.particleSystem._isSubEmitter=!0,e}dispose(){this.particleSystem.dispose()}}var CS=D(11269);function FS(S,v){const D=new K;return D.direction1=S,D.direction2=v,D}function lS(){return new I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function PS(){return new q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function QS(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.Rv(0,1,0),D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.Rv(0,1,0);return new u(S,v,D)}function LS(){return new R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Sv(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.Rv(0,1,0),N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.Rv(0,1,0);return new O(S,v,D,e,N)}function vv(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new w(S,v)}function Dv(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.Rv(0,1,0),e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.Rv(0,1,0);return new n(S,v,D,e)}const zv=z.Rv.Zero(),ev=z.Rv.Zero(),Nv=z.Rv.Zero();class mv{constructor(){this.strength=0,this.position=z.Rv.Zero()}_processParticle(S,v){this.position.subtractToRef(S.position,zv);const D=zv.lengthSquared()+1;zv.normalize().scaleToRef(this.strength/D,ev),ev.scaleToRef(v._tempScaledUpdateSpeed,Nv),S.direction.addInPlace(Nv)}serialize(){return{position:this.position.Oe(),strength:this.strength}}}class Bv extends VS{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=S=>{if(!this._subEmitters||0===this._subEmitters.length)return;const v=Math.floor(Math.random()*this._subEmitters.length);for(const D of this._subEmitters[v])if(1===D.type){const v=D.clone();S._inheritParticleInfoToSubEmitter(v),v.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(v.particleSystem),v.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(S,v){const D=FS(S,v);return this.particleEmitterType=D,D}get flowMap(){return this._flowMap}set flowMap(S){this._flowMap!==S&&(this._flowMap=S,this._flowMapUpdate&&(jS(this._flowMapUpdate),this._flowMapUpdate=null),S&&(this._flowMapUpdate={process:S=>{var v;const D=null===(v=this.xS())||void 0===v?void 0:v.getTransformMatrix();this._flowMap._processParticle(S,this.flowMapStrength*this._tempScaledUpdateSpeed,D)},previousItem:null,nextItem:null},GS(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(S){this._attractors.push(S),1===this._attractors.length&&(this._attractorUpdate={process:S=>{for(const v of this._attractors)v._processParticle(S,this)},previousItem:null,nextItem:null},GS(this._attractorUpdate,this._directionProcessing))}removeAttractor(S){const v=this._attractors.indexOf(S);-1!==v&&this._attractors.splice(v,1),0===this._attractors.length&&jS(this._attractorUpdate)}start(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(S)}createHemisphericEmitter(){const S=lS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=S,S}createSphereEmitter(){const S=PS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=S,S}createDirectedSphereEmitter(){const S=QS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.Rv(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.Rv(0,1,0));return this.particleEmitterType=S,S}createCylinderEmitter(){const S=LS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=S,S}createDirectedCylinderEmitter(){const S=Sv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.Rv(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.Rv(0,1,0));return this.particleEmitterType=S,S}createConeEmitter(){const S=vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=S,S}createDirectedConeEmitter(){const S=Dv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.Rv(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.Rv(0,1,0));return this.particleEmitterType=S,S}createBoxEmitter(S,v,D,z){const e=new A;return this.particleEmitterType=e,this.direction1=S,this.direction2=v,this.minEmitBox=D,this.maxEmitBox=z,e}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const S of this.subEmitters)S instanceof Bv?this._subEmitters.push([new fS(S)]):S instanceof fS?this._subEmitters.push([S]):S instanceof Array&&this._subEmitters.push(S)}_stopSubEmitters(){if(this.activeSubSystems){for(const S of this.activeSubSystems)S.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const S=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==S&&this._rootParticleSystem.activeSubSystems.splice(S,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(S){S&&this._stopSubEmitters()}_prepareParticle(S){if(this._subEmitters&&this._subEmitters.length>0){const v=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];S._attachedSubEmitters=[];for(const D of v)if(0===D.type){const v=D.clone();S._attachedSubEmitters.push(v),v.particleSystem.start()}}}_onDispose(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),S&&this.particles)for(const D of this.particles)if(D._attachedSubEmitters)for(let S=D._attachedSubEmitters.length-1;S>=0;S-=1)D._attachedSubEmitters[S].dispose();if(v&&this.activeSubSystems)for(let D=this.activeSubSystems.length-1;D>=0;D-=1)this.activeSubSystems[D].dispose();if(this._subEmitters&&this._subEmitters.length){for(let S=0;S<this._subEmitters.length;S++)for(const v of this._subEmitters[S])v.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.zv&&this.zv.dispose&&this.zv.dispose(!0)}static _Parse(S,v,D,e){let N;N=D instanceof CS.d?null:D;const g=(0,B.e)("BABYLON.Texture");if(g&&N&&(S.texture?v.particleTexture=g.Parse(S.texture,N,e):S.textureName&&(v.particleTexture=new g(e+S.textureName,N,!1,void 0===S.invertY||S.invertY),v.particleTexture.name=S.textureName)),S.emitterId||0===S.emitterId||void 0!==S.zv?S.emitterId&&N?v.zv=N.getLastMeshById(S.emitterId):v.zv=z.Rv.uv(S.zv):v.zv=z.Rv.Zero(),v.isLocal=!!S.isLocal,void 0!==S.renderingGroupId&&(v.renderingGroupId=S.renderingGroupId),void 0!==S.isBillboardBased&&(v.isBillboardBased=S.isBillboardBased),void 0!==S.billboardMode&&(v.billboardMode=S.billboardMode),void 0!==S.useLogarithmicDepth&&(v.useLogarithmicDepth=S.useLogarithmicDepth),S.animations){for(let D=0;D<S.animations.length;D++){const z=S.animations[D],e=(0,B.e)("BABYLON.Animation");e&&v.animations.push(e.Parse(z))}v.beginAnimationOnStart=S.beginAnimationOnStart,v.beginAnimationFrom=S.beginAnimationFrom,v.beginAnimationTo=S.beginAnimationTo,v.beginAnimationLoop=S.beginAnimationLoop}if(S.autoAnimate&&N&&N.beginAnimation(v,S.autoAnimateFrom,S.autoAnimateTo,S.autoAnimateLoop,S.autoAnimateSpeed||1),v.startDelay=0|S.startDelay,v.minAngularSpeed=S.minAngularSpeed,v.maxAngularSpeed=S.maxAngularSpeed,v.minSize=S.minSize,v.maxSize=S.maxSize,S.minScaleX&&(v.minScaleX=S.minScaleX,v.maxScaleX=S.maxScaleX,v.minScaleY=S.minScaleY,v.maxScaleY=S.maxScaleY),void 0!==S.preWarmCycles&&(v.preWarmCycles=S.preWarmCycles,v.preWarmStepOffset=S.preWarmStepOffset),void 0!==S.minInitialRotation&&(v.minInitialRotation=S.minInitialRotation,v.maxInitialRotation=S.maxInitialRotation),v.minLifeTime=S.minLifeTime,v.maxLifeTime=S.maxLifeTime,v.minEmitPower=S.minEmitPower,v.maxEmitPower=S.maxEmitPower,v.emitRate=S.emitRate,v.gravity=z.Rv.uv(S.gravity),S.noiseStrength&&(v.noiseStrength=z.Rv.uv(S.noiseStrength)),v.color1=m.Ge.uv(S.color1),v.color2=m.Ge.uv(S.color2),v.colorDead=m.Ge.uv(S.colorDead),v.updateSpeed=S.updateSpeed,v.targetStopDuration=S.targetStopDuration,v.blendMode=S.blendMode,S.colorGradients)for(const z of S.colorGradients)v.addColorGradient(z.gradient,m.Ge.uv(z.color1),z.color2?m.Ge.uv(z.color2):void 0);if(S.rampGradients){for(const D of S.rampGradients)v.addRampGradient(D.gradient,m.qv.uv(D.color));v.useRampGradients=S.useRampGradients}if(S.colorRemapGradients)for(const z of S.colorRemapGradients)v.addColorRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(S.alphaRemapGradients)for(const z of S.alphaRemapGradients)v.addAlphaRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(S.sizeGradients)for(const z of S.sizeGradients)v.addSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(S.angularSpeedGradients)for(const z of S.angularSpeedGradients)v.addAngularSpeedGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(S.velocityGradients)for(const z of S.velocityGradients)v.addVelocityGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(S.dragGradients)for(const z of S.dragGradients)v.addDragGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(S.emitRateGradients)for(const z of S.emitRateGradients)v.addEmitRateGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(S.startSizeGradients)for(const z of S.startSizeGradients)v.addStartSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(S.lifeTimeGradients)for(const z of S.lifeTimeGradients)v.addLifeTimeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(S.limitVelocityGradients){for(const D of S.limitVelocityGradients)v.addLimitVelocityGradient(D.gradient,void 0!==D.factor1?D.factor1:D.factor,D.factor2);v.limitVelocityDamping=S.limitVelocityDamping}if(S.noiseTexture&&N){const D=(0,B.e)("BABYLON.ProceduralTexture");v.noiseTexture=D.Parse(S.noiseTexture,N,e)}let E;if(S.particleEmitterType){switch(S.particleEmitterType.type){case"SphereParticleEmitter":E=new q;break;case"SphereDirectedParticleEmitter":E=new u;break;case"ConeEmitter":case"ConeParticleEmitter":E=new w;break;case"ConeDirectedParticleEmitter":E=new n;break;case"CylinderParticleEmitter":E=new R;break;case"CylinderDirectedParticleEmitter":E=new O;break;case"HemisphericParticleEmitter":E=new I;break;case"PointParticleEmitter":E=new K;break;case"MeshParticleEmitter":E=new d;break;case"CustomParticleEmitter":E=new s;break;default:E=new A}E.parse(S.particleEmitterType,N)}else E=new A,E.parse(S,N);v.particleEmitterType=E,v.startSpriteCellID=S.startSpriteCellID,v.endSpriteCellID=S.endSpriteCellID,v.spriteCellLoop=S.spriteCellLoop??!0,v.spriteCellWidth=S.spriteCellWidth,v.spriteCellHeight=S.spriteCellHeight,v.spriteCellChangeSpeed=S.spriteCellChangeSpeed,v.spriteRandomStartCell=S.spriteRandomStartCell,v.disposeOnStop=S.disposeOnStop??!1,v.manualEmitCount=S.manualEmitCount??-1}static Parse(S,v,D){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0;const B=S.name;let g,E,h=null,A=null;if(v instanceof CS.d?g=v:(E=v,g=E.getEngine()),S.customShader&&g.createEffectForParticles){A=S.customShader;const v=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"";h=g.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,v)}const w=new Bv(B,N||S.Jv,v,h,S.isAnimationSheetEnabled);if(w.customShader=A,w._rootUrl=D,S.id&&(w.id=S.id),S.subEmitters){w.subEmitters=[];for(const z of S.subEmitters){const S=[];for(const e of z)S.push(fS.Parse(e,v,D));w.subEmitters.push(S)}}if(S.attractors)for(const m of S.attractors){const S=new mv;S.position=z.Rv.uv(m.position),S.strength=m.strength,w.addAttractor(S)}return Bv._Parse(S,w,v,D),S.textureMask&&(w.textureMask=m.Ge.uv(S.textureMask)),S.xE&&(w.xE=z.Rv.uv(S.xE)),S.preventAutoStart&&(w.preventAutoStart=S.preventAutoStart),e||w.preventAutoStart||w.start(),w}serialize(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};if(Bv._Serialize(v,this,S),v.textureMask=this.textureMask.Oe(),v.customShader=this.customShader,v.preventAutoStart=this.preventAutoStart,v.xE=this.xE.Oe(),this.subEmitters){v.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const D of this._subEmitters){const z=[];for(const v of D)z.push(v.serialize(S));v.subEmitters.push(z)}}if(this._attractors&&this._attractors.length){v.attractors=[];for(const S of this._attractors)v.attractors.push(S.serialize())}return v}static _Serialize(S,v,D){if(S.name=v.name,S.id=v.id,S.Jv=v.getCapacity(),S.disposeOnStop=v.disposeOnStop,S.manualEmitCount=v.manualEmitCount,v.zv.position){const D=v.zv;S.emitterId=D.id}else{const D=v.zv;S.zv=D.Oe()}v.particleEmitterType&&(S.particleEmitterType=v.particleEmitterType.serialize()),v.particleTexture&&(D?S.texture=v.particleTexture.serialize():(S.textureName=v.particleTexture.name,S.invertY=!!v.particleTexture._invertY)),S.isLocal=v.isLocal,a.b.AppendSerializedAnimations(v,S),S.beginAnimationOnStart=v.beginAnimationOnStart,S.beginAnimationFrom=v.beginAnimationFrom,S.beginAnimationTo=v.beginAnimationTo,S.beginAnimationLoop=v.beginAnimationLoop,S.startDelay=v.startDelay,S.renderingGroupId=v.renderingGroupId,S.isBillboardBased=v.isBillboardBased,S.billboardMode=v.billboardMode,S.minAngularSpeed=v.minAngularSpeed,S.maxAngularSpeed=v.maxAngularSpeed,S.minSize=v.minSize,S.maxSize=v.maxSize,S.minScaleX=v.minScaleX,S.maxScaleX=v.maxScaleX,S.minScaleY=v.minScaleY,S.maxScaleY=v.maxScaleY,S.minEmitPower=v.minEmitPower,S.maxEmitPower=v.maxEmitPower,S.minLifeTime=v.minLifeTime,S.maxLifeTime=v.maxLifeTime,S.emitRate=v.emitRate,S.gravity=v.gravity.Oe(),S.noiseStrength=v.noiseStrength.Oe(),S.color1=v.color1.Oe(),S.color2=v.color2.Oe(),S.colorDead=v.colorDead.Oe(),S.updateSpeed=v.updateSpeed,S.targetStopDuration=v.targetStopDuration,S.blendMode=v.blendMode,S.preWarmCycles=v.preWarmCycles,S.preWarmStepOffset=v.preWarmStepOffset,S.minInitialRotation=v.minInitialRotation,S.maxInitialRotation=v.maxInitialRotation,S.startSpriteCellID=v.startSpriteCellID,S.spriteCellLoop=v.spriteCellLoop,S.endSpriteCellID=v.endSpriteCellID,S.spriteCellChangeSpeed=v.spriteCellChangeSpeed,S.spriteCellWidth=v.spriteCellWidth,S.spriteCellHeight=v.spriteCellHeight,S.spriteRandomStartCell=v.spriteRandomStartCell,S.isAnimationSheetEnabled=v.isAnimationSheetEnabled,S.useLogarithmicDepth=v.useLogarithmicDepth;const z=v.getColorGradients();if(z){S.colorGradients=[];for(const v of z){const D={gradient:v.gradient,color1:v.color1.Oe()};v.color2?D.color2=v.color2.Oe():D.color2=v.color1.Oe(),S.colorGradients.push(D)}}const e=v.getRampGradients();if(e){S.rampGradients=[];for(const v of e){const D={gradient:v.gradient,color:v.color.Oe()};S.rampGradients.push(D)}S.useRampGradients=v.useRampGradients}const N=v.getColorRemapGradients();if(N){S.colorRemapGradients=[];for(const v of N){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.colorRemapGradients.push(D)}}const m=v.getAlphaRemapGradients();if(m){S.alphaRemapGradients=[];for(const v of m){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.alphaRemapGradients.push(D)}}const B=v.getSizeGradients();if(B){S.sizeGradients=[];for(const v of B){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.sizeGradients.push(D)}}const g=v.getAngularSpeedGradients();if(g){S.angularSpeedGradients=[];for(const v of g){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.angularSpeedGradients.push(D)}}const E=v.getVelocityGradients();if(E){S.velocityGradients=[];for(const v of E){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.velocityGradients.push(D)}}const h=v.getDragGradients();if(h){S.dragGradients=[];for(const v of h){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.dragGradients.push(D)}}const A=v.getEmitRateGradients();if(A){S.emitRateGradients=[];for(const v of A){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.emitRateGradients.push(D)}}const w=v.getStartSizeGradients();if(w){S.startSizeGradients=[];for(const v of w){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.startSizeGradients.push(D)}}const n=v.getLifeTimeGradients();if(n){S.lifeTimeGradients=[];for(const v of n){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.lifeTimeGradients.push(D)}}const R=v.getLimitVelocityGradients();if(R){S.limitVelocityGradients=[];for(const v of R){const D={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?D.factor2=v.factor2:D.factor2=v.factor1,S.limitVelocityGradients.push(D)}S.limitVelocityDamping=v.limitVelocityDamping}v.noiseTexture&&(S.noiseTexture=v.noiseTexture.serialize())}clone(S,v){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let e=null;const N=this._engine;if(N.createEffectForParticles&&null!=this.customShader){e=this.customShader;const S=e.shaderOptions.defines.length>0?e.shaderOptions.defines.join("\n"):"",v=N.createEffectForParticles(e.shaderPath.fragmentElement,e.shaderOptions.uniforms,e.shaderOptions.samplers,S);z[0]?z[0].effect=v:this.setCustomEffect(v,0)}const m=this.serialize(D),B=Bv.Parse(m,this._scene||this._engine,this._rootUrl);return B.name=S,B.customShader=e,B._customWrappers=z,void 0===v&&(v=this.zv),this.noiseTexture&&(B.noiseTexture=this.noiseTexture.clone()),B.zv=v,this.preventAutoStart||B.start(),B}}Bv.BILLBOARDMODE_Y=2,Bv.BILLBOARDMODE_ALL=7,Bv.BILLBOARDMODE_STRETCHED=8,Bv.BILLBOARDMODE_STRETCHED_LOCAL=9,fS._ParseParticleSystem=Bv.Parse;var gv=D(11625),Ev=D(11619),hv=D(11505);hv.e.prototype.createTransformFeedback=function(){const S=this._gl.createTransformFeedback();if(!S)throw new Error("Unable to create Transform Feedback");return S},hv.e.prototype.deleteTransformFeedback=function(S){this._gl.deleteTransformFeedback(S)},hv.e.prototype.bindTransformFeedback=function(S){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,S)},hv.e.prototype.beginTransformFeedback=function(){let S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(S?this._gl.POINTS:this._gl.TRIANGLES)},hv.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},hv.e.prototype.setTranformFeedbackVaryings=function(S,v){this._gl.transformFeedbackVaryings(S,v,this._gl.INTERLEAVED_ATTRIBS)},hv.e.prototype.bindTransformFeedbackBuffer=function(S){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,S?S.underlyingResource:null)},hv.e.prototype.readTransformFeedbackBuffer=function(S){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,S)};const Av="clipPlaneFragmentDeclaration2",wv="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";W.b.IncludesShadersStore[Av]||(W.b.IncludesShadersStore[Av]=wv);D(12708),D(12713),D(12721),D(12723),D(12732),D(12741),D(12749),D(12751);const nv="gpuRenderParticlesPixelShader",Rv="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";W.b.ShadersStore[nv]||(W.b.ShadersStore[nv]=Rv);const Ov="clipPlaneVertexDeclaration2",Iv="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";W.b.IncludesShadersStore[Ov]||(W.b.IncludesShadersStore[Ov]=Iv);D(12757),D(12765),D(12769),D(12775);const Kv="gpuRenderParticlesVertexShader",qv="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";W.b.ShadersStore[Kv]||(W.b.ShadersStore[Kv]=qv);class uv extends g{static get IsSupported(){if(!Q.c.LastCreatedEngine)return!1;const S=Q.c.LastCreatedEngine.getCaps();return S.supportTransformFeedbacks||S.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(S){this._maxActiveParticleCount=Math.min(S,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(S){this.maxActiveParticleCount=S}createPointEmitter(S,v){const D=FS(S,v);return this.particleEmitterType=D,D}createHemisphericEmitter(){const S=lS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=S,S}createSphereEmitter(){const S=PS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=S,S}createDirectedSphereEmitter(){const S=QS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.Rv(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.Rv(0,1,0));return this.particleEmitterType=S,S}createCylinderEmitter(){const S=LS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=S,S}createDirectedCylinderEmitter(){const S=Sv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.Rv(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.Rv(0,1,0));return this.particleEmitterType=S,S}createConeEmitter(){const S=vv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=S,S}createDirectedConeEmitter(){const S=Dv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.Rv(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.Rv(0,1,0));return this.particleEmitterType=S,S}createBoxEmitter(S,v,D,z){const e=new A;return this.particleEmitterType=e,this.direction1=S,this.direction2=v,this.minEmitBox=D,this.maxEmitBox=z,e}get flowMap(){return this._flowMap}set flowMap(S){this._flowMap!==S&&(this._flowMap=S)}isReady(){if(!this.zv||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Bv.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Bv.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Bv.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";S?setTimeout((()=>{this.start(0)}),S):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var S;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(S=this._customWrappers[v])||void 0===S?void 0:S.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[S]??this._customWrappers[0]}setCustomEffect(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[v]=new SS.b(this._engine),this._customWrappers[v].effect=S}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new l.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(S,v,D){return super._removeGradientAndTexture(S,v,D),this._releaseBuffers(),this}addColorGradient(S,v){this._colorGradients||(this._colorGradients=[]);const D=new y(S,v);return this._colorGradients.push(D),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(S&&this._colorGradients.sort(((S,v)=>S.gradient<v.gradient?-1:S.gradient>v.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(S){return this._removeGradientAndTexture(S,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const v in this._drawWrappers){var S;null===(S=this._drawWrappers[v].drawContext)||void 0===S||S.reset()}}_addFactorGradient(S,v,D){const z=new C(v,D);S.push(z),this._releaseBuffers()}addSizeGradient(S,v){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,S,v),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(S){return this._removeGradientAndTexture(S,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(S,v){if(!S)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&S.sort(((S,v)=>S.gradient<v.gradient?-1:S.gradient>v.gradient?1:0));const D=this;D[v]&&(D[v].dispose(),D[v]=null)}addAngularSpeedGradient(S,v){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,S,v),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(S){return this._removeGradientAndTexture(S,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(S,v){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,S,v),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(S){return this._removeGradientAndTexture(S,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(S,v){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,S,v),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(S){return this._removeGradientAndTexture(S,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(S,v){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,S,v),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(S){return this._removeGradientAndTexture(S,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(S){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(S,v,D){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(S),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Se=new l.d,this.onStoppedObservable=new l.d,this.onStartedObservable=new l.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,D&&"Scene"!==D.getClassName()?(this._engine=D,this.defaultProjectionMatrix=z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=D||Q.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Zw.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,B.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,B.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,B.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,B.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new SS.b(this._engine)},this._customWrappers[0].effect=e,this._drawWrappers={0:new SS.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(v=v??{}).randomTextureSize||delete v.randomTextureSize;const m={Jv:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...v},g=v;isFinite(g)&&(m.Jv=g),this._capacity=m.Jv,this._maxActiveParticleCount=m.Jv,this._currentActiveCount=0,this._isAnimationSheetEnabled=N,this.particleEmitterType=new A;const E=Math.min(this._engine.getCaps().maxTextureSize,m.randomTextureSize);let h=[];for(let z=0;z<E;++z)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture=new P.e(new Float32Array(h),E,1,5,D,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,h=[];for(let z=0;z<E;++z)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture2=new P.e(new Float32Array(h),E,1,5,D,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=E}_reset(){this._releaseBuffers()}_createVertexBuffers(S,v,D){const z={};z.position=v.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let e=3;z.age=v.createVertexBuffer("age",e,1,this._attributesStrideSize,!0),e+=1,z.size=v.createVertexBuffer("size",e,3,this._attributesStrideSize,!0),e+=3,z.life=v.createVertexBuffer("life",e,1,this._attributesStrideSize,!0),e+=1,e+=4,this.billboardMode===Bv.BILLBOARDMODE_STRETCHED&&(z.direction=v.createVertexBuffer("direction",e,3,this._attributesStrideSize,!0)),e+=3,this._platform.alignDataInBuffer&&(e+=1),this.particleEmitterType instanceof s&&(e+=3,this._platform.alignDataInBuffer&&(e+=1)),this._colorGradientsTexture||(z.color=v.createVertexBuffer("color",e,4,this._attributesStrideSize,!0),e+=4),this._isBillboardBased||(z.initialDirection=v.createVertexBuffer("initialDirection",e,3,this._attributesStrideSize,!0),e+=3,this._platform.alignDataInBuffer&&(e+=1)),this.noiseTexture&&(z.noiseCoordinates1=v.createVertexBuffer("noiseCoordinates1",e,3,this._attributesStrideSize,!0),e+=3,this._platform.alignDataInBuffer&&(e+=1),z.noiseCoordinates2=v.createVertexBuffer("noiseCoordinates2",e,3,this._attributesStrideSize,!0),e+=3,this._platform.alignDataInBuffer&&(e+=1)),z.angle=v.createVertexBuffer("angle",e,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?e++:e+=2,this._isAnimationSheetEnabled&&(z.cellIndex=v.createVertexBuffer("cellIndex",e,1,this._attributesStrideSize,!0),e+=1,this.spriteRandomStartCell&&(z.cellStartOffset=v.createVertexBuffer("cellStartOffset",e,1,this._attributesStrideSize,!0),e+=1)),z.offset=D.createVertexBuffer("offset",0,2),z.uv=D.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(z),this._platform.createVertexBuffers(S,z),this.resetDrawCache()}_initialize(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!S)return;const v=this._engine,D=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof s&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const e=this.particleEmitterType instanceof s,N=z.TmpVectors.Rv[0];let m=0;for(let z=0;z<this._capacity;z++)if(D.push(0),D.push(0),D.push(0),D.push(0),D.push(0),D.push(0),D.push(0),D.push(0),D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),e?(this.particleEmitterType.particleDestinationGenerator(z,null,N),D.push(N.x),D.push(N.y),D.push(N.z)):(D.push(0),D.push(0),D.push(0)),this._platform.alignDataInBuffer&&D.push(0),m+=16,e&&(this.particleEmitterType.particlePositionGenerator(z,null,N),D.push(N.x),D.push(N.y),D.push(N.z),this._platform.alignDataInBuffer&&D.push(0),m+=4),this._colorGradientsTexture||(D.push(0),D.push(0),D.push(0),D.push(0),m+=4),this.isBillboardBased||(D.push(0),D.push(0),D.push(0),this._platform.alignDataInBuffer&&D.push(0),m+=4),this.noiseTexture&&(D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),this._platform.alignDataInBuffer&&D.push(0),D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),this._platform.alignDataInBuffer&&D.push(0),m+=8),D.push(0),m+=1,this._angularSpeedGradientsTexture||(D.push(0),m+=1),this._isAnimationSheetEnabled&&(D.push(0),m+=1,this.spriteRandomStartCell&&(D.push(0),m+=1)),this._platform.alignDataInBuffer){let S=3-(m+3&3);for(m+=S;S-- >0;)D.push(0)}const B=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),g=this._platform.createParticleBuffer(D),E=this._platform.createParticleBuffer(D);this._buffer0=new r.b(v,g,!1,this._attributesStrideSize),this._buffer1=new r.b(v,E,!1,this._attributesStrideSize),this._spriteBuffer=new r.b(v,B,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let S=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(S+="\n#define BILLBOARD"),this._colorGradientsTexture&&(S+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(S+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(S+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(S+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(S+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(S+="\n#define DRAGGRADIENTS"),this._flowMap&&(S+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(S+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(S+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(S+="\n#define NOISE"),this.isLocal&&(S+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===S||(this._cachedUpdateDefines=S,this._updateBuffer=this._platform.createUpdateBuffer(S)),this._platform.isUpdateBufferReady()}_getWrapper(S){const v=this._getCustomDrawWrapper(S);if(null!==v&&void 0!==v&&v.effect)return v;const D=[];this.fillDefines(D,S);let z=this._drawWrappers[S];z||(z=new SS.b(this._engine),z.drawContext&&(z.drawContext.useInstancing=!0),this._drawWrappers[S]=z);const e=D.join("\n");if(z.defines!==e){const S=[],v=[],D=[];this.fillUniformsAttributesAndSamplerNames(v,S,D),z.setEffect(this._engine.createEffect("gpuRenderParticles",S,v,D,e),e)}return z}static _GetAttributeNamesOrOptions(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const e=[r.d.PositionKind,"age","life","size","angle"];return S||e.push(r.d.ColorKind),v&&e.push("cellIndex"),D||e.push("initialDirection"),z&&e.push("direction"),e.push("offset",r.d.UVKind),e}static _GetEffectCreationOptions(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["emitterWM","xE","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,vS.d)(z),S&&z.push("sheetInfos"),v&&z.push("logarithmicDepthConstant"),D&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,vS.h)(this,this._scene,S),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Ev.d.FOGMODE_NONE&&S.push("#define FOG")),v===Bv.BLENDMODE_MULTIPLY&&S.push("#define BLENDMULTIPLYMODE"),this.isLocal&&S.push("#define LOCAL"),this.useLogarithmicDepth&&S.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(S.push("#define BILLBOARD"),this.billboardMode){case Bv.BILLBOARDMODE_Y:S.push("#define BILLBOARDY");break;case Bv.BILLBOARDMODE_STRETCHED:S.push("#define BILLBOARDSTRETCHED");break;case Bv.BILLBOARDMODE_ALL:S.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&S.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&S.push("#define ANIMATESHEET"),D&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),S.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(S,v,D){v.push(...uv._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Bv.BILLBOARDMODE_STRETCHED)),S.push(...uv._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),D.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(gv.d.PrepareUniforms(S,this._imageProcessingConfigurationDefines),gv.d.PrepareSamplers(D,this._imageProcessingConfigurationDefines))}animate(){var S;let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(v?this.preWarmStepOffset:(null===(S=this._scene)||void 0===S?void 0:S.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(S,v){const D=this[v];if(!S||!S.length||D)return;const z=new Float32Array(this._rawTextureWidth);for(let e=0;e<this._rawTextureWidth;e++){const v=e/this._rawTextureWidth;F.GetCurrentGradient(v,S,((S,v,D)=>{z[e]=(0,E.Lerp)(S.factor1,v.factor1,D)}))}this[v]=P.e.CreateRTexture(z,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[v].name=v.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const S=new Uint8Array(4*this._rawTextureWidth),v=m.TmpColors.Ge[0];for(let D=0;D<this._rawTextureWidth;D++){const z=D/this._rawTextureWidth;F.GetCurrentGradient(z,this._colorGradients,((z,e,N)=>{m.Ge.LerpToRef(z.color1,e.color1,N,v),S[4*D]=255*v.r,S[4*D+1]=255*v.g,S[4*D+2]=255*v.b,S[4*D+3]=255*v.a}))}this._colorGradientsTexture=P.e.CreateRGBATexture(S,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(S,v){var D,e,N,m;const B=this._getWrapper(S),g=B.effect;this._engine.enableEffect(B);const E=(null===(D=this._scene)||void 0===D?void 0:D.getViewMatrix())||z.Matrix.IdentityReadOnly;if(g.setMatrix("view",E),g.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),g.setTexture("diffuseSampler",this.particleTexture),g.setVector2("translationPivot",this.translationPivot),g.setVector3("xE",this.xE),this.isLocal&&g.setMatrix("emitterWM",v),this._colorGradientsTexture?g.setTexture("colorGradientSampler",this._colorGradientsTexture):g.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const S=this.particleTexture.getBaseSize();g.setFloat3("sheetInfos",this.spriteCellWidth/S.width,this.spriteCellHeight/S.height,S.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const S=this._scene.activeCamera;g.setVector3("eyePosition",S.globalPosition)}const h=g.defines;if(this._scene&&((0,vS.e)(g,this,this._scene),this.applyFog&&(0,DS.h)(this._scene,void 0,g)),h.indexOf("#define BILLBOARDMODE_ALL")>=0){const S=E.clone();S.invert(),g.setMatrix("invView",S)}return this.useLogarithmicDepth&&this._scene&&(0,DS.m)(h,g,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(g),this._setEngineBasedOnBlendMode(S),this._platform.bindDrawBuffers(this._targetIndex,g,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(g),null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(m=this._scene)&&void 0!==m&&m.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(S){if(!this.zv||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!S)if(this.zv.position){S=this.zv.getWorldMatrix()}else{const v=this.zv;S=z.TmpVectors.Matrix[0],z.Matrix.TranslationToRef(v.x,v.y,v.z,S)}const v=this._engine,D=v.getDepthWrite();if(v.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const S=this.xS();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",S.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",S),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const e=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=e,v.setDepthWrite(D)}render(){let S,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!v&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let S=0;S<this.preWarmCycles;S++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const S=0|this._accumulatedCount;this._accumulatedCount-=S,this._currentActiveCount+=S}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.zv.position){S=this.zv.getWorldMatrix()}else{const v=this.zv;S=z.TmpVectors.Matrix[0],z.Matrix.TranslationToRef(v.x,v.y,v.z,S)}const e=this._engine;this.updateInAnimate||this._update(S);let N=0;return v||D||(e.setState(!1),this.forceDepthWrite&&e.setDepthWrite(!0),N=this.blendMode===Bv.BLENDMODE_MULTIPLYADD?this._render(Bv.BLENDMODE_MULTIPLY,S)+this._render(Bv.BLENDMODE_ADD,S):this._render(this.blendMode,S),this._engine.setAlphaMode(0)),N}rebuild(){const S=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(S,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,S()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const v in this._drawWrappers){this._drawWrappers[v].dispose()}if(this._drawWrappers={},this._scene){const S=this._scene.Zw.indexOf(this);S>-1&&this._scene.Zw.splice(S,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let v=0;v<this._renderVertexBuffers.length;++v){const S=this._renderVertexBuffers[v];for(const v in S)S[v].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),S&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),S&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Se.notifyObservers(this),this.Se.clear()}clone(S,v){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let e=null;const N=this._engine;if(N.createEffectForParticles&&null!=this.customShader){e=this.customShader;const S=e.shaderOptions.defines.length>0?e.shaderOptions.defines.join("\n"):"";z[0]=N.createEffectForParticles(e.shaderPath.fragmentElement,e.shaderOptions.uniforms,e.shaderOptions.samplers,S,void 0,void 0,void 0,this)}const m=this.serialize(D),B=uv.Parse(m,this._scene||this._engine,this._rootUrl);return B.name=S,B.customShader=e,B._customWrappers=z,void 0===v&&(v=this.zv),this.noiseTexture&&(B.noiseTexture=this.noiseTexture.clone()),B.zv=v,B}serialize(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};return Bv._Serialize(v,this,S),v.activeParticleCount=this.activeParticleCount,v.randomTextureSize=this._randomTextureSize,v.customShader=this.customShader,v}static Parse(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],e=arguments.length>4?arguments[4]:void 0;const N=S.name;let m,B;v instanceof CS.d?m=v:(B=v,m=B.getEngine());const g=new uv(N,{Jv:e||S.Jv,randomTextureSize:S.randomTextureSize},v,null,S.isAnimationSheetEnabled);if(g._rootUrl=D,S.customShader&&m.createEffectForParticles){const v=S.customShader,D=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"",z=m.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,D,void 0,void 0,void 0,g);g.setCustomEffect(z,0),g.customShader=v}return S.id&&(g.id=S.id),S.activeParticleCount&&(g.activeParticleCount=S.activeParticleCount),Bv._Parse(S,g,v,D),S.preventAutoStart&&(g.preventAutoStart=S.preventAutoStart),z||g.preventAutoStart||g.start(),g}}var sv=D(11175),rv=D(12780),dv=D(11746);class xv{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(S){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const v of this.systems)v.zv=S;this._emitterNode=S}setEmitterAsSphere(S,v,D){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:S,renderingGroupId:v};const z=(0,rv.d)("emitterSphere",{diameter:S.diameter,segments:S.segments},D);z.renderingGroupId=v;const e=new dv.Kv("emitterSphereMaterial",D);e.emissiveColor=S.color,z.material=e;for(const N of this.systems)N.zv=z;this._emitterNode=z}start(S){for(const v of this.systems)S&&(v.zv=S),v.start()}dispose(){for(const S of this.systems)S.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={systems:[]};for(const D of this.systems)v.systems.push(D.serialize(S));return this._emitterNode&&(v.zv=this._emitterCreationOptions),v}static Parse(S,v){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;const e=new xv,N=this.BaseAssetsUrl+"/textures/";v=v||Q.c.LastCreatedScene;for(const m of S.systems)e.systems.push(D?uv.Parse(m,v,N,!0,z):Bv.Parse(m,v,N,!0,z));if(S.zv){const D=S.zv.options;if("Sphere"===S.zv.kind)e.setEmitterAsSphere({diameter:D.diameter,segments:D.segments,color:m.qv.uv(D.color)},S.zv.renderingGroupId,v)}return e}}xv.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Wv=D(11214);class pv{static CreateDefault(S){let v,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,z=arguments.length>2?arguments[2]:void 0;v=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new uv("default system",{Jv:D},z):new Bv("default system",D,z),v.zv=S;const e=sv.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return v.particleTexture=new o.d(e,v.xS()),v.createConeEmitter(.1,Math.PI/4),v.color1=new m.Ge(1,1,1,1),v.color2=new m.Ge(1,1,1,1),v.colorDead=new m.Ge(1,1,1,0),v.minSize=.1,v.maxSize=.1,v.minEmitPower=2,v.maxEmitPower=2,v.updateSpeed=1/60,v.emitRate=30,v}static CreateAsync(S,v){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;v||(v=Q.c.LastCreatedScene);const e={};return v.addPendingData(e),new Promise(((N,m)=>{if(D&&!uv.IsSupported)return v.removePendingData(e),m("Particle system with GPU is not supported.");sv.Tools.LoadFile(`${pv.BaseAssetsUrl}/systems/${S}.json`,(S=>{v.removePendingData(e);const m=JSON.parse(S.toString());return N(xv.Parse(m,v,D,z))}),void 0,void 0,void 0,(()=>(v.removePendingData(e),m(`An error occurred with the creation of your particle system. Check if your type '${S}' exists.`))))}))}static ExportSet(S){const v=new xv;for(const D of S)v.systems.push(D);return v}static ParseFromFileAsync(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",N=arguments.length>5?arguments[5]:void 0;return new Promise(((m,B)=>{const g=new Wv.c;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const v=JSON.parse(g.responseText);let B;B=z?uv.Parse(v,D,e,!1,N):Bv.Parse(v,D,e,!1,N),S&&(B.name=S),m(B)}else B("Unable to load the particle system")})),g.open("GET",v),g.send()}))}static ParseFromSnippetAsync(S,v){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",e=arguments.length>4?arguments[4]:void 0;if("_BLANK"===S){const S=this.CreateDefault(null);return S.start(),Promise.resolve(S)}return new Promise(((N,m)=>{const B=new Wv.c;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const m=JSON.parse(JSON.parse(B.responseText).jsonPayload),g=JSON.parse(m.particleSystem);let E;E=D?uv.Parse(g,v,z,!1,e):Bv.Parse(g,v,z,!1,e),E.snippetId=S,N(E)}else m("Unable to load the snippet "+S)})),B.open("GET",this.SnippetUrl+"/"+S.replace(/#/g,"/")),B.send()}))}}pv.BaseAssetsUrl=xv.BaseAssetsUrl,pv.SnippetUrl="https://snippet.babylonjs.com",pv.CreateFromSnippetAsync=pv.ParseFromSnippetAsync;var bv=D(11819),kv=D(11645),Zv=D(12785);(0,Zv.g)(kv.e.NAME_PARTICLESYSTEM,((S,v,D,z)=>{const e=(0,Zv.h)(kv.e.NAME_PARTICLESYSTEM);if(e&&void 0!==S.Zw&&null!==S.Zw)for(let N=0,m=S.Zw.length;N<m;N++){const m=S.Zw[N];D.Zw.push(e(m,v,z))}})),(0,Zv.c)(kv.e.NAME_PARTICLESYSTEM,((S,v,D)=>{if(S.activeParticleCount){return uv.Parse(S,v,D)}return Bv.Parse(S,v,D)})),CS.d.prototype.createEffectForParticles=function(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",N=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0,g=arguments.length>7?arguments[7]:void 0,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0,A=[],w=[];const n=[];return g?g.fillUniformsAttributesAndSamplerNames(w,A,n):(A=Bv._GetAttributeNamesOrOptions(),w=Bv._GetEffectCreationOptions()),-1===e.indexOf(" BILLBOARD")&&(e+="\n#define BILLBOARD\n"),null!==g&&void 0!==g&&g.isAnimationSheetEnabled&&-1===e.indexOf(" ANIMATESHEET")&&(e+="\n#define ANIMATESHEET\n"),-1===z.indexOf("diffuseSampler")&&z.push("diffuseSampler"),this.createEffect({vertex:h??(null===g||void 0===g?void 0:g.vertexShaderName)??"particles",fragmentElement:S},A,w.concat(v),n.concat(z),e,N,m,B,void 0,E,(async()=>{0===E?await Promise.resolve().then(D.bind(D,12811)):await Promise.resolve().then(D.bind(D,12881))}))},bv.e.prototype.getEmittedParticleSystems=function(){const S=[];for(let v=0;v<this.xS().Zw.length;v++){const D=this.xS().Zw[v];D.zv===this&&S.push(D)}return S},bv.e.prototype.getHierarchyEmittedParticleSystems=function(){const S=[],v=this.getDescendants();v.push(this);for(let D=0;D<this.xS().Zw.length;D++){const z=this.xS().Zw[D],e=z.zv;e.position&&-1!==v.indexOf(e)&&S.push(z)}return S};D(11716),D(11721),D(11802);D(11806),D(12788),D(11584),D(11705),D(11836);D(11576);var iv;D(12793),D(11400);!function(S){S[S.Color=2]="Color",S[S.UV=1]="UV",S[S.Random=0]="Random",S[S.Stated=3]="Stated"}(iv||(iv={}));var tv=D(11607);const Xv=new z.Rv(0,0,0),av=new z.Rv(0,0,0),ov=new z.Rv(0,0,0);class Mv{constructor(S,v,D){this.width=S,this.height=v,this.data=D}processFlowable(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2?arguments[2]:void 0;if(!D)return;D instanceof z.Matrix?z.Rv.TransformCoordinatesToRef(S.position,D,ov):(ov.x=D.x,ov.y=D.y,ov.z=D.z);const e=.5*ov.x+.5,N=1-(.5*ov.y+.5),m=Math.floor(e*this.width),B=Math.floor(N*this.height);if(m<0||m>=this.width||B<0||B>=this.height)return;const g=4*(B*this.width+m),E=this.data[g]/255*2-1,h=this.data[g+1]/255*2-1,A=this.data[g+2]/255*2-1,w=this.data[g+3]/255;Xv.set(E,h,A),Xv.scaleToRef(v*w,av),S.direction.addInPlace(av)}_processParticle(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2?arguments[2]:void 0;this.processFlowable(S,v,D)}static async FromUrlAsync(S){return await new Promise(((v,D)=>{const z=document.createElement("canvas"),e=z.getContext("2d");let N=null;const m=new Image;m.crossOrigin="anonymous",m.src=S,m.onerror=v=>{D(new Error(`Failed to load image: ${S} : ${v}`))},m.onload=()=>{z.width=m.width,z.height=m.height,e.drawImage(m,0,0),N=e.getImageData(0,0,z.width,z.height),v(new Mv(z.width,z.height,N.data))}}))}static async ExtractFromTextureAsync(S){return await new Promise(((v,D)=>{if(!S.isReady())return void S.onLoadObservable.addOnce((async()=>{try{const D=await this.ExtractFromTextureAsync(S);v(D)}catch(z){D(z)}}));const z=S.getSize();tv.m.GetTextureDataAsync(S,z.width,z.height).then((S=>{v(new Mv(z.width,z.height,new Uint8ClampedArray(S)))})).catch(D)}))}}var cv,Jv,Hv,Tv,Gv,Yv,jv,Vv,Uv;!function(S){S[S.Int=1]="Int",S[S.Float=2]="Float",S[S.Vector2=4]="Vector2",S[S.Rv=8]="Rv",S[S.Matrix=16]="Matrix",S[S.Particle=32]="Particle",S[S.Texture=64]="Texture",S[S.Ge=128]="Ge",S[S.FloatGradient=256]="FloatGradient",S[S.Vector2Gradient=512]="Vector2Gradient",S[S.Vector3Gradient=1024]="Vector3Gradient",S[S.Color4Gradient=2048]="Color4Gradient",S[S.System=4096]="System",S[S.AutoDetect=8192]="AutoDetect",S[S.BasedOnInput=16384]="BasedOnInput",S[S.Undefined=32768]="Undefined",S[S.All=65535]="All"}(cv||(cv={})),function(S){S[S.Compatible=0]="Compatible",S[S.TypeIncompatible=1]="TypeIncompatible",S[S.HierarchyIssue=2]="HierarchyIssue"}(Jv||(Jv={})),function(S){S[S.Input=0]="Input",S[S.Output=1]="Output"}(Hv||(Hv={}));class yv{get direction(){return this._direction}get type(){if(this._type===cv.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===cv.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(S){this._type=S}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((S=>S.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(S,v,D){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=cv.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new l.d,this.onDisconnectionObservable=new l.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=v,this.name=S,this._direction=D}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(S){var v;return this.isConnected?null!==(v=this._connectedPoint)&&void 0!==v&&v._storedFunction?this._connectedPoint._storedFunction(S):this._connectedPoint._storedValue:this.value}canConnectTo(S){return 0===this.checkCompatibilityState(S)}checkCompatibilityState(S){const v=this._ownerBlock,D=S.ownerBlock;if(this.type!==S.type&&S.innerType!==cv.AutoDetect)return S.acceptedConnectionPointTypes&&-1!==S.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(S.excludedConnectionPointTypes&&-1!==S.excludedConnectionPointTypes.indexOf(this.type))return 1;let z=D,e=v;return 0===this.direction&&(z=v,e=D),z.isAnAncestorOf(e)?2:0}connectTo(S){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(S))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${S.ownerBlock.name}".${S.name}`;return this._endpoints.push(S),S._connectedPoint=this,this.onConnectionObservable.notifyObservers(S),S.onConnectionObservable.notifyObservers(this),this}disconnectFrom(S){const v=this._endpoints.indexOf(S);return-1===v||(this._endpoints.splice(v,1),S._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(S),S.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(S){let v=1;for(;v<cv.All;)S&v||this.excludedConnectionPointTypes.push(v),v<<=1}serialize(){let S=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const v={};return v.name=this.name,v.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Oe?(v.valueType="BABYLON."+this.value.getClassName(),v.value=this.value.Oe()):(v.valueType="number",v.value=this.value)),S&&this.connectedPoint&&(v.inputName=this.name,v.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,v.targetConnectionName=this.connectedPoint.name,v.isExposedOnFrame=!0,v.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(v.isExposedOnFrame=!0,v.exposedPortPosition=this.exposedPortPosition),v}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class fv{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(S){this._name=S}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(S){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new l.d,this.Se=new l.d,this.onInputChangedObservable=new l.d,this.visibleOnFrame=!1,this._name=S,this.uniqueId=M.c.UniqueId}_inputRename(S){return S}_outputRename(S){return S}isAnAncestorOf(S){for(const v of this._outputs)if(v.hasEndpoints)for(const D of v.endpoints){if(D.ownerBlock===S)return!0;if(D.ownerBlock.isAnAncestorOf(S))return!0}return!1}isAnAncestorOfType(S){if(this.getClassName()===S)return!0;for(const v of this._outputs)if(v.hasEndpoints)for(const D of v.endpoints)if(D.ownerBlock.isAnAncestorOfType(S))return!0;return!1}getInputByName(S){const v=this._inputs.filter((v=>v.name===S));return v.length?v[0]:null}_linkConnectionTypes(S,v){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[v]._acceptedConnectionPointType=this._inputs[S]:(this._inputs[S]._linkedConnectionSource=this._inputs[v],this._inputs[S]._isMainLinkSource=!0),this._inputs[v]._linkedConnectionSource=this._inputs[S]}registerInput(S,v){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0,e=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0;const m=new yv(S,this,0);return m.type=v,m.isOptional=D,m.defaultValue=z,m.value=z,m.valueMin=e,m.valueMax=N,this._inputs.push(m),this.onInputChangedObservable.notifyObservers(m),this}registerOutput(S,v,D){return(D=D??new yv(S,this,1)).type=v,this._outputs.push(D),this}_build(S){}_customBuildStep(S){}build(S){if(this._buildId===S.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((S=>S.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=S.buildId;for(const v of this._inputs){if(!v.connectedPoint){v.isOptional||S.notConnectedNonOptionalInputs.push(v);continue}const D=v.connectedPoint.ownerBlock;D&&D!==this&&!D.isSystem&&D.build(S)}return this._customBuildStep(S),S.verbose&&c.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(S),this.onBuildObservable.notifyObservers(this),!1}serialize(){const S={};S.customType="BABYLON."+this.getClassName(),S.id=this.uniqueId,S.name=this.name,S.visibleOnFrame=this.visibleOnFrame,S.inputs=[],S.outputs=[];for(const v of this.inputs)S.inputs.push(v.serialize());for(const v of this.outputs)S.outputs.push(v.serialize(!1));return S}_deserialize(S){this._name=S.name,this.comments=S.comments,this.visibleOnFrame=!!S.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(S)}_deserializePortDisplayNamesAndExposedOnFrame(S){const v=S.inputs,D=S.outputs;if(v)for(const z of v){const S=this.inputs.find((S=>S.name===z.name));if(!S)return;if(z.displayName&&(S.displayName=z.displayName),z.isExposedOnFrame&&(S.isExposedOnFrame=z.isExposedOnFrame,S.exposedPortPosition=z.exposedPortPosition),void 0!==z.value&&null!==z.value)if("number"===z.valueType)S.value=z.value;else{const v=(0,B.e)(z.valueType);v&&(S.value=v.uv(z.value))}}if(D)for(let z=0;z<D.length;z++){const S=D[z];S.displayName&&(this.outputs[z].displayName=S.displayName),S.isExposedOnFrame&&(this.outputs[z].isExposedOnFrame=S.isExposedOnFrame,this.outputs[z].exposedPortPosition=S.exposedPortPosition)}}clone(){const S=this.serialize(),v=(0,B.e)(S.customType);if(v){const D=new v;return D._deserialize(S),D}return null}dispose(){this.Se.notifyObservers(this),this.Se.clear();for(const S of this.inputs)S.dispose();for(const S of this.outputs)S.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Cv(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",z=arguments.length>3?arguments[3]:void 0;return(e,N)=>{let m=e._propStore;m||(m=[],e._propStore=m),m.push({propertyName:N,displayName:S,type:v,groupName:D,options:z??{},className:e.getClassName()})}}(0,t.b)([(0,X.L)("comment")],fv.prototype,"comments",void 0),function(S){S[S.Boolean=0]="Boolean",S[S.Float=1]="Float",S[S.Int=2]="Int",S[S.Vector2=3]="Vector2",S[S.List=4]="List",S[S.Ge=5]="Ge",S[S.SamplingMode=6]="SamplingMode",S[S.TextureFormat=7]="TextureFormat",S[S.TextureType=8]="TextureType"}(Tv||(Tv={})),function(S){S[S.None=0]="None",S[S.Position=1]="Position",S[S.Direction=2]="Direction",S[S.Age=3]="Age",S[S.Lifetime=4]="Lifetime",S[S.Color=5]="Color",S[S.ScaledDirection=6]="ScaledDirection",S[S.Scale=7]="Scale",S[S.AgeGradient=8]="AgeGradient",S[S.Angle=9]="Angle",S[S.SpriteCellIndex=16]="SpriteCellIndex",S[S.SpriteCellStart=17]="SpriteCellStart",S[S.SpriteCellEnd=18]="SpriteCellEnd"}(Gv||(Gv={})),function(S){S[S.None=0]="None",S[S.Time=1]="Time",S[S.Delta=2]="Delta",S[S.Emitter=3]="Emitter"}(Yv||(Yv={}));class Fv{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let S="";for(const v of this.notConnectedNonOptionalInputs)S+=`input ${v.name} from block ${v.ownerBlock.name}[${v.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(S)throw"Build of Node Particle System Set failed:\n"+S}adapt(S,v){const D=S.getConnectedValue(this)||0;if(S.type===v)return D;switch(v){case cv.Vector2:return new z.Vector2(D,D);case cv.Rv:return new z.Rv(D,D,D);case cv.Ge:return new m.Ge(D,D,D,D)}return null}getContextualValue(S){if(!this.particleContext||!this.systemContext)return null;switch(S){case Gv.Position:return this.particleContext.position;case Gv.Direction:return this.particleContext.direction;case Gv.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Gv.Color:return this.particleContext.color;case Gv.Age:return this.particleContext.age;case Gv.Lifetime:return this.particleContext.lifeTime;case Gv.Angle:return this.particleContext.angle;case Gv.Scale:return this.particleContext.scale;case Gv.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Gv.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Gv.SpriteCellIndex:return this.particleContext.cellIndex;case Gv.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.zv.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.zv.absolutePosition:this.systemContext.zv:null}getSystemValue(S){if(!this.particleContext||!this.systemContext)return null;switch(S){case Yv.Time:return this.systemContext._actualFrame;case Yv.Delta:return this.systemContext._scaledUpdateSpeed;case Yv.Emitter:if(this.isEmitterTransformNode){return this.systemContext.zv.absolutePosition}return this.systemContext.zv}return null}}function lv(S,v,D){const z=new Fv;z.Iv=v;const e=S.createSystem(z);return e.canStart=()=>!0,e.zv=D.clone(),e.disposeOnStop=!0,e.start(),e}class Pv extends fv{constructor(S){super(S),this.blendMode=g.BLENDMODE_ONEONE,this.Jv=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",cv.Particle),this.registerInput("texture",cv.Texture),this.registerInput("onStart",cv.System,!0),this.registerInput("onEnd",cv.System,!0),this.registerOutput("system",cv.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(S){S.Jv=this.Jv,S.buildId=this._buildId++,this.build(S);const v=this.particle.getConnectedValue(S);return v.particleTexture=this.texture.getConnectedValue(S),v.emitRate=this.emitRate,v.blendMode=this.blendMode,v.name=this.name,v._nodeGenerated=!0,v._targetStopDuration=this.targetStopDuration,v.startDelay=this.startDelay,this.system._storedValue=this,v.canStart=()=>!this.doNoStart,v.onStartedObservable.add((D=>{const z=this.onStart.getConnectedValue(S);z&&D.onStartedObservable.addOnce((()=>{S.systemContext=v;const D=lv(z,S.Iv,S.emitterPosition);this.Se.addOnce((()=>{D.dispose()}))}));const e=this.onEnd.getConnectedValue(S);e&&D.onStoppedObservable.addOnce((()=>{S.systemContext=v;const D=lv(e,S.Iv,S.emitterPosition);this.Se.addOnce((()=>{D.dispose()}))}))})),this.Se.addOnce((()=>{v.dispose()})),v}serialize(){const S=super.serialize();return S.Jv=this.Jv,S.emitRate=this.emitRate,S.blendMode=this.blendMode,S.doNoStart=this.doNoStart,S.targetStopDuration=this.targetStopDuration,S.startDelay=this.startDelay,S}_deserialize(S){super._deserialize(S),this.Jv=S.Jv,this.emitRate=S.emitRate,this.doNoStart=!!S.doNoStart,void 0!==S.blendMode&&(this.blendMode=S.blendMode),void 0!==S.targetStopDuration&&(this.targetStopDuration=S.targetStopDuration),void 0!==S.startDelay&&(this.startDelay=S.startDelay)}}(0,t.b)([Cv("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:g.BLENDMODE_ONEONE},{label:"Standard",value:g.BLENDMODE_STANDARD},{label:"Add",value:g.BLENDMODE_ADD},{label:"Multiply",value:g.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:g.BLENDMODE_MULTIPLYADD}]})],Pv.prototype,"blendMode",void 0),(0,t.b)([Cv("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Pv.prototype,"Jv",void 0),(0,t.b)([Cv("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Pv.prototype,"emitRate",void 0),(0,t.b)([Cv("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Pv.prototype,"targetStopDuration",void 0),(0,t.b)([Cv("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Pv.prototype,"startDelay",void 0),(0,t.b)([Cv("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Pv.prototype,"doNoStart",void 0),(0,B.f)("BABYLON.SystemBlock",Pv);class Qv extends fv{get type(){if(this._type===cv.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=cv.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=cv.Vector2,this._type;case"Rv":return this._type=cv.Rv,this._type;case"Ge":return this._type=cv.Ge,this._type;case"Matrix":return this._type=cv.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Gv.None&&this._systemSource!==Yv.None}get systemSource(){return this._systemSource}set systemSource(S){if(this._systemSource=S,S!==Yv.None){switch(this._contextualSource=Gv.None,this._type=cv.Float,S){case Yv.Time:case Yv.Delta:this._type=cv.Float;break;case Yv.Emitter:this._type=cv.Rv}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Gv.None}get contextualValue(){return this._contextualSource}set contextualValue(S){if(this._contextualSource=S,S!==Gv.None){switch(this._systemSource=Yv.None,S){case Gv.Scale:this._type=cv.Vector2;break;case Gv.Position:case Gv.Direction:case Gv.ScaledDirection:this._type=cv.Rv;break;case Gv.Color:this._type=cv.Ge;break;case Gv.Age:case Gv.Lifetime:case Gv.Angle:case Gv.AgeGradient:this._type=cv.Float;break;case Gv.SpriteCellEnd:case Gv.SpriteCellStart:case Gv.SpriteCellIndex:this._type=cv.Int}this.output&&(this.output.type=this._type)}}constructor(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cv.AutoDetect;super(S),this._type=cv.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new l.d,this._systemSource=Yv.None,this._contextualSource=Gv.None,this._type=v,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",v)}get value(){return this._storedValue}set value(S){this.type===cv.Float&&this.min!==this.max&&(S=Math.max(this.min,S),S=Math.min(this.max,S)),this._storedValue=S,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(S){this._valueCallback=S}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case cv.Int:case cv.Float:this.value=0;break;case cv.Vector2:this.value=z.Vector2.Zero();break;case cv.Rv:this.value=z.Rv.Zero();break;case cv.Ge:this.value=new m.Ge(1,1,1,1);break;case cv.Matrix:this.value=z.Matrix.Identity()}}_build(S){super._build(S),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=S=>S.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=S=>S.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const S=super.serialize();return S.type=this.type,S.contextualValue=this.contextualValue,S.systemSource=this.systemSource,S.min=this.min,S.max=this.max,S.groupInInspector=this.groupInInspector,S.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Oe?(S.valueType="BABYLON."+this._storedValue.getClassName(),S.value=this._storedValue.Oe()):(S.valueType="number",S.value=this._storedValue)),S}_deserialize(S){if(super._deserialize(S),this._type=S.type,this.contextualValue=S.contextualValue,this.systemSource=S.systemSource||Yv.None,this.min=S.min||0,this.max=S.max||0,this.groupInInspector=S.groupInInspector||"",void 0!==S.displayInInspector&&(this.displayInInspector=S.displayInInspector),S.valueType)if("number"===S.valueType)this._storedValue=S.value;else{const v=(0,B.e)(S.valueType);v&&(this._storedValue=v.uv(S.value))}}}(0,B.f)("BABYLON.ParticleInputBlock",Qv);class Lv extends fv{get url(){return this._url}set url(S){this._url!==S&&(this._cachedData=null,this._url=S,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(S){this._textureDataUrl!==S&&(this._cachedData=null,this._textureDataUrl=S,this._url="",this._sourceTexture=null)}set sourceTexture(S){this._sourceTexture!==S&&(this._cachedData=null,this._sourceTexture=S,this._url="",this._textureDataUrl="")}constructor(S){super(S),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",cv.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const S=this.texture._storedValue;return await new Promise(((v,D)=>{if(!S.isReady())return void S.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),v(this._cachedData)}catch(S){D(S)}}));const z=S.getSize();tv.m.GetTextureDataAsync(S,z.width,z.height).then((D=>{this._cachedData={width:z.width,height:z.height,data:new Uint8ClampedArray(D)},S.dispose(),v(this._cachedData)})).catch(D)}))}_build(S){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new o.d(this._textureDataUrl,S.Iv):this.texture._storedValue=new o.d(this._url,S.Iv):this.texture._storedValue=null}serialize(){const S=super.serialize();return S.url=this.url,S.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(S.textureDataUrl=this.textureDataUrl),S}_deserialize(S){super._deserialize(S),this.url=S.url,this.serializedCachedData=!!S.serializedCachedData,S.textureDataUrl&&(this.textureDataUrl=S.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,B.f)("BABYLON.ParticleTextureSourceBlock",Lv);class SD extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerInput("position",cv.Rv),this.registerOutput("output",cv.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(S){const v=this.particle.getConnectedValue(S);if(this.output._storedValue=v,!this.position.isConnected)return;const D={process:D=>{S.particleContext=D,S.systemContext=v,D.position.N(this.position.getConnectedValue(S))},previousItem:null,nextItem:null};v._updateQueueStart?YS(D,v._updateQueueStart):v._updateQueueStart=D}}(0,B.f)("BABYLON.UpdatePositionBlock",SD),function(S){S[S.Add=0]="Add",S[S.Subtract=1]="Subtract",S[S.Multiply=2]="Multiply",S[S.Divide=3]="Divide",S[S.Max=4]="Max",S[S.Min=5]="Min"}(jv||(jv={}));class vD extends fv{constructor(S){super(S),this.operation=jv.Add,this.registerInput("left",cv.AutoDetect),this.registerInput("right",cv.AutoDetect),this.registerOutput("output",cv.BasedOnInput),this.output._typeConnectionSource=this.left;const v=[cv.Matrix,cv.Particle,cv.Texture,cv.System,cv.FloatGradient,cv.Color4Gradient,cv.Vector2Gradient,cv.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...v),this.right.excludedConnectionPointTypes.push(...v),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(S){let v;const D=this.left,e=this.right;if(!D.isConnected||!e.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const N=D.type===cv.Float||D.type===cv.Int,B=e.type===cv.Float||e.type===cv.Int,g=N&&B;switch(this.operation){case jv.Add:v=g?S=>D.getConnectedValue(S)+e.getConnectedValue(S):N?S=>S.adapt(D,e.type).add(e.getConnectedValue(S)):S=>D.getConnectedValue(S).add(S.adapt(e,D.type));break;case jv.Subtract:v=g?S=>D.getConnectedValue(S)-e.getConnectedValue(S):N?S=>S.adapt(D,e.type).Ov(e.getConnectedValue(S)):S=>D.getConnectedValue(S).Ov(S.adapt(e,D.type));break;case jv.Multiply:v=g?S=>D.getConnectedValue(S)*e.getConnectedValue(S):N?S=>S.adapt(D,e.type).multiply(e.getConnectedValue(S)):S=>D.getConnectedValue(S).multiply(S.adapt(e,D.type));break;case jv.Divide:v=g?S=>D.getConnectedValue(S)/e.getConnectedValue(S):N?S=>S.adapt(D,e.type).divide(e.getConnectedValue(S)):S=>D.getConnectedValue(S).divide(S.adapt(e,D.type));break;case jv.Min:if(g)v=S=>Math.min(D.getConnectedValue(S),e.getConnectedValue(S));else{const[S,B]=N?[e,D]:[D,e];switch(S.type){case cv.Vector2:v=v=>z.Vector2.Minimize(S.getConnectedValue(v),v.adapt(B,S.type));break;case cv.Rv:v=v=>z.Rv.Minimize(S.getConnectedValue(v),v.adapt(B,S.type));break;case cv.Ge:v=v=>{const D=S.getConnectedValue(v),{r:z,g:e,b:N,a:g}=v.adapt(B,S.type);return new m.Ge(Math.min(D.r,z),Math.min(D.g,e),Math.min(D.b,N),Math.min(D.a,g))}}}break;case jv.Max:if(!g){const[S,B]=N?[e,D]:[D,e];switch(S.type){case cv.Vector2:v=v=>z.Vector2.Maximize(S.getConnectedValue(v),v.adapt(B,S.type));break;case cv.Rv:v=v=>z.Rv.Maximize(S.getConnectedValue(v),v.adapt(B,S.type));break;case cv.Ge:v=v=>{const D=S.getConnectedValue(v),{r:z,g:e,b:N,a:g}=v.adapt(B,S.type);return new m.Ge(Math.max(D.r,z),Math.min(D.g,e),Math.min(D.b,N),Math.min(D.a,g))}}break}v=S=>Math.max(D.getConnectedValue(S),e.getConnectedValue(S))}this.output._storedFunction=S=>D.type===cv.Int?0|v(S):v(S)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===cv.Int||this.left.type===cv.Float&&this.right.type!==cv.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[S,v]of[[this.left,this.right],[this.right,this.left]])S.acceptedConnectionPointTypes=[cv.Int,cv.Float],v.isConnected&&(S.acceptedConnectionPointTypes.push(v.type),v.type!==cv.Int&&v.type!==cv.Float||S.acceptedConnectionPointTypes.push(cv.Vector2,cv.Rv,cv.Ge))}dispose(){super.dispose();for(const S of this._connectionObservers)S.remove();this._connectionObservers.length=0}serialize(){const S=super.serialize();return S.operation=this.operation,S}_deserialize(S){super._deserialize(S),this.operation=S.operation}}(0,t.b)([Cv("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:jv.Add},{label:"Subtract",value:jv.Subtract},{label:"Multiply",value:jv.Multiply},{label:"Divide",value:jv.Divide},{label:"Max",value:jv.Max},{label:"Min",value:jv.Min}]})],vD.prototype,"operation",void 0),(0,B.f)("BABYLON.ParticleMathBlock",vD);class DD extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerInput("direction1",cv.Rv,!0,new z.Rv(0,1,0)),this.registerInput("direction2",cv.Rv,!0,new z.Rv(0,1,0)),this.registerInput("minEmitBox",cv.Rv,!0,new z.Rv(-.5,-.5,-.5)),this.registerInput("maxEmitBox",cv.Rv,!0,new z.Rv(.5,.5,.5)),this.registerOutput("output",cv.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(S){const v=this.particle.getConnectedValue(S);v._directionCreation.process=D=>{S.particleContext=D,S.systemContext=v;const e=this.direction1.getConnectedValue(S),N=this.direction2.getConnectedValue(S),m=(0,E.RandomRange)(e.x,N.x),B=(0,E.RandomRange)(e.y,N.y),g=(0,E.RandomRange)(e.z,N.z);S.isEmitterTransformNode?z.Rv.TransformNormalFromFloatsToRef(m,B,g,S.emitterWorldMatrix,D.direction):D.direction.oe(m,B,g)},v._positionCreation.process=D=>{S.particleContext=D,S.systemContext=v;const e=this.minEmitBox.getConnectedValue(S),N=this.maxEmitBox.getConnectedValue(S),m=(0,E.RandomRange)(e.x,N.x),B=(0,E.RandomRange)(e.y,N.y),g=(0,E.RandomRange)(e.z,N.z);S.isEmitterTransformNode?z.Rv.TransformCoordinatesFromFloatsToRef(m,B,g,S.emitterWorldMatrix,D.position):(D.position.oe(m,B,g),D.position.addInPlace(S.emitterPosition))},this.output._storedValue=v}}(0,B.f)("BABYLON.BoxShapeBlock",DD);class zD extends fv{constructor(S){super(S),this.registerInput("emitPower",cv.Float,!0,1),this.registerInput("lifeTime",cv.Float,!0,1),this.registerInput("color",cv.Ge,!0,new m.Ge(1,1,1,1)),this.registerInput("scale",cv.Vector2,!0,new z.Vector2(1,1)),this.registerInput("angle",cv.Float,!0,0),this.registerOutput("particle",cv.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(S){const v=new Bv(this.name,S.Jv,S.Iv,null,!1,void 0,!0);v.particleEmitterType=new K,v._lifeTimeCreation.process=(v,D)=>{S.particleContext=v,v.lifeTime=this.lifeTime.getConnectedValue(S),D._emitPower=this.emitPower.getConnectedValue(S)},v._colorCreation.process=v=>{S.particleContext=v,v.color.N(this.color.getConnectedValue(S))},v._sizeCreation.process=v=>{S.particleContext=v,v.size=1,v.scale.N(this.scale.getConnectedValue(S))},v._angleCreation.process=v=>{S.particleContext=v,v.angle=this.angle.getConnectedValue(S)},this.particle._storedValue=v}}(0,B.f)("BABYLON.CreateParticleBlock",zD);class eD{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const S=[];for(const v of this.attachedBlocks)v.isInput&&S.push(v);return S}constructor(S){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new l.d,this.name=S}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(S){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(S)&&this.attachedBlocks.push(S);for(const D of S.inputs){const z=D.connectedPoint;if(z){const D=z.ownerBlock;D!==S&&this._initializeBlock(D,v)}}}async buildAsync(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((D=>{const z=new xv;for(const S of this._systemBlocks)this._initializeBlock(S);for(const e of this.systemBlocks){const D=new Fv;D.buildId=this._buildId++,D.Iv=S,D.verbose=v;const N=e.createSystem(D);D.emitErrors(),z.systems.push(N)}this.onBuildObservable.notifyObservers(this),D(z)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const S=new Pv("Particle system"),v=new SD("Update position");v.output.connectTo(S.particle);const D=new Qv("Position");D.contextualValue=Gv.Position;const z=new Qv("Scaled direction");z.contextualValue=Gv.ScaledDirection;const e=new vD("Add");e.operation=jv.Add,D.output.connectTo(e.left),z.output.connectTo(e.right),e.output.connectTo(v.position);const N=new zD("Create particle"),m=new DD("Box shape");N.particle.connectTo(m.particle),m.output.connectTo(v.particle);const B=new Lv("Texture");B.texture.connectTo(S.texture),B.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(S)}removeBlock(S){const v=this.attachedBlocks.indexOf(S);if(v>-1&&this.attachedBlocks.splice(v,1),S.isSystem){const v=this._systemBlocks.indexOf(S);v>-1&&this._systemBlocks.splice(v,1)}}parseSerializedObject(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v||this.clear();const D={};for(const z of S.jh){const S=(0,B.e)(z.customType);if(S){const v=new S;v._deserialize(z),D[z.id]=v,this.attachedBlocks.push(v),v.isSystem&&this._systemBlocks.push(v)}}for(const z of this.attachedBlocks)if(z.isTeleportOut){const S=z,v=S._tempEntryPointUniqueId;if(v){const z=D[v];z&&z.attachToEndpoint(S)}}for(let z=0;z<S.jh.length;z++){const e=S.jh[z],N=D[e.id];N&&(N.inputs.length&&e.inputs.some((S=>S.targetConnectionName))&&!v||this._restoreConnections(N,S,D))}if(S.locations||S.editorData&&S.editorData.locations){const z=S.locations||S.editorData.locations;for(const S of z)D[S.YD]&&(S.YD=D[S.YD].uniqueId);v&&this.editorData&&this.editorData.locations&&z.concat(this.editorData.locations),S.locations?this.editorData={locations:z}:(this.editorData=S.editorData,this.editorData.locations=z);const e=[];for(const S in D)e[S]=D[S].uniqueId;this.editorData.map=e}this.comment=S.comment}_restoreConnections(S,v,D){for(const z of S.outputs)for(const e of v.jh){const N=D[e.id];if(N)for(const m of e.inputs)if(D[m.targetBlockId]!==S||m.targetConnectionName!==z.name);else{const S=N.getInputByName(m.inputName);if(!S||S.isConnected)continue;z.connectTo(S,!0),this._restoreConnections(N,v,D)}}}serialize(S){const v=S?{}:a.b.Serialize(this);v.editorData=JSON.parse(JSON.stringify(this.editorData));let D=[];S?D=S:v.customType="BABYLON.NodeParticleSystemSet",v.jh=[];for(const z of D)v.jh.push(z.serialize());if(!S)for(const z of this.attachedBlocks)-1===D.indexOf(z)&&v.jh.push(z.serialize());return v}dispose(){for(const S of this.attachedBlocks)S.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(S){const v=new eD(S);return v.setToDefault(),v}static Parse(S){const v=a.b.Parse((()=>new eD(S.name)),S,null);return v.parseSerializedObject(S),v}static ParseFromSnippetAsync(S,v){return"_BLANK"===S?Promise.resolve(eD.CreateDefault("blank")):new Promise(((D,z)=>{const e=new Wv.c;e.addEventListener("readystatechange",(()=>{if(4==e.readyState)if(200==e.status){const m=JSON.parse(JSON.parse(e.responseText).jsonPayload),B=JSON.parse(m.nodeParticle);v||(v=a.b.Parse((()=>new eD(S)),B,null)),v.parseSerializedObject(B),v.snippetId=S;try{D(v)}catch(N){z(N)}}else z("Unable to load the snippet "+S)})),e.open("GET",this.SnippetUrl+"/"+S.replace(/#/g,"/")),e.send()}))}}eD.EditorURL=`${sv.Tools._DefaultCdnUrl}/v${CS.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,eD.SnippetUrl="https://snippet.babylonjs.com",(0,t.b)([(0,X.L)()],eD.prototype,"name",void 0),(0,t.b)([(0,X.L)("comment")],eD.prototype,"comment",void 0),function(S){S[S.None=0]="None",S[S.PerParticle=1]="PerParticle",S[S.PerSystem=2]="PerSystem"}(Vv||(Vv={}));class ND extends fv{constructor(S){super(S),this._currentLockId=-2,this.lockMode=Vv.PerParticle,this.registerInput("min",cv.AutoDetect,!0,0),this.registerInput("max",cv.AutoDetect,!0,1),this.registerOutput("output",cv.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cv.Float|cv.Int|cv.Vector2|cv.Rv|cv.Ge),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(cv.Float|cv.Int|cv.Vector2|cv.Rv|cv.Ge),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=cv.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let S=null;switch(this._currentLockId=-2,this.min.type){case cv.AutoDetect:case cv.Int:case cv.Float:S=S=>{const v=this.min.getConnectedValue(S)||0,D=this.max.getConnectedValue(S)||1;return v+Math.random()*(D-v)};break;case cv.Vector2:S=S=>{const v=this.min.getConnectedValue(S)||z.Vector2.Zero(),D=this.max.getConnectedValue(S)||z.Vector2.One();return new z.Vector2(v.x+Math.random()*(D.x-v.x),v.y+Math.random()*(D.y-v.y))};break;case cv.Rv:S=S=>{const v=this.min.getConnectedValue(S)||z.Rv.Zero(),D=this.max.getConnectedValue(S)||z.Rv.One();return new z.Rv(v.x+Math.random()*(D.x-v.x),v.y+Math.random()*(D.y-v.y),v.z+Math.random()*(D.z-v.z))};break;case cv.Ge:S=S=>{const v=this.min.getConnectedValue(S)||new m.Ge(0,0,0,0),D=this.max.getConnectedValue(S)||new m.Ge(1,1,1,1);return new m.Ge(v.x+Math.random()*(D.x-v.x),v.y+Math.random()*(D.y-v.y),v.z+Math.random()*(D.z-v.z),v.w+Math.random()*(D.w-v.w))}}this.output._storedFunction=v=>{var D;let z=0;switch(this.lockMode){case Vv.PerParticle:z=(null===(D=v.particleContext)||void 0===D?void 0:D.id)||-1;break;case Vv.PerSystem:z=v.buildId||0}return this._currentLockId!==z&&(this.lockMode!==Vv.None&&(this._currentLockId=z),this.output._storedValue=S(v)),this.output._storedValue}}serialize(){const S=super.serialize();return S.lockMode=this.lockMode,S}_deserialize(S){super._deserialize(S),this.lockMode=S.lockMode}}(0,t.b)([Cv("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Vv.None},{label:"Per particle",value:Vv.PerParticle},{label:"Per system",value:Vv.PerSystem}]})],ND.prototype,"lockMode",void 0),(0,B.f)("BABYLON.ParticleRandomBlock",ND);class mD extends fv{constructor(S){super(S),this._currentLockId=-2,this.lockMode=Vv.PerParticle,this.registerInput("min",cv.AutoDetect),this.registerInput("max",cv.AutoDetect),this.registerOutput("output",cv.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const v=[cv.Matrix,cv.Particle,cv.Texture,cv.System,cv.FloatGradient,cv.Color4Gradient,cv.Vector2Gradient,cv.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...v),this.max.excludedConnectionPointTypes.push(...v)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let S=null;switch(this._currentLockId=-2,this.min.type){case cv.Float:case cv.Int:S=S=>{const v=this.min.getConnectedValue(S),D=this.max.getConnectedValue(S);return Math.random()*(D-v)+v};break;case cv.Vector2:S=S=>{const v=this.min.getConnectedValue(S),D=this.max.getConnectedValue(S);return new z.Vector2(Math.random()*(D.x-v.x)+v.x,Math.random()*(D.y-v.y)+v.y)};break;case cv.Rv:S=S=>{const v=this.min.getConnectedValue(S),D=this.max.getConnectedValue(S);return new z.Rv(Math.random()*(D.x-v.x)+v.x,Math.random()*(D.y-v.y)+v.y,Math.random()*(D.z-v.z)+v.z)};break;case cv.Ge:S=S=>{const v=this.min.getConnectedValue(S),D=this.max.getConnectedValue(S);return new m.Ge(Math.random()*(D.r-v.r)+v.r,Math.random()*(D.g-v.g)+v.g,Math.random()*(D.b-v.b)+v.b,Math.random()*(D.a-v.a)+v.a)}}this.output._storedFunction=v=>{var D;let z=0;switch(this.lockMode){case Vv.PerParticle:z=(null===(D=v.particleContext)||void 0===D?void 0:D.id)||-1;break;case Vv.PerSystem:z=v.buildId||0}return this._currentLockId!==z&&(this.lockMode!==Vv.None&&(this._currentLockId=z),this.output._storedValue=S(v)),this.output._storedValue}}serialize(){const S=super.serialize();return S.lockMode=this.lockMode,S}_deserialize(S){super._deserialize(S),void 0!==S.lockMode&&(this.lockMode=S.lockMode)}}(0,t.b)([Cv("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Vv.None},{label:"Per particle",value:Vv.PerParticle},{label:"Per system",value:Vv.PerSystem}]})],mD.prototype,"lockMode",void 0),(0,B.f)("BABYLON.RandomRangeBlock",mD);(0,B.f)("BABYLON.ParticleLerpBlock",class extends fv{constructor(S){super(S),this.registerInput("left",cv.AutoDetect),this.registerInput("right",cv.AutoDetect),this.registerInput("gradient",cv.Float,!0,0,0,1),this.registerOutput("output",cv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cv.Float|cv.Int|cv.Vector2|cv.Rv|cv.Ge)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const S=(S,v,D)=>(1-S)*v+S*D;this.output._storedFunction=v=>{const D=this.left.getConnectedValue(v),e=this.right.getConnectedValue(v),N=this.gradient.getConnectedValue(v);switch(this.left.type){case cv.Int:case cv.Float:return S(N,D,e);case cv.Vector2:return new z.Vector2(S(N,D.x,e.x),S(N,D.y,e.y));case cv.Rv:return new z.Rv(S(N,D.x,e.x),S(N,D.y,e.y),S(N,D.z,e.z));case cv.Ge:return new m.Ge(S(N,D.r,e.r),S(N,D.g,e.g),S(N,D.b,e.b),S(N,D.a,e.a))}return 0}}});(0,B.f)("BABYLON.UpdateDirectionBlock",class extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerInput("direction",cv.Rv),this.registerOutput("output",cv.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(S){const v=this.particle.getConnectedValue(S);if(this.output._storedValue=v,!this.direction.isConnected)return;const D={process:D=>{S.particleContext=D,S.systemContext=v,D.direction.N(this.direction.getConnectedValue(S))},previousItem:null,nextItem:null};v._updateQueueStart?YS(D,v._updateQueueStart):v._updateQueueStart=D}});(0,B.f)("BABYLON.UpdateColorBlock",class extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerInput("color",cv.Ge),this.registerOutput("output",cv.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(S){const v=this.particle.getConnectedValue(S);if(this.output._storedValue=v,!this.color.isConnected)return;const D={process:D=>{S.particleContext=D,S.systemContext=v,D.color.N(this.color.getConnectedValue(S))},previousItem:null,nextItem:null};v._updateQueueStart?YS(D,v._updateQueueStart):v._updateQueueStart=D}});(0,B.f)("BABYLON.UpdateScaleBlock",class extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerInput("scale",cv.Vector2),this.registerOutput("output",cv.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(S){const v=this.particle.getConnectedValue(S);if(this.output._storedValue=v,!this.scale.isConnected)return;const D={process:D=>{S.particleContext=D,S.systemContext=v,D.scale.N(this.scale.getConnectedValue(S))},previousItem:null,nextItem:null};v._updateQueueStart?YS(D,v._updateQueueStart):v._updateQueueStart=D}});(0,B.f)("BABYLON.UpdateAngleBlock",class extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerInput("angle",cv.Float),this.registerOutput("output",cv.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(S){const v=this.particle.getConnectedValue(S);if(this.output._storedValue=v,!this.angle.isConnected)return;const D={process:D=>{S.particleContext=D,S.systemContext=v,D.angle=this.angle.getConnectedValue(S)},previousItem:null,nextItem:null};v._updateQueueStart?YS(D,v._updateQueueStart):v._updateQueueStart=D}});(0,B.f)("BABYLON.BasicPositionUpdateBlock",class extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerOutput("output",cv.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(S){const v=this.particle.getConnectedValue(S),D={process:D=>{S.particleContext=D,S.systemContext=v,D.direction.scaleToRef(v._directionScale,v._scaledDirection),D.position.addInPlace(v._scaledDirection)},previousItem:null,nextItem:null};v._updateQueueStart?YS(D,v._updateQueueStart):v._updateQueueStart=D,this.output._storedValue=v}});(0,B.f)("BABYLON.BasicSpriteUpdateBlock",class extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerOutput("output",cv.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(S){const v=this.particle.getConnectedValue(S),D={process:D=>{S.particleContext=D,S.systemContext=v,D.updateCellIndex()},previousItem:null,nextItem:null};v._updateQueueStart?YS(D,v._updateQueueStart):v._updateQueueStart=D,this.output._storedValue=v}});(0,B.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerInput("cellIndex",cv.Int),this.registerOutput("output",cv.Particle),this.cellIndex.acceptedConnectionPointTypes=[cv.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(S){const v=this.particle.getConnectedValue(S);if(this.output._storedValue=v,!this.cellIndex.isConnected)return;const D={process:D=>{S.particleContext=D,S.systemContext=v,D.cellIndex=Math.floor(this.cellIndex.getConnectedValue(S))},previousItem:null,nextItem:null};v._updateQueueStart?YS(D,v._updateQueueStart):v._updateQueueStart=D}});class BD extends fv{constructor(S){super(S),this.strength=1,this.registerInput("particle",cv.Particle),this.registerInput("flowMap",cv.Texture),this.registerOutput("output",cv.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(S){var v;const D=this.particle.getConnectedValue(S),z=S.Iv;let e;(null===(v=this.flowMap.connectedPoint)||void 0===v?void 0:v.ownerBlock).extractTextureContentAsync().then((S=>{S&&(e=new Mv(S.width,S.height,S.data))}));const N={process:S=>{const v=z.getTransformMatrix();e&&e._processParticle(S,this.strength*D._tempScaledUpdateSpeed,v)},previousItem:null,nextItem:null};D._updateQueueStart?YS(N,D._updateQueueStart):D._updateQueueStart=N,this.output._storedValue=D}serialize(){const S=super.serialize();return S.strength=this.strength,S}_deserialize(S){super._deserialize(S),this.strength=S.strength}}(0,t.b)([Cv("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BD.prototype,"strength",void 0),(0,B.f)("BABYLON.UpdateFlowMapBlock",BD);(0,B.f)("BABYLON.SphereShapeBlock",class extends fv{constructor(S){super(S),this.registerInput("input",cv.Particle),this.registerInput("radius",cv.Float,!0,1),this.registerInput("radiusRange",cv.Float,!0,1,0,1),this.registerInput("directionRandomizer",cv.Float,!0,0,0,1),this.registerOutput("output",cv.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(S){const v=this.input.getConnectedValue(S);v._directionCreation.process=D=>{S.particleContext=D,S.systemContext=v;const e=this.directionRandomizer.getConnectedValue(S),N=D.position.Ov(S.emitterPosition).normalize(),m=(0,E.RandomRange)(0,e),B=(0,E.RandomRange)(0,e),g=(0,E.RandomRange)(0,e);N.x+=m,N.y+=B,N.z+=g,N.normalize(),S.isEmitterTransformNode?z.Rv.TransformNormalFromFloatsToRef(m,B,g,S.emitterWorldMatrix,D.direction):D.direction.oe(m,B,g)},v._positionCreation.process=D=>{S.particleContext=D,S.systemContext=v;const e=this.radius.getConnectedValue(S),N=this.radiusRange.getConnectedValue(S),m=e-(0,E.RandomRange)(0,e*N),B=(0,E.RandomRange)(0,1),g=(0,E.RandomRange)(0,2*Math.PI),h=Math.acos(2*B-1),A=m*Math.cos(g)*Math.sin(h),w=m*Math.cos(h),n=m*Math.sin(g)*Math.sin(h);S.isEmitterTransformNode?z.Rv.TransformCoordinatesFromFloatsToRef(A,w,n,S.emitterWorldMatrix,D.position):(D.position.oe(A,w,n),D.position.addInPlace(S.emitterPosition))},this.output._storedValue=v}});(0,B.f)("BABYLON.PointShapeBlock",class extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerInput("direction1",cv.Rv,!0,new z.Rv(0,1,0)),this.registerInput("direction2",cv.Rv,!0,new z.Rv(0,1,0)),this.registerOutput("output",cv.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(S){const v=this.particle.getConnectedValue(S);v._directionCreation.process=D=>{S.particleContext=D,S.systemContext=v;const e=this.direction1.getConnectedValue(S),N=this.direction2.getConnectedValue(S),m=(0,E.RandomRange)(e.x,N.x),B=(0,E.RandomRange)(e.y,N.y),g=(0,E.RandomRange)(e.z,N.z);S.isEmitterTransformNode?z.Rv.TransformNormalFromFloatsToRef(m,B,g,S.emitterWorldMatrix,D.direction):D.direction.oe(m,B,g)},v._positionCreation.process=D=>{S.systemContext=v,S.isEmitterTransformNode?z.Rv.TransformCoordinatesFromFloatsToRef(0,0,0,S.emitterWorldMatrix,D.position):D.position.N(S.emitterPosition)},this.output._storedValue=v}});(0,B.f)("BABYLON.CustomShapeBlock",class extends fv{constructor(S){super(S),this.registerInput("particle",cv.Particle),this.registerInput("position",cv.Rv,!0,new z.Rv(0,0,0)),this.registerInput("direction",cv.Rv,!0,new z.Rv(0,1,0)),this.registerOutput("output",cv.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(S){const v=this.particle.getConnectedValue(S);v._directionCreation.process=D=>{S.particleContext=D,S.systemContext=v;const e=this.direction.getConnectedValue(S);S.isEmitterTransformNode?z.Rv.TransformNormalToRef(e,S.emitterWorldMatrix,D.direction):D.direction.N(e)},v._positionCreation.process=D=>{S.particleContext=D,S.systemContext=v;const e=this.position.getConnectedValue(S);S.isEmitterTransformNode?z.Rv.TransformCoordinatesToRef(e,S.emitterWorldMatrix,D.position):(D.position.N(e),D.position.addInPlace(S.emitterPosition))},this.output._storedValue=v}});(0,B.f)("BABYLON.CylinderShapeBlock",class extends fv{constructor(S){super(S),this._tempVector=z.Rv.Zero(),this.registerInput("particle",cv.Particle),this.registerInput("radius",cv.Float,!0,1),this.registerInput("height",cv.Float,!0,1,0),this.registerInput("radiusRange",cv.Float,!0,1,0,1),this.registerInput("directionRandomizer",cv.Float,!0,0,0,1),this.registerOutput("output",cv.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(S){const v=this.particle.getConnectedValue(S);v._directionCreation.process=D=>{S.particleContext=D,S.systemContext=v;const e=this.directionRandomizer.getConnectedValue(S);D.position.subtractToRef(S.emitterPosition,this._tempVector),this._tempVector.normalize(),S.isEmitterTransformNode&&z.Rv.TransformNormalToRef(this._tempVector,S.emitterInverseWorldMatrix,this._tempVector);const N=(0,E.RandomRange)(-e/2,e/2);let m=Math.atan2(this._tempVector.x,this._tempVector.z);m+=(0,E.RandomRange)(-Math.PI/2,Math.PI/2)*e,this._tempVector.y=N,this._tempVector.x=Math.sin(m),this._tempVector.z=Math.cos(m),this._tempVector.normalize(),S.isEmitterTransformNode?z.Rv.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,S.emitterWorldMatrix,D.direction):D.direction.N(this._tempVector)},v._positionCreation.process=D=>{S.particleContext=D,S.systemContext=v;const e=this.height.getConnectedValue(S),N=this.radiusRange.getConnectedValue(S),m=this.radius.getConnectedValue(S),B=(0,E.RandomRange)(-e/2,e/2),g=(0,E.RandomRange)(0,2*Math.PI),h=(0,E.RandomRange)((1-N)*(1-N),1),A=Math.sqrt(h)*m,w=A*Math.cos(g),n=A*Math.sin(g);S.isEmitterTransformNode?z.Rv.TransformCoordinatesFromFloatsToRef(w,B,n,S.emitterWorldMatrix,D.position):(D.position.oe(w,B,n),D.position.addInPlace(S.emitterPosition))},this.output._storedValue=v}});class gD extends fv{constructor(S){super(S),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",cv.Particle),this.registerOutput("output",cv.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(S){super._build(S);const v=this.particle.getConnectedValue(S);v._isAnimationSheetEnabled=!0,v.spriteCellWidth=this.width,v.spriteCellHeight=this.height,v.startSpriteCellID=this.start,v.endSpriteCellID=this.end,v.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=v}serialize(){const S=super.serialize();return S.width=this.width,S.height=this.height,S.start=this.start,S.end=this.end,S.randomStartCell=this.randomStartCell,S}_deserialize(S){super._deserialize(S),this.width=S.width,this.height=S.height,this.start=S.start,this.end=S.end,this.randomStartCell=S.randomStartCell}}(0,t.b)([Cv("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gD.prototype,"start",void 0),(0,t.b)([Cv("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gD.prototype,"end",void 0),(0,t.b)([Cv("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gD.prototype,"width",void 0),(0,t.b)([Cv("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gD.prototype,"height",void 0),(0,t.b)([Cv("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],gD.prototype,"loop",void 0),(0,t.b)([Cv("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],gD.prototype,"randomStartCell",void 0),(0,B.f)("BABYLON.SetupSpriteSheetBlock",gD);class ED extends fv{constructor(S){super(S),this.reference=0,this.registerInput("value",cv.AutoDetect),this.registerOutput("output",cv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=S=>{switch(S){case cv.Float:return cv.FloatGradient;case cv.Vector2:return cv.Vector2Gradient;case cv.Rv:return cv.Vector3Gradient;case cv.Ge:return cv.Color4Gradient}return S},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cv.Float|cv.Vector2|cv.Rv|cv.Ge)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=S=>null}serialize(){const S=super.serialize();return S.reference=this.reference,S}_deserialize(S){super._deserialize(S),this.reference=S.reference}}(0,t.b)([Cv("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],ED.prototype,"reference",void 0),(0,B.f)("BABYLON.ParticleGradientValueBlock",ED);(0,B.f)("BABYLON.ParticleGradientBlock",class extends fv{constructor(S){super(S),this._entryCount=1,this.registerInput("gradient",cv.Float,!0,1,0,1),this.registerInput("value0",cv.AutoDetect),this.registerOutput("output",cv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=S=>{switch(S){case cv.FloatGradient:return cv.Float;case cv.Vector2Gradient:return cv.Vector2;case cv.Vector3Gradient:return cv.Rv;case cv.Color4Gradient:return cv.Ge}return S},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(cv.FloatGradient|cv.Vector2Gradient|cv.Vector3Gradient|cv.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(S){this._inputs[S].onConnectionObservable.add((()=>{this._entryCount>S||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),cv.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const S=[];for(let D=1;D<this._inputs.length;D++){var v;if(this._inputs[D].isConnected)S.push(null===(v=this._inputs[D].connectedPoint)||void 0===v?void 0:v.ownerBlock)}S.sort(((S,v)=>S.reference-v.reference)),this.output._storedFunction=v=>{const D=this.gradient.getConnectedValue(v);if(1===S.length)return S[0].value.getConnectedValue(v);let e=null;for(let N=S.length-1;N>=0;N--){const B=S[N];if(B.reference<=D){const S=B.value.getConnectedValue(v);if(e){const N=e.value.getConnectedValue(v),g=e.reference,h=B.reference,A=Math.max(0,Math.min(1,(D-h)/(g-h)));switch(this.output.type){case cv.Float:return(0,E.Lerp)(S,N,A);case cv.Vector2:return z.Vector2.Lerp(S,N,A);case cv.Rv:return z.Rv.Lerp(S,N,A);case cv.Ge:return m.Ge.Lerp(S,N,A)}}return S}e=B}return 0}}});(0,B.f)("BABYLON.ParticleConverterBlock",class extends fv{constructor(S){super(S),this.registerInput("color ",cv.Ge,!0),this.registerInput("xyz ",cv.Rv,!0),this.registerInput("xy ",cv.Vector2,!0),this.registerInput("zw ",cv.Vector2,!0),this.registerInput("x ",cv.Float,!0),this.registerInput("y ",cv.Float,!0),this.registerInput("z ",cv.Float,!0),this.registerInput("w ",cv.Float,!0),this.registerOutput("color",cv.Ge),this.registerOutput("xyz",cv.Rv),this.registerOutput("xy",cv.Vector2),this.registerOutput("zw",cv.Vector2),this.registerOutput("x",cv.Float),this.registerOutput("y",cv.Float),this.registerOutput("z",cv.Float),this.registerOutput("w",cv.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(S){return"color "===S?"colorIn":"xyz "===S?"xyzIn":"xy "===S?"xyIn":"zw "===S?"zwIn":"x "===S?"xIn":"y "===S?"yIn":"z "===S?"zIn":"w "===S?"wIn":S}_outputRename(S){switch(S){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return S}}_build(S){super._build(S);const v=this.xIn,D=this.yIn,e=this.zIn,N=this.wIn,B=this.xyIn,g=this.zwIn,E=this.xyzIn,h=this.colorIn,A=this.colorOut,w=this.xyzOut,n=this.xyOut,R=this.zwOut,O=this.xOut,I=this.yOut,K=this.zOut,q=this.wOut,u=S=>{if(h.isConnected)return h.getConnectedValue(S);let z=0,A=0,w=0,n=0;if(v.isConnected&&(z=v.getConnectedValue(S)),D.isConnected&&(A=D.getConnectedValue(S)),e.isConnected&&(w=e.getConnectedValue(S)),N.isConnected&&(n=N.getConnectedValue(S)),B.isConnected){const v=B.getConnectedValue(S);v&&(z=v.x,A=v.y)}if(g.isConnected){const v=g.getConnectedValue(S);v&&(w=v.x,n=v.y)}if(E.isConnected){const v=E.getConnectedValue(S);v&&(z=v.x,A=v.y,w=v.z)}return new m.Ge(z,A,w,n)};A._storedFunction=S=>u(S),w._storedFunction=S=>{const v=u(S);return new z.Rv(v.r,v.g,v.b)},n._storedFunction=S=>{const v=u(S);return new z.Vector2(v.r,v.g)},R._storedFunction=S=>{const v=u(S);return new z.Vector2(v.b,v.a)},O._storedFunction=S=>u(S).r,I._storedFunction=S=>u(S).g,K._storedFunction=S=>u(S).b,q._storedFunction=S=>u(S).a}}),function(S){S[S.Cos=0]="Cos",S[S.Sin=1]="Sin",S[S.Abs=2]="Abs",S[S.Exp=3]="Exp",S[S.Exp2=4]="Exp2",S[S.Round=5]="Round",S[S.Floor=6]="Floor",S[S.Ceiling=7]="Ceiling",S[S.Sqrt=8]="Sqrt",S[S.Log=9]="Log",S[S.Tan=10]="Tan",S[S.ArcTan=11]="ArcTan",S[S.ArcCos=12]="ArcCos",S[S.ArcSin=13]="ArcSin",S[S.Sign=14]="Sign",S[S.Negate=15]="Negate",S[S.OneMinus=16]="OneMinus",S[S.Reciprocal=17]="Reciprocal",S[S.ToDegrees=18]="ToDegrees",S[S.ToRadians=19]="ToRadians",S[S.Fract=20]="Fract"}(Uv||(Uv={}));class hD extends fv{constructor(S){super(S),this.operation=Uv.Cos,this.registerInput("input",cv.AutoDetect),this.registerOutput("output",cv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cv.Float|cv.Int|cv.Vector2|cv.Rv|cv.Ge)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(S){super._build(S);let v=null;switch(this.operation){case Uv.Cos:v=S=>Math.cos(S);break;case Uv.Sin:v=S=>Math.sin(S);break;case Uv.Abs:v=S=>Math.abs(S);break;case Uv.Exp:v=S=>Math.exp(S);break;case Uv.Exp2:v=S=>Math.pow(2,S);break;case Uv.Round:v=S=>Math.round(S);break;case Uv.Floor:v=S=>Math.floor(S);break;case Uv.Ceiling:v=S=>Math.ceil(S);break;case Uv.Sqrt:v=S=>Math.sqrt(S);break;case Uv.Log:v=S=>Math.log(S);break;case Uv.Tan:v=S=>Math.tan(S);break;case Uv.ArcTan:v=S=>Math.atan(S);break;case Uv.ArcCos:v=S=>Math.acos(S);break;case Uv.ArcSin:v=S=>Math.asin(S);break;case Uv.Sign:v=S=>Math.sign(S);break;case Uv.Negate:v=S=>-S;break;case Uv.OneMinus:v=S=>1-S;break;case Uv.Reciprocal:v=S=>1/S;break;case Uv.ToRadians:v=S=>S*Math.PI/180;break;case Uv.ToDegrees:v=S=>180*S/Math.PI;break;case Uv.Fract:v=S=>S>=0?S-Math.floor(S):S-Math.ceil(S)}if(!v)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case cv.Int:case cv.Float:this.output._storedFunction=S=>{const D=this.input.getConnectedValue(S);return v(D)};break;case cv.Vector2:this.output._storedFunction=S=>{const D=this.input.getConnectedValue(S);return new z.Vector2(v(D.x),v(D.y))};break;case cv.Rv:this.output._storedFunction=S=>{const D=this.input.getConnectedValue(S);return new z.Rv(v(D.x),v(D.y),v(D.z))};break;case cv.Ge:this.output._storedFunction=S=>{const D=this.input.getConnectedValue(S);return new m.Ge(v(D.r),v(D.g),v(D.b),v(D.a))}}return this}serialize(){const S=super.serialize();return S.operation=this.operation,S}_deserialize(S){super._deserialize(S),this.operation=S.operation}}(0,t.b)([Cv("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Uv.Cos},{label:"Sin",value:Uv.Sin},{label:"Abs",value:Uv.Abs},{label:"Exp",value:Uv.Exp},{label:"Exp2",value:Uv.Exp2},{label:"Round",value:Uv.Round},{label:"Floor",value:Uv.Floor},{label:"Ceiling",value:Uv.Ceiling},{label:"Sqrt",value:Uv.Sqrt},{label:"Log",value:Uv.Log},{label:"Tan",value:Uv.Tan},{label:"ArcTan",value:Uv.ArcTan},{label:"ArcCos",value:Uv.ArcCos},{label:"ArcSin",value:Uv.ArcSin},{label:"Sign",value:Uv.Sign},{label:"Negate",value:Uv.Negate},{label:"OneMinus",value:Uv.OneMinus},{label:"Reciprocal",value:Uv.Reciprocal},{label:"ToDegrees",value:Uv.ToDegrees},{label:"ToRadians",value:Uv.ToRadians},{label:"Fract",value:Uv.Fract}]})],hD.prototype,"operation",void 0),(0,B.f)("BABYLON.ParticleTrigonometryBlock",hD);var AD,wD=D(12796);class nD extends fv{constructor(S){super(S),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",cv.AutoDetect),this.registerOutput("output",cv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(cv.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(cv.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(cv.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(cv.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(cv.System),this._inputs[0].excludedConnectionPointTypes.push(cv.Particle),this._inputs[0].excludedConnectionPointTypes.push(cv.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(S){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const v=S=>{const v=this.input.getConnectedValue(S);if(this.log.length>=this.stackSize)return v;if(null===v||void 0===v)return this.log.push(["null",""]),v;switch(this.input.type){case cv.Vector2:this.log.push([(0,wD.h)(v,4),v.toString()]);break;case cv.Rv:this.log.push([(0,wD.j)(v,4),v.toString()]);break;case cv.Ge:this.log.push([`{R: ${v.r.toFixed(4)} G: ${v.g.toFixed(4)} B: ${v.b.toFixed(4)} A: ${v.a.toFixed(4)}}`,v.toString()]);break;default:this.log.push([v.toString(),v.toString()])}return v};this.output.isConnected?this.output._storedFunction=v:this.output._storedValue=v(S)}serialize(){const S=super.serialize();return S.stackSize=this.stackSize,S}_deserialize(S){super._deserialize(S),this.stackSize=S.stackSize}}(0,t.b)([Cv("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],nD.prototype,"stackSize",void 0),(0,B.f)("BABYLON.ParticleDebugBlock",nD);(0,B.f)("BABYLON.ParticleElbowBlock",class extends fv{constructor(S){super(S),this.registerInput("input",cv.AutoDetect),this.registerOutput("output",cv.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(S){super._build(S);const v=this._outputs[0],D=this._inputs[0];v._storedFunction=S=>D.getConnectedValue(S)}});(0,B.f)("BABYLON.ParticleTeleportInBlock",class extends fv{get endpoints(){return this._endpoints}constructor(S){super(S),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",cv.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(S){if(this.getClassName()===S)return!0;for(const v of this.endpoints)if(v.isAnAncestorOfType(S))return!0;return!1}isAnAncestorOf(S){for(const v of this.endpoints){if(v===S)return!0;if(v.isAnAncestorOf(S))return!0}return!1}attachToEndpoint(S){S.detach(),this._endpoints.push(S),S._entryPoint=this,S._outputs[0]._typeConnectionSource=this._inputs[0],S._tempEntryPointUniqueId=null,S.name="> "+this.name}detachFromEndpoint(S){const v=this._endpoints.indexOf(S);-1!==v&&(this._endpoints.splice(v,1),S._outputs[0]._typeConnectionSource=null,S._entryPoint=null)}_build(){for(const S of this._endpoints)S.output._storedFunction=S=>this.input.getConnectedValue(S)}});(0,B.f)("BABYLON.ParticleTeleportOutBlock",class extends fv{constructor(S){super(S),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",cv.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(S){this.entryPoint&&this.entryPoint.build(S)}clone(){const S=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(S),S}serialize(){var S;const v=super.serialize();return v.entryPoint=(null===(S=this.entryPoint)||void 0===S?void 0:S.uniqueId)??"",v}_deserialize(S){super._deserialize(S),this._tempEntryPointUniqueId=S.entryPoint}}),function(S){S[S.Equal=0]="Equal",S[S.NotEqual=1]="NotEqual",S[S.LessThan=2]="LessThan",S[S.GreaterThan=3]="GreaterThan",S[S.LessOrEqual=4]="LessOrEqual",S[S.GreaterOrEqual=5]="GreaterOrEqual",S[S.Xor=6]="Xor",S[S.Or=7]="Or",S[S.And=8]="And"}(AD||(AD={}));class RD extends fv{constructor(S){super(S),this.test=AD.Equal,this.epsilon=0,this.registerInput("left",cv.Float),this.registerInput("right",cv.Float,!0,0),this.registerInput("ifTrue",cv.AutoDetect,!0,1),this.registerInput("ifFalse",cv.AutoDetect,!0,0),this.registerOutput("output",cv.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=cv.Float,this._inputs[0].acceptedConnectionPointTypes.push(cv.Int),this._inputs[1].acceptedConnectionPointTypes.push(cv.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const S=S=>{const v=this.left.getConnectedValue(S),D=this.right.getConnectedValue(S);let z=!1;switch(this.test){case AD.Equal:z=(0,E.WithinEpsilon)(v,D,this.epsilon);break;case AD.NotEqual:z=!(0,E.WithinEpsilon)(v,D,this.epsilon);break;case AD.LessThan:z=v<D+this.epsilon;break;case AD.GreaterThan:z=v>D-this.epsilon;break;case AD.LessOrEqual:z=v<=D+this.epsilon;break;case AD.GreaterOrEqual:z=v>=D-this.epsilon;break;case AD.Xor:z=!!v&&!D||!v&&!!D;break;case AD.Or:z=!!v||!!D;break;case AD.And:z=!!v&&!!D}return z};this.output._storedFunction=v=>S(v)?this.ifTrue.getConnectedValue(v):this.ifFalse.getConnectedValue(v)}serialize(){const S=super.serialize();return S.test=this.test,S.epsilon=this.epsilon,S}_deserialize(S){super._deserialize(S),this.test=S.test,void 0!==S.epsilon&&(this.epsilon=S.epsilon)}}(0,t.b)([Cv("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:AD.Equal},{label:"NotEqual",value:AD.NotEqual},{label:"LessThan",value:AD.LessThan},{label:"GreaterThan",value:AD.GreaterThan},{label:"LessOrEqual",value:AD.LessOrEqual},{label:"GreaterOrEqual",value:AD.GreaterOrEqual},{label:"Xor",value:AD.Xor},{label:"Or",value:AD.Or},{label:"And",value:AD.And}]})],RD.prototype,"test",void 0),(0,t.b)([Cv("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],RD.prototype,"epsilon",void 0),(0,B.f)("BABYLON.ParticleConditionBlock",RD);class OD extends fv{constructor(S){super(S),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",cv.Particle),this.registerInput("condition",cv.Float,!0,0),this.registerInput("system",cv.System),this.registerOutput("output",cv.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(S){this._triggerCount=0;const v=this.input.getConnectedValue(S),D={process:D=>{if(S.particleContext=D,S.systemContext=v,0!==this.condition.getConnectedValue(S)&&(0===this.limit||this._triggerCount<this.limit)){const z=(new Date).getTime();if(this._previousOne&&z-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=z;const e=this.system.getConnectedValue(S);if(e){const z=lv(e,S.Iv,D.position);z.Se.addOnce((()=>{this._triggerCount--})),v.Se.addOnce((()=>{z.dispose()}))}}},previousItem:null,nextItem:null};v._updateQueueStart?YS(D,v._updateQueueStart):v._updateQueueStart=D,this.output._storedValue=v}serialize(){const S=super.serialize();return S.limit=this.limit,S.delay=this.delay,S}_deserialize(S){super._deserialize(S),void 0!==S.limit&&(this.limit=S.limit),void 0!==S.delay&&(this.delay=S.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,t.b)([Cv("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OD.prototype,"limit",void 0),(0,t.b)([Cv("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OD.prototype,"delay",void 0),(0,B.f)("BABYLON.ParticleTriggerBlock",OD);D(12804),D(12811),D(12821),D(12881)},12860:(S,v,D)=>{"use strict";var z=D(11280);const e="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12829:(S,v,D)=>{"use strict";var z=D(11280);const e="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12895:(S,v,D)=>{"use strict";var z=D(11280);const e="clipPlaneVertex",N="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12886:(S,v,D)=>{"use strict";var z=D(11280);const e="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12877:(S,v,D)=>{"use strict";var z=D(11280);const e="fogFragment",N="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12853:(S,v,D)=>{"use strict";var z=D(11280);const e="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12902:(S,v,D)=>{"use strict";var z=D(11280);const e="fogVertex",N="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12890:(S,v,D)=>{"use strict";var z=D(11280);const e="fogVertexDeclaration",N="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12839:(S,v,D)=>{"use strict";var z=D(11280);const e="helperFunctions",N="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12832:(S,v,D)=>{"use strict";var z=D(11280);const e="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12847:(S,v,D)=>{"use strict";var z=D(11280);const e="imageProcessingFunctions",N="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12834:(S,v,D)=>{"use strict";var z=D(11280);const e="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12868:(S,v,D)=>{"use strict";var z=D(11280);const e="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12908:(S,v,D)=>{"use strict";var z=D(11280);const e="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";z.b.IncludesShadersStoreWGSL[e]||(z.b.IncludesShadersStoreWGSL[e]=N)},12821:(S,v,D)=>{"use strict";D.r(v),D.d(v,{particlesPixelShaderWGSL:()=>m});var z=D(11280);D(12829),D(12832),D(12834),D(12839),D(12847),D(12853),D(12860),D(12868),D(12877);const e="particlesPixelShader",N="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.b.ShadersStoreWGSL[e]||(z.b.ShadersStoreWGSL[e]=N);const m={name:e,shader:N}},12881:(S,v,D)=>{"use strict";D.r(v),D.d(v,{particlesVertexShaderWGSL:()=>m});var z=D(11280);D(12886),D(12890),D(12834),D(12895),D(12902),D(12908);const e="particlesVertexShader",N="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.b.ShadersStoreWGSL[e]||(z.b.ShadersStoreWGSL[e]=N);const m={name:e,shader:N}},12741:(S,v,D)=>{"use strict";var z=D(11280);const e="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12809:(S,v,D)=>{"use strict";var z=D(11280);const e="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12765:(S,v,D)=>{"use strict";var z=D(11280);const e="clipPlaneVertex",N="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12818:(S,v,D)=>{"use strict";var z=D(11280);const e="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12751:(S,v,D)=>{"use strict";var z=D(11280);const e="fogFragment",N="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12732:(S,v,D)=>{"use strict";var z=D(11280);const e="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12769:(S,v,D)=>{"use strict";var z=D(11280);const e="fogVertex",N="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12757:(S,v,D)=>{"use strict";var z=D(11280);const e="fogVertexDeclaration",N="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12721:(S,v,D)=>{"use strict";var z=D(11280);const e="helperFunctions",N="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12708:(S,v,D)=>{"use strict";var z=D(11280);const e="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12723:(S,v,D)=>{"use strict";var z=D(11280);const e="imageProcessingFunctions",N="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12713:(S,v,D)=>{"use strict";var z=D(11280);const e="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12749:(S,v,D)=>{"use strict";var z=D(11280);const e="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12775:(S,v,D)=>{"use strict";var z=D(11280);const e="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";z.b.IncludesShadersStore[e]||(z.b.IncludesShadersStore[e]=N)},12804:(S,v,D)=>{"use strict";D.r(v),D.d(v,{particlesPixelShader:()=>m});var z=D(11280);D(12809),D(12708),D(12713),D(12721),D(12723),D(12732),D(12741),D(12749),D(12751);const e="particlesPixelShader",N="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.b.ShadersStore[e]||(z.b.ShadersStore[e]=N);const m={name:e,shader:N}},12811:(S,v,D)=>{"use strict";D.r(v),D.d(v,{particlesVertexShader:()=>m});var z=D(11280);D(12818),D(12757),D(12713),D(12765),D(12769),D(12775);const e="particlesVertexShader",N="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.b.ShadersStore[e]||(z.b.ShadersStore[e]=N);const m={name:e,shader:N}},13153:(S,v,D)=>{"use strict";D.r(v),D.d(v,{FlowGraphGLTFDataProvider:()=>N});var z=D(13123),e=D(13108);class N extends z.d{constructor(S){var v,D;super();const z=S.glTF,N=(null===(v=z.animations)||void 0===v?void 0:v.map((S=>S._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",e.d,N);const m=(null===(D=z.nodes)||void 0===D?void 0:D.map((S=>S._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",e.d,m)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13048:(S,v,D)=>{"use strict";D.d(v,{c:()=>I,g:()=>R,i:()=>n,l:()=>O});var z=D(11371),e=D(11845),N=D(11425),m=D(13055);const B=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class g{constructor(S,v){this._gltf=S,this._infoTree=v}convert(S){let v,D=this._gltf,z=this._infoTree;if(!S.startsWith("/"))throw new Error("Path must start with a /");const e=S.split("/");if(e.shift(),e[e.length-1].includes(".length")){const S=e[e.length-1].split(".");e.pop(),e.push(...S)}let N=!1;for(const g of e){const e="length"===g;if(e&&!z.__array__)throw new Error(`Path ${S} is invalid`);if(z.__ignoreObjectTree__&&(N=!0),z.__array__&&!e)z=z.__array__;else if(z=z[g],!z)throw new Error(`Path ${S} is invalid`);if(!N)if(void 0===D){if(!B.find((v=>v.regex.test(S))))throw new Error(`Path ${S} is invalid`)}else if(!e){var m;D=null===(m=D)||void 0===m?void 0:m[g]}(z.__target__||e)&&(v=D)}return{object:v,info:z}}}function E(S,v,D,z){const e=h(S,v);return z?e[D][z]:e[D]}function h(S,v,D){var z,N;return null===(z=S._data)||void 0===z||null===(N=z[(null===D||void 0===D?void 0:D.fillMode)??e.e.MATERIAL_TriangleFillMode])||void 0===N?void 0:N.babylonMaterial}function A(S,v){return{offset:{componentsCount:2,type:"Vector2",get:(D,e,N)=>{const m=E(D,N,S,v);return new z.Vector2(null===m||void 0===m?void 0:m.uOffset,null===m||void 0===m?void 0:m.vOffset)},getTarget:h,set:(D,z,e,N)=>{const m=E(z,N,S,v);m.uOffset=D.x,m.vOffset=D.y},getPropertyName:[()=>`${S}${v?"."+v:""}.uOffset`,()=>`${S}${v?"."+v:""}.vOffset`]},rotation:{type:"number",get:(D,z,e)=>{var N;return null===(N=E(D,e,S,v))||void 0===N?void 0:N.wAng},getTarget:h,set:(D,z,e,N)=>E(z,N,S,v).wAng=D,getPropertyName:[()=>`${S}${v?"."+v:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(D,e,N)=>{const m=E(D,N,S,v);return new z.Vector2(null===m||void 0===m?void 0:m.uScale,null===m||void 0===m?void 0:m.vScale)},getTarget:h,set:(D,z,e,N)=>{const m=E(z,N,S,v);m.uScale=D.x,m.vScale=D.y},getPropertyName:[()=>`${S}${v?"."+v:""}.uScale`,()=>`${S}${v?"."+v:""}.vScale`]}}}const w={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:S=>{var v,D;return new z.Vector2((null===(v=S._babylonCamera)||void 0===v?void 0:v.orthoLeft)??0,(null===(D=S._babylonCamera)||void 0===D?void 0:D.orthoRight)??0)},set:(S,v)=>{v._babylonCamera&&(v._babylonCamera.orthoLeft=S.x,v._babylonCamera.orthoRight=S.y)},getTarget:S=>S,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:S=>{var v,D;return new z.Vector2((null===(v=S._babylonCamera)||void 0===v?void 0:v.orthoBottom)??0,(null===(D=S._babylonCamera)||void 0===D?void 0:D.orthoTop)??0)},set:(S,v)=>{v._babylonCamera&&(v._babylonCamera.orthoBottom=S.x,v._babylonCamera.orthoTop=S.y)},getTarget:S=>S,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:S=>{var v;return null===(v=S._babylonCamera)||void 0===v?void 0:v.maxZ},set:(S,v)=>{v._babylonCamera&&(v._babylonCamera.maxZ=S)},getTarget:S=>S,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:S=>{var v;return null===(v=S._babylonCamera)||void 0===v?void 0:v.xe},set:(S,v)=>{v._babylonCamera&&(v._babylonCamera.xe=S)},getTarget:S=>S,getPropertyName:[()=>"xe"]}},perspective:{aspectRatio:{type:"number",get:S=>{var v;return null===(v=S._babylonCamera)||void 0===v?void 0:v.getEngine().getAspectRatio(S._babylonCamera)},getTarget:S=>S,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:S=>{var v;return null===(v=S._babylonCamera)||void 0===v?void 0:v.fov},set:(S,v)=>{v._babylonCamera&&(v._babylonCamera.fov=S)},getTarget:S=>S,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:S=>{var v;return null===(v=S._babylonCamera)||void 0===v?void 0:v.maxZ},set:(S,v)=>{v._babylonCamera&&(v._babylonCamera.maxZ=S)},getTarget:S=>S,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:S=>{var v;return null===(v=S._babylonCamera)||void 0===v?void 0:v.xe},set:(S,v)=>{v._babylonCamera&&(v._babylonCamera.xe=S)},getTarget:S=>S,getPropertyName:[()=>"xe"]}}}},nodes:{length:{type:"number",get:S=>S.length,getTarget:S=>S.map((S=>S._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Rv",get:S=>{var v;return null===(v=S._babylonTransformNode)||void 0===v?void 0:v.position},set:(S,v)=>{var D;return null===(D=v._babylonTransformNode)||void 0===D?void 0:D.position.N(S)},getTarget:S=>S._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:S=>{var v;return null===(v=S._babylonTransformNode)||void 0===v?void 0:v.rotationQuaternion},set:(S,v)=>{var D,z;return null===(D=v._babylonTransformNode)||void 0===D||null===(z=D.rotationQuaternion)||void 0===z?void 0:z.N(S)},getTarget:S=>S._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Rv",get:S=>{var v;return null===(v=S._babylonTransformNode)||void 0===v?void 0:v.Me},set:(S,v)=>{var D;return null===(D=v._babylonTransformNode)||void 0===D?void 0:D.Me.N(S)},getTarget:S=>S._babylonTransformNode,getPropertyName:[()=>"Me"]},weights:{length:{type:"number",get:S=>S._numMorphTargets,getTarget:S=>S._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(S,v)=>{var D,z;return void 0!==v?null===(D=S._primitiveBabylonMeshes)||void 0===D||null===(z=D[0].morphTargetManager)||void 0===z?void 0:z.getTarget(v).influence:void 0},getTarget:S=>S._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(S,v)=>[0],getTarget:S=>S._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:S=>{var v,D,e;return z.Matrix.Compose(null===(v=S._babylonTransformNode)||void 0===v?void 0:v.Me,null===(D=S._babylonTransformNode)||void 0===D?void 0:D.rotationQuaternion,null===(e=S._babylonTransformNode)||void 0===e?void 0:e.position)},getTarget:S=>S._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:S=>{var v,D,e,N;const m=z.Matrix.Identity();let B=S.parent;for(;B&&B.parent;)B=B.parent;const g=(null===(v=S._babylonTransformNode)||void 0===v?void 0:v.position._isDirty)||(null===(D=S._babylonTransformNode)||void 0===D||null===(e=D.rotationQuaternion)||void 0===e?void 0:e._isDirty)||(null===(N=S._babylonTransformNode)||void 0===N?void 0:N.Me._isDirty);if(B){var E;const v=null===(E=B._babylonTransformNode)||void 0===E?void 0:E.ke(!0).invert();var h,A;if(v)null===(h=S._babylonTransformNode)||void 0===h||null===(A=h.ke(g))||void 0===A||A.multiplyToRef(v,m)}else S._babylonTransformNode&&m.N(S._babylonTransformNode.ke(g));return m},getTarget:S=>S._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:S=>{var v,D;return null===(v=S._babylonTransformNode)||void 0===v||null===(D=v.getChildren((S=>S instanceof m.d),!0)[0])||void 0===D?void 0:D.le},getTarget:S=>{var v;return null===(v=S._babylonTransformNode)||void 0===v?void 0:v.getChildren((S=>S instanceof m.d),!0)[0]},set:(S,v)=>{if(v._babylonTransformNode){const D=v._babylonTransformNode.getChildren((S=>S instanceof m.d),!0)[0];D&&(D.le=S)}}},color:{type:"qv",get:S=>{var v,D;return null===(v=S._babylonTransformNode)||void 0===v||null===(D=v.getChildren((S=>S instanceof m.d),!0)[0])||void 0===D?void 0:D.sB},getTarget:S=>{var v;return null===(v=S._babylonTransformNode)||void 0===v?void 0:v.getChildren((S=>S instanceof m.d),!0)[0]},set:(S,v)=>{if(v._babylonTransformNode){const D=v._babylonTransformNode.getChildren((S=>S instanceof m.d),!0)[0];D&&(D.sB=S)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"qv",get:(S,v,D)=>h(S,v,D).emissiveColor,set:(S,v,D,z)=>h(v,D,z).emissiveColor.N(S),getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:A("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(S,v,D)=>{var z;return null===(z=E(S,D,"bumpTexture"))||void 0===z?void 0:z.level},set:(S,v,D,z)=>{const e=E(v,z,"bumpTexture");e&&(e.level=S)},getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:A("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(S,v,D)=>h(S,v,D).ambientTextureStrength,set:(S,v,D,z)=>{const e=h(v,D,z);e&&(e.ambientTextureStrength=S)},getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:A("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Ge",get:(S,v,D)=>{const z=h(S,v,D);return N.Ge.FromColor3(z.albedoColor,z.alpha)},set:(S,v,D,z)=>{const e=h(v,D,z);e.albedoColor.set(S.r,S.g,S.b),e.alpha=S.a},getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:A("albedoTexture")}},metallicFactor:{type:"number",get:(S,v,D)=>h(S,v,D).metallic,set:(S,v,D,z)=>{const e=h(v,D,z);e&&(e.metallic=S)},getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(S,v,D)=>h(S,v,D).roughness,set:(S,v,D,z)=>{const e=h(v,D,z);e&&(e.roughness=S)},getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:A("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(S,v,D)=>h(S,v,D).anisotropy.le,set:(S,v,D,z)=>{h(v,D,z).anisotropy.le=S},getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(S,v,D)=>h(S,v,D).anisotropy.angle,set:(S,v,D,z)=>{h(v,D,z).anisotropy.angle=S},getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:A("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(S,v,D)=>h(S,v,D).clearCoat.le,set:(S,v,D,z)=>{h(v,D,z).clearCoat.le=S},getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(S,v,D)=>h(S,v,D).clearCoat.roughness,set:(S,v,D,z)=>{h(v,D,z).clearCoat.roughness=S},getTarget:(S,v,D)=>h(S,v,D),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:A("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(S,v,D)=>{var z;return null===(z=h(S,v,D).clearCoat.bumpTexture)||void 0===z?void 0:z.level},getTarget:h,set:(S,v,D,z)=>h(v,D,z).clearCoat.bumpTexture.level=S},extensions:{KHR_texture_transform:A("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:A("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(S,v,D)=>h(S,v,D).subSurface.dispersion,getTarget:h,set:(S,v,D,z)=>h(v,D,z).subSurface.dispersion=S}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(S,v,D)=>h(S,v,D).emissiveIntensity,getTarget:h,set:(S,v,D,z)=>h(v,D,z).emissiveIntensity=S}},KHR_materials_ior:{ior:{type:"number",get:(S,v,D)=>h(S,v,D).indexOfRefraction,getTarget:h,set:(S,v,D,z)=>h(v,D,z).indexOfRefraction=S}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(S,v,D)=>h(S,v,D).iridescence.le,getTarget:h,set:(S,v,D,z)=>h(v,D,z).iridescence.le=S},iridescenceIor:{type:"number",get:(S,v,D)=>h(S,v,D).iridescence.indexOfRefraction,getTarget:h,set:(S,v,D,z)=>h(v,D,z).iridescence.indexOfRefraction=S},iridescenceTexture:{extensions:{KHR_texture_transform:A("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(S,v,D)=>h(S,v,D).iridescence.maximumThickness,getTarget:h,set:(S,v,D,z)=>h(v,D,z).iridescence.maximumThickness=S},iridescenceThicknessMinimum:{type:"number",get:(S,v,D)=>h(S,v,D).iridescence.minimumThickness,getTarget:h,set:(S,v,D,z)=>h(v,D,z).iridescence.minimumThickness=S},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:A("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"qv",get:(S,v,D)=>h(S,v,D).sheen.color,getTarget:h,set:(S,v,D,z)=>h(v,D,z).sheen.color.N(S)},sheenColorTexture:{extensions:{KHR_texture_transform:A("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(S,v,D)=>h(S,v,D).sheen.le,getTarget:h,set:(S,v,D,z)=>h(v,D,z).sheen.le=S},sheenRoughnessTexture:{extensions:{KHR_texture_transform:A("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(S,v,D)=>h(S,v,D).metallicF0Factor,getTarget:h,set:(S,v,D,z)=>h(v,D,z).metallicF0Factor=S,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"qv",get:(S,v,D)=>h(S,v,D).metallicReflectanceColor,getTarget:h,set:(S,v,D,z)=>h(v,D,z).metallicReflectanceColor.N(S),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:A("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:A("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(S,v,D)=>h(S,v,D).subSurface.refractionIntensity,getTarget:h,set:(S,v,D,z)=>h(v,D,z).subSurface.refractionIntensity=S,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:A("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(S,v,D)=>h(S,v,D).subSurface.translucencyIntensity,getTarget:h,set:(S,v,D,z)=>h(v,D,z).subSurface.translucencyIntensity=S},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:A("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"qv",get:(S,v,D)=>h(S,v,D).subSurface.translucencyColor,getTarget:h,set:(S,v,D,z)=>{var e;return S&&(null===(e=h(v,D,z).subSurface.translucencyColor)||void 0===e?void 0:e.N(S))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:A("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"qv",get:(S,v,D)=>h(S,v,D).subSurface.tintColor,getTarget:h,set:(S,v,D,z)=>h(v,D,z).subSurface.tintColor.N(S)},attenuationDistance:{type:"number",get:(S,v,D)=>h(S,v,D).subSurface.tintColorAtDistance,getTarget:h,set:(S,v,D,z)=>h(v,D,z).subSurface.tintColorAtDistance=S},thicknessFactor:{type:"number",get:(S,v,D)=>h(S,v,D).subSurface.maximumThickness,getTarget:h,set:(S,v,D,z)=>h(v,D,z).subSurface.maximumThickness=S},thicknessTexture:{extensions:{KHR_texture_transform:A("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:S=>S.length,getTarget:S=>S.map((S=>S._babylonLight)),getPropertyName:[S=>"length"]},__array__:{__target__:!0,color:{type:"qv",get:S=>{var v;return null===(v=S._babylonLight)||void 0===v?void 0:v.sB},set:(S,v)=>{var D;return null===(D=v._babylonLight)||void 0===D?void 0:D.sB.N(S)},getTarget:S=>S._babylonLight,getPropertyName:[S=>"diffuse"]},le:{type:"number",get:S=>{var v;return null===(v=S._babylonLight)||void 0===v?void 0:v.le},set:(S,v)=>v._babylonLight?v._babylonLight.le=S:void 0,getTarget:S=>S._babylonLight,getPropertyName:[S=>"intensity"]},range:{type:"number",get:S=>{var v;return null===(v=S._babylonLight)||void 0===v?void 0:v.range},set:(S,v)=>v._babylonLight?v._babylonLight.range=S:void 0,getTarget:S=>S._babylonLight,getPropertyName:[S=>"range"]},spot:{innerConeAngle:{type:"number",get:S=>{var v;return null===(v=S._babylonLight)||void 0===v?void 0:v.innerAngle},set:(S,v)=>v._babylonLight?v._babylonLight.innerAngle=S:void 0,getTarget:S=>S._babylonLight,getPropertyName:[S=>"innerConeAngle"]},outerConeAngle:{type:"number",get:S=>{var v;return null===(v=S._babylonLight)||void 0===v?void 0:v.angle},set:(S,v)=>v._babylonLight?v._babylonLight.angle=S:void 0,getTarget:S=>S._babylonLight,getPropertyName:[S=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:S=>S.length,getTarget:S=>S.map((S=>S._babylonLight)),getPropertyName:[S=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:S=>S.length,getTarget:S=>S.map((S=>S._babylonTexture)),getPropertyName:[S=>"length"]},__array__:{__target__:!0,le:{type:"number",get:S=>{var v;return null===(v=S._babylonTexture)||void 0===v?void 0:v.level},set:(S,v)=>{v._babylonTexture&&(v._babylonTexture.level=S)},getTarget:S=>S._babylonTexture},rotation:{type:"Quaternion",get:S=>{var v;return S._babylonTexture&&z.Quaternion.FromRotationMatrix(null===(v=S._babylonTexture)||void 0===v?void 0:v.getReflectionTextureMatrix())},set:(S,v)=>{var D;v._babylonTexture&&(null!==(D=v._babylonTexture.xS())&&void 0!==D&&D.useRightHandedSystem||(S=z.Quaternion.Inverse(S)),z.Matrix.FromQuaternionToRef(S,v._babylonTexture.getReflectionTextureMatrix()))},getTarget:S=>S._babylonTexture}}}}},animations:{length:{type:"number",get:S=>S.length,getTarget:S=>S.map((S=>S._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:S=>S.length,getTarget:S=>S.map((S=>{var v;return null===(v=S.primitives[0]._instanceData)||void 0===v?void 0:v.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function n(S){return new g(S,w)}function R(S){const v=S.split("/").map((S=>S.replace(/{}/g,"__array__")));let D=w;for(const z of v)z&&(D=D[z]);if(D&&D.type&&D.get)return D}function O(S,v){const D=S.split("/").map((S=>S.replace(/{}/g,"__array__")));let z=w;for(const e of D)e&&(z=z[e]);z&&z.type&&z.get&&(z.interpolation=v)}function I(S,v){const D=S.split("/").map((S=>S.replace(/{}/g,"__array__")));let z=w;for(const e of D)if(e){if(!z[e]){if("?"===e){z.__ignoreObjectTree__=!0;continue}z[e]={},"__array__"===e&&(z[e].__target__=!0)}z=z[e]}Object.assign(z,v)}},13062:(S,v,D)=>{"use strict";D.r(v),D.d(v,{AnimationPropertyInfo:()=>E,TransformNodeAnimationPropertyInfo:()=>h,WeightAnimationPropertyInfo:()=>A,getQuaternion:()=>B,getVector3:()=>m,getWeights:()=>g});var z=D(11884),e=D(11371),N=D(13048);function m(S,v,D,z){return e.Rv.uv(v,D).scaleInPlace(z)}function B(S,v,D,z){return e.Quaternion.uv(v,D).scaleInPlace(z)}function g(S,v,D,z){const e=new Array(S._numMorphTargets);for(let N=0;N<e.length;N++)e[N]=v[D++]*z;return e}class E{constructor(S,v,D,z){this.type=S,this.name=v,this.getValue=D,this.getStride=z}_buildAnimation(S,v,D){const e=new z.b(S,this.name,v,this.type);return e.setKeys(D),e}}class h extends E{buildAnimations(S,v,D,z){const e=[];return e.push({babylonAnimatable:S._babylonTransformNode,babylonAnimation:this._buildAnimation(v,D,z)}),e}}class A extends E{buildAnimations(S,v,D,e){const N=[];if(S._numMorphTargets)for(let m=0;m<S._numMorphTargets;m++){const B=new z.b(`${v}_${m}`,this.name,D,this.type);if(B.setKeys(e.map((S=>({frame:S.frame,inTangent:S.inTangent?S.inTangent[m]:void 0,value:S.value[m],outTangent:S.outTangent?S.outTangent[m]:void 0,interpolation:S.interpolation})))),S._primitiveBabylonMeshes)for(const v of S._primitiveBabylonMeshes)if(v.morphTargetManager){const S=v.morphTargetManager.getTarget(m),D=B.clone();S.animations.push(D),N.push({babylonAnimatable:S,babylonAnimation:D})}}return N}}(0,N.l)("/nodes/{}/translation",[new h(z.b.ANIMATIONTYPE_VECTOR3,"position",m,(()=>3))]),(0,N.l)("/nodes/{}/rotation",[new h(z.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",B,(()=>4))]),(0,N.l)("/nodes/{}/scale",[new h(z.b.ANIMATIONTYPE_VECTOR3,"Me",m,(()=>3))]),(0,N.l)("/nodes/{}/weights",[new A(z.b.ANIMATIONTYPE_FLOAT,"influence",g,(S=>S._numMorphTargets))])},13019:(S,v,D)=>{"use strict";class z{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((S,v)=>{this._resolve=S,this._reject=v}))}}var e=D(11371),N=D(11425),m=D(11175),B=D(11827),g=D(13026),E=D(13036),h=D(11179),A=D(11841),w=D(11884),n=D(11888),R=D(11222),O=D(11190),I=D(11193);class K{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(S){this._useTextureToStoreBoneMatrices=S,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(S){this._animationPropertiesOverride=S}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(S,v,D){this.name=S,this.id=v,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=e.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new h.d,this.bones=[],this._scene=D||R.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const z=this._scene.getEngine().getCaps();this._canUseTextureForBones=z.textureFloat&&z.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((S=>!S.getParent()))}getTransformMatrices(S){if(this.needInitialSkinMatrix){if(!S)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return S._bonesTransformMatrices||this.prepare(!0),S._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(S){return this.needInitialSkinMatrix&&S._transformMatrixTexture?S._transformMatrixTexture:this._transformMatrixTexture}xS(){return this._scene}toString(S){let v=`Name: ${this.name}, nBones: ${this.bones.length}`;if(v+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,S){v+=", Ranges: {";let S=!0;for(const D in this._ranges)S&&(v+=", ",S=!1),v+=D;v+="}"}return v}getBoneIndexByName(S){for(let v=0,D=this.bones.length;v<D;v++)if(this.bones[v].name===S)return v;return-1}createAnimationRange(S,v,D){if(!this._ranges[S]){this._ranges[S]=new n.c(S,v,D);for(let z=0,e=this.bones.length;z<e;z++)this.bones[z].animations[0]&&this.bones[z].animations[0].createRange(S,v,D)}}deleteAnimationRange(S){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let D=0,z=this.bones.length;D<z;D++)this.bones[D].animations[0]&&this.bones[D].animations[0].deleteRange(S,v);this._ranges[S]=null}getAnimationRange(S){return this._ranges[S]||null}getAnimationRanges(){const S=[];let v;for(v in this._ranges)S.push(this._ranges[v]);return S}copyAnimationRange(S,v){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[v]||!S.getAnimationRange(v))return!1;let z=!0;const e=this._getHighestAnimationFrame()+1,N={},m=S.bones;let B,g;for(g=0,B=m.length;g<B;g++)N[m[g].name]=m[g];this.bones.length!==m.length&&(O.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${m.length}`),z=!1);const E=D&&this.dimensionsAtRest&&S.dimensionsAtRest?this.dimensionsAtRest.divide(S.dimensionsAtRest):null;for(g=0,B=this.bones.length;g<B;g++){const S=this.bones[g].name,m=N[S];m?z=z&&this.bones[g].copyAnimationRange(m,v,e,D,E):(O.b.Warn("copyAnimationRange: not same rig, missing source bone "+S),z=!1)}const h=S.getAnimationRange(v);return h&&(this._ranges[v]=new n.c(v,h.from+e,h.to+e)),z}returnToRest(){for(const S of this.bones)-1!==S._index&&S.returnToRest()}_getHighestAnimationFrame(){let S=0;for(let v=0,D=this.bones.length;v<D;v++)if(this.bones[v].animations[0]){const D=this.bones[v].animations[0].getHighestFrame();S<D&&(S=D)}return S}beginAnimation(S,v,D,z){const e=this.getAnimationRange(S);return e?this._scene.beginAnimation(this,e.from,e.to,v,D,z):null}static MakeAnimationAdditive(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;const z=S.getAnimationRange(D);if(!z)return null;const e=S._scene.getAllAnimatablesByTarget(S);let N=null;for(let B=0;B<e.length;B++){const S=e[B];if(S.fromFrame===(null===z||void 0===z?void 0:z.from)&&S.toFrame===(null===z||void 0===z?void 0:z.to)){N=S;break}}const m=S.getAnimatables();for(let B=0;B<m.length;B++){const S=m[B].animations;if(S)for(let z=0;z<S.length;z++)w.b.MakeAnimationAdditive(S[z],v,D)}return N&&(N.isAdditive=!0),S}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(S){this._meshesWithPoseMatrix.push(S)}_unregisterMeshWithPoseMatrix(S){const v=this._meshesWithPoseMatrix.indexOf(S);v>-1&&this._meshesWithPoseMatrix.splice(v,1)}_computeTransformMatrices(S,v){this.onBeforeComputeObservable.notifyObservers(this);for(let D=0;D<this.bones.length;D++){const z=this.bones[D];z._childUpdateId++;const e=z.getParent();if(e?z.getLocalMatrix().multiplyToRef(e.getFinalMatrix(),z.getFinalMatrix()):v?z.getLocalMatrix().multiplyToRef(v,z.getFinalMatrix()):z.getFinalMatrix().N(z.getLocalMatrix()),-1!==z._index){const v=null===z._index?D:z._index;z.getAbsoluteInverseBindMatrix().multiplyToArray(z.getFinalMatrix(),S,16*v)}}this._identity.copyToArray(S,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const S=this.xS().getRenderId();if(this._currentRenderId===S)return;this._currentRenderId=S}if(this._numBonesWithLinkedTransformNode>0)for(const S of this.bones)if(S._linkedTransformNode){const v=S._linkedTransformNode;S.position=v.position,v.rotationQuaternion?S.rotationQuaternion=v.rotationQuaternion:S.rotation=v.rotation,S.Me=v.Me}if(this.needInitialSkinMatrix)for(const S of this._meshesWithPoseMatrix){const v=S.getPoseMatrix();let D=this._isDirty;if(S._bonesTransformMatrices&&S._bonesTransformMatrices.length===16*(this.bones.length+1)||(S._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),D=!0),D){if(this._synchronizedWithMesh!==S){this._synchronizedWithMesh=S;for(const S of this.bones)if(!S.getParent()){S.getBindMatrix().multiplyToRef(v,e.TmpVectors.Matrix[1]),S._updateAbsoluteBindMatrices(e.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const v=4*(this.bones.length+1);S._transformMatrixTexture&&S._transformMatrixTexture.getSize().width===v||(S._transformMatrixTexture&&S._transformMatrixTexture.dispose(),S._transformMatrixTexture=A.e.CreateRGBATexture(S._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(S._bonesTransformMatrices,v),this.isUsingTextureForMatrices&&S._transformMatrixTexture&&S._transformMatrixTexture.update(S._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=A.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let S=0;S<this.bones.length;S++)this._animatables.push(this.bones[S])}return this._animatables}clone(S,v){const D=new K(S,v||S,this._scene);D.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let z=0;z<this.bones.length;z++){const S=this.bones[z];let v=null;const e=S.getParent();if(e){const S=this.bones.indexOf(e);v=D.bones[S]}const N=new E.d(S.name,D,v,S.getBindMatrix().clone(),S.getRestMatrix().clone());N._index=S._index,S._linkedTransformNode&&N.linkTransformNode(S._linkedTransformNode),I.e.DeepCopy(S.animations,N.animations)}if(this._ranges){D._ranges={};for(const S in this._ranges){const v=this._ranges[S];v&&(D._ranges[S]=v.clone())}}return this._isDirty=!0,D.prepare(!0),D}enableBlending(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const v of this.bones)for(const D of v.animations)D.enableBlending=!0,D.blendingSpeed=S}dispose(){if(this._meshesWithPoseMatrix.length=0,this.xS().stopAnimation(this),this.xS().removeSkeleton(this),this._parentContainer){const S=this._parentContainer.skeletons.indexOf(this);S>-1&&this._parentContainer.skeletons.splice(S,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const S={};S.name=this.name,S.id=this.id,this.dimensionsAtRest&&(S.dimensionsAtRest=this.dimensionsAtRest.Oe()),S.bones=[],S.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let D=0;D<this.bones.length;D++){var v;const z=this.bones[D],e=z.getParent(),N={parentBoneIndex:e?this.bones.indexOf(e):-1,index:z.getIndex(),name:z.name,id:z.id,matrix:z.getBindMatrix().Oe(),rest:z.getRestMatrix().Oe(),linkedTransformNodeId:null===(v=z.getTransformNode())||void 0===v?void 0:v.id};S.bones.push(N),z.length&&(N.length=z.length),z.metadata&&(N.metadata=z.metadata),z.animations&&z.animations.length>0&&(N.animation=z.animations[0].serialize()),S.ranges=[];for(const v in this._ranges){const D=this._ranges[v];if(!D)continue;const z={};z.name=v,z.from=D.from,z.to=D.to,S.ranges.push(z)}}return S}static Parse(S,v){const D=new K(S.name,S.id,v);let z;for(S.dimensionsAtRest&&(D.dimensionsAtRest=e.Rv.uv(S.dimensionsAtRest)),D.needInitialSkinMatrix=S.needInitialSkinMatrix,z=0;z<S.bones.length;z++){const v=S.bones[z],N=S.bones[z].index;let m=null;v.parentBoneIndex>-1&&(m=D.bones[v.parentBoneIndex]);const B=v.rest?e.Matrix.uv(v.rest):null,g=new E.d(v.name,D,m,e.Matrix.uv(v.matrix),B,null,N);void 0!==v.id&&null!==v.id&&(g.id=v.id),v.length&&(g.length=v.length),v.metadata&&(g.metadata=v.metadata),v.animation&&g.animations.push(w.b.Parse(v.animation)),void 0!==v.linkedTransformNodeId&&null!==v.linkedTransformNodeId&&(D._hasWaitingData=!0,g._waitingTransformNodeId=v.linkedTransformNodeId)}if(S.ranges)for(z=0;z<S.ranges.length;z++){const v=S.ranges[z];D.createAnimationRange(v.name,v.from,v.to)}return D}computeAbsoluteMatrices(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||S)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(S)}getPoseMatrix(){let S=null;return this._meshesWithPoseMatrix.length>0&&(S=this._meshesWithPoseMatrix[0].getPoseMatrix()),S}sortBones(){const S=[],v=new Array(this.bones.length);for(let D=0;D<this.bones.length;D++)this._sortBones(D,S,v);this.bones=S}_sortBones(S,v,D){if(D[S])return;D[S]=!0;const z=this.bones[S];if(!z)return;void 0===z._index&&(z._index=S);const e=z.getParent();e&&this._sortBones(this.bones.indexOf(e),v,D),v.push(z)}setCurrentPoseAsRest(){for(const S of this.bones)S.setCurrentPoseAsRest()}}var q=D(11699),u=D(11854),s=D(11350),r=D(11791),d=D(11452),x=D(11829),W=D(11802),p=D(11819),b=D(11895),k=D(11483),Z=D(12989);class i{set areUpdatesFrozen(S){S?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new k.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,S||(S=R.c.LastCreatedScene),this._scene=S,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const S=this._scene.getEngine().getCaps();this._canUseTextureForTargets=S.canUseGLVertexID&&S.textureFloat&&S.maxVertexTextureImageUnits>0&&S.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return i.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?i.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(S){this._numMaxInfluencers!==S&&(this._numMaxInfluencers=S,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(S){this._useTextureToStoreTargets!==S&&(this._useTextureToStoreTargets=S,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var S;return i.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(S=this._scene)&&void 0!==S&&S.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(S){return this._activeTargets.data[S]}getTarget(S){return this._targets[S]}getTargetByName(S){for(const v of this._targets)if(v.name===S)return v;return null}addTarget(S){this._targets.push(S),this._targetInfluenceChangedObservers.push(S.onInfluenceChanged.add((S=>{this.areUpdatesFrozen&&S&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(S)}))),this._targetDataLayoutChangedObservers.push(S._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(S){const v=this._targets.indexOf(S);v>=0&&(this._targets.splice(v,1),S.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(v,1)[0]),S._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(v,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(S)}_bind(S){S.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),S.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),S.setTexture("morphTargets",this._targetStoreTexture),S.setInt("morphTargetCount",this.numInfluencers)}clone(){const S=new i(this._scene);for(const v of this._targets)S.addTarget(v.clone());return S.enablePositionMorphing=this.enablePositionMorphing,S.enableNormalMorphing=this.enableNormalMorphing,S.enableTangentMorphing=this.enableTangentMorphing,S.enableUVMorphing=this.enableUVMorphing,S.enableUV2Morphing=this.enableUV2Morphing,S.enableColorMorphing=this.enableColorMorphing,S}serialize(){const S={};S.id=this.uniqueId,S.targets=[];for(const v of this._targets)S.targets.push(v.serialize());return S}_syncActiveTargets(){let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const v=!!this._targetStoreTexture,D=this.isUsingTextureForTargets;(this._mustSynchronize||v!==D)&&(this._mustSynchronize=!1,this.synchronize());let z=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let e=-1;for(const N of this._targets)if(e++,0!==N.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=i.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(N),this._morphTargetTextureIndices[z]=e,this._tempInfluences[z++]=N.influence}this._morphTargetTextureIndices.length!==z&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,z)),this._influences&&this._influences.length===z||(this._influences=new Float32Array(z));for(let N=0;N<z;N++)this._influences[N]=this._tempInfluences[N];if(S&&this._scene)for(const N of this._scene.meshes)N.morphTargetManager===this&&(D?N._markSubMeshesAsAttributesDirty():N._syncGeometryWithMorphTargetManager())}synchronize(){var S;if(!this._scene||this.areUpdatesFrozen)return;const v=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(S=this._targetStoreTexture)||void 0===S||S.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>v.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const D of this._targets){this._supportsPositions=this._supportsPositions&&D.hasPositions,this._supportsNormals=this._supportsNormals&&D.hasNormals,this._supportsTangents=this._supportsTangents&&D.hasTangents,this._supportsUVs=this._supportsUVs&&D.hasUVs,this._supportsUV2s=this._supportsUV2s&&D.hasUV2s,this._supportsColors=this._supportsColors&&D.hasColors;const S=D.vertexCount;if(0===this._vertexCount)this._vertexCount=S;else if(this._vertexCount!==S)return void O.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${D.name}": ${S}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const S=v.getCaps().maxTextureSize;this._textureWidth>S&&(this._textureHeight=Math.ceil(this._textureWidth/S),this._textureWidth=S);const D=this._targets.length,z=new Float32Array(D*this._textureWidth*this._textureHeight*4);let e=0;for(let v=0;v<D;v++){const S=this._targets[v],D=S.getPositions(),N=S.getNormals(),m=S.getUVs(),B=S.getTangents(),g=S.getUV2s(),E=S.getColors();e=v*this._textureWidth*this._textureHeight*4;for(let v=0;v<this._vertexCount;v++)this._supportsPositions&&D&&(z[e]=D[3*v],z[e+1]=D[3*v+1],z[e+2]=D[3*v+2],e+=4),this._supportsNormals&&N&&(z[e]=N[3*v],z[e+1]=N[3*v+1],z[e+2]=N[3*v+2],e+=4),this._supportsUVs&&m&&(z[e]=m[2*v],z[e+1]=m[2*v+1],e+=4),this._supportsTangents&&B&&(z[e]=B[3*v],z[e+1]=B[3*v+1],z[e+2]=B[3*v+2],e+=4),this._supportsUV2s&&g&&(z[e]=g[2*v],z[e+1]=g[2*v+1],e+=4),this._supportsColors&&E&&(z[e]=E[4*v],z[e+1]=E[4*v+1],z[e+2]=E[4*v+2],z[e+3]=E[4*v+3],e+=4)}this._targetStoreTexture=Z.d.CreateRGBATexture(z,this._textureWidth,this._textureHeight,D,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const D of this._scene.meshes)D.morphTargetManager===this&&D._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const S=this._parentContainer.morphTargetManagers.indexOf(this);S>-1&&this._parentContainer.morphTargetManagers.splice(S,1),this._parentContainer=null}for(const S of this._targets)this._scene.stopAnimation(S)}}static Parse(S,v){const D=new i(v);for(const z of S.targets)D.addTarget(b.e.Parse(z,v));return D}}i.EnableTextureStorage=!0,i.MaxActiveMorphTargetsInVertexAttributeMode=8,i.ConstantTargetCountForTextureMode=0;var t=D(13042),X=D(11229),a=D(11716);const o=new Map,M=o;function c(S,v,D){J(S)&&O.b.Warn(`Extension with the name '${S}' already exists`),o.set(S,{isGLTFExtension:v,factory:D})}function J(S){return o.delete(S)}var H=D(13048),T=D(11935),G=D(11469);class Y{static Get(S,v,D){if(!v||void 0==D||!v[D])throw new Error(`${S}: Failed to find index (${D})`);return v[D]}static TryGet(S,v){return S&&void 0!=v&&S[v]?S[v]:null}static Assign(S){if(S)for(let v=0;v<S.length;v++)S[v].index=v}}function j(S){if(S.min&&S.max){const v=S.min,D=S.max,z=e.TmpVectors.Rv[0].oe(v[0],v[1],v[2]),N=e.TmpVectors.Rv[1].oe(D[0],D[1],D[2]);if(S.normalized&&5126!==S.componentType){let v=1;switch(S.componentType){case 5120:v=127;break;case 5121:v=255;break;case 5122:v=32767;break;case 5123:v=65535}const D=1/v;z.scaleInPlace(D),N.scaleInPlace(D)}return new a.c(z,N)}return null}class V{static RegisterExtension(S,v){c(S,!1,v)}static UnregisterExtension(S){return J(S)}get me(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(S){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=S}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((S=>S.dispose&&S.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(S,v,D,z,e,N){let m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=v,this._assetContainer=D,this._loadData(z);let N=null;if(S){const v={};if(this._gltf.nodes)for(const S of this._gltf.nodes)S.name&&(v[S.name]=S.index);N=(S instanceof Array?S:[S]).map((S=>{const D=v[S];if(void 0===D)throw new Error(`Failed to find node '${S}'`);return D}))}return await this._loadAsync(e,m,N,(()=>({meshes:this._getMeshes(),Zw:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(S,v,D,z){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=S,this._loadData(v),await this._loadAsync(D,e,null,(()=>{}))}async _loadAsync(S,v,D,z){return await Promise.resolve().then((async()=>{this._rootUrl=S,this._uniqueRootUrl=!S.startsWith("file:")&&v?S:`${S}${Date.now()}/`,this._fileName=v,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const e=`${t.j[t.j.LOADING]} => ${t.j[t.j.READY]}`,N=`${t.j[t.j.LOADING]} => ${t.j[t.j.COMPLETE]}`;this._parent._startPerformanceCounter(e),this._parent._startPerformanceCounter(N),this._parent._setState(t.j.LOADING),this._extensionsOnLoading();const B=new Array;if(!this.parent.loadOnlyMaterials)if(D)B.push(this.loadSceneAsync("/nodes",{nodes:D,index:-1}));else if(void 0!=this._gltf.Iv||this._gltf.scenes&&this._gltf.scenes[0]){const S=Y.Get("/scene",this._gltf.scenes,this._gltf.Iv||0);B.push(this.loadSceneAsync(`/scenes/${S.index}`,S))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let S=0;S<this._gltf.materials.length;++S){const v=this._gltf.materials[S],D="/materials/"+S,z=q.d.TriangleFillMode;B.push(this._loadMaterialAsync(D,v,null,z,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&B.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&B.push(this._compileShadowGeneratorsAsync());const g=Promise.all(B).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.JB(!0);for(const S of this._babylonScene.materials){const v=S;void 0!==v.maxSimultaneousLights&&(v.maxSimultaneousLights=Math.max(v.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(t.j.READY),this._skipStartAnimationStep||this._startAnimations(),z()}));return await g.then((S=>(this._parent._endPerformanceCounter(e),m.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(N),this._parent._setState(t.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(S=>{this._parent.onErrorObservable.notifyObservers(S),this._parent.onErrorObservable.clear(),this.dispose()}))})),S)))})).catch((S=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(S),this._parent.onErrorObservable.clear(),this.dispose()),S}))}_loadData(S){if(this._gltf=S.json,this._setupData(),S.bin){const v=this._gltf.buffers;if(v&&v[0]&&!v[0].uri){const D=v[0];(D.byteLength<S.bin.byteLength-3||D.byteLength>S.bin.byteLength)&&O.b.Warn(`Binary buffer length (${D.byteLength}) from JSON does not match chunk length (${S.bin.byteLength})`),this._bin=S.bin}else O.b.Warn("Unexpected BIN chunk")}}_setupData(){if(Y.Assign(this._gltf.accessors),Y.Assign(this._gltf.animations),Y.Assign(this._gltf.buffers),Y.Assign(this._gltf.bufferViews),Y.Assign(this._gltf.cameras),Y.Assign(this._gltf.images),Y.Assign(this._gltf.materials),Y.Assign(this._gltf.meshes),Y.Assign(this._gltf.nodes),Y.Assign(this._gltf.samplers),Y.Assign(this._gltf.scenes),Y.Assign(this._gltf.skins),Y.Assign(this._gltf.textures),this._gltf.nodes){const S={};for(const D of this._gltf.nodes)if(D.children)for(const v of D.children)S[v]=D.index;const v=this._createRootNode();for(const D of this._gltf.nodes){const z=S[D.index];D.parent=void 0===z?v:this._gltf.nodes[z]}}}async _loadExtensionsAsync(){const S=[];if(M.forEach(((v,D)=>{var z;!1===(null===(z=this.parent.extensionOptions[D])||void 0===z?void 0:z.enabled)?v.isGLTFExtension&&this.isExtensionUsed(D)&&O.b.Warn(`Extension ${D} is used but has been explicitly disabled.`):v.isGLTFExtension&&!this.isExtensionUsed(D)||S.push((async()=>{const S=await v.factory(this);return S.name!==D&&O.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${S.name} !== ${D}`),this._parent.onExtensionLoadedObservable.notifyObservers(S),S})())})),this._extensions.push(...await Promise.all(S)),this._extensions.sort(((S,v)=>(S.order||Number.MAX_VALUE)-(v.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const D of this._gltf.extensionsRequired){if(!this._extensions.some((S=>S.name===D&&S.enabled))){var v;if(!1===(null===(v=this.parent.extensionOptions[D])||void 0===v?void 0:v.enabled))throw new Error(`Required extension ${D} is disabled`);throw new Error(`Required extension ${D} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new p.e("__root__",this._babylonScene);this._rootBabylonMesh=S,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.JB(!1);const v={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case t.f.AUTO:this._babylonScene.useRightHandedSystem||(v.rotation=[0,1,0,0],v.scale=[1,1,-1],V._LoadTransform(v,this._rootBabylonMesh));break;case t.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(S),v}loadSceneAsync(S,v){const D=this._extensionsLoadSceneAsync(S,v);if(D)return D;const z=new Array;if(this.logOpen(`${S} ${v.name||""}`),v.nodes)for(const e of v.nodes){const v=Y.Get(`${S}/nodes/${e}`,this._gltf.nodes,e);z.push(this.loadNodeAsync(`/nodes/${v.index}`,v,(S=>{S.parent=this._rootBabylonMesh})))}for(const e of this._postSceneLoadActions)e();return z.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(z).then((()=>{}))}_forEachPrimitive(S,v){if(S._primitiveBabylonMeshes)for(const D of S._primitiveBabylonMeshes)v(D)}_getGeometries(){const S=[],v=this._gltf.nodes;if(v)for(const D of v)this._forEachPrimitive(D,(v=>{const D=v.ie;D&&-1===S.indexOf(D)&&S.push(D)}));return S}_getMeshes(){const S=[];this._rootBabylonMesh instanceof W.e&&S.push(this._rootBabylonMesh);const v=this._gltf.nodes;if(v)for(const D of v)this._forEachPrimitive(D,(v=>{S.push(v)}));return S}_getTransformNodes(){const S=[],v=this._gltf.nodes;if(v)for(const D of v)D._babylonTransformNode&&"gg"===D._babylonTransformNode.getClassName()&&S.push(D._babylonTransformNode),D._babylonTransformNodeForSkin&&S.push(D._babylonTransformNodeForSkin);return S}_getSkeletons(){const S=[],v=this._gltf.skins;if(v)for(const D of v)D._data&&S.push(D._data.babylonSkeleton);return S}_getAnimationGroups(){const S=[],v=this._gltf.animations;if(v)for(const D of v)D._babylonAnimationGroup&&S.push(D._babylonAnimationGroup);return S}_startAnimations(){switch(this._parent.animationStartMode){case t.c.NONE:break;case t.c.FIRST:{const S=this._getAnimationGroups();0!==S.length&&S[0].start(!0);break}case t.c.ALL:{const S=this._getAnimationGroups();for(const v of S)v.start(!0);break}default:return void O.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadNodeAsync(S,v,D);if(z)return z;if(v._babylonTransformNode)throw new Error(`${S}: Invalid recursive node hierarchy`);const e=new Array;this.logOpen(`${S} ${v.name||""}`);const N=z=>{if(V.AddPointerMetadata(z,S),V._LoadTransform(v,z),void 0!=v.camera){const D=Y.Get(`${S}/camera`,this._gltf.cameras,v.camera);e.push(this.loadCameraAsync(`/cameras/${D.index}`,D,(S=>{S.parent=z,this._babylonScene.useRightHandedSystem||(z.Me.x=-1)})))}if(v.children)for(const D of v.children){const v=Y.Get(`${S}/children/${D}`,this._gltf.nodes,D);e.push(this.loadNodeAsync(`/nodes/${v.index}`,v,(S=>{S.parent=z})))}D(z)},m=void 0!=v.mesh,B=this._parent.loadSkins&&void 0!=v.skin;if(!m||B){const S=v.name||`node${v.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new r.b(S,this._babylonScene);D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==v.mesh?v._babylonTransformNode=D:v._babylonTransformNodeForSkin=D,N(D)}if(m)if(B){const D=Y.Get(`${S}/mesh`,this._gltf.meshes,v.mesh);e.push(this._loadMeshAsync(`/meshes/${D.index}`,v,D,(D=>{const z=v._babylonTransformNodeForSkin;D.metadata=(0,T.d)(z.metadata,D.metadata||{});const N=Y.Get(`${S}/skin`,this._gltf.skins,v.skin);e.push(this._loadSkinAsync(`/skins/${N.index}`,v,N,(S=>{this._forEachPrimitive(v,(v=>{v.skeleton=S})),this._postSceneLoadActions.push((()=>{if(void 0!=N.skeleton){const S=Y.Get(`/skins/${N.index}/skeleton`,this._gltf.nodes,N.skeleton).parent;v.index===S.index?D.parent=z.parent:D.parent=S._babylonTransformNode}else D.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:z,skinnedNode:D})}))})))})))}else{const D=Y.Get(`${S}/mesh`,this._gltf.meshes,v.mesh);e.push(this._loadMeshAsync(`/meshes/${D.index}`,v,D,N))}return this.logClose(),Promise.all(e).then((()=>(this._forEachPrimitive(v,(S=>{const v=S;!v.isAnInstance&&v.ie&&v.ie.useBoundingInfoFromGeometry?S.aS():S.refreshBoundingInfo(!0,!0)})),v._babylonTransformNode)))}_loadMeshAsync(S,v,D,z){const e=D.primitives;if(!e||!e.length)throw new Error(`${S}: Primitives are missing`);void 0==e[0].index&&Y.Assign(e);const N=new Array;this.logOpen(`${S} ${D.name||""}`);const m=v.name||`node${v.index}`;if(1===e.length){const z=D.primitives[0];N.push(this._loadMeshPrimitiveAsync(`${S}/primitives/${z.index}`,m,v,D,z,(S=>{v._babylonTransformNode=S,v._primitiveBabylonMeshes=[S]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,v._babylonTransformNode=new r.b(m,this._babylonScene),v._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._primitiveBabylonMeshes=[];for(const z of e)N.push(this._loadMeshPrimitiveAsync(`${S}/primitives/${z.index}`,`${m}_primitive${z.index}`,v,D,z,(S=>{S.parent=v._babylonTransformNode,v._primitiveBabylonMeshes.push(S)})))}return z(v._babylonTransformNode),this.logClose(),Promise.all(N).then((()=>v._babylonTransformNode))}_loadMeshPrimitiveAsync(S,v,D,z,e,N){const m=this._extensionsLoadMeshPrimitiveAsync(S,v,D,z,e,N);if(m)return m;this.logOpen(`${S}`);const B=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==D.skin&&!z.primitives[0].targets;let g,E;if(B&&e._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,g=e._instanceData.babylonSourceMesh.createInstance(v),g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E=e._instanceData.promise;else{const N=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new p.e(v,this._babylonScene);m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.sideOrientation=this._babylonScene.useRightHandedSystem?q.d.CounterClockWiseSideOrientation:q.d.ClockWiseSideOrientation,this._createMorphTargets(S,D,z,e,m),N.push(this._loadVertexDataAsync(S,e,m).then((async v=>await this._loadMorphTargetsAsync(S,e,m,v).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,v.tS(m),v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const h=V._GetDrawMode(S,e.mode);if(void 0==e.material){let S=this._defaultBabylonMaterialData[h];S||(S=this._createDefaultMaterial("__GLTFLoader._default",h),this._parent.onMaterialLoadedObservable.notifyObservers(S),this._defaultBabylonMaterialData[h]=S),m.material=S}else if(!this.parent.skipMaterials){const v=Y.Get(`${S}/material`,this._gltf.materials,e.material);N.push(this._loadMaterialAsync(`/materials/${v.index}`,v,m,h,(S=>{m.material=S})))}E=Promise.all(N),B&&(e._instanceData={babylonSourceMesh:m,promise:E}),g=m}return V.AddPointerMetadata(g,S),this._parent.onMeshLoadedObservable.notifyObservers(g),N(g),this.logClose(),E.then((()=>g))}_loadVertexDataAsync(S,v,D){const z=this._extensionsLoadVertexDataAsync(S,v,D);if(z)return z;const e=v.attributes;if(!e)throw new Error(`${S}: Attributes are missing`);const N=new Array,m=new x.c(D.name,this._babylonScene);if(void 0==v.indices)D.isUnIndexed=!0;else{const D=Y.Get(`${S}/indices`,this._gltf.accessors,v.indices);N.push(this._loadIndicesAccessorAsync(`/accessors/${D.index}`,D).then((S=>{m.setIndices(S)})))}const B=(v,z,B)=>{if(void 0==e[v])return;D._delayInfo=D._delayInfo||[],-1===D._delayInfo.indexOf(z)&&D._delayInfo.push(z);const g=Y.Get(`${S}/attributes/${v}`,this._gltf.accessors,e[v]);N.push(this._loadVertexAccessorAsync(`/accessors/${g.index}`,g,z).then((S=>{if(S.getKind()===d.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!D.skeleton){const S=j(g);S&&(m._boundingInfo=S,m.useBoundingInfoFromGeometry=!0)}m.setVerticesBuffer(S,g.count)}))),z==d.d.MatricesIndicesExtraKind&&(D.numBoneInfluencers=8),B&&B(g)};return B("POSITION",d.d.PositionKind),B("NORMAL",d.d.NormalKind),B("TANGENT",d.d.TangentKind),B("TEXCOORD_0",d.d.UVKind),B("TEXCOORD_1",d.d.UV2Kind),B("TEXCOORD_2",d.d.UV3Kind),B("TEXCOORD_3",d.d.UV4Kind),B("TEXCOORD_4",d.d.UV5Kind),B("TEXCOORD_5",d.d.UV6Kind),B("JOINTS_0",d.d.MatricesIndicesKind),B("WEIGHTS_0",d.d.MatricesWeightsKind),B("JOINTS_1",d.d.MatricesIndicesExtraKind),B("WEIGHTS_1",d.d.MatricesWeightsExtraKind),B("COLOR_0",d.d.ColorKind,(S=>{"VEC4"===S.type&&(D.hasVertexAlpha=!0)})),Promise.all(N).then((()=>m))}_createMorphTargets(S,v,D,z,e){if(!z.targets||!this._parent.loadMorphTargets)return;if(void 0==v._numMorphTargets)v._numMorphTargets=z.targets.length;else if(z.targets.length!==v._numMorphTargets)throw new Error(`${S}: Primitives do not have the same number of targets`);const N=D.extras?D.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,e.morphTargetManager=new i(this._babylonScene),e.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.morphTargetManager.areUpdatesFrozen=!0;for(let m=0;m<z.targets.length;m++){const S=v.weights?v.weights[m]:D.weights?D.weights[m]:0,z=N?N[m]:`morphTarget${m}`;e.morphTargetManager.addTarget(new b.e(z,S,e.xS()))}}_loadMorphTargetsAsync(S,v,D,z){if(!v.targets||!this._parent.loadMorphTargets)return Promise.resolve();const e=new Array,N=D.morphTargetManager;for(let m=0;m<N.numTargets;m++){const D=N.getTarget(m);e.push(this._loadMorphTargetVertexDataAsync(`${S}/targets/${m}`,z,v.targets[m],D))}return Promise.all(e).then((()=>{N.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(S,v,D,z){const e=new Array,N=(z,N,m)=>{if(void 0==D[z])return;const B=v.getVertexBuffer(N);if(!B)return;const g=Y.Get(`${S}/${z}`,this._gltf.accessors,D[z]);e.push(this._loadFloatAccessorAsync(`/accessors/${g.index}`,g).then((S=>{m(B,S)})))};return N("POSITION",d.d.PositionKind,((S,v)=>{const D=new Float32Array(v.length);S.forEach(v.length,((S,z)=>{D[z]=v[z]+S})),z.setPositions(D)})),N("NORMAL",d.d.NormalKind,((S,v)=>{const D=new Float32Array(v.length);S.forEach(D.length,((S,z)=>{D[z]=v[z]+S})),z.setNormals(D)})),N("TANGENT",d.d.TangentKind,((S,v)=>{const D=new Float32Array(v.length/3*4);let e=0;S.forEach(v.length/3*4,((S,z)=>{(z+1)%4!==0&&(D[e]=v[e]+S,e++)})),z.setTangents(D)})),N("TEXCOORD_0",d.d.UVKind,((S,v)=>{const D=new Float32Array(v.length);S.forEach(v.length,((S,z)=>{D[z]=v[z]+S})),z.setUVs(D)})),N("TEXCOORD_1",d.d.UV2Kind,((S,v)=>{const D=new Float32Array(v.length);S.forEach(v.length,((S,z)=>{D[z]=v[z]+S})),z.setUV2s(D)})),N("COLOR_0",d.d.ColorKind,((v,D)=>{let e=null;const N=v.getSize();if(3===N){e=new Float32Array(D.length/3*4),v.forEach(D.length,((S,v)=>{const z=Math.floor(v/3),N=v%3;e[4*z+N]=D[3*z+N]+S}));for(let S=0;S<D.length/3;++S)e[4*S+3]=1}else{if(4!==N)throw new Error(`${S}: Invalid number of components (${N}) for COLOR_0 attribute`);e=new Float32Array(D.length),v.forEach(D.length,((S,v)=>{e[v]=D[v]+S}))}z.setColors(e)})),await Promise.all(e).then((()=>{}))}static _LoadTransform(S,v){if(void 0!=S.skin)return;let D=e.Rv.Zero(),z=e.Quaternion.Identity(),N=e.Rv.One();if(S.matrix){e.Matrix.uv(S.matrix).decompose(N,z,D)}else S.translation&&(D=e.Rv.uv(S.translation)),S.rotation&&(z=e.Quaternion.uv(S.rotation)),S.scale&&(N=e.Rv.uv(S.scale));v.position=D,v.rotationQuaternion=z,v.Me=N}_loadSkinAsync(S,v,D,z){if(!this._parent.loadSkins)return Promise.resolve();const e=this._extensionsLoadSkinAsync(S,v,D);if(e)return e;if(D._data)return z(D._data.babylonSkeleton),D._data.promise;const N=`skeleton${D.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new K(D.name||N,N,this._babylonScene);m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(S,D,m);const B=this._loadSkinInverseBindMatricesDataAsync(S,D).then((S=>{this._updateBoneMatrices(m,S)}));return D._data={babylonSkeleton:m,promise:B},z(m),B}_loadBones(S,v,D){if(void 0==v.skeleton||this._parent.alwaysComputeSkeletonRootNode){const D=this._findSkeletonRootNode(`${S}/joints`,v.joints);if(D)if(void 0===v.skeleton)v.skeleton=D.index;else{const z=(S,v)=>{for(;v.parent;v=v.parent)if(v.parent===S)return!0;return!1},e=Y.Get(`${S}/skeleton`,this._gltf.nodes,v.skeleton);e===D||z(e,D)||(O.b.Warn(`${S}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),v.skeleton=D.index)}else O.b.Warn(`${S}: Failed to find common root`)}const z={};for(const e of v.joints){const N=Y.Get(`${S}/joints/${e}`,this._gltf.nodes,e);this._loadBone(N,v,D,z)}}_findSkeletonRootNode(S,v){if(0===v.length)return null;const D={};for(const e of v){const v=[];let z=Y.Get(`${S}/${e}`,this._gltf.nodes,e);for(;-1!==z.index;)v.unshift(z),z=z.parent;D[e]=v}let z=null;for(let e=0;;++e){let S=D[v[0]];if(e>=S.length)return z;const N=S[e];for(let m=1;m<v.length;++m)if(S=D[v[m]],e>=S.length||N!==S[e])return z;z=N}}_loadBone(S,v,D,z){S._isJoint=!0;let e=z[S.index];if(e)return e;let N=null;S.index!==v.skeleton&&(S.parent&&-1!==S.parent.index?N=this._loadBone(S.parent,v,D,z):void 0!==v.skeleton&&O.b.Warn(`/skins/${v.index}/skeleton: Skeleton node is not a common root`));const m=v.joints.indexOf(S.index);return e=new E.d(S.name||`joint${S.index}`,D,N,this._getNodeMatrix(S),null,null,m),z[S.index]=e,this._postSceneLoadActions.push((()=>{e.linkTransformNode(S._babylonTransformNode)})),e}_loadSkinInverseBindMatricesDataAsync(S,v){if(void 0==v.inverseBindMatrices)return Promise.resolve(null);const D=Y.Get(`${S}/inverseBindMatrices`,this._gltf.accessors,v.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${D.index}`,D)}_updateBoneMatrices(S,v){for(const D of S.bones){const S=e.Matrix.Identity(),z=D._index;v&&-1!==z&&(e.Matrix.FromArrayToRef(v,16*z,S),S.invertToRef(S));const N=D.getParent();N&&S.multiplyToRef(N.getAbsoluteInverseBindMatrix(),S),D.pe(S,!1,!1),D._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(S){return S.matrix?e.Matrix.uv(S.matrix):e.Matrix.Compose(S.scale?e.Rv.uv(S.scale):e.Rv.One(),S.rotation?e.Quaternion.uv(S.rotation):e.Quaternion.Identity(),S.translation?e.Rv.uv(S.translation):e.Rv.Zero())}loadCameraAsync(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadCameraAsync(S,v,D);if(z)return z;const N=new Array;this.logOpen(`${S} ${v.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const m=new g.c(v.name||`camera${v.index}`,e.Rv.Zero(),this._babylonScene,!1);switch(m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._babylonCamera=m,m.setTarget(new e.Rv(0,0,-1)),v.type){case"perspective":{const D=v.perspective;if(!D)throw new Error(`${S}: Camera perspective properties are missing`);m.fov=D.yfov,m.xe=D.znear,m.maxZ=D.zfar||0;break}case"orthographic":if(!v.orthographic)throw new Error(`${S}: Camera orthographic properties are missing`);m.mode=B.b.ORTHOGRAPHIC_CAMERA,m.orthoLeft=-v.orthographic.xmag,m.orthoRight=v.orthographic.xmag,m.orthoBottom=-v.orthographic.ymag,m.orthoTop=v.orthographic.ymag,m.xe=v.orthographic.znear,m.maxZ=v.orthographic.zfar;break;default:throw new Error(`${S}: Invalid camera type (${v.type})`)}return V.AddPointerMetadata(m,S),this._parent.onCameraLoadedObservable.notifyObservers(m),D(m),this.logClose(),Promise.all(N).then((()=>m))}_loadAnimationsAsync(){const S=this._gltf.animations;if(!S)return Promise.resolve();const v=new Array;for(let D=0;D<S.length;D++){const z=S[D];v.push(this.loadAnimationAsync(`/animations/${z.index}`,z).then((S=>{0===S.targetedAnimations.length&&S.dispose()})))}return Promise.all(v).then((()=>{}))}loadAnimationAsync(S,v){const z=this._extensionsLoadAnimationAsync(S,v);return z||D.e(78).then(D.bind(D,14571)).then((D=>{let{AnimationGroup:z}=D;this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new z(v.name||`animation${v.index}`,this._babylonScene);e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._babylonAnimationGroup=e;const N=new Array;Y.Assign(v.channels),Y.Assign(v.samplers);for(const m of v.channels)N.push(this._loadAnimationChannelAsync(`${S}/channels/${m.index}`,S,v,m,((S,v)=>{S.animations=S.animations||[],S.animations.push(v),e.addTargetedAnimation(v,S)})));return Promise.all(N).then((()=>(e.normalize(0),e)))}))}async _loadAnimationChannelAsync(S,v,z,e,N){const m=this._extensionsLoadAnimationChannelAsync(S,v,z,e,N);if(m)return await m;if(void 0==e.target.node)return await Promise.resolve();const B=Y.Get(`${S}/target/node`,this._gltf.nodes,e.target.node),g=e.target.path,E="weights"===g;if(E&&!B._numMorphTargets||!E&&!B._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!E&&!B._isJoint)return await Promise.resolve();let h;switch(await Promise.resolve().then(D.bind(D,13062)),g){case"translation":var A;h=null===(A=(0,H.g)("/nodes/{}/translation"))||void 0===A?void 0:A.interpolation;break;case"rotation":var w;h=null===(w=(0,H.g)("/nodes/{}/rotation"))||void 0===w?void 0:w.interpolation;break;case"scale":var n;h=null===(n=(0,H.g)("/nodes/{}/scale"))||void 0===n?void 0:n.interpolation;break;case"weights":var R;h=null===(R=(0,H.g)("/nodes/{}/weights"))||void 0===R?void 0:R.interpolation;break;default:throw new Error(`${S}/target/path: Invalid value (${e.target.path})`)}if(!h)throw new Error(`${S}/target/path: Could not find interpolation properties for target path (${e.target.path})`);const O={object:B,info:h};return await this._loadAnimationChannelFromTargetInfoAsync(S,v,z,e,O,N)}_loadAnimationChannelFromTargetInfoAsync(S,v,D,z,e,N){const m=this.parent.targetFps,B=1/m,g=Y.Get(`${S}/sampler`,D.samplers,z.sampler);return this._loadAnimationSamplerAsync(`${v}/samplers/${z.sampler}`,g).then((S=>{let v=0;const g=e.object,E=e.info;for(const e of E){const E=e.getStride(g),h=S.input,A=S.output,w=new Array(h.length);let n=0;switch(S.interpolation){case"STEP":for(let S=0;S<h.length;S++){const v=e.getValue(g,A,n,1);n+=E,w[S]={frame:h[S]*m,value:v,interpolation:1}}break;case"CUBICSPLINE":for(let S=0;S<h.length;S++){const v=e.getValue(g,A,n,B);n+=E;const D=e.getValue(g,A,n,1);n+=E;const z=e.getValue(g,A,n,B);n+=E,w[S]={frame:h[S]*m,inTangent:v,value:D,outTangent:z}}break;case"LINEAR":for(let S=0;S<h.length;S++){const v=e.getValue(g,A,n,1);n+=E,w[S]={frame:h[S]*m,value:v}}}if(n>0){const S=`${D.name||`animation${D.index}`}_channel${z.index}_${v}`,B=e.buildAnimations(g,S,m,w);for(const D of B)v++,N(D.babylonAnimatable,D.babylonAnimation)}}}))}_loadAnimationSamplerAsync(S,v){if(v._data)return v._data;const D=v.interpolation||"LINEAR";switch(D){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${S}/interpolation: Invalid value (${v.interpolation})`)}const z=Y.Get(`${S}/input`,this._gltf.accessors,v.input),e=Y.Get(`${S}/output`,this._gltf.accessors,v.output);return v._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${z.index}`,z),this._loadFloatAccessorAsync(`/accessors/${e.index}`,e)]).then((S=>{let[v,z]=S;return{input:v,interpolation:D,output:z}})),v._data}loadBufferAsync(S,v,D,z){const e=this._extensionsLoadBufferAsync(S,v,D,z);if(e)return e;if(!v._data)if(v.uri)v._data=this.loadUriAsync(`${S}/uri`,v,v.uri);else{if(!this._bin)throw new Error(`${S}: Uri is missing or the binary glTF is missing its binary chunk`);v._data=this._bin.readAsync(0,v.byteLength)}return v._data.then((v=>{try{return new Uint8Array(v.buffer,v.byteOffset+D,z)}catch(e){throw new Error(`${S}: ${e.message}`)}}))}loadBufferViewAsync(S,v){const D=this._extensionsLoadBufferViewAsync(S,v);if(D)return D;if(v._data)return v._data;const z=Y.Get(`${S}/buffer`,this._gltf.buffers,v.buffer);return v._data=this.loadBufferAsync(`/buffers/${z.index}`,z,v.byteOffset||0,v.byteLength),v._data}_loadAccessorAsync(S,v,D){if(v._data)return v._data;const z=V._GetNumComponents(S,v.type),e=z*d.d.GetTypeByteLength(v.componentType),N=z*v.count;if(void 0==v.bufferView)v._data=Promise.resolve(new D(N));else{const m=Y.Get(`${S}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${m.index}`,m).then((B=>{if(5126!==v.componentType||v.normalized||m.byteStride&&m.byteStride!==e){const S=new D(N);return d.d.ForEach(B,v.byteOffset||0,m.byteStride||e,z,v.componentType,S.length,v.normalized||!1,((v,D)=>{S[D]=v})),S}return V._GetTypedArray(S,v.componentType,B,v.byteOffset,N)}))}if(v.sparse){const N=v.sparse;v._data=v._data.then((m=>{const B=m,g=Y.Get(`${S}/sparse/indices/bufferView`,this._gltf.bufferViews,N.indices.bufferView),E=Y.Get(`${S}/sparse/values/bufferView`,this._gltf.bufferViews,N.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${g.index}`,g),this.loadBufferViewAsync(`/bufferViews/${E.index}`,E)]).then((m=>{let[g,E]=m;const h=V._GetTypedArray(`${S}/sparse/indices`,N.indices.componentType,g,N.indices.byteOffset,N.count),A=z*N.count;let w;if(5126!==v.componentType||v.normalized){const m=V._GetTypedArray(`${S}/sparse/values`,v.componentType,E,N.values.byteOffset,A);w=new D(A),d.d.ForEach(m,0,e,z,v.componentType,w.length,v.normalized||!1,((S,v)=>{w[v]=S}))}else w=V._GetTypedArray(`${S}/sparse/values`,v.componentType,E,N.values.byteOffset,A);let n=0;for(let S=0;S<h.length;S++){let v=h[S]*z;for(let S=0;S<z;S++)B[v++]=w[n++]}return B}))}))}return v._data}_loadFloatAccessorAsync(S,v){return this._loadAccessorAsync(S,v,Float32Array)}_loadIndicesAccessorAsync(S,v){if("SCALAR"!==v.type)throw new Error(`${S}/type: Invalid value ${v.type}`);if(5121!==v.componentType&&5123!==v.componentType&&5125!==v.componentType)throw new Error(`${S}/componentType: Invalid value ${v.componentType}`);if(v._data)return v._data;if(v.sparse){const D=V._GetTypedArrayConstructor(`${S}/componentType`,v.componentType);v._data=this._loadAccessorAsync(S,v,D)}else{const D=Y.Get(`${S}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${D.index}`,D).then((D=>V._GetTypedArray(S,v.componentType,D,v.byteOffset,v.count)))}return v._data}_loadVertexBufferViewAsync(S){if(S._babylonBuffer)return S._babylonBuffer;const v=this._babylonScene.getEngine();return S._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${S.index}`,S).then((S=>new d.b(v,S,!1))),S._babylonBuffer}_loadVertexAccessorAsync(S,v,D){var z;if(null!==(z=v._babylonVertexBuffer)&&void 0!==z&&z[D])return v._babylonVertexBuffer[D];v._babylonVertexBuffer||(v._babylonVertexBuffer={});const e=this._babylonScene.getEngine();if(v.sparse||void 0==v.bufferView)v._babylonVertexBuffer[D]=this._loadFloatAccessorAsync(S,v).then((S=>new d.d(e,S,D,!1)));else{const z=Y.Get(`${S}/bufferView`,this._gltf.bufferViews,v.bufferView);v._babylonVertexBuffer[D]=this._loadVertexBufferViewAsync(z).then((N=>{const m=V._GetNumComponents(S,v.type);return new d.d(e,N,D,!1,void 0,z.byteStride,void 0,v.byteOffset,m,v.componentType,v.normalized,!0,void 0,!0)}))}return v._babylonVertexBuffer[D]}_loadMaterialMetallicRoughnessPropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;return v&&(v.baseColorFactor?(D.albedoColor=N.qv.uv(v.baseColorFactor),D.alpha=v.baseColorFactor[3]):D.albedoColor=N.qv.White(),D.metallic=void 0==v.metallicFactor?1:v.metallicFactor,D.roughness=void 0==v.roughnessFactor?1:v.roughnessFactor,v.baseColorTexture&&z.push(this.loadTextureInfoAsync(`${S}/baseColorTexture`,v.baseColorTexture,(S=>{S.name=`${D.name} (Base Color)`,D.albedoTexture=S}))),v.metallicRoughnessTexture&&(v.metallicRoughnessTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${S}/metallicRoughnessTexture`,v.metallicRoughnessTexture,(S=>{S.name=`${D.name} (Metallic Roughness)`,D.metallicTexture=S}))),D.useMetallnessFromMetallicTextureBlue=!0,D.useRoughnessFromMetallicTextureGreen=!0,D.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(z).then((()=>{}))}_loadMaterialAsync(S,v,D,z){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const N=this._extensionsLoadMaterialAsync(S,v,D,z,e);if(N)return N;v._data=v._data||{};let m=v._data[z];if(!m){this.logOpen(`${S} ${v.name||""}`);const D=this.createMaterial(S,v,z);m={babylonMaterial:D,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(S,v,D)},v._data[z]=m,V.AddPointerMetadata(D,S),this._parent.onMaterialLoadedObservable.notifyObservers(D),this.logClose()}return D&&(m.babylonMeshes.push(D),D.Se.addOnce((()=>{const S=m.babylonMeshes.indexOf(D);-1!==S&&m.babylonMeshes.splice(S,1)}))),e(m.babylonMaterial),m.promise.then((()=>m.babylonMaterial))}_createDefaultMaterial(S,v){this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new u.d(S,this._babylonScene);return D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D.fillMode=v,D.enableSpecularAntiAliasing=!0,D.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,D.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,D.transparencyMode=u.d.PBRMATERIAL_OPAQUE,D.metallic=1,D.roughness=1,D}createMaterial(S,v,D){const z=this._extensionsCreateMaterial(S,v,D);if(z)return z;const e=v.name||`material${v.index}`;return this._createDefaultMaterial(e,D)}loadMaterialPropertiesAsync(S,v,D){const z=this._extensionsLoadMaterialPropertiesAsync(S,v,D);if(z)return z;const e=new Array;return e.push(this.loadMaterialBasePropertiesAsync(S,v,D)),v.pbrMetallicRoughness&&e.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${S}/pbrMetallicRoughness`,v.pbrMetallicRoughness,D)),this.loadMaterialAlphaProperties(S,v,D),Promise.all(e).then((()=>{}))}loadMaterialBasePropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;return D.emissiveColor=v.emissiveFactor?N.qv.uv(v.emissiveFactor):new N.qv(0,0,0),v.doubleSided&&(D.Xe=!1,D.twoSidedLighting=!0),v.normalTexture&&(v.normalTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${S}/normalTexture`,v.normalTexture,(S=>{S.name=`${D.name} (Normal)`,D.bumpTexture=S}))),D.invertNormalMapX=!this._babylonScene.useRightHandedSystem,D.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=v.normalTexture.scale&&D.bumpTexture&&(D.bumpTexture.level=v.normalTexture.scale),D.forceIrradianceInFragment=!0),v.occlusionTexture&&(v.occlusionTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${S}/occlusionTexture`,v.occlusionTexture,(S=>{S.name=`${D.name} (Occlusion)`,D.ambientTexture=S}))),D.useAmbientInGrayScale=!0,void 0!=v.occlusionTexture.strength&&(D.ambientTextureStrength=v.occlusionTexture.strength)),v.emissiveTexture&&z.push(this.loadTextureInfoAsync(`${S}/emissiveTexture`,v.emissiveTexture,(S=>{S.name=`${D.name} (Emissive)`,D.emissiveTexture=S}))),Promise.all(z).then((()=>{}))}loadMaterialAlphaProperties(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);switch(v.alphaMode||"OPAQUE"){case"OPAQUE":D.transparencyMode=u.d.PBRMATERIAL_OPAQUE,D.alpha=1;break;case"MASK":D.transparencyMode=u.d.PBRMATERIAL_ALPHATEST,D.alphaCutOff=void 0==v.alphaCutoff?.5:v.alphaCutoff,D.albedoTexture&&(D.albedoTexture.de=!0);break;case"BLEND":D.transparencyMode=u.d.PBRMATERIAL_ALPHABLEND,D.albedoTexture&&(D.albedoTexture.de=!0,D.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${S}/alphaMode: Invalid value (${v.alphaMode})`)}}loadTextureInfoAsync(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureInfoAsync(S,v,D);if(z)return z;if(this.logOpen(`${S}`),v.texCoord>=6)throw new Error(`${S}/texCoord: Invalid value (${v.texCoord})`);const e=Y.Get(`${S}/index`,this._gltf.textures,v.index);e._textureInfo=v;const N=this._loadTextureAsync(`/textures/${v.index}`,e,(z=>{z.coordinatesIndex=v.texCoord||0,V.AddPointerMetadata(z,S),this._parent.onTextureLoadedObservable.notifyObservers(z),D(z)}));return this.logClose(),N}_loadTextureAsync(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureAsync(S,v,D);if(z)return z;this.logOpen(`${S} ${v.name||""}`);const e=void 0==v.sampler?V.DefaultSampler:Y.Get(`${S}/sampler`,this._gltf.samplers,v.sampler),N=Y.Get(`${S}/source`,this._gltf.images,v.source),m=this._createTextureAsync(S,e,N,D,void 0,!v._textureInfo.nonColorData);return this.logClose(),m}_createTextureAsync(S,v,D){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},N=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0;const B=this._loadSampler(`/samplers/${v.index}`,v),g=new Array,E=new z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:B.noMipMaps,invertY:!1,samplingMode:B.samplingMode,l:()=>{this._disposed||E.resolve()},onError:(v,D)=>{this._disposed||E.reject(new Error(`${S}: ${D&&D.message?D.message:v||"Failed to load texture"}`))},mimeType:D.mimeType??(0,X.h)(D.uri??""),loaderOptions:N,useSRGBBuffer:!!m&&this._parent.useSRGBBuffers},A=new s.d(null,this._babylonScene,h);return A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.push(E.promise),g.push(this.loadImageAsync(`/images/${D.index}`,D).then((S=>{const v=D.uri||`${this._fileName}#image${D.index}`,z=`data:${this._uniqueRootUrl}${v}`;A.updateURL(z,S);const e=A.getInternalTexture();e&&(e.label=D.name)}))),A.wrapU=B.wrapU,A.wrapV=B.wrapV,e(A),this._parent.useGltfTextureNames&&(A.name=D.name||D.uri||`image${D.index}`),Promise.all(g).then((()=>A))}_loadSampler(S,v){return v._data||(v._data={noMipMaps:9728===v.minFilter||9729===v.minFilter,samplingMode:V._GetTextureSamplingMode(S,v),wrapU:V._GetTextureWrapMode(`${S}/wrapS`,v.wrapS),wrapV:V._GetTextureWrapMode(`${S}/wrapT`,v.wrapT)}),v._data}loadImageAsync(S,v){if(!v._data){if(this.logOpen(`${S} ${v.name||""}`),v.uri)v._data=this.loadUriAsync(`${S}/uri`,v,v.uri);else{const D=Y.Get(`${S}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${D.index}`,D)}this.logClose()}return v._data}loadUriAsync(S,v,D){const z=this._extensionsLoadUriAsync(S,v,D);if(z)return z;if(!V._ValidateUri(D))throw new Error(`${S}: '${D}' is invalid`);if((0,X.j)(D)){const v=new Uint8Array((0,X.c)(D));return this.log(`${S}: Decoded ${D.substring(0,64)}... (${v.length} bytes)`),Promise.resolve(v)}return this.log(`${S}: Loading ${D}`),this._parent.preprocessUrlAsync(this._rootUrl+D).then((v=>new Promise(((z,e)=>{this._parent._loadFile(this._babylonScene,v,(v=>{this._disposed||(this.log(`${S}: Loaded ${D} (${v.byteLength} bytes)`),z(new Uint8Array(v)))}),!0,(v=>{e(new X.k(`${S}: Failed to load '${D}'${v?": "+v.status+" "+v.statusText:""}`,v))}))}))))}static AddPointerMetadata(S,v){S.metadata=S.metadata||{};const D=S._internalMetadata=S._internalMetadata||{},z=D.me=D.me||{};(z.pointers=z.pointers||[]).push(v)}static _GetTextureWrapMode(S,v){switch(v=void 0==v?10497:v){case 33071:return s.d.CLAMP_ADDRESSMODE;case 33648:return s.d.MIRROR_ADDRESSMODE;case 10497:return s.d.WRAP_ADDRESSMODE;default:return O.b.Warn(`${S}: Invalid value (${v})`),s.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(S,v){const D=void 0==v.magFilter?9729:v.magFilter,z=void 0==v.minFilter?9987:v.minFilter;if(9729===D)switch(z){case 9728:return s.d.LINEAR_NEAREST;case 9729:return s.d.LINEAR_LINEAR;case 9984:return s.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return s.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return s.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return s.d.LINEAR_LINEAR_MIPLINEAR;default:return O.b.Warn(`${S}/minFilter: Invalid value (${z})`),s.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==D&&O.b.Warn(`${S}/magFilter: Invalid value (${D})`),z){case 9728:return s.d.NEAREST_NEAREST;case 9729:return s.d.NEAREST_LINEAR;case 9984:return s.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return s.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return s.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return s.d.NEAREST_LINEAR_MIPLINEAR;default:return O.b.Warn(`${S}/minFilter: Invalid value (${z})`),s.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(S,v){try{return(0,G.o)(v)}catch(D){throw new Error(`${S}: ${D.message}`)}}static _GetTypedArray(S,v,D,z,e){const N=D.buffer;z=D.byteOffset+(z||0);const m=V._GetTypedArrayConstructor(`${S}/componentType`,v),B=d.d.GetTypeByteLength(v);return z%B!==0?(O.b.Warn(`${S}: Copying buffer as byte offset (${z}) is not a multiple of component type byte length (${B})`),new m(N.slice(z,z+e*B),0)):new m(N,z,e)}static _GetNumComponents(S,v){switch(v){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${S}: Invalid type (${v})`)}static _ValidateUri(S){return m.Tools.IsBase64(S)||-1===S.indexOf("..")}static _GetDrawMode(S,v){switch(void 0==v&&(v=4),v){case 0:return q.d.PointListDrawMode;case 1:return q.d.LineListDrawMode;case 2:return q.d.LineLoopDrawMode;case 3:return q.d.LineStripDrawMode;case 4:return q.d.TriangleFillMode;case 5:return q.d.TriangleStripDrawMode;case 6:return q.d.TriangleFanDrawMode}throw new Error(`${S}: Invalid mesh primitive mode (${v})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const S=new Array;if(this._gltf.materials)for(const v of this._gltf.materials)if(v._data)for(const D in v._data){const z=v._data[D];for(const v of z.babylonMeshes){v.ke(!0);const D=z.babylonMaterial;S.push(D.forceCompilationAsync(v)),S.push(D.forceCompilationAsync(v,{useInstances:!0})),this._parent.useClipPlane&&(S.push(D.forceCompilationAsync(v,{clipPlane:!0})),S.push(D.forceCompilationAsync(v,{clipPlane:!0,useInstances:!0})))}}return Promise.all(S).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const S=new Array,v=this._babylonScene.lights;for(const D of v){const v=D.getShadowGenerator();v&&S.push(v.forceCompilationAsync())}return Promise.all(S).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(S){for(const v of this._extensions)v.enabled&&S(v)}_applyExtensions(S,v,D){for(const z of this._extensions)if(z.enabled){const e=`${z.name}.${v}`,N=S;N._activeLoaderExtensionFunctions=N._activeLoaderExtensionFunctions||{};const m=N._activeLoaderExtensionFunctions;if(!m[e]){m[e]=!0;try{const S=D(z);if(S)return S}finally{delete m[e]}}}return null}_extensionsOnLoading(){this._forEachExtensions((S=>S.onLoading&&S.onLoading()))}_extensionsOnReady(){this._forEachExtensions((S=>S.onReady&&S.onReady()))}_extensionsLoadSceneAsync(S,v){return this._applyExtensions(v,"loadScene",(D=>D.loadSceneAsync&&D.loadSceneAsync(S,v)))}_extensionsLoadNodeAsync(S,v,D){return this._applyExtensions(v,"loadNode",(z=>z.loadNodeAsync&&z.loadNodeAsync(S,v,D)))}_extensionsLoadCameraAsync(S,v,D){return this._applyExtensions(v,"loadCamera",(z=>z.loadCameraAsync&&z.loadCameraAsync(S,v,D)))}_extensionsLoadVertexDataAsync(S,v,D){return this._applyExtensions(v,"loadVertexData",(z=>z._loadVertexDataAsync&&z._loadVertexDataAsync(S,v,D)))}_extensionsLoadMeshPrimitiveAsync(S,v,D,z,e,N){return this._applyExtensions(e,"loadMeshPrimitive",(m=>m._loadMeshPrimitiveAsync&&m._loadMeshPrimitiveAsync(S,v,D,z,e,N)))}_extensionsLoadMaterialAsync(S,v,D,z,e){return this._applyExtensions(v,"loadMaterial",(N=>N._loadMaterialAsync&&N._loadMaterialAsync(S,v,D,z,e)))}_extensionsCreateMaterial(S,v,D){return this._applyExtensions(v,"createMaterial",(z=>z.createMaterial&&z.createMaterial(S,v,D)))}_extensionsLoadMaterialPropertiesAsync(S,v,D){return this._applyExtensions(v,"loadMaterialProperties",(z=>z.loadMaterialPropertiesAsync&&z.loadMaterialPropertiesAsync(S,v,D)))}_extensionsLoadTextureInfoAsync(S,v,D){return this._applyExtensions(v,"loadTextureInfo",(z=>z.loadTextureInfoAsync&&z.loadTextureInfoAsync(S,v,D)))}_extensionsLoadTextureAsync(S,v,D){return this._applyExtensions(v,"loadTexture",(z=>z._loadTextureAsync&&z._loadTextureAsync(S,v,D)))}_extensionsLoadAnimationAsync(S,v){return this._applyExtensions(v,"loadAnimation",(D=>D.loadAnimationAsync&&D.loadAnimationAsync(S,v)))}_extensionsLoadAnimationChannelAsync(S,v,D,z,e){return this._applyExtensions(D,"loadAnimationChannel",(N=>N._loadAnimationChannelAsync&&N._loadAnimationChannelAsync(S,v,D,z,e)))}_extensionsLoadSkinAsync(S,v,D){return this._applyExtensions(D,"loadSkin",(z=>z._loadSkinAsync&&z._loadSkinAsync(S,v,D)))}_extensionsLoadUriAsync(S,v,D){return this._applyExtensions(v,"loadUri",(z=>z._loadUriAsync&&z._loadUriAsync(S,v,D)))}_extensionsLoadBufferViewAsync(S,v){return this._applyExtensions(v,"loadBufferView",(D=>D.loadBufferViewAsync&&D.loadBufferViewAsync(S,v)))}_extensionsLoadBufferAsync(S,v,D,z){return this._applyExtensions(v,"loadBuffer",(e=>e.loadBufferAsync&&e.loadBufferAsync(S,v,D,z)))}static LoadExtensionAsync(S,v,D,z){if(!v.extensions)return null;const e=v.extensions[D];return e?z(`${S}/extensions/${D}`,e):null}static LoadExtraAsync(S,v,D,z){if(!v.extras)return null;const e=v.extras[D];return e?z(`${S}/extras/${D}`,e):null}isExtensionUsed(S){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(S)}logOpen(S){this._parent._logOpen(S)}logClose(){this._parent._logClose()}log(S){this._parent._log(S)}startPerformanceCounter(S){this._parent._startPerformanceCounter(S)}endPerformanceCounter(S){this._parent._endPerformanceCounter(S)}}V.DefaultSampler={index:-1},t.b._CreateGLTF2Loader=S=>new V(S);var U=D(13062),y=D(11573),f=D(11415),C=D(13069),F=D(13074);class l extends F.d{constructor(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",S),this._texture=S.getEngine().createRawCubeTexture(v,D,z,e,N,m,B,g)}update(S,v,D,z){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,S,v,D,z,e)}updateRGBDAsync(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,C.m)(this._texture,S,v,D,z).then((()=>{}))}clone(){return f.b.Clone((()=>{const S=this.xS(),v=this._texture,D=new l(S,v._bufferViewArray,v.width,v.format,v.type,v.generateMipMaps,v.invertY,v.samplingMode,v._compression);return 13===v.source&&D.updateRGBDAsync(v._bufferViewArrayArray,v._sphericalPolynomial,v._lodGenerationScale,v._lodGenerationOffset),D}),this)}}const P="EXT_lights_image_based";class Q{constructor(S){this.name=P,this._loader=S,this.enabled=this._loader.isExtensionUsed(P)}dispose(){this._loader=null,delete this._lights}onLoading(){const S=this._loader.me.extensions;if(S&&S[this.name]){const v=S[this.name];this._lights=v.lights}}loadSceneAsync(S,v){return V.LoadExtensionAsync(S,v,this.name,(async(D,z)=>{this._loader._allMaterialsDirtyRequired=!0;const e=new Array;e.push(this._loader.loadSceneAsync(S,v)),this._loader.logOpen(`${D}`);const N=Y.Get(`${D}/light`,this._lights,z.nz);return e.push(this._loadLightAsync(`/extensions/${this.name}/lights/${z.nz}`,N).then((S=>{this._loader.babylonScene.environmentTexture=S}))),this._loader.logClose(),await Promise.all(e).then((()=>{}))}))}_loadLightAsync(S,v){if(!v._loaded){const D=new Array;this._loader.logOpen(`${S}`);const z=new Array(v.specularImages.length);for(let e=0;e<v.specularImages.length;e++){const N=v.specularImages[e];z[e]=new Array(N.length);for(let v=0;v<N.length;v++){const m=`${S}/specularImages/${e}/${v}`;this._loader.logOpen(`${m}`);const B=N[v],g=Y.Get(m,this._loader.me.images,B);D.push(this._loader.loadImageAsync(`/images/${B}`,g).then((S=>{z[e][v]=S}))),this._loader.logClose()}}this._loader.logClose(),v._loaded=Promise.all(D).then((async()=>{const D=new l(this._loader.babylonScene,null,v.specularImageSize);if(D.name=v.name||"environment",v._babylonTexture=D,void 0!=v.le&&(D.level=v.le),v.rotation){let S=e.Quaternion.uv(v.rotation);this._loader.babylonScene.useRightHandedSystem||(S=e.Quaternion.Inverse(S)),e.Matrix.FromQuaternionToRef(S,D.getReflectionTextureMatrix())}if(!v.irradianceCoefficients)throw new Error(`${S}: Irradiance coefficients are missing`);const N=y.d.uv(v.irradianceCoefficients);N.scaleInPlace(v.le),N.convertIrradianceToLambertianRadiance();const m=y.g.FromHarmonics(N),B=(z.length-1)/Math.log2(v.specularImageSize);return await D.updateRGBDAsync(z,m,B)}))}return v._loaded.then((()=>v._babylonTexture))}}J(P),c(P,!0,(S=>new Q(S)));D(11915);const L="EXT_mesh_gpu_instancing";class SS{constructor(S){this.name=L,this._loader=S,this.enabled=this._loader.isExtensionUsed(L)}dispose(){this._loader=null}loadNodeAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(S,z)=>{this._loader._disableInstancedMesh++;const N=this._loader.loadNodeAsync(`/nodes/${v.index}`,v,D);if(this._loader._disableInstancedMesh--,!v._primitiveBabylonMeshes)return await N;const m=new Array;let B=0;const g=v=>{if(void 0==z.attributes[v])return void m.push(Promise.resolve(null));const D=Y.Get(`${S}/attributes/${v}`,this._loader.me.accessors,z.attributes[v]);if(m.push(this._loader._loadFloatAccessorAsync(`/accessors/${D.bufferView}`,D)),0===B)B=D.count;else if(B!==D.count)throw new Error(`${S}/attributes: Instance buffer accessors do not have the same count.`)};return g("TRANSLATION"),g("ROTATION"),g("SCALE"),await N.then((async S=>{const[D,z,N]=await Promise.all(m),g=new Float32Array(16*B);e.TmpVectors.Rv[0].oe(0,0,0),e.TmpVectors.Quaternion[0].oe(0,0,0,1),e.TmpVectors.Rv[1].oe(1,1,1);for(let v=0;v<B;++v)D&&e.Rv.FromArrayToRef(D,3*v,e.TmpVectors.Rv[0]),z&&e.Quaternion.FromArrayToRef(z,4*v,e.TmpVectors.Quaternion[0]),N&&e.Rv.FromArrayToRef(N,3*v,e.TmpVectors.Rv[1]),e.Matrix.ComposeToRef(e.TmpVectors.Rv[1],e.TmpVectors.Quaternion[0],e.TmpVectors.Rv[0],e.TmpVectors.Matrix[0]),e.TmpVectors.Matrix[0].copyToArray(g,16*v);for(const e of v._primitiveBabylonMeshes)e.CA("matrix",g,16,!0);return S}))}))}}J(L),c(L,!0,(S=>new SS(S)));let vS=0,DS=null;class zS{static get Default(){return zS._Default||(zS._Default=new zS),zS._Default}constructor(){const S=zS.Configuration.decoder;this._decoderModulePromise=m.Tools.LoadBabylonScriptAsync(S.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(S,v,D,z,e){await this._decoderModulePromise,0===vS&&(MeshoptDecoder.useWorkers(1),vS=1);const N=await MeshoptDecoder.decodeGltfBufferAsync(v,D,S,z,e);return null!==DS&&clearTimeout(DS),DS=setTimeout((()=>{MeshoptDecoder.useWorkers(0),vS=0,DS=null}),1e3),N}}zS.Configuration={decoder:{url:`${m.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},zS._Default=null;const eS="EXT_meshopt_compression";class NS{constructor(S){this.name=eS,this.enabled=S.isExtensionUsed(eS),this._loader=S}dispose(){this._loader=null}loadBufferViewAsync(S,v){return V.LoadExtensionAsync(S,v,this.name,(async(D,z)=>{const e=v;if(e._meshOptData)return await e._meshOptData;const N=Y.Get(`${S}/buffer`,this._loader.me.buffers,z.buffer);return e._meshOptData=this._loader.loadBufferAsync(`/buffers/${N.index}`,N,z.byteOffset||0,z.byteLength).then((async S=>await zS.Default.decodeGltfBufferAsync(S,z.count,z.byteStride,z.mode,z.filter))),await e._meshOptData}))}}J(eS),c(eS,!0,(S=>new NS(S)));const mS="EXT_texture_webp";class BS{constructor(S){this.name=mS,this._loader=S,this.enabled=S.isExtensionUsed(mS)}dispose(){this._loader=null}_loadTextureAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=void 0==v.sampler?V.DefaultSampler:Y.Get(`${S}/sampler`,this._loader.me.samplers,v.sampler),m=Y.Get(`${z}/source`,this._loader.me.images,e.source);return await this._loader._createTextureAsync(S,N,m,(S=>{D(S)}),void 0,!v._textureInfo.nonColorData)}))}}J(mS),c(mS,!0,(S=>new BS(S)));const gS="EXT_texture_avif";class ES{constructor(S){this.name=gS,this._loader=S,this.enabled=S.isExtensionUsed(gS)}dispose(){this._loader=null}_loadTextureAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=void 0==v.sampler?V.DefaultSampler:Y.Get(`${S}/sampler`,this._loader.me.samplers,v.sampler),m=Y.Get(`${z}/source`,this._loader.me.images,e.source);return await this._loader._createTextureAsync(S,N,m,(S=>{D(S)}),void 0,!v._textureInfo.nonColorData)}))}}J(gS),c(gS,!0,(S=>new ES(S)));var hS=D(13055),AS=D(11901);const wS="EXT_lights_ies";class nS{constructor(S){this.name=wS,this._loader=S,this.enabled=this._loader.isExtensionUsed(wS)}dispose(){this._loader=null,delete this._lights}onLoading(){const S=this._loader.me.extensions;if(S&&S[this.name]){const v=S[this.name];this._lights=v.lights,Y.Assign(this._lights)}}loadNodeAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,m)=>{let B,g;this._loader._allMaterialsDirtyRequired=!0;const E=await this._loader.loadNodeAsync(S,v,(S=>{g=Y.Get(z,this._lights,m.nz);const v=g.name||S.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,B=new hS.d(v,e.Rv.Zero(),e.Rv.Backward(),0,1,this._loader.babylonScene),B.angle=Math.PI/2,B.innerAngle=0,B._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,g._babylonLight=B,B.falloffType=AS.b.FALLOFF_GLTF,B.sB=m.color?N.qv.uv(m.color):N.qv.White(),B.le=m.multiplier||1,B.range=Number.MAX_VALUE,B.parent=S,this._loader._babylonLights.push(B),V.AddPointerMetadata(B,z),D(S)}));let h;if(g.uri)h=await this._loader.loadUriAsync(S,g,g.uri);else{const v=Y.Get(`${S}/bufferView`,this._loader.me.bufferViews,g.bufferView);h=await this._loader.loadBufferViewAsync(`/bufferViews/${v.index}`,v)}return B.iesProfileTexture=new s.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,h,!0,void 0,void 0,void 0,void 0,".ies"),E}))}}J(wS),c(wS,!0,(S=>new nS(S)));var RS=D(13088);const OS="KHR_draco_mesh_compression";class IS{constructor(S){this.name=OS,this.useNormalizedFlagFromAccessor=!0,this._loader=S,this.enabled=RS.d.DefaultAvailable&&this._loader.isExtensionUsed(OS)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{if(void 0!=v.mode&&4!==v.mode&&5!==v.mode)throw new Error(`${S}: Unsupported mode ${v.mode}`);const N={},m={},B=(S,z)=>{const B=e.attributes[S];if(void 0!=B&&(D._delayInfo=D._delayInfo||[],-1===D._delayInfo.indexOf(z)&&D._delayInfo.push(z),N[z]=B,this.useNormalizedFlagFromAccessor)){const D=Y.TryGet(this._loader.me.accessors,v.attributes[S]);D&&(m[z]=D.normalized||!1)}};B("POSITION",d.d.PositionKind),B("NORMAL",d.d.NormalKind),B("TANGENT",d.d.TangentKind),B("TEXCOORD_0",d.d.UVKind),B("TEXCOORD_1",d.d.UV2Kind),B("TEXCOORD_2",d.d.UV3Kind),B("TEXCOORD_3",d.d.UV4Kind),B("TEXCOORD_4",d.d.UV5Kind),B("TEXCOORD_5",d.d.UV6Kind),B("JOINTS_0",d.d.MatricesIndicesKind),B("WEIGHTS_0",d.d.MatricesWeightsKind),B("COLOR_0",d.d.ColorKind);const g=Y.Get(z,this._loader.me.bufferViews,e.bufferView);return g._dracoBabylonGeometry||(g._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((async z=>{const e=this.dracoDecoder||RS.d.Default,B=Y.TryGet(this._loader.me.accessors,v.attributes.POSITION),g=this._loader.parent.alwaysComputeBoundingBox||D.skeleton||!B?null:j(B);return await e._decodeMeshToGeometryForGltfAsync(D.name,this._loader.babylonScene,z,N,m,g).catch((v=>{throw new Error(`${S}: ${v.message}`)}))}))),await g._dracoBabylonGeometry}))}}J(OS),c(OS,!0,(S=>new IS(S)));var KS=D(13090),qS=D(11358),uS=D(11364),sS=D(11797),rS=D(11944),dS=D(11329);sS.b.AddNodeConstructor("Light_Type_0",((S,v)=>()=>new xS(S,e.Rv.Zero(),v)));class xS extends rS.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(S){this._shadowAngle=S,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(S){const v=this.needCube();if(this._direction=S,this.needCube()!==v&&this._shadowGenerators){const S=this._shadowGenerators.values();for(let v=S.next();!0!==v.done;v=S.next()){v.value.recreateShadowMap()}}}constructor(S,v,D){super(S,D),this._shadowAngle=Math.PI/2,this.position=v}getClassName(){return"PointLight"}getTypeID(){return AS.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(S){if(this.direction)return super.getShadowDirection(S);switch(S){case 0:return new e.Rv(1,0,0);case 1:return new e.Rv(-1,0,0);case 2:return new e.Rv(0,-1,0);case 3:return new e.Rv(0,1,0);case 4:return new e.Rv(0,0,1);case 5:return new e.Rv(0,0,-1)}return e.Rv.Zero()}_setDefaultShadowProjectionMatrix(S,v,D){const z=this.xS().activeCamera;if(!z)return;const N=void 0!==this.shadowMinZ?this.shadowMinZ:z.xe,m=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,B=this.xS().getEngine().useReverseDepthBuffer;e.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,B?m:N,B?N:m,S,!0,this._scene.getEngine().isNDCHalfZRange,void 0,B)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(S,v){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,v):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,v),this}transferToNodeMaterialEffect(S,v){return this.computeTransformedInformation()?S.setFloat3(v,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):S.setFloat3(v,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(S,v){S["POINTLIGHT"+v]=!0}}(0,qS.b)([(0,uS.L)()],xS.prototype,"shadowAngle",null),(0,dS.f)("BABYLON.PointLight",xS);const WS="KHR_lights_punctual";class pS{constructor(S){this.name=WS,this._loader=S,this.enabled=this._loader.isExtensionUsed(WS)}dispose(){this._loader=null,delete this._lights}onLoading(){const S=this._loader.me.extensions;if(S&&S[this.name]){const v=S[this.name];this._lights=v.lights,Y.Assign(this._lights)}}loadNodeAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,m)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(S,v,(S=>{let v;const B=Y.Get(z,this._lights,m.nz),g=B.name||S.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,B.type){case"directional":{const S=new KS.e(g,e.Rv.Backward(),this._loader.babylonScene);S.position.Je(0),v=S;break}case"point":v=new xS(g,e.Rv.Zero(),this._loader.babylonScene);break;case"spot":{const S=new hS.d(g,e.Rv.Zero(),e.Rv.Backward(),0,1,this._loader.babylonScene);S.angle=2*(B.spot&&B.spot.outerConeAngle||Math.PI/4),S.innerAngle=2*(B.spot&&B.spot.innerConeAngle||0),v=S;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${z}: Invalid light type (${B.type})`)}v._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,B._babylonLight=v,v.falloffType=AS.b.FALLOFF_GLTF,v.sB=B.color?N.qv.uv(B.color):N.qv.White(),v.le=void 0==B.le?1:B.le,v.range=void 0==B.range?Number.MAX_VALUE:B.range,v.parent=S,this._loader._babylonLights.push(v),V.AddPointerMetadata(v,z),D(S)})))))}}J(WS),c(WS,!0,(S=>new pS(S)));const bS="KHR_materials_pbrSpecularGlossiness";class kS{constructor(S){this.name=bS,this.order=200,this._loader=S,this.enabled=this._loader.isExtensionUsed(bS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;return N.push(this._loader.loadMaterialBasePropertiesAsync(S,v,D)),N.push(this._loadSpecularGlossinessPropertiesAsync(z,e,D)),this._loader.loadMaterialAlphaProperties(S,v,D),await Promise.all(N).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;return D.metallic=null,D.roughness=null,v.diffuseFactor?(D.albedoColor=N.qv.uv(v.diffuseFactor),D.alpha=v.diffuseFactor[3]):D.albedoColor=N.qv.White(),D.reflectivityColor=v.specularFactor?N.qv.uv(v.specularFactor):N.qv.White(),D.microSurface=void 0==v.glossinessFactor?1:v.glossinessFactor,v.diffuseTexture&&z.push(this._loader.loadTextureInfoAsync(`${S}/diffuseTexture`,v.diffuseTexture,(S=>{S.name=`${D.name} (Diffuse)`,D.albedoTexture=S}))),v.specularGlossinessTexture&&(z.push(this._loader.loadTextureInfoAsync(`${S}/specularGlossinessTexture`,v.specularGlossinessTexture,(S=>{S.name=`${D.name} (Specular Glossiness)`,D.reflectivityTexture=S,D.reflectivityTexture.de=!0}))),D.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(z).then((()=>{}))}}J(bS),c(bS,!0,(S=>new kS(S)));const ZS="KHR_materials_unlit";class iS{constructor(S){this.name=ZS,this.order=210,this._loader=S,this.enabled=this._loader.isExtensionUsed(ZS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async()=>await this._loadUnlitPropertiesAsync(S,v,D)))}_loadUnlitPropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;D.unlit=!0;const e=v.pbrMetallicRoughness;return e&&(e.baseColorFactor?(D.albedoColor=N.qv.uv(e.baseColorFactor),D.alpha=e.baseColorFactor[3]):D.albedoColor=N.qv.White(),e.baseColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${S}/baseColorTexture`,e.baseColorTexture,(S=>{S.name=`${D.name} (Base Color)`,D.albedoTexture=S})))),v.doubleSided&&(D.Xe=!1,D.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(S,v,D),Promise.all(z).then((()=>{}))}}J(ZS),c(ZS,!0,(S=>new iS(S)));const tS="KHR_materials_clearcoat";class XS{constructor(S){this.name=tS,this.order=190,this._loader=S,this.enabled=this._loader.isExtensionUsed(tS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadClearCoatPropertiesAsync(z,e,D)),await Promise.all(N)}))}_loadClearCoatPropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;return D.clearCoat.isEnabled=!0,D.clearCoat.useRoughnessFromMainTexture=!1,D.clearCoat.remapF0OnInterfaceChange=!1,void 0!=v.clearcoatFactor?D.clearCoat.le=v.clearcoatFactor:D.clearCoat.le=0,v.clearcoatTexture&&z.push(this._loader.loadTextureInfoAsync(`${S}/clearcoatTexture`,v.clearcoatTexture,(S=>{S.name=`${D.name} (ClearCoat)`,D.clearCoat.texture=S}))),void 0!=v.clearcoatRoughnessFactor?D.clearCoat.roughness=v.clearcoatRoughnessFactor:D.clearCoat.roughness=0,v.clearcoatRoughnessTexture&&(v.clearcoatRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${S}/clearcoatRoughnessTexture`,v.clearcoatRoughnessTexture,(S=>{S.name=`${D.name} (ClearCoat Roughness)`,D.clearCoat.textureRoughness=S})))),v.clearcoatNormalTexture&&(v.clearcoatNormalTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${S}/clearcoatNormalTexture`,v.clearcoatNormalTexture,(S=>{S.name=`${D.name} (ClearCoat Normal)`,D.clearCoat.bumpTexture=S}))),D.invertNormalMapX=!D.xS().useRightHandedSystem,D.invertNormalMapY=D.xS().useRightHandedSystem,void 0!=v.clearcoatNormalTexture.scale&&(D.clearCoat.bumpTexture.level=v.clearcoatNormalTexture.scale)),Promise.all(z).then((()=>{}))}}J(tS),c(tS,!0,(S=>new XS(S)));const aS="KHR_materials_iridescence";class oS{constructor(S){this.name=aS,this.order=195,this._loader=S,this.enabled=this._loader.isExtensionUsed(aS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadIridescencePropertiesAsync(z,e,D)),await Promise.all(N).then((()=>{}))}))}_loadIridescencePropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;return D.iridescence.isEnabled=!0,D.iridescence.le=v.iridescenceFactor??0,D.iridescence.indexOfRefraction=v.iridescenceIor??v.iridescenceIOR??1.3,D.iridescence.minimumThickness=v.iridescenceThicknessMinimum??100,D.iridescence.maximumThickness=v.iridescenceThicknessMaximum??400,v.iridescenceTexture&&z.push(this._loader.loadTextureInfoAsync(`${S}/iridescenceTexture`,v.iridescenceTexture,(S=>{S.name=`${D.name} (Iridescence)`,D.iridescence.texture=S}))),v.iridescenceThicknessTexture&&z.push(this._loader.loadTextureInfoAsync(`${S}/iridescenceThicknessTexture`,v.iridescenceThicknessTexture,(S=>{S.name=`${D.name} (Iridescence Thickness)`,D.iridescence.thicknessTexture=S}))),Promise.all(z).then((()=>{}))}}J(aS),c(aS,!0,(S=>new oS(S)));const MS="KHR_materials_anisotropy";class cS{constructor(S){this.name=MS,this.order=195,this._loader=S,this.enabled=this._loader.isExtensionUsed(MS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadIridescencePropertiesAsync(z,e,D)),await Promise.all(N)}))}async _loadIridescencePropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;D.anisotropy.isEnabled=!0,D.anisotropy.le=v.anisotropyStrength??0,D.anisotropy.angle=v.anisotropyRotation??0,v.anisotropyTexture&&(v.anisotropyTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${S}/anisotropyTexture`,v.anisotropyTexture,(S=>{S.name=`${D.name} (Anisotropy Intensity)`,D.anisotropy.texture=S})))),await Promise.all(z)}}J(MS),c(MS,!0,(S=>new cS(S)));const JS="KHR_materials_emissive_strength";class HS{constructor(S){this.name=JS,this.order=170,this._loader=S,this.enabled=this._loader.isExtensionUsed(JS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>await this._loader.loadMaterialPropertiesAsync(S,v,D).then((()=>{this._loadEmissiveProperties(z,e,D)}))))}_loadEmissiveProperties(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);void 0!==v.emissiveStrength&&(D.emissiveIntensity=v.emissiveStrength)}}J(JS),c(JS,!0,(S=>new HS(S)));const TS="KHR_materials_sheen";class GS{constructor(S){this.name=TS,this.order=190,this._loader=S,this.enabled=this._loader.isExtensionUsed(TS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadSheenPropertiesAsync(z,e,D)),await Promise.all(N).then((()=>{}))}))}_loadSheenPropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;return D.sheen.isEnabled=!0,D.sheen.le=1,void 0!=v.sheenColorFactor?D.sheen.color=N.qv.uv(v.sheenColorFactor):D.sheen.color=N.qv.Black(),v.sheenColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${S}/sheenColorTexture`,v.sheenColorTexture,(S=>{S.name=`${D.name} (Sheen Color)`,D.sheen.texture=S}))),void 0!==v.sheenRoughnessFactor?D.sheen.roughness=v.sheenRoughnessFactor:D.sheen.roughness=0,v.sheenRoughnessTexture&&(v.sheenRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${S}/sheenRoughnessTexture`,v.sheenRoughnessTexture,(S=>{S.name=`${D.name} (Sheen Roughness)`,D.sheen.textureRoughness=S})))),D.sheen.albedoScaling=!0,D.sheen.useRoughnessFromMainTexture=!1,Promise.all(z).then((()=>{}))}}J(TS),c(TS,!0,(S=>new GS(S)));var YS=D(11845);const jS="KHR_materials_specular";class VS{constructor(S){this.name=jS,this.order=190,this._loader=S,this.enabled=this._loader.isExtensionUsed(jS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;if(N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadSpecularPropertiesAsync(z,e,D)),e.extensions&&e.extensions.EXT_materials_specular_edge_color&&D instanceof u.d){e.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(D.brdf.dielectricSpecularModel=YS.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,D.brdf.conductorSpecularModel=YS.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(N).then((()=>{}))}))}_loadSpecularPropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;return void 0!==v.specularFactor&&(D.metallicF0Factor=v.specularFactor),void 0!==v.specularColorFactor&&(D.metallicReflectanceColor=N.qv.uv(v.specularColorFactor)),v.specularTexture&&(v.specularTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${S}/specularTexture`,v.specularTexture,(S=>{S.name=`${D.name} (Specular)`,D.metallicReflectanceTexture=S,D.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),v.specularColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${S}/specularColorTexture`,v.specularColorTexture,(S=>{S.name=`${D.name} (Specular Color)`,D.reflectanceTexture=S}))),Promise.all(z).then((()=>{}))}}J(jS),c(jS,!0,(S=>new VS(S)));const US="KHR_materials_ior";class yS{constructor(S){this.name=US,this.order=180,this._loader=S,this.enabled=this._loader.isExtensionUsed(US)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadIorPropertiesAsync(z,e,D)),await Promise.all(N).then((()=>{}))}))}_loadIorPropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);return void 0!==v.ior?D.indexOfRefraction=v.ior:D.indexOfRefraction=yS._DEFAULT_IOR,Promise.resolve()}}yS._DEFAULT_IOR=1.5,J(US),c(US,!0,(S=>new yS(S)));const fS="KHR_materials_variants";class CS{constructor(S){this.name=fS,this._loader=S,this.enabled=this._loader.isExtensionUsed(fS)}dispose(){this._loader=null}static GetAvailableVariants(S){const v=this._GetExtensionMetadata(S);return v?Object.keys(v.variants):[]}getAvailableVariants(S){return CS.GetAvailableVariants(S)}static SelectVariant(S,v){const D=this._GetExtensionMetadata(S);if(!D)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${fS} extension`);const z=S=>{const v=D.variants[S];if(v)for(const D of v)D.mesh.material=D.material};if(v instanceof Array)for(const e of v)z(e);else z(v);D.lastSelected=v}selectVariant(S,v){CS.SelectVariant(S,v)}static Reset(S){const v=this._GetExtensionMetadata(S);if(!v)throw new Error(`Cannot reset on a glTF mesh that does not have the ${fS} extension`);for(const D of v.original)D.mesh.material=D.material;v.lastSelected=null}reset(S){CS.Reset(S)}static GetLastSelectedVariant(S){const v=this._GetExtensionMetadata(S);if(!v)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${fS} extension`);return v.lastSelected}getLastSelectedVariant(S){return CS.GetLastSelectedVariant(S)}static _GetExtensionMetadata(S){var v,D;return(null===S||void 0===S||null===(v=S._internalMetadata)||void 0===v||null===(D=v.me)||void 0===D?void 0:D[fS])||null}onLoading(){const S=this._loader.me.extensions;if(S&&S[this.name]){const v=S[this.name];this._variants=v.variants}}onReady(){const S=this._loader.rootBabylonMesh;if(S){var v;const D=this._loader.parent.extensionOptions[fS];null!==D&&void 0!==D&&D.defaultVariant&&CS.SelectVariant(S,D.defaultVariant),null===D||void 0===D||null===(v=D.onLoaded)||void 0===v||v.call(D,{get variants(){return CS.GetAvailableVariants(S)},get selectedVariant(){const v=CS.GetLastSelectedVariant(S);return v?Array.isArray(v)?v[0]:v:CS.GetAvailableVariants(S)[0]},set selectedVariant(v){CS.SelectVariant(S,v)}})}}_loadMeshPrimitiveAsync(S,v,D,z,e,N){return V.LoadExtensionAsync(S,e,this.name,(async(m,B)=>{const g=new Array;return g.push(this._loader._loadMeshPrimitiveAsync(S,v,D,z,e,(v=>{if(N(v),v instanceof p.e){const D=V._GetDrawMode(S,e.mode),z=this._loader.rootBabylonMesh,N=z?z._internalMetadata=z._internalMetadata||{}:{},E=N.me=N.me||{},h=E[fS]=E[fS]||{lastSelected:null,original:[],variants:{}};h.original.push({mesh:v,material:v.material});for(let S=0;S<B.mappings.length;++S){const e=B.mappings[S],N=Y.Get(`${m}/mappings/${S}/material`,this._loader.me.materials,e.material);g.push(this._loader._loadMaterialAsync(`#/materials/${e.material}`,N,v,D,(S=>{for(let D=0;D<e.variants.length;++D){const N=e.variants[D],m=Y.Get(`/extensions/${fS}/variants/${N}`,this._variants,N);h.variants[m.name]=h.variants[m.name]||[],h.variants[m.name].push({mesh:v,material:S}),v.onClonedObservable.add((S=>{const D=S;let e=null,N=D;do{if(N=N.parent,!N)return;e=CS._GetExtensionMetadata(N)}while(null===e);if(z&&e===CS._GetExtensionMetadata(z)){N._internalMetadata={};for(const S in z._internalMetadata)N._internalMetadata[S]=z._internalMetadata[S];N._internalMetadata.me=[];for(const S in z._internalMetadata.me)N._internalMetadata.me[S]=z._internalMetadata.me[S];N._internalMetadata.me[fS]={lastSelected:null,original:[],variants:{}};for(const S of e.original)N._internalMetadata.me[fS].original.push({mesh:S.mesh,material:S.material});for(const S in e.variants)if(Object.prototype.hasOwnProperty.call(e.variants,S)){N._internalMetadata.me[fS].variants[S]=[];for(const v of e.variants[S])N._internalMetadata.me[fS].variants[S].push({mesh:v.mesh,material:v.material})}e=N._internalMetadata.me[fS]}for(const z of e.original)z.mesh===v&&(z.mesh=D);for(const z of e.variants[m.name])z.mesh===v&&(z.mesh=D)}))}})))}}}))),await Promise.all(g).then((S=>{let[v]=S;return v}))}))}}J(fS),c(fS,!0,(S=>new CS(S)));var FS=D(11436);class lS{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:YS.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(S,v){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...lS._GetDefaultOptions(),...S},this._scene=v,this._scene._transmissionHelper=this,this.onErrorObservable=new h.d,this._scene.Se.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(S){if(!Object.keys(S).filter((v=>this._options[v]!==S[v])).length)return;const v={...this._options,...S},D=this._options;this._options=v,v.renderSize===D.renderSize&&v.renderTargetTextureType===D.renderTargetTextureType&&v.generateMipmaps===D.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=v.samples,this._opaqueRenderTarget.lodGenerationScale=v.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=v.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(S){return!!S&&!!(S instanceof u.d&&S.subSurface.isRefractionEnabled)}_addMesh(S){this._materialObservers[S.uniqueId]=S.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),m.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(S.material)?(S.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(S)&&this._transparentMeshesCache.push(S)):-1===this._opaqueMeshesCache.indexOf(S)&&this._opaqueMeshesCache.push(S)}))}_removeMesh(S){S.onMaterialChangedObservable.remove(this._materialObservers[S.uniqueId]),delete this._materialObservers[S.uniqueId];let v=this._transparentMeshesCache.indexOf(S);-1!==v&&this._transparentMeshesCache.splice(v,1),v=this._opaqueMeshesCache.indexOf(S),-1!==v&&this._opaqueMeshesCache.splice(v,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(S){const v=this._transparentMeshesCache.indexOf(S),D=this._opaqueMeshesCache.indexOf(S);this._shouldRenderAsTransmission(S.material)?(S.material instanceof u.d&&(S.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==D?(this._opaqueMeshesCache.splice(D,1),this._transparentMeshesCache.push(S)):-1===v&&this._transparentMeshesCache.push(S)):-1!==v?(this._transparentMeshesCache.splice(v,1),this._opaqueMeshesCache.push(S)):-1===D&&this._opaqueMeshesCache.push(S)}_isRenderTargetValid(){var S;return null!==(null===(S=this._opaqueRenderTarget)||void 0===S?void 0:S.getInternalTexture())}_setupRenderTargets(){var S;let v;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new FS.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(S=this._options.clearColor)||void 0===S?void 0:S.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((S=>{v=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?S.clearColor.N(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(S.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=v}));for(const D of this._transparentMeshesCache)this._shouldRenderAsTransmission(D.material)&&(D.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const PS="KHR_materials_transmission";class QS{constructor(S){this.name=PS,this.order=175,this._loader=S,this.enabled=this._loader.isExtensionUsed(PS),this.enabled&&(S.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadTransparentPropertiesAsync(z,v,D,e)),await Promise.all(N).then((()=>{}))}))}_loadTransparentPropertiesAsync(S,v,D,z){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const e=D;if(e.subSurface.isRefractionEnabled=!0,e.subSurface.volumeIndexOfRefraction=1,e.subSurface.useAlbedoToTintRefraction=!0,void 0===z.transmissionFactor)return e.subSurface.refractionIntensity=0,e.subSurface.isRefractionEnabled=!1,Promise.resolve();{var N;e.subSurface.refractionIntensity=z.transmissionFactor;const S=e.xS();if(e.subSurface.refractionIntensity&&!S._transmissionHelper)new lS({},e.xS());else if(e.subSurface.refractionIntensity&&(null===(N=S._transmissionHelper)||void 0===N||!N._isRenderTargetValid())){var m;null===(m=S._transmissionHelper)||void 0===m||m._setupRenderTargets()}}return e.subSurface.minimumThickness=0,e.subSurface.maximumThickness=0,z.transmissionTexture?(z.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${S}/transmissionTexture`,z.transmissionTexture,void 0).then((S=>{S.name=`${D.name} (Transmission)`,e.subSurface.refractionIntensityTexture=S,e.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(PS),c(PS,!0,(S=>new QS(S)));const LS="KHR_materials_diffuse_transmission";class Sv{constructor(S){this.name=LS,this.order=174,this._loader=S,this.enabled=this._loader.isExtensionUsed(LS),this.enabled&&(S.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadTranslucentPropertiesAsync(z,v,D,e)),await Promise.all(N).then((()=>{}))}))}_loadTranslucentPropertiesAsync(S,v,D,z){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const e=D;if(e.subSurface.isTranslucencyEnabled=!0,e.subSurface.volumeIndexOfRefraction=1,e.subSurface.minimumThickness=0,e.subSurface.maximumThickness=0,e.subSurface.useAlbedoToTintTranslucency=!1,void 0===z.diffuseTransmissionFactor)return e.subSurface.translucencyIntensity=0,e.subSurface.isTranslucencyEnabled=!1,Promise.resolve();e.subSurface.translucencyIntensity=z.diffuseTransmissionFactor;const m=new Array;return e.subSurface.useGltfStyleTextures=!0,z.diffuseTransmissionTexture&&(z.diffuseTransmissionTexture.nonColorData=!0,m.push(this._loader.loadTextureInfoAsync(`${S}/diffuseTransmissionTexture`,z.diffuseTransmissionTexture).then((S=>{S.name=`${D.name} (Diffuse Transmission)`,e.subSurface.translucencyIntensityTexture=S})))),void 0!==z.diffuseTransmissionColorFactor?e.subSurface.translucencyColor=N.qv.uv(z.diffuseTransmissionColorFactor):e.subSurface.translucencyColor=N.qv.White(),z.diffuseTransmissionColorTexture&&m.push(this._loader.loadTextureInfoAsync(`${S}/diffuseTransmissionColorTexture`,z.diffuseTransmissionColorTexture).then((S=>{S.name=`${D.name} (Diffuse Transmission Color)`,e.subSurface.translucencyColorTexture=S}))),Promise.all(m).then((()=>{}))}}J(LS),c(LS,!0,(S=>new Sv(S)));const vv="KHR_materials_volume";class Dv{constructor(S){this.name=vv,this.order=173,this._loader=S,this.enabled=this._loader.isExtensionUsed(vv),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadVolumePropertiesAsync(z,v,D,e)),await Promise.all(N).then((()=>{}))}))}_loadVolumePropertiesAsync(S,v,D,z){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);if(!D.subSurface.isRefractionEnabled&&!D.subSurface.isTranslucencyEnabled||!z.thicknessFactor)return Promise.resolve();D.subSurface.volumeIndexOfRefraction=D.indexOfRefraction;const e=void 0!==z.attenuationDistance?z.attenuationDistance:Number.MAX_VALUE;return D.subSurface.tintColorAtDistance=e,void 0!==z.attenuationColor&&3==z.attenuationColor.length&&D.subSurface.tintColor.oe(z.attenuationColor[0],z.attenuationColor[1],z.attenuationColor[2]),D.subSurface.minimumThickness=0,D.subSurface.maximumThickness=z.thicknessFactor,D.subSurface.useThicknessAsDepth=!0,z.thicknessTexture?(z.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${S}/thicknessTexture`,z.thicknessTexture).then((S=>{S.name=`${D.name} (Thickness)`,D.subSurface.thicknessTexture=S,D.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(vv),c(vv,!0,(S=>new Dv(S)));const zv="KHR_materials_dispersion";class ev{constructor(S){this.name=zv,this.order=174,this._loader=S,this.enabled=this._loader.isExtensionUsed(zv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadDispersionPropertiesAsync(z,v,D,e)),await Promise.all(N).then((()=>{}))}))}_loadDispersionPropertiesAsync(S,v,D,z){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);return D.subSurface.isRefractionEnabled&&z.dispersion?(D.subSurface.isDispersionEnabled=!0,D.subSurface.dispersion=z.dispersion,Promise.resolve()):Promise.resolve()}}J(zv),c(zv,!0,(S=>new ev(S)));const Nv="EXT_materials_diffuse_roughness";class mv{constructor(S){this.name=Nv,this.order=190,this._loader=S,this.enabled=this._loader.isExtensionUsed(Nv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(S,v,D)),N.push(this._loadDiffuseRoughnessPropertiesAsync(z,e,D)),await Promise.all(N).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(S,v,D){if(!(D instanceof u.d))throw new Error(`${S}: Material type not supported`);const z=new Array;return D.brdf.baseDiffuseModel=YS.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=v.diffuseRoughnessFactor?D.baseDiffuseRoughness=v.diffuseRoughnessFactor:D.baseDiffuseRoughness=0,v.diffuseRoughnessTexture&&z.push(this._loader.loadTextureInfoAsync(`${S}/diffuseRoughnessTexture`,v.diffuseRoughnessTexture,(S=>{S.name=`${D.name} (Diffuse Roughness)`,D.baseDiffuseRoughnessTexture=S}))),Promise.all(z).then((()=>{}))}}J(Nv),c(Nv,!0,(S=>new mv(S)));const Bv="KHR_mesh_quantization";class gv{constructor(S){this.name=Bv,this.enabled=S.isExtensionUsed(Bv)}dispose(){}}J(Bv),c(Bv,!0,(S=>new gv(S)));const Ev="KHR_texture_basisu";class hv{constructor(S){this.name=Ev,this._loader=S,this.enabled=S.isExtensionUsed(Ev)}dispose(){this._loader=null}_loadTextureAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>{const N=void 0==v.sampler?V.DefaultSampler:Y.Get(`${S}/sampler`,this._loader.me.samplers,v.sampler),m=Y.Get(`${z}/source`,this._loader.me.images,e.source);return await this._loader._createTextureAsync(S,N,m,(S=>{D(S)}),v._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!v._textureInfo.nonColorData)}))}}J(Ev),c(Ev,!0,(S=>new hv(S)));const Av="KHR_texture_transform";class wv{constructor(S){this.name=Av,this._loader=S,this.enabled=this._loader.isExtensionUsed(Av)}dispose(){this._loader=null}loadTextureInfoAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(z,e)=>await this._loader.loadTextureInfoAsync(S,v,(S=>{if(!(S instanceof s.d))throw new Error(`${z}: Texture type not supported`);e.offset&&(S.uOffset=e.offset[0],S.vOffset=e.offset[1]),S.uRotationCenter=0,S.vRotationCenter=0,e.rotation&&(S.wAng=-e.rotation),e.scale&&(S.uScale=e.scale[0],S.vScale=e.scale[1]),void 0!=e.texCoord&&(S.coordinatesIndex=e.texCoord),D(S)}))))}}J(Av),c(Av,!0,(S=>new wv(S)));const nv="KHR_xmp_json_ld";class Rv{constructor(S){this.name=nv,this.order=100,this._loader=S,this.enabled=this._loader.isExtensionUsed(nv)}dispose(){this._loader=null}onLoading(){var S,v,D;if(null===this._loader.rootBabylonMesh)return;const z=null===(S=this._loader.me.extensions)||void 0===S?void 0:S.KHR_xmp_json_ld,e=null===(v=this._loader.me.asset)||void 0===v||null===(D=v.extensions)||void 0===D?void 0:D.KHR_xmp_json_ld;if(z&&e){const S=+e.packet;z.packets&&S<z.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=z.packets[S])}}}function Ov(S,v,D,z){return N.qv.uv(v,D).scale(z)}function Iv(S,v,D,z){return v[D]*z}function Kv(S,v,D,z){return-v[D]*z}function qv(S,v,D,z){return v[D+1]*z}function uv(S,v,D,z){return v[D]*z*2}function sv(S){return{scale:[new dv(w.b.ANIMATIONTYPE_FLOAT,`${S}.uScale`,Iv,(()=>2)),new dv(w.b.ANIMATIONTYPE_FLOAT,`${S}.vScale`,qv,(()=>2))],offset:[new dv(w.b.ANIMATIONTYPE_FLOAT,`${S}.uOffset`,Iv,(()=>2)),new dv(w.b.ANIMATIONTYPE_FLOAT,`${S}.vOffset`,qv,(()=>2))],rotation:[new dv(w.b.ANIMATIONTYPE_FLOAT,`${S}.wAng`,Kv,(()=>1))]}}J(nv),c(nv,!0,(S=>new Rv(S)));class rv extends U.AnimationPropertyInfo{buildAnimations(S,v,D,z){return[{babylonAnimatable:S._babylonCamera,babylonAnimation:this._buildAnimation(v,D,z)}]}}class dv extends U.AnimationPropertyInfo{buildAnimations(S,v,D,z){const e=[];for(const N in S._data)e.push({babylonAnimatable:S._data[N].babylonMaterial,babylonAnimation:this._buildAnimation(v,D,z)});return e}}class xv extends U.AnimationPropertyInfo{buildAnimations(S,v,D,z){return[{babylonAnimatable:S._babylonLight,babylonAnimation:this._buildAnimation(v,D,z)}]}}(0,H.l)("/cameras/{}/orthographic/xmag",[new rv(w.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Kv,(()=>1)),new rv(w.b.ANIMATIONTYPE_FLOAT,"orthoRight",qv,(()=>1))]),(0,H.l)("/cameras/{}/orthographic/ymag",[new rv(w.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Kv,(()=>1)),new rv(w.b.ANIMATIONTYPE_FLOAT,"orthoTop",qv,(()=>1))]),(0,H.l)("/cameras/{}/orthographic/zfar",[new rv(w.b.ANIMATIONTYPE_FLOAT,"maxZ",Iv,(()=>1))]),(0,H.l)("/cameras/{}/orthographic/znear",[new rv(w.b.ANIMATIONTYPE_FLOAT,"xe",Iv,(()=>1))]),(0,H.l)("/cameras/{}/perspective/yfov",[new rv(w.b.ANIMATIONTYPE_FLOAT,"fov",Iv,(()=>1))]),(0,H.l)("/cameras/{}/perspective/zfar",[new rv(w.b.ANIMATIONTYPE_FLOAT,"maxZ",Iv,(()=>1))]),(0,H.l)("/cameras/{}/perspective/znear",[new rv(w.b.ANIMATIONTYPE_FLOAT,"xe",Iv,(()=>1))]),(0,H.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new dv(w.b.ANIMATIONTYPE_COLOR3,"albedoColor",Ov,(()=>4)),new dv(w.b.ANIMATIONTYPE_FLOAT,"alpha",(function(S,v,D,z){return v[D+3]*z}),(()=>4))]),(0,H.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"metallic",Iv,(()=>1))]),(0,H.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"roughness",Iv,(()=>1))]);const Wv=sv("albedoTexture");(0,H.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Wv.scale),(0,H.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Wv.offset),(0,H.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Wv.rotation);const pv=sv("metallicTexture");(0,H.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",pv.scale),(0,H.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",pv.offset),(0,H.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",pv.rotation),(0,H.l)("/materials/{}/emissiveFactor",[new dv(w.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Ov,(()=>3))]);const bv=sv("bumpTexture");(0,H.l)("/materials/{}/normalTexture/scale",[new dv(w.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Iv,(()=>1))]),(0,H.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",bv.scale),(0,H.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",bv.offset),(0,H.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",bv.rotation),(0,H.l)("/materials/{}/occlusionTexture/strength",[new dv(w.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Iv,(()=>1))]);const kv=sv("ambientTexture");(0,H.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",kv.scale),(0,H.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",kv.offset),(0,H.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",kv.rotation);const Zv=sv("emissiveTexture");(0,H.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Zv.scale),(0,H.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Zv.offset),(0,H.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Zv.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new dv(w.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new dv(w.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Iv,(()=>1))]);const iv=sv("anisotropy.texture");(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",iv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",iv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",iv.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Iv,(()=>1))]);const tv=sv("clearCoat.texture");(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",tv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",tv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",tv.rotation);const Xv=sv("clearCoat.bumpTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new dv(w.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Xv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Xv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Xv.rotation);const av=sv("clearCoat.textureRoughness");(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",av.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",av.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",av.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new dv(w.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new dv(w.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new dv(w.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new dv(w.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Iv,(()=>1))]);const ov=sv("iridescence.texture");(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",ov.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",ov.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",ov.rotation);const Mv=sv("iridescence.thicknessTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Mv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Mv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Mv.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new dv(w.b.ANIMATIONTYPE_COLOR3,"sheen.color",Ov,(()=>3))]),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Iv,(()=>1))]);const cv=sv("sheen.texture");(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",cv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",cv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",cv.rotation);const Jv=sv("sheen.textureRoughness");(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Jv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Jv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Jv.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new dv(w.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Ov,(()=>3))]);const Hv=sv("metallicReflectanceTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Hv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Hv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Hv.rotation);const Tv=sv("reflectanceTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Tv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Tv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Tv.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Iv,(()=>1))]);const Gv=sv("subSurface.refractionIntensityTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Gv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Gv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Gv.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new dv(w.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Ov,(()=>3))]),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new dv(w.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Iv,(()=>1))]),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Iv,(()=>1))]);const Yv=sv("subSurface.thicknessTexture");(0,H.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Yv.scale),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Yv.offset),(0,H.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Yv.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new dv(w.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Iv,(()=>1))]);const jv=sv("subSurface.translucencyIntensityTexture");(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",jv.scale),(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",jv.offset),(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",jv.rotation),(0,H.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new dv(w.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Ov,(()=>3))]);const Vv=sv("subSurface.translucencyColorTexture");(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Vv.scale),(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Vv.offset),(0,H.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Vv.rotation),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new xv(w.b.ANIMATIONTYPE_COLOR3,"diffuse",Ov,(()=>3))]),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new xv(w.b.ANIMATIONTYPE_FLOAT,"intensity",Iv,(()=>1))]),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new xv(w.b.ANIMATIONTYPE_FLOAT,"range",Iv,(()=>1))]),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new xv(w.b.ANIMATIONTYPE_FLOAT,"innerAngle",uv,(()=>1))]),(0,H.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new xv(w.b.ANIMATIONTYPE_FLOAT,"angle",uv,(()=>1))]),(0,H.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new xv(w.b.ANIMATIONTYPE_COLOR3,"diffuse",Ov,(()=>3))]),(0,H.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new xv(w.b.ANIMATIONTYPE_FLOAT,"intensity",Iv,(()=>1))]);const Uv="KHR_animation_pointer";class yv{constructor(S){this.name=Uv,this._loader=S,this._pathToObjectConverter=(0,H.i)(this._loader.me)}get enabled(){return this._loader.isExtensionUsed(Uv)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(S,v,D,z,e){var N;const m=null===(N=z.target.extensions)||void 0===N?void 0:N.KHR_animation_pointer;if(!m||!this._pathToObjectConverter)return null;"pointer"!==z.target.path&&O.b.Warn(`${S}/target/path: Value (${z.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=z.target.node&&O.b.Warn(`${S}/target/node: Value (${z.target.node}) must not be present when using the ${this.name} extension`);const B=`${S}/extensions/${this.name}`,g=m.pointer;if(!g)throw new Error(`${B}: Pointer is missing`);try{const N=this._pathToObjectConverter.convert(g);if(!N.info.interpolation)throw new Error(`${B}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(S,v,D,z,{object:N.object,info:N.info.interpolation},e)}catch(E){return O.b.Warn(`${B}/pointer: Invalid pointer (${g}) skipped`),null}}}J(Uv),c(Uv,!0,(S=>new yv(S)));class fv{constructor(S,v,D){this.frame=S,this.action=v,this.onlyOnce=D,this.isDone=!1}_clone(){return new fv(this.frame,this.action,this.onlyOnce)}}var Cv=D(11207),Fv=D(11269),lv=D(11262);class Pv{get loop(){return this._loop}set loop(S){S!==this._loop&&(this._loop=S,this.updateOptions({loop:S}))}get currentTime(){var S;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(S=Fv.d.audioEngine)&&void 0!==S&&S.audioContext&&(this.isPlaying||this.isPaused)){const S=this.isPaused?0:Fv.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+S}return 0}get spatialSound(){return this._spatialSound}set spatialSound(S){if(S==this._spatialSound)return;const v=this.isPlaying;this.pause(),S?(this._spatialSound=S,this._updateSpatialParameters()):this._disableSpatialSound(),v&&this.play()}constructor(S,v,D){var z;let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new h.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=e.Rv.Zero(),this._localDirection=new e.Rv(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=S,D=D||R.c.LastCreatedScene)if(this._scene=D,Pv._SceneComponentInitialization(D),this._readyToPlayCallback=N,this._customAttenuationFunction=(S,v,D,z,e)=>v<D?S*(1-v/D):0,B&&(this.autoplay=B.autoplay||!1,this._loop=B.loop||!1,void 0!==B.volume&&(this._volume=B.volume),this._spatialSound=B.spatialSound??!1,this.maxDistance=B.maxDistance??100,this.useCustomAttenuation=B.useCustomAttenuation??!1,this.rolloffFactor=B.rolloffFactor||1,this.refDistance=B.refDistance||1,this.distanceModel=B.distanceModel||"linear",this._playbackRate=B.playbackRate||1,this._streaming=B.streaming??!1,this._length=B.length,this._offset=B.offset),null!==(z=Fv.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&Fv.d.audioEngine.audioContext){this._soundGain=Fv.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let S=!0;if(v)try{"string"===typeof v?(this._urlType="String",this._url=v):v instanceof ArrayBuffer?this._urlType="ArrayBuffer":v instanceof HTMLMediaElement?this._urlType="MediaElement":v instanceof MediaStream?this._urlType="MediaStream":v instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(v)&&(this._urlType="Array");let D=[],z=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fv.d.audioEngine.audioContext.createMediaElementSource(v),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fv.d.audioEngine.audioContext.createMediaStreamSource(v),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":v.byteLength>0&&(z=!0,this._soundLoaded(v));break;case"AudioBuffer":this._audioBufferLoaded(v);break;case"String":D.push(v);case"Array":0===D.length&&(D=v);for(let S=0;S<D.length;S++){const v=D[S];if(z=B&&B.skipCodecCheck||-1!==v.indexOf(".mp3",v.length-4)&&Fv.d.audioEngine.isMP3supported||-1!==v.indexOf(".ogg",v.length-4)&&Fv.d.audioEngine.isOGGsupported||-1!==v.indexOf(".wav",v.length-4)||-1!==v.indexOf(".m4a",v.length-4)||-1!==v.indexOf(".mp4",v.length-4)||-1!==v.indexOf("blob:"),z){this._streaming?(this._htmlAudioElement=new Audio(v),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,m.Tools.SetCorsBehavior(v,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(v,(S=>{this._soundLoaded(S)}),void 0,!0,!0,(S=>{S&&O.b.Error("XHR "+S.status+" error on: "+v+"."),O.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:S=!1}S?z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):O.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(g){O.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Fv.d.audioEngine&&!Fv.d.audioEngine.WarnedWebAudioUnsupported&&(O.b.Error("Web Audio is not supported by your browser."),Fv.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var S;null!==(S=Fv.d.audioEngine)&&void 0!==S&&S.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(S){var v;null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.audioContext&&(this._audioBuffer=S,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(S){var v;null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.audioContext&&Fv.d.audioEngine.audioContext.decodeAudioData(S,(S=>{this._audioBufferLoaded(S)}),(S=>{O.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+S)}))}setAudioBuffer(S){var v;null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&(this._audioBuffer=S,this._isReadyToPlay=!0)}updateOptions(S){S&&(this.loop=S.loop??this.loop,this.maxDistance=S.maxDistance??this.maxDistance,this.useCustomAttenuation=S.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=S.rolloffFactor??this.rolloffFactor,this.refDistance=S.refDistance??this.refDistance,this.distanceModel=S.distanceModel??this.distanceModel,this._playbackRate=S.playbackRate??this._playbackRate,this._length=S.length??void 0,this.spatialSound=S.spatialSound??this._spatialSound,this._setOffset(S.offset??void 0),this.setVolume(S.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var S;null!==(S=Fv.d.audioEngine)&&void 0!==S&&S.canUseWebAudio&&Fv.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Fv.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var S;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(S=this._soundPanner)||void 0===S||S.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var S;null!==(S=Fv.d.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(S){var v;null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(S),this._isOutputConnected=!0)}setDirectionalCone(S,v,D){v<S?O.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=S,this._coneOuterAngle=v,this._coneOuterGain=D,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(S){if(S!=this._coneInnerAngle){var v;if(this._coneOuterAngle<S)return void O.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=S,null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(S){if(S!=this._coneOuterAngle){var v;if(S<this._coneInnerAngle)return void O.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=S,null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(S){var v;S.equals(this._position)||(this._position.N(S),null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(S){var v;this._localDirection=S,null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const S=this._connectedTransformNode.getWorldMatrix(),v=e.Rv.TransformNormal(this._localDirection,S);v.normalize(),this._soundPanner.orientationX.value=v.x,this._soundPanner.orientationY.value=v.y,this._soundPanner.orientationZ.value=v.z}updateDistanceFromListener(){var S;if(null!==(S=Fv.d.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const S=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Ov(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,S,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(S){this._customAttenuationFunction=S}play(S,v,D){var z;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(z=Fv.d.audioEngine)&&void 0!==z&&z.audioContext)try{var e,N;this._clearTimeoutsAndObservers();let z=S?(null===(e=Fv.d.audioEngine)||void 0===e?void 0:e.audioContext.currentTime)+S:null===(N=Fv.d.audioEngine)||void 0===N?void 0:N.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Fv.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const S=()=>{var D;if(null!==(D=Fv.d.audioEngine)&&void 0!==D&&D.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=v??0;const D=this._htmlAudioElement.play();void 0!==D&&D.catch((()=>{var v,D;(null===(v=Fv.d.audioEngine)||void 0===v||v.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(D=Fv.d.audioEngine)||void 0===D?void 0:D.onAudioUnlockedObservable.addOnce((()=>{S()})))}))}else{var z;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(z=Fv.d.audioEngine)||void 0===z?void 0:z.onAudioUnlockedObservable.addOnce((()=>{S()}))}};S()}}else{var m;const e=()=>{var e;if(null!==(e=Fv.d.audioEngine)&&void 0!==e&&e.audioContext){var N;if(D=D||this._length,void 0!==v&&this._setOffset(v),this._soundSource){const S=this._soundSource;S.onended=()=>{S.disconnect()}}if(this._soundSource=null===(N=Fv.d.audioEngine)||void 0===N?void 0:N.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var m;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==v&&(this._soundSource.loopStart=v),void 0!==D&&(this._soundSource.loopEnd=(0|v)+D),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},z=S?(null===(m=Fv.d.audioEngine)||void 0===m?void 0:m.audioContext.currentTime)+S:Fv.d.audioEngine.audioContext.currentTime;const e=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(z,e,this.loop?void 0:D)}}};"suspended"===(null===(m=Fv.d.audioEngine)||void 0===m?void 0:m.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var S;"suspended"===(null===(S=Fv.d.audioEngine)||void 0===S?void 0:S.audioContext.state)?(Fv.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Fv.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{e()})))):e()}),500):e()}this._startTime=z,this.isPlaying=!0,this.isPaused=!1}catch(B){O.b.Error("Error while trying to play audio: "+this.name+", "+B.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(S){var v;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var D;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(D=this._streamingSource)||void 0===D||D.disconnect();this.isPlaying=!1}else if(null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.audioContext&&this._soundSource){const v=S?Fv.d.audioEngine.audioContext.currentTime+S:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(v)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var S;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var v;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(v=this._streamingSource)||void 0===v||v.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(S=Fv.d.audioEngine)&&void 0!==S&&S.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Fv.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(S,v){var D;null!==(D=Fv.d.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._soundGain&&(v&&Fv.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Fv.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Fv.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(S,Fv.d.audioEngine.audioContext.currentTime+v)):this._soundGain.gain.value=S),this._volume=S}setPlaybackRate(S){this._playbackRate=S,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(S){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=S,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=S=>this._onRegisterAfterWorldMatrixUpdate(S),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(S){var v;if(S.getBoundingInfo){const v=S.getBoundingInfo();this.setPosition(v.boundingSphere.centerWorld)}else this.setPosition(S.absolutePosition);null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const S=()=>{(0,lv.e)((()=>this._isReadyToPlay),(()=>{D._audioBuffer=this.getAudioBuffer(),D._isReadyToPlay=!0,D.autoplay&&D.play(0,this._offset,this._length)}),void 0,300)},v={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},D=new Pv(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,v);return this.useCustomAttenuation&&D.setAttenuationFunction(this._customAttenuationFunction),D.setPosition(this._position),D.setPlaybackRate(this._playbackRate),S(),D}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const S={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(S.connectedMeshId=this._connectedTransformNode.id),S.position=this._position.Oe(),S.refDistance=this.refDistance,S.distanceModel=this.distanceModel,S.isDirectional=this._isDirectional,S.localDirectionToMesh=this._localDirection.Oe(),S.coneInnerAngle=this._coneInnerAngle,S.coneOuterAngle=this._coneOuterAngle,S.coneOuterGain=this._coneOuterGain),S}static Parse(S,v,D,z){const N=S.name;let m;m=S.url?D+S.url:D+N;const B={autoplay:S.autoplay,loop:S.loop,volume:S.volume,spatialSound:S.spatialSound,maxDistance:S.maxDistance,rolloffFactor:S.rolloffFactor,refDistance:S.refDistance,distanceModel:S.distanceModel,playbackRate:S.playbackRate};let g;if(z){const S=()=>{(0,lv.e)((()=>z._isReadyToPlay),(()=>{g._audioBuffer=z.getAudioBuffer(),g._isReadyToPlay=!0,g.autoplay&&g.play(0,g._offset,g._length)}),void 0,300)};g=new Pv(N,new ArrayBuffer(0),v,null,B),S()}else g=new Pv(N,m,v,(()=>{v.removePendingData(g)}),B),v.addPendingData(g);if(S.position){const v=e.Rv.uv(S.position);g.setPosition(v)}if(S.isDirectional&&(g.setDirectionalCone(S.coneInnerAngle||360,S.coneOuterAngle||360,S.coneOuterGain||0),S.localDirectionToMesh)){const v=e.Rv.uv(S.localDirectionToMesh);g.setLocalDirectionToMesh(v)}if(S.connectedMeshId){const D=v.getMeshById(S.connectedMeshId);D&&g.attachToMesh(D)}return S.metadata&&(g.metadata=S.metadata),g}_setOffset(S){this._offset!==S&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=S)}_clearTimeoutsAndObservers(){var S;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(S=Fv.d.audioEngine)||void 0===S||S.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Pv._SceneComponentInitialization=S=>{throw(0,Cv.e)("AudioSceneComponent")},(0,dS.f)("BABYLON.Sound",Pv);class Qv{constructor(S,v,D){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],v.length!==D.length)throw new Error("Sounds length does not equal weights length");this.loop=S,this._weights=D;let z=0;for(const N of D)z+=N;const e=z>0?1/z:0;for(let N=0;N<this._weights.length;N++)this._weights[N]*=e;this._sounds=v;for(const N of this._sounds)N.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(S){if(S!==this._coneInnerAngle){if(this._coneOuterAngle<S)return void O.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=S;for(const v of this._sounds)v.directionalConeInnerAngle=S}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(S){if(S!==this._coneOuterAngle){if(S<this._coneInnerAngle)return void O.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=S;for(const v of this._sounds)v.directionalConeOuterAngle=S}}get volume(){return this._volume}set volume(S){if(S!==this._volume)for(const v of this._sounds)v.setVolume(S)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(S){if(!this.isPaused){this.stop();const S=Math.random();let v=0;for(let D=0;D<this._weights.length;D++)if(v+=this._weights[D],S<=v){this._currentIndex=D;break}}const v=this._sounds[this._currentIndex??0];v.isReady()?v.play(0,this.isPaused?void 0:S):v.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Lv{constructor(S){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(S=S||R.c.LastCreatedScene)&&(this._scene=S,this.soundCollection=[],this._options=v,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var S;null!==(S=Fv.d.audioEngine)&&void 0!==S&&S.canUseWebAudio&&Fv.d.audioEngine.audioContext&&(this._outputAudioNode=Fv.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Fv.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Fv.d.audioEngine&&Fv.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(S){var v;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&S.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==S.soundTrackId&&(-1===S.soundTrackId?this._scene.mainSoundTrack.removeSound(S):this._scene.soundTracks&&this._scene.soundTracks[S.soundTrackId].removeSound(S)),this.soundCollection.push(S),S.soundTrackId=this.id}removeSound(S){const v=this.soundCollection.indexOf(S);-1!==v&&this.soundCollection.splice(v,1)}setVolume(S){var v;null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=S)}switchPanningModelToHRTF(){var S;if(null!==(S=Fv.d.audioEngine)&&void 0!==S&&S.canUseWebAudio)for(let v=0;v<this.soundCollection.length;v++)this.soundCollection[v].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var S;if(null!==(S=Fv.d.audioEngine)&&void 0!==S&&S.canUseWebAudio)for(let v=0;v<this.soundCollection.length;v++)this.soundCollection[v].switchPanningModelToEqualPower()}connectToAnalyser(S){var v;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=S,null!==(v=Fv.d.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Fv.d.audioEngine.masterGain))}}var SD=D(11645),vD=D(11619),DD=D(11182);Fv.d.AudioEngineFactory=(S,v,D)=>new zD(S,v,D);class zD{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new h.d,this.onAudioLockedObservable=new h.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,DD.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const z=document.createElement("audio");this._hostElement=S,this._audioContext=v,this._audioDestination=D;try{z&&z.canPlayType&&(z.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||z.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(e){}try{z&&z.canPlayType&&z.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}}lock(){this._triggerSuspendedState()}unlock(){var S,v;if("running"===(null===(S=this._audioContext)||void 0===S?void 0:S.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(v=this._audioContext)||void 0===v||v.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{O.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var S;null===(S=this._audioContext)||void 0===S||S.addEventListener("statechange",(()=>{var S;this.unlocked&&"running"!==(null===(S=this._audioContext)||void 0===S?void 0:S.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var S;return null!==(S=this._audioContext)&&void 0!==S&&S.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(S){this.canUseWebAudio=!1,O.b.Error("Web Audio: "+S.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(S){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const S=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",v=document.createElement("style");v.appendChild(document.createTextNode(S)),document.getElementsByTagName("head")[0].appendChild(v),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var S;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(S=this._audioContext)||void 0===S||S.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(S){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=S)}connectToAnalyser(S){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=S,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var eD=D(11199);(0,D(12785).g)(SD.e.NAME_AUDIO,((S,v,D,z)=>{let e,N=[];if(D.En=D.En||[],void 0!==S.En&&null!==S.En)for(let B=0,g=S.En.length;B<g;B++){var m;const g=S.En[B];null!==(m=Fv.d.audioEngine)&&void 0!==m&&m.canUseWebAudio?(g.url||(g.url=g.name),N[g.url]?D.En.push(Pv.Parse(g,v,z,N[g.url])):(e=Pv.Parse(g,v,z),N[g.url]=e,D.En.push(e))):D.En.push(new Pv(g.name,null,v))}N=[]})),Object.defineProperty(vD.d.prototype,"mainSoundTrack",{get:function(){let S=this._getComponent(SD.e.NAME_AUDIO);return S||(S=new ND(this),this.o(S)),this._mainSoundTrack||(this._mainSoundTrack=new Lv(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),vD.d.prototype.getSoundByName=function(S){let v;for(v=0;v<this.mainSoundTrack.soundCollection.length;v++)if(this.mainSoundTrack.soundCollection[v].name===S)return this.mainSoundTrack.soundCollection[v];if(this.soundTracks)for(let D=0;D<this.soundTracks.length;D++)for(v=0;v<this.soundTracks[D].soundCollection.length;v++)if(this.soundTracks[D].soundCollection[v].name===S)return this.soundTracks[D].soundCollection[v];return null},Object.defineProperty(vD.d.prototype,"audioEnabled",{get:function(){let S=this._getComponent(SD.e.NAME_AUDIO);return S||(S=new ND(this),this.o(S)),S.audioEnabled},set:function(S){let v=this._getComponent(SD.e.NAME_AUDIO);v||(v=new ND(this),this.o(v)),S?v.enableAudio():v.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(vD.d.prototype,"headphone",{get:function(){let S=this._getComponent(SD.e.NAME_AUDIO);return S||(S=new ND(this),this.o(S)),S.headphone},set:function(S){let v=this._getComponent(SD.e.NAME_AUDIO);v||(v=new ND(this),this.o(v)),S?v.switchAudioModeForHeadphones():v.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(vD.d.prototype,"audioListenerPositionProvider",{get:function(){let S=this._getComponent(SD.e.NAME_AUDIO);return S||(S=new ND(this),this.o(S)),S.audioListenerPositionProvider},set:function(S){let v=this._getComponent(SD.e.NAME_AUDIO);if(v||(v=new ND(this),this.o(v)),S&&"function"!==typeof S)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");v.audioListenerPositionProvider=S},enumerable:!0,configurable:!0}),Object.defineProperty(vD.d.prototype,"audioListenerRotationProvider",{get:function(){let S=this._getComponent(SD.e.NAME_AUDIO);return S||(S=new ND(this),this.o(S)),S.audioListenerRotationProvider},set:function(S){let v=this._getComponent(SD.e.NAME_AUDIO);if(v||(v=new ND(this),this.o(v)),S&&"function"!==typeof S)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");v.audioListenerRotationProvider=S},enumerable:!0,configurable:!0}),Object.defineProperty(vD.d.prototype,"audioPositioningRefreshRate",{get:function(){let S=this._getComponent(SD.e.NAME_AUDIO);return S||(S=new ND(this),this.o(S)),S.audioPositioningRefreshRate},set:function(S){let v=this._getComponent(SD.e.NAME_AUDIO);v||(v=new ND(this),this.o(v)),v.audioPositioningRefreshRate=S},enumerable:!0,configurable:!0});class ND{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(S){this.name=SD.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new e.Rv,this._cachedCameraPosition=new e.Rv,this._lastCheck=0,this._invertMatrixTemp=new e.Matrix,this._cameraDirectionTemp=new e.Rv,(S=S||R.c.LastCreatedScene)&&(this.Iv=S,S.soundTracks=[],S.En=[])}register(){this.Iv._afterRenderStage.registerStep(SD.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(S){if(S.En=[],this.Iv.soundTracks)for(let v=0;v<this.Iv.soundTracks.length;v++){const D=this.Iv.soundTracks[v];for(let v=0;v<D.soundCollection.length;v++)S.En.push(D.soundCollection[v].serialize())}}addFromContainer(S){if(S.En)for(const v of S.En)v.play(),v.autoplay=!0,this.Iv.mainSoundTrack.addSound(v)}removeFromContainer(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(S.En)for(const D of S.En)D.stop(),D.autoplay=!1,this.Iv.mainSoundTrack.removeSound(D),v&&D.dispose()}dispose(){const S=this.Iv;if(S._mainSoundTrack&&S.mainSoundTrack.dispose(),S.soundTracks)for(let v=0;v<S.soundTracks.length;v++)S.soundTracks[v].dispose()}disableAudio(){const S=this.Iv;let v;for(this._audioEnabled=!1,Fv.d.audioEngine&&Fv.d.audioEngine.audioContext&&Fv.d.audioEngine.audioContext.suspend(),v=0;v<S.mainSoundTrack.soundCollection.length;v++)S.mainSoundTrack.soundCollection[v].pause();if(S.soundTracks)for(v=0;v<S.soundTracks.length;v++)for(let D=0;D<S.soundTracks[v].soundCollection.length;D++)S.soundTracks[v].soundCollection[D].pause()}enableAudio(){const S=this.Iv;let v;for(this._audioEnabled=!0,Fv.d.audioEngine&&Fv.d.audioEngine.audioContext&&Fv.d.audioEngine.audioContext.resume(),v=0;v<S.mainSoundTrack.soundCollection.length;v++)S.mainSoundTrack.soundCollection[v].isPaused&&S.mainSoundTrack.soundCollection[v].play();if(S.soundTracks)for(v=0;v<S.soundTracks.length;v++)for(let D=0;D<S.soundTracks[v].soundCollection.length;D++)S.soundTracks[v].soundCollection[D].isPaused&&S.soundTracks[v].soundCollection[D].play()}switchAudioModeForHeadphones(){const S=this.Iv;if(this._headphone=!0,S.mainSoundTrack.switchPanningModelToHRTF(),S.soundTracks)for(let v=0;v<S.soundTracks.length;v++)S.soundTracks[v].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const S=this.Iv;if(this._headphone=!1,S.mainSoundTrack.switchPanningModelToEqualPower(),S.soundTracks)for(let v=0;v<S.soundTracks.length;v++)S.soundTracks[v].switchPanningModelToEqualPower()}_afterRender(){const S=eD.c.Now;if(this._lastCheck&&S-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=S;const v=this.Iv;if(!this._audioEnabled||!v._mainSoundTrack||!v.soundTracks||0===v._mainSoundTrack.soundCollection.length&&1===v.soundTracks.length)return;const D=Fv.d.audioEngine;if(D&&D.audioContext){let S,z=v.activeCamera;if(v.activeCameras&&v.activeCameras.length>0&&(z=v.activeCameras[0]),this.audioListenerPositionProvider){const S=this.audioListenerPositionProvider();D.audioContext.listener.setPosition(S.x||0,S.y||0,S.z||0)}else z?this._cachedCameraPosition.equals(z.globalPosition)||(this._cachedCameraPosition.N(z.globalPosition),D.audioContext.listener.setPosition(z.globalPosition.x,z.globalPosition.y,z.globalPosition.z)):D.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const S=this.audioListenerRotationProvider();D.audioContext.listener.setOrientation(S.x||0,S.y||0,S.z||0,0,1,0)}else z?(z.rigCameras&&z.rigCameras.length>0&&(z=z.rigCameras[0]),z.getViewMatrix().invertToRef(this._invertMatrixTemp),e.Rv.TransformNormalToRef(ND._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.N(this._cameraDirectionTemp),D.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):D.audioContext.listener.setOrientation(0,0,0,0,1,0);for(S=0;S<v.mainSoundTrack.soundCollection.length;S++){const D=v.mainSoundTrack.soundCollection[S];D.useCustomAttenuation&&D.updateDistanceFromListener()}if(v.soundTracks)for(S=0;S<v.soundTracks.length;S++)for(let D=0;D<v.soundTracks[S].soundCollection.length;D++){const z=v.soundTracks[S].soundCollection[D];z.useCustomAttenuation&&z.updateDistanceFromListener()}}}}ND._CameraDirection=new e.Rv(0,0,-1),Pv._SceneComponentInitialization=S=>{let v=S._getComponent(SD.e.NAME_AUDIO);v||(v=new ND(S),S.o(v))};const mD="MSFT_audio_emitter";class BD{constructor(S){this.name=mD,this._loader=S,this.enabled=this._loader.isExtensionUsed(mD)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const S=this._loader.me.extensions;if(S&&S[this.name]){const v=S[this.name];this._clips=v.clips,this._emitters=v.emitters,Y.Assign(this._clips),Y.Assign(this._emitters)}}loadSceneAsync(S,v){return V.LoadExtensionAsync(S,v,this.name,(async(D,z)=>{const e=new Array;e.push(this._loader.loadSceneAsync(S,v));for(const S of z.emitters){const v=Y.Get(`${D}/emitters`,this._emitters,S);if(void 0!=v.refDistance||void 0!=v.maxDistance||void 0!=v.rolloffFactor||void 0!=v.distanceModel||void 0!=v.innerAngle||void 0!=v.outerAngle)throw new Error(`${D}: Direction or Distance properties are not allowed on emitters attached to a scene`);e.push(this._loadEmitterAsync(`${D}/emitters/${v.index}`,v))}await Promise.all(e)}))}loadNodeAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(S,z)=>{const N=new Array,B=await this._loader.loadNodeAsync(S,v,(v=>{for(const D of z.emitters){const z=Y.Get(`${S}/emitters`,this._emitters,D);N.push(this._loadEmitterAsync(`${S}/emitters/${z.index}`,z).then((()=>{for(const S of z._babylonSounds)S.attachToMesh(v),void 0==z.innerAngle&&void 0==z.outerAngle||(S.setLocalDirectionToMesh(e.Rv.Forward()),S.setDirectionalCone(2*m.Tools.ToDegrees(void 0==z.innerAngle?Math.PI:z.innerAngle),2*m.Tools.ToDegrees(void 0==z.outerAngle?Math.PI:z.outerAngle),0))})))}D(v)}));return await Promise.all(N),B}))}loadAnimationAsync(S,v){return V.LoadExtensionAsync(S,v,this.name,(async(D,z)=>{const e=await this._loader.loadAnimationAsync(S,v),N=new Array;Y.Assign(z.events);for(const m of z.events)N.push(this._loadAnimationEventAsync(`${D}/events/${m.index}`,S,v,m,e));return await Promise.all(N),e}))}_loadClipAsync(S,v){if(v._objectURL)return v._objectURL;let D;if(v.uri)D=this._loader.loadUriAsync(S,v,v.uri);else{const z=Y.Get(`${S}/bufferView`,this._loader.me.bufferViews,v.bufferView);D=this._loader.loadBufferViewAsync(`/bufferViews/${z.index}`,z)}return v._objectURL=D.then((S=>URL.createObjectURL(new Blob([S],{type:v.mimeType})))),v._objectURL}_loadEmitterAsync(S,v){if(v._babylonSounds=v._babylonSounds||[],!v._babylonData){const S=new Array,D=v.name||`emitter${v.index}`,z={loop:!1,autoplay:!1,volume:void 0==v.volume?1:v.volume};for(let N=0;N<v.clips.length;N++){const e=`/extensions/${this.name}/clips`,m=Y.Get(e,this._clips,v.clips[N].clip);S.push(this._loadClipAsync(`${e}/${v.clips[N].clip}`,m).then((S=>{const e=v._babylonSounds[N]=new Pv(D,S,this._loader.babylonScene,null,z);e.refDistance=v.refDistance||1,e.maxDistance=v.maxDistance||256,e.rolloffFactor=v.rolloffFactor||1,e.distanceModel=v.distanceModel||"exponential"})))}const e=Promise.all(S).then((()=>{const S=v.clips.map((S=>S.weight||1)),D=new Qv(v.loop||!1,v._babylonSounds,S);v.innerAngle&&(D.directionalConeInnerAngle=2*m.Tools.ToDegrees(v.innerAngle)),v.outerAngle&&(D.directionalConeOuterAngle=2*m.Tools.ToDegrees(v.outerAngle)),v.volume&&(D.volume=v.volume),v._babylonData.sound=D}));v._babylonData={loaded:e}}return v._babylonData.loaded}_getEventAction(S,v,D,z,e){switch(D){case"play":return S=>{const D=(e||0)+(S-z);v.play(D)};case"stop":return()=>{v.stop()};case"pause":return()=>{v.pause()};default:throw new Error(`${S}: Unsupported action ${D}`)}}_loadAnimationEventAsync(S,v,D,z,e){if(0==e.targetedAnimations.length)return Promise.resolve();const N=e.targetedAnimations[0],m=z.zv,B=Y.Get(`/extensions/${this.name}/emitters`,this._emitters,m);return this._loadEmitterAsync(S,B).then((()=>{const v=B._babylonData.sound;if(v){const D=new fv(z.time,this._getEventAction(S,v,z.action,z.time,z.startOffset));N.animation.addEvent(D),e.onAnimationGroupEndObservable.add((()=>{v.stop()})),e.onAnimationGroupPauseObservable.add((()=>{v.pause()}))}}))}}J(mD),c(mD,!0,(S=>new BD(S)));const gD="MSFT_lod";class ED{constructor(S){var v;this.name=gD,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new h.d,this.onMaterialLODsLoadedObservable=new h.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=S,this.maxLODsToLoad=(null===(v=this._loader.parent.extensionOptions[gD])||void 0===v?void 0:v.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(gD)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let S=0;S<this._nodePromiseLODs.length;S++){const v=Promise.all(this._nodePromiseLODs[S]).then((()=>{0!==S&&(this._loader.endPerformanceCounter(`Node LOD ${S}`),this._loader.log(`Loaded node LOD ${S}`)),this.onNodeLODsLoadedObservable.notifyObservers(S),S!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${S+1}`),this._loadBufferLOD(this._nodeBufferLODs,S+1),this._nodeSignalLODs[S]&&this._nodeSignalLODs[S].resolve())}));this._loader._completePromises.push(v)}for(let S=0;S<this._materialPromiseLODs.length;S++){const v=Promise.all(this._materialPromiseLODs[S]).then((()=>{0!==S&&(this._loader.endPerformanceCounter(`Material LOD ${S}`),this._loader.log(`Loaded material LOD ${S}`)),this.onMaterialLODsLoadedObservable.notifyObservers(S),S!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${S+1}`),this._loadBufferLOD(this._materialBufferLODs,S+1),this._materialSignalLODs[S]&&this._materialSignalLODs[S].resolve())}));this._loader._completePromises.push(v)}}loadSceneAsync(S,v){const D=this._loader.loadSceneAsync(S,v);return this._loadBufferLOD(this._bufferLODs,0),D}loadNodeAsync(S,v,D){return V.LoadExtensionAsync(S,v,this.name,(async(S,e)=>{let N;const m=this._getLODs(S,v,this._loader.me.nodes,e.ids);this._loader.logOpen(`${S}`);for(let v=0;v<m.length;v++){const S=m[v];0!==v&&(this._nodeIndexLOD=v,this._nodeSignalLODs[v]=this._nodeSignalLODs[v]||new z);const e=S=>{D(S),S.JB(!1)},B=this._loader.loadNodeAsync(`/nodes/${S.index}`,S,e).then((S=>{if(0!==v){const S=m[v-1];S._babylonTransformNode&&(this._disposeTransformNode(S._babylonTransformNode),delete S._babylonTransformNode)}return S.JB(!0),S}));this._nodePromiseLODs[v]=this._nodePromiseLODs[v]||[],0===v?N=B:(this._nodeIndexLOD=null,this._nodePromiseLODs[v].push(B))}return this._loader.logClose(),await N}))}_loadMaterialAsync(S,v,D,z,e){return this._nodeIndexLOD?null:V.LoadExtensionAsync(S,v,this.name,(async(S,N)=>{let m;const B=this._getLODs(S,v,this._loader.me.materials,N.ids);this._loader.logOpen(`${S}`);for(let v=0;v<B.length;v++){const S=B[v];0!==v&&(this._materialIndexLOD=v);const N=this._loader._loadMaterialAsync(`/materials/${S.index}`,S,D,z,(S=>{0===v&&e(S)})).then((S=>{if(0!==v){e(S);const D=B[v-1]._data;D[z]&&(this._disposeMaterials([D[z].babylonMaterial]),delete D[z])}return S}));this._materialPromiseLODs[v]=this._materialPromiseLODs[v]||[],0===v?m=N:(this._materialIndexLOD=null,this._materialPromiseLODs[v].push(N))}return this._loader.logClose(),await m}))}_loadUriAsync(S,v,D){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const e=this._nodeIndexLOD-1;return this._nodeSignalLODs[e]=this._nodeSignalLODs[e]||new z,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(S,v,D)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const e=this._materialIndexLOD-1;return this._materialSignalLODs[e]=this._materialSignalLODs[e]||new z,this._materialSignalLODs[e].promise.then((async()=>await this._loader.loadUriAsync(S,v,D)))}return null}loadBufferAsync(S,v,D,e){if(this._loader.parent.useRangeRequests&&!v.uri){if(!this._loader.bin)throw new Error(`${S}: Uri is missing or the binary glTF is missing its binary chunk`);const v=async(S,v)=>{const N=D,m=N+e-1;let B=S[v];return B?(B.start=Math.min(B.start,N),B.end=Math.max(B.end,m)):(B={start:N,end:m,loaded:new z},S[v]=B),await B.loaded.promise.then((S=>new Uint8Array(S.buffer,S.byteOffset+D-B.start,e)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?v(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?v(this._materialBufferLODs,this._materialIndexLOD):v(this._bufferLODs,0)}return null}_loadBufferLOD(S,v){const D=S[v];D&&(this._loader.log(`Loading buffer range [${D.start}-${D.end}]`),this._loader.bin.readAsync(D.start,D.end-D.start+1).then((S=>{D.loaded.resolve(S)}),(S=>{D.loaded.reject(S)})))}_getLODs(S,v,D,z){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const e=[];for(let N=z.length-1;N>=0;N--)if(e.push(Y.Get(`${S}/ids/${z[N]}`,D,z[N])),e.length===this.maxLODsToLoad)return e;return e.push(v),e}_disposeTransformNode(S){const v=[],D=S.material;D&&v.push(D);for(const e of S.getChildMeshes())e.material&&v.push(e.material);S.dispose();const z=v.filter((S=>this._loader.babylonScene.meshes.every((v=>v.material!=S))));this._disposeMaterials(z)}_disposeMaterials(S){const v={};for(const D of S){for(const S of D.getActiveTextures())v[S.uniqueId]=S;D.dispose()}for(const D in v)for(const S of this._loader.babylonScene.materials)S.hasTexture(v[D])&&delete v[D];for(const D in v)v[D].dispose()}}J(gD),c(gD,!0,(S=>new ED(S)));const hD="MSFT_minecraftMesh";class AD{constructor(S){this.name=hD,this._loader=S,this.enabled=this._loader.isExtensionUsed(hD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtraAsync(S,v,this.name,(async(z,e)=>{if(e){if(!(D instanceof u.d))throw new Error(`${z}: Material type not supported`);const e=this._loader.loadMaterialPropertiesAsync(S,v,D);return D.needAlphaBlending()&&(D.forceDepthWrite=!0,D.separateCullingPass=!0),D.Xe=D.forceDepthWrite,D.twoSidedLighting=!0,await e}}))}}J(hD),c(hD,!0,(S=>new AD(S)));const wD="MSFT_sRGBFactors";class nD{constructor(S){this.name=wD,this._loader=S,this.enabled=this._loader.isExtensionUsed(wD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(S,v,D){return V.LoadExtraAsync(S,v,this.name,(async(z,e)=>{if(e){if(!(D instanceof u.d))throw new Error(`${z}: Material type not supported`);const e=this._loader.loadMaterialPropertiesAsync(S,v,D),N=D.xS().getEngine().useExactSrgbConversions;return D.albedoTexture||D.albedoColor.toLinearSpaceToRef(D.albedoColor,N),D.reflectivityTexture||D.reflectivityColor.toLinearSpaceToRef(D.reflectivityColor,N),await e}}))}}J(wD),c(wD,!0,(S=>new nD(S)));var RD=D(13094);const OD={};var ID=D(13143),KD=D(13119),qD=D(13097),uD=D(13108);function sD(S,v){for(const D of S)for(const S of D.dataOutputs)if(S.uniqueId===v)return S;throw new Error("Could not find data out connection with unique id "+v)}function rD(S,v){for(const D of S)if(D instanceof KD.e)for(const S of D.signalInputs)if(S.uniqueId===v)return S;throw new Error("Could not find signal in connection with unique id "+v)}async function dD(S,v){const z=await Promise.all(S.allBlocks.map((async S=>{const v=function(S){switch(S){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([D.e(78),D.e(79)]).then(D.bind(D,14578))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await D.e(80).then(D.bind(D,14586))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await D.e(81).then(D.bind(D,14590))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await D.e(82).then(D.bind(D,14598))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await D.e(83).then(D.bind(D,14607))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await D.e(84).then(D.bind(D,14616))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await D.e(85).then(D.bind(D,14618))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await D.e(86).then(D.bind(D,14625))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await D.e(87).then(D.bind(D,14630))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await D.e(90).then(D.bind(D,14657))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await D.e(90).then(D.bind(D,14657))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await D.e(90).then(D.bind(D,14657))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await D.e(90).then(D.bind(D,14657))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await D.e(95).then(D.bind(D,14661))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await D.e(96).then(D.bind(D,14663))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await D.e(97).then(D.bind(D,14671))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await D.e(98).then(D.bind(D,14679))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await D.e(99).then(D.bind(D,14686))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await D.e(100).then(D.bind(D,14694))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await D.e(101).then(D.bind(D,14702))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await D.e(102).then(D.bind(D,14706))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await D.e(103).then(D.bind(D,14711))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await D.e(104).then(D.bind(D,14714))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await D.e(105).then(D.bind(D,14723))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await D.e(106).then(D.bind(D,14727))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await D.e(107).then(D.bind(D,14731))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await D.e(108).then(D.bind(D,14734))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await D.e(109).then(D.bind(D,14743))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await D.e(110).then(D.bind(D,14751))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await D.e(111).then(D.bind(D,14755))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await D.e(112).then(D.bind(D,14757))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await D.e(113).then(D.bind(D,14765))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await D.e(92).then(D.bind(D,14768))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await D.e(114).then(D.bind(D,14776))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await D.e(115).then(D.bind(D,14785))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await D.e(116).then(D.bind(D,14792))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await D.e(93).then(D.bind(D,14800))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await D.e(88).then(D.bind(D,14636))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await D.e(94).then(D.bind(D,14805))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await D.e(94).then(D.bind(D,14805))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await D.e(94).then(D.bind(D,14805))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await D.e(94).then(D.bind(D,14805))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await D.e(94).then(D.bind(D,14805))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await D.e(94).then(D.bind(D,14805))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await D.e(94).then(D.bind(D,14805))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await D.e(94).then(D.bind(D,14805))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await D.e(89).then(D.bind(D,14654))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await D.e(90).then(D.bind(D,14657))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await D.e(90).then(D.bind(D,14657))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await D.e(91).then(D.bind(D,14814))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await D.e(91).then(D.bind(D,14814))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await D.e(91).then(D.bind(D,14814))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await D.e(91).then(D.bind(D,14814))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await D.e(91).then(D.bind(D,14814))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await D.e(91).then(D.bind(D,14814))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await D.e(117).then(D.bind(D,14816))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await D.e(118).then(D.bind(D,14821))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await D.e(119).then(D.bind(D,14827))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await D.e(120).then(D.bind(D,14836))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await D.e(121).then(D.bind(D,14838))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await D.e(122).then(D.bind(D,14847))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await D.e(123).then(D.bind(D,14853))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await D.e(124).then(D.bind(D,14861))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await D.e(125).then(D.bind(D,14869))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await D.e(126).then(D.bind(D,14878))).FlowGraphDataSwitchBlock;default:if(OD[S])return OD[S];throw new Error(`Unknown block name ${S}`)}}(S.className);return await v()})));return function(S,v,D){const z=v.coordinator.createGraph(),e=[],N=v.valueParseFunction??qD.c;for(let m=0;m<S.allBlocks.length;m++){const B=WD(S.allBlocks[m],{Iv:v.coordinator.config.Iv,pathConverter:v.pathConverter,assetsContainer:v.coordinator.config.Iv,valueParseFunction:N},D[m]);e.push(B),B instanceof ID.c&&z.addEventBlock(B)}for(const m of e){for(const S of m.dataInputs)for(const v of S.connectedPointIds){const D=sD(e,v);S.connectTo(D)}if(m instanceof KD.e)for(const S of m.signalOutputs)for(const v of S.connectedPointIds){const D=rD(e,v);S.connectTo(D)}}for(const m of S.executionContexts)xD(m,{graph:z,valueParseFunction:N},S.rightHanded);return z}(S,v,z)}function xD(S,v,D){const z=v.graph.createContext();S.enableLogging&&(z.enableLogging=!0),z.treatDataAsRightHanded=D||!1;const e=v.valueParseFunction??qD.c;z.uniqueId=S.uniqueId;const N=z.xS();if(S._assetsContext){var m,B,g,E,h,A,w,n,R,O;const v=S._assetsContext,D={meshes:null===(m=v.meshes)||void 0===m?void 0:m.map((S=>N.getMeshById(S))),lights:null===(B=v.lights)||void 0===B?void 0:B.map((S=>N.getLightByName(S))),cameras:null===(g=v.cameras)||void 0===g?void 0:g.map((S=>N.getCameraByName(S))),materials:null===(E=v.materials)||void 0===E?void 0:E.map((S=>N.getMaterialById(S))),textures:null===(h=v.textures)||void 0===h?void 0:h.map((S=>N.getTextureByName(S))),animations:null===(A=v.animations)||void 0===A?void 0:A.map((S=>N.animations.find((v=>v.name===S)))),skeletons:null===(w=v.skeletons)||void 0===w?void 0:w.map((S=>N.getSkeletonByName(S))),Zw:null===(n=v.Zw)||void 0===n?void 0:n.map((S=>N.getParticleSystemById(S))),animationGroups:null===(R=v.animationGroups)||void 0===R?void 0:R.map((S=>N.getAnimationGroupByName(S))),transformNodes:null===(O=v.transformNodes)||void 0===O?void 0:O.map((S=>N.getTransformNodeById(S))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],En:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};z.assetsContext=D}for(const I in S._userVariables){const v=e(I,S._userVariables,z.assetsContext,N);z.userVariables[I]=v}for(const I in S._connectionValues){const v=e(I,S._connectionValues,z.assetsContext,N);z._setConnectionValueByKey(I,v)}return z}function WD(S,v,D){const z={},e=v.valueParseFunction??qD.c;if(S.config)for(const m in S.config)z[m]=e(m,S.config,v.assetsContainer||v.Iv,v.Iv);if((0,qD.g)(S.className)){if(!v.pathConverter)throw new Error("Path converter is required for this block");z.pathConverter=v.pathConverter}const N=new D(z);N.uniqueId=S.uniqueId;for(let m=0;m<S.dataInputs.length;m++){const v=N.getDataInput(S.dataInputs[m].name);if(!v)throw new Error("Could not find data input with name "+S.dataInputs[m].name+" in block "+S.className);v.deserialize(S.dataInputs[m])}for(let m=0;m<S.dataOutputs.length;m++){const v=N.getDataOutput(S.dataOutputs[m].name);if(!v)throw new Error("Could not find data output with name "+S.dataOutputs[m].name+" in block "+S.className);v.deserialize(S.dataOutputs[m])}return N.metadata=S.metadata,N.deserialize&&N.deserialize(S),N}function pD(S){const[v,D]=S.split(":");return bD({op:v,extension:D})}function bD(S){var v;let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const z=S.extension?null===(v=ZD[S.extension])||void 0===v?void 0:v[S.op]:iD[S.op];if(!z&&(O.b.Warn(`No mapping found for operation ${S.op} and extension ${S.extension||"KHR_interactivity"}`),D)){const v={},D={flows:{}};if(S.inputValueSockets){v.values={};for(const D in S.inputValueSockets)v.values[D]={name:D}}return S.outputValueSockets&&(D.values={},Object.keys(S.outputValueSockets).forEach((S=>{D.values[S]={name:S}}))),{jh:[],inputs:v,outputs:D}}return z}function kD(S,v,D){ZD[v]||(ZD[v]={}),ZD[v][S]=D}const ZD={BABYLON:{"flow/log":{jh:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},iD={"event/onStart":{jh:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{jh:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{jh:["FlowGraphSendCustomEventBlock"],extraProcessor(S,v,D,z,e){if("event/send"!==v.op||!S.configuration||1!==Object.keys(S.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const N=S.configuration.event.value[0];if("number"!==typeof N)throw new Error("Event id should be a number");const m=z.arrays.events[N],B=e[0];return B.config||(B.config={}),B.config.eventId=m.eventId,B.config.eventData=m.eventData,e}},"event/receive":{jh:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(S,v){var D;if(!S.configuration)return O.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const z=S.configuration.event;if(!z)return O.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const e=z.value[0];if("number"!==typeof e)return O.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(D=v.events)||void 0===D?void 0:D[e])?{valid:!0}:(O.b.Error(`Event with id ${e} not found`),{valid:!1,error:`Event with id ${e} not found`})},extraProcessor(S,v,D,z,e){if("event/receive"!==v.op||!S.configuration||1!==Object.keys(S.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const N=S.configuration.event.value[0];if("number"!==typeof N)throw new Error("Event id should be a number");const m=z.arrays.events[N],B=e[0];return B.config||(B.config={}),B.config.eventId=m.eventId,B.config.eventData=m.eventData,e}},"math/e":tD("FlowGraphEBlock"),"math/pi":tD("FlowGraphPIBlock"),"math/inf":tD("FlowGraphInfBlock"),"math/nan":tD("FlowGraphNaNBlock"),"math/abs":tD("FlowGraphAbsBlock"),"math/sign":tD("FlowGraphSignBlock"),"math/trunc":tD("FlowGraphTruncBlock"),"math/floor":tD("FlowGraphFloorBlock"),"math/ceil":tD("FlowGraphCeilBlock"),"math/round":{jh:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e){var N;return(N=e[0]).config||(N.config={}),e[0].config.roundHalfAwayFromZero=!0,e}},"math/fract":tD("FlowGraphFractBlock"),"math/neg":tD("FlowGraphNegationBlock"),"math/add":tD("FlowGraphAddBlock",["a","b"],!0),"math/sub":tD("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{jh:["FlowGraphMultiplyBlock"],extraProcessor(S,v,D,z,e){var N;(N=e[0]).config||(N.config={}),e[0].config.useMatrixPerComponent=!0,e[0].config.preventIntegerFloatArithmetic=!0;let m=-1;return Object.keys(S.values||{}).find((v=>{var D;return void 0!==(null===(D=S.values)||void 0===D?void 0:D[v].type)&&(m=S.values[v].type,!0)})),-1!==m&&(e[0].config.type=z.arrays.types[m].flowGraphType),e},validation:S=>S.values?XD(S):{valid:!0}},"math/div":tD("FlowGraphDivideBlock",["a","b"],!0),"math/rem":tD("FlowGraphModuloBlock",["a","b"]),"math/min":tD("FlowGraphMinBlock",["a","b"]),"math/max":tD("FlowGraphMaxBlock",["a","b"]),"math/clamp":tD("FlowGraphClampBlock",["a","b","c"]),"math/saturate":tD("FlowGraphSaturateBlock"),"math/mix":tD("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":tD("FlowGraphEqualityBlock",["a","b"]),"math/lt":tD("FlowGraphLessThanBlock",["a","b"]),"math/le":tD("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":tD("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":tD("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":tD("FlowGraphIsNaNBlock"),"math/isinf":tD("FlowGraphIsInfBlock"),"math/select":{jh:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{jh:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":tD("FlowGraphSinBlock"),"math/cos":tD("FlowGraphCosBlock"),"math/tan":tD("FlowGraphTanBlock"),"math/asin":tD("FlowGraphASinBlock"),"math/acos":tD("FlowGraphACosBlock"),"math/atan":tD("FlowGraphATanBlock"),"math/atan2":tD("FlowGraphATan2Block",["a","b"]),"math/sinh":tD("FlowGraphSinhBlock"),"math/cosh":tD("FlowGraphCoshBlock"),"math/tanh":tD("FlowGraphTanhBlock"),"math/asinh":tD("FlowGraphASinhBlock"),"math/acosh":tD("FlowGraphACoshBlock"),"math/atanh":tD("FlowGraphATanhBlock"),"math/exp":tD("FlowGraphExponentialBlock"),"math/log":tD("FlowGraphLogBlock"),"math/log2":tD("FlowGraphLog2Block"),"math/log10":tD("FlowGraphLog10Block"),"math/sqrt":tD("FlowGraphSquareRootBlock"),"math/cbrt":tD("FlowGraphCubeRootBlock"),"math/pow":tD("FlowGraphPowerBlock",["a","b"]),"math/length":tD("FlowGraphLengthBlock"),"math/normalize":tD("FlowGraphNormalizeBlock"),"math/dot":tD("FlowGraphDotBlock",["a","b"]),"math/cross":tD("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":tD("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":tD("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{jh:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{jh:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{jh:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{jh:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{jh:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{jh:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{jh:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":tD("FlowGraphTransposeBlock"),"math/determinant":tD("FlowGraphDeterminantBlock"),"math/inverse":tD("FlowGraphInvertMatrixBlock"),"math/matmul":tD("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{jh:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Me",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e,N){const m=e[0].dataInputs.find((S=>"rotationQuaternion"===S.name));if(!m)throw new Error("Rotation quaternion input not found");return N._connectionValues[m.uniqueId]&&(N._connectionValues[m.uniqueId].type="Quaternion"),e}},"math/matDecompose":{jh:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Me"}}}},"math/quatConjugate":tD("FlowGraphConjugateBlock",["a"]),"math/quatMul":{jh:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e){var N;return(N=e[0]).config||(N.config={}),e[0].config.type="Quaternion",e}},"math/quatAngleBetween":tD("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{jh:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":tD("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":tD("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{jh:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e){var N;return(N=e[0]).config||(N.config={}),e[0].config.inputIsColumnMajor=!0,e}},"math/extract2x2":{jh:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{jh:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e){var N;return(N=e[0]).config||(N.config={}),e[0].config.inputIsColumnMajor=!0,e}},"math/extract3x3":{jh:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{jh:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e){var N;return(N=e[0]).config||(N.config={}),e[0].config.inputIsColumnMajor=!0,e}},"math/extract4x4":{jh:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{jh:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e,N){var m,B;(B=e[0]).config||(B.config={});const g=e[0].dataInputs[0];return e[0].config.valueType=(null===(m=N._connectionValues[g.uniqueId])||void 0===m?void 0:m.type)??"FlowGraphInteger",e}},"math/and":{jh:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e,N){var m,B,g;(g=e[0]).config||(g.config={});const E=e[0].dataInputs[0],h=e[0].dataInputs[1];return e[0].config.valueType=(null===(m=N._connectionValues[E.uniqueId])||void 0===m?void 0:m.type)??(null===(B=N._connectionValues[h.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",e}},"math/or":{jh:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e,N){var m,B,g;(g=e[0]).config||(g.config={});const E=e[0].dataInputs[0],h=e[0].dataInputs[1];return e[0].config.valueType=(null===(m=N._connectionValues[E.uniqueId])||void 0===m?void 0:m.type)??(null===(B=N._connectionValues[h.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",e}},"math/xor":{jh:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(S,v,D,z,e,N){var m,B,g;(g=e[0]).config||(g.config={});const E=e[0].dataInputs[0],h=e[0].dataInputs[1];return e[0].config.valueType=(null===(m=N._connectionValues[E.uniqueId])||void 0===m?void 0:m.type)??(null===(B=N._connectionValues[h.uniqueId])||void 0===B?void 0:B.type)??"FlowGraphInteger",e}},"math/asr":tD("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":tD("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":tD("FlowGraphLeadingZerosBlock"),"math/ctz":tD("FlowGraphTrailingZerosBlock"),"math/popcnt":tD("FlowGraphOneBitsCounterBlock"),"math/rad":tD("FlowGraphDegToRadBlock"),"math/deg":tD("FlowGraphRadToDegBlock"),"type/boolToInt":tD("FlowGraphBooleanToInt"),"type/boolToFloat":tD("FlowGraphBooleanToFloat"),"type/intToBool":tD("FlowGraphIntToBoolean"),"type/intToFloat":tD("FlowGraphIntToFloat"),"type/floatToInt":tD("FlowGraphFloatToInt"),"type/floatToBool":tD("FlowGraphFloatToBoolean"),"flow/sequence":{jh:["FlowGraphSequenceBlock"],extraProcessor(S,v,D,z,e){const N=e[0];return N.config||(N.config={}),N.config.outputSignalCount=Object.keys(S.flows||[]).length,N.signalOutputs.forEach(((S,v)=>{S.name="out_"+v})),e}},"flow/branch":{jh:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{jh:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(S){if(S.configuration&&S.configuration.cases){const v=S.configuration.cases.value;if(!v.every((S=>"number"===typeof S&&/^-?\d+$/.test(S.toString()))))return O.b.Warn("Switch cases should be integers. Using empty array instead."),S.configuration.cases.value=[],{valid:!0};const D=new Set(v);S.configuration.cases.value=Array.from(D)}return{valid:!0}},extraProcessor(S,v,D,z,e){if("flow/switch"!==v.op||!S.flows||0===Object.keys(S.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return e[0].signalOutputs.forEach((S=>{"default"!==S.name&&(S.name="out_"+S.name)})),e}},"flow/while":{jh:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{jh:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(S,v,D,z,e){const N=e[0];return N.config||(N.config={}),N.config.incrementIndexWhenLoopDone=!0,e}},"flow/doN":{jh:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{jh:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(S,v,D,z,e){if("flow/multiGate"!==v.op||!S.flows||0===Object.keys(S.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const N=e[0];return N.config||(N.config={}),N.config.outputSignalCount=Object.keys(S.flows).length,N.signalOutputs.forEach(((S,v)=>{S.name="out_"+v})),e}},"flow/waitAll":{jh:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(S){var v,D;return"number"!==typeof(null===(v=S.configuration)||void 0===v||null===(D=v.inputFlows)||void 0===D?void 0:D.value[0])&&(S.configuration=S.configuration||{inputFlows:{value:[0]}},S.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{jh:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{jh:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{jh:["FlowGraphCancelDelayBlock"]},"variable/get":{jh:["FlowGraphGetVariableBlock"],validation(S){var v,D;return null!==(v=S.configuration)&&void 0!==v&&null!==(D=v.variable)&&void 0!==D&&D.value?{valid:!0}:(O.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(S,v)=>[v.getVariableName(S[0])]}}},"variable/set":{jh:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(S,v)=>[v.getVariableName(S[0])]}}},"variable/setMultiple":{jh:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(S,v)=>[S[0].map((S=>v.getVariableName(S)))]}},extraProcessor:(S,v,D,z,e)=>(e[0].dataInputs.forEach((S=>{S.name=z.getVariableName(+S.name)})),e)},"variable/interpolate":{jh:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(S,v)=>[v.getVariableName(S[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:S=>!0===S[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",sD:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",sD:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",sD:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",sD:"FlowGraphPlayAnimationBlock"},out:{name:"out",sD:"FlowGraphPlayAnimationBlock"},done:{name:"done",sD:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(S,v,D,z,e){var N,m,B;const g=e[0],E=null===(N=S.configuration)||void 0===N?void 0:N.variable.value[0];if("number"!==typeof E)throw O.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const h=z.arrays.staticVariables[E];"undefined"===typeof g.config.animationType.value&&(z.arrays.staticVariables,g.config.animationType.value=(0,uD.J)(h.type));const A=e[4];return A.config||(A.config={}),(m=A.config).variable||(m.variable={}),A.config.variable.value=z.getVariableName(E),(B=e[3]).config||(B.config={}),e}},"pointer/get":{jh:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",sD:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",sD:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(S,v,D,z,e)=>(e.forEach((S=>{"FlowGraphJsonPointerParserBlock"===S.className&&(S.config||(S.config={}),S.config.outputValue=!0)})),e)},"pointer/set":{jh:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",sD:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",sD:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(S,v,D,z,e)=>(e.forEach((S=>{"FlowGraphJsonPointerParserBlock"===S.className&&(S.config||(S.config={}),S.config.outputValue=!0)})),e)},"pointer/interpolate":{jh:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",sD:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",sD:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",sD:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",sD:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",sD:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",sD:"FlowGraphPlayAnimationBlock"},out:{name:"out",sD:"FlowGraphPlayAnimationBlock"},done:{name:"done",sD:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(S,v,D,z,e)=>(e.forEach((v=>{"FlowGraphJsonPointerParserBlock"===v.className?(v.config||(v.config={}),v.config.outputValue=!0):"FlowGraphInterpolationBlock"===v.className&&(v.config||(v.config={}),Object.keys(S.values||[]).forEach((D=>{var e;const N=null===(e=S.values)||void 0===e?void 0:e[D];if("value"===D&&N){const S=N.type;void 0!==S&&(v.config.animationType=z.arrays.types[S].flowGraphType)}})))})),e)},"animation/start":{jh:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",sD:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(S,v)=>[S[0]*v._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(S,v)=>[S[0]*v._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(S,v,D,z,e,N,m){const B=e[e.length-1];return B.config||(B.config={}),B.config.glTF=m,e}},"animation/stop":{jh:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",sD:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(S,v,D,z,e,N,m){const B=e[e.length-1];return B.config||(B.config={}),B.config.glTF=m,e}},"animation/stopAt":{jh:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",sD:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(S,v)=>[S[0]*v._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(S,v,D,z,e,N,m){const B=e[e.length-1];return B.config||(B.config={}),B.config.glTF=m,e}},"math/switch":{jh:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(S){if(S.configuration&&S.configuration.cases){const v=S.configuration.cases.value;if(!v.every((S=>"number"===typeof S&&/^-?\d+$/.test(S.toString()))))return O.b.Warn("Switch cases should be integers. Using empty array instead."),S.configuration.cases.value=[],{valid:!0};const D=new Set(v);S.configuration.cases.value=Array.from(D)}return{valid:!0}},extraProcessor(S,v,D,z,e){const N=e[0];return N.dataInputs.forEach((S=>{"default"!==S.name&&"case"!==S.name&&(S.name="in_"+S.name)})),N.config||(N.config={}),N.config.treatCasesAsIntegers=!0,e}},"debug/log":{jh:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function tD(S){let v=arguments.length>2?arguments[2]:void 0;return{jh:[S],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((S,v)=>(S[v]={name:v},S)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(S,D,z,e,N){var m;if(v){(m=N[0]).config||(m.config={}),N[0].config.preventIntegerFloatArithmetic=!0;let v=-1;Object.keys(S.values||{}).find((D=>{var z;return void 0!==(null===(z=S.values)||void 0===z?void 0:z[D].type)&&(v=S.values[D].type,!0)})),-1!==v&&(N[0].config.type=e.arrays.types[v].flowGraphType)}return N},validation:S=>v?XD(S):{valid:!0}}}function XD(S){if(S.values){const v=Object.keys(S.values).map((v=>S.values[v].type)).filter((S=>void 0!==S));if(!v.every((S=>S===v[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}iD["math/compose"]=iD["math/matCompose"],iD["math/decompose"]=iD["math/matDecompose"];var aD=D(11336);const oD={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Rv",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class MD{constructor(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=S,this._gltf=v,this._animationTargetFps=D,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const S of this._interactivityGraph.types)this._types.push(oD[S.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const S of this._interactivityGraph.declarations){const v=bD(S);if(!v)throw O.b.Error(["No mapping found for declaration",S]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:v,fullOperationName:S.extension?S.op+":"+S.extension:S.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const S of this._interactivityGraph.variables){const v=this._parseVariable(S);this._staticVariables.push(v)}}_parseVariable(S,v){const D=this._types[S.type];if(!D)throw O.b.Error(["No type found for variable",S]),new Error("Error parsing variables");if(S.value&&S.value.length!==D.length)throw O.b.Error(["Invalid value length for variable",S,D]),new Error("Error parsing variables");const z=S.value||[];if(!z.length)switch(D.flowGraphType){case"boolean":z.push(!1);break;case"FlowGraphInteger":z.push(0);break;case"number":z.push(NaN);break;case"Vector2":z.push(NaN,NaN);break;case"Rv":z.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":z.fill(NaN,0,4);break;case"Matrix":z.fill(NaN,0,16);break;case"Matrix3D":z.fill(NaN,0,9)}return"number"===D.elementType&&"string"===typeof z[0]&&(z[0]=parseFloat(z[0])),{type:D.flowGraphType,value:v?v(z,this):z}}_parseEvents(){if(this._interactivityGraph.events)for(const S of this._interactivityGraph.events){const v={eventId:S.id||"internalEvent_"+this._internalEventsCounter++};S.values&&(v.eventData=Object.keys(S.values).map((v=>{var D;const z=null===(D=S.values)||void 0===D?void 0:D[v];if(!z)throw O.b.Error(["No value found for event key",v]),new Error("Error parsing events");const e=this._types[z.type];if(!e)throw O.b.Error(["No type found for event value",z]),new Error("Error parsing events");const N="undefined"!==typeof z.value?this._parseVariable(z):void 0;return{id:v,type:e.flowGraphType,eventData:!0,value:N}}))),this._events.push(v)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const v of this._interactivityGraph.nodes){if("number"!==typeof v.declaration)throw O.b.Error(["No declaration found for node",v]),new Error("Error parsing nodes");const D=this._mappings[v.declaration];if(!D)throw O.b.Error(["No mapping found for node",v]),new Error("Error parsing nodes");if(D.flowGraphMapping.validation){const z=D.flowGraphMapping.validation(v,this._interactivityGraph,this._gltf);var S;if(!z.valid)throw new Error(`Error validating interactivity node ${null===(S=this._interactivityGraph.declarations)||void 0===S?void 0:S[v.declaration].op} - ${z.error}`)}const z=[];for(const S of D.flowGraphMapping.jh){const e=this._getEmptyBlock(S,D.fullOperationName);this._parseNodeConfiguration(v,e,D.flowGraphMapping,S),z.push(e)}this._nodes.push({jh:z,fullOperationName:D.fullOperationName})}}_getEmptyBlock(S,v){return{uniqueId:(0,aD.e)(),className:S,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:v,metadata:{}}}_parseNodeConfiguration(S,v,D,z){const e=v.config;if(S.configuration){const v=Object.keys(S.configuration);for(const B of v){var N,m;const v=null===(N=S.configuration)||void 0===N?void 0:N[B];if(!v)throw O.b.Error(["No value found for node configuration",B]),new Error("Error parsing node configuration");const g=null===(m=D.configuration)||void 0===m?void 0:m[B];if(g&&g.sD?g.sD===z:0===D.jh.indexOf(z)){const S=(null===g||void 0===g?void 0:g.name)||B;v&&"undefined"!==typeof v.value||"undefined"===typeof(null===g||void 0===g?void 0:g.defaultValue)?v.value.length>=0?e[S]={value:1===v.value.length?v.value[0]:v.value}:O.b.Warn(["Invalid value for node configuration",v]):e[S]={value:g.defaultValue},g&&g.dataTransformer&&(e[S].value=g.dataTransformer([e[S].value],this)[0])}}}}_parseNodeConnections(S){for(let d=0;d<this._nodes.length;d++){var v;const x=null===(v=this._interactivityGraph.nodes)||void 0===v?void 0:v[d];if(!x)throw O.b.Error(["No node found for interactivity node",this._nodes[d]]),new Error("Error parsing node connections");const W=this._nodes[d],p=this._mappings[x.declaration];if(!p)throw O.b.Error(["No mapping found for node",x]),new Error("Error parsing node connections");const b=x.flows||{},k=Object.keys(b).sort();for(const S of k){var D,z,e,N;const v=b[S],E=null===(D=p.flowGraphMapping.outputs)||void 0===D||null===(z=D.flows)||void 0===z?void 0:z[S],h=(null===E||void 0===E?void 0:E.name)||S,A=this._createNewSocketConnection(h,!0);(E&&E.sD&&W.jh.find((S=>S.className===E.sD))||W.jh[0]).signalOutputs.push(A);const w=v.node,n=this._nodes[w];if(!n)throw O.b.Error(["No node found for input node id",w]),new Error("Error parsing node connections");const R=pD(n.fullOperationName);if(!R)throw O.b.Error(["No mapping found for input node",n]),new Error("Error parsing node connections");let I=null===(e=R.inputs)||void 0===e||null===(N=e.flows)||void 0===N?void 0:N[v.socket||"in"],K=!1;if(!I)for(const S in null===(m=R.inputs)||void 0===m?void 0:m.flows){var m,B,g;if(S.startsWith("[")&&S.endsWith("]"))K=!0,I=null===(B=R.inputs)||void 0===B||null===(g=B.flows)||void 0===g?void 0:g[S]}const q=I?K?I.name.replace("$1",v.socket||""):I.name:v.socket||"in",u=I&&I.sD&&n.jh.find((S=>S.className===I.sD))||n.jh[0];let s=u.signalInputs.find((S=>S.name===q));s||(s=this._createNewSocketConnection(q),u.signalInputs.push(s)),s.connectedPointIds.push(A.uniqueId),A.connectedPointIds.push(s.uniqueId)}const Z=x.values||{},i=Object.keys(Z);for(const v of i){var E,h;const D=Z[v];let z=null===(E=p.flowGraphMapping.inputs)||void 0===E||null===(h=E.values)||void 0===h?void 0:h[v],e=!1;if(!z)for(const S in null===(A=p.flowGraphMapping.inputs)||void 0===A?void 0:A.values){var A,w,n;if(S.startsWith("[")&&S.endsWith("]"))e=!0,z=null===(w=p.flowGraphMapping.inputs)||void 0===w||null===(n=w.values)||void 0===n?void 0:n[S]}const N=z?e?z.name.replace("$1",v):z.name:v,m=this._createNewSocketConnection(N);if((z&&z.sD&&W.jh.find((S=>S.className===z.sD))||W.jh[0]).dataInputs.push(m),void 0!==D.value){const v=this._parseVariable(D,z&&z.dataTransformer);S._connectionValues[m.uniqueId]=v}else{if("undefined"===typeof D.node)throw O.b.Error(["Invalid value for value connection",D]),new Error("Error parsing node connections");{var R,I,K;const S=D.node,v=D.socket||"value",z=this._nodes[S];if(!z)throw O.b.Error(["No node found for output socket reference",D]),new Error("Error parsing node connections");const e=pD(z.fullOperationName);if(!e)throw O.b.Error(["No mapping found for output socket reference",D]),new Error("Error parsing node connections");let N=null===(R=e.outputs)||void 0===R||null===(I=R.values)||void 0===I?void 0:I[v],B=!1;if(!N)for(const D in null===(q=e.outputs)||void 0===q?void 0:q.values){var q,u,s;if(D.startsWith("[")&&D.endsWith("]"))B=!0,N=null===(u=e.outputs)||void 0===u||null===(s=u.values)||void 0===s?void 0:s[D]}const g=N?B?N.name.replace("$1",v):null===(K=N)||void 0===K?void 0:K.name:v,E=N&&N.sD&&z.jh.find((S=>S.className===N.sD))||z.jh[0];let h=E.dataOutputs.find((S=>S.name===g));h||(h=this._createNewSocketConnection(g,!0),E.dataOutputs.push(h)),m.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(m.uniqueId)}}}if(p.flowGraphMapping.interBlockConnectors)for(const S of p.flowGraphMapping.interBlockConnectors){const v=S.input,D=S.output,z=S.isVariable;this._connectFlowGraphNodes(v,D,W.jh[S.inputBlockIndex],W.jh[S.outputBlockIndex],z)}if(p.flowGraphMapping.extraProcessor){var r;const v=null===(r=this._interactivityGraph.declarations)||void 0===r?void 0:r[x.declaration];if(!v)throw O.b.Error(["No declaration found for extra processor",x]),new Error("Error parsing node connections");W.jh=p.flowGraphMapping.extraProcessor(x,v,p.flowGraphMapping,this,W.jh,S,this._gltf)}}}_createNewSocketConnection(S,v){return{uniqueId:(0,aD.e)(),name:S,_connectionType:v?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(S,v,D,z,e){const N=e?D.dataInputs:D.signalInputs,m=e?z.dataOutputs:z.signalOutputs,B=N.find((v=>v.name===S))||this._createNewSocketConnection(S),g=m.find((S=>S.name===v))||this._createNewSocketConnection(v,!0);N.find((v=>v.name===S))||N.push(B),m.find((S=>S.name===v))||m.push(g),B.connectedPointIds.push(g.uniqueId),g.connectedPointIds.push(B.uniqueId)}getVariableName(S){return"staticVariable_"+S}serializeToFlowGraph(){const S={uniqueId:(0,aD.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(S);for(let v=0;v<this._staticVariables.length;v++){const D=this._staticVariables[v];S._userVariables[this.getVariableName(v)]=D}return{rightHanded:!0,allBlocks:this._nodes.reduce(((S,v)=>S.concat(v.jh)),[]),executionContexts:[S]}}}const cD="KHR_interactivity";class JD{constructor(S){this._loader=S,this.name=cD,this.enabled=this._loader.isExtensionUsed(cD),this._pathConverter=(0,H.i)(this._loader.me),S._skipStartAnimationStep=!0;const v=S.babylonScene;v&&function(S){(0,H.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!S.activeCamera)return new e.Quaternion(NaN,NaN,NaN,NaN);const v=e.Quaternion.FromRotationMatrix(S.activeCamera.getWorldMatrix()).normalize();return S.useRightHandedSystem||(v.w*=-1,v.x*=-1),v},type:"Quaternion",getTarget:()=>S.activeCamera}),(0,H.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!S.activeCamera)return new e.Rv(NaN,NaN,NaN);const v=S.activeCamera.getWorldMatrix().getTranslation();return S.useRightHandedSystem||(v.x*=-1),v},type:"Rv",getTarget:()=>S.activeCamera}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:S=>{var v;return(null===(v=S._babylonAnimationGroup)||void 0===v?void 0:v.isPlaying)??!1},type:"boolean",getTarget:S=>S._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:S=>{var v;return((null===(v=S._babylonAnimationGroup)||void 0===v?void 0:v.from)??0)/60},type:"number",getTarget:S=>S._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:S=>{var v;return((null===(v=S._babylonAnimationGroup)||void 0===v?void 0:v.to)??0)/60},type:"number",getTarget:S=>S._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:S=>{var v;return((null===(v=S._babylonAnimationGroup)||void 0===v?void 0:v.getCurrentFrame())??0)/60},type:"number",getTarget:S=>S._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:S=>{var v;return((null===(v=S._babylonAnimationGroup)||void 0===v?void 0:v.getCurrentFrame())??0)/60},type:"number",getTarget:S=>S._babylonAnimationGroup})}(v)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var S;if(!this._loader.babylonScene||!this._pathConverter)return;const v=this._loader.babylonScene,D=null===(S=this._loader.me.extensions)||void 0===S?void 0:S.KHR_interactivity;if(!D)return;const z=new RD.b({Iv:v});z.dispatchEventsSynchronously=!1;const e=D.graphs.map((S=>new MD(S,this._loader.me,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(e.map((async S=>await dD(S,{coordinator:z,pathConverter:this._pathConverter})))),z.start()}}var HD;HD=async()=>(await Promise.resolve().then(D.bind(D,13153))).FlowGraphGLTFDataProvider,OD[`${cD}/${"FlowGraphGLTFDataProvider"}`]=HD,J(cD),c(cD,!0,(S=>new JD(S)));const TD="KHR_node_visibility";(0,H.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:S=>{const v=S._babylonTransformNode;return!v||void 0===v.isVisible||v.isVisible},set:(S,v)=>{var D,z;null===(D=v._primitiveBabylonMeshes)||void 0===D||D.forEach((S=>{S.inheritVisibility=!0})),v._babylonTransformNode&&(v._babylonTransformNode.isVisible=S),null===(z=v._primitiveBabylonMeshes)||void 0===z||z.forEach((v=>{v.isVisible=S}))},getTarget:S=>S._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class GD{constructor(S){this.name=TD,this._loader=S,this.enabled=S.isExtensionUsed(TD)}async onReady(){var S;null===(S=this._loader.me.nodes)||void 0===S||S.forEach((S=>{var v,D,z,e;(null===(v=S._primitiveBabylonMeshes)||void 0===v||v.forEach((S=>{S.inheritVisibility=!0})),null!==(D=S.extensions)&&void 0!==D&&D.KHR_node_visibility)&&(!1===(null===(z=S.extensions)||void 0===z?void 0:z.KHR_node_visibility.visible)&&(S._babylonTransformNode&&(S._babylonTransformNode.isVisible=!1),null===(e=S._primitiveBabylonMeshes)||void 0===e||e.forEach((S=>{S.isVisible=!1}))))}))}dispose(){this._loader=null}}J(TD),c(TD,!0,(S=>new GD(S)));const YD="KHR_node_selectability";kD("event/onSelect",YD,{jh:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",sD:"FlowGraphGetVariableBlock",dataTransformer:S=>["pickedMesh_"+S[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",sD:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(S,v,D,z,e,N,m){var B,g,E,h,A,w;const n=e[e.length-1];n.config=n.config||{},n.config.glTF=m;const R=null===(B=S.configuration)||void 0===B||null===(g=B.nodeIndex)||void 0===g?void 0:g.value[0];if(void 0===R||"number"!==typeof R)throw new Error("nodeIndex not found in configuration");const O="pickedMesh_"+R;return e[1].config.variable=O,N._userVariables[O]={className:"Mesh",id:null===m||void 0===m||null===(E=m.nodes)||void 0===E||null===(h=E[R]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===m||void 0===m||null===(A=m.nodes)||void 0===A||null===(w=A[R]._babylonTransformNode)||void 0===w?void 0:w.uniqueId},e}}),(0,H.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:S=>{const v=S._babylonTransformNode;return!v||void 0===v.Cg||v.Cg},set:(S,v)=>{var D;null===(D=v._primitiveBabylonMeshes)||void 0===D||D.forEach((v=>{v.Cg=S}))},getTarget:S=>S._babylonTransformNode,getPropertyName:[()=>"Cg"],type:"boolean"});class jD{constructor(S){this.name=YD,this._loader=S,this.enabled=S.isExtensionUsed(YD)}async onReady(){var S;null===(S=this._loader.me.nodes)||void 0===S||S.forEach((S=>{var v,D,z;null!==(v=S.extensions)&&void 0!==v&&v.KHR_node_selectability&&!1===(null===(D=S.extensions)||void 0===D?void 0:D.KHR_node_selectability.selectable)&&(null===(z=S._babylonTransformNode)||void 0===z||z.getChildMeshes().forEach((S=>{S.Cg=!1})))}))}dispose(){this._loader=null}}J(YD),c(YD,!0,(S=>new jD(S)));const VD="KHR_node_hoverability",UD="targetMeshPointerOver_";kD("event/onHoverIn",VD,{jh:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",sD:"FlowGraphGetVariableBlock",dataTransformer:S=>[UD+S[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",sD:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(S,v,D,z,e,N,m){var B,g,E,h,A,w;const n=e[e.length-1];n.config=n.config||{},n.config.glTF=m;const R=null===(B=S.configuration)||void 0===B||null===(g=B.nodeIndex)||void 0===g?void 0:g.value[0];if(void 0===R||"number"!==typeof R)throw new Error("nodeIndex not found in configuration");const O=UD+R;return e[1].config.variable=O,N._userVariables[O]={className:"Mesh",id:null===m||void 0===m||null===(E=m.nodes)||void 0===E||null===(h=E[R]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===m||void 0===m||null===(A=m.nodes)||void 0===A||null===(w=A[R]._babylonTransformNode)||void 0===w?void 0:w.uniqueId},e}});const yD="targetMeshPointerOut_";kD("event/onHoverOut",VD,{jh:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",sD:"FlowGraphGetVariableBlock",dataTransformer:S=>[yD+S[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",sD:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(S,v,D,z,e,N,m){var B,g,E,h,A,w;const n=e[e.length-1];n.config=n.config||{},n.config.glTF=m;const R=null===(B=S.configuration)||void 0===B||null===(g=B.nodeIndex)||void 0===g?void 0:g.value[0];if(void 0===R||"number"!==typeof R)throw new Error("nodeIndex not found in configuration");const O=yD+R;return e[1].config.variable=O,N._userVariables[O]={className:"Mesh",id:null===m||void 0===m||null===(E=m.nodes)||void 0===E||null===(h=E[R]._babylonTransformNode)||void 0===h?void 0:h.id,uniqueId:null===m||void 0===m||null===(A=m.nodes)||void 0===A||null===(w=A[R]._babylonTransformNode)||void 0===w?void 0:w.uniqueId},e}}),(0,H.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:S=>{const v=S._babylonTransformNode;return!v||void 0===v.pointerOverDisableMeshTesting||v.pointerOverDisableMeshTesting},set:(S,v)=>{var D;null===(D=v._primitiveBabylonMeshes)||void 0===D||D.forEach((v=>{v.pointerOverDisableMeshTesting=!S}))},getTarget:S=>S._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class fD{constructor(S){this.name=VD,this._loader=S,this.enabled=S.isExtensionUsed(VD)}async onReady(){var S;null===(S=this._loader.me.nodes)||void 0===S||S.forEach((S=>{var v,D,z;null!==(v=S.extensions)&&void 0!==v&&v.KHR_node_hoverability&&!1===(null===(D=S.extensions)||void 0===D?void 0:D.KHR_node_hoverability.hoverable)&&(null===(z=S._babylonTransformNode)||void 0===z||z.getChildMeshes().forEach((S=>{S.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}J(VD),c(VD,!0,(S=>new fD(S)));const CD="ExtrasAsMetadata";class FD{_assignExtras(S,v){if(v.extras&&Object.keys(v.extras).length>0){const D=S.metadata=S.metadata||{};(D.me=D.me||{}).extras=v.extras}}constructor(S){this.name=CD,this.enabled=!0,this._loader=S}dispose(){this._loader=null}loadNodeAsync(S,v,D){return this._loader.loadNodeAsync(S,v,(S=>{this._assignExtras(S,v),D(S)}))}loadCameraAsync(S,v,D){return this._loader.loadCameraAsync(S,v,(S=>{this._assignExtras(S,v),D(S)}))}createMaterial(S,v,D){const z=this._loader.createMaterial(S,v,D);return this._assignExtras(z,v),z}}J(CD),c(CD,!1,(S=>new FD(S)));D(13153)},13042:(S,v,D)=>{"use strict";D.d(v,{b:()=>X,c:()=>p,f:()=>W,j:()=>b});var z=D(11179),e=D(11175),N=D(12677),m=D(11819),B=D(11791),g=D(11802),E=D(11190),h=D(11222),A=D(11811),w=D(11901),n=D(11827),R=D(11422);class O{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Zw=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.En=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(S){this._environmentTexture=S}getNodes(){let S=[];S=S.concat(this.meshes),S=S.concat(this.lights),S=S.concat(this.cameras),S=S.concat(this.transformNodes);for(const v of this.skeletons)S=S.concat(v.bones);return S}}class I extends O{}class K{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const S=this.rootNodes;for(const z of S)z.dispose();S.length=0;const v=this.skeletons;for(const z of v)z.dispose();v.length=0;const D=this.animationGroups;for(const z of D)z.dispose();D.length=0}}class q extends O{constructor(S){super(),this._wasAddedToScene=!1,(S=S||h.c.LastCreatedScene)&&(this.Iv=S,this.proceduralTextures=[],S.Se.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=S.getEngine().onContextRestoredObservable.add((()=>{for(const S of this.geometries)S._rebuild();for(const S of this.meshes)S._rebuild();for(const S of this.Zw)S.rebuild();for(const S of this.textures)S._rebuild()})))}_topologicalSort(S){const v=new Map;for(const m of S)v.set(m.uniqueId,m);const D={dependsOn:new Map,dependedBy:new Map};for(const m of S){const S=m.uniqueId;D.dependsOn.set(S,new Set),D.dependedBy.set(S,new Set)}for(const m of S){const S=m.uniqueId,z=D.dependsOn.get(S);if(m instanceof A.c){const e=m.sourceMesh;v.has(e.uniqueId)&&(z.add(e.uniqueId),D.dependedBy.get(e.uniqueId).add(S))}const e=D.dependedBy.get(S);for(const N of m.getDescendants()){const z=N.uniqueId;if(v.has(z)){e.add(z);D.dependsOn.get(z).add(S)}}}const z=[],e=[];for(const m of S){const S=m.uniqueId;0===D.dependsOn.get(S).size&&(e.push(m),v.delete(S))}const N=e;for(;N.length>0;){const S=N.shift();z.push(S);const e=D.dependedBy.get(S.uniqueId);for(const z of Array.from(e.values())){const e=D.dependsOn.get(z);e.delete(S.uniqueId),0===e.size&&v.get(z)&&(N.push(v.get(z)),v.delete(z))}}return v.size>0&&(E.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),v.forEach((S=>{E.b.Error(S.name)}))),z}_addNodeAndDescendantsToList(S,v,D,z){if(D&&(!z||z(D))&&!v.has(D.uniqueId)){S.push(D),v.add(D.uniqueId);for(const e of D.getDescendants(!0))this._addNodeAndDescendantsToList(S,v,e,z)}}_isNodeInContainer(S){return S instanceof g.e&&-1!==this.meshes.indexOf(S)||(S instanceof B.b&&-1!==this.transformNodes.indexOf(S)||(S instanceof w.b&&-1!==this.lights.indexOf(S)||S instanceof n.b&&-1!==this.cameras.indexOf(S)))}_isValidHierarchy(){for(const S of this.meshes)if(S.parent&&!this._isNodeInContainer(S.parent))return E.b.Warn(`Node ${S.name} has a parent that is not in the container.`),!1;for(const S of this.transformNodes)if(S.parent&&!this._isNodeInContainer(S.parent))return E.b.Warn(`Node ${S.name} has a parent that is not in the container.`),!1;for(const S of this.lights)if(S.parent&&!this._isNodeInContainer(S.parent))return E.b.Warn(`Node ${S.name} has a parent that is not in the container.`),!1;for(const S of this.cameras)if(S.parent&&!this._isNodeInContainer(S.parent))return E.b.Warn(`Node ${S.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(S){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||e.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const z={},N={},B=new K,g=[],E=[],h={doNotInstantiate:!0,...D},A=[],w=new Set;for(const e of this.transformNodes)null===e.parent&&this._addNodeAndDescendantsToList(A,w,e,h.predicate);for(const e of this.meshes)null===e.parent&&this._addNodeAndDescendantsToList(A,w,e,h.predicate);const n=this._topologicalSort(A),R=(D,e)=>{if(((v,D)=>{if(z[v.uniqueId]=D.uniqueId,N[D.uniqueId]=D,S&&(D.name=S(v.name)),D instanceof m.e){const S=D;if(S.morphTargetManager){const D=v.morphTargetManager;S.morphTargetManager=D.clone();for(let v=0;v<D.numTargets;v++){const e=D.getTarget(v),m=S.morphTargetManager.getTarget(v);z[e.uniqueId]=m.uniqueId,N[m.uniqueId]=m}}}})(D,e),D.parent){const S=z[D.parent.uniqueId],v=N[S];e.parent=v||D.parent}if(e.position&&D.position&&e.position.N(D.position),e.rotationQuaternion&&D.rotationQuaternion&&e.rotationQuaternion.N(D.rotationQuaternion),e.rotation&&D.rotation&&e.rotation.N(D.rotation),e.Me&&D.Me&&e.Me.N(D.Me),e.material){const m=e;if(m.material)if(v){const v=D.material;if(-1===E.indexOf(v)){let D=v.clone(S?S(v.name):"Clone of "+v.name);if(E.push(v),z[v.uniqueId]=D.uniqueId,N[D.uniqueId]=D,"MultiMaterial"===v.getClassName()){const e=v;for(const v of e.Ye)v&&(D=v.clone(S?S(v.name):"Clone of "+v.name),E.push(v),z[v.uniqueId]=D.uniqueId,N[D.uniqueId]=D);e.Ye=e.Ye.map((S=>S&&N[z[S.uniqueId]]))}}"InstancedMesh"!==m.getClassName()&&(m.material=N[z[v.uniqueId]])}else"MultiMaterial"===m.material.getClassName()?-1===this.Iv.multiMaterials.indexOf(m.material)&&this.Iv.addMultiMaterial(m.material):-1===this.Iv.materials.indexOf(m.material)&&this.Iv.addMaterial(m.material)}null===e.parent&&B.rootNodes.push(e)};for(const e of n)if("InstancedMesh"===e.getClassName()){const S=e,v=S.sourceMesh,D=z[v.uniqueId];R(S,("number"===typeof D?N[D]:v).createInstance(S.name))}else{let S=!0;"gg"===e.getClassName()||"Node"===e.getClassName()||e.skeleton||!e.getTotalVertices||0===e.getTotalVertices()?S=!1:h.doNotInstantiate&&(S="function"===typeof h.doNotInstantiate?!h.doNotInstantiate(e):!h.doNotInstantiate);const v=S?e.createInstance(`instance of ${e.name}`):e.clone(`Clone of ${e.name}`,null,!0);if(!v)throw new Error(`Could not clone or instantiate node on Asset Container ${e.name}`);R(e,v)}for(const e of this.skeletons){if(h.predicate&&!h.predicate(e))continue;const v=e.clone(S?S(e.name):"Clone of "+e.name);for(const S of this.meshes)if(S.skeleton===e&&!S.isAnInstance){const D=N[z[S.uniqueId]];if(!D||D.isAnInstance)continue;if(D.skeleton=v,-1!==g.indexOf(v))continue;g.push(v);for(const S of v.bones)S._linkedTransformNode&&(S._linkedTransformNode=N[z[S._linkedTransformNode.uniqueId]])}B.skeletons.push(v)}for(const e of this.animationGroups){if(h.predicate&&!h.predicate(e))continue;const v=e.clone(S?S(e.name):"Clone of "+e.name,(S=>N[z[S.uniqueId]]||S));B.animationGroups.push(v)}return B}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||e.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Iv.environmentTexture=this.environmentTexture);for(const S of this.Iv._serializableComponents)S.addFromContainer(this);this.Iv.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const v=[];for(const D of this.cameras)S&&!S(D)||(this.Iv.addCamera(D),v.push(D));for(const D of this.lights)S&&!S(D)||(this.Iv.addLight(D),v.push(D));for(const D of this.meshes)S&&!S(D)||(this.Iv.Kh(D),v.push(D));for(const D of this.skeletons)S&&!S(D)||this.Iv.addSkeleton(D);for(const D of this.animations)S&&!S(D)||this.Iv.addAnimation(D);for(const D of this.animationGroups)S&&!S(D)||this.Iv.addAnimationGroup(D);for(const D of this.multiMaterials)S&&!S(D)||this.Iv.addMultiMaterial(D);for(const D of this.materials)S&&!S(D)||this.Iv.addMaterial(D);for(const D of this.morphTargetManagers)S&&!S(D)||this.Iv.addMorphTargetManager(D);for(const D of this.geometries)S&&!S(D)||this.Iv.addGeometry(D);for(const D of this.transformNodes)S&&!S(D)||(this.Iv.addTransformNode(D),v.push(D));for(const D of this.actionManagers)S&&!S(D)||this.Iv.addActionManager(D);for(const D of this.textures)S&&!S(D)||this.Iv.addTexture(D);for(const D of this.reflectionProbes)S&&!S(D)||this.Iv.addReflectionProbe(D);for(const D of v)D.parent&&-1===this.Iv.getNodes().indexOf(D.parent)&&(D.setParent?D.setParent(null):D.parent=null)}removeAllFromScene(){this._isValidHierarchy()||e.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Iv.environmentTexture&&(this.Iv.environmentTexture=null);for(const S of this.Iv._serializableComponents)S.removeFromContainer(this)}removeFromScene(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const v of this.cameras)S&&!S(v)||this.Iv.removeCamera(v);for(const v of this.lights)S&&!S(v)||this.Iv.removeLight(v);for(const v of this.meshes)S&&!S(v)||this.Iv.Ih(v,!0);for(const v of this.skeletons)S&&!S(v)||this.Iv.removeSkeleton(v);for(const v of this.animations)S&&!S(v)||this.Iv.removeAnimation(v);for(const v of this.animationGroups)S&&!S(v)||this.Iv.removeAnimationGroup(v);for(const v of this.multiMaterials)S&&!S(v)||this.Iv.removeMultiMaterial(v);for(const v of this.materials)S&&!S(v)||this.Iv.removeMaterial(v);for(const v of this.morphTargetManagers)S&&!S(v)||this.Iv.removeMorphTargetManager(v);for(const v of this.geometries)S&&!S(v)||this.Iv.removeGeometry(v);for(const v of this.transformNodes)S&&!S(v)||this.Iv.removeTransformNode(v);for(const v of this.actionManagers)S&&!S(v)||this.Iv.removeActionManager(v);for(const v of this.textures)S&&!S(v)||this.Iv.removeTexture(v);for(const v of this.reflectionProbes)S&&!S(v)||this.Iv.removeReflectionProbe(v)}dispose(){const S=this.cameras.slice(0);for(const n of S)n.dispose();this.cameras.length=0;const v=this.lights.slice(0);for(const n of v)n.dispose();this.lights.length=0;const D=this.meshes.slice(0);for(const n of D)n.dispose();this.meshes.length=0;const z=this.skeletons.slice(0);for(const n of z)n.dispose();this.skeletons.length=0;const e=this.animationGroups.slice(0);for(const n of e)n.dispose();this.animationGroups.length=0;const N=this.multiMaterials.slice(0);for(const n of N)n.dispose();this.multiMaterials.length=0;const m=this.materials.slice(0);for(const n of m)n.dispose();this.materials.length=0;const B=this.geometries.slice(0);for(const n of B)n.dispose();this.geometries.length=0;const g=this.transformNodes.slice(0);for(const n of g)n.dispose();this.transformNodes.length=0;const E=this.actionManagers.slice(0);for(const n of E)n.dispose();this.actionManagers.length=0;const h=this.textures.slice(0);for(const n of h)n.dispose();this.textures.length=0;const A=this.reflectionProbes.slice(0);for(const n of A)n.dispose();this.reflectionProbes.length=0;const w=this.morphTargetManagers.slice(0);for(const n of w)n.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const n of this.Iv._serializableComponents)n.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Iv.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(S,v,D){if(S&&v)for(const z of S){let S=!0;if(D)for(const v of D)if(z===v){S=!1;break}S&&(v.push(z),z._parentContainer=this)}}moveAllFromScene(S){this._wasAddedToScene=!1,void 0===S&&(S=new I);for(const v in this)Object.prototype.hasOwnProperty.call(this,v)&&(this[v]=this[v]||("_environmentTexture"===v?null:[]),this._moveAssets(this.Iv[v],this[v],S[v]));this.environmentTexture=this.Iv.environmentTexture,this.removeAllFromScene()}createRootMesh(){const S=new m.e("assetContainerRootMesh",this.Iv);for(const v of this.meshes)v.parent||S.addChild(v);return this.meshes.unshift(S),S}mergeAnimationsTo(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.c.LastCreatedScene,v=arguments.length>1?arguments[1]:void 0,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!S)return E.b.Error("No scene available to merge animations to"),[];const z=D||(v=>{let D=null;const z=v.animations.length?v.animations[0].targetProperty:"",e=v.name.split(".").join("").split("_primitive")[0];switch(z){case"position":case"rotationQuaternion":D=S.getTransformNodeByName(v.name)||S.getTransformNodeByName(e);break;case"influence":D=S.getMorphTargetByName(v.name)||S.getMorphTargetByName(e);break;default:D=S.getNodeByName(v.name)||S.getNodeByName(e)}return D}),e=this.getNodes();for(const B of e){const S=z(B);if(null!==S){for(const v of B.animations){const D=S.animations.filter((S=>S.targetProperty===v.targetProperty));for(const v of D){const D=S.animations.indexOf(v,0);D>-1&&S.animations.splice(D,1)}}S.animations=S.animations.concat(B.animations)}}const N=[],m=this.animationGroups.slice();for(const B of m){N.push(B.clone(B.name,z));for(const S of B.animatables)S.stop()}for(const B of v){const v=z(B.target);v&&(S.beginAnimation(v,B.fromFrame,B.toFrame,B.loopAnimation,B.speedRatio,B.onAnimationEnd?B.onAnimationEnd:void 0,void 0,!0,void 0,B.onAnimationLoop?B.onAnimationLoop:void 0),S.stopAnimation(B.target))}return N}populateRootNodes(){this.rootNodes.length=0;for(const S of this.meshes)S.parent||-1!==this.rootNodes.indexOf(S)||this.rootNodes.push(S);for(const S of this.transformNodes)S.parent||-1!==this.rootNodes.indexOf(S)||this.rootNodes.push(S);for(const S of this.lights)S.parent||-1!==this.rootNodes.indexOf(S)||this.rootNodes.push(S);for(const S of this.cameras)S.parent||-1!==this.rootNodes.indexOf(S)||this.rootNodes.push(S)}addAllAssetsToContainer(S){if(!S)return;const v=[],D=new Set;for(v.push(S);v.length>0;){const S=v.pop();if(S instanceof m.e?(S.ie&&-1===this.geometries.indexOf(S.ie)&&this.geometries.push(S.ie),this.meshes.push(S)):S instanceof A.c?this.meshes.push(S):S instanceof B.b?this.transformNodes.push(S):S instanceof w.b?this.lights.push(S):S instanceof n.b&&this.cameras.push(S),S instanceof g.e){if(S.material&&-1===this.materials.indexOf(S.material)){this.materials.push(S.material);for(const v of S.material.getActiveTextures())-1===this.textures.indexOf(v)&&this.textures.push(v)}S.skeleton&&-1===this.skeletons.indexOf(S.skeleton)&&this.skeletons.push(S.skeleton),S.morphTargetManager&&-1===this.morphTargetManagers.indexOf(S.morphTargetManager)&&this.morphTargetManagers.push(S.morphTargetManager)}for(const z of S.getChildren())D.has(z)||v.push(z);D.add(S)}this.populateRootNodes()}_getByTags(S,v,D){if(void 0===v)return S;const z=[];for(const e in S){const N=S[e];R.c&&R.c.MatchesQuery(N,v)&&(!D||D(N))&&z.push(N)}return z}getMeshesByTags(S,v){return this._getByTags(this.meshes,S,v)}getCamerasByTags(S,v){return this._getByTags(this.cameras,S,v)}getLightsByTags(S,v){return this._getByTags(this.lights,S,v)}getMaterialsByTags(S,v){return this._getByTags(this.materials,S,v).concat(this._getByTags(this.multiMaterials,S,v))}getTransformNodesByTags(S,v){return this._getByTags(this.transformNodes,S,v)}}var u=D(11244);class s{constructor(S){this.byteOffset=0,this.buffer=S}async loadAsync(S){const v=await this.buffer.readAsync(this.byteOffset,S);this._dataView=new DataView(v.buffer,v.byteOffset,v.byteLength),this._dataByteOffset=0}readUint32(){const S=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,S}readUint8Array(S){const v=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,S);return this._dataByteOffset+=S,this.byteOffset+=S,v}readString(S){return(0,u.l)(this.readUint8Array(S))}skipBytes(S){this._dataByteOffset+=S,this.byteOffset+=S}}var r=D(13044);const d="Z2xURg",x={name:"me",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:S=>-1!==S.indexOf("asset")&&-1!==S.indexOf("version")||S.startsWith("data:base64,"+d)||S.startsWith("data:;base64,"+d)||S.startsWith("data:application/octet-stream;base64,"+d)||S.startsWith("data:model/gltf-binary;base64,"+d)};var W,p,b,k=D(11229),Z=D(11237);function i(S,v,D){try{return Promise.resolve(new Uint8Array(S,v,D))}catch(z){return Promise.reject(z)}}!function(S){S[S.AUTO=0]="AUTO",S[S.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(W||(W={})),function(S){S[S.NONE=0]="NONE",S[S.FIRST=1]="FIRST",S[S.ALL=2]="ALL"}(p||(p={})),function(S){S[S.LOADING=0]="LOADING",S[S.READY=1]="READY",S[S.COMPLETE=2]="COMPLETE"}(b||(b={}));class t{constructor(){this.coordinateSystemMode=W.AUTO,this.animationStartMode=p.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=S=>Promise.resolve(S),this.extensionOptions={}}N(S){S&&(this.onParsed=S.onParsed,this.coordinateSystemMode=S.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=S.animationStartMode??this.animationStartMode,this.loadNodeAnimations=S.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=S.loadSkins??this.loadSkins,this.loadMorphTargets=S.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=S.compileMaterials??this.compileMaterials,this.useClipPlane=S.useClipPlane??this.useClipPlane,this.compileShadowGenerators=S.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=S.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=S.useRangeRequests??this.useRangeRequests,this.createInstances=S.createInstances??this.createInstances,this.alwaysComputeBoundingBox=S.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=S.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=S.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=S.skipMaterials??this.skipMaterials,this.useSRGBBuffers=S.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=S.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=S.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=S.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=S.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=S.customRootNode,this.onMeshLoaded=S.onMeshLoaded,this.onSkinLoaded=S.onSkinLoaded,this.onTextureLoaded=S.onTextureLoaded,this.onMaterialLoaded=S.onMaterialLoaded,this.onCameraLoaded=S.onCameraLoaded,this.extensionOptions=S.extensionOptions??this.extensionOptions)}}class X extends t{constructor(S){super(),this.onParsedObservable=new z.d,this.onMeshLoadedObservable=new z.d,this.onSkinLoadedObservable=new z.d,this.onTextureLoadedObservable=new z.d,this.onMaterialLoadedObservable=new z.d,this.onCameraLoadedObservable=new z.d,this.onCompleteObservable=new z.d,this.onErrorObservable=new z.d,this.Se=new z.d,this.onExtensionLoadedObservable=new z.d,this.validate=!1,this.onValidatedObservable=new z.d,this._loader=null,this._state=null,this._requests=new Array,this.name=x.name,this.extensions=x.extensions,this.onLoaderStateChangedObservable=new z.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.N(S)}set onParsed(S){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),S&&(this._onParsedObserver=this.onParsedObservable.add(S))}set onMeshLoaded(S){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),S&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(S))}set onSkinLoaded(S){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),S&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((v=>S(v.node,v.skinnedNode))))}set onTextureLoaded(S){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),S&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(S))}set onMaterialLoaded(S){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),S&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(S))}set onCameraLoaded(S){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),S&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(S))}set onComplete(S){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(S)}set onError(S){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(S)}set onDispose(S){this._onDisposeObserver&&this.Se.remove(this._onDisposeObserver),this._onDisposeObserver=this.Se.add(S)}set onExtensionLoaded(S){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(S)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(S){this._loggingEnabled!==S&&(this._loggingEnabled=S,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(S){this._capturePerformanceCounters!==S&&(this._capturePerformanceCounters=S,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(S){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(S)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const S of this._requests)S.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=S=>Promise.resolve(S),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Se.notifyObservers(void 0),this.Se.clear()}loadFile(S,v,D,N,m,B,g,h){if(ArrayBuffer.isView(v))return this._loadBinary(S,v,D,N,g,h),null;this._progressCallback=m;const A=v.name||e.Tools.GetFilename(v);if(B){if(this.useRangeRequests){this.validate&&E.b.Warn("glTF validation is not supported when range requests are enabled");const D={abort:()=>{},onCompleteObservable:new z.d},e={readAsync:(D,z)=>new Promise(((e,N)=>{this._loadFile(S,v,(S=>{e(new Uint8Array(S))}),!0,(S=>{N(S)}),(S=>{S.setRequestHeader("Range",`bytes=${D}-${D+z-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new s(e)).then((S=>{D.onCompleteObservable.notifyObservers(D),N(S)}),g?S=>g(void 0,S):void 0),D}return this._loadFile(S,v,(v=>{this._validate(S,new Uint8Array(v,0,v.byteLength),D,A),this._unpackBinaryAsync(new s({readAsync:(S,D)=>i(v,S,D),byteLength:v.byteLength})).then((S=>{N(S)}),g?S=>g(void 0,S):void 0)}),!0,g)}return this._loadFile(S,v,(v=>{try{this._validate(S,v,D,A),N({json:this._parseJson(v)})}catch{g&&g()}}),!1,g)}_loadBinary(S,v,D,z,e,N){this._validate(S,new Uint8Array(v.buffer,v.byteOffset,v.byteLength),D,N),this._unpackBinaryAsync(new s({readAsync:(S,D)=>function(S,v,D){try{if(v<0||v>=S.byteLength)throw new RangeError("Offset is out of range.");if(v+D>S.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(S.buffer,S.byteOffset+v,D))}catch(z){return Promise.reject(z)}}(v,S,D),byteLength:v.byteLength})).then((S=>{z(S)}),e?S=>e(void 0,S):void 0)}importMeshAsync(S,v,D,z,e,N){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(D),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(D),this._loader.importMeshAsync(S,v,null,D,z,e,N))))}loadAsync(S,v,D,z,e){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${e||""}`),this._loader=this._getLoader(v),this._loader.loadAsync(S,v,D,z,e))))}loadAssetContainerAsync(S,v,D,z,e){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${e||""}`),this._loader=this._getLoader(v);const N=new q(S),m=[];this.onMaterialLoadedObservable.add((S=>{m.push(S)}));const B=[];this.onTextureLoadedObservable.add((S=>{B.push(S)}));const g=[];this.onCameraLoadedObservable.add((S=>{g.push(S)}));const E=[];return this.onMeshLoadedObservable.add((S=>{S.morphTargetManager&&E.push(S.morphTargetManager)})),this._loader.importMeshAsync(null,S,N,v,D,z,e).then((S=>(Array.prototype.push.apply(N.geometries,S.geometries),Array.prototype.push.apply(N.meshes,S.meshes),Array.prototype.push.apply(N.Zw,S.Zw),Array.prototype.push.apply(N.skeletons,S.skeletons),Array.prototype.push.apply(N.animationGroups,S.animationGroups),Array.prototype.push.apply(N.materials,m),Array.prototype.push.apply(N.textures,B),Array.prototype.push.apply(N.lights,S.lights),Array.prototype.push.apply(N.transformNodes,S.transformNodes),Array.prototype.push.apply(N.cameras,g),Array.prototype.push.apply(N.morphTargetManagers,E),N)))}))}canDirectLoad(S){return x.canDirectLoad(S)}directLoad(S,v){if(v.startsWith("base64,"+d)||v.startsWith(";base64,"+d)||v.startsWith("application/octet-stream;base64,"+d)||v.startsWith("model/gltf-binary;base64,"+d)){const D=(0,k.c)(v);return this._validate(S,new Uint8Array(D,0,D.byteLength)),this._unpackBinaryAsync(new s({readAsync:(S,v)=>i(D,S,v),byteLength:D.byteLength}))}return this._validate(S,v),Promise.resolve({json:this._parseJson(v)})}createPlugin(S){return new X(S[x.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((S,v)=>{this.onCompleteObservable.addOnce((()=>{S()})),this.onErrorObservable.addOnce((S=>{v(S)}))}))}_setState(S){this._state!==S&&(this._state=S,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(b[this._state]))}_loadFile(S,v,D,z,e,N){const m=S._loadFile(v,D,(S=>{this._onProgress(S,m)}),!0,z,e,N);return m.onCompleteObservable.add((()=>{m._lengthComputable=!0,m._total=m._loaded})),this._requests.push(m),m}_onProgress(S,v){if(!this._progressCallback)return;v._lengthComputable=S.lengthComputable,v._loaded=S.loaded,v._total=S.total;let D=!0,z=0,e=0;for(const N of this._requests){if(void 0===N._lengthComputable||void 0===N._loaded||void 0===N._total)return;D=D&&N._lengthComputable,z+=N._loaded,e+=N._total}this._progressCallback({lengthComputable:D,loaded:z,total:D?e:0})}_validate(S,v){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),r.d.ValidateAsync(v,D,z,(v=>this.preprocessUrlAsync(D+v).then((v=>S._loadFileAsync(v,void 0,!0,!0).then((S=>new Uint8Array(S,0,S.byteLength))))))).then((S=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(S),this.onValidatedObservable.clear()}),(S=>{this._endPerformanceCounter("Validate JSON"),e.Tools.Warn(`Failed to validate: ${S.message}`),this.onValidatedObservable.clear()})))}_getLoader(S){const v=S.json.asset||{};this._log(`Asset version: ${v.version}`),v.minVersion&&this._log(`Asset minimum version: ${v.minVersion}`),v.generator&&this._log(`Asset generator: ${v.generator}`);const D=X._parseVersion(v.version);if(!D)throw new Error("Invalid version: "+v.version);if(void 0!==v.minVersion){const S=X._parseVersion(v.minVersion);if(!S)throw new Error("Invalid minimum version: "+v.minVersion);if(X._compareVersion(S,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+v.minVersion)}const z={1:X._CreateGLTF1Loader,2:X._CreateGLTF2Loader}[D.major];if(!z)throw new Error("Unsupported version: "+v.version);return z(this)}_parseJson(S){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${S.length}`);const v=JSON.parse(S);return this._endPerformanceCounter("Parse JSON"),v}_unpackBinaryAsync(S){return this._startPerformanceCounter("Unpack Binary"),S.loadAsync(20).then((()=>{const v=S.readUint32();if(1179937895!==v)throw new Z.g("Unexpected magic: "+v,Z.f.GLTFLoaderUnexpectedMagicError);const D=S.readUint32();this.loggingEnabled&&this._log(`Binary version: ${D}`);const z=S.readUint32();let e;switch(this.useRangeRequests||z===S.buffer.byteLength||E.b.Warn(`Length in header does not match actual data length: ${z} != ${S.buffer.byteLength}`),D){case 1:e=this._unpackBinaryV1Async(S,z);break;case 2:e=this._unpackBinaryV2Async(S,z);break;default:throw new Error("Unsupported version: "+D)}return this._endPerformanceCounter("Unpack Binary"),e}))}_unpackBinaryV1Async(S,v){const D=S.readUint32(),z=S.readUint32();if(0!==z)throw new Error(`Unexpected content format: ${z}`);const e=v-S.byteOffset,N={json:this._parseJson(S.readString(D)),bin:null};if(0!==e){const v=S.byteOffset;N.bin={readAsync:(D,z)=>S.buffer.readAsync(v+D,z),byteLength:e}}return Promise.resolve(N)}_unpackBinaryV2Async(S,v){const D=1313821514,z=5130562,e=S.readUint32();if(S.readUint32()!==D)throw new Error("First chunk format is not JSON");return S.byteOffset+e===v?S.loadAsync(e).then((()=>({json:this._parseJson(S.readString(e)),bin:null}))):S.loadAsync(e+8).then((()=>{const N={json:this._parseJson(S.readString(e)),bin:null},m=()=>{const e=S.readUint32();switch(S.readUint32()){case D:throw new Error("Unexpected JSON chunk");case z:{const v=S.byteOffset;N.bin={readAsync:(D,z)=>S.buffer.readAsync(v+D,z),byteLength:e},S.skipBytes(e);break}default:S.skipBytes(e)}return S.byteOffset!==v?S.loadAsync(8).then(m):Promise.resolve(N)};return m()}))}static _parseVersion(S){if("1.0"===S||"1.0.1"===S)return{major:1,minor:0};const v=(S+"").match(/^(\d+)\.(\d+)/);return v?{major:parseInt(v[1]),minor:parseInt(v[2])}:null}static _compareVersion(S,v){return S.major>v.major?1:S.major<v.major?-1:S.minor>v.minor?1:S.minor<v.minor?-1:0}_logOpen(S){this._log(S),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(S){const v=X._logSpaces.substring(0,2*this._logIndentLevel);E.b.Log(`${v}${S}`)}_logDisabled(S){}_startPerformanceCounterEnabled(S){e.Tools.StartPerformanceCounter(S)}_startPerformanceCounterDisabled(S){}_endPerformanceCounterEnabled(S){e.Tools.EndPerformanceCounter(S)}_endPerformanceCounterDisabled(S){}}X.IncrementalLoading=!0,X.HomogeneousCoordinates=!1,X._logSpaces="                                ",(0,N.d)(new X)},13044:(S,v,D)=>{"use strict";D.d(v,{d:()=>m});var z=D(11175);function e(S,v,D,z){const e={externalResourceFunction:z};return D&&(e.uri="file:"===v?D:v+D),ArrayBuffer.isView(S)?GLTFValidator.validateBytes(S,e):GLTFValidator.validateString(S,e)}function N(){const S=[];onmessage=v=>{const D=v.data;switch(D.id){case"init":importScripts(D.url);break;case"validate":e(D.data,D.rootUrl,D.fileName,(v=>new Promise(((D,z)=>{const e=S.length;S.push({resolve:D,reject:z}),postMessage({id:"getExternalResource",index:e,uri:v})})))).then((S=>{postMessage({id:"validate.resolve",value:S})}),(S=>{postMessage({id:"validate.reject",reason:S})}));break;case"getExternalResource.resolve":S[D.index].resolve(D.value);break;case"getExternalResource.reject":S[D.index].reject(D.reason)}}}class m{static ValidateAsync(S,v,D,m){return"function"===typeof Worker?new Promise(((B,g)=>{const E=`${e}(${N})()`,h=URL.createObjectURL(new Blob([E],{type:"application/javascript"})),A=new Worker(h),w=S=>{A.removeEventListener("error",w),A.removeEventListener("message",n),g(S)},n=S=>{const v=S.data;switch(v.id){case"getExternalResource":m(v.uri).then((S=>{A.postMessage({id:"getExternalResource.resolve",index:v.index,value:S},[S.buffer])}),(S=>{A.postMessage({id:"getExternalResource.reject",index:v.index,reason:S})}));break;case"validate.resolve":A.removeEventListener("error",w),A.removeEventListener("message",n),B(v.value),A.terminate();break;case"validate.reject":A.removeEventListener("error",w),A.removeEventListener("message",n),g(v.reason),A.terminate()}};if(A.addEventListener("error",w),A.addEventListener("message",n),A.postMessage({id:"init",url:z.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(S)){const z=S.slice();A.postMessage({id:"validate",data:z,rootUrl:v,fileName:D},[z.buffer])}else A.postMessage({id:"validate",data:S,rootUrl:v,fileName:D})})):(this._LoadScriptPromise||(this._LoadScriptPromise=z.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>e(S,v,D,m))))}}m.Configuration={url:`${z.Tools._DefaultCdnUrl}/gltf_validator.js`}},13573:(S,v,D)=>{"use strict";D.d(v,{d:()=>x});var z=D(11358),e=D(11364),N=D(11415),m=D(11371),B=D(11757),g=D(11692),E=D(11452),h=D(11619),A=D(11329),w=D(11280);D(12809),D(12713),D(12732),D(12721),D(12741),D(12749),D(12751);const n="imageProcessingCompatibility",R="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";w.b.IncludesShadersStore[n]||(w.b.IncludesShadersStore[n]=R);const O="skyPixelShader",I="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";w.b.ShadersStore[O]||(w.b.ShadersStore[O]=I);D(12818),D(12757),D(12765),D(12775),D(12769);const K="skyVertexShader",q="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";w.b.ShadersStore[K]||(w.b.ShadersStore[K]=q);var u=D(11687),s=D(11738),r=D(11736);class d extends B.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class x extends g.c{constructor(S,v){super(S,v),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new m.Rv(0,100,0),this.useSunPosition=!1,this.cameraOffset=m.Rv.Zero(),this.up=m.Rv.Up(),this.dithering=!1,this._cameraPosition=m.Rv.Zero(),this._skyOrientation=new m.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(S,v){const D=v._drawWrapper;if(this.isFrozen&&D.effect&&D._wasPreviouslyReady)return!0;v.materialDefines||(v.materialDefines=new d);const z=v.materialDefines,e=this.xS();if(this._isReadyForSubMesh(v))return!0;if((0,r.S)(S,e,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,z),(0,r.J)(S,z,!0,!1),z.IMAGEPROCESSINGPOSTPROCESS!==e.imageProcessingConfiguration.applyByPostProcess&&z.markAsMiscDirty(),z.DITHER!==this.dithering&&z.markAsMiscDirty(),z.isDirty){z.markAsProcessed(),e.resetCachedMaterial();const S=new u.d;z.FOG&&S.addFallback(1,"FOG"),z.IMAGEPROCESSINGPOSTPROCESS=e.imageProcessingConfiguration.applyByPostProcess,z.DITHER=this.dithering;const D=[E.d.PositionKind];z.VERTEXCOLOR&&D.push(E.d.ColorKind);const N="sky",m=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,s.d)(m);const B=z.toString();v.setEffect(e.getEngine().createEffect(N,D,m,[],B,S,this.onCompiled,this.onError),z,this._materialContext)}return!(!v.effect||!v.effect.isReady())&&(z._renderId=e.getRenderId(),D._wasPreviouslyReady=!0,!0)}bindForSubMesh(S,v,D){const z=this.xS(),e=D.materialDefines;if(!e)return;const N=D.effect;if(!N)return;this._activeEffect=N,this.bindOnlyWorldMatrix(S),this._activeEffect.setMatrix("viewProjection",z.getTransformMatrix()),this._mustRebind(z,N,D)&&((0,s.e)(N,this,z),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,r.m)(e,N,z)),z.fogEnabled&&v.applyFog&&z.fogMode!==h.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",z.getViewMatrix()),(0,r.h)(z,v,this._activeEffect);const B=z.activeCamera;if(B){const S=B.getWorldMatrix();this._cameraPosition.x=S.m[12],this._cameraPosition.y=S.m[13],this._cameraPosition.z=S.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const S=Math.PI*(this.inclination-.5),v=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(v)*Math.cos(S),this.sunPosition.y=this.distance*Math.sin(-S),this.sunPosition.z=this.distance*Math.sin(v)*Math.cos(S),m.Quaternion.FromUnitVectorsToRef(m.Rv.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(v,this._activeEffect,D)}getAnimatables(){return[]}dispose(S){super.dispose(S)}clone(S){return N.b.Clone((()=>new x(S,this.xS())),this)}serialize(){const S=super.serialize();return S.customType="BABYLON.SkyMaterial",S}getClassName(){return"SkyMaterial"}static Parse(S,v,D){return N.b.Parse((()=>new x(S.name,v)),S,v,D)}}(0,z.b)([(0,e.L)()],x.prototype,"luminance",void 0),(0,z.b)([(0,e.L)()],x.prototype,"turbidity",void 0),(0,z.b)([(0,e.L)()],x.prototype,"rayleigh",void 0),(0,z.b)([(0,e.L)()],x.prototype,"mieCoefficient",void 0),(0,z.b)([(0,e.L)()],x.prototype,"mieDirectionalG",void 0),(0,z.b)([(0,e.L)()],x.prototype,"distance",void 0),(0,z.b)([(0,e.L)()],x.prototype,"inclination",void 0),(0,z.b)([(0,e.L)()],x.prototype,"azimuth",void 0),(0,z.b)([(0,e.H)()],x.prototype,"sunPosition",void 0),(0,z.b)([(0,e.L)()],x.prototype,"useSunPosition",void 0),(0,z.b)([(0,e.H)()],x.prototype,"cameraOffset",void 0),(0,z.b)([(0,e.H)()],x.prototype,"up",void 0),(0,z.b)([(0,e.L)()],x.prototype,"dithering",void 0),(0,A.f)("BABYLON.SkyMaterial",x)},12062:(S,v,D)=>{"use strict";function z(S,v){v.headers=S.headers||{},v.statusMessage=S.statusText,v.statusCode=S.status,v.data=S.response}function e(S,v,D){return new Promise((function(e,N){D=D||{};var m,B,g,E=new XMLHttpRequest,h=D.body,A=D.headers||{};for(m in D.timeout&&(E.timeout=D.timeout),E.ontimeout=E.onerror=function(S){S.timeout="timeout"==S.type,N(S)},E.open(S,v.href||v),E.onload=function(){for(g=E.getAllResponseHeaders().trim().split(/[\r\n]+/),z(E,E);B=g.shift();)B=B.split(": "),E.headers[B.shift().toLowerCase()]=B.join(": ");if((B=E.headers["content-type"])&&~B.indexOf("application/json"))try{E.data=JSON.parse(E.data,D.reviver)}catch(S){return z(E,S),N(S)}(E.status>=400?N:e)(E)},typeof FormData<"u"&&h instanceof FormData||h&&"object"==typeof h&&(A["content-type"]="application/json",h=JSON.stringify(h)),E.withCredentials=!!D.withCredentials,A)E.setRequestHeader(m,A[m]);E.send(h)}))}D.r(v),D.d(v,{del:()=>g,get:()=>N,patch:()=>B,post:()=>m,put:()=>E,send:()=>e});var N=e.bind(e,"GET"),m=e.bind(e,"POST"),B=e.bind(e,"PATCH"),g=e.bind(e,"DELETE"),E=e.bind(e,"PUT")},13693:(S,v,D)=>{"use strict";D.d(v,{b:()=>A});const z=.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,N=1/3,m=1/6,B=(Math.sqrt(5)-1)/4,g=(5-Math.sqrt(5))/20,E=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),h=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const A=class{constructor(){let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const v="function"==typeof S?S:function(S){let v=0,D=0,z=0,e=1;const N=function(){let S=4022871197;return function(v){v=v.toString();for(let D=0;D<v.length;D++){S+=v.charCodeAt(D);let z=.02519603282416938*S;S=z>>>0,z-=S,z*=S,S=z>>>0,z-=S,S+=4294967296*z}return 2.3283064365386963e-10*(S>>>0)}}();v=N(" "),D=N(" "),z=N(" "),v-=N(S),v<0&&(v+=1);D-=N(S),D<0&&(D+=1);z-=N(S),z<0&&(z+=1);return function(){const S=2091639*v+2.3283064365386963e-10*e;return v=D,D=z,z=S-(e=0|S)}}(S);this.p=function(S){const v=new Uint8Array(256);for(let D=0;D<256;D++)v[D]=D;for(let D=0;D<255;D++){const z=D+~~(S()*(256-D)),e=v[D];v[D]=v[z],v[z]=e}return v}(v),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let D=0;D<512;D++)this.perm[D]=this.p[255&D],this.permMod12[D]=this.perm[D]%12}noise2D(S,v){const D=this.permMod12,N=this.perm;let m=0,B=0,g=0;const h=(S+v)*z,A=Math.floor(S+h),w=Math.floor(v+h),n=(A+w)*e,R=S-(A-n),O=v-(w-n);let I,K;R>O?(I=1,K=0):(I=0,K=1);const q=R-I+e,u=O-K+e,s=R-1+2*e,r=O-1+2*e,d=255&A,x=255&w;let W=.5-R*R-O*O;if(W>=0){const S=3*D[d+N[x]];W*=W,m=W*W*(E[S]*R+E[S+1]*O)}let p=.5-q*q-u*u;if(p>=0){const S=3*D[d+I+N[x+K]];p*=p,B=p*p*(E[S]*q+E[S+1]*u)}let b=.5-s*s-r*r;if(b>=0){const S=3*D[d+1+N[x+1]];b*=b,g=b*b*(E[S]*s+E[S+1]*r)}return 70*(m+B+g)}noise3D(S,v,D){const z=this.permMod12,e=this.perm;let B,g,h,A;const w=(S+v+D)*N,n=Math.floor(S+w),R=Math.floor(v+w),O=Math.floor(D+w),I=(n+R+O)*m,K=S-(n-I),q=v-(R-I),u=D-(O-I);let s,r,d,x,W,p;K>=q?q>=u?(s=1,r=0,d=0,x=1,W=1,p=0):K>=u?(s=1,r=0,d=0,x=1,W=0,p=1):(s=0,r=0,d=1,x=1,W=0,p=1):q<u?(s=0,r=0,d=1,x=0,W=1,p=1):K<u?(s=0,r=1,d=0,x=0,W=1,p=1):(s=0,r=1,d=0,x=1,W=1,p=0);const b=K-s+m,k=q-r+m,Z=u-d+m,i=K-x+2*m,t=q-W+2*m,X=u-p+2*m,a=K-1+.5,o=q-1+.5,M=u-1+.5,c=255&n,J=255&R,H=255&O;let T=.6-K*K-q*q-u*u;if(T<0)B=0;else{const S=3*z[c+e[J+e[H]]];T*=T,B=T*T*(E[S]*K+E[S+1]*q+E[S+2]*u)}let G=.6-b*b-k*k-Z*Z;if(G<0)g=0;else{const S=3*z[c+s+e[J+r+e[H+d]]];G*=G,g=G*G*(E[S]*b+E[S+1]*k+E[S+2]*Z)}let Y=.6-i*i-t*t-X*X;if(Y<0)h=0;else{const S=3*z[c+x+e[J+W+e[H+p]]];Y*=Y,h=Y*Y*(E[S]*i+E[S+1]*t+E[S+2]*X)}let j=.6-a*a-o*o-M*M;if(j<0)A=0;else{const S=3*z[c+1+e[J+1+e[H+1]]];j*=j,A=j*j*(E[S]*a+E[S+1]*o+E[S+2]*M)}return 32*(B+g+h+A)}noise4D(S,v,D,z){const e=this.perm;let N,m,E,A,w;const n=(S+v+D+z)*B,R=Math.floor(S+n),O=Math.floor(v+n),I=Math.floor(D+n),K=Math.floor(z+n),q=(R+O+I+K)*g,u=S-(R-q),s=v-(O-q),r=D-(I-q),d=z-(K-q);let x=0,W=0,p=0,b=0;u>s?x++:W++,u>r?x++:p++,u>d?x++:b++,s>r?W++:p++,s>d?W++:b++,r>d?p++:b++;const k=x>=3?1:0,Z=W>=3?1:0,i=p>=3?1:0,t=b>=3?1:0,X=x>=2?1:0,a=W>=2?1:0,o=p>=2?1:0,M=b>=2?1:0,c=x>=1?1:0,J=W>=1?1:0,H=p>=1?1:0,T=b>=1?1:0,G=u-k+g,Y=s-Z+g,j=r-i+g,V=d-t+g,U=u-X+2*g,y=s-a+2*g,f=r-o+2*g,C=d-M+2*g,F=u-c+3*g,l=s-J+3*g,P=r-H+3*g,Q=d-T+3*g,L=u-1+4*g,SS=s-1+4*g,vS=r-1+4*g,DS=d-1+4*g,zS=255&R,eS=255&O,NS=255&I,mS=255&K;let BS=.6-u*u-s*s-r*r-d*d;if(BS<0)N=0;else{const S=e[zS+e[eS+e[NS+e[mS]]]]%32*4;BS*=BS,N=BS*BS*(h[S]*u+h[S+1]*s+h[S+2]*r+h[S+3]*d)}let gS=.6-G*G-Y*Y-j*j-V*V;if(gS<0)m=0;else{const S=e[zS+k+e[eS+Z+e[NS+i+e[mS+t]]]]%32*4;gS*=gS,m=gS*gS*(h[S]*G+h[S+1]*Y+h[S+2]*j+h[S+3]*V)}let ES=.6-U*U-y*y-f*f-C*C;if(ES<0)E=0;else{const S=e[zS+X+e[eS+a+e[NS+o+e[mS+M]]]]%32*4;ES*=ES,E=ES*ES*(h[S]*U+h[S+1]*y+h[S+2]*f+h[S+3]*C)}let hS=.6-F*F-l*l-P*P-Q*Q;if(hS<0)A=0;else{const S=e[zS+c+e[eS+J+e[NS+H+e[mS+T]]]]%32*4;hS*=hS,A=hS*hS*(h[S]*F+h[S+1]*l+h[S+2]*P+h[S+3]*Q)}let AS=.6-L*L-SS*SS-vS*vS-DS*DS;if(AS<0)w=0;else{const S=e[zS+1+e[eS+1+e[NS+1+e[mS+1]]]]%32*4;AS*=AS,w=AS*AS*(h[S]*L+h[S+1]*SS+h[S+2]*vS+h[S+3]*DS)}return 27*(N+m+E+A+w)}}}}]);