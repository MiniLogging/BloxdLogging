/*! For license information please see j24x8k.32.8c497d3d.chunk.js.LICENSE.txt */
(self["9jl1vn4ei5r"]=self["9jl1vn4ei5r"]||[]).push([[32],{13742:(M,p,b)=>{"use strict";var Q=b(13746),q=b(13753),B=b(13755);b.g.__TYPEDARRAY_POOL||(b.g.__TYPEDARRAY_POOL={UINT8:q([32,0]),UINT16:q([32,0]),UINT32:q([32,0]),INT8:q([32,0]),INT16:q([32,0]),INT32:q([32,0]),FLOAT:q([32,0]),DOUBLE:q([32,0]),DATA:q([32,0]),UINT8C:q([32,0]),BUFFER:q([32,0])});var k="undefined"!==typeof Uint8ClampedArray,u=b.g.__TYPEDARRAY_POOL;u.UINT8C||(u.UINT8C=q([32,0])),u.BUFFER||(u.BUFFER=q([32,0]));var T=u.DATA,O=u.BUFFER;function H(M){if(M){var p=M.length||M.byteLength,b=Q.log2(p);T[b].push(M)}}function F(M){M=Q.nextPow2(M);var p=Q.log2(M),b=T[p];return b.length>0?b.pop():new ArrayBuffer(M)}function o(M){return new Uint8Array(F(M),0,M)}function W(M){return new Uint16Array(F(2*M),0,M)}function i(M){return new Uint32Array(F(4*M),0,M)}function A(M){return new Int8Array(F(M),0,M)}function j(M){return new Int16Array(F(2*M),0,M)}function K(M){return new Int32Array(F(4*M),0,M)}function D(M){return new Float32Array(F(4*M),0,M)}function a(M){return new Float64Array(F(8*M),0,M)}function s(M){return k?new Uint8ClampedArray(F(M),0,M):o(M)}function S(M){return new DataView(F(M),0,M)}p.free=function(M){if(B(M))O[Q.log2(M.length)].push(M);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(M)&&(M=M.buffer),!M)return;var p=M.length||M.byteLength,b=0|Q.log2(p);T[b].push(M)}},p.freeUint8=p.freeUint16=p.freeUint32=p.freeInt8=p.freeInt16=p.freeInt32=p.freeFloat32=p.freeFloat=p.freeFloat64=p.freeDouble=p.freeUint8Clamped=p.freeDataView=function(M){H(M.buffer)},p.freeArrayBuffer=H,p.freeBuffer=function(M){O[Q.log2(M.length)].push(M)},p.malloc=function(M,p){if(void 0===p||"arraybuffer"===p)return F(M);switch(p){case"uint8":return o(M);case"uint16":return W(M);case"uint32":return i(M);case"int8":return A(M);case"int16":return j(M);case"int32":return K(M);case"float":case"float32":return D(M);case"double":case"float64":return a(M);case"uint8_clamped":return s(M);case"buffer":throw"Buffer not supported";case"data":case"dataview":return S(M);default:return null}return null},p.mallocArrayBuffer=F,p.mallocUint8=o,p.mallocUint16=W,p.mallocUint32=i,p.mallocInt8=A,p.mallocInt16=j,p.mallocInt32=K,p.mallocFloat32=p.mallocFloat=D,p.mallocFloat64=p.mallocDouble=a,p.mallocUint8Clamped=s,p.mallocDataView=S,p.clearCache=function(){for(var M=0;M<32;++M)u.UINT8[M].length=0,u.UINT16[M].length=0,u.UINT32[M].length=0,u.INT8[M].length=0,u.INT16[M].length=0,u.INT32[M].length=0,u.FLOAT[M].length=0,u.DOUBLE[M].length=0,u.UINT8C[M].length=0,T[M].length=0,O[M].length=0}},13819:(M,p,b)=>{M.exports=q;var Q=b(12588);function q(M,p){if(!(this instanceof q))return new q(M,p);var b=Q.create();Q.add(b,M,p),this.base=Q.min(Q.create(),M,b),this.kH=Q.clone(p),this.max=Q.max(Q.create(),M,b),this.mag=Q.length(this.kH)}var B=q.prototype;B.width=function(){return this.kH[0]},B.height=function(){return this.kH[1]},B.depth=function(){return this.kH[2]},B.x0=function(){return this.base[0]},B.y0=function(){return this.base[1]},B.z0=function(){return this.base[2]},B.x1=function(){return this.max[0]},B.y1=function(){return this.max[1]},B.z1=function(){return this.max[2]},B.translate=function(M){return Q.add(this.max,this.max,M),Q.add(this.base,this.base,M),this},B.setPosition=function(M){return Q.add(this.max,M,this.kH),Q.j(this.base,M),this},B.expand=function(M){var p=Q.create(),b=Q.create();return Q.max(p,M.max,this.max),Q.min(b,M.base,this.base),Q.jp(p,p,b),new q(b,p)},B.intersects=function(M){return!(M.base[0]>this.max[0])&&(!(M.base[1]>this.max[1])&&(!(M.base[2]>this.max[2])&&(!(M.max[0]<this.base[0])&&(!(M.max[1]<this.base[1])&&!(M.max[2]<this.base[2])))))},B.touches=function(M){var p=this.union(M);return null!==p&&(0==p.width()||0==p.height()||0==p.depth())},B.union=function(M){if(!this.intersects(M))return null;var p=Math.max(M.base[0],this.base[0]),b=Math.max(M.base[1],this.base[1]),Q=Math.max(M.base[2],this.base[2]);return new q([p,b,Q],[Math.min(M.max[0],this.max[0])-p,Math.min(M.max[1],this.max[1])-b,Math.min(M.max[2],this.max[2])-Q])}},13746:(M,p)=>{"use strict";function b(M){var p=32;return(M&=-M)&&p--,65535&M&&(p-=16),16711935&M&&(p-=8),252645135&M&&(p-=4),858993459&M&&(p-=2),1431655765&M&&(p-=1),p}p.INT_BITS=32,p.INT_MAX=2147483647,p.INT_MIN=-1<<31,p.sign=function(M){return(M>0)-(M<0)},p.abs=function(M){var p=M>>31;return(M^p)-p},p.min=function(M,p){return p^(M^p)&-(M<p)},p.max=function(M,p){return M^(M^p)&-(M<p)},p.isPow2=function(M){return!(M&M-1)&&!!M},p.log2=function(M){var p,b;return p=(M>65535)<<4,p|=b=((M>>>=p)>255)<<3,p|=b=((M>>>=b)>15)<<2,(p|=b=((M>>>=b)>3)<<1)|(M>>>=b)>>1},p.log10=function(M){return M>=1e9?9:M>=1e8?8:M>=1e7?7:M>=1e6?6:M>=1e5?5:M>=1e4?4:M>=1e3?3:M>=100?2:M>=10?1:0},p.popCount=function(M){return 16843009*((M=(858993459&(M-=M>>>1&1431655765))+(M>>>2&858993459))+(M>>>4)&252645135)>>>24},p.countTrailingZeros=b,p.nextPow2=function(M){return M+=0===M,--M,M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)+1},p.prevPow2=function(M){return M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)-(M>>>1)},p.parity=function(M){return M^=M>>>16,M^=M>>>8,M^=M>>>4,27030>>>(M&=15)&1};var Q=new Array(256);!function(M){for(var p=0;p<256;++p){var b=p,Q=p,q=7;for(b>>>=1;b;b>>>=1)Q<<=1,Q|=1&b,--q;M[p]=Q<<q&255}}(Q),p.reverse=function(M){return Q[255&M]<<24|Q[M>>>8&255]<<16|Q[M>>>16&255]<<8|Q[M>>>24&255]},p.interleave2=function(M,p){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))<<1},p.deinterleave2=function(M,p){return(M=65535&((M=16711935&((M=252645135&((M=858993459&((M=M>>>p&1431655765)|M>>>1))|M>>>2))|M>>>4))|M>>>16))<<16>>16},p.interleave3=function(M,p,b){return M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2),(M|=(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},p.deinterleave3=function(M,p){return(M=1023&((M=4278190335&((M=251719695&((M=3272356035&((M=M>>>p&1227133513)|M>>>2))|M>>>4))|M>>>8))|M>>>16))<<22>>22},p.nextCombination=function(M){var p=M|M-1;return p+1|(~p&-~p)-1>>>b(M)+1}},13737:(M,p,b)=>{"use strict";M.exports=function(M,p,b){switch(arguments.length){case 1:return Q=[],O(q=M,q,H,!0),Q;case 2:return"function"===typeof p?O(M,M,p,!0):function(M,p){return Q=[],O(M,p,H,!1),Q}(M,p);case 3:return O(M,p,b,!1);default:throw new Error("box-intersect: Invalid arguments")}var q};var Q,q=b(13742),B=b(13762),k=b(13775);function u(M,p){for(var b=0;b<M;++b)if(!(p[b]<=p[b+M]))return!0;return!1}function T(M,p,b,Q){for(var q=0,B=0,k=0,T=M.length;k<T;++k){var O=M[k];if(!u(p,O)){for(var H=0;H<2*p;++H)b[q++]=O[H];Q[B++]=k}}return B}function O(M,p,b,Q){var u=M.length,O=p.length;if(!(u<=0||O<=0)){var H=M[0].length>>>1;if(!(H<=0)){var F,o=q.mallocDouble(2*H*u),W=q.mallocInt32(u);if((u=T(M,H,o,W))>0){if(1===H&&Q)B.init(u),F=B.sweepComplete(H,b,0,u,o,W,0,u,o,W);else{var i=q.mallocDouble(2*H*O),A=q.mallocInt32(O);(O=T(p,H,i,A))>0&&(B.init(u+O),F=1===H?B.sweepBipartite(H,b,0,u,o,W,0,O,i,A):k(H,b,Q,u,o,W,O,i,A),q.free(i),q.free(A))}q.free(o),q.free(W)}return F}}}function H(M,p){Q.push([M,p])}},13780:(M,p)=>{"use strict";var b="d",Q="ax",q="fp",B="es",k="rs",u="re",T="rb",O="bs",H="be",F="bb",o=[b,Q,"vv",k,u,T,"ri",O,H,F,"bi"];function W(M){var p="bruteForce"+(M?"Full":"Partial"),Q=[],k=o.slice();M||k.splice(3,0,q);var u=["function "+p+"("+k.join()+"){"];function T(p,q){var k=function(M,p,Q){var q="bruteForce"+(M?"Red":"Blue")+(p?"Flip":"")+(Q?"Full":""),k=["function ",q,"(",o.join(),"){","var ",B,"=2*",b,";"],u="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",T="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(Q?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return M?k.push(u,"Q",":",T):k.push(T,"Q",":",u),Q?k.push("if(y1<x0||x1<y0)continue;"):p?k.push("if(y0<=x0||x1<y0)continue;"):k.push("if(y0<x0||x1<y0)continue;"),k.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),p?k.push("yi,xi"):k.push("xi,yi"),k.push(");if(rv!==void 0)return rv;}}}"),{name:q,code:k.join("")}}(p,q,M);Q.push(k.code),u.push("return "+k.name+"("+o.join()+");")}u.push("if(re-rs>be-bs){"),M?(T(!0,!1),u.push("}else{"),T(!1,!1)):(u.push("if(fp){"),T(!0,!0),u.push("}else{"),T(!0,!1),u.push("}}else{if(fp){"),T(!1,!0),u.push("}else{"),T(!1,!1),u.push("}")),u.push("}}return "+p);var O=Q.join("")+u.join("");return new Function(O)()}p.partial=W(!1),p.full=W(!0)},13775:(M,p,b)=>{"use strict";M.exports=function(M,p,b,B,H,L,N,r,Y){!function(M,p){var b=8*q.log2(p+1)*(M+1)|0,B=q.nextPow2(s*b);f.length<B&&(Q.free(f),f=Q.mallocInt32(B));var k=q.nextPow2(S*b);R.length<k&&(Q.free(R),R=Q.mallocDouble(k))}(M,B+N);var w,E=0,n=2*M;y(E++,0,0,B,0,N,b?16:0,-1/0,1/0),b||y(E++,0,0,N,0,B,1,-1/0,1/0);for(;E>0;){var g=(E-=1)*s,U=f[g],c=f[g+1],d=f[g+2],V=f[g+3],h=f[g+4],I=f[g+5],Z=E*S,J=R[Z],v=R[Z+1],z=1&I,t=!!(16&I),e=H,G=L,mM=r,C=Y;if(z&&(e=r,G=Y,mM=H,C=L),!(2&I&&c>=(d=j(M,U,c,d,e,G,v)))&&!(4&I&&(c=K(M,U,c,d,e,G,J))>=d)){var X=d-c,l=h-V;if(t){if(M*X*(X+l)<W){if(void 0!==(w=T.scanComplete(M,U,p,c,d,e,G,V,h,mM,C)))return w;continue}}else{if(M*Math.min(X,l)<F){if(void 0!==(w=k(M,U,p,z,c,d,e,G,V,h,mM,C)))return w;continue}if(M*X*l<o){if(void 0!==(w=T.scanBipartite(M,U,p,z,c,d,e,G,V,h,mM,C)))return w;continue}}var MM=i(M,U,c,d,e,G,J,v);if(c<MM)if(M*(MM-c)<F){if(void 0!==(w=u(M,U+1,p,c,MM,e,G,V,h,mM,C)))return w}else if(U===M-2){if(void 0!==(w=z?T.sweepBipartite(M,p,V,h,mM,C,c,MM,e,G):T.sweepBipartite(M,p,c,MM,e,G,V,h,mM,C)))return w}else y(E++,U+1,c,MM,V,h,z,-1/0,1/0),y(E++,U+1,V,h,c,MM,1^z,-1/0,1/0);if(MM<d){var pM=O(M,U,V,h,mM,C),bM=mM[n*pM+U],QM=A(M,U,pM,h,mM,C,bM);if(QM<h&&y(E++,U,MM,d,QM,h,(4|z)+(t?16:0),bM,v),V<pM&&y(E++,U,MM,d,V,pM,(2|z)+(t?16:0),J,bM),pM+1===QM){if(void 0!==(w=t?P(M,U,p,MM,d,e,G,pM,mM,C[pM]):x(M,U,p,z,MM,d,e,G,pM,mM,C[pM])))return w}else if(pM<QM){var qM;if(t){if(MM<(qM=D(M,U,MM,d,e,G,bM))){var BM=A(M,U,MM,qM,e,G,bM);if(U===M-2){if(MM<BM&&void 0!==(w=T.sweepComplete(M,p,MM,BM,e,G,pM,QM,mM,C)))return w;if(BM<qM&&void 0!==(w=T.sweepBipartite(M,p,BM,qM,e,G,pM,QM,mM,C)))return w}else MM<BM&&y(E++,U+1,MM,BM,pM,QM,16,-1/0,1/0),BM<qM&&(y(E++,U+1,BM,qM,pM,QM,0,-1/0,1/0),y(E++,U+1,pM,QM,BM,qM,1,-1/0,1/0))}}else MM<(qM=z?a(M,U,MM,d,e,G,bM):D(M,U,MM,d,e,G,bM))&&(U===M-2?w=z?T.sweepBipartite(M,p,pM,QM,mM,C,MM,qM,e,G):T.sweepBipartite(M,p,MM,qM,e,G,pM,QM,mM,C):(y(E++,U+1,MM,qM,pM,QM,z,-1/0,1/0),y(E++,U+1,pM,QM,MM,qM,1^z,-1/0,1/0)))}}}}};var Q=b(13742),q=b(13746),B=b(13780),k=B.partial,u=B.full,T=b(13762),O=b(13783),H=b(13787),F=128,o=1<<22,W=1<<22,i=H("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),A=H("lo===p0",["p0"]),j=H("lo<p0",["p0"]),K=H("hi<=p0",["p0"]),D=H("lo<=p0&&p0<=hi",["p0"]),a=H("lo<p0&&p0<=hi",["p0"]),s=6,S=2,f=Q.mallocInt32(1024),R=Q.mallocDouble(1024);function y(M,p,b,Q,q,B,k,u,T){var O=s*M;f[O]=p,f[O+1]=b,f[O+2]=Q,f[O+3]=q,f[O+4]=B,f[O+5]=k;var H=S*M;R[H]=u,R[H+1]=T}function x(M,p,b,Q,q,B,k,u,T,O,H){var F=2*M,o=T*F,W=O[o+p];M:for(var i=q,A=q*F;i<B;++i,A+=F){var j=k[A+p],K=k[A+p+M];if(!(W<j||K<W)&&(!Q||W!==j)){for(var D,a=u[i],s=p+1;s<M;++s){j=k[A+s],K=k[A+s+M];var S=O[o+s],f=O[o+s+M];if(K<S||f<j)continue M}if(void 0!==(D=Q?b(H,a):b(a,H)))return D}}}function P(M,p,b,Q,q,B,k,u,T,O){var H=2*M,F=u*H,o=T[F+p];M:for(var W=Q,i=Q*H;W<q;++W,i+=H){var A=k[W];if(A!==O){var j=B[i+p],K=B[i+p+M];if(!(o<j||K<o)){for(var D=p+1;D<M;++D){j=B[i+D],K=B[i+D+M];var a=T[F+D],s=T[F+D+M];if(K<a||s<j)continue M}var S=b(A,O);if(void 0!==S)return S}}}}},13783:(M,p,b)=>{"use strict";M.exports=function(M,p,b,k,u,T){if(k<=b+1)return b;var O=b,H=k,F=k+b>>>1,o=2*M,W=F,i=u[o*F+p];for(;O<H;){if(H-O<q){B(M,p,O,H,u,T),i=u[o*F+p];break}var A=H-O,j=Math.random()*A+O|0,K=u[o*j+p],D=Math.random()*A+O|0,a=u[o*D+p],s=Math.random()*A+O|0,S=u[o*s+p];K<=a?S>=a?(W=D,i=a):K>=S?(W=j,i=K):(W=s,i=S):a>=S?(W=D,i=a):S>=K?(W=j,i=K):(W=s,i=S);for(var f=o*(H-1),R=o*W,y=0;y<o;++y,++f,++R){var x=u[f];u[f]=u[R],u[R]=x}var P=T[H-1];T[H-1]=T[W],T[W]=P;for(f=o*(H-1),R=o*(W=Q(M,p,O,H-1,u,T,i)),y=0;y<o;++y,++f,++R){x=u[f];u[f]=u[R],u[R]=x}P=T[H-1];if(T[H-1]=T[W],T[W]=P,F<W){for(H=W-1;O<H&&u[o*(H-1)+p]===i;)H-=1;H+=1}else{if(!(W<F))break;for(O=W+1;O<H&&u[o*O+p]===i;)O+=1}}return Q(M,p,b,F,u,T,u[o*F+p])};var Q=b(13787)("lo<p0",["p0"]),q=8;function B(M,p,b,Q,q,B){for(var k=2*M,u=k*(b+1)+p,T=b+1;T<Q;++T,u+=k)for(var O=q[u],H=T,F=k*(T-1);H>b&&q[F+p]>O;--H,F-=k){for(var o=F,W=F+k,i=0;i<k;++i,++o,++W){var A=q[o];q[o]=q[W],q[W]=A}var j=B[H];B[H]=B[H-1],B[H-1]=j}}},13787:M=>{"use strict";M.exports=function(M,b){var Q="abcdef".split("").concat(b),q=[];M.indexOf("lo")>=0&&q.push("lo=e[k+n]");M.indexOf("hi")>=0&&q.push("hi=e[k+o]");return Q.push(p.replace("_",q.join()).replace("$",M)),Function.apply(void 0,Q)};var p="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13766:M=>{"use strict";M.exports=function(M,Q){Q<=4*p?b(0,Q-1,M):O(0,Q-1,M)};var p=32;function b(M,p,b){for(var Q=2*(M+1),q=M+1;q<=p;++q){for(var B=b[Q++],k=b[Q++],u=q,T=Q-2;u-- >M;){var O=b[T-2],H=b[T-1];if(O<B)break;if(O===B&&H<k)break;b[T]=O,b[T+1]=H,T-=2}b[T]=B,b[T+1]=k}}function Q(M,p,b){p*=2;var Q=b[M*=2],q=b[M+1];b[M]=b[p],b[M+1]=b[p+1],b[p]=Q,b[p+1]=q}function q(M,p,b){p*=2,b[M*=2]=b[p],b[M+1]=b[p+1]}function B(M,p,b,Q){p*=2,b*=2;var q=Q[M*=2],B=Q[M+1];Q[M]=Q[p],Q[M+1]=Q[p+1],Q[p]=Q[b],Q[p+1]=Q[b+1],Q[b]=q,Q[b+1]=B}function k(M,p,b,Q,q){p*=2,q[M*=2]=q[p],q[p]=b,q[M+1]=q[p+1],q[p+1]=Q}function u(M,p,b){p*=2;var Q=b[M*=2],q=b[p];return!(Q<q)&&(Q!==q||b[M+1]>b[p+1])}function T(M,p,b,Q){var q=Q[M*=2];return q<p||q===p&&Q[M+1]<b}function O(M,H,F){var o=(H-M+1)/6|0,W=M+o,i=H-o,A=M+H>>1,j=A-o,K=A+o,D=W,a=j,s=A,S=K,f=i,R=M+1,y=H-1,x=0;u(D,a,F)&&(x=D,D=a,a=x),u(S,f,F)&&(x=S,S=f,f=x),u(D,s,F)&&(x=D,D=s,s=x),u(a,s,F)&&(x=a,a=s,s=x),u(D,S,F)&&(x=D,D=S,S=x),u(s,S,F)&&(x=s,s=S,S=x),u(a,f,F)&&(x=a,a=f,f=x),u(a,s,F)&&(x=a,a=s,s=x),u(S,f,F)&&(x=S,S=f,f=x);for(var P=F[2*a],L=F[2*a+1],N=F[2*S],r=F[2*S+1],Y=2*D,w=2*s,E=2*f,n=2*W,g=2*A,U=2*i,c=0;c<2;++c){var d=F[Y+c],V=F[w+c],h=F[E+c];F[n+c]=d,F[g+c]=V,F[U+c]=h}q(j,M,F),q(K,H,F);for(var I=R;I<=y;++I)if(T(I,P,L,F))I!==R&&Q(I,R,F),++R;else if(!T(I,N,r,F))for(;;){if(T(y,N,r,F)){T(y,P,L,F)?(B(I,R,y,F),++R,--y):(Q(I,y,F),--y);break}if(--y<I)break}k(M,R-1,P,L,F),k(H,y+1,N,r,F),R-2-M<=p?b(M,R-2,F):O(M,R-2,F),H-(y+2)<=p?b(y+2,H,F):O(y+2,H,F),y-R<=p?b(R,y,F):O(R,y,F)}},13762:(M,p,b)=>{"use strict";M.exports={init:function(M){var p=q.nextPow2(M);T.length<p&&(Q.free(T),T=Q.mallocInt32(p));O.length<p&&(Q.free(O),O=Q.mallocInt32(p));H.length<p&&(Q.free(H),H=Q.mallocInt32(p));F.length<p&&(Q.free(F),F=Q.mallocInt32(p));o.length<p&&(Q.free(o),o=Q.mallocInt32(p));W.length<p&&(Q.free(W),W=Q.mallocInt32(p));var b=8*p;i.length<b&&(Q.free(i),i=Q.mallocDouble(b))},sweepBipartite:function(M,p,b,Q,q,u,o,W,K,D){for(var a=0,s=2*M,S=M-1,f=s-1,R=b;R<Q;++R){var y=u[R],x=s*R;i[a++]=q[x+S],i[a++]=-(y+1),i[a++]=q[x+f],i[a++]=y}for(R=o;R<W;++R){y=D[R]+k;var P=s*R;i[a++]=K[P+S],i[a++]=-y,i[a++]=K[P+f],i[a++]=y}var L=a>>>1;B(i,L);var N=0,r=0;for(R=0;R<L;++R){var Y=0|i[2*R+1];if(Y>=k)A(H,F,r--,Y=Y-k|0);else if(Y>=0)A(T,O,N--,Y);else if(Y<=-k){Y=-Y-k|0;for(var w=0;w<N;++w){if(void 0!==(E=p(T[w],Y)))return E}j(H,F,r++,Y)}else{Y=-Y-1|0;for(w=0;w<r;++w){var E;if(void 0!==(E=p(Y,H[w])))return E}j(T,O,N++,Y)}}},sweepComplete:function(M,p,b,Q,q,k,u,K,D,a){for(var s=0,S=2*M,f=M-1,R=S-1,y=b;y<Q;++y){var x=k[y]+1<<1,P=S*y;i[s++]=q[P+f],i[s++]=-x,i[s++]=q[P+R],i[s++]=x}for(y=u;y<K;++y){x=a[y]+1<<1;var L=S*y;i[s++]=D[L+f],i[s++]=1|-x,i[s++]=D[L+R],i[s++]=1|x}var N=s>>>1;B(i,N);var r=0,Y=0,w=0;for(y=0;y<N;++y){var E=0|i[2*y+1],n=1&E;if(y<N-1&&E>>1===i[2*y+3]>>1&&(n=2,y+=1),E<0){for(var g=-(E>>1)-1,U=0;U<w;++U){if(void 0!==(c=p(o[U],g)))return c}if(0!==n)for(U=0;U<r;++U){if(void 0!==(c=p(T[U],g)))return c}if(1!==n)for(U=0;U<Y;++U){var c;if(void 0!==(c=p(H[U],g)))return c}0===n?j(T,O,r++,g):1===n?j(H,F,Y++,g):2===n&&j(o,W,w++,g)}else{g=(E>>1)-1;0===n?A(T,O,r--,g):1===n?A(H,F,Y--,g):2===n&&A(o,W,w--,g)}}},scanBipartite:function(M,p,b,Q,q,u,H,F,o,W,K,D){var a=0,s=2*M,S=p,f=p+M,R=1,y=1;Q?y=k:R=k;for(var x=q;x<u;++x){var P=x+R,L=s*x;i[a++]=H[L+S],i[a++]=-P,i[a++]=H[L+f],i[a++]=P}for(x=o;x<W;++x){P=x+y;var N=s*x;i[a++]=K[N+S],i[a++]=-P}var r=a>>>1;B(i,r);var Y=0;for(x=0;x<r;++x){var w=0|i[2*x+1];if(w<0){var E=!1;if((P=-w)>=k?(E=!Q,P-=k):(E=!!Q,P-=1),E)j(T,O,Y++,P);else{var n=D[P],g=s*P,U=K[g+p+1],c=K[g+p+1+M];M:for(var d=0;d<Y;++d){var V=T[d],h=s*V;if(!(c<H[h+p+1]||H[h+p+1+M]<U)){for(var I=p+2;I<M;++I)if(K[g+I+M]<H[h+I]||H[h+I+M]<K[g+I])continue M;var Z,J=F[V];if(void 0!==(Z=Q?b(n,J):b(J,n)))return Z}}}}else A(T,O,Y--,w-R)}},scanComplete:function(M,p,b,Q,q,u,O,H,F,o,W){for(var A=0,j=2*M,K=p,D=p+M,a=Q;a<q;++a){var s=a+k,S=j*a;i[A++]=u[S+K],i[A++]=-s,i[A++]=u[S+D],i[A++]=s}for(a=H;a<F;++a){s=a+1;var f=j*a;i[A++]=o[f+K],i[A++]=-s}var R=A>>>1;B(i,R);var y=0;for(a=0;a<R;++a){var x=0|i[2*a+1];if(x<0){if((s=-x)>=k)T[y++]=s-k;else{var P=W[s-=1],L=j*s,N=o[L+p+1],r=o[L+p+1+M];M:for(var Y=0;Y<y;++Y){var w=T[Y],E=O[w];if(E===P)break;var n=j*w;if(!(r<u[n+p+1]||u[n+p+1+M]<N)){for(var g=p+2;g<M;++g)if(o[L+g+M]<u[n+g]||u[n+g+M]<o[L+g])continue M;var U=b(E,P);if(void 0!==U)return U}}}}else{for(s=x-k,Y=y-1;Y>=0;--Y)if(T[Y]===s){for(g=Y+1;g<y;++g)T[g-1]=T[g];break}--y}}}};var Q=b(13742),q=b(13746),B=b(13766),k=1<<28,u=1024,T=Q.mallocInt32(u),O=Q.mallocInt32(u),H=Q.mallocInt32(u),F=Q.mallocInt32(u),o=Q.mallocInt32(u),W=Q.mallocInt32(u),i=Q.mallocDouble(8192);function A(M,p,b,Q){var q=p[Q],B=M[b-1];M[q]=B,p[B]=q}function j(M,p,b,Q){M[b]=Q,p[Q]=b}},13753:M=>{"use strict";function p(M,b,Q){var q=0|M[Q];if(q<=0)return[];var B,k=new Array(q);if(Q===M.length-1)for(B=0;B<q;++B)k[B]=b;else for(B=0;B<q;++B)k[B]=p(M,b,Q+1);return k}M.exports=function(M,b){switch("undefined"===typeof b&&(b=0),typeof M){case"number":if(M>0)return function(M,p){var b,Q;for(b=new Array(M),Q=0;Q<M;++Q)b[Q]=p;return b}(0|M,b);break;case"object":if("number"===typeof M.length)return p(M,b,0)}return[]}},13717:(M,p,b)=>{M.exports=function(){var M=this;this.components={},this.comps=this.components;var p=this.components,b=1,q={},B=[],k=[],u={timeout:!1,removals:[],multiComps:[]};function T(M,b){var Q=p[b],B=q[b],k=B.hash[M];k&&(B.remove(M),Q.ip&&(Q.multi?(k.forEach((p=>{p&&Q.ip(M,p)})),k.length=0):Q.ip(M,k)),u.removals.push(B),O())}function O(){u.timeout||(u.timeout=!0,setTimeout(H,1))}function H(){u.timeout=!1,F()}function F(){u.multiComps.length&&function(M){for(var p=0;p<M.length;p++){var{entID:b,data:Q}=M[p],q=Q.hash[b];if(q){for(var B=0;B<q.length;B++)q[B]||(q.splice(B,1),B--);0===q.length&&(Q.remove(b),u.removals.push(Q))}}M.length=0}(u.multiComps),u.removals.length&&function(M){for(var p=0;p<M.length;p++){M[p].flush()}M.length=0}(u.removals)}this.sF=q,this._systems=B,this._renderSystems=k,this.OH=function(p){var Q=b++;return Array.isArray(p)&&p.forEach((p=>M.tT(Q,p))),Q},this.deleteEntity=function(p){return Object.keys(q).forEach((M=>{q[M].hash[p]&&T(p,M)})),M},this.yH=function(M){if(!M)throw new Error("Missing component definition");var b=M.name;if(!b)throw new Error("Component definition must have a name property.");if("string"!==typeof b)throw new Error("Component name must be a string.");if(""===b)throw new Error("Component name must be a non-empty string.");if(q[b])throw new Error(`Component ${b} already exists.`);var u={};return u.name=b,u.multi=!!M.multi,u.order=isNaN(M.order)?99:M.order,u.stateConstructor=M.stateConstructor||null,u.state=M.state||{},u.vu=M.vu||null,u.ip=M.ip||null,u.system=M.system||null,u.Cu=M.Cu||null,p[b]=u,q[b]=new Q,q[b]._pendingMultiCleanup=!1,q[b]._multiCleanupIDs=u.multi?[]:null,u.system&&(B.push(b),B.sort(((M,b)=>p[M].order-p[b].order))),u.Cu&&(k.push(b),k.sort(((M,b)=>p[M].order-p[b].order))),b},this.overwriteComponent=function(M,b){var Q=p[M];if(!Q)throw new Error(`Unknown component: ${M}`);if(!b)throw new Error("Missing component definition");if(Q.name!==b.name)throw new Error("Overwriting component must use the same name property.");var u={};u.name=M,u.multi=!!b.multi,u.order=isNaN(b.order)?99:b.order,u.state=b.state||{},u.vu=b.vu||null,u.ip=b.ip||null,u.system=b.system||null,u.Cu=b.Cu||null,p[M]=u,q[M]._pendingMultiCleanup=!1,q[M]._multiCleanupIDs=u.multi?[]:null;var T=B.indexOf(M);u.system&&T<0&&B.push(M),!u.system&&T>=0&&B.splice(T,1),B.sort(((M,b)=>p[M].order-p[b].order));var O=k.indexOf(M);u.Cu&&O<0&&k.push(M),!u.Cu&&O>=0&&k.splice(O,1),k.sort(((M,b)=>p[M].order-p[b].order));var H=u.state;return this.vO(M).forEach((M=>{for(var p in H)p in M||(M[p]=H[p]);u.vu&&u.vu(M.Gu,M)})),M},this.deleteComponent=function(b){var Q=q[b];if(!Q)throw new Error(`Unknown component: ${b}`);Q.flush(),Q.list.forEach((M=>{M&&T(M.Gu||M[0].Gu,b)}));var u=B.indexOf(b),O=k.indexOf(b);return u>-1&&B.splice(u,1),O>-1&&k.splice(O,1),q[b].dispose(),delete q[b],delete p[b],M},this.tT=function(M,b,Q){var B,k=p[b],u=q[b];if(!u)throw new Error(`Unknown component: ${b}.`);if(u.hash[M]&&!k.multi)throw new Error(`Entity ${M} already has component: ${b}.`);if(k.stateConstructor){if(!(B=new k.stateConstructor).hasOwnProperty("Gu"))throw new Error(`Component ${k.name} stateConstructor type does not have property __id`)}else B=Object.assign({},{Gu:M},k.state,Q);if(B.Gu=M,k.multi){var T=u.hash[M];T||(T=[],u.add(M,T)),T.push(B)}else u.add(M,B);return k.vu&&k.vu(M,B),this},this.QO=function(M,p){var b=q[p];if(!b)throw new Error(`Unknown component: ${p}.`);return!!b.hash[M]},this.CT=function(p,b){if(!q[b])throw new Error(`Unknown component: ${b}.`);return T(p,b),M},this.getState=function(M,p){var b=q[p];if(!b)throw new Error(`Unknown component: ${p}.`);return b.hash[M]},this.vO=function(M){var p=q[M];if(!p)throw new Error(`Unknown component: ${M}.`);return F(),p.list},this.oW=function(M){if(!q[M])throw new Error(`Unknown component: ${M}.`);var p=q[M].hash;return M=>p[M]},this.AW=function(M){if(!q[M])throw new Error(`Unknown component: ${M}.`);var p=q[M].hash;return M=>!!p[M]},this.Ju=function(b){F();for(var Q=0;Q<B.length;Q++){var k=B[Q],u=p[k],T=q[k];u.system(b,T.list),F()}return M},this.render=function(b){F();for(var Q=0;Q<k.length;Q++){var B=k[Q],u=p[B],T=q[B];u.Cu(b,T.list),F()}return M},this.removeMultiComponent=function(b,Q,B){var k=p[Q],T=q[Q];if(!T)throw new Error(`Unknown component: ${Q}.`);if(!k.multi)throw new Error("removeMultiComponent called on non-multi component");return function(M,p,b,Q){var q=b.hash[M];if(q){var B=q[Q];B&&(q[Q]=null,p.ip&&p.ip(M,B),u.multiComps.push({entID:M,data:b}),O())}}(b,k,T,B),M}};var Q=b(13720)},13720:M=>{function p(M,p){var b=M._map[p];if(delete M.hash[p],delete M._map[p],b===M.list.length-1)M.list.pop();else{var Q=M.list.pop();if(M.list[b]=Q,null===Q||null===Q[0]){var q=M.list.length;for(var B in M._map)if(M._map[B]===q)return void(M._map[B]=b)}else{var k=Q.Gu||Q[0].Gu;M._map[k]=b}}}M.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(M,p){if("number"===typeof this._map[M]){var b=this._map[M];this.hash[M]=p,this.list[b]=p}else this._map[M]=this.list.length,this.hash[M]=p,this.list.push(p)}remove(M){var p=this._map[M];this.hash[M]=null,this.list[p]=null,this._pendingRemovals.push(M)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var M=0;M<this._pendingRemovals.length;M++){var b=this._pendingRemovals[M];null===this.hash[b]&&p(this,b)}this._pendingRemovals.length=0}}},13685:M=>{"use strict";var p,b="object"===typeof Reflect?Reflect:null,Q=function(M,p,b){return Function.prototype.apply.call(M,p,b)};p=b&&"function"===typeof b.ownKeys?b.ownKeys:Object.getOwnPropertySymbols?function(M){return Object.getOwnPropertyNames(M).concat(Object.getOwnPropertySymbols(M))}:function(M){return Object.getOwnPropertyNames(M)};var q=Number.isNaN||function(M){return M!==M};function B(){B.init.call(this)}M.exports=B,M.exports.once=function(M,p){return new Promise((function(b,Q){function q(b){M.removeListener(p,B),Q(b)}function B(){"function"===typeof M.removeListener&&M.removeListener("error",q),b([].slice.call(arguments))}A(M,p,B,{once:!0}),"error"!==p&&function(M,p,b){"function"===typeof M.on&&A(M,"error",p,b)}(M,q,{once:!0})}))},B.EventEmitter=B,B.prototype._events=void 0,B.prototype._eventsCount=0,B.prototype._maxListeners=void 0;var k=10;function u(M){if("function"!==typeof M)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof M)}function T(M){return void 0===M._maxListeners?B.defaultMaxListeners:M._maxListeners}function O(M,p,b,Q){var q,B,k,O;if(u(b),void 0===(B=M._events)?(B=M._events=Object.create(null),M._eventsCount=0):(void 0!==B.newListener&&(M.emit("newListener",p,b.listener?b.listener:b),B=M._events),k=B[p]),void 0===k)k=B[p]=b,++M._eventsCount;else if("function"===typeof k?k=B[p]=Q?[b,k]:[k,b]:Q?k.unshift(b):k.push(b),(q=T(M))>0&&k.length>q&&!k.warned){k.warned=!0;var H=new Error("Possible EventEmitter memory leak detected. "+k.length+" "+String(p)+" listeners added. Use emitter.setMaxListeners() to increase limit");H.name="MaxListenersExceededWarning",H.Qp=M,H.type=p,H.count=k.length,O=H,console&&console.warn&&console.warn(O)}return M}function H(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function F(M,p,b){var Q={fired:!1,wrapFn:void 0,target:M,type:p,listener:b},q=H.bind(Q);return q.listener=b,Q.wrapFn=q,q}function o(M,p,b){var Q=M._events;if(void 0===Q)return[];var q=Q[p];return void 0===q?[]:"function"===typeof q?b?[q.listener||q]:[q]:b?function(M){for(var p=new Array(M.length),b=0;b<p.length;++b)p[b]=M[b].listener||M[b];return p}(q):i(q,q.length)}function W(M){var p=this._events;if(void 0!==p){var b=p[M];if("function"===typeof b)return 1;if(void 0!==b)return b.length}return 0}function i(M,p){for(var b=new Array(p),Q=0;Q<p;++Q)b[Q]=M[Q];return b}function A(M,p,b,Q){if("function"===typeof M.on)Q.once?M.once(p,b):M.on(p,b);else{if("function"!==typeof M.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof M);M.addEventListener(p,(function q(B){Q.once&&M.removeEventListener(p,q),b(B)}))}}Object.defineProperty(B,"defaultMaxListeners",{enumerable:!0,get:function(){return k},set:function(M){if("number"!==typeof M||M<0||q(M))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+M+".");k=M}}),B.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},B.prototype.setMaxListeners=function(M){if("number"!==typeof M||M<0||q(M))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+M+".");return this._maxListeners=M,this},B.prototype.getMaxListeners=function(){return T(this)},B.prototype.emit=function(M){for(var p=[],b=1;b<arguments.length;b++)p.push(arguments[b]);var q="error"===M,B=this._events;if(void 0!==B)q=q&&void 0===B.error;else if(!q)return!1;if(q){var k;if(p.length>0&&(k=p[0]),k instanceof Error)throw k;var u=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw u.context=k,u}var T=B[M];if(void 0===T)return!1;if("function"===typeof T)Q(T,this,p);else{var O=T.length,H=i(T,O);for(b=0;b<O;++b)Q(H[b],this,p)}return!0},B.prototype.addListener=function(M,p){return O(this,M,p,!1)},B.prototype.on=B.prototype.addListener,B.prototype.prependListener=function(M,p){return O(this,M,p,!0)},B.prototype.once=function(M,p){return u(p),this.on(M,F(this,M,p)),this},B.prototype.prependOnceListener=function(M,p){return u(p),this.prependListener(M,F(this,M,p)),this},B.prototype.removeListener=function(M,p){var b,Q,q,B,k;if(u(p),void 0===(Q=this._events))return this;if(void 0===(b=Q[M]))return this;if(b===p||b.listener===p)0===--this._eventsCount?this._events=Object.create(null):(delete Q[M],Q.removeListener&&this.emit("removeListener",M,b.listener||p));else if("function"!==typeof b){for(q=-1,B=b.length-1;B>=0;B--)if(b[B]===p||b[B].listener===p){k=b[B].listener,q=B;break}if(q<0)return this;0===q?b.shift():function(M,p){for(;p+1<M.length;p++)M[p]=M[p+1];M.pop()}(b,q),1===b.length&&(Q[M]=b[0]),void 0!==Q.removeListener&&this.emit("removeListener",M,k||p)}return this},B.prototype.off=B.prototype.removeListener,B.prototype.qp=function(M){var p,b,Q;if(void 0===(b=this._events))return this;if(void 0===b.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==b[M]&&(0===--this._eventsCount?this._events=Object.create(null):delete b[M]),this;if(0===arguments.length){var q,B=Object.keys(b);for(Q=0;Q<B.length;++Q)"removeListener"!==(q=B[Q])&&this.qp(q);return this.qp("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(p=b[M]))this.removeListener(M,p);else if(void 0!==p)for(Q=p.length-1;Q>=0;Q--)this.removeListener(M,p[Q]);return this},B.prototype.listeners=function(M){return o(this,M,!0)},B.prototype.rawListeners=function(M){return o(this,M,!1)},B.listenerCount=function(M,p){return"function"===typeof M.listenerCount?M.listenerCount(p):W.call(M,p)},B.prototype.listenerCount=W,B.prototype.eventNames=function(){return this._eventsCount>0?p(this._events):[]}},13942:M=>{"use strict";M.exports=function(M,p,b,Q,q,B){var k=+p[0],u=+p[1],T=+p[2],O=+b[0],H=+b[1],F=+b[2],o=Math.sqrt(O*O+H*H+F*F);if(0===o)throw new Error("Can't raycast along a zero vector");return function(M,p,b,Q,q,B,k,u,T,O){for(var H=0,F=Math.floor,o=0|F(p),W=0|F(b),i=0|F(Q),A=q>0?1:-1,j=B>0?1:-1,K=k>0?1:-1,D=Math.abs(1/q),a=Math.abs(1/B),s=Math.abs(1/k),S=D<1/0?D*(A>0?o+1-p:p-o):1/0,f=a<1/0?a*(j>0?W+1-b:b-W):1/0,R=s<1/0?s*(K>0?i+1-Q:Q-i):1/0,y=-1;H<=u;){var x=M(o,W,i);if(x)return T&&(T[0]=p+H*q,T[1]=b+H*B,T[2]=Q+H*k),O&&(O[0]=O[1]=O[2]=0,0===y&&(O[0]=-A),1===y&&(O[1]=-j),2===y&&(O[2]=-K)),x;S<f?S<R?(o+=A,H=S,S+=D,y=0):(i+=K,H=R,R+=s,y=2):f<R?(W+=j,H=f,f+=a,y=1):(i+=K,H=R,R+=s,y=2)}return T&&(T[0]=p+H*q,T[1]=b+H*B,T[2]=Q+H*k),O&&(O[0]=O[1]=O[2]=0),0}(M,k,u,T,O/=o,H/=o,F/=o,Q="undefined"===typeof Q?64:+Q,q,B)}},13970:(M,p,b)=>{"use strict";b.d(p,{d:()=>B});var Q=b(13685);function q(){this.Oo=!1,this.stopPropagation=!1,this.Ho=!1,this.disabled=!1}class B{constructor(M,p){this.version="0.7.0";var b=Object.assign({},new q,p||{});this.element=M||document,this.Oo=!!b.Oo,this.stopPropagation=!!b.stopPropagation,this.Ho=!!b.Ho,this.disabled=!!b.disabled,this.filterEvents=(M,p)=>!0,this.down=new Q.EventEmitter,this.up=new Q.EventEmitter,this.state={},this.dO={dx:0,dy:0,QW:0,cO:0,qW:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?u(this):document.addEventListener("DOMContentLoaded",(M=>{u(this)}),{once:!0})}bind(M){for(var p=arguments.length,b=new Array(p>1?p-1:0),Q=1;Q<p;Q++)b[Q-1]=arguments[Q];b.forEach((p=>{var b=this._keyBindmap[p]||[];b.includes(M)||(b.push(M),this._keyBindmap[p]=b)})),this.state[M]=!!this.state[M],this.pressCount[M]=this.pressCount[M]||0,this.releaseCount[M]=this.releaseCount[M]||0}unbind(M){for(var p in this._keyBindmap){var b=this._keyBindmap[p],Q=b.indexOf(M);Q>-1&&b.splice(Q,1)}}getBindings(){var M={};for(var p in this._keyBindmap){this._keyBindmap[p].forEach((b=>{M[b]=M[b]||[],M[b].push(p)}))}return M}Ju(){k(this.dO),k(this.pressCount),k(this.releaseCount)}}function k(M){for(var p in M)M[p]=0}function u(M){window.addEventListener("keydown",i.bind(null,M,!0),!1),window.addEventListener("keyup",i.bind(null,M,!1),!1);var p={passive:!0};M.element.addEventListener("touchstart",F.bind(void 0,M),{passive:!1}),M.element.addEventListener("touchend",W.bind(void 0,M),p),M.element.addEventListener("mousedown",A.bind(null,M,!0),p),window.document.addEventListener("mouseup",A.bind(null,M,!1),p),M.element.addEventListener("touchmove",j.bind(null,M),p),M.element.addEventListener("mousemove",j.bind(null,M),p),window.PointerEvent,M.element.addEventListener("wheel",K.bind(null,M),p),M.element.addEventListener("contextmenu",D.bind(null,M),!1),window.addEventListener("blur",a.bind(null,M),!1)}var T=0,O=0,H=null;function F(M,p){p.preventDefault(),o(p)}function o(M){let p=!1;for(let b=0;b<M.touches.length;++b)if(M.touches[b].identifier===H){p=!0;break}if(!p){const p=M.changedTouches[0];T=p.clientX,O=p.clientY,H=p.identifier}}function W(M,p){for(var b=p.changedTouches,Q=0;Q<b.length;++Q)b[Q].identifier===H&&(H=null)}function i(M,p,b){s(b.code,p,M,b)}function A(M,p,b){if("pointerId"in b)if(p){if(null!==M._touches.currID)return;M._touches.currID=b.pointerId}else{if(M._touches.currID!==b.pointerId)return;M._touches.currID=null}return s("Mouse"+("button"in b?b.button+1:1),p,M,b),!1}function j(M,p){var b=p.movementX||p.mozMovementX||0,Q=p.movementY||p.mozMovementY||0;if(p.touches&&0===(b|Q)){var q=function(M){o(M);for(let p=0;p<M.changedTouches.length;++p)if(M.changedTouches[p].identifier==H){const b=M.changedTouches[p],Q=[b.clientX-T,b.clientY-O];return T=b.clientX,O=b.clientY,Q}return console.error(`Did not find touch id ${H}`),[0,0]}(p);b=q[0],Q=q[1]}M.dO.dx+=b,M.dO.dy+=Q}function K(M,p){var b=1;switch(p.deltaMode){case 0:b=1;break;case 1:b=12;break;case 2:b=M.element.clientHeight||window.innerHeight}M.dO.QW+=(p.deltaX||0)*b,M.dO.cO+=(p.deltaY||0)*b,M.dO.qW+=(p.deltaZ||0)*b}function D(M,p){if(!M.Ho)return p.preventDefault(),!1}function a(M){for(var p in M._keyStates)M._keyStates[p]&&(/^Mouse\d/.test(p)||s(p,!1,M,{code:p,note:"lg0l31m677f",preventDefault:()=>{},stopPropagation:()=>{}}))}function s(M,p,b,Q){var q=b._keyBindmap[M];q&&(S(b._keyStates[M],p)&&(b._keyStates[M]=p,q.forEach((M=>{(!b.filterEvents||b.filterEvents(Q,M))&&function(M,p,b,Q){var q=p?b.pressCount:b.releaseCount;q[M]=(q[M]||0)+1;var B=b._bindPressCount[M]||0;(B+=p?1:-1)<0&&(B=0);b._bindPressCount[M]=B;var k=b.state[M];if(S(k,B)){b.state[M]=B>0;var u=p?b.down:b.up;b.disabled||u.emit(M,Q)}}(M,p,b,Q)}))),"button"in Q||(b.Oo&&!Q.defaultPrevented&&Q.preventDefault(),b.stopPropagation&&Q.stopPropagation()))}function S(M,p){return M?!p:p}},12644:M=>{M.exports=function(M,p,b){return M[0]=p[0]+b[0],M[1]=p[1]+b[1],M[2]=p[2]+b[2],M}},12606:(M,p,b)=>{M.exports=function(M,p){var b=Q(M[0],M[1],M[2]),k=Q(p[0],p[1],p[2]);q(b,b),q(k,k);var u=B(b,k);return u>1?0:Math.acos(u)};var Q=b(12614),q=b(12616),B=b(12623)},12699:M=>{M.exports=function(M,p){return M[0]=Math.ceil(p[0]),M[1]=Math.ceil(p[1]),M[2]=Math.ceil(p[2]),M}},12598:M=>{M.exports=function(M){var p=new Float32Array(3);return p[0]=M[0],p[1]=M[1],p[2]=M[2],p}},12627:M=>{M.exports=function(M,p){return M[0]=p[0],M[1]=p[1],M[2]=p[2],M}},12596:M=>{M.exports=function(){var M=new Float32Array(3);return M[0]=0,M[1]=0,M[2]=0,M}},12780:M=>{M.exports=function(M,p,b){var Q=p[0],q=p[1],B=p[2],k=b[0],u=b[1],T=b[2];return M[0]=q*T-B*u,M[1]=B*k-Q*T,M[2]=Q*u-q*k,M}},12726:(M,p,b)=>{M.exports=b(12724)},12724:M=>{M.exports=function(M,p){var b=p[0]-M[0],Q=p[1]-M[1],q=p[2]-M[2];return Math.sqrt(b*b+Q*Q+q*q)}},12684:(M,p,b)=>{M.exports=b(12679)},12679:M=>{M.exports=function(M,p,b){return M[0]=p[0]/b[0],M[1]=p[1]/b[1],M[2]=p[2]/b[2],M}},12623:M=>{M.exports=function(M,p){return M[0]*p[0]+M[1]*p[1]+M[2]*p[2]}},12592:M=>{M.exports=1e-6},12635:(M,p,b)=>{M.exports=function(M,p){var b=M[0],q=M[1],B=M[2],k=p[0],u=p[1],T=p[2];return Math.abs(b-k)<=Q*Math.max(1,Math.abs(b),Math.abs(k))&&Math.abs(q-u)<=Q*Math.max(1,Math.abs(q),Math.abs(u))&&Math.abs(B-T)<=Q*Math.max(1,Math.abs(B),Math.abs(T))};var Q=b(12592)},12638:M=>{M.exports=function(M,p){return M[0]===p[0]&&M[1]===p[1]&&M[2]===p[2]}},12691:M=>{M.exports=function(M,p){return M[0]=Math.floor(p[0]),M[1]=Math.floor(p[1]),M[2]=Math.floor(p[2]),M}},12822:(M,p,b)=>{M.exports=function(M,p,b,q,B,k){var u,T;p||(p=3);b||(b=0);T=q?Math.min(q*p+b,M.length):M.length;for(u=b;u<T;u+=p)Q[0]=M[u],Q[1]=M[u+1],Q[2]=M[u+2],B(Q,Q,k),M[u]=Q[0],M[u+1]=Q[1],M[u+2]=Q[2];return M};var Q=b(12596)()},12614:M=>{M.exports=function(M,p,b){var Q=new Float32Array(3);return Q[0]=M,Q[1]=p,Q[2]=b,Q}},12588:(M,p,b)=>{M.exports={EPSILON:b(12592),create:b(12596),clone:b(12598),angle:b(12606),nu:b(12614),j:b(12627),set:b(12629),equals:b(12635),exactEquals:b(12638),add:b(12644),jp:b(12650),sub:b(12659),multiply:b(12667),mul:b(12675),divide:b(12679),div:b(12684),min:b(12687),max:b(12689),floor:b(12691),ceil:b(12699),round:b(12706),scale:b(12715),gu:b(12721),distance:b(12724),k:b(12726),squaredDistance:b(12732),sqrDist:b(12738),length:b(12747),len:b(12755),squaredLength:b(12760),Uu:b(12764),negate:b(12771),inverse:b(12775),normalize:b(12616),dot:b(12623),cross:b(12780),Yu:b(12789),random:b(12795),transformMat4:b(12797),transformMat3:b(12800),transformQuat:b(12805),cu:b(12808),du:b(12812),Vu:b(12817),forEach:b(12822)}},12775:M=>{M.exports=function(M,p){return M[0]=1/p[0],M[1]=1/p[1],M[2]=1/p[2],M}},12755:(M,p,b)=>{M.exports=b(12747)},12747:M=>{M.exports=function(M){var p=M[0],b=M[1],Q=M[2];return Math.sqrt(p*p+b*b+Q*Q)}},12789:M=>{M.exports=function(M,p,b,Q){var q=p[0],B=p[1],k=p[2];return M[0]=q+Q*(b[0]-q),M[1]=B+Q*(b[1]-B),M[2]=k+Q*(b[2]-k),M}},12689:M=>{M.exports=function(M,p,b){return M[0]=Math.max(p[0],b[0]),M[1]=Math.max(p[1],b[1]),M[2]=Math.max(p[2],b[2]),M}},12687:M=>{M.exports=function(M,p,b){return M[0]=Math.min(p[0],b[0]),M[1]=Math.min(p[1],b[1]),M[2]=Math.min(p[2],b[2]),M}},12675:(M,p,b)=>{M.exports=b(12667)},12667:M=>{M.exports=function(M,p,b){return M[0]=p[0]*b[0],M[1]=p[1]*b[1],M[2]=p[2]*b[2],M}},12771:M=>{M.exports=function(M,p){return M[0]=-p[0],M[1]=-p[1],M[2]=-p[2],M}},12616:M=>{M.exports=function(M,p){var b=p[0],Q=p[1],q=p[2],B=b*b+Q*Q+q*q;B>0&&(B=1/Math.sqrt(B),M[0]=p[0]*B,M[1]=p[1]*B,M[2]=p[2]*B);return M}},12795:M=>{M.exports=function(M,p){p=p||1;var b=2*Math.random()*Math.PI,Q=2*Math.random()-1,q=Math.sqrt(1-Q*Q)*p;return M[0]=Math.cos(b)*q,M[1]=Math.sin(b)*q,M[2]=Q*p,M}},12808:M=>{M.exports=function(M,p,b,Q){var q=b[1],B=b[2],k=p[1]-q,u=p[2]-B,T=Math.sin(Q),O=Math.cos(Q);return M[0]=p[0],M[1]=q+k*O-u*T,M[2]=B+k*T+u*O,M}},12812:M=>{M.exports=function(M,p,b,Q){var q=b[0],B=b[2],k=p[0]-q,u=p[2]-B,T=Math.sin(Q),O=Math.cos(Q);return M[0]=q+u*T+k*O,M[1]=p[1],M[2]=B+u*O-k*T,M}},12817:M=>{M.exports=function(M,p,b,Q){var q=b[0],B=b[1],k=p[0]-q,u=p[1]-B,T=Math.sin(Q),O=Math.cos(Q);return M[0]=q+k*O-u*T,M[1]=B+k*T+u*O,M[2]=p[2],M}},12706:M=>{M.exports=function(M,p){return M[0]=Math.round(p[0]),M[1]=Math.round(p[1]),M[2]=Math.round(p[2]),M}},12715:M=>{M.exports=function(M,p,b){return M[0]=p[0]*b,M[1]=p[1]*b,M[2]=p[2]*b,M}},12721:M=>{M.exports=function(M,p,b,Q){return M[0]=p[0]+b[0]*Q,M[1]=p[1]+b[1]*Q,M[2]=p[2]+b[2]*Q,M}},12629:M=>{M.exports=function(M,p,b,Q){return M[0]=p,M[1]=b,M[2]=Q,M}},12738:(M,p,b)=>{M.exports=b(12732)},12764:(M,p,b)=>{M.exports=b(12760)},12732:M=>{M.exports=function(M,p){var b=p[0]-M[0],Q=p[1]-M[1],q=p[2]-M[2];return b*b+Q*Q+q*q}},12760:M=>{M.exports=function(M){var p=M[0],b=M[1],Q=M[2];return p*p+b*b+Q*Q}},12659:(M,p,b)=>{M.exports=b(12650)},12650:M=>{M.exports=function(M,p,b){return M[0]=p[0]-b[0],M[1]=p[1]-b[1],M[2]=p[2]-b[2],M}},12800:M=>{M.exports=function(M,p,b){var Q=p[0],q=p[1],B=p[2];return M[0]=Q*b[0]+q*b[3]+B*b[6],M[1]=Q*b[1]+q*b[4]+B*b[7],M[2]=Q*b[2]+q*b[5]+B*b[8],M}},12797:M=>{M.exports=function(M,p,b){var Q=p[0],q=p[1],B=p[2],k=b[3]*Q+b[7]*q+b[11]*B+b[15];return k=k||1,M[0]=(b[0]*Q+b[4]*q+b[8]*B+b[12])/k,M[1]=(b[1]*Q+b[5]*q+b[9]*B+b[13])/k,M[2]=(b[2]*Q+b[6]*q+b[10]*B+b[14])/k,M}},12805:M=>{M.exports=function(M,p,b){var Q=p[0],q=p[1],B=p[2],k=b[0],u=b[1],T=b[2],O=b[3],H=O*Q+u*B-T*q,F=O*q+T*Q-k*B,o=O*B+k*q-u*Q,W=-k*Q-u*q-T*B;return M[0]=H*O+W*-k+F*-T-o*-u,M[1]=F*O+W*-u+o*-k-H*-T,M[2]=o*O+W*-T+H*-u-F*-k,M}},13701:M=>{"use strict";M.exports=function(M){for(var p=new Array(M),b=0;b<M;++b)p[b]=b;return p}},13755:M=>{M.exports=function(M){return null!=M&&null!=M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}},13945:(M,p,b)=>{"use strict";b.d(p,{b:()=>Q});class Q{constructor(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.zH=!1,this.tH=!1,this.JH=30,this.vH=0,this.pF=!1,this.fullscreen=!1,this.GH=function(M){},this.mF=function(){},this.lH=function(){},this.Up=function(){},this.CH=function(M){},this.onFullscreenChanged=function(M){},O((()=>{!function(M,p){M._nowObject=performance||Date,M._lastTick=0,M._renderAccum=0,M._rt=0,M._frameCB=u.bind(null,M),requestAnimationFrame(M._frameCB),p>0&&(M._intervalCB=k.bind(null,M),M._interval=setInterval(M._intervalCB,Math.max(p,1e3/M.JH/2)))}(this,p),function(M,p){if(!p)return;var b=!1,Q=!1;document.addEventListener("pointerlockchange",(Q=>{b=document.pointerLockElement===p,M.CH(b)})),document.addEventListener("fullscreenchange",(b=>{Q=document.fullscreenElement===p,M.onFullscreenChanged(Q)})),Object.defineProperty(M,"pF",{get:()=>b,set:M=>{M&&!b?T(p):b&&!M&&function(M){M.exitPointerLock&&M.exitPointerLock()}(document)}}),Object.defineProperty(M,"fullscreen",{get:()=>Q,set:M=>{M&&!Q?p.requestFullscreen():Q&&!M&&document.exitFullscreen()}}),p.addEventListener("click",(q=>{M.zH&&!b&&T(p),M.tH&&!Q&&p.requestFullscreen()}));var q=()=>M.Up();if(window.ResizeObserver){new ResizeObserver(q).observe(p)}else window.addEventListener("resize",q)}(this,M),this.lH()}))}}var q=3,B=20;function k(M){for(var p=1e3/M.JH,b=M._nowObject.now()+B,Q=0;M._nowObject.now()>=M._lastTick+p&&M._nowObject.now()<b&&++Q<=q;)M.GH(p),M._lastTick+=p;var k=5*(p+5),u=M._nowObject.now();if(u-M._lastTick>k)for(;u>=M._lastTick+p;)M._lastTick+=p}function u(M){requestAnimationFrame(M._frameCB),k(M);var p=M._nowObject.now(),b=p-M._rt;if(M._rt=p,M.vH>0){M._renderAccum+=b;var Q=1e3/M.vH;if(M._renderAccum<Q)return;M._renderAccum=Math.min(M._renderAccum-Q,Q)}var q=1e3/M.JH,B=(p-M._lastTick)/q;M.mF(b,B,q)}function T(M){M.requestPointerLock&&M.requestPointerLock()}var O=M=>{if("loading"===document.readyState){var p=()=>{document.removeEventListener("readystatechange",p),M()};document.addEventListener("readystatechange",p)}else setTimeout(M,1)}},13694:(M,p,b)=>{var Q=b(13701),q=b(13708),B="undefined"!==typeof Float64Array;function k(M,p){return M[0]-p[0]}function u(){var M,p=this.stride,b=new Array(p.length);for(M=0;M<b.length;++M)b[M]=[Math.abs(p[M]),M];b.sort(k);var Q=new Array(b.length);for(M=0;M<Q.length;++M)Q[M]=b[M][1];return Q}function T(M,p){var b=["View",p,"d",M].join("");p<0&&(b="View_Nil"+M);var q="generic"===M;if(-1===p){var B="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+M+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(B)()}if(0===p){B="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+M+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",B)(O[M][0])}B=["'use strict'"];var k=Q(p),T=k.map((function(M){return"i"+M})),H="this.offset+"+k.map((function(M){return"this.stride["+M+"]*i"+M})).join("+"),F=k.map((function(M){return"b"+M})).join(","),o=k.map((function(M){return"c"+M})).join(",");B.push("function "+b+"(a,"+F+","+o+",d){this.data=a","this.shape=["+F+"]","this.stride=["+o+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+M+"'","proto.dimension="+p),B.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+k.map((function(M){return"this.shape["+M+"]"})).join("*"),"}})"),1===p?B.push("proto.order=[0]"):(B.push("Object.defineProperty(proto,'order',{get:"),p<4?(B.push("function "+b+"_order(){"),2===p?B.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===p&&B.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):B.push("ORDER})")),B.push("proto.set=function "+b+"_set("+T.join(",")+",v){"),q?B.push("return this.data.set("+H+",v)}"):B.push("return this.data["+H+"]=v}"),B.push("proto.get=function "+b+"_get("+T.join(",")+"){"),q?B.push("return this.data.get("+H+")}"):B.push("return this.data["+H+"]}"),B.push("proto.index=function "+b+"_index(",T.join(),"){return "+H+"}"),B.push("proto.hi=function "+b+"_hi("+T.join(",")+"){return new "+b+"(this.data,"+k.map((function(M){return["(typeof i",M,"!=='number'||i",M,"<0)?this.shape[",M,"]:i",M,"|0"].join("")})).join(",")+","+k.map((function(M){return"this.stride["+M+"]"})).join(",")+",this.offset)}");var W=k.map((function(M){return"a"+M+"=this.shape["+M+"]"})),i=k.map((function(M){return"c"+M+"=this.stride["+M+"]"}));B.push("proto.lo=function "+b+"_lo("+T.join(",")+"){var b=this.offset,d=0,"+W.join(",")+","+i.join(","));for(var A=0;A<p;++A)B.push("if(typeof i"+A+"==='number'&&i"+A+">=0){d=i"+A+"|0;b+=c"+A+"*d;a"+A+"-=d}");B.push("return new "+b+"(this.data,"+k.map((function(M){return"a"+M})).join(",")+","+k.map((function(M){return"c"+M})).join(",")+",b)}"),B.push("proto.step=function "+b+"_step("+T.join(",")+"){var "+k.map((function(M){return"a"+M+"=this.shape["+M+"]"})).join(",")+","+k.map((function(M){return"b"+M+"=this.stride["+M+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(A=0;A<p;++A)B.push("if(typeof i"+A+"==='number'){d=i"+A+"|0;if(d<0){c+=b"+A+"*(a"+A+"-1);a"+A+"=ceil(-a"+A+"/d)}else{a"+A+"=ceil(a"+A+"/d)}b"+A+"*=d}");B.push("return new "+b+"(this.data,"+k.map((function(M){return"a"+M})).join(",")+","+k.map((function(M){return"b"+M})).join(",")+",c)}");var j=new Array(p),K=new Array(p);for(A=0;A<p;++A)j[A]="a[i"+A+"]",K[A]="b[i"+A+"]";B.push("proto.transpose=function "+b+"_transpose("+T+"){"+T.map((function(M,p){return M+"=("+M+"===undefined?"+p+":"+M+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+j.join(",")+","+K.join(",")+",this.offset)}"),B.push("proto.pick=function "+b+"_pick("+T+"){var a=[],b=[],c=this.offset");for(A=0;A<p;++A)B.push("if(typeof i"+A+"==='number'&&i"+A+">=0){c=(c+this.stride["+A+"]*i"+A+")|0}else{a.push(this.shape["+A+"]);b.push(this.stride["+A+"])}");return B.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),B.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+k.map((function(M){return"shape["+M+"]"})).join(",")+","+k.map((function(M){return"stride["+M+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",B.join("\n"))(O[M],u)}var O={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};M.exports=function(M,p,b,Q){if(void 0===M)return(0,O.array[0])([]);"number"===typeof M&&(M=[M]),void 0===p&&(p=[M.length]);var k=p.length;if(void 0===b){b=new Array(k);for(var u=k-1,H=1;u>=0;--u)b[u]=H,H*=p[u]}if(void 0===Q){Q=0;for(u=0;u<k;++u)b[u]<0&&(Q-=(p[u]-1)*b[u])}for(var F=function(M){if(q(M))return"buffer";if(B)switch(Object.prototype.toString.call(M)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(M)?"array":"generic"}(M),o=O[F];o.length<=k+1;)o.push(T(F,o.length-1));return(0,o[k+1])(M,p,b,Q)}},13708:M=>{function p(M){return!!M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}M.exports=function(M){return null!=M&&(p(M)||function(M){return"function"===typeof M.readFloatLE&&"function"===typeof M.slice&&p(M.slice(0,0))}(M)||!!M._isBuffer)}},13827:M=>{"use strict";var p=[],b=[],Q=[],q=[],B=[],k=[],u=[],T=[],O=[],H=[],F=[],o=[];M.exports=function(M,W,i,A,j,K){for(var D=u,a=O,s=H,S=o,f=0;f<3;f++)D[f]=+i[f],s[f]=+W.max[f],a[f]=+W.base[f];K||(K=1e-10);var R=function(M,u,O,H,o,W){var i=p,A=b,j=Q,K=q,D=B,a=k,s=T,S=Math.floor,f=0,R=0,y=0,x=0,P=0;if(L(),0===y)return 0;for(x=Y();R<=y;){if(N(x)&&r())return f;x=Y()}for(f+=y,P=0;P<3;P++)H[P]+=O[P],o[P]+=O[P];return f;function L(){if(R=0,0!==(y=Math.sqrt(O[0]*O[0]+O[1]*O[1]+O[2]*O[2])))for(var M=0;M<3;M++){var p=O[M]>=0;K[M]=p?1:-1;var b=p?o[M]:H[M];i[M]=p?H[M]:o[M],A[M]=w(b,K[M]),j[M]=E(i[M],K[M]),s[M]=O[M]/y,D[M]=Math.abs(1/s[M]);var Q=p?A[M]+1-b:b-A[M];a[M]=D[M]<1/0?D[M]*Q:1/0}}function N(p){for(var b=K[0],Q=0===p?A[0]:j[0],q=A[0]+b,B=K[1],k=1===p?A[1]:j[1],u=A[1]+B,T=K[2],O=2===p?A[2]:j[2],H=A[2]+T,F=Q;F!=q;F+=b)for(var o=k;o!=u;o+=B)for(var W=O;W!=H;W+=T)if(M(F,o,W))return!0;return!1}function r(){f+=R;var M=K[x],p=R/y,b=F;for(P=0;P<3;P++){var Q=O[P]*p;H[P]+=Q,o[P]+=Q,b[P]=O[P]-Q}if(M>0?o[x]=Math.round(o[x]):H[x]=Math.round(H[x]),u(f,x,M,b))return!0;for(P=0;P<3;P++)O[P]=b[P];return L(),0===y}function Y(){var M=a[0]<a[1]?a[0]<a[2]?0:2:a[1]<a[2]?1:2,p=a[M]-R;for(R=a[M],A[M]+=K[M],a[M]+=D[M],P=0;P<3;P++)i[P]+=p*s[P],j[P]=E(i[P],K[P]);return M}function w(M,p){return S(M-p*W)}function E(M,p){return S(M+p*W)}}(M,A,D,a,s,K);if(!j){for(f=0;f<3;f++)S[f]=i[f]>0?s[f]-W.max[f]:a[f]-W.base[f];W.translate(S)}return R}},13976:(M,p,b)=>{"use strict";b.d(p,{b:()=>F});var Q=b(13819),q=b(12588);class B{constructor(M,p,b,B,k,u,T){this.JO=new Q(M.base,M.kH),this.PB=p,this.friction=b,this.restitution=B,this.Ru=k,this.RW=u,this.yu=!!T,this.BH=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Fi=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.DO=q.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=q.create(),this._impulses=q.create(),this._sleepFrameCount=10}loadFromCopy(M){q.j(this.JO.base,M.JO.base),q.j(this.JO.kH,M.JO.kH),q.j(this.JO.max,M.JO.max),this.JO.mag=M.JO.mag,this.PB=M.PB,this.friction=M.friction,this.restitution=M.restitution,this.Ru=M.Ru,this.RW=M.RW,this.yu=M.yu,this.BH=M.BH,this.fluidDrag=M.fluidDrag,this.Fi=M.Fi,this.preventFallOffEdge=M.preventFallOffEdge,this.rolledBackLastTick=M.rolledBackLastTick,q.j(this.DO,M.DO),q.j(this.resting,M.resting),this.inFluid=M.inFluid,this._ratioInFluid=M._ratioInFluid,q.j(this._forces,M._forces),q.j(this._impulses,M._impulses),this._sleepFrameCount=M._sleepFrameCount}setPosition(M){k(M),q.jp(M,M,this.JO.base),this.JO.translate(M),this.SO()}dp(){return q.clone(this.JO.base)}applyForce(M){k(M),q.add(this._forces,this._forces,M),this.SO()}applyImpulse(M){k(M),q.add(this._impulses,this._impulses,M),this.SO()}SO(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var k=M=>{};var u=b(13819),T=b(12588),O=b(13827);function H(){this.BH=.1,this.fluidDrag=.4,this.ru=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function F(M,p,b){M=Object.assign(new H,M),this.gravity=M.gravity||[0,-10,0],this.BH=M.BH||.1,this.ru=M.ru||2,this.fluidDrag=M.fluidDrag||.4,this.minBounceImpulse=M.minBounceImpulse,this.bodies=[],this.vo=M.vo,this.testSolid=p,this.testFluid=b}F.prototype.YW=function(M,p,b,Q,q,k){M=M||new u([0,0,0],[1,1,1]),"undefined"==typeof p&&(p=1),"undefined"==typeof b&&(b=1),"undefined"==typeof Q&&(Q=0),"undefined"==typeof q&&(q=1);var T=new B(M,p,b,Q,q,k);return this.bodies.push(T),T},F.prototype.wW=function(M){var p=this.bodies.indexOf(M);p<0||(this.bodies.splice(p,1),M.JO=M.RW=null)};var o=T.create(),W=T.create(),i=T.create(),A=T.create(),j=T.create(),K=T.create(),D=T.create(),a=new u([0,0,0],[1,1,1]),s=new B(a,1,1,0,1,(()=>{}),!1);function S(M,p,b){return p=b,p*=1-(1-M.ratioInFluid)**2}F.prototype.Ju=function(M){M/=1e3;var p=d(0,T.squaredLength(this.gravity));this.bodies.forEach((b=>function(M,p,b,Q){T.j(j,p.resting),M.vo&&s.loadFromCopy(p);if(p.PB<=0)return T.set(p.DO,0,0,0),T.set(p._forces,0,0,0),void T.set(p._impulses,0,0,0);var q=Q||0===p.Ru;if(function(M,p,b,Q){if(p._sleepFrameCount>0)return!1;if(Q)return!0;var q=!1,B=.5*b*b*p.Ru;return T.scale(c,M.gravity,B),O(M.testSolid,p.JO,c,(function(){return q=!0,!0}),!0),q}(M,p,b,q))return;p._sleepFrameCount--,function(M,p){var b=p.JO,Q=Math.floor(b.base[0]),q=Math.floor(b.base[2]),B=Math.floor(b.base[1]),k=Math.floor(b.max[1]);if(!M.testFluid(Q,B,q))return p.inFluid=!1,void(p.ratioInFluid=0);var u=1,O=B+1;for(;O<=k&&M.testFluid(Q,O,q);)u++,O++;var H=(B+u-b.base[1])/b.kH[1];H>1&&(H=1);var F=b.kH[0]*b.kH[1]*b.kH[2]*H,o=R;T.scale(o,M.gravity,-M.ru*F*p.Ru),p.applyForce(o),p.inFluid=!0,p.ratioInFluid=H}(M,p),h(p._forces),h(p._impulses),h(p.DO),h(p.resting),T.scale(o,p._forces,1/p.PB),T.gu(o,o,M.gravity,p.Ru),T.scale(W,p._impulses,1/p.PB),T.gu(W,W,o,b),T.add(p.DO,p.DO,W),p.friction&&(y(M,0,p,W,b),y(M,1,p,W,b),y(M,2,p,W,b));var B=p.fluidDrag>=0?p.fluidDrag:M.fluidDrag,k=p.BH>=0?p.BH:M.BH,u=k,H=k;p.inFluid&&(u=S(p,u,p.fluidDragHoriz>=0?p.fluidDragHoriz:B),H=S(p,H,p.fluidDragVert>=0?p.fluidDragVert:B));u=Math.max(1-u*b/p.PB,0),H=Math.max(1-H*b/p.PB,0),T.set(f,u,H,u),T.multiply(p.DO,p.DO,f),T.scale(i,p.DO,b),T.set(p._forces,0,0,0),T.set(p._impulses,0,0,0),p.yu&&V(L,p.JO);T.j(K,i),T.set(D,0,0,0),p.preventFallOffEdge&&function(M,p,b,Q){if(!p.resting[1]||b[1]>0)return;var q=n;V(q,p.JO);for(var B=0;B<3;B+=2){T.set(E,0,0,0),E[B]=b[B];var k=!0;(k=(k=(k=(k=k&&!U(M,q.base[0]+E[0]+1e-5,q.base[1],q.base[2]+E[2]+1e-5))&&!U(M,q.max[0]+E[0]-1e-5,q.base[1],q.base[2]+E[2]+1e-5))&&!U(M,q.base[0]+E[0]+1e-5,q.base[1],q.max[2]+E[2]-1e-5))&&!U(M,q.max[0]+E[0]-1e-5,q.base[1],q.max[2]+E[2]-1e-5))?(Q[B]=b[B]>0?1:-1,b[B]=0):0===B&&(T.set(g,b[0],0,0),P(M,q,g,Q,p.slideOnCollision))}}(M,p,i,D);P(M,p.JO,i,p.resting,p.slideOnCollision),p.yu&&function(M,p,b,Q){if(p.resting[1]>=0&&!p.inFluid)return;var q=0!==p.resting[0],B=0!==p.resting[2];if(!q&&!B)return;var k=Math.abs(Q[0]/Q[2]),u=4;if(!q&&k>u)return;if(!B&&k<1/u)return;T.add(r,b.base,Q);var H=M.testSolid;O(H,b,Q,(function(M,p,b,Q){if(1!==p)return!0;Q[p]=0}));var F=b.base[1],o=p.inFluid?1.951:1.001,W=Math.floor(F+o)-F;T.set(Y,0,W,0);var i=!1;if(O(H,b,Y,(function(M,p,b,Q){return i=!0,!0})),i)return;T.jp(w,r,b.base),w[1]=0,P(M,b,w,N,!0);var A=d(b.base[0],r[0]),j=d(b.base[2],r[2]);if(q&&!A&&(!j||!B))return;if(B&&(!A||!q)&&!j)return;var K=!0;if(K=K&&!U(M,b.base[0]+1e-5,b.base[1],b.base[2]+1e-5),K=K&&!U(M,b.max[0]-1e-5,b.base[1],b.base[2]+1e-5),K=K&&!U(M,b.base[0]+1e-5,b.base[1],b.max[2]-1e-5),K=K&&!U(M,b.max[0]-1e-5,b.base[1],b.max[2]-1e-5),K)return;V(p.JO,b),p.resting[0]=N[0],p.resting[2]=N[2],p.Fi&&p.Fi()}(M,p,L,K);for(var F=0;F<3;++F)p.resting[F]=p.resting[F]||D[F],A[F]=0,p.resting[F]&&(j[F]||(A[F]=-p.DO[F]),p.DO[F]=0);var a=T.length(A);a>.001&&(T.scale(A,A,p.PB),p.RW&&p.RW(A),p.restitution>0&&a>M.minBounceImpulse&&(T.scale(A,A,p.restitution),p.applyImpulse(A)));var x=T.squaredLength(p.DO);x>1e-5&&p.SO();M.vo&&M.vo(p)?(p.loadFromCopy(s),p.rolledBackLastTick=!0):p.rolledBackLastTick=!1}(this,b,M,p)))};var f=T.create([0,0,0]);var R=T.create();function y(M,p,b,Q,q){var B=b.resting[p],k=Q[p];if(!b.alwaysApplyHorizFriction||1!==p){if(0===B)return;if(B*k<=0)return}T.j(x,b.DO),x[p]=0;var u=T.length(x);if(!d(u,0)){var O=Math.abs(b.friction*M.gravity[p]*q),H=u>O?(u-O)/u:0;b.DO[(p+1)%3]*=H,b.DO[(p+2)%3]*=H}}var x=T.create();function P(M,p,b,Q,q){return T.set(Q,0,0,0),O(M.testSolid,p,b,(function(M,p,b,B){Q[p]=b,B[p]=0,q||(B[0]=0,B[1]=0,B[2]=0)}))}var L=new u([],[]),N=T.create(),r=T.create(),Y=T.create(),w=T.create();var E=T.create(),n=new u([],[]),g=T.create();function U(M,p,b,Q){return M.testSolid(Math.floor(p),Math.floor(b-1),Math.floor(Q))}var c=T.create();function d(M,p){return Math.abs(M-p)<1e-5}function V(M,p){for(var b=0;b<3;b++)M.base[b]=p.base[b],M.max[b]=p.max[b],M.kH[b]=p.kH[b]}var h=function(M){}},12472:function(M,p){!function(M){"use strict";var p=function(M,b){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,p){M.__proto__=p}||function(M,p){for(var b in p)Object.prototype.hasOwnProperty.call(p,b)&&(M[b]=p[b])},p(M,b)};function b(M,b){if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function Q(){this.constructor=M}p(M,b),M.prototype=null===b?Object.create(b):(Q.prototype=b.prototype,new Q)}function Q(M,p,b,Q){var q,B=arguments.length,k=B<3?p:null===Q?Q=Object.getOwnPropertyDescriptor(p,b):Q;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)k=Reflect.decorate(M,p,b,Q);else for(var u=M.length-1;u>=0;u--)(q=M[u])&&(k=(B<3?q(k):B>3?q(p,b,k):q(p,b))||k);return B>3&&k&&Object.defineProperty(p,b,k),k}function q(M,p,b){if(b||2===arguments.length)for(var Q,q=0,B=p.length;q<B;q++)!Q&&q in p||(Q||(Q=Array.prototype.slice.call(p,0,q)),Q[q]=p[q]);return M.concat(Q||Array.prototype.slice.call(p))}var B,k=255,u=213;M.OPERATION=void 0,(B=M.OPERATION||(M.OPERATION={}))[B.ADD=128]="ADD",B[B.REPLACE=0]="REPLACE",B[B.DELETE=64]="DELETE",B[B.DELETE_AND_ADD=192]="DELETE_AND_ADD",B[B.TOUCH=1]="TOUCH",B[B.CLEAR=10]="CLEAR";var T=function(){function p(M,p,b){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=M,this.setParent(p,b)}return p.prototype.setParent=function(M,p,b){var Q=this;if(this.indexes||(this.indexes=this.ref instanceof wM?this.ref._definition.indexes:{}),this.parent=M,this.parentIndex=b,p)if(this.root=p,this.ref instanceof wM){var q=this.ref._definition;for(var B in q.schema){var k=this.ref[B];if(k&&k.$changes){var u=q.indexes[B];k.$changes.setParent(this.ref,p,u)}}}else"object"===typeof this.ref&&this.ref.forEach((function(M,p){if(M instanceof wM){var b=M.$changes,q=Q.ref.$changes.indexes[p];b.setParent(Q.ref,Q.root,q)}}))},p.prototype.operation=function(M){this.changes.set(--this.currentCustomOperation,M)},p.prototype.change=function(p,b){void 0===b&&(b=M.OPERATION.ADD);var Q="number"===typeof p?p:this.indexes[p];this.assertValidIndex(Q,p);var q=this.changes.get(Q);q&&q.op!==M.OPERATION.DELETE&&q.op!==M.OPERATION.TOUCH||this.changes.set(Q,{op:q&&q.op===M.OPERATION.DELETE?M.OPERATION.DELETE_AND_ADD:b,index:Q}),this.allChanges.add(Q),this.changed=!0,this.touchParents()},p.prototype.touch=function(p){var b="number"===typeof p?p:this.indexes[p];this.assertValidIndex(b,p),this.changes.has(b)||this.changes.set(b,{op:M.OPERATION.TOUCH,index:b}),this.allChanges.add(b),this.touchParents()},p.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},p.prototype.getType=function(M){if(this.ref._definition)return(p=this.ref._definition).schema[p.fieldsByIndex[M]];var p,b=(p=this.parent._definition).schema[p.fieldsByIndex[this.parentIndex]];return Object.values(b)[0]},p.prototype.getChildrenFilter=function(){var M=this.parent._definition.childFilters;return M&&M[this.parentIndex]},p.prototype.getValue=function(M){return this.ref.getByIndex(M)},p.prototype.delete=function(p){var b="number"===typeof p?p:this.indexes[p];if(void 0!==b){var Q=this.getValue(b);this.changes.set(b,{op:M.OPERATION.DELETE,index:b}),this.allChanges.delete(b),delete this.caches[b],Q&&Q.$changes&&(Q.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(p," (").concat(b,")"))},p.prototype.discard=function(p,b){var Q=this;void 0===p&&(p=!1),void 0===b&&(b=!1),this.ref instanceof wM||this.changes.forEach((function(p){if(p.op===M.OPERATION.DELETE){var b=Q.ref.getIndex(p.index);delete Q.indexes[b]}})),this.changes.clear(),this.changed=p,b&&this.allChanges.clear(),this.currentCustomOperation=0},p.prototype.discardAll=function(){var M=this;this.changes.forEach((function(p){var b=M.getValue(p.index);b&&b.$changes&&b.$changes.discardAll()})),this.discard()},p.prototype.cache=function(M,p){this.caches[M]=p},p.prototype.clone=function(){return new p(this.ref,this.parent,this.root)},p.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},p.prototype.assertValidIndex=function(M,p){if(void 0===M)throw new Error('ChangeTree: missing index for field "'.concat(p,'"'))},p}();function O(M,p,b,Q){return M[p]||(M[p]=[]),M[p].push(b),null===Q||void 0===Q||Q.forEach((function(M,p){return b(M,p)})),function(){return F(M[p],M[p].indexOf(b))}}function H(p){var b=this,Q="string"!==typeof this.$changes.getType();this.$items.forEach((function(q,B){p.push({refId:b.$changes.refId,op:M.OPERATION.DELETE,field:B,value:void 0,previousValue:q}),Q&&b.$changes.root.removeRef(q.$changes.refId)}))}function F(M,p){if(-1===p||p>=M.length)return!1;for(var b=M.length-1,Q=p;Q<b;Q++)M[Q]=M[Q+1];return M.length=b,!0}var o=function(M,p){var b=M.toString(),Q=p.toString();return b<Q?-1:b>Q?1:0};function W(M){return M.$proxy=!0,M=new Proxy(M,{get:function(M,p){return"symbol"===typeof p||isNaN(p)?M[p]:M.at(p)},set:function(M,p,b){if("symbol"===typeof p||isNaN(p))M[p]=b;else{var Q=Array.from(M.$items.keys()),q=parseInt(Q[p]||p);void 0===b||null===b?M.deleteAt(q):M.setAt(q,b)}return!0},deleteProperty:function(M,p){return"number"===typeof p?M.deleteAt(p):delete M[p],!0}})}var i=function(){function p(){for(var M=[],p=0;p<arguments.length;p++)M[p]=arguments[p];this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,M)}return p.prototype.vu=function(p,b){return void 0===b&&(b=!0),O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,p,b?this.$items:void 0)},p.prototype.ip=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,p)},p.is=function(M){return Array.isArray(M)||void 0!==M.array},Object.defineProperty(p.prototype,"length",{get:function(){return this.$items.size},set:function(M){0===M?this.clear():this.splice(M,this.length-M)},enumerable:!1,configurable:!0}),p.prototype.push=function(){for(var M,p=this,b=[],Q=0;Q<arguments.length;Q++)b[Q]=arguments[Q];return b.forEach((function(b){M=p.$refId++,p.setAt(M,b)})),M},p.prototype.pop=function(){var M=Array.from(this.$indexes.values()).pop();if(void 0!==M){this.$changes.delete(M),this.$indexes.delete(M);var p=this.$items.get(M);return this.$items.delete(M),p}},p.prototype.at=function(M){var p=Array.from(this.$items.keys())[M];return this.$items.get(p)},p.prototype.setAt=function(p,b){var Q,q;if(void 0!==b&&null!==b){if(this.$items.get(p)!==b){void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,p);var B=null!==(q=null===(Q=this.$changes.indexes[p])||void 0===Q?void 0:Q.op)&&void 0!==q?q:M.OPERATION.ADD;this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,b),this.$changes.change(p,B)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},p.prototype.deleteAt=function(M){var p=Array.from(this.$items.keys())[M];return void 0!==p&&this.$deleteAt(p)},p.prototype.$deleteAt=function(M){return this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M)},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&H.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.concat=function(){for(var M,b=[],Q=0;Q<arguments.length;Q++)b[Q]=arguments[Q];return new(p.bind.apply(p,q([void 0],(M=Array.from(this.$items.values())).concat.apply(M,b),!1)))},p.prototype.join=function(M){return Array.from(this.$items.values()).join(M)},p.prototype.reverse=function(){var M=this,p=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(b,Q){M.setAt(p[Q],b)})),this},p.prototype.shift=function(){var M=Array.from(this.$items.keys()).shift();if(void 0!==M){var p=this.$items.get(M);return this.$deleteAt(M),p}},p.prototype.slice=function(M,b){var Q=new p;return Q.push.apply(Q,Array.from(this.$items.values()).slice(M,b)),Q},p.prototype.sort=function(M){var p=this;void 0===M&&(M=o);var b=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(M).forEach((function(M,Q){p.setAt(b[Q],M)})),this},p.prototype.splice=function(M,p){void 0===p&&(p=this.length-M);for(var b=Array.from(this.$items.keys()),Q=[],q=M;q<M+p;q++)Q.push(this.$items.get(b[q])),this.$deleteAt(b[q]);return Q},p.prototype.unshift=function(){for(var M=this,p=[],b=0;b<arguments.length;b++)p[b]=arguments[b];var Q=this.length,q=p.length,B=Array.from(this.$items.values());return p.forEach((function(p,b){M.setAt(b,p)})),B.forEach((function(p,b){M.setAt(q+b,p)})),Q+q},p.prototype.indexOf=function(M,p){return Array.from(this.$items.values()).indexOf(M,p)},p.prototype.lastIndexOf=function(M,p){return void 0===p&&(p=this.length-1),Array.from(this.$items.values()).lastIndexOf(M,p)},p.prototype.every=function(M,p){return Array.from(this.$items.values()).every(M,p)},p.prototype.some=function(M,p){return Array.from(this.$items.values()).some(M,p)},p.prototype.forEach=function(M,p){Array.from(this.$items.values()).forEach(M,p)},p.prototype.map=function(M,p){return Array.from(this.$items.values()).map(M,p)},p.prototype.filter=function(M,p){return Array.from(this.$items.values()).filter(M,p)},p.prototype.reduce=function(M,p){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},p.prototype.reduceRight=function(M,p){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},p.prototype.find=function(M,p){return Array.from(this.$items.values()).find(M,p)},p.prototype.findIndex=function(M,p){return Array.from(this.$items.values()).findIndex(M,p)},p.prototype.fill=function(M,p,b){throw new Error("ArraySchema#fill() not implemented")},p.prototype.copyWithin=function(M,p,b){throw new Error("ArraySchema#copyWithin() not implemented")},p.prototype.toString=function(){return this.$items.toString()},p.prototype.toLocaleString=function(){return this.$items.toLocaleString()},p.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(p,Symbol.species,{get:function(){return p},enumerable:!1,configurable:!0}),p.prototype.entries=function(){return this.$items.entries()},p.prototype.keys=function(){return this.$items.keys()},p.prototype.values=function(){return this.$items.values()},p.prototype.includes=function(M,p){return Array.from(this.$items.values()).includes(M,p)},p.prototype.flatMap=function(M,p){throw new Error("ArraySchema#flatMap() is not supported.")},p.prototype.flat=function(M){throw new Error("ArraySchema#flat() is not supported.")},p.prototype.findLast=function(){var M=Array.from(this.$items.values());return M.findLast.apply(M,arguments)},p.prototype.findLastIndex=function(){var M=Array.from(this.$items.values());return M.findLastIndex.apply(M,arguments)},p.prototype.setIndex=function(M,p){this.$indexes.set(M,p)},p.prototype.getIndex=function(M){return this.$indexes.get(M)},p.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},p.prototype.deleteByIndex=function(M){var p=this.$indexes.get(M);this.$items.delete(p),this.$indexes.delete(M)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){return this.toArray().map((function(M){return"function"===typeof M.toJSON?M.toJSON():M}))},p.prototype.clone=function(M){return M?new(p.bind.apply(p,q([void 0],Array.from(this.$items.values()),!1))):new(p.bind.apply(p,q([void 0],this.map((function(M){return M.$changes?M.clone():M})),!1)))},p}();function A(M){return M.$proxy=!0,M=new Proxy(M,{get:function(M,p){return"symbol"!==typeof p&&"undefined"===typeof M[p]?M.get(p):M[p]},set:function(M,p,b){return"symbol"!==typeof p&&-1===p.indexOf("$")&&"vu"!==p&&"ip"!==p&&"onChange"!==p?M.set(p,b):M[p]=b,!0},deleteProperty:function(M,p){return M.delete(p),!0}})}var j=function(){function p(M){var b=this;if(this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M)if(M instanceof Map||M instanceof p)M.forEach((function(M,p){return b.set(p,M)}));else for(var Q in M)this.set(Q,M[Q])}return p.prototype.vu=function(p,b){return void 0===b&&(b=!0),O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,p,b?this.$items:void 0)},p.prototype.ip=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,p)},p.is=function(M){return void 0!==M.map},p.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(p.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(p,Symbol.species,{get:function(){return p},enumerable:!1,configurable:!0}),p.prototype.set=function(p,b){if(void 0===b||null===b)throw new Error("MapSchema#set('".concat(p,"', ").concat(b,"): trying to set ").concat(b," value on '").concat(p,"'."));p=p.toString();var Q="undefined"!==typeof this.$changes.indexes[p],q=Q?this.$changes.indexes[p]:this.$refId++,B=Q?M.OPERATION.REPLACE:M.OPERATION.ADD,k=void 0!==b.$changes;if(k&&b.$changes.setParent(this,this.$changes.root,q),Q){if(!k&&this.$items.get(p)===b)return;k&&this.$items.get(p)!==b&&(B=M.OPERATION.ADD)}else this.$changes.indexes[p]=q,this.$indexes.set(q,p);return this.$items.set(p,b),this.$changes.change(p,B),this},p.prototype.get=function(M){return this.$items.get(M)},p.prototype.delete=function(M){return this.$changes.delete(M),this.$items.delete(M)},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&H.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(M){return this.$items.has(M)},p.prototype.forEach=function(M){this.$items.forEach(M)},p.prototype.entries=function(){return this.$items.entries()},p.prototype.keys=function(){return this.$items.keys()},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(M,p){this.$indexes.set(M,p)},p.prototype.getIndex=function(M){return this.$indexes.get(M)},p.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},p.prototype.deleteByIndex=function(M){var p=this.$indexes.get(M);this.$items.delete(p),this.$indexes.delete(M)},p.prototype.toJSON=function(){var M={};return this.forEach((function(p,b){M[b]="function"===typeof p.toJSON?p.toJSON():p})),M},p.prototype.clone=function(M){var b;return M?b=Object.assign(new p,this):(b=new p,this.forEach((function(M,p){M.$changes?b.set(p,M.clone()):b.set(p,M)}))),b},p}(),K={};function D(M,p){K[M]=p}function a(M){return K[M]}var s=function(){function M(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return M.create=function(p){var b=new M;return b.schema=Object.assign({},p&&p.schema||{}),b.indexes=Object.assign({},p&&p.indexes||{}),b.fieldsByIndex=Object.assign({},p&&p.fieldsByIndex||{}),b.descriptors=Object.assign({},p&&p.descriptors||{}),b.deprecated=Object.assign({},p&&p.deprecated||{}),b},M.prototype.addField=function(M,p){var b=this.getNextFieldIndex();this.fieldsByIndex[b]=M,this.indexes[M]=b,this.schema[M]=Array.isArray(p)?{array:p[0]}:p},M.prototype.hasField=function(M){return void 0!==this.indexes[M]},M.prototype.addFilter=function(M,p){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[M]]=p,this.indexesWithFilters.push(this.indexes[M]),!0},M.prototype.addChildrenFilter=function(M,p){var b=this.indexes[M],Q=this.schema[M];if(a(Object.keys(Q)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[b]=p,!0;console.warn("@filterChildren: field '".concat(M,"' can't have children. Ignoring filter."))},M.prototype.getChildrenFilter=function(M){return this.childFilters&&this.childFilters[this.indexes[M]]},M.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},M}();function S(M){return M._context&&M._context.useFilters}var f=function(){function M(){this.types={},this.schemas=new Map,this.useFilters=!1}return M.prototype.has=function(M){return this.schemas.has(M)},M.prototype.get=function(M){return this.types[M]},M.prototype.add=function(M,p){void 0===p&&(p=this.schemas.size),M._definition=s.create(M._definition),M._typeid=p,this.types[p]=M,this.schemas.set(M,p)},M.create=function(p){return void 0===p&&(p={}),function(b){return p.context||(p.context=new M),y(b,p)}},M}(),R=new f;function y(M,p){return void 0===p&&(p={}),function(b,Q){var B=p.context||R,k=b.constructor;if(k._context=B,!M)throw new Error("".concat(k.name,': @type() reference provided for "').concat(Q,"\" is undefined. Make sure you don't have any circular dependencies."));B.has(k)||B.add(k);var u=k._definition;if(u.addField(Q,M),u.descriptors[Q]){if(u.deprecated[Q])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(Q,"' definition on '").concat(k.name,"'.\nCheck @type() annotation"))}catch(K){var T=K.stack.split("\n")[4].trim();throw new Error("".concat(K.message," ").concat(T))}}var O=i.is(M),H=!O&&j.is(M);if("string"!==typeof M&&!wM.is(M)){var F=Object.values(M)[0];"string"===typeof F||B.has(F)||B.add(F)}if(p.manual)u.descriptors[Q]={enumerable:!0,configurable:!0,writable:!0};else{var o="_".concat(Q);u.descriptors[o]={enumerable:!1,configurable:!1,writable:!0},u.descriptors[Q]={get:function(){return this[o]},set:function(M){M!==this[o]&&(void 0!==M&&null!==M?(!O||M instanceof i||(M=new(i.bind.apply(i,q([void 0],M,!1)))),!H||M instanceof j||(M=new j(M)),void 0===M.$proxy&&(H?M=A(M):O&&(M=W(M))),this.$changes.change(Q),M.$changes&&M.$changes.setParent(this,this.$changes.root,this._definition.indexes[Q])):this[o]&&this.$changes.delete(Q),this[o]=M)},enumerable:!0,configurable:!0}}}}function x(M){return function(p,b){var Q=p.constructor;Q._definition.addFilter(b,M)&&(Q._context.useFilters=!0)}}function P(M){return function(p,b){var Q=p.constructor;Q._definition.addChildrenFilter(b,M)&&(Q._context.useFilters=!0)}}function L(M){return void 0===M&&(M=!0),function(p,b){var Q=p.constructor._definition;Q.deprecated[b]=!0,M&&(Q.descriptors[b]={get:function(){throw new Error("".concat(b," is deprecated."))},set:function(M){},enumerable:!1,configurable:!0})}}function N(M,p,b){for(var Q in void 0===b&&(b={}),b.context||(b.context=M._context||b.context||R),p)y(p[Q],b)(M.prototype,Q);return M}function r(M){for(var p=0,b=0,Q=0,q=M.length;Q<q;Q++)(p=M.charCodeAt(Q))<128?b+=1:p<2048?b+=2:p<55296||p>=57344?b+=3:(Q++,b+=4);return b}function Y(M,p,b){for(var Q=0,q=0,B=b.length;q<B;q++)(Q=b.charCodeAt(q))<128?M[p++]=Q:Q<2048?(M[p++]=192|Q>>6,M[p++]=128|63&Q):Q<55296||Q>=57344?(M[p++]=224|Q>>12,M[p++]=128|Q>>6&63,M[p++]=128|63&Q):(q++,Q=65536+((1023&Q)<<10|1023&b.charCodeAt(q)),M[p++]=240|Q>>18,M[p++]=128|Q>>12&63,M[p++]=128|Q>>6&63,M[p++]=128|63&Q)}function w(M,p){M.push(255&p)}function E(M,p){M.push(255&p)}function n(M,p){M.push(255&p),M.push(p>>8&255)}function g(M,p){M.push(255&p),M.push(p>>8&255)}function U(M,p){M.push(255&p),M.push(p>>8&255),M.push(p>>16&255),M.push(p>>24&255)}function c(M,p){var b=p>>24,Q=p>>16,q=p>>8,B=p;M.push(255&B),M.push(255&q),M.push(255&Q),M.push(255&b)}function d(M,p){var b=Math.floor(p/Math.pow(2,32));c(M,p>>>0),c(M,b)}function V(M,p){var b=p/Math.pow(2,32)|0;c(M,p>>>0),c(M,b)}function h(M,p){z(M,p)}function I(M,p){t(M,p)}var Z=new Int32Array(2),J=new Float32Array(Z.buffer),v=new Float64Array(Z.buffer);function z(M,p){J[0]=p,U(M,Z[0])}function t(M,p){v[0]=p,U(M,Z[0]),U(M,Z[1])}function e(M,p){return E(M,p?1:0)}function G(M,p){p||(p="");var b=r(p),Q=0;if(b<32)M.push(160|b),Q=1;else if(b<256)M.push(217),E(M,b),Q=2;else if(b<65536)M.push(218),g(M,b),Q=3;else{if(!(b<4294967296))throw new Error("String too long");M.push(219),c(M,b),Q=5}return Y(M,M.length,p),Q+b}function mM(M,p){return isNaN(p)?mM(M,0):isFinite(p)?p!==(0|p)?(M.push(203),t(M,p),9):p>=0?p<128?(E(M,p),1):p<256?(M.push(204),E(M,p),2):p<65536?(M.push(205),g(M,p),3):p<4294967296?(M.push(206),c(M,p),5):(M.push(207),V(M,p),9):p>=-32?(M.push(224|p+32),1):p>=-128?(M.push(208),w(M,p),2):p>=-32768?(M.push(209),n(M,p),3):p>=-2147483648?(M.push(210),U(M,p),5):(M.push(211),d(M,p),9):mM(M,p>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var C=Object.freeze({__proto__:null,utf8Write:Y,int8:w,uint8:E,int16:n,uint16:g,int32:U,uint32:c,int64:d,uint64:V,float32:h,float64:I,writeFloat32:z,writeFloat64:t,boolean:e,string:G,number:mM});function X(M,p,b){for(var Q="",q=0,B=p,k=p+b;B<k;B++){var u=M[B];0!==(128&u)?192!==(224&u)?224!==(240&u)?240!==(248&u)?console.error("Invalid byte "+u.toString(16)):(q=(7&u)<<18|(63&M[++B])<<12|(63&M[++B])<<6|63&M[++B])>=65536?(q-=65536,Q+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):Q+=String.fromCharCode(q):Q+=String.fromCharCode((15&u)<<12|(63&M[++B])<<6|63&M[++B]):Q+=String.fromCharCode((31&u)<<6|63&M[++B]):Q+=String.fromCharCode(u)}return Q}function l(M,p){return MM(M,p)<<24>>24}function MM(M,p){return M[p.offset++]}function pM(M,p){return bM(M,p)<<16>>16}function bM(M,p){return M[p.offset++]|M[p.offset++]<<8}function QM(M,p){return M[p.offset++]|M[p.offset++]<<8|M[p.offset++]<<16|M[p.offset++]<<24}function qM(M,p){return QM(M,p)>>>0}function BM(M,p){return oM(M,p)}function kM(M,p){return WM(M,p)}function uM(M,p){var b=qM(M,p);return QM(M,p)*Math.pow(2,32)+b}function TM(M,p){var b=qM(M,p);return qM(M,p)*Math.pow(2,32)+b}var OM=new Int32Array(2),HM=new Float32Array(OM.buffer),FM=new Float64Array(OM.buffer);function oM(M,p){return OM[0]=QM(M,p),HM[0]}function WM(M,p){return OM[0]=QM(M,p),OM[1]=QM(M,p),FM[0]}function iM(M,p){return MM(M,p)>0}function AM(M,p){var b,Q=M[p.offset++];Q<192?b=31&Q:217===Q?b=MM(M,p):218===Q?b=bM(M,p):219===Q&&(b=qM(M,p));var q=X(M,p.offset,b);return p.offset+=b,q}function jM(M,p){var b=M[p.offset];return b<192&&b>160||217===b||218===b||219===b}function KM(M,p){var b=M[p.offset++];return b<128?b:202===b?oM(M,p):203===b?WM(M,p):204===b?MM(M,p):205===b?bM(M,p):206===b?qM(M,p):207===b?TM(M,p):208===b?l(M,p):209===b?pM(M,p):210===b?QM(M,p):211===b?uM(M,p):b>223?-1*(255-b+1):void 0}function DM(M,p){var b=M[p.offset];return b<128||b>=202&&b<=211}function aM(M,p){return M[p.offset]<160}function sM(M,p){return M[p.offset-1]===k&&(M[p.offset]<128||M[p.offset]>=202&&M[p.offset]<=211)}var SM=Object.freeze({__proto__:null,int8:l,uint8:MM,int16:pM,uint16:bM,int32:QM,uint32:qM,float32:BM,float64:kM,int64:uM,uint64:TM,readFloat32:oM,readFloat64:WM,boolean:iM,string:AM,stringCheck:jM,number:KM,numberCheck:DM,arrayCheck:aM,switchStructureCheck:sM}),fM=function(){function p(M){var p=this;this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M&&M.forEach((function(M){return p.add(M)}))}return p.prototype.vu=function(p,b){return void 0===b&&(b=!0),O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,p,b?this.$items:void 0)},p.prototype.ip=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,p)},p.is=function(M){return void 0!==M.collection},p.prototype.add=function(M){var p=this.$refId++;return void 0!==M.$changes&&M.$changes.setParent(this,this.$changes.root,p),this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,M),this.$changes.change(p),p},p.prototype.at=function(M){var p=Array.from(this.$items.keys())[M];return this.$items.get(p)},p.prototype.entries=function(){return this.$items.entries()},p.prototype.delete=function(M){for(var p,b,Q=this.$items.entries();(b=Q.next())&&!b.done;)if(M===b.value[1]){p=b.value[0];break}return void 0!==p&&(this.$changes.delete(p),this.$indexes.delete(p),this.$items.delete(p))},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&H.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(M){return Array.from(this.$items.values()).some((function(p){return p===M}))},p.prototype.forEach=function(M){var p=this;this.$items.forEach((function(b,Q,q){return M(b,Q,p)}))},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(M,p){this.$indexes.set(M,p)},p.prototype.getIndex=function(M){return this.$indexes.get(M)},p.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},p.prototype.deleteByIndex=function(M){var p=this.$indexes.get(M);this.$items.delete(p),this.$indexes.delete(M)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){var M=[];return this.forEach((function(p,b){M.push("function"===typeof p.toJSON?p.toJSON():p)})),M},p.prototype.clone=function(M){var b;return M?b=Object.assign(new p,this):(b=new p,this.forEach((function(M){M.$changes?b.add(M.clone()):b.add(M)}))),b},p}(),RM=function(){function p(M){var p=this;this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M&&M.forEach((function(M){return p.add(M)}))}return p.prototype.vu=function(p,b){return void 0===b&&(b=!0),O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,p,b?this.$items:void 0)},p.prototype.ip=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,p)},p.is=function(M){return void 0!==M.set},p.prototype.add=function(p){var b,Q;if(this.has(p))return!1;var q=this.$refId++;void 0!==p.$changes&&p.$changes.setParent(this,this.$changes.root,q);var B=null!==(Q=null===(b=this.$changes.indexes[q])||void 0===b?void 0:b.op)&&void 0!==Q?Q:M.OPERATION.ADD;return this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,p),this.$changes.change(q,B),q},p.prototype.entries=function(){return this.$items.entries()},p.prototype.delete=function(M){for(var p,b,Q=this.$items.entries();(b=Q.next())&&!b.done;)if(M===b.value[1]){p=b.value[0];break}return void 0!==p&&(this.$changes.delete(p),this.$indexes.delete(p),this.$items.delete(p))},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&H.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(M){for(var p,b=this.$items.values(),Q=!1;(p=b.next())&&!p.done;)if(M===p.value){Q=!0;break}return Q},p.prototype.forEach=function(M){var p=this;this.$items.forEach((function(b,Q,q){return M(b,Q,p)}))},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(M,p){this.$indexes.set(M,p)},p.prototype.getIndex=function(M){return this.$indexes.get(M)},p.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},p.prototype.deleteByIndex=function(M){var p=this.$indexes.get(M);this.$items.delete(p),this.$indexes.delete(M)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){var M=[];return this.forEach((function(p,b){M.push("function"===typeof p.toJSON?p.toJSON():p)})),M},p.prototype.clone=function(M){var b;return M?b=Object.assign(new p,this):(b=new p,this.forEach((function(M){M.$changes?b.add(M.clone()):b.add(M)}))),b},p}(),yM=function(){function M(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return M.prototype.addRefId=function(M){this.refIds.has(M)||(this.refIds.add(M),this.containerIndexes.set(M,new Set))},M.get=function(p){return void 0===p.$filterState&&(p.$filterState=new M),p.$filterState},M}(),xM=function(){function M(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return M.prototype.getNextUniqueId=function(){return this.nextUniqueId++},M.prototype.addRef=function(M,p,b){void 0===b&&(b=!0),this.refs.set(M,p),b&&(this.refCounts[M]=(this.refCounts[M]||0)+1)},M.prototype.removeRef=function(M){this.refCounts[M]=this.refCounts[M]-1,this.deletedRefs.add(M)},M.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},M.prototype.garbageCollectDeletedRefs=function(){var M=this;this.deletedRefs.forEach((function(p){if(!(M.refCounts[p]>0)){var b=M.refs.get(p);if(b instanceof wM)for(var Q in b._definition.schema)"string"!==typeof b._definition.schema[Q]&&b[Q]&&b[Q].$changes&&M.removeRef(b[Q].$changes.refId);else{var q=b.$changes.parent._definition,B=q.schema[q.fieldsByIndex[b.$changes.parentIndex]];"function"===typeof Object.values(B)[0]&&Array.from(b.values()).forEach((function(p){return M.removeRef(p.$changes.refId)}))}M.refs.delete(p),delete M.refCounts[p]}})),this.deletedRefs.clear()},M}(),PM=function(M){function p(){return null!==M&&M.apply(this,arguments)||this}return b(p,M),p}(Error);function LM(M,p,b,Q){var q,B=!1;switch(p){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":q="number",isNaN(M)&&console.log('trying to encode "NaN" in '.concat(b.constructor.name,"#").concat(Q));break;case"string":q="string",B=!0;break;case"boolean":return}if(typeof M!==q&&(!B||B&&null!==M)){var k="'".concat(JSON.stringify(M),"'").concat(M&&M.constructor&&" (".concat(M.constructor.name,")")||"");throw new PM("a '".concat(q,"' was expected, but ").concat(k," was provided in ").concat(b.constructor.name,"#").concat(Q))}}function NM(M,p,b,Q){if(!(M instanceof p))throw new PM("a '".concat(p.name,"' was expected, but '").concat(M.constructor.name,"' was provided in ").concat(b.constructor.name,"#").concat(Q))}function rM(M,p,b,Q,q){LM(b,M,Q,q);var B=C[M];if(!B)throw new PM("a '".concat(M,"' was expected, but ").concat(b," was provided in ").concat(Q.constructor.name,"#").concat(q));B(p,b)}function YM(M,p,b){return SM[M](p,b)}var wM=function(){function p(){for(var M=[],p=0;p<arguments.length;p++)M[p]=arguments[p];Object.defineProperties(this,{$changes:{value:new T(this,void 0,new xM),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var b=this._definition.descriptors;b&&Object.defineProperties(this,b),M[0]&&this.assign(M[0])}return p.onError=function(M){console.error(M)},p.is=function(M){return M._definition&&void 0!==M._definition.schema},p.prototype.onChange=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,p)},p.prototype.ip=function(p){return O(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,p)},p.prototype.assign=function(M){return Object.assign(this,M),this},Object.defineProperty(p.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),p.prototype.setDirty=function(M,p){this.$changes.change(M,p)},p.prototype.listen=function(M,p,b){var Q=this;return void 0===b&&(b=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[M]||(this.$callbacks[M]=[]),this.$callbacks[M].push(p),b&&void 0!==this[M]&&p(this[M],void 0),function(){return F(Q.$callbacks[M],Q.$callbacks[M].indexOf(p))}},p.prototype.decode=function(b,Q,q){var B;void 0===Q&&(Q={offset:0}),void 0===q&&(q=this);var u=[],T=this.$changes.root,O=b.length,H=0;for(T.refs.set(H,this);Q.offset<O;){var F=b[Q.offset++];if(F!=k){var o=q.$changes,W=void 0!==q._definition,A=W?F>>6<<6:F;if(A!==M.OPERATION.CLEAR){var K=W?F%(A||255):KM(b,Q),D=W?q._definition.fieldsByIndex[K]:"",s=o.getType(K),S=void 0,f=void 0,R=void 0;if(W?f=q["_".concat(D)]:(f=q.getByIndex(K),(A&M.OPERATION.ADD)===M.OPERATION.ADD?(R=q instanceof j?AM(b,Q):K,q.setIndex(K,R)):R=q.getIndex(K)),(A&M.OPERATION.DELETE)===M.OPERATION.DELETE&&(A!==M.OPERATION.DELETE_AND_ADD&&q.deleteByIndex(K),f&&f.$changes&&T.removeRef(f.$changes.refId),S=null),void 0!==D){if(A===M.OPERATION.DELETE);else if(p.is(s)){var y=KM(b,Q);if(S=T.refs.get(y),A!==M.OPERATION.REPLACE){var x=this.getSchemaType(b,Q,s);S||((S=this.createTypeInstance(x)).$changes.refId=y,f&&(S.$callbacks=f.$callbacks,f.$changes.refId&&y!==f.$changes.refId&&T.removeRef(f.$changes.refId))),T.addRef(y,S,S!==f)}}else if("string"===typeof s)S=YM(s,b,Q);else{var P=a(Object.keys(s)[0]),L=KM(b,Q),N=T.refs.has(L)?f||T.refs.get(L):new P.constructor;if((S=N.clone(!0)).$changes.refId=L,f&&(S.$callbacks=f.$callbacks,f.$changes.refId&&L!==f.$changes.refId)){T.removeRef(f.$changes.refId);for(var r=f.entries(),Y=void 0;(Y=r.next())&&!Y.done;){var w=(B=Y.value)[0],E=B[1];u.push({refId:L,op:M.OPERATION.DELETE,field:w,value:void 0,previousValue:E})}}T.addRef(L,S,N!==f)}if(null!==S&&void 0!==S)if(S.$changes&&S.$changes.setParent(o.ref,o.root,K),q instanceof p)q[D]=S;else if(q instanceof j)w=R,q.$items.set(w,S),q.$changes.allChanges.add(K);else if(q instanceof i)q.setAt(K,S);else if(q instanceof fM){var n=q.add(S);q.setIndex(K,n)}else q instanceof RM&&!1!==(n=q.add(S))&&q.setIndex(K,n);f!==S&&u.push({refId:H,op:A,field:D,dynamicIndex:R,value:S,previousValue:f})}else{console.warn("@colyseus/schema: definition mismatch");for(var g={offset:Q.offset};Q.offset<O&&(!sM(b,Q)||(g.offset=Q.offset+1,!T.refs.has(KM(b,g))));)Q.offset++}}else q.clear(u)}else{H=KM(b,Q);var U=T.refs.get(H);if(!U)throw new Error('"refId" not found: '.concat(H));q=U}}return this._triggerChanges(u),T.garbageCollectDeletedRefs(),u},p.prototype.encode=function(b,Q,q){void 0===b&&(b=!1),void 0===Q&&(Q=[]),void 0===q&&(q=!1);for(var B=this.$changes,u=new WeakSet,T=[B],O=1,H=0;H<O;H++){var F=T[H],o=F.ref,W=o instanceof p;F.ensureRefId(),u.add(F),F!==B&&(F.changed||b)&&(E(Q,k),mM(Q,F.refId));for(var i=b?Array.from(F.allChanges):Array.from(F.changes.values()),A=0,K=i.length;A<K;A++){var D=b?{op:M.OPERATION.ADD,index:i[A]}:i[A],s=D.index,S=W?o._definition.fieldsByIndex&&o._definition.fieldsByIndex[s]:s,f=Q.length;if(D.op!==M.OPERATION.TOUCH)if(W)E(Q,s|D.op);else{if(E(Q,D.op),D.op===M.OPERATION.CLEAR)continue;mM(Q,s)}if(W||(D.op&M.OPERATION.ADD)!=M.OPERATION.ADD||o instanceof j&&G(Q,F.ref.$indexes.get(s)),D.op!==M.OPERATION.DELETE){var R=F.getType(s),y=F.getValue(s);if(y&&y.$changes&&!u.has(y.$changes)&&(T.push(y.$changes),y.$changes.ensureRefId(),O++),D.op!==M.OPERATION.TOUCH){if(p.is(R))NM(y,R,o,S),mM(Q,y.$changes.refId),(D.op&M.OPERATION.ADD)===M.OPERATION.ADD&&this.tryEncodeTypeId(Q,R,y.constructor);else if("string"===typeof R)rM(R,Q,y,o,S);else{var x=a(Object.keys(R)[0]);NM(o["_".concat(S)],x.constructor,o,S),mM(Q,y.$changes.refId)}q&&F.cache(s,Q.slice(f))}}}b||q||F.discard()}return Q},p.prototype.encodeAll=function(M){return this.encode(!0,[],M)},p.prototype.applyFilters=function(b,Q){var q,B;void 0===Q&&(Q=!1);for(var u=this,T=new Set,O=yM.get(b),H=[this.$changes],F=1,o=[],W=function(W){var i=H[W];if(T.has(i.refId))return"continue";var A=i.ref,K=A instanceof p;E(o,k),mM(o,i.refId);var D=O.refIds.has(i),a=Q||!D;O.addRefId(i);var s=O.containerIndexes.get(i),S=a?Array.from(i.allChanges):Array.from(i.changes.values());!Q&&K&&A._definition.indexesWithFilters&&A._definition.indexesWithFilters.forEach((function(p){!s.has(p)&&i.allChanges.has(p)&&(a?S.push(p):S.push({op:M.OPERATION.ADD,index:p}))}));for(var f=0,R=S.length;f<R;f++){var y=a?{op:M.OPERATION.ADD,index:S[f]}:S[f];if(y.op!==M.OPERATION.CLEAR){var x=y.index;if(y.op!==M.OPERATION.DELETE){var P=i.getValue(x),L=i.getType(x);if(K){if((N=A._definition.filters&&A._definition.filters[x])&&!N.call(A,b,P,u)){P&&P.$changes&&T.add(P.$changes.refId);continue}}else{var N,r=i.parent;if((N=i.getChildrenFilter())&&!N.call(r,b,A.$indexes.get(x),P,u)){P&&P.$changes&&T.add(P.$changes.refId);continue}}if(P.$changes&&(H.push(P.$changes),F++),y.op!==M.OPERATION.TOUCH)if(y.op===M.OPERATION.ADD||K)o.push.apply(o,null!==(q=i.caches[x])&&void 0!==q?q:[]),s.add(x);else if(s.has(x))o.push.apply(o,null!==(B=i.caches[x])&&void 0!==B?B:[]);else{if(s.add(x),E(o,M.OPERATION.ADD),mM(o,x),A instanceof j){var Y=i.ref.$indexes.get(x);G(o,Y)}P.$changes?mM(o,P.$changes.refId):C[L](o,P)}else P.$changes&&!K&&(E(o,M.OPERATION.ADD),mM(o,x),A instanceof j&&(Y=i.ref.$indexes.get(x),G(o,Y)),mM(o,P.$changes.refId))}else K?E(o,y.op|x):(E(o,y.op),mM(o,x))}else E(o,y.op)}},i=0;i<F;i++)W(i);return o},p.prototype.clone=function(){var M,p=new this.constructor,b=this._definition.schema;for(var Q in b)"object"===typeof this[Q]&&"function"===typeof(null===(M=this[Q])||void 0===M?void 0:M.clone)?p[Q]=this[Q].clone():p[Q]=this[Q];return p},p.prototype.toJSON=function(){var M=this._definition.schema,p=this._definition.deprecated,b={};for(var Q in M)p[Q]||null===this[Q]||"undefined"===typeof this[Q]||(b[Q]="function"===typeof this[Q].toJSON?this[Q].toJSON():this["_".concat(Q)]);return b},p.prototype.discardAllChanges=function(){this.$changes.discardAll()},p.prototype.getByIndex=function(M){return this[this._definition.fieldsByIndex[M]]},p.prototype.deleteByIndex=function(M){this[this._definition.fieldsByIndex[M]]=void 0},p.prototype.tryEncodeTypeId=function(M,p,b){p._typeid!==b._typeid&&(E(M,u),mM(M,b._typeid))},p.prototype.getSchemaType=function(M,p,b){var Q;return M[p.offset]===u&&(p.offset++,Q=this.constructor._context.get(KM(M,p))),Q||b},p.prototype.createTypeInstance=function(M){var p=new M;return p.$changes.root=this.$changes.root,p},p.prototype._triggerChanges=function(b){for(var Q,q,B,k,u,T,O,H,F,o=new Set,W=this.$changes.root.refs,i=function(i){var A=b[i],j=A.refId,K=W.get(j),D=K.$callbacks;if((A.op&M.OPERATION.DELETE)===M.OPERATION.DELETE&&A.previousValue instanceof p&&(null===(q=null===(Q=A.previousValue.$callbacks)||void 0===Q?void 0:Q[M.OPERATION.DELETE])||void 0===q||q.forEach((function(M){return M()}))),!D)return"continue";if(K instanceof p){if(!o.has(j))try{null===(B=null===D||void 0===D?void 0:D[M.OPERATION.REPLACE])||void 0===B||B.forEach((function(M){return M()}))}catch(a){p.onError(a)}try{D.hasOwnProperty(A.field)&&(null===(k=D[A.field])||void 0===k||k.forEach((function(M){return M(A.value,A.previousValue)})))}catch(a){p.onError(a)}}else A.op===M.OPERATION.ADD&&void 0===A.previousValue?null===(u=D[M.OPERATION.ADD])||void 0===u||u.forEach((function(M){var p;return M(A.value,null!==(p=A.dynamicIndex)&&void 0!==p?p:A.field)})):A.op===M.OPERATION.DELETE?void 0!==A.previousValue&&(null===(T=D[M.OPERATION.DELETE])||void 0===T||T.forEach((function(M){var p;return M(A.previousValue,null!==(p=A.dynamicIndex)&&void 0!==p?p:A.field)}))):A.op===M.OPERATION.DELETE_AND_ADD&&(void 0!==A.previousValue&&(null===(O=D[M.OPERATION.DELETE])||void 0===O||O.forEach((function(M){var p;return M(A.previousValue,null!==(p=A.dynamicIndex)&&void 0!==p?p:A.field)}))),null===(H=D[M.OPERATION.ADD])||void 0===H||H.forEach((function(M){var p;return M(A.value,null!==(p=A.dynamicIndex)&&void 0!==p?p:A.field)}))),A.value!==A.previousValue&&(null===(F=D[M.OPERATION.REPLACE])||void 0===F||F.forEach((function(M){var p;return M(A.value,null!==(p=A.dynamicIndex)&&void 0!==p?p:A.field)})));o.add(j)},A=0;A<b.length;A++)i(A)},p._definition=s.create(),p}();function EM(M){for(var p=[M.$changes],b=1,Q={},q=Q,B=function(M){var b=p[M];b.changes.forEach((function(M){var p=b.ref,Q=M.index,B=p._definition?p._definition.fieldsByIndex[Q]:p.$indexes.get(Q);q[B]=b.getValue(Q)}))},k=0;k<b;k++)B(k);return Q}var nM={context:new f},gM=function(M){function p(){return null!==M&&M.apply(this,arguments)||this}return b(p,M),Q([y("string",nM)],p.prototype,"name",void 0),Q([y("string",nM)],p.prototype,"type",void 0),Q([y("number",nM)],p.prototype,"referencedType",void 0),p}(wM),UM=function(M){function p(){var p=null!==M&&M.apply(this,arguments)||this;return p.fields=new i,p}return b(p,M),Q([y("number",nM)],p.prototype,"id",void 0),Q([y([gM],nM)],p.prototype,"fields",void 0),p}(wM),cM=function(M){function p(){var p=null!==M&&M.apply(this,arguments)||this;return p.types=new i,p}return b(p,M),p.encode=function(M){var b=M.constructor,Q=new p;Q.rootType=b._typeid;var q=function(M,p){for(var b in p){var q=new gM;q.name=b;var B=void 0;if("string"===typeof p[b])B=p[b];else{var k=p[b],u=void 0;wM.is(k)?(B="ref",u=p[b]):"string"===typeof k[B=Object.keys(k)[0]]?B+=":"+k[B]:u=k[B],q.referencedType=u?u._typeid:-1}q.type=B,M.fields.push(q)}Q.types.push(M)},B=b._context.types;for(var k in B){var u=new UM;u.id=Number(k),q(u,B[k]._definition.schema)}return Q.encodeAll()},p.decode=function(M,Q){var q=new f,B=new p;B.decode(M,Q);var k=B.types.reduce((function(M,p){var Q=function(M){function p(){return null!==M&&M.apply(this,arguments)||this}return b(p,M),p}(wM),B=p.id;return M[B]=Q,q.add(Q,B),M}),{});B.types.forEach((function(M){var p=k[M.id];M.fields.forEach((function(M){var b;if(void 0!==M.referencedType){var Q=M.type,B=k[M.referencedType];if(!B){var u=M.type.split(":");Q=u[0],B=u[1]}"ref"===Q?y(B,{context:q})(p.prototype,M.name):y(((b={})[Q]=B,b),{context:q})(p.prototype,M.name)}else y(M.type,{context:q})(p.prototype,M.name)}))}));var u=k[B.rootType],T=new u;for(var O in u._definition.schema){var H=u._definition.schema[O];"string"!==typeof H&&(T[O]="function"===typeof H?new H:new(a(Object.keys(H)[0]).constructor))}return T},Q([y([UM],nM)],p.prototype,"types",void 0),Q([y("number",nM)],p.prototype,"rootType",void 0),p}(wM);D("map",{constructor:j}),D("array",{constructor:i}),D("set",{constructor:RM}),D("collection",{constructor:fM}),M.ArraySchema=i,M.CollectionSchema=fM,M.Context=f,M.MapSchema=j,M.Reflection=cM,M.ReflectionField=gM,M.ReflectionType=UM,M.Schema=wM,M.SchemaDefinition=s,M.SetSchema=RM,M.decode=SM,M.defineTypes=N,M.deprecated=L,M.dumpChanges=EM,M.encode=C,M.filter=x,M.filterChildren=P,M.hasFilter=S,M.registerType=D,M.type=y,Object.defineProperty(M,"__esModule",{value:!0})}(p)},13853:M=>{"use strict";M.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13851:(M,p,b)=>{var Q=b(13853),q=b(13858),B=Object.hasOwnProperty,k=Object.create(null);for(var u in Q)B.call(Q,u)&&(k[Q[u]]=u);var T=M.exports={to:{},get:{}};function O(M,p,b){return Math.min(Math.max(p,M),b)}function H(M){var p=Math.round(M).toString(16).toUpperCase();return p.length<2?"0"+p:p}T.get=function(M){var p,b;switch(M.substring(0,3).toLowerCase()){case"hsl":p=T.get.hsl(M),b="hsl";break;case"hwb":p=T.get.hwb(M),b="hwb";break;default:p=T.get.rgb(M),b="rgb"}return p?{model:b,value:p}:null},T.get.rgb=function(M){if(!M)return null;var p,b,q,k=[0,0,0,1];if(p=M.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(q=p[2],p=p[1],b=0;b<3;b++){var u=2*b;k[b]=parseInt(p.slice(u,u+2),16)}q&&(k[3]=parseInt(q,16)/255)}else if(p=M.match(/^#([a-f0-9]{3,4})$/i)){for(q=(p=p[1])[3],b=0;b<3;b++)k[b]=parseInt(p[b]+p[b],16);q&&(k[3]=parseInt(q+q,16)/255)}else if(p=M.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(b=0;b<3;b++)k[b]=parseInt(p[b+1],0);p[4]&&(p[5]?k[3]=.01*parseFloat(p[4]):k[3]=parseFloat(p[4]))}else{if(!(p=M.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(p=M.match(/^(\w+)$/))?"transparent"===p[1]?[0,0,0,0]:B.call(Q,p[1])?((k=Q[p[1]])[3]=1,k):null:null;for(b=0;b<3;b++)k[b]=Math.round(2.55*parseFloat(p[b+1]));p[4]&&(p[5]?k[3]=.01*parseFloat(p[4]):k[3]=parseFloat(p[4]))}for(b=0;b<3;b++)k[b]=O(k[b],0,255);return k[3]=O(k[3],0,1),k},T.get.hsl=function(M){if(!M)return null;var p=M.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(p){var b=parseFloat(p[4]);return[(parseFloat(p[1])%360+360)%360,O(parseFloat(p[2]),0,100),O(parseFloat(p[3]),0,100),O(isNaN(b)?1:b,0,1)]}return null},T.get.hwb=function(M){if(!M)return null;var p=M.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(p){var b=parseFloat(p[4]);return[(parseFloat(p[1])%360+360)%360,O(parseFloat(p[2]),0,100),O(parseFloat(p[3]),0,100),O(isNaN(b)?1:b,0,1)]}return null},T.to.hex=function(){var M=q(arguments);return"#"+H(M[0])+H(M[1])+H(M[2])+(M[3]<1?H(Math.round(255*M[3])):"")},T.to.rgb=function(){var M=q(arguments);return M.length<4||1===M[3]?"rgb("+Math.round(M[0])+", "+Math.round(M[1])+", "+Math.round(M[2])+")":"rgba("+Math.round(M[0])+", "+Math.round(M[1])+", "+Math.round(M[2])+", "+M[3]+")"},T.to.rgb.percent=function(){var M=q(arguments),p=Math.round(M[0]/255*100),b=Math.round(M[1]/255*100),Q=Math.round(M[2]/255*100);return M.length<4||1===M[3]?"rgb("+p+"%, "+b+"%, "+Q+"%)":"rgba("+p+"%, "+b+"%, "+Q+"%, "+M[3]+")"},T.to.hsl=function(){var M=q(arguments);return M.length<4||1===M[3]?"hsl("+M[0]+", "+M[1]+"%, "+M[2]+"%)":"hsla("+M[0]+", "+M[1]+"%, "+M[2]+"%, "+M[3]+")"},T.to.hwb=function(){var M=q(arguments),p="";return M.length>=4&&1!==M[3]&&(p=", "+M[3]),"hwb("+M[0]+", "+M[1]+"%, "+M[2]+"%"+p+")"},T.to.keyword=function(M){return k[M.slice(0,3)]}},13848:(M,p,b)=>{const Q=b(13851),q=b(13866),B=["keyword","gray","hex"],k={};for(const W of Object.keys(q))k[[...q[W].labels].sort().join("")]=W;const u={};function T(M,p){if(!(this instanceof T))return new T(M,p);if(p&&p in B&&(p=null),p&&!(p in q))throw new Error("Unknown model: "+p);let b,O;if(null==M)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(M instanceof T)this.model=M.model,this.color=[...M.color],this.valpha=M.valpha;else if("string"===typeof M){const p=Q.get(M);if(null===p)throw new Error("Unable to parse color from string: "+M);this.model=p.model,O=q[this.model].channels,this.color=p.value.slice(0,O),this.valpha="number"===typeof p.value[O]?p.value[O]:1}else if(M.length>0){this.model=p||"rgb",O=q[this.model].channels;const b=Array.prototype.slice.call(M,0,O);this.color=o(b,O),this.valpha="number"===typeof M[O]?M[O]:1}else if("number"===typeof M)this.model="rgb",this.color=[M>>16&255,M>>8&255,255&M],this.valpha=1;else{this.valpha=1;const p=Object.keys(M);"alpha"in M&&(p.splice(p.indexOf("alpha"),1),this.valpha="number"===typeof M.alpha?M.alpha:0);const Q=p.sort().join("");if(!(Q in k))throw new Error("Unable to parse color from object: "+JSON.stringify(M));this.model=k[Q];const{labels:B}=q[this.model],u=[];for(b=0;b<B.length;b++)u.push(M[B[b]]);this.color=o(u)}if(u[this.model])for(O=q[this.model].channels,b=0;b<O;b++){const M=u[this.model][b];M&&(this.color[b]=M(this.color[b]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}T.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(M){let p=this.model in Q.to?this:this.rgb();p=p.round("number"===typeof M?M:1);const b=1===p.valpha?p.color:[...p.color,this.valpha];return Q.to[p.model](b)},percentString(M){const p=this.rgb().round("number"===typeof M?M:1),b=1===p.valpha?p.color:[...p.color,this.valpha];return Q.to.rgb.percent(b)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const M={},{channels:p}=q[this.model],{labels:b}=q[this.model];for(let Q=0;Q<p;Q++)M[b[Q]]=this.color[Q];return 1!==this.valpha&&(M.alpha=this.valpha),M},unitArray(){const M=this.rgb().color;return M[0]/=255,M[1]/=255,M[2]/=255,1!==this.valpha&&M.push(this.valpha),M},unitObject(){const M=this.rgb().object();return M.r/=255,M.g/=255,M.b/=255,1!==this.valpha&&(M.alpha=this.valpha),M},round(M){return M=Math.max(M||0,0),new T([...this.color.map(O(M)),this.valpha],this.model)},alpha(M){return void 0!==M?new T([...this.color,Math.max(0,Math.min(1,M))],this.model):this.valpha},red:H("rgb",0,F(255)),green:H("rgb",1,F(255)),blue:H("rgb",2,F(255)),hue:H(["hsl","hsv","hsl","hwb","hcg"],0,(M=>(M%360+360)%360)),saturationl:H("hsl",1,F(100)),lightness:H("hsl",2,F(100)),saturationv:H("hsv",1,F(100)),value:H("hsv",2,F(100)),chroma:H("hcg",1,F(100)),gray:H("hcg",2,F(100)),white:H("hwb",1,F(100)),wblack:H("hwb",2,F(100)),cyan:H("cmyk",0,F(100)),magenta:H("cmyk",1,F(100)),yellow:H("cmyk",2,F(100)),black:H("cmyk",3,F(100)),x:H("xyz",0,F(95.047)),y:H("xyz",1,F(100)),z:H("xyz",2,F(108.833)),l:H("lab",0,F(100)),a:H("lab",1),b:H("lab",2),keyword(M){return void 0!==M?new T(M):q[this.model].keyword(this.color)},hex(M){return void 0!==M?new T(M):Q.to.hex(this.rgb().round().color)},hexa(M){if(void 0!==M)return new T(M);const p=this.rgb().round().color;let b=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===b.length&&(b="0"+b),Q.to.hex(p)+b},rgbNumber(){const M=this.rgb().color;return(255&M[0])<<16|(255&M[1])<<8|255&M[2]},luminosity(){const M=this.rgb().color,p=[];for(const[b,Q]of M.entries()){const M=Q/255;p[b]=M<=.04045?M/12.92:((M+.055)/1.055)**2.4}return.2126*p[0]+.7152*p[1]+.0722*p[2]},contrast(M){const p=this.luminosity(),b=M.luminosity();return p>b?(p+.05)/(b+.05):(b+.05)/(p+.05)},level(M){const p=this.contrast(M);return p>=7?"AAA":p>=4.5?"AA":""},isDark(){const M=this.rgb().color;return(2126*M[0]+7152*M[1]+722*M[2])/1e4<128},isLight(){return!this.isDark()},negate(){const M=this.rgb();for(let p=0;p<3;p++)M.color[p]=255-M.color[p];return M},lighten(M){const p=this.hsl();return p.color[2]+=p.color[2]*M,p},darken(M){const p=this.hsl();return p.color[2]-=p.color[2]*M,p},saturate(M){const p=this.hsl();return p.color[1]+=p.color[1]*M,p},desaturate(M){const p=this.hsl();return p.color[1]-=p.color[1]*M,p},whiten(M){const p=this.hwb();return p.color[1]+=p.color[1]*M,p},blacken(M){const p=this.hwb();return p.color[2]+=p.color[2]*M,p},grayscale(){const M=this.rgb().color,p=.3*M[0]+.59*M[1]+.11*M[2];return T.rgb(p,p,p)},fade(M){return this.alpha(this.valpha-this.valpha*M)},opaquer(M){return this.alpha(this.valpha+this.valpha*M)},rotate(M){const p=this.hsl();let b=p.color[0];return b=(b+M)%360,b=b<0?360+b:b,p.color[0]=b,p},mix(M,p){if(!M||!M.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof M);const b=M.rgb(),Q=this.rgb(),q=void 0===p?.5:p,B=2*q-1,k=b.alpha()-Q.alpha(),u=((B*k===-1?B:(B+k)/(1+B*k))+1)/2,O=1-u;return T.rgb(u*b.red()+O*Q.red(),u*b.green()+O*Q.green(),u*b.blue()+O*Q.blue(),b.alpha()*q+Q.alpha()*(1-q))}};for(const W of Object.keys(q)){if(B.includes(W))continue;const{channels:M}=q[W];T.prototype[W]=function(){if(this.model===W)return new T(this);for(var M=arguments.length,p=new Array(M),b=0;b<M;b++)p[b]=arguments[b];return p.length>0?new T(p,W):new T([...(Q=q[this.model][W].raw(this.color),Array.isArray(Q)?Q:[Q]),this.valpha],W);var Q},T[W]=function(){for(var p=arguments.length,b=new Array(p),Q=0;Q<p;Q++)b[Q]=arguments[Q];let q=b[0];return"number"===typeof q&&(q=o(b,M)),new T(q,W)}}function O(M){return function(p){return function(M,p){return Number(M.toFixed(p))}(p,M)}}function H(M,p,b){M=Array.isArray(M)?M:[M];for(const Q of M)(u[Q]||(u[Q]=[]))[p]=b;return M=M[0],function(Q){let q;return void 0!==Q?(b&&(Q=b(Q)),q=this[M](),q.color[p]=Q,q):(q=this[M]().color[p],b&&(q=b(q)),q)}}function F(M){return function(p){return Math.max(0,Math.min(M,p))}}function o(M,p){for(let b=0;b<p;b++)"number"!==typeof M[b]&&(M[b]=0);return M}M.exports=T},13869:(M,p,b)=>{const Q=b(13873),q={};for(const k of Object.keys(Q))q[Q[k]]=k;const B={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};M.exports=B;for(const k of Object.keys(B)){if(!("channels"in B[k]))throw new Error("missing channels property: "+k);if(!("labels"in B[k]))throw new Error("missing channel labels property: "+k);if(B[k].labels.length!==B[k].channels)throw new Error("channel and label counts mismatch: "+k);const{channels:M,labels:p}=B[k];delete B[k].channels,delete B[k].labels,Object.defineProperty(B[k],"channels",{value:M}),Object.defineProperty(B[k],"labels",{value:p})}B.rgb.hsl=function(M){const p=M[0]/255,b=M[1]/255,Q=M[2]/255,q=Math.min(p,b,Q),B=Math.max(p,b,Q),k=B-q;let u,T;B===q?u=0:p===B?u=(b-Q)/k:b===B?u=2+(Q-p)/k:Q===B&&(u=4+(p-b)/k),u=Math.min(60*u,360),u<0&&(u+=360);const O=(q+B)/2;return T=B===q?0:O<=.5?k/(B+q):k/(2-B-q),[u,100*T,100*O]},B.rgb.hsv=function(M){let p,b,Q,q,B;const k=M[0]/255,u=M[1]/255,T=M[2]/255,O=Math.max(k,u,T),H=O-Math.min(k,u,T),F=function(M){return(O-M)/6/H+.5};return 0===H?(q=0,B=0):(B=H/O,p=F(k),b=F(u),Q=F(T),k===O?q=Q-b:u===O?q=1/3+p-Q:T===O&&(q=2/3+b-p),q<0?q+=1:q>1&&(q-=1)),[360*q,100*B,100*O]},B.rgb.hwb=function(M){const p=M[0],b=M[1];let Q=M[2];const q=B.rgb.hsl(M)[0],k=1/255*Math.min(p,Math.min(b,Q));return Q=1-1/255*Math.max(p,Math.max(b,Q)),[q,100*k,100*Q]},B.rgb.cmyk=function(M){const p=M[0]/255,b=M[1]/255,Q=M[2]/255,q=Math.min(1-p,1-b,1-Q);return[100*((1-p-q)/(1-q)||0),100*((1-b-q)/(1-q)||0),100*((1-Q-q)/(1-q)||0),100*q]},B.rgb.keyword=function(M){const p=q[M];if(p)return p;let b,B=1/0;for(const q of Object.keys(Q)){const p=Q[q],T=(u=p,((k=M)[0]-u[0])**2+(k[1]-u[1])**2+(k[2]-u[2])**2);T<B&&(B=T,b=q)}var k,u;return b},B.keyword.rgb=function(M){return Q[M]},B.rgb.xyz=function(M){let p=M[0]/255,b=M[1]/255,Q=M[2]/255;p=p>.04045?((p+.055)/1.055)**2.4:p/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92;return[100*(.4124*p+.3576*b+.1805*Q),100*(.2126*p+.7152*b+.0722*Q),100*(.0193*p+.1192*b+.9505*Q)]},B.rgb.lab=function(M){const p=B.rgb.xyz(M);let b=p[0],Q=p[1],q=p[2];b/=95.047,Q/=100,q/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,q=q>.008856?q**(1/3):7.787*q+16/116;return[116*Q-16,500*(b-Q),200*(Q-q)]},B.hsl.rgb=function(M){const p=M[0]/360,b=M[1]/100,Q=M[2]/100;let q,B,k;if(0===b)return k=255*Q,[k,k,k];q=Q<.5?Q*(1+b):Q+b-Q*b;const u=2*Q-q,T=[0,0,0];for(let O=0;O<3;O++)B=p+1/3*-(O-1),B<0&&B++,B>1&&B--,k=6*B<1?u+6*(q-u)*B:2*B<1?q:3*B<2?u+(q-u)*(2/3-B)*6:u,T[O]=255*k;return T},B.hsl.hsv=function(M){const p=M[0];let b=M[1]/100,Q=M[2]/100,q=b;const B=Math.max(Q,.01);Q*=2,b*=Q<=1?Q:2-Q,q*=B<=1?B:2-B;return[p,100*(0===Q?2*q/(B+q):2*b/(Q+b)),100*((Q+b)/2)]},B.hsv.rgb=function(M){const p=M[0]/60,b=M[1]/100;let Q=M[2]/100;const q=Math.floor(p)%6,B=p-Math.floor(p),k=255*Q*(1-b),u=255*Q*(1-b*B),T=255*Q*(1-b*(1-B));switch(Q*=255,q){case 0:return[Q,T,k];case 1:return[u,Q,k];case 2:return[k,Q,T];case 3:return[k,u,Q];case 4:return[T,k,Q];case 5:return[Q,k,u]}},B.hsv.hsl=function(M){const p=M[0],b=M[1]/100,Q=M[2]/100,q=Math.max(Q,.01);let B,k;k=(2-b)*Q;const u=(2-b)*q;return B=b*q,B/=u<=1?u:2-u,B=B||0,k/=2,[p,100*B,100*k]},B.hwb.rgb=function(M){const p=M[0]/360;let b=M[1]/100,Q=M[2]/100;const q=b+Q;let B;q>1&&(b/=q,Q/=q);const k=Math.floor(6*p),u=1-Q;B=6*p-k,0!==(1&k)&&(B=1-B);const T=b+B*(u-b);let O,H,F;switch(k){default:case 6:case 0:O=u,H=T,F=b;break;case 1:O=T,H=u,F=b;break;case 2:O=b,H=u,F=T;break;case 3:O=b,H=T,F=u;break;case 4:O=T,H=b,F=u;break;case 5:O=u,H=b,F=T}return[255*O,255*H,255*F]},B.cmyk.rgb=function(M){const p=M[0]/100,b=M[1]/100,Q=M[2]/100,q=M[3]/100;return[255*(1-Math.min(1,p*(1-q)+q)),255*(1-Math.min(1,b*(1-q)+q)),255*(1-Math.min(1,Q*(1-q)+q))]},B.xyz.rgb=function(M){const p=M[0]/100,b=M[1]/100,Q=M[2]/100;let q,B,k;return q=3.2406*p+-1.5372*b+-.4986*Q,B=-.9689*p+1.8758*b+.0415*Q,k=.0557*p+-.204*b+1.057*Q,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,q=Math.min(Math.max(0,q),1),B=Math.min(Math.max(0,B),1),k=Math.min(Math.max(0,k),1),[255*q,255*B,255*k]},B.xyz.lab=function(M){let p=M[0],b=M[1],Q=M[2];p/=95.047,b/=100,Q/=108.883,p=p>.008856?p**(1/3):7.787*p+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116;return[116*b-16,500*(p-b),200*(b-Q)]},B.lab.xyz=function(M){let p,b,Q;b=(M[0]+16)/116,p=M[1]/500+b,Q=b-M[2]/200;const q=b**3,B=p**3,k=Q**3;return b=q>.008856?q:(b-16/116)/7.787,p=B>.008856?B:(p-16/116)/7.787,Q=k>.008856?k:(Q-16/116)/7.787,p*=95.047,b*=100,Q*=108.883,[p,b,Q]},B.lab.lch=function(M){const p=M[0],b=M[1],Q=M[2];let q;q=360*Math.atan2(Q,b)/2/Math.PI,q<0&&(q+=360);return[p,Math.sqrt(b*b+Q*Q),q]},B.lch.lab=function(M){const p=M[0],b=M[1],Q=M[2]/360*2*Math.PI;return[p,b*Math.cos(Q),b*Math.sin(Q)]},B.rgb.ansi16=function(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[b,Q,q]=M;let k=null===p?B.rgb.hsv(M)[2]:p;if(k=Math.round(k/50),0===k)return 30;let u=30+(Math.round(q/255)<<2|Math.round(Q/255)<<1|Math.round(b/255));return 2===k&&(u+=60),u},B.hsv.ansi16=function(M){return B.rgb.ansi16(B.hsv.rgb(M),M[2])},B.rgb.ansi256=function(M){const p=M[0],b=M[1],Q=M[2];if(p===b&&b===Q)return p<8?16:p>248?231:Math.round((p-8)/247*24)+232;return 16+36*Math.round(p/255*5)+6*Math.round(b/255*5)+Math.round(Q/255*5)},B.ansi16.rgb=function(M){let p=M%10;if(0===p||7===p)return M>50&&(p+=3.5),p=p/10.5*255,[p,p,p];const b=.5*(1+~~(M>50));return[(1&p)*b*255,(p>>1&1)*b*255,(p>>2&1)*b*255]},B.ansi256.rgb=function(M){if(M>=232){const p=10*(M-232)+8;return[p,p,p]}let p;M-=16;return[Math.floor(M/36)/5*255,Math.floor((p=M%36)/6)/5*255,p%6/5*255]},B.rgb.hex=function(M){const p=(((255&Math.round(M[0]))<<16)+((255&Math.round(M[1]))<<8)+(255&Math.round(M[2]))).toString(16).toUpperCase();return"000000".substring(p.length)+p},B.hex.rgb=function(M){const p=M.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!p)return[0,0,0];let b=p[0];3===p[0].length&&(b=b.split("").map((M=>M+M)).join(""));const Q=parseInt(b,16);return[Q>>16&255,Q>>8&255,255&Q]},B.rgb.hcg=function(M){const p=M[0]/255,b=M[1]/255,Q=M[2]/255,q=Math.max(Math.max(p,b),Q),B=Math.min(Math.min(p,b),Q),k=q-B;let u,T;return u=k<1?B/(1-k):0,T=k<=0?0:q===p?(b-Q)/k%6:q===b?2+(Q-p)/k:4+(p-b)/k,T/=6,T%=1,[360*T,100*k,100*u]},B.hsl.hcg=function(M){const p=M[1]/100,b=M[2]/100,Q=b<.5?2*p*b:2*p*(1-b);let q=0;return Q<1&&(q=(b-.5*Q)/(1-Q)),[M[0],100*Q,100*q]},B.hsv.hcg=function(M){const p=M[1]/100,b=M[2]/100,Q=p*b;let q=0;return Q<1&&(q=(b-Q)/(1-Q)),[M[0],100*Q,100*q]},B.hcg.rgb=function(M){const p=M[0]/360,b=M[1]/100,Q=M[2]/100;if(0===b)return[255*Q,255*Q,255*Q];const q=[0,0,0],B=p%1*6,k=B%1,u=1-k;let T=0;switch(Math.floor(B)){case 0:q[0]=1,q[1]=k,q[2]=0;break;case 1:q[0]=u,q[1]=1,q[2]=0;break;case 2:q[0]=0,q[1]=1,q[2]=k;break;case 3:q[0]=0,q[1]=u,q[2]=1;break;case 4:q[0]=k,q[1]=0,q[2]=1;break;default:q[0]=1,q[1]=0,q[2]=u}return T=(1-b)*Q,[255*(b*q[0]+T),255*(b*q[1]+T),255*(b*q[2]+T)]},B.hcg.hsv=function(M){const p=M[1]/100,b=p+M[2]/100*(1-p);let Q=0;return b>0&&(Q=p/b),[M[0],100*Q,100*b]},B.hcg.hsl=function(M){const p=M[1]/100,b=M[2]/100*(1-p)+.5*p;let Q=0;return b>0&&b<.5?Q=p/(2*b):b>=.5&&b<1&&(Q=p/(2*(1-b))),[M[0],100*Q,100*b]},B.hcg.hwb=function(M){const p=M[1]/100,b=p+M[2]/100*(1-p);return[M[0],100*(b-p),100*(1-b)]},B.hwb.hcg=function(M){const p=M[1]/100,b=1-M[2]/100,Q=b-p;let q=0;return Q<1&&(q=(b-Q)/(1-Q)),[M[0],100*Q,100*q]},B.apple.rgb=function(M){return[M[0]/65535*255,M[1]/65535*255,M[2]/65535*255]},B.rgb.apple=function(M){return[M[0]/255*65535,M[1]/255*65535,M[2]/255*65535]},B.gray.rgb=function(M){return[M[0]/100*255,M[0]/100*255,M[0]/100*255]},B.gray.hsl=function(M){return[0,0,M[0]]},B.gray.hsv=B.gray.hsl,B.gray.hwb=function(M){return[0,100,M[0]]},B.gray.cmyk=function(M){return[0,0,0,M[0]]},B.gray.lab=function(M){return[M[0],0,0]},B.gray.hex=function(M){const p=255&Math.round(M[0]/100*255),b=((p<<16)+(p<<8)+p).toString(16).toUpperCase();return"000000".substring(b.length)+b},B.rgb.gray=function(M){return[(M[0]+M[1]+M[2])/3/255*100]}},13866:(M,p,b)=>{const Q=b(13869),q=b(13881),B={};Object.keys(Q).forEach((M=>{B[M]={},Object.defineProperty(B[M],"channels",{value:Q[M].channels}),Object.defineProperty(B[M],"labels",{value:Q[M].labels});const p=q(M);Object.keys(p).forEach((b=>{const Q=p[b];B[M][b]=function(M){const p=function(){for(var p=arguments.length,b=new Array(p),Q=0;Q<p;Q++)b[Q]=arguments[Q];const q=b[0];if(void 0===q||null===q)return q;q.length>1&&(b=q);const B=M(b);if("object"===typeof B)for(let M=B.length,k=0;k<M;k++)B[k]=Math.round(B[k]);return B};return"conversion"in M&&(p.conversion=M.conversion),p}(Q),B[M][b].raw=function(M){const p=function(){for(var p=arguments.length,b=new Array(p),Q=0;Q<p;Q++)b[Q]=arguments[Q];const q=b[0];return void 0===q||null===q?q:(q.length>1&&(b=q),M(b))};return"conversion"in M&&(p.conversion=M.conversion),p}(Q)}))})),M.exports=B},13881:(M,p,b)=>{const Q=b(13869);function q(M){const p=function(){const M={},p=Object.keys(Q);for(let b=p.length,Q=0;Q<b;Q++)M[p[Q]]={distance:-1,parent:null};return M}(),b=[M];for(p[M].distance=0;b.length;){const M=b.pop(),q=Object.keys(Q[M]);for(let Q=q.length,B=0;B<Q;B++){const Q=q[B],k=p[Q];-1===k.distance&&(k.distance=p[M].distance+1,k.parent=M,b.unshift(Q))}}return p}function B(M,p){return function(b){return p(M(b))}}function k(M,p){const b=[p[M].parent,M];let q=Q[p[M].parent][M],k=p[M].parent;for(;p[k].parent;)b.unshift(p[k].parent),q=B(Q[p[k].parent][k],q),k=p[k].parent;return q.conversion=b,q}M.exports=function(M){const p=q(M),b={},Q=Object.keys(p);for(let q=Q.length,B=0;B<q;B++){const M=Q[B];null!==p[M].parent&&(b[M]=k(M,p))}return b}},13873:M=>{"use strict";M.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12500:(M,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.discordURLBuilder=void 0,p.discordURLBuilder=function(M){var p;const b=(null===(p=null===window||void 0===window?void 0:window.location)||void 0===p?void 0:p.hostname)||"localhost",Q=M.hostname.split("."),q=!M.hostname.includes("trycloudflare.com")&&!M.hostname.includes("discordsays.com")&&Q.length>2?`/${Q[0]}`:"";return M.pathname.startsWith("/.proxy")?`${M.protocol}//${b}${q}${M.pathname}${M.search}`:`${M.protocol}//${b}/.proxy/colyseus${q}${M.pathname}${M.search}`}},12489:function(M,p,b){"use strict";var Q,q,B,k,u=this&&this.__awaiter||function(M,p,b,Q){return new(b||(b=Promise))((function(q,B){function k(M){try{T(Q.next(M))}catch(p){B(p)}}function u(M){try{T(Q.throw(M))}catch(p){B(p)}}function T(M){var p;M.done?q(M.value):(p=M.value,p instanceof b?p:new b((function(M){M(p)}))).then(k,u)}T((Q=Q.apply(M,p||[])).next())}))},T=this&&this.__classPrivateFieldGet||function(M,p,b,Q){if("a"===b&&!Q)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof p?M!==p||!Q:!p.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===b?Q:"a"===b?Q.call(M):Q?Q.value:p.get(M)},O=this&&this.__classPrivateFieldSet||function(M,p,b,Q,q){if("m"===Q)throw new TypeError("Private method is not writable");if("a"===Q&&!q)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof p?M!==p||!q:!p.has(M))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===Q?q.call(M,b):q?q.value=b:p.set(M,b),b};Object.defineProperty(p,"__esModule",{value:!0}),p.Auth=void 0;const H=b(12498),F=b(12464);p.Auth=class{constructor(M){this.http=M,this.settings={path:"/auth",key:"colyseus-auth-token"},Q.set(this,!1),q.set(this,void 0),B.set(this,void 0),k.set(this,(0,F.createNanoEvents)()),(0,H.getItem)(this.settings.key,(M=>this.token=M))}set token(M){this.http.authToken=M}get token(){return this.http.authToken}onChange(M){const p=T(this,k,"f").on("change",M);return T(this,Q,"f")||O(this,q,new Promise(((M,p)=>{this.getUserData().then((M=>{this.emitChange(Object.assign(Object.assign({},M),{token:this.token}))})).catch((M=>{this.emitChange({user:null,token:void 0})})).finally((()=>{M()}))})),"f"),O(this,Q,!0,"f"),p}getUserData(){return u(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(M,p,b){return u(this,void 0,void 0,(function*(){const Q=(yield this.http.post(`${this.settings.path}/register`,{body:{email:M,password:p,options:b}})).data;return this.emitChange(Q),Q}))}signInWithEmailAndPassword(M,p){return u(this,void 0,void 0,(function*(){const b=(yield this.http.post(`${this.settings.path}/login`,{body:{email:M,password:p}})).data;return this.emitChange(b),b}))}signInAnonymously(M){return u(this,void 0,void 0,(function*(){const p=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:M}})).data;return this.emitChange(p),p}))}sendPasswordResetEmail(M){return u(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:M}})).data}))}signInWithProvider(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(this,void 0,void 0,(function*(){return new Promise(((b,Q)=>{const q=p.width||480,k=p.height||768,u=this.token?`?token=${this.token}`:"",H=`Login with ${M[0].toUpperCase()+M.substring(1)}`,F=this.http.client.getHttpEndpoint(`${p.prefix||`${this.settings.path}/provider`}/${M}${u}`),o=screen.width/2-q/2,W=screen.height/2-k/2;O(this,B,window.open(F,H,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+q+", height="+k+", top="+W+", left="+o),"f");const i=M=>{void 0===M.data.user&&void 0===M.data.token||(clearInterval(A),T(this,B,"f").close(),O(this,B,void 0,"f"),window.removeEventListener("message",i),void 0!==M.data.error?Q(M.data.error):(b(M.data),this.emitChange(M.data)))},A=setInterval((()=>{T(this,B,"f")&&!T(this,B,"f").closed||(O(this,B,void 0,"f"),Q("Au"),window.removeEventListener("message",i))}),200);window.addEventListener("message",i)}))}))}signOut(){return u(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(M){void 0!==M.token&&(this.token=M.token,null===M.token?(0,H.removeItem)(this.settings.key):(0,H.setItem)(this.settings.key,M.token)),T(this,k,"f").emit("change",M)}},Q=new WeakMap,q=new WeakMap,B=new WeakMap,k=new WeakMap},12418:function(M,p,b){"use strict";var Q,q=this&&this.__awaiter||function(M,p,b,Q){return new(b||(b=Promise))((function(q,B){function k(M){try{T(Q.next(M))}catch(p){B(p)}}function u(M){try{T(Q.throw(M))}catch(p){B(p)}}function T(M){var p;M.done?q(M.value):(p=M.value,p instanceof b?p:new b((function(M){M(p)}))).then(k,u)}T((Q=Q.apply(M,p||[])).next())}))};Object.defineProperty(p,"__esModule",{value:!0}),p.Client=p.MatchMakeError=void 0;const B=b(12422),k=b(12431),u=b(12480),T=b(12489),O=b(12500);class H extends Error{constructor(M,p){super(M),this.code=p,Object.setPrototypeOf(this,H.prototype)}}p.MatchMakeError=H;const F="undefined"!==typeof window&&"undefined"!==typeof(null===(Q=null===window||void 0===window?void 0:window.location)||void 0===Q?void 0:Q.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";p.Client=class{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,p=arguments.length>1?arguments[1]:void 0;var b,Q;if("string"===typeof M){const p=M.startsWith("/")?new URL(M,F):new URL(M),b="https:"===p.protocol||"wss:"===p.protocol,Q=Number(p.port||(b?443:80));this.settings={hostname:p.hostname,pathname:p.pathname,port:Q,secure:b}}else void 0===M.port&&(M.port=M.secure?443:80),void 0===M.pathname&&(M.pathname=""),this.settings=M;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new u.HTTP(this,(null===p||void 0===p?void 0:p.headers)||{}),this.auth=new T.Auth(this.http),this.urlBuilder=null===p||void 0===p?void 0:p.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(Q=null===(b=null===window||void 0===window?void 0:window.location)||void 0===b?void 0:b.hostname)||void 0===Q?void 0:Q.includes("discordsays.com"))&&(this.urlBuilder=O.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",M,p,b)}))}create(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",M,p,b)}))}join(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",M,p,b)}))}joinById(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",M,p,b)}))}reconnect(M,p){return q(this,void 0,void 0,(function*(){if("string"===typeof M&&"string"===typeof p)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[b,Q]=M.split(":");if(!b||!Q)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",b,{reconnectionToken:Q},p)}))}getAvailableRooms(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return q(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${M}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(M,p,b){return q(this,void 0,void 0,(function*(){const Q=this.createRoom(M.room.name,p);Q.roomId=M.room.roomId,Q.sessionId=M.sessionId;const k={sessionId:Q.sessionId};M.reconnectionToken&&(k.reconnectionToken=M.reconnectionToken);const u=b||Q;return Q.connect(this.buildEndpoint(M.room,k),M.devMode&&(()=>q(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${Q.roomId}'...`);let b=0;const B=()=>q(this,void 0,void 0,(function*(){b++;try{yield this.consumeSeatReservation(M,p,u),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${Q.roomId}'`)}catch(q){b<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${b} out of 8)`),setTimeout(B,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(B,2e3)}))),u,this.http.headers),new Promise(((M,p)=>{const b=(M,b)=>p(new B.ServerError(M,b));u.onError.once(b),u.onJoin.once((()=>{u.onError.remove(b),setTimeout((()=>{try{u.JT(128,new Uint8Array([60,144,84,134,95,45,66,162,37,142,145,210,185,177,84,65,167,99,204,88]))}catch{}}),3e3),M(u)}))}))}))}createMatchMakeRequest(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Q=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;return q(this,void 0,void 0,(function*(){const q=(yield this.http.post(`matchmake/${M}/${p}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(b)})).data;if(q.error)throw new H(q.error,q.code);return"reconnect"===M&&(q.reconnectionToken=b.reconnectionToken),yield this.consumeSeatReservation(q,Q,B)}))}createRoom(M,p){return new k.Room(M,p)}buildEndpoint(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=[];for(const B in p)p.hasOwnProperty(B)&&b.push(`${B}=${p[B]}`);let Q=this.settings.secure?"wss://":"ws://";M.publicAddress?Q+=`${M.publicAddress}`:Q+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const q=`${Q}/${M.processId}/${M.roomId}?${b.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(q)):q}getHttpEndpoint(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const p=M.startsWith("/")?M:`/${M}`,b=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${p}`;return this.urlBuilder?this.urlBuilder(new URL(b)):b}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12443:(M,p,b)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.Connection=void 0;const Q=b(12447);p.Connection=class{constructor(){this.events={},this.transport=new Q.WebSocketTransport(this.events)}send(M){this.transport.send(M)}connect(M,p){this.transport.connect(M,p)}close(M,p){this.transport.close(M,p)}get isOpen(){return this.transport.isOpen}}},12480:function(M,p,b){"use strict";var Q=this&&this.__createBinding||(Object.create?function(M,p,b,Q){void 0===Q&&(Q=b);var q=Object.getOwnPropertyDescriptor(p,b);q&&!("get"in q?!p.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return p[b]}}),Object.defineProperty(M,Q,q)}:function(M,p,b,Q){void 0===Q&&(Q=b),M[Q]=p[b]}),q=this&&this.__setModuleDefault||(Object.create?function(M,p){Object.defineProperty(M,"default",{enumerable:!0,value:p})}:function(M,p){M.default=p}),B=this&&this.__importStar||function(M){if(M&&M.__esModule)return M;var p={};if(null!=M)for(var b in M)"default"!==b&&Object.prototype.hasOwnProperty.call(M,b)&&Q(p,M,b);return q(p,M),p};Object.defineProperty(p,"__esModule",{value:!0}),p.HTTP=void 0;const k=b(12422),u=B(b(12484));p.HTTP=class{constructor(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=M,this.headers=p}get(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",M,p)}post(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",M,p)}del(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",M,p)}put(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",M,p)}request(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u[M](this.client.getHttpEndpoint(p),this.getOptions(b)).catch((M=>{var p;const b=M.statusCode,Q=(null===(p=M.data)||void 0===p?void 0:p.error)||M.statusMessage||M.message;if(!b&&!Q)throw M;throw new k.ServerError(b,Q)}))}getOptions(M){return M.headers=Object.assign({},this.headers,M.headers),this.authToken&&(M.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(M.withCredentials=!0),M}}},12456:(M,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.utf8Length=p.utf8Read=p.ErrorCode=p.Protocol=void 0,function(M){M[M.HANDSHAKE=9]="HANDSHAKE",M[M.JOIN_ROOM=10]="JOIN_ROOM",M[M.ERROR=11]="ERROR",M[M.LEAVE_ROOM=12]="LEAVE_ROOM",M[M.ROOM_DATA=13]="ROOM_DATA",M[M.ROOM_STATE=14]="ROOM_STATE",M[M.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",M[M.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",M[M.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(p.Protocol||(p.Protocol={})),function(M){M[M.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",M[M.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",M[M.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",M[M.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",M[M.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",M[M.AUTH_FAILED=4215]="AUTH_FAILED",M[M.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(p.ErrorCode||(p.ErrorCode={})),p.utf8Read=function(M,p){const b=M[p++];for(var Q="",q=0,B=p,k=p+b;B<k;B++){var u=M[B];if(0!==(128&u))if(192!==(224&u))if(224!==(240&u)){if(240!==(248&u))throw new Error("Invalid byte "+u.toString(16));(q=(7&u)<<18|(63&M[++B])<<12|(63&M[++B])<<6|63&M[++B])>=65536?(q-=65536,Q+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):Q+=String.fromCharCode(q)}else Q+=String.fromCharCode((15&u)<<12|(63&M[++B])<<6|63&M[++B]);else Q+=String.fromCharCode((31&u)<<6|63&M[++B]);else Q+=String.fromCharCode(u)}return Q},p.utf8Length=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",p=0,b=0;for(let Q=0,q=M.length;Q<q;Q++)p=M.charCodeAt(Q),p<128?b+=1:p<2048?b+=2:p<55296||p>=57344?b+=3:(Q++,b+=4);return b+1}},12431:function(M,p,b){"use strict";var Q=this&&this.__createBinding||(Object.create?function(M,p,b,Q){void 0===Q&&(Q=b);var q=Object.getOwnPropertyDescriptor(p,b);q&&!("get"in q?!p.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return p[b]}}),Object.defineProperty(M,Q,q)}:function(M,p,b,Q){void 0===Q&&(Q=b),M[Q]=p[b]}),q=this&&this.__setModuleDefault||(Object.create?function(M,p){Object.defineProperty(M,"default",{enumerable:!0,value:p})}:function(M,p){M.default=p}),B=this&&this.__importStar||function(M){if(M&&M.__esModule)return M;var p={};if(null!=M)for(var b in M)"default"!==b&&Object.prototype.hasOwnProperty.call(M,b)&&Q(p,M,b);return q(p,M),p};Object.defineProperty(p,"__esModule",{value:!0}),p.Room=void 0;const k=B(b(12435)),u=b(12443),T=b(12456),O=b(12461),H=b(12464),F=b(12469),o=b(12472),W=b(12422);class i{constructor(M,p){this.onStateChange=(0,F.createSignal)(),this.onError=(0,F.createSignal)(),this.onLeave=(0,F.createSignal)(),this.onJoin=(0,F.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,H.createNanoEvents)(),this.roomId=null,this.name=M,p&&(this.serializer=new((0,O.getSerializer)("schema")),this.rootSchema=p,this.serializer.state=new p),this.onError(((M,p)=>{var b;return null===(b=console.warn)||void 0===b?void 0:b.call(console,`colyseus.js - onError => (${M}) ${p}`)})),this.onLeave((()=>this.qp()))}get id(){return this.roomId}connect(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,Q=arguments.length>3?arguments[3]:void 0;const q=new u.Connection;b.connection=q,q.events.onmessage=i.prototype.onMessageCallback.bind(b),q.events.onclose=function(M){var Q;if(!b.hasJoined)return null===(Q=console.warn)||void 0===Q||Q.call(console,`Room connection was closed unexpectedly (${M.code}): ${M.reason}`),void b.onError.invoke(M.code,M.reason);M.code===W.CloseCode.DEVMODE_RESTART&&p?p():(b.onLeave.invoke(M.code,M.reason),b.destroy())},q.events.onerror=function(M){var p;null===(p=console.warn)||void 0===p||p.call(console,`Room, onError (${M.code}): ${M.reason}`),b.onError.invoke(M.code,M.reason)},q.connect(M,Q)}Iu(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((p=>{this.onLeave((M=>p(M))),this.connection?M?this.connection.send([T.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(W.CloseCode.CONSENTED)}))}gp(M,p){return this.onMessageHandlers.on(this.getMessageHandlerKey(M),p)}send(M,p){const b=[T.Protocol.ROOM_DATA];let Q;if("string"===typeof M?o.encode.string(b,M):o.encode.number(b,M),void 0!==p){const M=k.encode(p);Q=new Uint8Array(b.length+M.byteLength),Q.set(new Uint8Array(b),0),Q.set(new Uint8Array(M),b.length)}else Q=new Uint8Array(b);this.connection.send(Q.buffer)}JT(M,p){const b=[T.Protocol.ROOM_DATA_BYTES];let Q;"string"===typeof M?o.encode.string(b,M):o.encode.number(b,M),Q=new Uint8Array(b.length+(p.byteLength||p.length)),Q.set(new Uint8Array(b),0),Q.set(new Uint8Array(p),b.length),this.connection.send(Q.buffer)}get state(){return this.serializer.getState()}qp(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(M){const p=Array.from(new Uint8Array(M.data)),b=p[0];if(b===T.Protocol.JOIN_ROOM){let M=1;const b=(0,T.utf8Read)(p,M);if(M+=(0,T.utf8Length)(b),this.serializerId=(0,T.utf8Read)(p,M),M+=(0,T.utf8Length)(this.serializerId),!this.serializer){const M=(0,O.getSerializer)(this.serializerId);this.serializer=new M}p.length>M&&this.serializer.handshake&&this.serializer.handshake(p,{offset:M}),this.reconnectionToken=`${this.roomId}:${b}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([T.Protocol.JOIN_ROOM])}else if(b===T.Protocol.ERROR){const M={offset:1},b=o.decode.number(p,M),Q=o.decode.string(p,M);this.onError.invoke(b,Q)}else if(b===T.Protocol.LEAVE_ROOM)this.Iu();else if(b===T.Protocol.ROOM_DATA_SCHEMA){const M={offset:1},b=this.serializer.getState().constructor._context.get(o.decode.number(p,M)),Q=new b;Q.decode(p,M),this.dispatchMessage(b,Q)}else if(b===T.Protocol.ROOM_STATE)p.shift(),this.setState(p);else if(b===T.Protocol.ROOM_STATE_PATCH)p.shift(),this.patch(p);else if(b===T.Protocol.ROOM_DATA){const b={offset:1},Q=o.decode.stringCheck(p,b)?o.decode.string(p,b):o.decode.number(p,b),q=p.length>b.offset?k.decode(M.data,b.offset):void 0;this.dispatchMessage(Q,q)}else if(b===T.Protocol.ROOM_DATA_BYTES){const M={offset:1},b=o.decode.stringCheck(p,M)?o.decode.string(p,M):o.decode.number(p,M);this.dispatchMessage(b,new Uint8Array(p.slice(M.offset)))}}setState(M){this.serializer.setState(M),this.onStateChange.invoke(this.serializer.getState())}patch(M){this.serializer.patch(M),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(M,p){var b;const Q=this.getMessageHandlerKey(M);this.onMessageHandlers.events[Q]?this.onMessageHandlers.emit(Q,p):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",M,p):null===(b=console.warn)||void 0===b||b.call(console,`colyseus.js: onMessage() not registered for type '${M}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(M){switch(typeof M){case"function":return`$${M._typeid}`;case"string":return M;case"number":return`i${M}`;default:throw new Error("invalid message type.")}}}p.Room=i},12498:(M,p)=>{"use strict";let b;function Q(){if(!b)try{b="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(M){}return b||(b={cache:{},setItem:function(M,p){this.cache[M]=p},getItem:function(M){this.cache[M]},removeItem:function(M){delete this.cache[M]}}),b}Object.defineProperty(p,"__esModule",{value:!0}),p.getItem=p.removeItem=p.setItem=void 0,p.setItem=function(M,p){Q().setItem(M,p)},p.removeItem=function(M){Q().removeItem(M)},p.getItem=function(M,p){const b=Q().getItem(M);"undefined"!==typeof Promise&&b instanceof Promise?b.then((M=>p(M))):p(b)}},12464:(M,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.createNanoEvents=void 0;p.createNanoEvents=()=>({emit(M){let p=this.events[M]||[];for(var b=arguments.length,Q=new Array(b>1?b-1:0),q=1;q<b;q++)Q[q-1]=arguments[q];for(let B=0,k=p.length;B<k;B++)p[B](...Q)},events:{},on(M,p){var b;return(null===(b=this.events[M])||void 0===b?void 0:b.push(p))||(this.events[M]=[p]),()=>{var b;this.events[M]=null===(b=this.events[M])||void 0===b?void 0:b.filter((M=>p!==M))}}})},12469:(M,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.createSignal=p.EventEmitter=void 0;class b{constructor(){this.handlers=[]}register(M){return this.handlers.push(M),this}invoke(){for(var M=arguments.length,p=new Array(M),b=0;b<M;b++)p[b]=arguments[b];this.handlers.forEach((M=>M.apply(this,p)))}invokeAsync(){for(var M=arguments.length,p=new Array(M),b=0;b<M;b++)p[b]=arguments[b];return Promise.all(this.handlers.map((M=>M.apply(this,p))))}remove(M){const p=this.handlers.indexOf(M);this.handlers[p]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}p.EventEmitter=b,p.createSignal=function(){const M=new b;function p(p){return M.register(p,null===this)}return p.once=p=>{const b=function(){for(var Q=arguments.length,q=new Array(Q),B=0;B<Q;B++)q[B]=arguments[B];p.apply(this,q),M.remove(b)};M.register(b)},p.remove=p=>M.remove(p),p.invoke=function(){return M.invoke(...arguments)},p.invokeAsync=function(){return M.invokeAsync(...arguments)},p.clear=()=>M.clear(),p}},12422:(M,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.ServerError=p.CloseCode=void 0,function(M){M[M.CONSENTED=4e3]="CONSENTED",M[M.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(p.CloseCode||(p.CloseCode={}));class b extends Error{constructor(M,p){super(p),this.name="ServerError",this.code=M}}p.ServerError=b},12408:(M,p,b)=>{"use strict";p.d=void 0,b(12414);var Q=b(12418);Object.defineProperty(p,"d",{enumerable:!0,get:function(){return Q.Client}});var q=b(12456);var B=b(12431);var k=b(12489);const u=b(12504);const T=b(12506),O=b(12461);(0,O.registerSerializer)("schema",u.SchemaSerializer),(0,O.registerSerializer)("none",T.NoneSerializer)},12414:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=M=>null!==M&&"object"===typeof M&&M.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12435:(M,p)=>{"use strict";function b(M,p){if(this._offset=p,M instanceof ArrayBuffer)this._buffer=M,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(M))throw new Error("Invalid argument");this._buffer=M.buffer,this._view=new DataView(this._buffer,M.byteOffset,M.byteLength)}}Object.defineProperty(p,"__esModule",{value:!0}),p.decode=p.encode=void 0,b.prototype._array=function(M){for(var p=new Array(M),b=0;b<M;b++)p[b]=this._parse();return p},b.prototype._map=function(M){for(var p={},b=0;b<M;b++)p[this._parse()]=this._parse();return p},b.prototype._str=function(M){var p=function(M,p,b){for(var Q="",q=0,B=p,k=p+b;B<k;B++){var u=M.getUint8(B);if(0!==(128&u))if(192!==(224&u))if(224!==(240&u)){if(240!==(248&u))throw new Error("Invalid byte "+u.toString(16));(q=(7&u)<<18|(63&M.getUint8(++B))<<12|(63&M.getUint8(++B))<<6|63&M.getUint8(++B))>=65536?(q-=65536,Q+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):Q+=String.fromCharCode(q)}else Q+=String.fromCharCode((15&u)<<12|(63&M.getUint8(++B))<<6|63&M.getUint8(++B));else Q+=String.fromCharCode((31&u)<<6|63&M.getUint8(++B));else Q+=String.fromCharCode(u)}return Q}(this._view,this._offset,M);return this._offset+=M,p},b.prototype._bin=function(M){var p=this._buffer.slice(this._offset,this._offset+M);return this._offset+=M,p},b.prototype._parse=function(){var M,p=this._view.getUint8(this._offset++),b=0,Q=0,q=0,B=0;if(p<192)return p<128?p:p<144?this._map(15&p):p<160?this._array(15&p):this._str(31&p);if(p>223)return-1*(255-p+1);switch(p){case 192:return null;case 194:return!1;case 195:return!0;case 196:return b=this._view.getUint8(this._offset),this._offset+=1,this._bin(b);case 197:return b=this._view.getUint16(this._offset),this._offset+=2,this._bin(b);case 198:return b=this._view.getUint32(this._offset),this._offset+=4,this._bin(b);case 199:if(b=this._view.getUint8(this._offset),Q=this._view.getInt8(this._offset+1),this._offset+=2,-1===Q){var k=this._view.getUint32(this._offset);return q=this._view.getInt32(this._offset+4),B=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*q+B)+k/1e6)}return[Q,this._bin(b)];case 200:return b=this._view.getUint16(this._offset),Q=this._view.getInt8(this._offset+2),this._offset+=3,[Q,this._bin(b)];case 201:return b=this._view.getUint32(this._offset),Q=this._view.getInt8(this._offset+4),this._offset+=5,[Q,this._bin(b)];case 202:return M=this._view.getFloat32(this._offset),this._offset+=4,M;case 203:return M=this._view.getFloat64(this._offset),this._offset+=8,M;case 204:return M=this._view.getUint8(this._offset),this._offset+=1,M;case 205:return M=this._view.getUint16(this._offset),this._offset+=2,M;case 206:return M=this._view.getUint32(this._offset),this._offset+=4,M;case 207:return q=this._view.getUint32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,q+B;case 208:return M=this._view.getInt8(this._offset),this._offset+=1,M;case 209:return M=this._view.getInt16(this._offset),this._offset+=2,M;case 210:return M=this._view.getInt32(this._offset),this._offset+=4,M;case 211:return q=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,q+B;case 212:return Q=this._view.getInt8(this._offset),this._offset+=1,0===Q?void(this._offset+=1):[Q,this._bin(1)];case 213:return Q=this._view.getInt8(this._offset),this._offset+=1,[Q,this._bin(2)];case 214:return Q=this._view.getInt8(this._offset),this._offset+=1,-1===Q?(M=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*M)):[Q,this._bin(4)];case 215:return Q=this._view.getInt8(this._offset),this._offset+=1,0===Q?(q=this._view.getInt32(this._offset)*Math.pow(2,32),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(q+B)):-1===Q?(q=this._view.getUint32(this._offset),B=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&q)+B)+(q>>>2)/1e6)):[Q,this._bin(8)];case 216:return Q=this._view.getInt8(this._offset),this._offset+=1,[Q,this._bin(16)];case 217:return b=this._view.getUint8(this._offset),this._offset+=1,this._str(b);case 218:return b=this._view.getUint16(this._offset),this._offset+=2,this._str(b);case 219:return b=this._view.getUint32(this._offset),this._offset+=4,this._str(b);case 220:return b=this._view.getUint16(this._offset),this._offset+=2,this._array(b);case 221:return b=this._view.getUint32(this._offset),this._offset+=4,this._array(b);case 222:return b=this._view.getUint16(this._offset),this._offset+=2,this._map(b);case 223:return b=this._view.getUint32(this._offset),this._offset+=4,this._map(b)}throw new Error("Could not parse")},p.decode=function(M){var p=new b(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),Q=p._parse();if(p._offset!==M.byteLength)throw new Error(M.byteLength-p._offset+" trailing bytes");return Q};function Q(M,p,b){for(var Q=0,q=0,B=b.length;q<B;q++)(Q=b.charCodeAt(q))<128?M.setUint8(p++,Q):Q<2048?(M.setUint8(p++,192|Q>>6),M.setUint8(p++,128|63&Q)):Q<55296||Q>=57344?(M.setUint8(p++,224|Q>>12),M.setUint8(p++,128|Q>>6&63),M.setUint8(p++,128|63&Q)):(q++,Q=65536+((1023&Q)<<10|1023&b.charCodeAt(q)),M.setUint8(p++,240|Q>>18),M.setUint8(p++,128|Q>>12&63),M.setUint8(p++,128|Q>>6&63),M.setUint8(p++,128|63&Q))}function q(M,p,b){var Q=typeof b,B=0,k=0,u=0,T=0,O=0,H=0;if("string"===Q){if(O=function(M){for(var p=0,b=0,Q=0,q=M.length;Q<q;Q++)(p=M.charCodeAt(Q))<128?b+=1:p<2048?b+=2:p<55296||p>=57344?b+=3:(Q++,b+=4);return b}(b),O<32)M.push(160|O),H=1;else if(O<256)M.push(217,O),H=2;else if(O<65536)M.push(218,O>>8,O),H=3;else{if(!(O<4294967296))throw new Error("String too long");M.push(219,O>>24,O>>16,O>>8,O),H=5}return p.push({_str:b,_length:O,_offset:M.length}),H+O}if("number"===Q)return Math.floor(b)===b&&isFinite(b)?b>=0?b<128?(M.push(b),1):b<256?(M.push(204,b),2):b<65536?(M.push(205,b>>8,b),3):b<4294967296?(M.push(206,b>>24,b>>16,b>>8,b),5):(u=b/Math.pow(2,32)|0,T=b>>>0,M.push(207,u>>24,u>>16,u>>8,u,T>>24,T>>16,T>>8,T),9):b>=-32?(M.push(b),1):b>=-128?(M.push(208,b),2):b>=-32768?(M.push(209,b>>8,b),3):b>=-2147483648?(M.push(210,b>>24,b>>16,b>>8,b),5):(u=Math.floor(b/Math.pow(2,32)),T=b>>>0,M.push(211,u>>24,u>>16,u>>8,u,T>>24,T>>16,T>>8,T),9):(M.push(203),p.push({_float:b,_length:8,_offset:M.length}),9);if("object"===Q){if(null===b)return M.push(192),1;if(Array.isArray(b)){if((O=b.length)<16)M.push(144|O),H=1;else if(O<65536)M.push(220,O>>8,O),H=3;else{if(!(O<4294967296))throw new Error("Array too large");M.push(221,O>>24,O>>16,O>>8,O),H=5}for(B=0;B<O;B++)H+=q(M,p,b[B]);return H}if(b instanceof Date){var F=b.getTime(),o=Math.floor(F/1e3),W=1e6*(F-1e3*o);return o>=0&&W>=0&&o<=17179869183?0===W&&o<=4294967295?(M.push(214,255,o>>24,o>>16,o>>8,o),6):(u=o/4294967296,T=4294967295&o,M.push(215,255,W>>22,W>>14,W>>6,u,T>>24,T>>16,T>>8,T),10):(u=Math.floor(o/4294967296),T=o>>>0,M.push(199,12,255,W>>24,W>>16,W>>8,W,u>>24,u>>16,u>>8,u,T>>24,T>>16,T>>8,T),15)}if(b instanceof ArrayBuffer){if((O=b.byteLength)<256)M.push(196,O),H=2;else if(O<65536)M.push(197,O>>8,O),H=3;else{if(!(O<4294967296))throw new Error("Buffer too large");M.push(198,O>>24,O>>16,O>>8,O),H=5}return p.push({_bin:b,_length:O,_offset:M.length}),H+O}if("function"===typeof b.toJSON)return q(M,p,b.toJSON());var i=[],A="",j=Object.keys(b);for(B=0,k=j.length;B<k;B++)void 0!==b[A=j[B]]&&"function"!==typeof b[A]&&i.push(A);if((O=i.length)<16)M.push(128|O),H=1;else if(O<65536)M.push(222,O>>8,O),H=3;else{if(!(O<4294967296))throw new Error("Object too large");M.push(223,O>>24,O>>16,O>>8,O),H=5}for(B=0;B<O;B++)H+=q(M,p,A=i[B]),H+=q(M,p,b[A]);return H}if("boolean"===Q)return M.push(b?195:194),1;if("undefined"===Q)return M.push(192),1;if("function"===typeof b.toJSON)return q(M,p,b.toJSON());throw new Error("Could not encode")}p.encode=function(M){var p=[],b=[],B=q(p,b,M),k=new ArrayBuffer(B),u=new DataView(k),T=0,O=0,H=-1;b.length>0&&(H=b[0]._offset);for(var F,o=0,W=0,i=0,A=p.length;i<A;i++)if(u.setUint8(O+i,p[i]),i+1===H){if(o=(F=b[T])._length,W=O+H,F._bin)for(var j=new Uint8Array(F._bin),K=0;K<o;K++)u.setUint8(W+K,j[K]);else F._str?Q(u,W,F._str):void 0!==F._float&&u.setFloat64(W,F._float);O+=o,b[++T]&&(H=b[T]._offset)}return k}},12506:(M,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.NoneSerializer=void 0;p.NoneSerializer=class{setState(M){}getState(){return null}patch(M){}teardown(){}handshake(M){}}},12504:(M,p,b)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.SchemaSerializer=void 0;const Q=b(12472);p.SchemaSerializer=class{setState(M){return this.state.decode(M)}getState(){return this.state}patch(M){return this.state.decode(M)}teardown(){var M,p;null===(p=null===(M=this.state)||void 0===M?void 0:M.$changes)||void 0===p||p.root.clearRefs()}handshake(M,p){if(this.state){(new Q.Reflection).decode(M,p)}else this.state=Q.Reflection.decode(M,p)}}},12461:(M,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.getSerializer=p.registerSerializer=void 0;const b={};p.registerSerializer=function(M,p){b[M]=p},p.getSerializer=function(M){const p=b[M];if(!p)throw new Error("missing serializer: "+M);return p}},12447:function(M,p,b){"use strict";var Q=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(p,"__esModule",{value:!0}),p.WebSocketTransport=void 0;const q=Q(b(12451)),B=globalThis.WebSocket||q.default;p.WebSocketTransport=class{constructor(M){this.events=M}send(M){M instanceof ArrayBuffer?this.ws.send(M):Array.isArray(M)&&this.ws.send(new Uint8Array(M).buffer)}connect(M,p){try{this.ws=new B(M,{headers:p,protocols:this.protocols})}catch(b){this.ws=new B(M,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(M,p){this.ws.close(M,p)}get isOpen(){return this.ws.readyState===B.OPEN}}},12451:M=>{"use strict";M.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12847:M=>{"use strict";M.exports=function(M){for(var p=new Array(M),b=0;b<M;++b)p[b]=b;return p}},12854:M=>{function p(M){return!!M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}M.exports=function(M){return null!=M&&(p(M)||function(M){return"function"===typeof M.readFloatLE&&"function"===typeof M.slice&&p(M.slice(0,0))}(M)||!!M._isBuffer)}},12843:(M,p,b)=>{var Q=b(12847),q=b(12854),B="undefined"!==typeof Float64Array;function k(M,p){return M[0]-p[0]}function u(){var M,p=this.stride,b=new Array(p.length);for(M=0;M<b.length;++M)b[M]=[Math.abs(p[M]),M];b.sort(k);var Q=new Array(b.length);for(M=0;M<Q.length;++M)Q[M]=b[M][1];return Q}function T(M,p){var b=["View",p,"d",M].join("");p<0&&(b="View_Nil"+M);var q="generic"===M;if(-1===p){var B="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+M+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(B)()}if(0===p){B="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+M+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",B)(O[M][0])}B=["'use strict'"];var k=Q(p),T=k.map((function(M){return"i"+M})),H="this.offset+"+k.map((function(M){return"this.stride["+M+"]*i"+M})).join("+"),F=k.map((function(M){return"b"+M})).join(","),o=k.map((function(M){return"c"+M})).join(",");B.push("function "+b+"(a,"+F+","+o+",d){this.data=a","this.shape=["+F+"]","this.stride=["+o+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+M+"'","proto.dimension="+p),B.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+k.map((function(M){return"this.shape["+M+"]"})).join("*"),"}})"),1===p?B.push("proto.order=[0]"):(B.push("Object.defineProperty(proto,'order',{get:"),p<4?(B.push("function "+b+"_order(){"),2===p?B.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===p&&B.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):B.push("ORDER})")),B.push("proto.set=function "+b+"_set("+T.join(",")+",v){"),q?B.push("return this.data.set("+H+",v)}"):B.push("return this.data["+H+"]=v}"),B.push("proto.get=function "+b+"_get("+T.join(",")+"){"),q?B.push("return this.data.get("+H+")}"):B.push("return this.data["+H+"]}"),B.push("proto.index=function "+b+"_index(",T.join(),"){return "+H+"}"),B.push("proto.hi=function "+b+"_hi("+T.join(",")+"){return new "+b+"(this.data,"+k.map((function(M){return["(typeof i",M,"!=='number'||i",M,"<0)?this.shape[",M,"]:i",M,"|0"].join("")})).join(",")+","+k.map((function(M){return"this.stride["+M+"]"})).join(",")+",this.offset)}");var W=k.map((function(M){return"a"+M+"=this.shape["+M+"]"})),i=k.map((function(M){return"c"+M+"=this.stride["+M+"]"}));B.push("proto.lo=function "+b+"_lo("+T.join(",")+"){var b=this.offset,d=0,"+W.join(",")+","+i.join(","));for(var A=0;A<p;++A)B.push("if(typeof i"+A+"==='number'&&i"+A+">=0){d=i"+A+"|0;b+=c"+A+"*d;a"+A+"-=d}");B.push("return new "+b+"(this.data,"+k.map((function(M){return"a"+M})).join(",")+","+k.map((function(M){return"c"+M})).join(",")+",b)}"),B.push("proto.step=function "+b+"_step("+T.join(",")+"){var "+k.map((function(M){return"a"+M+"=this.shape["+M+"]"})).join(",")+","+k.map((function(M){return"b"+M+"=this.stride["+M+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(A=0;A<p;++A)B.push("if(typeof i"+A+"==='number'){d=i"+A+"|0;if(d<0){c+=b"+A+"*(a"+A+"-1);a"+A+"=ceil(-a"+A+"/d)}else{a"+A+"=ceil(a"+A+"/d)}b"+A+"*=d}");B.push("return new "+b+"(this.data,"+k.map((function(M){return"a"+M})).join(",")+","+k.map((function(M){return"b"+M})).join(",")+",c)}");var j=new Array(p),K=new Array(p);for(A=0;A<p;++A)j[A]="a[i"+A+"]",K[A]="b[i"+A+"]";B.push("proto.transpose=function "+b+"_transpose("+T+"){"+T.map((function(M,p){return M+"=("+M+"===undefined?"+p+":"+M+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+j.join(",")+","+K.join(",")+",this.offset)}"),B.push("proto.pick=function "+b+"_pick("+T+"){var a=[],b=[],c=this.offset");for(A=0;A<p;++A)B.push("if(typeof i"+A+"==='number'&&i"+A+">=0){c=(c+this.stride["+A+"]*i"+A+")|0}else{a.push(this.shape["+A+"]);b.push(this.stride["+A+"])}");return B.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),B.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+k.map((function(M){return"shape["+M+"]"})).join(",")+","+k.map((function(M){return"stride["+M+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",B.join("\n"))(O[M],u)}var O={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};M.exports=function(M,p,b,Q){if(void 0===M)return(0,O.array[0])([]);"number"===typeof M&&(M=[M]),void 0===p&&(p=[M.length]);var k=p.length;if(void 0===b){b=new Array(k);for(var u=k-1,H=1;u>=0;--u)b[u]=H,H*=p[u]}if(void 0===Q){Q=0;for(u=0;u<k;++u)b[u]<0&&(Q-=(p[u]-1)*b[u])}for(var F=function(M){if(q(M))return"buffer";if(B)switch(Object.prototype.toString.call(M)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(M)?"array":"generic"}(M),o=O[F];o.length<=k+1;)o.push(T(F,o.length-1));return(0,o[k+1])(M,p,b,Q)}},13840:M=>{var p;self,p=()=>(()=>{"use strict";var M={d:(p,b)=>{for(var Q in b)M.o(b,Q)&&!M.o(p,Q)&&Object.defineProperty(p,Q,{enumerable:!0,get:b[Q]})},o:(M,p)=>Object.prototype.hasOwnProperty.call(M,p)},p={};M.d(p,{default:()=>E});var b,Q=function(M,p){var b=p.x-M.x,Q=p.y-M.y;return Math.sqrt(b*b+Q*Q)},q=function(M){return M*(Math.PI/180)},B=new Map,k=function(M){B.has(M)&&clearTimeout(B.get(M)),B.set(M,setTimeout(M,100))},u=function(M,p,b){for(var Q,q=p.split(/[ ,]+/g),B=0;B<q.length;B+=1)Q=q[B],M.addEventListener?M.addEventListener(Q,b,!1):M.attachEvent&&M.attachEvent(Q,b)},T=function(M,p,b){for(var Q,q=p.split(/[ ,]+/g),B=0;B<q.length;B+=1)Q=q[B],M.removeEventListener?M.removeEventListener(Q,b):M.detachEvent&&M.detachEvent(Q,b)},O=function(M){return M.preventDefault(),M.type.match(/^touch/)?M.changedTouches:M},H=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},F=function(M,p){p.top||p.right||p.bottom||p.left?(M.style.top=p.top,M.style.right=p.right,M.style.bottom=p.bottom,M.style.left=p.left):(M.style.left=p.x+"px",M.style.top=p.y+"px")},o=function(M,p,b){var Q=W(M);for(var q in Q)if(Q.hasOwnProperty(q))if("string"==typeof p)Q[q]=p+" "+b;else{for(var B="",k=0,u=p.length;k<u;k+=1)B+=p[k]+" "+b+", ";Q[q]=B.slice(0,-2)}return Q},W=function(M){var p={};return p[M]="",["webkit","Moz","o"].forEach((function(b){p[b+M.charAt(0).toUpperCase()+M.slice(1)]=""})),p},i=function(M,p){for(var b in p)p.hasOwnProperty(b)&&(M[b]=p[b]);return M},A=function(M,p){if(M.length)for(var b=0,Q=M.length;b<Q;b+=1)p(M[b]);else p(M)},j="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,K=window.matchMedia("(any-hover: none)").matches,D=!!("ontouchstart"in window),a=!!window.PointerEvent,s=!!window.MSPointerEvent,S={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},f={start:"mousedown",move:"mousemove",end:"mouseup"},R={};function y(){}j&&!K?b=S:a?b={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?b={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:D?(b=S,R=f):b=f,y.prototype.on=function(M,p){var b,Q=this,q=M.split(/[ ,]+/g);Q._handlers_=Q._handlers_||{};for(var B=0;B<q.length;B+=1)b=q[B],Q._handlers_[b]=Q._handlers_[b]||[],Q._handlers_[b].push(p);return Q},y.prototype.off=function(M,p){var b=this;return b._handlers_=b._handlers_||{},void 0===M?b._handlers_={}:void 0===p?b._handlers_[M]=null:b._handlers_[M]&&b._handlers_[M].indexOf(p)>=0&&b._handlers_[M].splice(b._handlers_[M].indexOf(p),1),b},y.prototype.trigger=function(M,p){var b,Q=this,q=M.split(/[ ,]+/g);Q._handlers_=Q._handlers_||{};for(var B=0;B<q.length;B+=1)b=q[B],Q._handlers_[b]&&Q._handlers_[b].length&&Q._handlers_[b].forEach((function(M){M.call(Q,{type:b,target:Q},p)}))},y.prototype.config=function(M){var p=this;p.options=p.defaults||{},M&&(p.options=function(M,p){var b={};for(var Q in M)M.hasOwnProperty(Q)&&p.hasOwnProperty(Q)?b[Q]=p[Q]:M.hasOwnProperty(Q)&&(b[Q]=M[Q]);return b}(p.options,M))},y.prototype.bindEvt=function(M,p){var Q=this;return Q._domHandlers_=Q._domHandlers_||{},Q._domHandlers_[p]=function(){"function"==typeof Q["on"+p]?Q["on"+p].apply(Q,arguments):console.warn('[WARNING] : Missing "on'+p+'" handler.')},u(M,b[p],Q._domHandlers_[p]),R[p]&&u(M,R[p],Q._domHandlers_[p]),Q},y.prototype.unbindEvt=function(M,p){var Q=this;return Q._domHandlers_=Q._domHandlers_||{},T(M,b[p],Q._domHandlers_[p]),R[p]&&T(M,R[p],Q._domHandlers_[p]),delete Q._domHandlers_[p],this};const x=y;function P(M,p){return this.identifier=p.identifier,this.position=p.position,this.frontPosition=p.frontPosition,this.collection=M,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(p),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=P.id,P.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}P.prototype=new x,P.constructor=P,P.id=0,P.prototype.buildEl=function(M){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},P.prototype.stylize=function(){if(this.options.dataOnly)return this;var M=this.options.fadeTime+"ms",p=function(){var M=W("borderRadius");for(var p in M)M.hasOwnProperty(p)&&(M[p]="50%");return M}(),b=o("transition","opacity",M),Q={};return Q.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},Q.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},Q.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},i(Q.el,b),"circle"===this.options.shape&&i(Q.back,p),i(Q.front,p),this.applyStyles(Q),this},P.prototype.applyStyles=function(M){for(var p in this.ui)if(this.ui.hasOwnProperty(p))for(var b in M[p])this.ui[p].style[b]=M[p][b];return this},P.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},P.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},P.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},P.prototype.show=function(M){var p=this;return p.options.dataOnly||(clearTimeout(p.removeTimeout),clearTimeout(p.showTimeout),clearTimeout(p.restTimeout),p.addToDom(),p.restCallback(),setTimeout((function(){p.ui.el.style.opacity=1}),0),p.showTimeout=setTimeout((function(){p.trigger("shown",p.instance),"function"==typeof M&&M.call(this)}),p.options.fadeTime)),p},P.prototype.hide=function(M){var p=this;if(p.options.dataOnly)return p;if(p.ui.el.style.opacity=p.options.restOpacity,clearTimeout(p.removeTimeout),clearTimeout(p.showTimeout),clearTimeout(p.restTimeout),p.removeTimeout=setTimeout((function(){var b="dynamic"===p.options.mode?"none":"block";p.ui.el.style.display=b,"function"==typeof M&&M.call(p),p.trigger("hidden",p.instance)}),p.options.fadeTime),p.options.restJoystick){var b=p.options.restJoystick,Q={};Q.x=!0===b||!1!==b.x?0:p.instance.frontPosition.x,Q.y=!0===b||!1!==b.y?0:p.instance.frontPosition.y,p.setPosition(M,Q)}return p},P.prototype.setPosition=function(M,p){var b=this;b.frontPosition={x:p.x,y:p.y};var Q=b.options.fadeTime+"ms",q={};q.front=o("transition",["transform"],Q);var B={front:{}};B.front={transform:"translate("+b.frontPosition.x+"px,"+b.frontPosition.y+"px)"},b.applyStyles(q),b.applyStyles(B),b.restTimeout=setTimeout((function(){"function"==typeof M&&M.call(b),b.restCallback()}),b.options.fadeTime)},P.prototype.restCallback=function(){var M=this,p={};p.front=o("transition","none",""),M.applyStyles(p),M.trigger("rested",M.instance)},P.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},P.prototype.computeDirection=function(M){var p,b,Q,q=M.angle.radian,B=Math.PI/4,k=Math.PI/2;if(q>B&&q<3*B&&!M.lockX?p="up":q>-B&&q<=B&&!M.lockY?p="left":q>3*-B&&q<=-B&&!M.lockX?p="down":M.lockY||(p="right"),M.lockY||(b=q>-k&&q<k?"left":"right"),M.lockX||(Q=q>0?"up":"down"),M.force>this.options.threshold){var u,T={};for(u in this.direction)this.direction.hasOwnProperty(u)&&(T[u]=this.direction[u]);var O={};for(u in this.direction={x:b,y:Q,angle:p},M.direction=this.direction,T)T[u]===this.direction[u]&&(O[u]=!0);if(O.x&&O.y&&O.angle)return M;O.x&&O.y||this.trigger("plain",M),O.x||this.trigger("plain:"+b,M),O.y||this.trigger("plain:"+Q,M),O.angle||this.trigger("dir dir:"+p,M)}else this.resetDirection();return M};const L=P;function N(M,p){var b=this;b.nipples=[],b.idles=[],b.actives=[],b.ids=[],b.pressureIntervals={},b.manager=M,b.id=N.id,N.id+=1,b.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},b.config(p),"static"!==b.options.mode&&"semi"!==b.options.mode||(b.options.multitouch=!1),b.options.multitouch||(b.options.maxNumberOfNipples=1);var Q=getComputedStyle(b.options.zone.parentElement);return Q&&"flex"===Q.display&&(b.parentIsFlex=!0),b.updateBox(),b.prepareNipples(),b.Fo(),b.begin(),b.nipples}N.prototype=new x,N.constructor=N,N.id=0,N.prototype.prepareNipples=function(){var M=this,p=M.nipples;p.on=M.on.bind(M),p.off=M.off.bind(M),p.options=M.options,p.destroy=M.destroy.bind(M),p.ids=M.ids,p.id=M.id,p.processOnMove=M.processOnMove.bind(M),p.processOnEnd=M.processOnEnd.bind(M),p.get=function(M){if(void 0===M)return p[0];for(var b=0,Q=p.length;b<Q;b+=1)if(p[b].identifier===M)return p[b];return!1}},N.prototype.Fo=function(){var M=this;M.bindEvt(M.options.zone,"start"),M.options.zone.style.touchAction="none",M.options.zone.style.msTouchAction="none"},N.prototype.begin=function(){var M=this,p=M.options;if("static"===p.mode){var b=M.createNipple(p.position,M.manager.getIdentifier());b.add(),M.idles.push(b)}},N.prototype.createNipple=function(M,p){var b=this,Q=b.manager.scroll,q={},B=b.options,k=b.parentIsFlex?Q.x:Q.x+b.box.left,u=b.parentIsFlex?Q.y:Q.y+b.box.top;if(M.x&&M.y)q={x:M.x-k,y:M.y-u};else if(M.top||M.right||M.bottom||M.left){var T=document.createElement("DIV");T.style.display="hidden",T.style.top=M.top,T.style.right=M.right,T.style.bottom=M.bottom,T.style.left=M.left,T.style.position="absolute",B.zone.appendChild(T);var O=T.getBoundingClientRect();B.zone.removeChild(T),q=M,M={x:O.left+Q.x,y:O.top+Q.y}}var H=new L(b,{color:B.color,size:B.size,threshold:B.threshold,fadeTime:B.fadeTime,dataOnly:B.dataOnly,restJoystick:B.restJoystick,restOpacity:B.restOpacity,mode:B.mode,identifier:p,position:M,zone:B.zone,frontPosition:{x:0,y:0},shape:B.shape});return B.dataOnly||(F(H.ui.el,q),F(H.ui.front,H.frontPosition)),b.nipples.push(H),b.trigger("added "+H.identifier+":added",H),b.manager.trigger("added "+H.identifier+":added",H),b.bindNipple(H),H},N.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},N.prototype.bindNipple=function(M){var p,b=this,Q=function(M,Q){p=M.type+" "+Q.id+":"+M.type,b.trigger(p,Q)};M.on("destroyed",b.onDestroyed.bind(b)),M.on("shown hidden rested dir plain",Q),M.on("dir:up dir:right dir:down dir:left",Q),M.on("plain:up plain:right plain:down plain:left",Q)},N.prototype.pressureFn=function(M,p,b){var Q=this,q=0;clearInterval(Q.pressureIntervals[b]),Q.pressureIntervals[b]=setInterval(function(){var b=M.force||M.pressure||M.webkitForce||0;b!==q&&(p.trigger("pressure",b),Q.trigger("pressure "+p.identifier+":pressure",b),q=b)}.bind(Q),100)},N.prototype.onstart=function(M){var p=this,b=p.options,Q=M;return M=O(M),p.updateBox(),A(M,(function(q){p.actives.length<b.maxNumberOfNipples?p.processOnStart(q):Q.type.match(/^touch/)&&(Object.keys(p.manager.ids).forEach((function(b){if(Object.values(Q.touches).findIndex((function(M){return M.identifier===b}))<0){var q=[M[0]];q.identifier=b,p.processOnEnd(q)}})),p.actives.length<b.maxNumberOfNipples&&p.processOnStart(q))})),p.manager.bindDocument(),!1},N.prototype.processOnStart=function(M){var p,b=this,q=b.options,B=b.manager.getIdentifier(M),k=M.force||M.pressure||M.webkitForce||0,u={x:M.pageX,y:M.pageY},T=b.getOrCreate(B,u);T.identifier!==B&&b.manager.removeIdentifier(T.identifier),T.identifier=B;var O=function(p){p.trigger("start",p),b.trigger("start "+p.id+":start",p),p.show(),k>0&&b.pressureFn(M,p,p.identifier),b.processOnMove(M)};if((p=b.idles.indexOf(T))>=0&&b.idles.splice(p,1),b.actives.push(T),b.ids.push(T.identifier),"semi"!==q.mode)O(T);else{if(!(Q(u,T.position)<=q.catchDistance))return T.destroy(),void b.processOnStart(M);O(T)}return T},N.prototype.getOrCreate=function(M,p){var b,Q=this,q=Q.options;return/(semi|static)/.test(q.mode)?(b=Q.idles[0])?(Q.idles.splice(0,1),b):"semi"===q.mode?Q.createNipple(p,M):(console.warn("Coudln't find the needed nipple."),!1):b=Q.createNipple(p,M)},N.prototype.processOnMove=function(M){var p=this,b=p.options,B=p.manager.getIdentifier(M),k=p.nipples.get(B),u=p.manager.scroll;if(function(M){return isNaN(M.buttons)?0!==M.pressure:0!==M.buttons}(M)){if(!k)return console.error("Found zombie joystick with ID "+B),void p.manager.removeIdentifier(B);if(b.dynamicPage){var T=k.el.getBoundingClientRect();k.position={x:u.x+T.left,y:u.y+T.top}}k.identifier=B;var O=k.options.size/2,H={x:M.pageX,y:M.pageY};b.lockX&&(H.y=k.position.y),b.lockY&&(H.x=k.position.x);var F,o,W,i,A,j,K,D,a,s,S=Q(H,k.position),f=(F=H,W=(o=k.position).x-F.x,i=o.y-F.y,function(M){return M*(180/Math.PI)}(Math.atan2(i,W))),R=q(f),y=S/O,x={distance:S,position:H};if("circle"===k.options.shape?(A=Math.min(S,O),K=k.position,D=A,s={x:0,y:0},a=q(a=f),s.x=K.x-D*Math.cos(a),s.y=K.y-D*Math.sin(a),j=s):(j=function(M,p,b){return{x:Math.min(Math.max(M.x,p.x-b),p.x+b),y:Math.min(Math.max(M.y,p.y-b),p.y+b)}}(H,k.position,O),A=Q(j,k.position)),b.follow){if(S>O){var P=H.x-j.x,L=H.y-j.y;k.position.x+=P,k.position.y+=L,k.el.style.top=k.position.y-(p.box.top+u.y)+"px",k.el.style.left=k.position.x-(p.box.left+u.x)+"px",S=Q(H,k.position)}}else H=j,S=A;var N=H.x-k.position.x,r=H.y-k.position.y;k.frontPosition={x:N,y:r},b.dataOnly||(k.ui.front.style.transform="translate("+N+"px,"+r+"px)");var Y={identifier:k.identifier,position:H,force:y,pressure:M.force||M.pressure||M.webkitForce||0,distance:S,angle:{radian:R,degree:f},vector:{x:N/O,y:-r/O},raw:x,instance:k,lockX:b.lockX,lockY:b.lockY};(Y=k.computeDirection(Y)).angle={radian:q(180-f),degree:180-f},k.trigger("move",Y),p.trigger("move "+k.id+":move",Y)}else this.processOnEnd(M)},N.prototype.processOnEnd=function(M){var p=this,b=p.options,Q=p.manager.getIdentifier(M),q=p.nipples.get(Q),B=p.manager.removeIdentifier(q.identifier);q&&(b.dataOnly||q.hide((function(){"dynamic"===b.mode&&(q.trigger("removed",q),p.trigger("removed "+q.id+":removed",q),p.manager.trigger("removed "+q.id+":removed",q),q.destroy())})),clearInterval(p.pressureIntervals[q.identifier]),q.resetDirection(),q.trigger("end",q),p.trigger("end "+q.id+":end",q),p.ids.indexOf(q.identifier)>=0&&p.ids.splice(p.ids.indexOf(q.identifier),1),p.actives.indexOf(q)>=0&&p.actives.splice(p.actives.indexOf(q),1),/(semi|static)/.test(b.mode)?p.idles.push(q):p.nipples.indexOf(q)>=0&&p.nipples.splice(p.nipples.indexOf(q),1),p.manager.unbindDocument(),/(semi|static)/.test(b.mode)&&(p.manager.ids[B.id]=B.identifier))},N.prototype.onDestroyed=function(M,p){var b=this;b.nipples.indexOf(p)>=0&&b.nipples.splice(b.nipples.indexOf(p),1),b.actives.indexOf(p)>=0&&b.actives.splice(b.actives.indexOf(p),1),b.idles.indexOf(p)>=0&&b.idles.splice(b.idles.indexOf(p),1),b.ids.indexOf(p.identifier)>=0&&b.ids.splice(b.ids.indexOf(p.identifier),1),b.manager.removeIdentifier(p.identifier),b.manager.unbindDocument()},N.prototype.destroy=function(){var M=this;for(var p in M.unbindEvt(M.options.zone,"start"),M.nipples.forEach((function(M){M.destroy()})),M.pressureIntervals)M.pressureIntervals.hasOwnProperty(p)&&clearInterval(M.pressureIntervals[p]);M.trigger("destroyed",M.nipples),M.manager.unbindDocument(),M.off()};const r=N;function Y(M){var p=this;p.ids={},p.index=0,p.collections=[],p.scroll=H(),p.config(M),p.prepareCollections();var b=function(){var M;p.collections.forEach((function(b){b.forEach((function(b){M=b.el.getBoundingClientRect(),b.position={x:p.scroll.x+M.left,y:p.scroll.y+M.top}}))}))};u(window,"resize",(function(){k(b)}));var Q=function(){p.scroll=H()};return u(window,"scroll",(function(){k(Q)})),p.collections}Y.prototype=new x,Y.constructor=Y,Y.prototype.prepareCollections=function(){var M=this;M.collections.create=M.create.bind(M),M.collections.on=M.on.bind(M),M.collections.off=M.off.bind(M),M.collections.destroy=M.destroy.bind(M),M.collections.get=function(p){var b;return M.collections.every((function(M){return!(b=M.get(p))})),b}},Y.prototype.create=function(M){return this.createCollection(M)},Y.prototype.createCollection=function(M){var p=this,b=new r(p,M);return p.bindCollection(b),p.collections.push(b),b},Y.prototype.bindCollection=function(M){var p,b=this,Q=function(M,Q){p=M.type+" "+Q.id+":"+M.type,b.trigger(p,Q)};M.on("destroyed",b.onDestroyed.bind(b)),M.on("shown hidden rested dir plain",Q),M.on("dir:up dir:right dir:down dir:left",Q),M.on("plain:up plain:right plain:down plain:left",Q)},Y.prototype.bindDocument=function(){var M=this;M.binded||(M.bindEvt(document,"move").bindEvt(document,"end"),M.binded=!0)},Y.prototype.unbindDocument=function(M){var p=this;Object.keys(p.ids).length&&!0!==M||(p.unbindEvt(document,"move").unbindEvt(document,"end"),p.binded=!1)},Y.prototype.getIdentifier=function(M){var p;return M?void 0===(p=void 0===M.identifier?M.pointerId:M.identifier)&&(p=this.latest||0):p=this.index,void 0===this.ids[p]&&(this.ids[p]=this.index,this.index+=1),this.latest=p,this.ids[p]},Y.prototype.removeIdentifier=function(M){var p={};for(var b in this.ids)if(this.ids[b]===M){p.id=b,p.identifier=this.ids[b],delete this.ids[b];break}return p},Y.prototype.onmove=function(M){return this.onAny("move",M),!1},Y.prototype.onend=function(M){return this.onAny("end",M),!1},Y.prototype.oncancel=function(M){return this.onAny("end",M),!1},Y.prototype.onAny=function(M,p){var b,Q=this,q="processOn"+M.charAt(0).toUpperCase()+M.slice(1);p=O(p);var B=function(M,p,b){b.ids.indexOf(p)>=0&&(b[q](M),M._found_=!0)};return A(p,(function(M){b=Q.getIdentifier(M),A(Q.collections,B.bind(null,M,b)),M._found_||Q.removeIdentifier(b)})),!1},Y.prototype.destroy=function(){var M=this;M.unbindDocument(!0),M.ids={},M.index=0,M.collections.forEach((function(M){M.destroy()})),M.off()},Y.prototype.onDestroyed=function(M,p){var b=this;if(b.collections.indexOf(p)<0)return!1;b.collections.splice(b.collections.indexOf(p),1)};var w=new Y;const E={create:function(M){return w.create(M)},factory:w};return p.default})(),M.exports=p()},12865:(M,p,b)=>{"use strict";const{Deflate:Q,deflate:q,deflateRaw:B,gzip:k}=b(12873),{Inflate:u,inflate:T,inflateRaw:O,ungzip:H}=b(12930),F=b(12901);M.exports.Deflate=Q,M.exports.deflate=q,M.exports.deflateRaw=B,M.exports.gzip=k,M.exports.Inflate=u,M.exports.inflate=T,M.exports.inflateRaw=O,M.exports.ungzip=H,M.exports.constants=F},12873:(M,p,b)=>{"use strict";const Q=b(12880),q=b(12908),B=b(12913),k=b(12898),u=b(12921),T=Object.prototype.toString,{Z_NO_FLUSH:O,Z_SYNC_FLUSH:H,Z_FULL_FLUSH:F,Z_FINISH:o,Z_OK:W,Z_STREAM_END:i,Z_DEFAULT_COMPRESSION:A,Z_DEFAULT_STRATEGY:j,Z_DEFLATED:K}=b(12901);function D(M){this.options=q.assign({level:A,method:K,dM:16384,windowBits:15,memLevel:8,strategy:j},M||{});let p=this.options;p.raw&&p.windowBits>0?p.windowBits=-p.windowBits:p.gzip&&p.windowBits>0&&p.windowBits<16&&(p.windowBits+=16),this.err=0,this.Op="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;let b=Q.deflateInit2(this.strm,p.level,p.method,p.windowBits,p.memLevel,p.strategy);if(b!==W)throw new Error(k[b]);if(p.header&&Q.deflateSetHeader(this.strm,p.header),p.dictionary){let M;if(M="string"===typeof p.dictionary?B.string2buf(p.dictionary):"[object ArrayBuffer]"===T.call(p.dictionary)?new Uint8Array(p.dictionary):p.dictionary,b=Q.deflateSetDictionary(this.strm,M),b!==W)throw new Error(k[b]);this._dict_set=!0}}function a(M,p){const b=new D(p);if(b.push(M,!0),b.err)throw b.Op||k[b.err];return b.result}D.prototype.push=function(M,p){const b=this.strm,q=this.options.dM;let k,u;if(this.ended)return!1;for(u=p===~~p?p:!0===p?o:O,"string"===typeof M?b.input=B.string2buf(M):"[object ArrayBuffer]"===T.call(M)?b.input=new Uint8Array(M):b.input=M,b.next_in=0,b.avail_in=b.input.length;;)if(0===b.avail_out&&(b.output=new Uint8Array(q),b.next_out=0,b.avail_out=q),(u===H||u===F)&&b.avail_out<=6)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else{if(k=Q.deflate(b,u),k===i)return b.next_out>0&&this.onData(b.output.subarray(0,b.next_out)),k=Q.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===W;if(0!==b.avail_out){if(u>0&&b.next_out>0)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else if(0===b.avail_in)break}else this.onData(b.output)}return!0},D.prototype.onData=function(M){this.chunks.push(M)},D.prototype.onEnd=function(M){M===W&&(this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.Op=this.strm.Op},M.exports.Deflate=D,M.exports.deflate=a,M.exports.deflateRaw=function(M,p){return(p=p||{}).raw=!0,a(M,p)},M.exports.gzip=function(M,p){return(p=p||{}).gzip=!0,a(M,p)},M.exports.constants=b(12901)},12930:(M,p,b)=>{"use strict";const Q=b(12937),q=b(12908),B=b(12913),k=b(12898),u=b(12921),T=b(12946),O=Object.prototype.toString,{Z_NO_FLUSH:H,Z_FINISH:F,Z_OK:o,Z_STREAM_END:W,Z_NEED_DICT:i,Z_STREAM_ERROR:A,Z_DATA_ERROR:j,Z_MEM_ERROR:K}=b(12901);function D(M){this.options=q.assign({dM:65536,windowBits:15,to:""},M||{});const p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,0===p.windowBits&&(p.windowBits=-15)),!(p.windowBits>=0&&p.windowBits<16)||M&&M.windowBits||(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&0===(15&p.windowBits)&&(p.windowBits|=15),this.err=0,this.Op="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;let b=Q.inflateInit2(this.strm,p.windowBits);if(b!==o)throw new Error(k[b]);if(this.header=new T,Q.inflateGetHeader(this.strm,this.header),p.dictionary&&("string"===typeof p.dictionary?p.dictionary=B.string2buf(p.dictionary):"[object ArrayBuffer]"===O.call(p.dictionary)&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(b=Q.inflateSetDictionary(this.strm,p.dictionary),b!==o)))throw new Error(k[b])}function a(M,p){const b=new D(p);if(b.push(M),b.err)throw b.Op||k[b.err];return b.result}D.prototype.push=function(M,p){const b=this.strm,q=this.options.dM,k=this.options.dictionary;let u,T,D;if(this.ended)return!1;for(T=p===~~p?p:!0===p?F:H,"[object ArrayBuffer]"===O.call(M)?b.input=new Uint8Array(M):b.input=M,b.next_in=0,b.avail_in=b.input.length;;){for(0===b.avail_out&&(b.output=new Uint8Array(q),b.next_out=0,b.avail_out=q),u=Q.inflate(b,T),u===i&&k&&(u=Q.inflateSetDictionary(b,k),u===o?u=Q.inflate(b,T):u===j&&(u=i));b.avail_in>0&&u===W&&b.state.wrap>0&&0!==M[b.next_in];)Q.inflateReset(b),u=Q.inflate(b,T);switch(u){case A:case j:case i:case K:return this.onEnd(u),this.ended=!0,!1}if(D=b.avail_out,b.next_out&&(0===b.avail_out||u===W))if("string"===this.options.to){let M=B.utf8border(b.output,b.next_out),p=b.next_out-M,Q=B.buf2string(b.output,M);b.next_out=p,b.avail_out=q-p,p&&b.output.set(b.output.subarray(M,M+p),0),this.onData(Q)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(u!==o||0!==D){if(u===W)return u=Q.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(0===b.avail_in)break}}return!0},D.prototype.onData=function(M){this.chunks.push(M)},D.prototype.onEnd=function(M){M===o&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.Op=this.strm.Op},M.exports.Inflate=D,M.exports.inflate=a,M.exports.inflateRaw=function(M,p){return(p=p||{}).raw=!0,a(M,p)},M.exports.ungzip=a,M.exports.constants=b(12901)},12908:M=>{"use strict";const p=(M,p)=>Object.prototype.hasOwnProperty.call(M,p);M.exports.assign=function(M){const b=Array.prototype.slice.call(arguments,1);for(;b.length;){const Q=b.shift();if(Q){if("object"!==typeof Q)throw new TypeError(Q+"must be non-object");for(const b in Q)p(Q,b)&&(M[b]=Q[b])}}return M},M.exports.flattenChunks=M=>{let p=0;for(let Q=0,q=M.length;Q<q;Q++)p+=M[Q].length;const b=new Uint8Array(p);for(let Q=0,q=0,B=M.length;Q<B;Q++){let p=M[Q];b.set(p,q),q+=p.length}return b}},12913:M=>{"use strict";let p=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Q){p=!1}const b=new Uint8Array(256);for(let q=0;q<256;q++)b[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;b[254]=b[254]=1,M.exports.string2buf=M=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(M);let p,b,Q,q,B,k=M.length,u=0;for(q=0;q<k;q++)b=M.charCodeAt(q),55296===(64512&b)&&q+1<k&&(Q=M.charCodeAt(q+1),56320===(64512&Q)&&(b=65536+(b-55296<<10)+(Q-56320),q++)),u+=b<128?1:b<2048?2:b<65536?3:4;for(p=new Uint8Array(u),B=0,q=0;B<u;q++)b=M.charCodeAt(q),55296===(64512&b)&&q+1<k&&(Q=M.charCodeAt(q+1),56320===(64512&Q)&&(b=65536+(b-55296<<10)+(Q-56320),q++)),b<128?p[B++]=b:b<2048?(p[B++]=192|b>>>6,p[B++]=128|63&b):b<65536?(p[B++]=224|b>>>12,p[B++]=128|b>>>6&63,p[B++]=128|63&b):(p[B++]=240|b>>>18,p[B++]=128|b>>>12&63,p[B++]=128|b>>>6&63,p[B++]=128|63&b);return p};M.exports.buf2string=(M,Q)=>{const q=Q||M.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(M.subarray(0,Q));let B,k;const u=new Array(2*q);for(k=0,B=0;B<q;){let p=M[B++];if(p<128){u[k++]=p;continue}let Q=b[p];if(Q>4)u[k++]=65533,B+=Q-1;else{for(p&=2===Q?31:3===Q?15:7;Q>1&&B<q;)p=p<<6|63&M[B++],Q--;Q>1?u[k++]=65533:p<65536?u[k++]=p:(p-=65536,u[k++]=55296|p>>10&1023,u[k++]=56320|1023&p)}}return((M,b)=>{if(b<65534&&M.subarray&&p)return String.fromCharCode.apply(null,M.length===b?M:M.subarray(0,b));let Q="";for(let p=0;p<b;p++)Q+=String.fromCharCode(M[p]);return Q})(u,k)},M.exports.utf8border=(M,p)=>{(p=p||M.length)>M.length&&(p=M.length);let Q=p-1;for(;Q>=0&&128===(192&M[Q]);)Q--;return Q<0||0===Q?p:Q+b[M[Q]]>p?Q:p}},12887:M=>{"use strict";M.exports=(M,p,b,Q)=>{let q=65535&M,B=M>>>16&65535,k=0;for(;0!==b;){k=b>2e3?2e3:b,b-=k;do{q=q+p[Q++]|0,B=B+q|0}while(--k);q%=65521,B%=65521}return q|B<<16}},12901:M=>{"use strict";M.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12892:M=>{"use strict";const p=new Uint32Array((()=>{let M,p=[];for(var b=0;b<256;b++){M=b;for(var Q=0;Q<8;Q++)M=1&M?3988292384^M>>>1:M>>>1;p[b]=M}return p})());M.exports=(M,b,Q,q)=>{const B=p,k=q+Q;M^=-1;for(let p=q;p<k;p++)M=M>>>8^B[255&(M^b[p])];return~M}},12880:(M,p,b)=>{"use strict";const{_tr_init:Q,_tr_stored_block:q,_tr_flush_block:B,_tr_tally:k,_tr_align:u}=b(12884),T=b(12887),O=b(12892),H=b(12898),{Z_NO_FLUSH:F,Z_PARTIAL_FLUSH:o,Z_FULL_FLUSH:W,Z_FINISH:i,Z_BLOCK:A,Z_OK:j,Z_STREAM_END:K,Z_STREAM_ERROR:D,Z_DATA_ERROR:a,Z_BUF_ERROR:s,Z_DEFAULT_COMPRESSION:S,Z_FILTERED:f,Z_HUFFMAN_ONLY:R,Z_RLE:y,Z_FIXED:x,Z_DEFAULT_STRATEGY:P,Z_UNKNOWN:L,Z_DEFLATED:N}=b(12901),r=258,Y=262,w=103,E=113,n=666,g=(M,p)=>(M.Op=H[p],p),U=M=>(M<<1)-(M>4?9:0),c=M=>{let p=M.length;for(;--p>=0;)M[p]=0};let d=(M,p,b)=>(p<<M.hash_shift^b)&M.hash_mask;const V=M=>{const p=M.state;let b=p.pending;b>M.avail_out&&(b=M.avail_out),0!==b&&(M.output.set(p.pending_buf.subarray(p.pending_out,p.pending_out+b),M.next_out),M.next_out+=b,p.pending_out+=b,M.total_out+=b,M.avail_out-=b,p.pending-=b,0===p.pending&&(p.pending_out=0))},h=(M,p)=>{B(M,M.block_start>=0?M.block_start:-1,M.strstart-M.block_start,p),M.block_start=M.strstart,V(M.strm)},I=(M,p)=>{M.pending_buf[M.pending++]=p},Z=(M,p)=>{M.pending_buf[M.pending++]=p>>>8&255,M.pending_buf[M.pending++]=255&p},J=(M,p,b,Q)=>{let q=M.avail_in;return q>Q&&(q=Q),0===q?0:(M.avail_in-=q,p.set(M.input.subarray(M.next_in,M.next_in+q),b),1===M.state.wrap?M.adler=T(M.adler,p,q,b):2===M.state.wrap&&(M.adler=O(M.adler,p,q,b)),M.next_in+=q,M.total_in+=q,q)},v=(M,p)=>{let b,Q,q=M.max_chain_length,B=M.strstart,k=M.prev_length,u=M.nice_match;const T=M.strstart>M.w_size-Y?M.strstart-(M.w_size-Y):0,O=M.window,H=M.w_mask,F=M.prev,o=M.strstart+r;let W=O[B+k-1],i=O[B+k];M.prev_length>=M.good_match&&(q>>=2),u>M.lookahead&&(u=M.lookahead);do{if(b=p,O[b+k]===i&&O[b+k-1]===W&&O[b]===O[B]&&O[++b]===O[B+1]){B+=2,b++;do{}while(O[++B]===O[++b]&&O[++B]===O[++b]&&O[++B]===O[++b]&&O[++B]===O[++b]&&O[++B]===O[++b]&&O[++B]===O[++b]&&O[++B]===O[++b]&&O[++B]===O[++b]&&B<o);if(Q=r-(o-B),B=o-r,Q>k){if(M.match_start=p,k=Q,Q>=u)break;W=O[B+k-1],i=O[B+k]}}}while((p=F[p&H])>T&&0!==--q);return k<=M.lookahead?k:M.lookahead},z=M=>{const p=M.w_size;let b,Q,q,B,k;do{if(B=M.window_size-M.lookahead-M.strstart,M.strstart>=p+(p-Y)){M.window.set(M.window.subarray(p,p+p),0),M.match_start-=p,M.strstart-=p,M.block_start-=p,Q=M.hash_size,b=Q;do{q=M.head[--b],M.head[b]=q>=p?q-p:0}while(--Q);Q=p,b=Q;do{q=M.prev[--b],M.prev[b]=q>=p?q-p:0}while(--Q);B+=p}if(0===M.strm.avail_in)break;if(Q=J(M.strm,M.window,M.strstart+M.lookahead,B),M.lookahead+=Q,M.lookahead+M.insert>=3)for(k=M.strstart-M.insert,M.ins_h=M.window[k],M.ins_h=d(M,M.ins_h,M.window[k+1]);M.insert&&(M.ins_h=d(M,M.ins_h,M.window[k+3-1]),M.prev[k&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=k,k++,M.insert--,!(M.lookahead+M.insert<3)););}while(M.lookahead<Y&&0!==M.strm.avail_in)},t=(M,p)=>{let b,Q;for(;;){if(M.lookahead<Y){if(z(M),M.lookahead<Y&&p===F)return 1;if(0===M.lookahead)break}if(b=0,M.lookahead>=3&&(M.ins_h=d(M,M.ins_h,M.window[M.strstart+3-1]),b=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),0!==b&&M.strstart-b<=M.w_size-Y&&(M.match_length=v(M,b)),M.match_length>=3)if(Q=k(M,M.strstart-M.match_start,M.match_length-3),M.lookahead-=M.match_length,M.match_length<=M.max_lazy_match&&M.lookahead>=3){M.match_length--;do{M.strstart++,M.ins_h=d(M,M.ins_h,M.window[M.strstart+3-1]),b=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart}while(0!==--M.match_length);M.strstart++}else M.strstart+=M.match_length,M.match_length=0,M.ins_h=M.window[M.strstart],M.ins_h=d(M,M.ins_h,M.window[M.strstart+1]);else Q=k(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++;if(Q&&(h(M,!1),0===M.strm.avail_out))return 1}return M.insert=M.strstart<2?M.strstart:2,p===i?(h(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(h(M,!1),0===M.strm.avail_out)?1:2},e=(M,p)=>{let b,Q,q;for(;;){if(M.lookahead<Y){if(z(M),M.lookahead<Y&&p===F)return 1;if(0===M.lookahead)break}if(b=0,M.lookahead>=3&&(M.ins_h=d(M,M.ins_h,M.window[M.strstart+3-1]),b=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),M.prev_length=M.match_length,M.prev_match=M.match_start,M.match_length=2,0!==b&&M.prev_length<M.max_lazy_match&&M.strstart-b<=M.w_size-Y&&(M.match_length=v(M,b),M.match_length<=5&&(M.strategy===f||3===M.match_length&&M.strstart-M.match_start>4096)&&(M.match_length=2)),M.prev_length>=3&&M.match_length<=M.prev_length){q=M.strstart+M.lookahead-3,Q=k(M,M.strstart-1-M.prev_match,M.prev_length-3),M.lookahead-=M.prev_length-1,M.prev_length-=2;do{++M.strstart<=q&&(M.ins_h=d(M,M.ins_h,M.window[M.strstart+3-1]),b=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart)}while(0!==--M.prev_length);if(M.match_available=0,M.match_length=2,M.strstart++,Q&&(h(M,!1),0===M.strm.avail_out))return 1}else if(M.match_available){if(Q=k(M,0,M.window[M.strstart-1]),Q&&h(M,!1),M.strstart++,M.lookahead--,0===M.strm.avail_out)return 1}else M.match_available=1,M.strstart++,M.lookahead--}return M.match_available&&(Q=k(M,0,M.window[M.strstart-1]),M.match_available=0),M.insert=M.strstart<2?M.strstart:2,p===i?(h(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(h(M,!1),0===M.strm.avail_out)?1:2};function G(M,p,b,Q,q){this.good_length=M,this.max_lazy=p,this.nice_length=b,this.max_chain=Q,this.func=q}const mM=[new G(0,0,0,0,((M,p)=>{let b=65535;for(b>M.pending_buf_size-5&&(b=M.pending_buf_size-5);;){if(M.lookahead<=1){if(z(M),0===M.lookahead&&p===F)return 1;if(0===M.lookahead)break}M.strstart+=M.lookahead,M.lookahead=0;const Q=M.block_start+b;if((0===M.strstart||M.strstart>=Q)&&(M.lookahead=M.strstart-Q,M.strstart=Q,h(M,!1),0===M.strm.avail_out))return 1;if(M.strstart-M.block_start>=M.w_size-Y&&(h(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,p===i?(h(M,!0),0===M.strm.avail_out?3:4):(M.strstart>M.block_start&&(h(M,!1),M.strm.avail_out),1)})),new G(4,4,8,4,t),new G(4,5,16,8,t),new G(4,6,32,32,t),new G(4,4,16,16,e),new G(8,16,32,32,e),new G(8,16,128,128,e),new G(8,32,128,256,e),new G(32,128,258,1024,e),new G(32,258,258,4096,e)];function C(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=N,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),c(this.dyn_ltree),c(this.dyn_dtree),c(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),c(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),c(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const X=M=>{if(!M||!M.state)return g(M,D);M.total_in=M.total_out=0,M.data_type=L;const p=M.state;return p.pending=0,p.pending_out=0,p.wrap<0&&(p.wrap=-p.wrap),p.status=p.wrap?42:E,M.adler=2===p.wrap?0:1,p.last_flush=F,Q(p),j},l=M=>{const p=X(M);var b;return p===j&&((b=M.state).window_size=2*b.w_size,c(b.head),b.max_lazy_match=mM[b.level].max_lazy,b.good_match=mM[b.level].good_length,b.nice_match=mM[b.level].nice_length,b.max_chain_length=mM[b.level].max_chain,b.strstart=0,b.block_start=0,b.lookahead=0,b.insert=0,b.match_length=b.prev_length=2,b.match_available=0,b.ins_h=0),p},MM=(M,p,b,Q,q,B)=>{if(!M)return D;let k=1;if(p===S&&(p=6),Q<0?(k=0,Q=-Q):Q>15&&(k=2,Q-=16),q<1||q>9||b!==N||Q<8||Q>15||p<0||p>9||B<0||B>x)return g(M,D);8===Q&&(Q=9);const u=new C;return M.state=u,u.strm=M,u.wrap=k,u.gzhead=null,u.w_bits=Q,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=q+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<q+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=p,u.strategy=B,u.method=b,l(M)};M.exports.deflateInit=(M,p)=>MM(M,p,N,15,8,P),M.exports.deflateInit2=MM,M.exports.deflateReset=l,M.exports.deflateResetKeep=X,M.exports.deflateSetHeader=(M,p)=>M&&M.state?2!==M.state.wrap?D:(M.state.gzhead=p,j):D,M.exports.deflate=(M,p)=>{let b,Q;if(!M||!M.state||p>A||p<0)return M?g(M,D):D;const B=M.state;if(!M.output||!M.input&&0!==M.avail_in||B.status===n&&p!==i)return g(M,0===M.avail_out?s:D);B.strm=M;const T=B.last_flush;if(B.last_flush=p,42===B.status)if(2===B.wrap)M.adler=0,I(B,31),I(B,139),I(B,8),B.gzhead?(I(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),I(B,255&B.gzhead.time),I(B,B.gzhead.time>>8&255),I(B,B.gzhead.time>>16&255),I(B,B.gzhead.time>>24&255),I(B,9===B.level?2:B.strategy>=R||B.level<2?4:0),I(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(I(B,255&B.gzhead.extra.length),I(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(M.adler=O(M.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(I(B,0),I(B,0),I(B,0),I(B,0),I(B,0),I(B,9===B.level?2:B.strategy>=R||B.level<2?4:0),I(B,3),B.status=E);else{let p=N+(B.w_bits-8<<4)<<8,b=-1;b=B.strategy>=R||B.level<2?0:B.level<6?1:6===B.level?2:3,p|=b<<6,0!==B.strstart&&(p|=32),p+=31-p%31,B.status=E,Z(B,p),0!==B.strstart&&(Z(B,M.adler>>>16),Z(B,65535&M.adler)),M.adler=1}if(69===B.status)if(B.gzhead.extra){for(b=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>b&&(M.adler=O(M.adler,B.pending_buf,B.pending-b,b)),V(M),b=B.pending,B.pending!==B.pending_buf_size));)I(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>b&&(M.adler=O(M.adler,B.pending_buf,B.pending-b,b)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(73===B.status)if(B.gzhead.name){b=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>b&&(M.adler=O(M.adler,B.pending_buf,B.pending-b,b)),V(M),b=B.pending,B.pending===B.pending_buf_size)){Q=1;break}Q=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,I(B,Q)}while(0!==Q);B.gzhead.hcrc&&B.pending>b&&(M.adler=O(M.adler,B.pending_buf,B.pending-b,b)),0===Q&&(B.gzindex=0,B.status=91)}else B.status=91;if(91===B.status)if(B.gzhead.comment){b=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>b&&(M.adler=O(M.adler,B.pending_buf,B.pending-b,b)),V(M),b=B.pending,B.pending===B.pending_buf_size)){Q=1;break}Q=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,I(B,Q)}while(0!==Q);B.gzhead.hcrc&&B.pending>b&&(M.adler=O(M.adler,B.pending_buf,B.pending-b,b)),0===Q&&(B.status=w)}else B.status=w;if(B.status===w&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&V(M),B.pending+2<=B.pending_buf_size&&(I(B,255&M.adler),I(B,M.adler>>8&255),M.adler=0,B.status=E)):B.status=E),0!==B.pending){if(V(M),0===M.avail_out)return B.last_flush=-1,j}else if(0===M.avail_in&&U(p)<=U(T)&&p!==i)return g(M,s);if(B.status===n&&0!==M.avail_in)return g(M,s);if(0!==M.avail_in||0!==B.lookahead||p!==F&&B.status!==n){let b=B.strategy===R?((M,p)=>{let b;for(;;){if(0===M.lookahead&&(z(M),0===M.lookahead)){if(p===F)return 1;break}if(M.match_length=0,b=k(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++,b&&(h(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,p===i?(h(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(h(M,!1),0===M.strm.avail_out)?1:2})(B,p):B.strategy===y?((M,p)=>{let b,Q,q,B;const u=M.window;for(;;){if(M.lookahead<=r){if(z(M),M.lookahead<=r&&p===F)return 1;if(0===M.lookahead)break}if(M.match_length=0,M.lookahead>=3&&M.strstart>0&&(q=M.strstart-1,Q=u[q],Q===u[++q]&&Q===u[++q]&&Q===u[++q])){B=M.strstart+r;do{}while(Q===u[++q]&&Q===u[++q]&&Q===u[++q]&&Q===u[++q]&&Q===u[++q]&&Q===u[++q]&&Q===u[++q]&&Q===u[++q]&&q<B);M.match_length=r-(B-q),M.match_length>M.lookahead&&(M.match_length=M.lookahead)}if(M.match_length>=3?(b=k(M,1,M.match_length-3),M.lookahead-=M.match_length,M.strstart+=M.match_length,M.match_length=0):(b=k(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++),b&&(h(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,p===i?(h(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(h(M,!1),0===M.strm.avail_out)?1:2})(B,p):mM[B.level].func(B,p);if(3!==b&&4!==b||(B.status=n),1===b||3===b)return 0===M.avail_out&&(B.last_flush=-1),j;if(2===b&&(p===o?u(B):p!==A&&(q(B,0,0,!1),p===W&&(c(B.head),0===B.lookahead&&(B.strstart=0,B.block_start=0,B.insert=0))),V(M),0===M.avail_out))return B.last_flush=-1,j}return p!==i?j:B.wrap<=0?K:(2===B.wrap?(I(B,255&M.adler),I(B,M.adler>>8&255),I(B,M.adler>>16&255),I(B,M.adler>>24&255),I(B,255&M.total_in),I(B,M.total_in>>8&255),I(B,M.total_in>>16&255),I(B,M.total_in>>24&255)):(Z(B,M.adler>>>16),Z(B,65535&M.adler)),V(M),B.wrap>0&&(B.wrap=-B.wrap),0!==B.pending?j:K)},M.exports.deflateEnd=M=>{if(!M||!M.state)return D;const p=M.state.status;return 42!==p&&69!==p&&73!==p&&91!==p&&p!==w&&p!==E&&p!==n?g(M,D):(M.state=null,p===E?g(M,a):j)},M.exports.deflateSetDictionary=(M,p)=>{let b=p.length;if(!M||!M.state)return D;const Q=M.state,q=Q.wrap;if(2===q||1===q&&42!==Q.status||Q.lookahead)return D;if(1===q&&(M.adler=T(M.adler,p,b,0)),Q.wrap=0,b>=Q.w_size){0===q&&(c(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0);let M=new Uint8Array(Q.w_size);M.set(p.subarray(b-Q.w_size,b),0),p=M,b=Q.w_size}const B=M.avail_in,k=M.next_in,u=M.input;for(M.avail_in=b,M.next_in=0,M.input=p,z(Q);Q.lookahead>=3;){let M=Q.strstart,p=Q.lookahead-2;do{Q.ins_h=d(Q,Q.ins_h,Q.window[M+3-1]),Q.prev[M&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=M,M++}while(--p);Q.strstart=M,Q.lookahead=2,z(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=2,Q.match_available=0,M.next_in=k,M.input=u,M.avail_in=B,Q.wrap=q,j},M.exports.deflateInfo="pako deflate (from Nodeca project)"},12946:M=>{"use strict";M.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12939:M=>{"use strict";M.exports=function(M,p){let b,Q,q,B,k,u,T,O,H,F,o,W,i,A,j,K,D,a,s,S,f,R,y,x;const P=M.state;b=M.next_in,y=M.input,Q=b+(M.avail_in-5),q=M.next_out,x=M.output,B=q-(p-M.avail_out),k=q+(M.avail_out-257),u=P.dmax,T=P.wsize,O=P.whave,H=P.wnext,F=P.window,o=P.hold,W=P.bits,i=P.lencode,A=P.distcode,j=(1<<P.lenbits)-1,K=(1<<P.distbits)-1;M:do{W<15&&(o+=y[b++]<<W,W+=8,o+=y[b++]<<W,W+=8),D=i[o&j];p:for(;;){if(a=D>>>24,o>>>=a,W-=a,a=D>>>16&255,0===a)x[q++]=65535&D;else{if(!(16&a)){if(0===(64&a)){D=i[(65535&D)+(o&(1<<a)-1)];continue p}if(32&a){P.mode=12;break M}M.Op="invalid literal/length code",P.mode=30;break M}s=65535&D,a&=15,a&&(W<a&&(o+=y[b++]<<W,W+=8),s+=o&(1<<a)-1,o>>>=a,W-=a),W<15&&(o+=y[b++]<<W,W+=8,o+=y[b++]<<W,W+=8),D=A[o&K];b:for(;;){if(a=D>>>24,o>>>=a,W-=a,a=D>>>16&255,!(16&a)){if(0===(64&a)){D=A[(65535&D)+(o&(1<<a)-1)];continue b}M.Op="invalid distance code",P.mode=30;break M}if(S=65535&D,a&=15,W<a&&(o+=y[b++]<<W,W+=8,W<a&&(o+=y[b++]<<W,W+=8)),S+=o&(1<<a)-1,S>u){M.Op="invalid distance too far back",P.mode=30;break M}if(o>>>=a,W-=a,a=q-B,S>a){if(a=S-a,a>O&&P.sane){M.Op="invalid distance too far back",P.mode=30;break M}if(f=0,R=F,0===H){if(f+=T-a,a<s){s-=a;do{x[q++]=F[f++]}while(--a);f=q-S,R=x}}else if(H<a){if(f+=T+H-a,a-=H,a<s){s-=a;do{x[q++]=F[f++]}while(--a);if(f=0,H<s){a=H,s-=a;do{x[q++]=F[f++]}while(--a);f=q-S,R=x}}}else if(f+=H-a,a<s){s-=a;do{x[q++]=F[f++]}while(--a);f=q-S,R=x}for(;s>2;)x[q++]=R[f++],x[q++]=R[f++],x[q++]=R[f++],s-=3;s&&(x[q++]=R[f++],s>1&&(x[q++]=R[f++]))}else{f=q-S;do{x[q++]=x[f++],x[q++]=x[f++],x[q++]=x[f++],s-=3}while(s>2);s&&(x[q++]=x[f++],s>1&&(x[q++]=x[f++]))}break}}break}}while(b<Q&&q<k);s=W>>3,b-=s,W-=s<<3,o&=(1<<W)-1,M.next_in=b,M.next_out=q,M.avail_in=b<Q?Q-b+5:5-(b-Q),M.avail_out=q<k?k-q+257:257-(q-k),P.hold=o,P.bits=W}},12937:(M,p,b)=>{"use strict";const Q=b(12887),q=b(12892),B=b(12939),k=b(12941),{Z_FINISH:u,Z_BLOCK:T,Z_TREES:O,Z_OK:H,Z_STREAM_END:F,Z_NEED_DICT:o,Z_STREAM_ERROR:W,Z_DATA_ERROR:i,Z_MEM_ERROR:A,Z_BUF_ERROR:j,Z_DEFLATED:K}=b(12901),D=12,a=30,s=M=>(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24);function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const f=M=>{if(!M||!M.state)return W;const p=M.state;return M.total_in=M.total_out=p.total=0,M.Op="",p.wrap&&(M.adler=1&p.wrap),p.mode=1,p.last=0,p.havedict=0,p.dmax=32768,p.head=null,p.hold=0,p.bits=0,p.lencode=p.lendyn=new Int32Array(852),p.distcode=p.distdyn=new Int32Array(592),p.sane=1,p.back=-1,H},R=M=>{if(!M||!M.state)return W;const p=M.state;return p.wsize=0,p.whave=0,p.wnext=0,f(M)},y=(M,p)=>{let b;if(!M||!M.state)return W;const Q=M.state;return p<0?(b=0,p=-p):(b=1+(p>>4),p<48&&(p&=15)),p&&(p<8||p>15)?W:(null!==Q.window&&Q.wbits!==p&&(Q.window=null),Q.wrap=b,Q.wbits=p,R(M))},x=(M,p)=>{if(!M)return W;const b=new S;M.state=b,b.window=null;const Q=y(M,p);return Q!==H&&(M.state=null),Q};let P,L,N=!0;const r=M=>{if(N){P=new Int32Array(512),L=new Int32Array(32);let p=0;for(;p<144;)M.lens[p++]=8;for(;p<256;)M.lens[p++]=9;for(;p<280;)M.lens[p++]=7;for(;p<288;)M.lens[p++]=8;for(k(1,M.lens,0,288,P,0,M.work,{bits:9}),p=0;p<32;)M.lens[p++]=5;k(2,M.lens,0,32,L,0,M.work,{bits:5}),N=!1}M.lencode=P,M.lenbits=9,M.distcode=L,M.distbits=5},Y=(M,p,b,Q)=>{let q;const B=M.state;return null===B.window&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new Uint8Array(B.wsize)),Q>=B.wsize?(B.window.set(p.subarray(b-B.wsize,b),0),B.wnext=0,B.whave=B.wsize):(q=B.wsize-B.wnext,q>Q&&(q=Q),B.window.set(p.subarray(b-Q,b-Q+q),B.wnext),(Q-=q)?(B.window.set(p.subarray(b-Q,b),0),B.wnext=Q,B.whave=B.wsize):(B.wnext+=q,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=q))),0};M.exports.inflateReset=R,M.exports.inflateReset2=y,M.exports.inflateResetKeep=f,M.exports.inflateInit=M=>x(M,15),M.exports.inflateInit2=x,M.exports.inflate=(M,p)=>{let b,S,f,R,y,x,P,L,N,w,E,n,g,U,c,d,V,h,I,Z,J,v,z=0;const t=new Uint8Array(4);let e,G;const mM=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!M||!M.state||!M.output||!M.input&&0!==M.avail_in)return W;b=M.state,b.mode===D&&(b.mode=13),y=M.next_out,f=M.output,P=M.avail_out,R=M.next_in,S=M.input,x=M.avail_in,L=b.hold,N=b.bits,w=x,E=P,v=H;M:for(;;)switch(b.mode){case 1:if(0===b.wrap){b.mode=13;break}for(;N<16;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if(2&b.wrap&&35615===L){b.check=0,t[0]=255&L,t[1]=L>>>8&255,b.check=q(b.check,t,2,0),L=0,N=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&L)<<8)+(L>>8))%31){M.Op="incorrect header check",b.mode=a;break}if((15&L)!==K){M.Op="unknown compression method",b.mode=a;break}if(L>>>=4,N-=4,J=8+(15&L),0===b.wbits)b.wbits=J;else if(J>b.wbits){M.Op="invalid window size",b.mode=a;break}b.dmax=1<<b.wbits,M.adler=b.check=1,b.mode=512&L?10:D,L=0,N=0;break;case 2:for(;N<16;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if(b.flags=L,(255&b.flags)!==K){M.Op="unknown compression method",b.mode=a;break}if(57344&b.flags){M.Op="unknown header flags set",b.mode=a;break}b.head&&(b.head.text=L>>8&1),512&b.flags&&(t[0]=255&L,t[1]=L>>>8&255,b.check=q(b.check,t,2,0)),L=0,N=0,b.mode=3;case 3:for(;N<32;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}b.head&&(b.head.time=L),512&b.flags&&(t[0]=255&L,t[1]=L>>>8&255,t[2]=L>>>16&255,t[3]=L>>>24&255,b.check=q(b.check,t,4,0)),L=0,N=0,b.mode=4;case 4:for(;N<16;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}b.head&&(b.head.xflags=255&L,b.head.os=L>>8),512&b.flags&&(t[0]=255&L,t[1]=L>>>8&255,b.check=q(b.check,t,2,0)),L=0,N=0,b.mode=5;case 5:if(1024&b.flags){for(;N<16;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}b.length=L,b.head&&(b.head.extra_len=L),512&b.flags&&(t[0]=255&L,t[1]=L>>>8&255,b.check=q(b.check,t,2,0)),L=0,N=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(n=b.length,n>x&&(n=x),n&&(b.head&&(J=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Uint8Array(b.head.extra_len)),b.head.extra.set(S.subarray(R,R+n),J)),512&b.flags&&(b.check=q(b.check,S,n,R)),x-=n,R+=n,b.length-=n),b.length))break M;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(0===x)break M;n=0;do{J=S[R+n++],b.head&&J&&b.length<65536&&(b.head.name+=String.fromCharCode(J))}while(J&&n<x);if(512&b.flags&&(b.check=q(b.check,S,n,R)),x-=n,R+=n,J)break M}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(0===x)break M;n=0;do{J=S[R+n++],b.head&&J&&b.length<65536&&(b.head.comment+=String.fromCharCode(J))}while(J&&n<x);if(512&b.flags&&(b.check=q(b.check,S,n,R)),x-=n,R+=n,J)break M}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;N<16;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if(L!==(65535&b.check)){M.Op="header crc mismatch",b.mode=a;break}L=0,N=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),M.adler=b.check=0,b.mode=D;break;case 10:for(;N<32;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}M.adler=b.check=s(L),L=0,N=0,b.mode=11;case 11:if(0===b.havedict)return M.next_out=y,M.avail_out=P,M.next_in=R,M.avail_in=x,b.hold=L,b.bits=N,o;M.adler=b.check=1,b.mode=D;case D:if(p===T||p===O)break M;case 13:if(b.last){L>>>=7&N,N-=7&N,b.mode=27;break}for(;N<3;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}switch(b.last=1&L,L>>>=1,N-=1,3&L){case 0:b.mode=14;break;case 1:if(r(b),b.mode=20,p===O){L>>>=2,N-=2;break M}break;case 2:b.mode=17;break;case 3:M.Op="invalid block type",b.mode=a}L>>>=2,N-=2;break;case 14:for(L>>>=7&N,N-=7&N;N<32;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if((65535&L)!==(L>>>16^65535)){M.Op="invalid stored block lengths",b.mode=a;break}if(b.length=65535&L,L=0,N=0,b.mode=15,p===O)break M;case 15:b.mode=16;case 16:if(n=b.length,n){if(n>x&&(n=x),n>P&&(n=P),0===n)break M;f.set(S.subarray(R,R+n),y),x-=n,R+=n,P-=n,y+=n,b.length-=n;break}b.mode=D;break;case 17:for(;N<14;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if(b.nlen=257+(31&L),L>>>=5,N-=5,b.ndist=1+(31&L),L>>>=5,N-=5,b.ncode=4+(15&L),L>>>=4,N-=4,b.nlen>286||b.ndist>30){M.Op="too many length or distance symbols",b.mode=a;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;N<3;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}b.lens[mM[b.have++]]=7&L,L>>>=3,N-=3}for(;b.have<19;)b.lens[mM[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,e={bits:b.lenbits},v=k(0,b.lens,0,19,b.lencode,0,b.work,e),b.lenbits=e.bits,v){M.Op="invalid code lengths set",b.mode=a;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;z=b.lencode[L&(1<<b.lenbits)-1],c=z>>>24,d=z>>>16&255,V=65535&z,!(c<=N);){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if(V<16)L>>>=c,N-=c,b.lens[b.have++]=V;else{if(16===V){for(G=c+2;N<G;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if(L>>>=c,N-=c,0===b.have){M.Op="invalid bit length repeat",b.mode=a;break}J=b.lens[b.have-1],n=3+(3&L),L>>>=2,N-=2}else if(17===V){for(G=c+3;N<G;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}L>>>=c,N-=c,J=0,n=3+(7&L),L>>>=3,N-=3}else{for(G=c+7;N<G;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}L>>>=c,N-=c,J=0,n=11+(127&L),L>>>=7,N-=7}if(b.have+n>b.nlen+b.ndist){M.Op="invalid bit length repeat",b.mode=a;break}for(;n--;)b.lens[b.have++]=J}}if(b.mode===a)break;if(0===b.lens[256]){M.Op="invalid code -- missing end-of-block",b.mode=a;break}if(b.lenbits=9,e={bits:b.lenbits},v=k(1,b.lens,0,b.nlen,b.lencode,0,b.work,e),b.lenbits=e.bits,v){M.Op="invalid literal/lengths set",b.mode=a;break}if(b.distbits=6,b.distcode=b.distdyn,e={bits:b.distbits},v=k(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,e),b.distbits=e.bits,v){M.Op="invalid distances set",b.mode=a;break}if(b.mode=20,p===O)break M;case 20:b.mode=21;case 21:if(x>=6&&P>=258){M.next_out=y,M.avail_out=P,M.next_in=R,M.avail_in=x,b.hold=L,b.bits=N,B(M,E),y=M.next_out,f=M.output,P=M.avail_out,R=M.next_in,S=M.input,x=M.avail_in,L=b.hold,N=b.bits,b.mode===D&&(b.back=-1);break}for(b.back=0;z=b.lencode[L&(1<<b.lenbits)-1],c=z>>>24,d=z>>>16&255,V=65535&z,!(c<=N);){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if(d&&0===(240&d)){for(h=c,I=d,Z=V;z=b.lencode[Z+((L&(1<<h+I)-1)>>h)],c=z>>>24,d=z>>>16&255,V=65535&z,!(h+c<=N);){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}L>>>=h,N-=h,b.back+=h}if(L>>>=c,N-=c,b.back+=c,b.length=V,0===d){b.mode=26;break}if(32&d){b.back=-1,b.mode=D;break}if(64&d){M.Op="invalid literal/length code",b.mode=a;break}b.extra=15&d,b.mode=22;case 22:if(b.extra){for(G=b.extra;N<G;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}b.length+=L&(1<<b.extra)-1,L>>>=b.extra,N-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;z=b.distcode[L&(1<<b.distbits)-1],c=z>>>24,d=z>>>16&255,V=65535&z,!(c<=N);){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if(0===(240&d)){for(h=c,I=d,Z=V;z=b.distcode[Z+((L&(1<<h+I)-1)>>h)],c=z>>>24,d=z>>>16&255,V=65535&z,!(h+c<=N);){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}L>>>=h,N-=h,b.back+=h}if(L>>>=c,N-=c,b.back+=c,64&d){M.Op="invalid distance code",b.mode=a;break}b.offset=V,b.extra=15&d,b.mode=24;case 24:if(b.extra){for(G=b.extra;N<G;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}b.offset+=L&(1<<b.extra)-1,L>>>=b.extra,N-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){M.Op="invalid distance too far back",b.mode=a;break}b.mode=25;case 25:if(0===P)break M;if(n=E-P,b.offset>n){if(n=b.offset-n,n>b.whave&&b.sane){M.Op="invalid distance too far back",b.mode=a;break}n>b.wnext?(n-=b.wnext,g=b.wsize-n):g=b.wnext-n,n>b.length&&(n=b.length),U=b.window}else U=f,g=y-b.offset,n=b.length;n>P&&(n=P),P-=n,b.length-=n;do{f[y++]=U[g++]}while(--n);0===b.length&&(b.mode=21);break;case 26:if(0===P)break M;f[y++]=b.length,P--,b.mode=21;break;case 27:if(b.wrap){for(;N<32;){if(0===x)break M;x--,L|=S[R++]<<N,N+=8}if(E-=P,M.total_out+=E,b.total+=E,E&&(M.adler=b.check=b.flags?q(b.check,f,E,y-E):Q(b.check,f,E,y-E)),E=P,(b.flags?L:s(L))!==b.check){M.Op="incorrect data check",b.mode=a;break}L=0,N=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;N<32;){if(0===x)break M;x--,L+=S[R++]<<N,N+=8}if(L!==(4294967295&b.total)){M.Op="incorrect length check",b.mode=a;break}L=0,N=0}b.mode=29;case 29:v=F;break M;case a:v=i;break M;case 31:return A;default:return W}return M.next_out=y,M.avail_out=P,M.next_in=R,M.avail_in=x,b.hold=L,b.bits=N,(b.wsize||E!==M.avail_out&&b.mode<a&&(b.mode<27||p!==u))&&Y(M,M.output,M.next_out,E-M.avail_out)?(b.mode=31,A):(w-=M.avail_in,E-=M.avail_out,M.total_in+=w,M.total_out+=E,b.total+=E,b.wrap&&E&&(M.adler=b.check=b.flags?q(b.check,f,E,M.next_out-E):Q(b.check,f,E,M.next_out-E)),M.data_type=b.bits+(b.last?64:0)+(b.mode===D?128:0)+(20===b.mode||15===b.mode?256:0),(0===w&&0===E||p===u)&&v===H&&(v=j),v)},M.exports.inflateEnd=M=>{if(!M||!M.state)return W;let p=M.state;return p.window&&(p.window=null),M.state=null,H},M.exports.inflateGetHeader=(M,p)=>{if(!M||!M.state)return W;const b=M.state;return 0===(2&b.wrap)?W:(b.head=p,p.done=!1,H)},M.exports.inflateSetDictionary=(M,p)=>{const b=p.length;let q,B,k;return M&&M.state?(q=M.state,0!==q.wrap&&11!==q.mode?W:11===q.mode&&(B=1,B=Q(B,p,b,0),B!==q.check)?i:(k=Y(M,p,b,b),k?(q.mode=31,A):(q.havedict=1,H))):W},M.exports.inflateInfo="pako inflate (from Nodeca project)"},12941:M=>{"use strict";const p=15,b=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Q=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),q=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),B=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);M.exports=(M,k,u,T,O,H,F,o)=>{const W=o.bits;let i,A,j,K,D,a,s=0,S=0,f=0,R=0,y=0,x=0,P=0,L=0,N=0,r=0,Y=null,w=0;const E=new Uint16Array(16),n=new Uint16Array(16);let g,U,c,d=null,V=0;for(s=0;s<=p;s++)E[s]=0;for(S=0;S<T;S++)E[k[u+S]]++;for(y=W,R=p;R>=1&&0===E[R];R--);if(y>R&&(y=R),0===R)return O[H++]=20971520,O[H++]=20971520,o.bits=1,0;for(f=1;f<R&&0===E[f];f++);for(y<f&&(y=f),L=1,s=1;s<=p;s++)if(L<<=1,L-=E[s],L<0)return-1;if(L>0&&(0===M||1!==R))return-1;for(n[1]=0,s=1;s<p;s++)n[s+1]=n[s]+E[s];for(S=0;S<T;S++)0!==k[u+S]&&(F[n[k[u+S]]++]=S);if(0===M?(Y=d=F,a=19):1===M?(Y=b,w-=257,d=Q,V-=257,a=256):(Y=q,d=B,a=-1),r=0,S=0,s=f,D=H,x=y,P=0,j=-1,N=1<<y,K=N-1,1===M&&N>852||2===M&&N>592)return 1;for(;;){g=s-P,F[S]<a?(U=0,c=F[S]):F[S]>a?(U=d[V+F[S]],c=Y[w+F[S]]):(U=96,c=0),i=1<<s-P,A=1<<x,f=A;do{A-=i,O[D+(r>>P)+A]=g<<24|U<<16|c}while(0!==A);for(i=1<<s-1;r&i;)i>>=1;if(0!==i?(r&=i-1,r+=i):r=0,S++,0===--E[s]){if(s===R)break;s=k[u+F[S]]}if(s>y&&(r&K)!==j){for(0===P&&(P=y),D+=f,x=s-P,L=1<<x;x+P<R&&(L-=E[x+P],!(L<=0));)x++,L<<=1;if(N+=1<<x,1===M&&N>852||2===M&&N>592)return 1;j=r&K,O[j]=y<<24|x<<16|D-H}}return 0!==r&&(O[D+r]=s-P<<24|64<<16),o.bits=y,0}},12898:M=>{"use strict";M.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12884:M=>{"use strict";function p(M){let p=M.length;for(;--p>=0;)M[p]=0}const b=256,Q=286,q=30,B=15,k=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),u=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),T=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),H=new Array(576);p(H);const F=new Array(60);p(F);const o=new Array(512);p(o);const W=new Array(256);p(W);const i=new Array(29);p(i);const A=new Array(q);function j(M,p,b,Q,q){this.static_tree=M,this.extra_bits=p,this.extra_base=b,this.elems=Q,this.max_length=q,this.has_stree=M&&M.length}let K,D,a;function s(M,p){this.dyn_tree=M,this.max_code=0,this.stat_desc=p}p(A);const S=M=>M<256?o[M]:o[256+(M>>>7)],f=(M,p)=>{M.pending_buf[M.pending++]=255&p,M.pending_buf[M.pending++]=p>>>8&255},R=(M,p,b)=>{M.bi_valid>16-b?(M.bi_buf|=p<<M.bi_valid&65535,f(M,M.bi_buf),M.bi_buf=p>>16-M.bi_valid,M.bi_valid+=b-16):(M.bi_buf|=p<<M.bi_valid&65535,M.bi_valid+=b)},y=(M,p,b)=>{R(M,b[2*p],b[2*p+1])},x=(M,p)=>{let b=0;do{b|=1&M,M>>>=1,b<<=1}while(--p>0);return b>>>1},P=(M,p,b)=>{const Q=new Array(16);let q,k,u=0;for(q=1;q<=B;q++)Q[q]=u=u+b[q-1]<<1;for(k=0;k<=p;k++){let p=M[2*k+1];0!==p&&(M[2*k]=x(Q[p]++,p))}},L=M=>{let p;for(p=0;p<Q;p++)M.dyn_ltree[2*p]=0;for(p=0;p<q;p++)M.dyn_dtree[2*p]=0;for(p=0;p<19;p++)M.bl_tree[2*p]=0;M.dyn_ltree[512]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0},N=M=>{M.bi_valid>8?f(M,M.bi_buf):M.bi_valid>0&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0},r=(M,p,b,Q)=>{const q=2*p,B=2*b;return M[q]<M[B]||M[q]===M[B]&&Q[p]<=Q[b]},Y=(M,p,b)=>{const Q=M.heap[b];let q=b<<1;for(;q<=M.heap_len&&(q<M.heap_len&&r(p,M.heap[q+1],M.heap[q],M.depth)&&q++,!r(p,Q,M.heap[q],M.depth));)M.heap[b]=M.heap[q],b=q,q<<=1;M.heap[b]=Q},w=(M,p,Q)=>{let q,B,T,O,H=0;if(0!==M.last_lit)do{q=M.pending_buf[M.d_buf+2*H]<<8|M.pending_buf[M.d_buf+2*H+1],B=M.pending_buf[M.l_buf+H],H++,0===q?y(M,B,p):(T=W[B],y(M,T+b+1,p),O=k[T],0!==O&&(B-=i[T],R(M,B,O)),q--,T=S(q),y(M,T,Q),O=u[T],0!==O&&(q-=A[T],R(M,q,O)))}while(H<M.last_lit);y(M,256,p)},E=(M,p)=>{const b=p.dyn_tree,Q=p.stat_desc.static_tree,q=p.stat_desc.has_stree,k=p.stat_desc.elems;let u,T,O,H=-1;for(M.heap_len=0,M.heap_max=573,u=0;u<k;u++)0!==b[2*u]?(M.heap[++M.heap_len]=H=u,M.depth[u]=0):b[2*u+1]=0;for(;M.heap_len<2;)O=M.heap[++M.heap_len]=H<2?++H:0,b[2*O]=1,M.depth[O]=0,M.opt_len--,q&&(M.static_len-=Q[2*O+1]);for(p.max_code=H,u=M.heap_len>>1;u>=1;u--)Y(M,b,u);O=k;do{u=M.heap[1],M.heap[1]=M.heap[M.heap_len--],Y(M,b,1),T=M.heap[1],M.heap[--M.heap_max]=u,M.heap[--M.heap_max]=T,b[2*O]=b[2*u]+b[2*T],M.depth[O]=(M.depth[u]>=M.depth[T]?M.depth[u]:M.depth[T])+1,b[2*u+1]=b[2*T+1]=O,M.heap[1]=O++,Y(M,b,1)}while(M.heap_len>=2);M.heap[--M.heap_max]=M.heap[1],((M,p)=>{const b=p.dyn_tree,Q=p.max_code,q=p.stat_desc.static_tree,k=p.stat_desc.has_stree,u=p.stat_desc.extra_bits,T=p.stat_desc.extra_base,O=p.stat_desc.max_length;let H,F,o,W,i,A,j=0;for(W=0;W<=B;W++)M.bl_count[W]=0;for(b[2*M.heap[M.heap_max]+1]=0,H=M.heap_max+1;H<573;H++)F=M.heap[H],W=b[2*b[2*F+1]+1]+1,W>O&&(W=O,j++),b[2*F+1]=W,F>Q||(M.bl_count[W]++,i=0,F>=T&&(i=u[F-T]),A=b[2*F],M.opt_len+=A*(W+i),k&&(M.static_len+=A*(q[2*F+1]+i)));if(0!==j){do{for(W=O-1;0===M.bl_count[W];)W--;M.bl_count[W]--,M.bl_count[W+1]+=2,M.bl_count[O]--,j-=2}while(j>0);for(W=O;0!==W;W--)for(F=M.bl_count[W];0!==F;)o=M.heap[--H],o>Q||(b[2*o+1]!==W&&(M.opt_len+=(W-b[2*o+1])*b[2*o],b[2*o+1]=W),F--)}})(M,p),P(b,H,M.bl_count)},n=(M,p,b)=>{let Q,q,B=-1,k=p[1],u=0,T=7,O=4;for(0===k&&(T=138,O=3),p[2*(b+1)+1]=65535,Q=0;Q<=b;Q++)q=k,k=p[2*(Q+1)+1],++u<T&&q===k||(u<O?M.bl_tree[2*q]+=u:0!==q?(q!==B&&M.bl_tree[2*q]++,M.bl_tree[32]++):u<=10?M.bl_tree[34]++:M.bl_tree[36]++,u=0,B=q,0===k?(T=138,O=3):q===k?(T=6,O=3):(T=7,O=4))},g=(M,p,b)=>{let Q,q,B=-1,k=p[1],u=0,T=7,O=4;for(0===k&&(T=138,O=3),Q=0;Q<=b;Q++)if(q=k,k=p[2*(Q+1)+1],!(++u<T&&q===k)){if(u<O)do{y(M,q,M.bl_tree)}while(0!==--u);else 0!==q?(q!==B&&(y(M,q,M.bl_tree),u--),y(M,16,M.bl_tree),R(M,u-3,2)):u<=10?(y(M,17,M.bl_tree),R(M,u-3,3)):(y(M,18,M.bl_tree),R(M,u-11,7));u=0,B=q,0===k?(T=138,O=3):q===k?(T=6,O=3):(T=7,O=4)}};let U=!1;const c=(M,p,b,Q)=>{R(M,0+(Q?1:0),3),((M,p,b,Q)=>{N(M),Q&&(f(M,b),f(M,~b)),M.pending_buf.set(M.window.subarray(p,p+b),M.pending),M.pending+=b})(M,p,b,!0)};M.exports._tr_init=M=>{U||((()=>{let M,p,b,O,s;const S=new Array(16);for(b=0,O=0;O<28;O++)for(i[O]=b,M=0;M<1<<k[O];M++)W[b++]=O;for(W[b-1]=O,s=0,O=0;O<16;O++)for(A[O]=s,M=0;M<1<<u[O];M++)o[s++]=O;for(s>>=7;O<q;O++)for(A[O]=s<<7,M=0;M<1<<u[O]-7;M++)o[256+s++]=O;for(p=0;p<=B;p++)S[p]=0;for(M=0;M<=143;)H[2*M+1]=8,M++,S[8]++;for(;M<=255;)H[2*M+1]=9,M++,S[9]++;for(;M<=279;)H[2*M+1]=7,M++,S[7]++;for(;M<=287;)H[2*M+1]=8,M++,S[8]++;for(P(H,287,S),M=0;M<q;M++)F[2*M+1]=5,F[2*M]=x(M,5);K=new j(H,k,257,Q,B),D=new j(F,u,0,q,B),a=new j(new Array(0),T,0,19,7)})(),U=!0),M.l_desc=new s(M.dyn_ltree,K),M.d_desc=new s(M.dyn_dtree,D),M.bl_desc=new s(M.bl_tree,a),M.bi_buf=0,M.bi_valid=0,L(M)},M.exports._tr_stored_block=c,M.exports._tr_flush_block=(M,p,Q,q)=>{let B,k,u=0;M.level>0?(2===M.strm.data_type&&(M.strm.data_type=(M=>{let p,Q=4093624447;for(p=0;p<=31;p++,Q>>>=1)if(1&Q&&0!==M.dyn_ltree[2*p])return 0;if(0!==M.dyn_ltree[18]||0!==M.dyn_ltree[20]||0!==M.dyn_ltree[26])return 1;for(p=32;p<b;p++)if(0!==M.dyn_ltree[2*p])return 1;return 0})(M)),E(M,M.l_desc),E(M,M.d_desc),u=(M=>{let p;for(n(M,M.dyn_ltree,M.l_desc.max_code),n(M,M.dyn_dtree,M.d_desc.max_code),E(M,M.bl_desc),p=18;p>=3&&0===M.bl_tree[2*O[p]+1];p--);return M.opt_len+=3*(p+1)+5+5+4,p})(M),B=M.opt_len+3+7>>>3,k=M.static_len+3+7>>>3,k<=B&&(B=k)):B=k=Q+5,Q+4<=B&&-1!==p?c(M,p,Q,q):4===M.strategy||k===B?(R(M,2+(q?1:0),3),w(M,H,F)):(R(M,4+(q?1:0),3),((M,p,b,Q)=>{let q;for(R(M,p-257,5),R(M,b-1,5),R(M,Q-4,4),q=0;q<Q;q++)R(M,M.bl_tree[2*O[q]+1],3);g(M,M.dyn_ltree,p-1),g(M,M.dyn_dtree,b-1)})(M,M.l_desc.max_code+1,M.d_desc.max_code+1,u+1),w(M,M.dyn_ltree,M.dyn_dtree)),L(M),q&&N(M)},M.exports._tr_tally=(M,p,Q)=>(M.pending_buf[M.d_buf+2*M.last_lit]=p>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&p,M.pending_buf[M.l_buf+M.last_lit]=255&Q,M.last_lit++,0===p?M.dyn_ltree[2*Q]++:(M.matches++,p--,M.dyn_ltree[2*(W[Q]+b+1)]++,M.dyn_dtree[2*S(p)]++),M.last_lit===M.lit_bufsize-1),M.exports._tr_align=M=>{R(M,2,3),y(M,256,H),(M=>{16===M.bi_valid?(f(M,M.bi_buf),M.bi_buf=0,M.bi_valid=0):M.bi_valid>=8&&(M.pending_buf[M.pending++]=255&M.bi_buf,M.bi_buf>>=8,M.bi_valid-=8)})(M)}},12921:M=>{"use strict";M.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Op="",this.state=null,this.data_type=2,this.adler=0}},12580:M=>{function p(M,p,b){for(var Q=M.length,q=-1/0,B=1/0,k=0;k<Q;k++){var u=(b[0][k]-M[k])/p[k],T=(b[1][k]-M[k])/p[k];if(u>T){var O=u;u=T,T=O}if(T<q||u>B)return 1/0;u>q&&(q=u),T<B&&(B=T)}return q>B?1/0:q}M.exports=function(M,b,Q,q){var B=p(b,Q,q);if(B===1/0)M=null;else{M=M||[];for(var k=0;k<b.length;k++)M[k]=b[k]+Q[k]*B}return M},M.exports.distance=p},13909:(M,p,b)=>{"use strict";b.d(p,{c:()=>k});var Q=b(34);const q=Q.useLayoutEffect;const B=function(M){var p=(0,Q.useRef)(M);return q((function(){p.current=M})),p};var k=function(M){var p=B(M);(0,Q.kp)((function(){var M=function(M){var b;if(null!=p.current&&(b=p.current(M)),M.defaultPrevented&&(M.returnValue=""),"string"===typeof b)return M.returnValue=b,b};return window.addEventListener("beforeunload",M),function(){window.removeEventListener("beforeunload",M)}}),[])}},13858:(M,p,b)=>{"use strict";var Q=b(13864),q=Array.prototype.concat,B=Array.prototype.slice,k=M.exports=function(M){for(var p=[],b=0,k=M.length;b<k;b++){var u=M[b];Q(u)?p=q.call(p,B.call(u)):p.push(u)}return p};k.wrap=function(M){return function(){return M(k(arguments))}}},13864:M=>{M.exports=function(M){return!(!M||"string"===typeof M)&&(M instanceof Array||Array.isArray(M)||M.length>=0&&(M.splice instanceof Function||Object.getOwnPropertyDescriptor(M,M.length-1)&&"String"!==M.constructor.name))}},12832:(M,p,b)=>{var Q=b(12835);function q(M){for(var p,b,q=0,B=M.length,k=0;k<M.length;){for(p=M[k],b=0;k<B&&M[k]===p;)++k,++b;q+=Q.log2(b)/7|0,q+=Q.log2(p>>>0)/7|0,q+=2}return q}p.size=q,p.encode=function(M,p){p||(p=new Uint8Array(q(M)));for(var b,Q,B=0,k=p.length,u=0;u<M.length;){for(b=M[u],Q=0;u<M.length&&M[u]===b;)++u,++Q;for(;B<k&&Q>=128;)p[B++]=128+(127&Q),Q>>>=7;if(B>=k)throw new Error("RLE buffer overflow");for(p[B++]=Q,b>>>=0;B<k&&b>=128;)p[B++]=128+(127&b),b>>>=7;if(B>=k)throw new Error("RLE buffer overflow");p[B++]=b}return p},p.decode=function(M,p){for(var b,Q,q,B,k=p.length,u=M.length,T=0,O=0;O<u;){for(b=0,Q=0;O<u&&M[O]>=128;)b+=(127&M[O++])<<Q,Q+=7;if(b+=M[O++]<<Q,O>=u)throw new Error("RLE buffer underrun");if(T+b>k)throw new Error("Chunk buffer overflow");for(q=0,Q=0;O<u&&M[O]>=128;)q+=(127&M[O++])<<Q,Q+=7;if(O>=u)throw new Error("RLE buffer underrun");for(q+=M[O++]<<Q,B=0;B<b;++B)p[T++]=q}return p}},12835:(M,p)=>{"use strict";function b(M){var p=32;return(M&=-M)&&p--,65535&M&&(p-=16),16711935&M&&(p-=8),252645135&M&&(p-=4),858993459&M&&(p-=2),1431655765&M&&(p-=1),p}p.INT_BITS=32,p.INT_MAX=2147483647,p.INT_MIN=-1<<31,p.sign=function(M){return(M>0)-(M<0)},p.abs=function(M){var p=M>>31;return(M^p)-p},p.min=function(M,p){return p^(M^p)&-(M<p)},p.max=function(M,p){return M^(M^p)&-(M<p)},p.isPow2=function(M){return!(M&M-1)&&!!M},p.log2=function(M){var p,b;return p=(M>65535)<<4,p|=b=((M>>>=p)>255)<<3,p|=b=((M>>>=b)>15)<<2,(p|=b=((M>>>=b)>3)<<1)|(M>>>=b)>>1},p.log10=function(M){return M>=1e9?9:M>=1e8?8:M>=1e7?7:M>=1e6?6:M>=1e5?5:M>=1e4?4:M>=1e3?3:M>=100?2:M>=10?1:0},p.popCount=function(M){return 16843009*((M=(858993459&(M-=M>>>1&1431655765))+(M>>>2&858993459))+(M>>>4)&252645135)>>>24},p.countTrailingZeros=b,p.nextPow2=function(M){return M+=0===M,--M,M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)+1},p.prevPow2=function(M){return M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)-(M>>>1)},p.parity=function(M){return M^=M>>>16,M^=M>>>8,M^=M>>>4,27030>>>(M&=15)&1};var Q=new Array(256);!function(M){for(var p=0;p<256;++p){var b=p,Q=p,q=7;for(b>>>=1;b;b>>>=1)Q<<=1,Q|=1&b,--q;M[p]=Q<<q&255}}(Q),p.reverse=function(M){return Q[255&M]<<24|Q[M>>>8&255]<<16|Q[M>>>16&255]<<8|Q[M>>>24&255]},p.interleave2=function(M,p){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))<<1},p.deinterleave2=function(M,p){return(M=65535&((M=16711935&((M=252645135&((M=858993459&((M=M>>>p&1431655765)|M>>>1))|M>>>2))|M>>>4))|M>>>16))<<16>>16},p.interleave3=function(M,p,b){return M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2),(M|=(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},p.deinterleave3=function(M,p){return(M=1023&((M=4278190335&((M=251719695&((M=3272356035&((M=M>>>p&1227133513)|M>>>2))|M>>>4))|M>>>8))|M>>>16))<<22>>22},p.nextCombination=function(M){var p=M|M-1;return p+1|(~p&-~p)-1>>>b(M)+1}},12862:M=>{"use strict";M.exports=function(M,p,b,Q){var q=self||window;try{try{var B;try{B=new q.Blob([M])}catch(O){(B=new(q.BlobBuilder||q.WebKitBlobBuilder||q.MozBlobBuilder||q.MSBlobBuilder)).append(M),B=B.getBlob()}var k=q.URL||q.webkitURL,u=k.createObjectURL(B),T=new q[p](u,b);return k.revokeObjectURL(u),T}catch(O){return new q[p]("data:application/javascript,".concat(encodeURIComponent(M)),b)}}catch(O){if(!Q)throw Error("Inline worker is not supported");return new q[p](Q,b)}}},12566:(M,p,b)=>{"use strict";function Q(M,p,b,Q,q){var B={};return Object.keys(Q).forEach((function(M){B[M]=Q[M]})),B.enumerable=!!B.enumerable,B.configurable=!!B.configurable,("value"in B||B.initializer)&&(B.writable=!0),B=b.slice().reverse().reduce((function(b,Q){return Q(M,p,b)||b}),B),q&&void 0!==B.initializer&&(B.value=B.initializer?B.initializer.call(q):void 0,B.initializer=void 0),void 0===B.initializer&&(Object.defineProperty(M,p,B),B=null),B}b.d(p,{c:()=>Q})},12558:(M,p,b)=>{"use strict";function Q(M,p,b,Q){b&&Object.defineProperty(M,p,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(Q):void 0})}b.d(p,{d:()=>Q})},13897:(M,p,b)=>{"use strict";b.d(p,{d:()=>k,h:()=>F,i:()=>u,k:()=>B,m:()=>T,p:()=>q,t:()=>O,w:()=>H});var Q=b(12001);class q{constructor(){this._easingMode=q.EASINGMODE_EASEIN}setEasingMode(M){const p=Math.min(Math.max(M,0),2);this._easingMode=p}getEasingMode(){return this._easingMode}easeInCore(M){throw new Error("You must implement this method")}ease(M){switch(this._easingMode){case q.EASINGMODE_EASEIN:return this.easeInCore(M);case q.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-M)}return M>=.5?.5*(1-this.easeInCore(2*(1-M)))+.5:.5*this.easeInCore(2*M)}}q.EASINGMODE_EASEIN=0,q.EASINGMODE_EASEOUT=1,q.EASINGMODE_EASEINOUT=2;class B extends q{easeInCore(M){return M=Math.max(0,Math.min(1,M)),1-Math.sqrt(1-M*M)}}class k extends q{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=M}easeInCore(M){const p=Math.max(0,this.amplitude);return Math.pow(M,3)-M*p*Math.sin(3.141592653589793*M)}}class u extends q{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=M,this.bounciness=p}easeInCore(M){const p=Math.max(0,this.bounces);let b=this.bounciness;b<=1&&(b=1.001);const Q=Math.pow(b,p),q=1-b,B=(1-Q)/q+.5*Q,k=M*B,u=Math.log(-k*(1-b)+1)/Math.log(b),T=Math.floor(u),O=T+1,H=(1-Math.pow(b,T))/(q*B),F=.5*(H+(1-Math.pow(b,O))/(q*B)),o=M-F,W=F-H;return-Math.pow(1/b,p-T)/(W*W)*(o-W)*(o+W)}}class T extends q{easeInCore(M){return M*M*M}}class O extends q{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=M,this.springiness=p}easeInCore(M){let p;const b=Math.max(0,this.oscillations),Q=Math.max(0,this.springiness);return p=0==Q?M:(Math.exp(Q*M)-1)/(Math.exp(Q)-1),p*Math.sin((6.283185307179586*b+1.5707963267948966)*M)}}class H extends q{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=M}easeInCore(M){return this.exponent<=0?M:(Math.exp(this.exponent*M)-1)/(Math.exp(this.exponent)-1)}}class F extends q{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=M,this.y1=p,this.x2=b,this.y2=Q}easeInCore(M){return Q.b.Interpolate(M,this.x1,this.y1,this.x2,this.y2)}}},13385:(M,p,b)=>{"use strict";b.d(p,{d:()=>k});var Q=b(11796),q=b(11800),B=b(12236);class k extends B.d{get _matrix(){return this._compose(),this.Lo}set _matrix(M){(M.updateFlag!==this.Lo.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Lo.B(M),this._markAsDirtyAndDecompose())}constructor(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(M,p.RM(),!1),this.name=M,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=p,this.Lo=(null===q||void 0===q?void 0:q.clone())??Q.Matrix.Identity(),this._restMatrix=B??this.Lo.clone(),this._bindMatrix=k??this.Lo.clone(),this._index=u,this._absoluteMatrix=new Q.Matrix,this._absoluteBindMatrix=new Q.Matrix,this._absoluteInverseBindMatrix=new Q.Matrix,this._finalMatrix=new Q.Matrix,p.bones.push(this),this.setParent(b,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(M){this.setParent(M)}setParent(M){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==M){if(this.parent){const M=this.parent.children.indexOf(this);-1!==M&&this.parent.children.splice(M,1)}this._parentNode=M,this.parent&&this.parent.children.push(this),p&&this._updateAbsoluteBindMatrices(),this.XO()}}getLocalMatrix(){return this._compose(),this.Lo}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(M){this._restMatrix.B(M)}setRestPose(M){this.setRestMatrix(M)}getBindPose(){return this.getBindMatrix()}setBindMatrix(M){this.ob(M)}setBindPose(M){this.setBindMatrix(M)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const M=Q.TmpVectors.Ap[0],p=Q.TmpVectors.Quaternion[0],b=Q.TmpVectors.Ap[1];this.getRestMatrix().decompose(M,p,b),this._linkedTransformNode.position.B(b),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Q.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.B(p),this._linkedTransformNode.ab.B(M)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(M){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=M,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.QT}set position(M){this._decompose(),this.QT.B(M),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(M){this.setRotation(M)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(M){this.setRotationQuaternion(M)}get ab(){return this.getScale()}set ab(M){this.setScale(M)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=Q.Ap.Zero(),this._localRotation=Q.Quaternion.Zero(),this.QT=Q.Ap.Zero()),this.Lo.decompose(this._localScaling,this._localRotation,this.QT))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Q.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.QT,this.Lo)):this._needToCompose=!1)}ob(M){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.B(M),p&&this._updateAbsoluteBindMatrices(),b?this._matrix=M:this.XO()}_updateAbsoluteBindMatrices(M){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(M||(M=this._bindMatrix),this.parent?M.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.B(M),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),p)for(let b=0;b<this.children.length;b++)this.children[b]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}XO(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.XO(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.XO(),this._needToDecompose=!0}_updatePosition(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=this.getLocalMatrix();if(0==p)q?(B.addAtIndex(12,M.x),B.addAtIndex(13,M.y),B.addAtIndex(14,M.z)):B.setTranslationFromFloats(M.x,M.y,M.z);else{let p=null;b&&(p=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const u=k._TmpMats[0],T=k._TmpVecs[0];this.parent?b&&p?(u.B(this.parent.getAbsoluteMatrix()),u.multiplyToRef(p,u)):u.B(this.parent.getAbsoluteMatrix()):Q.Matrix.IdentityToRef(u),q&&u.setTranslationFromFloats(0,0,0),u.invert(),Q.Ap.TransformCoordinatesToRef(M,u,T),q?(B.addAtIndex(12,T.x),B.addAtIndex(13,T.y),B.addAtIndex(14,T.z)):B.setTranslationFromFloats(T.x,T.y,T.z)}this._markAsDirtyAndDecompose()}translate(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(M,p,b,!0)}setPosition(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(M,p,b,!1)}setAbsolutePosition(M,p){this.setPosition(M,1,p)}scale(M,p,b){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=this.getLocalMatrix(),u=k._TmpMats[0];Q.Matrix.ScalingToRef(M,p,b,u),u.multiplyToRef(B,B),u.invert();for(const Q of this.children){const q=Q.getLocalMatrix();q.multiplyToRef(u,q),q.multiplyAtIndex(12,M),q.multiplyAtIndex(13,p),q.multiplyAtIndex(14,b),Q._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),q)for(const Q of this.children)Q.scale(M,p,b,q)}setScale(M){this._decompose(),this._localScaling.B(M),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(M){this._decompose(),M.B(this._localScaling)}setYawPitchRoll(M,p,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4?arguments[4]:void 0;if(0===q){const u=k._TmpQuat;return Q.Quaternion.RotationYawPitchRollToRef(M,p,b,u),void this.setRotationQuaternion(u,q,B)}const u=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,B))return;const T=k._TmpMats[1];Q.Matrix.RotationYawPitchRollToRef(M,p,b,T),u.multiplyToRef(T,T),this._rotateWithMatrix(T,q,B)}rotate(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;const B=k._TmpMats[0];B.setTranslationFromFloats(0,0,0),Q.Matrix.RotationAxisToRef(M,p,B),this._rotateWithMatrix(B,b,q)}setAxisAngle(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;if(0===b){const B=k._TmpQuat;return Q.Quaternion.RotationAxisToRef(M,p,B),void this.setRotationQuaternion(B,b,q)}const B=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,q))return;const u=k._TmpMats[1];Q.Matrix.RotationAxisToRef(M,p,u),B.multiplyToRef(u,u),this._rotateWithMatrix(u,b,q)}setRotation(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(M.y,M.x,M.z,p,b)}setRotationQuaternion(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===p)return this._decompose(),this._localRotation.B(M),void this._markAsDirtyAndCompose();const q=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,b))return;const B=k._TmpMats[1];Q.Matrix.FromQuaternionToRef(M,B),q.multiplyToRef(B,B),this._rotateWithMatrix(B,p,b)}setRotationMatrix(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===p){const q=k._TmpQuat;return Q.Quaternion.FromRotationMatrixToRef(M,q),void this.setRotationQuaternion(q,p,b)}const q=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,b))return;const B=k._TmpMats[1];B.B(M),q.multiplyToRef(M,B),this._rotateWithMatrix(B,p,b)}_rotateWithMatrix(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const Q=this.getLocalMatrix(),q=Q.m[12],B=Q.m[13],u=Q.m[14],T=this.getParent(),O=k._TmpMats[3],H=k._TmpMats[4];T&&1==p?(b?(O.B(b.getWorldMatrix()),T.getAbsoluteMatrix().multiplyToRef(O,O)):O.B(T.getAbsoluteMatrix()),H.B(O),H.invert(),Q.multiplyToRef(O,Q),Q.multiplyToRef(M,Q),Q.multiplyToRef(H,Q)):1==p&&b?(O.B(b.getWorldMatrix()),H.B(O),H.invert(),Q.multiplyToRef(O,Q),Q.multiplyToRef(M,Q),Q.multiplyToRef(H,Q)):Q.multiplyToRef(M,Q),Q.setTranslationFromFloats(q,B,u),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(M,p){const b=k._TmpMats[2];return M.B(this.getAbsoluteMatrix()),p?(M.multiplyToRef(p.getWorldMatrix(),M),Q.Matrix.ScalingToRef(p.ab.x,p.ab.y,p.ab.z,b)):Q.Matrix.IdentityToRef(b),M.invert(),!isNaN(M.m[0])&&(b.multiplyAtIndex(0,this._scalingDeterminant),M.multiplyToRef(b,M),!0)}dp(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=Q.Ap.Zero();return this.getPositionToRef(M,p,b),b}getPositionToRef(){let M=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const M=this.getLocalMatrix();p.x=M.m[12],p.y=M.m[13],p.z=M.m[14]}else{let b=null;M&&(b=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let Q=k._TmpMats[0];M&&b?(Q.B(this.getAbsoluteMatrix()),Q.multiplyToRef(b,Q)):Q=this.getAbsoluteMatrix(),p.x=Q.m[12],p.y=Q.m[13],p.z=Q.m[14]}}getAbsolutePosition(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const p=Q.Ap.Zero();return this.getPositionToRef(1,M,p),p}getAbsolutePositionToRef(M,p){this.getPositionToRef(1,M,p)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Lo.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.B(this.Lo);const M=this._skeleton.getPoseMatrix();M&&this._absoluteMatrix.multiplyToRef(M,this._absoluteMatrix)}const M=this.children,p=M.length;for(let b=0;b<p;b++)M[b].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}YT(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=Q.Ap.Zero();return this.getDirectionToRef(M,p,b),b}getDirectionToRef(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,q=null;p&&(q=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=k._TmpMats[0];B.B(this.getAbsoluteMatrix()),p&&q&&B.multiplyToRef(q,B),Q.Ap.TransformNormalToRef(M,B,b),b.normalize()}getRotation(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=Q.Ap.Zero();return this.getRotationToRef(M,p,b),b}getRotationToRef(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const Q=k._TmpQuat;this.getRotationQuaternionToRef(M,p,Q),Q.toEulerAnglesToRef(b)}getRotationQuaternion(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=Q.Quaternion.Identity();return this.getRotationQuaternionToRef(M,p,b),b}getRotationQuaternionToRef(){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),p.B(this._localRotation);else{const b=k._TmpMats[0],Q=this.getAbsoluteMatrix();M?Q.multiplyToRef(M.getWorldMatrix(),b):b.B(Q),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.decompose(void 0,p,void 0)}}getRotationMatrix(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1?arguments[1]:void 0;const b=Q.Matrix.Identity();return this.getRotationMatrixToRef(M,p,b),b}getRotationMatrixToRef(){let M=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(p);else{const b=k._TmpMats[0],Q=this.getAbsoluteMatrix();M?Q.multiplyToRef(M.getWorldMatrix(),b):b.B(Q),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.getRotationMatrixToRef(p)}}getAbsolutePositionFromLocal(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=Q.Ap.Zero();return this.getAbsolutePositionFromLocalToRef(M,p,b),b}getAbsolutePositionFromLocalToRef(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,q=null;p&&(q=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=k._TmpMats[0];B.B(this.getAbsoluteMatrix()),p&&q&&B.multiplyToRef(q,B),Q.Ap.TransformCoordinatesToRef(M,B,b)}getLocalPositionFromAbsolute(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=Q.Ap.Zero();return this.getLocalPositionFromAbsoluteToRef(M,p,b),b}getLocalPositionFromAbsoluteToRef(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,q=null;p&&(q=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const B=k._TmpMats[0];B.B(this.getAbsoluteMatrix()),p&&q&&B.multiplyToRef(q,B),B.invert(),Q.Ap.TransformCoordinatesToRef(M,B,b)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const M=this._skeleton.bones.indexOf(this);if(-1!==M&&this._skeleton.bones.splice(M,1),this._parentNode&&this._parentNode.children){const M=this._parentNode.children,p=M.indexOf(this);-1!==p&&M.splice(p,1)}super.dispose()}}k._TmpVecs=(0,q.e)(2,Q.Ap.Zero),k._TmpQuat=Q.Quaternion.Identity(),k._TmpMats=(0,q.e)(5,Q.Matrix.Identity)},13890:(M,p,b)=>{"use strict";b.d(p,{b:()=>E});var Q=b(11784),q=b(11788),B=b(11624),k=b(11796),u=b(11806),T=b(12236),O=b(12257),H=b(12082),F=b(11647),o=b(11798);class W{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(M){this._zoomStopsAnimation=M}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(M){this._idleRotationSpeed=M}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(M){this._idleRotationWaitTime=M}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(M){this._idleRotationSpinupTime=M}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(M){this._attachedCamera=M;const p=this._attachedCamera.RM();this._onPrePointerObservableObserver=p.onPrePointerObservable.add((M=>{M.type!==H.e.POINTERDOWN?M.type===H.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const M=F.b.Now;let p=0;null!=this._lastFrameTime&&(p=M-this._lastFrameTime),this._lastFrameTime=M,this._applyUserInteraction();const b=M-this._lastInteractionTime-this._idleRotationWaitTime,Q=Math.max(Math.min(b/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*Q,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(p/1e3))}))}detach(){if(!this._attachedCamera)return;const M=this._attachedCamera.RM();this._onPrePointerObservableObserver&&M.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(M){this._lastInteractionTime=M??F.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<o.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let M=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(M=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?M:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=F.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var i=b(13897),A=b(12342);class j{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(M){if(this._autoTransitionRange===M)return;this._autoTransitionRange=M;const p=this._attachedCamera;p&&(M?this._onMeshTargetChangedObserver=p.onMeshTargetChangedObservable.add((M=>{if(M&&(M.ib(!0),M.getBoundingInfo)){const p=M.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*p,this.upperRadiusTransitionRange=.05*p}})):this._onMeshTargetChangedObserver&&p.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(M){this._attachedCamera=M,this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(M){return!!this._attachedCamera&&(this._attachedCamera.radius===M&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(M){if(!this._attachedCamera)return;this._radiusBounceTransition||(j.EasingFunction.setEasingMode(j.EasingMode),this._radiusBounceTransition=A.c.CreateAnimation("radius",A.c.ANIMATIONTYPE_FLOAT,60,j.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const p=A.c.TransitionTo("radius",this._attachedCamera.radius+M,this._attachedCamera,this._attachedCamera.RM(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));p&&this._animatables.push(p)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}j.EasingFunction=new i.d(.3),j.EasingMode=i.p.EASINGMODE_EASEOUT;class K{constructor(){this.onTargetFramingAnimationEndObservable=new B.b,this._mode=K.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(M){this._mode=M}get mode(){return this._mode}set radiusScale(M){this._radiusScale=M}get radiusScale(){return this._radiusScale}set positionScale(M){this._positionScale=M}get positionScale(){return this._positionScale}set defaultElevation(M){this._defaultElevation=M}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(M){this._elevationReturnTime=M}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(M){this._elevationReturnWaitTime=M}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(M){this._zoomStopsAnimation=M}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(M){this._framingTime=M}get framingTime(){return this._framingTime}init(){}attach(M){this._attachedCamera=M;const p=this._attachedCamera.RM();K.EasingFunction.setEasingMode(K.EasingMode),this._onPrePointerObservableObserver=p.onPrePointerObservable.add((M=>{M.type!==H.e.POINTERDOWN?M.type===H.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=M.onMeshTargetChangedObservable.add((M=>{M&&M.getBoundingInfo&&this.zoomOnMesh(M,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const M=this._attachedCamera.RM();this._onPrePointerObservableObserver&&M.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M.ib(!0);const Q=M.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(Q.minimumWorld,Q.maximumWorld,p,b)}zoomOnMeshHierarchy(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M.ib(!0);const Q=M.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(Q.min,Q.max,p,b)}zoomOnMeshesHierarchy(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new k.Ap(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new k.Ap(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let B=0;B<M.length;B++){const p=M[B].getHierarchyBoundingVectors(!0);k.Ap.CheckExtends(p.min,Q,q),k.Ap.CheckExtends(p.max,Q,q)}this.zoomOnBoundingInfo(Q,q,p,b)}zoomOnBoundingInfo(M,p){let b,Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const B=M.y,u=B+(p.y-B)*this._positionScale,T=p.jp(M).scale(.5);if(!isFinite(u))return!1;if(Q)b=new k.Ap(0,u,0);else{const p=M.add(T);b=new k.Ap(p.x,u,p.z)}this._vectorTransition||(this._vectorTransition=A.c.CreateAnimation("target",A.c.ANIMATIONTYPE_VECTOR3,60,K.EasingFunction)),this._betaIsAnimating=!0;let O=A.c.TransitionTo("target",b,this._attachedCamera,this._attachedCamera.RM(),60,this._vectorTransition,this._framingTime);O&&this._animatables.push(O);let H=0;if(this._mode===K.FitFrustumSidesMode){const b=this._calculateLowerRadiusFromModelBoundingSphere(M,p);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=T.length()+this._attachedCamera.Fb),H=b}else this._mode===K.IgnoreBoundsSizeMode&&(H=this._calculateLowerRadiusFromModelBoundingSphere(M,p),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Fb));if(this.autoCorrectCameraLimitsAndSensibility){const b=p.jp(M).length();this._attachedCamera.panningSensibility=5e3/b,this._attachedCamera.wheelPrecision=100/H}return this._radiusTransition||(this._radiusTransition=A.c.CreateAnimation("radius",A.c.ANIMATIONTYPE_FLOAT,60,K.EasingFunction)),O=A.c.TransitionTo("radius",H,this._attachedCamera,this._attachedCamera.RM(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),q&&q(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),O&&this._animatables.push(O),!0}_calculateLowerRadiusFromModelBoundingSphere(M,p){const b=this._attachedCamera;if(!b)return 0;let Q=b._calculateLowerRadiusFromModelBoundingSphere(M,p,this._radiusScale);return b.lowerRadiusLimit&&this._mode===K.IgnoreBoundsSizeMode&&(Q=Q<b.lowerRadiusLimit?b.lowerRadiusLimit:Q),b.upperRadiusLimit&&(Q=Q>b.upperRadiusLimit?b.upperRadiusLimit:Q),Q}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const M=F.b.Now-this._lastInteractionTime,p=.5*Math.PI-this._defaultElevation,b=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>b&&M>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=A.c.CreateAnimation("beta",A.c.ANIMATIONTYPE_FLOAT,60,K.EasingFunction));const M=A.c.TransitionTo("beta",p,this._attachedCamera,this._attachedCamera.RM(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));M&&this._animatables.push(M)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=F.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}K.EasingFunction=new i.w,K.EasingMode=i.p.EASINGMODE_EASEINOUT,K.IgnoreBoundsSizeMode=0,K.FitFrustumSidesMode=1;var D=b(12262),a=b(12297),s=b(13383),S=b(11621);class f{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(M){M=S.Tools.BackCompatCameraNoPreventDefault(arguments);const p=this.camera.getEngine(),b=p.getInputElement();let Q=0,q=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=B=>{var k,u;const T=B.event,O="touch"===T.pointerType;if(B.type!==H.e.POINTERMOVE&&-1===this.buttons.indexOf(T.button))return;const F=T.target;if(this._altKey=T.altKey,this._ctrlKey=T.ctrlKey,this._metaKey=T.metaKey,this._shiftKey=T.shiftKey,this._buttonsPressed=T.buttons,p.isPointerLock){const M=T.movementX,p=T.movementY;this.onTouch(null,M,p),this._pointA=null,this._pointB=null}else{if(B.type!==H.e.POINTERDOWN&&B.type!==H.e.POINTERDOUBLETAP&&O&&(null===(k=this._pointA)||void 0===k?void 0:k.pointerId)!==T.pointerId&&(null===(u=this._pointB)||void 0===u?void 0:u.pointerId)!==T.pointerId)return;if(B.type!==H.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!O)if(B.type===H.e.POINTERDOUBLETAP)this.onDoubleTap(T.pointerType);else if(B.type!==H.e.POINTERUP||this._currentMousePointerIdDown!==T.pointerId&&!O){if(B.type===H.e.POINTERMOVE)if(M||T.preventDefault(),this._pointA&&null===this._pointB){const M=T.clientX-this._pointA.x,p=T.clientY-this._pointA.y;this._pointA.x=T.clientX,this._pointA.y=T.clientY,this.onTouch(this._pointA,M,p)}else if(this._pointA&&this._pointB){const M=this._pointA.pointerId===T.pointerId?this._pointA:this._pointB;M.x=T.clientX,M.y=T.clientY;const p=this._pointA.x-this._pointB.x,b=this._pointA.y-this._pointB.y,k=p*p+b*b,u={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:T.pointerId,type:B.type};this.onMultiTouch(this._pointA,this._pointB,Q,k,q,u),q=u,Q=k}}else{try{null===F||void 0===F||F.releasePointerCapture(T.pointerId)}catch(o){}O||(this._pointB=null),p._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==T.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==T.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==Q||q)&&(this.onMultiTouch(this._pointA,this._pointB,Q,0,q,null),Q=0,q=null),this._currentMousePointerIdDown=-1,this.onButtonUp(T),M||T.preventDefault()}else{try{null===F||void 0===F||F.setPointerCapture(T.pointerId)}catch(o){}if(null===this._pointA)this._pointA={x:T.clientX,y:T.clientY,pointerId:T.pointerId,type:T.pointerType};else{if(null!==this._pointB)return;this._pointB={x:T.clientX,y:T.clientY,pointerId:T.pointerId,type:T.pointerType}}-1!==this._currentMousePointerIdDown||O||(this._currentMousePointerIdDown=T.pointerId),this.onButtonDown(T),M||(T.preventDefault(),b&&b.focus())}}},this._observer=this.camera.RM()._inputManager._addCameraPointerObserver(this._pointerInput,H.e.POINTERDOWN|H.e.POINTERUP|H.e.POINTERMOVE|H.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,Q=0,q=null,this.onLostFocus()},this._contextMenuBind=M=>this.onContextMenu(M),b&&b.addEventListener("contextmenu",this._contextMenuBind,!1);const B=this.camera.RM().getEngine().getHostWindow();B&&S.Tools.RegisterTopRootEvents(B,[{name:"blur",handler:this._onLostFocus}])}dF(){if(this._onLostFocus){const M=this.camera.RM().getEngine().getHostWindow();M&&S.Tools.UnregisterTopRootEvents(M,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.RM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const M=this.camera.RM().getEngine().getInputElement();M&&M.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(M){}onTouch(M,p,b){}onMultiTouch(M,p,b,Q,q,B){}onContextMenu(M){M.preventDefault()}onButtonDown(M){}onButtonUp(M){}onLostFocus(){}}(0,Q.c)([(0,q.R)()],f.prototype,"buttons",void 0);class R extends f{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(M,p){if(0!==this.panningSensibility&&M&&p){const b=p.x-M.x,Q=p.y-M.y;this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=Q/this.panningSensibility}}_computePinchZoom(M,p){const b=this.camera.radius||R.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=b*Math.sqrt(M)/Math.sqrt(p):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(p-M)*b*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(p-M)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(M,p,b){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-p/this.panningSensibility,this.camera.inertialPanningY+=b/this.panningSensibility):(this.camera.inertialAlphaOffset-=p/this.angularSensibilityX,this.camera.inertialBetaOffset-=b/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(M,p,b,Q,q,B){0===b&&null===q||0===Q&&null===B||(this.multiTouchPanAndZoom?(this._computePinchZoom(b,Q),this._computeMultiTouchPanning(q,B)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(Q)-Math.sqrt(b))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(b,Q),this._isPinching=!0):this._computeMultiTouchPanning(q,B)):this.multiTouchPanning?this._computeMultiTouchPanning(q,B):this.pinchZoom&&this._computePinchZoom(b,Q))}onButtonDown(M){this._isPanClick=M.button===this.camera._panningMouseButton}onButtonUp(M){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}R.MinimumRadiusForPinch=.001,(0,Q.c)([(0,q.R)()],R.prototype,"buttons",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"angularSensibilityX",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"angularSensibilityY",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"pinchPrecision",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"pinchDeltaPercentage",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"useNaturalPinchZoom",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"pinchZoom",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"panningSensibility",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"multiTouchPanning",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"multiTouchPanAndZoom",void 0),s.e.ArcRotateCameraPointersInput=R;var y=b(12086);class x{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(M){M=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.RM(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((p=>{const b=p.event;if(!b.metaKey)if(p.type===y.c.KEYDOWN){if(this._ctrlPressed=b.ctrlKey,this._altPressed=b.altKey,-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),b.preventDefault&&(M||b.preventDefault())}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){const p=this._keys.indexOf(b.keyCode);p>=0&&this._keys.splice(p,1),b.preventDefault&&(M||b.preventDefault())}})))}dF(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const M=this.camera;for(let p=0;p<this._keys.length;p++){const b=this._keys[p];-1!==this.keysLeft.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningX-=1/this.panningSensibility:M.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?M.inertialRadiusOffset+=1/this.zoomingSensibility:M.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningX+=1/this.panningSensibility:M.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?M.inertialRadiusOffset-=1/this.zoomingSensibility:M.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(b)&&M.useInputToRestoreState&&M.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,Q.c)([(0,q.R)()],x.prototype,"keysUp",void 0),(0,Q.c)([(0,q.R)()],x.prototype,"keysDown",void 0),(0,Q.c)([(0,q.R)()],x.prototype,"keysLeft",void 0),(0,Q.c)([(0,q.R)()],x.prototype,"keysRight",void 0),(0,Q.c)([(0,q.R)()],x.prototype,"keysReset",void 0),(0,Q.c)([(0,q.R)()],x.prototype,"panningSensibility",void 0),(0,Q.c)([(0,q.R)()],x.prototype,"zoomingSensibility",void 0),(0,Q.c)([(0,q.R)()],x.prototype,"useAltToZoom",void 0),(0,Q.c)([(0,q.R)()],x.prototype,"angularSpeed",void 0),s.e.ArcRotateCameraKeyboardMoveInput=x;var P=b(11842),L=b(12094);class N{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new k.Ap(0,0,0),this._globalOffset=new k.Ap(0,0,0),this._inertialPanning=k.Ap.Zero()}_computeDeltaFromMouseWheelLegacyEvent(M,p){let b=0;const Q=.01*M*this.wheelDeltaPercentage*p;return b=M>0?Q/(1+this.wheelDeltaPercentage):Q*(1+this.wheelDeltaPercentage),b}attachControl(M){M=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=p=>{if(p.type!==H.e.POINTERWHEEL)return;const b=p.event;let Q=0;const q=b.deltaMode===L.c.DOM_DELTA_LINE?40:1,B=-b.deltaY*q;if(this.customComputeDeltaFromMouseWheel)Q=this.customComputeDeltaFromMouseWheel(B,this,b);else if(this.wheelDeltaPercentage){if(Q=this._computeDeltaFromMouseWheelLegacyEvent(B,this.camera.radius),Q>0){let M=this.camera.radius,p=this.camera.inertialRadiusOffset+Q;for(let b=0;b<20&&!(M<=p)&&!(Math.abs(p*this.camera.inertia)<.001);b++)M-=p,p*=this.camera.inertia;M=(0,u.Clamp)(M,0,Number.MAX_VALUE),Q=this._computeDeltaFromMouseWheelLegacyEvent(B,M)}}else Q=B/(40*this.wheelPrecision);Q&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(Q)):this.camera.inertialRadiusOffset+=Q),b.preventDefault&&(M||b.preventDefault())},this._observer=this.camera.RM()._inputManager._addCameraPointerObserver(this._wheel,H.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.sb(0)}dF(){this._observer&&(this.camera.RM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const M=this.camera;0+M.inertialAlphaOffset+M.inertialBetaOffset+M.inertialRadiusOffset&&(this._updateHitPlane(),M.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(M.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const M=this.camera,p=M.target.jp(M.position);this._hitPlane=P.e.FromPositionAndNormal(M.target,p)}_getPosition(){const M=this.camera,p=M.RM(),b=p.createPickingRay(p.pointerX,p.pointerY,k.Matrix.Identity(),M,!1);0===M.targetScreenOffset.x&&0===M.targetScreenOffset.y||(this._viewOffset.set(M.targetScreenOffset.x,M.targetScreenOffset.y,0),M.getViewMatrix().invertToRef(M._cameraTransformMatrix),this._globalOffset=k.Ap.TransformNormal(this._viewOffset,M._cameraTransformMatrix),b.origin.addInPlace(this._globalOffset));let Q=0;return this._hitPlane&&(Q=b.intersectsPlane(this._hitPlane)??0),b.origin.addInPlace(b.direction.scaleInPlace(Q))}_zoomToMouse(M){const p=this.camera,b=1-p.inertia;if(p.lowerRadiusLimit){const Q=p.lowerRadiusLimit??0;p.radius-(p.inertialRadiusOffset+M)/b<Q&&(M=(p.radius-Q)*b-p.inertialRadiusOffset)}if(p.upperRadiusLimit){const Q=p.upperRadiusLimit??0;p.radius-(p.inertialRadiusOffset+M)/b>Q&&(M=(p.radius-Q)*b-p.inertialRadiusOffset)}const Q=M/b/p.radius,q=this._getPosition(),B=k.TmpVectors.Ap[6];q.subtractToRef(p.target,B),B.scaleInPlace(Q),B.scaleInPlace(b),this._inertialPanning.addInPlace(B),p.inertialRadiusOffset+=M}_zeroIfClose(M){Math.abs(M.x)<o.d&&(M.x=0),Math.abs(M.y)<o.d&&(M.y=0),Math.abs(M.z)<o.d&&(M.z=0)}}(0,Q.c)([(0,q.R)()],N.prototype,"wheelPrecision",void 0),(0,Q.c)([(0,q.R)()],N.prototype,"zoomToMouseLocation",void 0),(0,Q.c)([(0,q.R)()],N.prototype,"wheelDeltaPercentage",void 0),s.e.ArcRotateCameraMouseWheelInput=N;class r extends s.i{constructor(M){super(M)}addMouseWheel(){return this.add(new N),this}addPointers(){return this.add(new R),this}addKeyboard(){return this.add(new x),this}}var Y=b(11757);function w(M,p){return isNaN(M)?p:M}T.d.AddNodeConstructor("ArcRotateCamera",((M,p)=>()=>new E(M,0,0,1,k.Ap.Zero(),p)));class E extends a.e{get target(){return this._target}set target(M){this.setTarget(M)}get targetHost(){return this._targetHost}set targetHost(M){M&&this.setTarget(M)}getTarget(){return this.target}get position(){return this._position}set position(M){this.setPosition(M)}set upVector(M){this._upToYMatrix||(this._yToUpMatrix=new k.Matrix,this._upToYMatrix=new k.Matrix,this._upVector=k.Ap.Zero()),M.normalize(),this._upVector.B(M),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){k.Matrix.RotationAlignToRef(k.Ap.UpReadOnly,this._upVector,this._yToUpMatrix),k.Matrix.RotationAlignToRef(this._upVector,k.Ap.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const M=this.inputs.attached.pointers;return M?M.angularSensibilityX:0}set angularSensibilityX(M){const p=this.inputs.attached.pointers;p&&(p.angularSensibilityX=M)}get angularSensibilityY(){const M=this.inputs.attached.pointers;return M?M.angularSensibilityY:0}set angularSensibilityY(M){const p=this.inputs.attached.pointers;p&&(p.angularSensibilityY=M)}get pinchPrecision(){const M=this.inputs.attached.pointers;return M?M.pinchPrecision:0}set pinchPrecision(M){const p=this.inputs.attached.pointers;p&&(p.pinchPrecision=M)}get pinchDeltaPercentage(){const M=this.inputs.attached.pointers;return M?M.pinchDeltaPercentage:0}set pinchDeltaPercentage(M){const p=this.inputs.attached.pointers;p&&(p.pinchDeltaPercentage=M)}get useNaturalPinchZoom(){const M=this.inputs.attached.pointers;return!!M&&M.useNaturalPinchZoom}set useNaturalPinchZoom(M){const p=this.inputs.attached.pointers;p&&(p.useNaturalPinchZoom=M)}get panningSensibility(){const M=this.inputs.attached.pointers;return M?M.panningSensibility:0}set panningSensibility(M){const p=this.inputs.attached.pointers;p&&(p.panningSensibility=M)}get keysUp(){const M=this.inputs.attached.keyboard;return M?M.keysUp:[]}set keysUp(M){const p=this.inputs.attached.keyboard;p&&(p.keysUp=M)}get keysDown(){const M=this.inputs.attached.keyboard;return M?M.keysDown:[]}set keysDown(M){const p=this.inputs.attached.keyboard;p&&(p.keysDown=M)}get keysLeft(){const M=this.inputs.attached.keyboard;return M?M.keysLeft:[]}set keysLeft(M){const p=this.inputs.attached.keyboard;p&&(p.keysLeft=M)}get keysRight(){const M=this.inputs.attached.keyboard;return M?M.keysRight:[]}set keysRight(M){const p=this.inputs.attached.keyboard;p&&(p.keysRight=M)}get wheelPrecision(){const M=this.inputs.attached.mousewheel;return M?M.wheelPrecision:0}set wheelPrecision(M){const p=this.inputs.attached.mousewheel;p&&(p.wheelPrecision=M)}get zoomToMouseLocation(){const M=this.inputs.attached.mousewheel;return!!M&&M.zoomToMouseLocation}set zoomToMouseLocation(M){const p=this.inputs.attached.mousewheel;p&&(p.zoomToMouseLocation=M)}get wheelDeltaPercentage(){const M=this.inputs.attached.mousewheel;return M?M.wheelDeltaPercentage:0}set wheelDeltaPercentage(M){const p=this.inputs.attached.mousewheel;p&&(p.wheelDeltaPercentage=M)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(M){M!==this.useBouncingBehavior&&(M?(this._bouncingBehavior=new j,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(M){M!==this.useFramingBehavior&&(M?(this._framingBehavior=new K,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(M){M!==this.useAutoRotationBehavior&&(M?(this._autoRotationBehavior=new W,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(M,p,b,Q,q,u){var T;let O=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(M,k.Ap.Zero(),u,O),T=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=k.Ap.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=k.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new k.Matrix,this.panningAxis=new k.Ap(1,1,0),this._transformedDirection=new k.Ap,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new B.b,this.checkCollisions=!1,this.collisionRadius=new k.Ap(.5,.5,.5),this._previousPosition=k.Ap.Zero(),this._collisionVelocity=k.Ap.Zero(),this._newPosition=k.Ap.Zero(),this._computationVector=k.Ap.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new k.Ap(NaN,NaN,NaN),this._goalTargetScreenOffset=new k.Vector2(NaN,NaN),this._onCollisionPositionChange=function(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b?(T.setPosition(p),T.RW&&T.RW(b)):T._previousPosition.B(T._position);const Q=Math.cos(T.alpha),q=Math.sin(T.alpha),B=Math.cos(T.beta);let k=Math.sin(T.beta);0===k&&(k=1e-4);const u=T._getTargetPosition();T._computationVector.Db(T.radius*Q*k,T.radius*B,T.radius*q*k),u.addToRef(T._computationVector,T._newPosition),T._position.B(T._newPosition);let O=T.upVector;T.allowUpsideDown&&T.beta<0&&(O=O.clone(),O=O.negate()),T._computeViewMatrix(T._position,u,O),T._viewMatrix.addAtIndex(12,T.targetScreenOffset.x),T._viewMatrix.addAtIndex(13,T.targetScreenOffset.y),T._collisionTriggered=!1},this._target=k.Ap.Zero(),q&&this.setTarget(q),this.alpha=p,this.beta=b,this.radius=Q,this.getViewMatrix(),this.inputs=new r(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new k.Ap(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=k.Vector2.Zero()}_updateCache(M){M||super._updateCache(),this._cache._target.B(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.B(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const M=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?M.addToRef(this._targetBoundingCenter,this._target):this._target.B(M)}const M=this._getLockedTargetPosition();return M||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>o.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,B=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=B?this._currentInterpolationFactor=B:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=w(M,this._goalAlpha),this._goalBeta=w(p,this._goalBeta),this._goalRadius=w(b,this._goalRadius),this._goalTarget.set(w(Q.x,this._goalTarget.x),w(Q.y,this._goalTarget.y),w(Q.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(w(q.x,this._goalTargetScreenOffset.x),w(q.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,u.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,u.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,u.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,u.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(M,p){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const q=arguments;p=S.Tools.BackCompatCameraNoPreventDefault(q),this._useCtrlForPanning=b,this._panningMouseButton=Q,"boolean"===typeof q[0]&&(q.length>1&&(this._useCtrlForPanning=q[1]),q.length>2&&(this._panningMouseButton=q[2])),this.inputs.attachElement(p),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}dF(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let M=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){M=!0;const p=this.invertRotation?-1:1,b=this._calculateHandednessMultiplier();let Q=this.inertialAlphaOffset*b;this.beta<0&&(Q*=-1),this.alpha+=Q*p,this.beta+=this.inertialBetaOffset*p,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<o.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<o.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*o.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){M=!0;const p=new k.Ap(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),p.multiplyInPlace(this.panningAxis),k.Ap.TransformNormalToRef(p,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const M=this.upVector,p=k.Ap.CrossToRef(this._transformedDirection,M,this._transformedDirection);k.Ap.CrossToRef(M,p,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);k.Ap.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.B(this._transformedDirection)}else{if(this.parent){const M=k.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(M),M.transposeToRef(M),k.Ap.TransformCoordinatesToRef(this._transformedDirection,M,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*o.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*o.d&&(this.inertialPanningY=0)}if(M)this.stopInterpolation();else if(this._isInterpolating){let M=!1;const p=this._scene.getEngine().getDeltaTime()/1e3,b=1-Math.pow(2,-p/this._currentInterpolationFactor),Q=w(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const p=k.TmpVectors.Ap[0].set(w(this._goalTarget.x,this._target.x),w(this._goalTarget.y,this._target.y),w(this._goalTarget.z,this._target.z));k.Ap.LerpToRef(this.target,p,b,this._target),10*k.Ap.Distance(this.target,p)/Q<o.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.B(p),this.setTarget(this.target,!1,!0,!0)):M=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const p=k.Quaternion.RotationAlphaBetaGammaToRef(w(this._goalAlpha,this.alpha),w(this._goalBeta,this.beta),0,k.TmpVectors.Quaternion[0]),Q=k.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,k.TmpVectors.Quaternion[1]),q=k.Quaternion.SlerpToRef(Q,p,b,k.TmpVectors.Quaternion[2]);q.normalize();const B=q.toAlphaBetaGammaToRef(k.TmpVectors.Ap[0]);if(this.alpha=B.x,this.beta=B.y,q.isApprox(p,o.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const M=p.toAlphaBetaGammaToRef(k.TmpVectors.Ap[0]);this.alpha=M.x,this.beta=M.y}else M=!0}if(isNaN(this._goalRadius)||(this.radius+=(Q-this.radius)*b,Math.abs(Q/this.radius-1)<o.d?(this._goalRadius=NaN,this.radius=Q):M=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const p=k.TmpVectors.Vector2[0].set(w(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),w(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));k.Vector2.LerpToRef(this.targetScreenOffset,p,b,this.targetScreenOffset),k.Vector2.Distance(this.targetScreenOffset,p)<o.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.B(p)):M=!0}this._isInterpolating=M}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||k.Ap.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const M=this.alpha;var p,b;this.alpha=function(M){let p=Math.PI/2;return 0===M.x&&0===M.z||(p=Math.acos(M.x/Math.sqrt(Math.pow(M.x,2)+Math.pow(M.z,2)))),M.z<0&&(p=2*Math.PI-p),p}(this._computationVector),this.beta=(p=this._computationVector.y,b=this.radius,Math.acos(p/b));const Q=Math.round((M-this.alpha)/(2*Math.PI));this.alpha+=2*Q*Math.PI,this._checkLimits()}setPosition(M){this._position.equals(M)||(this._position.B(M),this.rebuildAnglesAndRadius())}setTarget(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Q=this.overrideCloneAlphaBetaRadius??Q,M.ib)p&&M.getBoundingInfo?this._targetBoundingCenter=M.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,M.ib(),this._targetHost=M,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const p=M,Q=this._getTargetPosition();if(Q&&!b&&Q.equals(p))return;this._targetHost=null,this._target=p,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}Q||this.rebuildAnglesAndRadius()}_getViewMatrix(){const M=Math.cos(this.alpha),p=Math.sin(this.alpha),b=Math.cos(this.beta);let Q=Math.sin(this.beta);0===Q&&(Q=1e-4),0===this.radius&&(this.radius=1e-4);const q=this._getTargetPosition();if(this._computationVector.Db(this.radius*M*Q,this.radius*b,this.radius*p*Q),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||k.Ap.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),q.addToRef(this._computationVector,this._newPosition),this.RM().collisionsEnabled&&this.checkCollisions){const M=this.RM().collisionCoordinator;this._collider||(this._collider=M.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,M.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.B(this._newPosition);let M=this.upVector;this.allowUpsideDown&&Q<0&&(M=M.negate()),this._computeViewMatrix(this._position,q,M),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.B(q),this._viewMatrix}zoomOn(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];M=M||this.RM().meshes;const b=O.d.MinMax(M);let Q=this._calculateLowerRadiusFromModelBoundingSphere(b.min,b.max);if(Q=Math.max(Math.min(Q,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=Q*this.zoomOnFactor,this.mode===D.b.ORTHOGRAPHIC_CAMERA){const M=this.RM().getEngine().getAspectRatio(this),p=Q*this.zoomOnFactor/2;this.orthoLeft=-p*M,this.orthoRight=p*M,this.orthoBottom=-p,this.orthoTop=p}this.focusOn({min:b.min,max:b.max,distance:Q},p)}focusOn(M){let p,b,Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===M.min){const Q=M||this.RM().meshes;p=O.d.MinMax(Q),b=k.Ap.Distance(p.min,p.max)}else{p=M,b=M.distance}this._target=O.d.Center(p),Q||(this.maxZ=2*b)}createRigCamera(M,p){let b=0;switch(this.cameraRigMode){case D.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case D.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case D.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case D.b.RIG_MODE_VR:b=this._cameraRigParams.stereoHalfAngle*(0===p?1:-1);break;case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b=this._cameraRigParams.stereoHalfAngle*(0===p?-1:1)}const Q=new E(M,this.alpha+b,this.beta,this.radius,this._target,this.RM());return Q._cameraRigParams={},Q.isRigCamera=!0,Q.rigParent=this,Q.upVector=this.upVector,Q.mode=this.mode,Q.orthoLeft=this.orthoLeft,Q.orthoRight=this.orthoRight,Q.orthoBottom=this.orthoBottom,Q.orthoTop=this.orthoTop,Q}_updateRigCameras(){const M=this._rigCameras[0],p=this._rigCameras[1];switch(M.beta=p.beta=this.beta,this.cameraRigMode){case D.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case D.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case D.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case D.b.RIG_MODE_VR:M.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,p.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:M.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,p.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const Q=k.Ap.Distance(M,p),q=this.RM().getEngine().getAspectRatio(this),B=Math.tan(this.fov/2),u=B*q,T=.5*Q*b,O=T*Math.sqrt(1+1/(u*u)),H=T*Math.sqrt(1+1/(B*B));return Math.max(O,H)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,Q.c)([(0,q.R)()],E.prototype,"alpha",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"beta",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"radius",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,Q.c)([(0,q.N)("target")],E.prototype,"_target",void 0),(0,Q.c)([(0,q.D)("targetHost")],E.prototype,"_targetHost",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"inertialAlphaOffset",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"inertialBetaOffset",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"inertialRadiusOffset",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"lowerAlphaLimit",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"upperAlphaLimit",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"lowerBetaLimit",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"upperBetaLimit",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"lowerRadiusLimit",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"upperRadiusLimit",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"lowerTargetYLimit",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"inertialPanningX",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"inertialPanningY",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"pinchToPanMaxDistance",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"panningDistanceLimit",void 0),(0,Q.c)([(0,q.N)()],E.prototype,"panningOriginTarget",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"panningInertia",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"zoomToMouseLocation",null),(0,Q.c)([(0,q.R)()],E.prototype,"zoomOnFactor",void 0),(0,Q.c)([(0,q.L)()],E.prototype,"targetScreenOffset",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"allowUpsideDown",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"useInputToRestoreState",void 0),(0,Q.c)([(0,q.R)()],E.prototype,"restoreStateInterpolationFactor",void 0),(0,Y.g)("BABYLON.ArcRotateCamera",E)},13383:(M,p,b)=>{"use strict";b.d(p,{e:()=>k,i:()=>u});var Q=b(11637),q=b(11823),B=b(12262),k={};class u{constructor(M){this.attachedToElement=!1,this.attached={},this.camera=M,this.checkInputs=()=>{}}add(M){const p=M.getSimpleName();this.attached[p]?Q.c.Warn("camera input of type "+p+" already exists on camera"):(this.attached[p]=M,M.camera=this.camera,M.checkInputs&&(this.checkInputs=this._addCheckInputs(M.checkInputs.bind(M))),this.attachedToElement&&M.attachControl(this.noPreventDefault))}remove(M){for(const p in this.attached){const b=this.attached[p];if(b===M)return b.dF(),b.camera=null,delete this.attached[p],void this.rebuildInputCheck()}}removeByType(M){for(const p in this.attached){const b=this.attached[p];b.getClassName()===M&&(b.dF(),b.camera=null,delete this.attached[p],this.rebuildInputCheck())}}_addCheckInputs(M){const p=this.checkInputs;return()=>{p(),M()}}attachInput(M){this.attachedToElement&&M.attachControl(this.noPreventDefault)}attachElement(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){M=!B.b.ForceAttachControlToAlwaysPreventDefault&&M,this.attachedToElement=!0,this.noPreventDefault=M;for(const p in this.attached)this.attached[p].attachControl(M)}}detachElement(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const p in this.attached)this.attached[p].dF(),M&&(this.attached[p].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const M in this.attached){const p=this.attached[M];p.checkInputs&&(this.checkInputs=this._addCheckInputs(p.checkInputs.bind(p)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(M){const p={};for(const b in this.attached){const M=this.attached[b],Q=q.b.Serialize(M);p[M.getClassName()]=Q}M.inputsmgr=p}parse(M){const p=M.inputsmgr;if(p){this.clear();for(const M in p){const b=k[M];if(b){const Q=p[M],B=q.b.Parse((()=>new b),Q,null);this.add(B)}}}else for(const b in this.attached){const p=k[this.attached[b].getClassName()];if(p){const Q=q.b.Parse((()=>new p),M,null);this.remove(this.attached[b]),this.add(Q)}}}}},13378:(M,p,b)=>{"use strict";b.d(p,{d:()=>f});var Q=b(11784),q=b(11788),B=b(11796),k=b(12297),u=b(13383),T=b(12086),O=b(11621);class H{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(M){M=O.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.RM(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((p=>{const b=p.event;if(!b.metaKey)if(p.type===T.c.KEYDOWN){if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),M||b.preventDefault()}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){const p=this._keys.indexOf(b.keyCode);p>=0&&this._keys.splice(p,1),M||b.preventDefault()}})))}dF(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const M=this.camera;for(let p=0;p<this._keys.length;p++){const b=this._keys[p],Q=M._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(b)?M._localDirection.Db(-Q,0,0):-1!==this.keysUp.indexOf(b)?M._localDirection.Db(0,0,Q):-1!==this.keysRight.indexOf(b)?M._localDirection.Db(Q,0,0):-1!==this.keysDown.indexOf(b)?M._localDirection.Db(0,0,-Q):-1!==this.keysUpward.indexOf(b)?M._localDirection.Db(0,Q,0):-1!==this.keysDownward.indexOf(b)?M._localDirection.Db(0,-Q,0):-1!==this.keysRotateLeft.indexOf(b)?(M._localDirection.Db(0,0,0),M.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(b)?(M._localDirection.Db(0,0,0),M.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(b)?(M._localDirection.Db(0,0,0),M.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(b)&&(M._localDirection.Db(0,0,0),M.cameraRotation.x+=this._getLocalRotation()),M.RM().useRightHandedSystem&&(M._localDirection.z*=-1),M.getViewMatrix().invertToRef(M._cameraTransformMatrix),B.Ap.TransformNormalToRef(M._localDirection,M._cameraTransformMatrix,M._transformedDirection),M.cameraDirection.addInPlace(M._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const M=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*M}}(0,Q.c)([(0,q.R)()],H.prototype,"keysUp",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"keysUpward",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"keysDown",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"keysDownward",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"keysLeft",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"keysRight",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"rotationSpeed",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"keysRotateLeft",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"keysRotateRight",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"keysRotateUp",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"keysRotateDown",void 0),u.e.FreeCameraKeyboardMoveInput=H;var F=b(11624),o=b(12082);class W{constructor(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=M,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new F.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(M){M=O.Tools.BackCompatCameraNoPreventDefault(arguments);const p=this.camera.getEngine(),b=p.getInputElement();this._pointerInput||(this._pointerInput=Q=>{const q=Q.event,B="touch"===q.pointerType;if(!this.touchEnabled&&B)return;if(Q.type!==o.e.POINTERMOVE&&-1===this.buttons.indexOf(q.button))return;const k=q.target;if(Q.type===o.e.POINTERDOWN){if(B&&-1!==this._activePointerId||!B&&-1!==this._currentActiveButton)return;this._activePointerId=q.pointerId;try{null===k||void 0===k||k.setPointerCapture(q.pointerId)}catch(u){}-1===this._currentActiveButton&&(this._currentActiveButton=q.button),this._previousPosition={x:q.clientX,y:q.clientY},M||(q.preventDefault(),b&&b.focus()),p.isPointerLock&&this._onMouseMove&&this._onMouseMove(Q.event)}else if(Q.type===o.e.POINTERUP){if(B&&this._activePointerId!==q.pointerId||!B&&this._currentActiveButton!==q.button)return;try{null===k||void 0===k||k.releasePointerCapture(q.pointerId)}catch(u){}this._currentActiveButton=-1,this._previousPosition=null,M||q.preventDefault(),this._activePointerId=-1}else if(Q.type===o.e.POINTERMOVE&&(this._activePointerId===q.pointerId||!B))if(p.isPointerLock&&this._onMouseMove)this._onMouseMove(Q.event);else if(this._previousPosition){const p=this.camera._calculateHandednessMultiplier(),b=(q.clientX-this._previousPosition.x)*p,Q=q.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=b/this.angularSensibility,this.camera.cameraRotation.x+=Q/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:b,offsetY:Q}),this._previousPosition={x:q.clientX,y:q.clientY},M||q.preventDefault()}}),this._onMouseMove=b=>{if(!p.isPointerLock)return;const Q=this.camera._calculateHandednessMultiplier(),q=b.movementX*Q;this.camera.cameraRotation.y+=q/this.angularSensibility;const B=b.movementY;this.camera.cameraRotation.x+=B/this.angularSensibility,this._previousPosition=null,M||b.preventDefault()},this._observer=this.camera.RM()._inputManager._addCameraPointerObserver(this._pointerInput,o.e.POINTERDOWN|o.e.POINTERUP|o.e.POINTERMOVE),b&&(this._contextMenuBind=M=>this.onContextMenu(M),b.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(M){M.preventDefault()}dF(){if(this._observer){if(this.camera.RM()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const M=this.camera.getEngine().getInputElement();M&&M.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,Q.c)([(0,q.R)()],W.prototype,"buttons",void 0),(0,Q.c)([(0,q.R)()],W.prototype,"angularSensibility",void 0),u.e.FreeCameraMouseInput=W;var i,A=b(12094);class j{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new F.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(M){M=O.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=p=>{if(p.type!==o.e.POINTERWHEEL)return;const b=p.event,Q=b.deltaMode===A.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*Q*b.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*Q*b.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*Q*b.deltaZ/this._normalize,b.preventDefault&&(M||b.preventDefault())},this._observer=this.camera.RM()._inputManager._addCameraPointerObserver(this._wheel,o.e.POINTERWHEEL)}dF(){this._observer&&(this.camera.RM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,Q.c)([(0,q.R)()],j.prototype,"wheelPrecisionX",void 0),(0,Q.c)([(0,q.R)()],j.prototype,"wheelPrecisionY",void 0),(0,Q.c)([(0,q.R)()],j.prototype,"wheelPrecisionZ",void 0),function(M){M[M.MoveRelative=0]="MoveRelative",M[M.RotateRelative=1]="RotateRelative",M[M.MoveScene=2]="MoveScene"}(i||(i={}));class K extends j{constructor(){super(...arguments),this._moveRelative=B.Ap.Zero(),this._rotateRelative=B.Ap.Zero(),this._moveScene=B.Ap.Zero(),this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(M){null===M&&this._wheelXAction!==i.MoveRelative||(this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=M)}get wheelXMoveRelative(){return this._wheelXAction!==i.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(M){null===M&&this._wheelYAction!==i.MoveRelative||(this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=M)}get wheelYMoveRelative(){return this._wheelYAction!==i.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(M){null===M&&this._wheelZAction!==i.MoveRelative||(this._wheelZAction=i.MoveRelative,this._wheelZActionCoordinate=M)}get wheelZMoveRelative(){return this._wheelZAction!==i.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(M){null===M&&this._wheelXAction!==i.RotateRelative||(this._wheelXAction=i.RotateRelative,this._wheelXActionCoordinate=M)}get wheelXRotateRelative(){return this._wheelXAction!==i.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(M){null===M&&this._wheelYAction!==i.RotateRelative||(this._wheelYAction=i.RotateRelative,this._wheelYActionCoordinate=M)}get wheelYRotateRelative(){return this._wheelYAction!==i.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(M){null===M&&this._wheelZAction!==i.RotateRelative||(this._wheelZAction=i.RotateRelative,this._wheelZActionCoordinate=M)}get wheelZRotateRelative(){return this._wheelZAction!==i.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(M){null===M&&this._wheelXAction!==i.MoveScene||(this._wheelXAction=i.MoveScene,this._wheelXActionCoordinate=M)}get wheelXMoveScene(){return this._wheelXAction!==i.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(M){null===M&&this._wheelYAction!==i.MoveScene||(this._wheelYAction=i.MoveScene,this._wheelYActionCoordinate=M)}get wheelYMoveScene(){return this._wheelYAction!==i.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(M){null===M&&this._wheelZAction!==i.MoveScene||(this._wheelZAction=i.MoveScene,this._wheelZActionCoordinate=M)}get wheelZMoveScene(){return this._wheelZAction!==i.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.sb(0),this._rotateRelative.sb(0),this._moveScene.sb(0),this._updateCamera(),this.camera.RM().useRightHandedSystem&&(this._moveRelative.z*=-1);const M=B.Matrix.Zero();this.camera.getViewMatrix().invertToRef(M);const p=B.Ap.Zero();B.Ap.TransformNormalToRef(this._moveRelative,M,p),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(p),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(M,p,b){if(0===M)return;if(null===p||null===b)return;let Q=null;switch(p){case i.MoveRelative:Q=this._moveRelative;break;case i.RotateRelative:Q=this._rotateRelative;break;case i.MoveScene:Q=this._moveScene}switch(b){case 0:Q.set(M,0,0);break;case 1:Q.set(0,M,0);break;case 2:Q.set(0,0,M)}}}(0,Q.c)([(0,q.R)()],K.prototype,"wheelXMoveRelative",null),(0,Q.c)([(0,q.R)()],K.prototype,"wheelYMoveRelative",null),(0,Q.c)([(0,q.R)()],K.prototype,"wheelZMoveRelative",null),(0,Q.c)([(0,q.R)()],K.prototype,"wheelXRotateRelative",null),(0,Q.c)([(0,q.R)()],K.prototype,"wheelYRotateRelative",null),(0,Q.c)([(0,q.R)()],K.prototype,"wheelZRotateRelative",null),(0,Q.c)([(0,q.R)()],K.prototype,"wheelXMoveScene",null),(0,Q.c)([(0,q.R)()],K.prototype,"wheelYMoveScene",null),(0,Q.c)([(0,q.R)()],K.prototype,"wheelZMoveScene",null),u.e.FreeCameraMouseWheelInput=K;class D{constructor(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=M,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=O.Tools.IsSafari()}attachControl(M){M=O.Tools.BackCompatCameraNoPreventDefault(arguments);let p=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=b=>{const Q=b.event,q="mouse"===Q.pointerType||this._isSafari&&"undefined"===typeof Q.pointerType;if(this.allowMouse||!q)if(b.type===o.e.POINTERDOWN){if(M||Q.preventDefault(),this._pointerPressed.push(Q.pointerId),1!==this._pointerPressed.length)return;p={x:Q.clientX,y:Q.clientY}}else if(b.type===o.e.POINTERUP){M||Q.preventDefault();const b=this._pointerPressed.indexOf(Q.pointerId);if(-1===b)return;if(this._pointerPressed.splice(b,1),0!=b)return;p=null,this._offsetX=null,this._offsetY=null}else if(b.type===o.e.POINTERMOVE){if(M||Q.preventDefault(),!p)return;if(0!=this._pointerPressed.indexOf(Q.pointerId))return;this._offsetX=Q.clientX-p.x,this._offsetY=-(Q.clientY-p.y)}}),this._observer=this.camera.RM()._inputManager._addCameraPointerObserver(this._pointerInput,o.e.POINTERDOWN|o.e.POINTERUP|o.e.POINTERMOVE),this._onLostFocus){const M=this.camera.getEngine().getInputElement();M&&M.addEventListener("blur",this._onLostFocus)}}dF(){if(this._pointerInput){if(this._observer&&(this.camera.RM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const M=this.camera.getEngine().getInputElement();M&&M.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const M=this.camera,p=M._calculateHandednessMultiplier();M.cameraRotation.y=p*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)M.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const p=M._computeLocalCameraSpeed(),b=new B.Ap(0,0,0!==this.touchMoveSensibility?p*this._offsetY/this.touchMoveSensibility:0);B.Matrix.RotationYawPitchRollToRef(M.rotation.y,M.rotation.x,0,M._cameraRotationMatrix),M.cameraDirection.addInPlace(B.Ap.TransformCoordinates(b,M._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,Q.c)([(0,q.R)()],D.prototype,"touchAngularSensibility",void 0),(0,Q.c)([(0,q.R)()],D.prototype,"touchMoveSensibility",void 0),u.e.FreeCameraTouchInput=D;class a extends u.i{constructor(M){super(M),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new H),this}addMouse(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new W(M),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new K,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new D),this}clear(){super.clear(),this._mouseInput=null}}var s=b(11757),S=b(11700);class f extends k.e{get angularSensibility(){const M=this.inputs.attached.mouse;return M?M.angularSensibility:0}set angularSensibility(M){const p=this.inputs.attached.mouse;p&&(p.angularSensibility=M)}get keysUp(){const M=this.inputs.attached.keyboard;return M?M.keysUp:[]}set keysUp(M){const p=this.inputs.attached.keyboard;p&&(p.keysUp=M)}get keysUpward(){const M=this.inputs.attached.keyboard;return M?M.keysUpward:[]}set keysUpward(M){const p=this.inputs.attached.keyboard;p&&(p.keysUpward=M)}get keysDown(){const M=this.inputs.attached.keyboard;return M?M.keysDown:[]}set keysDown(M){const p=this.inputs.attached.keyboard;p&&(p.keysDown=M)}get keysDownward(){const M=this.inputs.attached.keyboard;return M?M.keysDownward:[]}set keysDownward(M){const p=this.inputs.attached.keyboard;p&&(p.keysDownward=M)}get keysLeft(){const M=this.inputs.attached.keyboard;return M?M.keysLeft:[]}set keysLeft(M){const p=this.inputs.attached.keyboard;p&&(p.keysLeft=M)}get keysRight(){const M=this.inputs.attached.keyboard;return M?M.keysRight:[]}set keysRight(M){const p=this.inputs.attached.keyboard;p&&(p.keysRight=M)}get keysRotateLeft(){const M=this.inputs.attached.keyboard;return M?M.keysRotateLeft:[]}set keysRotateLeft(M){const p=this.inputs.attached.keyboard;p&&(p.keysRotateLeft=M)}get keysRotateRight(){const M=this.inputs.attached.keyboard;return M?M.keysRotateRight:[]}set keysRotateRight(M){const p=this.inputs.attached.keyboard;p&&(p.keysRotateRight=M)}get keysRotateUp(){const M=this.inputs.attached.keyboard;return M?M.keysRotateUp:[]}set keysRotateUp(M){const p=this.inputs.attached.keyboard;p&&(p.keysRotateUp=M)}get keysRotateDown(){const M=this.inputs.attached.keyboard;return M?M.keysRotateDown:[]}set keysRotateDown(M){const p=this.inputs.attached.keyboard;p&&(p.keysRotateDown=M)}constructor(M,p,b){var Q;super(M,p,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),Q=this,this.ellipsoid=new B.Ap(.5,1,.5),this.ellipsoidOffset=new B.Ap(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=B.Ap.Zero(),this._diffPosition=B.Ap.Zero(),this._newPosition=B.Ap.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q._newPosition.B(p),Q._newPosition.subtractToRef(Q._oldPosition,Q._diffPosition),Q._diffPosition.length()>S.c.CollisionsEpsilon&&(Q.position.addToRef(Q._diffPosition,Q._deferredPositionUpdate),Q._deferOnly?Q._deferredUpdated=!0:Q.position.B(Q._deferredPositionUpdate),Q.RW&&b&&Q.RW(b))},this.inputs=new a(this),this.inputs.addKeyboard().addMouse()}attachControl(M,p){p=O.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(p)}dF(){this.inputs.detachElement(),this.cameraDirection=new B.Ap(0,0,0),this.cameraRotation=new B.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(M){this._collisionMask=isNaN(M)?-1:M}_collideWithWorld(M){let p;p=this.parent?B.Ap.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,p.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const b=this.RM().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let Q=M;this.applyGravity&&(Q=M.add(this.RM().gravity)),b.getNewPosition(this._oldPosition,Q,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=B.Ap.Zero(),this._transformedDirection=B.Ap.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(M){this._needMoveForGravity=M}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.RM().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"wb"}}(0,Q.c)([(0,q.N)()],f.prototype,"ellipsoid",void 0),(0,Q.c)([(0,q.N)()],f.prototype,"ellipsoidOffset",void 0),(0,Q.c)([(0,q.R)()],f.prototype,"checkCollisions",void 0),(0,Q.c)([(0,q.R)()],f.prototype,"applyGravity",void 0),(0,s.g)("BABYLON.FreeCamera",f)},13949:(M,p,b)=>{"use strict";b.d(p,{c:()=>B});var Q=b(11874),q=b(13955);class B{constructor(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=b,this.qF=[],this._maxBlockCapacity=p||64,this._selectionContent=new Q.b(1024),this._creationFunc=M}update(M,p,b){q.c._CreateBlocks(M,p,b,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}FH(M){for(let p=0;p<this.RH.length;p++){this.RH[p].addEntry(M)}}HH(M){for(let p=0;p<this.RH.length;p++){this.RH[p].removeEntry(M)}}select(M,p){this._selectionContent.reset();for(let b=0;b<this.RH.length;b++){this.RH[b].select(M,this._selectionContent,p)}return p?this._selectionContent.concat(this.qF):this._selectionContent.concatWithNoDuplicate(this.qF),this._selectionContent}intersects(M,p,b){this._selectionContent.reset();for(let Q=0;Q<this.RH.length;Q++){this.RH[Q].intersects(M,p,this._selectionContent,b)}return b?this._selectionContent.concat(this.qF):this._selectionContent.concatWithNoDuplicate(this.qF),this._selectionContent}intersectsRay(M){this._selectionContent.reset();for(let p=0;p<this.RH.length;p++){this.RH[p].intersectsRay(M,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.qF),this._selectionContent}}B.CreationFuncForMeshes=(M,p)=>{const b=M.getBoundingInfo();!M.isBlocked&&b.boundingBox.intersectsMinMax(p.OF,p.HF)&&p.entries.push(M)},B.CreationFuncForSubMeshes=(M,p)=>{M.getBoundingInfo().boundingBox.intersectsMinMax(p.OF,p.HF)&&p.entries.push(M)}},13955:(M,p,b)=>{"use strict";b.d(p,{c:()=>B});var Q=b(11796),q=b(12153);class B{constructor(M,p,b,Q,q,B){this.entries=[],this.FF=new Array,this._capacity=b,this._depth=Q,this._maxDepth=q,this._creationFunc=B,this._minPoint=M,this._maxPoint=p,this.FF.push(M.clone()),this.FF.push(p.clone()),this.FF.push(M.clone()),this.FF[2].x=p.x,this.FF.push(M.clone()),this.FF[3].y=p.y,this.FF.push(M.clone()),this.FF[4].z=p.z,this.FF.push(p.clone()),this.FF[5].z=M.z,this.FF.push(p.clone()),this.FF[6].x=M.x,this.FF.push(p.clone()),this.FF[7].y=M.y}get fp(){return this._capacity}get OF(){return this._minPoint}get HF(){return this._maxPoint}addEntry(M){if(this.RH)for(let p=0;p<this.RH.length;p++){this.RH[p].addEntry(M)}else this._creationFunc(M,this),this.entries.length>this.fp&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(M){if(this.RH){for(let p=0;p<this.RH.length;p++){this.RH[p].removeEntry(M)}return}const p=this.entries.indexOf(M);p>-1&&this.entries.splice(p,1)}addEntries(M){for(let p=0;p<M.length;p++){const b=M[p];this.addEntry(b)}}select(M,p,b){if(q.b.IsInFrustum(this.FF,M)){if(this.RH){for(let Q=0;Q<this.RH.length;Q++){this.RH[Q].select(M,p,b)}return}b?p.concat(this.entries):p.concatWithNoDuplicate(this.entries)}}intersects(M,p,b,Q){if(q.b.IntersectsSphere(this._minPoint,this._maxPoint,M,p)){if(this.RH){for(let q=0;q<this.RH.length;q++){this.RH[q].intersects(M,p,b,Q)}return}Q?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersectsRay(M,p){if(M.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.RH){for(let b=0;b<this.RH.length;b++){this.RH[b].intersectsRay(M,p)}return}p.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){B._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(M,p,b,q,k,u,T,O){T.RH=new Array;const H=new Q.Ap((p.x-M.x)/2,(p.y-M.y)/2,(p.z-M.z)/2);for(let Q=0;Q<2;Q++)for(let p=0;p<2;p++)for(let F=0;F<2;F++){const o=M.add(H.multiplyByFloats(Q,p,F)),W=M.add(H.multiplyByFloats(Q+1,p+1,F+1)),i=new B(o,W,q,k+1,u,O);i.addEntries(b),T.RH.push(i)}}}},13962:(M,p,b)=>{"use strict";b.d(p,{c:()=>H});var Q=b(12033),q=b(11796),B=b(12242),k=b(13154),u=b(12073),T=b(13949),O=b(11664);Q.e.prototype.createOrUpdateSelectionOctree=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,b=this._getComponent(u.c.NAME_OCTREE);b||(b=new H(this),this.o(b)),this.bF||(this.bF=new T.c(T.c.CreationFuncForMeshes,M,p));const Q=this.getWorldExtends();return this.bF.update(Q.min,Q.max,this.meshes),this.bF},Object.defineProperty(Q.e.prototype,"selectionOctree",{get:function(){return this.bF},enumerable:!0,configurable:!0}),B.b.prototype.createOrUpdateSubmeshesOctree=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=this.RM();let Q=b._getComponent(u.c.NAME_OCTREE);Q||(Q=new H(b),b.o(Q)),this._submeshesOctree||(this._submeshesOctree=new T.c(T.c.CreationFuncForSubMeshes,M,p)),this.ib(!0);const q=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(q.minimumWorld,q.maximumWorld,this.Tb),this._submeshesOctree};class H{constructor(M){this.name=u.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new k.b(q.Ap.Zero(),new q.Ap(1,1,1)),(M=M||O.c.LastCreatedScene)&&(this.Kp=M,this.Kp.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Kp.getActiveSubMeshCandidates=M=>this.getActiveSubMeshCandidates(M),this.Kp.getCollidingSubMeshCandidates=(M,p)=>this.getCollidingSubMeshCandidates(M,p),this.Kp.getIntersectingSubMeshCandidates=(M,p)=>this.getIntersectingSubMeshCandidates(M,p))}register(){this.Kp.onMeshRemovedObservable.add((M=>{const p=this.Kp.selectionOctree;if(void 0!==p&&null!==p){const b=p.qF.indexOf(M);-1!==b&&p.qF.splice(b,1)}})),this.Kp.onMeshImportedObservable.add((M=>{const p=this.Kp.selectionOctree;void 0!==p&&null!==p&&p.FH(M)}))}getActiveMeshCandidates(){var M;return(null===(M=this.Kp.bF)||void 0===M?void 0:M.select(this.Kp.frustumPlanes))||this.Kp._getDefaultMeshCandidates()}getActiveSubMeshCandidates(M){if(M._submeshesOctree&&M.useOctreeForRenderingSelection){return M._submeshesOctree.select(this.Kp.frustumPlanes)}return this.Kp._getDefaultSubMeshCandidates(M)}getIntersectingSubMeshCandidates(M,p){if(M._submeshesOctree&&M.useOctreeForPicking){k.b.TransformToRef(p,M.getWorldMatrix(),this._tempRay);return M._submeshesOctree.intersectsRay(this._tempRay)}return this.Kp._getDefaultSubMeshCandidates(M)}getCollidingSubMeshCandidates(M,p){if(M._submeshesOctree&&M.useOctreeForCollisions){const b=p._velocityWorldLength+Math.max(p._radius.x,p._radius.y,p._radius.z);return M._submeshesOctree.intersects(p._basePointWorld,b)}return this.Kp._getDefaultSubMeshCandidates(M)}rebuild(){}dispose(){}}},13154:(M,p,b)=>{"use strict";b.d(p,{b:()=>W});var Q=b(12033),q=b(12262),B=b(11798),k=b(11796),u=b(11800),T=b(12145),O=b(12064),H=b(11664),F=b(12098);const o={internalPickerForMesh:void 0};class W{constructor(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.d;this.origin=M,this.direction=p,this.length=b,this.epsilon=Q}clone(){return new W(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Q=W._TmpVector3[0].Db(M.x-b,M.y-b,M.z-b),q=W._TmpVector3[1].Db(p.x+b,p.y+b,p.z+b);let B,k,u,T,O=0,H=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<Q.x||this.origin.x>q.x)return!1}else if(B=1/this.direction.x,k=(Q.x-this.origin.x)*B,u=(q.x-this.origin.x)*B,u===-1/0&&(u=1/0),k>u&&(T=k,k=u,u=T),O=Math.max(k,O),H=Math.min(u,H),O>H)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<Q.y||this.origin.y>q.y)return!1}else if(B=1/this.direction.y,k=(Q.y-this.origin.y)*B,u=(q.y-this.origin.y)*B,u===-1/0&&(u=1/0),k>u&&(T=k,k=u,u=T),O=Math.max(k,O),H=Math.min(u,H),O>H)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<Q.z||this.origin.z>q.z)return!1}else if(B=1/this.direction.z,k=(Q.z-this.origin.z)*B,u=(q.z-this.origin.z)*B,u===-1/0&&(u=1/0),k>u&&(T=k,k=u,u=T),O=Math.max(k,O),H=Math.min(u,H),O>H)return!1;return!0}intersectsBox(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(M.minimum,M.maximum,p)}intersectsSphere(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=M.center.x-this.origin.x,Q=M.center.y-this.origin.y,q=M.center.z-this.origin.z,B=b*b+Q*Q+q*q,k=M.radius+p,u=k*k;if(B<=u)return!0;const T=b*this.direction.x+Q*this.direction.y+q*this.direction.z;if(T<0)return!1;return B-T*T<=u}intersectsTriangle(M,p,b){const Q=W._TmpVector3[0],q=W._TmpVector3[1],B=W._TmpVector3[2],u=W._TmpVector3[3],O=W._TmpVector3[4];p.subtractToRef(M,Q),b.subtractToRef(M,q),k.Ap.CrossToRef(this.direction,q,B);const H=k.Ap.Dot(Q,B);if(0===H)return null;const F=1/H;this.origin.subtractToRef(M,u);const o=k.Ap.Dot(u,B)*F;if(o<-this.epsilon||o>1+this.epsilon)return null;k.Ap.CrossToRef(u,Q,O);const i=k.Ap.Dot(this.direction,O)*F;if(i<-this.epsilon||o+i>1+this.epsilon)return null;const A=k.Ap.Dot(q,O)*F;return A>this.length?null:new T.d(1-o-i,o,A)}intersectsPlane(M){let p;const b=k.Ap.Dot(M.normal,this.direction);if(Math.abs(b)<9.99999997475243e-7)return null;{const Q=k.Ap.Dot(M.normal,this.origin);return p=(-M.d-Q)/b,p<0?p<-9.99999997475243e-7?null:0:p}}intersectsAxis(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(M){case"y":{const M=(this.origin.y-p)/this.direction.y;return M>0?null:new k.Ap(this.origin.x+this.direction.x*-M,p,this.origin.z+this.direction.z*-M)}case"x":{const M=(this.origin.x-p)/this.direction.x;return M>0?null:new k.Ap(p,this.origin.y+this.direction.y*-M,this.origin.z+this.direction.z*-M)}case"z":{const M=(this.origin.z-p)/this.direction.z;return M>0?null:new k.Ap(this.origin.x+this.direction.x*-M,this.origin.y+this.direction.y*-M,p)}default:return null}}intersectsMesh(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const u=k.TmpVectors.Matrix[0];return M.getWorldMatrix().invertToRef(u),this._tmpRay?W.TransformToRef(this,u,this._tmpRay):this._tmpRay=W.Transform(this,u),M.intersects(this._tmpRay,p,b,Q,q,B)}intersectsMeshes(M,p,b){b?b.length=0:b=[];for(let Q=0;Q<M.length;Q++){const q=this.intersectsMesh(M[Q],p);q.hit&&b.push(q)}return b.sort(this._comparePickingInfo),b}_comparePickingInfo(M,p){return M.distance<p.distance?-1:M.distance>p.distance?1:0}intersectionSegment(M,p,b){const Q=this.origin,q=k.TmpVectors.Ap[0],B=k.TmpVectors.Ap[1],u=k.TmpVectors.Ap[2],T=k.TmpVectors.Ap[3];p.subtractToRef(M,q),this.direction.scaleToRef(W._Rayl,u),Q.addToRef(u,B),M.subtractToRef(Q,T);const O=k.Ap.Dot(q,q),H=k.Ap.Dot(q,u),F=k.Ap.Dot(u,u),o=k.Ap.Dot(q,T),i=k.Ap.Dot(u,T),A=O*F-H*H;let j,K,D=A,a=A;A<W._Smallnum?(j=0,D=1,K=i,a=F):(j=H*i-F*o,K=O*i-H*o,j<0?(j=0,K=i,a=F):j>D&&(j=D,K=i+H,a=F)),K<0?(K=0,-o<0?j=0:-o>O?j=D:(j=-o,D=O)):K>a&&(K=a,-o+H<0?j=0:-o+H>O?j=D:(j=-o+H,D=O));const s=Math.abs(j)<W._Smallnum?0:j/D,S=Math.abs(K)<W._Smallnum?0:K/a,f=k.TmpVectors.Ap[4];u.scaleToRef(S,f);const R=k.TmpVectors.Ap[5];q.scaleToRef(s,R),R.addInPlace(T);const y=k.TmpVectors.Ap[6];R.subtractToRef(f,y);return S>0&&S<=this.length&&y.lengthSquared()<b*b?R.length():-1}update(M,p,b,Q,q,B,u){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){W._RayDistant||(W._RayDistant=W.Zero()),W._RayDistant.unprojectRayToRef(M,p,b,Q,k.Matrix.IdentityReadOnly,B,u);const T=k.TmpVectors.Matrix[0];q.invertToRef(T),W.TransformToRef(W._RayDistant,T,this)}else this.unprojectRayToRef(M,p,b,Q,q,B,u);return this}static Zero(){return new W(k.Ap.Zero(),k.Ap.Zero())}static CreateNew(M,p,b,Q,q,B,k){return W.Zero().update(M,p,b,Q,q,B,k)}static CreateNewFromTo(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.Matrix.IdentityReadOnly;const Q=new W(new k.Ap(0,0,0),new k.Ap(0,0,0));return W.CreateFromToToRef(M,p,Q,b)}static CreateFromToToRef(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.Matrix.IdentityReadOnly;b.origin.B(M);const q=p.subtractToRef(M,b.direction),B=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z);return b.length=B,b.direction.normalize(),W.TransformToRef(b,Q,b)}static Transform(M,p){const b=new W(new k.Ap(0,0,0),new k.Ap(0,0,0));return W.TransformToRef(M,p,b),b}static TransformToRef(M,p,b){k.Ap.TransformCoordinatesToRef(M.origin,p,b.origin),k.Ap.TransformNormalToRef(M.direction,p,b.direction),b.length=M.length,b.epsilon=M.epsilon;const Q=b.direction,q=Q.length();if(0!==q&&1!==q){const M=1/q;Q.x*=M,Q.y*=M,Q.z*=M,b.length*=q}return b}unprojectRayToRef(M,p,b,Q,q,B,u){const T=k.TmpVectors.Matrix[0];q.multiplyToRef(B,T),T.multiplyToRef(u,T),T.invert();const O=H.c.LastCreatedEngine,F=k.TmpVectors.Ap[0];F.x=M/b*2-1,F.y=-(p/Q*2-1),F.z=null!==O&&void 0!==O&&O.useReverseDepthBuffer?1:null!==O&&void 0!==O&&O.isNDCHalfZRange?0:-1;const o=k.TmpVectors.Ap[1].Db(F.x,F.y,1-1e-8),W=k.TmpVectors.Ap[2],i=k.TmpVectors.Ap[3];k.Ap._UnprojectFromInvertedMatrixToRef(F,T,W),k.Ap._UnprojectFromInvertedMatrixToRef(o,T,i),this.origin.B(W),i.subtractToRef(W,this.direction),this.direction.normalize()}}function i(M,p,b,Q,q){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=W.Zero();return A(M,p,b,Q,k,q,B),k}function A(M,p,b,Q,q,B){let u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const O=M.getEngine();if(!B&&!(B=M.activeCamera))return M;const H=B.viewport,F=O.getRenderHeight(),{x:o,y:W,width:i,height:A}=H.toGlobal(O.getRenderWidth(),F),j=1/O.getHardwareScalingLevel();return p=p*j-o,b=b*j-(F-W-A),q.update(p,b,i,A,Q||k.Matrix.IdentityReadOnly,u?k.Matrix.IdentityReadOnly:B.getViewMatrix(),B.getProjectionMatrix(),T),M}function j(M,p,b,Q,q){if(!O.d)return M;const B=M.getEngine();if(!q&&!(q=M.activeCamera))throw new Error("Active camera not set");const u=q.viewport,T=B.getRenderHeight(),{x:H,y:F,width:o,height:W}=u.toGlobal(B.getRenderWidth(),T),i=k.Matrix.Identity(),A=1/B.getHardwareScalingLevel();return p=p*A-H,b=b*A-(T-F-W),Q.update(p,b,o,W,i,i,q.getProjectionMatrix()),M}function K(M,p,b,Q,q,B,k,u){const T=p(Q,b.enableDistantPicking),O=b.intersects(T,q,k,B,Q,u);return O&&O.hit?!q&&null!=M&&O.distance>=M.distance?null:O:null}function D(M,p,b,Q,q,B){let u=null;const T=!!(M.activeCameras&&M.activeCameras.length>1&&M.cameraToUseForPointers!==M.activeCamera),H=M.cameraToUseForPointers||M.activeCamera,F=o.internalPickerForMesh||K;for(let O=0;O<M.meshes.length;O++){const o=M.meshes[O];if(b){if(!b(o,-1))continue}else if(!o.isEnabled()||!o.isVisible||!o.GT)continue;const W=T&&o.isWorldMatrixCameraDependent(),i=o.ib(W,H);if(o.hasThinInstances&&o.LO){const M=F(u,p,o,i,!0,!0,B);if(M){if(q)return M;const T=k.TmpVectors.Matrix[1],O=o.thinInstanceGetWorldMatrices();for(let M=0;M<O.length;M++){if(b&&!b(o,M))continue;O[M].multiplyToRef(i,T);const k=F(u,p,o,T,Q,q,B,!0);if(k&&(u=k,u.thinInstanceIndex=M,Q))return u}}}else{const M=F(u,p,o,i,Q,q,B);if(M&&(u=M,Q))return u}}return u||new O.d}function a(M,p,b,Q){if(!O.d)return null;const q=[],B=!!(M.activeCameras&&M.activeCameras.length>1&&M.cameraToUseForPointers!==M.activeCamera),u=M.cameraToUseForPointers||M.activeCamera,T=o.internalPickerForMesh||K;for(let O=0;O<M.meshes.length;O++){const H=M.meshes[O];if(b){if(!b(H,-1))continue}else if(!H.isEnabled()||!H.isVisible||!H.GT)continue;const F=B&&H.isWorldMatrixCameraDependent(),o=H.ib(F,u);if(H.hasThinInstances&&H.LO){if(T(null,p,H,o,!0,!0,Q)){const M=k.TmpVectors.Matrix[1],B=H.thinInstanceGetWorldMatrices();for(let k=0;k<B.length;k++){if(b&&!b(H,k))continue;B[k].multiplyToRef(o,M);const u=T(null,p,H,M,!1,!1,Q,!0);u&&(u.thinInstanceIndex=k,q.push(u))}}}else{const M=T(null,p,H,o,!1,!1,Q);M&&q.push(M)}}return q}function s(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,Q=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;Q||(Q=M.getWorldMatrix()),p.length=b,q?p.origin.B(q):p.origin.B(M.position);const B=k.TmpVectors.Ap[2];B.set(0,0,M._scene.useRightHandedSystem?-1:1);const u=k.TmpVectors.Ap[3];return k.Ap.TransformNormalToRef(B,Q,u),k.Ap.NormalizeToRef(u,p.direction),p}var S,f;W._TmpVector3=(0,u.e)(6,k.Ap.Zero),W._RayDistant=W.Zero(),W._Smallnum=1e-8,W._Rayl=1e9,S=Q.e,(f=q.b)&&(f.prototype.getForwardRay=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,p=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;return s(this,new W(k.Ap.Zero(),k.Ap.Zero(),M),M,p,b)},f.prototype.getForwardRayToRef=function(M){return s(this,M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),S&&(F.c._IsPickingAvailable=!0,S.prototype.createPickingRay=function(M,p,b,Q){return i(this,M,p,b,Q,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),Q.e.prototype.createPickingRayToRef=function(M,p,b,Q,q){return A(this,M,p,b,Q,q,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},Q.e.prototype.createPickingRayInCameraSpace=function(M,p,b){return function(M,p,b,Q){const q=W.Zero();return j(M,p,b,q,Q),q}(this,M,p,b)},Q.e.prototype.createPickingRayInCameraSpaceToRef=function(M,p,b,Q){return j(this,M,p,b,Q)},Q.e.prototype.pickWithBoundingInfo=function(M,p,b,Q,q){return function(M,p,b,Q,q,B){if(!O.d)return null;const u=D(M,(Q=>(M._tempPickingRay||(M._tempPickingRay=W.Zero()),A(M,p,b,Q,M._tempPickingRay,B||null),M._tempPickingRay)),Q,q,!0);return u&&(u.ray=i(M,p,b,k.Matrix.Identity(),B||null)),u}(this,M,p,b,Q,q)},Q.e.prototype.FQ=function(M,p,b,Q,q,B){return function(M,p,b,Q,q,B,u){const T=D(M,((Q,q)=>(M._tempPickingRay||(M._tempPickingRay=W.Zero()),A(M,p,b,Q,M._tempPickingRay,B||null,!1,q),M._tempPickingRay)),Q,q,!1,u);return T&&(T.ray=i(M,p,b,k.Matrix.Identity(),B||null)),T}(this,M,p,b,Q,q,B)},Q.e.prototype.pickWithRay=function(M,p,b,Q){return function(M,p,b,Q,q){const B=D(M,(b=>(M._pickWithRayInverseMatrix||(M._pickWithRayInverseMatrix=k.Matrix.Identity()),b.invertToRef(M._pickWithRayInverseMatrix),M._cachedRayForTransform||(M._cachedRayForTransform=W.Zero()),W.TransformToRef(p,M._pickWithRayInverseMatrix,M._cachedRayForTransform),M._cachedRayForTransform)),b,Q,!1,q);return B&&(B.ray=p),B}(this,M,p,b,Q)},Q.e.prototype.multiPick=function(M,p,b,Q,q){return function(M,p,b,Q,q,B){return a(M,(Q=>i(M,p,b,Q,q||null)),Q,B)}(this,M,p,b,Q,q)},Q.e.prototype.multiPickWithRay=function(M,p,b){return function(M,p,b,Q){return a(M,(b=>(M._pickWithRayInverseMatrix||(M._pickWithRayInverseMatrix=k.Matrix.Identity()),b.invertToRef(M._pickWithRayInverseMatrix),M._cachedRayForTransform||(M._cachedRayForTransform=W.Zero()),W.TransformToRef(p,M._pickWithRayInverseMatrix,M._cachedRayForTransform),M._cachedRayForTransform)),b,Q)}(this,M,p,b)}},13437:(M,p,b)=>{"use strict";var Q=b(11729),q=b(11637),B=b(11671),k=b(11764),u=b(11700),T=b(11742);u.c.prototype._partialLoadFile=function(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(M,(M=>{b[p]=M,b._internalCount++,6===b._internalCount&&Q(b)}),void 0,void 0,!0,((M,p)=>{q&&M&&q(M.status+" "+M.statusText,p)}))},u.c.prototype._cascadeLoadFiles=function(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const q=[];q._internalCount=0;for(let B=0;B<6;B++)this._partialLoadFile(b[B],B,q,p,Q)},u.c.prototype._cascadeLoadImgs=function(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5?arguments[5]:void 0;const k=[];k._internalCount=0;for(let u=0;u<6;u++)this._partialLoadImg(Q[u],u,k,M,p,b,q,B)},u.c.prototype._partialLoadImg=function(M,p,b,Q,q,u){let T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7?arguments[7]:void 0;const H=(0,k.c)();(0,B.p)(M,(M=>{b[p]=M,b._internalCount++,Q&&Q.removePendingData(H),6===b._internalCount&&u&&u(q,b)}),((M,p)=>{Q&&Q.removePendingData(H),T&&T(M,p)}),Q?Q.offlineProvider:null,O),Q&&Q.addPendingData(H)},u.c.prototype.createCubeTextureBase=function(M,p,b,B){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6?arguments[6]:void 0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,W=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,A=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,j=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,K=arguments.length>14&&void 0!==arguments[14]&&arguments[14],D=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const a=i||new Q.b(this,7);a.isCube=!0,a.url=M,a.generateMipMaps=!B,a._lodGenerationScale=o,a._lodGenerationOffset=W,a._useSRGBBuffer=!!K&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!B),a!==i&&(a.label=M.substring(0,60)),this._doNotHandleContextLost||(a._extension=H,a._files=b,a._buffer=D);const s=M;this._transformTextureUrl&&!i&&(M=this._transformTextureUrl(M));const S=H??function(M){const p=M.split("?")[0],b=p.lastIndexOf(".");return b>-1?p.substring(b).toLowerCase():""}(M),f=(0,T.d)(S),R=(M,p)=>{a.dispose(),u?u(M,p):M&&q.c.Warn(M)},y=(Q,u)=>{M===s?Q&&R(Q.status+" "+Q.statusText,u):(q.c.Warn(`Failed to load ${M}, falling back to the ${s}`),this.createCubeTextureBase(s,p,b,!!B,k,R,O,H,F,o,W,a,A,j,K,D))};if(f)f.then((Q=>{const q=M=>{A&&A(a,M),Q.loadCubeData(M,a,F,k,((M,p)=>{R(M,p)}))};D?q(D):b&&6===b.length?Q.supportCascades?this._cascadeLoadFiles(p,(M=>q(M.map((M=>new Uint8Array(M))))),b,R):R("Textures type does not support cascades."):this._loadFile(M,(M=>q(new Uint8Array(M))),void 0,void 0,!0,y)}));else{if(!b||0===b.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(p,a,((M,p)=>{j&&j(M,p)}),b,R)}return this._internalTexturesCache.push(a),a}},13964:(M,p,b)=>{"use strict";b(11637);var Q=b(11911);b(11729),b(11861),b(11722),b(11965),b(11921);Q.e},13468:(M,p,b)=>{"use strict";b.d(p,{e:()=>q});var Q=b(11757);class q{constructor(M){this.value=this._toInt(M)}_toInt(M){return 0|M}add(M){return new q(this.value+M.value)}jp(M){return new q(this.value-M.value)}multiply(M){return new q(Math.imul(this.value,M.value))}divide(M){return new q(this.value/M.value)}getClassName(){return q.ClassName}equals(M){return this.value===M.value}static FromValue(M){return new q(M)}toString(){return this.value.toString()}}q.ClassName="FlowGraphInteger",(0,Q.g)("FlowGraphInteger",q)},13479:(M,p,b)=>{"use strict";b.d(p,{d:()=>q,h:()=>B});var Q=b(11796);class q{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Qb=M}get m(){return this.Qb}transformVector(M){return this.transformVectorToRef(M,new Q.Vector2)}transformVectorToRef(M,p){return p.x=M.x*this.Qb[0]+M.y*this.Qb[1],p.y=M.x*this.Qb[2]+M.y*this.Qb[3],p}Ob(){return this.toArray()}toArray(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let p=0;p<4;p++)M[p]=this.Qb[p];return M}oQ(M){for(let p=0;p<4;p++)this.Qb[p]=M[p];return this}multiplyToRef(M,p){const b=M.Qb,Q=this.Qb,q=p.Qb;return q[0]=b[0]*Q[0]+b[1]*Q[2],q[1]=b[0]*Q[1]+b[1]*Q[3],q[2]=b[2]*Q[0]+b[3]*Q[2],q[3]=b[2]*Q[1]+b[3]*Q[3],p}multiply(M){return this.multiplyToRef(M,new q)}divideToRef(M,p){const b=this.Qb,Q=M.Qb,q=p.Qb;return q[0]=b[0]/Q[0],q[1]=b[1]/Q[1],q[2]=b[2]/Q[2],q[3]=b[3]/Q[3],p}divide(M){return this.divideToRef(M,new q)}addToRef(M,p){const b=this.Qb,Q=M.m,q=p.m;return q[0]=b[0]+Q[0],q[1]=b[1]+Q[1],q[2]=b[2]+Q[2],q[3]=b[3]+Q[3],p}add(M){return this.addToRef(M,new q)}subtractToRef(M,p){const b=this.Qb,Q=M.m,q=p.m;return q[0]=b[0]-Q[0],q[1]=b[1]-Q[1],q[2]=b[2]-Q[2],q[3]=b[3]-Q[3],p}jp(M){return this.subtractToRef(M,new q)}transpose(){const M=this.Qb;return new q([M[0],M[2],M[1],M[3]])}determinant(){const M=this.Qb;return M[0]*M[3]-M[1]*M[2]}inverse(){const M=this.determinant();if(0===M)throw new Error("Matrix is not invertible");const p=this.Qb,b=1/M;return new q([p[3]*b,-p[1]*b,-p[2]*b,p[0]*b])}equals(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.Qb,Q=M.m;return 0===p?b[0]===Q[0]&&b[1]===Q[1]&&b[2]===Q[2]&&b[3]===Q[3]:Math.abs(b[0]-Q[0])<p&&Math.abs(b[1]-Q[1])<p&&Math.abs(b[2]-Q[2])<p&&Math.abs(b[3]-Q[3])<p}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Qb.join(", ")})`}}class B{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Qb=M}get m(){return this.Qb}transformVector(M){return this.transformVectorToRef(M,new Q.Ap)}transformVectorToRef(M,p){const b=this.Qb;return p.x=M.x*b[0]+M.y*b[1]+M.z*b[2],p.y=M.x*b[3]+M.y*b[4]+M.z*b[5],p.z=M.x*b[6]+M.y*b[7]+M.z*b[8],p}multiplyToRef(M,p){const b=M.Qb,Q=this.Qb,q=p.m;return q[0]=b[0]*Q[0]+b[1]*Q[3]+b[2]*Q[6],q[1]=b[0]*Q[1]+b[1]*Q[4]+b[2]*Q[7],q[2]=b[0]*Q[2]+b[1]*Q[5]+b[2]*Q[8],q[3]=b[3]*Q[0]+b[4]*Q[3]+b[5]*Q[6],q[4]=b[3]*Q[1]+b[4]*Q[4]+b[5]*Q[7],q[5]=b[3]*Q[2]+b[4]*Q[5]+b[5]*Q[8],q[6]=b[6]*Q[0]+b[7]*Q[3]+b[8]*Q[6],q[7]=b[6]*Q[1]+b[7]*Q[4]+b[8]*Q[7],q[8]=b[6]*Q[2]+b[7]*Q[5]+b[8]*Q[8],p}multiply(M){return this.multiplyToRef(M,new B)}divideToRef(M,p){const b=this.Qb,Q=M.m,q=p.m;return q[0]=b[0]/Q[0],q[1]=b[1]/Q[1],q[2]=b[2]/Q[2],q[3]=b[3]/Q[3],q[4]=b[4]/Q[4],q[5]=b[5]/Q[5],q[6]=b[6]/Q[6],q[7]=b[7]/Q[7],q[8]=b[8]/Q[8],p}divide(M){return this.divideToRef(M,new B)}addToRef(M,p){const b=this.Qb,Q=M.m,q=p.m;return q[0]=b[0]+Q[0],q[1]=b[1]+Q[1],q[2]=b[2]+Q[2],q[3]=b[3]+Q[3],q[4]=b[4]+Q[4],q[5]=b[5]+Q[5],q[6]=b[6]+Q[6],q[7]=b[7]+Q[7],q[8]=b[8]+Q[8],p}add(M){return this.addToRef(M,new B)}subtractToRef(M,p){const b=this.Qb,Q=M.m,q=p.m;return q[0]=b[0]-Q[0],q[1]=b[1]-Q[1],q[2]=b[2]-Q[2],q[3]=b[3]-Q[3],q[4]=b[4]-Q[4],q[5]=b[5]-Q[5],q[6]=b[6]-Q[6],q[7]=b[7]-Q[7],q[8]=b[8]-Q[8],p}jp(M){return this.subtractToRef(M,new B)}toArray(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let p=0;p<9;p++)M[p]=this.Qb[p];return M}Ob(){return this.toArray()}oQ(M){for(let p=0;p<9;p++)this.Qb[p]=M[p];return this}transpose(){const M=this.Qb;return new B([M[0],M[3],M[6],M[1],M[4],M[7],M[2],M[5],M[8]])}determinant(){const M=this.Qb;return M[0]*(M[4]*M[8]-M[5]*M[7])-M[1]*(M[3]*M[8]-M[5]*M[6])+M[2]*(M[3]*M[7]-M[4]*M[6])}inverse(){const M=this.determinant();if(0===M)throw new Error("Matrix is not invertible");const p=this.Qb,b=1/M;return new B([(p[4]*p[8]-p[5]*p[7])*b,(p[2]*p[7]-p[1]*p[8])*b,(p[1]*p[5]-p[2]*p[4])*b,(p[5]*p[6]-p[3]*p[8])*b,(p[0]*p[8]-p[2]*p[6])*b,(p[2]*p[3]-p[0]*p[5])*b,(p[3]*p[7]-p[4]*p[6])*b,(p[1]*p[6]-p[0]*p[7])*b,(p[0]*p[4]-p[1]*p[3])*b])}equals(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.Qb,Q=M.m;return 0===p?b[0]===Q[0]&&b[1]===Q[1]&&b[2]===Q[2]&&b[3]===Q[3]&&b[4]===Q[4]&&b[5]===Q[5]&&b[6]===Q[6]&&b[7]===Q[7]&&b[8]===Q[8]:Math.abs(b[0]-Q[0])<p&&Math.abs(b[1]-Q[1])<p&&Math.abs(b[2]-Q[2])<p&&Math.abs(b[3]-Q[3])<p&&Math.abs(b[4]-Q[4])<p&&Math.abs(b[5]-Q[5])<p&&Math.abs(b[6]-Q[6])<p&&Math.abs(b[7]-Q[7])<p&&Math.abs(b[8]-Q[8])<p}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Qb.join(", ")})`}}},13485:(M,p,b)=>{"use strict";var Q;function q(M,p,b,Q){switch(p){case"Animation":return Q?M.animations.find((M=>M.uniqueId===b))??null:M.animations[b]??null;case"AnimationGroup":return Q?M.animationGroups.find((M=>M.uniqueId===b))??null:M.animationGroups[b]??null;case"Mesh":return Q?M.meshes.find((M=>M.uniqueId===b))??null:M.meshes[b]??null;case"Material":return Q?M.materials.find((M=>M.uniqueId===b))??null:M.materials[b]??null;case"aH":return Q?M.cameras.find((M=>M.uniqueId===b))??null:M.cameras[b]??null;case"Light":return Q?M.lights.find((M=>M.uniqueId===b))??null:M.lights[b]??null;default:return null}}b.d(p,{d:()=>q}),function(M){M.Animation="Animation",M.AnimationGroup="AnimationGroup",M.Mesh="Mesh",M.Material="Material",M.aH="aH",M.Light="Light"}(Q||(Q={}))},13516:(M,p,b)=>{"use strict";b.d(p,{b:()=>q});var Q=b(13520);class q extends Q.c{constructor(M,p){if(super(M),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),p)for(const b of p)this._eventsSignalOutputs[b]=this._registerSignalOutput(b+"Event")}_executeOnTick(M){}_startPendingTasks(M){M._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(M),this._resetAfterCanceled(M)),this._preparePendingTasks(M),M._addPendingBlock(this),this.out._activateSignal(M),M._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(M){M._deleteExecutionVariable(this,"_initialized"),M._removePendingBlock(this)}}},13492:(M,p,b)=>{"use strict";b.d(p,{b:()=>O});var Q=b(11764),q=b(11757),B=b(13499),k=b(11624),u=b(13459);class T extends B.e{constructor(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Q.defaultValue,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(M,p,b),this.richType=Q,this._defaultValue=q,this._optional=B,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new k.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(M){this._isDisabled!==M&&(this._isDisabled=M,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(M,p){p._getConnectionValue(this)!==M&&(p._setConnectionValue(this,M),this.onValueChangedObservable.notifyObservers(M))}resetToDefaultValue(M){M._setConnectionValue(this,this._defaultValue)}connectTo(M){this._isDisabled||super.connectTo(M)}_getValueOrDefault(M){const p=M._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(p):p}getValue(M){if(1===this.connectionType){M._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(M);const p=this._getValueOrDefault(M);return this._lastValue=p,this.richType.typeTransformer?this.richType.typeTransformer(p):p}const p=this.isConnected()?this._connectedPoint[0].getValue(M):this._getValueOrDefault(M);return this._lastValue=p,this.richType.typeTransformer?this.richType.typeTransformer(p):p}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.richType={},this.richType.serialize(M.richType),M.optional=this._optional,(0,u.f)("defaultValue",this._defaultValue,M)}}(0,q.g)("FlowGraphDataConnection",T);class O{constructor(M){var p;this.config=M,this.uniqueId=(0,Q.c)(),this.name=(null===(p=this.config)||void 0===p?void 0:p.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(M){}registerDataInput(M,p,b){const Q=new T(M,0,this,p,b);return this.dataInputs.push(Q),Q}registerDataOutput(M,p,b){const Q=new T(M,1,this,p,b);return this.dataOutputs.push(Q),Q}getDataInput(M){return this.dataInputs.find((p=>p.name===M))}getDataOutput(M){return this.dataOutputs.find((p=>p.name===M))}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.f;if(M.uniqueId=this.uniqueId,M.config={},this.config){const b=this.config,Q=Object.keys(b);for(const q of Q)p(q,b[q],M.config)}M.dataInputs=[],M.dataOutputs=[],M.className=this.getClassName();for(const b of this.dataInputs){const p={};b.serialize(p),M.dataInputs.push(p)}for(const b of this.dataOutputs){const p={};b.serialize(p),M.dataOutputs.push(p)}}deserialize(M){}_log(M,p,b){var Q;null===(Q=M.logger)||void 0===Q||Q.addLogItem({action:p,WQ:b,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13499:(M,p,b)=>{"use strict";b.d(p,{e:()=>B});var Q,q=b(11764);!function(M){M[M.Input=0]="Input",M[M.Output=1]="Output"}(Q||(Q={}));class B{constructor(M,p,b){this._ownerBlock=b,this._connectedPoint=[],this.uniqueId=(0,q.c)(),this.connectedPointIds=[],this.name=M,this._connectionType=p}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(M){if(this._connectionType===M._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||M._isSingularConnection()&&M._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(M),M._connectedPoint.push(this)}disconnectFrom(M){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this._connectedPoint.indexOf(M),Q=M._connectedPoint.indexOf(this);-1!==b&&-1!==Q&&(p&&this._connectedPoint.splice(b,1),M._connectedPoint.splice(Q,1))}disconnectFromAll(){for(const M of this._connectedPoint)this.disconnectFrom(M,!1);this._connectedPoint.length=0}dispose(){for(const M of this._connectedPoint)this.disconnectFrom(M)}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};M.uniqueId=this.uniqueId,M.name=this.name,M._connectionType=this._connectionType,M.connectedPointIds=[],M.className=this.getClassName();for(const p of this._connectedPoint)M.connectedPointIds.push(p.uniqueId)}getClassName(){return"FGConnection"}deserialize(M){this.uniqueId=M.uniqueId,this.name=M.name,this._connectionType=M._connectionType,this.connectedPointIds=M.connectedPointIds}}},13454:(M,p,b)=>{"use strict";b.d(p,{c:()=>a});var Q,q=b(11624),B=b(11784),k=b(11788),u=b(11764),T=b(13459),O=b(13485),H=b(11637);!function(M){M.ExecuteBlock="ExecuteBlock",M.ExecuteEvent="ExecuteEvent",M.TriggerConnection="TriggerConnection",M.ContextVariableSet="ContextVariableSet",M.GlobalVariableSet="GlobalVariableSet",M.GlobalVariableDelete="GlobalVariableDelete",M.GlobalVariableGet="GlobalVariableGet",M.AddConnection="AddConnection",M.GetConnectionValue="GetConnectionValue",M.SetConnectionValue="SetConnectionValue",M.ActivateSignal="ActivateSignal",M.ContextVariableGet="ContextVariableGet"}(Q||(Q={}));class F{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(M){if(M.time||(M.time=Date.now()),this.log.push(M),this.logToConsole){var p;const b=null===(p=M.WQ)||void 0===p?void 0:p.value;"object"===typeof b&&b.getClassName?H.c.Log(`[FGLog] ${M.className}:${M.uniqueId.split("-")[0]} ${M.action} - ${JSON.stringify(b.getClassName())}: ${b.toString()}`):H.c.Log(`[FGLog] ${M.className}:${M.uniqueId.split("-")[0]} ${M.action} - ${JSON.stringify(M.WQ)}`)}}getItemsOfType(M){return this.log.filter((p=>p.action===M))}}class o{get enableLogging(){return this._enableLogging}set enableLogging(M){this._enableLogging!==M&&(this._enableLogging=M,this._enableLogging?(this.logger=new F,this.logger.logToConsole=!0):this.logger=null)}constructor(M){this.uniqueId=(0,u.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new q.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=M,this.assetsContext=M.assetsContext??M.Kp}hasVariable(M){return M in this._userVariables}setVariable(M,p){var b;this._userVariables[M]=p,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",WQ:{name:M,value:p}})}getAsset(M,p){return(0,O.d)(this.assetsContext,M,p)}getVariable(M){var p;return null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",WQ:{name:M,value:this._userVariables[M]}}),this._userVariables[M]}get userVariables(){return this._userVariables}RM(){return this._configuration.Kp}_getUniqueIdPrefixedName(M,p){return`${M.uniqueId}_${p}`}_getGlobalContextVariable(M,p){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",WQ:{name:M,defaultValue:p,possibleValue:this._globalContextVariables[M]}}),this._hasGlobalContextVariable(M)?this._globalContextVariables[M]:p}_setGlobalContextVariable(M,p){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",WQ:{name:M,value:p}}),this._globalContextVariables[M]=p}_deleteGlobalContextVariable(M){var p;null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",WQ:{name:M}}),delete this._globalContextVariables[M]}_hasGlobalContextVariable(M){return M in this._globalContextVariables}_setExecutionVariable(M,p,b){this._executionVariables[this._getUniqueIdPrefixedName(M,p)]=b}_getExecutionVariable(M,p,b){return this._hasExecutionVariable(M,p)?this._executionVariables[this._getUniqueIdPrefixedName(M,p)]:b}_deleteExecutionVariable(M,p){delete this._executionVariables[this._getUniqueIdPrefixedName(M,p)]}_hasExecutionVariable(M,p){return this._getUniqueIdPrefixedName(M,p)in this._executionVariables}_hasConnectionValue(M){return M.uniqueId in this._connectionValues}_setConnectionValue(M,p){var b;this._connectionValues[M.uniqueId]=p,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",WQ:{connectionPointId:M.uniqueId,value:p}})}_setConnectionValueByKey(M,p){this._connectionValues[M]=p}_getConnectionValue(M){var p;return null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",WQ:{connectionPointId:M.uniqueId,value:this._connectionValues[M.uniqueId]}}),this._connectionValues[M.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(M){this._pendingBlocks.includes(M)||(this._pendingBlocks.push(M),this._pendingBlocks.sort(((M,p)=>M.priority-p.priority)))}_removePendingBlock(M){const p=this._pendingBlocks.indexOf(M);-1!==p&&this._pendingBlocks.splice(p,1)}_clearPendingBlocks(){for(const M of this._pendingBlocks)M._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(M){var p;this.onNodeExecutedObservable.notifyObservers(M),null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:M.getClassName(),uniqueId:M.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(M){this._setGlobalContextVariable("timeSinceStart",M.timeSinceStart),this._setGlobalContextVariable("deltaTime",M.deltaTime);for(const b of this._pendingBlocks){var p;null===(p=b._executeOnTick)||void 0===p||p.call(b,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.f;M.uniqueId=this.uniqueId,M._userVariables={};for(const Q in this._userVariables)p(Q,this._userVariables[Q],M._userVariables);M._connectionValues={};for(const Q in this._connectionValues)p(Q,this._connectionValues[Q],M._connectionValues);var b;this.assetsContext!==this.RM()&&(M._assetsContext={meshes:this.assetsContext.meshes.map((M=>M.id)),materials:this.assetsContext.materials.map((M=>M.id)),textures:this.assetsContext.textures.map((M=>M.name)),animations:this.assetsContext.animations.map((M=>M.name)),lights:this.assetsContext.lights.map((M=>M.id)),cameras:this.assetsContext.cameras.map((M=>M.id)),ho:null===(b=this.assetsContext.ho)||void 0===b?void 0:b.map((M=>M.name)),skeletons:this.assetsContext.skeletons.map((M=>M.id)),qo:this.assetsContext.qo.map((M=>M.name)),geometries:this.assetsContext.geometries.map((M=>M.id)),multiMaterials:this.assetsContext.multiMaterials.map((M=>M.id)),transformNodes:this.assetsContext.transformNodes.map((M=>M.id))})}getClassName(){return"FlowGraphContext"}}(0,B.c)([(0,k.R)()],o.prototype,"uniqueId",void 0);var W=b(13488),i=b(12082);class A{constructor(M){this.onEventTriggeredObservable=new q.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=M,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.bb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const M=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",WQ:{timeSinceStart:this._startingTime,deltaTime:M}}),this._startingTime+=M})),this._meshPickedObserver=this._scene.onPointerObservable.add((M=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",WQ:M})}),i.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((M=>{const p=M.pointerId,b=M.mesh,Q=this._pointerUnderMeshState[p];!Q&&b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",WQ:{pointerId:p,mesh:b}}):Q&&!b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",WQ:{pointerId:p,mesh:Q}}):Q&&b&&Q!==b&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",WQ:{pointerId:p,mesh:Q,over:b}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",WQ:{pointerId:p,mesh:b,out:Q}})),this._pointerUnderMeshState[p]=b}),i.e.POINTERMOVE)}dispose(){var M,p,b,Q,q;null===(M=this._sceneDisposeObserver)||void 0===M||M.remove(),null===(p=this._sceneReadyObserver)||void 0===p||p.remove(),null===(b=this._sceneOnBeforeRenderObserver)||void 0===b||b.remove(),null===(Q=this._meshPickedObserver)||void 0===Q||Q.remove(),null===(q=this._meshUnderPointerObserver)||void 0===q||q.remove(),this.onEventTriggeredObservable.clear()}}var j,K=b(13507);!function(M){M[M.Stopped=0]="Stopped",M[M.Started=1]="Started"}(j||(j={}));class D{get state(){return this._state}set state(M){this._state=M,this.onStateChangedObservable.notifyObservers(M)}constructor(M){this.onStateChangedObservable=new q.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=M.Kp,this._sceneEventCoordinator=new A(this._scene),this._coordinator=M.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((M=>{for(const p of this._executionContexts){const b=this._getContextualOrder(M.type,p);for(const Q of b)if(!Q._executeEvent(p,M.WQ))break}switch(M.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const p of this._executionContexts)p._notifyOnTick(M.WQ);break;case"SceneDispose":this.dispose()}}))}createContext(){const M=new o({Kp:this._scene,coordinator:this._coordinator});return this._executionContexts.push(M),M}getContext(M){return this._executionContexts[M]}addEventBlock(M){if("PointerOver"!==M.type&&"PointerOut"!==M.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==M.type&&this._eventBlocks[M.type].push(M),1===this.state)for(const p of this._executionContexts)M._startPendingTasks(p);else this.onStateChangedObservable.addOnce((p=>{if(1===p)for(const b of this._executionContexts)M._startPendingTasks(b)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((M=>{1===M&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const M of this._executionContexts)for(const p in this._eventBlocks){const b=this._getContextualOrder(p,M);for(const p of b)p._startPendingTasks(M)}}_getContextualOrder(M,p){const b=this._eventBlocks[M].sort(((M,p)=>p.initPriority-M.initPriority));if("MeshPick"===M){const M=[];for(const Q of b){const q=Q.asset.getValue(p);let B=0;for(;B<b.length;B++){const M=b[B].asset.getValue(p);if(q&&M&&(0,K.q)(q,M))break}M.splice(B,0,Q)}return M}return b}dispose(){var M;if(0!==this.state){this.state=0;for(const M of this._executionContexts)M._clearPendingBlocks();this._executionContexts.length=0;for(const M in this._eventBlocks)this._eventBlocks[M].length=0;null===(M=this._eventObserver)||void 0===M||M.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(M){const p=[],b=new Set;for(const Q in this._eventBlocks)for(const M of this._eventBlocks[Q])p.push(M),b.add(M.uniqueId);for(;p.length>0;){const Q=p.pop();M(Q);for(const M of Q.dataInputs)for(const Q of M._connectedPoint)b.has(Q._ownerBlock.uniqueId)||(p.push(Q._ownerBlock),b.add(Q._ownerBlock.uniqueId));if(Q instanceof W.e)for(const M of Q.signalOutputs)for(const Q of M._connectedPoint)b.has(Q._ownerBlock.uniqueId)||(p.push(Q._ownerBlock),b.add(Q._ownerBlock.uniqueId))}}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1?arguments[1]:void 0;M.allBlocks=[],this.visitAllBlocks((p=>{const b={};p.serialize(b),M.allBlocks.push(b)})),M.executionContexts=[];for(const b of this._executionContexts){const Q={};b.serialize(Q,p),M.executionContexts.push(Q)}}}class a{constructor(M){this.config=M,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Kp.bb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Kp.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const M=this._executeOnNextFrame.slice(0);if(M.length)for(const p of M){this.notifyCustomEvent(p.id,p.data,!1);const M=this._executeOnNextFrame.findIndex((M=>M.uniqueId===p.uniqueId));-1!==M&&this._executeOnNextFrame.splice(M,1)}}));(a.SceneCoordinators.get(this.config.Kp)??[]).push(this)}createGraph(){const M=new D({Kp:this.config.Kp,coordinator:this});return this._flowGraphs.push(M),M}removeGraph(M){const p=this._flowGraphs.indexOf(M);-1!==p&&(M.dispose(),this._flowGraphs.splice(p,1))}start(){for(const M of this._flowGraphs)M.start()}dispose(){var M,p;for(const q of this._flowGraphs)q.dispose();this._flowGraphs.length=0,null===(M=this._disposeObserver)||void 0===M||M.remove(),null===(p=this._onBeforeRenderObserver)||void 0===p||p.remove();const b=a.SceneCoordinators.get(this.config.Kp)??[],Q=b.indexOf(this);-1!==Q&&b.splice(Q,1)}serialize(M,p){M._flowGraphs=[];for(const b of this._flowGraphs){const Q={};b.serialize(Q,p),M._flowGraphs.push(Q)}M.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(M){let p=this._customEventsMap.get(M);return p||(p=new q.b,this._customEventsMap.set(M,p)),p}notifyCustomEvent(M,p){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:M,data:p,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(M)){const p=this._eventExecutionCounter.get(M);if(this._eventExecutionCounter.set(M,p+1),p>=a.MaxEventTypeExecutionPerFrame)return void(p===a.MaxEventTypeExecutionPerFrame&&H.c.Warn(`FlowGraphCoordinator: Too many executions of event "${M}".`))}else this._eventExecutionCounter.set(M,1);const b=this._customEventsMap.get(M);b&&b.notifyObservers(p)}}a.MaxEventsPerType=30,a.MaxEventTypeExecutionPerFrame=30,a.SceneCoordinators=new Map},13512:(M,p,b)=>{"use strict";b.d(p,{e:()=>q});var Q=b(13516);class q extends Q.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(M){M._notifyExecuteNode(this),this.done._activateSignal(M)}}},13488:(M,p,b)=>{"use strict";b.d(p,{e:()=>u});var Q=b(13492),q=b(13499),B=b(11757);class k extends q.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(M){super.connectTo(M),this._connectedPoint.sort(((M,p)=>p.priority-M.priority))}_activateSignal(M){var p;if(null===(p=M.logger)||void 0===p||p.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,WQ:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)M._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(M,this),M._increaseExecutionId();else for(const b of this._connectedPoint)b._activateSignal(M)}}(0,B.g)("FlowGraphSignalConnection",k);class u extends Q.b{constructor(M){super(M),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(M){const p=new k(M,0,this);return this.signalInputs.push(p),p}_registerSignalOutput(M){const p=new k(M,1,this);return this.signalOutputs.push(p),p}_unregisterSignalInput(M){const p=this.signalInputs.findIndex((p=>p.name===M));-1!==p&&(this.signalInputs[p].dispose(),this.signalInputs.splice(p,1))}_unregisterSignalOutput(M){const p=this.signalOutputs.findIndex((p=>p.name===M));-1!==p&&(this.signalOutputs[p].dispose(),this.signalOutputs.splice(p,1))}_reportError(M,p){this.error.WQ="string"===typeof p?new Error(p):p,this.error._activateSignal(M)}getSignalInput(M){return this.signalInputs.find((p=>p.name===M))}getSignalOutput(M){return this.signalOutputs.find((p=>p.name===M))}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.signalInputs=[],M.signalOutputs=[];for(const p of this.signalInputs){const b={};p.serialize(b),M.signalInputs.push(b)}for(const p of this.signalOutputs){const b={};p.serialize(b),M.signalOutputs.push(b)}}deserialize(M){for(let p=0;p<M.signalInputs.length;p++){const b=this.getSignalInput(M.signalInputs[p].name);if(!b)throw new Error("Could not find signal input with name "+M.signalInputs[p].name+" in block "+M.className);b.deserialize(M.signalInputs[p])}for(let p=0;p<M.signalOutputs.length;p++){const b=this.getSignalOutput(M.signalOutputs[p].name);if(!b)throw new Error("Could not find signal output with name "+M.signalOutputs[p].name+" in block "+M.className);b.deserialize(M.signalOutputs[p])}}getClassName(){return"FlowGraphExecutionBlock"}}},13520:(M,p,b)=>{"use strict";b.d(p,{c:()=>q});var Q=b(13488);class q extends Q.e{constructor(M){super(M),this.out=this._registerSignalOutput("out")}}},13477:(M,p,b)=>{"use strict";b.d(p,{B:()=>W,C:()=>i,F:()=>A,J:()=>x,M:()=>P,P:()=>y,T:()=>R,c:()=>O,d:()=>o,e:()=>f,g:()=>j,k:()=>K,o:()=>D,q:()=>F,t:()=>S,x:()=>H});var Q,q=b(11796),B=b(11833),k=b(13468),u=b(13479);!function(M){M.Any="any",M.String="string",M.Number="number",M.Boolean="boolean",M.Object="object",M.Integer="FlowGraphInteger",M.Vector2="Vector2",M.Ap="Ap",M.Vector4="Vector4",M.Quaternion="Quaternion",M.Matrix="Matrix",M.Matrix2D="Matrix2D",M.Matrix3D="Matrix3D",M.ap="ap",M.Sb="Sb"}(Q||(Q={}));class T{constructor(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=M,this.defaultValue=p,this.animationType=b}serialize(M){M.typeName=this.typeName,M.defaultValue=this.defaultValue}}const O=new T("any",void 0),H=new T("string",""),F=new T("number",0,0),o=new T("boolean",!1),W=new T("Vector2",q.Vector2.Zero(),5),i=new T("Ap",q.Ap.Zero(),1),A=new T("Vector4",q.Vector4.Zero()),j=new T("Matrix",q.Matrix.Identity(),3),K=new T("Matrix2D",new u.d),D=new T("Matrix3D",new u.h),a=new T("ap",B.ap.Black(),4),s=new T("Sb",new B.Sb(0,0,0,0),7),S=new T("Quaternion",q.Quaternion.Identity(),2);S.typeTransformer=M=>{if(M.getClassName){if("Vector4"===M.getClassName())return q.Quaternion.sp(M.Ob());if("Ap"===M.getClassName())return q.Quaternion.FromEulerVector(M);if("Matrix"===M.getClassName())return q.Quaternion.FromRotationMatrix(M)}return M};const f=new T("FlowGraphInteger",new k.e(0),0);function R(M){const p=M;switch(typeof M){case"string":return H;case"number":return F;case"boolean":return o;case"object":if(p.getClassName)switch(p.getClassName()){case"Vector2":return W;case"Ap":return i;case"Vector4":return A;case"Matrix":return j;case"ap":return a;case"Sb":return s;case"Quaternion":return S;case"FlowGraphInteger":return f;case"Matrix2D":return K;case"Matrix3D":return D}return O;default:return O}}function y(M){switch(M){case"string":return H;case"number":return F;case"boolean":return o;case"Vector2":return W;case"Ap":return i;case"Vector4":return A;case"Matrix":return j;case"ap":return a;case"Sb":return s;case"Quaternion":return S;case"FlowGraphInteger":return f;case"Matrix2D":return K;case"Matrix3D":return D;default:return O}}function x(M){switch(M){case"number":default:return 0;case"Vector2":return 5;case"Ap":return 1;case"Matrix":return 3;case"ap":return 4;case"Sb":return 7;case"Quaternion":return 2}}function P(M){switch(M){case 0:return F;case 5:return W;case 1:return i;case 3:return j;case 4:return a;case 7:return s;case 2:return S;default:return O}}},13459:(M,p,b)=>{"use strict";b.d(p,{e:()=>H,f:()=>O,j:()=>F});var Q=b(11833),q=b(11796),B=b(13468),k=b(13477),u=b(13479);function T(M){return"Vector2"===M||"Ap"===M||"Vector4"===M||"Quaternion"===M||"ap"===M||"Sb"===M}function O(M,p,b){var Q;const q=(null===p||void 0===p||null===(Q=p.getClassName)||void 0===Q?void 0:Q.call(p))??"";if(T(q)||function(M){return"Matrix"===M||"Matrix2D"===M||"Matrix3D"===M}(q))b[M]={value:p.Ob(),className:q};else if("FlowGraphInteger"===q)b[M]={value:p.value,className:q};else if(q&&(p.id||p.name))b[M]={id:p.id,name:p.name,className:q};else{if("object"===typeof p)throw new Error(`Could not serialize value ${p}`);b[M]=p}}function H(M,p,b,O){const F=p[M];let o;const W=(null===F||void 0===F?void 0:F.type)??(null===F||void 0===F?void 0:F.className);if(function(M){return"Mesh"===M||"AbstractMesh"===M||"GroundMesh"===M||"InstanceMesh"===M||"LinesMesh"===M||"GoldbergMesh"===M||"GreasedLineMesh"===M||"TrailMesh"===M}(W)){let M=O.meshes.filter((M=>F.id?M.id===F.id:M.name===F.name));0===M.length&&(M=O.transformNodes.filter((M=>F.id?M.id===F.id:M.name===F.name))),o=F.uniqueId?M.find((M=>M.uniqueId===F.uniqueId)):M[0]}else if(T(W))o=function(M,p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===M)return q.Vector2.sp(p);if("Ap"===M)return b&&(p[2]*=-1),q.Ap.sp(p);if("Vector4"===M)return q.Vector4.sp(p);if("Quaternion"===M)return b&&(p[2]*=-1,p[3]*=-1),q.Quaternion.sp(p);if("ap"===M)return new Q.ap(p[0],p[1],p[2]);if("Sb"===M)return new Q.Sb(p[0],p[1],p[2],p[3]);throw new Error(`Unknown vector class name ${M}`)}(W,F.value);else if(function(M){return"AnimationGroup"===M}(W)){const M=O.animationGroups.filter((M=>M.name===F.name));o=1===M.length?M[0]:M.find((M=>M.uniqueId===F.uniqueId))}else o="Matrix"===W?q.Matrix.sp(F.value):"Matrix2D"===W?new u.d(F.value):"Matrix3D"===W?new u.h(F.value):"FlowGraphInteger"===W?B.e.FromValue(F.value):"number"===W||"string"===W||"boolean"===W?F.value[0]:F&&void 0!==F.value?F.value:Array.isArray(F)?F.reduce(((M,p)=>p.eventData?(M[p.id]={type:(0,k.P)(p.type)},"undefined"!==typeof p.value&&(M[p.id].value=H("value",p,b,O)),M):M),{}):F;return o}function F(M){return"FlowGraphJsonPointerParserBlock"===M}},13507:(M,p,b)=>{"use strict";function Q(M,p){return!(!M.parent||M.parent!==p&&!Q(M.parent,p))}function q(M){if(M.getClassName)return M.getClassName()}function B(M,p){return M===p&&("Vector2"===M||"Ap"===M||"Vector4"===M||"Quaternion"===M)}function k(M,p){return M===p&&("Matrix"===M||"Matrix2D"===M||"Matrix3D"===M)}function u(M,p){return"FlowGraphInteger"===M&&"FlowGraphInteger"===p}function T(M,p){const b="number"===typeof M||"number"===typeof(null===M||void 0===M?void 0:M.value);return b&&!p?!isNaN(O(M)):b}function O(M){return"number"===typeof M?M:M.value}b.d(p,{d:()=>u,e:()=>k,i:()=>B,m:()=>q,q:()=>Q,r:()=>O,v:()=>T})},12856:(M,p,b)=>{"use strict";b.r(p),b.d(p,{SceneInstrumentation:()=>B});var Q=b(11621),q=b(12007);class B{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(M){M!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=M,M?(this._onBeforeActiveMeshesEvaluationObserver=this.Kp.onBeforeActiveMeshesEvaluationObservable.add((()=>{Q.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Kp.onAfterActiveMeshesEvaluationObservable.add((()=>{Q.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Kp.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Kp.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(M){M!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=M,M?(this._onBeforeRenderTargetsRenderObserver=this.Kp.onBeforeRenderTargetsRenderObservable.add((()=>{Q.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Kp.onAfterRenderTargetsRenderObservable.add((()=>{Q.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Kp.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Kp.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(M){M!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=M,M?(this._onBeforeParticlesRenderingObserver=this.Kp.onBeforeParticlesRenderingObservable.add((()=>{Q.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Kp.onAfterParticlesRenderingObservable.add((()=>{Q.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Kp.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Kp.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(M){M!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=M,this.Kp.spriteManagers&&(M?(this._onBeforeSpritesRenderingObserver=this.Kp.onBeforeSpritesRenderingObservable.add((()=>{Q.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Kp.onAfterSpritesRenderingObservable.add((()=>{Q.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Kp.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Kp.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(M){M!==this._capturePhysicsTime&&this.Kp.onBeforePhysicsObservable&&(this._capturePhysicsTime=M,M?(this._onBeforePhysicsObserver=this.Kp.onBeforePhysicsObservable.add((()=>{Q.Tools.StartPerformanceCounter("Eb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Kp.onAfterPhysicsObservable.add((()=>{Q.Tools.EndPerformanceCounter("Eb"),this._physicsTime.endMonitoring()}))):(this.Kp.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Kp.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(M){M!==this._captureAnimationsTime&&(this._captureAnimationsTime=M,M?this._onAfterAnimationsObserver=this.Kp.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Kp.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(M){this._captureFrameTime=M}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(M){this._captureInterFrameTime=M}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(M){M!==this._captureRenderTime&&(this._captureRenderTime=M,M?(this._onBeforeDrawPhaseObserver=this.Kp.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),Q.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Kp.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),Q.Tools.EndPerformanceCounter("Main render")}))):(this.Kp.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Kp.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(M){M!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=M,M?(this._onBeforeCameraRenderObserver=this.Kp.onBeforeCameraRenderObservable.add((M=>{this._cameraRenderTime.beginMonitoring(),Q.Tools.StartPerformanceCounter(`Rendering camera ${M.name}`)})),this._onAfterCameraRenderObserver=this.Kp.onAfterCameraRenderObservable.add((M=>{this._cameraRenderTime.endMonitoring(!1),Q.Tools.EndPerformanceCounter(`Rendering camera ${M.name}`)}))):(this.Kp.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Kp.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Kp.getEngine()._drawCalls}constructor(M){this.Kp=M,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new q.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new q.b,this._captureFrameTime=!1,this._frameTime=new q.b,this._captureRenderTime=!1,this._renderTime=new q.b,this._captureInterFrameTime=!1,this._interFrameTime=new q.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new q.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new q.b,this._capturePhysicsTime=!1,this._physicsTime=new q.b,this._captureAnimationsTime=!1,this._animationsTime=new q.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new q.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=M.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(Q.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Kp.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=M.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(Q.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.pb(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.pb(),this._captureParticlesRenderTime&&this._particlesRenderTime.pb(),this._captureSpritesRenderTime&&this._spritesRenderTime.pb(),this._captureRenderTime&&this._renderTime.pb(),this._captureCameraRenderTime&&this._cameraRenderTime.pb()}))}dispose(){this._disposed||(this.Kp.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Kp.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Kp.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Kp.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Kp.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Kp.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Kp.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Kp.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Kp.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Kp.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Kp.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Kp.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Kp.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Kp.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Kp.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Kp.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Kp.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Kp=null,this._disposed=!0)}}},13448:(M,p,b)=>{"use strict";b.d(p,{c:()=>H});var Q=b(11784),q=b(11788),B=b(11796),k=b(12236),u=b(12349),T=b(12397),O=b(11757);k.d.AddNodeConstructor("Light_Type_1",((M,p)=>()=>new H(M,B.Ap.Zero(),p)));class H extends T.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(M){this._shadowFrustumSize=M,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(M){this._shadowOrthoScale=M,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(M){this._orthoLeft=M}get orthoRight(){return this._orthoRight}set orthoRight(M){this._orthoRight=M}get orthoTop(){return this._orthoTop}set orthoTop(M){this._orthoTop=M}get orthoBottom(){return this._orthoBottom}set orthoBottom(M){this._orthoBottom=M}constructor(M,p,b){super(M,b),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=p.scale(-1),this.direction=p}getClassName(){return"gb"}getTypeID(){return u.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(M,p,b){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(M):this._setDefaultAutoExtendShadowProjectionMatrix(M,p,b)}_setDefaultFixedFrustumShadowProjectionMatrix(M){const p=this.RM().activeCamera;p&&B.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:p.Fb,void 0!==this.shadowMaxZ?this.shadowMaxZ:p.maxZ,M,this.RM().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(M,p,b){const Q=this.RM().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const M=B.Ap.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let Q=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(let k=0;k<b.length;k++){const u=b[k];if(!u)continue;const T=u.getBoundingInfo().boundingBox;for(let b=0;b<T.vectorsWorld.length;b++)B.Ap.TransformCoordinatesToRef(T.vectorsWorld[b],p,M),M.x<this._orthoLeft&&(this._orthoLeft=M.x),M.y<this._orthoBottom&&(this._orthoBottom=M.y),M.x>this._orthoRight&&(this._orthoRight=M.x),M.y>this._orthoTop&&(this._orthoTop=M.y),this.autoCalcShadowZBounds&&(M.z<Q&&(Q=M.z),M.z>q&&(q=M.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=Q,this._shadowMaxZ=q)}const q=this._orthoRight-this._orthoLeft,k=this._orthoTop-this._orthoBottom,u=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Q||void 0===Q?void 0:Q.Fb)||0,T=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Q||void 0===Q?void 0:Q.maxZ)||1e4,O=this.RM().getEngine().useReverseDepthBuffer;B.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-q*this.shadowOrthoScale,this._orthoRight+q*this.shadowOrthoScale,this._orthoBottom-k*this.shadowOrthoScale,this._orthoTop+k*this.shadowOrthoScale,O?T:u,O?u:T,M,this.RM().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(M,p){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,p),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,p),this)}transferToNodeMaterialEffect(M,p){return this.computeTransformedInformation()?(M.setFloat3(p,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(M.setFloat3(p,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(M){const p=this._scene.getEngine();return!p.useReverseDepthBuffer&&p.isNDCHalfZRange?0:1}getDepthMaxZ(M){const p=this._scene.getEngine();return p.useReverseDepthBuffer&&p.isNDCHalfZRange?0:1}prepareLightSpecificDefines(M,p){M["DIRLIGHT"+p]=!0}}(0,Q.c)([(0,q.R)()],H.prototype,"shadowFrustumSize",null),(0,Q.c)([(0,q.R)()],H.prototype,"shadowOrthoScale",null),(0,Q.c)([(0,q.R)()],H.prototype,"autoUpdateExtends",void 0),(0,Q.c)([(0,q.R)()],H.prototype,"autoCalcShadowZBounds",void 0),(0,Q.c)([(0,q.R)("orthoLeft")],H.prototype,"_orthoLeft",void 0),(0,Q.c)([(0,q.R)("orthoRight")],H.prototype,"_orthoRight",void 0),(0,Q.c)([(0,q.R)("orthoTop")],H.prototype,"_orthoTop",void 0),(0,Q.c)([(0,q.R)("orthoBottom")],H.prototype,"_orthoBottom",void 0),(0,O.g)("BABYLON.DirectionalLight",H)},13901:(M,p,b)=>{"use strict";b.d(p,{e:()=>H});var Q=b(11784),q=b(11788),B=b(11796),k=b(11833),u=b(12236),T=b(12349),O=b(11757);u.d.AddNodeConstructor("Light_Type_3",((M,p)=>()=>new H(M,B.Ap.Zero(),p)));class H extends T.e{constructor(M,p,b){super(M,b),this.groundColor=new k.ap(0,0,0),this.direction=p||B.Ap.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Ub"}setDirectionToTarget(M){return this.direction=B.Ap.Normalize(M.jp(B.Ap.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(M,p){const b=B.Ap.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",b.x,b.y,b.z,0,p),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.yb),p),this}transferToNodeMaterialEffect(M,p){const b=B.Ap.Normalize(this.direction);return M.setFloat3(p,b.x,b.y,b.z),this}ib(){return this._worldMatrix||(this._worldMatrix=B.Matrix.Identity()),this._worldMatrix}getTypeID(){return T.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(M,p){M["HEMILIGHT"+p]=!0}}(0,Q.c)([(0,q.o)()],H.prototype,"groundColor",void 0),(0,Q.c)([(0,q.N)()],H.prototype,"direction",void 0),(0,O.g)("BABYLON.HemisphericLight",H)},13409:(M,p,b)=>{"use strict";b.d(p,{b:()=>F});var Q=b(11784),q=b(11788),B=b(11796),k=b(12236),u=b(12349),T=b(12397),O=b(11780),H=b(11757);k.d.AddNodeConstructor("Light_Type_2",((M,p)=>()=>new F(M,B.Ap.Zero(),B.Ap.Zero(),0,0,p)));class F extends T.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(M){this._iesProfileTexture!==M&&(this._iesProfileTexture=M,this._iesProfileTexture&&F._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(M){this._angle=M,this._cosHalfAngle=Math.cos(.5*M),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(M){this._innerAngle=M,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(M){this._shadowAngleScale=M,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(M){this._projectionTextureLightNear=M,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(M){this._projectionTextureLightFar=M,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(M){this._projectionTextureUpDirection=M,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(M){this._projectionTexture!==M&&(this._projectionTexture=M,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(F._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):F._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(M){return void 0!==M.onGeneratedObservable}static _IsTexture(M){return void 0!==M.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(M){this._projectionTextureProjectionLightMatrix=M,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(M,p,b,Q,q,k){super(M,k),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=B.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=B.Ap.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=B.Ap.Zero(),this._projectionTextureViewLightMatrix=B.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=B.Matrix.Zero(),this._projectionTextureScalingMatrix=B.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=p,this.direction=b,this.angle=Q,this.exponent=q}getClassName(){return"SpotLight"}getTypeID(){return u.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(M){super._setDirection(M),this._projectionTextureViewLightDirty=!0}_setPosition(M){super._setPosition(M),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(M,p,b){const Q=this.RM().activeCamera;if(!Q)return;this._shadowAngleScale=this._shadowAngleScale||1;const q=this._shadowAngleScale*this._angle,k=void 0!==this.shadowMinZ?this.shadowMinZ:Q.Fb,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,T=this.RM().getEngine().useReverseDepthBuffer;B.Matrix.PerspectiveFovLHToRef(q,1,T?u:k,T?k:u,M,!0,this._scene.getEngine().isNDCHalfZRange,void 0,T)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),B.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const M=this.projectionTextureLightFar,p=this.projectionTextureLightNear,b=M/(M-p),Q=-b*p,q=1/Math.tan(this._angle/2);B.Matrix.FromValuesToRef(q/1,0,0,0,0,q,0,0,0,0,b,1,0,0,Q,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof O.b){const M=this._projectionTexture.uScale/2,p=this._projectionTexture.vScale/2;B.Matrix.FromValuesToRef(M,0,0,0,0,p,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(M,p){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),M.setMatrix("textureProjectionMatrix"+p,this._projectionTextureMatrix),M.setTexture("projectionLightTexture"+p,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&M.setTexture("iesLightTexture"+p,this._iesProfileTexture),this}transferToEffect(M,p){let b;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,p),b=B.Ap.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,p),b=B.Ap.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",b.x,b.y,b.z,this._cosHalfAngle,p),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,p),this}transferToNodeMaterialEffect(M,p){let b;return b=this.computeTransformedInformation()?B.Ap.Normalize(this.transformedDirection):B.Ap.Normalize(this.direction),this.RM().useRightHandedSystem?M.setFloat3(p,-b.x,-b.y,-b.z):M.setFloat3(p,b.x,b.y,b.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(M){const p=this._scene.getEngine(),b=void 0!==this.shadowMinZ?this.shadowMinZ:(null===M||void 0===M?void 0:M.Fb)??0;return p.useReverseDepthBuffer&&p.isNDCHalfZRange?b:this._scene.getEngine().isNDCHalfZRange?0:b}getDepthMaxZ(M){const p=this._scene.getEngine(),b=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===M||void 0===M?void 0:M.maxZ)??1e4;return p.useReverseDepthBuffer&&p.isNDCHalfZRange?0:b}prepareLightSpecificDefines(M,p){M["SPOTLIGHT"+p]=!0,M["PROJECTEDLIGHTTEXTURE"+p]=!(!this.projectionTexture||!this.projectionTexture.isReady()),M["IESLIGHTTEXTURE"+p]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,Q.c)([(0,q.R)()],F.prototype,"angle",null),(0,Q.c)([(0,q.R)()],F.prototype,"innerAngle",null),(0,Q.c)([(0,q.R)()],F.prototype,"shadowAngleScale",null),(0,Q.c)([(0,q.R)()],F.prototype,"exponent",void 0),(0,Q.c)([(0,q.R)()],F.prototype,"projectionTextureLightNear",null),(0,Q.c)([(0,q.R)()],F.prototype,"projectionTextureLightFar",null),(0,Q.c)([(0,q.R)()],F.prototype,"projectionTextureUpDirection",null),(0,Q.c)([(0,q.J)("projectedLightTexture")],F.prototype,"_projectionTexture",void 0),(0,H.g)("BABYLON.SpotLight",F)},13143:(M,p,b)=>{"use strict";b.d(p,{d:()=>k,e:()=>B,g:()=>u});const Q={},q={};function B(M,p){Q[M]=p}function k(M,p){q[M]=p}function u(M){return q[M]?q[M]:null}},13026:(M,p,b)=>{"use strict";b.d(p,{b:()=>R,c:()=>g});var Q,q=b(11621),B=b(11624),k=b(12033),u=b(11664),T=b(11637),O=b(12274),H=b(11671),F=b(11673),o=b(11764),W=b(11700),i=b(11660);!function(M){M[M.Clean=0]="Clean",M[M.Stop=1]="Stop",M[M.Sync=2]="Sync",M[M.NoSync=3]="NoSync"}(Q||(Q={}));const A=new B.b,j={};let K=!1;function D(){return j[".babylon"]}function a(M,p){const b=j[M];return b||(T.c.Warn("Unable to find a plugin to load "+M+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),p?D():void 0)}function s(M,p,b){let Q="Unable to load from "+(M.rawData?"binary data":M.url);return p?Q+=`: ${p}`:b&&(Q+=`: ${b}`),Q}async function S(M,p,b,Q,q,B,k,u,T){var O;const F="data:"===(o=M.url).substring(0,5)?o.substring(5):null;var o;if(M.rawData&&!k)throw"When using ArrayBufferView to load data the file extension must be provided.";const K=F||k?"":function(M){const p=M.indexOf("?");-1!==p&&(M=M.substring(0,p));const b=M.lastIndexOf(".");return M.substring(b,M.length).toLowerCase()}(M.url);let s=k?a(k,!0):F?function(M){for(const p in j){const b=j[p].plugin;if(b.canDirectLoad&&b.canDirectLoad(M))return j[p]}return D()}(M.url):a(K,!1);if(!s&&K){if(M.url&&!M.url.startsWith("blob:")){const p=await async function(M,p){const b=p.method||"GET";return await new Promise(((Q,q)=>{const B=new i.b;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const M={};if(p.responseHeaders)for(const b of p.responseHeaders)M[b]=B.getResponseHeader(b)||"";Q({response:B.response,headerValues:M})}else q(`Unable to fetch data from ${M}. Error code: ${B.status}`)})),B.open(b,M),B.send()}))}(M.url,{method:"HEAD",responseHeaders:["Content-Type"]}),b=p.headerValues?p.headerValues["Content-Type"]:"";b&&(s=function(M){for(const p in j){const b=j[p];if(b.mimeType===M)return b}}(b))}s||(s=D())}if(!s)throw new Error(`No plugin or fallback for ${k??M.url}`);if(!1===(null===T||void 0===T||null===(O=T[s.plugin.name])||void 0===O?void 0:O.enabled))throw new Error(`The '${s.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(M.rawData&&!s.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(M=>{if(s.plugin.createPlugin){const p=s.plugin.createPlugin(T??{});return p instanceof Promise?(p.then(M).catch((M=>{q("Error instantiating plugin.",M)})),null):(M(p),p)}return M(s.plugin),s.plugin})((T=>{var O;if(!T)throw`The loader plugin corresponding to the '${k}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(A.notifyObservers(T),F&&(T.canDirectLoad&&T.canDirectLoad(M.url)||!(0,H.h)(M.url))){if(T.directLoad){const M=T.directLoad(p,F);M instanceof Promise?M.then((M=>{b(T,M)})).catch((M=>{q("Error in directLoad of _loadData: "+M,M)})):b(T,M)}else b(T,F);return}const o=s.isBinary,i=(M,Q)=>{p.O?q("Scene has been disposed"):b(T,M,Q)};let j=null,K=!1;null===(O=T.bb)||void 0===O||O.add((()=>{K=!0,j&&(j.abort(),j=null),B()}));const D=()=>{if(K)return;const b=(M,p)=>{q(null===M||void 0===M?void 0:M.statusText,p)};if(!T.loadFile&&M.rawData)throw"Plugin does not support loading ArrayBufferView.";j=T.loadFile?T.loadFile(p,M.rawData||M.file||M.url,M.rootUrl,i,Q,o,b,u):p._loadFile(M.file||M.url,i,Q,!0,o,b)},a=p.getEngine();let S=a.enableOfflineSupport;if(S){let b=!1;for(const Q of p.disableOfflineSupportExceptionRules)if(Q.test(M.url)){b=!0;break}S=!b}S&&W.c.OfflineProviderFactory?p.offlineProvider=W.c.OfflineProviderFactory(M.url,D,a.disableManifestCheck):D()}))}function f(M,p){let b,Q,B=null,k=null;if(p)if(p.name)b=`file:${p.name}`,Q=p.name,B=p;else if(ArrayBuffer.isView(p))b="",Q=(0,o.c)(),k=p;else if(p.startsWith("data:"))b=p,Q="";else if(M){const B=p;if("/"===B.substring(0,1))return q.Tools.Error("Wrong sceneFilename parameter"),null;b=M+B,Q=B}else b=p,Q=q.Tools.GetFilename(p),M=q.Tools.GetFolderPath(p);else b=M,Q=q.Tools.GetFilename(M),M=q.Tools.GetFolderPath(M);return{url:b,rootUrl:M,name:Q,file:B,rawData:k}}function R(M){if("string"===typeof M.extensions){const p=M.extensions;j[p.toLowerCase()]={plugin:M,isBinary:!1}}else{const p=M.extensions,b=Object.keys(p);for(const Q of b)j[Q.toLowerCase()]={plugin:M,isBinary:p[Q].isBinary,mimeType:p[Q].mimeType}}}async function y(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.c.LastCreatedScene,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!Q)return T.c.Error("No scene available to import mesh to"),null;const W=f(p,b);if(!W)return null;const i={};Q.addPendingData(i);const A=()=>{Q.removePendingData(i)},j=(M,p)=>{const b=s(W,M,p);k?k(Q,b,new F.k(b,F.h.SceneLoaderError,p)):T.c.Error(b),A()},K=B?M=>{try{B(M)}catch(p){j("Error in onProgress callback: "+p,p)}}:void 0,D=(M,p,b,B,k,u,T,O)=>{if(Q.importedMeshesFiles.push(W.url),q)try{q(M,p,b,B,k,u,T,O)}catch(H){j("Error in onSuccess callback: "+H,H)}Q.removePendingData(i)};return await S(W,Q,((p,b,q)=>{if(p.rewriteRootURL&&(W.rootUrl=p.rewriteRootURL(W.rootUrl,q)),p.importMesh){const q=[],B=[],k=[];if(!p.importMesh(M,Q,b,W.rootUrl,q,B,k,j))return;Q.loadingPluginName=p.name,D(q,B,k,[],[],[],[],[])}else{p.importMeshAsync(M,Q,b,W.rootUrl,K,W.name).then((M=>{Q.loadingPluginName=p.name,D(M.meshes,M.qo,M.skeletons,M.animationGroups,M.transformNodes,M.geometries,M.lights,M.spriteManagers)})).catch((M=>{j(M.message,M)}))}}),K,j,A,O,H,o)}async function x(M,p,b,Q,q,B,k,u){return await new Promise(((T,O)=>{try{y(M,p,b,Q,((M,p,b,Q,q,B,k,u)=>{T({meshes:M,qo:p,skeletons:b,animationGroups:Q,transformNodes:q,geometries:B,lights:k,spriteManagers:u})}),q,((M,p,b)=>{O(b||new Error(p))}),B,k,u).catch(O)}catch(F){O(F)}}))}async function P(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.c.LastCreatedEngine,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};b?await N(M,p,new k.e(b),Q,B,T,O,H,F):q.Tools.Error("No engine available")}async function L(M,p,b,Q,q,B,k){return await new Promise(((u,T)=>{P(M,p,b,(M=>{u(M)}),Q,((M,p,b)=>{T(b||new Error(p))}),q,B,k)}))}async function N(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.c.LastCreatedScene,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return T.c.Error("No scene available to append to"),null;const W=f(M,p);if(!W)return null;const i={};b.addPendingData(i);const A=()=>{b.removePendingData(i)};O.c.ShowLoadingScreen&&!K&&(K=!0,b.getEngine().displayLoadingUI(),b.executeWhenReady((()=>{b.getEngine().hideLoadingUI(),K=!1})));const j=(M,p)=>{const Q=s(W,M,p);B?B(b,Q,new F.k(Q,F.h.SceneLoaderError,p)):T.c.Error(Q),A()},D=q?M=>{try{q(M)}catch(p){j("Error in onProgress callback",p)}}:void 0,a=()=>{if(Q)try{Q(b)}catch(M){j("Error in onSuccess callback",M)}b.removePendingData(i)};return await S(W,b,((M,p)=>{if(M.load){if(!M.load(b,p,W.rootUrl,j))return;b.loadingPluginName=M.name,a()}else{M.loadAsync(b,p,W.rootUrl,D,W.name).then((()=>{b.loadingPluginName=M.name,a()})).catch((M=>{j(M.message,M)}))}}),D,j,A,k,H,o)}async function r(M,p,b,Q,q,B,k){return await new Promise(((u,T)=>{try{N(M,p,b,(M=>{u(M)}),Q,((M,p,b)=>{T(b||new Error(p))}),q,B,k).catch(T)}catch(F){T(F)}}))}async function Y(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.c.LastCreatedScene,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return T.c.Error("No scene available to load asset container to"),null;const o=f(M,p);if(!o)return null;const W={};b.addPendingData(W);const i=()=>{b.removePendingData(W)},A=(M,p)=>{const Q=s(o,M,p);B?B(b,Q,new F.k(Q,F.h.SceneLoaderError,p)):T.c.Error(Q),i()},j=q?M=>{try{q(M)}catch(p){A("Error in onProgress callback",p)}}:void 0,K=M=>{if(Q)try{Q(M)}catch(p){A("Error in onSuccess callback",p)}b.removePendingData(W)};return await S(o,b,((M,p)=>{if(M.loadAssetContainer){const Q=M.loadAssetContainer(b,p,o.rootUrl,A);if(!Q)return;Q.populateRootNodes(),b.loadingPluginName=M.name,K(Q)}else if(M.loadAssetContainerAsync){M.loadAssetContainerAsync(b,p,o.rootUrl,j,o.name).then((p=>{p.populateRootNodes(),b.loadingPluginName=M.name,K(p)})).catch((M=>{A(M.message,M)}))}else A("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),j,A,i,k,O,H)}async function w(M,p,b,Q,q,B,k){return await new Promise(((u,T)=>{try{Y(M,p,b,(M=>{u(M)}),Q,((M,p,b)=>{T(b||new Error(p))}),q,B,k).catch(T)}catch(F){T(F)}}))}async function E(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.c.LastCreatedScene,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!b)return void T.c.Error("No scene available to load animations to");if(Q){for(const Q of b.animatables)Q.reset();b.stopAllAnimations();const M=b.animationGroups.slice();for(const b of M)b.dispose();const p=b.getNodes();for(const b of p)b.animations&&(b.animations=[])}else switch(q){case 0:const M=b.animationGroups.slice();for(const p of M)p.dispose();break;case 1:for(const p of b.animationGroups)p.stop();break;case 2:for(const p of b.animationGroups)p.reset(),p.restart();break;case 3:break;default:return void T.c.Error("Unknown animation group loading mode value '"+q+"'")}const i=b.animatables.length;await Y(M,p,b,(M=>{M.mergeAnimationsTo(b,b.animatables.slice(i),B),M.dispose(),b.onAnimationFileImportedObservable.notifyObservers(b),k&&k(b)}),O,H,F,o,W)}async function n(M,p,b,Q,q,B,k,u,T,O){return await new Promise(((H,o)=>{try{E(M,p,b,Q,q,B,(M=>{H(M)}),k,((M,p,b)=>{o(b||new Error(p))}),u,T,O).catch(o)}catch(F){o(F)}}))}class g{static get ForceFullSceneLoadingForIncremental(){return O.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(M){O.c.ForceFullSceneLoadingForIncremental=M}static get ShowLoadingScreen(){return O.c.ShowLoadingScreen}static set ShowLoadingScreen(M){O.c.ShowLoadingScreen=M}static get loggingLevel(){return O.c.loggingLevel}static set loggingLevel(M){O.c.loggingLevel=M}static get CleanBoneMatrixWeights(){return O.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(M){O.c.CleanBoneMatrixWeights=M}static GetDefaultPlugin(){return D()}static GetPluginForExtension(M){var p;return null===(p=a(M,!0))||void 0===p?void 0:p.plugin}static IsPluginForExtensionAvailable(M){return function(M){return!!j[M]}(M)}static RegisterPlugin(M){R(M)}static ImportMesh(M,p,b,Q,q,B,k,T,O){y(M,p,b,Q,q,B,k,T,O).catch((M=>null===k||void 0===k?void 0:k(u.c.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async ImportMeshAsync(M,p,b,Q,q,B,k){return await x(M,p,b,Q,q,B,k)}static Load(M,p,b,Q,q,B,k,T){P(M,p,b,Q,q,B,k,T).catch((M=>null===B||void 0===B?void 0:B(u.c.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async LoadAsync(M,p,b,Q,q,B){return await L(M,p,b,Q,q,B)}static Append(M,p,b,Q,q,B,k,T){N(M,p,b,Q,q,B,k,T).catch((M=>null===B||void 0===B?void 0:B(b??u.c.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async AppendAsync(M,p,b,Q,q,B){return await r(M,p,b,Q,q,B)}static LoadAssetContainer(M,p,b,Q,q,B,k,T){Y(M,p,b,Q,q,B,k,T).catch((M=>null===B||void 0===B?void 0:B(b??u.c.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async LoadAssetContainerAsync(M,p,b,Q,q,B){return await w(M,p,b,Q,q,B)}static ImportAnimations(M,p,b,Q,q,B,k,T,O,H,F){E(M,p,b,Q,q,B,k,T,O,H,F).catch((M=>null===O||void 0===O?void 0:O(b??u.c.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async ImportAnimationsAsync(M,p,b,Q,q,B,k,u,T,O,H){return await n(M,p,b,Q,q,B,u,O,H)}}g.NO_LOGGING=0,g.MINIMAL_LOGGING=1,g.SUMMARY_LOGGING=2,g.DETAILED_LOGGING=3,g.OnPluginActivatedObservable=A},13428:(M,p,b)=>{"use strict";b.d(p,{b:()=>o});var Q=b(11784),q=b(11788),B=b(11621),k=b(11796),u=b(11809),T=b(11780),O=b(11757),H=b(11624),F=b(11823);b(13437);class o extends u.d{set boundingBoxSize(M){if(this._boundingBoxSize&&this._boundingBoxSize.equals(M))return;this._boundingBoxSize=M;const p=this.RM();p&&p.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(M){this._rotationY=M,this.setReflectionTextureMatrix(k.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(M,p,b){let Q="";for(const q of M)Q+=q;return new o(Q,p,null,b,M)}static CreateFromPrefilteredData(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=p.useDelayedTextureLoading;p.useDelayedTextureLoading=!1;const B=new o(M,p,null,!1,null,null,null,void 0,!0,b,Q);return p.useDelayedTextureLoading=q,B}constructor(M,p){var b;let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,o=arguments.length>8&&void 0!==arguments[8]&&arguments[8],W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,i=arguments.length>10&&void 0!==arguments[10]&&arguments[10],A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,j=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,K=arguments.length>13?arguments[13]:void 0,D=arguments.length>14?arguments[14]:void 0;super(p),this.onLoadObservable=new H.b,this.boundingBoxPosition=k.Ap.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new k.Matrix,this._buffer=null,this.name=M,this.url=M,this._noMipmap=q,this.Hb=!1,this.isCube=!0,this._textureMatrix=k.Matrix.Identity(),this.coordinatesMode=T.b.CUBIC_MODE;let a=null,s=null;null===Q||Array.isArray(Q)?(this._noMipmap=q,this._format=F,this._createPolynomials=i,a=Q,this._loaderOptions=K,this._useSRGBBuffer=D,this._lodScale=A,this._lodOffset=j):(a=Q.extensions??null,this._noMipmap=Q.noMipmap??!1,B=Q.files??null,s=Q.buffer??null,this._format=Q.format??5,o=Q.prefiltered??!1,W=Q.forcedExtension??null,this._createPolynomials=Q.createPolynomials??!1,this._lodScale=Q.lodScale??.8,this._lodOffset=Q.lodOffset??0,this._loaderOptions=Q.loaderOptions,this._useSRGBBuffer=Q.useSRGBBuffer,u=Q.C??null,O=Q.onError??null),(M||B)&&this.updateURL(M,W,u,o,O,a,null===(b=this.RM())||void 0===b?void 0:b.useDelayedTextureLoading,B,s)}getClassName(){return"CubeTexture"}updateURL(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=M),this.url=M,p&&(this._forcedExtension=p);const O=M.lastIndexOf("."),H=p||(O>-1?M.substring(O).toLowerCase():""),F=0===H.indexOf(".dds"),o=0===H.indexOf(".env"),W=0===H.indexOf(".basis");if(o?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=Q,Q&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),u)this._files=u;else if(W||o||F||B||(B=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,B){for(let p=0;p<B.length;p++)this._files.push(M+B[p]);this._extensions=B}this._buffer=T,k?(this.delayLoadState=4,this._delayedOnLoad=b,this._delayedOnError=q):this._loadTexture(b,q)}delayLoad(M){4===this.delayLoadState&&(M&&(this._forcedExtension=M),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(M){var p,b;if(M.updateFlag===this._textureMatrix.updateFlag)return;M.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(b=this.RM())||void 0===b||b.markAllMaterialsAsDirty(1,(M=>-1!==M.getActiveTextures().indexOf(this))));if(this._textureMatrix=M,null===(p=this.RM())||void 0===p||!p.useRightHandedSystem)return;const Q=k.TmpVectors.Ap[0],q=k.TmpVectors.Quaternion[0],B=k.TmpVectors.Ap[1];this._textureMatrix.decompose(Q,q,B),q.z*=-1,q.w*=-1,k.Matrix.ComposeToRef(Q,q,B,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var M;return null!==(M=this.RM())&&void 0!==M&&M.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this.RM(),Q=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const q=()=>{var p;(this.onLoadObservable.notifyObservers(this),Q)&&(Q.dispose(),null===(p=this.RM())||void 0===p||p.markAllMaterialsAsDirty(1));M&&M()},k=(M,b)=>{this._loadingError=!0,this._errorObject={message:M,exception:b},p&&p(M,b),T.b.OnTextureLoadErrorObservable.notifyObservers(this)};var u;this._texture?this._texture.isReady?B.Tools.SetImmediate((()=>q())):this._texture.onLoadedObservable.add((()=>q())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,b,this._lodScale,this._lodOffset,M,k,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,b,this._files,this._noMipmap,M,k,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(u=this._texture)||void 0===u||u.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(M,p,b){const Q=F.b.Parse((()=>{let Q=!1;return M.prefiltered&&(Q=M.prefiltered),new o(b+(M.url??M.name),p,M.extensions,!1,M.files||null,null,null,void 0,Q,M.forcedExtension)}),M,p);if(M.boundingBoxPosition&&(Q.boundingBoxPosition=k.Ap.sp(M.boundingBoxPosition)),M.boundingBoxSize&&(Q.boundingBoxSize=k.Ap.sp(M.boundingBoxSize)),M.animations)for(let q=0;q<M.animations.length;q++){const p=M.animations[q],b=(0,O.c)("BABYLON.Animation");b&&Q.animations.push(b.Parse(p))}return Q}clone(){let M=0;const p=F.b.Clone((()=>{const p=new o(this.url,this.RM()||this._getEngine(),this._extensions,this._noMipmap,this._files);return M=p.uniqueId,p}),this);return p.uniqueId=M,p}}(0,Q.c)([(0,q.R)()],o.prototype,"url",void 0),(0,Q.c)([(0,q.N)()],o.prototype,"boundingBoxPosition",void 0),(0,Q.c)([(0,q.N)()],o.prototype,"boundingBoxSize",null),(0,Q.c)([(0,q.R)("rotationY")],o.prototype,"rotationY",null),(0,Q.c)([(0,q.R)("files")],o.prototype,"_files",void 0),(0,Q.c)([(0,q.R)("forcedExtension")],o.prototype,"_forcedExtension",void 0),(0,Q.c)([(0,q.R)("extensions")],o.prototype,"_extensions",void 0),(0,Q.c)([(0,q.B)("textureMatrix")],o.prototype,"_textureMatrix",void 0),(0,Q.c)([(0,q.B)("textureMatrixRefraction")],o.prototype,"_textureMatrixRefraction",void 0),T.b._CubeTextureParser=o.Parse,(0,O.g)("BABYLON.CubeTexture",o)},13918:(M,p,b)=>{"use strict";b.d(p,{c:()=>T});var Q=b(11637),q=b(11780),B=b(11767),k=b(11919),u=b(11729);k.ThinEngine.prototype.createDynamicTexture=function(M,p,b,Q){const q=new u.b(this,4);return q.baseWidth=M,q.baseHeight=p,b&&(M=this.needPOTTextures?(0,B.g)(M,this._caps.maxTextureSize):M,p=this.needPOTTextures?(0,B.g)(p,this._caps.maxTextureSize):p),q.width=M,q.height=p,q.isReady=!1,q.generateMipMaps=b,q.samplingMode=Q,this.updateTextureSamplingMode(Q,q),this._internalTexturesCache.push(q),q},k.ThinEngine.prototype.updateDynamicTexture=function(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!M)return;const k=this._gl,u=k.TEXTURE_2D,T=this._bindTextureDirectly(u,M,!0,B);this._unpackFlipY(void 0===b?M.invertY:b),Q&&k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const O=this._getWebGLTextureType(M.type),H=this._getInternalFormat(q||M.format),F=this._getRGBABufferInternalSizedFormat(M.type,H);k.texImage2D(u,0,F,H,O,p),M.generateMipMaps&&k.generateMipmap(u),T||this._bindTextureDirectly(u,null),Q&&k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),q&&(M.format=q),M._dynamicTextureSource=p,M._premulAlpha=Q,M.invertY=b||!1,M.isReady=!0};class T extends q.b{constructor(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,u=arguments.length>6?arguments[6]:void 0;const T=!b||b._isScene;super(null,T?b:null===b||void 0===b?void 0:b.Kp,T?!Q:b,u,B,void 0,void 0,void 0,void 0,k),this.name=M,this.wrapU=q.b.CLAMP_ADDRESSMODE,this.wrapV=q.b.CLAMP_ADDRESSMODE,this._generateMipMaps=Q;const O=this._getEngine();if(!O)return;if(p.getContext)this._canvas=p,this._ownCanvas=!1,this._texture=O.createDynamicTexture(this._canvas.width,this._canvas.height,Q,B);else{this._canvas=O.createCanvas(1,1),this._ownCanvas=!0;const M=p;M.width||0===M.width?this._texture=O.createDynamicTexture(M.width,M.height,Q,B):this._texture=O.createDynamicTexture(p,p,Q,B)}const H=this.getSize();this._canvas.width!==H.width&&(this._canvas.width=H.width),this._canvas.height!==H.height&&(this._canvas.height=H.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(M){this._canvas.width=M.width,this._canvas.height=M.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(M.width,M.height,this._generateMipMaps,this.samplingMode)}scale(M){const p=this.getSize();p.width*=M,p.height*=M,this._recreate(p)}scaleTo(M,p){const b=this.getSize();b.width=M,b.height=p,this._recreate(b)}getContext(){return this._context}clear(M){const p=this.getSize();M&&(this._context.fillStyle=M),this._context.clearRect(0,0,p.width,p.height)}update(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===M||M,p,this._format||void 0,void 0,b)}drawText(M,p,b,Q,q,B,k){let u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const T=this.getSize();if(B&&(this._context.fillStyle=B,this._context.fillRect(0,0,T.width,T.height)),this._context.font=Q,null===p||void 0===p){const b=this._context.measureText(M);p=(T.width-b.width)/2}if(null===b||void 0===b){const M=parseInt(Q.replace(/\D/g,""));b=T.height/2+M/3.65}this._context.fillStyle=q||"",this._context.fillText(M,p,b),u&&this.update(k)}dispose(){var M,p;(super.dispose(),this._ownCanvas)&&(null===(M=this._canvas)||void 0===M||null===(p=M.remove)||void 0===p||p.call(M));this._canvas=null,this._context=null}clone(){const M=this.RM();if(!M)return this;const p=this.getSize(),b=new T(this.name,p,M,this._generateMipMaps);return b.Hb=this.Hb,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b}serialize(){const M=this.RM();M&&!M.isReady()&&Q.c.Warn("The scene must be ready before serializing the dynamic texture");const p=super.serialize();return T._IsCanvasElement(this._canvas)&&(p.base64String=this._canvas.toDataURL()),p.invertY=this._invertY,p.samplingMode=this.samplingMode,p}static _IsCanvasElement(M){return void 0!==M.toDataURL}_rebuild(){this.update()}}},13336:(M,p,b)=>{"use strict";b.d(p,{e:()=>q});var Q=b(11780);class q extends Q.b{get depth(){return this._depth}constructor(M,p,b,q,B,k){let u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Q.b.TRILINEAR_SAMPLINGMODE,H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,F=arguments.length>10?arguments[10]:void 0;super(null,k,!u,T),this.format=B,this._texture=k.getEngine().createRawTexture2DArray(M,p,b,q,B,u,T,O,null,H,F),this._depth=q,this.is2DArray=!0}update(M){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,M,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(M,p,b,Q,B){return new q(M,p,b,Q,5,B,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13157:(M,p,b)=>{"use strict";b.d(p,{d:()=>u,e:()=>T,i:()=>B,m:()=>k});var Q=b(11806),q=b(11796);function B(M,p){return`{X: ${M.x.toFixed(p)} Y: ${M.y.toFixed(p)}}`}function k(M,p){return`{X: ${M._x.toFixed(p)} Y: ${M._y.toFixed(p)} Z: ${M._z.toFixed(p)}}`}function u(M,p){return 2*Math.acos((0,Q.Clamp)(q.Quaternion.Dot(M,p)))}function T(M,p){const b=new q.Quaternion;return function(M,p,b){const B=q.Ap.Cross(M,p),k=Math.acos((0,Q.Clamp)(q.Ap.Dot(M,p),-1,1));q.Quaternion.RotationAxisToRef(B,k,b)}(M,p,b),b}},12974:(M,p,b)=>{"use strict";b.d(p,{e:()=>O});var Q=b(11796),q=b(11833),B=b(12257),k=b(12246),u=b(11848);b(12981);function T(M){let p=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],B=[];let T=[];const O=M.width||M.size||1,H=M.height||M.size||1,F=M.depth||M.size||1,o=M.wrap||!1;let W=void 0===M.topBaseAt?1:M.topBaseAt,i=void 0===M.bottomBaseAt?0:M.bottomBaseAt;W=(W+4)%4,i=(i+4)%4;let A=[2,0,3,1][W],j=[2,0,1,3][i],K=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(o){p=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],K=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let M=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],b=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const Q=[17,18,19,16],q=[22,23,20,21];for(;A>0;)M.unshift(M.pop()),Q.unshift(Q.pop()),A--;for(;j>0;)b.unshift(b.pop()),q.unshift(q.pop()),j--;M=M.flat(),b=b.flat(),K=K.concat(M).concat(b),p.push(Q[0],Q[2],Q[3],Q[0],Q[1],Q[2]),p.push(q[0],q[2],q[3],q[0],q[1],q[2])}const D=[O/2,H/2,F/2];T=K.reduce(((M,p,b)=>M.concat(p*D[b%3])),[]);const a=0===M.sideOrientation?0:M.sideOrientation||k.e.DEFAULTSIDE,s=M.faceUV||new Array(6),S=M.faceColors,f=[];for(let k=0;k<6;k++)void 0===s[k]&&(s[k]=new Q.Vector4(0,0,1,1)),S&&void 0===S[k]&&(S[k]=new q.Sb(1,1,1,1));for(let Q=0;Q<6;Q++)if(B.push(s[Q].z,u.e?1-s[Q].w:s[Q].w),B.push(s[Q].x,u.e?1-s[Q].w:s[Q].w),B.push(s[Q].x,u.e?1-s[Q].y:s[Q].y),B.push(s[Q].z,u.e?1-s[Q].y:s[Q].y),S)for(let M=0;M<4;M++)f.push(S[Q].r,S[Q].g,S[Q].b,S[Q].a);k.e._ComputeSides(a,T,p,b,B,M.frontUVs,M.backUVs);const R=new k.e;if(R.indices=p,R.xM=T,R.PM=b,R.NM=B,S){const M=a===k.e.DOUBLESIDE?f.concat(f):f;R.LM=M}return R}function O(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new B.d(M,b);p.sideOrientation=B.d._GetDefaultSideOrientation(p.sideOrientation),Q._originalBuilderSideOrientation=p.sideOrientation;return T(p).YM(Q,p.updatable),Q}k.e.CreateBox=T,B.d.CreateBox=function(M,p){return O(M,{size:p,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13152:(M,p,b)=>{"use strict";b.d(p,{e:()=>u});var Q=b(12257),q=b(12246),B=b(11848);function k(M){const p=[],b=[],Q=[],k=[],u=M.radius||.5,T=M.tessellation||64,O=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,H=0===M.sideOrientation?0:M.sideOrientation||q.e.DEFAULTSIDE;p.push(0,0,0),k.push(.5,.5);const F=2*Math.PI*O,o=1===O?F/T:F/(T-1);let W=0;for(let q=0;q<T;q++){const M=Math.cos(W),b=Math.sin(W),Q=(M+1)/2,q=(1-b)/2;p.push(u*M,u*b,0),k.push(Q,B.e?1-q:q),W+=o}1===O&&(p.push(p[3],p[4],p[5]),k.push(k[2],B.e?1-k[3]:k[3]));const i=p.length/3;for(let q=1;q<i-1;q++)b.push(q+1,0,q);q.e.ComputeNormals(p,b,Q),q.e._ComputeSides(H,p,b,Q,k,M.frontUVs,M.backUVs);const A=new q.e;return A.indices=b,A.xM=p,A.PM=Q,A.NM=k,A}function u(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new Q.d(M,b);p.sideOrientation=Q.d._GetDefaultSideOrientation(p.sideOrientation),q._originalBuilderSideOrientation=p.sideOrientation;return k(p).YM(q,p.updatable),q}q.e.CreateDisc=k,Q.d.CreateDisc=function(M,p,b){return u(M,{radius:p,tessellation:b,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12981:(M,p,b)=>{"use strict";b.d(p,{c:()=>j,b:()=>D,e:()=>K});var Q=b(11796),q=b(11833),B=b(12257),k=b(12246),u=b(11857);B.d._GroundMeshParser=(M,p)=>T.Parse(M,p);class T extends B.d{constructor(M,p){super(M,p),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=M,this._subdivisionsY=M,this.subdivide(M);const b=this;b.createOrUpdateSubmeshesOctree&&b.createOrUpdateSubmeshesOctree(p)}getHeightAtCoordinates(M,p){const b=this.getWorldMatrix(),q=Q.TmpVectors.Matrix[5];b.invertToRef(q);const B=Q.TmpVectors.Ap[8];if(Q.Ap.TransformCoordinatesFromFloatsToRef(M,0,p,q,B),M=B.x,p=B.z,M<this._minX||M>=this._maxX||p<=this._minZ||p>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const k=this._getFacetAt(M,p),u=-(k.x*M+k.z*p+k.w)/k.y;return Q.Ap.TransformCoordinatesFromFloatsToRef(0,u,0,b,B),B.y}getNormalAtCoordinates(M,p){const b=new Q.Ap(0,1,0);return this.getNormalAtCoordinatesToRef(M,p,b),b}getNormalAtCoordinatesToRef(M,p,b){const q=this.getWorldMatrix(),B=Q.TmpVectors.Matrix[5];q.invertToRef(B);const k=Q.TmpVectors.Ap[8];if(Q.Ap.TransformCoordinatesFromFloatsToRef(M,0,p,B,k),M=k.x,p=k.z,M<this._minX||M>this._maxX||p<this._minZ||p>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const u=this._getFacetAt(M,p);return Q.Ap.TransformNormalFromFloatsToRef(u.x,u.y,u.z,q,b),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(M,p){const b=Math.floor((M+this._maxX)*this._subdivisionsX/this._width),Q=Math.floor(-(p+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),q=this._heightQuads[Q*this._subdivisionsX+b];let B;return B=p<q.slope.x*M+q.slope.y?q.facet1:q.facet2,B}_initHeightQuads(){const M=this._subdivisionsX,p=this._subdivisionsY;this._heightQuads=[];for(let b=0;b<p;b++)for(let p=0;p<M;p++){const q={slope:Q.Vector2.Zero(),facet1:new Q.Vector4(0,0,0,0),facet2:new Q.Vector4(0,0,0,0)};this._heightQuads[b*M+p]=q}return this}_computeHeightQuads(){const M=this.getVerticesData(u.f.PositionKind);if(!M)return this;const p=Q.TmpVectors.Ap[3],b=Q.TmpVectors.Ap[2],q=Q.TmpVectors.Ap[1],B=Q.TmpVectors.Ap[0],k=Q.TmpVectors.Ap[4],T=Q.TmpVectors.Ap[5],O=Q.TmpVectors.Ap[6],H=Q.TmpVectors.Ap[7],F=Q.TmpVectors.Ap[8];let o=0,W=0,i=0,A=0,j=0,K=0,D=0;const a=this._subdivisionsX,s=this._subdivisionsY;for(let u=0;u<s;u++)for(let s=0;s<a;s++){o=3*s,W=u*(a+1)*3,i=(u+1)*(a+1)*3,p.x=M[W+o],p.y=M[W+o+1],p.z=M[W+o+2],b.x=M[W+o+3],b.y=M[W+o+4],b.z=M[W+o+5],q.x=M[i+o],q.y=M[i+o+1],q.z=M[i+o+2],B.x=M[i+o+3],B.y=M[i+o+4],B.z=M[i+o+5],A=(B.z-p.z)/(B.x-p.x),j=p.z-A*p.x,b.subtractToRef(p,k),q.subtractToRef(p,T),B.subtractToRef(p,O),Q.Ap.CrossToRef(O,T,H),Q.Ap.CrossToRef(k,O,F),H.normalize(),F.normalize(),K=-(H.x*p.x+H.y*p.y+H.z*p.z),D=-(F.x*b.x+F.y*b.y+F.z*b.z);const S=this._heightQuads[u*a+s];S.slope.Db(A,j),S.facet1.Db(H.x,H.y,H.z,K),S.facet2.Db(F.x,F.y,F.z,D)}return this}serialize(M){super.serialize(M),M.subdivisionsX=this._subdivisionsX,M.subdivisionsY=this._subdivisionsY,M.minX=this._minX,M.maxX=this._maxX,M.Fb=this._minZ,M.maxZ=this._maxZ,M.width=this._width,M.height=this._height}static Parse(M,p){const b=new T(M.name,p);return b._subdivisionsX=M.subdivisionsX||1,b._subdivisionsY=M.subdivisionsY||1,b._minX=M.minX,b._maxX=M.maxX,b._minZ=M.Fb,b._maxZ=M.maxZ,b._width=M.width,b._height=M.height,b}}var O=b(11621),H=b(11664),F=b(11798),o=b(11848);function W(M){const p=[],b=[],q=[],B=[];let u,T;const O=M.width||M.size||1,H=M.height||M.size||1,F=0|(M.subdivisionsX||M.subdivisions||1),W=0|(M.subdivisionsY||M.subdivisions||1);for(u=0;u<=W;u++)for(T=0;T<=F;T++){const M=new Q.Ap(T*O/F-O/2,0,(W-u)*H/W-H/2),p=new Q.Ap(0,1,0);b.push(M.x,M.y,M.z),q.push(p.x,p.y,p.z),B.push(T/F,o.e?u/W:1-u/W)}for(u=0;u<W;u++)for(T=0;T<F;T++)p.push(T+1+(u+1)*(F+1)),p.push(T+1+u*(F+1)),p.push(T+u*(F+1)),p.push(T+(u+1)*(F+1)),p.push(T+1+(u+1)*(F+1)),p.push(T+u*(F+1));const i=new k.e;return i.indices=p,i.xM=b,i.PM=q,i.NM=B,i}function i(M){const p=void 0!==M.xmin&&null!==M.xmin?M.xmin:-1,b=void 0!==M.zmin&&null!==M.zmin?M.zmin:-1,q=void 0!==M.xmax&&null!==M.xmax?M.xmax:1,B=void 0!==M.zmax&&null!==M.zmax?M.zmax:1,u=M.subdivisions||{w:1,h:1},T=M.precision||{w:1,h:1},O=[],H=[],F=[],o=[];let W,i,A,j;u.h=u.h<1?1:u.h,u.w=u.w<1?1:u.w,T.w=T.w<1?1:T.w,T.h=T.h<1?1:T.h;const K=(q-p)/u.w,D=(B-b)/u.h;function a(M,p,b,q){const B=H.length/3,k=T.w+1;for(W=0;W<T.h;W++)for(i=0;i<T.w;i++){const M=[B+i+W*k,B+(i+1)+W*k,B+(i+1)+(W+1)*k,B+i+(W+1)*k];O.push(M[1]),O.push(M[2]),O.push(M[3]),O.push(M[0]),O.push(M[1]),O.push(M[3])}const u=Q.Ap.Zero(),A=new Q.Ap(0,1,0);for(W=0;W<=T.h;W++)for(u.z=W*(q-p)/T.h+p,i=0;i<=T.w;i++)u.x=i*(b-M)/T.w+M,u.y=0,H.push(u.x,u.y,u.z),F.push(A.x,A.y,A.z),o.push(i/T.w,W/T.h)}for(A=0;A<u.h;A++)for(j=0;j<u.w;j++)a(p+j*K,b+A*D,p+(j+1)*K,b+(A+1)*D);const s=new k.e;return s.indices=O,s.xM=H,s.PM=F,s.NM=o,s}function A(M){const p=[],b=[],B=[],u=[];let T,O;const H=M.colorFilter||new q.ap(.3,.59,.11),o=M.alphaFilter||0;let W=!1;if(M.minHeight>M.maxHeight){W=!0;const p=M.maxHeight;M.maxHeight=M.minHeight,M.minHeight=p}for(T=0;T<=M.subdivisions;T++)for(O=0;O<=M.subdivisions;O++){const p=new Q.Ap(O*M.width/M.subdivisions-M.width/2,0,(M.subdivisions-T)*M.height/M.subdivisions-M.height/2),q=4*(((p.x+M.width/2)/M.width*(M.bufferWidth-1)|0)+((1-(p.z+M.height/2)/M.height)*(M.bufferHeight-1)|0)*M.bufferWidth);let k=M.buffer[q]/255,i=M.buffer[q+1]/255,A=M.buffer[q+2]/255;const j=M.buffer[q+3]/255;W&&(k=1-k,i=1-i,A=1-A);const K=k*H.r+i*H.g+A*H.b;p.y=j>=o?M.minHeight+(M.maxHeight-M.minHeight)*K:M.minHeight-F.d,M.heightBuffer&&(M.heightBuffer[T*(M.subdivisions+1)+O]=p.y),b.push(p.x,p.y,p.z),B.push(0,0,0),u.push(O/M.subdivisions,1-T/M.subdivisions)}for(T=0;T<M.subdivisions;T++)for(O=0;O<M.subdivisions;O++){const Q=O+1+(T+1)*(M.subdivisions+1),q=O+1+T*(M.subdivisions+1),B=O+T*(M.subdivisions+1),k=O+(T+1)*(M.subdivisions+1),u=b[3*Q+1]>=M.minHeight,H=b[3*q+1]>=M.minHeight,F=b[3*B+1]>=M.minHeight;u&&H&&F&&(p.push(Q),p.push(q),p.push(B));b[3*k+1]>=M.minHeight&&u&&F&&(p.push(k),p.push(Q),p.push(B))}k.e.ComputeNormals(b,p,B);const i=new k.e;return i.indices=p,i.xM=b,i.PM=B,i.NM=u,i}function j(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=new T(M,arguments.length>2?arguments[2]:void 0);b._setReady(!1),b._subdivisionsX=p.subdivisionsX||p.subdivisions||1,b._subdivisionsY=p.subdivisionsY||p.subdivisions||1,b._width=p.width||1,b._height=p.height||1,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ;return W(p).YM(b,p.updatable),b._setReady(!0),b}function K(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new B.d(M,b);return i(p).YM(Q,p.updatable),Q}function D(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=b.width||10,k=b.height||10,u=b.subdivisions||1,F=b.minHeight||0,o=b.maxHeight||1,W=b.colorFilter||new q.ap(.3,.59,.11),i=b.alphaFilter||0,j=b.updatable,K=b.onReady;Q=Q||H.c.LastCreatedScene;const D=new T(M,Q);let a;D._subdivisionsX=u,D._subdivisionsY=u,D._width=B,D._height=k,D._maxX=D._width/2,D._maxZ=D._height/2,D._minX=-D._maxX,D._minZ=-D._maxZ,D._setReady(!1),b.passHeightBufferInCallback&&(a=new Float32Array((u+1)*(u+1)));const s=(M,p,b)=>{A({width:B,height:k,subdivisions:u,minHeight:F,maxHeight:o,colorFilter:W,buffer:M,bufferWidth:p,bufferHeight:b,alphaFilter:i,heightBuffer:a}).YM(D,j),K&&K(D,a),D._setReady(!0)};if("string"===typeof p){const M=M=>{var p;const b=M.width,q=M.height;if(Q.O)return;const B=null===(p=Q)||void 0===p?void 0:p.getEngine().resizeImageBitmap(M,b,q);s(B,b,q)};O.Tools.LoadImage(p,M,b.onError?b.onError:()=>{},Q.offlineProvider)}else s(p.data,p.width,p.height);return D}k.e.CreateGround=W,k.e.CreateTiledGround=i,k.e.CreateGroundFromHeightMap=A,B.d.CreateGround=(M,p,b,Q,q,B)=>j(M,{width:p,height:b,subdivisions:Q,updatable:B},q),B.d.CreateTiledGround=(M,p,b,Q,q,B,k,u,T)=>K(M,{xmin:p,zmin:b,xmax:Q,zmax:q,subdivisions:B,precision:k,updatable:T},u),B.d.CreateGroundFromHeightMap=(M,p,b,Q,q,B,k,u,T,O,H)=>D(M,p,{width:b,height:Q,subdivisions:q,minHeight:B,maxHeight:k,updatable:T,onReady:O,alphaFilter:H},u)},13651:(M,p,b)=>{"use strict";b.d(p,{d:()=>W,e:()=>F,i:()=>o});var Q=b(11796),q=b(12257),B=b(12246),k=b(12356),u=b(11857),T=b(11637);function O(M){const p=[],b=[],Q=M.lines,q=M.LM,k=[];let u=0;for(let B=0;B<Q.length;B++){const M=Q[B];for(let Q=0;Q<M.length;Q++){const{x:T,y:O,z:H}=M[Q];if(b.push(T,O,H),q){const M=q[B],{r:p,g:b,b:u,a:T}=M[Q];k.push(p,b,u,T)}Q>0&&(p.push(u-1),p.push(u)),u++}}const T=new B.e;return T.indices=p,T.xM=b,q&&(T.LM=k),T}function H(M){const p=M.dashSize||3,b=M.gapSize||1,q=M.dashNb||200,k=M.points,u=[],T=[],O=Q.Ap.Zero();let H=0,F=0,o=0,W=0,i=0,A=0,j=0;for(j=0;j<k.length-1;j++)k[j+1].subtractToRef(k[j],O),H+=O.length();for(o=H/q,W=p*o/(p+b),j=0;j<k.length-1;j++){k[j+1].subtractToRef(k[j],O),F=Math.floor(O.length()/o),O.normalize();for(let M=0;M<F;M++)i=o*M,u.push(k[j].x+i*O.x,k[j].y+i*O.y,k[j].z+i*O.z),u.push(k[j].x+(i+W)*O.x,k[j].y+(i+W)*O.y,k[j].z+(i+W)*O.z),T.push(A,A+1),A+=2}const K=new B.e;return K.xM=u,K.indices=T,K}function F(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=p.instance,q=p.lines,B=p.LM;if(Q){const M=Q.getVerticesData(u.f.PositionKind);let p,b;B&&(p=Q.getVerticesData(u.f.ColorKind));let k=0,T=0;for(let Q=0;Q<q.length;Q++){const u=q[Q];for(let q=0;q<u.length;q++)M[k]=u[q].x,M[k+1]=u[q].y,M[k+2]=u[q].z,B&&p&&(b=B[Q],p[T]=b[q].r,p[T+1]=b[q].g,p[T+2]=b[q].b,p[T+3]=b[q].a,T+=4),k+=3}return Q.updateVerticesData(u.f.PositionKind,M,!1,!1),B&&p&&Q.updateVerticesData(u.f.ColorKind,p,!1,!1),Q.refreshBoundingInfo(),Q}const T=!!B,H=new k.c(M,b,null,void 0,void 0,T,p.useVertexAlpha,p.material);return O(p).YM(H,p.updatable),H}function o(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=p.LM?[p.LM]:null;return F(M,{lines:[p.points],updatable:p.updatable,instance:p.instance,LM:Q,useVertexAlpha:p.useVertexAlpha,material:p.material},b)}function W(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=p.points,u=p.instance,O=p.gapSize||1,F=p.dashSize||3;if(u){const M=M=>{const p=Q.Ap.Zero(),b=M.length/6;let q=0,k=0,T=0,O=0,H=0,F=0,o=0,W=0;for(o=0;o<B.length-1;o++)B[o+1].subtractToRef(B[o],p),q+=p.length();T=q/b;const i=u._creationDataStorage.dashSize;for(O=i*T/(i+u._creationDataStorage.gapSize),o=0;o<B.length-1;o++)for(B[o+1].subtractToRef(B[o],p),k=Math.floor(p.length()/T),p.normalize(),W=0;W<k&&F<M.length;)H=T*W,M[F]=B[o].x+H*p.x,M[F+1]=B[o].y+H*p.y,M[F+2]=B[o].z+H*p.z,M[F+3]=B[o].x+(H+O)*p.x,M[F+4]=B[o].y+(H+O)*p.y,M[F+5]=B[o].z+(H+O)*p.z,F+=6,W++;for(;F<M.length;)M[F]=B[o].x,M[F+1]=B[o].y,M[F+2]=B[o].z,F+=3};return(p.dashNb||p.dashSize||p.gapSize||p.useVertexAlpha||p.material)&&T.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),u.updateMeshPositions(M,!1),u}const o=new k.c(M,b,null,void 0,void 0,void 0,p.useVertexAlpha,p.material);return H(p).YM(o,p.updatable),o._creationDataStorage=new q.h,o._creationDataStorage.dashSize=F,o._creationDataStorage.gapSize=O,o}B.e.CreateLineSystem=O,B.e.CreateDashedLines=H,q.d.PO=function(M,p){return o(M,{points:p,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},q.d.CreateDashedLines=function(M,p,b,Q,q){return W(M,{points:p,dashSize:b,gapSize:Q,dashNb:q,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13033:(M,p,b)=>{"use strict";b.d(p,{c:()=>u,g:()=>T});var Q=b(12257),q=b(12246),B=b(11848);function k(M){const p=[],b=[],Q=[],k=[],u=void 0!==M.width?M.width:void 0!==M.size?M.size:1,T=void 0!==M.height?M.height:void 0!==M.size?M.size:1,O=0===M.sideOrientation?0:M.sideOrientation||q.e.DEFAULTSIDE,H=u/2,F=T/2;b.push(-H,-F,0),Q.push(0,0,-1),k.push(0,B.e?1:0),b.push(H,-F,0),Q.push(0,0,-1),k.push(1,B.e?1:0),b.push(H,F,0),Q.push(0,0,-1),k.push(1,B.e?0:1),b.push(-H,F,0),Q.push(0,0,-1),k.push(0,B.e?0:1),p.push(0),p.push(1),p.push(2),p.push(0),p.push(2),p.push(3),q.e._ComputeSides(O,b,p,Q,k,M.frontUVs,M.backUVs);const o=new q.e;return o.indices=p,o.xM=b,o.PM=Q,o.NM=k,o}function u(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new Q.d(M,b);p.sideOrientation=Q.d._GetDefaultSideOrientation(p.sideOrientation),q._originalBuilderSideOrientation=p.sideOrientation;return k(p).YM(q,p.updatable),p.sourcePlane&&(q.translate(p.sourcePlane.normal,-p.sourcePlane.d),q.setDirection(p.sourcePlane.normal.scale(-1))),q}const T={rO:u};q.e.rO=k,Q.d.rO=(M,p,b,Q,q)=>u(M,{size:p,width:p,height:p,sideOrientation:q,updatable:Q},b)},13135:(M,p,b)=>{"use strict";b.d(p,{e:()=>T});var Q=b(11796),q=b(12257),B=b(12246),k=b(11848);function u(M){const p=0|(M.segments||32),b=M.diameterX||M.diameter||1,q=M.diameterY||M.diameter||1,u=M.diameterZ||M.diameter||1,T=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,O=M.slice&&M.slice<=0?1:M.slice||1,H=0===M.sideOrientation?0:M.sideOrientation||B.e.DEFAULTSIDE,F=!!M.dedupTopBottomIndices,o=new Q.Ap(b/2,q/2,u/2),W=2+p,i=2*W,A=[],j=[],K=[],D=[];for(let B=0;B<=W;B++){const M=B/W,p=M*Math.PI*O;for(let b=0;b<=i;b++){const q=b/i,B=q*Math.PI*2*T,u=Q.Matrix.RotationZ(-p),O=Q.Matrix.RotationY(B),H=Q.Ap.TransformCoordinates(Q.Ap.Up(),u),F=Q.Ap.TransformCoordinates(H,O),W=F.multiply(o),A=F.divide(o).normalize();j.push(W.x,W.y,W.z),K.push(A.x,A.y,A.z),D.push(q,k.e?1-M:M)}if(B>0){const M=j.length/3;for(let p=M-2*(i+1);p+i+2<M;p++)F?(B>1&&(A.push(p),A.push(p+1),A.push(p+i+1)),(B<W||O<1)&&(A.push(p+i+1),A.push(p+1),A.push(p+i+2))):(A.push(p),A.push(p+1),A.push(p+i+1),A.push(p+i+1),A.push(p+1),A.push(p+i+2))}}B.e._ComputeSides(H,j,A,K,D,M.frontUVs,M.backUVs);const a=new B.e;return a.indices=A,a.xM=j,a.PM=K,a.NM=D,a}function T(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new q.d(M,b);p.sideOrientation=q.d._GetDefaultSideOrientation(p.sideOrientation),Q._originalBuilderSideOrientation=p.sideOrientation;return u(p).YM(Q,p.updatable),Q}B.e.CreateSphere=u,q.d.CreateSphere=(M,p,b,Q,q,B)=>T(M,{segments:p,diameterX:b,diameterY:b,diameterZ:b,sideOrientation:B,updatable:q},Q)},13925:(M,p,b)=>{"use strict";b.d(p,{d:()=>u});var Q=b(12372),q=b(13446),B=b(12390),k=b(12246);class u{static get Configuration(){return{get decoder(){return q.e.DefaultConfiguration},set decoder(M){q.e.DefaultConfiguration=M}}}static set Configuration(M){q.e.DefaultConfiguration=M.decoder}static get DecoderAvailable(){return(0,Q.e)(q.e.DefaultConfiguration)}static get Default(){return u._Default??(u._Default=new u),u._Default}static ResetDefault(M){u._Default&&(M||u._Default.dispose(),u._Default=null)}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.DefaultNumWorkers;const p="number"===typeof M?{...q.e.DefaultConfiguration,numWorkers:M}:{...q.e.DefaultConfiguration,...M};this._decoder=new q.e(p)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(M,p,b){return this._decoder.decodeMeshToMeshDataAsync(M,p,b)}async decodeMeshToGeometryAsync(M,p,b,Q){return await this._decoder.decodeMeshToGeometryAsync(M,p,b,Q)}async _decodeMeshToGeometryForGltfAsync(M,p,b,Q,q,B){return await this._decoder._decodeMeshToGeometryForGltfAsync(M,p,b,Q,q,B)}async decodeMeshAsync(M,p){const b=await this._decoder.decodeMeshToMeshDataAsync(M,p),Q=new k.e;b.indices&&(Q.indices=b.indices);for(const q of b.attributes){const M=B.b.GetFloatData(q.data,q.size,B.b.GetDataType(q.data),q.byteOffset,q.byteStride,q.normalized,b.totalVertices);Q.set(M,q.kind)}return Q}}u.DefaultNumWorkers=(0,Q.d)(),u._Default=null},13446:(M,p,b)=>{"use strict";b.d(p,{e:()=>O});var Q=b(12372),q=b(11621),B=b(12271),k=b(12390),u=b(11637),T=b(12386);class O extends Q.b{static get DefaultAvailable(){return(0,Q.e)(O.DefaultConfiguration)}static get Default(){return O._Default??(O._Default=new O),O._Default}static ResetDefault(M){O._Default&&(M||O._Default.dispose(),O._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(M,p){return{module:await(p||DracoDecoderModule)({wasmBinary:M})}}_getWorkerContent(){return`${T.e}(${T.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.DefaultConfiguration)}decodeMeshToMeshDataAsync(M,p,b){const Q=M instanceof ArrayBuffer?new Int8Array(M):new Int8Array(M.buffer,M.byteOffset,M.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async M=>await new Promise(((q,B)=>{M.push(((M,k)=>{let T=null;const O=[],H=p=>{M.removeEventListener("error",H),M.removeEventListener("message",F),B(p),k()},F=p=>{const Q=p.data;switch(Q.id){case"indices":T=Q.data;break;case"attribute":O.push({kind:Q.kind,data:Q.data,size:Q.size,byteOffset:Q.byteOffset,byteStride:Q.byteStride,normalized:(B=Q.kind,o=Q.normalized,b&&void 0!==b[B]?(o!==b[B]&&u.c.Warn(`Normalized flag from Draco data (${o}) does not match normalized flag from glTF accessor (${b[B]}). Using flag from glTF accessor.`),b[B]):o)});break;case"decodeMeshDone":M.removeEventListener("error",H),M.removeEventListener("message",F),q({indices:T,attributes:O,totalVertices:Q.totalVertices}),k()}var B,o};M.addEventListener("error",H),M.addEventListener("message",F);const o=Q.slice();M.postMessage({id:"decodeMesh",dataView:o,attributes:p},[o.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((M=>{let b=null;const q=[],B=(0,T.e)(M.module,Q,p,(M=>{b=M}),((M,p,b,Q,B,k)=>{q.push({kind:M,data:p,size:b,byteOffset:Q,byteStride:B,normalized:k})}));return{indices:b,attributes:q,totalVertices:B}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(M,p,b,Q){const q=await this.decodeMeshToMeshDataAsync(b,Q),u=new B.d(M,p);q.indices&&u.setIndices(q.indices);for(const B of q.attributes)u.setVerticesBuffer(new k.b(p.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),q.totalVertices);return u}async _decodeMeshToGeometryForGltfAsync(M,p,b,Q,q,u){const T=await this.decodeMeshToMeshDataAsync(b,Q,q),O=new B.d(M,p);u&&(O._boundingInfo=u,O.useBoundingInfoFromGeometry=!0),T.indices&&O.setIndices(T.indices);for(const B of T.attributes)O.setVerticesBuffer(new k.b(p.getEngine(),B.data,B.kind,!1,void 0,B.byteStride,void 0,B.byteOffset,B.size,void 0,B.normalized,!0),T.totalVertices);return O}}O.DefaultConfiguration={wasmUrl:`${q.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},O._Default=null},13642:(M,p,b)=>{"use strict";b.d(p,{c:()=>uM});var Q=b(11796),q=b(12257),B=b(11857),k=b(12246),u=b(11848);function T(M){let p=M.pathArray;const b=M.closeArray||!1,Q=M.closePath||!1,q=M.invertUV||!1,T=Math.floor(p[0].length/2);let O=M.offset||T;O=O>T?T:Math.floor(O);const H=0===M.sideOrientation?0:M.sideOrientation||k.e.DEFAULTSIDE,F=M.NM,o=M.LM,W=[],i=[],A=[],j=[],K=[],D=[],a=[],s=[];let S;const f=[],R=[];let y,x,P;if(p.length<2){const M=[],b=[];for(x=0;x<p[0].length-O;x++)M.push(p[0][x]),b.push(p[0][x+O]);p=[M,b]}let L=0;const N=Q?1:0,r=b?1:0;let Y,w,E,n,g,U;for(S=p[0].length,y=0;y<p.length+r;y++){for(a[y]=0,K[y]=[0],Y=y===p.length?p[0]:p[y],w=Y.length,S=S<w?S:w,P=0;P<w;)W.push(Y[P].x,Y[P].y,Y[P].z),P>0&&(E=Y[P].jp(Y[P-1]).length(),n=E+a[y],K[y].push(n),a[y]=n),P++;Q&&(P--,W.push(Y[0].x,Y[0].y,Y[0].z),E=Y[P].jp(Y[0]).length(),n=E+a[y],K[y].push(n),a[y]=n),f[y]=w+N,R[y]=L,L+=w+N}let c,d,V=null,h=null;for(x=0;x<S+N;x++)for(s[x]=0,D[x]=[0],y=0;y<p.length-1+r;y++)g=p[y],U=y===p.length-1?p[0]:p[y+1],x===S?(V=g[0],h=U[0]):(V=g[x],h=U[x]),E=h.jp(V).length(),n=E+s[x],D[x].push(n),s[x]=n;if(F)for(y=0;y<F.length;y++)j.push(F[y].x,u.e?1-F[y].y:F[y].y);else for(y=0;y<p.length+r;y++)for(x=0;x<S+N;x++)c=0!=a[y]?K[y][x]/a[y]:0,d=0!=s[x]?D[x][y]/s[x]:0,q?j.push(d,c):j.push(c,u.e?1-d:d);y=0;let I=0,Z=f[y]-1,J=f[y+1]-1,v=Z<J?Z:J,z=R[1]-R[0];const t=f.length-1;for(;I<=v&&y<t;)i.push(I,I+z,I+1),i.push(I+z+1,I+1,I+z),I+=1,I===v&&(y++,z=R[y+1]-R[y],Z=f[y]-1,J=f[y+1]-1,I=R[y],v=Z<J?Z+I:J+I);if(k.e.ComputeNormals(W,i,A),Q){let M=0,b=0;for(y=0;y<p.length;y++){M=3*R[y],b=y+1<p.length?3*(R[y+1]-1):A.length-3,A[M]=.5*(A[M]+A[b]),A[M+1]=.5*(A[M+1]+A[b+1]),A[M+2]=.5*(A[M+2]+A[b+2]);const Q=Math.sqrt(A[M]*A[M]+A[M+1]*A[M+1]+A[M+2]*A[M+2]);A[M]/=Q,A[M+1]/=Q,A[M+2]/=Q,A[b]=A[M],A[b+1]=A[M+1],A[b+2]=A[M+2]}}if(b){let M=3*R[0],b=3*R[p.length];for(x=0;x<S+N;x++){A[M]=.5*(A[M]+A[b]),A[M+1]=.5*(A[M+1]+A[b+1]),A[M+2]=.5*(A[M+2]+A[b+2]);const p=Math.sqrt(A[M]*A[M]+A[M+1]*A[M+1]+A[M+2]*A[M+2]);A[M]/=p,A[M+1]/=p,A[M+2]/=p,A[b]=A[M],A[b+1]=A[M+1],A[b+2]=A[M+2],M+=3,b+=3}}k.e._ComputeSides(H,W,i,A,j,M.frontUVs,M.backUVs);let e=null;if(o){e=new Float32Array(4*o.length);for(let M=0;M<o.length;M++)e[4*M]=o[M].r,e[4*M+1]=o[M].g,e[4*M+2]=o[M].b,e[4*M+3]=o[M].a}const G=new k.e,mM=new Float32Array(W),C=new Float32Array(A),X=new Float32Array(j);return G.indices=i,G.xM=mM,G.PM=C,G.NM=X,e&&G.set(e,B.f.ColorKind),Q&&(G._idx=R),G}function O(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=p.pathArray,H=p.closeArray,F=p.closePath,o=q.d._GetDefaultSideOrientation(p.sideOrientation),W=p.instance,i=p.updatable;if(W){const M=Q.TmpVectors.Ap[0].sb(Number.MAX_VALUE),b=Q.TmpVectors.Ap[1].sb(-Number.MAX_VALUE),T=p=>{let Q=O[0].length;const B=W;let k=0;const u=B._originalBuilderSideOrientation===q.d.DOUBLESIDE?2:1;for(let q=1;q<=u;++q)for(let u=0;u<O.length;++u){const q=O[u],T=q.length;Q=Q<T?Q:T;for(let B=0;B<Q;++B){const Q=q[B];p[k]=Q.x,p[k+1]=Q.y,p[k+2]=Q.z,M.minimizeInPlaceFromFloats(Q.x,Q.y,Q.z),b.maximizeInPlaceFromFloats(Q.x,Q.y,Q.z),k+=3}if(B._creationDataStorage&&B._creationDataStorage.closePath){const M=q[0];p[k]=M.x,p[k+1]=M.y,p[k+2]=M.z,k+=3}}},H=W.getVerticesData(B.f.PositionKind);if(T(H),W.hasBoundingInfo?W.getBoundingInfo().reConstruct(M,b,W._worldMatrix):W.buildBoundingInfo(M,b,W._worldMatrix),W.updateVerticesData(B.f.PositionKind,H,!1,!1),p.LM){const M=W.getVerticesData(B.f.ColorKind);for(let b=0,Q=0;b<p.LM.length;b++,Q+=4){const q=p.LM[b];M[Q]=q.r,M[Q+1]=q.g,M[Q+2]=q.b,M[Q+3]=q.a}W.updateVerticesData(B.f.ColorKind,M,!1,!1)}if(p.NM){const M=W.getVerticesData(B.f.UVKind);for(let b=0;b<p.NM.length;b++)M[2*b]=p.NM[b].x,M[2*b+1]=u.e?1-p.NM[b].y:p.NM[b].y;W.updateVerticesData(B.f.UVKind,M,!1,!1)}if(!W.areNormalsFrozen||W.isFacetDataEnabled){const M=W.jb(),p=W.getVerticesData(B.f.NormalKind),b=W.isFacetDataEnabled?W.getFacetDataParameters():null;if(k.e.ComputeNormals(H,M,p,b),W._creationDataStorage&&W._creationDataStorage.closePath){let M=0,b=0;for(let Q=0;Q<O.length;Q++)M=3*W._creationDataStorage.idx[Q],b=Q+1<O.length?3*(W._creationDataStorage.idx[Q+1]-1):p.length-3,p[M]=.5*(p[M]+p[b]),p[M+1]=.5*(p[M+1]+p[b+1]),p[M+2]=.5*(p[M+2]+p[b+2]),p[b]=p[M],p[b+1]=p[M+1],p[b+2]=p[M+2]}W.areNormalsFrozen||W.updateVerticesData(B.f.NormalKind,p,!1,!1)}return W}{const Q=new q.d(M,b);Q._originalBuilderSideOrientation=o,Q._creationDataStorage=new q.h;const B=T(p);return F&&(Q._creationDataStorage.idx=B._idx),Q._creationDataStorage.closePath=F,Q._creationDataStorage.closeArray=H,B.YM(Q,i),Q}}k.e.CreateRibbon=T,q.d.CreateRibbon=function(M,p){return O(M,{pathArray:p,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var H=b(13152),F=b(12974),o=b(11833);function W(M){const p=M.pattern||q.d.NO_FLIP,b=M.tileWidth||M.tileSize||1,Q=M.tileHeight||M.tileSize||1,B=M.alignHorizontal||0,u=M.alignVertical||0,T=M.width||M.size||1,O=Math.floor(T/b);let H=T-O*b;const F=M.height||M.size||1,o=Math.floor(F/Q);let W=F-o*Q;const i=b*O/2,A=Q*o/2;let j=0,K=0,D=0,a=0,s=0,S=0;if(H>0||W>0){switch(D=-i,a=-A,s=i,S=A,B){case q.d.CENTER:H/=2,D-=H,s+=H;break;case q.d.LEFT:s+=H,j=-H/2;break;case q.d.RIGHT:D-=H,j=H/2}switch(u){case q.d.CENTER:W/=2,a-=W,S+=W;break;case q.d.BOTTOM:S+=W,K=-W/2;break;case q.d.TOP:a-=W,K=W/2}}const f=[],R=[],y=[];y[0]=[0,0,1,0,1,1,0,1],y[1]=[0,0,1,0,1,1,0,1],p!==q.d.ROTATE_TILE&&p!==q.d.ROTATE_ROW||(y[1]=[1,1,0,1,0,0,1,0]),p!==q.d.FLIP_TILE&&p!==q.d.FLIP_ROW||(y[1]=[1,0,0,0,0,1,1,1]),p!==q.d.FLIP_N_ROTATE_TILE&&p!==q.d.FLIP_N_ROTATE_ROW||(y[1]=[0,1,1,1,1,0,0,0]);let x=[];const P=[],L=[];let N=0;for(let k=0;k<o;k++)for(let M=0;M<O;M++)f.push(M*b-i+j,k*Q-A+K,0),f.push((M+1)*b-i+j,k*Q-A+K,0),f.push((M+1)*b-i+j,(k+1)*Q-A+K,0),f.push(M*b-i+j,(k+1)*Q-A+K,0),L.push(N,N+1,N+3,N+1,N+2,N+3),x=p===q.d.FLIP_TILE||p===q.d.ROTATE_TILE||p===q.d.FLIP_N_ROTATE_TILE?x.concat(y[(M%2+k%2)%2]):p===q.d.FLIP_ROW||p===q.d.ROTATE_ROW||p===q.d.FLIP_N_ROTATE_ROW?x.concat(y[k%2]):x.concat(y[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),N+=4;if(H>0||W>0){const M=W>0&&(u===q.d.CENTER||u===q.d.TOP),k=W>0&&(u===q.d.CENTER||u===q.d.BOTTOM),T=H>0&&(B===q.d.CENTER||B===q.d.RIGHT),F=H>0&&(B===q.d.CENTER||B===q.d.LEFT);let y,r,Y,w,E=[];if(M&&T&&(f.push(D+j,a+K,0),f.push(-i+j,a+K,0),f.push(-i+j,a+W+K,0),f.push(D+j,a+W+K,0),L.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,y=1-H/b,r=1-W/Q,Y=1,w=1,E=[y,r,Y,r,Y,w,y,w],p===q.d.ROTATE_ROW&&(E=[1-y,1-r,1-Y,1-r,1-Y,1-w,1-y,1-w]),p===q.d.FLIP_ROW&&(E=[1-y,r,1-Y,r,1-Y,w,1-y,w]),p===q.d.FLIP_N_ROTATE_ROW&&(E=[y,1-r,Y,1-r,Y,1-w,y,1-w]),x=x.concat(E),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&F&&(f.push(i+j,a+K,0),f.push(s+j,a+K,0),f.push(s+j,a+W+K,0),f.push(i+j,a+W+K,0),L.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,y=0,r=1-W/Q,Y=H/b,w=1,E=[y,r,Y,r,Y,w,y,w],(p===q.d.ROTATE_ROW||p===q.d.ROTATE_TILE&&O%2===0)&&(E=[1-y,1-r,1-Y,1-r,1-Y,1-w,1-y,1-w]),(p===q.d.FLIP_ROW||p===q.d.FLIP_TILE&&O%2===0)&&(E=[1-y,r,1-Y,r,1-Y,w,1-y,w]),(p===q.d.FLIP_N_ROTATE_ROW||p===q.d.FLIP_N_ROTATE_TILE&&O%2===0)&&(E=[y,1-r,Y,1-r,Y,1-w,y,1-w]),x=x.concat(E),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k&&T&&(f.push(D+j,A+K,0),f.push(-i+j,A+K,0),f.push(-i+j,S+K,0),f.push(D+j,S+K,0),L.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,y=1-H/b,r=0,Y=1,w=W/Q,E=[y,r,Y,r,Y,w,y,w],(p===q.d.ROTATE_ROW&&o%2===1||p===q.d.ROTATE_TILE&&o%1===0)&&(E=[1-y,1-r,1-Y,1-r,1-Y,1-w,1-y,1-w]),(p===q.d.FLIP_ROW&&o%2===1||p===q.d.FLIP_TILE&&o%2===0)&&(E=[1-y,r,1-Y,r,1-Y,w,1-y,w]),(p===q.d.FLIP_N_ROTATE_ROW&&o%2===1||p===q.d.FLIP_N_ROTATE_TILE&&o%2===0)&&(E=[y,1-r,Y,1-r,Y,1-w,y,1-w]),x=x.concat(E),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k&&F&&(f.push(i+j,A+K,0),f.push(s+j,A+K,0),f.push(s+j,S+K,0),f.push(i+j,S+K,0),L.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,y=0,r=0,Y=H/b,w=W/Q,E=[y,r,Y,r,Y,w,y,w],(p===q.d.ROTATE_ROW&&o%2===1||p===q.d.ROTATE_TILE&&(o+O)%2===1)&&(E=[1-y,1-r,1-Y,1-r,1-Y,1-w,1-y,1-w]),(p===q.d.FLIP_ROW&&o%2===1||p===q.d.FLIP_TILE&&(o+O)%2===1)&&(E=[1-y,r,1-Y,r,1-Y,w,1-y,w]),(p===q.d.FLIP_N_ROTATE_ROW&&o%2===1||p===q.d.FLIP_N_ROTATE_TILE&&(o+O)%2===1)&&(E=[y,1-r,Y,1-r,Y,1-w,y,1-w]),x=x.concat(E),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M){const M=[];y=0,r=1-W/Q,Y=1,w=1,M[0]=[y,r,Y,r,Y,w,y,w],M[1]=[y,r,Y,r,Y,w,y,w],p!==q.d.ROTATE_TILE&&p!==q.d.ROTATE_ROW||(M[1]=[1-y,1-r,1-Y,1-r,1-Y,1-w,1-y,1-w]),p!==q.d.FLIP_TILE&&p!==q.d.FLIP_ROW||(M[1]=[1-y,r,1-Y,r,1-Y,w,1-y,w]),p!==q.d.FLIP_N_ROTATE_TILE&&p!==q.d.FLIP_N_ROTATE_ROW||(M[1]=[y,1-r,Y,1-r,Y,1-w,y,1-w]);for(let Q=0;Q<O;Q++)f.push(Q*b-i+j,a+K,0),f.push((Q+1)*b-i+j,a+K,0),f.push((Q+1)*b-i+j,a+W+K,0),f.push(Q*b-i+j,a+W+K,0),L.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,x=p===q.d.FLIP_TILE||p===q.d.ROTATE_TILE||p===q.d.FLIP_N_ROTATE_TILE?x.concat(M[(Q+1)%2]):p===q.d.FLIP_ROW||p===q.d.ROTATE_ROW||p===q.d.FLIP_N_ROTATE_ROW?x.concat(M[1]):x.concat(M[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){const M=[];y=0,r=0,Y=1,w=W/Q,M[0]=[y,r,Y,r,Y,w,y,w],M[1]=[y,r,Y,r,Y,w,y,w],p!==q.d.ROTATE_TILE&&p!==q.d.ROTATE_ROW||(M[1]=[1-y,1-r,1-Y,1-r,1-Y,1-w,1-y,1-w]),p!==q.d.FLIP_TILE&&p!==q.d.FLIP_ROW||(M[1]=[1-y,r,1-Y,r,1-Y,w,1-y,w]),p!==q.d.FLIP_N_ROTATE_TILE&&p!==q.d.FLIP_N_ROTATE_ROW||(M[1]=[y,1-r,Y,1-r,Y,1-w,y,1-w]);for(let Q=0;Q<O;Q++)f.push(Q*b-i+j,S-W+K,0),f.push((Q+1)*b-i+j,S-W+K,0),f.push((Q+1)*b-i+j,S+K,0),f.push(Q*b-i+j,S+K,0),L.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,x=p===q.d.FLIP_TILE||p===q.d.ROTATE_TILE||p===q.d.FLIP_N_ROTATE_TILE?x.concat(M[(Q+o)%2]):p===q.d.FLIP_ROW||p===q.d.ROTATE_ROW||p===q.d.FLIP_N_ROTATE_ROW?x.concat(M[o%2]):x.concat(M[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(T){const M=[];y=1-H/b,r=0,Y=1,w=1,M[0]=[y,r,Y,r,Y,w,y,w],M[1]=[y,r,Y,r,Y,w,y,w],p!==q.d.ROTATE_TILE&&p!==q.d.ROTATE_ROW||(M[1]=[1-y,1-r,1-Y,1-r,1-Y,1-w,1-y,1-w]),p!==q.d.FLIP_TILE&&p!==q.d.FLIP_ROW||(M[1]=[1-y,r,1-Y,r,1-Y,w,1-y,w]),p!==q.d.FLIP_N_ROTATE_TILE&&p!==q.d.FLIP_N_ROTATE_ROW||(M[1]=[y,1-r,Y,1-r,Y,1-w,y,1-w]);for(let b=0;b<o;b++)f.push(D+j,b*Q-A+K,0),f.push(D+H+j,b*Q-A+K,0),f.push(D+H+j,(b+1)*Q-A+K,0),f.push(D+j,(b+1)*Q-A+K,0),L.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,x=p===q.d.FLIP_TILE||p===q.d.ROTATE_TILE||p===q.d.FLIP_N_ROTATE_TILE?x.concat(M[(b+1)%2]):p===q.d.FLIP_ROW||p===q.d.ROTATE_ROW||p===q.d.FLIP_N_ROTATE_ROW?x.concat(M[b%2]):x.concat(M[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const M=[];y=0,r=0,Y=H/Q,w=1,M[0]=[y,r,Y,r,Y,w,y,w],M[1]=[y,r,Y,r,Y,w,y,w],p!==q.d.ROTATE_TILE&&p!==q.d.ROTATE_ROW||(M[1]=[1-y,1-r,1-Y,1-r,1-Y,1-w,1-y,1-w]),p!==q.d.FLIP_TILE&&p!==q.d.FLIP_ROW||(M[1]=[1-y,r,1-Y,r,1-Y,w,1-y,w]),p!==q.d.FLIP_N_ROTATE_TILE&&p!==q.d.FLIP_N_ROTATE_ROW||(M[1]=[y,1-r,Y,1-r,Y,1-w,y,1-w]);for(let b=0;b<o;b++)f.push(s-H+j,b*Q-A+K,0),f.push(s+j,b*Q-A+K,0),f.push(s+j,(b+1)*Q-A+K,0),f.push(s-H+j,(b+1)*Q-A+K,0),L.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,x=p===q.d.FLIP_TILE||p===q.d.ROTATE_TILE||p===q.d.FLIP_N_ROTATE_TILE?x.concat(M[(b+O)%2]):p===q.d.FLIP_ROW||p===q.d.ROTATE_ROW||p===q.d.FLIP_N_ROTATE_ROW?x.concat(M[b%2]):x.concat(M[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const r=0===M.sideOrientation?0:M.sideOrientation||k.e.DEFAULTSIDE;k.e._ComputeSides(r,f,L,R,x,M.frontUVs,M.backUVs);const Y=new k.e;Y.indices=L,Y.xM=f,Y.PM=R,Y.NM=x;const w=r===k.e.DOUBLESIDE?P.concat(P):P;return Y.LM=w,Y}function i(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new q.d(M,b);p.sideOrientation=q.d._GetDefaultSideOrientation(p.sideOrientation),Q._originalBuilderSideOrientation=p.sideOrientation;return W(p).YM(Q,p.updatable),Q}function A(M){const p=M.faceUV||new Array(6),b=M.faceColors,B=M.pattern||q.d.NO_FLIP,T=M.width||M.size||1,O=M.height||M.size||1,H=M.depth||M.size||1,F=M.tileWidth||M.tileSize||1,i=M.tileHeight||M.tileSize||1,A=M.alignHorizontal||0,j=M.alignVertical||0,K=0===M.sideOrientation?0:M.sideOrientation||k.e.DEFAULTSIDE;for(let q=0;q<6;q++)void 0===p[q]&&(p[q]=new Q.Vector4(0,0,1,1)),b&&void 0===b[q]&&(b[q]=new o.Sb(1,1,1,1));const D=T/2,a=O/2,s=H/2,S=[];for(let Q=0;Q<2;Q++)S[Q]=W({pattern:B,tileWidth:F,tileHeight:i,width:T,height:O,alignVertical:j,alignHorizontal:A,sideOrientation:K});for(let Q=2;Q<4;Q++)S[Q]=W({pattern:B,tileWidth:F,tileHeight:i,width:H,height:O,alignVertical:j,alignHorizontal:A,sideOrientation:K});let f=j;j===q.d.BOTTOM?f=q.d.TOP:j===q.d.TOP&&(f=q.d.BOTTOM);for(let Q=4;Q<6;Q++)S[Q]=W({pattern:B,tileWidth:F,tileHeight:i,width:T,height:H,alignVertical:f,alignHorizontal:A,sideOrientation:K});let R=[],y=[],x=[],P=[];const L=[],N=[],r=[],Y=[];let w=0,E=0;for(let q=0;q<6;q++){const M=S[q].xM.length;N[q]=[],r[q]=[];for(let p=0;p<M/3;p++)N[q].push(new Q.Ap(S[q].xM[3*p],S[q].xM[3*p+1],S[q].xM[3*p+2])),r[q].push(new Q.Ap(S[q].PM[3*p],S[q].PM[3*p+1],S[q].PM[3*p+2]));w=S[q].NM.length,Y[q]=[];for(let b=0;b<w;b+=2)Y[q][b]=p[q].x+(p[q].z-p[q].x)*S[q].NM[b],Y[q][b+1]=p[q].y+(p[q].w-p[q].y)*S[q].NM[b+1],u.e&&(Y[q][b+1]=1-Y[q][b+1]);if(x=x.concat(Y[q]),P=P.concat(S[q].indices.map((M=>M+E))),E+=N[q].length,b)for(let p=0;p<4;p++)L.push(b[q].r,b[q].g,b[q].b,b[q].a)}const n=new Q.Ap(0,0,s),g=Q.Matrix.RotationY(Math.PI);R=N[0].map((M=>Q.Ap.TransformNormal(M,g).add(n))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[]),y=r[0].map((M=>Q.Ap.TransformNormal(M,g))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[]),R=R.concat(N[1].map((M=>M.jp(n))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[])),y=y.concat(r[1].map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[]));const U=new Q.Ap(D,0,0),c=Q.Matrix.RotationY(-Math.PI/2);R=R.concat(N[2].map((M=>Q.Ap.TransformNormal(M,c).add(U))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[])),y=y.concat(r[2].map((M=>Q.Ap.TransformNormal(M,c))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[]));const d=Q.Matrix.RotationY(Math.PI/2);R=R.concat(N[3].map((M=>Q.Ap.TransformNormal(M,d).jp(U))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[])),y=y.concat(r[3].map((M=>Q.Ap.TransformNormal(M,d))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[]));const V=new Q.Ap(0,a,0),h=Q.Matrix.RotationX(Math.PI/2);R=R.concat(N[4].map((M=>Q.Ap.TransformNormal(M,h).add(V))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[])),y=y.concat(r[4].map((M=>Q.Ap.TransformNormal(M,h))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[]));const I=Q.Matrix.RotationX(-Math.PI/2);R=R.concat(N[5].map((M=>Q.Ap.TransformNormal(M,I).jp(V))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[])),y=y.concat(r[5].map((M=>Q.Ap.TransformNormal(M,I))).map((M=>[M.x,M.y,M.z])).reduce(((M,p)=>M.concat(p)),[])),k.e._ComputeSides(K,R,P,y,x);const Z=new k.e;if(Z.indices=P,Z.xM=R,Z.PM=y,Z.NM=x,b){const M=K===k.e.DOUBLESIDE?L.concat(L):L;Z.LM=M}return Z}function j(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new q.d(M,b);p.sideOrientation=q.d._GetDefaultSideOrientation(p.sideOrientation),Q._originalBuilderSideOrientation=p.sideOrientation;return A(p).YM(Q,p.updatable),Q}k.e.CreateTiledPlane=W;k.e.CreateTiledBox=A;var K=b(13135),D=b(12033),a=b(11985);function s(M){const p=M.height||2;let b=0===M.diameterTop?0:M.diameterTop||M.diameter||1,B=0===M.diameterBottom?0:M.diameterBottom||M.diameter||1;b=b||1e-5,B=B||1e-5;const T=0|(M.tessellation||24),O=0|(M.subdivisions||1),H=!!M.hasRings,F=!!M.enclose,W=0===M.cap?0:M.cap||q.d.CAP_ALL,i=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,A=0===M.sideOrientation?0:M.sideOrientation||k.e.DEFAULTSIDE,j=M.faceUV||new Array(3),K=M.faceColors,D=2+(1+(1!==i&&F?2:0))*(H?O:1);let s;for(s=0;s<D;s++)K&&void 0===K[s]&&(K[s]=new o.Sb(1,1,1,1));for(s=0;s<D;s++)j&&void 0===j[s]&&(j[s]=new Q.Vector4(0,0,1,1));const S=[],f=[],R=[],y=[],x=[],P=2*Math.PI*i/T;let L,N,r;const Y=(B-b)/2/p,w=Q.Ap.Zero(),E=Q.Ap.Zero(),n=Q.Ap.Zero(),g=Q.Ap.Zero(),U=Q.Ap.Zero(),c=a.e.Y;let d,V,h,I=1,Z=1,J=0,v=0;for(d=0;d<=O;d++)for(N=d/O,r=(N*(b-B)+B)/2,I=H&&0!==d&&d!==O?2:1,h=0;h<I;h++){for(H&&(Z+=h),F&&(Z+=2*h),V=0;V<=T;V++)L=V*P,w.x=Math.cos(-L)*r,w.y=-p/2+N*p,w.z=Math.sin(-L)*r,0===b&&d===O?(E.x=R[R.length-3*(T+1)],E.y=R[R.length-3*(T+1)+1],E.z=R[R.length-3*(T+1)+2]):(E.x=w.x,E.z=w.z,E.y=Math.sqrt(E.x*E.x+E.z*E.z)*Y,E.normalize()),0===V&&(n.B(w),g.B(E)),f.push(w.x,w.y,w.z),R.push(E.x,E.y,E.z),v=H?J!==Z?j[Z].y:j[Z].w:j[Z].y+(j[Z].w-j[Z].y)*N,y.push(j[Z].x+(j[Z].z-j[Z].x)*V/T,u.e?1-v:v),K&&x.push(K[Z].r,K[Z].g,K[Z].b,K[Z].a);1!==i&&F&&(f.push(w.x,w.y,w.z),f.push(0,w.y,0),f.push(0,w.y,0),f.push(n.x,n.y,n.z),Q.Ap.CrossToRef(c,E,U),U.normalize(),R.push(U.x,U.y,U.z,U.x,U.y,U.z),Q.Ap.CrossToRef(g,c,U),U.normalize(),R.push(U.x,U.y,U.z,U.x,U.y,U.z),v=H?J!==Z?j[Z+1].y:j[Z+1].w:j[Z+1].y+(j[Z+1].w-j[Z+1].y)*N,y.push(j[Z+1].x,u.e?1-v:v),y.push(j[Z+1].z,u.e?1-v:v),v=H?J!==Z?j[Z+2].y:j[Z+2].w:j[Z+2].y+(j[Z+2].w-j[Z+2].y)*N,y.push(j[Z+2].x,u.e?1-v:v),y.push(j[Z+2].z,u.e?1-v:v),K&&(x.push(K[Z+1].r,K[Z+1].g,K[Z+1].b,K[Z+1].a),x.push(K[Z+1].r,K[Z+1].g,K[Z+1].b,K[Z+1].a),x.push(K[Z+2].r,K[Z+2].g,K[Z+2].b,K[Z+2].a),x.push(K[Z+2].r,K[Z+2].g,K[Z+2].b,K[Z+2].a))),J!==Z&&(J=Z)}const z=1!==i&&F?T+4:T;for(d=0,Z=0;Z<O;Z++){let M=0,p=0,b=0,Q=0;for(V=0;V<T;V++)M=d*(z+1)+V,p=(d+1)*(z+1)+V,b=d*(z+1)+(V+1),Q=(d+1)*(z+1)+(V+1),S.push(M,p,b),S.push(Q,b,p);1!==i&&F&&(S.push(M+2,p+2,b+2),S.push(Q+2,b+2,p+2),S.push(M+4,p+4,b+4),S.push(Q+4,b+4,p+4)),d=H?d+2:d+1}const t=M=>{const q=M?b/2:B/2;if(0===q)return;let k,O,H;const F=M?j[D-1]:j[0];let o=null;K&&(o=M?K[D-1]:K[0]);const W=f.length/3,A=M?p/2:-p/2,a=new Q.Ap(0,A,0);f.push(a.x,a.y,a.z),R.push(0,M?1:-1,0);const s=F.y+.5*(F.w-F.y);y.push(F.x+.5*(F.z-F.x),u.e?1-s:s),o&&x.push(o.r,o.g,o.b,o.a);const P=new Q.Vector2(.5,.5);for(H=0;H<=T;H++){k=2*Math.PI*H*i/T;const p=Math.cos(-k),b=Math.sin(-k);O=new Q.Ap(p*q,A,b*q);const B=new Q.Vector2(p*P.x+.5,b*P.y+.5);f.push(O.x,O.y,O.z),R.push(0,M?1:-1,0);const W=F.y+(F.w-F.y)*B.y;y.push(F.x+(F.z-F.x)*B.x,u.e?1-W:W),o&&x.push(o.r,o.g,o.b,o.a)}for(H=0;H<T;H++)M?(S.push(W),S.push(W+(H+2)),S.push(W+(H+1))):(S.push(W),S.push(W+(H+1)),S.push(W+(H+2)))};W!==q.d.CAP_START&&W!==q.d.CAP_ALL||t(!1),W!==q.d.CAP_END&&W!==q.d.CAP_ALL||t(!0),k.e._ComputeSides(A,f,S,R,y,M.frontUVs,M.backUVs);const e=new k.e;return e.indices=S,e.xM=f,e.PM=R,e.NM=y,K&&(e.LM=x),e}function S(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const Q=new q.d(M,b);p.sideOrientation=q.d._GetDefaultSideOrientation(p.sideOrientation),Q._originalBuilderSideOrientation=p.sideOrientation;return s(p).YM(Q,p.updatable),Q}function f(M){const p=[],b=[],q=[],B=[],T=M.diameter||1,O=M.thickness||.5,H=0|(M.tessellation||16),F=0===M.sideOrientation?0:M.sideOrientation||k.e.DEFAULTSIDE,o=H+1;for(let k=0;k<=H;k++){const M=k/H,F=k*Math.PI*2/H-Math.PI/2,W=Q.Matrix.Translation(T/2,0,0).multiply(Q.Matrix.RotationY(F));for(let T=0;T<=H;T++){const F=1-T/H,i=T*Math.PI*2/H+Math.PI,A=Math.cos(i),j=Math.sin(i);let K=new Q.Ap(A,j,0),D=K.scale(O/2);const a=new Q.Vector2(M,F);D=Q.Ap.TransformCoordinates(D,W),K=Q.Ap.TransformNormal(K,W),b.push(D.x,D.y,D.z),q.push(K.x,K.y,K.z),B.push(a.x,u.e?1-a.y:a.y);const s=(k+1)%o,S=(T+1)%o;p.push(k*o+T),p.push(k*o+S),p.push(s*o+T),p.push(k*o+S),p.push(s*o+S),p.push(s*o+T)}}k.e._ComputeSides(F,b,p,q,B,M.frontUVs,M.backUVs);const W=new k.e;return W.indices=p,W.xM=b,W.PM=q,W.NM=B,W}function R(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const Q=new q.d(M,b);p.sideOrientation=q.d._GetDefaultSideOrientation(p.sideOrientation),Q._originalBuilderSideOrientation=p.sideOrientation;return f(p).YM(Q,p.updatable),Q}k.e.CreateCylinder=s,q.d.CreateCylinder=(M,p,b,Q,B,k,u,T,O)=>{void 0!==u&&u instanceof D.e||(void 0!==u&&(O=T||q.d.DEFAULTSIDE,T=u),u=k,k=1);return S(M,{height:p,diameterTop:b,diameterBottom:Q,tessellation:B,subdivisions:k,sideOrientation:O,updatable:T},u)};function y(M){const p=[],b=[],q=[],B=[],T=M.radius||2,O=M.tube||.5,H=M.radialSegments||32,F=M.tubularSegments||32,o=M.p||2,W=M.q||3,i=0===M.sideOrientation?0:M.sideOrientation||k.e.DEFAULTSIDE,A=M=>{const p=Math.cos(M),b=Math.sin(M),q=W/o*M,B=Math.cos(q),k=T*(2+B)*.5*p,u=T*(2+B)*b*.5,O=T*Math.sin(q)*.5;return new Q.Ap(k,u,O)};let j,K;for(j=0;j<=H;j++){const M=j%H/H*2*o*Math.PI,p=A(M),q=A(M+.01),k=q.jp(p);let T=q.add(p);const W=Q.Ap.Cross(k,T);for(T=Q.Ap.Cross(W,k),W.normalize(),T.normalize(),K=0;K<F;K++){const M=K%F/F*2*Math.PI,Q=-O*Math.cos(M),q=O*Math.sin(M);b.push(p.x+Q*T.x+q*W.x),b.push(p.y+Q*T.y+q*W.y),b.push(p.z+Q*T.z+q*W.z),B.push(j/H),B.push(u.e?1-K/F:K/F)}}for(j=0;j<H;j++)for(K=0;K<F;K++){const M=(K+1)%F,b=j*F+K,Q=(j+1)*F+K,q=(j+1)*F+M,B=j*F+M;p.push(B),p.push(Q),p.push(b),p.push(B),p.push(q),p.push(Q)}k.e.ComputeNormals(b,p,q),k.e._ComputeSides(i,b,p,q,B,M.frontUVs,M.backUVs);const D=new k.e;return D.indices=p,D.xM=b,D.PM=q,D.NM=B,D}function x(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const Q=new q.d(M,b);p.sideOrientation=q.d._GetDefaultSideOrientation(p.sideOrientation),Q._originalBuilderSideOrientation=p.sideOrientation;return y(p).YM(Q,p.updatable),Q}k.e.CreateTorus=f,q.d.CreateTorus=(M,p,b,Q,q,B,k)=>R(M,{diameter:p,thickness:b,tessellation:Q,sideOrientation:k,updatable:B},q);k.e.CreateTorusKnot=y,q.d.CreateTorusKnot=(M,p,b,Q,q,B,k,u,T,O)=>x(M,{radius:p,tube:b,radialSegments:Q,tubularSegments:q,p:B,q:k,sideOrientation:O,updatable:T},u);var P=b(13651),L=b(12364),N=b(12001);function r(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=p.path,B=p.shape,k=p.scale||1,u=p.rotation||0,T=0===p.cap?0:p.cap||q.d.NO_CAP,O=p.updatable,H=q.d._GetDefaultSideOrientation(p.sideOrientation),F=p.instance||null,o=p.invertUV||!1,W=p.closeShape||!1,i=p.closePath||!1,A=p.capFunction||null;return w(M,B,Q,k,u,null,null,i,W,T,!1,b,!!O,H,F,o,p.frontUVs||null,p.backUVs||null,p.firstNormal||null,!!p.adjustFrame,A)}function Y(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=p.path,B=p.shape,k=p.scaleFunction||(()=>1),u=p.rotationFunction||(()=>0),T=p.closePath||p.ribbonCloseArray||!1,O=p.closeShape||p.ribbonClosePath||!1,H=0===p.cap?0:p.cap||q.d.NO_CAP,F=p.updatable,o=p.firstNormal||null,W=p.adjustFrame||!1,i=q.d._GetDefaultSideOrientation(p.sideOrientation),A=p.instance,j=p.invertUV||!1,K=p.capFunction||null;return w(M,B,Q,null,null,k,u,T,O,H,!0,b,!!F,i,A||null,j,p.frontUVs||null,p.backUVs||null,o,W,K||null)}function w(M,p,b,B,k,u,T,H,F,o,W,i,A,j,K,D,a,s,S,f,R){const y=(M,p,b,B,k,u,T,O,H,F,o)=>{const W=b.getTangents(),i=b.getNormals(),A=b.getBinormals(),j=b.getDistances();if(o)for(let q=0;q<W.length;q++)if(0==W[q].x&&0==W[q].y&&0==W[q].z&&W[q].B(W[q-1]),0==i[q].x&&0==i[q].y&&0==i[q].z&&i[q].B(i[q-1]),0==A[q].x&&0==A[q].y&&0==A[q].z&&A[q].B(A[q-1]),q>0){let M=W[q-1];Q.Ap.Dot(M,W[q])<0&&W[q].scaleInPlace(-1),M=i[q-1],Q.Ap.Dot(M,i[q])<0&&i[q].scaleInPlace(-1),M=A[q-1],Q.Ap.Dot(M,A[q])<0&&A[q].scaleInPlace(-1)}let K=0;const D=F&&O?O:()=>null!==u?u:0,a=F&&T?T:()=>null!==k?k:1;let s=H===q.d.NO_CAP||H===q.d.CAP_END?0:2;const S=Q.TmpVectors.Matrix[0];for(let q=0;q<p.length;q++){const b=[],k=D(q,j[q]),u=a(q,j[q]);Q.Matrix.RotationAxisToRef(W[q],K,S);for(let B=0;B<M.length;B++){const k=W[q].scale(M[B].z).add(i[q].scale(M[B].x)).add(A[q].scale(M[B].y)),T=Q.Ap.Zero();Q.Ap.TransformCoordinatesToRef(k,S,T),T.scaleInPlace(u).addInPlace(p[q]),b[B]=T}B[s]=b,K+=k,s++}const f=R||(M=>{const p=Array(),b=Q.Ap.Zero();let q;for(q=0;q<M.length;q++)b.addInPlace(M[q]);for(b.scaleInPlace(1/M.length),q=0;q<M.length;q++)p.push(b);return p});switch(H){case q.d.NO_CAP:break;case q.d.CAP_START:B[0]=f(B[2]),B[1]=B[2];break;case q.d.CAP_END:B[s]=B[s-1],B[s+1]=f(B[s-1]);break;case q.d.CAP_ALL:B[0]=f(B[2]),B[1]=B[2],B[s]=B[s-1],B[s+1]=f(B[s-1])}return B};let x,P;if(K){const M=K._creationDataStorage;return x=S?M.path3D.update(b,S):M.path3D.update(b),P=y(p,b,M.path3D,M.pathArray,B,k,u,T,M.cap,W,f),K=O("",{pathArray:P,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:K},i||void 0)}x=S?new N.j(b,S):new N.j(b);P=y(p,b,x,new Array,B,k,u,T,o=o<0||o>3?0:o,W,f);const L=O(M,{pathArray:P,closeArray:H,closePath:F,updatable:A,sideOrientation:j,invertUV:D,frontUVs:a||void 0,backUVs:s||void 0},i);return L._creationDataStorage.pathArray=P,L._creationDataStorage.path3D=x,L._creationDataStorage.cap=o,L}function E(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=p.arc?p.arc<=0||p.arc>1?1:p.arc:1,k=void 0===p.closed||p.closed,u=p.shape,T=p.radius||1,H=p.tessellation||64,F=p.clip||0,o=p.updatable,W=q.d._GetDefaultSideOrientation(p.sideOrientation),i=p.cap||q.d.NO_CAP,A=2*Math.PI,j=[],K=p.invertUV||!1;let D=0,a=0;const s=A/H*B;let S,f;for(D=0;D<=H-F;D++){for(f=[],i!=q.d.CAP_START&&i!=q.d.CAP_ALL||(f.push(new Q.Ap(0,u[0].y,0)),f.push(new Q.Ap(Math.cos(D*s)*u[0].x*T,u[0].y,Math.sin(D*s)*u[0].x*T))),a=0;a<u.length;a++)S=new Q.Ap(Math.cos(D*s)*u[a].x*T,u[a].y,Math.sin(D*s)*u[a].x*T),f.push(S);i!=q.d.CAP_END&&i!=q.d.CAP_ALL||(f.push(new Q.Ap(Math.cos(D*s)*u[u.length-1].x*T,u[u.length-1].y,Math.sin(D*s)*u[u.length-1].x*T)),f.push(new Q.Ap(0,u[u.length-1].y,0))),j.push(f)}return O(M,{pathArray:j,closeArray:k,sideOrientation:W,updatable:o,invertUV:K,frontUVs:p.frontUVs,backUVs:p.backUVs},b)}q.d.ExtrudeShape=function(M,p,b,Q,B,k){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7?arguments[7]:void 0,O=arguments.length>8?arguments[8]:void 0,H=arguments.length>9?arguments[9]:void 0;return r(M,{shape:p,path:b,scale:Q,rotation:B,cap:0===k?0:k||q.d.NO_CAP,sideOrientation:O,instance:H,updatable:T},u)},q.d.ExtrudeShapeCustom=(M,p,b,Q,B,k,u,T,O,H,F,o)=>Y(M,{shape:p,path:b,scaleFunction:Q,rotationFunction:B,ribbonCloseArray:k,ribbonClosePath:u,cap:0===T?0:T||q.d.NO_CAP,sideOrientation:F,instance:o,updatable:H},O);q.d.CreateLathe=(M,p,b,Q,q,B,k)=>E(M,{shape:p,radius:b,tessellation:Q,sideOrientation:k,updatable:B},q);var n=b(13033),g=b(12981);function U(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=p.path;let k=p.instance,u=1;void 0!==p.radius?u=p.radius:k&&(u=k._creationDataStorage.radius);const T=p.tessellation||64,H=p.radiusFunction||null;let F=p.cap||q.d.NO_CAP;const o=p.invertUV||!1,W=p.updatable,i=q.d._GetDefaultSideOrientation(p.sideOrientation);p.arc=p.arc&&(p.arc<=0||p.arc>1)?1:p.arc||1;const A=(M,p,b,B,k,u,T,O)=>{const H=p.getTangents(),F=p.getNormals(),o=p.getDistances(),W=2*Math.PI/k*O,i=u||(()=>B);let A,j,K,D;const a=Q.TmpVectors.Matrix[0];let s=T===q.d.NO_CAP||T===q.d.CAP_END?0:2;for(let q=0;q<M.length;q++){j=i(q,o[q]),A=Array(),K=F[q];for(let p=0;p<k;p++)Q.Matrix.RotationAxisToRef(H[q],W*p,a),D=A[p]?A[p]:Q.Ap.Zero(),Q.Ap.TransformCoordinatesToRef(K,a,D),D.scaleInPlace(j).addInPlace(M[q]),A[p]=D;b[s]=A,s++}const S=(p,b)=>{const Q=Array();for(let q=0;q<p;q++)Q.push(M[b]);return Q};switch(T){case q.d.NO_CAP:break;case q.d.CAP_START:b[0]=S(k,0),b[1]=b[2].slice(0);break;case q.d.CAP_END:b[s]=b[s-1].slice(0),b[s+1]=S(k,M.length-1);break;case q.d.CAP_ALL:b[0]=S(k,0),b[1]=b[2].slice(0),b[s]=b[s-1].slice(0),b[s+1]=S(k,M.length-1)}return b};let j,K;if(k){const M=k._creationDataStorage,b=p.arc||M.arc;return j=M.path3D.update(B),K=A(B,j,M.pathArray,u,M.tessellation,H,M.cap,b),k=O("",{pathArray:K,instance:k}),M.path3D=j,M.pathArray=K,M.arc=b,M.radius=u,k}j=new N.j(B);F=F<0||F>3?0:F,K=A(B,j,new Array,u,T,H,F,p.arc);const D=O(M,{pathArray:K,closePath:!0,closeArray:!1,updatable:W,sideOrientation:i,invertUV:o,frontUVs:p.frontUVs,backUVs:p.backUVs},b);return D._creationDataStorage.pathArray=K,D._creationDataStorage.path3D=j,D._creationDataStorage.tessellation=T,D._creationDataStorage.cap=F,D._creationDataStorage.arc=p.arc,D._creationDataStorage.radius=u,D}function c(M){const p=[];p[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},p[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},p[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},p[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},p[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},p[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},p[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},p[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},p[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},p[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},p[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},p[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},p[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},p[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},p[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const b=M.type&&(M.type<0||M.type>=p.length)?0:M.type||0,q=M.size,B=M.sizeX||q||1,T=M.sizeY||q||1,O=M.sizeZ||q||1,H=M.custom||p[b],F=H.face.length,W=M.faceUV||new Array(F),i=M.faceColors,A=void 0===M.flat||M.flat,j=0===M.sideOrientation?0:M.sideOrientation||k.e.DEFAULTSIDE,K=[],D=[],a=[],s=[],S=[];let f=0,R=0;const y=[];let x,P,L,N,r,Y,w=0,E=0;if(A)for(E=0;E<F;E++)i&&void 0===i[E]&&(i[E]=new o.Sb(1,1,1,1)),W&&void 0===W[E]&&(W[E]=new Q.Vector4(0,0,1,1));if(A)for(E=0;E<F;E++){const M=H.face[E].length;for(L=2*Math.PI/M,N=.5*Math.tan(L/2),r=.5,w=0;w<M;w++)K.push(H.vertex[H.face[E][w]][0]*B,H.vertex[H.face[E][w]][1]*T,H.vertex[H.face[E][w]][2]*O),y.push(f),f++,x=W[E].x+(W[E].z-W[E].x)*(.5+N),P=W[E].y+(W[E].w-W[E].y)*(r-.5),s.push(x,u.e?1-P:P),Y=N*Math.cos(L)-r*Math.sin(L),r=N*Math.sin(L)+r*Math.cos(L),N=Y,i&&S.push(i[E].r,i[E].g,i[E].b,i[E].a);for(w=0;w<M-2;w++)D.push(y[0+R],y[w+2+R],y[w+1+R]);R+=M}else{for(w=0;w<H.vertex.length;w++)K.push(H.vertex[w][0]*B,H.vertex[w][1]*T,H.vertex[w][2]*O),s.push(0,u.e?1:0);for(E=0;E<F;E++)for(w=0;w<H.face[E].length-2;w++)D.push(H.face[E][0],H.face[E][w+2],H.face[E][w+1])}k.e.ComputeNormals(K,D,a),k.e._ComputeSides(j,K,D,a,s,M.frontUVs,M.backUVs);const n=new k.e;return n.xM=K,n.indices=D,n.PM=a,n.NM=s,i&&A&&(n.LM=S),n}function d(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new q.d(M,b);p.sideOrientation=q.d._GetDefaultSideOrientation(p.sideOrientation),Q._originalBuilderSideOrientation=p.sideOrientation;return c(p).YM(Q,p.updatable),Q}q.d.CreateTube=(M,p,b,Q,q,B,k,u,T,O)=>U(M,{path:p,radius:b,tessellation:Q,radiusFunction:q,arc:1,cap:B,updatable:u,sideOrientation:T,instance:O},k);function V(M){const p=M.sideOrientation||k.e.DEFAULTSIDE,b=M.radius||1,q=void 0===M.flat||M.flat,B=0|(M.subdivisions||4),T=M.radiusX||b,O=M.radiusY||b,H=M.radiusZ||b,F=(1+Math.sqrt(5))/2,o=[-1,F,-0,1,F,0,-1,-F,0,1,-F,0,0,-1,-F,0,1,-F,0,-1,F,0,1,F,F,0,1,F,0,-1,-F,0,1,-F,0,-1],W=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],i=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],A=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],j=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],K=[],D=[],a=[],s=[];let S=0;const f=new Array(3),R=new Array(3);let y;for(y=0;y<3;y++)f[y]=Q.Ap.Zero(),R[y]=Q.Vector2.Zero();for(let k=0;k<20;k++){for(y=0;y<3;y++){const M=W[3*k+y];f[y].Db(o[3*i[M]],o[3*i[M]+1],o[3*i[M]+2]),f[y].normalize(),R[y].Db(.134765625*A[2*M]+.05859375+-.0390625*j[k],.2333984375*A[2*M+1]+.025390625+.01953125*j[k])}const M=(M,p,b,k)=>{const F=Q.Ap.Lerp(f[0],f[2],p/B),o=Q.Ap.Lerp(f[1],f[2],p/B),W=B===p?f[2]:Q.Ap.Lerp(F,o,M/(B-p));let i;if(W.normalize(),q){const M=Q.Ap.Lerp(f[0],f[2],k/B),p=Q.Ap.Lerp(f[1],f[2],k/B);i=Q.Ap.Lerp(M,p,b/(B-k))}else i=new Q.Ap(W.x,W.y,W.z);i.x/=T,i.y/=O,i.z/=H,i.normalize();const A=Q.Vector2.Lerp(R[0],R[2],p/B),j=Q.Vector2.Lerp(R[1],R[2],p/B),y=B===p?R[2]:Q.Vector2.Lerp(A,j,M/(B-p));D.push(W.x*T,W.y*O,W.z*H),a.push(i.x,i.y,i.z),s.push(y.x,u.e?1-y.y:y.y),K.push(S),S++};for(let p=0;p<B;p++)for(let b=0;b+p<B;b++)M(b,p,b+1/3,p+1/3),M(b+1,p,b+1/3,p+1/3),M(b,p+1,b+1/3,p+1/3),b+p+1<B&&(M(b+1,p,b+2/3,p+2/3),M(b+1,p+1,b+2/3,p+2/3),M(b,p+1,b+2/3,p+2/3))}k.e._ComputeSides(p,D,K,a,s,M.frontUVs,M.backUVs);const x=new k.e;return x.indices=K,x.xM=D,x.PM=a,x.NM=s,x}function h(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new q.d(M,b);p.sideOrientation=q.d._GetDefaultSideOrientation(p.sideOrientation),Q._originalBuilderSideOrientation=p.sideOrientation;return V(p).YM(Q,p.updatable),Q}k.e.CreatePolyhedron=c,q.d.CreatePolyhedron=(M,p,b)=>d(M,p,b);k.e.CreateIcoSphere=V,q.d.CreateIcoSphere=(M,p,b)=>h(M,p,b);var I=b(11806);const Z=new Q.Ap(1,0,0),J=new Q.Ap(-1,0,0),v=new Q.Ap(0,1,0),z=new Q.Ap(0,-1,0),t=new Q.Ap(0,0,1),e=new Q.Ap(0,0,-1);class G{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q.Ap.Zero(),p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q.Ap.Up(),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.Vector2.Zero(),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,T=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=M,this.normal=p,this.uv=b,this.vertexIdx=q,this.vertexIdxForBones=B,this.localPositionOverride=k,this.localNormalOverride=u,this.matrixIndicesOverride=T,this.matrixWeightsOverride=O}clone(){var M,p,b,Q;return new G(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(M=this.localPositionOverride)||void 0===M?void 0:M.slice(),null===(p=this.localNormalOverride)||void 0===p?void 0:p.slice(),null===(b=this.matrixIndicesOverride)||void 0===b?void 0:b.slice(),null===(Q=this.matrixWeightsOverride)||void 0===Q?void 0:Q.slice())}}function mM(M,p,b){var T,O,H,F,o;const W=!!p.skeleton,i=!(null===(T=p.morphTargetManager)||void 0===T||!T.numTargets),A=b.localMode||W,j=p.jb(),K=W||i?p.tu(!0,!0):p.getVerticesData(B.f.PositionKind),D=W||i?p.getNormalsData(!0,!0):p.getVerticesData(B.f.NormalKind),a=A?W?p.getVerticesData(B.f.PositionKind):K:null,s=A?W?p.getVerticesData(B.f.NormalKind):D:null,S=p.getVerticesData(B.f.UVKind),f=W?p.getVerticesData(B.f.MatricesIndicesKind):null,R=W?p.getVerticesData(B.f.MatricesWeightsKind):null,y=W?p.getVerticesData(B.f.MatricesIndicesExtraKind):null,x=W?p.getVerticesData(B.f.MatricesWeightsExtraKind):null,P=b.position||Q.Ap.Zero();let L=b.normal||Q.Ap.Up();const N=b.size||Q.Ap.One(),r=b.angle||0;if(!L){const M=new Q.Ap(0,0,1),b=p.RM().activeCamera,q=Q.Ap.TransformCoordinates(M,b.getWorldMatrix());L=b.globalPosition.jp(q)}const Y=-Math.atan2(L.z,L.x)-Math.PI/2,w=Math.sqrt(L.x*L.x+L.z*L.z),E=Math.atan2(L.y,w),n=new k.e;n.indices=[],n.xM=[],n.PM=[],n.NM=[],n.matricesIndices=W?[]:null,n.matricesWeights=W?[]:null,n.matricesIndicesExtra=y?[]:null,n.matricesWeightsExtra=x?[]:null;let g=0;const U=(M,p)=>{const q=new G;if(!j||!K||!D)return q;const B=j[M];if(q.vertexIdx=3*B,q.vertexIdxForBones=4*B,q.position=new Q.Ap(K[3*B],K[3*B+1],K[3*B+2]),Q.Ap.TransformCoordinatesToRef(q.position,p,q.position),q.normal=new Q.Ap(D[3*B],D[3*B+1],D[3*B+2]),Q.Ap.TransformNormalToRef(q.normal,p,q.normal),b.captureUVS&&S){const M=S[2*B+1];q.uv=new Q.Vector2(S[2*B],u.e?1-M:M)}return q},c=[0,0,0,0],d=(M,p)=>{if(0===M.length)return M;const b=.5*Math.abs(Q.Ap.Dot(N,p)),q=(M,p,b,Q)=>{for(let q=0;q<Q;++q)if(M[b+q]===p)return b+q;return-1},B=(M,B)=>{const k=Q.Ap.GetClipFactor(M.position,B.position,p,b);let u=c,T=c;if(f&&R){const p=M.matrixIndicesOverride?0:M.vertexIdxForBones,b=M.matrixIndicesOverride??f,Q=M.matrixWeightsOverride??R,O=B.matrixIndicesOverride?0:B.vertexIdxForBones,H=B.matrixIndicesOverride??f,F=B.matrixWeightsOverride??R;u=[0,0,0,0],T=[0,0,0,0];let o=0;for(let M=0;M<4;++M)if(Q[p+M]>0){const B=q(H,b[p+M],O,4);u[o]=b[p+M],T[o]=(0,I.Lerp)(Q[p+M],B>=0?F[B]:0,k),o++}for(let M=0;M<4&&o<4;++M){const Q=H[O+M];-1===q(b,Q,p,4)&&(u[o]=Q,T[o]=(0,I.Lerp)(0,F[O+M],k),o++)}const W=T[0]+T[1]+T[2]+T[3];T[0]/=W,T[1]/=W,T[2]/=W,T[3]/=W}const O=M.localPositionOverride?M.localPositionOverride[0]:(null===a||void 0===a?void 0:a[M.vertexIdx])??0,H=M.localPositionOverride?M.localPositionOverride[1]:(null===a||void 0===a?void 0:a[M.vertexIdx+1])??0,F=M.localPositionOverride?M.localPositionOverride[2]:(null===a||void 0===a?void 0:a[M.vertexIdx+2])??0,o=B.localPositionOverride?B.localPositionOverride[0]:(null===a||void 0===a?void 0:a[B.vertexIdx])??0,W=B.localPositionOverride?B.localPositionOverride[1]:(null===a||void 0===a?void 0:a[B.vertexIdx+1])??0,i=B.localPositionOverride?B.localPositionOverride[2]:(null===a||void 0===a?void 0:a[B.vertexIdx+2])??0,A=M.localNormalOverride?M.localNormalOverride[0]:(null===s||void 0===s?void 0:s[M.vertexIdx])??0,j=M.localNormalOverride?M.localNormalOverride[1]:(null===s||void 0===s?void 0:s[M.vertexIdx+1])??0,K=M.localNormalOverride?M.localNormalOverride[2]:(null===s||void 0===s?void 0:s[M.vertexIdx+2])??0,D=A+((B.localNormalOverride?B.localNormalOverride[0]:(null===s||void 0===s?void 0:s[B.vertexIdx])??0)-A)*k,S=j+((B.localNormalOverride?B.localNormalOverride[1]:(null===s||void 0===s?void 0:s[B.vertexIdx+1])??0)-j)*k,y=K+((B.localNormalOverride?B.localNormalOverride[2]:(null===s||void 0===s?void 0:s[B.vertexIdx+2])??0)-K)*k,x=Math.sqrt(D*D+S*S+y*y);return new G(Q.Ap.Lerp(M.position,B.position,k),Q.Ap.Lerp(M.normal,B.normal,k).normalize(),Q.Vector2.Lerp(M.uv,B.uv,k),-1,-1,a?[O+(o-O)*k,H+(W-H)*k,F+(i-F)*k]:null,s?[D/x,S/x,y/x]:null,u,T)};let k=null;M.length>3&&(k=[]);for(let u=0;u<M.length;u+=3){let q=0,T=null,O=null,H=null,F=null;const o=Q.Ap.Dot(M[u].position,p)-b>0,W=Q.Ap.Dot(M[u+1].position,p)-b>0,i=Q.Ap.Dot(M[u+2].position,p)-b>0;switch(q=(o?1:0)+(W?1:0)+(i?1:0),q){case 0:M.length>3?(k.push(M[u]),k.push(M[u+1]),k.push(M[u+2])):k=M;break;case 1:if(k=k??new Array,o&&(T=M[u+1],O=M[u+2],H=B(M[u],T),F=B(M[u],O)),W){T=M[u],O=M[u+2],H=B(M[u+1],T),F=B(M[u+1],O),k.push(H),k.push(O.clone()),k.push(T.clone()),k.push(O.clone()),k.push(H.clone()),k.push(F);break}i&&(T=M[u],O=M[u+1],H=B(M[u+2],T),F=B(M[u+2],O)),T&&O&&H&&F&&(k.push(T.clone()),k.push(O.clone()),k.push(H),k.push(F),k.push(H.clone()),k.push(O.clone()));break;case 2:k=k??new Array,o||(T=M[u].clone(),O=B(T,M[u+1]),H=B(T,M[u+2]),k.push(T),k.push(O),k.push(H)),W||(T=M[u+1].clone(),O=B(T,M[u+2]),H=B(T,M[u]),k.push(T),k.push(O),k.push(H)),i||(T=M[u+2].clone(),O=B(T,M[u]),H=B(T,M[u+1]),k.push(T),k.push(O),k.push(H))}}return k},V=p instanceof q.d?p:null,h=null===V||void 0===V?void 0:V._thinInstanceDataStorage.matrixData,mM=(null===V||void 0===V?void 0:V.Rb)||1,C=Q.TmpVectors.Matrix[0];C.B(Q.Matrix.IdentityReadOnly);for(let q=0;q<mM;++q){if(null!==V&&void 0!==V&&V.hasThinInstances&&h){const M=16*q;C.setRowFromFloats(0,h[M+0],h[M+1],h[M+2],h[M+3]),C.setRowFromFloats(1,h[M+4],h[M+5],h[M+6],h[M+7]),C.setRowFromFloats(2,h[M+8],h[M+9],h[M+10],h[M+11]),C.setRowFromFloats(3,h[M+12],h[M+13],h[M+14],h[M+15])}const M=Q.Matrix.RotationYawPitchRoll(Y,E,r).multiply(Q.Matrix.Translation(P.x,P.y,P.z)),B=Q.Matrix.Invert(M),k=p.getWorldMatrix(),T=C.multiply(k).multiply(B),O=new Array(3);for(let p=0;p<j.length;p+=3){let M=O;if(M[0]=U(p,T),M[1]=U(p+1,T),M[2]=U(p+2,T),!(b.cullBackFaces&&-M[0].normal.z<=0&&-M[1].normal.z<=0&&-M[2].normal.z<=0)&&(M=d(M,Z),M&&(M=d(M,J),M&&(M=d(M,v),M&&(M=d(M,z),M&&(M=d(M,t),M&&(M=d(M,e),M)))))))for(let p=0;p<M.length;p++){const Q=M[p];if(n.indices.push(g),A?(Q.localPositionOverride?(n.xM[3*g]=Q.localPositionOverride[0],n.xM[3*g+1]=Q.localPositionOverride[1],n.xM[3*g+2]=Q.localPositionOverride[2]):a&&(n.xM[3*g]=a[Q.vertexIdx],n.xM[3*g+1]=a[Q.vertexIdx+1],n.xM[3*g+2]=a[Q.vertexIdx+2]),Q.localNormalOverride?(n.PM[3*g]=Q.localNormalOverride[0],n.PM[3*g+1]=Q.localNormalOverride[1],n.PM[3*g+2]=Q.localNormalOverride[2]):s&&(n.PM[3*g]=s[Q.vertexIdx],n.PM[3*g+1]=s[Q.vertexIdx+1],n.PM[3*g+2]=s[Q.vertexIdx+2])):(Q.position.toArray(n.xM,3*g),Q.normal.toArray(n.PM,3*g)),n.matricesIndices&&n.matricesWeights&&(Q.matrixIndicesOverride?(n.matricesIndices[4*g]=Q.matrixIndicesOverride[0],n.matricesIndices[4*g+1]=Q.matrixIndicesOverride[1],n.matricesIndices[4*g+2]=Q.matrixIndicesOverride[2],n.matricesIndices[4*g+3]=Q.matrixIndicesOverride[3]):(f&&(n.matricesIndices[4*g]=f[Q.vertexIdxForBones],n.matricesIndices[4*g+1]=f[Q.vertexIdxForBones+1],n.matricesIndices[4*g+2]=f[Q.vertexIdxForBones+2],n.matricesIndices[4*g+3]=f[Q.vertexIdxForBones+3]),y&&n.matricesIndicesExtra&&(n.matricesIndicesExtra[4*g]=y[Q.vertexIdxForBones],n.matricesIndicesExtra[4*g+1]=y[Q.vertexIdxForBones+1],n.matricesIndicesExtra[4*g+2]=y[Q.vertexIdxForBones+2],n.matricesIndicesExtra[4*g+3]=y[Q.vertexIdxForBones+3])),Q.matrixWeightsOverride?(n.matricesWeights[4*g]=Q.matrixWeightsOverride[0],n.matricesWeights[4*g+1]=Q.matrixWeightsOverride[1],n.matricesWeights[4*g+2]=Q.matrixWeightsOverride[2],n.matricesWeights[4*g+3]=Q.matrixWeightsOverride[3]):(R&&(n.matricesWeights[4*g]=R[Q.vertexIdxForBones],n.matricesWeights[4*g+1]=R[Q.vertexIdxForBones+1],n.matricesWeights[4*g+2]=R[Q.vertexIdxForBones+2],n.matricesWeights[4*g+3]=R[Q.vertexIdxForBones+3]),x&&n.matricesWeightsExtra&&(n.matricesWeightsExtra[4*g]=x[Q.vertexIdxForBones],n.matricesWeightsExtra[4*g+1]=x[Q.vertexIdxForBones+1],n.matricesWeightsExtra[4*g+2]=x[Q.vertexIdxForBones+2],n.matricesWeightsExtra[4*g+3]=x[Q.vertexIdxForBones+3]))),b.captureUVS)Q.uv.toArray(n.NM,2*g);else{n.NM.push(.5+Q.position.x/N.x);const M=.5+Q.position.y/N.y;n.NM.push(u.e?1-M:M)}g++}}}0===n.indices.length&&(n.indices=null),0===n.xM.length&&(n.xM=null),0===n.PM.length&&(n.PM=null),0===n.NM.length&&(n.NM=null),0===(null===(O=n.matricesIndices)||void 0===O?void 0:O.length)&&(n.matricesIndices=null),0===(null===(H=n.matricesWeights)||void 0===H?void 0:H.length)&&(n.matricesWeights=null),0===(null===(F=n.matricesIndicesExtra)||void 0===F?void 0:F.length)&&(n.matricesIndicesExtra=null),0===(null===(o=n.matricesWeightsExtra)||void 0===o?void 0:o.length)&&(n.matricesWeightsExtra=null);const X=new q.d(M,p.RM());return n.YM(X),A?(X.skeleton=p.skeleton,X.parent=p):(X.position=P.clone(),X.rotation=new Q.Ap(E,Y,r)),X.ib(!0),X.refreshBoundingInfo(!0,!0),X}function C(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const p=0|Math.max(M.subdivisions?M.subdivisions:2,1),b=0|Math.max(M.tessellation?M.tessellation:16,3),q=Math.max(M.height?M.height:1,0),B=Math.max(M.radius?M.radius:.25,0),T=0|Math.max(M.capSubdivisions?M.capSubdivisions:6,1),O=b,H=p,F=Math.max(M.radiusTop?M.radiusTop:B,0),o=Math.max(M.radiusBottom?M.radiusBottom:B,0),W=q-(F+o),i=2*Math.PI,A=Math.max(M.topCapSubdivisions?M.topCapSubdivisions:T,1),j=Math.max(M.bottomCapSubdivisions?M.bottomCapSubdivisions:T,1),K=Math.acos((o-F)/q);let D=[];const a=[],s=[],S=[];let f=0;const R=[],y=.5*W,x=.5*Math.PI;let P,L;const N=Q.Ap.Zero(),r=Q.Ap.Zero(),Y=Math.cos(K),w=Math.sin(K),E=new Q.Vector2(F*w,y+F*Y).jp(new Q.Vector2(o*w,o*Y-y)).length(),n=F*K+E+o*(x-K);let g=0;for(L=0;L<=A;L++){const M=[],p=x-K*(L/A);g+=F*K/A;const b=Math.cos(p),Q=Math.sin(p),q=b*F;for(P=0;P<=O;P++){const p=P/O,B=p*i+0,k=Math.sin(B),T=Math.cos(B);r.x=q*k,r.y=y+Q*F,r.z=q*T,a.push(r.x,r.y,r.z),N.set(b*k,Q,b*T),s.push(N.x,N.y,N.z),S.push(p,u.e?g/n:1-g/n),M.push(f),f++}R.push(M)}const U=q-F-o+Y*F-Y*o,c=w*(o-F)/U;for(L=1;L<=H;L++){const M=[];g+=E/H;const p=w*(L*(o-F)/H+F);for(P=0;P<=O;P++){const b=P/O,Q=b*i+0,q=Math.sin(Q),B=Math.cos(Q);r.x=p*q,r.y=y+Y*F-L*U/H,r.z=p*B,a.push(r.x,r.y,r.z),N.set(q,c,B).normalize(),s.push(N.x,N.y,N.z),S.push(b,u.e?g/n:1-g/n),M.push(f),f++}R.push(M)}for(L=1;L<=j;L++){const M=[],p=x-K-(Math.PI-K)*(L/j);g+=o*K/j;const b=Math.cos(p),Q=Math.sin(p),q=b*o;for(P=0;P<=O;P++){const p=P/O,B=p*i+0,k=Math.sin(B),T=Math.cos(B);r.x=q*k,r.y=Q*o-y,r.z=q*T,a.push(r.x,r.y,r.z),N.set(b*k,Q,b*T),s.push(N.x,N.y,N.z),S.push(p,u.e?g/n:1-g/n),M.push(f),f++}R.push(M)}for(P=0;P<O;P++)for(L=0;L<A+H+j;L++){const M=R[L][P],p=R[L+1][P],b=R[L+1][P+1],Q=R[L][P+1];D.push(M),D.push(p),D.push(Q),D.push(p),D.push(b),D.push(Q)}if(D=D.reverse(),M.orientation&&!M.orientation.equals(Q.Ap.Up())){const p=new Q.Matrix;M.orientation.clone().scale(.5*Math.PI).cross(Q.Ap.Up()).toQuaternion().toRotationMatrix(p);const b=Q.Ap.Zero();for(let M=0;M<a.length;M+=3)b.set(a[M],a[M+1],a[M+2]),Q.Ap.TransformCoordinatesToRef(b.clone(),p,b),a[M]=b.x,a[M+1]=b.y,a[M+2]=b.z}const d=new k.e;return d.xM=a,d.PM=s,d.NM=S,d.indices=D,d}function X(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:Q.Ap.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new q.d(M,b);return C(p).YM(B,p.updatable),B}q.d.CreateDecal=(M,p,b,Q,q,B)=>mM(M,p,{position:b,normal:Q,size:q,angle:B});q.d.CreateCapsule=(M,p,b)=>X(M,p,b),k.e.CreateCapsule=C;var l=b(11637),MM=b(11798);class pM{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=M,this.y=p,M!==Math.floor(M)&&(M=Math.floor(M),l.c.Warn("x is not an integer, floor(x) used")),p!==Math.floor(p)&&(p=Math.floor(p),l.c.Warn("y is not an integer, floor(y) used"))}clone(){return new pM(this.x,this.y)}rotate60About(M){const p=this.x;return this.x=M.x+M.y-this.y,this.y=p+this.y-M.x,this}rotateNeg60About(M){const p=this.x;return this.x=p+this.y-M.y,this.y=M.x+M.y-p,this}rotate120(M,p){M!==Math.floor(M)&&(M=Math.floor(M),l.c.Warn("m not an integer only floor(m) used")),p!==Math.floor(p)&&(p=Math.floor(p),l.c.Warn("n not an integer only floor(n) used"));const b=this.x;return this.x=M-b-this.y,this.y=p+b,this}rotateNeg120(M,p){M!==Math.floor(M)&&(M=Math.floor(M),l.c.Warn("m is not an integer, floor(m) used")),p!==Math.floor(p)&&(p=Math.floor(p),l.c.Warn("n is not an integer,   floor(n) used"));const b=this.x;return this.x=this.y-p,this.y=M+p-b-this.y,this}toCartesianOrigin(M,p){const b=Q.Ap.Zero();return b.x=M.x+2*this.x*p+this.y*p,b.y=M.y+Math.sqrt(3)*this.y*p,b}static Zero(){return new pM(0,0)}}class bM{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new QM("icosahedron","Regular",[[0,MM.f,-1],[-MM.f,1,0],[-1,0,-MM.f],[1,0,-MM.f],[MM.f,1,0],[0,MM.f,1],[-1,0,MM.f],[-MM.f,-1,0],[0,-MM.f,-1],[MM.f,-1,0],[1,0,MM.f],[0,-MM.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let M=12;const p={},b=this.m,Q=this.n;let q,B,k,u,T,O=b,H=1,F=0;0!==Q&&(O=(0,I.HighestCommonFactor)(b,Q)),H=b/O,F=Q/O;const o=pM.Zero(),W=new pM(b,Q),i=new pM(-Q,b+Q),A=pM.Zero(),j=pM.Zero(),K=pM.Zero();let D,a,s,S,f=[];const R=[],y=this.vertByDist,x=(b,Q,q,B)=>{D=b+"|"+q,a=Q+"|"+B,D in p||a in p?D in p&&!(a in p)?p[a]=p[D]:a in p&&!(D in p)&&(p[D]=p[a]):(p[D]=M,p[a]=M,M++),y[q][0]>2?R[p[D]]=[-y[q][0],y[q][1],p[D]]:R[p[D]]=[f[y[q][0]],y[q][1],p[D]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let P=0;P<20;P++){if(f=this.IDATA.face[P],k=f[2],u=f[1],T=f[0],s=o.x+"|"+o.y,D=P+"|"+s,D in p||(p[D]=k,R[k]=[f[y[s][0]],y[s][1]]),s=W.x+"|"+W.y,D=P+"|"+s,D in p||(p[D]=u,R[u]=[f[y[s][0]],y[s][1]]),s=i.x+"|"+i.y,D=P+"|"+s,D in p||(p[D]=T,R[T]=[f[y[s][0]],y[s][1]]),q=this.IDATA.edgematch[P][0],B=this.IDATA.edgematch[P][1],"B"===B)for(let M=1;M<O;M++)j.x=b-M*(H+F),j.y=Q+M*H,K.x=-M*F,K.y=M*(H+F),s=j.x+"|"+j.y,S=K.x+"|"+K.y,x(P,q,s,S);if("O"===B)for(let M=1;M<O;M++)K.x=-M*F,K.y=M*(H+F),A.x=M*H,A.y=M*F,s=K.x+"|"+K.y,S=A.x+"|"+A.y,x(P,q,s,S);if(q=this.IDATA.edgematch[P][2],B=this.IDATA.edgematch[P][3],B&&"A"===B)for(let M=1;M<O;M++)A.x=M*H,A.y=M*F,j.x=b-(O-M)*(H+F),j.y=Q+(O-M)*H,s=A.x+"|"+A.y,S=j.x+"|"+j.y,x(P,q,s,S);for(let b=0;b<this.vertices.length;b++)s=this.vertices[b].x+"|"+this.vertices[b].y,D=P+"|"+s,D in p||(p[D]=M++,y[s][0]>2?R[p[D]]=[-y[s][0],y[s][1],p[D]]:R[p[D]]=[f[y[s][0]],y[s][1],p[D]])}this.closestTo=R,this.vecToidx=p}calcCoeffs(){const M=this.m,p=this.n,b=Math.sqrt(3)/3,Q=M*M+p*p+M*p;this.coau=(M+p)/Q,this.cobu=-p/Q,this.coav=-b*(M-p)/Q,this.cobv=b*(2*M+p)/Q}createInnerFacets(){const M=this.m,p=this.n;for(let b=0;b<p+M+1;b++)for(let M=this.min[b];M<this.max[b]+1;M++)M<this.max[b]&&M<this.max[b+1]+1&&this.innerFacets.push(["|"+M+"|"+b,"|"+M+"|"+(b+1),"|"+(M+1)+"|"+b]),b>0&&M<this.max[b-1]&&M+1<this.max[b]+1&&this.innerFacets.push(["|"+M+"|"+b,"|"+(M+1)+"|"+b,"|"+(M+1)+"|"+(b-1)])}edgeVecsABOB(){const M=this.m,p=this.n,b=new pM(-p,M+p);for(let Q=1;Q<M+p;Q++){const M=new pM(this.min[Q],Q),p=new pM(this.min[Q-1],Q-1),q=new pM(this.min[Q+1],Q+1),B=M.clone(),k=p.clone(),u=q.clone();B.rotate60About(b),k.rotate60About(b),u.rotate60About(b);const T=new pM(this.max[B.y],B.y),O=new pM(this.max[B.y-1],B.y-1),H=new pM(this.max[B.y-1]-1,B.y-1);B.x===T.x&&B.y===T.y||(B.x!==O.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,O,H]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,H,T])):B.y===u.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([M,p,O]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([M,O,q])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([M,p,O]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,O,T])))}}mapABOBtoOBOA(){const M=new pM(0,0);for(let p=0;p<this.isoVecsABOB.length;p++){const b=[];for(let Q=0;Q<3;Q++)M.x=this.isoVecsABOB[p][Q].x,M.y=this.isoVecsABOB[p][Q].y,0===this.vertexTypes[p][Q]&&M.rotateNeg120(this.m,this.n),b.push(M.clone());this.isoVecsOBOA.push(b)}}mapABOBtoBAOA(){const M=new pM(0,0);for(let p=0;p<this.isoVecsABOB.length;p++){const b=[];for(let Q=0;Q<3;Q++)M.x=this.isoVecsABOB[p][Q].x,M.y=this.isoVecsABOB[p][Q].y,1===this.vertexTypes[p][Q]&&M.rotate120(this.m,this.n),b.push(M.clone());this.isoVecsBAOA.push(b)}}MapToFace(M,p){const b=this.IDATA.face[M],q=b[2],B=b[1],k=b[0],u=Q.Ap.sp(this.IDATA.vertex[q]),T=Q.Ap.sp(this.IDATA.vertex[B]),O=Q.Ap.sp(this.IDATA.vertex[k]),H=T.jp(u),F=O.jp(u),o=H.scale(this.coau).add(F.scale(this.cobu)),W=H.scale(this.coav).add(F.scale(this.cobv)),i=[];let A,j=Q.TmpVectors.Ap[0];for(let Q=0;Q<this.cartesian.length;Q++)j=o.scale(this.cartesian[Q].x).add(W.scale(this.cartesian[Q].y)).add(u),i[Q]=[j.x,j.y,j.z],A=M+"|"+this.vertices[Q].x+"|"+this.vertices[Q].y,p.vertex[this.vecToidx[A]]=[j.x,j.y,j.z]}build(M,p){const b=[],Q=pM.Zero(),q=new pM(M,p),B=new pM(-p,M+p);b.push(Q,q,B);for(let s=p;s<M+1;s++)for(let p=0;p<M+1-s;p++)b.push(new pM(p,s));if(p>0){const Q=(0,I.HighestCommonFactor)(M,p),q=M/Q,B=p/Q;for(let u=1;u<Q;u++)b.push(new pM(u*q,u*B)),b.push(new pM(-u*B,u*(q+B))),b.push(new pM(M-u*(q+B),p+u*q));const k=M/p;for(let u=1;u<p;u++)for(let Q=0;Q<u*k;Q++)b.push(new pM(Q,u)),b.push(new pM(Q,u).rotate120(M,p)),b.push(new pM(Q,u).rotateNeg120(M,p))}b.sort(((M,p)=>M.x-p.x)),b.sort(((M,p)=>M.y-p.y));const k=new Array(M+p+1),u=new Array(M+p+1);for(let s=0;s<k.length;s++)k[s]=1/0,u[s]=-1/0;let T=0,O=0;const H=b.length;for(let s=0;s<H;s++)O=b[s].x,T=b[s].y,k[T]=Math.min(O,k[T]),u[T]=Math.max(O,u[T]);const F=(b,Q)=>{const q=b.clone();return"A"===Q&&q.rotateNeg120(M,p),"B"===Q&&q.rotate120(M,p),q.x<0?q.y:q.x+q.y},o=[],W=[],i=[],A=[],j={},K=[];let D=-1,a=-1;for(let s=0;s<H;s++)o[s]=b[s].toCartesianOrigin(new pM(0,0),.5),W[s]=F(b[s],"O"),i[s]=F(b[s],"A"),A[s]=F(b[s],"B"),W[s]===i[s]&&i[s]===A[s]?(D=3,a=W[s]):W[s]===i[s]?(D=4,a=W[s]):i[s]===A[s]?(D=5,a=i[s]):A[s]===W[s]&&(D=6,a=W[s]),W[s]<i[s]&&W[s]<A[s]&&(D=2,a=W[s]),i[s]<W[s]&&i[s]<A[s]&&(D=1,a=i[s]),A[s]<i[s]&&A[s]<W[s]&&(D=0,a=A[s]),K.push([D,a,b[s].x,b[s].y]);K.sort(((M,p)=>M[2]-p[2])),K.sort(((M,p)=>M[3]-p[3])),K.sort(((M,p)=>M[1]-p[1])),K.sort(((M,p)=>M[0]-p[0]));for(let s=0;s<K.length;s++)j[K[s][2]+"|"+K[s][3]]=[K[s][0],K[s][1],s];return this.m=M,this.n=p,this.vertices=b,this.vertByDist=j,this.cartesian=o,this.min=k,this.max=u,this}}class QM{constructor(M,p,b,Q){this.name=M,this.category=p,this.vertex=b,this.face=Q}}class qM extends QM{innerToData(M,p){for(let b=0;b<p.innerFacets.length;b++)this.face.push(p.innerFacets[b].map((b=>p.vecToidx[M+b])))}mapABOBtoDATA(M,p){const b=p.IDATA.edgematch[M][0];for(let Q=0;Q<p.isoVecsABOB.length;Q++){const q=[];for(let B=0;B<3;B++)0===p.vertexTypes[Q][B]?q.push(M+"|"+p.isoVecsABOB[Q][B].x+"|"+p.isoVecsABOB[Q][B].y):q.push(b+"|"+p.isoVecsABOB[Q][B].x+"|"+p.isoVecsABOB[Q][B].y);this.face.push([p.vecToidx[q[0]],p.vecToidx[q[1]],p.vecToidx[q[2]]])}}mapOBOAtoDATA(M,p){const b=p.IDATA.edgematch[M][0];for(let Q=0;Q<p.isoVecsOBOA.length;Q++){const q=[];for(let B=0;B<3;B++)1===p.vertexTypes[Q][B]?q.push(M+"|"+p.isoVecsOBOA[Q][B].x+"|"+p.isoVecsOBOA[Q][B].y):q.push(b+"|"+p.isoVecsOBOA[Q][B].x+"|"+p.isoVecsOBOA[Q][B].y);this.face.push([p.vecToidx[q[0]],p.vecToidx[q[1]],p.vecToidx[q[2]]])}}mapBAOAtoDATA(M,p){const b=p.IDATA.edgematch[M][2];for(let Q=0;Q<p.isoVecsBAOA.length;Q++){const q=[];for(let B=0;B<3;B++)1===p.vertexTypes[Q][B]?q.push(M+"|"+p.isoVecsBAOA[Q][B].x+"|"+p.isoVecsBAOA[Q][B].y):q.push(b+"|"+p.isoVecsBAOA[Q][B].x+"|"+p.isoVecsBAOA[Q][B].y);this.face.push([p.vecToidx[q[0]],p.vecToidx[q[1]],p.vecToidx[q[2]]])}}orderData(M){const p=[];for(let B=0;B<13;B++)p[B]=[];const b=M.closestTo;for(let B=0;B<b.length;B++)b[B][0]>-1?b[B][1]>0&&p[b[B][0]].push([B,b[B][1]]):p[12].push([B,b[B][0]]);const Q=[];for(let B=0;B<12;B++)Q[B]=B;let q=12;for(let B=0;B<12;B++){p[B].sort(((M,p)=>M[1]-p[1]));for(let M=0;M<p[B].length;M++)Q[p[B][M][0]]=q++}for(let B=0;B<p[12].length;B++)Q[p[12][B][0]]=q++;for(let B=0;B<this.vertex.length;B++)this.vertex[B].push(Q[B]);this.vertex.sort(((M,p)=>M[3]-p[3]));for(let B=0;B<this.vertex.length;B++)this.vertex[B].pop();for(let B=0;B<this.face.length;B++)for(let M=0;M<this.face[B].length;M++)this.face[B][M]=Q[this.face[B][M]];this.sharedNodes=p[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(M,p){const b=[],Q=[];let q=p.pop();Q.push(q);let B=this.face[q].indexOf(M);B=(B+2)%3;let k=this.face[q][B];b.push(k);let u=0;for(;p.length>0;)q=p[u],this.face[q].indexOf(k)>-1?(B=(this.face[q].indexOf(k)+1)%3,k=this.face[q][B],b.push(k),Q.push(q),p.splice(u,1),u=0):u++;return this.adjacentFaces.push(b),Q}toGoldbergPolyhedronData(){const M=new QM("GeoDual","Goldberg",[],[]);M.name="GD dual";const p=this.vertex.length,b=new Array(p);for(let T=0;T<p;T++)b[T]=[];for(let T=0;T<this.face.length;T++)for(let M=0;M<3;M++)b[this.face[T][M]].push(T);let Q=0,q=0,B=0,k=[],u=[];this.adjacentFaces=[];for(let T=0;T<b.length;T++){M.face[T]=this.setOrder(T,b[T].concat([]));for(const p of b[T]){Q=0,q=0,B=0,k=this.face[p];for(let M=0;M<3;M++)u=this.vertex[k[M]],Q+=u[0],q+=u[1],B+=u[2];M.vertex[p]=[Q/3,q/3,B/3]}}return M}static BuildGeodesicData(M){const p=new qM("Geodesic-m-n","Geodesic",[[0,MM.f,-1],[-MM.f,1,0],[-1,0,-MM.f],[1,0,-MM.f],[MM.f,1,0],[0,MM.f,1],[-1,0,MM.f],[-MM.f,-1,0],[0,-MM.f,-1],[MM.f,-1,0],[1,0,MM.f],[0,-MM.f,1]],[]);M.setIndices(),M.calcCoeffs(),M.createInnerFacets(),M.edgeVecsABOB(),M.mapABOBtoOBOA(),M.mapABOBtoBAOA();for(let b=0;b<M.IDATA.face.length;b++)M.MapToFace(b,p),p.innerToData(b,M),"B"===M.IDATA.edgematch[b][1]&&p.mapABOBtoDATA(b,M),"O"===M.IDATA.edgematch[b][1]&&p.mapOBOAtoDATA(b,M),"A"===M.IDATA.edgematch[b][3]&&p.mapBAOAtoDATA(b,M);p.orderData(M);return p.vertex=p.vertex.map((function(M){const p=M[0],b=M[1],Q=M[2],q=Math.sqrt(p*p+b*b+Q*Q);return M[0]*=1/q,M[1]*=1/q,M[2]*=1/q,M})),p}}q.d._GoldbergMeshParser=(M,p)=>BM.Parse(M,p);class BM extends q.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(M,p){return void 0===p?(M>this.goldbergData.nbUnsharedFaces-1&&(l.c.Warn("Maximum number of unshared faces used"),M=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+M):(M>11&&(l.c.Warn("Last pole used"),M=11),p>this.goldbergData.nbFacesAtPole-1&&(l.c.Warn("Maximum number of faces at a pole used"),p=this.goldbergData.nbFacesAtPole-1),12+M*this.goldbergData.nbFacesAtPole+p)}_changeGoldbergFaceColors(M){for(let b=0;b<M.length;b++){const p=M[b][0],Q=M[b][1],q=M[b][2];for(let M=p;M<Q+1;M++)this.goldbergData.faceColors[M]=q}const p=[];for(let b=0;b<12;b++)for(let M=0;M<5;M++)p.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);for(let b=12;b<this.goldbergData.faceColors.length;b++)for(let M=0;M<6;M++)p.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);return p}setGoldbergFaceColors(M){const p=this._changeGoldbergFaceColors(M);this.gM(B.f.ColorKind,p)}updateGoldbergFaceColors(M){const p=this._changeGoldbergFaceColors(M);this.updateVerticesData(B.f.ColorKind,p)}_changeGoldbergFaceUVs(M){const p=this.getVerticesData(B.f.UVKind);for(let b=0;b<M.length;b++){const Q=M[b][0],q=M[b][1],B=M[b][2],k=M[b][3],u=M[b][4],T=[],O=[];let H,F;for(let M=0;M<5;M++)H=B.x+k*Math.cos(u+M*Math.PI/2.5),F=B.y+k*Math.sin(u+M*Math.PI/2.5),H<0&&(H=0),H>1&&(H=1),T.push(H,F);for(let M=0;M<6;M++)H=B.x+k*Math.cos(u+M*Math.PI/3),F=B.y+k*Math.sin(u+M*Math.PI/3),H<0&&(H=0),H>1&&(H=1),O.push(H,F);for(let M=Q;M<Math.min(12,q+1);M++)for(let b=0;b<5;b++)p[10*M+2*b]=T[2*b],p[10*M+2*b+1]=T[2*b+1];for(let M=Math.max(12,Q);M<q+1;M++)for(let b=0;b<6;b++)p[12*M-24+2*b]=O[2*b],p[12*M-23+2*b]=O[2*b+1]}return p}setGoldbergFaceUVs(M){const p=this._changeGoldbergFaceUVs(M);this.gM(B.f.UVKind,p)}updateGoldbergFaceUVs(M){const p=this._changeGoldbergFaceUVs(M);this.updateVerticesData(B.f.UVKind,p)}placeOnGoldbergFaceAt(M,p,b){const q=Q.Ap.RotationFromAxis(this.goldbergData.faceXaxis[p],this.goldbergData.faceYaxis[p],this.goldbergData.faceZaxis[p]);M.rotation=q,M.position=this.goldbergData.faceCenters[p].add(this.goldbergData.faceXaxis[p].scale(b.x)).add(this.goldbergData.faceYaxis[p].scale(b.y)).add(this.goldbergData.faceZaxis[p].scale(b.z))}serialize(M){super.serialize(M),M.type="GoldbergMesh";const p={};if(p.adjacentFaces=this.goldbergData.adjacentFaces,p.nbSharedFaces=this.goldbergData.nbSharedFaces,p.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,p.nbFaces=this.goldbergData.nbFaces,p.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){p.faceColors=[];for(const M of this.goldbergData.faceColors)p.faceColors.push(M.Ob())}if(this.goldbergData.faceCenters){p.faceCenters=[];for(const M of this.goldbergData.faceCenters)p.faceCenters.push(M.Ob())}if(this.goldbergData.faceZaxis){p.faceZaxis=[];for(const M of this.goldbergData.faceZaxis)p.faceZaxis.push(M.Ob())}if(this.goldbergData.faceYaxis){p.faceYaxis=[];for(const M of this.goldbergData.faceYaxis)p.faceYaxis.push(M.Ob())}if(this.goldbergData.faceXaxis){p.faceXaxis=[];for(const M of this.goldbergData.faceXaxis)p.faceXaxis.push(M.Ob())}M.goldbergData=p}static Parse(M,p){const b=M.goldbergData;b.faceColors=b.faceColors.map((M=>o.Sb.sp(M))),b.faceCenters=b.faceCenters.map((M=>Q.Ap.sp(M))),b.faceZaxis=b.faceZaxis.map((M=>Q.Ap.sp(M))),b.faceXaxis=b.faceXaxis.map((M=>Q.Ap.sp(M))),b.faceYaxis=b.faceYaxis.map((M=>Q.Ap.sp(M)));const q=new BM(M.name,p);return q.goldbergData=b,q}}var kM=b(12362);const uM={CreateBox:F.e,CreateTiledBox:j,CreateSphere:K.e,CreateDisc:H.e,CreateIcoSphere:h,CreateRibbon:O,CreateCylinder:S,CreateTorus:R,CreateTorusKnot:x,CreateLineSystem:P.e,PO:P.i,CreateDashedLines:P.d,ExtrudeShape:r,ExtrudeShapeCustom:Y,CreateLathe:E,CreateTiledPlane:i,rO:n.c,CreateGround:g.c,CreateTiledGround:g.e,CreateGroundFromHeightMap:g.b,CreatePolygon:L.b,ExtrudePolygon:L.e,CreateTube:U,CreatePolyhedron:d,CreateGeodesic:function(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=p.m||1;Q!==Math.floor(Q)&&(Q=Math.floor(Q),l.c.Warn("m not an integer only floor(m) used"));let q=p.n||0;if(q!==Math.floor(q)&&(q=Math.floor(q),l.c.Warn("n not an integer only floor(n) used")),q>Q){const M=q;q=Q,Q=M,l.c.Warn("n > m therefore m and n swapped")}const B=new bM;return B.build(Q,q),d(M,{custom:qM.BuildGeodesicData(B),size:p.size,sizeX:p.sizeX,sizeY:p.sizeY,sizeZ:p.sizeZ,faceUV:p.faceUV,faceColors:p.faceColors,flat:p.flat,updatable:p.updatable,sideOrientation:p.sideOrientation,frontUVs:p.frontUVs,backUVs:p.backUVs},b)},CreateGoldberg:function(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=p.size,T=p.sizeX||B||1,O=p.sizeY||B||1,H=p.sizeZ||B||1;let F=p.m||1;F!==Math.floor(F)&&(F=Math.floor(F),l.c.Warn("m not an integer only floor(m) used"));let W=p.n||0;if(W!==Math.floor(W)&&(W=Math.floor(W),l.c.Warn("n not an integer only floor(n) used")),W>F){const M=W;W=F,F=M,l.c.Warn("n > m therefore m and n swapped")}const i=new bM;i.build(F,W);const A=qM.BuildGeodesicData(i),j=A.toGoldbergPolyhedronData(),K=new BM(M,b);p.sideOrientation=q.d._GetDefaultSideOrientation(p.sideOrientation),K._originalBuilderSideOrientation=p.sideOrientation;(function(M,p){const b=M.size,q=M.sizeX||b||1,B=M.sizeY||b||1,T=M.sizeZ||b||1,O=0===M.sideOrientation?0:M.sideOrientation||k.e.DEFAULTSIDE,H=[],F=[],o=[],W=[];let i=1/0,A=-1/0,j=1/0,K=-1/0;for(let Q=0;Q<p.vertex.length;Q++)i=Math.min(i,p.vertex[Q][0]*q),A=Math.max(A,p.vertex[Q][0]*q),j=Math.min(j,p.vertex[Q][1]*B),K=Math.max(K,p.vertex[Q][1]*B);let D=0;for(let k=0;k<p.face.length;k++){const M=p.face[k],b=Q.Ap.sp(p.vertex[M[0]]),O=Q.Ap.sp(p.vertex[M[2]]),a=Q.Ap.sp(p.vertex[M[1]]),s=O.jp(b),S=a.jp(b),f=Q.Ap.Cross(S,s).normalize();for(let Q=0;Q<M.length;Q++){o.push(f.x,f.y,f.z);const b=p.vertex[M[Q]];H.push(b[0]*q,b[1]*B,b[2]*T);const k=(b[1]*B-j)/(K-j);W.push((b[0]*q-i)/(A-i),u.e?1-k:k)}for(let p=0;p<M.length-2;p++)F.push(D,D+p+2,D+p+1);D+=M.length}k.e._ComputeSides(O,H,F,o,W);const a=new k.e;return a.xM=H,a.indices=F,a.PM=o,a.NM=W,a})(p,j).YM(K,p.updatable),K.goldbergData.nbSharedFaces=A.sharedNodes,K.goldbergData.nbUnsharedFaces=A.poleNodes,K.goldbergData.adjacentFaces=A.adjacentFaces,K.goldbergData.nbFaces=K.goldbergData.nbSharedFaces+K.goldbergData.nbUnsharedFaces,K.goldbergData.nbFacesAtPole=(K.goldbergData.nbUnsharedFaces-12)/12;for(let q=0;q<A.vertex.length;q++)K.goldbergData.faceCenters.push(Q.Ap.sp(A.vertex[q])),K.goldbergData.faceCenters[q].x*=T,K.goldbergData.faceCenters[q].y*=O,K.goldbergData.faceCenters[q].z*=H,K.goldbergData.faceColors.push(new o.Sb(1,1,1,1));for(let q=0;q<j.face.length;q++){const M=j.face[q],p=Q.Ap.sp(j.vertex[M[0]]),b=Q.Ap.sp(j.vertex[M[2]]),B=Q.Ap.sp(j.vertex[M[1]]),k=b.jp(p),u=B.jp(p),T=Q.Ap.Cross(u,k).normalize(),O=Q.Ap.Cross(u,T).normalize();K.goldbergData.faceXaxis.push(u.normalize()),K.goldbergData.faceYaxis.push(T),K.goldbergData.faceZaxis.push(O)}return K},CreateDecal:mM,CreateCapsule:X,CreateText:kM.e}},13049:(M,p,b)=>{"use strict";b.d(p,{e:()=>upM});var Q=b(11796),q=b(12186);class B extends q.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var k=b(11833),u=(b(11949),b(11757));class T{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(M){this._targetStopDuration!==M&&(this._targetStopDuration=M)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(M){this._noiseTexture!==M&&(this._noiseTexture=M,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(M){this._animationSheetEnabled!==M&&(this._animationSheetEnabled=M)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(M){this._isAnimationSheetEnabled!=M&&(this._isAnimationSheetEnabled=M,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(M){this._useLogarithmicDepth=M&&this.RM().getEngine().getCaps().fragmentDepthSupported}RM(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(M){switch(M){case T.BLENDMODE_MULTIPLYADD:return;case T.BLENDMODE_ADD:M=1;break;case T.BLENDMODE_ONEONE:M=6;break;case T.BLENDMODE_STANDARD:M=2;break;case T.BLENDMODE_MULTIPLY:M=4;break;case T.BLENDMODE_SUBTRACT:M=3}this._engine.setAlphaMode(M)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:Q.Ap.Zero()}set direction1(M){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=M)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:Q.Ap.Zero()}set direction2(M){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=M)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:Q.Ap.Zero()}set minEmitBox(M){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=M)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:Q.Ap.Zero()}set maxEmitBox(M){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=M)}get billboardMode(){return this._billboardMode}set billboardMode(M){this._billboardMode!==M&&(this._billboardMode=M,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(M){this._isBillboardBased!==M&&(this._isBillboardBased=M,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(M){this._attachImageProcessingConfiguration(M)}_attachImageProcessingConfiguration(M){M!==this._imageProcessingConfiguration&&(!M&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=M)}_reset(){}_removeGradientAndTexture(M,p,b){if(!p)return this;let Q=0;for(const q of p){if(q.gradient===M){p.splice(Q,1);break}Q++}return b&&b.dispose(),this}constructor(M){this.animations=[],this.renderingGroupId=0,this.Qp=Q.Ap.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new Q.Ap(10,10,10),this.onAnimationEnd=null,this.blendMode=T.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Q.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.RO=new Q.Ap(0,0,0),this._useLogarithmicDepth=!1,this.gravity=Q.Ap.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new k.Sb(1,1,1,1),this.color2=new k.Sb(1,1,1,1),this.colorDead=new k.Sb(0,0,0,1),this.textureMask=new k.Sb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new B,this.id=M,this.name=M}createPointEmitter(M,p){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new Q.Ap(0,1,0),arguments.length>2&&void 0!==arguments[2]||new Q.Ap(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new Q.Ap(0,1,0),arguments.length>4&&void 0!==arguments[4]||new Q.Ap(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new Q.Ap(0,1,0),arguments.length>3&&void 0!==arguments[3]||new Q.Ap(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(M,p,b,Q){throw new Error("Method not implemented.")}}T.BLENDMODE_ONEONE=0,T.BLENDMODE_STANDARD=1,T.BLENDMODE_ADD=2,T.BLENDMODE_MULTIPLY=3,T.BLENDMODE_MULTIPLYADD=4,T.BLENDMODE_SUBTRACT=-1,(0,u.g)("BABYLON.BaseParticleSystem",T);var O=b(11806),H=b(11641);class F{constructor(){this.direction1=new Q.Ap(0,1,0),this.direction2=new Q.Ap(0,1,0),this.minEmitBox=new Q.Ap(-.5,-.5,-.5),this.maxEmitBox=new Q.Ap(.5,.5,.5)}startDirectionFunction(M,p,b,q){const B=(0,O.RandomRange)(this.direction1.x,this.direction2.x),k=(0,O.RandomRange)(this.direction1.y,this.direction2.y),u=(0,O.RandomRange)(this.direction1.z,this.direction2.z);if(q)return p.x=B,p.y=k,void(p.z=u);Q.Ap.TransformNormalFromFloatsToRef(B,k,u,M,p)}startPositionFunction(M,p,b,q){const B=(0,O.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),k=(0,O.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),u=(0,O.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(q)return p.x=B,p.y=k,void(p.z=u);Q.Ap.TransformCoordinatesFromFloatsToRef(B,k,u,M,p)}clone(){const M=new F;return H.c.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2),M.setVector3("minEmitBox",this.minEmitBox),M.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3),M.addUniform("minEmitBox",3),M.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.direction1=this.direction1.Ob(),M.direction2=this.direction2.Ob(),M.minEmitBox=this.minEmitBox.Ob(),M.maxEmitBox=this.maxEmitBox.Ob(),M}parse(M){Q.Ap.FromArrayToRef(M.direction1,0,this.direction1),Q.Ap.FromArrayToRef(M.direction2,0,this.direction2),Q.Ap.FromArrayToRef(M.minEmitBox,0,this.minEmitBox),Q.Ap.FromArrayToRef(M.maxEmitBox,0,this.maxEmitBox)}}class o{get radius(){return this._radius}set radius(M){this._radius=M,this._buildHeight()}get angle(){return this._angle}set angle(M){this._angle=M,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=b,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=p,this.radius=M}startDirectionFunction(M,p,b,q){q?Q.TmpVectors.Ap[0].B(b.QT).normalize():b.position.subtractToRef(M.getTranslation(),Q.TmpVectors.Ap[0]).normalize();const B=(0,O.RandomRange)(0,this.directionRandomizer),k=(0,O.RandomRange)(0,this.directionRandomizer),u=(0,O.RandomRange)(0,this.directionRandomizer);p.x=Q.TmpVectors.Ap[0].x+B,p.y=Q.TmpVectors.Ap[0].y+k,p.z=Q.TmpVectors.Ap[0].z+u,p.normalize()}startPositionFunction(M,p,b,q){const B=(0,O.RandomRange)(0,2*Math.PI);let k;this.emitFromSpawnPointOnly?k=1e-4:(k=(0,O.RandomRange)(0,this.heightRange),k=1-k*k);let u=this._radius-(0,O.RandomRange)(0,this._radius*this.radiusRange);u*=k;const T=u*Math.sin(B),H=u*Math.cos(B),F=k*this._height;if(q)return p.x=T,p.y=F,void(p.z=H);Q.Ap.TransformCoordinatesFromFloatsToRef(T,F,H,M,p)}clone(){const M=new o(this._radius,this._angle,this.directionRandomizer);return H.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat2("radius",this._radius,this.radiusRange),M.setFloat("coneAngle",this._angle),M.setFloat2("height",this._height,this.heightRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",2),M.addUniform("coneAngle",1),M.addUniform("height",2),M.addUniform("directionRandomizer",1)}getEffectDefines(){let M="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(M+="\n#define CONEEMITTERSPAWNPOINT"),M}getClassName(){return"ConeParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this._radius,M.angle=this._angle,M.directionRandomizer=this.directionRandomizer,M.radiusRange=this.radiusRange,M.heightRange=this.heightRange,M.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,M}parse(M){this.radius=M.radius,this.angle=M.angle,this.directionRandomizer=M.directionRandomizer,this.radiusRange=void 0!==M.radiusRange?M.radiusRange:1,this.heightRange=void 0!==M.radiusRange?M.heightRange:1,this.emitFromSpawnPointOnly=void 0!==M.emitFromSpawnPointOnly&&M.emitFromSpawnPointOnly}}class W extends o{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.Ap(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.Ap(0,1,0);super(M,p),this.direction1=b,this.direction2=q}startDirectionFunction(M,p){const b=(0,O.RandomRange)(this.direction1.x,this.direction2.x),q=(0,O.RandomRange)(this.direction1.y,this.direction2.y),B=(0,O.RandomRange)(this.direction1.z,this.direction2.z);Q.Ap.TransformNormalFromFloatsToRef(b,q,B,M,p)}clone(){const M=new W(this.radius,this.angle,this.direction1,this.direction2);return H.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.Ob(),M.direction2=this.direction2.Ob(),M}parse(M){super.parse(M),this.direction1.B(M.direction1),this.direction2.B(M.direction2)}}class i{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=M,this.height=p,this.radiusRange=b,this.directionRandomizer=q,this._tempVector=Q.Ap.Zero()}startDirectionFunction(M,p,b,q,B){b.position.subtractToRef(M.getTranslation(),this._tempVector),this._tempVector.normalize(),Q.Ap.TransformNormalToRef(this._tempVector,B,this._tempVector);const k=(0,O.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let u=Math.atan2(this._tempVector.x,this._tempVector.z);u+=(0,O.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=k,this._tempVector.x=Math.sin(u),this._tempVector.z=Math.cos(u),this._tempVector.normalize(),q?p.B(this._tempVector):Q.Ap.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,M,p)}startPositionFunction(M,p,b,q){const B=(0,O.RandomRange)(-this.height/2,this.height/2),k=(0,O.RandomRange)(0,2*Math.PI),u=(0,O.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),T=Math.sqrt(u)*this.radius,H=T*Math.cos(k),F=T*Math.sin(k);q?p.Db(H,B,F):Q.Ap.TransformCoordinatesFromFloatsToRef(H,B,F,M,p)}clone(){const M=new i(this.radius,this.directionRandomizer);return H.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("height",this.height),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("height",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this.radius,M.height=this.height,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.radius=M.radius,this.height=M.height,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class A extends i{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.Ap(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.Ap(0,1,0);super(M,p,b),this.direction1=q,this.direction2=B}startDirectionFunction(M,p,b,q){const B=(0,O.RandomRange)(this.direction1.x,this.direction2.x),k=(0,O.RandomRange)(this.direction1.y,this.direction2.y),u=(0,O.RandomRange)(this.direction1.z,this.direction2.z);q?p.Db(B,k,u):Q.Ap.TransformNormalFromFloatsToRef(B,k,u,M,p)}clone(){const M=new A(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return H.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("height",this.height),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("height",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.Ob(),M.direction2=this.direction2.Ob(),M}parse(M){super.parse(M),Q.Ap.FromArrayToRef(M.direction1,0,this.direction1),Q.Ap.FromArrayToRef(M.direction2,0,this.direction2)}}class j{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=M,this.radiusRange=p,this.directionRandomizer=b}startDirectionFunction(M,p,b,q){const B=b.position.jp(M.getTranslation()).normalize(),k=(0,O.RandomRange)(0,this.directionRandomizer),u=(0,O.RandomRange)(0,this.directionRandomizer),T=(0,O.RandomRange)(0,this.directionRandomizer);B.x+=k,B.y+=u,B.z+=T,B.normalize(),q?p.B(B):Q.Ap.TransformNormalFromFloatsToRef(B.x,B.y,B.z,M,p)}startPositionFunction(M,p,b,q){const B=this.radius-(0,O.RandomRange)(0,this.radius*this.radiusRange),k=(0,O.RandomRange)(0,1),u=(0,O.RandomRange)(0,2*Math.PI),T=Math.acos(2*k-1),H=B*Math.cos(u)*Math.sin(T),F=B*Math.cos(T),o=B*Math.sin(u)*Math.sin(T);q?p.Db(H,Math.abs(F),o):Q.Ap.TransformCoordinatesFromFloatsToRef(H,Math.abs(F),o,M,p)}clone(){const M=new j(this.radius,this.directionRandomizer);return H.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this.radius,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.radius=M.radius,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class K{constructor(){this.direction1=new Q.Ap(0,1,0),this.direction2=new Q.Ap(0,1,0)}startDirectionFunction(M,p,b,q){const B=(0,O.RandomRange)(this.direction1.x,this.direction2.x),k=(0,O.RandomRange)(this.direction1.y,this.direction2.y),u=(0,O.RandomRange)(this.direction1.z,this.direction2.z);q?p.Db(B,k,u):Q.Ap.TransformNormalFromFloatsToRef(B,k,u,M,p)}startPositionFunction(M,p,b,q){q?p.Db(0,0,0):Q.Ap.TransformCoordinatesFromFloatsToRef(0,0,0,M,p)}clone(){const M=new K;return H.c.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.direction1=this.direction1.Ob(),M.direction2=this.direction2.Ob(),M}parse(M){Q.Ap.FromArrayToRef(M.direction1,0,this.direction1),Q.Ap.FromArrayToRef(M.direction2,0,this.direction2)}}class D{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=M,this.radiusRange=p,this.directionRandomizer=b}startDirectionFunction(M,p,b,q){const B=b.position.jp(M.getTranslation()).normalize(),k=(0,O.RandomRange)(0,this.directionRandomizer),u=(0,O.RandomRange)(0,this.directionRandomizer),T=(0,O.RandomRange)(0,this.directionRandomizer);B.x+=k,B.y+=u,B.z+=T,B.normalize(),q?p.B(B):Q.Ap.TransformNormalFromFloatsToRef(B.x,B.y,B.z,M,p)}startPositionFunction(M,p,b,q){const B=this.radius-(0,O.RandomRange)(0,this.radius*this.radiusRange),k=(0,O.RandomRange)(0,1),u=(0,O.RandomRange)(0,2*Math.PI),T=Math.acos(2*k-1),H=B*Math.cos(u)*Math.sin(T),F=B*Math.cos(T),o=B*Math.sin(u)*Math.sin(T);q?p.Db(H,F,o):Q.Ap.TransformCoordinatesFromFloatsToRef(H,F,o,M,p)}clone(){const M=new D(this.radius,this.directionRandomizer);return H.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this.radius,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.radius=M.radius,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class a extends D{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.Ap(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.Ap(0,1,0);super(M),this.direction1=p,this.direction2=b}startDirectionFunction(M,p){const b=(0,O.RandomRange)(this.direction1.x,this.direction2.x),q=(0,O.RandomRange)(this.direction1.y,this.direction2.y),B=(0,O.RandomRange)(this.direction1.z,this.direction2.z);Q.Ap.TransformNormalFromFloatsToRef(b,q,B,M,p)}clone(){const M=new a(this.radius,this.direction1,this.direction2);return H.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.Ob(),M.direction2=this.direction2.Ob(),M}parse(M){super.parse(M),this.direction1.B(M.direction1),this.direction2.B(M.direction2)}}class s{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(M,p,b,q){const B=Q.TmpVectors.Ap[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,b,B);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,b,B);const M=Q.TmpVectors.Ap[1];B.subtractToRef(b.position,M),M.scaleToRef(1/b.lifeTime,B)}else B.set(0,0,0);q?p.B(B):Q.Ap.TransformNormalToRef(B,M,p)}startPositionFunction(M,p,b,q){const B=Q.TmpVectors.Ap[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,b,B):B.set(0,0,0),q?p.B(B):Q.Ap.TransformCoordinatesToRef(B,M,p)}clone(){const M=new s;return H.c.DeepCopy(this,M),M}applyToShader(M){}buildUniformLayout(M){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.particlePositionGenerator=this.particlePositionGenerator,M.particleDestinationGenerator=this.particleDestinationGenerator,M}parse(M){M.particlePositionGenerator&&(this.particlePositionGenerator=M.particlePositionGenerator),M.particleDestinationGenerator&&(this.particleDestinationGenerator=M.particleDestinationGenerator)}}var S=b(11857);class f{get mesh(){return this._mesh}set mesh(M){this._mesh!==M&&(this._mesh=M,M?(this._indices=M.jb(),this._positions=M.getVerticesData(S.f.PositionKind),this._normals=M.getVerticesData(S.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=Q.Ap.Zero(),this._mesh=null,this.direction1=new Q.Ap(0,1,0),this.direction2=new Q.Ap(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=M}startDirectionFunction(M,p,b,q){if(this.useMeshNormalsForDirection&&this._normals)return void Q.Ap.TransformNormalToRef(this._storedNormal,M,p);const B=(0,O.RandomRange)(this.direction1.x,this.direction2.x),k=(0,O.RandomRange)(this.direction1.y,this.direction2.y),u=(0,O.RandomRange)(this.direction1.z,this.direction2.z);q?p.Db(B,k,u):Q.Ap.TransformNormalFromFloatsToRef(B,k,u,M,p)}startPositionFunction(M,p,b,q){if(!this._indices||!this._positions)return;const B=3*(Math.random()*(this._indices.length/3)|0),k=Math.random(),u=Math.random()*(1-k),T=1-k-u,O=this._indices[B],H=this._indices[B+1],F=this._indices[B+2],o=Q.TmpVectors.Ap[0],W=Q.TmpVectors.Ap[1],i=Q.TmpVectors.Ap[2],A=Q.TmpVectors.Ap[3];Q.Ap.FromArrayToRef(this._positions,3*O,o),Q.Ap.FromArrayToRef(this._positions,3*H,W),Q.Ap.FromArrayToRef(this._positions,3*F,i),A.x=k*o.x+u*W.x+T*i.x,A.y=k*o.y+u*W.y+T*i.y,A.z=k*o.z+u*W.z+T*i.z,q?p.Db(A.x,A.y,A.z):Q.Ap.TransformCoordinatesFromFloatsToRef(A.x,A.y,A.z,M,p),this.useMeshNormalsForDirection&&this._normals&&(Q.Ap.FromArrayToRef(this._normals,3*O,o),Q.Ap.FromArrayToRef(this._normals,3*H,W),Q.Ap.FromArrayToRef(this._normals,3*F,i),this._storedNormal.x=k*o.x+u*W.x+T*i.x,this._storedNormal.y=k*o.y+u*W.y+T*i.y,this._storedNormal.z=k*o.z+u*W.z+T*i.z)}clone(){const M=new f(this.mesh);return H.c.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var M;const p={};return p.type=this.getClassName(),p.direction1=this.direction1.Ob(),p.direction2=this.direction2.Ob(),p.meshId=null===(M=this.mesh)||void 0===M?void 0:M.id,p.useMeshNormalsForDirection=this.useMeshNormalsForDirection,p}parse(M,p){Q.Ap.FromArrayToRef(M.direction1,0,this.direction1),Q.Ap.FromArrayToRef(M.direction2,0,this.direction2),M.meshId&&p&&(this.mesh=p.getLastMeshById(M.meshId)),this.useMeshNormalsForDirection=M.useMeshNormalsForDirection}}class R{_isUbo(M){return void 0!==M.addUniform}constructor(M){this._isUbo(M)?(this.setMatrix3x3=M.updateMatrix3x3.bind(M),this.setMatrix2x2=M.updateMatrix2x2.bind(M),this.setFloat=M.updateFloat.bind(M),this.setFloat2=M.updateFloat2.bind(M),this.setFloat3=M.updateFloat3.bind(M),this.setFloat4=M.updateFloat4.bind(M),this.setFloatArray=M.updateFloatArray.bind(M),this.setArray=M.updateArray.bind(M),this.setIntArray=M.updateIntArray.bind(M),this.setMatrix=M.ob.bind(M),this.setMatrices=M.updateMatrices.bind(M),this.setVector3=M.updateVector3.bind(M),this.setVector4=M.updateVector4.bind(M),this.setColor3=M.updateColor3.bind(M),this.setColor4=M.updateColor4.bind(M),this.setDirectColor4=M.updateDirectColor4.bind(M),this.setInt=M.updateInt.bind(M),this.setInt2=M.updateInt2.bind(M),this.setInt3=M.updateInt3.bind(M),this.setInt4=M.updateInt4.bind(M)):(this.setMatrix3x3=M.setMatrix3x3.bind(M),this.setMatrix2x2=M.setMatrix2x2.bind(M),this.setFloat=M.setFloat.bind(M),this.setFloat2=M.setFloat2.bind(M),this.setFloat3=M.setFloat3.bind(M),this.setFloat4=M.setFloat4.bind(M),this.setFloatArray=M.setFloatArray.bind(M),this.setArray=M.setArray.bind(M),this.setIntArray=M.setIntArray.bind(M),this.setMatrix=M.setMatrix.bind(M),this.setMatrices=M.setMatrices.bind(M),this.setVector3=M.setVector3.bind(M),this.setVector4=M.setVector4.bind(M),this.setColor3=M.setColor3.bind(M),this.setColor4=M.setColor4.bind(M),this.setDirectColor4=M.setDirectColor4.bind(M),this.setInt=M.setInt.bind(M),this.setInt2=M.setInt2.bind(M),this.setInt3=M.setInt3.bind(M),this.setInt4=M.setInt4.bind(M))}}var y=b(11709);const x="gpuUpdateParticlesPixelShader",P="#version 300 es\nvoid main() {discard;}\n";y.d.ShadersStore[x]||(y.d.ShadersStore[x]=P);const L="gpuUpdateParticlesVertexShader",N="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";y.d.ShadersStore[L]||(y.d.ShadersStore[L]=N);(0,u.g)("BABYLON.WebGL2ParticleSystem",class{constructor(M,p){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=M,this._engine=p,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var M;return(null===(M=this._updateEffect)||void 0===M?void 0:M.isReady())??!1}createUpdateBuffer(M){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof s&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=M,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new R(this._updateEffect)}createVertexBuffers(M,p){this._updateVAO.push(this._createUpdateVAO(M)),this._renderVAO.push(this._engine.recordVertexArrayObject(p,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=p}createParticleBuffer(M){return M}bindDrawBuffers(M,p,b){b?this._engine.bindBuffers(this._renderVertexBuffers,b,p):this._engine.bindVertexArrayObject(this._renderVAO[M],null)}preUpdateParticleBuffer(){const M=this._engine;if(this._engine.enableEffect(this._updateEffect),!M.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(M,p,b){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[M],null);const Q=this._engine;Q.bindTransformFeedbackBuffer(p.getBuffer()),Q.setRasterizerState(!1),Q.beginTransformFeedback(!0),Q.drawArraysType(3,0,b),Q.endTransformFeedback(),Q.setRasterizerState(!0),Q.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let M=0;M<this._updateVAO.length;M++)this._engine.releaseVertexArrayObject(this._updateVAO[M]);this._updateVAO.length=0;for(let M=0;M<this._renderVAO.length;M++)this._engine.releaseVertexArrayObject(this._renderVAO[M]);this._renderVAO.length=0}_createUpdateVAO(M){const p={};p.position=M.createVertexBuffer("position",0,3);let b=3;p.age=M.createVertexBuffer("age",b,1),b+=1,p.size=M.createVertexBuffer("size",b,3),b+=3,p.life=M.createVertexBuffer("life",b,1),b+=1,p.seed=M.createVertexBuffer("seed",b,4),b+=4,p.direction=M.createVertexBuffer("direction",b,3),b+=3,this._parent.particleEmitterType instanceof s&&(p.initialPosition=M.createVertexBuffer("initialPosition",b,3),b+=3),this._parent._colorGradientsTexture||(p.color=M.createVertexBuffer("color",b,4),b+=4),this._parent._isBillboardBased||(p.initialDirection=M.createVertexBuffer("initialDirection",b,3),b+=3),this._parent.noiseTexture&&(p.noiseCoordinates1=M.createVertexBuffer("noiseCoordinates1",b,3),b+=3,p.noiseCoordinates2=M.createVertexBuffer("noiseCoordinates2",b,3),b+=3),this._parent._angularSpeedGradientsTexture?(p.angle=M.createVertexBuffer("angle",b,1),b+=1):(p.angle=M.createVertexBuffer("angle",b,2),b+=2),this._parent._isAnimationSheetEnabled&&(p.cellIndex=M.createVertexBuffer("cellIndex",b,1),b+=1,this._parent.spriteRandomStartCell&&(p.cellStartOffset=M.createVertexBuffer("cellStartOffset",b,1),b+=1));const Q=this._engine.recordVertexArrayObject(p,null,this._updateEffect);return this._engine.bindArrayBuffer(null),Q}});class r{constructor(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Q=arguments.length>3?arguments[3]:void 0;this._engine=M,this._label=Q,this._engine._storageBuffers.push(this),this._create(p,b)}_create(M,p){this._bufferSize=M,this._creationFlags=p,this._buffer=this._engine.createStorageBuffer(M,p,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(M,p,b){this._buffer&&this._engine.updateStorageBuffer(this._buffer,M,p,b)}async read(M,p,b,Q){return await this._engine.readFromStorageBuffer(this._buffer,M,p,b,Q)}dispose(){const M=this._engine._storageBuffers,p=M.indexOf(this);-1!==p&&(M[p]=M[M.length-1],M.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var Y=b(11784),w=b(11788),E=b(11823),n=b(11780),g=b(12106),U=b(11637),c=b(11736),d=b(12007);class V{constructor(){this._gpuTimeInFrameId=-1,this.counter=new d.b}_addDuration(M,p){M<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==M?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(p,!1),this._gpuTimeInFrameId=M):this.counter.addCount(p,!1))}}var h=b(11693);class I{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=M,this._engine=p,this.uniqueId=g.e.UniqueId,p.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new V),this._engine.getCaps().supportComputeShaders?Q.bindingsMapping?(this._context=p.createComputeContext(),this._shaderPath=b,this._options={bindingsMapping:{},defines:[],...Q}):U.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):U.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(M,p){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Q=this._bindings[M];this._bindings[M]={type:b?0:4,object:p,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==p||Q.type!==this._bindings[M].type)}setStorageTexture(M,p){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==p),this._bindings[M]={type:1,object:p,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setExternalTexture(M,p){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==p),this._bindings[M]={type:6,object:p,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setVideoTexture(M,p){return!!p.externalTexture&&(this.setExternalTexture(M,p.externalTexture),!0)}setUniformBuffer(M,p){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==p),this._bindings[M]={type:I._BufferIsDataBuffer(p)?7:2,object:p,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setStorageBuffer(M,p){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==p),this._bindings[M]={type:I._BufferIsDataBuffer(p)?7:3,object:p,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setTextureSampler(M,p){const b=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!b||!p.compareSampler(b.object)),this._bindings[M]={type:5,object:p,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}isReady(){let M=this._effect;for(const q in this._bindings){const M=this._bindings[q],p=M.type,b=M.object;switch(p){case 0:case 4:case 1:if(!b.isReady())return!1;break;case 6:if(!b.isReady())return!1;break}}const p=[],b=this._shaderPath;if(this._options.defines)for(let q=0;q<this._options.defines.length;q++)p.push(this._options.defines[q]);const Q=p.join("\n");return this._cachedDefines!==Q&&(this._cachedDefines=Q,M=this._engine.createComputeEffect(b,{defines:Q,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=M),!!M.isReady()}dispatch(M,p,b){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,M,p,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const b=I._BufferIsDataBuffer(M)?M:M.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,b,p,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const p in this._bindings){const b=this._bindings[p];if(!this._options.bindingsMapping[p])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+p+"'");switch(b.type){case 0:{const Q=this._samplers[p],q=b.object;var M;if(!Q||!q._texture||!Q.compareSampler(q._texture))this._samplers[p]=(new c.d).setParameters(q.wrapU,q.wrapV,q.wrapR,q.anisotropicFilteringLevel,q._texture.samplingMode,null===(M=q._texture)||void 0===M?void 0:M._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const M=b.object;M.getBuffer()!==b.buffer&&(b.buffer=M.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((q=>{(0,h.i)((()=>this.dispatch(M,p,b)),q,void 0,Q)}))}serialize(){const M=E.b.Serialize(this);M.options=this._options,M.shaderPath=this._shaderPath,M.Fo={},M.textures={};for(const p in this._bindings){const b=this._bindings[p],Q=b.object;switch(b.type){case 0:case 4:case 1:{const q=Q.serialize();q&&(M.textures[p]=q,M.Fo[p]={type:b.type});break}}}return M}static Parse(M,p,b){const Q=E.b.Parse((()=>new I(M.name,p.getEngine(),M.shaderPath,M.options)),M,p,b);for(const q in M.textures){const B=M.Fo[q],k=n.b.Parse(M.textures[q],p,b);0===B.type?Q.setTexture(q,k):4===B.type?Q.setTexture(q,k,!1):Q.setStorageTexture(q,k)}return Q}static _BufferIsDataBuffer(M){return void 0!==M.underlyingResource}}(0,Y.c)([(0,w.R)()],I.prototype,"name",void 0),(0,Y.c)([(0,w.R)()],I.prototype,"fastMode",void 0),(0,u.g)("BABYLON.ComputeShader",I);var Z=b(12057);const J="gpuUpdateParticlesComputeShader",v="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";y.d.ShadersStoreWGSL[J]||(y.d.ShadersStoreWGSL[J]=v);(0,u.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(M,p){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=M,this._engine=p}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var M;return(null===(M=this._updateComputeShader)||void 0===M?void 0:M.isReady())??!1}createUpdateBuffer(M){var p;const b={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(b.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(b.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(b.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(b.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(b.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(b.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(b.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new I("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:b,defines:M.split("\n")}),null===(p=this._simParamsComputeShader)||void 0===p||p.dispose(),this._simParamsComputeShader=new Z.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new R(this._simParamsComputeShader)}createVertexBuffers(M,p){this._renderVertexBuffers.push(p)}createParticleBuffer(M){const p=new r(this._engine,4*M.length,11,"ComputeShaderParticleSystemBuffer");return p.update(M),this._bufferComputeShader.push(p),p.getBuffer()}bindDrawBuffers(M,p,b){this._engine.bindBuffers(this._renderVertexBuffers[M],b,p)}preUpdateParticleBuffer(){}updateParticleBuffer(M,p,b){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[M]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^M]),this._updateComputeShader.dispatch(Math.ceil(b/64))}releaseBuffers(){var M;for(let p=0;p<this._bufferComputeShader.length;++p)this._bufferComputeShader[p].dispose();this._bufferComputeShader.length=0,null===(M=this._simParamsComputeShader)||void 0===M||M.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class z{constructor(M,p,b){this.gradient=M,this.color1=p,this.color2=b}getColorToRef(M){this.color2?k.Sb.LerpToRef(this.color1,this.color2,Math.random(),M):M.B(this.color1)}}class t{constructor(M,p){this.gradient=M,this.color=p}}class e{constructor(M,p,b){this.gradient=M,this.factor1=p,this.factor2=b}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class G{static GetCurrentGradient(M,p,b){if(p[0].gradient>M)return void b(p[0],p[0],1);for(let q=0;q<p.length-1;q++){const Q=p[q],B=p[q+1];if(M>=Q.gradient&&M<=B.gradient){return void b(Q,B,(M-Q.gradient)/(B.gradient-Q.gradient))}}const Q=p.length-1;b(p[Q],p[Q],1)}}var mM=b(11624),C=b(12284),X=b(11664);class l{constructor(M){this.particleSystem=M,this.position=Q.Ap.Zero(),this.direction=Q.Ap.Zero(),this.color=new k.Sb(0,0,0,0),this.colorStep=new k.Sb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new Q.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new k.Sb(0,0,0,0),this._currentColor2=new k.Sb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=l._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let M=this.age,p=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===p?(p=1,M=this._randomCellOffset):M+=this._randomCellOffset);const b=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let Q;Q=this._initialSpriteCellLoop?(0,O.Clamp)(M*p%this.lifeTime/this.lifeTime):(0,O.Clamp)(M*p/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+Q*b|0}_inheritParticleInfoToSubEmitter(M){if(M.particleSystem.Qp.position){const p=M.particleSystem.Qp;if(p.position.B(this.position),M.inheritDirection){const M=Q.TmpVectors.Ap[0];this.direction.normalizeToRef(M),p.setDirection(M,0,Math.PI/2)}}else{M.particleSystem.Qp.B(this.position)}this.direction.scaleToRef(M.inheritedVelocityAmount/2,Q.TmpVectors.Ap[0]),M.particleSystem._inheritedVelocityOffset.B(Q.TmpVectors.Ap[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const M of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(M)}_reset(){this.age=0,this.id=l._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(M){M.position.B(this.position),this._initialDirection?M._initialDirection?M._initialDirection.B(this._initialDirection):M._initialDirection=this._initialDirection.clone():M._initialDirection=null,M.direction.B(this.direction),this.QT&&(M.QT?M.QT.B(this.QT):M.QT=this.QT.clone()),M.color.B(this.color),M.colorStep.B(this.colorStep),M.lifeTime=this.lifeTime,M.age=this.age,M._randomCellOffset=this._randomCellOffset,M.size=this.size,M.scale.B(this.scale),M.angle=this.angle,M.angularSpeed=this.angularSpeed,M.particleSystem=this.particleSystem,M.cellIndex=this.cellIndex,M.id=this.id,M._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(M._currentColorGradient=this._currentColorGradient,M._currentColor1.B(this._currentColor1),M._currentColor2.B(this._currentColor2)),this._currentSizeGradient&&(M._currentSizeGradient=this._currentSizeGradient,M._currentSize1=this._currentSize1,M._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(M._currentAngularSpeedGradient=this._currentAngularSpeedGradient,M._currentAngularSpeed1=this._currentAngularSpeed1,M._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(M._currentVelocityGradient=this._currentVelocityGradient,M._currentVelocity1=this._currentVelocity1,M._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(M._currentLimitVelocityGradient=this._currentLimitVelocityGradient,M._currentLimitVelocity1=this._currentLimitVelocity1,M._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(M._currentDragGradient=this._currentDragGradient,M._currentDrag1=this._currentDrag1,M._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(M._initialStartSpriteCellId=this._initialStartSpriteCellId,M._initialEndSpriteCellId=this._initialEndSpriteCellId,M._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(M.remapData&&this.remapData?M.remapData.B(this.remapData):M.remapData=new Q.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(M._randomNoiseCoordinates1?(M._randomNoiseCoordinates1.B(this._randomNoiseCoordinates1),M._randomNoiseCoordinates2.B(this._randomNoiseCoordinates2)):(M._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),M._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}l._Count=0;var MM=b(11898),pM=(b(11940),b(12173)),bM=b(12167),QM=b(12048);function qM(M,p){const b=(0,O.RandomRange)(0,1);k.Sb.LerpToRef(p.color1,p.color2,b,M.color),p.colorDead.subtractToRef(M.color,p._colorDiff),p._colorDiff.scaleToRef(1/M.lifeTime,M.colorStep)}function BM(M,p){M._currentColorGradient=p._colorGradients[0],M._currentColorGradient.getColorToRef(M.color),M._currentColor1.B(M.color),p._colorGradients.length>1?p._colorGradients[1].getColorToRef(M._currentColor2):M._currentColor2.B(M.color)}function kM(M,p){const b=p._colorGradients;G.GetCurrentGradient(p._ratio,b,((p,b,Q)=>{p!==M._currentColorGradient&&(M._currentColor1.B(M._currentColor2),b.getColorToRef(M._currentColor2),M._currentColorGradient=p),k.Sb.LerpToRef(M._currentColor1,M._currentColor2,Q,M.color)}))}function uM(M,p){M.colorStep.scaleToRef(p._scaledUpdateSpeed,p._scaledColorStep),M.color.addInPlace(p._scaledColorStep),M.color.a<0&&(M.color.a=0)}function TM(M,p){G.GetCurrentGradient(p._ratio,p._angularSpeedGradients,((p,b,Q)=>{p!==M._currentAngularSpeedGradient&&(M._currentAngularSpeed1=M._currentAngularSpeed2,M._currentAngularSpeed2=b.getFactor(),M._currentAngularSpeedGradient=p),M.angularSpeed=(0,O.Lerp)(M._currentAngularSpeed1,M._currentAngularSpeed2,Q)}))}function OM(M,p){M.angle+=M.angularSpeed*p._scaledUpdateSpeed}function HM(M,p){p.particleEmitterType.startDirectionFunction(p._emitterWorldMatrix,M.direction,M,p.isLocal,p._emitterInverseWorldMatrix)}function FM(M,p){p.startDirectionFunction(p._emitterWorldMatrix,M.direction,M,p.isLocal)}function oM(M,p){M._currentVelocityGradient=p._velocityGradients[0],M._currentVelocity1=M._currentVelocityGradient.getFactor(),p._velocityGradients.length>1?M._currentVelocity2=p._velocityGradients[1].getFactor():M._currentVelocity2=M._currentVelocity1}function WM(M,p){M._currentLimitVelocityGradient=p._limitVelocityGradients[0],M._currentLimitVelocity1=M._currentLimitVelocityGradient.getFactor(),p._limitVelocityGradients.length>1?M._currentLimitVelocity2=p._limitVelocityGradients[1].getFactor():M._currentLimitVelocity2=M._currentLimitVelocity1}function iM(M,p){G.GetCurrentGradient(p._ratio,p._velocityGradients,((b,Q,q)=>{b!==M._currentVelocityGradient&&(M._currentVelocity1=M._currentVelocity2,M._currentVelocity2=Q.getFactor(),M._currentVelocityGradient=b),p._directionScale*=(0,O.Lerp)(M._currentVelocity1,M._currentVelocity2,q)}))}function AM(M,p){G.GetCurrentGradient(p._ratio,p._limitVelocityGradients,((b,Q,q)=>{b!==M._currentLimitVelocityGradient&&(M._currentLimitVelocity1=M._currentLimitVelocity2,M._currentLimitVelocity2=Q.getFactor(),M._currentLimitVelocityGradient=b);const B=(0,O.Lerp)(M._currentLimitVelocity1,M._currentLimitVelocity2,q);M.direction.length()>B&&M.direction.scaleInPlace(p.limitVelocityDamping)}))}function jM(M,p){M.direction.scaleToRef(p._directionScale,p._scaledDirection)}function KM(M,p){p.particleEmitterType.startPositionFunction(p._emitterWorldMatrix,M.position,M,p.isLocal)}function DM(M,p){p.startPositionFunction(p._emitterWorldMatrix,M.position,M,p.isLocal)}function aM(M,p){M.QT?M.QT.B(M.position):M.QT=M.position.clone(),Q.Ap.TransformCoordinatesToRef(M.QT,p._emitterWorldMatrix,M.position)}function sM(M,p){p.isLocal&&M.QT?(M.QT.addInPlace(p._scaledDirection),Q.Ap.TransformCoordinatesToRef(M.QT,p._emitterWorldMatrix,M.position)):M.position.addInPlace(p._scaledDirection)}function SM(M,p){M._currentDragGradient=p._dragGradients[0],M._currentDrag1=M._currentDragGradient.getFactor(),p._dragGradients.length>1?M._currentDrag2=p._dragGradients[1].getFactor():M._currentDrag2=M._currentDrag1}function fM(M,p){G.GetCurrentGradient(p._ratio,p._dragGradients,((b,Q,q)=>{b!==M._currentDragGradient&&(M._currentDrag1=M._currentDrag2,M._currentDrag2=Q.getFactor(),M._currentDragGradient=b);const B=(0,O.Lerp)(M._currentDrag1,M._currentDrag2,q);p._scaledDirection.scaleInPlace(1-B)}))}function RM(M,p){M._randomNoiseCoordinates1?(M._randomNoiseCoordinates1.Db(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2.Db(Math.random(),Math.random(),Math.random())):(M._randomNoiseCoordinates1=new Q.Ap(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2=new Q.Ap(Math.random(),Math.random(),Math.random()))}function yM(M,p){const b=p._noiseTextureData,q=p._noiseTextureSize;if(b&&q&&M._randomNoiseCoordinates1){const B=p._fetchR(M._randomNoiseCoordinates1.x,M._randomNoiseCoordinates1.y,q.width,q.height,b),k=p._fetchR(M._randomNoiseCoordinates1.z,M._randomNoiseCoordinates2.x,q.width,q.height,b),u=p._fetchR(M._randomNoiseCoordinates2.y,M._randomNoiseCoordinates2.z,q.width,q.height,b),T=Q.TmpVectors.Ap[0],O=Q.TmpVectors.Ap[1];T.Db((2*B-1)*p.noiseStrength.x,(2*k-1)*p.noiseStrength.y,(2*u-1)*p.noiseStrength.z),T.scaleToRef(p._tempScaledUpdateSpeed,O),M.direction.addInPlace(O)}}function xM(M,p){p.gravity.scaleToRef(p._tempScaledUpdateSpeed,p._scaledGravity),M.direction.addInPlace(p._scaledGravity)}function PM(M,p){M.size=(0,O.RandomRange)(p.minSize,p.maxSize),M.scale.Db((0,O.RandomRange)(p.minScaleX,p.maxScaleX),(0,O.RandomRange)(p.minScaleY,p.maxScaleY))}function LM(M,p){M._currentSizeGradient=p._sizeGradients[0],M._currentSize1=M._currentSizeGradient.getFactor(),M.size=M._currentSize1,p._sizeGradients.length>1?M._currentSize2=p._sizeGradients[1].getFactor():M._currentSize2=M._currentSize1,M.scale.Db((0,O.RandomRange)(p.minScaleX,p.maxScaleX),(0,O.RandomRange)(p.minScaleY,p.maxScaleY))}function NM(M,p){const b=p._actualFrame/p.targetStopDuration;G.GetCurrentGradient(b,p._startSizeGradients,((b,Q,q)=>{b!==p._currentStartSizeGradient&&(p._currentStartSize1=p._currentStartSize2,p._currentStartSize2=Q.getFactor(),p._currentStartSizeGradient=b);const B=(0,O.Lerp)(p._currentStartSize1,p._currentStartSize2,q);M.scale.scaleInPlace(B)}))}function rM(M,p){G.GetCurrentGradient(p._ratio,p._sizeGradients,((p,b,Q)=>{p!==M._currentSizeGradient&&(M._currentSize1=M._currentSize2,M._currentSize2=b.getFactor(),M._currentSizeGradient=p),M.size=(0,O.Lerp)(M._currentSize1,M._currentSize2,Q)}))}function YM(M,p){M.remapData=new Q.Vector4(0,1,0,1)}function wM(M,p){p._colorRemapGradients&&p._colorRemapGradients.length>0&&G.GetCurrentGradient(p._ratio,p._colorRemapGradients,((p,b,Q)=>{const q=(0,O.Lerp)(p.factor1,b.factor1,Q),B=(0,O.Lerp)(p.factor2,b.factor2,Q);M.remapData.x=q,M.remapData.y=B-q})),p._alphaRemapGradients&&p._alphaRemapGradients.length>0&&G.GetCurrentGradient(p._ratio,p._alphaRemapGradients,((p,b,Q)=>{const q=(0,O.Lerp)(p.factor1,b.factor1,Q),B=(0,O.Lerp)(p.factor2,b.factor2,Q);M.remapData.z=q,M.remapData.w=B-q}))}function EM(M,p){const b=(0,O.Clamp)(p._actualFrame/p.targetStopDuration);G.GetCurrentGradient(b,p._lifeTimeGradients,((p,Q)=>{const q=p,B=Q,k=q.getFactor(),u=B.getFactor(),T=(b-q.gradient)/(B.gradient-q.gradient);M.lifeTime=(0,O.Lerp)(k,u,T)})),p._emitPower=(0,O.RandomRange)(p.minEmitPower,p.maxEmitPower)}function nM(M,p){M.lifeTime=(0,O.RandomRange)(p.minLifeTime,p.maxLifeTime),p._emitPower=(0,O.RandomRange)(p.minEmitPower,p.maxEmitPower)}function gM(M,p){0===p._emitPower?(M._initialDirection?M._initialDirection.B(M.direction):M._initialDirection=M.direction.clone(),M.direction.set(0,0,0)):(M._initialDirection=null,M.direction.scaleInPlace(p._emitPower)),M.direction.addInPlace(p._inheritedVelocityOffset)}function UM(M,p){M.angularSpeed=(0,O.RandomRange)(p.minAngularSpeed,p.maxAngularSpeed),M.angle=(0,O.RandomRange)(p.minInitialRotation,p.maxInitialRotation)}function cM(M,p){M._currentAngularSpeedGradient=p._angularSpeedGradients[0],M.angularSpeed=M._currentAngularSpeedGradient.getFactor(),M._currentAngularSpeed1=M.angularSpeed,p._angularSpeedGradients.length>1?M._currentAngularSpeed2=p._angularSpeedGradients[1].getFactor():M._currentAngularSpeed2=M._currentAngularSpeed1,M.angle=(0,O.RandomRange)(p.minInitialRotation,p.maxInitialRotation)}function dM(M,p){M._initialStartSpriteCellId=p.startSpriteCellID,M._initialEndSpriteCellId=p.endSpriteCellID,M._initialSpriteCellLoop=p.spriteCellLoop}function VM(M,p){M.previousItem=p.previousItem,M.nextItem=p,p.previousItem&&(p.previousItem.nextItem=M),p.previousItem=M}function hM(M,p){M.previousItem=p,M.nextItem=p.nextItem,p.nextItem&&(p.nextItem.previousItem=M),p.nextItem=M}function IM(M,p){let b=p;for(;b.nextItem;)b=b.nextItem;M.previousItem=b,M.nextItem=b.nextItem,b.nextItem=M}function ZM(M){M.previousItem&&(M.previousItem.nextItem=M.nextItem),M.nextItem&&(M.nextItem.previousItem=M.previousItem)}class JM extends T{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(M){this._startDirectionFunction!==M&&(this._startDirectionFunction=M,this._directionProcessing.process=M?FM:HM)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(M){this._startPositionFunction!==M&&(this._startPositionFunction=M,this._positionCreation.process=M?DM:KM)}set onDispose(M){this._onDisposeObserver&&this.bb.remove(this._onDisposeObserver),this._onDisposeObserver=this.bb.add(M)}get O(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(M){this._useRampGradients!==M&&(this._useRampGradients=M,this._resetEffect(),M?(this._rampCreation={process:YM,previousItem:null,nextItem:null},hM(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:wM,previousItem:null,nextItem:null},hM(this._remapGradientProcessing,this._gravityProcessing)):(ZM(this._rampCreation),ZM(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(M){this._isLocal!==M&&(this._isLocal=M,M?(this._isLocalCreation={process:aM,previousItem:null,nextItem:null},hM(this._isLocalCreation,this._positionCreation)):ZM(this._isLocalCreation))}get particles(){return this.ko}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(M){this._animationSheetEnabled!==M&&(this._animationSheetEnabled=M,M?(this._sheetCreation={process:dM,previousItem:null,nextItem:null},hM(this._sheetCreation,this._colorCreation)):ZM(this._sheetCreation),this._reset())}getActiveCount(){return this.ko.length}getClassName(){return"Lb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var M;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(M=this._customWrappers[p])||void 0===M?void 0:M.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[M]??this._customWrappers[0]}setCustomEffect(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[p]=new MM.e(this._engine),this._customWrappers[p].effect=M,this._customWrappers[p].drawContext&&(this._customWrappers[p].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new mM.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(M){if(this.noiseTexture!==M){if(this._noiseTexture=M,!M)return ZM(this._noiseCreation),void ZM(this._noiseProcessing);this._noiseCreation={process:RM,previousItem:null,nextItem:null},hM(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:yM,previousItem:null,nextItem:null},hM(this._noiseProcessing,this._positionProcessing)}}constructor(M,p,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(M),this._emitterInverseWorldMatrix=Q.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new Q.Ap,this.bb=new mM.b,this.onStoppedObservable=new mM.b,this.onStartedObservable=new mM.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.ko=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new k.Sb(0,0,0,0),this._colorDiff=new k.Sb(0,0,0,0),this._scaledDirection=Q.Ap.Zero(),this._scaledGravity=Q.Ap.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=M=>{},this.recycleParticle=M=>{const p=this.ko.pop();p!==M&&p.copyTo(M),this._stockParticles.push(p)},this._createParticle=()=>{let M;return 0!==this._stockParticles.length?(M=this._stockParticles.pop(),M._reset()):M=new l(this),this._prepareParticle(M),M},this.paused=!1,this._shadersLoaded=!1,this._capacity=p,this._epsilon=u,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=Q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||X.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qo.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:nM,previousItem:null,nextItem:null},this._positionCreation={process:KM,previousItem:null,nextItem:null},hM(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:HM,previousItem:null,nextItem:null},hM(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:gM,previousItem:null,nextItem:null},hM(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:PM,previousItem:null,nextItem:null},hM(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:UM,previousItem:null,nextItem:null},hM(this._angleCreation,this._sizeCreation),this._colorCreation={process:qM,previousItem:null,nextItem:null},hM(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,T||(this._colorProcessing={process:uM,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:OM,previousItem:null,nextItem:null},hM(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:jM,previousItem:null,nextItem:null},hM(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:sM,previousItem:null,nextItem:null},hM(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:xM,previousItem:null,nextItem:null},hM(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=B,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new MM.e(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new F,this.updateFunction=M=>{var p;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(p=this.noiseTexture.getContent())||void 0===p||p.then((M=>{this._noiseTextureData=M})));const b=M===this.ko;for(let Q=0;Q<M.length;Q++){const p=M[Q];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const q=p.age;if(p.age+=this._tempScaledUpdateSpeed,p.age>p.lifeTime){const M=p.age-q,b=p.lifeTime-q;this._tempScaledUpdateSpeed=b*this._tempScaledUpdateSpeed/M,p.age=p.lifeTime}this._ratio=p.age/p.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let B=this._updateQueueStart;for(;B;)B.process(p,this),B=B.nextItem;if(this._isAnimationSheetEnabled&&!T&&p.updateCellIndex(),p._inheritParticleInfoToSubEmitters(),p.age>=p.lifeTime){if(this._emitFromParticle(p),p._attachedSubEmitters){for(const M of p._attachedSubEmitters)M.particleSystem.disposeOnStop=!0,M.particleSystem.stop();p._attachedSubEmitters=null}this.recycleParticle(p),b&&Q--}else;}}}serialize(M){throw new Error("Method not implemented.")}clone(M,p){throw new Error("Method not implemented.")}_addFactorGradient(M,p,b,Q){const q=new e(p,b,Q);M.push(q),M.sort(((M,p)=>M.gradient<p.gradient?-1:M.gradient>p.gradient?1:0))}_removeFactorGradient(M,p){if(!M)return;let b=0;for(const Q of M){if(Q.gradient===p){M.splice(b,1);break}b++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=EM:this._lifeTimeCreation.process=nM}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:NM,previousItem:null,nextItem:null},hM(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(ZM(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(M){this.targetStopDuration!==M&&(this._targetStopDuration=M,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(M,p,b){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,M,p,b),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(M){return this._removeFactorGradient(this._lifeTimeGradients,M),this._syncLifeTimeCreation(),this}addSizeGradient(M,p,b){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=LM,this._sizeGradientProcessing={process:rM,previousItem:null,nextItem:null},VM(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,M,p,b),this}removeSizeGradient(M){var p;return this._removeFactorGradient(this._sizeGradients,M),0===(null===(p=this._sizeGradients)||void 0===p?void 0:p.length)&&(ZM(this._sizeGradientProcessing),this._sizeCreation.process=PM),this}addColorRemapGradient(M,p,b){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,M,p,b),this}removeColorRemapGradient(M){return this._removeFactorGradient(this._colorRemapGradients,M),this}addAlphaRemapGradient(M,p,b){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,M,p,b),this}removeAlphaRemapGradient(M){return this._removeFactorGradient(this._alphaRemapGradients,M),this}addAngularSpeedGradient(M,p,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=cM,this._angularSpeedGradientProcessing={process:TM,previousItem:null,nextItem:null},VM(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,M,p,b),this}removeAngularSpeedGradient(M){var p;return this._removeFactorGradient(this._angularSpeedGradients,M),0===(null===(p=this._angularSpeedGradients)||void 0===p?void 0:p.length)&&(this._angleCreation.process=UM,ZM(this._angularSpeedGradientProcessing)),this}addVelocityGradient(M,p,b){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:oM,previousItem:null,nextItem:null},hM(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:iM,previousItem:null,nextItem:null},VM(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,M,p,b),this}removeVelocityGradient(M){var p;return this._removeFactorGradient(this._velocityGradients,M),0===(null===(p=this._velocityGradients)||void 0===p?void 0:p.length)&&(ZM(this._velocityCreation),ZM(this._velocityGradientProcessing)),this}addLimitVelocityGradient(M,p,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:WM,previousItem:null,nextItem:null},hM(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:AM,previousItem:null,nextItem:null},hM(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,M,p,b),this}removeLimitVelocityGradient(M){var p;return this._removeFactorGradient(this._limitVelocityGradients,M),0===(null===(p=this._limitVelocityGradients)||void 0===p?void 0:p.length)&&(ZM(this._limitVelocityCreation),ZM(this._limitVelocityGradientProcessing)),this}addDragGradient(M,p,b){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:SM,previousItem:null,nextItem:null},VM(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:fM,previousItem:null,nextItem:null},VM(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,M,p,b),this}removeDragGradient(M){var p;return this._removeFactorGradient(this._dragGradients,M),0===(null===(p=this._dragGradients)||void 0===p?void 0:p.length)&&(ZM(this._dragCreation),ZM(this._dragGradientProcessing)),this}addEmitRateGradient(M,p,b){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,M,p,b),this}removeEmitRateGradient(M){return this._removeFactorGradient(this._emitRateGradients,M),this}addStartSizeGradient(M,p,b){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,M,p,b),this._syncStartSizeCreation(),this}removeStartSizeGradient(M){return this._removeFactorGradient(this._startSizeGradients,M),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const M=new Uint8Array(4*this._rawTextureWidth),p=k.TmpColors.ap[0];for(let b=0;b<this._rawTextureWidth;b++){const Q=b/this._rawTextureWidth;G.GetCurrentGradient(Q,this._rampGradients,((Q,q,B)=>{k.ap.LerpToRef(Q.color,q.color,B,p),M[4*b]=255*p.r,M[4*b+1]=255*p.g,M[4*b+2]=255*p.b,M[4*b+3]=255}))}this._rampGradientsTexture=C.e.CreateRGBATexture(M,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((M,p)=>M.gradient<p.gradient?-1:M.gradient>p.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(M,p){this._rampGradients||(this._rampGradients=[]);const b=new t(M,p);return this._rampGradients.push(b),this._syncRampGradientTexture(),this}removeRampGradient(M){return this._removeGradientAndTexture(M,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(M,p,b){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=BM,this._colorProcessing.process=kM);const Q=new z(M,p,b);return this._colorGradients.push(Q),this._colorGradients.sort(((M,p)=>M.gradient<p.gradient?-1:M.gradient>p.gradient?1:0)),this}removeColorGradient(M){if(!this._colorGradients)return this;let p=0;for(const b of this._colorGradients){if(b.gradient===M){this._colorGradients.splice(p,1);break}p++}return 0===this._colorGradients.length&&(this._colorCreation.process=qM,this._colorProcessing.process=uM),this}resetDrawCache(){if(this._drawWrappers){for(const M of this._drawWrappers)if(M)for(const p of M)null===p||void 0===p||p.dispose();this._drawWrappers=[]}}_fetchR(M,p,b,Q,q){return q[4*(((M=.5*Math.abs(M)+.5)*b%b|0)+((p=.5*Math.abs(p)+.5)*Q%Q|0)*b)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const M=this._engine,p=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*p),this._vertexBuffer=new S.d(M,this._vertexData,!0,p);let b=0;const Q=this._vertexBuffer.createVertexBuffer(S.f.PositionKind,b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[S.f.PositionKind]=Q,b+=3;const q=this._vertexBuffer.createVertexBuffer(S.f.ColorKind,b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[S.f.ColorKind]=q,b+=4;const B=this._vertexBuffer.createVertexBuffer("angle",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=B,b+=1;const k=this._vertexBuffer.createVertexBuffer("size",b,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=k,b+=2,this._isAnimationSheetEnabled){const M=this._vertexBuffer.createVertexBuffer("cellIndex",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=M,b+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const M=this._vertexBuffer.createVertexBuffer("direction",b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=M,b+=3}if(this._useRampGradients){const M=this._vertexBuffer.createVertexBuffer("remapData",b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=M,b+=4}let u;if(this._useInstancing){const p=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new S.d(M,p,!1,2),u=this._spriteBuffer.createVertexBuffer("offset",0,2)}else u=this._vertexBuffer.createVertexBuffer("offset",b,2,this._vertexBufferSize,this._useInstancing),b+=2;this._vertexBuffers.offset=u,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const M=[],p=[];let b=0;for(let Q=0;Q<this._capacity;Q++)M.push(b),M.push(b+1),M.push(b+2),M.push(b),M.push(b+2),M.push(b+3),p.push(b,b+1,b+1,b+2,b+2,b+3,b+3,b,b,b+3),b+=4;this._indexBuffer=this._engine.createIndexBuffer(M),this._linesIndexBuffer=this._engine.createIndexBuffer(p)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(M)setTimeout((()=>{this.start(0)}),M);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var p;-1!==(null===(p=this.Qp)||void 0===p?void 0:p.getClassName().indexOf("Mesh"))&&this.Qp.ib(!0);const M=this.noiseTexture;if(M&&M.onGeneratedObservable)M.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let p=0;p<this.preWarmCycles;p++)this.animate(!0),M.render()}))}));else for(let p=0;p<this.preWarmCycles;p++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(M))}_postStop(M){}reset(){this._stockParticles.length=0,this.ko.length=0}_appendParticleVertex(M,p,b,q){let B=M*this._vertexBufferSize;if(this._vertexData[B++]=p.position.x+this.RO.x,this._vertexData[B++]=p.position.y+this.RO.y,this._vertexData[B++]=p.position.z+this.RO.z,this._vertexData[B++]=p.color.r,this._vertexData[B++]=p.color.g,this._vertexData[B++]=p.color.b,this._vertexData[B++]=p.color.a,this._vertexData[B++]=p.angle,this._vertexData[B++]=p.scale.x*p.size,this._vertexData[B++]=p.scale.y*p.size,this._isAnimationSheetEnabled&&(this._vertexData[B++]=p.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[B++]=p.direction.x,this._vertexData[B++]=p.direction.y,this._vertexData[B++]=p.direction.z);else if(p._initialDirection){let M=p._initialDirection;this.isLocal&&(Q.Ap.TransformNormalToRef(M,this._emitterWorldMatrix,Q.TmpVectors.Ap[0]),M=Q.TmpVectors.Ap[0]),0===M.x&&0===M.z&&(M.x=.001),this._vertexData[B++]=M.x,this._vertexData[B++]=M.y,this._vertexData[B++]=M.z}else{let M=p.direction;this.isLocal&&(Q.Ap.TransformNormalToRef(M,this._emitterWorldMatrix,Q.TmpVectors.Ap[0]),M=Q.TmpVectors.Ap[0]),0===M.x&&0===M.z&&(M.x=.001),this._vertexData[B++]=M.x,this._vertexData[B++]=M.y,this._vertexData[B++]=M.z}this._useRampGradients&&p.remapData&&(this._vertexData[B++]=p.remapData.x,this._vertexData[B++]=p.remapData.y,this._vertexData[B++]=p.remapData.z,this._vertexData[B++]=p.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===b?b=this._epsilon:1===b&&(b=1-this._epsilon),0===q?q=this._epsilon:1===q&&(q=1-this._epsilon)),this._vertexData[B++]=b,this._vertexData[B++]=q)}_prepareParticle(M){}_createNewOnes(M){let p;for(let b=0;b<M&&this.ko.length!==this._capacity;b++){p=this._createParticle(),this.ko.push(p);let M=this._createQueueStart;for(;M;)M.process(p,this),M=M.nextItem;p._inheritParticleInfoToSubEmitters()}}_update(M){if(this._alive=this.ko.length>0,this.Qp.position){const M=this.Qp;this._emitterWorldMatrix=M.getWorldMatrix()}else{const M=this.Qp;this._emitterWorldMatrix=Q.Matrix.Translation(M.x,M.y,M.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.ko),this._createNewOnes(M)}static _GetAttributeNamesOrOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=[S.f.PositionKind,S.f.ColorKind,"angle","offset","size"];return M&&Q.push("cellIndex"),p||Q.push("direction"),b&&Q.push("remapData"),Q}static _GetEffectCreationOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,pM.d)(Q),M&&Q.push("particlesInfos"),p&&Q.push("logarithmicDepthConstant"),b&&(Q.push("vFogInfos"),Q.push("vFogColor")),Q}fillDefines(M,p){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,pM.i)(this,this._scene,M),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&M.push("#define FOG")),this._isAnimationSheetEnabled&&M.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&M.push("#define LOGARITHMICDEPTH"),p===T.BLENDMODE_MULTIPLY&&M.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&M.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(M.push("#define BILLBOARD"),this.billboardMode){case 2:M.push("#define BILLBOARDY");break;case 8:case 9:M.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&M.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:M.push("#define BILLBOARDMODE_ALL")}b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),M.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(M,p,b){p.push(...JM._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),M.push(...JM._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,QM.f)(M,this._imageProcessingConfigurationDefines),(0,QM.b)(b,this._imageProcessingConfigurationDefines))}_getWrapper(M){const p=this._getCustomDrawWrapper(M);if(null!==p&&void 0!==p&&p.effect)return p;const b=[];this.fillDefines(b,M);const Q=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let q=this._drawWrappers[Q];q||(q=this._drawWrappers[Q]=[]);let B=q[M];B||(B=new MM.e(this._engine),B.drawContext&&(B.drawContext.useInstancing=this._useInstancing),q[M]=B);const k=b.join("\n");if(B.defines!==k){const M=[],p=[],b=[];this.fillUniformsAttributesAndSamplerNames(p,M,b),B.setEffect(this._engine.createEffect("particles",M,p,b,k,void 0,void 0,void 0,void 0,this._shaderLanguage),k)}return B}animate(){var M;let p,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!b&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(b?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this.manualEmitCount>-1)p=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let M=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const p=this._actualFrame/this.targetStopDuration;G.GetCurrentGradient(p,this._emitRateGradients,((p,b,Q)=>{p!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=b.getFactor(),this._currentEmitRateGradient=p),M=(0,O.Lerp)(this._currentEmitRate1,this._currentEmitRate2,Q)}))}p=M*this._scaledUpdateSpeed|0,this._newPartsExcess+=M*this._scaledUpdateSpeed-p}if(this._newPartsExcess>1&&(p+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?p=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(p),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!b){let M=0;for(let p=0;p<this.ko.length;p++){const b=this.ko[p];this._appendParticleVertices(M,b),M+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.ko.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(M,p){this._appendParticleVertex(M++,p,0,0),this._useInstancing||(this._appendParticleVertex(M++,p,1,0),this._appendParticleVertex(M++,p,1,1),this._appendParticleVertex(M++,p,0,1))}rebuild(){var M;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(M=this._spriteBuffer)||void 0===M||M._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!JM.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(b.bind(b,13234)),Promise.resolve().then(b.bind(b,13183))])):await Promise.all([Promise.resolve().then(b.bind(b,13172)),Promise.resolve().then(b.bind(b,13159))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Qp||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==T.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(T.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(T.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(M){const p=this._getWrapper(M),b=p.effect,q=this._engine;q.enableEffect(p);const B=this.defaultViewMatrix??this._scene.getViewMatrix();if(b.setTexture("diffuseSampler",this.particleTexture),b.setMatrix("view",B),b.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const M=this.particleTexture.getBaseSize();b.setFloat3("particlesInfos",this.spriteCellWidth/M.width,this.spriteCellHeight/M.height,this.spriteCellWidth/M.width)}if(b.setVector2("translationPivot",this.translationPivot),b.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const M=this._scene.activeCamera;b.setVector3("eyePosition",M.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),b.setTexture("rampSampler",this._rampGradientsTexture));const k=b.defines;var u,T,O,H,F,o;(this._scene&&((0,pM.e)(b,this,this._scene),this.applyFog&&(0,bM.c)(this._scene,void 0,b)),k.indexOf("#define BILLBOARDMODE_ALL")>=0&&(B.invertToRef(Q.TmpVectors.Matrix[0]),b.setMatrix("invView",Q.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?q.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,b):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,b)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?q.bindBuffers(this._vertexBuffers,null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._linesIndexBuffer:this._indexBuffer,b):q.bindBuffers(this._vertexBuffers,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBufferUseInstancing:null,b);(this.useLogarithmicDepth&&this._scene&&(0,bM.e)(k,b,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(b),this._setEngineBasedOnBlendMode(M),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(b),this._useInstancing)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?q.drawElementsType(6,0,10,this.ko.length):q.drawArraysType(7,0,4,this.ko.length):null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?q.drawElementsType(1,0,10*this.ko.length):q.drawElementsType(0,0,6*this.ko.length);return this.ko.length}render(){if(!this.isReady()||!this.ko.length)return 0;const M=this._engine;M.setState&&(M.setState(!1),this.forceDepthWrite&&M.setDepthWrite(!0));let p=0;return p=this.blendMode===T.BLENDMODE_MULTIPLYADD?this._render(T.BLENDMODE_MULTIPLY)+this._render(T.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),p}_onDispose(){}dispose(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),M&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),M&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(p,b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const M=this._scene.qo.indexOf(this);M>-1&&this._scene.qo.splice(M,1),this._scene._activeParticleSystems.dispose()}this.bb.notifyObservers(this),this.bb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}JM.ForceGLSL=!1;var vM,zM=b(11651);!function(M){M[M.ATTACHED=0]="ATTACHED",M[M.END=1]="END"}(vM||(vM={}));class tM{constructor(M){if(this.particleSystem=M,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!M.Qp||!M.Qp.dispose){const p=(0,u.c)("BABYLON.AbstractMesh");M.Qp=new p("SubemitterSystemEmitter",M.RM()),M._disposeEmitterOnDispose=!0}}clone(){let M=this.particleSystem.Qp;if(M){if(M instanceof Q.Ap)M=M.clone();else if(-1!==M.getClassName().indexOf("Mesh")){M=new((0,u.c)("BABYLON.Mesh"))("",M.RM()),M.isVisible=!1}}else M=new Q.Ap;const p=new tM(this.particleSystem.clone(this.particleSystem.name,M));return p.particleSystem.name+="Clone",p.type=this.type,p.inheritDirection=this.inheritDirection,p.inheritedVelocityAmount=this.inheritedVelocityAmount,p.particleSystem._disposeEmitterOnDispose=!0,p.particleSystem.disposeOnStop=!0,p}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};return p.type=this.type,p.inheritDirection=this.inheritDirection,p.inheritedVelocityAmount=this.inheritedVelocityAmount,p.particleSystem=this.particleSystem.serialize(M),p}static _ParseParticleSystem(M,p,b){throw(0,zM.c)("ParseParticle")}static Parse(M,p,b){const Q=M.particleSystem,q=new tM(tM._ParseParticleSystem(Q,p,b,!0));return q.type=M.type,q.inheritDirection=M.inheritDirection,q.inheritedVelocityAmount=M.inheritedVelocityAmount,q.particleSystem._isSubEmitter=!0,q}dispose(){this.particleSystem.dispose()}}var eM=b(11700);function GM(M,p){const b=new K;return b.direction1=M,b.direction2=p,b}function mp(){return new j(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function CM(){return new D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function XM(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.Ap(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.Ap(0,1,0);return new a(M,p,b)}function lM(){return new i(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Mp(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.Ap(0,1,0),B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.Ap(0,1,0);return new A(M,p,b,q,B)}function pp(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new o(M,p)}function bp(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.Ap(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.Ap(0,1,0);return new W(M,p,b,q)}const Qp=Q.Ap.Zero(),qp=Q.Ap.Zero(),Bp=Q.Ap.Zero();class kp{constructor(){this.strength=0,this.position=Q.Ap.Zero()}_processParticle(M,p){this.position.subtractToRef(M.position,Qp);const b=Qp.lengthSquared()+1;Qp.normalize().scaleToRef(this.strength/b,qp),qp.scaleToRef(p._tempScaledUpdateSpeed,Bp),M.direction.addInPlace(Bp)}serialize(){return{position:this.position.Ob(),strength:this.strength}}}class upM extends JM{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=M=>{if(!this._subEmitters||0===this._subEmitters.length)return;const p=Math.floor(Math.random()*this._subEmitters.length);for(const b of this._subEmitters[p])if(1===b.type){const p=b.clone();M._inheritParticleInfoToSubEmitter(p),p.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(p.particleSystem),p.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(M,p){const b=GM(M,p);return this.particleEmitterType=b,b}get flowMap(){return this._flowMap}set flowMap(M){this._flowMap!==M&&(this._flowMap=M,this._flowMapUpdate&&(ZM(this._flowMapUpdate),this._flowMapUpdate=null),M&&(this._flowMapUpdate={process:M=>{var p;const b=null===(p=this.RM())||void 0===p?void 0:p.getTransformMatrix();this._flowMap._processParticle(M,this.flowMapStrength*this._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null},hM(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(M){this._attractors.push(M),1===this._attractors.length&&(this._attractorUpdate={process:M=>{for(const p of this._attractors)p._processParticle(M,this)},previousItem:null,nextItem:null},hM(this._attractorUpdate,this._directionProcessing))}removeAttractor(M){const p=this._attractors.indexOf(M);-1!==p&&this._attractors.splice(p,1),0===this._attractors.length&&ZM(this._attractorUpdate)}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(M)}createHemisphericEmitter(){const M=mp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createSphereEmitter(){const M=CM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createDirectedSphereEmitter(){const M=XM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.Ap(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.Ap(0,1,0));return this.particleEmitterType=M,M}createCylinderEmitter(){const M=lM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=M,M}createDirectedCylinderEmitter(){const M=Mp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.Ap(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.Ap(0,1,0));return this.particleEmitterType=M,M}createConeEmitter(){const M=pp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=M,M}createDirectedConeEmitter(){const M=bp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.Ap(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.Ap(0,1,0));return this.particleEmitterType=M,M}createBoxEmitter(M,p,b,Q){const q=new F;return this.particleEmitterType=q,this.direction1=M,this.direction2=p,this.minEmitBox=b,this.maxEmitBox=Q,q}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const M of this.subEmitters)M instanceof upM?this._subEmitters.push([new tM(M)]):M instanceof tM?this._subEmitters.push([M]):M instanceof Array&&this._subEmitters.push(M)}_stopSubEmitters(){if(this.activeSubSystems){for(const M of this.activeSubSystems)M.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const M=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==M&&this._rootParticleSystem.activeSubSystems.splice(M,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(M){M&&this._stopSubEmitters()}_prepareParticle(M){if(this._subEmitters&&this._subEmitters.length>0){const p=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];M._attachedSubEmitters=[];for(const b of p)if(0===b.type){const p=b.clone();M._attachedSubEmitters.push(p),p.particleSystem.start()}}}_onDispose(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),M&&this.particles)for(const b of this.particles)if(b._attachedSubEmitters)for(let M=b._attachedSubEmitters.length-1;M>=0;M-=1)b._attachedSubEmitters[M].dispose();if(p&&this.activeSubSystems)for(let b=this.activeSubSystems.length-1;b>=0;b-=1)this.activeSubSystems[b].dispose();if(this._subEmitters&&this._subEmitters.length){for(let M=0;M<this._subEmitters.length;M++)for(const p of this._subEmitters[M])p.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Qp&&this.Qp.dispose&&this.Qp.dispose(!0)}static _Parse(M,p,b,q){let B;B=b instanceof eM.c?null:b;const T=(0,u.c)("BABYLON.Texture");if(T&&B&&(M.texture?p.particleTexture=T.Parse(M.texture,B,q):M.textureName&&(p.particleTexture=new T(q+M.textureName,B,!1,void 0===M.invertY||M.invertY),p.particleTexture.name=M.textureName)),M.emitterId||0===M.emitterId||void 0!==M.Qp?M.emitterId&&B?p.Qp=B.getLastMeshById(M.emitterId):p.Qp=Q.Ap.sp(M.Qp):p.Qp=Q.Ap.Zero(),p.isLocal=!!M.isLocal,void 0!==M.renderingGroupId&&(p.renderingGroupId=M.renderingGroupId),void 0!==M.isBillboardBased&&(p.isBillboardBased=M.isBillboardBased),void 0!==M.billboardMode&&(p.billboardMode=M.billboardMode),void 0!==M.useLogarithmicDepth&&(p.useLogarithmicDepth=M.useLogarithmicDepth),M.animations){for(let b=0;b<M.animations.length;b++){const Q=M.animations[b],q=(0,u.c)("BABYLON.Animation");q&&p.animations.push(q.Parse(Q))}p.beginAnimationOnStart=M.beginAnimationOnStart,p.beginAnimationFrom=M.beginAnimationFrom,p.beginAnimationTo=M.beginAnimationTo,p.beginAnimationLoop=M.beginAnimationLoop}if(M.autoAnimate&&B&&B.beginAnimation(p,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1),p.startDelay=0|M.startDelay,p.minAngularSpeed=M.minAngularSpeed,p.maxAngularSpeed=M.maxAngularSpeed,p.minSize=M.minSize,p.maxSize=M.maxSize,M.minScaleX&&(p.minScaleX=M.minScaleX,p.maxScaleX=M.maxScaleX,p.minScaleY=M.minScaleY,p.maxScaleY=M.maxScaleY),void 0!==M.preWarmCycles&&(p.preWarmCycles=M.preWarmCycles,p.preWarmStepOffset=M.preWarmStepOffset),void 0!==M.minInitialRotation&&(p.minInitialRotation=M.minInitialRotation,p.maxInitialRotation=M.maxInitialRotation),p.minLifeTime=M.minLifeTime,p.maxLifeTime=M.maxLifeTime,p.minEmitPower=M.minEmitPower,p.maxEmitPower=M.maxEmitPower,p.emitRate=M.emitRate,p.gravity=Q.Ap.sp(M.gravity),M.noiseStrength&&(p.noiseStrength=Q.Ap.sp(M.noiseStrength)),p.color1=k.Sb.sp(M.color1),p.color2=k.Sb.sp(M.color2),p.colorDead=k.Sb.sp(M.colorDead),p.updateSpeed=M.updateSpeed,p.targetStopDuration=M.targetStopDuration,p.blendMode=M.blendMode,M.colorGradients)for(const Q of M.colorGradients)p.addColorGradient(Q.gradient,k.Sb.sp(Q.color1),Q.color2?k.Sb.sp(Q.color2):void 0);if(M.rampGradients){for(const b of M.rampGradients)p.addRampGradient(b.gradient,k.ap.sp(b.color));p.useRampGradients=M.useRampGradients}if(M.colorRemapGradients)for(const Q of M.colorRemapGradients)p.addColorRemapGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(M.alphaRemapGradients)for(const Q of M.alphaRemapGradients)p.addAlphaRemapGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(M.sizeGradients)for(const Q of M.sizeGradients)p.addSizeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(M.angularSpeedGradients)for(const Q of M.angularSpeedGradients)p.addAngularSpeedGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(M.velocityGradients)for(const Q of M.velocityGradients)p.addVelocityGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(M.dragGradients)for(const Q of M.dragGradients)p.addDragGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(M.emitRateGradients)for(const Q of M.emitRateGradients)p.addEmitRateGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(M.startSizeGradients)for(const Q of M.startSizeGradients)p.addStartSizeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(M.lifeTimeGradients)for(const Q of M.lifeTimeGradients)p.addLifeTimeGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);if(M.limitVelocityGradients){for(const b of M.limitVelocityGradients)p.addLimitVelocityGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);p.limitVelocityDamping=M.limitVelocityDamping}if(M.noiseTexture&&B){const b=(0,u.c)("BABYLON.ProceduralTexture");p.noiseTexture=b.Parse(M.noiseTexture,B,q)}let O;if(M.particleEmitterType){switch(M.particleEmitterType.type){case"SphereParticleEmitter":O=new D;break;case"SphereDirectedParticleEmitter":O=new a;break;case"ConeEmitter":case"ConeParticleEmitter":O=new o;break;case"ConeDirectedParticleEmitter":O=new W;break;case"CylinderParticleEmitter":O=new i;break;case"CylinderDirectedParticleEmitter":O=new A;break;case"HemisphericParticleEmitter":O=new j;break;case"PointParticleEmitter":O=new K;break;case"MeshParticleEmitter":O=new f;break;case"CustomParticleEmitter":O=new s;break;default:O=new F}O.parse(M.particleEmitterType,B)}else O=new F,O.parse(M,B);p.particleEmitterType=O,p.startSpriteCellID=M.startSpriteCellID,p.endSpriteCellID=M.endSpriteCellID,p.spriteCellLoop=M.spriteCellLoop??!0,p.spriteCellWidth=M.spriteCellWidth,p.spriteCellHeight=M.spriteCellHeight,p.spriteCellChangeSpeed=M.spriteCellChangeSpeed,p.spriteRandomStartCell=M.spriteRandomStartCell,p.disposeOnStop=M.disposeOnStop??!1,p.manualEmitCount=M.manualEmitCount??-1}static Parse(M,p,b){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const u=M.name;let T,O,H=null,F=null;if(p instanceof eM.c?T=p:(O=p,T=O.getEngine()),M.customShader&&T.createEffectForParticles){F=M.customShader;const p=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"";H=T.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,p)}const o=new upM(u,B||M.fp,p,H,M.isAnimationSheetEnabled);if(o.customShader=F,o._rootUrl=b,M.id&&(o.id=M.id),M.subEmitters){o.subEmitters=[];for(const Q of M.subEmitters){const M=[];for(const q of Q)M.push(tM.Parse(q,p,b));o.subEmitters.push(M)}}if(M.attractors)for(const k of M.attractors){const M=new kp;M.position=Q.Ap.sp(k.position),M.strength=k.strength,o.addAttractor(M)}return upM._Parse(M,o,p,b),M.textureMask&&(o.textureMask=k.Sb.sp(M.textureMask)),M.RO&&(o.RO=Q.Ap.sp(M.RO)),M.preventAutoStart&&(o.preventAutoStart=M.preventAutoStart),q||o.preventAutoStart||o.start(),o}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};if(upM._Serialize(p,this,M),p.textureMask=this.textureMask.Ob(),p.customShader=this.customShader,p.preventAutoStart=this.preventAutoStart,p.RO=this.RO.Ob(),this.subEmitters){p.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const b of this._subEmitters){const Q=[];for(const p of b)Q.push(p.serialize(M));p.subEmitters.push(Q)}}if(this._attractors&&this._attractors.length){p.attractors=[];for(const M of this._attractors)p.attractors.push(M.serialize())}return p}static _Serialize(M,p,b){if(M.name=p.name,M.id=p.id,M.fp=p.getCapacity(),M.disposeOnStop=p.disposeOnStop,M.manualEmitCount=p.manualEmitCount,p.Qp.position){const b=p.Qp;M.emitterId=b.id}else{const b=p.Qp;M.Qp=b.Ob()}p.particleEmitterType&&(M.particleEmitterType=p.particleEmitterType.serialize()),p.particleTexture&&(b?M.texture=p.particleTexture.serialize():(M.textureName=p.particleTexture.name,M.invertY=!!p.particleTexture._invertY)),M.isLocal=p.isLocal,E.b.AppendSerializedAnimations(p,M),M.beginAnimationOnStart=p.beginAnimationOnStart,M.beginAnimationFrom=p.beginAnimationFrom,M.beginAnimationTo=p.beginAnimationTo,M.beginAnimationLoop=p.beginAnimationLoop,M.startDelay=p.startDelay,M.renderingGroupId=p.renderingGroupId,M.isBillboardBased=p.isBillboardBased,M.billboardMode=p.billboardMode,M.minAngularSpeed=p.minAngularSpeed,M.maxAngularSpeed=p.maxAngularSpeed,M.minSize=p.minSize,M.maxSize=p.maxSize,M.minScaleX=p.minScaleX,M.maxScaleX=p.maxScaleX,M.minScaleY=p.minScaleY,M.maxScaleY=p.maxScaleY,M.minEmitPower=p.minEmitPower,M.maxEmitPower=p.maxEmitPower,M.minLifeTime=p.minLifeTime,M.maxLifeTime=p.maxLifeTime,M.emitRate=p.emitRate,M.gravity=p.gravity.Ob(),M.noiseStrength=p.noiseStrength.Ob(),M.color1=p.color1.Ob(),M.color2=p.color2.Ob(),M.colorDead=p.colorDead.Ob(),M.updateSpeed=p.updateSpeed,M.targetStopDuration=p.targetStopDuration,M.blendMode=p.blendMode,M.preWarmCycles=p.preWarmCycles,M.preWarmStepOffset=p.preWarmStepOffset,M.minInitialRotation=p.minInitialRotation,M.maxInitialRotation=p.maxInitialRotation,M.startSpriteCellID=p.startSpriteCellID,M.spriteCellLoop=p.spriteCellLoop,M.endSpriteCellID=p.endSpriteCellID,M.spriteCellChangeSpeed=p.spriteCellChangeSpeed,M.spriteCellWidth=p.spriteCellWidth,M.spriteCellHeight=p.spriteCellHeight,M.spriteRandomStartCell=p.spriteRandomStartCell,M.isAnimationSheetEnabled=p.isAnimationSheetEnabled,M.useLogarithmicDepth=p.useLogarithmicDepth;const Q=p.getColorGradients();if(Q){M.colorGradients=[];for(const p of Q){const b={gradient:p.gradient,color1:p.color1.Ob()};p.color2?b.color2=p.color2.Ob():b.color2=p.color1.Ob(),M.colorGradients.push(b)}}const q=p.getRampGradients();if(q){M.rampGradients=[];for(const p of q){const b={gradient:p.gradient,color:p.color.Ob()};M.rampGradients.push(b)}M.useRampGradients=p.useRampGradients}const B=p.getColorRemapGradients();if(B){M.colorRemapGradients=[];for(const p of B){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.colorRemapGradients.push(b)}}const k=p.getAlphaRemapGradients();if(k){M.alphaRemapGradients=[];for(const p of k){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.alphaRemapGradients.push(b)}}const u=p.getSizeGradients();if(u){M.sizeGradients=[];for(const p of u){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.sizeGradients.push(b)}}const T=p.getAngularSpeedGradients();if(T){M.angularSpeedGradients=[];for(const p of T){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.angularSpeedGradients.push(b)}}const O=p.getVelocityGradients();if(O){M.velocityGradients=[];for(const p of O){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.velocityGradients.push(b)}}const H=p.getDragGradients();if(H){M.dragGradients=[];for(const p of H){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.dragGradients.push(b)}}const F=p.getEmitRateGradients();if(F){M.emitRateGradients=[];for(const p of F){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.emitRateGradients.push(b)}}const o=p.getStartSizeGradients();if(o){M.startSizeGradients=[];for(const p of o){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.startSizeGradients.push(b)}}const W=p.getLifeTimeGradients();if(W){M.lifeTimeGradients=[];for(const p of W){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.lifeTimeGradients.push(b)}}const i=p.getLimitVelocityGradients();if(i){M.limitVelocityGradients=[];for(const p of i){const b={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?b.factor2=p.factor2:b.factor2=p.factor1,M.limitVelocityGradients.push(b)}M.limitVelocityDamping=p.limitVelocityDamping}p.noiseTexture&&(M.noiseTexture=p.noiseTexture.serialize())}clone(M,p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q={...this._customWrappers};let q=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){q=this.customShader;const M=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"",p=B.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,M);Q[0]?Q[0].effect=p:this.setCustomEffect(p,0)}const k=this.serialize(b),u=upM.Parse(k,this._scene||this._engine,this._rootUrl);return u.name=M,u.customShader=q,u._customWrappers=Q,void 0===p&&(p=this.Qp),this.noiseTexture&&(u.noiseTexture=this.noiseTexture.clone()),u.Qp=p,this.preventAutoStart||u.start(),u}}upM.BILLBOARDMODE_Y=2,upM.BILLBOARDMODE_ALL=7,upM.BILLBOARDMODE_STRETCHED=8,upM.BILLBOARDMODE_STRETCHED_LOCAL=9,tM._ParseParticleSystem=upM.Parse;var Tp=b(12038),Op=b(12033),Hp=b(11911);Hp.e.prototype.createTransformFeedback=function(){const M=this._gl.createTransformFeedback();if(!M)throw new Error("Unable to create Transform Feedback");return M},Hp.e.prototype.deleteTransformFeedback=function(M){this._gl.deleteTransformFeedback(M)},Hp.e.prototype.bindTransformFeedback=function(M){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,M)},Hp.e.prototype.beginTransformFeedback=function(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(M?this._gl.POINTS:this._gl.TRIANGLES)},Hp.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Hp.e.prototype.setTranformFeedbackVaryings=function(M,p){this._gl.transformFeedbackVaryings(M,p,this._gl.INTERLEAVED_ATTRIBS)},Hp.e.prototype.bindTransformFeedbackBuffer=function(M){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,M?M.underlyingResource:null)},Hp.e.prototype.readTransformFeedbackBuffer=function(M){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,M)};const Fp="clipPlaneFragmentDeclaration2",op="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";y.d.IncludesShadersStore[Fp]||(y.d.IncludesShadersStore[Fp]=op);b(13056),b(13065),b(13067),b(13075),b(13084),b(13091),b(13099),b(13106);const Wp="gpuRenderParticlesPixelShader",ip="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";y.d.ShadersStore[Wp]||(y.d.ShadersStore[Wp]=ip);const Ap="clipPlaneVertexDeclaration2",jp="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";y.d.IncludesShadersStore[Ap]||(y.d.IncludesShadersStore[Ap]=jp);b(13115),b(13117),b(13126),b(13128);const Kp="gpuRenderParticlesVertexShader",Dp="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";y.d.ShadersStore[Kp]||(y.d.ShadersStore[Kp]=Dp);class ap extends T{static get IsSupported(){if(!X.c.LastCreatedEngine)return!1;const M=X.c.LastCreatedEngine.getCaps();return M.supportTransformFeedbacks||M.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(M){this._maxActiveParticleCount=Math.min(M,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(M){this.maxActiveParticleCount=M}createPointEmitter(M,p){const b=GM(M,p);return this.particleEmitterType=b,b}createHemisphericEmitter(){const M=mp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createSphereEmitter(){const M=CM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createDirectedSphereEmitter(){const M=XM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Q.Ap(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.Ap(0,1,0));return this.particleEmitterType=M,M}createCylinderEmitter(){const M=lM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=M,M}createDirectedCylinderEmitter(){const M=Mp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.Ap(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Q.Ap(0,1,0));return this.particleEmitterType=M,M}createConeEmitter(){const M=pp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=M,M}createDirectedConeEmitter(){const M=bp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Q.Ap(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Q.Ap(0,1,0));return this.particleEmitterType=M,M}createBoxEmitter(M,p,b,Q){const q=new F;return this.particleEmitterType=q,this.direction1=M,this.direction2=p,this.minEmitBox=b,this.maxEmitBox=Q,q}get flowMap(){return this._flowMap}set flowMap(M){this._flowMap!==M&&(this._flowMap=M)}isReady(){if(!this.Qp||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==upM.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(upM.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(upM.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";M?setTimeout((()=>{this.start(0)}),M):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var M;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(M=this._customWrappers[p])||void 0===M?void 0:M.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[M]??this._customWrappers[0]}setCustomEffect(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[p]=new MM.e(this._engine),this._customWrappers[p].effect=M}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new mM.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(M,p,b){return super._removeGradientAndTexture(M,p,b),this._releaseBuffers(),this}addColorGradient(M,p){this._colorGradients||(this._colorGradients=[]);const b=new z(M,p);return this._colorGradients.push(b),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(M&&this._colorGradients.sort(((M,p)=>M.gradient<p.gradient?-1:M.gradient>p.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(M){return this._removeGradientAndTexture(M,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const p in this._drawWrappers){var M;null===(M=this._drawWrappers[p].drawContext)||void 0===M||M.reset()}}_addFactorGradient(M,p,b){const Q=new e(p,b);M.push(Q),this._releaseBuffers()}addSizeGradient(M,p){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,M,p),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(M){return this._removeGradientAndTexture(M,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(M,p){if(!M)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&M.sort(((M,p)=>M.gradient<p.gradient?-1:M.gradient>p.gradient?1:0));const b=this;b[p]&&(b[p].dispose(),b[p]=null)}addAngularSpeedGradient(M,p){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,M,p),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(M){return this._removeGradientAndTexture(M,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(M,p){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,M,p),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(M){return this._removeGradientAndTexture(M,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(M,p){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,M,p),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(M){return this._removeGradientAndTexture(M,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(M,p){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,M,p),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(M){return this._removeGradientAndTexture(M,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(M){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(M,p,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(M),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.bb=new mM.b,this.onStoppedObservable=new mM.b,this.onStartedObservable=new mM.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=Q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||X.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qo.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,u.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,u.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,u.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,u.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new MM.e(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers={0:new MM.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(p=p??{}).randomTextureSize||delete p.randomTextureSize;const k={fp:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...p},T=p;isFinite(T)&&(k.fp=T),this._capacity=k.fp,this._maxActiveParticleCount=k.fp,this._currentActiveCount=0,this._isAnimationSheetEnabled=B,this.particleEmitterType=new F;const O=Math.min(this._engine.getCaps().maxTextureSize,k.randomTextureSize);let H=[];for(let Q=0;Q<O;++Q)H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random());this._randomTexture=new C.e(new Float32Array(H),O,1,5,b,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,H=[];for(let Q=0;Q<O;++Q)H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random());this._randomTexture2=new C.e(new Float32Array(H),O,1,5,b,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=O}_reset(){this._releaseBuffers()}_createVertexBuffers(M,p,b){const Q={};Q.position=p.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let q=3;Q.age=p.createVertexBuffer("age",q,1,this._attributesStrideSize,!0),q+=1,Q.size=p.createVertexBuffer("size",q,3,this._attributesStrideSize,!0),q+=3,Q.life=p.createVertexBuffer("life",q,1,this._attributesStrideSize,!0),q+=1,q+=4,this.billboardMode===upM.BILLBOARDMODE_STRETCHED&&(Q.direction=p.createVertexBuffer("direction",q,3,this._attributesStrideSize,!0)),q+=3,this._platform.alignDataInBuffer&&(q+=1),this.particleEmitterType instanceof s&&(q+=3,this._platform.alignDataInBuffer&&(q+=1)),this._colorGradientsTexture||(Q.color=p.createVertexBuffer("color",q,4,this._attributesStrideSize,!0),q+=4),this._isBillboardBased||(Q.initialDirection=p.createVertexBuffer("initialDirection",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),this.noiseTexture&&(Q.noiseCoordinates1=p.createVertexBuffer("noiseCoordinates1",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1),Q.noiseCoordinates2=p.createVertexBuffer("noiseCoordinates2",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),Q.angle=p.createVertexBuffer("angle",q,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?q++:q+=2,this._isAnimationSheetEnabled&&(Q.cellIndex=p.createVertexBuffer("cellIndex",q,1,this._attributesStrideSize,!0),q+=1,this.spriteRandomStartCell&&(Q.cellStartOffset=p.createVertexBuffer("cellStartOffset",q,1,this._attributesStrideSize,!0),q+=1)),Q.offset=b.createVertexBuffer("offset",0,2),Q.uv=b.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(Q),this._platform.createVertexBuffers(M,Q),this.resetDrawCache()}_initialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!M)return;const p=this._engine,b=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof s&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const q=this.particleEmitterType instanceof s,B=Q.TmpVectors.Ap[0];let k=0;for(let Q=0;Q<this._capacity;Q++)if(b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),q?(this.particleEmitterType.particleDestinationGenerator(Q,null,B),b.push(B.x),b.push(B.y),b.push(B.z)):(b.push(0),b.push(0),b.push(0)),this._platform.alignDataInBuffer&&b.push(0),k+=16,q&&(this.particleEmitterType.particlePositionGenerator(Q,null,B),b.push(B.x),b.push(B.y),b.push(B.z),this._platform.alignDataInBuffer&&b.push(0),k+=4),this._colorGradientsTexture||(b.push(0),b.push(0),b.push(0),b.push(0),k+=4),this.isBillboardBased||(b.push(0),b.push(0),b.push(0),this._platform.alignDataInBuffer&&b.push(0),k+=4),this.noiseTexture&&(b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),k+=8),b.push(0),k+=1,this._angularSpeedGradientsTexture||(b.push(0),k+=1),this._isAnimationSheetEnabled&&(b.push(0),k+=1,this.spriteRandomStartCell&&(b.push(0),k+=1)),this._platform.alignDataInBuffer){let M=3-(k+3&3);for(k+=M;M-- >0;)b.push(0)}const u=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),T=this._platform.createParticleBuffer(b),O=this._platform.createParticleBuffer(b);this._buffer0=new S.d(p,T,!1,this._attributesStrideSize),this._buffer1=new S.d(p,O,!1,this._attributesStrideSize),this._spriteBuffer=new S.d(p,u,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let M=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(M+="\n#define BILLBOARD"),this._colorGradientsTexture&&(M+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(M+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(M+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(M+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(M+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(M+="\n#define DRAGGRADIENTS"),this._flowMap&&(M+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(M+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(M+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(M+="\n#define NOISE"),this.isLocal&&(M+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===M||(this._cachedUpdateDefines=M,this._updateBuffer=this._platform.createUpdateBuffer(M)),this._platform.isUpdateBufferReady()}_getWrapper(M){const p=this._getCustomDrawWrapper(M);if(null!==p&&void 0!==p&&p.effect)return p;const b=[];this.fillDefines(b,M);let Q=this._drawWrappers[M];Q||(Q=new MM.e(this._engine),Q.drawContext&&(Q.drawContext.useInstancing=!0),this._drawWrappers[M]=Q);const q=b.join("\n");if(Q.defines!==q){const M=[],p=[],b=[];this.fillUniformsAttributesAndSamplerNames(p,M,b),Q.setEffect(this._engine.createEffect("gpuRenderParticles",M,p,b,q),q)}return Q}static _GetAttributeNamesOrOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const q=[S.f.PositionKind,"age","life","size","angle"];return M||q.push(S.f.ColorKind),p&&q.push("cellIndex"),b||q.push("initialDirection"),Q&&q.push("direction"),q.push("offset",S.f.UVKind),q}static _GetEffectCreationOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=["emitterWM","RO","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,pM.d)(Q),M&&Q.push("sheetInfos"),p&&Q.push("logarithmicDepthConstant"),b&&(Q.push("vFogInfos"),Q.push("vFogColor")),Q}fillDefines(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,pM.i)(this,this._scene,M),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Op.e.FOGMODE_NONE&&M.push("#define FOG")),p===upM.BLENDMODE_MULTIPLY&&M.push("#define BLENDMULTIPLYMODE"),this.isLocal&&M.push("#define LOCAL"),this.useLogarithmicDepth&&M.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(M.push("#define BILLBOARD"),this.billboardMode){case upM.BILLBOARDMODE_Y:M.push("#define BILLBOARDY");break;case upM.BILLBOARDMODE_STRETCHED:M.push("#define BILLBOARDSTRETCHED");break;case upM.BILLBOARDMODE_ALL:M.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&M.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&M.push("#define ANIMATESHEET"),b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),M.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(M,p,b){p.push(...ap._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===upM.BILLBOARDMODE_STRETCHED)),M.push(...ap._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Tp.d.PrepareUniforms(M,this._imageProcessingConfigurationDefines),Tp.d.PrepareSamplers(b,this._imageProcessingConfigurationDefines))}animate(){var M;let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(p?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(M,p){const b=this[p];if(!M||!M.length||b)return;const Q=new Float32Array(this._rawTextureWidth);for(let q=0;q<this._rawTextureWidth;q++){const p=q/this._rawTextureWidth;G.GetCurrentGradient(p,M,((M,p,b)=>{Q[q]=(0,O.Lerp)(M.factor1,p.factor1,b)}))}this[p]=C.e.CreateRTexture(Q,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[p].name=p.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const M=new Uint8Array(4*this._rawTextureWidth),p=k.TmpColors.Sb[0];for(let b=0;b<this._rawTextureWidth;b++){const Q=b/this._rawTextureWidth;G.GetCurrentGradient(Q,this._colorGradients,((Q,q,B)=>{k.Sb.LerpToRef(Q.color1,q.color1,B,p),M[4*b]=255*p.r,M[4*b+1]=255*p.g,M[4*b+2]=255*p.b,M[4*b+3]=255*p.a}))}this._colorGradientsTexture=C.e.CreateRGBATexture(M,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(M,p){var b,q,B,k;const u=this._getWrapper(M),T=u.effect;this._engine.enableEffect(u);const O=(null===(b=this._scene)||void 0===b?void 0:b.getViewMatrix())||Q.Matrix.IdentityReadOnly;if(T.setMatrix("view",O),T.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),T.setTexture("diffuseSampler",this.particleTexture),T.setVector2("translationPivot",this.translationPivot),T.setVector3("RO",this.RO),this.isLocal&&T.setMatrix("emitterWM",p),this._colorGradientsTexture?T.setTexture("colorGradientSampler",this._colorGradientsTexture):T.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const M=this.particleTexture.getBaseSize();T.setFloat3("sheetInfos",this.spriteCellWidth/M.width,this.spriteCellHeight/M.height,M.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const M=this._scene.activeCamera;T.setVector3("eyePosition",M.globalPosition)}const H=T.defines;if(this._scene&&((0,pM.e)(T,this,this._scene),this.applyFog&&(0,bM.c)(this._scene,void 0,T)),H.indexOf("#define BILLBOARDMODE_ALL")>=0){const M=O.clone();M.invert(),T.setMatrix("invView",M)}return this.useLogarithmicDepth&&this._scene&&(0,bM.e)(H,T,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(T),this._setEngineBasedOnBlendMode(M),this._platform.bindDrawBuffers(this._targetIndex,T,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(T),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(k=this._scene)&&void 0!==k&&k.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(M){if(!this.Qp||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!M)if(this.Qp.position){M=this.Qp.getWorldMatrix()}else{const p=this.Qp;M=Q.TmpVectors.Matrix[0],Q.Matrix.TranslationToRef(p.x,p.y,p.z,M)}const p=this._engine,b=p.getDepthWrite();if(p.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const M=this.RM();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",M.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",M),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=q,p.setDepthWrite(b)}render(){let M,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!p&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let M=0;M<this.preWarmCycles;M++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const M=0|this._accumulatedCount;this._accumulatedCount-=M,this._currentActiveCount+=M}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Qp.position){M=this.Qp.getWorldMatrix()}else{const p=this.Qp;M=Q.TmpVectors.Matrix[0],Q.Matrix.TranslationToRef(p.x,p.y,p.z,M)}const q=this._engine;this.updateInAnimate||this._update(M);let B=0;return p||b||(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0),B=this.blendMode===upM.BLENDMODE_MULTIPLYADD?this._render(upM.BLENDMODE_MULTIPLY,M)+this._render(upM.BLENDMODE_ADD,M):this._render(this.blendMode,M),this._engine.setAlphaMode(0)),B}rebuild(){const M=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(M,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,M()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const p in this._drawWrappers){this._drawWrappers[p].dispose()}if(this._drawWrappers={},this._scene){const M=this._scene.qo.indexOf(this);M>-1&&this._scene.qo.splice(M,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let p=0;p<this._renderVertexBuffers.length;++p){const M=this._renderVertexBuffers[p];for(const p in M)M[p].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),M&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),M&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.bb.notifyObservers(this),this.bb.clear()}clone(M,p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q={...this._customWrappers};let q=null;const B=this._engine;if(B.createEffectForParticles&&null!=this.customShader){q=this.customShader;const M=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"";Q[0]=B.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,M,void 0,void 0,void 0,this)}const k=this.serialize(b),u=ap.Parse(k,this._scene||this._engine,this._rootUrl);return u.name=M,u.customShader=q,u._customWrappers=Q,void 0===p&&(p=this.Qp),this.noiseTexture&&(u.noiseTexture=this.noiseTexture.clone()),u.Qp=p,u}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};return upM._Serialize(p,this,M),p.activeParticleCount=this.activeParticleCount,p.randomTextureSize=this._randomTextureSize,p.customShader=this.customShader,p}static Parse(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0;const B=M.name;let k,u;p instanceof eM.c?k=p:(u=p,k=u.getEngine());const T=new ap(B,{fp:q||M.fp,randomTextureSize:M.randomTextureSize},p,null,M.isAnimationSheetEnabled);if(T._rootUrl=b,M.customShader&&k.createEffectForParticles){const p=M.customShader,b=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"",Q=k.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,b,void 0,void 0,void 0,T);T.setCustomEffect(Q,0),T.customShader=p}return M.id&&(T.id=M.id),M.activeParticleCount&&(T.activeParticleCount=M.activeParticleCount),upM._Parse(M,T,p,b),M.preventAutoStart&&(T.preventAutoStart=M.preventAutoStart),Q||T.preventAutoStart||T.start(),T}}var sp=b(11621),Sp=b(13135),fp=b(12175);class Rp{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(M){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const p of this.systems)p.Qp=M;this._emitterNode=M}setEmitterAsSphere(M,p,b){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:M,renderingGroupId:p};const Q=(0,Sp.e)("emitterSphere",{diameter:M.diameter,segments:M.segments},b);Q.renderingGroupId=p;const q=new fp.Dp("emitterSphereMaterial",b);q.emissiveColor=M.color,Q.material=q;for(const B of this.systems)B.Qp=Q;this._emitterNode=Q}start(M){for(const p of this.systems)M&&(p.Qp=M),p.start()}dispose(){for(const M of this.systems)M.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={systems:[]};for(const b of this.systems)p.systems.push(b.serialize(M));return this._emitterNode&&(p.Qp=this._emitterCreationOptions),p}static Parse(M,p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;const q=new Rp,B=this.BaseAssetsUrl+"/textures/";p=p||X.c.LastCreatedScene;for(const k of M.systems)q.systems.push(b?ap.Parse(k,p,B,!0,Q):upM.Parse(k,p,B,!0,Q));if(M.Qp){const b=M.Qp.options;if("Sphere"===M.Qp.kind)q.setEmitterAsSphere({diameter:b.diameter,segments:b.segments,color:k.ap.sp(b.color)},M.Qp.renderingGroupId,p)}return q}}Rp.BaseAssetsUrl="https://assets.babylonjs.com/particles";var yp=b(11660);class xp{static CreateDefault(M){let p,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,Q=arguments.length>2?arguments[2]:void 0;p=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ap("default system",{fp:b},Q):new upM("default system",b,Q),p.Qp=M;const q=sp.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return p.particleTexture=new n.b(q,p.RM()),p.createConeEmitter(.1,Math.PI/4),p.color1=new k.Sb(1,1,1,1),p.color2=new k.Sb(1,1,1,1),p.colorDead=new k.Sb(1,1,1,0),p.minSize=.1,p.maxSize=.1,p.minEmitPower=2,p.maxEmitPower=2,p.updateSpeed=1/60,p.emitRate=30,p}static CreateAsync(M,p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;p||(p=X.c.LastCreatedScene);const q={};return p.addPendingData(q),new Promise(((B,k)=>{if(b&&!ap.IsSupported)return p.removePendingData(q),k("Particle system with GPU is not supported.");sp.Tools.LoadFile(`${xp.BaseAssetsUrl}/systems/${M}.json`,(M=>{p.removePendingData(q);const k=JSON.parse(M.toString());return B(Rp.Parse(k,p,b,Q))}),void 0,void 0,void 0,(()=>(p.removePendingData(q),k(`An error occurred with the creation of your particle system. Check if your type '${M}' exists.`))))}))}static ExportSet(M){const p=new Rp;for(const b of M)p.systems.push(b);return p}static ParseFromFileAsync(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",B=arguments.length>5?arguments[5]:void 0;return new Promise(((k,u)=>{const T=new yp.b;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){const p=JSON.parse(T.responseText);let u;u=Q?ap.Parse(p,b,q,!1,B):upM.Parse(p,b,q,!1,B),M&&(u.name=M),k(u)}else u("Unable to load the particle system")})),T.open("GET",p),T.send()}))}static ParseFromSnippetAsync(M,p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",q=arguments.length>4?arguments[4]:void 0;if("_BLANK"===M){const M=this.CreateDefault(null);return M.start(),Promise.resolve(M)}return new Promise(((B,k)=>{const u=new yp.b;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const k=JSON.parse(JSON.parse(u.responseText).jsonPayload),T=JSON.parse(k.particleSystem);let O;O=b?ap.Parse(T,p,Q,!1,q):upM.Parse(T,p,Q,!1,q),O.snippetId=M,B(O)}else k("Unable to load the snippet "+M)})),u.open("GET",this.SnippetUrl+"/"+M.replace(/#/g,"/")),u.send()}))}}xp.BaseAssetsUrl=Rp.BaseAssetsUrl,xp.SnippetUrl="https://snippet.babylonjs.com",xp.CreateFromSnippetAsync=xp.ParseFromSnippetAsync;var Pp=b(12257),Lp=b(12073),Np=b(13143);(0,Np.e)(Lp.c.NAME_PARTICLESYSTEM,((M,p,b,Q)=>{const q=(0,Np.g)(Lp.c.NAME_PARTICLESYSTEM);if(q&&void 0!==M.qo&&null!==M.qo)for(let B=0,k=M.qo.length;B<k;B++){const k=M.qo[B];b.qo.push(q(k,p,Q))}})),(0,Np.d)(Lp.c.NAME_PARTICLESYSTEM,((M,p,b)=>{if(M.activeParticleCount){return ap.Parse(M,p,b)}return upM.Parse(M,p,b)})),eM.c.prototype.createEffectForParticles=function(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,T=arguments.length>7?arguments[7]:void 0,O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,H=arguments.length>9?arguments[9]:void 0,F=[],o=[];const W=[];return T?T.fillUniformsAttributesAndSamplerNames(o,F,W):(F=upM._GetAttributeNamesOrOptions(),o=upM._GetEffectCreationOptions()),-1===q.indexOf(" BILLBOARD")&&(q+="\n#define BILLBOARD\n"),null!==T&&void 0!==T&&T.isAnimationSheetEnabled&&-1===q.indexOf(" ANIMATESHEET")&&(q+="\n#define ANIMATESHEET\n"),-1===Q.indexOf("diffuseSampler")&&Q.push("diffuseSampler"),this.createEffect({vertex:H??(null===T||void 0===T?void 0:T.vertexShaderName)??"particles",fragmentElement:M},F,o.concat(p),W.concat(Q),q,B,k,u,void 0,O,(async()=>{0===O?await Promise.resolve().then(b.bind(b,13172)):await Promise.resolve().then(b.bind(b,13234))}))},Pp.d.prototype.getEmittedParticleSystems=function(){const M=[];for(let p=0;p<this.RM().qo.length;p++){const b=this.RM().qo[p];b.Qp===this&&M.push(b)}return M},Pp.d.prototype.getHierarchyEmittedParticleSystems=function(){const M=[],p=this.getDescendants();p.push(this);for(let b=0;b<this.RM().qo.length;b++){const Q=this.RM().qo[b],q=Q.Qp;q.position&&-1!==p.indexOf(q)&&M.push(Q)}return M};b(12150),b(12159),b(12242);b(12246),b(13152),b(11985),b(12137),b(12277);b(11981);var rp;b(13154),b(11809);!function(M){M[M.Color=2]="Color",M[M.UV=1]="UV",M[M.Random=0]="Random",M[M.Stated=3]="Stated"}(rp||(rp={}));var Yp=b(12022);const wp=new Q.Ap(0,0,0),Ep=new Q.Ap(0,0,0),np=new Q.Ap(0,0,0);class gp{constructor(M,p,b){this.width=M,this.height=p,this.data=b}processFlowable(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;if(!b)return;b instanceof Q.Matrix?Q.Ap.TransformCoordinatesToRef(M.position,b,np):(np.x=b.x,np.y=b.y,np.z=b.z);const q=.5*np.x+.5,B=1-(.5*np.y+.5),k=Math.floor(q*this.width),u=Math.floor(B*this.height);if(k<0||k>=this.width||u<0||u>=this.height)return;const T=4*(u*this.width+k),O=this.data[T]/255*2-1,H=this.data[T+1]/255*2-1,F=this.data[T+2]/255*2-1,o=this.data[T+3]/255;wp.set(O,H,F),wp.scaleToRef(p*o,Ep),M.direction.addInPlace(Ep)}_processParticle(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;this.processFlowable(M,p,b)}static async FromUrlAsync(M){return await new Promise(((p,b)=>{const Q=document.createElement("canvas"),q=Q.getContext("2d");let B=null;const k=new Image;k.crossOrigin="anonymous",k.src=M,k.onerror=p=>{b(new Error(`Failed to load image: ${M} : ${p}`))},k.onload=()=>{Q.width=k.width,Q.height=k.height,q.drawImage(k,0,0),B=q.getImageData(0,0,Q.width,Q.height),p(new gp(Q.width,Q.height,B.data))}}))}static async ExtractFromTextureAsync(M){return await new Promise(((p,b)=>{if(!M.isReady())return void M.onLoadObservable.addOnce((async()=>{try{const b=await this.ExtractFromTextureAsync(M);p(b)}catch(Q){b(Q)}}));const Q=M.getSize();Yp.k.GetTextureDataAsync(M,Q.width,Q.height).then((M=>{p(new gp(Q.width,Q.height,new Uint8ClampedArray(M)))})).catch(b)}))}}var Up,cp,dp,Vp,hp,Ip,Zp,Jp,vp;!function(M){M[M.Int=1]="Int",M[M.Float=2]="Float",M[M.Vector2=4]="Vector2",M[M.Ap=8]="Ap",M[M.Matrix=16]="Matrix",M[M.Particle=32]="Particle",M[M.Texture=64]="Texture",M[M.Sb=128]="Sb",M[M.FloatGradient=256]="FloatGradient",M[M.Vector2Gradient=512]="Vector2Gradient",M[M.Vector3Gradient=1024]="Vector3Gradient",M[M.Color4Gradient=2048]="Color4Gradient",M[M.System=4096]="System",M[M.AutoDetect=8192]="AutoDetect",M[M.BasedOnInput=16384]="BasedOnInput",M[M.Undefined=32768]="Undefined",M[M.All=65535]="All"}(Up||(Up={})),function(M){M[M.Compatible=0]="Compatible",M[M.TypeIncompatible=1]="TypeIncompatible",M[M.HierarchyIssue=2]="HierarchyIssue"}(cp||(cp={})),function(M){M[M.Input=0]="Input",M[M.Output=1]="Output"}(dp||(dp={}));class zp{get direction(){return this._direction}get type(){if(this._type===Up.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Up.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(M){this._type=M}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((M=>M.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(M,p,b){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Up.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new mM.b,this.onDisconnectionObservable=new mM.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=p,this.name=M,this._direction=b}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(M){var p;return this.isConnected?null!==(p=this._connectedPoint)&&void 0!==p&&p._storedFunction?this._connectedPoint._storedFunction(M):this._connectedPoint._storedValue:this.value}canConnectTo(M){return 0===this.checkCompatibilityState(M)}checkCompatibilityState(M){const p=this._ownerBlock,b=M.ownerBlock;if(this.type!==M.type&&M.innerType!==Up.AutoDetect)return M.acceptedConnectionPointTypes&&-1!==M.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(M.excludedConnectionPointTypes&&-1!==M.excludedConnectionPointTypes.indexOf(this.type))return 1;let Q=b,q=p;return 0===this.direction&&(Q=p,q=b),Q.isAnAncestorOf(q)?2:0}connectTo(M){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(M))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${M.ownerBlock.name}".${M.name}`;return this._endpoints.push(M),M._connectedPoint=this,this.onConnectionObservable.notifyObservers(M),M.onConnectionObservable.notifyObservers(this),this}disconnectFrom(M){const p=this._endpoints.indexOf(M);return-1===p||(this._endpoints.splice(p,1),M._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(M),M.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(M){let p=1;for(;p<Up.All;)M&p||this.excludedConnectionPointTypes.push(p),p<<=1}serialize(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const p={};return p.name=this.name,p.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ob?(p.valueType="BABYLON."+this.value.getClassName(),p.value=this.value.Ob()):(p.valueType="number",p.value=this.value)),M&&this.connectedPoint&&(p.inputName=this.name,p.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,p.targetConnectionName=this.connectedPoint.name,p.isExposedOnFrame=!0,p.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(p.isExposedOnFrame=!0,p.exposedPortPosition=this.exposedPortPosition),p}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class tp{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(M){this._name=M}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(M){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new mM.b,this.bb=new mM.b,this.onInputChangedObservable=new mM.b,this.visibleOnFrame=!1,this._name=M,this.uniqueId=g.e.UniqueId}_inputRename(M){return M}_outputRename(M){return M}isAnAncestorOf(M){for(const p of this._outputs)if(p.hasEndpoints)for(const b of p.endpoints){if(b.ownerBlock===M)return!0;if(b.ownerBlock.isAnAncestorOf(M))return!0}return!1}isAnAncestorOfType(M){if(this.getClassName()===M)return!0;for(const p of this._outputs)if(p.hasEndpoints)for(const b of p.endpoints)if(b.ownerBlock.isAnAncestorOfType(M))return!0;return!1}getInputByName(M){const p=this._inputs.filter((p=>p.name===M));return p.length?p[0]:null}_linkConnectionTypes(M,p){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[p]._acceptedConnectionPointType=this._inputs[M]:(this._inputs[M]._linkedConnectionSource=this._inputs[p],this._inputs[M]._isMainLinkSource=!0),this._inputs[p]._linkedConnectionSource=this._inputs[M]}registerInput(M,p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;const k=new zp(M,this,0);return k.type=p,k.isOptional=b,k.defaultValue=Q,k.value=Q,k.valueMin=q,k.valueMax=B,this._inputs.push(k),this.onInputChangedObservable.notifyObservers(k),this}registerOutput(M,p,b){return(b=b??new zp(M,this,1)).type=p,this._outputs.push(b),this}_build(M){}_customBuildStep(M){}build(M){if(this._buildId===M.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((M=>M.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=M.buildId;for(const p of this._inputs){if(!p.connectedPoint){p.isOptional||M.notConnectedNonOptionalInputs.push(p);continue}const b=p.connectedPoint.ownerBlock;b&&b!==this&&!b.isSystem&&b.build(M)}return this._customBuildStep(M),M.verbose&&U.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(M),this.onBuildObservable.notifyObservers(this),!1}serialize(){const M={};M.customType="BABYLON."+this.getClassName(),M.id=this.uniqueId,M.name=this.name,M.visibleOnFrame=this.visibleOnFrame,M.inputs=[],M.outputs=[];for(const p of this.inputs)M.inputs.push(p.serialize());for(const p of this.outputs)M.outputs.push(p.serialize(!1));return M}_deserialize(M){this._name=M.name,this.comments=M.comments,this.visibleOnFrame=!!M.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(M)}_deserializePortDisplayNamesAndExposedOnFrame(M){const p=M.inputs,b=M.outputs;if(p)for(const Q of p){const M=this.inputs.find((M=>M.name===Q.name));if(!M)return;if(Q.displayName&&(M.displayName=Q.displayName),Q.isExposedOnFrame&&(M.isExposedOnFrame=Q.isExposedOnFrame,M.exposedPortPosition=Q.exposedPortPosition),void 0!==Q.value&&null!==Q.value)if("number"===Q.valueType)M.value=Q.value;else{const p=(0,u.c)(Q.valueType);p&&(M.value=p.sp(Q.value))}}if(b)for(let Q=0;Q<b.length;Q++){const M=b[Q];M.displayName&&(this.outputs[Q].displayName=M.displayName),M.isExposedOnFrame&&(this.outputs[Q].isExposedOnFrame=M.isExposedOnFrame,this.outputs[Q].exposedPortPosition=M.exposedPortPosition)}}clone(){const M=this.serialize(),p=(0,u.c)(M.customType);if(p){const b=new p;return b._deserialize(M),b}return null}dispose(){this.bb.notifyObservers(this),this.bb.clear();for(const M of this.inputs)M.dispose();for(const M of this.outputs)M.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function ep(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",Q=arguments.length>3?arguments[3]:void 0;return(q,B)=>{let k=q._propStore;k||(k=[],q._propStore=k),k.push({propertyName:B,displayName:M,type:p,groupName:b,options:Q??{},className:q.getClassName()})}}(0,Y.c)([(0,w.R)("comment")],tp.prototype,"comments",void 0),function(M){M[M.Boolean=0]="Boolean",M[M.Float=1]="Float",M[M.Int=2]="Int",M[M.Vector2=3]="Vector2",M[M.List=4]="List",M[M.Sb=5]="Sb",M[M.SamplingMode=6]="SamplingMode",M[M.TextureFormat=7]="TextureFormat",M[M.TextureType=8]="TextureType"}(Vp||(Vp={})),function(M){M[M.None=0]="None",M[M.Position=1]="Position",M[M.Direction=2]="Direction",M[M.Age=3]="Age",M[M.Lifetime=4]="Lifetime",M[M.Color=5]="Color",M[M.ScaledDirection=6]="ScaledDirection",M[M.Scale=7]="Scale",M[M.AgeGradient=8]="AgeGradient",M[M.Angle=9]="Angle",M[M.SpriteCellIndex=16]="SpriteCellIndex",M[M.SpriteCellStart=17]="SpriteCellStart",M[M.SpriteCellEnd=18]="SpriteCellEnd"}(hp||(hp={})),function(M){M[M.None=0]="None",M[M.Time=1]="Time",M[M.Delta=2]="Delta",M[M.Emitter=3]="Emitter"}(Ip||(Ip={}));class Gp{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let M="";for(const p of this.notConnectedNonOptionalInputs)M+=`input ${p.name} from block ${p.ownerBlock.name}[${p.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(M)throw"Build of Node Particle System Set failed:\n"+M}adapt(M,p){const b=M.getConnectedValue(this)||0;if(M.type===p)return b;switch(p){case Up.Vector2:return new Q.Vector2(b,b);case Up.Ap:return new Q.Ap(b,b,b);case Up.Sb:return new k.Sb(b,b,b,b)}return null}getContextualValue(M){if(!this.particleContext||!this.systemContext)return null;switch(M){case hp.Position:return this.particleContext.position;case hp.Direction:return this.particleContext.direction;case hp.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case hp.Color:return this.particleContext.color;case hp.Age:return this.particleContext.age;case hp.Lifetime:return this.particleContext.lifeTime;case hp.Angle:return this.particleContext.angle;case hp.Scale:return this.particleContext.scale;case hp.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case hp.SpriteCellEnd:return this.systemContext.endSpriteCellID;case hp.SpriteCellIndex:return this.particleContext.cellIndex;case hp.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Qp.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Qp.absolutePosition:this.systemContext.Qp:null}getSystemValue(M){if(!this.particleContext||!this.systemContext)return null;switch(M){case Ip.Time:return this.systemContext._actualFrame;case Ip.Delta:return this.systemContext._scaledUpdateSpeed;case Ip.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Qp.absolutePosition}return this.systemContext.Qp}return null}}function mb(M,p,b){const Q=new Gp;Q.Kp=p;const q=M.createSystem(Q);return q.canStart=()=>!0,q.Qp=b.clone(),q.disposeOnStop=!0,q.start(),q}class Cp extends tp{constructor(M){super(M),this.blendMode=T.BLENDMODE_ONEONE,this.fp=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Up.Particle),this.registerInput("texture",Up.Texture),this.registerInput("onStart",Up.System,!0),this.registerInput("onEnd",Up.System,!0),this.registerOutput("system",Up.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(M){M.fp=this.fp,M.buildId=this._buildId++,this.build(M);const p=this.particle.getConnectedValue(M);return p.particleTexture=this.texture.getConnectedValue(M),p.emitRate=this.emitRate,p.blendMode=this.blendMode,p.name=this.name,p._nodeGenerated=!0,p._targetStopDuration=this.targetStopDuration,p.startDelay=this.startDelay,this.system._storedValue=this,p.canStart=()=>!this.doNoStart,p.onStartedObservable.add((b=>{const Q=this.onStart.getConnectedValue(M);Q&&b.onStartedObservable.addOnce((()=>{M.systemContext=p;const b=mb(Q,M.Kp,M.emitterPosition);this.bb.addOnce((()=>{b.dispose()}))}));const q=this.onEnd.getConnectedValue(M);q&&b.onStoppedObservable.addOnce((()=>{M.systemContext=p;const b=mb(q,M.Kp,M.emitterPosition);this.bb.addOnce((()=>{b.dispose()}))}))})),this.bb.addOnce((()=>{p.dispose()})),p}serialize(){const M=super.serialize();return M.fp=this.fp,M.emitRate=this.emitRate,M.blendMode=this.blendMode,M.doNoStart=this.doNoStart,M.targetStopDuration=this.targetStopDuration,M.startDelay=this.startDelay,M}_deserialize(M){super._deserialize(M),this.fp=M.fp,this.emitRate=M.emitRate,this.doNoStart=!!M.doNoStart,void 0!==M.blendMode&&(this.blendMode=M.blendMode),void 0!==M.targetStopDuration&&(this.targetStopDuration=M.targetStopDuration),void 0!==M.startDelay&&(this.startDelay=M.startDelay)}}(0,Y.c)([ep("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:T.BLENDMODE_ONEONE},{label:"Standard",value:T.BLENDMODE_STANDARD},{label:"Add",value:T.BLENDMODE_ADD},{label:"Multiply",value:T.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:T.BLENDMODE_MULTIPLYADD}]})],Cp.prototype,"blendMode",void 0),(0,Y.c)([ep("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Cp.prototype,"fp",void 0),(0,Y.c)([ep("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cp.prototype,"emitRate",void 0),(0,Y.c)([ep("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cp.prototype,"targetStopDuration",void 0),(0,Y.c)([ep("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cp.prototype,"startDelay",void 0),(0,Y.c)([ep("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Cp.prototype,"doNoStart",void 0),(0,u.g)("BABYLON.SystemBlock",Cp);class Xp extends tp{get type(){if(this._type===Up.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Up.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Up.Vector2,this._type;case"Ap":return this._type=Up.Ap,this._type;case"Sb":return this._type=Up.Sb,this._type;case"Matrix":return this._type=Up.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===hp.None&&this._systemSource!==Ip.None}get systemSource(){return this._systemSource}set systemSource(M){if(this._systemSource=M,M!==Ip.None){switch(this._contextualSource=hp.None,this._type=Up.Float,M){case Ip.Time:case Ip.Delta:this._type=Up.Float;break;case Ip.Emitter:this._type=Up.Ap}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==hp.None}get contextualValue(){return this._contextualSource}set contextualValue(M){if(this._contextualSource=M,M!==hp.None){switch(this._systemSource=Ip.None,M){case hp.Scale:this._type=Up.Vector2;break;case hp.Position:case hp.Direction:case hp.ScaledDirection:this._type=Up.Ap;break;case hp.Color:this._type=Up.Sb;break;case hp.Age:case hp.Lifetime:case hp.Angle:case hp.AgeGradient:this._type=Up.Float;break;case hp.SpriteCellEnd:case hp.SpriteCellStart:case hp.SpriteCellIndex:this._type=Up.Int}this.output&&(this.output.type=this._type)}}constructor(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Up.AutoDetect;super(M),this._type=Up.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new mM.b,this._systemSource=Ip.None,this._contextualSource=hp.None,this._type=p,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",p)}get value(){return this._storedValue}set value(M){this.type===Up.Float&&this.min!==this.max&&(M=Math.max(this.min,M),M=Math.min(this.max,M)),this._storedValue=M,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(M){this._valueCallback=M}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Up.Int:case Up.Float:this.value=0;break;case Up.Vector2:this.value=Q.Vector2.Zero();break;case Up.Ap:this.value=Q.Ap.Zero();break;case Up.Sb:this.value=new k.Sb(1,1,1,1);break;case Up.Matrix:this.value=Q.Matrix.Identity()}}_build(M){super._build(M),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=M=>M.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=M=>M.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const M=super.serialize();return M.type=this.type,M.contextualValue=this.contextualValue,M.systemSource=this.systemSource,M.min=this.min,M.max=this.max,M.groupInInspector=this.groupInInspector,M.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ob?(M.valueType="BABYLON."+this._storedValue.getClassName(),M.value=this._storedValue.Ob()):(M.valueType="number",M.value=this._storedValue)),M}_deserialize(M){if(super._deserialize(M),this._type=M.type,this.contextualValue=M.contextualValue,this.systemSource=M.systemSource||Ip.None,this.min=M.min||0,this.max=M.max||0,this.groupInInspector=M.groupInInspector||"",void 0!==M.displayInInspector&&(this.displayInInspector=M.displayInInspector),M.valueType)if("number"===M.valueType)this._storedValue=M.value;else{const p=(0,u.c)(M.valueType);p&&(this._storedValue=p.sp(M.value))}}}(0,u.g)("BABYLON.ParticleInputBlock",Xp);class lp extends tp{get url(){return this._url}set url(M){this._url!==M&&(this._cachedData=null,this._url=M,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(M){this._textureDataUrl!==M&&(this._cachedData=null,this._textureDataUrl=M,this._url="",this._sourceTexture=null)}set sourceTexture(M){this._sourceTexture!==M&&(this._cachedData=null,this._sourceTexture=M,this._url="",this._textureDataUrl="")}constructor(M){super(M),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Up.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const M=this.texture._storedValue;return await new Promise(((p,b)=>{if(!M.isReady())return void M.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),p(this._cachedData)}catch(M){b(M)}}));const Q=M.getSize();Yp.k.GetTextureDataAsync(M,Q.width,Q.height).then((b=>{this._cachedData={width:Q.width,height:Q.height,data:new Uint8ClampedArray(b)},M.dispose(),p(this._cachedData)})).catch(b)}))}_build(M){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new n.b(this._textureDataUrl,M.Kp):this.texture._storedValue=new n.b(this._url,M.Kp):this.texture._storedValue=null}serialize(){const M=super.serialize();return M.url=this.url,M.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(M.textureDataUrl=this.textureDataUrl),M}_deserialize(M){super._deserialize(M),this.url=M.url,this.serializedCachedData=!!M.serializedCachedData,M.textureDataUrl&&(this.textureDataUrl=M.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,u.g)("BABYLON.ParticleTextureSourceBlock",lp);class Mb extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerInput("position",Up.Ap),this.registerOutput("output",Up.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(M){const p=this.particle.getConnectedValue(M);if(this.output._storedValue=p,!this.position.isConnected)return;const b={process:b=>{M.particleContext=b,M.systemContext=p,b.position.B(this.position.getConnectedValue(M))},previousItem:null,nextItem:null};p._updateQueueStart?IM(b,p._updateQueueStart):p._updateQueueStart=b}}(0,u.g)("BABYLON.UpdatePositionBlock",Mb),function(M){M[M.Add=0]="Add",M[M.Subtract=1]="Subtract",M[M.Multiply=2]="Multiply",M[M.Divide=3]="Divide",M[M.Max=4]="Max",M[M.Min=5]="Min"}(Zp||(Zp={}));class pb extends tp{constructor(M){super(M),this.operation=Zp.Add,this.registerInput("left",Up.AutoDetect),this.registerInput("right",Up.AutoDetect),this.registerOutput("output",Up.BasedOnInput),this.output._typeConnectionSource=this.left;const p=[Up.Matrix,Up.Particle,Up.Texture,Up.System,Up.FloatGradient,Up.Color4Gradient,Up.Vector2Gradient,Up.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...p),this.right.excludedConnectionPointTypes.push(...p),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(M){let p;const b=this.left,q=this.right;if(!b.isConnected||!q.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const B=b.type===Up.Float||b.type===Up.Int,u=q.type===Up.Float||q.type===Up.Int,T=B&&u;switch(this.operation){case Zp.Add:p=T?M=>b.getConnectedValue(M)+q.getConnectedValue(M):B?M=>M.adapt(b,q.type).add(q.getConnectedValue(M)):M=>b.getConnectedValue(M).add(M.adapt(q,b.type));break;case Zp.Subtract:p=T?M=>b.getConnectedValue(M)-q.getConnectedValue(M):B?M=>M.adapt(b,q.type).jp(q.getConnectedValue(M)):M=>b.getConnectedValue(M).jp(M.adapt(q,b.type));break;case Zp.Multiply:p=T?M=>b.getConnectedValue(M)*q.getConnectedValue(M):B?M=>M.adapt(b,q.type).multiply(q.getConnectedValue(M)):M=>b.getConnectedValue(M).multiply(M.adapt(q,b.type));break;case Zp.Divide:p=T?M=>b.getConnectedValue(M)/q.getConnectedValue(M):B?M=>M.adapt(b,q.type).divide(q.getConnectedValue(M)):M=>b.getConnectedValue(M).divide(M.adapt(q,b.type));break;case Zp.Min:if(T)p=M=>Math.min(b.getConnectedValue(M),q.getConnectedValue(M));else{const[M,u]=B?[q,b]:[b,q];switch(M.type){case Up.Vector2:p=p=>Q.Vector2.Minimize(M.getConnectedValue(p),p.adapt(u,M.type));break;case Up.Ap:p=p=>Q.Ap.Minimize(M.getConnectedValue(p),p.adapt(u,M.type));break;case Up.Sb:p=p=>{const b=M.getConnectedValue(p),{r:Q,g:q,b:B,a:T}=p.adapt(u,M.type);return new k.Sb(Math.min(b.r,Q),Math.min(b.g,q),Math.min(b.b,B),Math.min(b.a,T))}}}break;case Zp.Max:if(!T){const[M,u]=B?[q,b]:[b,q];switch(M.type){case Up.Vector2:p=p=>Q.Vector2.Maximize(M.getConnectedValue(p),p.adapt(u,M.type));break;case Up.Ap:p=p=>Q.Ap.Maximize(M.getConnectedValue(p),p.adapt(u,M.type));break;case Up.Sb:p=p=>{const b=M.getConnectedValue(p),{r:Q,g:q,b:B,a:T}=p.adapt(u,M.type);return new k.Sb(Math.max(b.r,Q),Math.min(b.g,q),Math.min(b.b,B),Math.min(b.a,T))}}break}p=M=>Math.max(b.getConnectedValue(M),q.getConnectedValue(M))}this.output._storedFunction=M=>b.type===Up.Int?0|p(M):p(M)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Up.Int||this.left.type===Up.Float&&this.right.type!==Up.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[M,p]of[[this.left,this.right],[this.right,this.left]])M.acceptedConnectionPointTypes=[Up.Int,Up.Float],p.isConnected&&(M.acceptedConnectionPointTypes.push(p.type),p.type!==Up.Int&&p.type!==Up.Float||M.acceptedConnectionPointTypes.push(Up.Vector2,Up.Ap,Up.Sb))}dispose(){super.dispose();for(const M of this._connectionObservers)M.remove();this._connectionObservers.length=0}serialize(){const M=super.serialize();return M.operation=this.operation,M}_deserialize(M){super._deserialize(M),this.operation=M.operation}}(0,Y.c)([ep("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Zp.Add},{label:"Subtract",value:Zp.Subtract},{label:"Multiply",value:Zp.Multiply},{label:"Divide",value:Zp.Divide},{label:"Max",value:Zp.Max},{label:"Min",value:Zp.Min}]})],pb.prototype,"operation",void 0),(0,u.g)("BABYLON.ParticleMathBlock",pb);class bb extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerInput("direction1",Up.Ap,!0,new Q.Ap(0,1,0)),this.registerInput("direction2",Up.Ap,!0,new Q.Ap(0,1,0)),this.registerInput("minEmitBox",Up.Ap,!0,new Q.Ap(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Up.Ap,!0,new Q.Ap(.5,.5,.5)),this.registerOutput("output",Up.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(M){const p=this.particle.getConnectedValue(M);p._directionCreation.process=b=>{M.particleContext=b,M.systemContext=p;const q=this.direction1.getConnectedValue(M),B=this.direction2.getConnectedValue(M),k=(0,O.RandomRange)(q.x,B.x),u=(0,O.RandomRange)(q.y,B.y),T=(0,O.RandomRange)(q.z,B.z);M.isEmitterTransformNode?Q.Ap.TransformNormalFromFloatsToRef(k,u,T,M.emitterWorldMatrix,b.direction):b.direction.Db(k,u,T)},p._positionCreation.process=b=>{M.particleContext=b,M.systemContext=p;const q=this.minEmitBox.getConnectedValue(M),B=this.maxEmitBox.getConnectedValue(M),k=(0,O.RandomRange)(q.x,B.x),u=(0,O.RandomRange)(q.y,B.y),T=(0,O.RandomRange)(q.z,B.z);M.isEmitterTransformNode?Q.Ap.TransformCoordinatesFromFloatsToRef(k,u,T,M.emitterWorldMatrix,b.position):(b.position.Db(k,u,T),b.position.addInPlace(M.emitterPosition))},this.output._storedValue=p}}(0,u.g)("BABYLON.BoxShapeBlock",bb);class Qb extends tp{constructor(M){super(M),this.registerInput("emitPower",Up.Float,!0,1),this.registerInput("lifeTime",Up.Float,!0,1),this.registerInput("color",Up.Sb,!0,new k.Sb(1,1,1,1)),this.registerInput("scale",Up.Vector2,!0,new Q.Vector2(1,1)),this.registerInput("angle",Up.Float,!0,0),this.registerOutput("particle",Up.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(M){const p=new upM(this.name,M.fp,M.Kp,null,!1,void 0,!0);p.particleEmitterType=new K,p._lifeTimeCreation.process=(p,b)=>{M.particleContext=p,p.lifeTime=this.lifeTime.getConnectedValue(M),b._emitPower=this.emitPower.getConnectedValue(M)},p._colorCreation.process=p=>{M.particleContext=p,p.color.B(this.color.getConnectedValue(M))},p._sizeCreation.process=p=>{M.particleContext=p,p.size=1,p.scale.B(this.scale.getConnectedValue(M))},p._angleCreation.process=p=>{M.particleContext=p,p.angle=this.angle.getConnectedValue(M)},this.particle._storedValue=p}}(0,u.g)("BABYLON.CreateParticleBlock",Qb);class qb{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const M=[];for(const p of this.attachedBlocks)p.isInput&&M.push(p);return M}constructor(M){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new mM.b,this.name=M}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(M){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(M)&&this.attachedBlocks.push(M);for(const b of M.inputs){const Q=b.connectedPoint;if(Q){const b=Q.ownerBlock;b!==M&&this._initializeBlock(b,p)}}}async buildAsync(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((b=>{const Q=new Rp;for(const M of this._systemBlocks)this._initializeBlock(M);for(const q of this.systemBlocks){const b=new Gp;b.buildId=this._buildId++,b.Kp=M,b.verbose=p;const B=q.createSystem(b);b.emitErrors(),Q.systems.push(B)}this.onBuildObservable.notifyObservers(this),b(Q)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const M=new Cp("Particle system"),p=new Mb("Update position");p.output.connectTo(M.particle);const b=new Xp("Position");b.contextualValue=hp.Position;const Q=new Xp("Scaled direction");Q.contextualValue=hp.ScaledDirection;const q=new pb("Add");q.operation=Zp.Add,b.output.connectTo(q.left),Q.output.connectTo(q.right),q.output.connectTo(p.position);const B=new Qb("Create particle"),k=new bb("Box shape");B.particle.connectTo(k.particle),k.output.connectTo(p.particle);const u=new lp("Texture");u.texture.connectTo(M.texture),u.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(M)}removeBlock(M){const p=this.attachedBlocks.indexOf(M);if(p>-1&&this.attachedBlocks.splice(p,1),M.isSystem){const p=this._systemBlocks.indexOf(M);p>-1&&this._systemBlocks.splice(p,1)}}parseSerializedObject(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];p||this.clear();const b={};for(const Q of M.RH){const M=(0,u.c)(Q.customType);if(M){const p=new M;p._deserialize(Q),b[Q.id]=p,this.attachedBlocks.push(p),p.isSystem&&this._systemBlocks.push(p)}}for(const Q of this.attachedBlocks)if(Q.isTeleportOut){const M=Q,p=M._tempEntryPointUniqueId;if(p){const Q=b[p];Q&&Q.attachToEndpoint(M)}}for(let Q=0;Q<M.RH.length;Q++){const q=M.RH[Q],B=b[q.id];B&&(B.inputs.length&&q.inputs.some((M=>M.targetConnectionName))&&!p||this._restoreConnections(B,M,b))}if(M.locations||M.editorData&&M.editorData.locations){const Q=M.locations||M.editorData.locations;for(const M of Q)b[M.kB]&&(M.kB=b[M.kB].uniqueId);p&&this.editorData&&this.editorData.locations&&Q.concat(this.editorData.locations),M.locations?this.editorData={locations:Q}:(this.editorData=M.editorData,this.editorData.locations=Q);const q=[];for(const M in b)q[M]=b[M].uniqueId;this.editorData.map=q}this.comment=M.comment}_restoreConnections(M,p,b){for(const Q of M.outputs)for(const q of p.RH){const B=b[q.id];if(B)for(const k of q.inputs)if(b[k.targetBlockId]!==M||k.targetConnectionName!==Q.name);else{const M=B.getInputByName(k.inputName);if(!M||M.isConnected)continue;Q.connectTo(M,!0),this._restoreConnections(B,p,b)}}}serialize(M){const p=M?{}:E.b.Serialize(this);p.editorData=JSON.parse(JSON.stringify(this.editorData));let b=[];M?b=M:p.customType="BABYLON.NodeParticleSystemSet",p.RH=[];for(const Q of b)p.RH.push(Q.serialize());if(!M)for(const Q of this.attachedBlocks)-1===b.indexOf(Q)&&p.RH.push(Q.serialize());return p}dispose(){for(const M of this.attachedBlocks)M.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(M){const p=new qb(M);return p.setToDefault(),p}static Parse(M){const p=E.b.Parse((()=>new qb(M.name)),M,null);return p.parseSerializedObject(M),p}static ParseFromSnippetAsync(M,p){return"_BLANK"===M?Promise.resolve(qb.CreateDefault("blank")):new Promise(((b,Q)=>{const q=new yp.b;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const k=JSON.parse(JSON.parse(q.responseText).jsonPayload),u=JSON.parse(k.nodeParticle);p||(p=E.b.Parse((()=>new qb(M)),u,null)),p.parseSerializedObject(u),p.snippetId=M;try{b(p)}catch(B){Q(B)}}else Q("Unable to load the snippet "+M)})),q.open("GET",this.SnippetUrl+"/"+M.replace(/#/g,"/")),q.send()}))}}qb.EditorURL=`${sp.Tools._DefaultCdnUrl}/v${eM.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,qb.SnippetUrl="https://snippet.babylonjs.com",(0,Y.c)([(0,w.R)()],qb.prototype,"name",void 0),(0,Y.c)([(0,w.R)("comment")],qb.prototype,"comment",void 0),function(M){M[M.None=0]="None",M[M.PerParticle=1]="PerParticle",M[M.PerSystem=2]="PerSystem"}(Jp||(Jp={}));class Bb extends tp{constructor(M){super(M),this._currentLockId=-2,this.lockMode=Jp.PerParticle,this.registerInput("min",Up.AutoDetect,!0,0),this.registerInput("max",Up.AutoDetect,!0,1),this.registerOutput("output",Up.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Up.Float|Up.Int|Up.Vector2|Up.Ap|Up.Sb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Up.Float|Up.Int|Up.Vector2|Up.Ap|Up.Sb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Up.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let M=null;switch(this._currentLockId=-2,this.min.type){case Up.AutoDetect:case Up.Int:case Up.Float:M=M=>{const p=this.min.getConnectedValue(M)||0,b=this.max.getConnectedValue(M)||1;return p+Math.random()*(b-p)};break;case Up.Vector2:M=M=>{const p=this.min.getConnectedValue(M)||Q.Vector2.Zero(),b=this.max.getConnectedValue(M)||Q.Vector2.One();return new Q.Vector2(p.x+Math.random()*(b.x-p.x),p.y+Math.random()*(b.y-p.y))};break;case Up.Ap:M=M=>{const p=this.min.getConnectedValue(M)||Q.Ap.Zero(),b=this.max.getConnectedValue(M)||Q.Ap.One();return new Q.Ap(p.x+Math.random()*(b.x-p.x),p.y+Math.random()*(b.y-p.y),p.z+Math.random()*(b.z-p.z))};break;case Up.Sb:M=M=>{const p=this.min.getConnectedValue(M)||new k.Sb(0,0,0,0),b=this.max.getConnectedValue(M)||new k.Sb(1,1,1,1);return new k.Sb(p.x+Math.random()*(b.x-p.x),p.y+Math.random()*(b.y-p.y),p.z+Math.random()*(b.z-p.z),p.w+Math.random()*(b.w-p.w))}}this.output._storedFunction=p=>{var b;let Q=0;switch(this.lockMode){case Jp.PerParticle:Q=(null===(b=p.particleContext)||void 0===b?void 0:b.id)||-1;break;case Jp.PerSystem:Q=p.buildId||0}return this._currentLockId!==Q&&(this.lockMode!==Jp.None&&(this._currentLockId=Q),this.output._storedValue=M(p)),this.output._storedValue}}serialize(){const M=super.serialize();return M.lockMode=this.lockMode,M}_deserialize(M){super._deserialize(M),this.lockMode=M.lockMode}}(0,Y.c)([ep("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Jp.None},{label:"Per particle",value:Jp.PerParticle},{label:"Per system",value:Jp.PerSystem}]})],Bb.prototype,"lockMode",void 0),(0,u.g)("BABYLON.ParticleRandomBlock",Bb);class kb extends tp{constructor(M){super(M),this._currentLockId=-2,this.lockMode=Jp.PerParticle,this.registerInput("min",Up.AutoDetect),this.registerInput("max",Up.AutoDetect),this.registerOutput("output",Up.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const p=[Up.Matrix,Up.Particle,Up.Texture,Up.System,Up.FloatGradient,Up.Color4Gradient,Up.Vector2Gradient,Up.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...p),this.max.excludedConnectionPointTypes.push(...p)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let M=null;switch(this._currentLockId=-2,this.min.type){case Up.Float:case Up.Int:M=M=>{const p=this.min.getConnectedValue(M),b=this.max.getConnectedValue(M);return Math.random()*(b-p)+p};break;case Up.Vector2:M=M=>{const p=this.min.getConnectedValue(M),b=this.max.getConnectedValue(M);return new Q.Vector2(Math.random()*(b.x-p.x)+p.x,Math.random()*(b.y-p.y)+p.y)};break;case Up.Ap:M=M=>{const p=this.min.getConnectedValue(M),b=this.max.getConnectedValue(M);return new Q.Ap(Math.random()*(b.x-p.x)+p.x,Math.random()*(b.y-p.y)+p.y,Math.random()*(b.z-p.z)+p.z)};break;case Up.Sb:M=M=>{const p=this.min.getConnectedValue(M),b=this.max.getConnectedValue(M);return new k.Sb(Math.random()*(b.r-p.r)+p.r,Math.random()*(b.g-p.g)+p.g,Math.random()*(b.b-p.b)+p.b,Math.random()*(b.a-p.a)+p.a)}}this.output._storedFunction=p=>{var b;let Q=0;switch(this.lockMode){case Jp.PerParticle:Q=(null===(b=p.particleContext)||void 0===b?void 0:b.id)||-1;break;case Jp.PerSystem:Q=p.buildId||0}return this._currentLockId!==Q&&(this.lockMode!==Jp.None&&(this._currentLockId=Q),this.output._storedValue=M(p)),this.output._storedValue}}serialize(){const M=super.serialize();return M.lockMode=this.lockMode,M}_deserialize(M){super._deserialize(M),void 0!==M.lockMode&&(this.lockMode=M.lockMode)}}(0,Y.c)([ep("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Jp.None},{label:"Per particle",value:Jp.PerParticle},{label:"Per system",value:Jp.PerSystem}]})],kb.prototype,"lockMode",void 0),(0,u.g)("BABYLON.RandomRangeBlock",kb);(0,u.g)("BABYLON.ParticleLerpBlock",class extends tp{constructor(M){super(M),this.registerInput("left",Up.AutoDetect),this.registerInput("right",Up.AutoDetect),this.registerInput("gradient",Up.Float,!0,0,0,1),this.registerOutput("output",Up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Up.Float|Up.Int|Up.Vector2|Up.Ap|Up.Sb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const M=(M,p,b)=>(1-M)*p+M*b;this.output._storedFunction=p=>{const b=this.left.getConnectedValue(p),q=this.right.getConnectedValue(p),B=this.gradient.getConnectedValue(p);switch(this.left.type){case Up.Int:case Up.Float:return M(B,b,q);case Up.Vector2:return new Q.Vector2(M(B,b.x,q.x),M(B,b.y,q.y));case Up.Ap:return new Q.Ap(M(B,b.x,q.x),M(B,b.y,q.y),M(B,b.z,q.z));case Up.Sb:return new k.Sb(M(B,b.r,q.r),M(B,b.g,q.g),M(B,b.b,q.b),M(B,b.a,q.a))}return 0}}});(0,u.g)("BABYLON.UpdateDirectionBlock",class extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerInput("direction",Up.Ap),this.registerOutput("output",Up.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(M){const p=this.particle.getConnectedValue(M);if(this.output._storedValue=p,!this.direction.isConnected)return;const b={process:b=>{M.particleContext=b,M.systemContext=p,b.direction.B(this.direction.getConnectedValue(M))},previousItem:null,nextItem:null};p._updateQueueStart?IM(b,p._updateQueueStart):p._updateQueueStart=b}});(0,u.g)("BABYLON.UpdateColorBlock",class extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerInput("color",Up.Sb),this.registerOutput("output",Up.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(M){const p=this.particle.getConnectedValue(M);if(this.output._storedValue=p,!this.color.isConnected)return;const b={process:b=>{M.particleContext=b,M.systemContext=p,b.color.B(this.color.getConnectedValue(M))},previousItem:null,nextItem:null};p._updateQueueStart?IM(b,p._updateQueueStart):p._updateQueueStart=b}});(0,u.g)("BABYLON.UpdateScaleBlock",class extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerInput("scale",Up.Vector2),this.registerOutput("output",Up.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(M){const p=this.particle.getConnectedValue(M);if(this.output._storedValue=p,!this.scale.isConnected)return;const b={process:b=>{M.particleContext=b,M.systemContext=p,b.scale.B(this.scale.getConnectedValue(M))},previousItem:null,nextItem:null};p._updateQueueStart?IM(b,p._updateQueueStart):p._updateQueueStart=b}});(0,u.g)("BABYLON.UpdateAngleBlock",class extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerInput("angle",Up.Float),this.registerOutput("output",Up.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(M){const p=this.particle.getConnectedValue(M);if(this.output._storedValue=p,!this.angle.isConnected)return;const b={process:b=>{M.particleContext=b,M.systemContext=p,b.angle=this.angle.getConnectedValue(M)},previousItem:null,nextItem:null};p._updateQueueStart?IM(b,p._updateQueueStart):p._updateQueueStart=b}});(0,u.g)("BABYLON.BasicPositionUpdateBlock",class extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerOutput("output",Up.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(M){const p=this.particle.getConnectedValue(M),b={process:b=>{M.particleContext=b,M.systemContext=p,b.direction.scaleToRef(p._directionScale,p._scaledDirection),b.position.addInPlace(p._scaledDirection)},previousItem:null,nextItem:null};p._updateQueueStart?IM(b,p._updateQueueStart):p._updateQueueStart=b,this.output._storedValue=p}});(0,u.g)("BABYLON.BasicSpriteUpdateBlock",class extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerOutput("output",Up.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(M){const p=this.particle.getConnectedValue(M),b={process:b=>{M.particleContext=b,M.systemContext=p,b.updateCellIndex()},previousItem:null,nextItem:null};p._updateQueueStart?IM(b,p._updateQueueStart):p._updateQueueStart=b,this.output._storedValue=p}});(0,u.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerInput("cellIndex",Up.Int),this.registerOutput("output",Up.Particle),this.cellIndex.acceptedConnectionPointTypes=[Up.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(M){const p=this.particle.getConnectedValue(M);if(this.output._storedValue=p,!this.cellIndex.isConnected)return;const b={process:b=>{M.particleContext=b,M.systemContext=p,b.cellIndex=Math.floor(this.cellIndex.getConnectedValue(M))},previousItem:null,nextItem:null};p._updateQueueStart?IM(b,p._updateQueueStart):p._updateQueueStart=b}});class ub extends tp{constructor(M){super(M),this.strength=1,this.registerInput("particle",Up.Particle),this.registerInput("flowMap",Up.Texture),this.registerOutput("output",Up.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(M){var p;const b=this.particle.getConnectedValue(M),Q=M.Kp;let q;(null===(p=this.flowMap.connectedPoint)||void 0===p?void 0:p.ownerBlock).extractTextureContentAsync().then((M=>{M&&(q=new gp(M.width,M.height,M.data))}));const B={process:M=>{const p=Q.getTransformMatrix();q&&q._processParticle(M,this.strength*b._tempScaledUpdateSpeed,p)},previousItem:null,nextItem:null};b._updateQueueStart?IM(B,b._updateQueueStart):b._updateQueueStart=B,this.output._storedValue=b}serialize(){const M=super.serialize();return M.strength=this.strength,M}_deserialize(M){super._deserialize(M),this.strength=M.strength}}(0,Y.c)([ep("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ub.prototype,"strength",void 0),(0,u.g)("BABYLON.UpdateFlowMapBlock",ub);(0,u.g)("BABYLON.SphereShapeBlock",class extends tp{constructor(M){super(M),this.registerInput("input",Up.Particle),this.registerInput("radius",Up.Float,!0,1),this.registerInput("radiusRange",Up.Float,!0,1,0,1),this.registerInput("directionRandomizer",Up.Float,!0,0,0,1),this.registerOutput("output",Up.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(M){const p=this.input.getConnectedValue(M);p._directionCreation.process=b=>{M.particleContext=b,M.systemContext=p;const q=this.directionRandomizer.getConnectedValue(M),B=b.position.jp(M.emitterPosition).normalize(),k=(0,O.RandomRange)(0,q),u=(0,O.RandomRange)(0,q),T=(0,O.RandomRange)(0,q);B.x+=k,B.y+=u,B.z+=T,B.normalize(),M.isEmitterTransformNode?Q.Ap.TransformNormalFromFloatsToRef(k,u,T,M.emitterWorldMatrix,b.direction):b.direction.Db(k,u,T)},p._positionCreation.process=b=>{M.particleContext=b,M.systemContext=p;const q=this.radius.getConnectedValue(M),B=this.radiusRange.getConnectedValue(M),k=q-(0,O.RandomRange)(0,q*B),u=(0,O.RandomRange)(0,1),T=(0,O.RandomRange)(0,2*Math.PI),H=Math.acos(2*u-1),F=k*Math.cos(T)*Math.sin(H),o=k*Math.cos(H),W=k*Math.sin(T)*Math.sin(H);M.isEmitterTransformNode?Q.Ap.TransformCoordinatesFromFloatsToRef(F,o,W,M.emitterWorldMatrix,b.position):(b.position.Db(F,o,W),b.position.addInPlace(M.emitterPosition))},this.output._storedValue=p}});(0,u.g)("BABYLON.PointShapeBlock",class extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerInput("direction1",Up.Ap,!0,new Q.Ap(0,1,0)),this.registerInput("direction2",Up.Ap,!0,new Q.Ap(0,1,0)),this.registerOutput("output",Up.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(M){const p=this.particle.getConnectedValue(M);p._directionCreation.process=b=>{M.particleContext=b,M.systemContext=p;const q=this.direction1.getConnectedValue(M),B=this.direction2.getConnectedValue(M),k=(0,O.RandomRange)(q.x,B.x),u=(0,O.RandomRange)(q.y,B.y),T=(0,O.RandomRange)(q.z,B.z);M.isEmitterTransformNode?Q.Ap.TransformNormalFromFloatsToRef(k,u,T,M.emitterWorldMatrix,b.direction):b.direction.Db(k,u,T)},p._positionCreation.process=b=>{M.systemContext=p,M.isEmitterTransformNode?Q.Ap.TransformCoordinatesFromFloatsToRef(0,0,0,M.emitterWorldMatrix,b.position):b.position.B(M.emitterPosition)},this.output._storedValue=p}});(0,u.g)("BABYLON.CustomShapeBlock",class extends tp{constructor(M){super(M),this.registerInput("particle",Up.Particle),this.registerInput("position",Up.Ap,!0,new Q.Ap(0,0,0)),this.registerInput("direction",Up.Ap,!0,new Q.Ap(0,1,0)),this.registerOutput("output",Up.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(M){const p=this.particle.getConnectedValue(M);p._directionCreation.process=b=>{M.particleContext=b,M.systemContext=p;const q=this.direction.getConnectedValue(M);M.isEmitterTransformNode?Q.Ap.TransformNormalToRef(q,M.emitterWorldMatrix,b.direction):b.direction.B(q)},p._positionCreation.process=b=>{M.particleContext=b,M.systemContext=p;const q=this.position.getConnectedValue(M);M.isEmitterTransformNode?Q.Ap.TransformCoordinatesToRef(q,M.emitterWorldMatrix,b.position):(b.position.B(q),b.position.addInPlace(M.emitterPosition))},this.output._storedValue=p}});(0,u.g)("BABYLON.CylinderShapeBlock",class extends tp{constructor(M){super(M),this._tempVector=Q.Ap.Zero(),this.registerInput("particle",Up.Particle),this.registerInput("radius",Up.Float,!0,1),this.registerInput("height",Up.Float,!0,1,0),this.registerInput("radiusRange",Up.Float,!0,1,0,1),this.registerInput("directionRandomizer",Up.Float,!0,0,0,1),this.registerOutput("output",Up.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(M){const p=this.particle.getConnectedValue(M);p._directionCreation.process=b=>{M.particleContext=b,M.systemContext=p;const q=this.directionRandomizer.getConnectedValue(M);b.position.subtractToRef(M.emitterPosition,this._tempVector),this._tempVector.normalize(),M.isEmitterTransformNode&&Q.Ap.TransformNormalToRef(this._tempVector,M.emitterInverseWorldMatrix,this._tempVector);const B=(0,O.RandomRange)(-q/2,q/2);let k=Math.atan2(this._tempVector.x,this._tempVector.z);k+=(0,O.RandomRange)(-Math.PI/2,Math.PI/2)*q,this._tempVector.y=B,this._tempVector.x=Math.sin(k),this._tempVector.z=Math.cos(k),this._tempVector.normalize(),M.isEmitterTransformNode?Q.Ap.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,M.emitterWorldMatrix,b.direction):b.direction.B(this._tempVector)},p._positionCreation.process=b=>{M.particleContext=b,M.systemContext=p;const q=this.height.getConnectedValue(M),B=this.radiusRange.getConnectedValue(M),k=this.radius.getConnectedValue(M),u=(0,O.RandomRange)(-q/2,q/2),T=(0,O.RandomRange)(0,2*Math.PI),H=(0,O.RandomRange)((1-B)*(1-B),1),F=Math.sqrt(H)*k,o=F*Math.cos(T),W=F*Math.sin(T);M.isEmitterTransformNode?Q.Ap.TransformCoordinatesFromFloatsToRef(o,u,W,M.emitterWorldMatrix,b.position):(b.position.Db(o,u,W),b.position.addInPlace(M.emitterPosition))},this.output._storedValue=p}});class Tb extends tp{constructor(M){super(M),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Up.Particle),this.registerOutput("output",Up.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){super._build(M);const p=this.particle.getConnectedValue(M);p._isAnimationSheetEnabled=!0,p.spriteCellWidth=this.width,p.spriteCellHeight=this.height,p.startSpriteCellID=this.start,p.endSpriteCellID=this.end,p.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=p}serialize(){const M=super.serialize();return M.width=this.width,M.height=this.height,M.start=this.start,M.end=this.end,M.randomStartCell=this.randomStartCell,M}_deserialize(M){super._deserialize(M),this.width=M.width,this.height=M.height,this.start=M.start,this.end=M.end,this.randomStartCell=M.randomStartCell}}(0,Y.c)([ep("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tb.prototype,"start",void 0),(0,Y.c)([ep("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tb.prototype,"end",void 0),(0,Y.c)([ep("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tb.prototype,"width",void 0),(0,Y.c)([ep("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tb.prototype,"height",void 0),(0,Y.c)([ep("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Tb.prototype,"loop",void 0),(0,Y.c)([ep("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Tb.prototype,"randomStartCell",void 0),(0,u.g)("BABYLON.SetupSpriteSheetBlock",Tb);class Ob extends tp{constructor(M){super(M),this.reference=0,this.registerInput("value",Up.AutoDetect),this.registerOutput("output",Up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=M=>{switch(M){case Up.Float:return Up.FloatGradient;case Up.Vector2:return Up.Vector2Gradient;case Up.Ap:return Up.Vector3Gradient;case Up.Sb:return Up.Color4Gradient}return M},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Up.Float|Up.Vector2|Up.Ap|Up.Sb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=M=>null}serialize(){const M=super.serialize();return M.reference=this.reference,M}_deserialize(M){super._deserialize(M),this.reference=M.reference}}(0,Y.c)([ep("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Ob.prototype,"reference",void 0),(0,u.g)("BABYLON.ParticleGradientValueBlock",Ob);(0,u.g)("BABYLON.ParticleGradientBlock",class extends tp{constructor(M){super(M),this._entryCount=1,this.registerInput("gradient",Up.Float,!0,1,0,1),this.registerInput("value0",Up.AutoDetect),this.registerOutput("output",Up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=M=>{switch(M){case Up.FloatGradient:return Up.Float;case Up.Vector2Gradient:return Up.Vector2;case Up.Vector3Gradient:return Up.Ap;case Up.Color4Gradient:return Up.Sb}return M},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Up.FloatGradient|Up.Vector2Gradient|Up.Vector3Gradient|Up.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(M){this._inputs[M].onConnectionObservable.add((()=>{this._entryCount>M||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Up.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const M=[];for(let b=1;b<this._inputs.length;b++){var p;if(this._inputs[b].isConnected)M.push(null===(p=this._inputs[b].connectedPoint)||void 0===p?void 0:p.ownerBlock)}M.sort(((M,p)=>M.reference-p.reference)),this.output._storedFunction=p=>{const b=this.gradient.getConnectedValue(p);if(1===M.length)return M[0].value.getConnectedValue(p);let q=null;for(let B=M.length-1;B>=0;B--){const u=M[B];if(u.reference<=b){const M=u.value.getConnectedValue(p);if(q){const B=q.value.getConnectedValue(p),T=q.reference,H=u.reference,F=Math.max(0,Math.min(1,(b-H)/(T-H)));switch(this.output.type){case Up.Float:return(0,O.Lerp)(M,B,F);case Up.Vector2:return Q.Vector2.Lerp(M,B,F);case Up.Ap:return Q.Ap.Lerp(M,B,F);case Up.Sb:return k.Sb.Lerp(M,B,F)}}return M}q=u}return 0}}});(0,u.g)("BABYLON.ParticleConverterBlock",class extends tp{constructor(M){super(M),this.registerInput("color ",Up.Sb,!0),this.registerInput("xyz ",Up.Ap,!0),this.registerInput("xy ",Up.Vector2,!0),this.registerInput("zw ",Up.Vector2,!0),this.registerInput("x ",Up.Float,!0),this.registerInput("y ",Up.Float,!0),this.registerInput("z ",Up.Float,!0),this.registerInput("w ",Up.Float,!0),this.registerOutput("color",Up.Sb),this.registerOutput("xyz",Up.Ap),this.registerOutput("xy",Up.Vector2),this.registerOutput("zw",Up.Vector2),this.registerOutput("x",Up.Float),this.registerOutput("y",Up.Float),this.registerOutput("z",Up.Float),this.registerOutput("w",Up.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(M){return"color "===M?"colorIn":"xyz "===M?"xyzIn":"xy "===M?"xyIn":"zw "===M?"zwIn":"x "===M?"xIn":"y "===M?"yIn":"z "===M?"zIn":"w "===M?"wIn":M}_outputRename(M){switch(M){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return M}}_build(M){super._build(M);const p=this.xIn,b=this.yIn,q=this.zIn,B=this.wIn,u=this.xyIn,T=this.zwIn,O=this.xyzIn,H=this.colorIn,F=this.colorOut,o=this.xyzOut,W=this.xyOut,i=this.zwOut,A=this.xOut,j=this.yOut,K=this.zOut,D=this.wOut,a=M=>{if(H.isConnected)return H.getConnectedValue(M);let Q=0,F=0,o=0,W=0;if(p.isConnected&&(Q=p.getConnectedValue(M)),b.isConnected&&(F=b.getConnectedValue(M)),q.isConnected&&(o=q.getConnectedValue(M)),B.isConnected&&(W=B.getConnectedValue(M)),u.isConnected){const p=u.getConnectedValue(M);p&&(Q=p.x,F=p.y)}if(T.isConnected){const p=T.getConnectedValue(M);p&&(o=p.x,W=p.y)}if(O.isConnected){const p=O.getConnectedValue(M);p&&(Q=p.x,F=p.y,o=p.z)}return new k.Sb(Q,F,o,W)};F._storedFunction=M=>a(M),o._storedFunction=M=>{const p=a(M);return new Q.Ap(p.r,p.g,p.b)},W._storedFunction=M=>{const p=a(M);return new Q.Vector2(p.r,p.g)},i._storedFunction=M=>{const p=a(M);return new Q.Vector2(p.b,p.a)},A._storedFunction=M=>a(M).r,j._storedFunction=M=>a(M).g,K._storedFunction=M=>a(M).b,D._storedFunction=M=>a(M).a}}),function(M){M[M.Cos=0]="Cos",M[M.Sin=1]="Sin",M[M.Abs=2]="Abs",M[M.Exp=3]="Exp",M[M.Exp2=4]="Exp2",M[M.Round=5]="Round",M[M.Floor=6]="Floor",M[M.Ceiling=7]="Ceiling",M[M.Sqrt=8]="Sqrt",M[M.Log=9]="Log",M[M.Tan=10]="Tan",M[M.ArcTan=11]="ArcTan",M[M.ArcCos=12]="ArcCos",M[M.ArcSin=13]="ArcSin",M[M.Sign=14]="Sign",M[M.Negate=15]="Negate",M[M.OneMinus=16]="OneMinus",M[M.Reciprocal=17]="Reciprocal",M[M.ToDegrees=18]="ToDegrees",M[M.ToRadians=19]="ToRadians",M[M.Fract=20]="Fract"}(vp||(vp={}));class Hb extends tp{constructor(M){super(M),this.operation=vp.Cos,this.registerInput("input",Up.AutoDetect),this.registerOutput("output",Up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Up.Float|Up.Int|Up.Vector2|Up.Ap|Up.Sb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){super._build(M);let p=null;switch(this.operation){case vp.Cos:p=M=>Math.cos(M);break;case vp.Sin:p=M=>Math.sin(M);break;case vp.Abs:p=M=>Math.abs(M);break;case vp.Exp:p=M=>Math.exp(M);break;case vp.Exp2:p=M=>Math.pow(2,M);break;case vp.Round:p=M=>Math.round(M);break;case vp.Floor:p=M=>Math.floor(M);break;case vp.Ceiling:p=M=>Math.ceil(M);break;case vp.Sqrt:p=M=>Math.sqrt(M);break;case vp.Log:p=M=>Math.log(M);break;case vp.Tan:p=M=>Math.tan(M);break;case vp.ArcTan:p=M=>Math.atan(M);break;case vp.ArcCos:p=M=>Math.acos(M);break;case vp.ArcSin:p=M=>Math.asin(M);break;case vp.Sign:p=M=>Math.sign(M);break;case vp.Negate:p=M=>-M;break;case vp.OneMinus:p=M=>1-M;break;case vp.Reciprocal:p=M=>1/M;break;case vp.ToRadians:p=M=>M*Math.PI/180;break;case vp.ToDegrees:p=M=>180*M/Math.PI;break;case vp.Fract:p=M=>M>=0?M-Math.floor(M):M-Math.ceil(M)}if(!p)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Up.Int:case Up.Float:this.output._storedFunction=M=>{const b=this.input.getConnectedValue(M);return p(b)};break;case Up.Vector2:this.output._storedFunction=M=>{const b=this.input.getConnectedValue(M);return new Q.Vector2(p(b.x),p(b.y))};break;case Up.Ap:this.output._storedFunction=M=>{const b=this.input.getConnectedValue(M);return new Q.Ap(p(b.x),p(b.y),p(b.z))};break;case Up.Sb:this.output._storedFunction=M=>{const b=this.input.getConnectedValue(M);return new k.Sb(p(b.r),p(b.g),p(b.b),p(b.a))}}return this}serialize(){const M=super.serialize();return M.operation=this.operation,M}_deserialize(M){super._deserialize(M),this.operation=M.operation}}(0,Y.c)([ep("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:vp.Cos},{label:"Sin",value:vp.Sin},{label:"Abs",value:vp.Abs},{label:"Exp",value:vp.Exp},{label:"Exp2",value:vp.Exp2},{label:"Round",value:vp.Round},{label:"Floor",value:vp.Floor},{label:"Ceiling",value:vp.Ceiling},{label:"Sqrt",value:vp.Sqrt},{label:"Log",value:vp.Log},{label:"Tan",value:vp.Tan},{label:"ArcTan",value:vp.ArcTan},{label:"ArcCos",value:vp.ArcCos},{label:"ArcSin",value:vp.ArcSin},{label:"Sign",value:vp.Sign},{label:"Negate",value:vp.Negate},{label:"OneMinus",value:vp.OneMinus},{label:"Reciprocal",value:vp.Reciprocal},{label:"ToDegrees",value:vp.ToDegrees},{label:"ToRadians",value:vp.ToRadians},{label:"Fract",value:vp.Fract}]})],Hb.prototype,"operation",void 0),(0,u.g)("BABYLON.ParticleTrigonometryBlock",Hb);var Fb,ob=b(13157);class Wb extends tp{constructor(M){super(M),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Up.AutoDetect),this.registerOutput("output",Up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Up.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Up.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Up.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Up.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Up.System),this._inputs[0].excludedConnectionPointTypes.push(Up.Particle),this._inputs[0].excludedConnectionPointTypes.push(Up.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const p=M=>{const p=this.input.getConnectedValue(M);if(this.log.length>=this.stackSize)return p;if(null===p||void 0===p)return this.log.push(["null",""]),p;switch(this.input.type){case Up.Vector2:this.log.push([(0,ob.i)(p,4),p.toString()]);break;case Up.Ap:this.log.push([(0,ob.m)(p,4),p.toString()]);break;case Up.Sb:this.log.push([`{R: ${p.r.toFixed(4)} G: ${p.g.toFixed(4)} B: ${p.b.toFixed(4)} A: ${p.a.toFixed(4)}}`,p.toString()]);break;default:this.log.push([p.toString(),p.toString()])}return p};this.output.isConnected?this.output._storedFunction=p:this.output._storedValue=p(M)}serialize(){const M=super.serialize();return M.stackSize=this.stackSize,M}_deserialize(M){super._deserialize(M),this.stackSize=M.stackSize}}(0,Y.c)([ep("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Wb.prototype,"stackSize",void 0),(0,u.g)("BABYLON.ParticleDebugBlock",Wb);(0,u.g)("BABYLON.ParticleElbowBlock",class extends tp{constructor(M){super(M),this.registerInput("input",Up.AutoDetect),this.registerOutput("output",Up.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){super._build(M);const p=this._outputs[0],b=this._inputs[0];p._storedFunction=M=>b.getConnectedValue(M)}});(0,u.g)("BABYLON.ParticleTeleportInBlock",class extends tp{get endpoints(){return this._endpoints}constructor(M){super(M),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Up.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(M){if(this.getClassName()===M)return!0;for(const p of this.endpoints)if(p.isAnAncestorOfType(M))return!0;return!1}isAnAncestorOf(M){for(const p of this.endpoints){if(p===M)return!0;if(p.isAnAncestorOf(M))return!0}return!1}attachToEndpoint(M){M.detach(),this._endpoints.push(M),M._entryPoint=this,M._outputs[0]._typeConnectionSource=this._inputs[0],M._tempEntryPointUniqueId=null,M.name="> "+this.name}detachFromEndpoint(M){const p=this._endpoints.indexOf(M);-1!==p&&(this._endpoints.splice(p,1),M._outputs[0]._typeConnectionSource=null,M._entryPoint=null)}_build(){for(const M of this._endpoints)M.output._storedFunction=M=>this.input.getConnectedValue(M)}});(0,u.g)("BABYLON.ParticleTeleportOutBlock",class extends tp{constructor(M){super(M),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Up.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(M){this.entryPoint&&this.entryPoint.build(M)}clone(){const M=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(M),M}serialize(){var M;const p=super.serialize();return p.entryPoint=(null===(M=this.entryPoint)||void 0===M?void 0:M.uniqueId)??"",p}_deserialize(M){super._deserialize(M),this._tempEntryPointUniqueId=M.entryPoint}}),function(M){M[M.Equal=0]="Equal",M[M.NotEqual=1]="NotEqual",M[M.LessThan=2]="LessThan",M[M.GreaterThan=3]="GreaterThan",M[M.LessOrEqual=4]="LessOrEqual",M[M.GreaterOrEqual=5]="GreaterOrEqual",M[M.Xor=6]="Xor",M[M.Or=7]="Or",M[M.And=8]="And"}(Fb||(Fb={}));class ib extends tp{constructor(M){super(M),this.test=Fb.Equal,this.epsilon=0,this.registerInput("left",Up.Float),this.registerInput("right",Up.Float,!0,0),this.registerInput("ifTrue",Up.AutoDetect,!0,1),this.registerInput("ifFalse",Up.AutoDetect,!0,0),this.registerOutput("output",Up.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Up.Float,this._inputs[0].acceptedConnectionPointTypes.push(Up.Int),this._inputs[1].acceptedConnectionPointTypes.push(Up.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const M=M=>{const p=this.left.getConnectedValue(M),b=this.right.getConnectedValue(M);let Q=!1;switch(this.test){case Fb.Equal:Q=(0,O.WithinEpsilon)(p,b,this.epsilon);break;case Fb.NotEqual:Q=!(0,O.WithinEpsilon)(p,b,this.epsilon);break;case Fb.LessThan:Q=p<b+this.epsilon;break;case Fb.GreaterThan:Q=p>b-this.epsilon;break;case Fb.LessOrEqual:Q=p<=b+this.epsilon;break;case Fb.GreaterOrEqual:Q=p>=b-this.epsilon;break;case Fb.Xor:Q=!!p&&!b||!p&&!!b;break;case Fb.Or:Q=!!p||!!b;break;case Fb.And:Q=!!p&&!!b}return Q};this.output._storedFunction=p=>M(p)?this.ifTrue.getConnectedValue(p):this.ifFalse.getConnectedValue(p)}serialize(){const M=super.serialize();return M.test=this.test,M.epsilon=this.epsilon,M}_deserialize(M){super._deserialize(M),this.test=M.test,void 0!==M.epsilon&&(this.epsilon=M.epsilon)}}(0,Y.c)([ep("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Fb.Equal},{label:"NotEqual",value:Fb.NotEqual},{label:"LessThan",value:Fb.LessThan},{label:"GreaterThan",value:Fb.GreaterThan},{label:"LessOrEqual",value:Fb.LessOrEqual},{label:"GreaterOrEqual",value:Fb.GreaterOrEqual},{label:"Xor",value:Fb.Xor},{label:"Or",value:Fb.Or},{label:"And",value:Fb.And}]})],ib.prototype,"test",void 0),(0,Y.c)([ep("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ib.prototype,"epsilon",void 0),(0,u.g)("BABYLON.ParticleConditionBlock",ib);class Ab extends tp{constructor(M){super(M),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Up.Particle),this.registerInput("condition",Up.Float,!0,0),this.registerInput("system",Up.System),this.registerOutput("output",Up.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(M){this._triggerCount=0;const p=this.input.getConnectedValue(M),b={process:b=>{if(M.particleContext=b,M.systemContext=p,0!==this.condition.getConnectedValue(M)&&(0===this.limit||this._triggerCount<this.limit)){const Q=(new Date).getTime();if(this._previousOne&&Q-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=Q;const q=this.system.getConnectedValue(M);if(q){const Q=mb(q,M.Kp,b.position);Q.bb.addOnce((()=>{this._triggerCount--})),p.bb.addOnce((()=>{Q.dispose()}))}}},previousItem:null,nextItem:null};p._updateQueueStart?IM(b,p._updateQueueStart):p._updateQueueStart=b,this.output._storedValue=p}serialize(){const M=super.serialize();return M.limit=this.limit,M.delay=this.delay,M}_deserialize(M){super._deserialize(M),void 0!==M.limit&&(this.limit=M.limit),void 0!==M.delay&&(this.delay=M.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,Y.c)([ep("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ab.prototype,"limit",void 0),(0,Y.c)([ep("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ab.prototype,"delay",void 0),(0,u.g)("BABYLON.ParticleTriggerBlock",Ab);b(13159),b(13172),b(13183),b(13234)},13220:(M,p,b)=>{"use strict";var Q=b(11709);const q="clipPlaneFragment",B="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13186:(M,p,b)=>{"use strict";var Q=b(11709);const q="clipPlaneFragmentDeclaration",B="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13248:(M,p,b)=>{"use strict";var Q=b(11709);const q="clipPlaneVertex",B="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13237:(M,p,b)=>{"use strict";var Q=b(11709);const q="clipPlaneVertexDeclaration",B="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13232:(M,p,b)=>{"use strict";var Q=b(11709);const q="fogFragment",B="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13211:(M,p,b)=>{"use strict";var Q=b(11709);const q="fogFragmentDeclaration",B="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13253:(M,p,b)=>{"use strict";var Q=b(11709);const q="fogVertex",B="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13242:(M,p,b)=>{"use strict";var Q=b(11709);const q="fogVertexDeclaration",B="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13195:(M,p,b)=>{"use strict";var Q=b(11709);const q="helperFunctions",B="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13189:(M,p,b)=>{"use strict";var Q=b(11709);const q="imageProcessingDeclaration",B="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13202:(M,p,b)=>{"use strict";var Q=b(11709);const q="imageProcessingFunctions",B="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13193:(M,p,b)=>{"use strict";var Q=b(11709);const q="logDepthDeclaration",B="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13229:(M,p,b)=>{"use strict";var Q=b(11709);const q="logDepthFragment",B="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13257:(M,p,b)=>{"use strict";var Q=b(11709);const q="logDepthVertex",B="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";Q.d.IncludesShadersStoreWGSL[q]||(Q.d.IncludesShadersStoreWGSL[q]=B)},13183:(M,p,b)=>{"use strict";b.r(p),b.d(p,{particlesPixelShaderWGSL:()=>k});var Q=b(11709);b(13186),b(13189),b(13193),b(13195),b(13202),b(13211),b(13220),b(13229),b(13232);const q="particlesPixelShader",B="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Q.d.ShadersStoreWGSL[q]||(Q.d.ShadersStoreWGSL[q]=B);const k={name:q,shader:B}},13234:(M,p,b)=>{"use strict";b.r(p),b.d(p,{particlesVertexShaderWGSL:()=>k});var Q=b(11709);b(13237),b(13242),b(13193),b(13248),b(13253),b(13257);const q="particlesVertexShader",B="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Q.d.ShadersStoreWGSL[q]||(Q.d.ShadersStoreWGSL[q]=B);const k={name:q,shader:B}},13091:(M,p,b)=>{"use strict";var Q=b(11709);const q="clipPlaneFragment",B="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13165:(M,p,b)=>{"use strict";var Q=b(11709);const q="clipPlaneFragmentDeclaration",B="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13117:(M,p,b)=>{"use strict";var Q=b(11709);const q="clipPlaneVertex",B="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13179:(M,p,b)=>{"use strict";var Q=b(11709);const q="clipPlaneVertexDeclaration",B="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13106:(M,p,b)=>{"use strict";var Q=b(11709);const q="fogFragment",B="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13084:(M,p,b)=>{"use strict";var Q=b(11709);const q="fogFragmentDeclaration",B="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13126:(M,p,b)=>{"use strict";var Q=b(11709);const q="fogVertex",B="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13115:(M,p,b)=>{"use strict";var Q=b(11709);const q="fogVertexDeclaration",B="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13067:(M,p,b)=>{"use strict";var Q=b(11709);const q="helperFunctions",B="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13056:(M,p,b)=>{"use strict";var Q=b(11709);const q="imageProcessingDeclaration",B="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13075:(M,p,b)=>{"use strict";var Q=b(11709);const q="imageProcessingFunctions",B="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13065:(M,p,b)=>{"use strict";var Q=b(11709);const q="logDepthDeclaration",B="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13099:(M,p,b)=>{"use strict";var Q=b(11709);const q="logDepthFragment",B="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13128:(M,p,b)=>{"use strict";var Q=b(11709);const q="logDepthVertex",B="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Q.d.IncludesShadersStore[q]||(Q.d.IncludesShadersStore[q]=B)},13159:(M,p,b)=>{"use strict";b.r(p),b.d(p,{particlesPixelShader:()=>k});var Q=b(11709);b(13165),b(13056),b(13065),b(13067),b(13075),b(13084),b(13091),b(13099),b(13106);const q="particlesPixelShader",B="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Q.d.ShadersStore[q]||(Q.d.ShadersStore[q]=B);const k={name:q,shader:B}},13172:(M,p,b)=>{"use strict";b.r(p),b.d(p,{particlesVertexShader:()=>k});var Q=b(11709);b(13179),b(13115),b(13065),b(13117),b(13126),b(13128);const q="particlesVertexShader",B="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Q.d.ShadersStore[q]||(Q.d.ShadersStore[q]=B);const k={name:q,shader:B}},13529:(M,p,b)=>{"use strict";b.r(p),b.d(p,{FlowGraphGLTFDataProvider:()=>B});var Q=b(13492),q=b(13477);class B extends Q.b{constructor(M){var p,b;super();const Q=M.glTF,B=(null===(p=Q.animations)||void 0===p?void 0:p.map((M=>M._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",q.c,B);const k=(null===(b=Q.nodes)||void 0===b?void 0:b.map((M=>M._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",q.c,k)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13402:(M,p,b)=>{"use strict";b.d(p,{d:()=>j,f:()=>i,g:()=>W,k:()=>A});var Q=b(11796),q=b(12290),B=b(11833),k=b(13409);const u=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class T{constructor(M,p){this._gltf=M,this._infoTree=p}convert(M){let p,b=this._gltf,Q=this._infoTree;if(!M.startsWith("/"))throw new Error("Path must start with a /");const q=M.split("/");if(q.shift(),q[q.length-1].includes(".length")){const M=q[q.length-1].split(".");q.pop(),q.push(...M)}let B=!1;for(const T of q){const q="length"===T;if(q&&!Q.__array__)throw new Error(`Path ${M} is invalid`);if(Q.__ignoreObjectTree__&&(B=!0),Q.__array__&&!q)Q=Q.__array__;else if(Q=Q[T],!Q)throw new Error(`Path ${M} is invalid`);if(!B)if(void 0===b){if(!u.find((p=>p.regex.test(M))))throw new Error(`Path ${M} is invalid`)}else if(!q){var k;b=null===(k=b)||void 0===k?void 0:k[T]}(Q.__target__||q)&&(p=b)}return{object:p,info:Q}}}function O(M,p,b,Q){const q=H(M,p);return Q?q[b][Q]:q[b]}function H(M,p,b){var Q,B;return null===(Q=M._data)||void 0===Q||null===(B=Q[(null===b||void 0===b?void 0:b.fillMode)??q.c.MATERIAL_TriangleFillMode])||void 0===B?void 0:B.babylonMaterial}function F(M,p){return{offset:{componentsCount:2,type:"Vector2",get:(b,q,B)=>{const k=O(b,B,M,p);return new Q.Vector2(null===k||void 0===k?void 0:k.uOffset,null===k||void 0===k?void 0:k.vOffset)},getTarget:H,set:(b,Q,q,B)=>{const k=O(Q,B,M,p);k.uOffset=b.x,k.vOffset=b.y},getPropertyName:[()=>`${M}${p?"."+p:""}.uOffset`,()=>`${M}${p?"."+p:""}.vOffset`]},rotation:{type:"number",get:(b,Q,q)=>{var B;return null===(B=O(b,q,M,p))||void 0===B?void 0:B.wAng},getTarget:H,set:(b,Q,q,B)=>O(Q,B,M,p).wAng=b,getPropertyName:[()=>`${M}${p?"."+p:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(b,q,B)=>{const k=O(b,B,M,p);return new Q.Vector2(null===k||void 0===k?void 0:k.uScale,null===k||void 0===k?void 0:k.vScale)},getTarget:H,set:(b,Q,q,B)=>{const k=O(Q,B,M,p);k.uScale=b.x,k.vScale=b.y},getPropertyName:[()=>`${M}${p?"."+p:""}.uScale`,()=>`${M}${p?"."+p:""}.vScale`]}}}const o={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:M=>{var p,b;return new Q.Vector2((null===(p=M._babylonCamera)||void 0===p?void 0:p.orthoLeft)??0,(null===(b=M._babylonCamera)||void 0===b?void 0:b.orthoRight)??0)},set:(M,p)=>{p._babylonCamera&&(p._babylonCamera.orthoLeft=M.x,p._babylonCamera.orthoRight=M.y)},getTarget:M=>M,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:M=>{var p,b;return new Q.Vector2((null===(p=M._babylonCamera)||void 0===p?void 0:p.orthoBottom)??0,(null===(b=M._babylonCamera)||void 0===b?void 0:b.orthoTop)??0)},set:(M,p)=>{p._babylonCamera&&(p._babylonCamera.orthoBottom=M.x,p._babylonCamera.orthoTop=M.y)},getTarget:M=>M,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:M=>{var p;return null===(p=M._babylonCamera)||void 0===p?void 0:p.maxZ},set:(M,p)=>{p._babylonCamera&&(p._babylonCamera.maxZ=M)},getTarget:M=>M,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:M=>{var p;return null===(p=M._babylonCamera)||void 0===p?void 0:p.Fb},set:(M,p)=>{p._babylonCamera&&(p._babylonCamera.Fb=M)},getTarget:M=>M,getPropertyName:[()=>"Fb"]}},perspective:{aspectRatio:{type:"number",get:M=>{var p;return null===(p=M._babylonCamera)||void 0===p?void 0:p.getEngine().getAspectRatio(M._babylonCamera)},getTarget:M=>M,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:M=>{var p;return null===(p=M._babylonCamera)||void 0===p?void 0:p.fov},set:(M,p)=>{p._babylonCamera&&(p._babylonCamera.fov=M)},getTarget:M=>M,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:M=>{var p;return null===(p=M._babylonCamera)||void 0===p?void 0:p.maxZ},set:(M,p)=>{p._babylonCamera&&(p._babylonCamera.maxZ=M)},getTarget:M=>M,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:M=>{var p;return null===(p=M._babylonCamera)||void 0===p?void 0:p.Fb},set:(M,p)=>{p._babylonCamera&&(p._babylonCamera.Fb=M)},getTarget:M=>M,getPropertyName:[()=>"Fb"]}}}},nodes:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Ap",get:M=>{var p;return null===(p=M._babylonTransformNode)||void 0===p?void 0:p.position},set:(M,p)=>{var b;return null===(b=p._babylonTransformNode)||void 0===b?void 0:b.position.B(M)},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:M=>{var p;return null===(p=M._babylonTransformNode)||void 0===p?void 0:p.rotationQuaternion},set:(M,p)=>{var b,Q;return null===(b=p._babylonTransformNode)||void 0===b||null===(Q=b.rotationQuaternion)||void 0===Q?void 0:Q.B(M)},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Ap",get:M=>{var p;return null===(p=M._babylonTransformNode)||void 0===p?void 0:p.ab},set:(M,p)=>{var b;return null===(b=p._babylonTransformNode)||void 0===b?void 0:b.ab.B(M)},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"ab"]},weights:{length:{type:"number",get:M=>M._numMorphTargets,getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(M,p)=>{var b,Q;return void 0!==p?null===(b=M._primitiveBabylonMeshes)||void 0===b||null===(Q=b[0].morphTargetManager)||void 0===Q?void 0:Q.getTarget(p).influence:void 0},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(M,p)=>[0],getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:M=>{var p,b,q;return Q.Matrix.Compose(null===(p=M._babylonTransformNode)||void 0===p?void 0:p.ab,null===(b=M._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion,null===(q=M._babylonTransformNode)||void 0===q?void 0:q.position)},getTarget:M=>M._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:M=>{var p,b,q,B;const k=Q.Matrix.Identity();let u=M.parent;for(;u&&u.parent;)u=u.parent;const T=(null===(p=M._babylonTransformNode)||void 0===p?void 0:p.position._isDirty)||(null===(b=M._babylonTransformNode)||void 0===b||null===(q=b.rotationQuaternion)||void 0===q?void 0:q._isDirty)||(null===(B=M._babylonTransformNode)||void 0===B?void 0:B.ab._isDirty);if(u){var O;const p=null===(O=u._babylonTransformNode)||void 0===O?void 0:O.ib(!0).invert();var H,F;if(p)null===(H=M._babylonTransformNode)||void 0===H||null===(F=H.ib(T))||void 0===F||F.multiplyToRef(p,k)}else M._babylonTransformNode&&k.B(M._babylonTransformNode.ib(T));return k},getTarget:M=>M._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:M=>{var p,b;return null===(p=M._babylonTransformNode)||void 0===p||null===(b=p.getChildren((M=>M instanceof k.b),!0)[0])||void 0===b?void 0:b.yb},getTarget:M=>{var p;return null===(p=M._babylonTransformNode)||void 0===p?void 0:p.getChildren((M=>M instanceof k.b),!0)[0]},set:(M,p)=>{if(p._babylonTransformNode){const b=p._babylonTransformNode.getChildren((M=>M instanceof k.b),!0)[0];b&&(b.yb=M)}}},color:{type:"ap",get:M=>{var p,b;return null===(p=M._babylonTransformNode)||void 0===p||null===(b=p.getChildren((M=>M instanceof k.b),!0)[0])||void 0===b?void 0:b.Pb},getTarget:M=>{var p;return null===(p=M._babylonTransformNode)||void 0===p?void 0:p.getChildren((M=>M instanceof k.b),!0)[0]},set:(M,p)=>{if(p._babylonTransformNode){const b=p._babylonTransformNode.getChildren((M=>M instanceof k.b),!0)[0];b&&(b.Pb=M)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"ap",get:(M,p,b)=>H(M,p,b).emissiveColor,set:(M,p,b,Q)=>H(p,b,Q).emissiveColor.B(M),getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:F("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(M,p,b)=>{var Q;return null===(Q=O(M,b,"bumpTexture"))||void 0===Q?void 0:Q.level},set:(M,p,b,Q)=>{const q=O(p,Q,"bumpTexture");q&&(q.level=M)},getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:F("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(M,p,b)=>H(M,p,b).ambientTextureStrength,set:(M,p,b,Q)=>{const q=H(p,b,Q);q&&(q.ambientTextureStrength=M)},getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:F("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Sb",get:(M,p,b)=>{const Q=H(M,p,b);return B.Sb.FromColor3(Q.albedoColor,Q.alpha)},set:(M,p,b,Q)=>{const q=H(p,b,Q);q.albedoColor.set(M.r,M.g,M.b),q.alpha=M.a},getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:F("albedoTexture")}},metallicFactor:{type:"number",get:(M,p,b)=>H(M,p,b).metallic,set:(M,p,b,Q)=>{const q=H(p,b,Q);q&&(q.metallic=M)},getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(M,p,b)=>H(M,p,b).roughness,set:(M,p,b,Q)=>{const q=H(p,b,Q);q&&(q.roughness=M)},getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:F("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(M,p,b)=>H(M,p,b).anisotropy.yb,set:(M,p,b,Q)=>{H(p,b,Q).anisotropy.yb=M},getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(M,p,b)=>H(M,p,b).anisotropy.angle,set:(M,p,b,Q)=>{H(p,b,Q).anisotropy.angle=M},getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:F("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(M,p,b)=>H(M,p,b).clearCoat.yb,set:(M,p,b,Q)=>{H(p,b,Q).clearCoat.yb=M},getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(M,p,b)=>H(M,p,b).clearCoat.roughness,set:(M,p,b,Q)=>{H(p,b,Q).clearCoat.roughness=M},getTarget:(M,p,b)=>H(M,p,b),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:F("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(M,p,b)=>{var Q;return null===(Q=H(M,p,b).clearCoat.bumpTexture)||void 0===Q?void 0:Q.level},getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).clearCoat.bumpTexture.level=M},extensions:{KHR_texture_transform:F("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:F("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(M,p,b)=>H(M,p,b).subSurface.dispersion,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).subSurface.dispersion=M}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(M,p,b)=>H(M,p,b).emissiveIntensity,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).emissiveIntensity=M}},KHR_materials_ior:{ior:{type:"number",get:(M,p,b)=>H(M,p,b).indexOfRefraction,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).indexOfRefraction=M}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(M,p,b)=>H(M,p,b).iridescence.yb,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).iridescence.yb=M},iridescenceIor:{type:"number",get:(M,p,b)=>H(M,p,b).iridescence.indexOfRefraction,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).iridescence.indexOfRefraction=M},iridescenceTexture:{extensions:{KHR_texture_transform:F("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(M,p,b)=>H(M,p,b).iridescence.maximumThickness,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).iridescence.maximumThickness=M},iridescenceThicknessMinimum:{type:"number",get:(M,p,b)=>H(M,p,b).iridescence.minimumThickness,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).iridescence.minimumThickness=M},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:F("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"ap",get:(M,p,b)=>H(M,p,b).sheen.color,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).sheen.color.B(M)},sheenColorTexture:{extensions:{KHR_texture_transform:F("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(M,p,b)=>H(M,p,b).sheen.yb,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).sheen.yb=M},sheenRoughnessTexture:{extensions:{KHR_texture_transform:F("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(M,p,b)=>H(M,p,b).metallicF0Factor,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).metallicF0Factor=M,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"ap",get:(M,p,b)=>H(M,p,b).metallicReflectanceColor,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).metallicReflectanceColor.B(M),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:F("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:F("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(M,p,b)=>H(M,p,b).subSurface.refractionIntensity,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).subSurface.refractionIntensity=M,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:F("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(M,p,b)=>H(M,p,b).subSurface.translucencyIntensity,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).subSurface.translucencyIntensity=M},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:F("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"ap",get:(M,p,b)=>H(M,p,b).subSurface.translucencyColor,getTarget:H,set:(M,p,b,Q)=>{var q;return M&&(null===(q=H(p,b,Q).subSurface.translucencyColor)||void 0===q?void 0:q.B(M))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:F("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"ap",get:(M,p,b)=>H(M,p,b).subSurface.tintColor,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).subSurface.tintColor.B(M)},attenuationDistance:{type:"number",get:(M,p,b)=>H(M,p,b).subSurface.tintColorAtDistance,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).subSurface.tintColorAtDistance=M},thicknessFactor:{type:"number",get:(M,p,b)=>H(M,p,b).subSurface.maximumThickness,getTarget:H,set:(M,p,b,Q)=>H(p,b,Q).subSurface.maximumThickness=M},thicknessTexture:{extensions:{KHR_texture_transform:F("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonLight)),getPropertyName:[M=>"length"]},__array__:{__target__:!0,color:{type:"ap",get:M=>{var p;return null===(p=M._babylonLight)||void 0===p?void 0:p.Pb},set:(M,p)=>{var b;return null===(b=p._babylonLight)||void 0===b?void 0:b.Pb.B(M)},getTarget:M=>M._babylonLight,getPropertyName:[M=>"diffuse"]},yb:{type:"number",get:M=>{var p;return null===(p=M._babylonLight)||void 0===p?void 0:p.yb},set:(M,p)=>p._babylonLight?p._babylonLight.yb=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"intensity"]},range:{type:"number",get:M=>{var p;return null===(p=M._babylonLight)||void 0===p?void 0:p.range},set:(M,p)=>p._babylonLight?p._babylonLight.range=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"range"]},spot:{innerConeAngle:{type:"number",get:M=>{var p;return null===(p=M._babylonLight)||void 0===p?void 0:p.innerAngle},set:(M,p)=>p._babylonLight?p._babylonLight.innerAngle=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"innerConeAngle"]},outerConeAngle:{type:"number",get:M=>{var p;return null===(p=M._babylonLight)||void 0===p?void 0:p.angle},set:(M,p)=>p._babylonLight?p._babylonLight.angle=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonLight)),getPropertyName:[M=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonTexture)),getPropertyName:[M=>"length"]},__array__:{__target__:!0,yb:{type:"number",get:M=>{var p;return null===(p=M._babylonTexture)||void 0===p?void 0:p.level},set:(M,p)=>{p._babylonTexture&&(p._babylonTexture.level=M)},getTarget:M=>M._babylonTexture},rotation:{type:"Quaternion",get:M=>{var p;return M._babylonTexture&&Q.Quaternion.FromRotationMatrix(null===(p=M._babylonTexture)||void 0===p?void 0:p.getReflectionTextureMatrix())},set:(M,p)=>{var b;p._babylonTexture&&(null!==(b=p._babylonTexture.RM())&&void 0!==b&&b.useRightHandedSystem||(M=Q.Quaternion.Inverse(M)),Q.Matrix.FromQuaternionToRef(M,p._babylonTexture.getReflectionTextureMatrix()))},getTarget:M=>M._babylonTexture}}}}},animations:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>{var p;return null===(p=M.primitives[0]._instanceData)||void 0===p?void 0:p.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function W(M){return new T(M,o)}function i(M){const p=M.split("/").map((M=>M.replace(/{}/g,"__array__")));let b=o;for(const Q of p)Q&&(b=b[Q]);if(b&&b.type&&b.get)return b}function A(M,p){const b=M.split("/").map((M=>M.replace(/{}/g,"__array__")));let Q=o;for(const q of b)q&&(Q=Q[q]);Q&&Q.type&&Q.get&&(Q.interpolation=p)}function j(M,p){const b=M.split("/").map((M=>M.replace(/{}/g,"__array__")));let Q=o;for(const q of b)if(q){if(!Q[q]){if("?"===q){Q.__ignoreObjectTree__=!0;continue}Q[q]={},"__array__"===q&&(Q[q].__target__=!0)}Q=Q[q]}Object.assign(Q,p)}},13412:(M,p,b)=>{"use strict";b.r(p),b.d(p,{AnimationPropertyInfo:()=>O,TransformNodeAnimationPropertyInfo:()=>H,WeightAnimationPropertyInfo:()=>F,getQuaternion:()=>u,getVector3:()=>k,getWeights:()=>T});var Q=b(12342),q=b(11796),B=b(13402);function k(M,p,b,Q){return q.Ap.sp(p,b).scaleInPlace(Q)}function u(M,p,b,Q){return q.Quaternion.sp(p,b).scaleInPlace(Q)}function T(M,p,b,Q){const q=new Array(M._numMorphTargets);for(let B=0;B<q.length;B++)q[B]=p[b++]*Q;return q}class O{constructor(M,p,b,Q){this.type=M,this.name=p,this.getValue=b,this.getStride=Q}_buildAnimation(M,p,b){const q=new Q.c(M,this.name,p,this.type);return q.setKeys(b),q}}class H extends O{buildAnimations(M,p,b,Q){const q=[];return q.push({babylonAnimatable:M._babylonTransformNode,babylonAnimation:this._buildAnimation(p,b,Q)}),q}}class F extends O{buildAnimations(M,p,b,q){const B=[];if(M._numMorphTargets)for(let k=0;k<M._numMorphTargets;k++){const u=new Q.c(`${p}_${k}`,this.name,b,this.type);if(u.setKeys(q.map((M=>({frame:M.frame,inTangent:M.inTangent?M.inTangent[k]:void 0,value:M.value[k],outTangent:M.outTangent?M.outTangent[k]:void 0,interpolation:M.interpolation})))),M._primitiveBabylonMeshes)for(const p of M._primitiveBabylonMeshes)if(p.morphTargetManager){const M=p.morphTargetManager.getTarget(k),b=u.clone();M.animations.push(b),B.push({babylonAnimatable:M,babylonAnimation:b})}}return B}}(0,B.k)("/nodes/{}/translation",[new H(Q.c.ANIMATIONTYPE_VECTOR3,"position",k,(()=>3))]),(0,B.k)("/nodes/{}/rotation",[new H(Q.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",u,(()=>4))]),(0,B.k)("/nodes/{}/scale",[new H(Q.c.ANIMATIONTYPE_VECTOR3,"ab",k,(()=>3))]),(0,B.k)("/nodes/{}/weights",[new F(Q.c.ANIMATIONTYPE_FLOAT,"influence",T,(M=>M._numMorphTargets))])},13371:(M,p,b)=>{"use strict";class Q{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((M,p)=>{this._resolve=M,this._reject=p}))}}var q=b(11796),B=b(11833),k=b(11621),u=b(12262),T=b(13378),O=b(13385),H=b(11624),F=b(12284),o=b(12342),W=b(12345),i=b(11664),A=b(11637),j=b(11641);class K{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(M){this._useTextureToStoreBoneMatrices=M,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(M){this._animationPropertiesOverride=M}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(M,p,b){this.name=M,this.id=p,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=q.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new H.b,this.bones=[],this._scene=b||i.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const Q=this._scene.getEngine().getCaps();this._canUseTextureForBones=Q.textureFloat&&Q.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((M=>!M.getParent()))}getTransformMatrices(M){if(this.needInitialSkinMatrix){if(!M)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return M._bonesTransformMatrices||this.prepare(!0),M._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(M){return this.needInitialSkinMatrix&&M._transformMatrixTexture?M._transformMatrixTexture:this._transformMatrixTexture}RM(){return this._scene}toString(M){let p=`Name: ${this.name}, nBones: ${this.bones.length}`;if(p+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,M){p+=", Ranges: {";let M=!0;for(const b in this._ranges)M&&(p+=", ",M=!1),p+=b;p+="}"}return p}getBoneIndexByName(M){for(let p=0,b=this.bones.length;p<b;p++)if(this.bones[p].name===M)return p;return-1}createAnimationRange(M,p,b){if(!this._ranges[M]){this._ranges[M]=new W.b(M,p,b);for(let Q=0,q=this.bones.length;Q<q;Q++)this.bones[Q].animations[0]&&this.bones[Q].animations[0].createRange(M,p,b)}}deleteAnimationRange(M){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let b=0,Q=this.bones.length;b<Q;b++)this.bones[b].animations[0]&&this.bones[b].animations[0].deleteRange(M,p);this._ranges[M]=null}getAnimationRange(M){return this._ranges[M]||null}getAnimationRanges(){const M=[];let p;for(p in this._ranges)M.push(this._ranges[p]);return M}copyAnimationRange(M,p){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[p]||!M.getAnimationRange(p))return!1;let Q=!0;const q=this._getHighestAnimationFrame()+1,B={},k=M.bones;let u,T;for(T=0,u=k.length;T<u;T++)B[k[T].name]=k[T];this.bones.length!==k.length&&(A.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${k.length}`),Q=!1);const O=b&&this.dimensionsAtRest&&M.dimensionsAtRest?this.dimensionsAtRest.divide(M.dimensionsAtRest):null;for(T=0,u=this.bones.length;T<u;T++){const M=this.bones[T].name,k=B[M];k?Q=Q&&this.bones[T].copyAnimationRange(k,p,q,b,O):(A.c.Warn("copyAnimationRange: not same rig, missing source bone "+M),Q=!1)}const H=M.getAnimationRange(p);return H&&(this._ranges[p]=new W.b(p,H.from+q,H.to+q)),Q}returnToRest(){for(const M of this.bones)-1!==M._index&&M.returnToRest()}_getHighestAnimationFrame(){let M=0;for(let p=0,b=this.bones.length;p<b;p++)if(this.bones[p].animations[0]){const b=this.bones[p].animations[0].getHighestFrame();M<b&&(M=b)}return M}beginAnimation(M,p,b,Q){const q=this.getAnimationRange(M);return q?this._scene.beginAnimation(this,q.from,q.to,p,b,Q):null}static MakeAnimationAdditive(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const Q=M.getAnimationRange(b);if(!Q)return null;const q=M._scene.getAllAnimatablesByTarget(M);let B=null;for(let u=0;u<q.length;u++){const M=q[u];if(M.fromFrame===(null===Q||void 0===Q?void 0:Q.from)&&M.toFrame===(null===Q||void 0===Q?void 0:Q.to)){B=M;break}}const k=M.getAnimatables();for(let u=0;u<k.length;u++){const M=k[u].animations;if(M)for(let Q=0;Q<M.length;Q++)o.c.MakeAnimationAdditive(M[Q],p,b)}return B&&(B.isAdditive=!0),M}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(M){this._meshesWithPoseMatrix.push(M)}_unregisterMeshWithPoseMatrix(M){const p=this._meshesWithPoseMatrix.indexOf(M);p>-1&&this._meshesWithPoseMatrix.splice(p,1)}_computeTransformMatrices(M,p){this.onBeforeComputeObservable.notifyObservers(this);for(let b=0;b<this.bones.length;b++){const Q=this.bones[b];Q._childUpdateId++;const q=Q.getParent();if(q?Q.getLocalMatrix().multiplyToRef(q.getFinalMatrix(),Q.getFinalMatrix()):p?Q.getLocalMatrix().multiplyToRef(p,Q.getFinalMatrix()):Q.getFinalMatrix().B(Q.getLocalMatrix()),-1!==Q._index){const p=null===Q._index?b:Q._index;Q.getAbsoluteInverseBindMatrix().multiplyToArray(Q.getFinalMatrix(),M,16*p)}}this._identity.copyToArray(M,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const M=this.RM().getRenderId();if(this._currentRenderId===M)return;this._currentRenderId=M}if(this._numBonesWithLinkedTransformNode>0)for(const M of this.bones)if(M._linkedTransformNode){const p=M._linkedTransformNode;M.position=p.position,p.rotationQuaternion?M.rotationQuaternion=p.rotationQuaternion:M.rotation=p.rotation,M.ab=p.ab}if(this.needInitialSkinMatrix)for(const M of this._meshesWithPoseMatrix){const p=M.getPoseMatrix();let b=this._isDirty;if(M._bonesTransformMatrices&&M._bonesTransformMatrices.length===16*(this.bones.length+1)||(M._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),b=!0),b){if(this._synchronizedWithMesh!==M){this._synchronizedWithMesh=M;for(const M of this.bones)if(!M.getParent()){M.getBindMatrix().multiplyToRef(p,q.TmpVectors.Matrix[1]),M._updateAbsoluteBindMatrices(q.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const p=4*(this.bones.length+1);M._transformMatrixTexture&&M._transformMatrixTexture.getSize().width===p||(M._transformMatrixTexture&&M._transformMatrixTexture.dispose(),M._transformMatrixTexture=F.e.CreateRGBATexture(M._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(M._bonesTransformMatrices,p),this.isUsingTextureForMatrices&&M._transformMatrixTexture&&M._transformMatrixTexture.update(M._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=F.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let M=0;M<this.bones.length;M++)this._animatables.push(this.bones[M])}return this._animatables}clone(M,p){const b=new K(M,p||M,this._scene);b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Q=0;Q<this.bones.length;Q++){const M=this.bones[Q];let p=null;const q=M.getParent();if(q){const M=this.bones.indexOf(q);p=b.bones[M]}const B=new O.d(M.name,b,p,M.getBindMatrix().clone(),M.getRestMatrix().clone());B._index=M._index,M._linkedTransformNode&&B.linkTransformNode(M._linkedTransformNode),j.c.DeepCopy(M.animations,B.animations)}if(this._ranges){b._ranges={};for(const M in this._ranges){const p=this._ranges[M];p&&(b._ranges[M]=p.clone())}}return this._isDirty=!0,b.prepare(!0),b}enableBlending(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const p of this.bones)for(const b of p.animations)b.enableBlending=!0,b.blendingSpeed=M}dispose(){if(this._meshesWithPoseMatrix.length=0,this.RM().stopAnimation(this),this.RM().removeSkeleton(this),this._parentContainer){const M=this._parentContainer.skeletons.indexOf(this);M>-1&&this._parentContainer.skeletons.splice(M,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const M={};M.name=this.name,M.id=this.id,this.dimensionsAtRest&&(M.dimensionsAtRest=this.dimensionsAtRest.Ob()),M.bones=[],M.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let b=0;b<this.bones.length;b++){var p;const Q=this.bones[b],q=Q.getParent(),B={parentBoneIndex:q?this.bones.indexOf(q):-1,index:Q.getIndex(),name:Q.name,id:Q.id,matrix:Q.getBindMatrix().Ob(),rest:Q.getRestMatrix().Ob(),linkedTransformNodeId:null===(p=Q.getTransformNode())||void 0===p?void 0:p.id};M.bones.push(B),Q.length&&(B.length=Q.length),Q.metadata&&(B.metadata=Q.metadata),Q.animations&&Q.animations.length>0&&(B.animation=Q.animations[0].serialize()),M.ranges=[];for(const p in this._ranges){const b=this._ranges[p];if(!b)continue;const Q={};Q.name=p,Q.from=b.from,Q.to=b.to,M.ranges.push(Q)}}return M}static Parse(M,p){const b=new K(M.name,M.id,p);let Q;for(M.dimensionsAtRest&&(b.dimensionsAtRest=q.Ap.sp(M.dimensionsAtRest)),b.needInitialSkinMatrix=M.needInitialSkinMatrix,Q=0;Q<M.bones.length;Q++){const p=M.bones[Q],B=M.bones[Q].index;let k=null;p.parentBoneIndex>-1&&(k=b.bones[p.parentBoneIndex]);const u=p.rest?q.Matrix.sp(p.rest):null,T=new O.d(p.name,b,k,q.Matrix.sp(p.matrix),u,null,B);void 0!==p.id&&null!==p.id&&(T.id=p.id),p.length&&(T.length=p.length),p.metadata&&(T.metadata=p.metadata),p.animation&&T.animations.push(o.c.Parse(p.animation)),void 0!==p.linkedTransformNodeId&&null!==p.linkedTransformNodeId&&(b._hasWaitingData=!0,T._waitingTransformNodeId=p.linkedTransformNodeId)}if(M.ranges)for(Q=0;Q<M.ranges.length;Q++){const p=M.ranges[Q];b.createAnimationRange(p.name,p.from,p.to)}return b}computeAbsoluteMatrices(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||M)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(M)}getPoseMatrix(){let M=null;return this._meshesWithPoseMatrix.length>0&&(M=this._meshesWithPoseMatrix[0].getPoseMatrix()),M}sortBones(){const M=[],p=new Array(this.bones.length);for(let b=0;b<this.bones.length;b++)this._sortBones(b,M,p);this.bones=M}_sortBones(M,p,b){if(b[M])return;b[M]=!0;const Q=this.bones[M];if(!Q)return;void 0===Q._index&&(Q._index=M);const q=Q.getParent();q&&this._sortBones(this.bones.indexOf(q),p,b),p.push(Q)}setCurrentPoseAsRest(){for(const M of this.bones)M.setCurrentPoseAsRest()}}var D=b(12129),a=b(12305),s=b(11780),S=b(12231),f=b(11857),R=b(12271),y=b(12242),x=b(12257),P=b(12347),L=b(11874),N=b(13336);class r{set areUpdatesFrozen(M){M?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new L.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,M||(M=i.c.LastCreatedScene),this._scene=M,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const M=this._scene.getEngine().getCaps();this._canUseTextureForTargets=M.canUseGLVertexID&&M.textureFloat&&M.maxVertexTextureImageUnits>0&&M.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return r.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?r.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(M){this._numMaxInfluencers!==M&&(this._numMaxInfluencers=M,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(M){this._useTextureToStoreTargets!==M&&(this._useTextureToStoreTargets=M,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var M;return r.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(M=this._scene)&&void 0!==M&&M.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(M){return this._activeTargets.data[M]}getTarget(M){return this._targets[M]}getTargetByName(M){for(const p of this._targets)if(p.name===M)return p;return null}addTarget(M){this._targets.push(M),this._targetInfluenceChangedObservers.push(M.onInfluenceChanged.add((M=>{this.areUpdatesFrozen&&M&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(M)}))),this._targetDataLayoutChangedObservers.push(M._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(M){const p=this._targets.indexOf(M);p>=0&&(this._targets.splice(p,1),M.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(p,1)[0]),M._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(p,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(M)}_bind(M){M.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),M.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),M.setTexture("morphTargets",this._targetStoreTexture),M.setInt("morphTargetCount",this.numInfluencers)}clone(){const M=new r(this._scene);for(const p of this._targets)M.addTarget(p.clone());return M.enablePositionMorphing=this.enablePositionMorphing,M.enableNormalMorphing=this.enableNormalMorphing,M.enableTangentMorphing=this.enableTangentMorphing,M.enableUVMorphing=this.enableUVMorphing,M.enableUV2Morphing=this.enableUV2Morphing,M.enableColorMorphing=this.enableColorMorphing,M}serialize(){const M={};M.id=this.uniqueId,M.targets=[];for(const p of this._targets)M.targets.push(p.serialize());return M}_syncActiveTargets(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const p=!!this._targetStoreTexture,b=this.isUsingTextureForTargets;(this._mustSynchronize||p!==b)&&(this._mustSynchronize=!1,this.synchronize());let Q=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let q=-1;for(const B of this._targets)if(q++,0!==B.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=r.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(B),this._morphTargetTextureIndices[Q]=q,this._tempInfluences[Q++]=B.influence}this._morphTargetTextureIndices.length!==Q&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,Q)),this._influences&&this._influences.length===Q||(this._influences=new Float32Array(Q));for(let B=0;B<Q;B++)this._influences[B]=this._tempInfluences[B];if(M&&this._scene)for(const B of this._scene.meshes)B.morphTargetManager===this&&(b?B._markSubMeshesAsAttributesDirty():B._syncGeometryWithMorphTargetManager())}synchronize(){var M;if(!this._scene||this.areUpdatesFrozen)return;const p=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(M=this._targetStoreTexture)||void 0===M||M.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>p.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const b of this._targets){this._supportsPositions=this._supportsPositions&&b.hasPositions,this._supportsNormals=this._supportsNormals&&b.hasNormals,this._supportsTangents=this._supportsTangents&&b.hasTangents,this._supportsUVs=this._supportsUVs&&b.hasUVs,this._supportsUV2s=this._supportsUV2s&&b.hasUV2s,this._supportsColors=this._supportsColors&&b.hasColors;const M=b.vertexCount;if(0===this._vertexCount)this._vertexCount=M;else if(this._vertexCount!==M)return void A.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${b.name}": ${M}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const M=p.getCaps().maxTextureSize;this._textureWidth>M&&(this._textureHeight=Math.ceil(this._textureWidth/M),this._textureWidth=M);const b=this._targets.length,Q=new Float32Array(b*this._textureWidth*this._textureHeight*4);let q=0;for(let p=0;p<b;p++){const M=this._targets[p],b=M.getPositions(),B=M.getNormals(),k=M.getUVs(),u=M.getTangents(),T=M.getUV2s(),O=M.getColors();q=p*this._textureWidth*this._textureHeight*4;for(let p=0;p<this._vertexCount;p++)this._supportsPositions&&b&&(Q[q]=b[3*p],Q[q+1]=b[3*p+1],Q[q+2]=b[3*p+2],q+=4),this._supportsNormals&&B&&(Q[q]=B[3*p],Q[q+1]=B[3*p+1],Q[q+2]=B[3*p+2],q+=4),this._supportsUVs&&k&&(Q[q]=k[2*p],Q[q+1]=k[2*p+1],q+=4),this._supportsTangents&&u&&(Q[q]=u[3*p],Q[q+1]=u[3*p+1],Q[q+2]=u[3*p+2],q+=4),this._supportsUV2s&&T&&(Q[q]=T[2*p],Q[q+1]=T[2*p+1],q+=4),this._supportsColors&&O&&(Q[q]=O[4*p],Q[q+1]=O[4*p+1],Q[q+2]=O[4*p+2],Q[q+3]=O[4*p+3],q+=4)}this._targetStoreTexture=N.e.CreateRGBATexture(Q,this._textureWidth,this._textureHeight,b,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const b of this._scene.meshes)b.morphTargetManager===this&&b._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const M=this._parentContainer.morphTargetManagers.indexOf(this);M>-1&&this._parentContainer.morphTargetManagers.splice(M,1),this._parentContainer=null}for(const M of this._targets)this._scene.stopAnimation(M)}}static Parse(M,p){const b=new r(p);for(const Q of M.targets)b.addTarget(P.e.Parse(Q,p));return b}}r.EnableTextureStorage=!0,r.MaxActiveMorphTargetsInVertexAttributeMode=8,r.ConstantTargetCountForTextureMode=0;var Y=b(13393),w=b(11671),E=b(12150);const n=new Map,g=n;function U(M,p,b){c(M)&&A.c.Warn(`Extension with the name '${M}' already exists`),n.set(M,{isGLTFExtension:p,factory:b})}function c(M){return n.delete(M)}var d=b(13402),V=b(12392),h=b(11863);class I{static Get(M,p,b){if(!p||void 0==b||!p[b])throw new Error(`${M}: Failed to find index (${b})`);return p[b]}static TryGet(M,p){return M&&void 0!=p&&M[p]?M[p]:null}static Assign(M){if(M)for(let p=0;p<M.length;p++)M[p].index=p}}function Z(M){if(M.min&&M.max){const p=M.min,b=M.max,Q=q.TmpVectors.Ap[0].Db(p[0],p[1],p[2]),B=q.TmpVectors.Ap[1].Db(b[0],b[1],b[2]);if(M.normalized&&5126!==M.componentType){let p=1;switch(M.componentType){case 5120:p=127;break;case 5121:p=255;break;case 5122:p=32767;break;case 5123:p=65535}const b=1/p;Q.scaleInPlace(b),B.scaleInPlace(b)}return new E.d(Q,B)}return null}class J{static RegisterExtension(M,p){U(M,!1,p)}static UnregisterExtension(M){return c(M)}get Bb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(M){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=M}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((M=>M.dispose&&M.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(M,p,b,Q,q,B){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=p,this._assetContainer=b,this._loadData(Q);let B=null;if(M){const p={};if(this._gltf.nodes)for(const M of this._gltf.nodes)M.name&&(p[M.name]=M.index);B=(M instanceof Array?M:[M]).map((M=>{const b=p[M];if(void 0===b)throw new Error(`Failed to find node '${M}'`);return b}))}return await this._loadAsync(q,k,B,(()=>({meshes:this._getMeshes(),qo:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=M,this._loadData(p),await this._loadAsync(b,q,null,(()=>{}))}async _loadAsync(M,p,b,Q){return await Promise.resolve().then((async()=>{this._rootUrl=M,this._uniqueRootUrl=!M.startsWith("file:")&&p?M:`${M}${Date.now()}/`,this._fileName=p,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const q=`${Y.h[Y.h.LOADING]} => ${Y.h[Y.h.READY]}`,B=`${Y.h[Y.h.LOADING]} => ${Y.h[Y.h.COMPLETE]}`;this._parent._startPerformanceCounter(q),this._parent._startPerformanceCounter(B),this._parent._setState(Y.h.LOADING),this._extensionsOnLoading();const u=new Array;if(!this.parent.loadOnlyMaterials)if(b)u.push(this.loadSceneAsync("/nodes",{nodes:b,index:-1}));else if(void 0!=this._gltf.Kp||this._gltf.scenes&&this._gltf.scenes[0]){const M=I.Get("/scene",this._gltf.scenes,this._gltf.Kp||0);u.push(this.loadSceneAsync(`/scenes/${M.index}`,M))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let M=0;M<this._gltf.materials.length;++M){const p=this._gltf.materials[M],b="/materials/"+M,Q=D.e.TriangleFillMode;u.push(this._loadMaterialAsync(b,p,null,Q,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&u.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&u.push(this._compileShadowGeneratorsAsync());const T=Promise.all(u).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.pT(!0);for(const M of this._babylonScene.materials){const p=M;void 0!==p.maxSimultaneousLights&&(p.maxSimultaneousLights=Math.max(p.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(Y.h.READY),this._skipStartAnimationStep||this._startAnimations(),Q()}));return await T.then((M=>(this._parent._endPerformanceCounter(q),k.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(B),this._parent._setState(Y.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(M=>{this._parent.onErrorObservable.notifyObservers(M),this._parent.onErrorObservable.clear(),this.dispose()}))})),M)))})).catch((M=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(M),this._parent.onErrorObservable.clear(),this.dispose()),M}))}_loadData(M){if(this._gltf=M.json,this._setupData(),M.bin){const p=this._gltf.buffers;if(p&&p[0]&&!p[0].uri){const b=p[0];(b.byteLength<M.bin.byteLength-3||b.byteLength>M.bin.byteLength)&&A.c.Warn(`Binary buffer length (${b.byteLength}) from JSON does not match chunk length (${M.bin.byteLength})`),this._bin=M.bin}else A.c.Warn("Unexpected BIN chunk")}}_setupData(){if(I.Assign(this._gltf.accessors),I.Assign(this._gltf.animations),I.Assign(this._gltf.buffers),I.Assign(this._gltf.bufferViews),I.Assign(this._gltf.cameras),I.Assign(this._gltf.images),I.Assign(this._gltf.materials),I.Assign(this._gltf.meshes),I.Assign(this._gltf.nodes),I.Assign(this._gltf.samplers),I.Assign(this._gltf.scenes),I.Assign(this._gltf.skins),I.Assign(this._gltf.textures),this._gltf.nodes){const M={};for(const b of this._gltf.nodes)if(b.children)for(const p of b.children)M[p]=b.index;const p=this._createRootNode();for(const b of this._gltf.nodes){const Q=M[b.index];b.parent=void 0===Q?p:this._gltf.nodes[Q]}}}async _loadExtensionsAsync(){const M=[];if(g.forEach(((p,b)=>{var Q;!1===(null===(Q=this.parent.extensionOptions[b])||void 0===Q?void 0:Q.enabled)?p.isGLTFExtension&&this.isExtensionUsed(b)&&A.c.Warn(`Extension ${b} is used but has been explicitly disabled.`):p.isGLTFExtension&&!this.isExtensionUsed(b)||M.push((async()=>{const M=await p.factory(this);return M.name!==b&&A.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${M.name} !== ${b}`),this._parent.onExtensionLoadedObservable.notifyObservers(M),M})())})),this._extensions.push(...await Promise.all(M)),this._extensions.sort(((M,p)=>(M.order||Number.MAX_VALUE)-(p.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const b of this._gltf.extensionsRequired){if(!this._extensions.some((M=>M.name===b&&M.enabled))){var p;if(!1===(null===(p=this.parent.extensionOptions[b])||void 0===p?void 0:p.enabled))throw new Error(`Required extension ${b} is disabled`);throw new Error(`Required extension ${b} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new x.d("__root__",this._babylonScene);this._rootBabylonMesh=M,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.pT(!1);const p={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case Y.g.AUTO:this._babylonScene.useRightHandedSystem||(p.rotation=[0,1,0,0],p.scale=[1,1,-1],J._LoadTransform(p,this._rootBabylonMesh));break;case Y.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(M),p}loadSceneAsync(M,p){const b=this._extensionsLoadSceneAsync(M,p);if(b)return b;const Q=new Array;if(this.logOpen(`${M} ${p.name||""}`),p.nodes)for(const q of p.nodes){const p=I.Get(`${M}/nodes/${q}`,this._gltf.nodes,q);Q.push(this.loadNodeAsync(`/nodes/${p.index}`,p,(M=>{M.parent=this._rootBabylonMesh})))}for(const q of this._postSceneLoadActions)q();return Q.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(Q).then((()=>{}))}_forEachPrimitive(M,p){if(M._primitiveBabylonMeshes)for(const b of M._primitiveBabylonMeshes)p(b)}_getGeometries(){const M=[],p=this._gltf.nodes;if(p)for(const b of p)this._forEachPrimitive(b,(p=>{const b=p.Ab;b&&-1===M.indexOf(b)&&M.push(b)}));return M}_getMeshes(){const M=[];this._rootBabylonMesh instanceof y.b&&M.push(this._rootBabylonMesh);const p=this._gltf.nodes;if(p)for(const b of p)this._forEachPrimitive(b,(p=>{M.push(p)}));return M}_getTransformNodes(){const M=[],p=this._gltf.nodes;if(p)for(const b of p)b._babylonTransformNode&&"Yb"===b._babylonTransformNode.getClassName()&&M.push(b._babylonTransformNode),b._babylonTransformNodeForSkin&&M.push(b._babylonTransformNodeForSkin);return M}_getSkeletons(){const M=[],p=this._gltf.skins;if(p)for(const b of p)b._data&&M.push(b._data.babylonSkeleton);return M}_getAnimationGroups(){const M=[],p=this._gltf.animations;if(p)for(const b of p)b._babylonAnimationGroup&&M.push(b._babylonAnimationGroup);return M}_startAnimations(){switch(this._parent.animationStartMode){case Y.e.NONE:break;case Y.e.FIRST:{const M=this._getAnimationGroups();0!==M.length&&M[0].start(!0);break}case Y.e.ALL:{const M=this._getAnimationGroups();for(const p of M)p.start(!0);break}default:return void A.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadNodeAsync(M,p,b);if(Q)return Q;if(p._babylonTransformNode)throw new Error(`${M}: Invalid recursive node hierarchy`);const q=new Array;this.logOpen(`${M} ${p.name||""}`);const B=Q=>{if(J.AddPointerMetadata(Q,M),J._LoadTransform(p,Q),void 0!=p.camera){const b=I.Get(`${M}/camera`,this._gltf.cameras,p.camera);q.push(this.loadCameraAsync(`/cameras/${b.index}`,b,(M=>{M.parent=Q,this._babylonScene.useRightHandedSystem||(Q.ab.x=-1)})))}if(p.children)for(const b of p.children){const p=I.Get(`${M}/children/${b}`,this._gltf.nodes,b);q.push(this.loadNodeAsync(`/nodes/${p.index}`,p,(M=>{M.parent=Q})))}b(Q)},k=void 0!=p.mesh,u=this._parent.loadSkins&&void 0!=p.skin;if(!k||u){const M=p.name||`node${p.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new S.c(M,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==p.mesh?p._babylonTransformNode=b:p._babylonTransformNodeForSkin=b,B(b)}if(k)if(u){const b=I.Get(`${M}/mesh`,this._gltf.meshes,p.mesh);q.push(this._loadMeshAsync(`/meshes/${b.index}`,p,b,(b=>{const Q=p._babylonTransformNodeForSkin;b.metadata=(0,V.c)(Q.metadata,b.metadata||{});const B=I.Get(`${M}/skin`,this._gltf.skins,p.skin);q.push(this._loadSkinAsync(`/skins/${B.index}`,p,B,(M=>{this._forEachPrimitive(p,(p=>{p.skeleton=M})),this._postSceneLoadActions.push((()=>{if(void 0!=B.skeleton){const M=I.Get(`/skins/${B.index}/skeleton`,this._gltf.nodes,B.skeleton).parent;p.index===M.index?b.parent=Q.parent:b.parent=M._babylonTransformNode}else b.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:Q,skinnedNode:b})}))})))})))}else{const b=I.Get(`${M}/mesh`,this._gltf.meshes,p.mesh);q.push(this._loadMeshAsync(`/meshes/${b.index}`,p,b,B))}return this.logClose(),Promise.all(q).then((()=>(this._forEachPrimitive(p,(M=>{const p=M;!p.isAnInstance&&p.Ab&&p.Ab.useBoundingInfoFromGeometry?M.EM():M.refreshBoundingInfo(!0,!0)})),p._babylonTransformNode)))}_loadMeshAsync(M,p,b,Q){const q=b.primitives;if(!q||!q.length)throw new Error(`${M}: Primitives are missing`);void 0==q[0].index&&I.Assign(q);const B=new Array;this.logOpen(`${M} ${b.name||""}`);const k=p.name||`node${p.index}`;if(1===q.length){const Q=b.primitives[0];B.push(this._loadMeshPrimitiveAsync(`${M}/primitives/${Q.index}`,k,p,b,Q,(M=>{p._babylonTransformNode=M,p._primitiveBabylonMeshes=[M]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,p._babylonTransformNode=new S.c(k,this._babylonScene),p._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._primitiveBabylonMeshes=[];for(const Q of q)B.push(this._loadMeshPrimitiveAsync(`${M}/primitives/${Q.index}`,`${k}_primitive${Q.index}`,p,b,Q,(M=>{M.parent=p._babylonTransformNode,p._primitiveBabylonMeshes.push(M)})))}return Q(p._babylonTransformNode),this.logClose(),Promise.all(B).then((()=>p._babylonTransformNode))}_loadMeshPrimitiveAsync(M,p,b,Q,q,B){const k=this._extensionsLoadMeshPrimitiveAsync(M,p,b,Q,q,B);if(k)return k;this.logOpen(`${M}`);const u=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==b.skin&&!Q.primitives[0].targets;let T,O;if(u&&q._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,T=q._instanceData.babylonSourceMesh.createInstance(p),T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O=q._instanceData.promise;else{const B=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new x.d(p,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.sideOrientation=this._babylonScene.useRightHandedSystem?D.e.CounterClockWiseSideOrientation:D.e.ClockWiseSideOrientation,this._createMorphTargets(M,b,Q,q,k),B.push(this._loadVertexDataAsync(M,q,k).then((async p=>await this._loadMorphTargetsAsync(M,q,k,p).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,p.YM(k),p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const H=J._GetDrawMode(M,q.mode);if(void 0==q.material){let M=this._defaultBabylonMaterialData[H];M||(M=this._createDefaultMaterial("__GLTFLoader._default",H),this._parent.onMaterialLoadedObservable.notifyObservers(M),this._defaultBabylonMaterialData[H]=M),k.material=M}else if(!this.parent.skipMaterials){const p=I.Get(`${M}/material`,this._gltf.materials,q.material);B.push(this._loadMaterialAsync(`/materials/${p.index}`,p,k,H,(M=>{k.material=M})))}O=Promise.all(B),u&&(q._instanceData={babylonSourceMesh:k,promise:O}),T=k}return J.AddPointerMetadata(T,M),this._parent.onMeshLoadedObservable.notifyObservers(T),B(T),this.logClose(),O.then((()=>T))}_loadVertexDataAsync(M,p,b){const Q=this._extensionsLoadVertexDataAsync(M,p,b);if(Q)return Q;const q=p.attributes;if(!q)throw new Error(`${M}: Attributes are missing`);const B=new Array,k=new R.d(b.name,this._babylonScene);if(void 0==p.indices)b.isUnIndexed=!0;else{const b=I.Get(`${M}/indices`,this._gltf.accessors,p.indices);B.push(this._loadIndicesAccessorAsync(`/accessors/${b.index}`,b).then((M=>{k.setIndices(M)})))}const u=(p,Q,u)=>{if(void 0==q[p])return;b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(Q)&&b._delayInfo.push(Q);const T=I.Get(`${M}/attributes/${p}`,this._gltf.accessors,q[p]);B.push(this._loadVertexAccessorAsync(`/accessors/${T.index}`,T,Q).then((M=>{if(M.getKind()===f.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!b.skeleton){const M=Z(T);M&&(k._boundingInfo=M,k.useBoundingInfoFromGeometry=!0)}k.setVerticesBuffer(M,T.count)}))),Q==f.f.MatricesIndicesExtraKind&&(b.numBoneInfluencers=8),u&&u(T)};return u("POSITION",f.f.PositionKind),u("NORMAL",f.f.NormalKind),u("TANGENT",f.f.TangentKind),u("TEXCOORD_0",f.f.UVKind),u("TEXCOORD_1",f.f.UV2Kind),u("TEXCOORD_2",f.f.UV3Kind),u("TEXCOORD_3",f.f.UV4Kind),u("TEXCOORD_4",f.f.UV5Kind),u("TEXCOORD_5",f.f.UV6Kind),u("JOINTS_0",f.f.MatricesIndicesKind),u("WEIGHTS_0",f.f.MatricesWeightsKind),u("JOINTS_1",f.f.MatricesIndicesExtraKind),u("WEIGHTS_1",f.f.MatricesWeightsExtraKind),u("COLOR_0",f.f.ColorKind,(M=>{"VEC4"===M.type&&(b.hasVertexAlpha=!0)})),Promise.all(B).then((()=>k))}_createMorphTargets(M,p,b,Q,q){if(!Q.targets||!this._parent.loadMorphTargets)return;if(void 0==p._numMorphTargets)p._numMorphTargets=Q.targets.length;else if(Q.targets.length!==p._numMorphTargets)throw new Error(`${M}: Primitives do not have the same number of targets`);const B=b.extras?b.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,q.morphTargetManager=new r(this._babylonScene),q.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.morphTargetManager.areUpdatesFrozen=!0;for(let k=0;k<Q.targets.length;k++){const M=p.weights?p.weights[k]:b.weights?b.weights[k]:0,Q=B?B[k]:`morphTarget${k}`;q.morphTargetManager.addTarget(new P.e(Q,M,q.RM()))}}_loadMorphTargetsAsync(M,p,b,Q){if(!p.targets||!this._parent.loadMorphTargets)return Promise.resolve();const q=new Array,B=b.morphTargetManager;for(let k=0;k<B.numTargets;k++){const b=B.getTarget(k);q.push(this._loadMorphTargetVertexDataAsync(`${M}/targets/${k}`,Q,p.targets[k],b))}return Promise.all(q).then((()=>{B.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(M,p,b,Q){const q=new Array,B=(Q,B,k)=>{if(void 0==b[Q])return;const u=p.getVertexBuffer(B);if(!u)return;const T=I.Get(`${M}/${Q}`,this._gltf.accessors,b[Q]);q.push(this._loadFloatAccessorAsync(`/accessors/${T.index}`,T).then((M=>{k(u,M)})))};return B("POSITION",f.f.PositionKind,((M,p)=>{const b=new Float32Array(p.length);M.forEach(p.length,((M,Q)=>{b[Q]=p[Q]+M})),Q.setPositions(b)})),B("NORMAL",f.f.NormalKind,((M,p)=>{const b=new Float32Array(p.length);M.forEach(b.length,((M,Q)=>{b[Q]=p[Q]+M})),Q.setNormals(b)})),B("TANGENT",f.f.TangentKind,((M,p)=>{const b=new Float32Array(p.length/3*4);let q=0;M.forEach(p.length/3*4,((M,Q)=>{(Q+1)%4!==0&&(b[q]=p[q]+M,q++)})),Q.setTangents(b)})),B("TEXCOORD_0",f.f.UVKind,((M,p)=>{const b=new Float32Array(p.length);M.forEach(p.length,((M,Q)=>{b[Q]=p[Q]+M})),Q.setUVs(b)})),B("TEXCOORD_1",f.f.UV2Kind,((M,p)=>{const b=new Float32Array(p.length);M.forEach(p.length,((M,Q)=>{b[Q]=p[Q]+M})),Q.setUV2s(b)})),B("COLOR_0",f.f.ColorKind,((p,b)=>{let q=null;const B=p.getSize();if(3===B){q=new Float32Array(b.length/3*4),p.forEach(b.length,((M,p)=>{const Q=Math.floor(p/3),B=p%3;q[4*Q+B]=b[3*Q+B]+M}));for(let M=0;M<b.length/3;++M)q[4*M+3]=1}else{if(4!==B)throw new Error(`${M}: Invalid number of components (${B}) for COLOR_0 attribute`);q=new Float32Array(b.length),p.forEach(b.length,((M,p)=>{q[p]=b[p]+M}))}Q.setColors(q)})),await Promise.all(q).then((()=>{}))}static _LoadTransform(M,p){if(void 0!=M.skin)return;let b=q.Ap.Zero(),Q=q.Quaternion.Identity(),B=q.Ap.One();if(M.matrix){q.Matrix.sp(M.matrix).decompose(B,Q,b)}else M.translation&&(b=q.Ap.sp(M.translation)),M.rotation&&(Q=q.Quaternion.sp(M.rotation)),M.scale&&(B=q.Ap.sp(M.scale));p.position=b,p.rotationQuaternion=Q,p.ab=B}_loadSkinAsync(M,p,b,Q){if(!this._parent.loadSkins)return Promise.resolve();const q=this._extensionsLoadSkinAsync(M,p,b);if(q)return q;if(b._data)return Q(b._data.babylonSkeleton),b._data.promise;const B=`skeleton${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new K(b.name||B,B,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(M,b,k);const u=this._loadSkinInverseBindMatricesDataAsync(M,b).then((M=>{this._updateBoneMatrices(k,M)}));return b._data={babylonSkeleton:k,promise:u},Q(k),u}_loadBones(M,p,b){if(void 0==p.skeleton||this._parent.alwaysComputeSkeletonRootNode){const b=this._findSkeletonRootNode(`${M}/joints`,p.joints);if(b)if(void 0===p.skeleton)p.skeleton=b.index;else{const Q=(M,p)=>{for(;p.parent;p=p.parent)if(p.parent===M)return!0;return!1},q=I.Get(`${M}/skeleton`,this._gltf.nodes,p.skeleton);q===b||Q(q,b)||(A.c.Warn(`${M}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),p.skeleton=b.index)}else A.c.Warn(`${M}: Failed to find common root`)}const Q={};for(const q of p.joints){const B=I.Get(`${M}/joints/${q}`,this._gltf.nodes,q);this._loadBone(B,p,b,Q)}}_findSkeletonRootNode(M,p){if(0===p.length)return null;const b={};for(const q of p){const p=[];let Q=I.Get(`${M}/${q}`,this._gltf.nodes,q);for(;-1!==Q.index;)p.unshift(Q),Q=Q.parent;b[q]=p}let Q=null;for(let q=0;;++q){let M=b[p[0]];if(q>=M.length)return Q;const B=M[q];for(let k=1;k<p.length;++k)if(M=b[p[k]],q>=M.length||B!==M[q])return Q;Q=B}}_loadBone(M,p,b,Q){M._isJoint=!0;let q=Q[M.index];if(q)return q;let B=null;M.index!==p.skeleton&&(M.parent&&-1!==M.parent.index?B=this._loadBone(M.parent,p,b,Q):void 0!==p.skeleton&&A.c.Warn(`/skins/${p.index}/skeleton: Skeleton node is not a common root`));const k=p.joints.indexOf(M.index);return q=new O.d(M.name||`joint${M.index}`,b,B,this._getNodeMatrix(M),null,null,k),Q[M.index]=q,this._postSceneLoadActions.push((()=>{q.linkTransformNode(M._babylonTransformNode)})),q}_loadSkinInverseBindMatricesDataAsync(M,p){if(void 0==p.inverseBindMatrices)return Promise.resolve(null);const b=I.Get(`${M}/inverseBindMatrices`,this._gltf.accessors,p.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${b.index}`,b)}_updateBoneMatrices(M,p){for(const b of M.bones){const M=q.Matrix.Identity(),Q=b._index;p&&-1!==Q&&(q.Matrix.FromArrayToRef(p,16*Q,M),M.invertToRef(M));const B=b.getParent();B&&M.multiplyToRef(B.getAbsoluteInverseBindMatrix(),M),b.ob(M,!1,!1),b._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(M){return M.matrix?q.Matrix.sp(M.matrix):q.Matrix.Compose(M.scale?q.Ap.sp(M.scale):q.Ap.One(),M.rotation?q.Quaternion.sp(M.rotation):q.Quaternion.Identity(),M.translation?q.Ap.sp(M.translation):q.Ap.Zero())}loadCameraAsync(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadCameraAsync(M,p,b);if(Q)return Q;const B=new Array;this.logOpen(`${M} ${p.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new T.d(p.name||`camera${p.index}`,q.Ap.Zero(),this._babylonScene,!1);switch(k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._babylonCamera=k,k.setTarget(new q.Ap(0,0,-1)),p.type){case"perspective":{const b=p.perspective;if(!b)throw new Error(`${M}: Camera perspective properties are missing`);k.fov=b.yfov,k.Fb=b.znear,k.maxZ=b.zfar||0;break}case"orthographic":if(!p.orthographic)throw new Error(`${M}: Camera orthographic properties are missing`);k.mode=u.b.ORTHOGRAPHIC_CAMERA,k.orthoLeft=-p.orthographic.xmag,k.orthoRight=p.orthographic.xmag,k.orthoBottom=-p.orthographic.ymag,k.orthoTop=p.orthographic.ymag,k.Fb=p.orthographic.znear,k.maxZ=p.orthographic.zfar;break;default:throw new Error(`${M}: Invalid camera type (${p.type})`)}return J.AddPointerMetadata(k,M),this._parent.onCameraLoadedObservable.notifyObservers(k),b(k),this.logClose(),Promise.all(B).then((()=>k))}_loadAnimationsAsync(){const M=this._gltf.animations;if(!M)return Promise.resolve();const p=new Array;for(let b=0;b<M.length;b++){const Q=M[b];p.push(this.loadAnimationAsync(`/animations/${Q.index}`,Q).then((M=>{0===M.targetedAnimations.length&&M.dispose()})))}return Promise.all(p).then((()=>{}))}loadAnimationAsync(M,p){const Q=this._extensionsLoadAnimationAsync(M,p);return Q||b.e(78).then(b.bind(b,14916)).then((b=>{let{AnimationGroup:Q}=b;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new Q(p.name||`animation${p.index}`,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._babylonAnimationGroup=q;const B=new Array;I.Assign(p.channels),I.Assign(p.samplers);for(const k of p.channels)B.push(this._loadAnimationChannelAsync(`${M}/channels/${k.index}`,M,p,k,((M,p)=>{M.animations=M.animations||[],M.animations.push(p),q.addTargetedAnimation(p,M)})));return Promise.all(B).then((()=>(q.normalize(0),q)))}))}async _loadAnimationChannelAsync(M,p,Q,q,B){const k=this._extensionsLoadAnimationChannelAsync(M,p,Q,q,B);if(k)return await k;if(void 0==q.target.node)return await Promise.resolve();const u=I.Get(`${M}/target/node`,this._gltf.nodes,q.target.node),T=q.target.path,O="weights"===T;if(O&&!u._numMorphTargets||!O&&!u._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!O&&!u._isJoint)return await Promise.resolve();let H;switch(await Promise.resolve().then(b.bind(b,13412)),T){case"translation":var F;H=null===(F=(0,d.f)("/nodes/{}/translation"))||void 0===F?void 0:F.interpolation;break;case"rotation":var o;H=null===(o=(0,d.f)("/nodes/{}/rotation"))||void 0===o?void 0:o.interpolation;break;case"scale":var W;H=null===(W=(0,d.f)("/nodes/{}/scale"))||void 0===W?void 0:W.interpolation;break;case"weights":var i;H=null===(i=(0,d.f)("/nodes/{}/weights"))||void 0===i?void 0:i.interpolation;break;default:throw new Error(`${M}/target/path: Invalid value (${q.target.path})`)}if(!H)throw new Error(`${M}/target/path: Could not find interpolation properties for target path (${q.target.path})`);const A={object:u,info:H};return await this._loadAnimationChannelFromTargetInfoAsync(M,p,Q,q,A,B)}_loadAnimationChannelFromTargetInfoAsync(M,p,b,Q,q,B){const k=this.parent.targetFps,u=1/k,T=I.Get(`${M}/sampler`,b.samplers,Q.sampler);return this._loadAnimationSamplerAsync(`${p}/samplers/${Q.sampler}`,T).then((M=>{let p=0;const T=q.object,O=q.info;for(const q of O){const O=q.getStride(T),H=M.input,F=M.output,o=new Array(H.length);let W=0;switch(M.interpolation){case"STEP":for(let M=0;M<H.length;M++){const p=q.getValue(T,F,W,1);W+=O,o[M]={frame:H[M]*k,value:p,interpolation:1}}break;case"CUBICSPLINE":for(let M=0;M<H.length;M++){const p=q.getValue(T,F,W,u);W+=O;const b=q.getValue(T,F,W,1);W+=O;const Q=q.getValue(T,F,W,u);W+=O,o[M]={frame:H[M]*k,inTangent:p,value:b,outTangent:Q}}break;case"LINEAR":for(let M=0;M<H.length;M++){const p=q.getValue(T,F,W,1);W+=O,o[M]={frame:H[M]*k,value:p}}}if(W>0){const M=`${b.name||`animation${b.index}`}_channel${Q.index}_${p}`,u=q.buildAnimations(T,M,k,o);for(const b of u)p++,B(b.babylonAnimatable,b.babylonAnimation)}}}))}_loadAnimationSamplerAsync(M,p){if(p._data)return p._data;const b=p.interpolation||"LINEAR";switch(b){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${M}/interpolation: Invalid value (${p.interpolation})`)}const Q=I.Get(`${M}/input`,this._gltf.accessors,p.input),q=I.Get(`${M}/output`,this._gltf.accessors,p.output);return p._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q),this._loadFloatAccessorAsync(`/accessors/${q.index}`,q)]).then((M=>{let[p,Q]=M;return{input:p,interpolation:b,output:Q}})),p._data}loadBufferAsync(M,p,b,Q){const q=this._extensionsLoadBufferAsync(M,p,b,Q);if(q)return q;if(!p._data)if(p.uri)p._data=this.loadUriAsync(`${M}/uri`,p,p.uri);else{if(!this._bin)throw new Error(`${M}: Uri is missing or the binary glTF is missing its binary chunk`);p._data=this._bin.readAsync(0,p.byteLength)}return p._data.then((p=>{try{return new Uint8Array(p.buffer,p.byteOffset+b,Q)}catch(q){throw new Error(`${M}: ${q.message}`)}}))}loadBufferViewAsync(M,p){const b=this._extensionsLoadBufferViewAsync(M,p);if(b)return b;if(p._data)return p._data;const Q=I.Get(`${M}/buffer`,this._gltf.buffers,p.buffer);return p._data=this.loadBufferAsync(`/buffers/${Q.index}`,Q,p.byteOffset||0,p.byteLength),p._data}_loadAccessorAsync(M,p,b){if(p._data)return p._data;const Q=J._GetNumComponents(M,p.type),q=Q*f.f.GetTypeByteLength(p.componentType),B=Q*p.count;if(void 0==p.bufferView)p._data=Promise.resolve(new b(B));else{const k=I.Get(`${M}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${k.index}`,k).then((u=>{if(5126!==p.componentType||p.normalized||k.byteStride&&k.byteStride!==q){const M=new b(B);return f.f.ForEach(u,p.byteOffset||0,k.byteStride||q,Q,p.componentType,M.length,p.normalized||!1,((p,b)=>{M[b]=p})),M}return J._GetTypedArray(M,p.componentType,u,p.byteOffset,B)}))}if(p.sparse){const B=p.sparse;p._data=p._data.then((k=>{const u=k,T=I.Get(`${M}/sparse/indices/bufferView`,this._gltf.bufferViews,B.indices.bufferView),O=I.Get(`${M}/sparse/values/bufferView`,this._gltf.bufferViews,B.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${T.index}`,T),this.loadBufferViewAsync(`/bufferViews/${O.index}`,O)]).then((k=>{let[T,O]=k;const H=J._GetTypedArray(`${M}/sparse/indices`,B.indices.componentType,T,B.indices.byteOffset,B.count),F=Q*B.count;let o;if(5126!==p.componentType||p.normalized){const k=J._GetTypedArray(`${M}/sparse/values`,p.componentType,O,B.values.byteOffset,F);o=new b(F),f.f.ForEach(k,0,q,Q,p.componentType,o.length,p.normalized||!1,((M,p)=>{o[p]=M}))}else o=J._GetTypedArray(`${M}/sparse/values`,p.componentType,O,B.values.byteOffset,F);let W=0;for(let M=0;M<H.length;M++){let p=H[M]*Q;for(let M=0;M<Q;M++)u[p++]=o[W++]}return u}))}))}return p._data}_loadFloatAccessorAsync(M,p){return this._loadAccessorAsync(M,p,Float32Array)}_loadIndicesAccessorAsync(M,p){if("SCALAR"!==p.type)throw new Error(`${M}/type: Invalid value ${p.type}`);if(5121!==p.componentType&&5123!==p.componentType&&5125!==p.componentType)throw new Error(`${M}/componentType: Invalid value ${p.componentType}`);if(p._data)return p._data;if(p.sparse){const b=J._GetTypedArrayConstructor(`${M}/componentType`,p.componentType);p._data=this._loadAccessorAsync(M,p,b)}else{const b=I.Get(`${M}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>J._GetTypedArray(M,p.componentType,b,p.byteOffset,p.count)))}return p._data}_loadVertexBufferViewAsync(M){if(M._babylonBuffer)return M._babylonBuffer;const p=this._babylonScene.getEngine();return M._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M).then((M=>new f.d(p,M,!1))),M._babylonBuffer}_loadVertexAccessorAsync(M,p,b){var Q;if(null!==(Q=p._babylonVertexBuffer)&&void 0!==Q&&Q[b])return p._babylonVertexBuffer[b];p._babylonVertexBuffer||(p._babylonVertexBuffer={});const q=this._babylonScene.getEngine();if(p.sparse||void 0==p.bufferView)p._babylonVertexBuffer[b]=this._loadFloatAccessorAsync(M,p).then((M=>new f.f(q,M,b,!1)));else{const Q=I.Get(`${M}/bufferView`,this._gltf.bufferViews,p.bufferView);p._babylonVertexBuffer[b]=this._loadVertexBufferViewAsync(Q).then((B=>{const k=J._GetNumComponents(M,p.type);return new f.f(q,B,b,!1,void 0,Q.byteStride,void 0,p.byteOffset,k,p.componentType,p.normalized,!0,void 0,!0)}))}return p._babylonVertexBuffer[b]}_loadMaterialMetallicRoughnessPropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;return p&&(p.baseColorFactor?(b.albedoColor=B.ap.sp(p.baseColorFactor),b.alpha=p.baseColorFactor[3]):b.albedoColor=B.ap.White(),b.metallic=void 0==p.metallicFactor?1:p.metallicFactor,b.roughness=void 0==p.roughnessFactor?1:p.roughnessFactor,p.baseColorTexture&&Q.push(this.loadTextureInfoAsync(`${M}/baseColorTexture`,p.baseColorTexture,(M=>{M.name=`${b.name} (Base Color)`,b.albedoTexture=M}))),p.metallicRoughnessTexture&&(p.metallicRoughnessTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${M}/metallicRoughnessTexture`,p.metallicRoughnessTexture,(M=>{M.name=`${b.name} (Metallic Roughness)`,b.metallicTexture=M}))),b.useMetallnessFromMetallicTextureBlue=!0,b.useRoughnessFromMetallicTextureGreen=!0,b.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(Q).then((()=>{}))}_loadMaterialAsync(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const B=this._extensionsLoadMaterialAsync(M,p,b,Q,q);if(B)return B;p._data=p._data||{};let k=p._data[Q];if(!k){this.logOpen(`${M} ${p.name||""}`);const b=this.createMaterial(M,p,Q);k={babylonMaterial:b,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(M,p,b)},p._data[Q]=k,J.AddPointerMetadata(b,M),this._parent.onMaterialLoadedObservable.notifyObservers(b),this.logClose()}return b&&(k.babylonMeshes.push(b),b.bb.addOnce((()=>{const M=k.babylonMeshes.indexOf(b);-1!==M&&k.babylonMeshes.splice(M,1)}))),q(k.babylonMaterial),k.promise.then((()=>k.babylonMaterial))}_createDefaultMaterial(M,p){this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new a.d(M,this._babylonScene);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.fillMode=p,b.enableSpecularAntiAliasing=!0,b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,b.transparencyMode=a.d.PBRMATERIAL_OPAQUE,b.metallic=1,b.roughness=1,b}createMaterial(M,p,b){const Q=this._extensionsCreateMaterial(M,p,b);if(Q)return Q;const q=p.name||`material${p.index}`;return this._createDefaultMaterial(q,b)}loadMaterialPropertiesAsync(M,p,b){const Q=this._extensionsLoadMaterialPropertiesAsync(M,p,b);if(Q)return Q;const q=new Array;return q.push(this.loadMaterialBasePropertiesAsync(M,p,b)),p.pbrMetallicRoughness&&q.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${M}/pbrMetallicRoughness`,p.pbrMetallicRoughness,b)),this.loadMaterialAlphaProperties(M,p,b),Promise.all(q).then((()=>{}))}loadMaterialBasePropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;return b.emissiveColor=p.emissiveFactor?B.ap.sp(p.emissiveFactor):new B.ap(0,0,0),p.doubleSided&&(b.Kb=!1,b.twoSidedLighting=!0),p.normalTexture&&(p.normalTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${M}/normalTexture`,p.normalTexture,(M=>{M.name=`${b.name} (Normal)`,b.bumpTexture=M}))),b.invertNormalMapX=!this._babylonScene.useRightHandedSystem,b.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=p.normalTexture.scale&&b.bumpTexture&&(b.bumpTexture.level=p.normalTexture.scale),b.forceIrradianceInFragment=!0),p.occlusionTexture&&(p.occlusionTexture.nonColorData=!0,Q.push(this.loadTextureInfoAsync(`${M}/occlusionTexture`,p.occlusionTexture,(M=>{M.name=`${b.name} (Occlusion)`,b.ambientTexture=M}))),b.useAmbientInGrayScale=!0,void 0!=p.occlusionTexture.strength&&(b.ambientTextureStrength=p.occlusionTexture.strength)),p.emissiveTexture&&Q.push(this.loadTextureInfoAsync(`${M}/emissiveTexture`,p.emissiveTexture,(M=>{M.name=`${b.name} (Emissive)`,b.emissiveTexture=M}))),Promise.all(Q).then((()=>{}))}loadMaterialAlphaProperties(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);switch(p.alphaMode||"OPAQUE"){case"OPAQUE":b.transparencyMode=a.d.PBRMATERIAL_OPAQUE,b.alpha=1;break;case"MASK":b.transparencyMode=a.d.PBRMATERIAL_ALPHATEST,b.alphaCutOff=void 0==p.alphaCutoff?.5:p.alphaCutoff,b.albedoTexture&&(b.albedoTexture.Hb=!0);break;case"BLEND":b.transparencyMode=a.d.PBRMATERIAL_ALPHABLEND,b.albedoTexture&&(b.albedoTexture.Hb=!0,b.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${M}/alphaMode: Invalid value (${p.alphaMode})`)}}loadTextureInfoAsync(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadTextureInfoAsync(M,p,b);if(Q)return Q;if(this.logOpen(`${M}`),p.texCoord>=6)throw new Error(`${M}/texCoord: Invalid value (${p.texCoord})`);const q=I.Get(`${M}/index`,this._gltf.textures,p.index);q._textureInfo=p;const B=this._loadTextureAsync(`/textures/${p.index}`,q,(Q=>{Q.coordinatesIndex=p.texCoord||0,J.AddPointerMetadata(Q,M),this._parent.onTextureLoadedObservable.notifyObservers(Q),b(Q)}));return this.logClose(),B}_loadTextureAsync(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Q=this._extensionsLoadTextureAsync(M,p,b);if(Q)return Q;this.logOpen(`${M} ${p.name||""}`);const q=void 0==p.sampler?J.DefaultSampler:I.Get(`${M}/sampler`,this._gltf.samplers,p.sampler),B=I.Get(`${M}/source`,this._gltf.images,p.source),k=this._createTextureAsync(M,q,B,b,void 0,!p._textureInfo.nonColorData);return this.logClose(),k}_createTextureAsync(M,p,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},B=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0;const u=this._loadSampler(`/samplers/${p.index}`,p),T=new Array,O=new Q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H={noMipmap:u.noMipMaps,invertY:!1,samplingMode:u.samplingMode,C:()=>{this._disposed||O.resolve()},onError:(p,b)=>{this._disposed||O.reject(new Error(`${M}: ${b&&b.message?b.message:p||"Failed to load texture"}`))},mimeType:b.mimeType??(0,w.g)(b.uri??""),loaderOptions:B,useSRGBBuffer:!!k&&this._parent.useSRGBBuffers},F=new s.b(null,this._babylonScene,H);return F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.push(O.promise),T.push(this.loadImageAsync(`/images/${b.index}`,b).then((M=>{const p=b.uri||`${this._fileName}#image${b.index}`,Q=`data:${this._uniqueRootUrl}${p}`;F.updateURL(Q,M);const q=F.getInternalTexture();q&&(q.label=b.name)}))),F.wrapU=u.wrapU,F.wrapV=u.wrapV,q(F),this._parent.useGltfTextureNames&&(F.name=b.name||b.uri||`image${b.index}`),Promise.all(T).then((()=>F))}_loadSampler(M,p){return p._data||(p._data={noMipMaps:9728===p.minFilter||9729===p.minFilter,samplingMode:J._GetTextureSamplingMode(M,p),wrapU:J._GetTextureWrapMode(`${M}/wrapS`,p.wrapS),wrapV:J._GetTextureWrapMode(`${M}/wrapT`,p.wrapT)}),p._data}loadImageAsync(M,p){if(!p._data){if(this.logOpen(`${M} ${p.name||""}`),p.uri)p._data=this.loadUriAsync(`${M}/uri`,p,p.uri);else{const b=I.Get(`${M}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}this.logClose()}return p._data}loadUriAsync(M,p,b){const Q=this._extensionsLoadUriAsync(M,p,b);if(Q)return Q;if(!J._ValidateUri(b))throw new Error(`${M}: '${b}' is invalid`);if((0,w.h)(b)){const p=new Uint8Array((0,w.c)(b));return this.log(`${M}: Decoded ${b.substring(0,64)}... (${p.length} bytes)`),Promise.resolve(p)}return this.log(`${M}: Loading ${b}`),this._parent.preprocessUrlAsync(this._rootUrl+b).then((p=>new Promise(((Q,q)=>{this._parent._loadFile(this._babylonScene,p,(p=>{this._disposed||(this.log(`${M}: Loaded ${b} (${p.byteLength} bytes)`),Q(new Uint8Array(p)))}),!0,(p=>{q(new w.k(`${M}: Failed to load '${b}'${p?": "+p.status+" "+p.statusText:""}`,p))}))}))))}static AddPointerMetadata(M,p){M.metadata=M.metadata||{};const b=M._internalMetadata=M._internalMetadata||{},Q=b.Bb=b.Bb||{};(Q.pointers=Q.pointers||[]).push(p)}static _GetTextureWrapMode(M,p){switch(p=void 0==p?10497:p){case 33071:return s.b.CLAMP_ADDRESSMODE;case 33648:return s.b.MIRROR_ADDRESSMODE;case 10497:return s.b.WRAP_ADDRESSMODE;default:return A.c.Warn(`${M}: Invalid value (${p})`),s.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(M,p){const b=void 0==p.magFilter?9729:p.magFilter,Q=void 0==p.minFilter?9987:p.minFilter;if(9729===b)switch(Q){case 9728:return s.b.LINEAR_NEAREST;case 9729:return s.b.LINEAR_LINEAR;case 9984:return s.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return s.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return s.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return s.b.LINEAR_LINEAR_MIPLINEAR;default:return A.c.Warn(`${M}/minFilter: Invalid value (${Q})`),s.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==b&&A.c.Warn(`${M}/magFilter: Invalid value (${b})`),Q){case 9728:return s.b.NEAREST_NEAREST;case 9729:return s.b.NEAREST_LINEAR;case 9984:return s.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return s.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return s.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return s.b.NEAREST_LINEAR_MIPLINEAR;default:return A.c.Warn(`${M}/minFilter: Invalid value (${Q})`),s.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(M,p){try{return(0,h.k)(p)}catch(b){throw new Error(`${M}: ${b.message}`)}}static _GetTypedArray(M,p,b,Q,q){const B=b.buffer;Q=b.byteOffset+(Q||0);const k=J._GetTypedArrayConstructor(`${M}/componentType`,p),u=f.f.GetTypeByteLength(p);return Q%u!==0?(A.c.Warn(`${M}: Copying buffer as byte offset (${Q}) is not a multiple of component type byte length (${u})`),new k(B.slice(Q,Q+q*u),0)):new k(B,Q,q)}static _GetNumComponents(M,p){switch(p){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${M}: Invalid type (${p})`)}static _ValidateUri(M){return k.Tools.IsBase64(M)||-1===M.indexOf("..")}static _GetDrawMode(M,p){switch(void 0==p&&(p=4),p){case 0:return D.e.PointListDrawMode;case 1:return D.e.LineListDrawMode;case 2:return D.e.LineLoopDrawMode;case 3:return D.e.LineStripDrawMode;case 4:return D.e.TriangleFillMode;case 5:return D.e.TriangleStripDrawMode;case 6:return D.e.TriangleFanDrawMode}throw new Error(`${M}: Invalid mesh primitive mode (${p})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const M=new Array;if(this._gltf.materials)for(const p of this._gltf.materials)if(p._data)for(const b in p._data){const Q=p._data[b];for(const p of Q.babylonMeshes){p.ib(!0);const b=Q.babylonMaterial;M.push(b.forceCompilationAsync(p)),M.push(b.forceCompilationAsync(p,{useInstances:!0})),this._parent.useClipPlane&&(M.push(b.forceCompilationAsync(p,{clipPlane:!0})),M.push(b.forceCompilationAsync(p,{clipPlane:!0,useInstances:!0})))}}return Promise.all(M).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const M=new Array,p=this._babylonScene.lights;for(const b of p){const p=b.getShadowGenerator();p&&M.push(p.forceCompilationAsync())}return Promise.all(M).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(M){for(const p of this._extensions)p.enabled&&M(p)}_applyExtensions(M,p,b){for(const Q of this._extensions)if(Q.enabled){const q=`${Q.name}.${p}`,B=M;B._activeLoaderExtensionFunctions=B._activeLoaderExtensionFunctions||{};const k=B._activeLoaderExtensionFunctions;if(!k[q]){k[q]=!0;try{const M=b(Q);if(M)return M}finally{delete k[q]}}}return null}_extensionsOnLoading(){this._forEachExtensions((M=>M.onLoading&&M.onLoading()))}_extensionsOnReady(){this._forEachExtensions((M=>M.onReady&&M.onReady()))}_extensionsLoadSceneAsync(M,p){return this._applyExtensions(p,"loadScene",(b=>b.loadSceneAsync&&b.loadSceneAsync(M,p)))}_extensionsLoadNodeAsync(M,p,b){return this._applyExtensions(p,"loadNode",(Q=>Q.loadNodeAsync&&Q.loadNodeAsync(M,p,b)))}_extensionsLoadCameraAsync(M,p,b){return this._applyExtensions(p,"loadCamera",(Q=>Q.loadCameraAsync&&Q.loadCameraAsync(M,p,b)))}_extensionsLoadVertexDataAsync(M,p,b){return this._applyExtensions(p,"loadVertexData",(Q=>Q._loadVertexDataAsync&&Q._loadVertexDataAsync(M,p,b)))}_extensionsLoadMeshPrimitiveAsync(M,p,b,Q,q,B){return this._applyExtensions(q,"loadMeshPrimitive",(k=>k._loadMeshPrimitiveAsync&&k._loadMeshPrimitiveAsync(M,p,b,Q,q,B)))}_extensionsLoadMaterialAsync(M,p,b,Q,q){return this._applyExtensions(p,"loadMaterial",(B=>B._loadMaterialAsync&&B._loadMaterialAsync(M,p,b,Q,q)))}_extensionsCreateMaterial(M,p,b){return this._applyExtensions(p,"createMaterial",(Q=>Q.createMaterial&&Q.createMaterial(M,p,b)))}_extensionsLoadMaterialPropertiesAsync(M,p,b){return this._applyExtensions(p,"loadMaterialProperties",(Q=>Q.loadMaterialPropertiesAsync&&Q.loadMaterialPropertiesAsync(M,p,b)))}_extensionsLoadTextureInfoAsync(M,p,b){return this._applyExtensions(p,"loadTextureInfo",(Q=>Q.loadTextureInfoAsync&&Q.loadTextureInfoAsync(M,p,b)))}_extensionsLoadTextureAsync(M,p,b){return this._applyExtensions(p,"loadTexture",(Q=>Q._loadTextureAsync&&Q._loadTextureAsync(M,p,b)))}_extensionsLoadAnimationAsync(M,p){return this._applyExtensions(p,"loadAnimation",(b=>b.loadAnimationAsync&&b.loadAnimationAsync(M,p)))}_extensionsLoadAnimationChannelAsync(M,p,b,Q,q){return this._applyExtensions(b,"loadAnimationChannel",(B=>B._loadAnimationChannelAsync&&B._loadAnimationChannelAsync(M,p,b,Q,q)))}_extensionsLoadSkinAsync(M,p,b){return this._applyExtensions(b,"loadSkin",(Q=>Q._loadSkinAsync&&Q._loadSkinAsync(M,p,b)))}_extensionsLoadUriAsync(M,p,b){return this._applyExtensions(p,"loadUri",(Q=>Q._loadUriAsync&&Q._loadUriAsync(M,p,b)))}_extensionsLoadBufferViewAsync(M,p){return this._applyExtensions(p,"loadBufferView",(b=>b.loadBufferViewAsync&&b.loadBufferViewAsync(M,p)))}_extensionsLoadBufferAsync(M,p,b,Q){return this._applyExtensions(p,"loadBuffer",(q=>q.loadBufferAsync&&q.loadBufferAsync(M,p,b,Q)))}static LoadExtensionAsync(M,p,b,Q){if(!p.extensions)return null;const q=p.extensions[b];return q?Q(`${M}/extensions/${b}`,q):null}static LoadExtraAsync(M,p,b,Q){if(!p.extras)return null;const q=p.extras[b];return q?Q(`${M}/extras/${b}`,q):null}isExtensionUsed(M){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(M)}logOpen(M){this._parent._logOpen(M)}logClose(){this._parent._logClose()}log(M){this._parent._log(M)}startPerformanceCounter(M){this._parent._startPerformanceCounter(M)}endPerformanceCounter(M){this._parent._endPerformanceCounter(M)}}J.DefaultSampler={index:-1},Y.c._CreateGLTF2Loader=M=>new J(M);var v=b(13412),z=b(11976),t=b(11823),e=b(13419),G=b(13428);class mM extends G.b{constructor(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",M),this._texture=M.getEngine().createRawCubeTexture(p,b,Q,q,B,k,u,T)}update(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,M,p,b,Q,q)}updateRGBDAsync(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,e.i)(this._texture,M,p,b,Q).then((()=>{}))}clone(){return t.b.Clone((()=>{const M=this.RM(),p=this._texture,b=new mM(M,p._bufferViewArray,p.width,p.format,p.type,p.generateMipMaps,p.invertY,p.samplingMode,p._compression);return 13===p.source&&b.updateRGBDAsync(p._bufferViewArrayArray,p._sphericalPolynomial,p._lodGenerationScale,p._lodGenerationOffset),b}),this)}}const C="EXT_lights_image_based";class X{constructor(M){this.name=C,this._loader=M,this.enabled=this._loader.isExtensionUsed(C)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.Bb.extensions;if(M&&M[this.name]){const p=M[this.name];this._lights=p.lights}}loadSceneAsync(M,p){return J.LoadExtensionAsync(M,p,this.name,(async(b,Q)=>{this._loader._allMaterialsDirtyRequired=!0;const q=new Array;q.push(this._loader.loadSceneAsync(M,p)),this._loader.logOpen(`${b}`);const B=I.Get(`${b}/light`,this._lights,Q.mb);return q.push(this._loadLightAsync(`/extensions/${this.name}/lights/${Q.mb}`,B).then((M=>{this._loader.babylonScene.environmentTexture=M}))),this._loader.logClose(),await Promise.all(q).then((()=>{}))}))}_loadLightAsync(M,p){if(!p._loaded){const b=new Array;this._loader.logOpen(`${M}`);const Q=new Array(p.specularImages.length);for(let q=0;q<p.specularImages.length;q++){const B=p.specularImages[q];Q[q]=new Array(B.length);for(let p=0;p<B.length;p++){const k=`${M}/specularImages/${q}/${p}`;this._loader.logOpen(`${k}`);const u=B[p],T=I.Get(k,this._loader.Bb.images,u);b.push(this._loader.loadImageAsync(`/images/${u}`,T).then((M=>{Q[q][p]=M}))),this._loader.logClose()}}this._loader.logClose(),p._loaded=Promise.all(b).then((async()=>{const b=new mM(this._loader.babylonScene,null,p.specularImageSize);if(b.name=p.name||"environment",p._babylonTexture=b,void 0!=p.yb&&(b.level=p.yb),p.rotation){let M=q.Quaternion.sp(p.rotation);this._loader.babylonScene.useRightHandedSystem||(M=q.Quaternion.Inverse(M)),q.Matrix.FromQuaternionToRef(M,b.getReflectionTextureMatrix())}if(!p.irradianceCoefficients)throw new Error(`${M}: Irradiance coefficients are missing`);const B=z.e.sp(p.irradianceCoefficients);B.scaleInPlace(p.yb),B.convertIrradianceToLambertianRadiance();const k=z.f.FromHarmonics(B),u=(Q.length-1)/Math.log2(p.specularImageSize);return await b.updateRGBDAsync(Q,k,u)}))}return p._loaded.then((()=>p._babylonTexture))}}c(C),U(C,!0,(M=>new X(M)));b(12367);const l="EXT_mesh_gpu_instancing";class MM{constructor(M){this.name=l,this._loader=M,this.enabled=this._loader.isExtensionUsed(l)}dispose(){this._loader=null}loadNodeAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(M,Q)=>{this._loader._disableInstancedMesh++;const B=this._loader.loadNodeAsync(`/nodes/${p.index}`,p,b);if(this._loader._disableInstancedMesh--,!p._primitiveBabylonMeshes)return await B;const k=new Array;let u=0;const T=p=>{if(void 0==Q.attributes[p])return void k.push(Promise.resolve(null));const b=I.Get(`${M}/attributes/${p}`,this._loader.Bb.accessors,Q.attributes[p]);if(k.push(this._loader._loadFloatAccessorAsync(`/accessors/${b.bufferView}`,b)),0===u)u=b.count;else if(u!==b.count)throw new Error(`${M}/attributes: Instance buffer accessors do not have the same count.`)};return T("TRANSLATION"),T("ROTATION"),T("SCALE"),await B.then((async M=>{const[b,Q,B]=await Promise.all(k),T=new Float32Array(16*u);q.TmpVectors.Ap[0].Db(0,0,0),q.TmpVectors.Quaternion[0].Db(0,0,0,1),q.TmpVectors.Ap[1].Db(1,1,1);for(let p=0;p<u;++p)b&&q.Ap.FromArrayToRef(b,3*p,q.TmpVectors.Ap[0]),Q&&q.Quaternion.FromArrayToRef(Q,4*p,q.TmpVectors.Quaternion[0]),B&&q.Ap.FromArrayToRef(B,3*p,q.TmpVectors.Ap[1]),q.Matrix.ComposeToRef(q.TmpVectors.Ap[1],q.TmpVectors.Quaternion[0],q.TmpVectors.Ap[0],q.TmpVectors.Matrix[0]),q.TmpVectors.Matrix[0].copyToArray(T,16*p);for(const q of p._primitiveBabylonMeshes)q.yF("matrix",T,16,!0);return M}))}))}}c(l),U(l,!0,(M=>new MM(M)));let pM=0,bM=null;class QM{static get Default(){return QM._Default||(QM._Default=new QM),QM._Default}constructor(){const M=QM.Configuration.decoder;this._decoderModulePromise=k.Tools.LoadBabylonScriptAsync(M.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(M,p,b,Q,q){await this._decoderModulePromise,0===pM&&(MeshoptDecoder.useWorkers(1),pM=1);const B=await MeshoptDecoder.decodeGltfBufferAsync(p,b,M,Q,q);return null!==bM&&clearTimeout(bM),bM=setTimeout((()=>{MeshoptDecoder.useWorkers(0),pM=0,bM=null}),1e3),B}}QM.Configuration={decoder:{url:`${k.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},QM._Default=null;const qM="EXT_meshopt_compression";class BM{constructor(M){this.name=qM,this.enabled=M.isExtensionUsed(qM),this._loader=M}dispose(){this._loader=null}loadBufferViewAsync(M,p){return J.LoadExtensionAsync(M,p,this.name,(async(b,Q)=>{const q=p;if(q._meshOptData)return await q._meshOptData;const B=I.Get(`${M}/buffer`,this._loader.Bb.buffers,Q.buffer);return q._meshOptData=this._loader.loadBufferAsync(`/buffers/${B.index}`,B,Q.byteOffset||0,Q.byteLength).then((async M=>await QM.Default.decodeGltfBufferAsync(M,Q.count,Q.byteStride,Q.mode,Q.filter))),await q._meshOptData}))}}c(qM),U(qM,!0,(M=>new BM(M)));const kM="EXT_texture_webp";class uM{constructor(M){this.name=kM,this._loader=M,this.enabled=M.isExtensionUsed(kM)}dispose(){this._loader=null}_loadTextureAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=void 0==p.sampler?J.DefaultSampler:I.Get(`${M}/sampler`,this._loader.Bb.samplers,p.sampler),k=I.Get(`${Q}/source`,this._loader.Bb.images,q.source);return await this._loader._createTextureAsync(M,B,k,(M=>{b(M)}),void 0,!p._textureInfo.nonColorData)}))}}c(kM),U(kM,!0,(M=>new uM(M)));const TM="EXT_texture_avif";class OM{constructor(M){this.name=TM,this._loader=M,this.enabled=M.isExtensionUsed(TM)}dispose(){this._loader=null}_loadTextureAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=void 0==p.sampler?J.DefaultSampler:I.Get(`${M}/sampler`,this._loader.Bb.samplers,p.sampler),k=I.Get(`${Q}/source`,this._loader.Bb.images,q.source);return await this._loader._createTextureAsync(M,B,k,(M=>{b(M)}),void 0,!p._textureInfo.nonColorData)}))}}c(TM),U(TM,!0,(M=>new OM(M)));var HM=b(13409),FM=b(12349);const oM="EXT_lights_ies";class WM{constructor(M){this.name=oM,this._loader=M,this.enabled=this._loader.isExtensionUsed(oM)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.Bb.extensions;if(M&&M[this.name]){const p=M[this.name];this._lights=p.lights,I.Assign(this._lights)}}loadNodeAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,k)=>{let u,T;this._loader._allMaterialsDirtyRequired=!0;const O=await this._loader.loadNodeAsync(M,p,(M=>{T=I.Get(Q,this._lights,k.mb);const p=T.name||M.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,u=new HM.b(p,q.Ap.Zero(),q.Ap.Backward(),0,1,this._loader.babylonScene),u.angle=Math.PI/2,u.innerAngle=0,u._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,T._babylonLight=u,u.falloffType=FM.e.FALLOFF_GLTF,u.Pb=k.color?B.ap.sp(k.color):B.ap.White(),u.yb=k.multiplier||1,u.range=Number.MAX_VALUE,u.parent=M,this._loader._babylonLights.push(u),J.AddPointerMetadata(u,Q),b(M)}));let H;if(T.uri)H=await this._loader.loadUriAsync(M,T,T.uri);else{const p=I.Get(`${M}/bufferView`,this._loader.Bb.bufferViews,T.bufferView);H=await this._loader.loadBufferViewAsync(`/bufferViews/${p.index}`,p)}return u.iesProfileTexture=new s.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,H,!0,void 0,void 0,void 0,void 0,".ies"),O}))}}c(oM),U(oM,!0,(M=>new WM(M)));var iM=b(13446);const AM="KHR_draco_mesh_compression";class jM{constructor(M){this.name=AM,this.useNormalizedFlagFromAccessor=!0,this._loader=M,this.enabled=iM.e.DefaultAvailable&&this._loader.isExtensionUsed(AM)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{if(void 0!=p.mode&&4!==p.mode&&5!==p.mode)throw new Error(`${M}: Unsupported mode ${p.mode}`);const B={},k={},u=(M,Q)=>{const u=q.attributes[M];if(void 0!=u&&(b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(Q)&&b._delayInfo.push(Q),B[Q]=u,this.useNormalizedFlagFromAccessor)){const b=I.TryGet(this._loader.Bb.accessors,p.attributes[M]);b&&(k[Q]=b.normalized||!1)}};u("POSITION",f.f.PositionKind),u("NORMAL",f.f.NormalKind),u("TANGENT",f.f.TangentKind),u("TEXCOORD_0",f.f.UVKind),u("TEXCOORD_1",f.f.UV2Kind),u("TEXCOORD_2",f.f.UV3Kind),u("TEXCOORD_3",f.f.UV4Kind),u("TEXCOORD_4",f.f.UV5Kind),u("TEXCOORD_5",f.f.UV6Kind),u("JOINTS_0",f.f.MatricesIndicesKind),u("WEIGHTS_0",f.f.MatricesWeightsKind),u("COLOR_0",f.f.ColorKind);const T=I.Get(Q,this._loader.Bb.bufferViews,q.bufferView);return T._dracoBabylonGeometry||(T._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${T.index}`,T).then((async Q=>{const q=this.dracoDecoder||iM.e.Default,u=I.TryGet(this._loader.Bb.accessors,p.attributes.POSITION),T=this._loader.parent.alwaysComputeBoundingBox||b.skeleton||!u?null:Z(u);return await q._decodeMeshToGeometryForGltfAsync(b.name,this._loader.babylonScene,Q,B,k,T).catch((p=>{throw new Error(`${M}: ${p.message}`)}))}))),await T._dracoBabylonGeometry}))}}c(AM),U(AM,!0,(M=>new jM(M)));var KM=b(13448),DM=b(11784),aM=b(11788),sM=b(12236),SM=b(12397),fM=b(11757);sM.d.AddNodeConstructor("Light_Type_0",((M,p)=>()=>new RM(M,q.Ap.Zero(),p)));class RM extends SM.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(M){this._shadowAngle=M,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(M){const p=this.needCube();if(this._direction=M,this.needCube()!==p&&this._shadowGenerators){const M=this._shadowGenerators.values();for(let p=M.next();!0!==p.done;p=M.next()){p.value.recreateShadowMap()}}}constructor(M,p,b){super(M,b),this._shadowAngle=Math.PI/2,this.position=p}getClassName(){return"PointLight"}getTypeID(){return FM.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(M){if(this.direction)return super.getShadowDirection(M);switch(M){case 0:return new q.Ap(1,0,0);case 1:return new q.Ap(-1,0,0);case 2:return new q.Ap(0,-1,0);case 3:return new q.Ap(0,1,0);case 4:return new q.Ap(0,0,1);case 5:return new q.Ap(0,0,-1)}return q.Ap.Zero()}_setDefaultShadowProjectionMatrix(M,p,b){const Q=this.RM().activeCamera;if(!Q)return;const B=void 0!==this.shadowMinZ?this.shadowMinZ:Q.Fb,k=void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,u=this.RM().getEngine().useReverseDepthBuffer;q.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,u?k:B,u?B:k,M,!0,this._scene.getEngine().isNDCHalfZRange,void 0,u)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(M,p){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,p):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,p),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,p),this}transferToNodeMaterialEffect(M,p){return this.computeTransformedInformation()?M.setFloat3(p,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):M.setFloat3(p,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(M,p){M["POINTLIGHT"+p]=!0}}(0,DM.c)([(0,aM.R)()],RM.prototype,"shadowAngle",null),(0,fM.g)("BABYLON.PointLight",RM);const yM="KHR_lights_punctual";class xM{constructor(M){this.name=yM,this._loader=M,this.enabled=this._loader.isExtensionUsed(yM)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.Bb.extensions;if(M&&M[this.name]){const p=M[this.name];this._lights=p.lights,I.Assign(this._lights)}}loadNodeAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,k)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(M,p,(M=>{let p;const u=I.Get(Q,this._lights,k.mb),T=u.name||M.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,u.type){case"directional":{const M=new KM.c(T,q.Ap.Backward(),this._loader.babylonScene);M.position.sb(0),p=M;break}case"point":p=new RM(T,q.Ap.Zero(),this._loader.babylonScene);break;case"spot":{const M=new HM.b(T,q.Ap.Zero(),q.Ap.Backward(),0,1,this._loader.babylonScene);M.angle=2*(u.spot&&u.spot.outerConeAngle||Math.PI/4),M.innerAngle=2*(u.spot&&u.spot.innerConeAngle||0),p=M;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${Q}: Invalid light type (${u.type})`)}p._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,u._babylonLight=p,p.falloffType=FM.e.FALLOFF_GLTF,p.Pb=u.color?B.ap.sp(u.color):B.ap.White(),p.yb=void 0==u.yb?1:u.yb,p.range=void 0==u.range?Number.MAX_VALUE:u.range,p.parent=M,this._loader._babylonLights.push(p),J.AddPointerMetadata(p,Q),b(M)})))))}}c(yM),U(yM,!0,(M=>new xM(M)));const PM="KHR_materials_pbrSpecularGlossiness";class LM{constructor(M){this.name=PM,this.order=200,this._loader=M,this.enabled=this._loader.isExtensionUsed(PM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;return B.push(this._loader.loadMaterialBasePropertiesAsync(M,p,b)),B.push(this._loadSpecularGlossinessPropertiesAsync(Q,q,b)),this._loader.loadMaterialAlphaProperties(M,p,b),await Promise.all(B).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;return b.metallic=null,b.roughness=null,p.diffuseFactor?(b.albedoColor=B.ap.sp(p.diffuseFactor),b.alpha=p.diffuseFactor[3]):b.albedoColor=B.ap.White(),b.reflectivityColor=p.specularFactor?B.ap.sp(p.specularFactor):B.ap.White(),b.microSurface=void 0==p.glossinessFactor?1:p.glossinessFactor,p.diffuseTexture&&Q.push(this._loader.loadTextureInfoAsync(`${M}/diffuseTexture`,p.diffuseTexture,(M=>{M.name=`${b.name} (Diffuse)`,b.albedoTexture=M}))),p.specularGlossinessTexture&&(Q.push(this._loader.loadTextureInfoAsync(`${M}/specularGlossinessTexture`,p.specularGlossinessTexture,(M=>{M.name=`${b.name} (Specular Glossiness)`,b.reflectivityTexture=M,b.reflectivityTexture.Hb=!0}))),b.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(Q).then((()=>{}))}}c(PM),U(PM,!0,(M=>new LM(M)));const NM="KHR_materials_unlit";class rM{constructor(M){this.name=NM,this.order=210,this._loader=M,this.enabled=this._loader.isExtensionUsed(NM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async()=>await this._loadUnlitPropertiesAsync(M,p,b)))}_loadUnlitPropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;b.unlit=!0;const q=p.pbrMetallicRoughness;return q&&(q.baseColorFactor?(b.albedoColor=B.ap.sp(q.baseColorFactor),b.alpha=q.baseColorFactor[3]):b.albedoColor=B.ap.White(),q.baseColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${M}/baseColorTexture`,q.baseColorTexture,(M=>{M.name=`${b.name} (Base Color)`,b.albedoTexture=M})))),p.doubleSided&&(b.Kb=!1,b.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(M,p,b),Promise.all(Q).then((()=>{}))}}c(NM),U(NM,!0,(M=>new rM(M)));const YM="KHR_materials_clearcoat";class wM{constructor(M){this.name=YM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(YM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadClearCoatPropertiesAsync(Q,q,b)),await Promise.all(B)}))}_loadClearCoatPropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;return b.clearCoat.isEnabled=!0,b.clearCoat.useRoughnessFromMainTexture=!1,b.clearCoat.remapF0OnInterfaceChange=!1,void 0!=p.clearcoatFactor?b.clearCoat.yb=p.clearcoatFactor:b.clearCoat.yb=0,p.clearcoatTexture&&Q.push(this._loader.loadTextureInfoAsync(`${M}/clearcoatTexture`,p.clearcoatTexture,(M=>{M.name=`${b.name} (ClearCoat)`,b.clearCoat.texture=M}))),void 0!=p.clearcoatRoughnessFactor?b.clearCoat.roughness=p.clearcoatRoughnessFactor:b.clearCoat.roughness=0,p.clearcoatRoughnessTexture&&(p.clearcoatRoughnessTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${M}/clearcoatRoughnessTexture`,p.clearcoatRoughnessTexture,(M=>{M.name=`${b.name} (ClearCoat Roughness)`,b.clearCoat.textureRoughness=M})))),p.clearcoatNormalTexture&&(p.clearcoatNormalTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${M}/clearcoatNormalTexture`,p.clearcoatNormalTexture,(M=>{M.name=`${b.name} (ClearCoat Normal)`,b.clearCoat.bumpTexture=M}))),b.invertNormalMapX=!b.RM().useRightHandedSystem,b.invertNormalMapY=b.RM().useRightHandedSystem,void 0!=p.clearcoatNormalTexture.scale&&(b.clearCoat.bumpTexture.level=p.clearcoatNormalTexture.scale)),Promise.all(Q).then((()=>{}))}}c(YM),U(YM,!0,(M=>new wM(M)));const EM="KHR_materials_iridescence";class nM{constructor(M){this.name=EM,this.order=195,this._loader=M,this.enabled=this._loader.isExtensionUsed(EM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadIridescencePropertiesAsync(Q,q,b)),await Promise.all(B).then((()=>{}))}))}_loadIridescencePropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;return b.iridescence.isEnabled=!0,b.iridescence.yb=p.iridescenceFactor??0,b.iridescence.indexOfRefraction=p.iridescenceIor??p.iridescenceIOR??1.3,b.iridescence.minimumThickness=p.iridescenceThicknessMinimum??100,b.iridescence.maximumThickness=p.iridescenceThicknessMaximum??400,p.iridescenceTexture&&Q.push(this._loader.loadTextureInfoAsync(`${M}/iridescenceTexture`,p.iridescenceTexture,(M=>{M.name=`${b.name} (Iridescence)`,b.iridescence.texture=M}))),p.iridescenceThicknessTexture&&Q.push(this._loader.loadTextureInfoAsync(`${M}/iridescenceThicknessTexture`,p.iridescenceThicknessTexture,(M=>{M.name=`${b.name} (Iridescence Thickness)`,b.iridescence.thicknessTexture=M}))),Promise.all(Q).then((()=>{}))}}c(EM),U(EM,!0,(M=>new nM(M)));const gM="KHR_materials_anisotropy";class UM{constructor(M){this.name=gM,this.order=195,this._loader=M,this.enabled=this._loader.isExtensionUsed(gM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadIridescencePropertiesAsync(Q,q,b)),await Promise.all(B)}))}async _loadIridescencePropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;b.anisotropy.isEnabled=!0,b.anisotropy.yb=p.anisotropyStrength??0,b.anisotropy.angle=p.anisotropyRotation??0,p.anisotropyTexture&&(p.anisotropyTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${M}/anisotropyTexture`,p.anisotropyTexture,(M=>{M.name=`${b.name} (Anisotropy Intensity)`,b.anisotropy.texture=M})))),await Promise.all(Q)}}c(gM),U(gM,!0,(M=>new UM(M)));const cM="KHR_materials_emissive_strength";class dM{constructor(M){this.name=cM,this.order=170,this._loader=M,this.enabled=this._loader.isExtensionUsed(cM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>await this._loader.loadMaterialPropertiesAsync(M,p,b).then((()=>{this._loadEmissiveProperties(Q,q,b)}))))}_loadEmissiveProperties(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);void 0!==p.emissiveStrength&&(b.emissiveIntensity=p.emissiveStrength)}}c(cM),U(cM,!0,(M=>new dM(M)));const VM="KHR_materials_sheen";class hM{constructor(M){this.name=VM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(VM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadSheenPropertiesAsync(Q,q,b)),await Promise.all(B).then((()=>{}))}))}_loadSheenPropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;return b.sheen.isEnabled=!0,b.sheen.yb=1,void 0!=p.sheenColorFactor?b.sheen.color=B.ap.sp(p.sheenColorFactor):b.sheen.color=B.ap.Black(),p.sheenColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${M}/sheenColorTexture`,p.sheenColorTexture,(M=>{M.name=`${b.name} (Sheen Color)`,b.sheen.texture=M}))),void 0!==p.sheenRoughnessFactor?b.sheen.roughness=p.sheenRoughnessFactor:b.sheen.roughness=0,p.sheenRoughnessTexture&&(p.sheenRoughnessTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${M}/sheenRoughnessTexture`,p.sheenRoughnessTexture,(M=>{M.name=`${b.name} (Sheen Roughness)`,b.sheen.textureRoughness=M})))),b.sheen.albedoScaling=!0,b.sheen.useRoughnessFromMainTexture=!1,Promise.all(Q).then((()=>{}))}}c(VM),U(VM,!0,(M=>new hM(M)));var IM=b(12290);const ZM="KHR_materials_specular";class JM{constructor(M){this.name=ZM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(ZM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;if(B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadSpecularPropertiesAsync(Q,q,b)),q.extensions&&q.extensions.EXT_materials_specular_edge_color&&b instanceof a.d){q.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(b.brdf.dielectricSpecularModel=IM.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,b.brdf.conductorSpecularModel=IM.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(B).then((()=>{}))}))}_loadSpecularPropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;return void 0!==p.specularFactor&&(b.metallicF0Factor=p.specularFactor),void 0!==p.specularColorFactor&&(b.metallicReflectanceColor=B.ap.sp(p.specularColorFactor)),p.specularTexture&&(p.specularTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${M}/specularTexture`,p.specularTexture,(M=>{M.name=`${b.name} (Specular)`,b.metallicReflectanceTexture=M,b.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),p.specularColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${M}/specularColorTexture`,p.specularColorTexture,(M=>{M.name=`${b.name} (Specular Color)`,b.reflectanceTexture=M}))),Promise.all(Q).then((()=>{}))}}c(ZM),U(ZM,!0,(M=>new JM(M)));const vM="KHR_materials_ior";class zM{constructor(M){this.name=vM,this.order=180,this._loader=M,this.enabled=this._loader.isExtensionUsed(vM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadIorPropertiesAsync(Q,q,b)),await Promise.all(B).then((()=>{}))}))}_loadIorPropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);return void 0!==p.ior?b.indexOfRefraction=p.ior:b.indexOfRefraction=zM._DEFAULT_IOR,Promise.resolve()}}zM._DEFAULT_IOR=1.5,c(vM),U(vM,!0,(M=>new zM(M)));const tM="KHR_materials_variants";class eM{constructor(M){this.name=tM,this._loader=M,this.enabled=this._loader.isExtensionUsed(tM)}dispose(){this._loader=null}static GetAvailableVariants(M){const p=this._GetExtensionMetadata(M);return p?Object.keys(p.variants):[]}getAvailableVariants(M){return eM.GetAvailableVariants(M)}static SelectVariant(M,p){const b=this._GetExtensionMetadata(M);if(!b)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${tM} extension`);const Q=M=>{const p=b.variants[M];if(p)for(const b of p)b.mesh.material=b.material};if(p instanceof Array)for(const q of p)Q(q);else Q(p);b.lastSelected=p}selectVariant(M,p){eM.SelectVariant(M,p)}static Reset(M){const p=this._GetExtensionMetadata(M);if(!p)throw new Error(`Cannot reset on a glTF mesh that does not have the ${tM} extension`);for(const b of p.original)b.mesh.material=b.material;p.lastSelected=null}reset(M){eM.Reset(M)}static GetLastSelectedVariant(M){const p=this._GetExtensionMetadata(M);if(!p)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${tM} extension`);return p.lastSelected}getLastSelectedVariant(M){return eM.GetLastSelectedVariant(M)}static _GetExtensionMetadata(M){var p,b;return(null===M||void 0===M||null===(p=M._internalMetadata)||void 0===p||null===(b=p.Bb)||void 0===b?void 0:b[tM])||null}onLoading(){const M=this._loader.Bb.extensions;if(M&&M[this.name]){const p=M[this.name];this._variants=p.variants}}onReady(){const M=this._loader.rootBabylonMesh;if(M){var p;const b=this._loader.parent.extensionOptions[tM];null!==b&&void 0!==b&&b.defaultVariant&&eM.SelectVariant(M,b.defaultVariant),null===b||void 0===b||null===(p=b.onLoaded)||void 0===p||p.call(b,{get variants(){return eM.GetAvailableVariants(M)},get selectedVariant(){const p=eM.GetLastSelectedVariant(M);return p?Array.isArray(p)?p[0]:p:eM.GetAvailableVariants(M)[0]},set selectedVariant(p){eM.SelectVariant(M,p)}})}}_loadMeshPrimitiveAsync(M,p,b,Q,q,B){return J.LoadExtensionAsync(M,q,this.name,(async(k,u)=>{const T=new Array;return T.push(this._loader._loadMeshPrimitiveAsync(M,p,b,Q,q,(p=>{if(B(p),p instanceof x.d){const b=J._GetDrawMode(M,q.mode),Q=this._loader.rootBabylonMesh,B=Q?Q._internalMetadata=Q._internalMetadata||{}:{},O=B.Bb=B.Bb||{},H=O[tM]=O[tM]||{lastSelected:null,original:[],variants:{}};H.original.push({mesh:p,material:p.material});for(let M=0;M<u.mappings.length;++M){const q=u.mappings[M],B=I.Get(`${k}/mappings/${M}/material`,this._loader.Bb.materials,q.material);T.push(this._loader._loadMaterialAsync(`#/materials/${q.material}`,B,p,b,(M=>{for(let b=0;b<q.variants.length;++b){const B=q.variants[b],k=I.Get(`/extensions/${tM}/variants/${B}`,this._variants,B);H.variants[k.name]=H.variants[k.name]||[],H.variants[k.name].push({mesh:p,material:M}),p.onClonedObservable.add((M=>{const b=M;let q=null,B=b;do{if(B=B.parent,!B)return;q=eM._GetExtensionMetadata(B)}while(null===q);if(Q&&q===eM._GetExtensionMetadata(Q)){B._internalMetadata={};for(const M in Q._internalMetadata)B._internalMetadata[M]=Q._internalMetadata[M];B._internalMetadata.Bb=[];for(const M in Q._internalMetadata.Bb)B._internalMetadata.Bb[M]=Q._internalMetadata.Bb[M];B._internalMetadata.Bb[tM]={lastSelected:null,original:[],variants:{}};for(const M of q.original)B._internalMetadata.Bb[tM].original.push({mesh:M.mesh,material:M.material});for(const M in q.variants)if(Object.prototype.hasOwnProperty.call(q.variants,M)){B._internalMetadata.Bb[tM].variants[M]=[];for(const p of q.variants[M])B._internalMetadata.Bb[tM].variants[M].push({mesh:p.mesh,material:p.material})}q=B._internalMetadata.Bb[tM]}for(const Q of q.original)Q.mesh===p&&(Q.mesh=b);for(const Q of q.variants[k.name])Q.mesh===p&&(Q.mesh=b)}))}})))}}}))),await Promise.all(T).then((M=>{let[p]=M;return p}))}))}}c(tM),U(tM,!0,(M=>new eM(M)));var GM=b(11851);class mp{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:IM.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(M,p){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...mp._GetDefaultOptions(),...M},this._scene=p,this._scene._transmissionHelper=this,this.onErrorObservable=new H.b,this._scene.bb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(M){if(!Object.keys(M).filter((p=>this._options[p]!==M[p])).length)return;const p={...this._options,...M},b=this._options;this._options=p,p.renderSize===b.renderSize&&p.renderTargetTextureType===b.renderTargetTextureType&&p.generateMipmaps===b.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=p.samples,this._opaqueRenderTarget.lodGenerationScale=p.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=p.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(M){return!!M&&!!(M instanceof a.d&&M.subSurface.isRefractionEnabled)}_addMesh(M){this._materialObservers[M.uniqueId]=M.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),k.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(M.material)?(M.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(M)&&this._transparentMeshesCache.push(M)):-1===this._opaqueMeshesCache.indexOf(M)&&this._opaqueMeshesCache.push(M)}))}_removeMesh(M){M.onMaterialChangedObservable.remove(this._materialObservers[M.uniqueId]),delete this._materialObservers[M.uniqueId];let p=this._transparentMeshesCache.indexOf(M);-1!==p&&this._transparentMeshesCache.splice(p,1),p=this._opaqueMeshesCache.indexOf(M),-1!==p&&this._opaqueMeshesCache.splice(p,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(M){const p=this._transparentMeshesCache.indexOf(M),b=this._opaqueMeshesCache.indexOf(M);this._shouldRenderAsTransmission(M.material)?(M.material instanceof a.d&&(M.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==b?(this._opaqueMeshesCache.splice(b,1),this._transparentMeshesCache.push(M)):-1===p&&this._transparentMeshesCache.push(M)):-1!==p?(this._transparentMeshesCache.splice(p,1),this._opaqueMeshesCache.push(M)):-1===b&&this._opaqueMeshesCache.push(M)}_isRenderTargetValid(){var M;return null!==(null===(M=this._opaqueRenderTarget)||void 0===M?void 0:M.getInternalTexture())}_setupRenderTargets(){var M;let p;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new GM.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(M=this._options.clearColor)||void 0===M?void 0:M.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((M=>{p=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?M.clearColor.B(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(M.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=p}));for(const b of this._transparentMeshesCache)this._shouldRenderAsTransmission(b.material)&&(b.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const CM="KHR_materials_transmission";class XM{constructor(M){this.name=CM,this.order=175,this._loader=M,this.enabled=this._loader.isExtensionUsed(CM),this.enabled&&(M.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadTransparentPropertiesAsync(Q,p,b,q)),await Promise.all(B).then((()=>{}))}))}_loadTransparentPropertiesAsync(M,p,b,Q){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const q=b;if(q.subSurface.isRefractionEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.useAlbedoToTintRefraction=!0,void 0===Q.transmissionFactor)return q.subSurface.refractionIntensity=0,q.subSurface.isRefractionEnabled=!1,Promise.resolve();{var B;q.subSurface.refractionIntensity=Q.transmissionFactor;const M=q.RM();if(q.subSurface.refractionIntensity&&!M._transmissionHelper)new mp({},q.RM());else if(q.subSurface.refractionIntensity&&(null===(B=M._transmissionHelper)||void 0===B||!B._isRenderTargetValid())){var k;null===(k=M._transmissionHelper)||void 0===k||k._setupRenderTargets()}}return q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,Q.transmissionTexture?(Q.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${M}/transmissionTexture`,Q.transmissionTexture,void 0).then((M=>{M.name=`${b.name} (Transmission)`,q.subSurface.refractionIntensityTexture=M,q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}c(CM),U(CM,!0,(M=>new XM(M)));const lM="KHR_materials_diffuse_transmission";class Mp{constructor(M){this.name=lM,this.order=174,this._loader=M,this.enabled=this._loader.isExtensionUsed(lM),this.enabled&&(M.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadTranslucentPropertiesAsync(Q,p,b,q)),await Promise.all(B).then((()=>{}))}))}_loadTranslucentPropertiesAsync(M,p,b,Q){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const q=b;if(q.subSurface.isTranslucencyEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,q.subSurface.useAlbedoToTintTranslucency=!1,void 0===Q.diffuseTransmissionFactor)return q.subSurface.translucencyIntensity=0,q.subSurface.isTranslucencyEnabled=!1,Promise.resolve();q.subSurface.translucencyIntensity=Q.diffuseTransmissionFactor;const k=new Array;return q.subSurface.useGltfStyleTextures=!0,Q.diffuseTransmissionTexture&&(Q.diffuseTransmissionTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${M}/diffuseTransmissionTexture`,Q.diffuseTransmissionTexture).then((M=>{M.name=`${b.name} (Diffuse Transmission)`,q.subSurface.translucencyIntensityTexture=M})))),void 0!==Q.diffuseTransmissionColorFactor?q.subSurface.translucencyColor=B.ap.sp(Q.diffuseTransmissionColorFactor):q.subSurface.translucencyColor=B.ap.White(),Q.diffuseTransmissionColorTexture&&k.push(this._loader.loadTextureInfoAsync(`${M}/diffuseTransmissionColorTexture`,Q.diffuseTransmissionColorTexture).then((M=>{M.name=`${b.name} (Diffuse Transmission Color)`,q.subSurface.translucencyColorTexture=M}))),Promise.all(k).then((()=>{}))}}c(lM),U(lM,!0,(M=>new Mp(M)));const pp="KHR_materials_volume";class bp{constructor(M){this.name=pp,this.order=173,this._loader=M,this.enabled=this._loader.isExtensionUsed(pp),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadVolumePropertiesAsync(Q,p,b,q)),await Promise.all(B).then((()=>{}))}))}_loadVolumePropertiesAsync(M,p,b,Q){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);if(!b.subSurface.isRefractionEnabled&&!b.subSurface.isTranslucencyEnabled||!Q.thicknessFactor)return Promise.resolve();b.subSurface.volumeIndexOfRefraction=b.indexOfRefraction;const q=void 0!==Q.attenuationDistance?Q.attenuationDistance:Number.MAX_VALUE;return b.subSurface.tintColorAtDistance=q,void 0!==Q.attenuationColor&&3==Q.attenuationColor.length&&b.subSurface.tintColor.Db(Q.attenuationColor[0],Q.attenuationColor[1],Q.attenuationColor[2]),b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=Q.thicknessFactor,b.subSurface.useThicknessAsDepth=!0,Q.thicknessTexture?(Q.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${M}/thicknessTexture`,Q.thicknessTexture).then((M=>{M.name=`${b.name} (Thickness)`,b.subSurface.thicknessTexture=M,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}c(pp),U(pp,!0,(M=>new bp(M)));const Qp="KHR_materials_dispersion";class qp{constructor(M){this.name=Qp,this.order=174,this._loader=M,this.enabled=this._loader.isExtensionUsed(Qp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadDispersionPropertiesAsync(Q,p,b,q)),await Promise.all(B).then((()=>{}))}))}_loadDispersionPropertiesAsync(M,p,b,Q){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);return b.subSurface.isRefractionEnabled&&Q.dispersion?(b.subSurface.isDispersionEnabled=!0,b.subSurface.dispersion=Q.dispersion,Promise.resolve()):Promise.resolve()}}c(Qp),U(Qp,!0,(M=>new qp(M)));const Bp="EXT_materials_diffuse_roughness";class kp{constructor(M){this.name=Bp,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(Bp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=new Array;return B.push(this._loader.loadMaterialPropertiesAsync(M,p,b)),B.push(this._loadDiffuseRoughnessPropertiesAsync(Q,q,b)),await Promise.all(B).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(M,p,b){if(!(b instanceof a.d))throw new Error(`${M}: Material type not supported`);const Q=new Array;return b.brdf.baseDiffuseModel=IM.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=p.diffuseRoughnessFactor?b.baseDiffuseRoughness=p.diffuseRoughnessFactor:b.baseDiffuseRoughness=0,p.diffuseRoughnessTexture&&Q.push(this._loader.loadTextureInfoAsync(`${M}/diffuseRoughnessTexture`,p.diffuseRoughnessTexture,(M=>{M.name=`${b.name} (Diffuse Roughness)`,b.baseDiffuseRoughnessTexture=M}))),Promise.all(Q).then((()=>{}))}}c(Bp),U(Bp,!0,(M=>new kp(M)));const upM="KHR_mesh_quantization";class Tp{constructor(M){this.name=upM,this.enabled=M.isExtensionUsed(upM)}dispose(){}}c(upM),U(upM,!0,(M=>new Tp(M)));const Op="KHR_texture_basisu";class Hp{constructor(M){this.name=Op,this._loader=M,this.enabled=M.isExtensionUsed(Op)}dispose(){this._loader=null}_loadTextureAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>{const B=void 0==p.sampler?J.DefaultSampler:I.Get(`${M}/sampler`,this._loader.Bb.samplers,p.sampler),k=I.Get(`${Q}/source`,this._loader.Bb.images,q.source);return await this._loader._createTextureAsync(M,B,k,(M=>{b(M)}),p._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!p._textureInfo.nonColorData)}))}}c(Op),U(Op,!0,(M=>new Hp(M)));const Fp="KHR_texture_transform";class op{constructor(M){this.name=Fp,this._loader=M,this.enabled=this._loader.isExtensionUsed(Fp)}dispose(){this._loader=null}loadTextureInfoAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(Q,q)=>await this._loader.loadTextureInfoAsync(M,p,(M=>{if(!(M instanceof s.b))throw new Error(`${Q}: Texture type not supported`);q.offset&&(M.uOffset=q.offset[0],M.vOffset=q.offset[1]),M.uRotationCenter=0,M.vRotationCenter=0,q.rotation&&(M.wAng=-q.rotation),q.scale&&(M.uScale=q.scale[0],M.vScale=q.scale[1]),void 0!=q.texCoord&&(M.coordinatesIndex=q.texCoord),b(M)}))))}}c(Fp),U(Fp,!0,(M=>new op(M)));const Wp="KHR_xmp_json_ld";class ip{constructor(M){this.name=Wp,this.order=100,this._loader=M,this.enabled=this._loader.isExtensionUsed(Wp)}dispose(){this._loader=null}onLoading(){var M,p,b;if(null===this._loader.rootBabylonMesh)return;const Q=null===(M=this._loader.Bb.extensions)||void 0===M?void 0:M.KHR_xmp_json_ld,q=null===(p=this._loader.Bb.asset)||void 0===p||null===(b=p.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld;if(Q&&q){const M=+q.packet;Q.packets&&M<Q.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=Q.packets[M])}}}function Ap(M,p,b,Q){return B.ap.sp(p,b).scale(Q)}function jp(M,p,b,Q){return p[b]*Q}function Kp(M,p,b,Q){return-p[b]*Q}function Dp(M,p,b,Q){return p[b+1]*Q}function ap(M,p,b,Q){return p[b]*Q*2}function sp(M){return{scale:[new fp(o.c.ANIMATIONTYPE_FLOAT,`${M}.uScale`,jp,(()=>2)),new fp(o.c.ANIMATIONTYPE_FLOAT,`${M}.vScale`,Dp,(()=>2))],offset:[new fp(o.c.ANIMATIONTYPE_FLOAT,`${M}.uOffset`,jp,(()=>2)),new fp(o.c.ANIMATIONTYPE_FLOAT,`${M}.vOffset`,Dp,(()=>2))],rotation:[new fp(o.c.ANIMATIONTYPE_FLOAT,`${M}.wAng`,Kp,(()=>1))]}}c(Wp),U(Wp,!0,(M=>new ip(M)));class Sp extends v.AnimationPropertyInfo{buildAnimations(M,p,b,Q){return[{babylonAnimatable:M._babylonCamera,babylonAnimation:this._buildAnimation(p,b,Q)}]}}class fp extends v.AnimationPropertyInfo{buildAnimations(M,p,b,Q){const q=[];for(const B in M._data)q.push({babylonAnimatable:M._data[B].babylonMaterial,babylonAnimation:this._buildAnimation(p,b,Q)});return q}}class Rp extends v.AnimationPropertyInfo{buildAnimations(M,p,b,Q){return[{babylonAnimatable:M._babylonLight,babylonAnimation:this._buildAnimation(p,b,Q)}]}}(0,d.k)("/cameras/{}/orthographic/xmag",[new Sp(o.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Kp,(()=>1)),new Sp(o.c.ANIMATIONTYPE_FLOAT,"orthoRight",Dp,(()=>1))]),(0,d.k)("/cameras/{}/orthographic/ymag",[new Sp(o.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Kp,(()=>1)),new Sp(o.c.ANIMATIONTYPE_FLOAT,"orthoTop",Dp,(()=>1))]),(0,d.k)("/cameras/{}/orthographic/zfar",[new Sp(o.c.ANIMATIONTYPE_FLOAT,"maxZ",jp,(()=>1))]),(0,d.k)("/cameras/{}/orthographic/znear",[new Sp(o.c.ANIMATIONTYPE_FLOAT,"Fb",jp,(()=>1))]),(0,d.k)("/cameras/{}/perspective/yfov",[new Sp(o.c.ANIMATIONTYPE_FLOAT,"fov",jp,(()=>1))]),(0,d.k)("/cameras/{}/perspective/zfar",[new Sp(o.c.ANIMATIONTYPE_FLOAT,"maxZ",jp,(()=>1))]),(0,d.k)("/cameras/{}/perspective/znear",[new Sp(o.c.ANIMATIONTYPE_FLOAT,"Fb",jp,(()=>1))]),(0,d.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new fp(o.c.ANIMATIONTYPE_COLOR3,"albedoColor",Ap,(()=>4)),new fp(o.c.ANIMATIONTYPE_FLOAT,"alpha",(function(M,p,b,Q){return p[b+3]*Q}),(()=>4))]),(0,d.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"metallic",jp,(()=>1))]),(0,d.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"roughness",jp,(()=>1))]);const yp=sp("albedoTexture");(0,d.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",yp.scale),(0,d.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",yp.offset),(0,d.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",yp.rotation);const xp=sp("metallicTexture");(0,d.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",xp.scale),(0,d.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",xp.offset),(0,d.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",xp.rotation),(0,d.k)("/materials/{}/emissiveFactor",[new fp(o.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Ap,(()=>3))]);const Pp=sp("bumpTexture");(0,d.k)("/materials/{}/normalTexture/scale",[new fp(o.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",jp,(()=>1))]),(0,d.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Pp.scale),(0,d.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Pp.offset),(0,d.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Pp.rotation),(0,d.k)("/materials/{}/occlusionTexture/strength",[new fp(o.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",jp,(()=>1))]);const Lp=sp("ambientTexture");(0,d.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Lp.scale),(0,d.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Lp.offset),(0,d.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Lp.rotation);const Np=sp("emissiveTexture");(0,d.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Np.scale),(0,d.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Np.offset),(0,d.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Np.rotation),(0,d.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new fp(o.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new fp(o.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",jp,(()=>1))]);const rp=sp("anisotropy.texture");(0,d.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",rp.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",rp.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",rp.rotation),(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",jp,(()=>1))]);const Yp=sp("clearCoat.texture");(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Yp.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Yp.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Yp.rotation);const wp=sp("clearCoat.bumpTexture");(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new fp(o.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",wp.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",wp.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",wp.rotation);const Ep=sp("clearCoat.textureRoughness");(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Ep.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Ep.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Ep.rotation),(0,d.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new fp(o.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new fp(o.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new fp(o.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new fp(o.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",jp,(()=>1))]);const np=sp("iridescence.texture");(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",np.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",np.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",np.rotation);const gp=sp("iridescence.thicknessTexture");(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",gp.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",gp.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",gp.rotation),(0,d.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new fp(o.c.ANIMATIONTYPE_COLOR3,"sheen.color",Ap,(()=>3))]),(0,d.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",jp,(()=>1))]);const Up=sp("sheen.texture");(0,d.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Up.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Up.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Up.rotation);const cp=sp("sheen.textureRoughness");(0,d.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",cp.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",cp.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",cp.rotation),(0,d.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new fp(o.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Ap,(()=>3))]);const dp=sp("metallicReflectanceTexture");(0,d.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",dp.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",dp.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",dp.rotation);const Vp=sp("reflectanceTexture");(0,d.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Vp.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Vp.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Vp.rotation),(0,d.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",jp,(()=>1))]);const hp=sp("subSurface.refractionIntensityTexture");(0,d.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",hp.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",hp.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",hp.rotation),(0,d.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new fp(o.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Ap,(()=>3))]),(0,d.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new fp(o.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",jp,(()=>1))]),(0,d.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",jp,(()=>1))]);const Ip=sp("subSurface.thicknessTexture");(0,d.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Ip.scale),(0,d.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Ip.offset),(0,d.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Ip.rotation),(0,d.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new fp(o.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",jp,(()=>1))]);const Zp=sp("subSurface.translucencyIntensityTexture");(0,d.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Zp.scale),(0,d.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Zp.offset),(0,d.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Zp.rotation),(0,d.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new fp(o.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Ap,(()=>3))]);const Jp=sp("subSurface.translucencyColorTexture");(0,d.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Jp.scale),(0,d.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Jp.offset),(0,d.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Jp.rotation),(0,d.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new Rp(o.c.ANIMATIONTYPE_COLOR3,"diffuse",Ap,(()=>3))]),(0,d.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Rp(o.c.ANIMATIONTYPE_FLOAT,"intensity",jp,(()=>1))]),(0,d.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new Rp(o.c.ANIMATIONTYPE_FLOAT,"range",jp,(()=>1))]),(0,d.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Rp(o.c.ANIMATIONTYPE_FLOAT,"innerAngle",ap,(()=>1))]),(0,d.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Rp(o.c.ANIMATIONTYPE_FLOAT,"angle",ap,(()=>1))]),(0,d.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new Rp(o.c.ANIMATIONTYPE_COLOR3,"diffuse",Ap,(()=>3))]),(0,d.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Rp(o.c.ANIMATIONTYPE_FLOAT,"intensity",jp,(()=>1))]);const vp="KHR_animation_pointer";class zp{constructor(M){this.name=vp,this._loader=M,this._pathToObjectConverter=(0,d.g)(this._loader.Bb)}get enabled(){return this._loader.isExtensionUsed(vp)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(M,p,b,Q,q){var B;const k=null===(B=Q.target.extensions)||void 0===B?void 0:B.KHR_animation_pointer;if(!k||!this._pathToObjectConverter)return null;"pointer"!==Q.target.path&&A.c.Warn(`${M}/target/path: Value (${Q.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=Q.target.node&&A.c.Warn(`${M}/target/node: Value (${Q.target.node}) must not be present when using the ${this.name} extension`);const u=`${M}/extensions/${this.name}`,T=k.pointer;if(!T)throw new Error(`${u}: Pointer is missing`);try{const B=this._pathToObjectConverter.convert(T);if(!B.info.interpolation)throw new Error(`${u}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(M,p,b,Q,{object:B.object,info:B.info.interpolation},q)}catch(O){return A.c.Warn(`${u}/pointer: Invalid pointer (${T}) skipped`),null}}}c(vp),U(vp,!0,(M=>new zp(M)));class tp{constructor(M,p,b){this.frame=M,this.action=p,this.onlyOnce=b,this.isDone=!1}_clone(){return new tp(this.frame,this.action,this.onlyOnce)}}var ep=b(11651),Gp=b(11700),mb=b(11693);class Cp{get loop(){return this._loop}set loop(M){M!==this._loop&&(this._loop=M,this.updateOptions({loop:M}))}get currentTime(){var M;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(M=Gp.c.audioEngine)&&void 0!==M&&M.audioContext&&(this.isPlaying||this.isPaused)){const M=this.isPaused?0:Gp.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+M}return 0}get spatialSound(){return this._spatialSound}set spatialSound(M){if(M==this._spatialSound)return;const p=this.isPlaying;this.pause(),M?(this._spatialSound=M,this._updateSpatialParameters()):this._disableSpatialSound(),p&&this.play()}constructor(M,p,b){var Q;let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new H.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=q.Ap.Zero(),this._localDirection=new q.Ap(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=M,b=b||i.c.LastCreatedScene)if(this._scene=b,Cp._SceneComponentInitialization(b),this._readyToPlayCallback=B,this._customAttenuationFunction=(M,p,b,Q,q)=>p<b?M*(1-p/b):0,u&&(this.autoplay=u.autoplay||!1,this._loop=u.loop||!1,void 0!==u.volume&&(this._volume=u.volume),this._spatialSound=u.spatialSound??!1,this.maxDistance=u.maxDistance??100,this.useCustomAttenuation=u.useCustomAttenuation??!1,this.rolloffFactor=u.rolloffFactor||1,this.refDistance=u.refDistance||1,this.distanceModel=u.distanceModel||"linear",this._playbackRate=u.playbackRate||1,this._streaming=u.streaming??!1,this._length=u.length,this._offset=u.offset),null!==(Q=Gp.c.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&Gp.c.audioEngine.audioContext){this._soundGain=Gp.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let M=!0;if(p)try{"string"===typeof p?(this._urlType="String",this._url=p):p instanceof ArrayBuffer?this._urlType="ArrayBuffer":p instanceof HTMLMediaElement?this._urlType="MediaElement":p instanceof MediaStream?this._urlType="MediaStream":p instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(p)&&(this._urlType="Array");let b=[],Q=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gp.c.audioEngine.audioContext.createMediaElementSource(p),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gp.c.audioEngine.audioContext.createMediaStreamSource(p),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":p.byteLength>0&&(Q=!0,this._soundLoaded(p));break;case"AudioBuffer":this._audioBufferLoaded(p);break;case"String":b.push(p);case"Array":0===b.length&&(b=p);for(let M=0;M<b.length;M++){const p=b[M];if(Q=u&&u.skipCodecCheck||-1!==p.indexOf(".mp3",p.length-4)&&Gp.c.audioEngine.isMP3supported||-1!==p.indexOf(".ogg",p.length-4)&&Gp.c.audioEngine.isOGGsupported||-1!==p.indexOf(".wav",p.length-4)||-1!==p.indexOf(".m4a",p.length-4)||-1!==p.indexOf(".mp4",p.length-4)||-1!==p.indexOf("blob:"),Q){this._streaming?(this._htmlAudioElement=new Audio(p),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,k.Tools.SetCorsBehavior(p,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(p,(M=>{this._soundLoaded(M)}),void 0,!0,!0,(M=>{M&&A.c.Error("XHR "+M.status+" error on: "+p+"."),A.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:M=!1}M?Q||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):A.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(T){A.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Gp.c.audioEngine&&!Gp.c.audioEngine.WarnedWebAudioUnsupported&&(A.c.Error("Web Audio is not supported by your browser."),Gp.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var M;null!==(M=Gp.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(M){var p;null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.audioContext&&(this._audioBuffer=M,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(M){var p;null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.audioContext&&Gp.c.audioEngine.audioContext.decodeAudioData(M,(M=>{this._audioBufferLoaded(M)}),(M=>{A.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+M)}))}setAudioBuffer(M){var p;null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&(this._audioBuffer=M,this._isReadyToPlay=!0)}updateOptions(M){M&&(this.loop=M.loop??this.loop,this.maxDistance=M.maxDistance??this.maxDistance,this.useCustomAttenuation=M.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=M.rolloffFactor??this.rolloffFactor,this.refDistance=M.refDistance??this.refDistance,this.distanceModel=M.distanceModel??this.distanceModel,this._playbackRate=M.playbackRate??this._playbackRate,this._length=M.length??void 0,this.spatialSound=M.spatialSound??this._spatialSound,this._setOffset(M.offset??void 0),this.setVolume(M.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var M;null!==(M=Gp.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&Gp.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Gp.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var M;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(M=this._soundPanner)||void 0===M||M.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var M;null!==(M=Gp.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(M){var p;null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(M),this._isOutputConnected=!0)}setDirectionalCone(M,p,b){p<M?A.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=M,this._coneOuterAngle=p,this._coneOuterGain=b,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(M){if(M!=this._coneInnerAngle){var p;if(this._coneOuterAngle<M)return void A.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=M,null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(M){if(M!=this._coneOuterAngle){var p;if(M<this._coneInnerAngle)return void A.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=M,null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(M){var p;M.equals(this._position)||(this._position.B(M),null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(M){var p;this._localDirection=M,null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const M=this._connectedTransformNode.getWorldMatrix(),p=q.Ap.TransformNormal(this._localDirection,M);p.normalize(),this._soundPanner.orientationX.value=p.x,this._soundPanner.orientationY.value=p.y,this._soundPanner.orientationZ.value=p.z}updateDistanceFromListener(){var M;if(null!==(M=Gp.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const M=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.jp(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,M,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(M){this._customAttenuationFunction=M}play(M,p,b){var Q;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(Q=Gp.c.audioEngine)&&void 0!==Q&&Q.audioContext)try{var q,B;this._clearTimeoutsAndObservers();let Q=M?(null===(q=Gp.c.audioEngine)||void 0===q?void 0:q.audioContext.currentTime)+M:null===(B=Gp.c.audioEngine)||void 0===B?void 0:B.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Gp.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const M=()=>{var b;if(null!==(b=Gp.c.audioEngine)&&void 0!==b&&b.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=p??0;const b=this._htmlAudioElement.play();void 0!==b&&b.catch((()=>{var p,b;(null===(p=Gp.c.audioEngine)||void 0===p||p.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(b=Gp.c.audioEngine)||void 0===b?void 0:b.onAudioUnlockedObservable.addOnce((()=>{M()})))}))}else{var Q;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(Q=Gp.c.audioEngine)||void 0===Q?void 0:Q.onAudioUnlockedObservable.addOnce((()=>{M()}))}};M()}}else{var k;const q=()=>{var q;if(null!==(q=Gp.c.audioEngine)&&void 0!==q&&q.audioContext){var B;if(b=b||this._length,void 0!==p&&this._setOffset(p),this._soundSource){const M=this._soundSource;M.onended=()=>{M.disconnect()}}if(this._soundSource=null===(B=Gp.c.audioEngine)||void 0===B?void 0:B.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var k;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==p&&(this._soundSource.loopStart=p),void 0!==b&&(this._soundSource.loopEnd=(0|p)+b),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},Q=M?(null===(k=Gp.c.audioEngine)||void 0===k?void 0:k.audioContext.currentTime)+M:Gp.c.audioEngine.audioContext.currentTime;const q=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(Q,q,this.loop?void 0:b)}}};"suspended"===(null===(k=Gp.c.audioEngine)||void 0===k?void 0:k.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var M;"suspended"===(null===(M=Gp.c.audioEngine)||void 0===M?void 0:M.audioContext.state)?(Gp.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Gp.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{q()})))):q()}),500):q()}this._startTime=Q,this.isPlaying=!0,this.isPaused=!1}catch(u){A.c.Error("Error while trying to play audio: "+this.name+", "+u.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(M){var p;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1}else if(null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.audioContext&&this._soundSource){const p=M?Gp.c.audioEngine.audioContext.currentTime+M:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(p)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var M;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var p;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(p=this._streamingSource)||void 0===p||p.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(M=Gp.c.audioEngine)&&void 0!==M&&M.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Gp.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(M,p){var b;null!==(b=Gp.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._soundGain&&(p&&Gp.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Gp.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Gp.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(M,Gp.c.audioEngine.audioContext.currentTime+p)):this._soundGain.gain.value=M),this._volume=M}setPlaybackRate(M){this._playbackRate=M,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(M){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=M,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=M=>this._onRegisterAfterWorldMatrixUpdate(M),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(M){var p;if(M.getBoundingInfo){const p=M.getBoundingInfo();this.setPosition(p.boundingSphere.centerWorld)}else this.setPosition(M.absolutePosition);null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const M=()=>{(0,mb.i)((()=>this._isReadyToPlay),(()=>{b._audioBuffer=this.getAudioBuffer(),b._isReadyToPlay=!0,b.autoplay&&b.play(0,this._offset,this._length)}),void 0,300)},p={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},b=new Cp(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,p);return this.useCustomAttenuation&&b.setAttenuationFunction(this._customAttenuationFunction),b.setPosition(this._position),b.setPlaybackRate(this._playbackRate),M(),b}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const M={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(M.connectedMeshId=this._connectedTransformNode.id),M.position=this._position.Ob(),M.refDistance=this.refDistance,M.distanceModel=this.distanceModel,M.isDirectional=this._isDirectional,M.localDirectionToMesh=this._localDirection.Ob(),M.coneInnerAngle=this._coneInnerAngle,M.coneOuterAngle=this._coneOuterAngle,M.coneOuterGain=this._coneOuterGain),M}static Parse(M,p,b,Q){const B=M.name;let k;k=M.url?b+M.url:b+B;const u={autoplay:M.autoplay,loop:M.loop,volume:M.volume,spatialSound:M.spatialSound,maxDistance:M.maxDistance,rolloffFactor:M.rolloffFactor,refDistance:M.refDistance,distanceModel:M.distanceModel,playbackRate:M.playbackRate};let T;if(Q){const M=()=>{(0,mb.i)((()=>Q._isReadyToPlay),(()=>{T._audioBuffer=Q.getAudioBuffer(),T._isReadyToPlay=!0,T.autoplay&&T.play(0,T._offset,T._length)}),void 0,300)};T=new Cp(B,new ArrayBuffer(0),p,null,u),M()}else T=new Cp(B,k,p,(()=>{p.removePendingData(T)}),u),p.addPendingData(T);if(M.position){const p=q.Ap.sp(M.position);T.setPosition(p)}if(M.isDirectional&&(T.setDirectionalCone(M.coneInnerAngle||360,M.coneOuterAngle||360,M.coneOuterGain||0),M.localDirectionToMesh)){const p=q.Ap.sp(M.localDirectionToMesh);T.setLocalDirectionToMesh(p)}if(M.connectedMeshId){const b=p.getMeshById(M.connectedMeshId);b&&T.attachToMesh(b)}return M.metadata&&(T.metadata=M.metadata),T}_setOffset(M){this._offset!==M&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=M)}_clearTimeoutsAndObservers(){var M;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(M=Gp.c.audioEngine)||void 0===M||M.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Cp._SceneComponentInitialization=M=>{throw(0,ep.c)("AudioSceneComponent")},(0,fM.g)("BABYLON.Sound",Cp);class Xp{constructor(M,p,b){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],p.length!==b.length)throw new Error("Sounds length does not equal weights length");this.loop=M,this._weights=b;let Q=0;for(const B of b)Q+=B;const q=Q>0?1/Q:0;for(let B=0;B<this._weights.length;B++)this._weights[B]*=q;this._sounds=p;for(const B of this._sounds)B.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(M){if(M!==this._coneInnerAngle){if(this._coneOuterAngle<M)return void A.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=M;for(const p of this._sounds)p.directionalConeInnerAngle=M}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(M){if(M!==this._coneOuterAngle){if(M<this._coneInnerAngle)return void A.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=M;for(const p of this._sounds)p.directionalConeOuterAngle=M}}get volume(){return this._volume}set volume(M){if(M!==this._volume)for(const p of this._sounds)p.setVolume(M)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(M){if(!this.isPaused){this.stop();const M=Math.random();let p=0;for(let b=0;b<this._weights.length;b++)if(p+=this._weights[b],M<=p){this._currentIndex=b;break}}const p=this._sounds[this._currentIndex??0];p.isReady()?p.play(0,this.isPaused?void 0:M):p.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class lp{constructor(M){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(M=M||i.c.LastCreatedScene)&&(this._scene=M,this.soundCollection=[],this._options=p,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var M;null!==(M=Gp.c.audioEngine)&&void 0!==M&&M.canUseWebAudio&&Gp.c.audioEngine.audioContext&&(this._outputAudioNode=Gp.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Gp.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Gp.c.audioEngine&&Gp.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(M){var p;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&M.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==M.soundTrackId&&(-1===M.soundTrackId?this._scene.mainSoundTrack.removeSound(M):this._scene.soundTracks&&this._scene.soundTracks[M.soundTrackId].removeSound(M)),this.soundCollection.push(M),M.soundTrackId=this.id}removeSound(M){const p=this.soundCollection.indexOf(M);-1!==p&&this.soundCollection.splice(p,1)}setVolume(M){var p;null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=M)}switchPanningModelToHRTF(){var M;if(null!==(M=Gp.c.audioEngine)&&void 0!==M&&M.canUseWebAudio)for(let p=0;p<this.soundCollection.length;p++)this.soundCollection[p].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var M;if(null!==(M=Gp.c.audioEngine)&&void 0!==M&&M.canUseWebAudio)for(let p=0;p<this.soundCollection.length;p++)this.soundCollection[p].switchPanningModelToEqualPower()}connectToAnalyser(M){var p;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=M,null!==(p=Gp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Gp.c.audioEngine.masterGain))}}var Mb=b(12073),pb=b(12033),bb=b(11632);Gp.c.AudioEngineFactory=(M,p,b)=>new Qb(M,p,b);class Qb{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new H.b,this.onAudioLockedObservable=new H.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,bb.n)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const Q=document.createElement("audio");this._hostElement=M,this._audioContext=p,this._audioDestination=b;try{Q&&Q.canPlayType&&(Q.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||Q.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(q){}try{Q&&Q.canPlayType&&Q.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(q){}}lock(){this._triggerSuspendedState()}unlock(){var M,p;if("running"===(null===(M=this._audioContext)||void 0===M?void 0:M.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(p=this._audioContext)||void 0===p||p.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{A.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var M;null===(M=this._audioContext)||void 0===M||M.addEventListener("statechange",(()=>{var M;this.unlocked&&"running"!==(null===(M=this._audioContext)||void 0===M?void 0:M.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var M;return null!==(M=this._audioContext)&&void 0!==M&&M.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(M){this.canUseWebAudio=!1,A.c.Error("Web Audio: "+M.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(M){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const M=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",p=document.createElement("style");p.appendChild(document.createTextNode(M)),document.getElementsByTagName("head")[0].appendChild(p),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var M;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(M=this._audioContext)||void 0===M||M.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(M){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=M)}connectToAnalyser(M){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=M,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var qb=b(11647);(0,b(13143).e)(Mb.c.NAME_AUDIO,((M,p,b,Q)=>{let q,B=[];if(b.ho=b.ho||[],void 0!==M.ho&&null!==M.ho)for(let u=0,T=M.ho.length;u<T;u++){var k;const T=M.ho[u];null!==(k=Gp.c.audioEngine)&&void 0!==k&&k.canUseWebAudio?(T.url||(T.url=T.name),B[T.url]?b.ho.push(Cp.Parse(T,p,Q,B[T.url])):(q=Cp.Parse(T,p,Q),B[T.url]=q,b.ho.push(q))):b.ho.push(new Cp(T.name,null,p))}B=[]})),Object.defineProperty(pb.e.prototype,"mainSoundTrack",{get:function(){let M=this._getComponent(Mb.c.NAME_AUDIO);return M||(M=new Bb(this),this.o(M)),this._mainSoundTrack||(this._mainSoundTrack=new lp(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),pb.e.prototype.getSoundByName=function(M){let p;for(p=0;p<this.mainSoundTrack.soundCollection.length;p++)if(this.mainSoundTrack.soundCollection[p].name===M)return this.mainSoundTrack.soundCollection[p];if(this.soundTracks)for(let b=0;b<this.soundTracks.length;b++)for(p=0;p<this.soundTracks[b].soundCollection.length;p++)if(this.soundTracks[b].soundCollection[p].name===M)return this.soundTracks[b].soundCollection[p];return null},Object.defineProperty(pb.e.prototype,"audioEnabled",{get:function(){let M=this._getComponent(Mb.c.NAME_AUDIO);return M||(M=new Bb(this),this.o(M)),M.audioEnabled},set:function(M){let p=this._getComponent(Mb.c.NAME_AUDIO);p||(p=new Bb(this),this.o(p)),M?p.enableAudio():p.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(pb.e.prototype,"headphone",{get:function(){let M=this._getComponent(Mb.c.NAME_AUDIO);return M||(M=new Bb(this),this.o(M)),M.headphone},set:function(M){let p=this._getComponent(Mb.c.NAME_AUDIO);p||(p=new Bb(this),this.o(p)),M?p.switchAudioModeForHeadphones():p.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(pb.e.prototype,"audioListenerPositionProvider",{get:function(){let M=this._getComponent(Mb.c.NAME_AUDIO);return M||(M=new Bb(this),this.o(M)),M.audioListenerPositionProvider},set:function(M){let p=this._getComponent(Mb.c.NAME_AUDIO);if(p||(p=new Bb(this),this.o(p)),M&&"function"!==typeof M)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");p.audioListenerPositionProvider=M},enumerable:!0,configurable:!0}),Object.defineProperty(pb.e.prototype,"audioListenerRotationProvider",{get:function(){let M=this._getComponent(Mb.c.NAME_AUDIO);return M||(M=new Bb(this),this.o(M)),M.audioListenerRotationProvider},set:function(M){let p=this._getComponent(Mb.c.NAME_AUDIO);if(p||(p=new Bb(this),this.o(p)),M&&"function"!==typeof M)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");p.audioListenerRotationProvider=M},enumerable:!0,configurable:!0}),Object.defineProperty(pb.e.prototype,"audioPositioningRefreshRate",{get:function(){let M=this._getComponent(Mb.c.NAME_AUDIO);return M||(M=new Bb(this),this.o(M)),M.audioPositioningRefreshRate},set:function(M){let p=this._getComponent(Mb.c.NAME_AUDIO);p||(p=new Bb(this),this.o(p)),p.audioPositioningRefreshRate=M},enumerable:!0,configurable:!0});class Bb{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(M){this.name=Mb.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new q.Ap,this._cachedCameraPosition=new q.Ap,this._lastCheck=0,this._invertMatrixTemp=new q.Matrix,this._cameraDirectionTemp=new q.Ap,(M=M||i.c.LastCreatedScene)&&(this.Kp=M,M.soundTracks=[],M.ho=[])}register(){this.Kp._afterRenderStage.registerStep(Mb.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(M){if(M.ho=[],this.Kp.soundTracks)for(let p=0;p<this.Kp.soundTracks.length;p++){const b=this.Kp.soundTracks[p];for(let p=0;p<b.soundCollection.length;p++)M.ho.push(b.soundCollection[p].serialize())}}addFromContainer(M){if(M.ho)for(const p of M.ho)p.play(),p.autoplay=!0,this.Kp.mainSoundTrack.addSound(p)}removeFromContainer(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(M.ho)for(const b of M.ho)b.stop(),b.autoplay=!1,this.Kp.mainSoundTrack.removeSound(b),p&&b.dispose()}dispose(){const M=this.Kp;if(M._mainSoundTrack&&M.mainSoundTrack.dispose(),M.soundTracks)for(let p=0;p<M.soundTracks.length;p++)M.soundTracks[p].dispose()}disableAudio(){const M=this.Kp;let p;for(this._audioEnabled=!1,Gp.c.audioEngine&&Gp.c.audioEngine.audioContext&&Gp.c.audioEngine.audioContext.suspend(),p=0;p<M.mainSoundTrack.soundCollection.length;p++)M.mainSoundTrack.soundCollection[p].pause();if(M.soundTracks)for(p=0;p<M.soundTracks.length;p++)for(let b=0;b<M.soundTracks[p].soundCollection.length;b++)M.soundTracks[p].soundCollection[b].pause()}enableAudio(){const M=this.Kp;let p;for(this._audioEnabled=!0,Gp.c.audioEngine&&Gp.c.audioEngine.audioContext&&Gp.c.audioEngine.audioContext.resume(),p=0;p<M.mainSoundTrack.soundCollection.length;p++)M.mainSoundTrack.soundCollection[p].isPaused&&M.mainSoundTrack.soundCollection[p].play();if(M.soundTracks)for(p=0;p<M.soundTracks.length;p++)for(let b=0;b<M.soundTracks[p].soundCollection.length;b++)M.soundTracks[p].soundCollection[b].isPaused&&M.soundTracks[p].soundCollection[b].play()}switchAudioModeForHeadphones(){const M=this.Kp;if(this._headphone=!0,M.mainSoundTrack.switchPanningModelToHRTF(),M.soundTracks)for(let p=0;p<M.soundTracks.length;p++)M.soundTracks[p].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const M=this.Kp;if(this._headphone=!1,M.mainSoundTrack.switchPanningModelToEqualPower(),M.soundTracks)for(let p=0;p<M.soundTracks.length;p++)M.soundTracks[p].switchPanningModelToEqualPower()}_afterRender(){const M=qb.b.Now;if(this._lastCheck&&M-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=M;const p=this.Kp;if(!this._audioEnabled||!p._mainSoundTrack||!p.soundTracks||0===p._mainSoundTrack.soundCollection.length&&1===p.soundTracks.length)return;const b=Gp.c.audioEngine;if(b&&b.audioContext){let M,Q=p.activeCamera;if(p.activeCameras&&p.activeCameras.length>0&&(Q=p.activeCameras[0]),this.audioListenerPositionProvider){const M=this.audioListenerPositionProvider();b.audioContext.listener.setPosition(M.x||0,M.y||0,M.z||0)}else Q?this._cachedCameraPosition.equals(Q.globalPosition)||(this._cachedCameraPosition.B(Q.globalPosition),b.audioContext.listener.setPosition(Q.globalPosition.x,Q.globalPosition.y,Q.globalPosition.z)):b.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const M=this.audioListenerRotationProvider();b.audioContext.listener.setOrientation(M.x||0,M.y||0,M.z||0,0,1,0)}else Q?(Q.rigCameras&&Q.rigCameras.length>0&&(Q=Q.rigCameras[0]),Q.getViewMatrix().invertToRef(this._invertMatrixTemp),q.Ap.TransformNormalToRef(Bb._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.B(this._cameraDirectionTemp),b.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):b.audioContext.listener.setOrientation(0,0,0,0,1,0);for(M=0;M<p.mainSoundTrack.soundCollection.length;M++){const b=p.mainSoundTrack.soundCollection[M];b.useCustomAttenuation&&b.updateDistanceFromListener()}if(p.soundTracks)for(M=0;M<p.soundTracks.length;M++)for(let b=0;b<p.soundTracks[M].soundCollection.length;b++){const Q=p.soundTracks[M].soundCollection[b];Q.useCustomAttenuation&&Q.updateDistanceFromListener()}}}}Bb._CameraDirection=new q.Ap(0,0,-1),Cp._SceneComponentInitialization=M=>{let p=M._getComponent(Mb.c.NAME_AUDIO);p||(p=new Bb(M),M.o(p))};const kb="MSFT_audio_emitter";class ub{constructor(M){this.name=kb,this._loader=M,this.enabled=this._loader.isExtensionUsed(kb)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const M=this._loader.Bb.extensions;if(M&&M[this.name]){const p=M[this.name];this._clips=p.clips,this._emitters=p.emitters,I.Assign(this._clips),I.Assign(this._emitters)}}loadSceneAsync(M,p){return J.LoadExtensionAsync(M,p,this.name,(async(b,Q)=>{const q=new Array;q.push(this._loader.loadSceneAsync(M,p));for(const M of Q.emitters){const p=I.Get(`${b}/emitters`,this._emitters,M);if(void 0!=p.refDistance||void 0!=p.maxDistance||void 0!=p.rolloffFactor||void 0!=p.distanceModel||void 0!=p.innerAngle||void 0!=p.outerAngle)throw new Error(`${b}: Direction or Distance properties are not allowed on emitters attached to a scene`);q.push(this._loadEmitterAsync(`${b}/emitters/${p.index}`,p))}await Promise.all(q)}))}loadNodeAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(M,Q)=>{const B=new Array,u=await this._loader.loadNodeAsync(M,p,(p=>{for(const b of Q.emitters){const Q=I.Get(`${M}/emitters`,this._emitters,b);B.push(this._loadEmitterAsync(`${M}/emitters/${Q.index}`,Q).then((()=>{for(const M of Q._babylonSounds)M.attachToMesh(p),void 0==Q.innerAngle&&void 0==Q.outerAngle||(M.setLocalDirectionToMesh(q.Ap.Forward()),M.setDirectionalCone(2*k.Tools.ToDegrees(void 0==Q.innerAngle?Math.PI:Q.innerAngle),2*k.Tools.ToDegrees(void 0==Q.outerAngle?Math.PI:Q.outerAngle),0))})))}b(p)}));return await Promise.all(B),u}))}loadAnimationAsync(M,p){return J.LoadExtensionAsync(M,p,this.name,(async(b,Q)=>{const q=await this._loader.loadAnimationAsync(M,p),B=new Array;I.Assign(Q.events);for(const k of Q.events)B.push(this._loadAnimationEventAsync(`${b}/events/${k.index}`,M,p,k,q));return await Promise.all(B),q}))}_loadClipAsync(M,p){if(p._objectURL)return p._objectURL;let b;if(p.uri)b=this._loader.loadUriAsync(M,p,p.uri);else{const Q=I.Get(`${M}/bufferView`,this._loader.Bb.bufferViews,p.bufferView);b=this._loader.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)}return p._objectURL=b.then((M=>URL.createObjectURL(new Blob([M],{type:p.mimeType})))),p._objectURL}_loadEmitterAsync(M,p){if(p._babylonSounds=p._babylonSounds||[],!p._babylonData){const M=new Array,b=p.name||`emitter${p.index}`,Q={loop:!1,autoplay:!1,volume:void 0==p.volume?1:p.volume};for(let B=0;B<p.clips.length;B++){const q=`/extensions/${this.name}/clips`,k=I.Get(q,this._clips,p.clips[B].clip);M.push(this._loadClipAsync(`${q}/${p.clips[B].clip}`,k).then((M=>{const q=p._babylonSounds[B]=new Cp(b,M,this._loader.babylonScene,null,Q);q.refDistance=p.refDistance||1,q.maxDistance=p.maxDistance||256,q.rolloffFactor=p.rolloffFactor||1,q.distanceModel=p.distanceModel||"exponential"})))}const q=Promise.all(M).then((()=>{const M=p.clips.map((M=>M.weight||1)),b=new Xp(p.loop||!1,p._babylonSounds,M);p.innerAngle&&(b.directionalConeInnerAngle=2*k.Tools.ToDegrees(p.innerAngle)),p.outerAngle&&(b.directionalConeOuterAngle=2*k.Tools.ToDegrees(p.outerAngle)),p.volume&&(b.volume=p.volume),p._babylonData.sound=b}));p._babylonData={loaded:q}}return p._babylonData.loaded}_getEventAction(M,p,b,Q,q){switch(b){case"play":return M=>{const b=(q||0)+(M-Q);p.play(b)};case"stop":return()=>{p.stop()};case"pause":return()=>{p.pause()};default:throw new Error(`${M}: Unsupported action ${b}`)}}_loadAnimationEventAsync(M,p,b,Q,q){if(0==q.targetedAnimations.length)return Promise.resolve();const B=q.targetedAnimations[0],k=Q.Qp,u=I.Get(`/extensions/${this.name}/emitters`,this._emitters,k);return this._loadEmitterAsync(M,u).then((()=>{const p=u._babylonData.sound;if(p){const b=new tp(Q.time,this._getEventAction(M,p,Q.action,Q.time,Q.startOffset));B.animation.addEvent(b),q.onAnimationGroupEndObservable.add((()=>{p.stop()})),q.onAnimationGroupPauseObservable.add((()=>{p.pause()}))}}))}}c(kb),U(kb,!0,(M=>new ub(M)));const Tb="MSFT_lod";class Ob{constructor(M){var p;this.name=Tb,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new H.b,this.onMaterialLODsLoadedObservable=new H.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=M,this.maxLODsToLoad=(null===(p=this._loader.parent.extensionOptions[Tb])||void 0===p?void 0:p.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Tb)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let M=0;M<this._nodePromiseLODs.length;M++){const p=Promise.all(this._nodePromiseLODs[M]).then((()=>{0!==M&&(this._loader.endPerformanceCounter(`Node LOD ${M}`),this._loader.log(`Loaded node LOD ${M}`)),this.onNodeLODsLoadedObservable.notifyObservers(M),M!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${M+1}`),this._loadBufferLOD(this._nodeBufferLODs,M+1),this._nodeSignalLODs[M]&&this._nodeSignalLODs[M].resolve())}));this._loader._completePromises.push(p)}for(let M=0;M<this._materialPromiseLODs.length;M++){const p=Promise.all(this._materialPromiseLODs[M]).then((()=>{0!==M&&(this._loader.endPerformanceCounter(`Material LOD ${M}`),this._loader.log(`Loaded material LOD ${M}`)),this.onMaterialLODsLoadedObservable.notifyObservers(M),M!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${M+1}`),this._loadBufferLOD(this._materialBufferLODs,M+1),this._materialSignalLODs[M]&&this._materialSignalLODs[M].resolve())}));this._loader._completePromises.push(p)}}loadSceneAsync(M,p){const b=this._loader.loadSceneAsync(M,p);return this._loadBufferLOD(this._bufferLODs,0),b}loadNodeAsync(M,p,b){return J.LoadExtensionAsync(M,p,this.name,(async(M,q)=>{let B;const k=this._getLODs(M,p,this._loader.Bb.nodes,q.ids);this._loader.logOpen(`${M}`);for(let p=0;p<k.length;p++){const M=k[p];0!==p&&(this._nodeIndexLOD=p,this._nodeSignalLODs[p]=this._nodeSignalLODs[p]||new Q);const q=M=>{b(M),M.pT(!1)},u=this._loader.loadNodeAsync(`/nodes/${M.index}`,M,q).then((M=>{if(0!==p){const M=k[p-1];M._babylonTransformNode&&(this._disposeTransformNode(M._babylonTransformNode),delete M._babylonTransformNode)}return M.pT(!0),M}));this._nodePromiseLODs[p]=this._nodePromiseLODs[p]||[],0===p?B=u:(this._nodeIndexLOD=null,this._nodePromiseLODs[p].push(u))}return this._loader.logClose(),await B}))}_loadMaterialAsync(M,p,b,Q,q){return this._nodeIndexLOD?null:J.LoadExtensionAsync(M,p,this.name,(async(M,B)=>{let k;const u=this._getLODs(M,p,this._loader.Bb.materials,B.ids);this._loader.logOpen(`${M}`);for(let p=0;p<u.length;p++){const M=u[p];0!==p&&(this._materialIndexLOD=p);const B=this._loader._loadMaterialAsync(`/materials/${M.index}`,M,b,Q,(M=>{0===p&&q(M)})).then((M=>{if(0!==p){q(M);const b=u[p-1]._data;b[Q]&&(this._disposeMaterials([b[Q].babylonMaterial]),delete b[Q])}return M}));this._materialPromiseLODs[p]=this._materialPromiseLODs[p]||[],0===p?k=B:(this._materialIndexLOD=null,this._materialPromiseLODs[p].push(B))}return this._loader.logClose(),await k}))}_loadUriAsync(M,p,b){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const q=this._nodeIndexLOD-1;return this._nodeSignalLODs[q]=this._nodeSignalLODs[q]||new Q,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(M,p,b)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const q=this._materialIndexLOD-1;return this._materialSignalLODs[q]=this._materialSignalLODs[q]||new Q,this._materialSignalLODs[q].promise.then((async()=>await this._loader.loadUriAsync(M,p,b)))}return null}loadBufferAsync(M,p,b,q){if(this._loader.parent.useRangeRequests&&!p.uri){if(!this._loader.bin)throw new Error(`${M}: Uri is missing or the binary glTF is missing its binary chunk`);const p=async(M,p)=>{const B=b,k=B+q-1;let u=M[p];return u?(u.start=Math.min(u.start,B),u.end=Math.max(u.end,k)):(u={start:B,end:k,loaded:new Q},M[p]=u),await u.loaded.promise.then((M=>new Uint8Array(M.buffer,M.byteOffset+b-u.start,q)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?p(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?p(this._materialBufferLODs,this._materialIndexLOD):p(this._bufferLODs,0)}return null}_loadBufferLOD(M,p){const b=M[p];b&&(this._loader.log(`Loading buffer range [${b.start}-${b.end}]`),this._loader.bin.readAsync(b.start,b.end-b.start+1).then((M=>{b.loaded.resolve(M)}),(M=>{b.loaded.reject(M)})))}_getLODs(M,p,b,Q){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const q=[];for(let B=Q.length-1;B>=0;B--)if(q.push(I.Get(`${M}/ids/${Q[B]}`,b,Q[B])),q.length===this.maxLODsToLoad)return q;return q.push(p),q}_disposeTransformNode(M){const p=[],b=M.material;b&&p.push(b);for(const q of M.getChildMeshes())q.material&&p.push(q.material);M.dispose();const Q=p.filter((M=>this._loader.babylonScene.meshes.every((p=>p.material!=M))));this._disposeMaterials(Q)}_disposeMaterials(M){const p={};for(const b of M){for(const M of b.getActiveTextures())p[M.uniqueId]=M;b.dispose()}for(const b in p)for(const M of this._loader.babylonScene.materials)M.hasTexture(p[b])&&delete p[b];for(const b in p)p[b].dispose()}}c(Tb),U(Tb,!0,(M=>new Ob(M)));const Hb="MSFT_minecraftMesh";class Fb{constructor(M){this.name=Hb,this._loader=M,this.enabled=this._loader.isExtensionUsed(Hb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtraAsync(M,p,this.name,(async(Q,q)=>{if(q){if(!(b instanceof a.d))throw new Error(`${Q}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(M,p,b);return b.needAlphaBlending()&&(b.forceDepthWrite=!0,b.separateCullingPass=!0),b.Kb=b.forceDepthWrite,b.twoSidedLighting=!0,await q}}))}}c(Hb),U(Hb,!0,(M=>new Fb(M)));const ob="MSFT_sRGBFactors";class Wb{constructor(M){this.name=ob,this._loader=M,this.enabled=this._loader.isExtensionUsed(ob)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,p,b){return J.LoadExtraAsync(M,p,this.name,(async(Q,q)=>{if(q){if(!(b instanceof a.d))throw new Error(`${Q}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(M,p,b),B=b.RM().getEngine().useExactSrgbConversions;return b.albedoTexture||b.albedoColor.toLinearSpaceToRef(b.albedoColor,B),b.reflectivityTexture||b.reflectivityColor.toLinearSpaceToRef(b.reflectivityColor,B),await q}}))}}c(ob),U(ob,!0,(M=>new Wb(M)));var ib=b(13454);const Ab={};var jb=b(13512),Kb=b(13488),Db=b(13459),ab=b(13477);function sb(M,p){for(const b of M)for(const M of b.dataOutputs)if(M.uniqueId===p)return M;throw new Error("Could not find data out connection with unique id "+p)}function Sb(M,p){for(const b of M)if(b instanceof Kb.e)for(const M of b.signalInputs)if(M.uniqueId===p)return M;throw new Error("Could not find signal in connection with unique id "+p)}async function fb(M,p){const Q=await Promise.all(M.allBlocks.map((async M=>{const p=function(M){switch(M){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([b.e(78),b.e(79)]).then(b.bind(b,14925))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await b.e(80).then(b.bind(b,14929))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await b.e(81).then(b.bind(b,14934))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await b.e(82).then(b.bind(b,14943))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await b.e(83).then(b.bind(b,14952))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await b.e(84).then(b.bind(b,14955))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await b.e(85).then(b.bind(b,14963))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await b.e(86).then(b.bind(b,14968))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await b.e(87).then(b.bind(b,14976))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await b.e(90).then(b.bind(b,15015))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await b.e(90).then(b.bind(b,15015))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await b.e(90).then(b.bind(b,15015))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await b.e(90).then(b.bind(b,15015))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await b.e(95).then(b.bind(b,15020))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await b.e(96).then(b.bind(b,15022))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await b.e(97).then(b.bind(b,15024))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await b.e(98).then(b.bind(b,15027))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await b.e(99).then(b.bind(b,15033))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await b.e(100).then(b.bind(b,15040))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await b.e(101).then(b.bind(b,15046))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await b.e(102).then(b.bind(b,15049))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await b.e(103).then(b.bind(b,15051))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await b.e(104).then(b.bind(b,15055))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await b.e(105).then(b.bind(b,15058))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await b.e(106).then(b.bind(b,15064))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await b.e(107).then(b.bind(b,15069))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await b.e(108).then(b.bind(b,15072))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await b.e(109).then(b.bind(b,15080))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await b.e(110).then(b.bind(b,15083))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await b.e(111).then(b.bind(b,15085))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await b.e(112).then(b.bind(b,15091))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await b.e(113).then(b.bind(b,15094))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await b.e(92).then(b.bind(b,15096))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await b.e(114).then(b.bind(b,15099))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await b.e(115).then(b.bind(b,15106))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await b.e(116).then(b.bind(b,15109))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await b.e(93).then(b.bind(b,15112))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await b.e(88).then(b.bind(b,14979))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await b.e(94).then(b.bind(b,15115))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await b.e(94).then(b.bind(b,15115))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await b.e(94).then(b.bind(b,15115))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await b.e(94).then(b.bind(b,15115))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await b.e(94).then(b.bind(b,15115))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await b.e(94).then(b.bind(b,15115))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await b.e(94).then(b.bind(b,15115))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await b.e(94).then(b.bind(b,15115))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await b.e(89).then(b.bind(b,15008))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await b.e(90).then(b.bind(b,15015))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await b.e(90).then(b.bind(b,15015))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await b.e(91).then(b.bind(b,15118))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await b.e(91).then(b.bind(b,15118))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await b.e(91).then(b.bind(b,15118))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await b.e(91).then(b.bind(b,15118))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await b.e(91).then(b.bind(b,15118))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await b.e(91).then(b.bind(b,15118))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await b.e(117).then(b.bind(b,15122))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await b.e(118).then(b.bind(b,15128))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await b.e(119).then(b.bind(b,15131))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await b.e(120).then(b.bind(b,15138))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await b.e(121).then(b.bind(b,15143))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await b.e(122).then(b.bind(b,15145))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await b.e(123).then(b.bind(b,15150))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await b.e(124).then(b.bind(b,15157))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await b.e(125).then(b.bind(b,15163))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await b.e(126).then(b.bind(b,15165))).FlowGraphDataSwitchBlock;default:if(Ab[M])return Ab[M];throw new Error(`Unknown block name ${M}`)}}(M.className);return await p()})));return function(M,p,b){const Q=p.coordinator.createGraph(),q=[],B=p.valueParseFunction??Db.e;for(let k=0;k<M.allBlocks.length;k++){const u=yb(M.allBlocks[k],{Kp:p.coordinator.config.Kp,pathConverter:p.pathConverter,assetsContainer:p.coordinator.config.Kp,valueParseFunction:B},b[k]);q.push(u),u instanceof jb.e&&Q.addEventBlock(u)}for(const k of q){for(const M of k.dataInputs)for(const p of M.connectedPointIds){const b=sb(q,p);M.connectTo(b)}if(k instanceof Kb.e)for(const M of k.signalOutputs)for(const p of M.connectedPointIds){const b=Sb(q,p);M.connectTo(b)}}for(const k of M.executionContexts)Rb(k,{graph:Q,valueParseFunction:B},M.rightHanded);return Q}(M,p,Q)}function Rb(M,p,b){const Q=p.graph.createContext();M.enableLogging&&(Q.enableLogging=!0),Q.treatDataAsRightHanded=b||!1;const q=p.valueParseFunction??Db.e;Q.uniqueId=M.uniqueId;const B=Q.RM();if(M._assetsContext){var k,u,T,O,H,F,o,W,i,A;const p=M._assetsContext,b={meshes:null===(k=p.meshes)||void 0===k?void 0:k.map((M=>B.getMeshById(M))),lights:null===(u=p.lights)||void 0===u?void 0:u.map((M=>B.getLightByName(M))),cameras:null===(T=p.cameras)||void 0===T?void 0:T.map((M=>B.getCameraByName(M))),materials:null===(O=p.materials)||void 0===O?void 0:O.map((M=>B.getMaterialById(M))),textures:null===(H=p.textures)||void 0===H?void 0:H.map((M=>B.getTextureByName(M))),animations:null===(F=p.animations)||void 0===F?void 0:F.map((M=>B.animations.find((p=>p.name===M)))),skeletons:null===(o=p.skeletons)||void 0===o?void 0:o.map((M=>B.getSkeletonByName(M))),qo:null===(W=p.qo)||void 0===W?void 0:W.map((M=>B.getParticleSystemById(M))),animationGroups:null===(i=p.animationGroups)||void 0===i?void 0:i.map((M=>B.getAnimationGroupByName(M))),transformNodes:null===(A=p.transformNodes)||void 0===A?void 0:A.map((M=>B.getTransformNodeById(M))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ho:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};Q.assetsContext=b}for(const j in M._userVariables){const p=q(j,M._userVariables,Q.assetsContext,B);Q.userVariables[j]=p}for(const j in M._connectionValues){const p=q(j,M._connectionValues,Q.assetsContext,B);Q._setConnectionValueByKey(j,p)}return Q}function yb(M,p,b){const Q={},q=p.valueParseFunction??Db.e;if(M.config)for(const k in M.config)Q[k]=q(k,M.config,p.assetsContainer||p.Kp,p.Kp);if((0,Db.j)(M.className)){if(!p.pathConverter)throw new Error("Path converter is required for this block");Q.pathConverter=p.pathConverter}const B=new b(Q);B.uniqueId=M.uniqueId;for(let k=0;k<M.dataInputs.length;k++){const p=B.getDataInput(M.dataInputs[k].name);if(!p)throw new Error("Could not find data input with name "+M.dataInputs[k].name+" in block "+M.className);p.deserialize(M.dataInputs[k])}for(let k=0;k<M.dataOutputs.length;k++){const p=B.getDataOutput(M.dataOutputs[k].name);if(!p)throw new Error("Could not find data output with name "+M.dataOutputs[k].name+" in block "+M.className);p.deserialize(M.dataOutputs[k])}return B.metadata=M.metadata,B.deserialize&&B.deserialize(M),B}function xb(M){const[p,b]=M.split(":");return Pb({op:p,extension:b})}function Pb(M){var p;let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Q=M.extension?null===(p=Nb[M.extension])||void 0===p?void 0:p[M.op]:rb[M.op];if(!Q&&(A.c.Warn(`No mapping found for operation ${M.op} and extension ${M.extension||"KHR_interactivity"}`),b)){const p={},b={flows:{}};if(M.inputValueSockets){p.values={};for(const b in M.inputValueSockets)p.values[b]={name:b}}return M.outputValueSockets&&(b.values={},Object.keys(M.outputValueSockets).forEach((M=>{b.values[M]={name:M}}))),{RH:[],inputs:p,outputs:b}}return Q}function Lb(M,p,b){Nb[p]||(Nb[p]={}),Nb[p][M]=b}const Nb={BABYLON:{"flow/log":{RH:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},rb={"event/onStart":{RH:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{RH:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{RH:["FlowGraphSendCustomEventBlock"],extraProcessor(M,p,b,Q,q){if("event/send"!==p.op||!M.configuration||1!==Object.keys(M.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const B=M.configuration.event.value[0];if("number"!==typeof B)throw new Error("Event id should be a number");const k=Q.arrays.events[B],u=q[0];return u.config||(u.config={}),u.config.eventId=k.eventId,u.config.eventData=k.eventData,q}},"event/receive":{RH:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(M,p){var b;if(!M.configuration)return A.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const Q=M.configuration.event;if(!Q)return A.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const q=Q.value[0];if("number"!==typeof q)return A.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(b=p.events)||void 0===b?void 0:b[q])?{valid:!0}:(A.c.Error(`Event with id ${q} not found`),{valid:!1,error:`Event with id ${q} not found`})},extraProcessor(M,p,b,Q,q){if("event/receive"!==p.op||!M.configuration||1!==Object.keys(M.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const B=M.configuration.event.value[0];if("number"!==typeof B)throw new Error("Event id should be a number");const k=Q.arrays.events[B],u=q[0];return u.config||(u.config={}),u.config.eventId=k.eventId,u.config.eventData=k.eventData,q}},"math/e":Yb("FlowGraphEBlock"),"math/pi":Yb("FlowGraphPIBlock"),"math/inf":Yb("FlowGraphInfBlock"),"math/nan":Yb("FlowGraphNaNBlock"),"math/abs":Yb("FlowGraphAbsBlock"),"math/sign":Yb("FlowGraphSignBlock"),"math/trunc":Yb("FlowGraphTruncBlock"),"math/floor":Yb("FlowGraphFloorBlock"),"math/ceil":Yb("FlowGraphCeilBlock"),"math/round":{RH:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q){var B;return(B=q[0]).config||(B.config={}),q[0].config.roundHalfAwayFromZero=!0,q}},"math/fract":Yb("FlowGraphFractBlock"),"math/neg":Yb("FlowGraphNegationBlock"),"math/add":Yb("FlowGraphAddBlock",["a","b"],!0),"math/sub":Yb("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{RH:["FlowGraphMultiplyBlock"],extraProcessor(M,p,b,Q,q){var B;(B=q[0]).config||(B.config={}),q[0].config.useMatrixPerComponent=!0,q[0].config.preventIntegerFloatArithmetic=!0;let k=-1;return Object.keys(M.values||{}).find((p=>{var b;return void 0!==(null===(b=M.values)||void 0===b?void 0:b[p].type)&&(k=M.values[p].type,!0)})),-1!==k&&(q[0].config.type=Q.arrays.types[k].flowGraphType),q},validation:M=>M.values?wb(M):{valid:!0}},"math/div":Yb("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Yb("FlowGraphModuloBlock",["a","b"]),"math/min":Yb("FlowGraphMinBlock",["a","b"]),"math/max":Yb("FlowGraphMaxBlock",["a","b"]),"math/clamp":Yb("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Yb("FlowGraphSaturateBlock"),"math/mix":Yb("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Yb("FlowGraphEqualityBlock",["a","b"]),"math/lt":Yb("FlowGraphLessThanBlock",["a","b"]),"math/le":Yb("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Yb("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Yb("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Yb("FlowGraphIsNaNBlock"),"math/isinf":Yb("FlowGraphIsInfBlock"),"math/select":{RH:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{RH:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Yb("FlowGraphSinBlock"),"math/cos":Yb("FlowGraphCosBlock"),"math/tan":Yb("FlowGraphTanBlock"),"math/asin":Yb("FlowGraphASinBlock"),"math/acos":Yb("FlowGraphACosBlock"),"math/atan":Yb("FlowGraphATanBlock"),"math/atan2":Yb("FlowGraphATan2Block",["a","b"]),"math/sinh":Yb("FlowGraphSinhBlock"),"math/cosh":Yb("FlowGraphCoshBlock"),"math/tanh":Yb("FlowGraphTanhBlock"),"math/asinh":Yb("FlowGraphASinhBlock"),"math/acosh":Yb("FlowGraphACoshBlock"),"math/atanh":Yb("FlowGraphATanhBlock"),"math/exp":Yb("FlowGraphExponentialBlock"),"math/log":Yb("FlowGraphLogBlock"),"math/log2":Yb("FlowGraphLog2Block"),"math/log10":Yb("FlowGraphLog10Block"),"math/sqrt":Yb("FlowGraphSquareRootBlock"),"math/cbrt":Yb("FlowGraphCubeRootBlock"),"math/pow":Yb("FlowGraphPowerBlock",["a","b"]),"math/length":Yb("FlowGraphLengthBlock"),"math/normalize":Yb("FlowGraphNormalizeBlock"),"math/dot":Yb("FlowGraphDotBlock",["a","b"]),"math/cross":Yb("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Yb("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Yb("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{RH:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{RH:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{RH:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{RH:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{RH:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{RH:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{RH:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Yb("FlowGraphTransposeBlock"),"math/determinant":Yb("FlowGraphDeterminantBlock"),"math/inverse":Yb("FlowGraphInvertMatrixBlock"),"math/matmul":Yb("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{RH:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ab",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q,B){const k=q[0].dataInputs.find((M=>"rotationQuaternion"===M.name));if(!k)throw new Error("Rotation quaternion input not found");return B._connectionValues[k.uniqueId]&&(B._connectionValues[k.uniqueId].type="Quaternion"),q}},"math/matDecompose":{RH:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ab"}}}},"math/quatConjugate":Yb("FlowGraphConjugateBlock",["a"]),"math/quatMul":{RH:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q){var B;return(B=q[0]).config||(B.config={}),q[0].config.type="Quaternion",q}},"math/quatAngleBetween":Yb("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{RH:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Yb("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Yb("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{RH:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q){var B;return(B=q[0]).config||(B.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract2x2":{RH:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{RH:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q){var B;return(B=q[0]).config||(B.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract3x3":{RH:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{RH:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q){var B;return(B=q[0]).config||(B.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract4x4":{RH:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{RH:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q,B){var k,u;(u=q[0]).config||(u.config={});const T=q[0].dataInputs[0];return q[0].config.valueType=(null===(k=B._connectionValues[T.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",q}},"math/and":{RH:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q,B){var k,u,T;(T=q[0]).config||(T.config={});const O=q[0].dataInputs[0],H=q[0].dataInputs[1];return q[0].config.valueType=(null===(k=B._connectionValues[O.uniqueId])||void 0===k?void 0:k.type)??(null===(u=B._connectionValues[H.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",q}},"math/or":{RH:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q,B){var k,u,T;(T=q[0]).config||(T.config={});const O=q[0].dataInputs[0],H=q[0].dataInputs[1];return q[0].config.valueType=(null===(k=B._connectionValues[O.uniqueId])||void 0===k?void 0:k.type)??(null===(u=B._connectionValues[H.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",q}},"math/xor":{RH:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,p,b,Q,q,B){var k,u,T;(T=q[0]).config||(T.config={});const O=q[0].dataInputs[0],H=q[0].dataInputs[1];return q[0].config.valueType=(null===(k=B._connectionValues[O.uniqueId])||void 0===k?void 0:k.type)??(null===(u=B._connectionValues[H.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",q}},"math/asr":Yb("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Yb("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Yb("FlowGraphLeadingZerosBlock"),"math/ctz":Yb("FlowGraphTrailingZerosBlock"),"math/popcnt":Yb("FlowGraphOneBitsCounterBlock"),"math/rad":Yb("FlowGraphDegToRadBlock"),"math/deg":Yb("FlowGraphRadToDegBlock"),"type/boolToInt":Yb("FlowGraphBooleanToInt"),"type/boolToFloat":Yb("FlowGraphBooleanToFloat"),"type/intToBool":Yb("FlowGraphIntToBoolean"),"type/intToFloat":Yb("FlowGraphIntToFloat"),"type/floatToInt":Yb("FlowGraphFloatToInt"),"type/floatToBool":Yb("FlowGraphFloatToBoolean"),"flow/sequence":{RH:["FlowGraphSequenceBlock"],extraProcessor(M,p,b,Q,q){const B=q[0];return B.config||(B.config={}),B.config.outputSignalCount=Object.keys(M.flows||[]).length,B.signalOutputs.forEach(((M,p)=>{M.name="out_"+p})),q}},"flow/branch":{RH:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{RH:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(M){if(M.configuration&&M.configuration.cases){const p=M.configuration.cases.value;if(!p.every((M=>"number"===typeof M&&/^-?\d+$/.test(M.toString()))))return A.c.Warn("Switch cases should be integers. Using empty array instead."),M.configuration.cases.value=[],{valid:!0};const b=new Set(p);M.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(M,p,b,Q,q){if("flow/switch"!==p.op||!M.flows||0===Object.keys(M.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return q[0].signalOutputs.forEach((M=>{"default"!==M.name&&(M.name="out_"+M.name)})),q}},"flow/while":{RH:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{RH:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(M,p,b,Q,q){const B=q[0];return B.config||(B.config={}),B.config.incrementIndexWhenLoopDone=!0,q}},"flow/doN":{RH:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{RH:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(M,p,b,Q,q){if("flow/multiGate"!==p.op||!M.flows||0===Object.keys(M.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const B=q[0];return B.config||(B.config={}),B.config.outputSignalCount=Object.keys(M.flows).length,B.signalOutputs.forEach(((M,p)=>{M.name="out_"+p})),q}},"flow/waitAll":{RH:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(M){var p,b;return"number"!==typeof(null===(p=M.configuration)||void 0===p||null===(b=p.inputFlows)||void 0===b?void 0:b.value[0])&&(M.configuration=M.configuration||{inputFlows:{value:[0]}},M.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{RH:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{RH:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{RH:["FlowGraphCancelDelayBlock"]},"variable/get":{RH:["FlowGraphGetVariableBlock"],validation(M){var p,b;return null!==(p=M.configuration)&&void 0!==p&&null!==(b=p.variable)&&void 0!==b&&b.value?{valid:!0}:(A.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(M,p)=>[p.getVariableName(M[0])]}}},"variable/set":{RH:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(M,p)=>[p.getVariableName(M[0])]}}},"variable/setMultiple":{RH:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(M,p)=>[M[0].map((M=>p.getVariableName(M)))]}},extraProcessor:(M,p,b,Q,q)=>(q[0].dataInputs.forEach((M=>{M.name=Q.getVariableName(+M.name)})),q)},"variable/interpolate":{RH:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(M,p)=>[p.getVariableName(M[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:M=>!0===M[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",aQ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",aQ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",aQ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",aQ:"FlowGraphPlayAnimationBlock"},out:{name:"out",aQ:"FlowGraphPlayAnimationBlock"},done:{name:"done",aQ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(M,p,b,Q,q){var B,k,u;const T=q[0],O=null===(B=M.configuration)||void 0===B?void 0:B.variable.value[0];if("number"!==typeof O)throw A.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const H=Q.arrays.staticVariables[O];"undefined"===typeof T.config.animationType.value&&(Q.arrays.staticVariables,T.config.animationType.value=(0,ab.J)(H.type));const F=q[4];return F.config||(F.config={}),(k=F.config).variable||(k.variable={}),F.config.variable.value=Q.getVariableName(O),(u=q[3]).config||(u.config={}),q}},"pointer/get":{RH:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",aQ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",aQ:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(M,p,b,Q,q)=>(q.forEach((M=>{"FlowGraphJsonPointerParserBlock"===M.className&&(M.config||(M.config={}),M.config.outputValue=!0)})),q)},"pointer/set":{RH:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",aQ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",aQ:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(M,p,b,Q,q)=>(q.forEach((M=>{"FlowGraphJsonPointerParserBlock"===M.className&&(M.config||(M.config={}),M.config.outputValue=!0)})),q)},"pointer/interpolate":{RH:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",aQ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",aQ:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",aQ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",aQ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",aQ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",aQ:"FlowGraphPlayAnimationBlock"},out:{name:"out",aQ:"FlowGraphPlayAnimationBlock"},done:{name:"done",aQ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(M,p,b,Q,q)=>(q.forEach((p=>{"FlowGraphJsonPointerParserBlock"===p.className?(p.config||(p.config={}),p.config.outputValue=!0):"FlowGraphInterpolationBlock"===p.className&&(p.config||(p.config={}),Object.keys(M.values||[]).forEach((b=>{var q;const B=null===(q=M.values)||void 0===q?void 0:q[b];if("value"===b&&B){const M=B.type;void 0!==M&&(p.config.animationType=Q.arrays.types[M].flowGraphType)}})))})),q)},"animation/start":{RH:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",aQ:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(M,p)=>[M[0]*p._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(M,p)=>[M[0]*p._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(M,p,b,Q,q,B,k){const u=q[q.length-1];return u.config||(u.config={}),u.config.glTF=k,q}},"animation/stop":{RH:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",aQ:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(M,p,b,Q,q,B,k){const u=q[q.length-1];return u.config||(u.config={}),u.config.glTF=k,q}},"animation/stopAt":{RH:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",aQ:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(M,p)=>[M[0]*p._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(M,p,b,Q,q,B,k){const u=q[q.length-1];return u.config||(u.config={}),u.config.glTF=k,q}},"math/switch":{RH:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(M){if(M.configuration&&M.configuration.cases){const p=M.configuration.cases.value;if(!p.every((M=>"number"===typeof M&&/^-?\d+$/.test(M.toString()))))return A.c.Warn("Switch cases should be integers. Using empty array instead."),M.configuration.cases.value=[],{valid:!0};const b=new Set(p);M.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(M,p,b,Q,q){const B=q[0];return B.dataInputs.forEach((M=>{"default"!==M.name&&"case"!==M.name&&(M.name="in_"+M.name)})),B.config||(B.config={}),B.config.treatCasesAsIntegers=!0,q}},"debug/log":{RH:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Yb(M){let p=arguments.length>2?arguments[2]:void 0;return{RH:[M],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((M,p)=>(M[p]={name:p},M)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(M,b,Q,q,B){var k;if(p){(k=B[0]).config||(k.config={}),B[0].config.preventIntegerFloatArithmetic=!0;let p=-1;Object.keys(M.values||{}).find((b=>{var Q;return void 0!==(null===(Q=M.values)||void 0===Q?void 0:Q[b].type)&&(p=M.values[b].type,!0)})),-1!==p&&(B[0].config.type=q.arrays.types[p].flowGraphType)}return B},validation:M=>p?wb(M):{valid:!0}}}function wb(M){if(M.values){const p=Object.keys(M.values).map((p=>M.values[p].type)).filter((M=>void 0!==M));if(!p.every((M=>M===p[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}rb["math/compose"]=rb["math/matCompose"],rb["math/decompose"]=rb["math/matDecompose"];var Eb=b(11764);const nb={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Ap",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class gb{constructor(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=M,this._gltf=p,this._animationTargetFps=b,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const M of this._interactivityGraph.types)this._types.push(nb[M.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const M of this._interactivityGraph.declarations){const p=Pb(M);if(!p)throw A.c.Error(["No mapping found for declaration",M]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:p,fullOperationName:M.extension?M.op+":"+M.extension:M.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const M of this._interactivityGraph.variables){const p=this._parseVariable(M);this._staticVariables.push(p)}}_parseVariable(M,p){const b=this._types[M.type];if(!b)throw A.c.Error(["No type found for variable",M]),new Error("Error parsing variables");if(M.value&&M.value.length!==b.length)throw A.c.Error(["Invalid value length for variable",M,b]),new Error("Error parsing variables");const Q=M.value||[];if(!Q.length)switch(b.flowGraphType){case"boolean":Q.push(!1);break;case"FlowGraphInteger":Q.push(0);break;case"number":Q.push(NaN);break;case"Vector2":Q.push(NaN,NaN);break;case"Ap":Q.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":Q.fill(NaN,0,4);break;case"Matrix":Q.fill(NaN,0,16);break;case"Matrix3D":Q.fill(NaN,0,9)}return"number"===b.elementType&&"string"===typeof Q[0]&&(Q[0]=parseFloat(Q[0])),{type:b.flowGraphType,value:p?p(Q,this):Q}}_parseEvents(){if(this._interactivityGraph.events)for(const M of this._interactivityGraph.events){const p={eventId:M.id||"internalEvent_"+this._internalEventsCounter++};M.values&&(p.eventData=Object.keys(M.values).map((p=>{var b;const Q=null===(b=M.values)||void 0===b?void 0:b[p];if(!Q)throw A.c.Error(["No value found for event key",p]),new Error("Error parsing events");const q=this._types[Q.type];if(!q)throw A.c.Error(["No type found for event value",Q]),new Error("Error parsing events");const B="undefined"!==typeof Q.value?this._parseVariable(Q):void 0;return{id:p,type:q.flowGraphType,eventData:!0,value:B}}))),this._events.push(p)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const p of this._interactivityGraph.nodes){if("number"!==typeof p.declaration)throw A.c.Error(["No declaration found for node",p]),new Error("Error parsing nodes");const b=this._mappings[p.declaration];if(!b)throw A.c.Error(["No mapping found for node",p]),new Error("Error parsing nodes");if(b.flowGraphMapping.validation){const Q=b.flowGraphMapping.validation(p,this._interactivityGraph,this._gltf);var M;if(!Q.valid)throw new Error(`Error validating interactivity node ${null===(M=this._interactivityGraph.declarations)||void 0===M?void 0:M[p.declaration].op} - ${Q.error}`)}const Q=[];for(const M of b.flowGraphMapping.RH){const q=this._getEmptyBlock(M,b.fullOperationName);this._parseNodeConfiguration(p,q,b.flowGraphMapping,M),Q.push(q)}this._nodes.push({RH:Q,fullOperationName:b.fullOperationName})}}_getEmptyBlock(M,p){return{uniqueId:(0,Eb.c)(),className:M,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:p,metadata:{}}}_parseNodeConfiguration(M,p,b,Q){const q=p.config;if(M.configuration){const p=Object.keys(M.configuration);for(const u of p){var B,k;const p=null===(B=M.configuration)||void 0===B?void 0:B[u];if(!p)throw A.c.Error(["No value found for node configuration",u]),new Error("Error parsing node configuration");const T=null===(k=b.configuration)||void 0===k?void 0:k[u];if(T&&T.aQ?T.aQ===Q:0===b.RH.indexOf(Q)){const M=(null===T||void 0===T?void 0:T.name)||u;p&&"undefined"!==typeof p.value||"undefined"===typeof(null===T||void 0===T?void 0:T.defaultValue)?p.value.length>=0?q[M]={value:1===p.value.length?p.value[0]:p.value}:A.c.Warn(["Invalid value for node configuration",p]):q[M]={value:T.defaultValue},T&&T.dataTransformer&&(q[M].value=T.dataTransformer([q[M].value],this)[0])}}}}_parseNodeConnections(M){for(let f=0;f<this._nodes.length;f++){var p;const R=null===(p=this._interactivityGraph.nodes)||void 0===p?void 0:p[f];if(!R)throw A.c.Error(["No node found for interactivity node",this._nodes[f]]),new Error("Error parsing node connections");const y=this._nodes[f],x=this._mappings[R.declaration];if(!x)throw A.c.Error(["No mapping found for node",R]),new Error("Error parsing node connections");const P=R.flows||{},L=Object.keys(P).sort();for(const M of L){var b,Q,q,B;const p=P[M],O=null===(b=x.flowGraphMapping.outputs)||void 0===b||null===(Q=b.flows)||void 0===Q?void 0:Q[M],H=(null===O||void 0===O?void 0:O.name)||M,F=this._createNewSocketConnection(H,!0);(O&&O.aQ&&y.RH.find((M=>M.className===O.aQ))||y.RH[0]).signalOutputs.push(F);const o=p.node,W=this._nodes[o];if(!W)throw A.c.Error(["No node found for input node id",o]),new Error("Error parsing node connections");const i=xb(W.fullOperationName);if(!i)throw A.c.Error(["No mapping found for input node",W]),new Error("Error parsing node connections");let j=null===(q=i.inputs)||void 0===q||null===(B=q.flows)||void 0===B?void 0:B[p.socket||"in"],K=!1;if(!j)for(const M in null===(k=i.inputs)||void 0===k?void 0:k.flows){var k,u,T;if(M.startsWith("[")&&M.endsWith("]"))K=!0,j=null===(u=i.inputs)||void 0===u||null===(T=u.flows)||void 0===T?void 0:T[M]}const D=j?K?j.name.replace("$1",p.socket||""):j.name:p.socket||"in",a=j&&j.aQ&&W.RH.find((M=>M.className===j.aQ))||W.RH[0];let s=a.signalInputs.find((M=>M.name===D));s||(s=this._createNewSocketConnection(D),a.signalInputs.push(s)),s.connectedPointIds.push(F.uniqueId),F.connectedPointIds.push(s.uniqueId)}const N=R.values||{},r=Object.keys(N);for(const p of r){var O,H;const b=N[p];let Q=null===(O=x.flowGraphMapping.inputs)||void 0===O||null===(H=O.values)||void 0===H?void 0:H[p],q=!1;if(!Q)for(const M in null===(F=x.flowGraphMapping.inputs)||void 0===F?void 0:F.values){var F,o,W;if(M.startsWith("[")&&M.endsWith("]"))q=!0,Q=null===(o=x.flowGraphMapping.inputs)||void 0===o||null===(W=o.values)||void 0===W?void 0:W[M]}const B=Q?q?Q.name.replace("$1",p):Q.name:p,k=this._createNewSocketConnection(B);if((Q&&Q.aQ&&y.RH.find((M=>M.className===Q.aQ))||y.RH[0]).dataInputs.push(k),void 0!==b.value){const p=this._parseVariable(b,Q&&Q.dataTransformer);M._connectionValues[k.uniqueId]=p}else{if("undefined"===typeof b.node)throw A.c.Error(["Invalid value for value connection",b]),new Error("Error parsing node connections");{var i,j,K;const M=b.node,p=b.socket||"value",Q=this._nodes[M];if(!Q)throw A.c.Error(["No node found for output socket reference",b]),new Error("Error parsing node connections");const q=xb(Q.fullOperationName);if(!q)throw A.c.Error(["No mapping found for output socket reference",b]),new Error("Error parsing node connections");let B=null===(i=q.outputs)||void 0===i||null===(j=i.values)||void 0===j?void 0:j[p],u=!1;if(!B)for(const b in null===(D=q.outputs)||void 0===D?void 0:D.values){var D,a,s;if(b.startsWith("[")&&b.endsWith("]"))u=!0,B=null===(a=q.outputs)||void 0===a||null===(s=a.values)||void 0===s?void 0:s[b]}const T=B?u?B.name.replace("$1",p):null===(K=B)||void 0===K?void 0:K.name:p,O=B&&B.aQ&&Q.RH.find((M=>M.className===B.aQ))||Q.RH[0];let H=O.dataOutputs.find((M=>M.name===T));H||(H=this._createNewSocketConnection(T,!0),O.dataOutputs.push(H)),k.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(k.uniqueId)}}}if(x.flowGraphMapping.interBlockConnectors)for(const M of x.flowGraphMapping.interBlockConnectors){const p=M.input,b=M.output,Q=M.isVariable;this._connectFlowGraphNodes(p,b,y.RH[M.inputBlockIndex],y.RH[M.outputBlockIndex],Q)}if(x.flowGraphMapping.extraProcessor){var S;const p=null===(S=this._interactivityGraph.declarations)||void 0===S?void 0:S[R.declaration];if(!p)throw A.c.Error(["No declaration found for extra processor",R]),new Error("Error parsing node connections");y.RH=x.flowGraphMapping.extraProcessor(R,p,x.flowGraphMapping,this,y.RH,M,this._gltf)}}}_createNewSocketConnection(M,p){return{uniqueId:(0,Eb.c)(),name:M,_connectionType:p?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(M,p,b,Q,q){const B=q?b.dataInputs:b.signalInputs,k=q?Q.dataOutputs:Q.signalOutputs,u=B.find((p=>p.name===M))||this._createNewSocketConnection(M),T=k.find((M=>M.name===p))||this._createNewSocketConnection(p,!0);B.find((p=>p.name===M))||B.push(u),k.find((M=>M.name===p))||k.push(T),u.connectedPointIds.push(T.uniqueId),T.connectedPointIds.push(u.uniqueId)}getVariableName(M){return"staticVariable_"+M}serializeToFlowGraph(){const M={uniqueId:(0,Eb.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(M);for(let p=0;p<this._staticVariables.length;p++){const b=this._staticVariables[p];M._userVariables[this.getVariableName(p)]=b}return{rightHanded:!0,allBlocks:this._nodes.reduce(((M,p)=>M.concat(p.RH)),[]),executionContexts:[M]}}}const Ub="KHR_interactivity";class cb{constructor(M){this._loader=M,this.name=Ub,this.enabled=this._loader.isExtensionUsed(Ub),this._pathConverter=(0,d.g)(this._loader.Bb),M._skipStartAnimationStep=!0;const p=M.babylonScene;p&&function(M){(0,d.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!M.activeCamera)return new q.Quaternion(NaN,NaN,NaN,NaN);const p=q.Quaternion.FromRotationMatrix(M.activeCamera.getWorldMatrix()).normalize();return M.useRightHandedSystem||(p.w*=-1,p.x*=-1),p},type:"Quaternion",getTarget:()=>M.activeCamera}),(0,d.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!M.activeCamera)return new q.Ap(NaN,NaN,NaN);const p=M.activeCamera.getWorldMatrix().getTranslation();return M.useRightHandedSystem||(p.x*=-1),p},type:"Ap",getTarget:()=>M.activeCamera}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:M=>{var p;return(null===(p=M._babylonAnimationGroup)||void 0===p?void 0:p.isPlaying)??!1},type:"boolean",getTarget:M=>M._babylonAnimationGroup}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:M=>{var p;return((null===(p=M._babylonAnimationGroup)||void 0===p?void 0:p.from)??0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:M=>{var p;return((null===(p=M._babylonAnimationGroup)||void 0===p?void 0:p.to)??0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:M=>{var p;return((null===(p=M._babylonAnimationGroup)||void 0===p?void 0:p.getCurrentFrame())??0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup}),(0,d.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:M=>{var p;return((null===(p=M._babylonAnimationGroup)||void 0===p?void 0:p.getCurrentFrame())??0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup})}(p)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var M;if(!this._loader.babylonScene||!this._pathConverter)return;const p=this._loader.babylonScene,b=null===(M=this._loader.Bb.extensions)||void 0===M?void 0:M.KHR_interactivity;if(!b)return;const Q=new ib.c({Kp:p});Q.dispatchEventsSynchronously=!1;const q=b.graphs.map((M=>new gb(M,this._loader.Bb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(q.map((async M=>await fb(M,{coordinator:Q,pathConverter:this._pathConverter})))),Q.start()}}var db;db=async()=>(await Promise.resolve().then(b.bind(b,13529))).FlowGraphGLTFDataProvider,Ab[`${Ub}/${"FlowGraphGLTFDataProvider"}`]=db,c(Ub),U(Ub,!0,(M=>new cb(M)));const Vb="KHR_node_visibility";(0,d.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:M=>{const p=M._babylonTransformNode;return!p||void 0===p.isVisible||p.isVisible},set:(M,p)=>{var b,Q;null===(b=p._primitiveBabylonMeshes)||void 0===b||b.forEach((M=>{M.inheritVisibility=!0})),p._babylonTransformNode&&(p._babylonTransformNode.isVisible=M),null===(Q=p._primitiveBabylonMeshes)||void 0===Q||Q.forEach((p=>{p.isVisible=M}))},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class hb{constructor(M){this.name=Vb,this._loader=M,this.enabled=M.isExtensionUsed(Vb)}async onReady(){var M;null===(M=this._loader.Bb.nodes)||void 0===M||M.forEach((M=>{var p,b,Q,q;(null===(p=M._primitiveBabylonMeshes)||void 0===p||p.forEach((M=>{M.inheritVisibility=!0})),null!==(b=M.extensions)&&void 0!==b&&b.KHR_node_visibility)&&(!1===(null===(Q=M.extensions)||void 0===Q?void 0:Q.KHR_node_visibility.visible)&&(M._babylonTransformNode&&(M._babylonTransformNode.isVisible=!1),null===(q=M._primitiveBabylonMeshes)||void 0===q||q.forEach((M=>{M.isVisible=!1}))))}))}dispose(){this._loader=null}}c(Vb),U(Vb,!0,(M=>new hb(M)));const Ib="KHR_node_selectability";Lb("event/onSelect",Ib,{RH:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",aQ:"FlowGraphGetVariableBlock",dataTransformer:M=>["pickedMesh_"+M[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",aQ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(M,p,b,Q,q,B,k){var u,T,O,H,F,o;const W=q[q.length-1];W.config=W.config||{},W.config.glTF=k;const i=null===(u=M.configuration)||void 0===u||null===(T=u.nodeIndex)||void 0===T?void 0:T.value[0];if(void 0===i||"number"!==typeof i)throw new Error("nodeIndex not found in configuration");const A="pickedMesh_"+i;return q[1].config.variable=A,B._userVariables[A]={className:"Mesh",id:null===k||void 0===k||null===(O=k.nodes)||void 0===O||null===(H=O[i]._babylonTransformNode)||void 0===H?void 0:H.id,uniqueId:null===k||void 0===k||null===(F=k.nodes)||void 0===F||null===(o=F[i]._babylonTransformNode)||void 0===o?void 0:o.uniqueId},q}}),(0,d.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:M=>{const p=M._babylonTransformNode;return!p||void 0===p.GT||p.GT},set:(M,p)=>{var b;null===(b=p._primitiveBabylonMeshes)||void 0===b||b.forEach((p=>{p.GT=M}))},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"GT"],type:"boolean"});class Zb{constructor(M){this.name=Ib,this._loader=M,this.enabled=M.isExtensionUsed(Ib)}async onReady(){var M;null===(M=this._loader.Bb.nodes)||void 0===M||M.forEach((M=>{var p,b,Q;null!==(p=M.extensions)&&void 0!==p&&p.KHR_node_selectability&&!1===(null===(b=M.extensions)||void 0===b?void 0:b.KHR_node_selectability.selectable)&&(null===(Q=M._babylonTransformNode)||void 0===Q||Q.getChildMeshes().forEach((M=>{M.GT=!1})))}))}dispose(){this._loader=null}}c(Ib),U(Ib,!0,(M=>new Zb(M)));const Jb="KHR_node_hoverability",vb="targetMeshPointerOver_";Lb("event/onHoverIn",Jb,{RH:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",aQ:"FlowGraphGetVariableBlock",dataTransformer:M=>[vb+M[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",aQ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(M,p,b,Q,q,B,k){var u,T,O,H,F,o;const W=q[q.length-1];W.config=W.config||{},W.config.glTF=k;const i=null===(u=M.configuration)||void 0===u||null===(T=u.nodeIndex)||void 0===T?void 0:T.value[0];if(void 0===i||"number"!==typeof i)throw new Error("nodeIndex not found in configuration");const A=vb+i;return q[1].config.variable=A,B._userVariables[A]={className:"Mesh",id:null===k||void 0===k||null===(O=k.nodes)||void 0===O||null===(H=O[i]._babylonTransformNode)||void 0===H?void 0:H.id,uniqueId:null===k||void 0===k||null===(F=k.nodes)||void 0===F||null===(o=F[i]._babylonTransformNode)||void 0===o?void 0:o.uniqueId},q}});const zb="targetMeshPointerOut_";Lb("event/onHoverOut",Jb,{RH:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",aQ:"FlowGraphGetVariableBlock",dataTransformer:M=>[zb+M[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",aQ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(M,p,b,Q,q,B,k){var u,T,O,H,F,o;const W=q[q.length-1];W.config=W.config||{},W.config.glTF=k;const i=null===(u=M.configuration)||void 0===u||null===(T=u.nodeIndex)||void 0===T?void 0:T.value[0];if(void 0===i||"number"!==typeof i)throw new Error("nodeIndex not found in configuration");const A=zb+i;return q[1].config.variable=A,B._userVariables[A]={className:"Mesh",id:null===k||void 0===k||null===(O=k.nodes)||void 0===O||null===(H=O[i]._babylonTransformNode)||void 0===H?void 0:H.id,uniqueId:null===k||void 0===k||null===(F=k.nodes)||void 0===F||null===(o=F[i]._babylonTransformNode)||void 0===o?void 0:o.uniqueId},q}}),(0,d.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:M=>{const p=M._babylonTransformNode;return!p||void 0===p.pointerOverDisableMeshTesting||p.pointerOverDisableMeshTesting},set:(M,p)=>{var b;null===(b=p._primitiveBabylonMeshes)||void 0===b||b.forEach((p=>{p.pointerOverDisableMeshTesting=!M}))},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class tb{constructor(M){this.name=Jb,this._loader=M,this.enabled=M.isExtensionUsed(Jb)}async onReady(){var M;null===(M=this._loader.Bb.nodes)||void 0===M||M.forEach((M=>{var p,b,Q;null!==(p=M.extensions)&&void 0!==p&&p.KHR_node_hoverability&&!1===(null===(b=M.extensions)||void 0===b?void 0:b.KHR_node_hoverability.hoverable)&&(null===(Q=M._babylonTransformNode)||void 0===Q||Q.getChildMeshes().forEach((M=>{M.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}c(Jb),U(Jb,!0,(M=>new tb(M)));const eb="ExtrasAsMetadata";class Gb{_assignExtras(M,p){if(p.extras&&Object.keys(p.extras).length>0){const b=M.metadata=M.metadata||{};(b.Bb=b.Bb||{}).extras=p.extras}}constructor(M){this.name=eb,this.enabled=!0,this._loader=M}dispose(){this._loader=null}loadNodeAsync(M,p,b){return this._loader.loadNodeAsync(M,p,(M=>{this._assignExtras(M,p),b(M)}))}loadCameraAsync(M,p,b){return this._loader.loadCameraAsync(M,p,(M=>{this._assignExtras(M,p),b(M)}))}createMaterial(M,p,b){const Q=this._loader.createMaterial(M,p,b);return this._assignExtras(Q,p),Q}}c(eb),U(eb,!1,(M=>new Gb(M)));b(13529)},13393:(M,p,b)=>{"use strict";b.d(p,{c:()=>w,e:()=>x,g:()=>y,h:()=>P});var Q=b(11624),q=b(11621),B=b(13026),k=b(12257),u=b(12231),T=b(12242),O=b(11637),H=b(11664),F=b(12255),o=b(12349),W=b(12262),i=b(11829);class A{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.qo=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ho=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(M){this._environmentTexture=M}getNodes(){let M=[];M=M.concat(this.meshes),M=M.concat(this.lights),M=M.concat(this.cameras),M=M.concat(this.transformNodes);for(const p of this.skeletons)M=M.concat(p.bones);return M}}class j extends A{}class K{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const M=this.rootNodes;for(const Q of M)Q.dispose();M.length=0;const p=this.skeletons;for(const Q of p)Q.dispose();p.length=0;const b=this.animationGroups;for(const Q of b)Q.dispose();b.length=0}}class D extends A{constructor(M){super(),this._wasAddedToScene=!1,(M=M||H.c.LastCreatedScene)&&(this.Kp=M,this.proceduralTextures=[],M.bb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=M.getEngine().onContextRestoredObservable.add((()=>{for(const M of this.geometries)M._rebuild();for(const M of this.meshes)M._rebuild();for(const M of this.qo)M.rebuild();for(const M of this.textures)M._rebuild()})))}_topologicalSort(M){const p=new Map;for(const k of M)p.set(k.uniqueId,k);const b={dependsOn:new Map,dependedBy:new Map};for(const k of M){const M=k.uniqueId;b.dependsOn.set(M,new Set),b.dependedBy.set(M,new Set)}for(const k of M){const M=k.uniqueId,Q=b.dependsOn.get(M);if(k instanceof F.d){const q=k.sourceMesh;p.has(q.uniqueId)&&(Q.add(q.uniqueId),b.dependedBy.get(q.uniqueId).add(M))}const q=b.dependedBy.get(M);for(const B of k.getDescendants()){const Q=B.uniqueId;if(p.has(Q)){q.add(Q);b.dependsOn.get(Q).add(M)}}}const Q=[],q=[];for(const k of M){const M=k.uniqueId;0===b.dependsOn.get(M).size&&(q.push(k),p.delete(M))}const B=q;for(;B.length>0;){const M=B.shift();Q.push(M);const q=b.dependedBy.get(M.uniqueId);for(const Q of Array.from(q.values())){const q=b.dependsOn.get(Q);q.delete(M.uniqueId),0===q.size&&p.get(Q)&&(B.push(p.get(Q)),p.delete(Q))}}return p.size>0&&(O.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),p.forEach((M=>{O.c.Error(M.name)}))),Q}_addNodeAndDescendantsToList(M,p,b,Q){if(b&&(!Q||Q(b))&&!p.has(b.uniqueId)){M.push(b),p.add(b.uniqueId);for(const q of b.getDescendants(!0))this._addNodeAndDescendantsToList(M,p,q,Q)}}_isNodeInContainer(M){return M instanceof T.b&&-1!==this.meshes.indexOf(M)||(M instanceof u.c&&-1!==this.transformNodes.indexOf(M)||(M instanceof o.e&&-1!==this.lights.indexOf(M)||M instanceof W.b&&-1!==this.cameras.indexOf(M)))}_isValidHierarchy(){for(const M of this.meshes)if(M.parent&&!this._isNodeInContainer(M.parent))return O.c.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;for(const M of this.transformNodes)if(M.parent&&!this._isNodeInContainer(M.parent))return O.c.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;for(const M of this.lights)if(M.parent&&!this._isNodeInContainer(M.parent))return O.c.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;for(const M of this.cameras)if(M.parent&&!this._isNodeInContainer(M.parent))return O.c.Warn(`Node ${M.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(M){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const Q={},B={},u=new K,T=[],O=[],H={doNotInstantiate:!0,...b},F=[],o=new Set;for(const q of this.transformNodes)null===q.parent&&this._addNodeAndDescendantsToList(F,o,q,H.predicate);for(const q of this.meshes)null===q.parent&&this._addNodeAndDescendantsToList(F,o,q,H.predicate);const W=this._topologicalSort(F),i=(b,q)=>{if(((p,b)=>{if(Q[p.uniqueId]=b.uniqueId,B[b.uniqueId]=b,M&&(b.name=M(p.name)),b instanceof k.d){const M=b;if(M.morphTargetManager){const b=p.morphTargetManager;M.morphTargetManager=b.clone();for(let p=0;p<b.numTargets;p++){const q=b.getTarget(p),k=M.morphTargetManager.getTarget(p);Q[q.uniqueId]=k.uniqueId,B[k.uniqueId]=k}}}})(b,q),b.parent){const M=Q[b.parent.uniqueId],p=B[M];q.parent=p||b.parent}if(q.position&&b.position&&q.position.B(b.position),q.rotationQuaternion&&b.rotationQuaternion&&q.rotationQuaternion.B(b.rotationQuaternion),q.rotation&&b.rotation&&q.rotation.B(b.rotation),q.ab&&b.ab&&q.ab.B(b.ab),q.material){const k=q;if(k.material)if(p){const p=b.material;if(-1===O.indexOf(p)){let b=p.clone(M?M(p.name):"Clone of "+p.name);if(O.push(p),Q[p.uniqueId]=b.uniqueId,B[b.uniqueId]=b,"MultiMaterial"===p.getClassName()){const q=p;for(const p of q.fb)p&&(b=p.clone(M?M(p.name):"Clone of "+p.name),O.push(p),Q[p.uniqueId]=b.uniqueId,B[b.uniqueId]=b);q.fb=q.fb.map((M=>M&&B[Q[M.uniqueId]]))}}"InstancedMesh"!==k.getClassName()&&(k.material=B[Q[p.uniqueId]])}else"MultiMaterial"===k.material.getClassName()?-1===this.Kp.multiMaterials.indexOf(k.material)&&this.Kp.addMultiMaterial(k.material):-1===this.Kp.materials.indexOf(k.material)&&this.Kp.addMaterial(k.material)}null===q.parent&&u.rootNodes.push(q)};for(const q of W)if("InstancedMesh"===q.getClassName()){const M=q,p=M.sourceMesh,b=Q[p.uniqueId];i(M,("number"===typeof b?B[b]:p).createInstance(M.name))}else{let M=!0;"Yb"===q.getClassName()||"Node"===q.getClassName()||q.skeleton||!q.getTotalVertices||0===q.getTotalVertices()?M=!1:H.doNotInstantiate&&(M="function"===typeof H.doNotInstantiate?!H.doNotInstantiate(q):!H.doNotInstantiate);const p=M?q.createInstance(`instance of ${q.name}`):q.clone(`Clone of ${q.name}`,null,!0);if(!p)throw new Error(`Could not clone or instantiate node on Asset Container ${q.name}`);i(q,p)}for(const q of this.skeletons){if(H.predicate&&!H.predicate(q))continue;const p=q.clone(M?M(q.name):"Clone of "+q.name);for(const M of this.meshes)if(M.skeleton===q&&!M.isAnInstance){const b=B[Q[M.uniqueId]];if(!b||b.isAnInstance)continue;if(b.skeleton=p,-1!==T.indexOf(p))continue;T.push(p);for(const M of p.bones)M._linkedTransformNode&&(M._linkedTransformNode=B[Q[M._linkedTransformNode.uniqueId]])}u.skeletons.push(p)}for(const q of this.animationGroups){if(H.predicate&&!H.predicate(q))continue;const p=q.clone(M?M(q.name):"Clone of "+q.name,(M=>B[Q[M.uniqueId]]||M));u.animationGroups.push(p)}return u}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Kp.environmentTexture=this.environmentTexture);for(const M of this.Kp._serializableComponents)M.addFromContainer(this);this.Kp.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const p=[];for(const b of this.cameras)M&&!M(b)||(this.Kp.addCamera(b),p.push(b));for(const b of this.lights)M&&!M(b)||(this.Kp.addLight(b),p.push(b));for(const b of this.meshes)M&&!M(b)||(this.Kp.FH(b),p.push(b));for(const b of this.skeletons)M&&!M(b)||this.Kp.addSkeleton(b);for(const b of this.animations)M&&!M(b)||this.Kp.addAnimation(b);for(const b of this.animationGroups)M&&!M(b)||this.Kp.addAnimationGroup(b);for(const b of this.multiMaterials)M&&!M(b)||this.Kp.addMultiMaterial(b);for(const b of this.materials)M&&!M(b)||this.Kp.addMaterial(b);for(const b of this.morphTargetManagers)M&&!M(b)||this.Kp.addMorphTargetManager(b);for(const b of this.geometries)M&&!M(b)||this.Kp.addGeometry(b);for(const b of this.transformNodes)M&&!M(b)||(this.Kp.addTransformNode(b),p.push(b));for(const b of this.actionManagers)M&&!M(b)||this.Kp.addActionManager(b);for(const b of this.textures)M&&!M(b)||this.Kp.addTexture(b);for(const b of this.reflectionProbes)M&&!M(b)||this.Kp.addReflectionProbe(b);for(const b of p)b.parent&&-1===this.Kp.getNodes().indexOf(b.parent)&&(b.setParent?b.setParent(null):b.parent=null)}removeAllFromScene(){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Kp.environmentTexture&&(this.Kp.environmentTexture=null);for(const M of this.Kp._serializableComponents)M.removeFromContainer(this)}removeFromScene(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const p of this.cameras)M&&!M(p)||this.Kp.removeCamera(p);for(const p of this.lights)M&&!M(p)||this.Kp.removeLight(p);for(const p of this.meshes)M&&!M(p)||this.Kp.HH(p,!0);for(const p of this.skeletons)M&&!M(p)||this.Kp.removeSkeleton(p);for(const p of this.animations)M&&!M(p)||this.Kp.removeAnimation(p);for(const p of this.animationGroups)M&&!M(p)||this.Kp.removeAnimationGroup(p);for(const p of this.multiMaterials)M&&!M(p)||this.Kp.removeMultiMaterial(p);for(const p of this.materials)M&&!M(p)||this.Kp.removeMaterial(p);for(const p of this.morphTargetManagers)M&&!M(p)||this.Kp.removeMorphTargetManager(p);for(const p of this.geometries)M&&!M(p)||this.Kp.removeGeometry(p);for(const p of this.transformNodes)M&&!M(p)||this.Kp.removeTransformNode(p);for(const p of this.actionManagers)M&&!M(p)||this.Kp.removeActionManager(p);for(const p of this.textures)M&&!M(p)||this.Kp.removeTexture(p);for(const p of this.reflectionProbes)M&&!M(p)||this.Kp.removeReflectionProbe(p)}dispose(){const M=this.cameras.slice(0);for(const W of M)W.dispose();this.cameras.length=0;const p=this.lights.slice(0);for(const W of p)W.dispose();this.lights.length=0;const b=this.meshes.slice(0);for(const W of b)W.dispose();this.meshes.length=0;const Q=this.skeletons.slice(0);for(const W of Q)W.dispose();this.skeletons.length=0;const q=this.animationGroups.slice(0);for(const W of q)W.dispose();this.animationGroups.length=0;const B=this.multiMaterials.slice(0);for(const W of B)W.dispose();this.multiMaterials.length=0;const k=this.materials.slice(0);for(const W of k)W.dispose();this.materials.length=0;const u=this.geometries.slice(0);for(const W of u)W.dispose();this.geometries.length=0;const T=this.transformNodes.slice(0);for(const W of T)W.dispose();this.transformNodes.length=0;const O=this.actionManagers.slice(0);for(const W of O)W.dispose();this.actionManagers.length=0;const H=this.textures.slice(0);for(const W of H)W.dispose();this.textures.length=0;const F=this.reflectionProbes.slice(0);for(const W of F)W.dispose();this.reflectionProbes.length=0;const o=this.morphTargetManagers.slice(0);for(const W of o)W.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const W of this.Kp._serializableComponents)W.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Kp.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(M,p,b){if(M&&p)for(const Q of M){let M=!0;if(b)for(const p of b)if(Q===p){M=!1;break}M&&(p.push(Q),Q._parentContainer=this)}}moveAllFromScene(M){this._wasAddedToScene=!1,void 0===M&&(M=new j);for(const p in this)Object.prototype.hasOwnProperty.call(this,p)&&(this[p]=this[p]||("_environmentTexture"===p?null:[]),this._moveAssets(this.Kp[p],this[p],M[p]));this.environmentTexture=this.Kp.environmentTexture,this.removeAllFromScene()}createRootMesh(){const M=new k.d("assetContainerRootMesh",this.Kp);for(const p of this.meshes)p.parent||M.addChild(p);return this.meshes.unshift(M),M}mergeAnimationsTo(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.c.LastCreatedScene,p=arguments.length>1?arguments[1]:void 0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!M)return O.c.Error("No scene available to merge animations to"),[];const Q=b||(p=>{let b=null;const Q=p.animations.length?p.animations[0].targetProperty:"",q=p.name.split(".").join("").split("_primitive")[0];switch(Q){case"position":case"rotationQuaternion":b=M.getTransformNodeByName(p.name)||M.getTransformNodeByName(q);break;case"influence":b=M.getMorphTargetByName(p.name)||M.getMorphTargetByName(q);break;default:b=M.getNodeByName(p.name)||M.getNodeByName(q)}return b}),q=this.getNodes();for(const u of q){const M=Q(u);if(null!==M){for(const p of u.animations){const b=M.animations.filter((M=>M.targetProperty===p.targetProperty));for(const p of b){const b=M.animations.indexOf(p,0);b>-1&&M.animations.splice(b,1)}}M.animations=M.animations.concat(u.animations)}}const B=[],k=this.animationGroups.slice();for(const u of k){B.push(u.clone(u.name,Q));for(const M of u.animatables)M.stop()}for(const u of p){const p=Q(u.target);p&&(M.beginAnimation(p,u.fromFrame,u.toFrame,u.loopAnimation,u.speedRatio,u.onAnimationEnd?u.onAnimationEnd:void 0,void 0,!0,void 0,u.onAnimationLoop?u.onAnimationLoop:void 0),M.stopAnimation(u.target))}return B}populateRootNodes(){this.rootNodes.length=0;for(const M of this.meshes)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M);for(const M of this.transformNodes)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M);for(const M of this.lights)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M);for(const M of this.cameras)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M)}addAllAssetsToContainer(M){if(!M)return;const p=[],b=new Set;for(p.push(M);p.length>0;){const M=p.pop();if(M instanceof k.d?(M.Ab&&-1===this.geometries.indexOf(M.Ab)&&this.geometries.push(M.Ab),this.meshes.push(M)):M instanceof F.d?this.meshes.push(M):M instanceof u.c?this.transformNodes.push(M):M instanceof o.e?this.lights.push(M):M instanceof W.b&&this.cameras.push(M),M instanceof T.b){if(M.material&&-1===this.materials.indexOf(M.material)){this.materials.push(M.material);for(const p of M.material.getActiveTextures())-1===this.textures.indexOf(p)&&this.textures.push(p)}M.skeleton&&-1===this.skeletons.indexOf(M.skeleton)&&this.skeletons.push(M.skeleton),M.morphTargetManager&&-1===this.morphTargetManagers.indexOf(M.morphTargetManager)&&this.morphTargetManagers.push(M.morphTargetManager)}for(const Q of M.getChildren())b.has(Q)||p.push(Q);b.add(M)}this.populateRootNodes()}_getByTags(M,p,b){if(void 0===p)return M;const Q=[];for(const q in M){const B=M[q];i.c&&i.c.MatchesQuery(B,p)&&(!b||b(B))&&Q.push(B)}return Q}getMeshesByTags(M,p){return this._getByTags(this.meshes,M,p)}getCamerasByTags(M,p){return this._getByTags(this.cameras,M,p)}getLightsByTags(M,p){return this._getByTags(this.lights,M,p)}getMaterialsByTags(M,p){return this._getByTags(this.materials,M,p).concat(this._getByTags(this.multiMaterials,M,p))}getTransformNodesByTags(M,p){return this._getByTags(this.transformNodes,M,p)}}var a=b(11678);class s{constructor(M){this.byteOffset=0,this.buffer=M}async loadAsync(M){const p=await this.buffer.readAsync(this.byteOffset,M);this._dataView=new DataView(p.buffer,p.byteOffset,p.byteLength),this._dataByteOffset=0}readUint32(){const M=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,M}readUint8Array(M){const p=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,M);return this._dataByteOffset+=M,this.byteOffset+=M,p}readString(M){return(0,a.g)(this.readUint8Array(M))}skipBytes(M){this._dataByteOffset+=M,this.byteOffset+=M}}var S=b(13399);const f="Z2xURg",R={name:"Bb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:M=>-1!==M.indexOf("asset")&&-1!==M.indexOf("version")||M.startsWith("data:base64,"+f)||M.startsWith("data:;base64,"+f)||M.startsWith("data:application/octet-stream;base64,"+f)||M.startsWith("data:model/gltf-binary;base64,"+f)};var y,x,P,L=b(11671),N=b(11673);function r(M,p,b){try{return Promise.resolve(new Uint8Array(M,p,b))}catch(Q){return Promise.reject(Q)}}!function(M){M[M.AUTO=0]="AUTO",M[M.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(y||(y={})),function(M){M[M.NONE=0]="NONE",M[M.FIRST=1]="FIRST",M[M.ALL=2]="ALL"}(x||(x={})),function(M){M[M.LOADING=0]="LOADING",M[M.READY=1]="READY",M[M.COMPLETE=2]="COMPLETE"}(P||(P={}));class Y{constructor(){this.coordinateSystemMode=y.AUTO,this.animationStartMode=x.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=M=>Promise.resolve(M),this.extensionOptions={}}B(M){M&&(this.onParsed=M.onParsed,this.coordinateSystemMode=M.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=M.animationStartMode??this.animationStartMode,this.loadNodeAnimations=M.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=M.loadSkins??this.loadSkins,this.loadMorphTargets=M.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=M.compileMaterials??this.compileMaterials,this.useClipPlane=M.useClipPlane??this.useClipPlane,this.compileShadowGenerators=M.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=M.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=M.useRangeRequests??this.useRangeRequests,this.createInstances=M.createInstances??this.createInstances,this.alwaysComputeBoundingBox=M.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=M.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=M.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=M.skipMaterials??this.skipMaterials,this.useSRGBBuffers=M.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=M.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=M.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=M.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=M.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=M.customRootNode,this.onMeshLoaded=M.onMeshLoaded,this.onSkinLoaded=M.onSkinLoaded,this.onTextureLoaded=M.onTextureLoaded,this.onMaterialLoaded=M.onMaterialLoaded,this.onCameraLoaded=M.onCameraLoaded,this.extensionOptions=M.extensionOptions??this.extensionOptions)}}class w extends Y{constructor(M){super(),this.onParsedObservable=new Q.b,this.onMeshLoadedObservable=new Q.b,this.onSkinLoadedObservable=new Q.b,this.onTextureLoadedObservable=new Q.b,this.onMaterialLoadedObservable=new Q.b,this.onCameraLoadedObservable=new Q.b,this.onCompleteObservable=new Q.b,this.onErrorObservable=new Q.b,this.bb=new Q.b,this.onExtensionLoadedObservable=new Q.b,this.validate=!1,this.onValidatedObservable=new Q.b,this._loader=null,this._state=null,this._requests=new Array,this.name=R.name,this.extensions=R.extensions,this.onLoaderStateChangedObservable=new Q.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.B(M)}set onParsed(M){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),M&&(this._onParsedObserver=this.onParsedObservable.add(M))}set onMeshLoaded(M){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),M&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(M))}set onSkinLoaded(M){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),M&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((p=>M(p.node,p.skinnedNode))))}set onTextureLoaded(M){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),M&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(M))}set onMaterialLoaded(M){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),M&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(M))}set onCameraLoaded(M){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),M&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(M))}set onComplete(M){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(M)}set onError(M){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(M)}set onDispose(M){this._onDisposeObserver&&this.bb.remove(this._onDisposeObserver),this._onDisposeObserver=this.bb.add(M)}set onExtensionLoaded(M){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(M)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(M){this._loggingEnabled!==M&&(this._loggingEnabled=M,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(M){this._capturePerformanceCounters!==M&&(this._capturePerformanceCounters=M,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(M){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(M)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const M of this._requests)M.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=M=>Promise.resolve(M),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.bb.notifyObservers(void 0),this.bb.clear()}loadFile(M,p,b,B,k,u,T,H){if(ArrayBuffer.isView(p))return this._loadBinary(M,p,b,B,T,H),null;this._progressCallback=k;const F=p.name||q.Tools.GetFilename(p);if(u){if(this.useRangeRequests){this.validate&&O.c.Warn("glTF validation is not supported when range requests are enabled");const b={abort:()=>{},onCompleteObservable:new Q.b},q={readAsync:(b,Q)=>new Promise(((q,B)=>{this._loadFile(M,p,(M=>{q(new Uint8Array(M))}),!0,(M=>{B(M)}),(M=>{M.setRequestHeader("Range",`bytes=${b}-${b+Q-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new s(q)).then((M=>{b.onCompleteObservable.notifyObservers(b),B(M)}),T?M=>T(void 0,M):void 0),b}return this._loadFile(M,p,(p=>{this._validate(M,new Uint8Array(p,0,p.byteLength),b,F),this._unpackBinaryAsync(new s({readAsync:(M,b)=>r(p,M,b),byteLength:p.byteLength})).then((M=>{B(M)}),T?M=>T(void 0,M):void 0)}),!0,T)}return this._loadFile(M,p,(p=>{try{this._validate(M,p,b,F),B({json:this._parseJson(p)})}catch{T&&T()}}),!1,T)}_loadBinary(M,p,b,Q,q,B){this._validate(M,new Uint8Array(p.buffer,p.byteOffset,p.byteLength),b,B),this._unpackBinaryAsync(new s({readAsync:(M,b)=>function(M,p,b){try{if(p<0||p>=M.byteLength)throw new RangeError("Offset is out of range.");if(p+b>M.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(M.buffer,M.byteOffset+p,b))}catch(Q){return Promise.reject(Q)}}(p,M,b),byteLength:p.byteLength})).then((M=>{Q(M)}),q?M=>q(void 0,M):void 0)}importMeshAsync(M,p,b,Q,q,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(b),this._loader.importMeshAsync(M,p,null,b,Q,q,B))))}loadAsync(M,p,b,Q,q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(p),this._loader.loadAsync(M,p,b,Q,q))))}loadAssetContainerAsync(M,p,b,Q,q){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(p);const B=new D(M),k=[];this.onMaterialLoadedObservable.add((M=>{k.push(M)}));const u=[];this.onTextureLoadedObservable.add((M=>{u.push(M)}));const T=[];this.onCameraLoadedObservable.add((M=>{T.push(M)}));const O=[];return this.onMeshLoadedObservable.add((M=>{M.morphTargetManager&&O.push(M.morphTargetManager)})),this._loader.importMeshAsync(null,M,B,p,b,Q,q).then((M=>(Array.prototype.push.apply(B.geometries,M.geometries),Array.prototype.push.apply(B.meshes,M.meshes),Array.prototype.push.apply(B.qo,M.qo),Array.prototype.push.apply(B.skeletons,M.skeletons),Array.prototype.push.apply(B.animationGroups,M.animationGroups),Array.prototype.push.apply(B.materials,k),Array.prototype.push.apply(B.textures,u),Array.prototype.push.apply(B.lights,M.lights),Array.prototype.push.apply(B.transformNodes,M.transformNodes),Array.prototype.push.apply(B.cameras,T),Array.prototype.push.apply(B.morphTargetManagers,O),B)))}))}canDirectLoad(M){return R.canDirectLoad(M)}directLoad(M,p){if(p.startsWith("base64,"+f)||p.startsWith(";base64,"+f)||p.startsWith("application/octet-stream;base64,"+f)||p.startsWith("model/gltf-binary;base64,"+f)){const b=(0,L.c)(p);return this._validate(M,new Uint8Array(b,0,b.byteLength)),this._unpackBinaryAsync(new s({readAsync:(M,p)=>r(b,M,p),byteLength:b.byteLength}))}return this._validate(M,p),Promise.resolve({json:this._parseJson(p)})}createPlugin(M){return new w(M[R.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((M,p)=>{this.onCompleteObservable.addOnce((()=>{M()})),this.onErrorObservable.addOnce((M=>{p(M)}))}))}_setState(M){this._state!==M&&(this._state=M,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(P[this._state]))}_loadFile(M,p,b,Q,q,B){const k=M._loadFile(p,b,(M=>{this._onProgress(M,k)}),!0,Q,q,B);return k.onCompleteObservable.add((()=>{k._lengthComputable=!0,k._total=k._loaded})),this._requests.push(k),k}_onProgress(M,p){if(!this._progressCallback)return;p._lengthComputable=M.lengthComputable,p._loaded=M.loaded,p._total=M.total;let b=!0,Q=0,q=0;for(const B of this._requests){if(void 0===B._lengthComputable||void 0===B._loaded||void 0===B._total)return;b=b&&B._lengthComputable,Q+=B._loaded,q+=B._total}this._progressCallback({lengthComputable:b,loaded:Q,total:b?q:0})}_validate(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),S.e.ValidateAsync(p,b,Q,(p=>this.preprocessUrlAsync(b+p).then((p=>M._loadFileAsync(p,void 0,!0,!0).then((M=>new Uint8Array(M,0,M.byteLength))))))).then((M=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(M),this.onValidatedObservable.clear()}),(M=>{this._endPerformanceCounter("Validate JSON"),q.Tools.Warn(`Failed to validate: ${M.message}`),this.onValidatedObservable.clear()})))}_getLoader(M){const p=M.json.asset||{};this._log(`Asset version: ${p.version}`),p.minVersion&&this._log(`Asset minimum version: ${p.minVersion}`),p.generator&&this._log(`Asset generator: ${p.generator}`);const b=w._parseVersion(p.version);if(!b)throw new Error("Invalid version: "+p.version);if(void 0!==p.minVersion){const M=w._parseVersion(p.minVersion);if(!M)throw new Error("Invalid minimum version: "+p.minVersion);if(w._compareVersion(M,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+p.minVersion)}const Q={1:w._CreateGLTF1Loader,2:w._CreateGLTF2Loader}[b.major];if(!Q)throw new Error("Unsupported version: "+p.version);return Q(this)}_parseJson(M){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${M.length}`);const p=JSON.parse(M);return this._endPerformanceCounter("Parse JSON"),p}_unpackBinaryAsync(M){return this._startPerformanceCounter("Unpack Binary"),M.loadAsync(20).then((()=>{const p=M.readUint32();if(1179937895!==p)throw new N.k("Unexpected magic: "+p,N.h.GLTFLoaderUnexpectedMagicError);const b=M.readUint32();this.loggingEnabled&&this._log(`Binary version: ${b}`);const Q=M.readUint32();let q;switch(this.useRangeRequests||Q===M.buffer.byteLength||O.c.Warn(`Length in header does not match actual data length: ${Q} != ${M.buffer.byteLength}`),b){case 1:q=this._unpackBinaryV1Async(M,Q);break;case 2:q=this._unpackBinaryV2Async(M,Q);break;default:throw new Error("Unsupported version: "+b)}return this._endPerformanceCounter("Unpack Binary"),q}))}_unpackBinaryV1Async(M,p){const b=M.readUint32(),Q=M.readUint32();if(0!==Q)throw new Error(`Unexpected content format: ${Q}`);const q=p-M.byteOffset,B={json:this._parseJson(M.readString(b)),bin:null};if(0!==q){const p=M.byteOffset;B.bin={readAsync:(b,Q)=>M.buffer.readAsync(p+b,Q),byteLength:q}}return Promise.resolve(B)}_unpackBinaryV2Async(M,p){const b=1313821514,Q=5130562,q=M.readUint32();if(M.readUint32()!==b)throw new Error("First chunk format is not JSON");return M.byteOffset+q===p?M.loadAsync(q).then((()=>({json:this._parseJson(M.readString(q)),bin:null}))):M.loadAsync(q+8).then((()=>{const B={json:this._parseJson(M.readString(q)),bin:null},k=()=>{const q=M.readUint32();switch(M.readUint32()){case b:throw new Error("Unexpected JSON chunk");case Q:{const p=M.byteOffset;B.bin={readAsync:(b,Q)=>M.buffer.readAsync(p+b,Q),byteLength:q},M.skipBytes(q);break}default:M.skipBytes(q)}return M.byteOffset!==p?M.loadAsync(8).then(k):Promise.resolve(B)};return k()}))}static _parseVersion(M){if("1.0"===M||"1.0.1"===M)return{major:1,minor:0};const p=(M+"").match(/^(\d+)\.(\d+)/);return p?{major:parseInt(p[1]),minor:parseInt(p[2])}:null}static _compareVersion(M,p){return M.major>p.major?1:M.major<p.major?-1:M.minor>p.minor?1:M.minor<p.minor?-1:0}_logOpen(M){this._log(M),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(M){const p=w._logSpaces.substring(0,2*this._logIndentLevel);O.c.Log(`${p}${M}`)}_logDisabled(M){}_startPerformanceCounterEnabled(M){q.Tools.StartPerformanceCounter(M)}_startPerformanceCounterDisabled(M){}_endPerformanceCounterEnabled(M){q.Tools.EndPerformanceCounter(M)}_endPerformanceCounterDisabled(M){}}w.IncrementalLoading=!0,w.HomogeneousCoordinates=!1,w._logSpaces="                                ",(0,B.b)(new w)},13399:(M,p,b)=>{"use strict";b.d(p,{e:()=>k});var Q=b(11621);function q(M,p,b,Q){const q={externalResourceFunction:Q};return b&&(q.uri="file:"===p?b:p+b),ArrayBuffer.isView(M)?GLTFValidator.validateBytes(M,q):GLTFValidator.validateString(M,q)}function B(){const M=[];onmessage=p=>{const b=p.data;switch(b.id){case"init":importScripts(b.url);break;case"validate":q(b.data,b.rootUrl,b.fileName,(p=>new Promise(((b,Q)=>{const q=M.length;M.push({resolve:b,reject:Q}),postMessage({id:"getExternalResource",index:q,uri:p})})))).then((M=>{postMessage({id:"validate.resolve",value:M})}),(M=>{postMessage({id:"validate.reject",reason:M})}));break;case"getExternalResource.resolve":M[b.index].resolve(b.value);break;case"getExternalResource.reject":M[b.index].reject(b.reason)}}}class k{static ValidateAsync(M,p,b,k){return"function"===typeof Worker?new Promise(((u,T)=>{const O=`${q}(${B})()`,H=URL.createObjectURL(new Blob([O],{type:"application/javascript"})),F=new Worker(H),o=M=>{F.removeEventListener("error",o),F.removeEventListener("message",W),T(M)},W=M=>{const p=M.data;switch(p.id){case"getExternalResource":k(p.uri).then((M=>{F.postMessage({id:"getExternalResource.resolve",index:p.index,value:M},[M.buffer])}),(M=>{F.postMessage({id:"getExternalResource.reject",index:p.index,reason:M})}));break;case"validate.resolve":F.removeEventListener("error",o),F.removeEventListener("message",W),u(p.value),F.terminate();break;case"validate.reject":F.removeEventListener("error",o),F.removeEventListener("message",W),T(p.reason),F.terminate()}};if(F.addEventListener("error",o),F.addEventListener("message",W),F.postMessage({id:"init",url:Q.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(M)){const Q=M.slice();F.postMessage({id:"validate",data:Q,rootUrl:p,fileName:b},[Q.buffer])}else F.postMessage({id:"validate",data:M,rootUrl:p,fileName:b})})):(this._LoadScriptPromise||(this._LoadScriptPromise=Q.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>q(M,p,b,k))))}}k.Configuration={url:`${Q.Tools._DefaultCdnUrl}/gltf_validator.js`}},13923:(M,p,b)=>{"use strict";b.d(p,{e:()=>R});var Q=b(11784),q=b(11788),B=b(11823),k=b(11796),u=b(12186),T=b(12122),O=b(11857),H=b(12033),F=b(11757),o=b(11709);b(13165),b(13065),b(13084),b(13067),b(13091),b(13099),b(13106);const W="imageProcessingCompatibility",i="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";o.d.IncludesShadersStore[W]||(o.d.IncludesShadersStore[W]=i);const A="skyPixelShader",j="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";o.d.ShadersStore[A]||(o.d.ShadersStore[A]=j);b(13179),b(13115),b(13117),b(13128),b(13126);const K="skyVertexShader",D="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";o.d.ShadersStore[K]||(o.d.ShadersStore[K]=D);var a=b(12116),s=b(12173),S=b(12167);class f extends u.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class R extends T.c{constructor(M,p){super(M,p),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new k.Ap(0,100,0),this.useSunPosition=!1,this.cameraOffset=k.Ap.Zero(),this.up=k.Ap.Up(),this.dithering=!1,this._cameraPosition=k.Ap.Zero(),this._skyOrientation=new k.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(M,p){const b=p._drawWrapper;if(this.isFrozen&&b.effect&&b._wasPreviouslyReady)return!0;p.materialDefines||(p.materialDefines=new f);const Q=p.materialDefines,q=this.RM();if(this._isReadyForSubMesh(p))return!0;if((0,S.G)(M,q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,Q),(0,S.A)(M,Q,!0,!1),Q.IMAGEPROCESSINGPOSTPROCESS!==q.imageProcessingConfiguration.applyByPostProcess&&Q.markAsMiscDirty(),Q.DITHER!==this.dithering&&Q.markAsMiscDirty(),Q.isDirty){Q.markAsProcessed(),q.resetCachedMaterial();const M=new a.c;Q.FOG&&M.addFallback(1,"FOG"),Q.IMAGEPROCESSINGPOSTPROCESS=q.imageProcessingConfiguration.applyByPostProcess,Q.DITHER=this.dithering;const b=[O.f.PositionKind];Q.VERTEXCOLOR&&b.push(O.f.ColorKind);const B="sky",k=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,s.d)(k);const u=Q.toString();p.setEffect(q.getEngine().createEffect(B,b,k,[],u,M,this.onCompiled,this.onError),Q,this._materialContext)}return!(!p.effect||!p.effect.isReady())&&(Q._renderId=q.getRenderId(),b._wasPreviouslyReady=!0,!0)}bindForSubMesh(M,p,b){const Q=this.RM(),q=b.materialDefines;if(!q)return;const B=b.effect;if(!B)return;this._activeEffect=B,this.bindOnlyWorldMatrix(M),this._activeEffect.setMatrix("viewProjection",Q.getTransformMatrix()),this._mustRebind(Q,B,b)&&((0,s.e)(B,this,Q),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,S.e)(q,B,Q)),Q.fogEnabled&&p.applyFog&&Q.fogMode!==H.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",Q.getViewMatrix()),(0,S.c)(Q,p,this._activeEffect);const u=Q.activeCamera;if(u){const M=u.getWorldMatrix();this._cameraPosition.x=M.m[12],this._cameraPosition.y=M.m[13],this._cameraPosition.z=M.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const M=Math.PI*(this.inclination-.5),p=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(p)*Math.cos(M),this.sunPosition.y=this.distance*Math.sin(-M),this.sunPosition.z=this.distance*Math.sin(p)*Math.cos(M),k.Quaternion.FromUnitVectorsToRef(k.Ap.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(p,this._activeEffect,b)}getAnimatables(){return[]}dispose(M){super.dispose(M)}clone(M){return B.b.Clone((()=>new R(M,this.RM())),this)}serialize(){const M=super.serialize();return M.customType="BABYLON.SkyMaterial",M}getClassName(){return"SkyMaterial"}static Parse(M,p,b){return B.b.Parse((()=>new R(M.name,p)),M,p,b)}}(0,Q.c)([(0,q.R)()],R.prototype,"luminance",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"turbidity",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"rayleigh",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"mieCoefficient",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"mieDirectionalG",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"distance",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"inclination",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"azimuth",void 0),(0,Q.c)([(0,q.N)()],R.prototype,"sunPosition",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"useSunPosition",void 0),(0,Q.c)([(0,q.N)()],R.prototype,"cameraOffset",void 0),(0,Q.c)([(0,q.N)()],R.prototype,"up",void 0),(0,Q.c)([(0,q.R)()],R.prototype,"dithering",void 0),(0,F.g)("BABYLON.SkyMaterial",R)},12484:(M,p,b)=>{"use strict";function Q(M,p){p.headers=M.headers||{},p.statusMessage=M.statusText,p.statusCode=M.status,p.data=M.response}function q(M,p,b){return new Promise((function(q,B){b=b||{};var k,u,T,O=new XMLHttpRequest,H=b.body,F=b.headers||{};for(k in b.timeout&&(O.timeout=b.timeout),O.ontimeout=O.onerror=function(M){M.timeout="timeout"==M.type,B(M)},O.open(M,p.href||p),O.onload=function(){for(T=O.getAllResponseHeaders().trim().split(/[\r\n]+/),Q(O,O);u=T.shift();)u=u.split(": "),O.headers[u.shift().toLowerCase()]=u.join(": ");if((u=O.headers["content-type"])&&~u.indexOf("application/json"))try{O.data=JSON.parse(O.data,b.reviver)}catch(M){return Q(O,M),B(M)}(O.status>=400?B:q)(O)},typeof FormData<"u"&&H instanceof FormData||H&&"object"==typeof H&&(F["content-type"]="application/json",H=JSON.stringify(H)),O.withCredentials=!!b.withCredentials,F)O.setRequestHeader(k,F[k]);O.send(H)}))}b.r(p),b.d(p,{del:()=>T,get:()=>B,patch:()=>u,post:()=>k,put:()=>O,send:()=>q});var B=q.bind(q,"GET"),k=q.bind(q,"POST"),u=q.bind(q,"PATCH"),T=q.bind(q,"DELETE"),O=q.bind(q,"PUT")},14027:(M,p,b)=>{"use strict";b.d(p,{b:()=>F});const Q=.5*(Math.sqrt(3)-1),q=(3-Math.sqrt(3))/6,B=1/3,k=1/6,u=(Math.sqrt(5)-1)/4,T=(5-Math.sqrt(5))/20,O=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),H=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const F=class{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const p="function"==typeof M?M:function(M){let p=0,b=0,Q=0,q=1;const B=function(){let M=4022871197;return function(p){p=p.toString();for(let b=0;b<p.length;b++){M+=p.charCodeAt(b);let Q=.02519603282416938*M;M=Q>>>0,Q-=M,Q*=M,M=Q>>>0,Q-=M,M+=4294967296*Q}return 2.3283064365386963e-10*(M>>>0)}}();p=B(" "),b=B(" "),Q=B(" "),p-=B(M),p<0&&(p+=1);b-=B(M),b<0&&(b+=1);Q-=B(M),Q<0&&(Q+=1);return function(){const M=2091639*p+2.3283064365386963e-10*q;return p=b,b=Q,Q=M-(q=0|M)}}(M);this.p=function(M){const p=new Uint8Array(256);for(let b=0;b<256;b++)p[b]=b;for(let b=0;b<255;b++){const Q=b+~~(M()*(256-b)),q=p[b];p[b]=p[Q],p[Q]=q}return p}(p),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let b=0;b<512;b++)this.perm[b]=this.p[255&b],this.permMod12[b]=this.perm[b]%12}noise2D(M,p){const b=this.permMod12,B=this.perm;let k=0,u=0,T=0;const H=(M+p)*Q,F=Math.floor(M+H),o=Math.floor(p+H),W=(F+o)*q,i=M-(F-W),A=p-(o-W);let j,K;i>A?(j=1,K=0):(j=0,K=1);const D=i-j+q,a=A-K+q,s=i-1+2*q,S=A-1+2*q,f=255&F,R=255&o;let y=.5-i*i-A*A;if(y>=0){const M=3*b[f+B[R]];y*=y,k=y*y*(O[M]*i+O[M+1]*A)}let x=.5-D*D-a*a;if(x>=0){const M=3*b[f+j+B[R+K]];x*=x,u=x*x*(O[M]*D+O[M+1]*a)}let P=.5-s*s-S*S;if(P>=0){const M=3*b[f+1+B[R+1]];P*=P,T=P*P*(O[M]*s+O[M+1]*S)}return 70*(k+u+T)}noise3D(M,p,b){const Q=this.permMod12,q=this.perm;let u,T,H,F;const o=(M+p+b)*B,W=Math.floor(M+o),i=Math.floor(p+o),A=Math.floor(b+o),j=(W+i+A)*k,K=M-(W-j),D=p-(i-j),a=b-(A-j);let s,S,f,R,y,x;K>=D?D>=a?(s=1,S=0,f=0,R=1,y=1,x=0):K>=a?(s=1,S=0,f=0,R=1,y=0,x=1):(s=0,S=0,f=1,R=1,y=0,x=1):D<a?(s=0,S=0,f=1,R=0,y=1,x=1):K<a?(s=0,S=1,f=0,R=0,y=1,x=1):(s=0,S=1,f=0,R=1,y=1,x=0);const P=K-s+k,L=D-S+k,N=a-f+k,r=K-R+2*k,Y=D-y+2*k,w=a-x+2*k,E=K-1+.5,n=D-1+.5,g=a-1+.5,U=255&W,c=255&i,d=255&A;let V=.6-K*K-D*D-a*a;if(V<0)u=0;else{const M=3*Q[U+q[c+q[d]]];V*=V,u=V*V*(O[M]*K+O[M+1]*D+O[M+2]*a)}let h=.6-P*P-L*L-N*N;if(h<0)T=0;else{const M=3*Q[U+s+q[c+S+q[d+f]]];h*=h,T=h*h*(O[M]*P+O[M+1]*L+O[M+2]*N)}let I=.6-r*r-Y*Y-w*w;if(I<0)H=0;else{const M=3*Q[U+R+q[c+y+q[d+x]]];I*=I,H=I*I*(O[M]*r+O[M+1]*Y+O[M+2]*w)}let Z=.6-E*E-n*n-g*g;if(Z<0)F=0;else{const M=3*Q[U+1+q[c+1+q[d+1]]];Z*=Z,F=Z*Z*(O[M]*E+O[M+1]*n+O[M+2]*g)}return 32*(u+T+H+F)}noise4D(M,p,b,Q){const q=this.perm;let B,k,O,F,o;const W=(M+p+b+Q)*u,i=Math.floor(M+W),A=Math.floor(p+W),j=Math.floor(b+W),K=Math.floor(Q+W),D=(i+A+j+K)*T,a=M-(i-D),s=p-(A-D),S=b-(j-D),f=Q-(K-D);let R=0,y=0,x=0,P=0;a>s?R++:y++,a>S?R++:x++,a>f?R++:P++,s>S?y++:x++,s>f?y++:P++,S>f?x++:P++;const L=R>=3?1:0,N=y>=3?1:0,r=x>=3?1:0,Y=P>=3?1:0,w=R>=2?1:0,E=y>=2?1:0,n=x>=2?1:0,g=P>=2?1:0,U=R>=1?1:0,c=y>=1?1:0,d=x>=1?1:0,V=P>=1?1:0,h=a-L+T,I=s-N+T,Z=S-r+T,J=f-Y+T,v=a-w+2*T,z=s-E+2*T,t=S-n+2*T,e=f-g+2*T,G=a-U+3*T,mM=s-c+3*T,C=S-d+3*T,X=f-V+3*T,l=a-1+4*T,MM=s-1+4*T,pM=S-1+4*T,bM=f-1+4*T,QM=255&i,qM=255&A,BM=255&j,kM=255&K;let uM=.6-a*a-s*s-S*S-f*f;if(uM<0)B=0;else{const M=q[QM+q[qM+q[BM+q[kM]]]]%32*4;uM*=uM,B=uM*uM*(H[M]*a+H[M+1]*s+H[M+2]*S+H[M+3]*f)}let TM=.6-h*h-I*I-Z*Z-J*J;if(TM<0)k=0;else{const M=q[QM+L+q[qM+N+q[BM+r+q[kM+Y]]]]%32*4;TM*=TM,k=TM*TM*(H[M]*h+H[M+1]*I+H[M+2]*Z+H[M+3]*J)}let OM=.6-v*v-z*z-t*t-e*e;if(OM<0)O=0;else{const M=q[QM+w+q[qM+E+q[BM+n+q[kM+g]]]]%32*4;OM*=OM,O=OM*OM*(H[M]*v+H[M+1]*z+H[M+2]*t+H[M+3]*e)}let HM=.6-G*G-mM*mM-C*C-X*X;if(HM<0)F=0;else{const M=q[QM+U+q[qM+c+q[BM+d+q[kM+V]]]]%32*4;HM*=HM,F=HM*HM*(H[M]*G+H[M+1]*mM+H[M+2]*C+H[M+3]*X)}let FM=.6-l*l-MM*MM-pM*pM-bM*bM;if(FM<0)o=0;else{const M=q[QM+1+q[qM+1+q[BM+1+q[kM+1]]]]%32*4;FM*=FM,o=FM*FM*(H[M]*l+H[M+1]*MM+H[M+2]*pM+H[M+3]*bM)}return 27*(B+k+O+F+o)}}}}]);