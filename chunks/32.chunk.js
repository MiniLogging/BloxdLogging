/*! For license information please see ts7kx.32.0de1f2aa.chunk.js.LICENSE.txt */
(self.vb3rpbgyozo=self.vb3rpbgyozo||[]).push([[32],{14721:(q,I,l)=>{"use strict";var w=l(14725),t=l(14734),O=l(14741);l.g.__TYPEDARRAY_POOL||(l.g.__TYPEDARRAY_POOL={UINT8:t([32,0]),UINT16:t([32,0]),UINT32:t([32,0]),INT8:t([32,0]),INT16:t([32,0]),INT32:t([32,0]),FLOAT:t([32,0]),DOUBLE:t([32,0]),DATA:t([32,0]),UINT8C:t([32,0]),BUFFER:t([32,0])});var c="undefined"!==typeof Uint8ClampedArray,a=l.g.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=t([32,0])),a.BUFFER||(a.BUFFER=t([32,0]));var F=a.DATA,s=a.BUFFER;function Z(q){if(q){var I=q.length||q.byteLength,l=w.log2(I);F[l].push(q)}}function r(q){q=w.nextPow2(q);var I=w.log2(q),l=F[I];return l.length>0?l.pop():new ArrayBuffer(q)}function x(q){return new Uint8Array(r(q),0,q)}function o(q){return new Uint16Array(r(2*q),0,q)}function d(q){return new Uint32Array(r(4*q),0,q)}function T(q){return new Int8Array(r(q),0,q)}function V(q){return new Int16Array(r(2*q),0,q)}function U(q){return new Int32Array(r(4*q),0,q)}function B(q){return new Float32Array(r(4*q),0,q)}function v(q){return new Float64Array(r(8*q),0,q)}function k(q){return c?new Uint8ClampedArray(r(q),0,q):x(q)}function C(q){return new DataView(r(q),0,q)}I.free=function(q){if(O(q))s[w.log2(q.length)].push(q);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(q)&&(q=q.buffer),!q)return;var I=q.length||q.byteLength,l=0|w.log2(I);F[l].push(q)}},I.freeUint8=I.freeUint16=I.freeUint32=I.freeInt8=I.freeInt16=I.freeInt32=I.freeFloat32=I.freeFloat=I.freeFloat64=I.freeDouble=I.freeUint8Clamped=I.freeDataView=function(q){Z(q.buffer)},I.freeArrayBuffer=Z,I.freeBuffer=function(q){s[w.log2(q.length)].push(q)},I.malloc=function(q,I){if(void 0===I||"arraybuffer"===I)return r(q);switch(I){case"uint8":return x(q);case"uint16":return o(q);case"uint32":return d(q);case"int8":return T(q);case"int16":return V(q);case"int32":return U(q);case"float":case"float32":return B(q);case"double":case"float64":return v(q);case"uint8_clamped":return k(q);case"buffer":throw"Buffer not supported";case"data":case"dataview":return C(q);default:return null}return null},I.mallocArrayBuffer=r,I.mallocUint8=x,I.mallocUint16=o,I.mallocUint32=d,I.mallocInt8=T,I.mallocInt16=V,I.mallocInt32=U,I.mallocFloat32=I.mallocFloat=B,I.mallocFloat64=I.mallocDouble=v,I.mallocUint8Clamped=k,I.mallocDataView=C,I.clearCache=function(){for(var q=0;q<32;++q)a.UINT8[q].length=0,a.UINT16[q].length=0,a.UINT32[q].length=0,a.INT8[q].length=0,a.INT16[q].length=0,a.INT32[q].length=0,a.FLOAT[q].length=0,a.DOUBLE[q].length=0,a.UINT8C[q].length=0,F[q].length=0,s[q].length=0}},14821:(q,I,l)=>{q.exports=t;var w=l(13512);function t(q,I){if(!(this instanceof t))return new t(q,I);var l=w.create();w.add(l,q,I),this.base=w.min(w.create(),q,l),this.WZ=w.clone(I),this.max=w.max(w.create(),q,l),this.mag=w.length(this.WZ)}var O=t.prototype;O.width=function(){return this.WZ[0]},O.height=function(){return this.WZ[1]},O.depth=function(){return this.WZ[2]},O.x0=function(){return this.base[0]},O.y0=function(){return this.base[1]},O.z0=function(){return this.base[2]},O.x1=function(){return this.max[0]},O.y1=function(){return this.max[1]},O.z1=function(){return this.max[2]},O.translate=function(q){return w.add(this.max,this.max,q),w.add(this.base,this.base,q),this},O.setPosition=function(q){return w.add(this.max,q,this.WZ),w.j(this.base,q),this},O.expand=function(q){var I=w.create(),l=w.create();return w.max(I,q.max,this.max),w.min(l,q.base,this.base),w.TI(I,I,l),new t(l,I)},O.intersects=function(q){return!(q.base[0]>this.max[0])&&(!(q.base[1]>this.max[1])&&(!(q.base[2]>this.max[2])&&(!(q.max[0]<this.base[0])&&(!(q.max[1]<this.base[1])&&!(q.max[2]<this.base[2])))))},O.touches=function(q){var I=this.union(q);return null!==I&&(0==I.width()||0==I.height()||0==I.depth())},O.union=function(q){if(!this.intersects(q))return null;var I=Math.max(q.base[0],this.base[0]),l=Math.max(q.base[1],this.base[1]),w=Math.max(q.base[2],this.base[2]);return new t([I,l,w],[Math.min(q.max[0],this.max[0])-I,Math.min(q.max[1],this.max[1])-l,Math.min(q.max[2],this.max[2])-w])}},14725:(q,I)=>{"use strict";function l(q){var I=32;return(q&=-q)&&I--,65535&q&&(I-=16),16711935&q&&(I-=8),252645135&q&&(I-=4),858993459&q&&(I-=2),1431655765&q&&(I-=1),I}I.INT_BITS=32,I.INT_MAX=2147483647,I.INT_MIN=-1<<31,I.sign=function(q){return(q>0)-(q<0)},I.abs=function(q){var I=q>>31;return(q^I)-I},I.min=function(q,I){return I^(q^I)&-(q<I)},I.max=function(q,I){return q^(q^I)&-(q<I)},I.isPow2=function(q){return!(q&q-1)&&!!q},I.log2=function(q){var I,l;return I=(q>65535)<<4,I|=l=((q>>>=I)>255)<<3,I|=l=((q>>>=l)>15)<<2,(I|=l=((q>>>=l)>3)<<1)|(q>>>=l)>>1},I.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},I.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},I.countTrailingZeros=l,I.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},I.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},I.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var w=new Array(256);!function(q){for(var I=0;I<256;++I){var l=I,w=I,t=7;for(l>>>=1;l;l>>>=1)w<<=1,w|=1&l,--t;q[I]=w<<t&255}}(w),I.reverse=function(q){return w[255&q]<<24|w[q>>>8&255]<<16|w[q>>>16&255]<<8|w[q>>>24&255]},I.interleave2=function(q,I){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))<<1},I.deinterleave2=function(q,I){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>I&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},I.interleave3=function(q,I,l){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<1)|(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<2},I.deinterleave3=function(q,I){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>I&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},I.nextCombination=function(q){var I=q|q-1;return I+1|(~I&-~I)-1>>>l(q)+1}},14716:(q,I,l)=>{"use strict";q.exports=function(q,I,l){switch(arguments.length){case 1:return w=[],s(t=q,t,Z,!0),w;case 2:return"function"===typeof I?s(q,q,I,!0):function(q,I){return w=[],s(q,I,Z,!1),w}(q,I);case 3:return s(q,I,l,!1);default:throw new Error("box-intersect: Invalid arguments")}var t};var w,t=l(14721),O=l(14750),c=l(14759);function a(q,I){for(var l=0;l<q;++l)if(!(I[l]<=I[l+q]))return!0;return!1}function F(q,I,l,w){for(var t=0,O=0,c=0,F=q.length;c<F;++c){var s=q[c];if(!a(I,s)){for(var Z=0;Z<2*I;++Z)l[t++]=s[Z];w[O++]=c}}return O}function s(q,I,l,w){var a=q.length,s=I.length;if(!(a<=0||s<=0)){var Z=q[0].length>>>1;if(!(Z<=0)){var r,x=t.mallocDouble(2*Z*a),o=t.mallocInt32(a);if((a=F(q,Z,x,o))>0){if(1===Z&&w)O.init(a),r=O.sweepComplete(Z,l,0,a,x,o,0,a,x,o);else{var d=t.mallocDouble(2*Z*s),T=t.mallocInt32(s);(s=F(I,Z,d,T))>0&&(O.init(a+s),r=1===Z?O.sweepBipartite(Z,l,0,a,x,o,0,s,d,T):c(Z,l,w,a,x,o,s,d,T),t.free(d),t.free(T))}t.free(x),t.free(o)}return r}}}function Z(q,I){w.push([q,I])}},14762:(q,I)=>{"use strict";var l="d",w="ax",t="fp",O="es",c="rs",a="re",F="rb",s="bs",Z="be",r="bb",x=[l,w,"vv",c,a,F,"ri",s,Z,r,"bi"];function o(q){var I="bruteForce"+(q?"Full":"Partial"),w=[],c=x.slice();q||c.splice(3,0,t);var a=["function "+I+"("+c.join()+"){"];function F(I,t){var c=function(q,I,w){var t="bruteForce"+(q?"Red":"Blue")+(I?"Flip":"")+(w?"Full":""),c=["function ",t,"(",x.join(),"){","var ",O,"=2*",l,";"],a="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",F="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(w?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return q?c.push(a,"Q",":",F):c.push(F,"Q",":",a),w?c.push("if(y1<x0||x1<y0)continue;"):I?c.push("if(y0<=x0||x1<y0)continue;"):c.push("if(y0<x0||x1<y0)continue;"),c.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),I?c.push("yi,xi"):c.push("xi,yi"),c.push(");if(rv!==void 0)return rv;}}}"),{name:t,code:c.join("")}}(I,t,q);w.push(c.code),a.push("return "+c.name+"("+x.join()+");")}a.push("if(re-rs>be-bs){"),q?(F(!0,!1),a.push("}else{"),F(!1,!1)):(a.push("if(fp){"),F(!0,!0),a.push("}else{"),F(!0,!1),a.push("}}else{if(fp){"),F(!1,!0),a.push("}else{"),F(!1,!1),a.push("}")),a.push("}}return "+I);var s=w.join("")+a.join("");return new Function(s)()}I.partial=o(!1),I.full=o(!0)},14759:(q,I,l)=>{"use strict";q.exports=function(q,I,l,O,Z,g,p,X,K){!function(q,I){var l=8*t.log2(I+1)*(q+1)|0,O=t.nextPow2(k*l);R.length<O&&(w.free(R),R=w.mallocInt32(O));var c=t.nextPow2(C*l);W.length<c&&(w.free(W),W=w.mallocDouble(c))}(q,O+p);var D,M=0,n=2*q;e(M++,0,0,O,0,p,l?16:0,-1/0,1/0),l||e(M++,0,0,p,0,O,1,-1/0,1/0);for(;M>0;){var f=(M-=1)*k,L=R[f],E=R[f+1],j=R[f+2],h=R[f+3],u=R[f+4],P=R[f+5],mq=M*C,Y=W[mq],y=W[mq+1],G=1&P,N=!!(16&P),J=Z,z=g,H=X,A=K;if(G&&(J=X,z=K,H=Z,A=g),!(2&P&&E>=(j=V(q,L,E,j,J,z,y)))&&!(4&P&&(E=U(q,L,E,j,J,z,Y))>=j)){var Q=j-E,b=u-h;if(N){if(q*Q*(Q+b)<o){if(void 0!==(D=F.scanComplete(q,L,I,E,j,J,z,h,u,H,A)))return D;continue}}else{if(q*Math.min(Q,b)<r){if(void 0!==(D=c(q,L,I,G,E,j,J,z,h,u,H,A)))return D;continue}if(q*Q*b<x){if(void 0!==(D=F.scanBipartite(q,L,I,G,E,j,J,z,h,u,H,A)))return D;continue}}var qq=d(q,L,E,j,J,z,Y,y);if(E<qq)if(q*(qq-E)<r){if(void 0!==(D=a(q,L+1,I,E,qq,J,z,h,u,H,A)))return D}else if(L===q-2){if(void 0!==(D=G?F.sweepBipartite(q,I,h,u,H,A,E,qq,J,z):F.sweepBipartite(q,I,E,qq,J,z,h,u,H,A)))return D}else e(M++,L+1,E,qq,h,u,G,-1/0,1/0),e(M++,L+1,h,u,E,qq,1^G,-1/0,1/0);if(qq<j){var Iq=s(q,L,h,u,H,A),lq=H[n*Iq+L],wq=T(q,L,Iq,u,H,A,lq);if(wq<u&&e(M++,L,qq,j,wq,u,(4|G)+(N?16:0),lq,y),h<Iq&&e(M++,L,qq,j,h,Iq,(2|G)+(N?16:0),Y,lq),Iq+1===wq){if(void 0!==(D=N?S(q,L,I,qq,j,J,z,Iq,H,A[Iq]):i(q,L,I,G,qq,j,J,z,Iq,H,A[Iq])))return D}else if(Iq<wq){var tq;if(N){if(qq<(tq=B(q,L,qq,j,J,z,lq))){var Oq=T(q,L,qq,tq,J,z,lq);if(L===q-2){if(qq<Oq&&void 0!==(D=F.sweepComplete(q,I,qq,Oq,J,z,Iq,wq,H,A)))return D;if(Oq<tq&&void 0!==(D=F.sweepBipartite(q,I,Oq,tq,J,z,Iq,wq,H,A)))return D}else qq<Oq&&e(M++,L+1,qq,Oq,Iq,wq,16,-1/0,1/0),Oq<tq&&(e(M++,L+1,Oq,tq,Iq,wq,0,-1/0,1/0),e(M++,L+1,Iq,wq,Oq,tq,1,-1/0,1/0))}}else qq<(tq=G?v(q,L,qq,j,J,z,lq):B(q,L,qq,j,J,z,lq))&&(L===q-2?D=G?F.sweepBipartite(q,I,Iq,wq,H,A,qq,tq,J,z):F.sweepBipartite(q,I,qq,tq,J,z,Iq,wq,H,A):(e(M++,L+1,qq,tq,Iq,wq,G,-1/0,1/0),e(M++,L+1,Iq,wq,qq,tq,1^G,-1/0,1/0)))}}}}};var w=l(14721),t=l(14725),O=l(14762),c=O.partial,a=O.full,F=l(14750),s=l(14769),Z=l(14772),r=128,x=1<<22,o=1<<22,d=Z("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),T=Z("lo===p0",["p0"]),V=Z("lo<p0",["p0"]),U=Z("hi<=p0",["p0"]),B=Z("lo<=p0&&p0<=hi",["p0"]),v=Z("lo<p0&&p0<=hi",["p0"]),k=6,C=2,R=w.mallocInt32(1024),W=w.mallocDouble(1024);function e(q,I,l,w,t,O,c,a,F){var s=k*q;R[s]=I,R[s+1]=l,R[s+2]=w,R[s+3]=t,R[s+4]=O,R[s+5]=c;var Z=C*q;W[Z]=a,W[Z+1]=F}function i(q,I,l,w,t,O,c,a,F,s,Z){var r=2*q,x=F*r,o=s[x+I];q:for(var d=t,T=t*r;d<O;++d,T+=r){var V=c[T+I],U=c[T+I+q];if(!(o<V||U<o)&&(!w||o!==V)){for(var B,v=a[d],k=I+1;k<q;++k){V=c[T+k],U=c[T+k+q];var C=s[x+k],R=s[x+k+q];if(U<C||R<V)continue q}if(void 0!==(B=w?l(Z,v):l(v,Z)))return B}}}function S(q,I,l,w,t,O,c,a,F,s){var Z=2*q,r=a*Z,x=F[r+I];q:for(var o=w,d=w*Z;o<t;++o,d+=Z){var T=c[o];if(T!==s){var V=O[d+I],U=O[d+I+q];if(!(x<V||U<x)){for(var B=I+1;B<q;++B){V=O[d+B],U=O[d+B+q];var v=F[r+B],k=F[r+B+q];if(U<v||k<V)continue q}var C=l(T,s);if(void 0!==C)return C}}}}},14769:(q,I,l)=>{"use strict";q.exports=function(q,I,l,c,a,F){if(c<=l+1)return l;var s=l,Z=c,r=c+l>>>1,x=2*q,o=r,d=a[x*r+I];for(;s<Z;){if(Z-s<t){O(q,I,s,Z,a,F),d=a[x*r+I];break}var T=Z-s,V=Math.random()*T+s|0,U=a[x*V+I],B=Math.random()*T+s|0,v=a[x*B+I],k=Math.random()*T+s|0,C=a[x*k+I];U<=v?C>=v?(o=B,d=v):U>=C?(o=V,d=U):(o=k,d=C):v>=C?(o=B,d=v):C>=U?(o=V,d=U):(o=k,d=C);for(var R=x*(Z-1),W=x*o,e=0;e<x;++e,++R,++W){var i=a[R];a[R]=a[W],a[W]=i}var S=F[Z-1];F[Z-1]=F[o],F[o]=S;for(R=x*(Z-1),W=x*(o=w(q,I,s,Z-1,a,F,d)),e=0;e<x;++e,++R,++W){i=a[R];a[R]=a[W],a[W]=i}S=F[Z-1];if(F[Z-1]=F[o],F[o]=S,r<o){for(Z=o-1;s<Z&&a[x*(Z-1)+I]===d;)Z-=1;Z+=1}else{if(!(o<r))break;for(s=o+1;s<Z&&a[x*s+I]===d;)s+=1}}return w(q,I,l,r,a,F,a[x*r+I])};var w=l(14772)("lo<p0",["p0"]),t=8;function O(q,I,l,w,t,O){for(var c=2*q,a=c*(l+1)+I,F=l+1;F<w;++F,a+=c)for(var s=t[a],Z=F,r=c*(F-1);Z>l&&t[r+I]>s;--Z,r-=c){for(var x=r,o=r+c,d=0;d<c;++d,++x,++o){var T=t[x];t[x]=t[o],t[o]=T}var V=O[Z];O[Z]=O[Z-1],O[Z-1]=V}}},14772:q=>{"use strict";q.exports=function(q,l){var w="abcdef".split("").concat(l),t=[];q.indexOf("lo")>=0&&t.push("lo=e[k+n]");q.indexOf("hi")>=0&&t.push("hi=e[k+o]");return w.push(I.replace("_",t.join()).replace("$",q)),Function.apply(void 0,w)};var I="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14757:q=>{"use strict";q.exports=function(q,w){w<=4*I?l(0,w-1,q):s(0,w-1,q)};var I=32;function l(q,I,l){for(var w=2*(q+1),t=q+1;t<=I;++t){for(var O=l[w++],c=l[w++],a=t,F=w-2;a-- >q;){var s=l[F-2],Z=l[F-1];if(s<O)break;if(s===O&&Z<c)break;l[F]=s,l[F+1]=Z,F-=2}l[F]=O,l[F+1]=c}}function w(q,I,l){I*=2;var w=l[q*=2],t=l[q+1];l[q]=l[I],l[q+1]=l[I+1],l[I]=w,l[I+1]=t}function t(q,I,l){I*=2,l[q*=2]=l[I],l[q+1]=l[I+1]}function O(q,I,l,w){I*=2,l*=2;var t=w[q*=2],O=w[q+1];w[q]=w[I],w[q+1]=w[I+1],w[I]=w[l],w[I+1]=w[l+1],w[l]=t,w[l+1]=O}function c(q,I,l,w,t){I*=2,t[q*=2]=t[I],t[I]=l,t[q+1]=t[I+1],t[I+1]=w}function a(q,I,l){I*=2;var w=l[q*=2],t=l[I];return!(w<t)&&(w!==t||l[q+1]>l[I+1])}function F(q,I,l,w){var t=w[q*=2];return t<I||t===I&&w[q+1]<l}function s(q,Z,r){var x=(Z-q+1)/6|0,o=q+x,d=Z-x,T=q+Z>>1,V=T-x,U=T+x,B=o,v=V,k=T,C=U,R=d,W=q+1,e=Z-1,i=0;a(B,v,r)&&(i=B,B=v,v=i),a(C,R,r)&&(i=C,C=R,R=i),a(B,k,r)&&(i=B,B=k,k=i),a(v,k,r)&&(i=v,v=k,k=i),a(B,C,r)&&(i=B,B=C,C=i),a(k,C,r)&&(i=k,k=C,C=i),a(v,R,r)&&(i=v,v=R,R=i),a(v,k,r)&&(i=v,v=k,k=i),a(C,R,r)&&(i=C,C=R,R=i);for(var S=r[2*v],g=r[2*v+1],p=r[2*C],X=r[2*C+1],K=2*B,D=2*k,M=2*R,n=2*o,f=2*T,L=2*d,E=0;E<2;++E){var j=r[K+E],h=r[D+E],u=r[M+E];r[n+E]=j,r[f+E]=h,r[L+E]=u}t(V,q,r),t(U,Z,r);for(var P=W;P<=e;++P)if(F(P,S,g,r))P!==W&&w(P,W,r),++W;else if(!F(P,p,X,r))for(;;){if(F(e,p,X,r)){F(e,S,g,r)?(O(P,W,e,r),++W,--e):(w(P,e,r),--e);break}if(--e<P)break}c(q,W-1,S,g,r),c(Z,e+1,p,X,r),W-2-q<=I?l(q,W-2,r):s(q,W-2,r),Z-(e+2)<=I?l(e+2,Z,r):s(e+2,Z,r),e-W<=I?l(W,e,r):s(W,e,r)}},14750:(q,I,l)=>{"use strict";q.exports={init:function(q){var I=t.nextPow2(q);F.length<I&&(w.free(F),F=w.mallocInt32(I));s.length<I&&(w.free(s),s=w.mallocInt32(I));Z.length<I&&(w.free(Z),Z=w.mallocInt32(I));r.length<I&&(w.free(r),r=w.mallocInt32(I));x.length<I&&(w.free(x),x=w.mallocInt32(I));o.length<I&&(w.free(o),o=w.mallocInt32(I));var l=8*I;d.length<l&&(w.free(d),d=w.mallocDouble(l))},sweepBipartite:function(q,I,l,w,t,a,x,o,U,B){for(var v=0,k=2*q,C=q-1,R=k-1,W=l;W<w;++W){var e=a[W],i=k*W;d[v++]=t[i+C],d[v++]=-(e+1),d[v++]=t[i+R],d[v++]=e}for(W=x;W<o;++W){e=B[W]+c;var S=k*W;d[v++]=U[S+C],d[v++]=-e,d[v++]=U[S+R],d[v++]=e}var g=v>>>1;O(d,g);var p=0,X=0;for(W=0;W<g;++W){var K=0|d[2*W+1];if(K>=c)T(Z,r,X--,K=K-c|0);else if(K>=0)T(F,s,p--,K);else if(K<=-c){K=-K-c|0;for(var D=0;D<p;++D){if(void 0!==(M=I(F[D],K)))return M}V(Z,r,X++,K)}else{K=-K-1|0;for(D=0;D<X;++D){var M;if(void 0!==(M=I(K,Z[D])))return M}V(F,s,p++,K)}}},sweepComplete:function(q,I,l,w,t,c,a,U,B,v){for(var k=0,C=2*q,R=q-1,W=C-1,e=l;e<w;++e){var i=c[e]+1<<1,S=C*e;d[k++]=t[S+R],d[k++]=-i,d[k++]=t[S+W],d[k++]=i}for(e=a;e<U;++e){i=v[e]+1<<1;var g=C*e;d[k++]=B[g+R],d[k++]=1|-i,d[k++]=B[g+W],d[k++]=1|i}var p=k>>>1;O(d,p);var X=0,K=0,D=0;for(e=0;e<p;++e){var M=0|d[2*e+1],n=1&M;if(e<p-1&&M>>1===d[2*e+3]>>1&&(n=2,e+=1),M<0){for(var f=-(M>>1)-1,L=0;L<D;++L){if(void 0!==(E=I(x[L],f)))return E}if(0!==n)for(L=0;L<X;++L){if(void 0!==(E=I(F[L],f)))return E}if(1!==n)for(L=0;L<K;++L){var E;if(void 0!==(E=I(Z[L],f)))return E}0===n?V(F,s,X++,f):1===n?V(Z,r,K++,f):2===n&&V(x,o,D++,f)}else{f=(M>>1)-1;0===n?T(F,s,X--,f):1===n?T(Z,r,K--,f):2===n&&T(x,o,D--,f)}}},scanBipartite:function(q,I,l,w,t,a,Z,r,x,o,U,B){var v=0,k=2*q,C=I,R=I+q,W=1,e=1;w?e=c:W=c;for(var i=t;i<a;++i){var S=i+W,g=k*i;d[v++]=Z[g+C],d[v++]=-S,d[v++]=Z[g+R],d[v++]=S}for(i=x;i<o;++i){S=i+e;var p=k*i;d[v++]=U[p+C],d[v++]=-S}var X=v>>>1;O(d,X);var K=0;for(i=0;i<X;++i){var D=0|d[2*i+1];if(D<0){var M=!1;if((S=-D)>=c?(M=!w,S-=c):(M=!!w,S-=1),M)V(F,s,K++,S);else{var n=B[S],f=k*S,L=U[f+I+1],E=U[f+I+1+q];q:for(var j=0;j<K;++j){var h=F[j],u=k*h;if(!(E<Z[u+I+1]||Z[u+I+1+q]<L)){for(var P=I+2;P<q;++P)if(U[f+P+q]<Z[u+P]||Z[u+P+q]<U[f+P])continue q;var mq,Y=r[h];if(void 0!==(mq=w?l(n,Y):l(Y,n)))return mq}}}}else T(F,s,K--,D-W)}},scanComplete:function(q,I,l,w,t,a,s,Z,r,x,o){for(var T=0,V=2*q,U=I,B=I+q,v=w;v<t;++v){var k=v+c,C=V*v;d[T++]=a[C+U],d[T++]=-k,d[T++]=a[C+B],d[T++]=k}for(v=Z;v<r;++v){k=v+1;var R=V*v;d[T++]=x[R+U],d[T++]=-k}var W=T>>>1;O(d,W);var e=0;for(v=0;v<W;++v){var i=0|d[2*v+1];if(i<0){if((k=-i)>=c)F[e++]=k-c;else{var S=o[k-=1],g=V*k,p=x[g+I+1],X=x[g+I+1+q];q:for(var K=0;K<e;++K){var D=F[K],M=s[D];if(M===S)break;var n=V*D;if(!(X<a[n+I+1]||a[n+I+1+q]<p)){for(var f=I+2;f<q;++f)if(x[g+f+q]<a[n+f]||a[n+f+q]<x[g+f])continue q;var L=l(M,S);if(void 0!==L)return L}}}}else{for(k=i-c,K=e-1;K>=0;--K)if(F[K]===k){for(f=K+1;f<e;++f)F[f-1]=F[f];break}--e}}}};var w=l(14721),t=l(14725),O=l(14757),c=1<<28,a=1024,F=w.mallocInt32(a),s=w.mallocInt32(a),Z=w.mallocInt32(a),r=w.mallocInt32(a),x=w.mallocInt32(a),o=w.mallocInt32(a),d=w.mallocDouble(8192);function T(q,I,l,w){var t=I[w],O=q[l-1];q[t]=O,I[O]=t}function V(q,I,l,w){q[l]=w,I[w]=l}},14734:q=>{"use strict";function I(q,l,w){var t=0|q[w];if(t<=0)return[];var O,c=new Array(t);if(w===q.length-1)for(O=0;O<t;++O)c[O]=l;else for(O=0;O<t;++O)c[O]=I(q,l,w+1);return c}q.exports=function(q,l){switch("undefined"===typeof l&&(l=0),typeof q){case"number":if(q>0)return function(q,I){var l,w;for(l=new Array(q),w=0;w<q;++w)l[w]=I;return l}(0|q,l);break;case"object":if("number"===typeof q.length)return I(q,l,0)}return[]}},14690:(q,I,l)=>{q.exports=function(){var q=this;this.components={},this.comps=this.components;var I=this.components,l=1,t={},O=[],c=[],a={timeout:!1,removals:[],multiComps:[]};function F(q,l){var w=I[l],O=t[l],c=O.hash[q];c&&(O.remove(q),w.lt&&(w.multi?(c.forEach((I=>{I&&w.lt(q,I)})),c.length=0):w.lt(q,c)),a.removals.push(O),s())}function s(){a.timeout||(a.timeout=!0,setTimeout(Z,1))}function Z(){a.timeout=!1,r()}function r(){a.multiComps.length&&function(q){for(var I=0;I<q.length;I++){var{entID:l,data:w}=q[I],t=w.hash[l];if(t){for(var O=0;O<t.length;O++)t[O]||(t.splice(O,1),O--);0===t.length&&(w.remove(l),a.removals.push(w))}}q.length=0}(a.multiComps),a.removals.length&&function(q){for(var I=0;I<q.length;I++){q[I].flush()}q.length=0}(a.removals)}this.ur=t,this._systems=O,this._renderSystems=c,this.Ts=function(I){var w=l++;return Array.isArray(I)&&I.forEach((I=>q.cs(w,I))),w},this.deleteEntity=function(I){return Object.keys(t).forEach((q=>{t[q].hash[I]&&F(I,q)})),q},this.PZ=function(q){if(!q)throw new Error("Missing component definition");var l=q.name;if(!l)throw new Error("Component definition must have a name property.");if("string"!==typeof l)throw new Error("Component name must be a string.");if(""===l)throw new Error("Component name must be a non-empty string.");if(t[l])throw new Error(`Component ${l} already exists.`);var a={};return a.name=l,a.multi=!!q.multi,a.order=isNaN(q.order)?99:q.order,a.stateConstructor=q.stateConstructor||null,a.state=q.state||{},a.wF=q.wF||null,a.lt=q.lt||null,a.system=q.system||null,a.sF=q.sF||null,I[l]=a,t[l]=new w,t[l]._pendingMultiCleanup=!1,t[l]._multiCleanupIDs=a.multi?[]:null,a.system&&(O.push(l),O.sort(((q,l)=>I[q].order-I[l].order))),a.sF&&(c.push(l),c.sort(((q,l)=>I[q].order-I[l].order))),l},this.overwriteComponent=function(q,l){var w=I[q];if(!w)throw new Error(`Unknown component: ${q}`);if(!l)throw new Error("Missing component definition");if(w.name!==l.name)throw new Error("Overwriting component must use the same name property.");var a={};a.name=q,a.multi=!!l.multi,a.order=isNaN(l.order)?99:l.order,a.state=l.state||{},a.wF=l.wF||null,a.lt=l.lt||null,a.system=l.system||null,a.sF=l.sF||null,I[q]=a,t[q]._pendingMultiCleanup=!1,t[q]._multiCleanupIDs=a.multi?[]:null;var F=O.indexOf(q);a.system&&F<0&&O.push(q),!a.system&&F>=0&&O.splice(F,1),O.sort(((q,l)=>I[q].order-I[l].order));var s=c.indexOf(q);a.sF&&s<0&&c.push(q),!a.sF&&s>=0&&c.splice(s,1),c.sort(((q,l)=>I[q].order-I[l].order));var Z=a.state;return this.aZ(q).forEach((q=>{for(var I in Z)I in q||(q[I]=Z[I]);a.wF&&a.wF(q.aF,q)})),q},this.deleteComponent=function(l){var w=t[l];if(!w)throw new Error(`Unknown component: ${l}`);w.flush(),w.list.forEach((q=>{q&&F(q.aF||q[0].aF,l)}));var a=O.indexOf(l),s=c.indexOf(l);return a>-1&&O.splice(a,1),s>-1&&c.splice(s,1),t[l].dispose(),delete t[l],delete I[l],q},this.cs=function(q,l,w){var O,c=I[l],a=t[l];if(!a)throw new Error(`Unknown component: ${l}.`);if(a.hash[q]&&!c.multi)throw new Error(`Entity ${q} already has component: ${l}.`);if(c.stateConstructor){if(!(O=new c.stateConstructor).hasOwnProperty("aF"))throw new Error(`Component ${c.name} stateConstructor type does not have property __id`)}else O=Object.assign({},{aF:q},c.state,w);if(O.aF=q,c.multi){var F=a.hash[q];F||(F=[],a.add(q,F)),F.push(O)}else a.add(q,O);return c.wF&&c.wF(q,O),this},this.Bs=function(q,I){var l=t[I];if(!l)throw new Error(`Unknown component: ${I}.`);return!!l.hash[q]},this.rs=function(I,l){if(!t[l])throw new Error(`Unknown component: ${l}.`);return F(I,l),q},this.getState=function(q,I){var l=t[I];if(!l)throw new Error(`Unknown component: ${I}.`);return l.hash[q]},this.aZ=function(q){var I=t[q];if(!I)throw new Error(`Unknown component: ${q}.`);return r(),I.list},this.uo=function(q){if(!t[q])throw new Error(`Unknown component: ${q}.`);var I=t[q].hash;return q=>I[q]},this.Yo=function(q){if(!t[q])throw new Error(`Unknown component: ${q}.`);var I=t[q].hash;return q=>!!I[q]},this.Qa=function(l){r();for(var w=0;w<O.length;w++){var c=O[w],a=I[c],F=t[c];a.system(l,F.list),r()}return q},this.render=function(l){r();for(var w=0;w<c.length;w++){var O=c[w],a=I[O],F=t[O];a.sF(l,F.list),r()}return q},this.removeMultiComponent=function(l,w,O){var c=I[w],F=t[w];if(!F)throw new Error(`Unknown component: ${w}.`);if(!c.multi)throw new Error("removeMultiComponent called on non-multi component");return function(q,I,l,w){var t=l.hash[q];if(t){var O=t[w];O&&(t[w]=null,I.lt&&I.lt(q,O),a.multiComps.push({entID:q,data:l}),s())}}(l,c,F,O),q}};var w=l(14692)},14692:q=>{function I(q,I){var l=q._map[I];if(delete q.hash[I],delete q._map[I],l===q.list.length-1)q.list.pop();else{var w=q.list.pop();if(q.list[l]=w,null===w||null===w[0]){var t=q.list.length;for(var O in q._map)if(q._map[O]===t)return void(q._map[O]=l)}else{var c=w.aF||w[0].aF;q._map[c]=l}}}q.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(q,I){if("number"===typeof this._map[q]){var l=this._map[q];this.hash[q]=I,this.list[l]=I}else this._map[q]=this.list.length,this.hash[q]=I,this.list.push(I)}remove(q){var I=this._map[q];this.hash[q]=null,this.list[I]=null,this._pendingRemovals.push(q)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var q=0;q<this._pendingRemovals.length;q++){var l=this._pendingRemovals[q];null===this.hash[l]&&I(this,l)}this._pendingRemovals.length=0}}},14666:q=>{"use strict";var I,l="object"===typeof Reflect?Reflect:null,w=function(q,I,l){return Function.prototype.apply.call(q,I,l)};I=l&&"function"===typeof l.ownKeys?l.ownKeys:Object.getOwnPropertySymbols?function(q){return Object.getOwnPropertyNames(q).concat(Object.getOwnPropertySymbols(q))}:function(q){return Object.getOwnPropertyNames(q)};var t=Number.isNaN||function(q){return q!==q};function O(){O.init.call(this)}q.exports=O,q.exports.once=function(q,I){return new Promise((function(l,w){function t(l){q.removeListener(I,O),w(l)}function O(){"function"===typeof q.removeListener&&q.removeListener("error",t),l([].slice.call(arguments))}T(q,I,O,{once:!0}),"error"!==I&&function(q,I,l){"function"===typeof q.on&&T(q,"error",I,l)}(q,t,{once:!0})}))},O.EventEmitter=O,O.prototype._events=void 0,O.prototype._eventsCount=0,O.prototype._maxListeners=void 0;var c=10;function a(q){if("function"!==typeof q)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof q)}function F(q){return void 0===q._maxListeners?O.defaultMaxListeners:q._maxListeners}function s(q,I,l,w){var t,O,c,s;if(a(l),void 0===(O=q._events)?(O=q._events=Object.create(null),q._eventsCount=0):(void 0!==O.newListener&&(q.emit("newListener",I,l.listener?l.listener:l),O=q._events),c=O[I]),void 0===c)c=O[I]=l,++q._eventsCount;else if("function"===typeof c?c=O[I]=w?[l,c]:[c,l]:w?c.unshift(l):c.push(l),(t=F(q))>0&&c.length>t&&!c.warned){c.warned=!0;var Z=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");Z.name="MaxListenersExceededWarning",Z.wI=q,Z.type=I,Z.count=c.length,s=Z,console&&console.warn&&console.warn(s)}return q}function Z(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function r(q,I,l){var w={fired:!1,wrapFn:void 0,target:q,type:I,listener:l},t=Z.bind(w);return t.listener=l,w.wrapFn=t,t}function x(q,I,l){var w=q._events;if(void 0===w)return[];var t=w[I];return void 0===t?[]:"function"===typeof t?l?[t.listener||t]:[t]:l?function(q){for(var I=new Array(q.length),l=0;l<I.length;++l)I[l]=q[l].listener||q[l];return I}(t):d(t,t.length)}function o(q){var I=this._events;if(void 0!==I){var l=I[q];if("function"===typeof l)return 1;if(void 0!==l)return l.length}return 0}function d(q,I){for(var l=new Array(I),w=0;w<I;++w)l[w]=q[w];return l}function T(q,I,l,w){if("function"===typeof q.on)w.once?q.once(I,l):q.on(I,l);else{if("function"!==typeof q.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof q);q.addEventListener(I,(function t(O){w.once&&q.removeEventListener(I,t),l(O)}))}}Object.defineProperty(O,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(q){if("number"!==typeof q||q<0||t(q))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+q+".");c=q}}),O.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},O.prototype.setMaxListeners=function(q){if("number"!==typeof q||q<0||t(q))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+q+".");return this._maxListeners=q,this},O.prototype.getMaxListeners=function(){return F(this)},O.prototype.emit=function(q){for(var I=[],l=1;l<arguments.length;l++)I.push(arguments[l]);var t="error"===q,O=this._events;if(void 0!==O)t=t&&void 0===O.error;else if(!t)return!1;if(t){var c;if(I.length>0&&(c=I[0]),c instanceof Error)throw c;var a=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw a.context=c,a}var F=O[q];if(void 0===F)return!1;if("function"===typeof F)w(F,this,I);else{var s=F.length,Z=d(F,s);for(l=0;l<s;++l)w(Z[l],this,I)}return!0},O.prototype.addListener=function(q,I){return s(this,q,I,!1)},O.prototype.on=O.prototype.addListener,O.prototype.prependListener=function(q,I){return s(this,q,I,!0)},O.prototype.once=function(q,I){return a(I),this.on(q,r(this,q,I)),this},O.prototype.prependOnceListener=function(q,I){return a(I),this.prependListener(q,r(this,q,I)),this},O.prototype.removeListener=function(q,I){var l,w,t,O,c;if(a(I),void 0===(w=this._events))return this;if(void 0===(l=w[q]))return this;if(l===I||l.listener===I)0===--this._eventsCount?this._events=Object.create(null):(delete w[q],w.removeListener&&this.emit("removeListener",q,l.listener||I));else if("function"!==typeof l){for(t=-1,O=l.length-1;O>=0;O--)if(l[O]===I||l[O].listener===I){c=l[O].listener,t=O;break}if(t<0)return this;0===t?l.shift():function(q,I){for(;I+1<q.length;I++)q[I]=q[I+1];q.pop()}(l,t),1===l.length&&(w[q]=l[0]),void 0!==w.removeListener&&this.emit("removeListener",q,c||I)}return this},O.prototype.off=O.prototype.removeListener,O.prototype.tI=function(q){var I,l,w;if(void 0===(l=this._events))return this;if(void 0===l.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==l[q]&&(0===--this._eventsCount?this._events=Object.create(null):delete l[q]),this;if(0===arguments.length){var t,O=Object.keys(l);for(w=0;w<O.length;++w)"removeListener"!==(t=O[w])&&this.tI(t);return this.tI("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(I=l[q]))this.removeListener(q,I);else if(void 0!==I)for(w=I.length-1;w>=0;w--)this.removeListener(q,I[w]);return this},O.prototype.listeners=function(q){return x(this,q,!0)},O.prototype.rawListeners=function(q){return x(this,q,!1)},O.listenerCount=function(q,I){return"function"===typeof q.listenerCount?q.listenerCount(I):o.call(q,I)},O.prototype.listenerCount=o,O.prototype.eventNames=function(){return this._eventsCount>0?I(this._events):[]}},14956:q=>{"use strict";q.exports=function(q,I,l,w,t,O){var c=+I[0],a=+I[1],F=+I[2],s=+l[0],Z=+l[1],r=+l[2],x=Math.sqrt(s*s+Z*Z+r*r);if(0===x)throw new Error("Can't raycast along a zero vector");return function(q,I,l,w,t,O,c,a,F,s){for(var Z=0,r=Math.floor,x=0|r(I),o=0|r(l),d=0|r(w),T=t>0?1:-1,V=O>0?1:-1,U=c>0?1:-1,B=Math.abs(1/t),v=Math.abs(1/O),k=Math.abs(1/c),C=B<1/0?B*(T>0?x+1-I:I-x):1/0,R=v<1/0?v*(V>0?o+1-l:l-o):1/0,W=k<1/0?k*(U>0?d+1-w:w-d):1/0,e=-1;Z<=a;){var i=q(x,o,d);if(i)return F&&(F[0]=I+Z*t,F[1]=l+Z*O,F[2]=w+Z*c),s&&(s[0]=s[1]=s[2]=0,0===e&&(s[0]=-T),1===e&&(s[1]=-V),2===e&&(s[2]=-U)),i;C<R?C<W?(x+=T,Z=C,C+=B,e=0):(d+=U,Z=W,W+=k,e=2):R<W?(o+=V,Z=R,R+=v,e=1):(d+=U,Z=W,W+=k,e=2)}return F&&(F[0]=I+Z*t,F[1]=l+Z*O,F[2]=w+Z*c),s&&(s[0]=s[1]=s[2]=0),0}(q,c,a,F,s/=x,Z/=x,r/=x,w="undefined"===typeof w?64:+w,t,O)}},14989:(q,I,l)=>{"use strict";l.d(I,{c:()=>O});var w=l(14666);function t(){this.jx=!1,this.stopPropagation=!1,this.hx=!1,this.disabled=!1}class O{constructor(q,I){this.version="0.7.0";var l=Object.assign({},new t,I||{});this.element=q||document,this.jx=!!l.jx,this.stopPropagation=!!l.stopPropagation,this.hx=!!l.hx,this.disabled=!!l.disabled,this.filterEvents=(q,I)=>!0,this.down=new w.EventEmitter,this.up=new w.EventEmitter,this.state={},this.IZ={dx:0,dy:0,Ko:0,qZ:0,Do:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?a(this):document.addEventListener("DOMContentLoaded",(q=>{a(this)}),{once:!0})}bind(q){for(var I=arguments.length,l=new Array(I>1?I-1:0),w=1;w<I;w++)l[w-1]=arguments[w];l.forEach((I=>{var l=this._keyBindmap[I]||[];l.includes(q)||(l.push(q),this._keyBindmap[I]=l)})),this.state[q]=!!this.state[q],this.pressCount[q]=this.pressCount[q]||0,this.releaseCount[q]=this.releaseCount[q]||0}unbind(q){for(var I in this._keyBindmap){var l=this._keyBindmap[I],w=l.indexOf(q);w>-1&&l.splice(w,1)}}getBindings(){var q={};for(var I in this._keyBindmap){this._keyBindmap[I].forEach((l=>{q[l]=q[l]||[],q[l].push(I)}))}return q}Qa(){c(this.IZ),c(this.pressCount),c(this.releaseCount)}}function c(q){for(var I in q)q[I]=0}function a(q){window.addEventListener("keydown",d.bind(null,q,!0),!1),window.addEventListener("keyup",d.bind(null,q,!1),!1);var I={passive:!0};q.element.addEventListener("touchstart",r.bind(void 0,q),{passive:!1}),q.element.addEventListener("touchend",o.bind(void 0,q),I),q.element.addEventListener("mousedown",T.bind(null,q,!0),I),window.document.addEventListener("mouseup",T.bind(null,q,!1),I),q.element.addEventListener("touchmove",V.bind(null,q),I),q.element.addEventListener("mousemove",V.bind(null,q),I),window.PointerEvent,q.element.addEventListener("wheel",U.bind(null,q),I),q.element.addEventListener("contextmenu",B.bind(null,q),!1),window.addEventListener("blur",v.bind(null,q),!1)}var F=0,s=0,Z=null;function r(q,I){I.preventDefault(),x(I)}function x(q){let I=!1;for(let l=0;l<q.touches.length;++l)if(q.touches[l].identifier===Z){I=!0;break}if(!I){const I=q.changedTouches[0];F=I.clientX,s=I.clientY,Z=I.identifier}}function o(q,I){for(var l=I.changedTouches,w=0;w<l.length;++w)l[w].identifier===Z&&(Z=null)}function d(q,I,l){k(l.code,I,q,l)}function T(q,I,l){if("pointerId"in l)if(I){if(null!==q._touches.currID)return;q._touches.currID=l.pointerId}else{if(q._touches.currID!==l.pointerId)return;q._touches.currID=null}return k("Mouse"+("button"in l?l.button+1:1),I,q,l),!1}function V(q,I){var l=I.movementX||I.mozMovementX||0,w=I.movementY||I.mozMovementY||0;if(I.touches&&0===(l|w)){var t=function(q){x(q);for(let I=0;I<q.changedTouches.length;++I)if(q.changedTouches[I].identifier==Z){const l=q.changedTouches[I],w=[l.clientX-F,l.clientY-s];return F=l.clientX,s=l.clientY,w}return console.error(`Did not find touch id ${Z}`),[0,0]}(I);l=t[0],w=t[1]}q.IZ.dx+=l,q.IZ.dy+=w}function U(q,I){var l=1;switch(I.deltaMode){case 0:l=1;break;case 1:l=12;break;case 2:l=q.element.clientHeight||window.innerHeight}q.IZ.Ko+=(I.deltaX||0)*l,q.IZ.qZ+=(I.deltaY||0)*l,q.IZ.Do+=(I.deltaZ||0)*l}function B(q,I){if(!q.hx)return I.preventDefault(),!1}function v(q){for(var I in q._keyStates)q._keyStates[I]&&(/^Mouse\d/.test(I)||k(I,!1,q,{code:I,note:"klundbt35ha",preventDefault:()=>{},stopPropagation:()=>{}}))}function k(q,I,l,w){var t=l._keyBindmap[q];t&&(C(l._keyStates[q],I)&&(l._keyStates[q]=I,t.forEach((q=>{(!l.filterEvents||l.filterEvents(w,q))&&function(q,I,l,w){var t=I?l.pressCount:l.releaseCount;t[q]=(t[q]||0)+1;var O=l._bindPressCount[q]||0;(O+=I?1:-1)<0&&(O=0);l._bindPressCount[q]=O;var c=l.state[q];if(C(c,O)){l.state[q]=O>0;var a=I?l.down:l.up;l.disabled||a.emit(q,w)}}(q,I,l,w)}))),"button"in w||(l.jx&&!w.defaultPrevented&&w.preventDefault(),l.stopPropagation&&w.stopPropagation()))}function C(q,I){return q?!I:I}},13588:q=>{q.exports=function(q,I,l){return q[0]=I[0]+l[0],q[1]=I[1]+l[1],q[2]=I[2]+l[2],q}},13540:(q,I,l)=>{q.exports=function(q,I){var l=w(q[0],q[1],q[2]),c=w(I[0],I[1],I[2]);t(l,l),t(c,c);var a=O(l,c);return a>1?0:Math.acos(a)};var w=l(13543),t=l(13551),O=l(13557)},13654:q=>{q.exports=function(q,I){return q[0]=Math.ceil(I[0]),q[1]=Math.ceil(I[1]),q[2]=Math.ceil(I[2]),q}},13533:q=>{q.exports=function(q){var I=new Float32Array(3);return I[0]=q[0],I[1]=q[1],I[2]=q[2],I}},13563:q=>{q.exports=function(q,I){return q[0]=I[0],q[1]=I[1],q[2]=I[2],q}},13529:q=>{q.exports=function(){var q=new Float32Array(3);return q[0]=0,q[1]=0,q[2]=0,q}},13721:q=>{q.exports=function(q,I,l){var w=I[0],t=I[1],O=I[2],c=l[0],a=l[1],F=l[2];return q[0]=t*F-O*a,q[1]=O*c-w*F,q[2]=w*a-t*c,q}},13680:(q,I,l)=>{q.exports=l(13676)},13676:q=>{q.exports=function(q,I){var l=I[0]-q[0],w=I[1]-q[1],t=I[2]-q[2];return Math.sqrt(l*l+w*w+t*t)}},13626:(q,I,l)=>{q.exports=l(13618)},13618:q=>{q.exports=function(q,I,l){return q[0]=I[0]/l[0],q[1]=I[1]/l[1],q[2]=I[2]/l[2],q}},13557:q=>{q.exports=function(q,I){return q[0]*I[0]+q[1]*I[1]+q[2]*I[2]}},13520:q=>{q.exports=1e-6},13575:(q,I,l)=>{q.exports=function(q,I){var l=q[0],t=q[1],O=q[2],c=I[0],a=I[1],F=I[2];return Math.abs(l-c)<=w*Math.max(1,Math.abs(l),Math.abs(c))&&Math.abs(t-a)<=w*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(O-F)<=w*Math.max(1,Math.abs(O),Math.abs(F))};var w=l(13520)},13583:q=>{q.exports=function(q,I){return q[0]===I[0]&&q[1]===I[1]&&q[2]===I[2]}},13647:q=>{q.exports=function(q,I){return q[0]=Math.floor(I[0]),q[1]=Math.floor(I[1]),q[2]=Math.floor(I[2]),q}},13775:(q,I,l)=>{q.exports=function(q,I,l,t,O,c){var a,F;I||(I=3);l||(l=0);F=t?Math.min(t*I+l,q.length):q.length;for(a=l;a<F;a+=I)w[0]=q[a],w[1]=q[a+1],w[2]=q[a+2],O(w,w,c),q[a]=w[0],q[a+1]=w[1],q[a+2]=w[2];return q};var w=l(13529)()},13543:q=>{q.exports=function(q,I,l){var w=new Float32Array(3);return w[0]=q,w[1]=I,w[2]=l,w}},13512:(q,I,l)=>{q.exports={EPSILON:l(13520),create:l(13529),clone:l(13533),angle:l(13540),mF:l(13543),j:l(13563),set:l(13572),equals:l(13575),exactEquals:l(13583),add:l(13588),TI:l(13590),sub:l(13598),multiply:l(13605),mul:l(13609),divide:l(13618),div:l(13626),min:l(13635),max:l(13641),floor:l(13647),ceil:l(13654),round:l(13657),scale:l(13662),Ya:l(13669),distance:l(13676),k:l(13680),squaredDistance:l(13682),sqrDist:l(13684),length:l(13687),len:l(13696),squaredLength:l(13703),ya:l(13711),negate:l(13716),inverse:l(13718),normalize:l(13551),dot:l(13557),cross:l(13721),Ma:l(13729),random:l(13738),transformMat4:l(13745),transformMat3:l(13749),transformQuat:l(13752),Ga:l(13757),Na:l(13764),Ja:l(13771),forEach:l(13775)}},13718:q=>{q.exports=function(q,I){return q[0]=1/I[0],q[1]=1/I[1],q[2]=1/I[2],q}},13696:(q,I,l)=>{q.exports=l(13687)},13687:q=>{q.exports=function(q){var I=q[0],l=q[1],w=q[2];return Math.sqrt(I*I+l*l+w*w)}},13729:q=>{q.exports=function(q,I,l,w){var t=I[0],O=I[1],c=I[2];return q[0]=t+w*(l[0]-t),q[1]=O+w*(l[1]-O),q[2]=c+w*(l[2]-c),q}},13641:q=>{q.exports=function(q,I,l){return q[0]=Math.max(I[0],l[0]),q[1]=Math.max(I[1],l[1]),q[2]=Math.max(I[2],l[2]),q}},13635:q=>{q.exports=function(q,I,l){return q[0]=Math.min(I[0],l[0]),q[1]=Math.min(I[1],l[1]),q[2]=Math.min(I[2],l[2]),q}},13609:(q,I,l)=>{q.exports=l(13605)},13605:q=>{q.exports=function(q,I,l){return q[0]=I[0]*l[0],q[1]=I[1]*l[1],q[2]=I[2]*l[2],q}},13716:q=>{q.exports=function(q,I){return q[0]=-I[0],q[1]=-I[1],q[2]=-I[2],q}},13551:q=>{q.exports=function(q,I){var l=I[0],w=I[1],t=I[2],O=l*l+w*w+t*t;O>0&&(O=1/Math.sqrt(O),q[0]=I[0]*O,q[1]=I[1]*O,q[2]=I[2]*O);return q}},13738:q=>{q.exports=function(q,I){I=I||1;var l=2*Math.random()*Math.PI,w=2*Math.random()-1,t=Math.sqrt(1-w*w)*I;return q[0]=Math.cos(l)*t,q[1]=Math.sin(l)*t,q[2]=w*I,q}},13757:q=>{q.exports=function(q,I,l,w){var t=l[1],O=l[2],c=I[1]-t,a=I[2]-O,F=Math.sin(w),s=Math.cos(w);return q[0]=I[0],q[1]=t+c*s-a*F,q[2]=O+c*F+a*s,q}},13764:q=>{q.exports=function(q,I,l,w){var t=l[0],O=l[2],c=I[0]-t,a=I[2]-O,F=Math.sin(w),s=Math.cos(w);return q[0]=t+a*F+c*s,q[1]=I[1],q[2]=O+a*s-c*F,q}},13771:q=>{q.exports=function(q,I,l,w){var t=l[0],O=l[1],c=I[0]-t,a=I[1]-O,F=Math.sin(w),s=Math.cos(w);return q[0]=t+c*s-a*F,q[1]=O+c*F+a*s,q[2]=I[2],q}},13657:q=>{q.exports=function(q,I){return q[0]=Math.round(I[0]),q[1]=Math.round(I[1]),q[2]=Math.round(I[2]),q}},13662:q=>{q.exports=function(q,I,l){return q[0]=I[0]*l,q[1]=I[1]*l,q[2]=I[2]*l,q}},13669:q=>{q.exports=function(q,I,l,w){return q[0]=I[0]+l[0]*w,q[1]=I[1]+l[1]*w,q[2]=I[2]+l[2]*w,q}},13572:q=>{q.exports=function(q,I,l,w){return q[0]=I,q[1]=l,q[2]=w,q}},13684:(q,I,l)=>{q.exports=l(13682)},13711:(q,I,l)=>{q.exports=l(13703)},13682:q=>{q.exports=function(q,I){var l=I[0]-q[0],w=I[1]-q[1],t=I[2]-q[2];return l*l+w*w+t*t}},13703:q=>{q.exports=function(q){var I=q[0],l=q[1],w=q[2];return I*I+l*l+w*w}},13598:(q,I,l)=>{q.exports=l(13590)},13590:q=>{q.exports=function(q,I,l){return q[0]=I[0]-l[0],q[1]=I[1]-l[1],q[2]=I[2]-l[2],q}},13749:q=>{q.exports=function(q,I,l){var w=I[0],t=I[1],O=I[2];return q[0]=w*l[0]+t*l[3]+O*l[6],q[1]=w*l[1]+t*l[4]+O*l[7],q[2]=w*l[2]+t*l[5]+O*l[8],q}},13745:q=>{q.exports=function(q,I,l){var w=I[0],t=I[1],O=I[2],c=l[3]*w+l[7]*t+l[11]*O+l[15];return c=c||1,q[0]=(l[0]*w+l[4]*t+l[8]*O+l[12])/c,q[1]=(l[1]*w+l[5]*t+l[9]*O+l[13])/c,q[2]=(l[2]*w+l[6]*t+l[10]*O+l[14])/c,q}},13752:q=>{q.exports=function(q,I,l){var w=I[0],t=I[1],O=I[2],c=l[0],a=l[1],F=l[2],s=l[3],Z=s*w+a*O-F*t,r=s*t+F*w-c*O,x=s*O+c*t-a*w,o=-c*w-a*t-F*O;return q[0]=Z*s+o*-c+r*-F-x*-a,q[1]=r*s+o*-a+x*-c-Z*-F,q[2]=x*s+o*-F+Z*-a-r*-c,q}},14678:q=>{"use strict";q.exports=function(q){for(var I=new Array(q),l=0;l<q;++l)I[l]=l;return I}},14741:q=>{q.exports=function(q){return null!=q&&null!=q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}},14961:(q,I,l)=>{"use strict";l.d(I,{e:()=>w});class w{constructor(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Fr=!1,this.sr=!1,this.cr=30,this.ar=0,this.vr=!1,this.fullscreen=!1,this.rr=function(q){},this.dr=function(){},this.Ur=function(){},this.gt=function(){},this.Tr=function(q){},this.onFullscreenChanged=function(q){},s((()=>{!function(q,I){q._nowObject=performance||Date,q._lastTick=0,q._renderAccum=0,q._rt=0,q._frameCB=a.bind(null,q),requestAnimationFrame(q._frameCB),I>0&&(q._intervalCB=c.bind(null,q),q._interval=setInterval(q._intervalCB,Math.max(I,1e3/q.cr/2)))}(this,I),function(q,I){if(!I)return;var l=!1,w=!1;document.addEventListener("pointerlockchange",(w=>{l=document.pointerLockElement===I,q.Tr(l)})),document.addEventListener("fullscreenchange",(l=>{w=document.fullscreenElement===I,q.onFullscreenChanged(w)})),Object.defineProperty(q,"vr",{get:()=>l,set:q=>{q&&!l?F(I):l&&!q&&function(q){q.exitPointerLock&&q.exitPointerLock()}(document)}}),Object.defineProperty(q,"fullscreen",{get:()=>w,set:q=>{q&&!w?I.requestFullscreen():w&&!q&&document.exitFullscreen()}}),I.addEventListener("click",(t=>{q.Fr&&!l&&F(I),q.sr&&!w&&I.requestFullscreen()}));var t=()=>q.gt();if(window.ResizeObserver){new ResizeObserver(t).observe(I)}else window.addEventListener("resize",t)}(this,q),this.Ur()}))}}var t=3,O=20;function c(q){for(var I=1e3/q.cr,l=q._nowObject.now()+O,w=0;q._nowObject.now()>=q._lastTick+I&&q._nowObject.now()<l&&++w<=t;)q.rr(I),q._lastTick+=I;var c=5*(I+5),a=q._nowObject.now();if(a-q._lastTick>c)for(;a>=q._lastTick+I;)q._lastTick+=I}function a(q){requestAnimationFrame(q._frameCB),c(q);var I=q._nowObject.now(),l=I-q._rt;if(q._rt=I,q.ar>0){q._renderAccum+=l;var w=1e3/q.ar;if(q._renderAccum<w)return;q._renderAccum=Math.min(q._renderAccum-w,w)}var t=1e3/q.cr,O=(I-q._lastTick)/t;q.dr(l,O,t)}function F(q){q.requestPointerLock&&q.requestPointerLock()}var s=q=>{if("loading"===document.readyState){var I=()=>{document.removeEventListener("readystatechange",I),q()};document.addEventListener("readystatechange",I)}else setTimeout(q,1)}},14675:(q,I,l)=>{var w=l(14678),t=l(14681),O="undefined"!==typeof Float64Array;function c(q,I){return q[0]-I[0]}function a(){var q,I=this.stride,l=new Array(I.length);for(q=0;q<l.length;++q)l[q]=[Math.abs(I[q]),q];l.sort(c);var w=new Array(l.length);for(q=0;q<w.length;++q)w[q]=l[q][1];return w}function F(q,I){var l=["View",I,"d",q].join("");I<0&&(l="View_Nil"+q);var t="generic"===q;if(-1===I){var O="function "+l+"(a){this.data=a;};var proto="+l+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+l+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+l+"(a){return new "+l+"(a);}";return new Function(O)()}if(0===I){O="function "+l+"(a,d) {this.data = a;this.offset = d};var proto="+l+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+l+"_copy() {return new "+l+"(this.data,this.offset)};proto.pick=function "+l+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+l+"_get(){return "+(t?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+l+"_set(v){return "+(t?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+l+"(a,b,c,d){return new "+l+"(a,d)}";return new Function("TrivialArray",O)(s[q][0])}O=["'use strict'"];var c=w(I),F=c.map((function(q){return"i"+q})),Z="this.offset+"+c.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),r=c.map((function(q){return"b"+q})).join(","),x=c.map((function(q){return"c"+q})).join(",");O.push("function "+l+"(a,"+r+","+x+",d){this.data=a","this.shape=["+r+"]","this.stride=["+x+"]","this.offset=d|0}","var proto="+l+".prototype","proto.dtype='"+q+"'","proto.dimension="+I),O.push("Object.defineProperty(proto,'size',{get:function "+l+"_size(){return "+c.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===I?O.push("proto.order=[0]"):(O.push("Object.defineProperty(proto,'order',{get:"),I<4?(O.push("function "+l+"_order(){"),2===I?O.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===I&&O.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):O.push("ORDER})")),O.push("proto.set=function "+l+"_set("+F.join(",")+",v){"),t?O.push("return this.data.set("+Z+",v)}"):O.push("return this.data["+Z+"]=v}"),O.push("proto.get=function "+l+"_get("+F.join(",")+"){"),t?O.push("return this.data.get("+Z+")}"):O.push("return this.data["+Z+"]}"),O.push("proto.index=function "+l+"_index(",F.join(),"){return "+Z+"}"),O.push("proto.hi=function "+l+"_hi("+F.join(",")+"){return new "+l+"(this.data,"+c.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+c.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var o=c.map((function(q){return"a"+q+"=this.shape["+q+"]"})),d=c.map((function(q){return"c"+q+"=this.stride["+q+"]"}));O.push("proto.lo=function "+l+"_lo("+F.join(",")+"){var b=this.offset,d=0,"+o.join(",")+","+d.join(","));for(var T=0;T<I;++T)O.push("if(typeof i"+T+"==='number'&&i"+T+">=0){d=i"+T+"|0;b+=c"+T+"*d;a"+T+"-=d}");O.push("return new "+l+"(this.data,"+c.map((function(q){return"a"+q})).join(",")+","+c.map((function(q){return"c"+q})).join(",")+",b)}"),O.push("proto.step=function "+l+"_step("+F.join(",")+"){var "+c.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+c.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(T=0;T<I;++T)O.push("if(typeof i"+T+"==='number'){d=i"+T+"|0;if(d<0){c+=b"+T+"*(a"+T+"-1);a"+T+"=ceil(-a"+T+"/d)}else{a"+T+"=ceil(a"+T+"/d)}b"+T+"*=d}");O.push("return new "+l+"(this.data,"+c.map((function(q){return"a"+q})).join(",")+","+c.map((function(q){return"b"+q})).join(",")+",c)}");var V=new Array(I),U=new Array(I);for(T=0;T<I;++T)V[T]="a[i"+T+"]",U[T]="b[i"+T+"]";O.push("proto.transpose=function "+l+"_transpose("+F+"){"+F.map((function(q,I){return q+"=("+q+"===undefined?"+I+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+l+"(this.data,"+V.join(",")+","+U.join(",")+",this.offset)}"),O.push("proto.pick=function "+l+"_pick("+F+"){var a=[],b=[],c=this.offset");for(T=0;T<I;++T)O.push("if(typeof i"+T+"==='number'&&i"+T+">=0){c=(c+this.stride["+T+"]*i"+T+")|0}else{a.push(this.shape["+T+"]);b.push(this.stride["+T+"])}");return O.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),O.push("return function construct_"+l+"(data,shape,stride,offset){return new "+l+"(data,"+c.map((function(q){return"shape["+q+"]"})).join(",")+","+c.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",O.join("\n"))(s[q],a)}var s={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,I,l,w){if(void 0===q)return(0,s.array[0])([]);"number"===typeof q&&(q=[q]),void 0===I&&(I=[q.length]);var c=I.length;if(void 0===l){l=new Array(c);for(var a=c-1,Z=1;a>=0;--a)l[a]=Z,Z*=I[a]}if(void 0===w){w=0;for(a=0;a<c;++a)l[a]<0&&(w-=(I[a]-1)*l[a])}for(var r=function(q){if(t(q))return"buffer";if(O)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),x=s[r];x.length<=c+1;)x.push(F(r,x.length-1));return(0,x[c+1])(q,I,l,w)}},14681:q=>{function I(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(I(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&I(q.slice(0,0))}(q)||!!q._isBuffer)}},14830:q=>{"use strict";var I=[],l=[],w=[],t=[],O=[],c=[],a=[],F=[],s=[],Z=[],r=[],x=[];q.exports=function(q,o,d,T,V,U){for(var B=a,v=s,k=Z,C=x,R=0;R<3;R++)B[R]=+d[R],k[R]=+o.max[R],v[R]=+o.base[R];U||(U=1e-10);var W=function(q,a,s,Z,x,o){var d=I,T=l,V=w,U=t,B=O,v=c,k=F,C=Math.floor,R=0,W=0,e=0,i=0,S=0;if(g(),0===e)return 0;for(i=K();W<=e;){if(p(i)&&X())return R;i=K()}for(R+=e,S=0;S<3;S++)Z[S]+=s[S],x[S]+=s[S];return R;function g(){if(W=0,0!==(e=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2])))for(var q=0;q<3;q++){var I=s[q]>=0;U[q]=I?1:-1;var l=I?x[q]:Z[q];d[q]=I?Z[q]:x[q],T[q]=D(l,U[q]),V[q]=M(d[q],U[q]),k[q]=s[q]/e,B[q]=Math.abs(1/k[q]);var w=I?T[q]+1-l:l-T[q];v[q]=B[q]<1/0?B[q]*w:1/0}}function p(I){for(var l=U[0],w=0===I?T[0]:V[0],t=T[0]+l,O=U[1],c=1===I?T[1]:V[1],a=T[1]+O,F=U[2],s=2===I?T[2]:V[2],Z=T[2]+F,r=w;r!=t;r+=l)for(var x=c;x!=a;x+=O)for(var o=s;o!=Z;o+=F)if(q(r,x,o))return!0;return!1}function X(){R+=W;var q=U[i],I=W/e,l=r;for(S=0;S<3;S++){var w=s[S]*I;Z[S]+=w,x[S]+=w,l[S]=s[S]-w}if(q>0?x[i]=Math.round(x[i]):Z[i]=Math.round(Z[i]),a(R,i,q,l))return!0;for(S=0;S<3;S++)s[S]=l[S];return g(),0===e}function K(){var q=v[0]<v[1]?v[0]<v[2]?0:2:v[1]<v[2]?1:2,I=v[q]-W;for(W=v[q],T[q]+=U[q],v[q]+=B[q],S=0;S<3;S++)d[S]+=I*k[S],V[S]=M(d[S],U[S]);return q}function D(q,I){return C(q-I*o)}function M(q,I){return C(q+I*o)}}(q,T,B,v,k,U);if(!V){for(R=0;R<3;R++)C[R]=d[R]>0?k[R]-o.max[R]:v[R]-o.base[R];o.translate(C)}return W}},14991:(q,I,l)=>{"use strict";l.d(I,{e:()=>r});var w=l(14821),t=l(13512);class O{constructor(q,I,l,O,c,a,F){this.cZ=new w(q.base,q.WZ),this.lw=I,this.friction=l,this.restitution=O,this.ia=c,this.Qo=a,this.Sa=!!F,this.RZ=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.ZT=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.fs=t.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=t.create(),this._impulses=t.create(),this._sleepFrameCount=10}loadFromCopy(q){t.j(this.cZ.base,q.cZ.base),t.j(this.cZ.WZ,q.cZ.WZ),t.j(this.cZ.max,q.cZ.max),this.cZ.mag=q.cZ.mag,this.lw=q.lw,this.friction=q.friction,this.restitution=q.restitution,this.ia=q.ia,this.Qo=q.Qo,this.Sa=q.Sa,this.RZ=q.RZ,this.fluidDrag=q.fluidDrag,this.ZT=q.ZT,this.preventFallOffEdge=q.preventFallOffEdge,this.rolledBackLastTick=q.rolledBackLastTick,t.j(this.fs,q.fs),t.j(this.resting,q.resting),this.inFluid=q.inFluid,this._ratioInFluid=q._ratioInFluid,t.j(this._forces,q._forces),t.j(this._impulses,q._impulses),this._sleepFrameCount=q._sleepFrameCount}setPosition(q){c(q),t.TI(q,q,this.cZ.base),this.cZ.translate(q),this.js()}mc(){return t.clone(this.cZ.base)}applyForce(q){c(q),t.add(this._forces,this._forces,q),this.js()}applyImpulse(q){c(q),t.add(this._impulses,this._impulses,q),this.js()}js(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var c=q=>{};var a=l(14821),F=l(13512),s=l(14830);function Z(){this.RZ=.1,this.fluidDrag=.4,this.Da=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function r(q,I,l){q=Object.assign(new Z,q),this.gravity=q.gravity||[0,-10,0],this.RZ=q.RZ||.1,this.Da=q.Da||2,this.fluidDrag=q.fluidDrag||.4,this.minBounceImpulse=q.minBounceImpulse,this.bodies=[],this.vo=q.vo,this.testSolid=I,this.testFluid=l}r.prototype.od=function(q,I,l,w,t,c){q=q||new a([0,0,0],[1,1,1]),"undefined"==typeof I&&(I=1),"undefined"==typeof l&&(l=1),"undefined"==typeof w&&(w=0),"undefined"==typeof t&&(t=1);var F=new O(q,I,l,w,t,c);return this.bodies.push(F),F},r.prototype.Ud=function(q){var I=this.bodies.indexOf(q);I<0||(this.bodies.splice(I,1),q.cZ=q.Qo=null)};var x=F.create(),o=F.create(),d=F.create(),T=F.create(),V=F.create(),U=F.create(),B=F.create(),v=new a([0,0,0],[1,1,1]),k=new O(v,1,1,0,1,(()=>{}),!1);function C(q,I,l){return I=l,I*=1-(1-q.ratioInFluid)**2}r.prototype.Qa=function(q){q/=1e3;var I=j(0,F.squaredLength(this.gravity));this.bodies.forEach((l=>function(q,I,l,w){F.j(V,I.resting),q.vo&&k.loadFromCopy(I);if(I.lw<=0)return F.set(I.fs,0,0,0),F.set(I._forces,0,0,0),void F.set(I._impulses,0,0,0);var t=w||0===I.ia;if(function(q,I,l,w){if(I._sleepFrameCount>0)return!1;if(w)return!0;var t=!1,O=.5*l*l*I.ia;return F.scale(E,q.gravity,O),s(q.testSolid,I.cZ,E,(function(){return t=!0,!0}),!0),t}(q,I,l,t))return;I._sleepFrameCount--,function(q,I){var l=I.cZ,w=Math.floor(l.base[0]),t=Math.floor(l.base[2]),O=Math.floor(l.base[1]),c=Math.floor(l.max[1]);if(!q.testFluid(w,O,t))return I.inFluid=!1,void(I.ratioInFluid=0);var a=1,s=O+1;for(;s<=c&&q.testFluid(w,s,t);)a++,s++;var Z=(O+a-l.base[1])/l.WZ[1];Z>1&&(Z=1);var r=l.WZ[0]*l.WZ[1]*l.WZ[2]*Z,x=W;F.scale(x,q.gravity,-q.Da*r*I.ia),I.applyForce(x),I.inFluid=!0,I.ratioInFluid=Z}(q,I),u(I._forces),u(I._impulses),u(I.fs),u(I.resting),F.scale(x,I._forces,1/I.lw),F.Ya(x,x,q.gravity,I.ia),F.scale(o,I._impulses,1/I.lw),F.Ya(o,o,x,l),F.add(I.fs,I.fs,o),I.friction&&(e(q,0,I,o,l),e(q,1,I,o,l),e(q,2,I,o,l));var O=I.fluidDrag>=0?I.fluidDrag:q.fluidDrag,c=I.RZ>=0?I.RZ:q.RZ,a=c,Z=c;I.inFluid&&(a=C(I,a,I.fluidDragHoriz>=0?I.fluidDragHoriz:O),Z=C(I,Z,I.fluidDragVert>=0?I.fluidDragVert:O));a=Math.max(1-a*l/I.lw,0),Z=Math.max(1-Z*l/I.lw,0),F.set(R,a,Z,a),F.multiply(I.fs,I.fs,R),F.scale(d,I.fs,l),F.set(I._forces,0,0,0),F.set(I._impulses,0,0,0),I.Sa&&h(g,I.cZ);F.j(U,d),F.set(B,0,0,0),I.preventFallOffEdge&&function(q,I,l,w){if(!I.resting[1]||l[1]>0)return;var t=n;h(t,I.cZ);for(var O=0;O<3;O+=2){F.set(M,0,0,0),M[O]=l[O];var c=!0;(c=(c=(c=(c=c&&!L(q,t.base[0]+M[0]+1e-5,t.base[1],t.base[2]+M[2]+1e-5))&&!L(q,t.max[0]+M[0]-1e-5,t.base[1],t.base[2]+M[2]+1e-5))&&!L(q,t.base[0]+M[0]+1e-5,t.base[1],t.max[2]+M[2]-1e-5))&&!L(q,t.max[0]+M[0]-1e-5,t.base[1],t.max[2]+M[2]-1e-5))?(w[O]=l[O]>0?1:-1,l[O]=0):0===O&&(F.set(f,l[0],0,0),S(q,t,f,w,I.slideOnCollision))}}(q,I,d,B);S(q,I.cZ,d,I.resting,I.slideOnCollision),I.Sa&&function(q,I,l,w){if(I.resting[1]>=0&&!I.inFluid)return;var t=0!==I.resting[0],O=0!==I.resting[2];if(!t&&!O)return;var c=Math.abs(w[0]/w[2]),a=4;if(!t&&c>a)return;if(!O&&c<1/a)return;F.add(X,l.base,w);var Z=q.testSolid;s(Z,l,w,(function(q,I,l,w){if(1!==I)return!0;w[I]=0}));var r=l.base[1],x=I.inFluid?1.951:1.001,o=Math.floor(r+x)-r;F.set(K,0,o,0);var d=!1;if(s(Z,l,K,(function(q,I,l,w){return d=!0,!0})),d)return;F.TI(D,X,l.base),D[1]=0,S(q,l,D,p,!0);var T=j(l.base[0],X[0]),V=j(l.base[2],X[2]);if(t&&!T&&(!V||!O))return;if(O&&(!T||!t)&&!V)return;var U=!0;if(U=U&&!L(q,l.base[0]+1e-5,l.base[1],l.base[2]+1e-5),U=U&&!L(q,l.max[0]-1e-5,l.base[1],l.base[2]+1e-5),U=U&&!L(q,l.base[0]+1e-5,l.base[1],l.max[2]-1e-5),U=U&&!L(q,l.max[0]-1e-5,l.base[1],l.max[2]-1e-5),U)return;h(I.cZ,l),I.resting[0]=p[0],I.resting[2]=p[2],I.ZT&&I.ZT()}(q,I,g,U);for(var r=0;r<3;++r)I.resting[r]=I.resting[r]||B[r],T[r]=0,I.resting[r]&&(V[r]||(T[r]=-I.fs[r]),I.fs[r]=0);var v=F.length(T);v>.001&&(F.scale(T,T,I.lw),I.Qo&&I.Qo(T),I.restitution>0&&v>q.minBounceImpulse&&(F.scale(T,T,I.restitution),I.applyImpulse(T)));var i=F.squaredLength(I.fs);i>1e-5&&I.js();q.vo&&q.vo(I)?(I.loadFromCopy(k),I.rolledBackLastTick=!0):I.rolledBackLastTick=!1}(this,l,q,I)))};var R=F.create([0,0,0]);var W=F.create();function e(q,I,l,w,t){var O=l.resting[I],c=w[I];if(!l.alwaysApplyHorizFriction||1!==I){if(0===O)return;if(O*c<=0)return}F.j(i,l.fs),i[I]=0;var a=F.length(i);if(!j(a,0)){var s=Math.abs(l.friction*q.gravity[I]*t),Z=a>s?(a-s)/a:0;l.fs[(I+1)%3]*=Z,l.fs[(I+2)%3]*=Z}}var i=F.create();function S(q,I,l,w,t){return F.set(w,0,0,0),s(q.testSolid,I,l,(function(q,I,l,O){w[I]=l,O[I]=0,t||(O[0]=0,O[1]=0,O[2]=0)}))}var g=new a([],[]),p=F.create(),X=F.create(),K=F.create(),D=F.create();var M=F.create(),n=new a([],[]),f=F.create();function L(q,I,l,w){return q.testSolid(Math.floor(I),Math.floor(l-1),Math.floor(w))}var E=F.create();function j(q,I){return Math.abs(q-I)<1e-5}function h(q,I){for(var l=0;l<3;l++)q.base[l]=I.base[l],q.max[l]=I.max[l],q.WZ[l]=I.WZ[l]}var u=function(q){}},13397:function(q,I){!function(q){"use strict";var I=function(q,l){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,I){q.__proto__=I}||function(q,I){for(var l in I)Object.prototype.hasOwnProperty.call(I,l)&&(q[l]=I[l])},I(q,l)};function l(q,l){if("function"!==typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function w(){this.constructor=q}I(q,l),q.prototype=null===l?Object.create(l):(w.prototype=l.prototype,new w)}function w(q,I,l,w){var t,O=arguments.length,c=O<3?I:null===w?w=Object.getOwnPropertyDescriptor(I,l):w;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)c=Reflect.decorate(q,I,l,w);else for(var a=q.length-1;a>=0;a--)(t=q[a])&&(c=(O<3?t(c):O>3?t(I,l,c):t(I,l))||c);return O>3&&c&&Object.defineProperty(I,l,c),c}function t(q,I,l){if(l||2===arguments.length)for(var w,t=0,O=I.length;t<O;t++)!w&&t in I||(w||(w=Array.prototype.slice.call(I,0,t)),w[t]=I[t]);return q.concat(w||Array.prototype.slice.call(I))}var O,c=255,a=213;q.OPERATION=void 0,(O=q.OPERATION||(q.OPERATION={}))[O.ADD=128]="ADD",O[O.REPLACE=0]="REPLACE",O[O.DELETE=64]="DELETE",O[O.DELETE_AND_ADD=192]="DELETE_AND_ADD",O[O.TOUCH=1]="TOUCH",O[O.CLEAR=10]="CLEAR";var F=function(){function I(q,I,l){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=q,this.setParent(I,l)}return I.prototype.setParent=function(q,I,l){var w=this;if(this.indexes||(this.indexes=this.ref instanceof Dq?this.ref._definition.indexes:{}),this.parent=q,this.parentIndex=l,I)if(this.root=I,this.ref instanceof Dq){var t=this.ref._definition;for(var O in t.schema){var c=this.ref[O];if(c&&c.$changes){var a=t.indexes[O];c.$changes.setParent(this.ref,I,a)}}}else"object"===typeof this.ref&&this.ref.forEach((function(q,I){if(q instanceof Dq){var l=q.$changes,t=w.ref.$changes.indexes[I];l.setParent(w.ref,w.root,t)}}))},I.prototype.operation=function(q){this.changes.set(--this.currentCustomOperation,q)},I.prototype.change=function(I,l){void 0===l&&(l=q.OPERATION.ADD);var w="number"===typeof I?I:this.indexes[I];this.assertValidIndex(w,I);var t=this.changes.get(w);t&&t.op!==q.OPERATION.DELETE&&t.op!==q.OPERATION.TOUCH||this.changes.set(w,{op:t&&t.op===q.OPERATION.DELETE?q.OPERATION.DELETE_AND_ADD:l,index:w}),this.allChanges.add(w),this.changed=!0,this.touchParents()},I.prototype.touch=function(I){var l="number"===typeof I?I:this.indexes[I];this.assertValidIndex(l,I),this.changes.has(l)||this.changes.set(l,{op:q.OPERATION.TOUCH,index:l}),this.allChanges.add(l),this.touchParents()},I.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},I.prototype.getType=function(q){if(this.ref._definition)return(I=this.ref._definition).schema[I.fieldsByIndex[q]];var I,l=(I=this.parent._definition).schema[I.fieldsByIndex[this.parentIndex]];return Object.values(l)[0]},I.prototype.getChildrenFilter=function(){var q=this.parent._definition.childFilters;return q&&q[this.parentIndex]},I.prototype.getValue=function(q){return this.ref.getByIndex(q)},I.prototype.delete=function(I){var l="number"===typeof I?I:this.indexes[I];if(void 0!==l){var w=this.getValue(l);this.changes.set(l,{op:q.OPERATION.DELETE,index:l}),this.allChanges.delete(l),delete this.caches[l],w&&w.$changes&&(w.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(I," (").concat(l,")"))},I.prototype.discard=function(I,l){var w=this;void 0===I&&(I=!1),void 0===l&&(l=!1),this.ref instanceof Dq||this.changes.forEach((function(I){if(I.op===q.OPERATION.DELETE){var l=w.ref.getIndex(I.index);delete w.indexes[l]}})),this.changes.clear(),this.changed=I,l&&this.allChanges.clear(),this.currentCustomOperation=0},I.prototype.discardAll=function(){var q=this;this.changes.forEach((function(I){var l=q.getValue(I.index);l&&l.$changes&&l.$changes.discardAll()})),this.discard()},I.prototype.cache=function(q,I){this.caches[q]=I},I.prototype.clone=function(){return new I(this.ref,this.parent,this.root)},I.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},I.prototype.assertValidIndex=function(q,I){if(void 0===q)throw new Error('ChangeTree: missing index for field "'.concat(I,'"'))},I}();function s(q,I,l,w){return q[I]||(q[I]=[]),q[I].push(l),null===w||void 0===w||w.forEach((function(q,I){return l(q,I)})),function(){return r(q[I],q[I].indexOf(l))}}function Z(I){var l=this,w="string"!==typeof this.$changes.getType();this.$items.forEach((function(t,O){I.push({refId:l.$changes.refId,op:q.OPERATION.DELETE,field:O,value:void 0,previousValue:t}),w&&l.$changes.root.removeRef(t.$changes.refId)}))}function r(q,I){if(-1===I||I>=q.length)return!1;for(var l=q.length-1,w=I;w<l;w++)q[w]=q[w+1];return q.length=l,!0}var x=function(q,I){var l=q.toString(),w=I.toString();return l<w?-1:l>w?1:0};function o(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,I){return"symbol"===typeof I||isNaN(I)?q[I]:q.at(I)},set:function(q,I,l){if("symbol"===typeof I||isNaN(I))q[I]=l;else{var w=Array.from(q.$items.keys()),t=parseInt(w[I]||I);void 0===l||null===l?q.deleteAt(t):q.setAt(t,l)}return!0},deleteProperty:function(q,I){return"number"===typeof I?q.deleteAt(I):delete q[I],!0}})}var d=function(){function I(){for(var q=[],I=0;I<arguments.length;I++)q[I]=arguments[I];this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,q)}return I.prototype.wF=function(I,l){return void 0===l&&(l=!0),s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,I,l?this.$items:void 0)},I.prototype.lt=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,I)},I.is=function(q){return Array.isArray(q)||void 0!==q.array},Object.defineProperty(I.prototype,"length",{get:function(){return this.$items.size},set:function(q){0===q?this.clear():this.splice(q,this.length-q)},enumerable:!1,configurable:!0}),I.prototype.push=function(){for(var q,I=this,l=[],w=0;w<arguments.length;w++)l[w]=arguments[w];return l.forEach((function(l){q=I.$refId++,I.setAt(q,l)})),q},I.prototype.pop=function(){var q=Array.from(this.$indexes.values()).pop();if(void 0!==q){this.$changes.delete(q),this.$indexes.delete(q);var I=this.$items.get(q);return this.$items.delete(q),I}},I.prototype.at=function(q){var I=Array.from(this.$items.keys())[q];return this.$items.get(I)},I.prototype.setAt=function(I,l){var w,t;if(void 0!==l&&null!==l){if(this.$items.get(I)!==l){void 0!==l.$changes&&l.$changes.setParent(this,this.$changes.root,I);var O=null!==(t=null===(w=this.$changes.indexes[I])||void 0===w?void 0:w.op)&&void 0!==t?t:q.OPERATION.ADD;this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,l),this.$changes.change(I,O)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},I.prototype.deleteAt=function(q){var I=Array.from(this.$items.keys())[q];return void 0!==I&&this.$deleteAt(I)},I.prototype.$deleteAt=function(q){return this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q)},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&Z.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.concat=function(){for(var q,l=[],w=0;w<arguments.length;w++)l[w]=arguments[w];return new(I.bind.apply(I,t([void 0],(q=Array.from(this.$items.values())).concat.apply(q,l),!1)))},I.prototype.join=function(q){return Array.from(this.$items.values()).join(q)},I.prototype.reverse=function(){var q=this,I=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(l,w){q.setAt(I[w],l)})),this},I.prototype.shift=function(){var q=Array.from(this.$items.keys()).shift();if(void 0!==q){var I=this.$items.get(q);return this.$deleteAt(q),I}},I.prototype.slice=function(q,l){var w=new I;return w.push.apply(w,Array.from(this.$items.values()).slice(q,l)),w},I.prototype.sort=function(q){var I=this;void 0===q&&(q=x);var l=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(q).forEach((function(q,w){I.setAt(l[w],q)})),this},I.prototype.splice=function(q,I){void 0===I&&(I=this.length-q);for(var l=Array.from(this.$items.keys()),w=[],t=q;t<q+I;t++)w.push(this.$items.get(l[t])),this.$deleteAt(l[t]);return w},I.prototype.unshift=function(){for(var q=this,I=[],l=0;l<arguments.length;l++)I[l]=arguments[l];var w=this.length,t=I.length,O=Array.from(this.$items.values());return I.forEach((function(I,l){q.setAt(l,I)})),O.forEach((function(I,l){q.setAt(t+l,I)})),w+t},I.prototype.indexOf=function(q,I){return Array.from(this.$items.values()).indexOf(q,I)},I.prototype.lastIndexOf=function(q,I){return void 0===I&&(I=this.length-1),Array.from(this.$items.values()).lastIndexOf(q,I)},I.prototype.every=function(q,I){return Array.from(this.$items.values()).every(q,I)},I.prototype.some=function(q,I){return Array.from(this.$items.values()).some(q,I)},I.prototype.forEach=function(q,I){Array.from(this.$items.values()).forEach(q,I)},I.prototype.map=function(q,I){return Array.from(this.$items.values()).map(q,I)},I.prototype.filter=function(q,I){return Array.from(this.$items.values()).filter(q,I)},I.prototype.reduce=function(q,I){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},I.prototype.reduceRight=function(q,I){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},I.prototype.find=function(q,I){return Array.from(this.$items.values()).find(q,I)},I.prototype.findIndex=function(q,I){return Array.from(this.$items.values()).findIndex(q,I)},I.prototype.fill=function(q,I,l){throw new Error("ArraySchema#fill() not implemented")},I.prototype.copyWithin=function(q,I,l){throw new Error("ArraySchema#copyWithin() not implemented")},I.prototype.toString=function(){return this.$items.toString()},I.prototype.toLocaleString=function(){return this.$items.toLocaleString()},I.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(I,Symbol.species,{get:function(){return I},enumerable:!1,configurable:!0}),I.prototype.entries=function(){return this.$items.entries()},I.prototype.keys=function(){return this.$items.keys()},I.prototype.values=function(){return this.$items.values()},I.prototype.includes=function(q,I){return Array.from(this.$items.values()).includes(q,I)},I.prototype.flatMap=function(q,I){throw new Error("ArraySchema#flatMap() is not supported.")},I.prototype.flat=function(q){throw new Error("ArraySchema#flat() is not supported.")},I.prototype.findLast=function(){var q=Array.from(this.$items.values());return q.findLast.apply(q,arguments)},I.prototype.findLastIndex=function(){var q=Array.from(this.$items.values());return q.findLastIndex.apply(q,arguments)},I.prototype.setIndex=function(q,I){this.$indexes.set(q,I)},I.prototype.getIndex=function(q){return this.$indexes.get(q)},I.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},I.prototype.deleteByIndex=function(q){var I=this.$indexes.get(q);this.$items.delete(I),this.$indexes.delete(q)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){return this.toArray().map((function(q){return"function"===typeof q.toJSON?q.toJSON():q}))},I.prototype.clone=function(q){return q?new(I.bind.apply(I,t([void 0],Array.from(this.$items.values()),!1))):new(I.bind.apply(I,t([void 0],this.map((function(q){return q.$changes?q.clone():q})),!1)))},I}();function T(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,I){return"symbol"!==typeof I&&"undefined"===typeof q[I]?q.get(I):q[I]},set:function(q,I,l){return"symbol"!==typeof I&&-1===I.indexOf("$")&&"wF"!==I&&"lt"!==I&&"onChange"!==I?q.set(I,l):q[I]=l,!0},deleteProperty:function(q,I){return q.delete(I),!0}})}var V=function(){function I(q){var l=this;if(this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q)if(q instanceof Map||q instanceof I)q.forEach((function(q,I){return l.set(I,q)}));else for(var w in q)this.set(w,q[w])}return I.prototype.wF=function(I,l){return void 0===l&&(l=!0),s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,I,l?this.$items:void 0)},I.prototype.lt=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,I)},I.is=function(q){return void 0!==q.map},I.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(I.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(I,Symbol.species,{get:function(){return I},enumerable:!1,configurable:!0}),I.prototype.set=function(I,l){if(void 0===l||null===l)throw new Error("MapSchema#set('".concat(I,"', ").concat(l,"): trying to set ").concat(l," value on '").concat(I,"'."));I=I.toString();var w="undefined"!==typeof this.$changes.indexes[I],t=w?this.$changes.indexes[I]:this.$refId++,O=w?q.OPERATION.REPLACE:q.OPERATION.ADD,c=void 0!==l.$changes;if(c&&l.$changes.setParent(this,this.$changes.root,t),w){if(!c&&this.$items.get(I)===l)return;c&&this.$items.get(I)!==l&&(O=q.OPERATION.ADD)}else this.$changes.indexes[I]=t,this.$indexes.set(t,I);return this.$items.set(I,l),this.$changes.change(I,O),this},I.prototype.get=function(q){return this.$items.get(q)},I.prototype.delete=function(q){return this.$changes.delete(q),this.$items.delete(q)},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&Z.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(q){return this.$items.has(q)},I.prototype.forEach=function(q){this.$items.forEach(q)},I.prototype.entries=function(){return this.$items.entries()},I.prototype.keys=function(){return this.$items.keys()},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(q,I){this.$indexes.set(q,I)},I.prototype.getIndex=function(q){return this.$indexes.get(q)},I.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},I.prototype.deleteByIndex=function(q){var I=this.$indexes.get(q);this.$items.delete(I),this.$indexes.delete(q)},I.prototype.toJSON=function(){var q={};return this.forEach((function(I,l){q[l]="function"===typeof I.toJSON?I.toJSON():I})),q},I.prototype.clone=function(q){var l;return q?l=Object.assign(new I,this):(l=new I,this.forEach((function(q,I){q.$changes?l.set(I,q.clone()):l.set(I,q)}))),l},I}(),U={};function B(q,I){U[q]=I}function v(q){return U[q]}var k=function(){function q(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return q.create=function(I){var l=new q;return l.schema=Object.assign({},I&&I.schema||{}),l.indexes=Object.assign({},I&&I.indexes||{}),l.fieldsByIndex=Object.assign({},I&&I.fieldsByIndex||{}),l.descriptors=Object.assign({},I&&I.descriptors||{}),l.deprecated=Object.assign({},I&&I.deprecated||{}),l},q.prototype.addField=function(q,I){var l=this.getNextFieldIndex();this.fieldsByIndex[l]=q,this.indexes[q]=l,this.schema[q]=Array.isArray(I)?{array:I[0]}:I},q.prototype.hasField=function(q){return void 0!==this.indexes[q]},q.prototype.addFilter=function(q,I){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[q]]=I,this.indexesWithFilters.push(this.indexes[q]),!0},q.prototype.addChildrenFilter=function(q,I){var l=this.indexes[q],w=this.schema[q];if(v(Object.keys(w)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[l]=I,!0;console.warn("@filterChildren: field '".concat(q,"' can't have children. Ignoring filter."))},q.prototype.getChildrenFilter=function(q){return this.childFilters&&this.childFilters[this.indexes[q]]},q.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},q}();function C(q){return q._context&&q._context.useFilters}var R=function(){function q(){this.types={},this.schemas=new Map,this.useFilters=!1}return q.prototype.has=function(q){return this.schemas.has(q)},q.prototype.get=function(q){return this.types[q]},q.prototype.add=function(q,I){void 0===I&&(I=this.schemas.size),q._definition=k.create(q._definition),q._typeid=I,this.types[I]=q,this.schemas.set(q,I)},q.create=function(I){return void 0===I&&(I={}),function(l){return I.context||(I.context=new q),e(l,I)}},q}(),W=new R;function e(q,I){return void 0===I&&(I={}),function(l,w){var O=I.context||W,c=l.constructor;if(c._context=O,!q)throw new Error("".concat(c.name,': @type() reference provided for "').concat(w,"\" is undefined. Make sure you don't have any circular dependencies."));O.has(c)||O.add(c);var a=c._definition;if(a.addField(w,q),a.descriptors[w]){if(a.deprecated[w])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(w,"' definition on '").concat(c.name,"'.\nCheck @type() annotation"))}catch(U){var F=U.stack.split("\n")[4].trim();throw new Error("".concat(U.message," ").concat(F))}}var s=d.is(q),Z=!s&&V.is(q);if("string"!==typeof q&&!Dq.is(q)){var r=Object.values(q)[0];"string"===typeof r||O.has(r)||O.add(r)}if(I.manual)a.descriptors[w]={enumerable:!0,configurable:!0,writable:!0};else{var x="_".concat(w);a.descriptors[x]={enumerable:!1,configurable:!1,writable:!0},a.descriptors[w]={get:function(){return this[x]},set:function(q){q!==this[x]&&(void 0!==q&&null!==q?(!s||q instanceof d||(q=new(d.bind.apply(d,t([void 0],q,!1)))),!Z||q instanceof V||(q=new V(q)),void 0===q.$proxy&&(Z?q=T(q):s&&(q=o(q))),this.$changes.change(w),q.$changes&&q.$changes.setParent(this,this.$changes.root,this._definition.indexes[w])):this[x]&&this.$changes.delete(w),this[x]=q)},enumerable:!0,configurable:!0}}}}function i(q){return function(I,l){var w=I.constructor;w._definition.addFilter(l,q)&&(w._context.useFilters=!0)}}function S(q){return function(I,l){var w=I.constructor;w._definition.addChildrenFilter(l,q)&&(w._context.useFilters=!0)}}function g(q){return void 0===q&&(q=!0),function(I,l){var w=I.constructor._definition;w.deprecated[l]=!0,q&&(w.descriptors[l]={get:function(){throw new Error("".concat(l," is deprecated."))},set:function(q){},enumerable:!1,configurable:!0})}}function p(q,I,l){for(var w in void 0===l&&(l={}),l.context||(l.context=q._context||l.context||W),I)e(I[w],l)(q.prototype,w);return q}function X(q){for(var I=0,l=0,w=0,t=q.length;w<t;w++)(I=q.charCodeAt(w))<128?l+=1:I<2048?l+=2:I<55296||I>=57344?l+=3:(w++,l+=4);return l}function K(q,I,l){for(var w=0,t=0,O=l.length;t<O;t++)(w=l.charCodeAt(t))<128?q[I++]=w:w<2048?(q[I++]=192|w>>6,q[I++]=128|63&w):w<55296||w>=57344?(q[I++]=224|w>>12,q[I++]=128|w>>6&63,q[I++]=128|63&w):(t++,w=65536+((1023&w)<<10|1023&l.charCodeAt(t)),q[I++]=240|w>>18,q[I++]=128|w>>12&63,q[I++]=128|w>>6&63,q[I++]=128|63&w)}function D(q,I){q.push(255&I)}function M(q,I){q.push(255&I)}function n(q,I){q.push(255&I),q.push(I>>8&255)}function f(q,I){q.push(255&I),q.push(I>>8&255)}function L(q,I){q.push(255&I),q.push(I>>8&255),q.push(I>>16&255),q.push(I>>24&255)}function E(q,I){var l=I>>24,w=I>>16,t=I>>8,O=I;q.push(255&O),q.push(255&t),q.push(255&w),q.push(255&l)}function j(q,I){var l=Math.floor(I/Math.pow(2,32));E(q,I>>>0),E(q,l)}function h(q,I){var l=I/Math.pow(2,32)|0;E(q,I>>>0),E(q,l)}function u(q,I){G(q,I)}function P(q,I){N(q,I)}var mq=new Int32Array(2),Y=new Float32Array(mq.buffer),y=new Float64Array(mq.buffer);function G(q,I){Y[0]=I,L(q,mq[0])}function N(q,I){y[0]=I,L(q,mq[0]),L(q,mq[1])}function J(q,I){return M(q,I?1:0)}function z(q,I){I||(I="");var l=X(I),w=0;if(l<32)q.push(160|l),w=1;else if(l<256)q.push(217),M(q,l),w=2;else if(l<65536)q.push(218),f(q,l),w=3;else{if(!(l<4294967296))throw new Error("String too long");q.push(219),E(q,l),w=5}return K(q,q.length,I),w+l}function H(q,I){return isNaN(I)?H(q,0):isFinite(I)?I!==(0|I)?(q.push(203),N(q,I),9):I>=0?I<128?(M(q,I),1):I<256?(q.push(204),M(q,I),2):I<65536?(q.push(205),f(q,I),3):I<4294967296?(q.push(206),E(q,I),5):(q.push(207),h(q,I),9):I>=-32?(q.push(224|I+32),1):I>=-128?(q.push(208),D(q,I),2):I>=-32768?(q.push(209),n(q,I),3):I>=-2147483648?(q.push(210),L(q,I),5):(q.push(211),j(q,I),9):H(q,I>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var A=Object.freeze({__proto__:null,utf8Write:K,int8:D,uint8:M,int16:n,uint16:f,int32:L,uint32:E,int64:j,uint64:h,float32:u,float64:P,writeFloat32:G,writeFloat64:N,boolean:J,string:z,number:H});function Q(q,I,l){for(var w="",t=0,O=I,c=I+l;O<c;O++){var a=q[O];0!==(128&a)?192!==(224&a)?224!==(240&a)?240!==(248&a)?console.error("Invalid byte "+a.toString(16)):(t=(7&a)<<18|(63&q[++O])<<12|(63&q[++O])<<6|63&q[++O])>=65536?(t-=65536,w+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):w+=String.fromCharCode(t):w+=String.fromCharCode((15&a)<<12|(63&q[++O])<<6|63&q[++O]):w+=String.fromCharCode((31&a)<<6|63&q[++O]):w+=String.fromCharCode(a)}return w}function b(q,I){return qq(q,I)<<24>>24}function qq(q,I){return q[I.offset++]}function Iq(q,I){return lq(q,I)<<16>>16}function lq(q,I){return q[I.offset++]|q[I.offset++]<<8}function wq(q,I){return q[I.offset++]|q[I.offset++]<<8|q[I.offset++]<<16|q[I.offset++]<<24}function tq(q,I){return wq(q,I)>>>0}function Oq(q,I){return xq(q,I)}function cq(q,I){return oq(q,I)}function aq(q,I){var l=tq(q,I);return wq(q,I)*Math.pow(2,32)+l}function Fq(q,I){var l=tq(q,I);return tq(q,I)*Math.pow(2,32)+l}var sq=new Int32Array(2),Zq=new Float32Array(sq.buffer),rq=new Float64Array(sq.buffer);function xq(q,I){return sq[0]=wq(q,I),Zq[0]}function oq(q,I){return sq[0]=wq(q,I),sq[1]=wq(q,I),rq[0]}function dq(q,I){return qq(q,I)>0}function Tq(q,I){var l,w=q[I.offset++];w<192?l=31&w:217===w?l=qq(q,I):218===w?l=lq(q,I):219===w&&(l=tq(q,I));var t=Q(q,I.offset,l);return I.offset+=l,t}function Vq(q,I){var l=q[I.offset];return l<192&&l>160||217===l||218===l||219===l}function Uq(q,I){var l=q[I.offset++];return l<128?l:202===l?xq(q,I):203===l?oq(q,I):204===l?qq(q,I):205===l?lq(q,I):206===l?tq(q,I):207===l?Fq(q,I):208===l?b(q,I):209===l?Iq(q,I):210===l?wq(q,I):211===l?aq(q,I):l>223?-1*(255-l+1):void 0}function Bq(q,I){var l=q[I.offset];return l<128||l>=202&&l<=211}function vq(q,I){return q[I.offset]<160}function kq(q,I){return q[I.offset-1]===c&&(q[I.offset]<128||q[I.offset]>=202&&q[I.offset]<=211)}var Cq=Object.freeze({__proto__:null,int8:b,uint8:qq,int16:Iq,uint16:lq,int32:wq,uint32:tq,float32:Oq,float64:cq,int64:aq,uint64:Fq,readFloat32:xq,readFloat64:oq,boolean:dq,string:Tq,stringCheck:Vq,number:Uq,numberCheck:Bq,arrayCheck:vq,switchStructureCheck:kq}),Rq=function(){function I(q){var I=this;this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return I.add(q)}))}return I.prototype.wF=function(I,l){return void 0===l&&(l=!0),s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,I,l?this.$items:void 0)},I.prototype.lt=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,I)},I.is=function(q){return void 0!==q.collection},I.prototype.add=function(q){var I=this.$refId++;return void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,I),this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,q),this.$changes.change(I),I},I.prototype.at=function(q){var I=Array.from(this.$items.keys())[q];return this.$items.get(I)},I.prototype.entries=function(){return this.$items.entries()},I.prototype.delete=function(q){for(var I,l,w=this.$items.entries();(l=w.next())&&!l.done;)if(q===l.value[1]){I=l.value[0];break}return void 0!==I&&(this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I))},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&Z.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(q){return Array.from(this.$items.values()).some((function(I){return I===q}))},I.prototype.forEach=function(q){var I=this;this.$items.forEach((function(l,w,t){return q(l,w,I)}))},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(q,I){this.$indexes.set(q,I)},I.prototype.getIndex=function(q){return this.$indexes.get(q)},I.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},I.prototype.deleteByIndex=function(q){var I=this.$indexes.get(q);this.$items.delete(I),this.$indexes.delete(q)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){var q=[];return this.forEach((function(I,l){q.push("function"===typeof I.toJSON?I.toJSON():I)})),q},I.prototype.clone=function(q){var l;return q?l=Object.assign(new I,this):(l=new I,this.forEach((function(q){q.$changes?l.add(q.clone()):l.add(q)}))),l},I}(),Wq=function(){function I(q){var I=this;this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return I.add(q)}))}return I.prototype.wF=function(I,l){return void 0===l&&(l=!0),s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,I,l?this.$items:void 0)},I.prototype.lt=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,I)},I.is=function(q){return void 0!==q.set},I.prototype.add=function(I){var l,w;if(this.has(I))return!1;var t=this.$refId++;void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,t);var O=null!==(w=null===(l=this.$changes.indexes[t])||void 0===l?void 0:l.op)&&void 0!==w?w:q.OPERATION.ADD;return this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,I),this.$changes.change(t,O),t},I.prototype.entries=function(){return this.$items.entries()},I.prototype.delete=function(q){for(var I,l,w=this.$items.entries();(l=w.next())&&!l.done;)if(q===l.value[1]){I=l.value[0];break}return void 0!==I&&(this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I))},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&Z.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(q){for(var I,l=this.$items.values(),w=!1;(I=l.next())&&!I.done;)if(q===I.value){w=!0;break}return w},I.prototype.forEach=function(q){var I=this;this.$items.forEach((function(l,w,t){return q(l,w,I)}))},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(q,I){this.$indexes.set(q,I)},I.prototype.getIndex=function(q){return this.$indexes.get(q)},I.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},I.prototype.deleteByIndex=function(q){var I=this.$indexes.get(q);this.$items.delete(I),this.$indexes.delete(q)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){var q=[];return this.forEach((function(I,l){q.push("function"===typeof I.toJSON?I.toJSON():I)})),q},I.prototype.clone=function(q){var l;return q?l=Object.assign(new I,this):(l=new I,this.forEach((function(q){q.$changes?l.add(q.clone()):l.add(q)}))),l},I}(),eq=function(){function q(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return q.prototype.addRefId=function(q){this.refIds.has(q)||(this.refIds.add(q),this.containerIndexes.set(q,new Set))},q.get=function(I){return void 0===I.$filterState&&(I.$filterState=new q),I.$filterState},q}(),iq=function(){function q(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return q.prototype.getNextUniqueId=function(){return this.nextUniqueId++},q.prototype.addRef=function(q,I,l){void 0===l&&(l=!0),this.refs.set(q,I),l&&(this.refCounts[q]=(this.refCounts[q]||0)+1)},q.prototype.removeRef=function(q){this.refCounts[q]=this.refCounts[q]-1,this.deletedRefs.add(q)},q.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},q.prototype.garbageCollectDeletedRefs=function(){var q=this;this.deletedRefs.forEach((function(I){if(!(q.refCounts[I]>0)){var l=q.refs.get(I);if(l instanceof Dq)for(var w in l._definition.schema)"string"!==typeof l._definition.schema[w]&&l[w]&&l[w].$changes&&q.removeRef(l[w].$changes.refId);else{var t=l.$changes.parent._definition,O=t.schema[t.fieldsByIndex[l.$changes.parentIndex]];"function"===typeof Object.values(O)[0]&&Array.from(l.values()).forEach((function(I){return q.removeRef(I.$changes.refId)}))}q.refs.delete(I),delete q.refCounts[I]}})),this.deletedRefs.clear()},q}(),Sq=function(q){function I(){return null!==q&&q.apply(this,arguments)||this}return l(I,q),I}(Error);function gq(q,I,l,w){var t,O=!1;switch(I){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":t="number",isNaN(q)&&console.log('trying to encode "NaN" in '.concat(l.constructor.name,"#").concat(w));break;case"string":t="string",O=!0;break;case"boolean":return}if(typeof q!==t&&(!O||O&&null!==q)){var c="'".concat(JSON.stringify(q),"'").concat(q&&q.constructor&&" (".concat(q.constructor.name,")")||"");throw new Sq("a '".concat(t,"' was expected, but ").concat(c," was provided in ").concat(l.constructor.name,"#").concat(w))}}function pq(q,I,l,w){if(!(q instanceof I))throw new Sq("a '".concat(I.name,"' was expected, but '").concat(q.constructor.name,"' was provided in ").concat(l.constructor.name,"#").concat(w))}function Xq(q,I,l,w,t){gq(l,q,w,t);var O=A[q];if(!O)throw new Sq("a '".concat(q,"' was expected, but ").concat(l," was provided in ").concat(w.constructor.name,"#").concat(t));O(I,l)}function Kq(q,I,l){return Cq[q](I,l)}var Dq=function(){function I(){for(var q=[],I=0;I<arguments.length;I++)q[I]=arguments[I];Object.defineProperties(this,{$changes:{value:new F(this,void 0,new iq),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var l=this._definition.descriptors;l&&Object.defineProperties(this,l),q[0]&&this.assign(q[0])}return I.onError=function(q){console.error(q)},I.is=function(q){return q._definition&&void 0!==q._definition.schema},I.prototype.onChange=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,I)},I.prototype.lt=function(I){return s(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,I)},I.prototype.assign=function(q){return Object.assign(this,q),this},Object.defineProperty(I.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),I.prototype.setDirty=function(q,I){this.$changes.change(q,I)},I.prototype.listen=function(q,I,l){var w=this;return void 0===l&&(l=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[q]||(this.$callbacks[q]=[]),this.$callbacks[q].push(I),l&&void 0!==this[q]&&I(this[q],void 0),function(){return r(w.$callbacks[q],w.$callbacks[q].indexOf(I))}},I.prototype.decode=function(l,w,t){var O;void 0===w&&(w={offset:0}),void 0===t&&(t=this);var a=[],F=this.$changes.root,s=l.length,Z=0;for(F.refs.set(Z,this);w.offset<s;){var r=l[w.offset++];if(r!=c){var x=t.$changes,o=void 0!==t._definition,T=o?r>>6<<6:r;if(T!==q.OPERATION.CLEAR){var U=o?r%(T||255):Uq(l,w),B=o?t._definition.fieldsByIndex[U]:"",k=x.getType(U),C=void 0,R=void 0,W=void 0;if(o?R=t["_".concat(B)]:(R=t.getByIndex(U),(T&q.OPERATION.ADD)===q.OPERATION.ADD?(W=t instanceof V?Tq(l,w):U,t.setIndex(U,W)):W=t.getIndex(U)),(T&q.OPERATION.DELETE)===q.OPERATION.DELETE&&(T!==q.OPERATION.DELETE_AND_ADD&&t.deleteByIndex(U),R&&R.$changes&&F.removeRef(R.$changes.refId),C=null),void 0!==B){if(T===q.OPERATION.DELETE);else if(I.is(k)){var e=Uq(l,w);if(C=F.refs.get(e),T!==q.OPERATION.REPLACE){var i=this.getSchemaType(l,w,k);C||((C=this.createTypeInstance(i)).$changes.refId=e,R&&(C.$callbacks=R.$callbacks,R.$changes.refId&&e!==R.$changes.refId&&F.removeRef(R.$changes.refId))),F.addRef(e,C,C!==R)}}else if("string"===typeof k)C=Kq(k,l,w);else{var S=v(Object.keys(k)[0]),g=Uq(l,w),p=F.refs.has(g)?R||F.refs.get(g):new S.constructor;if((C=p.clone(!0)).$changes.refId=g,R&&(C.$callbacks=R.$callbacks,R.$changes.refId&&g!==R.$changes.refId)){F.removeRef(R.$changes.refId);for(var X=R.entries(),K=void 0;(K=X.next())&&!K.done;){var D=(O=K.value)[0],M=O[1];a.push({refId:g,op:q.OPERATION.DELETE,field:D,value:void 0,previousValue:M})}}F.addRef(g,C,p!==R)}if(null!==C&&void 0!==C)if(C.$changes&&C.$changes.setParent(x.ref,x.root,U),t instanceof I)t[B]=C;else if(t instanceof V)D=W,t.$items.set(D,C),t.$changes.allChanges.add(U);else if(t instanceof d)t.setAt(U,C);else if(t instanceof Rq){var n=t.add(C);t.setIndex(U,n)}else t instanceof Wq&&!1!==(n=t.add(C))&&t.setIndex(U,n);R!==C&&a.push({refId:Z,op:T,field:B,dynamicIndex:W,value:C,previousValue:R})}else{console.warn("@colyseus/schema: definition mismatch");for(var f={offset:w.offset};w.offset<s&&(!kq(l,w)||(f.offset=w.offset+1,!F.refs.has(Uq(l,f))));)w.offset++}}else t.clear(a)}else{Z=Uq(l,w);var L=F.refs.get(Z);if(!L)throw new Error('"refId" not found: '.concat(Z));t=L}}return this._triggerChanges(a),F.garbageCollectDeletedRefs(),a},I.prototype.encode=function(l,w,t){void 0===l&&(l=!1),void 0===w&&(w=[]),void 0===t&&(t=!1);for(var O=this.$changes,a=new WeakSet,F=[O],s=1,Z=0;Z<s;Z++){var r=F[Z],x=r.ref,o=x instanceof I;r.ensureRefId(),a.add(r),r!==O&&(r.changed||l)&&(M(w,c),H(w,r.refId));for(var d=l?Array.from(r.allChanges):Array.from(r.changes.values()),T=0,U=d.length;T<U;T++){var B=l?{op:q.OPERATION.ADD,index:d[T]}:d[T],k=B.index,C=o?x._definition.fieldsByIndex&&x._definition.fieldsByIndex[k]:k,R=w.length;if(B.op!==q.OPERATION.TOUCH)if(o)M(w,k|B.op);else{if(M(w,B.op),B.op===q.OPERATION.CLEAR)continue;H(w,k)}if(o||(B.op&q.OPERATION.ADD)!=q.OPERATION.ADD||x instanceof V&&z(w,r.ref.$indexes.get(k)),B.op!==q.OPERATION.DELETE){var W=r.getType(k),e=r.getValue(k);if(e&&e.$changes&&!a.has(e.$changes)&&(F.push(e.$changes),e.$changes.ensureRefId(),s++),B.op!==q.OPERATION.TOUCH){if(I.is(W))pq(e,W,x,C),H(w,e.$changes.refId),(B.op&q.OPERATION.ADD)===q.OPERATION.ADD&&this.tryEncodeTypeId(w,W,e.constructor);else if("string"===typeof W)Xq(W,w,e,x,C);else{var i=v(Object.keys(W)[0]);pq(x["_".concat(C)],i.constructor,x,C),H(w,e.$changes.refId)}t&&r.cache(k,w.slice(R))}}}l||t||r.discard()}return w},I.prototype.encodeAll=function(q){return this.encode(!0,[],q)},I.prototype.applyFilters=function(l,w){var t,O;void 0===w&&(w=!1);for(var a=this,F=new Set,s=eq.get(l),Z=[this.$changes],r=1,x=[],o=function(o){var d=Z[o];if(F.has(d.refId))return"continue";var T=d.ref,U=T instanceof I;M(x,c),H(x,d.refId);var B=s.refIds.has(d),v=w||!B;s.addRefId(d);var k=s.containerIndexes.get(d),C=v?Array.from(d.allChanges):Array.from(d.changes.values());!w&&U&&T._definition.indexesWithFilters&&T._definition.indexesWithFilters.forEach((function(I){!k.has(I)&&d.allChanges.has(I)&&(v?C.push(I):C.push({op:q.OPERATION.ADD,index:I}))}));for(var R=0,W=C.length;R<W;R++){var e=v?{op:q.OPERATION.ADD,index:C[R]}:C[R];if(e.op!==q.OPERATION.CLEAR){var i=e.index;if(e.op!==q.OPERATION.DELETE){var S=d.getValue(i),g=d.getType(i);if(U){if((p=T._definition.filters&&T._definition.filters[i])&&!p.call(T,l,S,a)){S&&S.$changes&&F.add(S.$changes.refId);continue}}else{var p,X=d.parent;if((p=d.getChildrenFilter())&&!p.call(X,l,T.$indexes.get(i),S,a)){S&&S.$changes&&F.add(S.$changes.refId);continue}}if(S.$changes&&(Z.push(S.$changes),r++),e.op!==q.OPERATION.TOUCH)if(e.op===q.OPERATION.ADD||U)x.push.apply(x,null!==(t=d.caches[i])&&void 0!==t?t:[]),k.add(i);else if(k.has(i))x.push.apply(x,null!==(O=d.caches[i])&&void 0!==O?O:[]);else{if(k.add(i),M(x,q.OPERATION.ADD),H(x,i),T instanceof V){var K=d.ref.$indexes.get(i);z(x,K)}S.$changes?H(x,S.$changes.refId):A[g](x,S)}else S.$changes&&!U&&(M(x,q.OPERATION.ADD),H(x,i),T instanceof V&&(K=d.ref.$indexes.get(i),z(x,K)),H(x,S.$changes.refId))}else U?M(x,e.op|i):(M(x,e.op),H(x,i))}else M(x,e.op)}},d=0;d<r;d++)o(d);return x},I.prototype.clone=function(){var q,I=new this.constructor,l=this._definition.schema;for(var w in l)"object"===typeof this[w]&&"function"===typeof(null===(q=this[w])||void 0===q?void 0:q.clone)?I[w]=this[w].clone():I[w]=this[w];return I},I.prototype.toJSON=function(){var q=this._definition.schema,I=this._definition.deprecated,l={};for(var w in q)I[w]||null===this[w]||"undefined"===typeof this[w]||(l[w]="function"===typeof this[w].toJSON?this[w].toJSON():this["_".concat(w)]);return l},I.prototype.discardAllChanges=function(){this.$changes.discardAll()},I.prototype.getByIndex=function(q){return this[this._definition.fieldsByIndex[q]]},I.prototype.deleteByIndex=function(q){this[this._definition.fieldsByIndex[q]]=void 0},I.prototype.tryEncodeTypeId=function(q,I,l){I._typeid!==l._typeid&&(M(q,a),H(q,l._typeid))},I.prototype.getSchemaType=function(q,I,l){var w;return q[I.offset]===a&&(I.offset++,w=this.constructor._context.get(Uq(q,I))),w||l},I.prototype.createTypeInstance=function(q){var I=new q;return I.$changes.root=this.$changes.root,I},I.prototype._triggerChanges=function(l){for(var w,t,O,c,a,F,s,Z,r,x=new Set,o=this.$changes.root.refs,d=function(d){var T=l[d],V=T.refId,U=o.get(V),B=U.$callbacks;if((T.op&q.OPERATION.DELETE)===q.OPERATION.DELETE&&T.previousValue instanceof I&&(null===(t=null===(w=T.previousValue.$callbacks)||void 0===w?void 0:w[q.OPERATION.DELETE])||void 0===t||t.forEach((function(q){return q()}))),!B)return"continue";if(U instanceof I){if(!x.has(V))try{null===(O=null===B||void 0===B?void 0:B[q.OPERATION.REPLACE])||void 0===O||O.forEach((function(q){return q()}))}catch(v){I.onError(v)}try{B.hasOwnProperty(T.field)&&(null===(c=B[T.field])||void 0===c||c.forEach((function(q){return q(T.value,T.previousValue)})))}catch(v){I.onError(v)}}else T.op===q.OPERATION.ADD&&void 0===T.previousValue?null===(a=B[q.OPERATION.ADD])||void 0===a||a.forEach((function(q){var I;return q(T.value,null!==(I=T.dynamicIndex)&&void 0!==I?I:T.field)})):T.op===q.OPERATION.DELETE?void 0!==T.previousValue&&(null===(F=B[q.OPERATION.DELETE])||void 0===F||F.forEach((function(q){var I;return q(T.previousValue,null!==(I=T.dynamicIndex)&&void 0!==I?I:T.field)}))):T.op===q.OPERATION.DELETE_AND_ADD&&(void 0!==T.previousValue&&(null===(s=B[q.OPERATION.DELETE])||void 0===s||s.forEach((function(q){var I;return q(T.previousValue,null!==(I=T.dynamicIndex)&&void 0!==I?I:T.field)}))),null===(Z=B[q.OPERATION.ADD])||void 0===Z||Z.forEach((function(q){var I;return q(T.value,null!==(I=T.dynamicIndex)&&void 0!==I?I:T.field)}))),T.value!==T.previousValue&&(null===(r=B[q.OPERATION.REPLACE])||void 0===r||r.forEach((function(q){var I;return q(T.value,null!==(I=T.dynamicIndex)&&void 0!==I?I:T.field)})));x.add(V)},T=0;T<l.length;T++)d(T)},I._definition=k.create(),I}();function Mq(q){for(var I=[q.$changes],l=1,w={},t=w,O=function(q){var l=I[q];l.changes.forEach((function(q){var I=l.ref,w=q.index,O=I._definition?I._definition.fieldsByIndex[w]:I.$indexes.get(w);t[O]=l.getValue(w)}))},c=0;c<l;c++)O(c);return w}var nq={context:new R},fq=function(q){function I(){return null!==q&&q.apply(this,arguments)||this}return l(I,q),w([e("string",nq)],I.prototype,"name",void 0),w([e("string",nq)],I.prototype,"type",void 0),w([e("number",nq)],I.prototype,"referencedType",void 0),I}(Dq),Lq=function(q){function I(){var I=null!==q&&q.apply(this,arguments)||this;return I.fields=new d,I}return l(I,q),w([e("number",nq)],I.prototype,"id",void 0),w([e([fq],nq)],I.prototype,"fields",void 0),I}(Dq),Eq=function(q){function I(){var I=null!==q&&q.apply(this,arguments)||this;return I.types=new d,I}return l(I,q),I.encode=function(q){var l=q.constructor,w=new I;w.rootType=l._typeid;var t=function(q,I){for(var l in I){var t=new fq;t.name=l;var O=void 0;if("string"===typeof I[l])O=I[l];else{var c=I[l],a=void 0;Dq.is(c)?(O="ref",a=I[l]):"string"===typeof c[O=Object.keys(c)[0]]?O+=":"+c[O]:a=c[O],t.referencedType=a?a._typeid:-1}t.type=O,q.fields.push(t)}w.types.push(q)},O=l._context.types;for(var c in O){var a=new Lq;a.id=Number(c),t(a,O[c]._definition.schema)}return w.encodeAll()},I.decode=function(q,w){var t=new R,O=new I;O.decode(q,w);var c=O.types.reduce((function(q,I){var w=function(q){function I(){return null!==q&&q.apply(this,arguments)||this}return l(I,q),I}(Dq),O=I.id;return q[O]=w,t.add(w,O),q}),{});O.types.forEach((function(q){var I=c[q.id];q.fields.forEach((function(q){var l;if(void 0!==q.referencedType){var w=q.type,O=c[q.referencedType];if(!O){var a=q.type.split(":");w=a[0],O=a[1]}"ref"===w?e(O,{context:t})(I.prototype,q.name):e(((l={})[w]=O,l),{context:t})(I.prototype,q.name)}else e(q.type,{context:t})(I.prototype,q.name)}))}));var a=c[O.rootType],F=new a;for(var s in a._definition.schema){var Z=a._definition.schema[s];"string"!==typeof Z&&(F[s]="function"===typeof Z?new Z:new(v(Object.keys(Z)[0]).constructor))}return F},w([e([Lq],nq)],I.prototype,"types",void 0),w([e("number",nq)],I.prototype,"rootType",void 0),I}(Dq);B("map",{constructor:V}),B("array",{constructor:d}),B("set",{constructor:Wq}),B("collection",{constructor:Rq}),q.ArraySchema=d,q.CollectionSchema=Rq,q.Context=R,q.MapSchema=V,q.Reflection=Eq,q.ReflectionField=fq,q.ReflectionType=Lq,q.Schema=Dq,q.SchemaDefinition=k,q.SetSchema=Wq,q.decode=Cq,q.defineTypes=p,q.deprecated=g,q.dumpChanges=Mq,q.encode=A,q.filter=i,q.filterChildren=S,q.hasFilter=C,q.registerType=B,q.type=e,Object.defineProperty(q,"__esModule",{value:!0})}(I)},14864:function(q,I,l){var w,t,O;function c(){const q=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(c=function(){return q})()}function a(q,I){const l=c();return(a=function(q,I){return l[q-=212]})(q,I)}q=l.nmd(q),function(q){const I=a,l=q();for(;;)try{if(368192===parseInt(I(328))/1+parseInt(I(379))/2*(-parseInt(I(226))/3)+parseInt(I(348))/4*(parseInt(I(264))/5)+parseInt(I(224))/6*(-parseInt(I(223))/7)+-parseInt(I(345))/8*(parseInt(I(325))/9)+-parseInt(I(215))/10+-parseInt(I(275))/11*(-parseInt(I(383))/12))break;l.push(l.shift())}catch(w){l.push(l.shift())}}(c),function(c,F){const s=a;s(262)==typeof I&&"object"==s(262)?q[s(337)]=F():"function"==s(237)&&l.amdD[s(400)]?(t=[],void 0===(O="function"===typeof(w=F)?w.apply(I,t):w)||(q.exports=O)):s(262)==typeof I?I[s(277)]=F():c[s(277)]=F()}(this,(()=>(()=>{var q={646:function(q){q[a(337)]=function(){"use strict";function q(q){const I=a;for(var l=1;l<arguments[I(302)];l++){var w=arguments[l];for(var t in w)q[t]=w[t]}return q}return function I(l,w){const t=a;function O(I,t,O){const c=a;if(c(363)!=typeof document){"number"==typeof(O=q({},w,O))[c(278)]&&(O[c(278)]=new Date(Date[c(235)]()+864e5*O[c(278)])),O[c(278)]&&(O[c(278)]=O[c(278)][c(351)]()),I=encodeURIComponent(I).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[c(320)](/[()]/g,escape);var F="";for(var s in O)O[s]&&(F+="; "+s,!0!==O[s]&&(F+="="+O[s][c(335)](";")[0]));return document[c(295)]=I+"="+l[c(349)](t,I)+F}}return Object[t(260)]({set:O,get:function(q){const I=a;if(I(363)!=typeof document&&(!arguments[I(302)]||q)){for(var w=document.cookie?document[I(295)][I(335)]("; "):[],t={},O=0;O<w[I(302)];O++){var c=w[O][I(335)]("="),F=c[I(396)](1)[I(323)]("=");try{var s=decodeURIComponent(c[0]);if(t[s]=l[I(366)](F,s),q===s)break}catch(Z){}}return q?t[q]:t}},remove:function(I,l){O(I,"",q({},l,{expires:-1}))},withAttributes:function(l){return I(this[t(359)],q({},this.attributes,l))},withConverter:function(l){const w=t;return I(q({},this[w(359)],l),this[w(398)])}},{attributes:{value:Object[t(315)](w)},converter:{value:Object.freeze(l)}})}({read:function(q){const I=a;return'"'===q[0]&&(q=q[I(396)](1,-1)),q.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(q){const I=a;return encodeURIComponent(q)[I(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(q,I,l)=>{"use strict";const w=a;Object[w(228)](I,w(220),{value:!0}),I[w(382)]=void 0;const t=l(284);class O{static[w(218)](){const q=w;console[q(395)](q(212)),window.addEventListener(q(297),O[q(258)])}static onBeforeUnload(){const q=w;t[q(313)][q(236)]()}}I[w(382)]=O},719:(q,I,l)=>{"use strict";const w=a;Object.defineProperty(I,"__esModule",{value:!0}),I[w(290)]=void 0;const t=l(284),O=l(878);I[w(290)]=class{static[w(307)](q,I,l){const O=w;t.ByteBrewCore[O(307)](q,I,l)}static[w(339)](){const q=w;return t[q(313)][q(393)]}static[w(239)](q,I){const l=w;void 0===I?t.ByteBrewCore[l(239)](q):l(240)==typeof I?t.ByteBrewCore[l(247)](q,I):l(270)==typeof I?t[l(313)][l(243)](q,I):l(262)==typeof I&&t[l(313)][l(286)](q,I)}static loadRemoteConfigs(q){const I=w;O.RemoteConfigHandler[I(282)](q)}static[w(233)](q,I){const l=w;return O[l(272)][l(233)](q,I)}static[w(369)](){const q=w;return O[q(272)][q(369)]()}static[w(391)](){const q=w;t[q(313)][q(391)]()}static[w(384)](){const q=w;t[q(313)][q(384)]()}static[w(213)](){return t.ByteBrewCore.userID}}},441:function(q,I,l){"use strict";const w=a;var t=this&&this[w(329)]||function(q){return q&&q[w(220)]?q:{default:q}};Object[w(228)](I,w(220),{value:!0}),I[w(397)]=void 0;const O=t(l(646)),c=l(429);class F{static[w(332)](){const q=w,I=O[q(334)][q(311)](F[q(231)]);return I?{userID:I,isNewUser:!1,hasSuccessfullyInitialized:F[q(394)]()}:{userID:F.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[w(230)](){const q=w,I=(0,c.v4)();return O.default[q(242)](F[q(231)],I,{expires:365}),I}static setTrackingSettingsCookie(q){const I=w,l=I(q?248:367);O[I(334)].set(F[I(225)],l,{expires:365})}static[w(314)](){const q=w,I=O[q(334)][q(311)](F.trackingSettingsIDCookieKey);return!I||"true"===I}static[w(356)](){return F.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const q=w,I=O.default[q(311)](F[q(231)]);I&&O.default[q(242)](F.userHasInitializedSuccessfullyCookieKey,I,{expires:365})}static[w(330)](){const q=w,I=O[q(334)][q(311)](F[q(326)]),l=O[q(334)][q(311)](F[q(231)]);return!(!I||!l)&&I===l}static hasUserInitialized(){return F[w(330)]()}}I.ByteBrewCookieManager=F,F.userIDCookieKey=w(361),F.trackingSettingsIDCookieKey=w(357),F[w(326)]="bb_u_h_init"},284:(q,I,l)=>{"use strict";const w=a;Object[w(228)](I,w(220),{value:!0}),I[w(313)]=void 0;const t=l(441),O=l(797),c=l(334),F=l(429),s=l(147);class Z{static[w(246)](){const q=w;let I=navigator[q(281)][q(335)]("-");return I.length<2?"??":I[I.length-1]||"??"}static[w(307)](q,I,l){const O=w;if(Z[O(393)])return;if(console[O(395)]("ByteBrew: Starting Initialization"),!q||!I)return void console.log(O(256));if(Z[O(221)]=t[O(397)][O(356)](),!Z.trackingEnabled)return void console[O(395)](O(362));Z[O(399)]=q,Z[O(249)]=I,Z[O(336)]=l,Z.sessionID=(0,F.v4)(),Z.sessionKey="",Z[O(300)]=s[O(305)],Z.language=navigator[O(281)],Z[O(385)]=Z[O(246)]();const a=t[O(397)][O(332)]();Z[O(308)]=a[O(308)],a.isNewUser||!a[O(293)]?Z.createNewUserEvent():Z[O(344)](),Z[O(331)]=new Date,c[O(382)][O(218)]()}static reinitializeByteBrew(){const q=w;console[q(395)](q(306)),Z.initializeByteBrew(Z[q(399)],Z[q(249)],Z[q(336)])}static[w(387)](q){const I=w;Z[I(214)]=q,Z[I(393)]=!0,Z.hasBeenInitializedWhilePageOpen=!0,t[I(397)][I(296)](),console[I(395)](I(386))}static[w(301)](){const q=w;Z[q(303)]&&(console.log(q(341)),this[q(217)]())}static[w(372)](){return Z[w(393)]&&Z.trackingEnabled}static getScreenResolution(){return window[w(227)]+"x"+window.innerHeight}static[w(241)](){const q=w;return{game_id:Z[q(399)],user_id:Z[q(308)],session_id:Z[q(318)],session_key:Z.sessionKey,platform:Z.platform}}static[w(244)](){const q=w;return Object[q(219)](Object[q(219)]({},Z[q(241)]()),{version_number:Z[q(336)],sdk_version:Z[q(300)],deviceScreenSize:Z[q(280)](),tracking_enabled:Z[q(221)]})}static[w(283)](q,I){const l=w;O.ByteBrewWebRequestor[l(380)](q,I).then((q=>{const I=l;if(q&&q.ok){const l=q.headers.get(I(354));l?Z.onInitializationSuccessful(l):console[I(395)](I(381))}else console[I(395)](I(232)+(q?q[I(259)]:"No Response"))}))}static createUserEvent(){const q=w;if(!Z[q(221)])return;console.log(q(353));let I={eventType:"game_open",userLocale:Z[q(281)]};const l=Object[q(219)](Object[q(219)]({},Z[q(244)]()),{category:q(269),geo:Z[q(385)],externalData:I});Z[q(283)](O.ByteBrewWebRequestor[q(238)],l)}static[w(285)](){const q=w;if(!Z[q(221)])return;console[q(395)](q(352));let I={eventType:q(309),userLocale:Z[q(281)]};const l=Object.assign(Object.assign({},Z.getFullEventObject()),{category:q(269),geo:Z[q(385)],externalData:I});Z[q(283)](O[q(265)][q(238)],l)}static endCurrentSession(){const q=w;if(!Z[q(372)]())return;Z[q(393)]=!1,console.log(q(350));const I=new Date;let l={sessionLength:Math[q(287)]((I[q(253)]()-Z[q(331)].getTime())/1e3)[q(251)]()};const t=Object[q(219)](Object[q(219)]({},Z[q(244)]()),{category:q(401),externalData:l});O.ByteBrewWebRequestor[q(380)](O[q(265)][q(238)],t)}static[w(252)](q){const I=w;let l="";if(!q)return l;for(const[w,t]of Object.entries(q))l+=w+"="+t+";";return l[I(302)]>0&&(l=l[I(396)](0,-1)),l}static[w(368)](q,I){const l=w;if(!Z.canSendData())return;console[l(395)](l(374)+q);let t={eventType:q};I&&(t=Object.assign(Object[l(219)]({},t),{value:"object"==typeof I?Z[l(252)](I):I[l(251)]()}));const c=Object[l(219)](Object[l(219)]({},Z[l(244)]()),{category:"custom",externalData:t});O.ByteBrewWebRequestor[l(380)](O[l(265)][l(238)],c)[l(378)]((q=>{const I=l;q&&q.ok?console.log(I(274)):console[I(395)](I(294)+(q?q.status:I(267)))}))}static[w(239)](q){Z[w(368)](q,null)}static[w(247)](q,I){Z.sendCustomEvent(q,I)}static newCustomEventWithNumber(q,I){Z.sendCustomEvent(q,I)}static[w(286)](q,I){Z[w(368)](q,I)}static[w(391)](){const q=w;console[q(395)]("ByteBrew: Restarting Tracking"),Z[q(221)]=!0,t[q(397)][q(360)](!0),Z[q(217)]()}static[w(384)](){const q=w;console[q(395)](q(257)),Z[q(221)]=!1,t.ByteBrewCookieManager[q(360)](!1)}}I[w(313)]=Z,Z[w(393)]=!1,Z[w(303)]=!1,Z[w(261)]="Web"},797:function(q,I,l){"use strict";const w=a;var t=this&&this[w(342)]||function(q,I,l,w){return new(l||(l=Promise))((function(t,O){const c=a;function F(q){try{Z(w.next(q))}catch(I){O(I)}}function s(q){try{Z(w.throw(q))}catch(I){O(I)}}function Z(q){const I=a;var w;q.done?t(q.value):(w=q[I(234)],w instanceof l?w:new l((function(q){q(w)})))[I(378)](F,s)}Z((w=w[c(222)](q,I||[]))[c(255)]())}))};Object[w(228)](I,w(220),{value:!0}),I[w(265)]=void 0;const O=l(284);class c{static sendBasicRequest(q,I){return t(this,void 0,void 0,(function*(){const l=a;try{const w={method:"POST",mode:l(358),headers:{Accept:l(304),"Content-Type":l(289),"sdk-key":O[l(313)][l(249)]},body:JSON.stringify(I),keepalive:!0};return yield c[l(298)](q,w)}catch(w){console[l(284)](w)}}))}static[w(343)](q){return t(this,void 0,void 0,(function*(){const I=a;try{const l={method:I(392),mode:"cors",headers:{Accept:I(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":O[I(313)][I(249)],user_id:O[I(313)][I(308)]}};return yield c[I(298)](q,l)}catch(l){console[I(284)](l)}}))}static[w(298)](q,I){return t(this,void 0,void 0,(function*(){const l=a;try{const w=yield fetch(q,I);return w.ok||console[l(284)]("Request failed with status "+w[l(259)]),w}catch(w){console[l(284)](w)}}))}}I.ByteBrewWebRequestor=c,c[w(238)]=w(390),c[w(268)]=w(389)},878:(q,I,l)=>{"use strict";const w=a;Object.defineProperty(I,w(220),{value:!0}),I[w(272)]=void 0;const t=l(284),O=l(797);class c{static[w(292)](q){c.remoteConfigs=q}static hasRemoteConfigsBeenSet(){return!!c[w(216)]}static loadRemoteConfigs(q){const I=w;O[I(265)][I(343)](O[I(265)][I(268)]+t[I(313)].appID)[I(378)]((l=>{const w=I;l&&l.ok?l[w(371)]()[w(378)]((I=>{const l=w;let t=null;try{t=new Map(Object[l(370)](JSON[l(250)](I))),console[l(395)](l(266))}catch(O){t=null,console[l(284)](l(388))}finally{c[l(292)](t),t&&q(t)}})):l?console.error(w(322)+(l?l[w(259)]:w(267))+" "+(l?l.statusText:"")):console[w(284)](w(279))}))}static[w(233)](q,I){const l=w;return c[l(369)]()&&c.remoteConfigs[l(364)](q)?c[l(216)][l(311)](q):I}}I[w(272)]=c,c[w(216)]=null},429:(q,I,l)=>{"use strict";const w=a;Object.defineProperty(I,w(220),{value:!0}),Object[w(228)](I,w(319),{enumerable:!0,get:function(){return s[w(334)]}}),Object[w(228)](I,w(250),{enumerable:!0,get:function(){return o.default}}),Object[w(228)](I,w(333),{enumerable:!0,get:function(){return x[w(334)]}}),Object.defineProperty(I,"v1",{enumerable:!0,get:function(){return t[w(334)]}}),Object[w(228)](I,"v3",{enumerable:!0,get:function(){return O[w(334)]}}),Object[w(228)](I,"v4",{enumerable:!0,get:function(){return c[w(334)]}}),Object[w(228)](I,"v5",{enumerable:!0,get:function(){return F[w(334)]}}),Object.defineProperty(I,w(310),{enumerable:!0,get:function(){return r[w(334)]}}),Object[w(228)](I,"version",{enumerable:!0,get:function(){return Z[w(334)]}});var t=d(l(990)),O=d(l(237)),c=d(l(355)),F=d(l(764)),s=d(l(314)),Z=d(l(464)),r=d(l(435)),x=d(l(8)),o=d(l(222));function d(q){return q&&q[w(220)]?q:{default:q}}},163:(q,I)=>{"use strict";const l=a;function w(q){return 14+(q+64>>>9<<4)+1}function t(q,I){const l=(65535&q)+(65535&I);return(q>>16)+(I>>16)+(l>>16)<<16|65535&l}function O(q,I,l,w,O,c){return t((a=t(t(I,q),t(w,c)))<<(F=O)|a>>>32-F,l);var a,F}function c(q,I,l,w,t,c,a){return O(I&l|~I&w,q,I,t,c,a)}function F(q,I,l,w,t,c,a){return O(I&w|l&~w,q,I,t,c,a)}function s(q,I,l,w,t,c,a){return O(I^l^w,q,I,t,c,a)}function Z(q,I,l,w,t,c,a){return O(l^(I|~w),q,I,t,c,a)}Object.defineProperty(I,l(220),{value:!0}),I[l(334)]=void 0;I.default=function(q){const I=l;if(I(240)==typeof q){const l=unescape(encodeURIComponent(q));q=new Uint8Array(l[I(302)]);for(let w=0;w<l[I(302)];++w)q[w]=l[I(312)](w)}return function(q){const l=I,w=[],t=32*q.length,O=l(276);for(let I=0;I<t;I+=8){const t=q[I>>5]>>>I%32&255,c=parseInt(O[l(376)](t>>>4&15)+O[l(376)](15&t),16);w[l(288)](c)}return w}(function(q,l){const O=I;q[l>>5]|=128<<l%32,q[w(l)-1]=l;let a=1732584193,r=-271733879,x=-1732584194,o=271733878;for(let I=0;I<q[O(302)];I+=16){const l=a,w=r,O=x,d=o;a=c(a,r,x,o,q[I],7,-680876936),o=c(o,a,r,x,q[I+1],12,-389564586),x=c(x,o,a,r,q[I+2],17,606105819),r=c(r,x,o,a,q[I+3],22,-1044525330),a=c(a,r,x,o,q[I+4],7,-176418897),o=c(o,a,r,x,q[I+5],12,1200080426),x=c(x,o,a,r,q[I+6],17,-1473231341),r=c(r,x,o,a,q[I+7],22,-45705983),a=c(a,r,x,o,q[I+8],7,1770035416),o=c(o,a,r,x,q[I+9],12,-1958414417),x=c(x,o,a,r,q[I+10],17,-42063),r=c(r,x,o,a,q[I+11],22,-1990404162),a=c(a,r,x,o,q[I+12],7,1804603682),o=c(o,a,r,x,q[I+13],12,-40341101),x=c(x,o,a,r,q[I+14],17,-1502002290),r=c(r,x,o,a,q[I+15],22,1236535329),a=F(a,r,x,o,q[I+1],5,-165796510),o=F(o,a,r,x,q[I+6],9,-1069501632),x=F(x,o,a,r,q[I+11],14,643717713),r=F(r,x,o,a,q[I],20,-373897302),a=F(a,r,x,o,q[I+5],5,-701558691),o=F(o,a,r,x,q[I+10],9,38016083),x=F(x,o,a,r,q[I+15],14,-660478335),r=F(r,x,o,a,q[I+4],20,-405537848),a=F(a,r,x,o,q[I+9],5,568446438),o=F(o,a,r,x,q[I+14],9,-1019803690),x=F(x,o,a,r,q[I+3],14,-187363961),r=F(r,x,o,a,q[I+8],20,1163531501),a=F(a,r,x,o,q[I+13],5,-1444681467),o=F(o,a,r,x,q[I+2],9,-51403784),x=F(x,o,a,r,q[I+7],14,1735328473),r=F(r,x,o,a,q[I+12],20,-1926607734),a=s(a,r,x,o,q[I+5],4,-378558),o=s(o,a,r,x,q[I+8],11,-2022574463),x=s(x,o,a,r,q[I+11],16,1839030562),r=s(r,x,o,a,q[I+14],23,-35309556),a=s(a,r,x,o,q[I+1],4,-1530992060),o=s(o,a,r,x,q[I+4],11,1272893353),x=s(x,o,a,r,q[I+7],16,-155497632),r=s(r,x,o,a,q[I+10],23,-1094730640),a=s(a,r,x,o,q[I+13],4,681279174),o=s(o,a,r,x,q[I],11,-358537222),x=s(x,o,a,r,q[I+3],16,-722521979),r=s(r,x,o,a,q[I+6],23,76029189),a=s(a,r,x,o,q[I+9],4,-640364487),o=s(o,a,r,x,q[I+12],11,-421815835),x=s(x,o,a,r,q[I+15],16,530742520),r=s(r,x,o,a,q[I+2],23,-995338651),a=Z(a,r,x,o,q[I],6,-198630844),o=Z(o,a,r,x,q[I+7],10,1126891415),x=Z(x,o,a,r,q[I+14],15,-1416354905),r=Z(r,x,o,a,q[I+5],21,-57434055),a=Z(a,r,x,o,q[I+12],6,1700485571),o=Z(o,a,r,x,q[I+3],10,-1894986606),x=Z(x,o,a,r,q[I+10],15,-1051523),r=Z(r,x,o,a,q[I+1],21,-2054922799),a=Z(a,r,x,o,q[I+8],6,1873313359),o=Z(o,a,r,x,q[I+15],10,-30611744),x=Z(x,o,a,r,q[I+6],15,-1560198380),r=Z(r,x,o,a,q[I+13],21,1309151649),a=Z(a,r,x,o,q[I+4],6,-145523070),o=Z(o,a,r,x,q[I+11],10,-1120210379),x=Z(x,o,a,r,q[I+2],15,718787259),r=Z(r,x,o,a,q[I+9],21,-343485551),a=t(a,l),r=t(r,w),x=t(x,O),o=t(o,d)}return[a,r,x,o]}(function(q){const l=I;if(0===q[l(302)])return[];const t=8*q[l(302)],O=new Uint32Array(w(t));for(let I=0;I<t;I+=8)O[I>>5]|=(255&q[I/8])<<I%32;return O}(q),8*q[I(302)]))}},790:(q,I)=>{"use strict";const l=a;Object[l(228)](I,l(220),{value:!0}),I[l(334)]=void 0;var w={randomUUID:l(363)!=typeof crypto&&crypto[l(273)]&&crypto[l(273)][l(229)](crypto)};I.default=w},314:(q,I)=>{"use strict";const l=a;Object[l(228)](I,"__esModule",{value:!0}),I.default=void 0,I[l(334)]="00000000-0000-0000-0000-000000000000"},222:(q,I,l)=>{"use strict";const w=a;Object.defineProperty(I,w(220),{value:!0}),I[w(334)]=void 0;var t,O=(t=l(435))&&t.__esModule?t:{default:t};I[w(334)]=function(q){const I=w;if(!(0,O.default)(q))throw TypeError(I(271));let l;const t=new Uint8Array(16);return t[0]=(l=parseInt(q[I(396)](0,8),16))>>>24,t[1]=l>>>16&255,t[2]=l>>>8&255,t[3]=255&l,t[4]=(l=parseInt(q[I(396)](9,13),16))>>>8,t[5]=255&l,t[6]=(l=parseInt(q[I(396)](14,18),16))>>>8,t[7]=255&l,t[8]=(l=parseInt(q[I(396)](19,23),16))>>>8,t[9]=255&l,t[10]=(l=parseInt(q[I(396)](24,36),16))/1099511627776&255,t[11]=l/4294967296&255,t[12]=l>>>24&255,t[13]=l>>>16&255,t[14]=l>>>8&255,t[15]=255&l,t}},58:(q,I)=>{"use strict";const l=a;Object[l(228)](I,"__esModule",{value:!0}),I[l(334)]=void 0,I[l(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(q,I)=>{"use strict";const l=a;let w;Object[l(228)](I,"__esModule",{value:!0}),I[l(334)]=function(){const q=l;if(!w&&(w="undefined"!=typeof crypto&&crypto[q(254)]&&crypto.getRandomValues.bind(crypto),!w))throw new Error(q(299));return w(t)};const t=new Uint8Array(16)},757:(q,I)=>{"use strict";const l=a;function w(q,I,l,w){switch(q){case 0:return I&l^~I&w;case 1:case 3:return I^l^w;case 2:return I&l^I&w^l&w}}function t(q,I){return q<<I|q>>>32-I}Object.defineProperty(I,l(220),{value:!0}),I[l(334)]=void 0;I[l(334)]=function(q){const I=l,O=[1518500249,1859775393,2400959708,3395469782],c=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof q){const l=unescape(encodeURIComponent(q));q=[];for(let w=0;w<l[I(302)];++w)q[I(288)](l.charCodeAt(w))}else Array[I(338)](q)||(q=Array[I(340)][I(396)].call(q));q[I(288)](128);const a=q[I(302)]/4+2,F=Math[I(375)](a/16),s=new Array(F);for(let l=0;l<F;++l){const I=new Uint32Array(16);for(let w=0;w<16;++w)I[w]=q[64*l+4*w]<<24|q[64*l+4*w+1]<<16|q[64*l+4*w+2]<<8|q[64*l+4*w+3];s[l]=I}s[F-1][14]=8*(q[I(302)]-1)/Math.pow(2,32),s[F-1][14]=Math.floor(s[F-1][14]),s[F-1][15]=8*(q.length-1)&4294967295;for(let l=0;l<F;++l){const q=new Uint32Array(80);for(let I=0;I<16;++I)q[I]=s[l][I];for(let I=16;I<80;++I)q[I]=t(q[I-3]^q[I-8]^q[I-14]^q[I-16],1);let a=c[0],F=c[1],Z=c[2],r=c[3],x=c[4];for(let l=0;l<80;++l){const c=Math[I(365)](l/20),s=t(a,5)+w(c,F,Z,r)+x+O[c]+q[l]>>>0;x=r,r=Z,Z=t(F,30)>>>0,F=a,a=s}c[0]=c[0]+a>>>0,c[1]=c[1]+F>>>0,c[2]=c[2]+Z>>>0,c[3]=c[3]+r>>>0,c[4]=c[4]+x>>>0}return[c[0]>>24&255,c[0]>>16&255,c[0]>>8&255,255&c[0],c[1]>>24&255,c[1]>>16&255,c[1]>>8&255,255&c[1],c[2]>>24&255,c[2]>>16&255,c[2]>>8&255,255&c[2],c[3]>>24&255,c[3]>>16&255,c[3]>>8&255,255&c[3],c[4]>>24&255,c[4]>>16&255,c[4]>>8&255,255&c[4]]}},8:(q,I,l)=>{"use strict";const w=a;Object[w(228)](I,w(220),{value:!0}),I[w(334)]=void 0,I[w(263)]=F;var t,O=(t=l(435))&&t[w(220)]?t:{default:t};const c=[];for(let a=0;a<256;++a)c[w(288)]((a+256)[w(251)](16)[w(396)](1));function F(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=w;return(c[q[I+0]]+c[q[I+1]]+c[q[I+2]]+c[q[I+3]]+"-"+c[q[I+4]]+c[q[I+5]]+"-"+c[q[I+6]]+c[q[I+7]]+"-"+c[q[I+8]]+c[q[I+9]]+"-"+c[q[I+10]]+c[q[I+11]]+c[q[I+12]]+c[q[I+13]]+c[q[I+14]]+c[q[I+15]])[l(317)]()}I[w(334)]=function(q){const I=w,l=F(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,O.default)(l))throw TypeError(I(321));return l}},990:(q,I,l)=>{"use strict";const w=a;Object.defineProperty(I,"__esModule",{value:!0}),I[w(334)]=void 0;var t,O=(t=l(319))&&t[w(220)]?t:{default:t},c=l(8);let F,s,Z=0,r=0;I[w(334)]=function(q,I,l){const t=w;let a=I&&l||0;const x=I||new Array(16);let o=(q=q||{}).node||F,d=void 0!==q[t(324)]?q[t(324)]:s;if(null==o||null==d){const I=q[t(347)]||(q[t(355)]||O[t(334)])();null==o&&(o=F=[1|I[0],I[1],I[2],I[3],I[4],I[5]]),null==d&&(d=s=16383&(I[6]<<8|I[7]))}let T=void 0!==q[t(327)]?q.msecs:Date.now(),V=void 0!==q[t(316)]?q.nsecs:r+1;const U=T-Z+(V-r)/1e4;if(U<0&&void 0===q[t(324)]&&(d=d+1&16383),(U<0||T>Z)&&void 0===q[t(316)]&&(V=0),V>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Z=T,r=V,s=d,T+=122192928e5;const B=(1e4*(268435455&T)+V)%4294967296;x[a++]=B>>>24&255,x[a++]=B>>>16&255,x[a++]=B>>>8&255,x[a++]=255&B;const v=T/4294967296*1e4&268435455;x[a++]=v>>>8&255,x[a++]=255&v,x[a++]=v>>>24&15|16,x[a++]=v>>>16&255,x[a++]=d>>>8|128,x[a++]=255&d;for(let w=0;w<6;++w)x[a+w]=o[w];return I||(0,c[t(263)])(x)}},237:(q,I,l)=>{"use strict";const w=a;Object[w(228)](I,w(220),{value:!0}),I[w(334)]=void 0;var t=c(l(925)),O=c(l(163));function c(q){return q&&q[w(220)]?q:{default:q}}var F=(0,t.default)("v3",48,O[w(334)]);I[w(334)]=F},925:(q,I,l)=>{"use strict";const w=a;Object[w(228)](I,w(220),{value:!0}),I[w(291)]=I.DNS=void 0,I[w(334)]=function(q,I,l){const t=w;function Z(q,w,t,F){const s=a;var Z;if(s(240)==typeof q&&(q=function(q){const I=s;q=unescape(encodeURIComponent(q));const l=[];for(let w=0;w<q.length;++w)l[I(288)](q.charCodeAt(w));return l}(q)),s(240)==typeof w&&(w=(0,c[s(334)])(w)),16!==(null===(Z=w)||void 0===Z?void 0:Z[s(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let r=new Uint8Array(16+q[s(302)]);if(r.set(w),r[s(242)](q,w[s(302)]),r=l(r),r[6]=15&r[6]|I,r[8]=63&r[8]|128,t){F=F||0;for(let q=0;q<16;++q)t[F+q]=r[q];return t}return(0,O.unsafeStringify)(r)}try{Z.name=q}catch(r){}return Z[t(245)]=F,Z[t(291)]=s,Z};var t,O=l(8),c=(t=l(222))&&t[w(220)]?t:{default:t};const F="6ba7b810-9dad-11d1-80b4-00c04fd430c8";I.DNS=F;const s="6ba7b811-9dad-11d1-80b4-00c04fd430c8";I.URL=s},355:(q,I,l)=>{"use strict";const w=a;Object.defineProperty(I,"__esModule",{value:!0}),I[w(334)]=void 0;var t=F(l(790)),O=F(l(319)),c=l(8);function F(q){return q&&q.__esModule?q:{default:q}}I[w(334)]=function(q,I,l){const a=w;if(t[a(334)][a(273)]&&!I&&!q)return t.default[a(273)]();const F=(q=q||{}).random||(q[a(355)]||O.default)();if(F[6]=15&F[6]|64,F[8]=63&F[8]|128,I){l=l||0;for(let q=0;q<16;++q)I[l+q]=F[q];return I}return(0,c.unsafeStringify)(F)}},764:(q,I,l)=>{"use strict";const w=a;Object[w(228)](I,"__esModule",{value:!0}),I[w(334)]=void 0;var t=c(l(925)),O=c(l(757));function c(q){return q&&q[w(220)]?q:{default:q}}var F=(0,t[w(334)])("v5",80,O.default);I.default=F},435:(q,I,l)=>{"use strict";const w=a;Object[w(228)](I,w(220),{value:!0}),I[w(334)]=void 0;var t,O=(t=l(58))&&t.__esModule?t:{default:t};I[w(334)]=function(q){const I=w;return I(240)==typeof q&&O[I(334)][I(346)](q)}},464:(q,I,l)=>{"use strict";const w=a;Object[w(228)](I,w(220),{value:!0}),I[w(334)]=void 0;var t,O=(t=l(435))&&t[w(220)]?t:{default:t};I[w(334)]=function(q){const I=w;if(!(0,O[I(334)])(q))throw TypeError(I(271));return parseInt(q[I(396)](14,15),16)}},147:q=>{"use strict";const I=a;q[I(337)]=JSON[I(250)](I(373))}},I={};function l(w){const t=a;var O=I[w];if(void 0!==O)return O[t(337)];var c=I[w]={exports:{}};return q[w][t(377)](c[t(337)],c,c[t(337)],l),c.exports}var w={};return(()=>{"use strict";const q=a;var I=w;Object[q(228)](I,"__esModule",{value:!0}),I.ByteBrew=void 0;var t=l(719);Object[q(228)](I,q(290),{enumerable:!0,get:function(){return t[q(290)]}})})(),w})()))},14884:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14881:(q,I,l)=>{var w=l(14884),t=l(14887),O=Object.hasOwnProperty,c=Object.create(null);for(var a in w)O.call(w,a)&&(c[w[a]]=a);var F=q.exports={to:{},get:{}};function s(q,I,l){return Math.min(Math.max(I,q),l)}function Z(q){var I=Math.round(q).toString(16).toUpperCase();return I.length<2?"0"+I:I}F.get=function(q){var I,l;switch(q.substring(0,3).toLowerCase()){case"hsl":I=F.get.hsl(q),l="hsl";break;case"hwb":I=F.get.hwb(q),l="hwb";break;default:I=F.get.rgb(q),l="rgb"}return I?{model:l,value:I}:null},F.get.rgb=function(q){if(!q)return null;var I,l,t,c=[0,0,0,1];if(I=q.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(t=I[2],I=I[1],l=0;l<3;l++){var a=2*l;c[l]=parseInt(I.slice(a,a+2),16)}t&&(c[3]=parseInt(t,16)/255)}else if(I=q.match(/^#([a-f0-9]{3,4})$/i)){for(t=(I=I[1])[3],l=0;l<3;l++)c[l]=parseInt(I[l]+I[l],16);t&&(c[3]=parseInt(t+t,16)/255)}else if(I=q.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(l=0;l<3;l++)c[l]=parseInt(I[l+1],0);I[4]&&(I[5]?c[3]=.01*parseFloat(I[4]):c[3]=parseFloat(I[4]))}else{if(!(I=q.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(I=q.match(/^(\w+)$/))?"transparent"===I[1]?[0,0,0,0]:O.call(w,I[1])?((c=w[I[1]])[3]=1,c):null:null;for(l=0;l<3;l++)c[l]=Math.round(2.55*parseFloat(I[l+1]));I[4]&&(I[5]?c[3]=.01*parseFloat(I[4]):c[3]=parseFloat(I[4]))}for(l=0;l<3;l++)c[l]=s(c[l],0,255);return c[3]=s(c[3],0,1),c},F.get.hsl=function(q){if(!q)return null;var I=q.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(I){var l=parseFloat(I[4]);return[(parseFloat(I[1])%360+360)%360,s(parseFloat(I[2]),0,100),s(parseFloat(I[3]),0,100),s(isNaN(l)?1:l,0,1)]}return null},F.get.hwb=function(q){if(!q)return null;var I=q.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(I){var l=parseFloat(I[4]);return[(parseFloat(I[1])%360+360)%360,s(parseFloat(I[2]),0,100),s(parseFloat(I[3]),0,100),s(isNaN(l)?1:l,0,1)]}return null},F.to.hex=function(){var q=t(arguments);return"#"+Z(q[0])+Z(q[1])+Z(q[2])+(q[3]<1?Z(Math.round(255*q[3])):"")},F.to.rgb=function(){var q=t(arguments);return q.length<4||1===q[3]?"rgb("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+")":"rgba("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+", "+q[3]+")"},F.to.rgb.percent=function(){var q=t(arguments),I=Math.round(q[0]/255*100),l=Math.round(q[1]/255*100),w=Math.round(q[2]/255*100);return q.length<4||1===q[3]?"rgb("+I+"%, "+l+"%, "+w+"%)":"rgba("+I+"%, "+l+"%, "+w+"%, "+q[3]+")"},F.to.hsl=function(){var q=t(arguments);return q.length<4||1===q[3]?"hsl("+q[0]+", "+q[1]+"%, "+q[2]+"%)":"hsla("+q[0]+", "+q[1]+"%, "+q[2]+"%, "+q[3]+")"},F.to.hwb=function(){var q=t(arguments),I="";return q.length>=4&&1!==q[3]&&(I=", "+q[3]),"hwb("+q[0]+", "+q[1]+"%, "+q[2]+"%"+I+")"},F.to.keyword=function(q){return c[q.slice(0,3)]}},14872:(q,I,l)=>{const w=l(14881),t=l(14898),O=["keyword","gray","hex"],c={};for(const o of Object.keys(t))c[[...t[o].labels].sort().join("")]=o;const a={};function F(q,I){if(!(this instanceof F))return new F(q,I);if(I&&I in O&&(I=null),I&&!(I in t))throw new Error("Unknown model: "+I);let l,s;if(null==q)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(q instanceof F)this.model=q.model,this.color=[...q.color],this.valpha=q.valpha;else if("string"===typeof q){const I=w.get(q);if(null===I)throw new Error("Unable to parse color from string: "+q);this.model=I.model,s=t[this.model].channels,this.color=I.value.slice(0,s),this.valpha="number"===typeof I.value[s]?I.value[s]:1}else if(q.length>0){this.model=I||"rgb",s=t[this.model].channels;const l=Array.prototype.slice.call(q,0,s);this.color=x(l,s),this.valpha="number"===typeof q[s]?q[s]:1}else if("number"===typeof q)this.model="rgb",this.color=[q>>16&255,q>>8&255,255&q],this.valpha=1;else{this.valpha=1;const I=Object.keys(q);"alpha"in q&&(I.splice(I.indexOf("alpha"),1),this.valpha="number"===typeof q.alpha?q.alpha:0);const w=I.sort().join("");if(!(w in c))throw new Error("Unable to parse color from object: "+JSON.stringify(q));this.model=c[w];const{labels:O}=t[this.model],a=[];for(l=0;l<O.length;l++)a.push(q[O[l]]);this.color=x(a)}if(a[this.model])for(s=t[this.model].channels,l=0;l<s;l++){const q=a[this.model][l];q&&(this.color[l]=q(this.color[l]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}F.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(q){let I=this.model in w.to?this:this.rgb();I=I.round("number"===typeof q?q:1);const l=1===I.valpha?I.color:[...I.color,this.valpha];return w.to[I.model](l)},percentString(q){const I=this.rgb().round("number"===typeof q?q:1),l=1===I.valpha?I.color:[...I.color,this.valpha];return w.to.rgb.percent(l)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const q={},{channels:I}=t[this.model],{labels:l}=t[this.model];for(let w=0;w<I;w++)q[l[w]]=this.color[w];return 1!==this.valpha&&(q.alpha=this.valpha),q},unitArray(){const q=this.rgb().color;return q[0]/=255,q[1]/=255,q[2]/=255,1!==this.valpha&&q.push(this.valpha),q},unitObject(){const q=this.rgb().object();return q.r/=255,q.g/=255,q.b/=255,1!==this.valpha&&(q.alpha=this.valpha),q},round(q){return q=Math.max(q||0,0),new F([...this.color.map(s(q)),this.valpha],this.model)},alpha(q){return void 0!==q?new F([...this.color,Math.max(0,Math.min(1,q))],this.model):this.valpha},red:Z("rgb",0,r(255)),green:Z("rgb",1,r(255)),blue:Z("rgb",2,r(255)),hue:Z(["hsl","hsv","hsl","hwb","hcg"],0,(q=>(q%360+360)%360)),saturationl:Z("hsl",1,r(100)),lightness:Z("hsl",2,r(100)),saturationv:Z("hsv",1,r(100)),value:Z("hsv",2,r(100)),chroma:Z("hcg",1,r(100)),gray:Z("hcg",2,r(100)),white:Z("hwb",1,r(100)),wblack:Z("hwb",2,r(100)),cyan:Z("cmyk",0,r(100)),magenta:Z("cmyk",1,r(100)),yellow:Z("cmyk",2,r(100)),black:Z("cmyk",3,r(100)),x:Z("xyz",0,r(95.047)),y:Z("xyz",1,r(100)),z:Z("xyz",2,r(108.833)),l:Z("lab",0,r(100)),a:Z("lab",1),b:Z("lab",2),keyword(q){return void 0!==q?new F(q):t[this.model].keyword(this.color)},hex(q){return void 0!==q?new F(q):w.to.hex(this.rgb().round().color)},hexa(q){if(void 0!==q)return new F(q);const I=this.rgb().round().color;let l=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===l.length&&(l="0"+l),w.to.hex(I)+l},rgbNumber(){const q=this.rgb().color;return(255&q[0])<<16|(255&q[1])<<8|255&q[2]},luminosity(){const q=this.rgb().color,I=[];for(const[l,w]of q.entries()){const q=w/255;I[l]=q<=.04045?q/12.92:((q+.055)/1.055)**2.4}return.2126*I[0]+.7152*I[1]+.0722*I[2]},contrast(q){const I=this.luminosity(),l=q.luminosity();return I>l?(I+.05)/(l+.05):(l+.05)/(I+.05)},level(q){const I=this.contrast(q);return I>=7?"AAA":I>=4.5?"AA":""},isDark(){const q=this.rgb().color;return(2126*q[0]+7152*q[1]+722*q[2])/1e4<128},isLight(){return!this.isDark()},negate(){const q=this.rgb();for(let I=0;I<3;I++)q.color[I]=255-q.color[I];return q},lighten(q){const I=this.hsl();return I.color[2]+=I.color[2]*q,I},darken(q){const I=this.hsl();return I.color[2]-=I.color[2]*q,I},saturate(q){const I=this.hsl();return I.color[1]+=I.color[1]*q,I},desaturate(q){const I=this.hsl();return I.color[1]-=I.color[1]*q,I},whiten(q){const I=this.hwb();return I.color[1]+=I.color[1]*q,I},blacken(q){const I=this.hwb();return I.color[2]+=I.color[2]*q,I},grayscale(){const q=this.rgb().color,I=.3*q[0]+.59*q[1]+.11*q[2];return F.rgb(I,I,I)},fade(q){return this.alpha(this.valpha-this.valpha*q)},opaquer(q){return this.alpha(this.valpha+this.valpha*q)},rotate(q){const I=this.hsl();let l=I.color[0];return l=(l+q)%360,l=l<0?360+l:l,I.color[0]=l,I},mix(q,I){if(!q||!q.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof q);const l=q.rgb(),w=this.rgb(),t=void 0===I?.5:I,O=2*t-1,c=l.alpha()-w.alpha(),a=((O*c===-1?O:(O+c)/(1+O*c))+1)/2,s=1-a;return F.rgb(a*l.red()+s*w.red(),a*l.green()+s*w.green(),a*l.blue()+s*w.blue(),l.alpha()*t+w.alpha()*(1-t))}};for(const o of Object.keys(t)){if(O.includes(o))continue;const{channels:q}=t[o];F.prototype[o]=function(){if(this.model===o)return new F(this);for(var q=arguments.length,I=new Array(q),l=0;l<q;l++)I[l]=arguments[l];return I.length>0?new F(I,o):new F([...(w=t[this.model][o].raw(this.color),Array.isArray(w)?w:[w]),this.valpha],o);var w},F[o]=function(){for(var I=arguments.length,l=new Array(I),w=0;w<I;w++)l[w]=arguments[w];let t=l[0];return"number"===typeof t&&(t=x(l,q)),new F(t,o)}}function s(q){return function(I){return function(q,I){return Number(q.toFixed(I))}(I,q)}}function Z(q,I,l){q=Array.isArray(q)?q:[q];for(const w of q)(a[w]||(a[w]=[]))[I]=l;return q=q[0],function(w){let t;return void 0!==w?(l&&(w=l(w)),t=this[q](),t.color[I]=w,t):(t=this[q]().color[I],l&&(t=l(t)),t)}}function r(q){return function(I){return Math.max(0,Math.min(q,I))}}function x(q,I){for(let l=0;l<I;l++)"number"!==typeof q[l]&&(q[l]=0);return q}q.exports=F},14900:(q,I,l)=>{const w=l(14909),t={};for(const c of Object.keys(w))t[w[c]]=c;const O={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};q.exports=O;for(const c of Object.keys(O)){if(!("channels"in O[c]))throw new Error("missing channels property: "+c);if(!("labels"in O[c]))throw new Error("missing channel labels property: "+c);if(O[c].labels.length!==O[c].channels)throw new Error("channel and label counts mismatch: "+c);const{channels:q,labels:I}=O[c];delete O[c].channels,delete O[c].labels,Object.defineProperty(O[c],"channels",{value:q}),Object.defineProperty(O[c],"labels",{value:I})}O.rgb.hsl=function(q){const I=q[0]/255,l=q[1]/255,w=q[2]/255,t=Math.min(I,l,w),O=Math.max(I,l,w),c=O-t;let a,F;O===t?a=0:I===O?a=(l-w)/c:l===O?a=2+(w-I)/c:w===O&&(a=4+(I-l)/c),a=Math.min(60*a,360),a<0&&(a+=360);const s=(t+O)/2;return F=O===t?0:s<=.5?c/(O+t):c/(2-O-t),[a,100*F,100*s]},O.rgb.hsv=function(q){let I,l,w,t,O;const c=q[0]/255,a=q[1]/255,F=q[2]/255,s=Math.max(c,a,F),Z=s-Math.min(c,a,F),r=function(q){return(s-q)/6/Z+.5};return 0===Z?(t=0,O=0):(O=Z/s,I=r(c),l=r(a),w=r(F),c===s?t=w-l:a===s?t=1/3+I-w:F===s&&(t=2/3+l-I),t<0?t+=1:t>1&&(t-=1)),[360*t,100*O,100*s]},O.rgb.hwb=function(q){const I=q[0],l=q[1];let w=q[2];const t=O.rgb.hsl(q)[0],c=1/255*Math.min(I,Math.min(l,w));return w=1-1/255*Math.max(I,Math.max(l,w)),[t,100*c,100*w]},O.rgb.cmyk=function(q){const I=q[0]/255,l=q[1]/255,w=q[2]/255,t=Math.min(1-I,1-l,1-w);return[100*((1-I-t)/(1-t)||0),100*((1-l-t)/(1-t)||0),100*((1-w-t)/(1-t)||0),100*t]},O.rgb.keyword=function(q){const I=t[q];if(I)return I;let l,O=1/0;for(const t of Object.keys(w)){const I=w[t],F=(a=I,((c=q)[0]-a[0])**2+(c[1]-a[1])**2+(c[2]-a[2])**2);F<O&&(O=F,l=t)}var c,a;return l},O.keyword.rgb=function(q){return w[q]},O.rgb.xyz=function(q){let I=q[0]/255,l=q[1]/255,w=q[2]/255;I=I>.04045?((I+.055)/1.055)**2.4:I/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92,w=w>.04045?((w+.055)/1.055)**2.4:w/12.92;return[100*(.4124*I+.3576*l+.1805*w),100*(.2126*I+.7152*l+.0722*w),100*(.0193*I+.1192*l+.9505*w)]},O.rgb.lab=function(q){const I=O.rgb.xyz(q);let l=I[0],w=I[1],t=I[2];l/=95.047,w/=100,t/=108.883,l=l>.008856?l**(1/3):7.787*l+16/116,w=w>.008856?w**(1/3):7.787*w+16/116,t=t>.008856?t**(1/3):7.787*t+16/116;return[116*w-16,500*(l-w),200*(w-t)]},O.hsl.rgb=function(q){const I=q[0]/360,l=q[1]/100,w=q[2]/100;let t,O,c;if(0===l)return c=255*w,[c,c,c];t=w<.5?w*(1+l):w+l-w*l;const a=2*w-t,F=[0,0,0];for(let s=0;s<3;s++)O=I+1/3*-(s-1),O<0&&O++,O>1&&O--,c=6*O<1?a+6*(t-a)*O:2*O<1?t:3*O<2?a+(t-a)*(2/3-O)*6:a,F[s]=255*c;return F},O.hsl.hsv=function(q){const I=q[0];let l=q[1]/100,w=q[2]/100,t=l;const O=Math.max(w,.01);w*=2,l*=w<=1?w:2-w,t*=O<=1?O:2-O;return[I,100*(0===w?2*t/(O+t):2*l/(w+l)),100*((w+l)/2)]},O.hsv.rgb=function(q){const I=q[0]/60,l=q[1]/100;let w=q[2]/100;const t=Math.floor(I)%6,O=I-Math.floor(I),c=255*w*(1-l),a=255*w*(1-l*O),F=255*w*(1-l*(1-O));switch(w*=255,t){case 0:return[w,F,c];case 1:return[a,w,c];case 2:return[c,w,F];case 3:return[c,a,w];case 4:return[F,c,w];case 5:return[w,c,a]}},O.hsv.hsl=function(q){const I=q[0],l=q[1]/100,w=q[2]/100,t=Math.max(w,.01);let O,c;c=(2-l)*w;const a=(2-l)*t;return O=l*t,O/=a<=1?a:2-a,O=O||0,c/=2,[I,100*O,100*c]},O.hwb.rgb=function(q){const I=q[0]/360;let l=q[1]/100,w=q[2]/100;const t=l+w;let O;t>1&&(l/=t,w/=t);const c=Math.floor(6*I),a=1-w;O=6*I-c,0!==(1&c)&&(O=1-O);const F=l+O*(a-l);let s,Z,r;switch(c){default:case 6:case 0:s=a,Z=F,r=l;break;case 1:s=F,Z=a,r=l;break;case 2:s=l,Z=a,r=F;break;case 3:s=l,Z=F,r=a;break;case 4:s=F,Z=l,r=a;break;case 5:s=a,Z=l,r=F}return[255*s,255*Z,255*r]},O.cmyk.rgb=function(q){const I=q[0]/100,l=q[1]/100,w=q[2]/100,t=q[3]/100;return[255*(1-Math.min(1,I*(1-t)+t)),255*(1-Math.min(1,l*(1-t)+t)),255*(1-Math.min(1,w*(1-t)+t))]},O.xyz.rgb=function(q){const I=q[0]/100,l=q[1]/100,w=q[2]/100;let t,O,c;return t=3.2406*I+-1.5372*l+-.4986*w,O=-.9689*I+1.8758*l+.0415*w,c=.0557*I+-.204*l+1.057*w,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,O=O>.0031308?1.055*O**(1/2.4)-.055:12.92*O,c=c>.0031308?1.055*c**(1/2.4)-.055:12.92*c,t=Math.min(Math.max(0,t),1),O=Math.min(Math.max(0,O),1),c=Math.min(Math.max(0,c),1),[255*t,255*O,255*c]},O.xyz.lab=function(q){let I=q[0],l=q[1],w=q[2];I/=95.047,l/=100,w/=108.883,I=I>.008856?I**(1/3):7.787*I+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,w=w>.008856?w**(1/3):7.787*w+16/116;return[116*l-16,500*(I-l),200*(l-w)]},O.lab.xyz=function(q){let I,l,w;l=(q[0]+16)/116,I=q[1]/500+l,w=l-q[2]/200;const t=l**3,O=I**3,c=w**3;return l=t>.008856?t:(l-16/116)/7.787,I=O>.008856?O:(I-16/116)/7.787,w=c>.008856?c:(w-16/116)/7.787,I*=95.047,l*=100,w*=108.883,[I,l,w]},O.lab.lch=function(q){const I=q[0],l=q[1],w=q[2];let t;t=360*Math.atan2(w,l)/2/Math.PI,t<0&&(t+=360);return[I,Math.sqrt(l*l+w*w),t]},O.lch.lab=function(q){const I=q[0],l=q[1],w=q[2]/360*2*Math.PI;return[I,l*Math.cos(w),l*Math.sin(w)]},O.rgb.ansi16=function(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[l,w,t]=q;let c=null===I?O.rgb.hsv(q)[2]:I;if(c=Math.round(c/50),0===c)return 30;let a=30+(Math.round(t/255)<<2|Math.round(w/255)<<1|Math.round(l/255));return 2===c&&(a+=60),a},O.hsv.ansi16=function(q){return O.rgb.ansi16(O.hsv.rgb(q),q[2])},O.rgb.ansi256=function(q){const I=q[0],l=q[1],w=q[2];if(I===l&&l===w)return I<8?16:I>248?231:Math.round((I-8)/247*24)+232;return 16+36*Math.round(I/255*5)+6*Math.round(l/255*5)+Math.round(w/255*5)},O.ansi16.rgb=function(q){let I=q%10;if(0===I||7===I)return q>50&&(I+=3.5),I=I/10.5*255,[I,I,I];const l=.5*(1+~~(q>50));return[(1&I)*l*255,(I>>1&1)*l*255,(I>>2&1)*l*255]},O.ansi256.rgb=function(q){if(q>=232){const I=10*(q-232)+8;return[I,I,I]}let I;q-=16;return[Math.floor(q/36)/5*255,Math.floor((I=q%36)/6)/5*255,I%6/5*255]},O.rgb.hex=function(q){const I=(((255&Math.round(q[0]))<<16)+((255&Math.round(q[1]))<<8)+(255&Math.round(q[2]))).toString(16).toUpperCase();return"000000".substring(I.length)+I},O.hex.rgb=function(q){const I=q.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!I)return[0,0,0];let l=I[0];3===I[0].length&&(l=l.split("").map((q=>q+q)).join(""));const w=parseInt(l,16);return[w>>16&255,w>>8&255,255&w]},O.rgb.hcg=function(q){const I=q[0]/255,l=q[1]/255,w=q[2]/255,t=Math.max(Math.max(I,l),w),O=Math.min(Math.min(I,l),w),c=t-O;let a,F;return a=c<1?O/(1-c):0,F=c<=0?0:t===I?(l-w)/c%6:t===l?2+(w-I)/c:4+(I-l)/c,F/=6,F%=1,[360*F,100*c,100*a]},O.hsl.hcg=function(q){const I=q[1]/100,l=q[2]/100,w=l<.5?2*I*l:2*I*(1-l);let t=0;return w<1&&(t=(l-.5*w)/(1-w)),[q[0],100*w,100*t]},O.hsv.hcg=function(q){const I=q[1]/100,l=q[2]/100,w=I*l;let t=0;return w<1&&(t=(l-w)/(1-w)),[q[0],100*w,100*t]},O.hcg.rgb=function(q){const I=q[0]/360,l=q[1]/100,w=q[2]/100;if(0===l)return[255*w,255*w,255*w];const t=[0,0,0],O=I%1*6,c=O%1,a=1-c;let F=0;switch(Math.floor(O)){case 0:t[0]=1,t[1]=c,t[2]=0;break;case 1:t[0]=a,t[1]=1,t[2]=0;break;case 2:t[0]=0,t[1]=1,t[2]=c;break;case 3:t[0]=0,t[1]=a,t[2]=1;break;case 4:t[0]=c,t[1]=0,t[2]=1;break;default:t[0]=1,t[1]=0,t[2]=a}return F=(1-l)*w,[255*(l*t[0]+F),255*(l*t[1]+F),255*(l*t[2]+F)]},O.hcg.hsv=function(q){const I=q[1]/100,l=I+q[2]/100*(1-I);let w=0;return l>0&&(w=I/l),[q[0],100*w,100*l]},O.hcg.hsl=function(q){const I=q[1]/100,l=q[2]/100*(1-I)+.5*I;let w=0;return l>0&&l<.5?w=I/(2*l):l>=.5&&l<1&&(w=I/(2*(1-l))),[q[0],100*w,100*l]},O.hcg.hwb=function(q){const I=q[1]/100,l=I+q[2]/100*(1-I);return[q[0],100*(l-I),100*(1-l)]},O.hwb.hcg=function(q){const I=q[1]/100,l=1-q[2]/100,w=l-I;let t=0;return w<1&&(t=(l-w)/(1-w)),[q[0],100*w,100*t]},O.apple.rgb=function(q){return[q[0]/65535*255,q[1]/65535*255,q[2]/65535*255]},O.rgb.apple=function(q){return[q[0]/255*65535,q[1]/255*65535,q[2]/255*65535]},O.gray.rgb=function(q){return[q[0]/100*255,q[0]/100*255,q[0]/100*255]},O.gray.hsl=function(q){return[0,0,q[0]]},O.gray.hsv=O.gray.hsl,O.gray.hwb=function(q){return[0,100,q[0]]},O.gray.cmyk=function(q){return[0,0,0,q[0]]},O.gray.lab=function(q){return[q[0],0,0]},O.gray.hex=function(q){const I=255&Math.round(q[0]/100*255),l=((I<<16)+(I<<8)+I).toString(16).toUpperCase();return"000000".substring(l.length)+l},O.rgb.gray=function(q){return[(q[0]+q[1]+q[2])/3/255*100]}},14898:(q,I,l)=>{const w=l(14900),t=l(14911),O={};Object.keys(w).forEach((q=>{O[q]={},Object.defineProperty(O[q],"channels",{value:w[q].channels}),Object.defineProperty(O[q],"labels",{value:w[q].labels});const I=t(q);Object.keys(I).forEach((l=>{const w=I[l];O[q][l]=function(q){const I=function(){for(var I=arguments.length,l=new Array(I),w=0;w<I;w++)l[w]=arguments[w];const t=l[0];if(void 0===t||null===t)return t;t.length>1&&(l=t);const O=q(l);if("object"===typeof O)for(let q=O.length,c=0;c<q;c++)O[c]=Math.round(O[c]);return O};return"conversion"in q&&(I.conversion=q.conversion),I}(w),O[q][l].raw=function(q){const I=function(){for(var I=arguments.length,l=new Array(I),w=0;w<I;w++)l[w]=arguments[w];const t=l[0];return void 0===t||null===t?t:(t.length>1&&(l=t),q(l))};return"conversion"in q&&(I.conversion=q.conversion),I}(w)}))})),q.exports=O},14911:(q,I,l)=>{const w=l(14900);function t(q){const I=function(){const q={},I=Object.keys(w);for(let l=I.length,w=0;w<l;w++)q[I[w]]={distance:-1,parent:null};return q}(),l=[q];for(I[q].distance=0;l.length;){const q=l.pop(),t=Object.keys(w[q]);for(let w=t.length,O=0;O<w;O++){const w=t[O],c=I[w];-1===c.distance&&(c.distance=I[q].distance+1,c.parent=q,l.unshift(w))}}return I}function O(q,I){return function(l){return I(q(l))}}function c(q,I){const l=[I[q].parent,q];let t=w[I[q].parent][q],c=I[q].parent;for(;I[c].parent;)l.unshift(I[c].parent),t=O(w[I[c].parent][c],t),c=I[c].parent;return t.conversion=l,t}q.exports=function(q){const I=t(q),l={},w=Object.keys(I);for(let t=w.length,O=0;O<t;O++){const q=w[O];null!==I[q].parent&&(l[q]=c(q,I))}return l}},14909:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13430:(q,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.discordURLBuilder=void 0,I.discordURLBuilder=function(q){var I;const l=(null===(I=null===window||void 0===window?void 0:window.location)||void 0===I?void 0:I.hostname)||"localhost",w=q.hostname.split("."),t=!q.hostname.includes("trycloudflare.com")&&!q.hostname.includes("discordsays.com")&&w.length>2?`/${w[0]}`:"";return q.pathname.startsWith("/.proxy")?`${q.protocol}//${l}${t}${q.pathname}${q.search}`:`${q.protocol}//${l}/.proxy/colyseus${t}${q.pathname}${q.search}`}},13420:function(q,I,l){"use strict";var w,t,O,c,a=this&&this.__awaiter||function(q,I,l,w){return new(l||(l=Promise))((function(t,O){function c(q){try{F(w.next(q))}catch(I){O(I)}}function a(q){try{F(w.throw(q))}catch(I){O(I)}}function F(q){var I;q.done?t(q.value):(I=q.value,I instanceof l?I:new l((function(q){q(I)}))).then(c,a)}F((w=w.apply(q,I||[])).next())}))},F=this&&this.__classPrivateFieldGet||function(q,I,l,w){if("a"===l&&!w)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof I?q!==I||!w:!I.has(q))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===l?w:"a"===l?w.call(q):w?w.value:I.get(q)},s=this&&this.__classPrivateFieldSet||function(q,I,l,w,t){if("m"===w)throw new TypeError("Private method is not writable");if("a"===w&&!t)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof I?q!==I||!t:!I.has(q))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===w?t.call(q,l):t?t.value=l:I.set(q,l),l};Object.defineProperty(I,"__esModule",{value:!0}),I.Auth=void 0;const Z=l(13426),r=l(13384);I.Auth=class{constructor(q){this.http=q,this.settings={path:"/auth",key:"colyseus-auth-token"},w.set(this,!1),t.set(this,void 0),O.set(this,void 0),c.set(this,(0,r.createNanoEvents)()),(0,Z.getItem)(this.settings.key,(q=>this.token=q))}set token(q){this.http.authToken=q}get token(){return this.http.authToken}onChange(q){const I=F(this,c,"f").on("change",q);return F(this,w,"f")||s(this,t,new Promise(((q,I)=>{this.getUserData().then((q=>{this.emitChange(Object.assign(Object.assign({},q),{token:this.token}))})).catch((q=>{this.emitChange({user:null,token:void 0})})).finally((()=>{q()}))})),"f"),s(this,w,!0,"f"),I}getUserData(){return a(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(q,I,l){return a(this,void 0,void 0,(function*(){const w=(yield this.http.post(`${this.settings.path}/register`,{body:{email:q,password:I,options:l}})).data;return this.emitChange(w),w}))}signInWithEmailAndPassword(q,I){return a(this,void 0,void 0,(function*(){const l=(yield this.http.post(`${this.settings.path}/login`,{body:{email:q,password:I}})).data;return this.emitChange(l),l}))}signInAnonymously(q){return a(this,void 0,void 0,(function*(){const I=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:q}})).data;return this.emitChange(I),I}))}sendPasswordResetEmail(q){return a(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:q}})).data}))}signInWithProvider(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(this,void 0,void 0,(function*(){return new Promise(((l,w)=>{const t=I.width||480,c=I.height||768,a=this.token?`?token=${this.token}`:"",Z=`Login with ${q[0].toUpperCase()+q.substring(1)}`,r=this.http.client.getHttpEndpoint(`${I.prefix||`${this.settings.path}/provider`}/${q}${a}`),x=screen.width/2-t/2,o=screen.height/2-c/2;s(this,O,window.open(r,Z,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+t+", height="+c+", top="+o+", left="+x),"f");const d=q=>{void 0===q.data.user&&void 0===q.data.token||(clearInterval(T),F(this,O,"f").close(),s(this,O,void 0,"f"),window.removeEventListener("message",d),void 0!==q.data.error?w(q.data.error):(l(q.data),this.emitChange(q.data)))},T=setInterval((()=>{F(this,O,"f")&&!F(this,O,"f").closed||(s(this,O,void 0,"f"),w("ZO"),window.removeEventListener("message",d))}),200);window.addEventListener("message",d)}))}))}signOut(){return a(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(q){void 0!==q.token&&(this.token=q.token,null===q.token?(0,Z.removeItem)(this.settings.key):(0,Z.setItem)(this.settings.key,q.token)),F(this,c,"f").emit("change",q)}},w=new WeakMap,t=new WeakMap,O=new WeakMap,c=new WeakMap},13329:function(q,I,l){"use strict";var w,t=this&&this.__awaiter||function(q,I,l,w){return new(l||(l=Promise))((function(t,O){function c(q){try{F(w.next(q))}catch(I){O(I)}}function a(q){try{F(w.throw(q))}catch(I){O(I)}}function F(q){var I;q.done?t(q.value):(I=q.value,I instanceof l?I:new l((function(q){q(I)}))).then(c,a)}F((w=w.apply(q,I||[])).next())}))};Object.defineProperty(I,"__esModule",{value:!0}),I.Client=I.MatchMakeError=void 0;const O=l(13331),c=l(13333),a=l(13404),F=l(13420),s=l(13430);class Z extends Error{constructor(q,I){super(q),this.code=I,Object.setPrototypeOf(this,Z.prototype)}}I.MatchMakeError=Z;const r="undefined"!==typeof window&&"undefined"!==typeof(null===(w=null===window||void 0===window?void 0:window.location)||void 0===w?void 0:w.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";I.Client=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,I=arguments.length>1?arguments[1]:void 0;var l,w;if("string"===typeof q){const I=q.startsWith("/")?new URL(q,r):new URL(q),l="https:"===I.protocol||"wss:"===I.protocol,w=Number(I.port||(l?443:80));this.settings={hostname:I.hostname,pathname:I.pathname,port:w,secure:l}}else void 0===q.port&&(q.port=q.secure?443:80),void 0===q.pathname&&(q.pathname=""),this.settings=q;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new a.HTTP(this,(null===I||void 0===I?void 0:I.headers)||{}),this.auth=new F.Auth(this.http),this.urlBuilder=null===I||void 0===I?void 0:I.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(w=null===(l=null===window||void 0===window?void 0:window.location)||void 0===l?void 0:l.hostname)||void 0===w?void 0:w.includes("discordsays.com"))&&(this.urlBuilder=s.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",q,I,l)}))}create(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",q,I,l)}))}join(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",q,I,l)}))}joinById(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return t(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",q,I,l)}))}reconnect(q,I){return t(this,void 0,void 0,(function*(){if("string"===typeof q&&"string"===typeof I)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[l,w]=q.split(":");if(!l||!w)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",l,{reconnectionToken:w},I)}))}getAvailableRooms(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${q}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(q,I,l){return t(this,void 0,void 0,(function*(){const w=this.createRoom(q.room.name,I);w.roomId=q.room.roomId,w.sessionId=q.sessionId;const c={sessionId:w.sessionId};q.reconnectionToken&&(c.reconnectionToken=q.reconnectionToken);const a=l||w;return w.connect(this.buildEndpoint(q.room,c),q.devMode&&(()=>t(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${w.roomId}'...`);let l=0;const O=()=>t(this,void 0,void 0,(function*(){l++;try{yield this.consumeSeatReservation(q,I,a),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${w.roomId}'`)}catch(t){l<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${l} out of 8)`),setTimeout(O,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(O,2e3)}))),a,this.http.headers),new Promise(((q,I)=>{const l=(q,l)=>I(new O.ServerError(q,l));a.onError.once(l),a.onJoin.once((()=>{a.onError.remove(l),setTimeout((()=>{try{a.ws(128,new Uint8Array([48,243,9,128,182,101,142,61,160,217,29,109,190,0,137,137,190,52,104,84]))}catch{}}),3e3),q(a)}))}))}))}createMatchMakeRequest(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},w=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0;return t(this,void 0,void 0,(function*(){const t=(yield this.http.post(`matchmake/${q}/${I}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)})).data;if(t.error)throw new Z(t.error,t.code);return"reconnect"===q&&(t.reconnectionToken=l.reconnectionToken),yield this.consumeSeatReservation(t,w,O)}))}createRoom(q,I){return new c.Room(q,I)}buildEndpoint(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=[];for(const O in I)I.hasOwnProperty(O)&&l.push(`${O}=${I[O]}`);let w=this.settings.secure?"wss://":"ws://";q.publicAddress?w+=`${q.publicAddress}`:w+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const t=`${w}/${q.processId}/${q.roomId}?${l.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(t)):t}getHttpEndpoint(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const I=q.startsWith("/")?q:`/${q}`,l=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${I}`;return this.urlBuilder?this.urlBuilder(new URL(l)):l}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13345:(q,I,l)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Connection=void 0;const w=l(13353);I.Connection=class{constructor(){this.events={},this.transport=new w.WebSocketTransport(this.events)}send(q){this.transport.send(q)}connect(q,I){this.transport.connect(q,I)}close(q,I){this.transport.close(q,I)}get isOpen(){return this.transport.isOpen}}},13404:function(q,I,l){"use strict";var w=this&&this.__createBinding||(Object.create?function(q,I,l,w){void 0===w&&(w=l);var t=Object.getOwnPropertyDescriptor(I,l);t&&!("get"in t?!I.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return I[l]}}),Object.defineProperty(q,w,t)}:function(q,I,l,w){void 0===w&&(w=l),q[w]=I[l]}),t=this&&this.__setModuleDefault||(Object.create?function(q,I){Object.defineProperty(q,"default",{enumerable:!0,value:I})}:function(q,I){q.default=I}),O=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var I={};if(null!=q)for(var l in q)"default"!==l&&Object.prototype.hasOwnProperty.call(q,l)&&w(I,q,l);return t(I,q),I};Object.defineProperty(I,"__esModule",{value:!0}),I.HTTP=void 0;const c=l(13331),a=O(l(13411));I.HTTP=class{constructor(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=q,this.headers=I}get(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",q,I)}post(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",q,I)}del(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",q,I)}put(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",q,I)}request(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a[q](this.client.getHttpEndpoint(I),this.getOptions(l)).catch((q=>{var I;const l=q.statusCode,w=(null===(I=q.data)||void 0===I?void 0:I.error)||q.statusMessage||q.message;if(!l&&!w)throw q;throw new c.ServerError(l,w)}))}getOptions(q){return q.headers=Object.assign({},this.headers,q.headers),this.authToken&&(q.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(q.withCredentials=!0),q}}},13369:(q,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.utf8Length=I.utf8Read=I.ErrorCode=I.Protocol=void 0,function(q){q[q.HANDSHAKE=9]="HANDSHAKE",q[q.JOIN_ROOM=10]="JOIN_ROOM",q[q.ERROR=11]="ERROR",q[q.LEAVE_ROOM=12]="LEAVE_ROOM",q[q.ROOM_DATA=13]="ROOM_DATA",q[q.ROOM_STATE=14]="ROOM_STATE",q[q.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",q[q.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",q[q.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(I.Protocol||(I.Protocol={})),function(q){q[q.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",q[q.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",q[q.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",q[q.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",q[q.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",q[q.AUTH_FAILED=4215]="AUTH_FAILED",q[q.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(I.ErrorCode||(I.ErrorCode={})),I.utf8Read=function(q,I){const l=q[I++];for(var w="",t=0,O=I,c=I+l;O<c;O++){var a=q[O];if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(t=(7&a)<<18|(63&q[++O])<<12|(63&q[++O])<<6|63&q[++O])>=65536?(t-=65536,w+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):w+=String.fromCharCode(t)}else w+=String.fromCharCode((15&a)<<12|(63&q[++O])<<6|63&q[++O]);else w+=String.fromCharCode((31&a)<<6|63&q[++O]);else w+=String.fromCharCode(a)}return w},I.utf8Length=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",I=0,l=0;for(let w=0,t=q.length;w<t;w++)I=q.charCodeAt(w),I<128?l+=1:I<2048?l+=2:I<55296||I>=57344?l+=3:(w++,l+=4);return l+1}},13333:function(q,I,l){"use strict";var w=this&&this.__createBinding||(Object.create?function(q,I,l,w){void 0===w&&(w=l);var t=Object.getOwnPropertyDescriptor(I,l);t&&!("get"in t?!I.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return I[l]}}),Object.defineProperty(q,w,t)}:function(q,I,l,w){void 0===w&&(w=l),q[w]=I[l]}),t=this&&this.__setModuleDefault||(Object.create?function(q,I){Object.defineProperty(q,"default",{enumerable:!0,value:I})}:function(q,I){q.default=I}),O=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var I={};if(null!=q)for(var l in q)"default"!==l&&Object.prototype.hasOwnProperty.call(q,l)&&w(I,q,l);return t(I,q),I};Object.defineProperty(I,"__esModule",{value:!0}),I.Room=void 0;const c=O(l(13342)),a=l(13345),F=l(13369),s=l(13378),Z=l(13384),r=l(13392),x=l(13397),o=l(13331);class d{constructor(q,I){this.onStateChange=(0,r.createSignal)(),this.onError=(0,r.createSignal)(),this.onLeave=(0,r.createSignal)(),this.onJoin=(0,r.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,Z.createNanoEvents)(),this.roomId=null,this.name=q,I&&(this.serializer=new((0,s.getSerializer)("schema")),this.rootSchema=I,this.serializer.state=new I),this.onError(((q,I)=>{var l;return null===(l=console.warn)||void 0===l?void 0:l.call(console,`colyseus.js - onError => (${q}) ${I}`)})),this.onLeave((()=>this.tI()))}get id(){return this.roomId}connect(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,w=arguments.length>3?arguments[3]:void 0;const t=new a.Connection;l.connection=t,t.events.onmessage=d.prototype.onMessageCallback.bind(l),t.events.onclose=function(q){var w;if(!l.hasJoined)return null===(w=console.warn)||void 0===w||w.call(console,`Room connection was closed unexpectedly (${q.code}): ${q.reason}`),void l.onError.invoke(q.code,q.reason);q.code===o.CloseCode.DEVMODE_RESTART&&I?I():(l.onLeave.invoke(q.code,q.reason),l.destroy())},t.events.onerror=function(q){var I;null===(I=console.warn)||void 0===I||I.call(console,`Room, onError (${q.code}): ${q.reason}`),l.onError.invoke(q.code,q.reason)},t.connect(q,w)}Ha(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((I=>{this.onLeave((q=>I(q))),this.connection?q?this.connection.send([F.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(o.CloseCode.CONSENTED)}))}MI(q,I){return this.onMessageHandlers.on(this.getMessageHandlerKey(q),I)}send(q,I){const l=[F.Protocol.ROOM_DATA];let w;if("string"===typeof q?x.encode.string(l,q):x.encode.number(l,q),void 0!==I){const q=c.encode(I);w=new Uint8Array(l.length+q.byteLength),w.set(new Uint8Array(l),0),w.set(new Uint8Array(q),l.length)}else w=new Uint8Array(l);this.connection.send(w.buffer)}ws(q,I){const l=[F.Protocol.ROOM_DATA_BYTES];let w;"string"===typeof q?x.encode.string(l,q):x.encode.number(l,q),w=new Uint8Array(l.length+(I.byteLength||I.length)),w.set(new Uint8Array(l),0),w.set(new Uint8Array(I),l.length),this.connection.send(w.buffer)}get state(){return this.serializer.getState()}tI(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(q){const I=Array.from(new Uint8Array(q.data)),l=I[0];if(l===F.Protocol.JOIN_ROOM){let q=1;const l=(0,F.utf8Read)(I,q);if(q+=(0,F.utf8Length)(l),this.serializerId=(0,F.utf8Read)(I,q),q+=(0,F.utf8Length)(this.serializerId),!this.serializer){const q=(0,s.getSerializer)(this.serializerId);this.serializer=new q}I.length>q&&this.serializer.handshake&&this.serializer.handshake(I,{offset:q}),this.reconnectionToken=`${this.roomId}:${l}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([F.Protocol.JOIN_ROOM])}else if(l===F.Protocol.ERROR){const q={offset:1},l=x.decode.number(I,q),w=x.decode.string(I,q);this.onError.invoke(l,w)}else if(l===F.Protocol.LEAVE_ROOM)this.Ha();else if(l===F.Protocol.ROOM_DATA_SCHEMA){const q={offset:1},l=this.serializer.getState().constructor._context.get(x.decode.number(I,q)),w=new l;w.decode(I,q),this.dispatchMessage(l,w)}else if(l===F.Protocol.ROOM_STATE)I.shift(),this.setState(I);else if(l===F.Protocol.ROOM_STATE_PATCH)I.shift(),this.patch(I);else if(l===F.Protocol.ROOM_DATA){const l={offset:1},w=x.decode.stringCheck(I,l)?x.decode.string(I,l):x.decode.number(I,l),t=I.length>l.offset?c.decode(q.data,l.offset):void 0;this.dispatchMessage(w,t)}else if(l===F.Protocol.ROOM_DATA_BYTES){const q={offset:1},l=x.decode.stringCheck(I,q)?x.decode.string(I,q):x.decode.number(I,q);this.dispatchMessage(l,new Uint8Array(I.slice(q.offset)))}}setState(q){this.serializer.setState(q),this.onStateChange.invoke(this.serializer.getState())}patch(q){this.serializer.patch(q),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(q,I){var l;const w=this.getMessageHandlerKey(q);this.onMessageHandlers.events[w]?this.onMessageHandlers.emit(w,I):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",q,I):null===(l=console.warn)||void 0===l||l.call(console,`colyseus.js: onMessage() not registered for type '${q}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(q){switch(typeof q){case"function":return`$${q._typeid}`;case"string":return q;case"number":return`i${q}`;default:throw new Error("invalid message type.")}}}I.Room=d},13426:(q,I)=>{"use strict";let l;function w(){if(!l)try{l="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(q){}return l||(l={cache:{},setItem:function(q,I){this.cache[q]=I},getItem:function(q){this.cache[q]},removeItem:function(q){delete this.cache[q]}}),l}Object.defineProperty(I,"__esModule",{value:!0}),I.getItem=I.removeItem=I.setItem=void 0,I.setItem=function(q,I){w().setItem(q,I)},I.removeItem=function(q){w().removeItem(q)},I.getItem=function(q,I){const l=w().getItem(q);"undefined"!==typeof Promise&&l instanceof Promise?l.then((q=>I(q))):I(l)}},13384:(q,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.createNanoEvents=void 0;I.createNanoEvents=()=>({emit(q){let I=this.events[q]||[];for(var l=arguments.length,w=new Array(l>1?l-1:0),t=1;t<l;t++)w[t-1]=arguments[t];for(let O=0,c=I.length;O<c;O++)I[O](...w)},events:{},on(q,I){var l;return(null===(l=this.events[q])||void 0===l?void 0:l.push(I))||(this.events[q]=[I]),()=>{var l;this.events[q]=null===(l=this.events[q])||void 0===l?void 0:l.filter((q=>I!==q))}}})},13392:(q,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.createSignal=I.EventEmitter=void 0;class l{constructor(){this.handlers=[]}register(q){return this.handlers.push(q),this}invoke(){for(var q=arguments.length,I=new Array(q),l=0;l<q;l++)I[l]=arguments[l];this.handlers.forEach((q=>q.apply(this,I)))}invokeAsync(){for(var q=arguments.length,I=new Array(q),l=0;l<q;l++)I[l]=arguments[l];return Promise.all(this.handlers.map((q=>q.apply(this,I))))}remove(q){const I=this.handlers.indexOf(q);this.handlers[I]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}I.EventEmitter=l,I.createSignal=function(){const q=new l;function I(I){return q.register(I,null===this)}return I.once=I=>{const l=function(){for(var w=arguments.length,t=new Array(w),O=0;O<w;O++)t[O]=arguments[O];I.apply(this,t),q.remove(l)};q.register(l)},I.remove=I=>q.remove(I),I.invoke=function(){return q.invoke(...arguments)},I.invokeAsync=function(){return q.invokeAsync(...arguments)},I.clear=()=>q.clear(),I}},13331:(q,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.ServerError=I.CloseCode=void 0,function(q){q[q.CONSENTED=4e3]="CONSENTED",q[q.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(I.CloseCode||(I.CloseCode={}));class l extends Error{constructor(q,I){super(I),this.name="ServerError",this.code=q}}I.ServerError=l},13314:(q,I,l)=>{"use strict";I.e=void 0,l(13321);var w=l(13329);Object.defineProperty(I,"e",{enumerable:!0,get:function(){return w.Client}});var t=l(13369);var O=l(13333);var c=l(13420);const a=l(13432);const F=l(13440),s=l(13378);(0,s.registerSerializer)("schema",a.SchemaSerializer),(0,s.registerSerializer)("none",F.NoneSerializer)},13321:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=q=>null!==q&&"object"===typeof q&&q.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13342:(q,I)=>{"use strict";function l(q,I){if(this._offset=I,q instanceof ArrayBuffer)this._buffer=q,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(q))throw new Error("Invalid argument");this._buffer=q.buffer,this._view=new DataView(this._buffer,q.byteOffset,q.byteLength)}}Object.defineProperty(I,"__esModule",{value:!0}),I.decode=I.encode=void 0,l.prototype._array=function(q){for(var I=new Array(q),l=0;l<q;l++)I[l]=this._parse();return I},l.prototype._map=function(q){for(var I={},l=0;l<q;l++)I[this._parse()]=this._parse();return I},l.prototype._str=function(q){var I=function(q,I,l){for(var w="",t=0,O=I,c=I+l;O<c;O++){var a=q.getUint8(O);if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(t=(7&a)<<18|(63&q.getUint8(++O))<<12|(63&q.getUint8(++O))<<6|63&q.getUint8(++O))>=65536?(t-=65536,w+=String.fromCharCode(55296+(t>>>10),56320+(1023&t))):w+=String.fromCharCode(t)}else w+=String.fromCharCode((15&a)<<12|(63&q.getUint8(++O))<<6|63&q.getUint8(++O));else w+=String.fromCharCode((31&a)<<6|63&q.getUint8(++O));else w+=String.fromCharCode(a)}return w}(this._view,this._offset,q);return this._offset+=q,I},l.prototype._bin=function(q){var I=this._buffer.slice(this._offset,this._offset+q);return this._offset+=q,I},l.prototype._parse=function(){var q,I=this._view.getUint8(this._offset++),l=0,w=0,t=0,O=0;if(I<192)return I<128?I:I<144?this._map(15&I):I<160?this._array(15&I):this._str(31&I);if(I>223)return-1*(255-I+1);switch(I){case 192:return null;case 194:return!1;case 195:return!0;case 196:return l=this._view.getUint8(this._offset),this._offset+=1,this._bin(l);case 197:return l=this._view.getUint16(this._offset),this._offset+=2,this._bin(l);case 198:return l=this._view.getUint32(this._offset),this._offset+=4,this._bin(l);case 199:if(l=this._view.getUint8(this._offset),w=this._view.getInt8(this._offset+1),this._offset+=2,-1===w){var c=this._view.getUint32(this._offset);return t=this._view.getInt32(this._offset+4),O=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*t+O)+c/1e6)}return[w,this._bin(l)];case 200:return l=this._view.getUint16(this._offset),w=this._view.getInt8(this._offset+2),this._offset+=3,[w,this._bin(l)];case 201:return l=this._view.getUint32(this._offset),w=this._view.getInt8(this._offset+4),this._offset+=5,[w,this._bin(l)];case 202:return q=this._view.getFloat32(this._offset),this._offset+=4,q;case 203:return q=this._view.getFloat64(this._offset),this._offset+=8,q;case 204:return q=this._view.getUint8(this._offset),this._offset+=1,q;case 205:return q=this._view.getUint16(this._offset),this._offset+=2,q;case 206:return q=this._view.getUint32(this._offset),this._offset+=4,q;case 207:return t=this._view.getUint32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,t+O;case 208:return q=this._view.getInt8(this._offset),this._offset+=1,q;case 209:return q=this._view.getInt16(this._offset),this._offset+=2,q;case 210:return q=this._view.getInt32(this._offset),this._offset+=4,q;case 211:return t=this._view.getInt32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,t+O;case 212:return w=this._view.getInt8(this._offset),this._offset+=1,0===w?void(this._offset+=1):[w,this._bin(1)];case 213:return w=this._view.getInt8(this._offset),this._offset+=1,[w,this._bin(2)];case 214:return w=this._view.getInt8(this._offset),this._offset+=1,-1===w?(q=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*q)):[w,this._bin(4)];case 215:return w=this._view.getInt8(this._offset),this._offset+=1,0===w?(t=this._view.getInt32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,new Date(t+O)):-1===w?(t=this._view.getUint32(this._offset),O=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&t)+O)+(t>>>2)/1e6)):[w,this._bin(8)];case 216:return w=this._view.getInt8(this._offset),this._offset+=1,[w,this._bin(16)];case 217:return l=this._view.getUint8(this._offset),this._offset+=1,this._str(l);case 218:return l=this._view.getUint16(this._offset),this._offset+=2,this._str(l);case 219:return l=this._view.getUint32(this._offset),this._offset+=4,this._str(l);case 220:return l=this._view.getUint16(this._offset),this._offset+=2,this._array(l);case 221:return l=this._view.getUint32(this._offset),this._offset+=4,this._array(l);case 222:return l=this._view.getUint16(this._offset),this._offset+=2,this._map(l);case 223:return l=this._view.getUint32(this._offset),this._offset+=4,this._map(l)}throw new Error("Could not parse")},I.decode=function(q){var I=new l(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),w=I._parse();if(I._offset!==q.byteLength)throw new Error(q.byteLength-I._offset+" trailing bytes");return w};function w(q,I,l){for(var w=0,t=0,O=l.length;t<O;t++)(w=l.charCodeAt(t))<128?q.setUint8(I++,w):w<2048?(q.setUint8(I++,192|w>>6),q.setUint8(I++,128|63&w)):w<55296||w>=57344?(q.setUint8(I++,224|w>>12),q.setUint8(I++,128|w>>6&63),q.setUint8(I++,128|63&w)):(t++,w=65536+((1023&w)<<10|1023&l.charCodeAt(t)),q.setUint8(I++,240|w>>18),q.setUint8(I++,128|w>>12&63),q.setUint8(I++,128|w>>6&63),q.setUint8(I++,128|63&w))}function t(q,I,l){var w=typeof l,O=0,c=0,a=0,F=0,s=0,Z=0;if("string"===w){if(s=function(q){for(var I=0,l=0,w=0,t=q.length;w<t;w++)(I=q.charCodeAt(w))<128?l+=1:I<2048?l+=2:I<55296||I>=57344?l+=3:(w++,l+=4);return l}(l),s<32)q.push(160|s),Z=1;else if(s<256)q.push(217,s),Z=2;else if(s<65536)q.push(218,s>>8,s),Z=3;else{if(!(s<4294967296))throw new Error("String too long");q.push(219,s>>24,s>>16,s>>8,s),Z=5}return I.push({_str:l,_length:s,_offset:q.length}),Z+s}if("number"===w)return Math.floor(l)===l&&isFinite(l)?l>=0?l<128?(q.push(l),1):l<256?(q.push(204,l),2):l<65536?(q.push(205,l>>8,l),3):l<4294967296?(q.push(206,l>>24,l>>16,l>>8,l),5):(a=l/Math.pow(2,32)|0,F=l>>>0,q.push(207,a>>24,a>>16,a>>8,a,F>>24,F>>16,F>>8,F),9):l>=-32?(q.push(l),1):l>=-128?(q.push(208,l),2):l>=-32768?(q.push(209,l>>8,l),3):l>=-2147483648?(q.push(210,l>>24,l>>16,l>>8,l),5):(a=Math.floor(l/Math.pow(2,32)),F=l>>>0,q.push(211,a>>24,a>>16,a>>8,a,F>>24,F>>16,F>>8,F),9):(q.push(203),I.push({_float:l,_length:8,_offset:q.length}),9);if("object"===w){if(null===l)return q.push(192),1;if(Array.isArray(l)){if((s=l.length)<16)q.push(144|s),Z=1;else if(s<65536)q.push(220,s>>8,s),Z=3;else{if(!(s<4294967296))throw new Error("Array too large");q.push(221,s>>24,s>>16,s>>8,s),Z=5}for(O=0;O<s;O++)Z+=t(q,I,l[O]);return Z}if(l instanceof Date){var r=l.getTime(),x=Math.floor(r/1e3),o=1e6*(r-1e3*x);return x>=0&&o>=0&&x<=17179869183?0===o&&x<=4294967295?(q.push(214,255,x>>24,x>>16,x>>8,x),6):(a=x/4294967296,F=4294967295&x,q.push(215,255,o>>22,o>>14,o>>6,a,F>>24,F>>16,F>>8,F),10):(a=Math.floor(x/4294967296),F=x>>>0,q.push(199,12,255,o>>24,o>>16,o>>8,o,a>>24,a>>16,a>>8,a,F>>24,F>>16,F>>8,F),15)}if(l instanceof ArrayBuffer){if((s=l.byteLength)<256)q.push(196,s),Z=2;else if(s<65536)q.push(197,s>>8,s),Z=3;else{if(!(s<4294967296))throw new Error("Buffer too large");q.push(198,s>>24,s>>16,s>>8,s),Z=5}return I.push({_bin:l,_length:s,_offset:q.length}),Z+s}if("function"===typeof l.toJSON)return t(q,I,l.toJSON());var d=[],T="",V=Object.keys(l);for(O=0,c=V.length;O<c;O++)void 0!==l[T=V[O]]&&"function"!==typeof l[T]&&d.push(T);if((s=d.length)<16)q.push(128|s),Z=1;else if(s<65536)q.push(222,s>>8,s),Z=3;else{if(!(s<4294967296))throw new Error("Object too large");q.push(223,s>>24,s>>16,s>>8,s),Z=5}for(O=0;O<s;O++)Z+=t(q,I,T=d[O]),Z+=t(q,I,l[T]);return Z}if("boolean"===w)return q.push(l?195:194),1;if("undefined"===w)return q.push(192),1;if("function"===typeof l.toJSON)return t(q,I,l.toJSON());throw new Error("Could not encode")}I.encode=function(q){var I=[],l=[],O=t(I,l,q),c=new ArrayBuffer(O),a=new DataView(c),F=0,s=0,Z=-1;l.length>0&&(Z=l[0]._offset);for(var r,x=0,o=0,d=0,T=I.length;d<T;d++)if(a.setUint8(s+d,I[d]),d+1===Z){if(x=(r=l[F])._length,o=s+Z,r._bin)for(var V=new Uint8Array(r._bin),U=0;U<x;U++)a.setUint8(o+U,V[U]);else r._str?w(a,o,r._str):void 0!==r._float&&a.setFloat64(o,r._float);s+=x,l[++F]&&(Z=l[F]._offset)}return c}},13440:(q,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.NoneSerializer=void 0;I.NoneSerializer=class{setState(q){}getState(){return null}patch(q){}teardown(){}handshake(q){}}},13432:(q,I,l)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.SchemaSerializer=void 0;const w=l(13397);I.SchemaSerializer=class{setState(q){return this.state.decode(q)}getState(){return this.state}patch(q){return this.state.decode(q)}teardown(){var q,I;null===(I=null===(q=this.state)||void 0===q?void 0:q.$changes)||void 0===I||I.root.clearRefs()}handshake(q,I){if(this.state){(new w.Reflection).decode(q,I)}else this.state=w.Reflection.decode(q,I)}}},13378:(q,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.getSerializer=I.registerSerializer=void 0;const l={};I.registerSerializer=function(q,I){l[q]=I},I.getSerializer=function(q){const I=l[q];if(!I)throw new Error("missing serializer: "+q);return I}},13353:function(q,I,l){"use strict";var w=this&&this.__importDefault||function(q){return q&&q.__esModule?q:{default:q}};Object.defineProperty(I,"__esModule",{value:!0}),I.WebSocketTransport=void 0;const t=w(l(13360)),O=globalThis.WebSocket||t.default;I.WebSocketTransport=class{constructor(q){this.events=q}send(q){q instanceof ArrayBuffer?this.ws.send(q):Array.isArray(q)&&this.ws.send(new Uint8Array(q).buffer)}connect(q,I){try{this.ws=new O(q,{headers:I,protocols:this.protocols})}catch(l){this.ws=new O(q,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(q,I){this.ws.close(q,I)}get isOpen(){return this.ws.readyState===O.OPEN}}},13360:q=>{"use strict";q.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13809:q=>{"use strict";q.exports=function(q){for(var I=new Array(q),l=0;l<q;++l)I[l]=l;return I}},13811:q=>{function I(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(I(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&I(q.slice(0,0))}(q)||!!q._isBuffer)}},13806:(q,I,l)=>{var w=l(13809),t=l(13811),O="undefined"!==typeof Float64Array;function c(q,I){return q[0]-I[0]}function a(){var q,I=this.stride,l=new Array(I.length);for(q=0;q<l.length;++q)l[q]=[Math.abs(I[q]),q];l.sort(c);var w=new Array(l.length);for(q=0;q<w.length;++q)w[q]=l[q][1];return w}function F(q,I){var l=["View",I,"d",q].join("");I<0&&(l="View_Nil"+q);var t="generic"===q;if(-1===I){var O="function "+l+"(a){this.data=a;};var proto="+l+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+l+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+l+"(a){return new "+l+"(a);}";return new Function(O)()}if(0===I){O="function "+l+"(a,d) {this.data = a;this.offset = d};var proto="+l+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+l+"_copy() {return new "+l+"(this.data,this.offset)};proto.pick=function "+l+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+l+"_get(){return "+(t?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+l+"_set(v){return "+(t?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+l+"(a,b,c,d){return new "+l+"(a,d)}";return new Function("TrivialArray",O)(s[q][0])}O=["'use strict'"];var c=w(I),F=c.map((function(q){return"i"+q})),Z="this.offset+"+c.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),r=c.map((function(q){return"b"+q})).join(","),x=c.map((function(q){return"c"+q})).join(",");O.push("function "+l+"(a,"+r+","+x+",d){this.data=a","this.shape=["+r+"]","this.stride=["+x+"]","this.offset=d|0}","var proto="+l+".prototype","proto.dtype='"+q+"'","proto.dimension="+I),O.push("Object.defineProperty(proto,'size',{get:function "+l+"_size(){return "+c.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===I?O.push("proto.order=[0]"):(O.push("Object.defineProperty(proto,'order',{get:"),I<4?(O.push("function "+l+"_order(){"),2===I?O.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===I&&O.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):O.push("ORDER})")),O.push("proto.set=function "+l+"_set("+F.join(",")+",v){"),t?O.push("return this.data.set("+Z+",v)}"):O.push("return this.data["+Z+"]=v}"),O.push("proto.get=function "+l+"_get("+F.join(",")+"){"),t?O.push("return this.data.get("+Z+")}"):O.push("return this.data["+Z+"]}"),O.push("proto.index=function "+l+"_index(",F.join(),"){return "+Z+"}"),O.push("proto.hi=function "+l+"_hi("+F.join(",")+"){return new "+l+"(this.data,"+c.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+c.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var o=c.map((function(q){return"a"+q+"=this.shape["+q+"]"})),d=c.map((function(q){return"c"+q+"=this.stride["+q+"]"}));O.push("proto.lo=function "+l+"_lo("+F.join(",")+"){var b=this.offset,d=0,"+o.join(",")+","+d.join(","));for(var T=0;T<I;++T)O.push("if(typeof i"+T+"==='number'&&i"+T+">=0){d=i"+T+"|0;b+=c"+T+"*d;a"+T+"-=d}");O.push("return new "+l+"(this.data,"+c.map((function(q){return"a"+q})).join(",")+","+c.map((function(q){return"c"+q})).join(",")+",b)}"),O.push("proto.step=function "+l+"_step("+F.join(",")+"){var "+c.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+c.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(T=0;T<I;++T)O.push("if(typeof i"+T+"==='number'){d=i"+T+"|0;if(d<0){c+=b"+T+"*(a"+T+"-1);a"+T+"=ceil(-a"+T+"/d)}else{a"+T+"=ceil(a"+T+"/d)}b"+T+"*=d}");O.push("return new "+l+"(this.data,"+c.map((function(q){return"a"+q})).join(",")+","+c.map((function(q){return"b"+q})).join(",")+",c)}");var V=new Array(I),U=new Array(I);for(T=0;T<I;++T)V[T]="a[i"+T+"]",U[T]="b[i"+T+"]";O.push("proto.transpose=function "+l+"_transpose("+F+"){"+F.map((function(q,I){return q+"=("+q+"===undefined?"+I+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+l+"(this.data,"+V.join(",")+","+U.join(",")+",this.offset)}"),O.push("proto.pick=function "+l+"_pick("+F+"){var a=[],b=[],c=this.offset");for(T=0;T<I;++T)O.push("if(typeof i"+T+"==='number'&&i"+T+">=0){c=(c+this.stride["+T+"]*i"+T+")|0}else{a.push(this.shape["+T+"]);b.push(this.stride["+T+"])}");return O.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),O.push("return function construct_"+l+"(data,shape,stride,offset){return new "+l+"(data,"+c.map((function(q){return"shape["+q+"]"})).join(",")+","+c.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",O.join("\n"))(s[q],a)}var s={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,I,l,w){if(void 0===q)return(0,s.array[0])([]);"number"===typeof q&&(q=[q]),void 0===I&&(I=[q.length]);var c=I.length;if(void 0===l){l=new Array(c);for(var a=c-1,Z=1;a>=0;--a)l[a]=Z,Z*=I[a]}if(void 0===w){w=0;for(a=0;a<c;++a)l[a]<0&&(w-=(I[a]-1)*l[a])}for(var r=function(q){if(t(q))return"buffer";if(O)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),x=s[r];x.length<=c+1;)x.push(F(r,x.length-1));return(0,x[c+1])(q,I,l,w)}},14839:q=>{var I;self,I=()=>(()=>{"use strict";var q={d:(I,l)=>{for(var w in l)q.o(l,w)&&!q.o(I,w)&&Object.defineProperty(I,w,{enumerable:!0,get:l[w]})},o:(q,I)=>Object.prototype.hasOwnProperty.call(q,I)},I={};q.d(I,{default:()=>M});var l,w=function(q,I){var l=I.x-q.x,w=I.y-q.y;return Math.sqrt(l*l+w*w)},t=function(q){return q*(Math.PI/180)},O=new Map,c=function(q){O.has(q)&&clearTimeout(O.get(q)),O.set(q,setTimeout(q,100))},a=function(q,I,l){for(var w,t=I.split(/[ ,]+/g),O=0;O<t.length;O+=1)w=t[O],q.addEventListener?q.addEventListener(w,l,!1):q.attachEvent&&q.attachEvent(w,l)},F=function(q,I,l){for(var w,t=I.split(/[ ,]+/g),O=0;O<t.length;O+=1)w=t[O],q.removeEventListener?q.removeEventListener(w,l):q.detachEvent&&q.detachEvent(w,l)},s=function(q){return q.preventDefault(),q.type.match(/^touch/)?q.changedTouches:q},Z=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},r=function(q,I){I.top||I.right||I.bottom||I.left?(q.style.top=I.top,q.style.right=I.right,q.style.bottom=I.bottom,q.style.left=I.left):(q.style.left=I.x+"px",q.style.top=I.y+"px")},x=function(q,I,l){var w=o(q);for(var t in w)if(w.hasOwnProperty(t))if("string"==typeof I)w[t]=I+" "+l;else{for(var O="",c=0,a=I.length;c<a;c+=1)O+=I[c]+" "+l+", ";w[t]=O.slice(0,-2)}return w},o=function(q){var I={};return I[q]="",["webkit","Moz","o"].forEach((function(l){I[l+q.charAt(0).toUpperCase()+q.slice(1)]=""})),I},d=function(q,I){for(var l in I)I.hasOwnProperty(l)&&(q[l]=I[l]);return q},T=function(q,I){if(q.length)for(var l=0,w=q.length;l<w;l+=1)I(q[l]);else I(q)},V="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,U=window.matchMedia("(any-hover: none)").matches,B=!!("ontouchstart"in window),v=!!window.PointerEvent,k=!!window.MSPointerEvent,C={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},R={start:"mousedown",move:"mousemove",end:"mouseup"},W={};function e(){}V&&!U?l=C:v?l={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:k?l={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:B?(l=C,W=R):l=R,e.prototype.on=function(q,I){var l,w=this,t=q.split(/[ ,]+/g);w._handlers_=w._handlers_||{};for(var O=0;O<t.length;O+=1)l=t[O],w._handlers_[l]=w._handlers_[l]||[],w._handlers_[l].push(I);return w},e.prototype.off=function(q,I){var l=this;return l._handlers_=l._handlers_||{},void 0===q?l._handlers_={}:void 0===I?l._handlers_[q]=null:l._handlers_[q]&&l._handlers_[q].indexOf(I)>=0&&l._handlers_[q].splice(l._handlers_[q].indexOf(I),1),l},e.prototype.trigger=function(q,I){var l,w=this,t=q.split(/[ ,]+/g);w._handlers_=w._handlers_||{};for(var O=0;O<t.length;O+=1)l=t[O],w._handlers_[l]&&w._handlers_[l].length&&w._handlers_[l].forEach((function(q){q.call(w,{type:l,target:w},I)}))},e.prototype.config=function(q){var I=this;I.options=I.defaults||{},q&&(I.options=function(q,I){var l={};for(var w in q)q.hasOwnProperty(w)&&I.hasOwnProperty(w)?l[w]=I[w]:q.hasOwnProperty(w)&&(l[w]=q[w]);return l}(I.options,q))},e.prototype.bindEvt=function(q,I){var w=this;return w._domHandlers_=w._domHandlers_||{},w._domHandlers_[I]=function(){"function"==typeof w["on"+I]?w["on"+I].apply(w,arguments):console.warn('[WARNING] : Missing "on'+I+'" handler.')},a(q,l[I],w._domHandlers_[I]),W[I]&&a(q,W[I],w._domHandlers_[I]),w},e.prototype.unbindEvt=function(q,I){var w=this;return w._domHandlers_=w._domHandlers_||{},F(q,l[I],w._domHandlers_[I]),W[I]&&F(q,W[I],w._domHandlers_[I]),delete w._domHandlers_[I],this};const i=e;function S(q,I){return this.identifier=I.identifier,this.position=I.position,this.frontPosition=I.frontPosition,this.collection=q,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(I),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=S.id,S.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}S.prototype=new i,S.constructor=S,S.id=0,S.prototype.buildEl=function(q){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},S.prototype.stylize=function(){if(this.options.dataOnly)return this;var q=this.options.fadeTime+"ms",I=function(){var q=o("borderRadius");for(var I in q)q.hasOwnProperty(I)&&(q[I]="50%");return q}(),l=x("transition","opacity",q),w={};return w.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},w.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},w.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},d(w.el,l),"circle"===this.options.shape&&d(w.back,I),d(w.front,I),this.applyStyles(w),this},S.prototype.applyStyles=function(q){for(var I in this.ui)if(this.ui.hasOwnProperty(I))for(var l in q[I])this.ui[I].style[l]=q[I][l];return this},S.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},S.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},S.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},S.prototype.show=function(q){var I=this;return I.options.dataOnly||(clearTimeout(I.removeTimeout),clearTimeout(I.showTimeout),clearTimeout(I.restTimeout),I.addToDom(),I.restCallback(),setTimeout((function(){I.ui.el.style.opacity=1}),0),I.showTimeout=setTimeout((function(){I.trigger("shown",I.instance),"function"==typeof q&&q.call(this)}),I.options.fadeTime)),I},S.prototype.hide=function(q){var I=this;if(I.options.dataOnly)return I;if(I.ui.el.style.opacity=I.options.restOpacity,clearTimeout(I.removeTimeout),clearTimeout(I.showTimeout),clearTimeout(I.restTimeout),I.removeTimeout=setTimeout((function(){var l="dynamic"===I.options.mode?"none":"block";I.ui.el.style.display=l,"function"==typeof q&&q.call(I),I.trigger("hidden",I.instance)}),I.options.fadeTime),I.options.restJoystick){var l=I.options.restJoystick,w={};w.x=!0===l||!1!==l.x?0:I.instance.frontPosition.x,w.y=!0===l||!1!==l.y?0:I.instance.frontPosition.y,I.setPosition(q,w)}return I},S.prototype.setPosition=function(q,I){var l=this;l.frontPosition={x:I.x,y:I.y};var w=l.options.fadeTime+"ms",t={};t.front=x("transition",["transform"],w);var O={front:{}};O.front={transform:"translate("+l.frontPosition.x+"px,"+l.frontPosition.y+"px)"},l.applyStyles(t),l.applyStyles(O),l.restTimeout=setTimeout((function(){"function"==typeof q&&q.call(l),l.restCallback()}),l.options.fadeTime)},S.prototype.restCallback=function(){var q=this,I={};I.front=x("transition","none",""),q.applyStyles(I),q.trigger("rested",q.instance)},S.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},S.prototype.computeDirection=function(q){var I,l,w,t=q.angle.radian,O=Math.PI/4,c=Math.PI/2;if(t>O&&t<3*O&&!q.lockX?I="up":t>-O&&t<=O&&!q.lockY?I="left":t>3*-O&&t<=-O&&!q.lockX?I="down":q.lockY||(I="right"),q.lockY||(l=t>-c&&t<c?"left":"right"),q.lockX||(w=t>0?"up":"down"),q.force>this.options.threshold){var a,F={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(F[a]=this.direction[a]);var s={};for(a in this.direction={x:l,y:w,angle:I},q.direction=this.direction,F)F[a]===this.direction[a]&&(s[a]=!0);if(s.x&&s.y&&s.angle)return q;s.x&&s.y||this.trigger("plain",q),s.x||this.trigger("plain:"+l,q),s.y||this.trigger("plain:"+w,q),s.angle||this.trigger("dir dir:"+I,q)}else this.resetDirection();return q};const g=S;function p(q,I){var l=this;l.nipples=[],l.idles=[],l.actives=[],l.ids=[],l.pressureIntervals={},l.manager=q,l.id=p.id,p.id+=1,l.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},l.config(I),"static"!==l.options.mode&&"semi"!==l.options.mode||(l.options.multitouch=!1),l.options.multitouch||(l.options.maxNumberOfNipples=1);var w=getComputedStyle(l.options.zone.parentElement);return w&&"flex"===w.display&&(l.parentIsFlex=!0),l.updateBox(),l.prepareNipples(),l.ux(),l.begin(),l.nipples}p.prototype=new i,p.constructor=p,p.id=0,p.prototype.prepareNipples=function(){var q=this,I=q.nipples;I.on=q.on.bind(q),I.off=q.off.bind(q),I.options=q.options,I.destroy=q.destroy.bind(q),I.ids=q.ids,I.id=q.id,I.processOnMove=q.processOnMove.bind(q),I.processOnEnd=q.processOnEnd.bind(q),I.get=function(q){if(void 0===q)return I[0];for(var l=0,w=I.length;l<w;l+=1)if(I[l].identifier===q)return I[l];return!1}},p.prototype.ux=function(){var q=this;q.bindEvt(q.options.zone,"start"),q.options.zone.style.touchAction="none",q.options.zone.style.msTouchAction="none"},p.prototype.begin=function(){var q=this,I=q.options;if("static"===I.mode){var l=q.createNipple(I.position,q.manager.getIdentifier());l.add(),q.idles.push(l)}},p.prototype.createNipple=function(q,I){var l=this,w=l.manager.scroll,t={},O=l.options,c=l.parentIsFlex?w.x:w.x+l.box.left,a=l.parentIsFlex?w.y:w.y+l.box.top;if(q.x&&q.y)t={x:q.x-c,y:q.y-a};else if(q.top||q.right||q.bottom||q.left){var F=document.createElement("DIV");F.style.display="hidden",F.style.top=q.top,F.style.right=q.right,F.style.bottom=q.bottom,F.style.left=q.left,F.style.position="absolute",O.zone.appendChild(F);var s=F.getBoundingClientRect();O.zone.removeChild(F),t=q,q={x:s.left+w.x,y:s.top+w.y}}var Z=new g(l,{color:O.color,size:O.size,threshold:O.threshold,fadeTime:O.fadeTime,dataOnly:O.dataOnly,restJoystick:O.restJoystick,restOpacity:O.restOpacity,mode:O.mode,identifier:I,position:q,zone:O.zone,frontPosition:{x:0,y:0},shape:O.shape});return O.dataOnly||(r(Z.ui.el,t),r(Z.ui.front,Z.frontPosition)),l.nipples.push(Z),l.trigger("added "+Z.identifier+":added",Z),l.manager.trigger("added "+Z.identifier+":added",Z),l.bindNipple(Z),Z},p.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},p.prototype.bindNipple=function(q){var I,l=this,w=function(q,w){I=q.type+" "+w.id+":"+q.type,l.trigger(I,w)};q.on("destroyed",l.onDestroyed.bind(l)),q.on("shown hidden rested dir plain",w),q.on("dir:up dir:right dir:down dir:left",w),q.on("plain:up plain:right plain:down plain:left",w)},p.prototype.pressureFn=function(q,I,l){var w=this,t=0;clearInterval(w.pressureIntervals[l]),w.pressureIntervals[l]=setInterval(function(){var l=q.force||q.pressure||q.webkitForce||0;l!==t&&(I.trigger("pressure",l),w.trigger("pressure "+I.identifier+":pressure",l),t=l)}.bind(w),100)},p.prototype.onstart=function(q){var I=this,l=I.options,w=q;return q=s(q),I.updateBox(),T(q,(function(t){I.actives.length<l.maxNumberOfNipples?I.processOnStart(t):w.type.match(/^touch/)&&(Object.keys(I.manager.ids).forEach((function(l){if(Object.values(w.touches).findIndex((function(q){return q.identifier===l}))<0){var t=[q[0]];t.identifier=l,I.processOnEnd(t)}})),I.actives.length<l.maxNumberOfNipples&&I.processOnStart(t))})),I.manager.bindDocument(),!1},p.prototype.processOnStart=function(q){var I,l=this,t=l.options,O=l.manager.getIdentifier(q),c=q.force||q.pressure||q.webkitForce||0,a={x:q.pageX,y:q.pageY},F=l.getOrCreate(O,a);F.identifier!==O&&l.manager.removeIdentifier(F.identifier),F.identifier=O;var s=function(I){I.trigger("start",I),l.trigger("start "+I.id+":start",I),I.show(),c>0&&l.pressureFn(q,I,I.identifier),l.processOnMove(q)};if((I=l.idles.indexOf(F))>=0&&l.idles.splice(I,1),l.actives.push(F),l.ids.push(F.identifier),"semi"!==t.mode)s(F);else{if(!(w(a,F.position)<=t.catchDistance))return F.destroy(),void l.processOnStart(q);s(F)}return F},p.prototype.getOrCreate=function(q,I){var l,w=this,t=w.options;return/(semi|static)/.test(t.mode)?(l=w.idles[0])?(w.idles.splice(0,1),l):"semi"===t.mode?w.createNipple(I,q):(console.warn("Coudln't find the needed nipple."),!1):l=w.createNipple(I,q)},p.prototype.processOnMove=function(q){var I=this,l=I.options,O=I.manager.getIdentifier(q),c=I.nipples.get(O),a=I.manager.scroll;if(function(q){return isNaN(q.buttons)?0!==q.pressure:0!==q.buttons}(q)){if(!c)return console.error("Found zombie joystick with ID "+O),void I.manager.removeIdentifier(O);if(l.dynamicPage){var F=c.el.getBoundingClientRect();c.position={x:a.x+F.left,y:a.y+F.top}}c.identifier=O;var s=c.options.size/2,Z={x:q.pageX,y:q.pageY};l.lockX&&(Z.y=c.position.y),l.lockY&&(Z.x=c.position.x);var r,x,o,d,T,V,U,B,v,k,C=w(Z,c.position),R=(r=Z,o=(x=c.position).x-r.x,d=x.y-r.y,function(q){return q*(180/Math.PI)}(Math.atan2(d,o))),W=t(R),e=C/s,i={distance:C,position:Z};if("circle"===c.options.shape?(T=Math.min(C,s),U=c.position,B=T,k={x:0,y:0},v=t(v=R),k.x=U.x-B*Math.cos(v),k.y=U.y-B*Math.sin(v),V=k):(V=function(q,I,l){return{x:Math.min(Math.max(q.x,I.x-l),I.x+l),y:Math.min(Math.max(q.y,I.y-l),I.y+l)}}(Z,c.position,s),T=w(V,c.position)),l.follow){if(C>s){var S=Z.x-V.x,g=Z.y-V.y;c.position.x+=S,c.position.y+=g,c.el.style.top=c.position.y-(I.box.top+a.y)+"px",c.el.style.left=c.position.x-(I.box.left+a.x)+"px",C=w(Z,c.position)}}else Z=V,C=T;var p=Z.x-c.position.x,X=Z.y-c.position.y;c.frontPosition={x:p,y:X},l.dataOnly||(c.ui.front.style.transform="translate("+p+"px,"+X+"px)");var K={identifier:c.identifier,position:Z,force:e,pressure:q.force||q.pressure||q.webkitForce||0,distance:C,angle:{radian:W,degree:R},vector:{x:p/s,y:-X/s},raw:i,instance:c,lockX:l.lockX,lockY:l.lockY};(K=c.computeDirection(K)).angle={radian:t(180-R),degree:180-R},c.trigger("move",K),I.trigger("move "+c.id+":move",K)}else this.processOnEnd(q)},p.prototype.processOnEnd=function(q){var I=this,l=I.options,w=I.manager.getIdentifier(q),t=I.nipples.get(w),O=I.manager.removeIdentifier(t.identifier);t&&(l.dataOnly||t.hide((function(){"dynamic"===l.mode&&(t.trigger("removed",t),I.trigger("removed "+t.id+":removed",t),I.manager.trigger("removed "+t.id+":removed",t),t.destroy())})),clearInterval(I.pressureIntervals[t.identifier]),t.resetDirection(),t.trigger("end",t),I.trigger("end "+t.id+":end",t),I.ids.indexOf(t.identifier)>=0&&I.ids.splice(I.ids.indexOf(t.identifier),1),I.actives.indexOf(t)>=0&&I.actives.splice(I.actives.indexOf(t),1),/(semi|static)/.test(l.mode)?I.idles.push(t):I.nipples.indexOf(t)>=0&&I.nipples.splice(I.nipples.indexOf(t),1),I.manager.unbindDocument(),/(semi|static)/.test(l.mode)&&(I.manager.ids[O.id]=O.identifier))},p.prototype.onDestroyed=function(q,I){var l=this;l.nipples.indexOf(I)>=0&&l.nipples.splice(l.nipples.indexOf(I),1),l.actives.indexOf(I)>=0&&l.actives.splice(l.actives.indexOf(I),1),l.idles.indexOf(I)>=0&&l.idles.splice(l.idles.indexOf(I),1),l.ids.indexOf(I.identifier)>=0&&l.ids.splice(l.ids.indexOf(I.identifier),1),l.manager.removeIdentifier(I.identifier),l.manager.unbindDocument()},p.prototype.destroy=function(){var q=this;for(var I in q.unbindEvt(q.options.zone,"start"),q.nipples.forEach((function(q){q.destroy()})),q.pressureIntervals)q.pressureIntervals.hasOwnProperty(I)&&clearInterval(q.pressureIntervals[I]);q.trigger("destroyed",q.nipples),q.manager.unbindDocument(),q.off()};const X=p;function K(q){var I=this;I.ids={},I.index=0,I.collections=[],I.scroll=Z(),I.config(q),I.prepareCollections();var l=function(){var q;I.collections.forEach((function(l){l.forEach((function(l){q=l.el.getBoundingClientRect(),l.position={x:I.scroll.x+q.left,y:I.scroll.y+q.top}}))}))};a(window,"resize",(function(){c(l)}));var w=function(){I.scroll=Z()};return a(window,"scroll",(function(){c(w)})),I.collections}K.prototype=new i,K.constructor=K,K.prototype.prepareCollections=function(){var q=this;q.collections.create=q.create.bind(q),q.collections.on=q.on.bind(q),q.collections.off=q.off.bind(q),q.collections.destroy=q.destroy.bind(q),q.collections.get=function(I){var l;return q.collections.every((function(q){return!(l=q.get(I))})),l}},K.prototype.create=function(q){return this.createCollection(q)},K.prototype.createCollection=function(q){var I=this,l=new X(I,q);return I.bindCollection(l),I.collections.push(l),l},K.prototype.bindCollection=function(q){var I,l=this,w=function(q,w){I=q.type+" "+w.id+":"+q.type,l.trigger(I,w)};q.on("destroyed",l.onDestroyed.bind(l)),q.on("shown hidden rested dir plain",w),q.on("dir:up dir:right dir:down dir:left",w),q.on("plain:up plain:right plain:down plain:left",w)},K.prototype.bindDocument=function(){var q=this;q.binded||(q.bindEvt(document,"move").bindEvt(document,"end"),q.binded=!0)},K.prototype.unbindDocument=function(q){var I=this;Object.keys(I.ids).length&&!0!==q||(I.unbindEvt(document,"move").unbindEvt(document,"end"),I.binded=!1)},K.prototype.getIdentifier=function(q){var I;return q?void 0===(I=void 0===q.identifier?q.pointerId:q.identifier)&&(I=this.latest||0):I=this.index,void 0===this.ids[I]&&(this.ids[I]=this.index,this.index+=1),this.latest=I,this.ids[I]},K.prototype.removeIdentifier=function(q){var I={};for(var l in this.ids)if(this.ids[l]===q){I.id=l,I.identifier=this.ids[l],delete this.ids[l];break}return I},K.prototype.onmove=function(q){return this.onAny("move",q),!1},K.prototype.onend=function(q){return this.onAny("end",q),!1},K.prototype.oncancel=function(q){return this.onAny("end",q),!1},K.prototype.onAny=function(q,I){var l,w=this,t="processOn"+q.charAt(0).toUpperCase()+q.slice(1);I=s(I);var O=function(q,I,l){l.ids.indexOf(I)>=0&&(l[t](q),q._found_=!0)};return T(I,(function(q){l=w.getIdentifier(q),T(w.collections,O.bind(null,q,l)),q._found_||w.removeIdentifier(l)})),!1},K.prototype.destroy=function(){var q=this;q.unbindDocument(!0),q.ids={},q.index=0,q.collections.forEach((function(q){q.destroy()})),q.off()},K.prototype.onDestroyed=function(q,I){var l=this;if(l.collections.indexOf(I)<0)return!1;l.collections.splice(l.collections.indexOf(I),1)};var D=new K;const M={create:function(q){return D.create(q)},factory:D};return I.default})(),q.exports=I()},13838:(q,I,l)=>{"use strict";const{Deflate:w,deflate:t,deflateRaw:O,gzip:c}=l(13847),{Inflate:a,inflate:F,inflateRaw:s,ungzip:Z}=l(13899),r=l(13876);q.exports.Deflate=w,q.exports.deflate=t,q.exports.deflateRaw=O,q.exports.gzip=c,q.exports.Inflate=a,q.exports.inflate=F,q.exports.inflateRaw=s,q.exports.ungzip=Z,q.exports.constants=r},13847:(q,I,l)=>{"use strict";const w=l(13852),t=l(13879),O=l(13881),c=l(13870),a=l(13890),F=Object.prototype.toString,{Z_NO_FLUSH:s,Z_SYNC_FLUSH:Z,Z_FULL_FLUSH:r,Z_FINISH:x,Z_OK:o,Z_STREAM_END:d,Z_DEFAULT_COMPRESSION:T,Z_DEFAULT_STRATEGY:V,Z_DEFLATED:U}=l(13876);function B(q){this.options=t.assign({level:T,method:U,jq:16384,windowBits:15,memLevel:8,strategy:V},q||{});let I=this.options;I.raw&&I.windowBits>0?I.windowBits=-I.windowBits:I.gzip&&I.windowBits>0&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.sI="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let l=w.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(l!==o)throw new Error(c[l]);if(I.header&&w.deflateSetHeader(this.strm,I.header),I.dictionary){let q;if(q="string"===typeof I.dictionary?O.string2buf(I.dictionary):"[object ArrayBuffer]"===F.call(I.dictionary)?new Uint8Array(I.dictionary):I.dictionary,l=w.deflateSetDictionary(this.strm,q),l!==o)throw new Error(c[l]);this._dict_set=!0}}function v(q,I){const l=new B(I);if(l.push(q,!0),l.err)throw l.sI||c[l.err];return l.result}B.prototype.push=function(q,I){const l=this.strm,t=this.options.jq;let c,a;if(this.ended)return!1;for(a=I===~~I?I:!0===I?x:s,"string"===typeof q?l.input=O.string2buf(q):"[object ArrayBuffer]"===F.call(q)?l.input=new Uint8Array(q):l.input=q,l.next_in=0,l.avail_in=l.input.length;;)if(0===l.avail_out&&(l.output=new Uint8Array(t),l.next_out=0,l.avail_out=t),(a===Z||a===r)&&l.avail_out<=6)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else{if(c=w.deflate(l,a),c===d)return l.next_out>0&&this.onData(l.output.subarray(0,l.next_out)),c=w.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===o;if(0!==l.avail_out){if(a>0&&l.next_out>0)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else if(0===l.avail_in)break}else this.onData(l.output)}return!0},B.prototype.onData=function(q){this.chunks.push(q)},B.prototype.onEnd=function(q){q===o&&(this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.sI=this.strm.sI},q.exports.Deflate=B,q.exports.deflate=v,q.exports.deflateRaw=function(q,I){return(I=I||{}).raw=!0,v(q,I)},q.exports.gzip=function(q,I){return(I=I||{}).gzip=!0,v(q,I)},q.exports.constants=l(13876)},13899:(q,I,l)=>{"use strict";const w=l(13908),t=l(13879),O=l(13881),c=l(13870),a=l(13890),F=l(13928),s=Object.prototype.toString,{Z_NO_FLUSH:Z,Z_FINISH:r,Z_OK:x,Z_STREAM_END:o,Z_NEED_DICT:d,Z_STREAM_ERROR:T,Z_DATA_ERROR:V,Z_MEM_ERROR:U}=l(13876);function B(q){this.options=t.assign({jq:65536,windowBits:15,to:""},q||{});const I=this.options;I.raw&&I.windowBits>=0&&I.windowBits<16&&(I.windowBits=-I.windowBits,0===I.windowBits&&(I.windowBits=-15)),!(I.windowBits>=0&&I.windowBits<16)||q&&q.windowBits||(I.windowBits+=32),I.windowBits>15&&I.windowBits<48&&0===(15&I.windowBits)&&(I.windowBits|=15),this.err=0,this.sI="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let l=w.inflateInit2(this.strm,I.windowBits);if(l!==x)throw new Error(c[l]);if(this.header=new F,w.inflateGetHeader(this.strm,this.header),I.dictionary&&("string"===typeof I.dictionary?I.dictionary=O.string2buf(I.dictionary):"[object ArrayBuffer]"===s.call(I.dictionary)&&(I.dictionary=new Uint8Array(I.dictionary)),I.raw&&(l=w.inflateSetDictionary(this.strm,I.dictionary),l!==x)))throw new Error(c[l])}function v(q,I){const l=new B(I);if(l.push(q),l.err)throw l.sI||c[l.err];return l.result}B.prototype.push=function(q,I){const l=this.strm,t=this.options.jq,c=this.options.dictionary;let a,F,B;if(this.ended)return!1;for(F=I===~~I?I:!0===I?r:Z,"[object ArrayBuffer]"===s.call(q)?l.input=new Uint8Array(q):l.input=q,l.next_in=0,l.avail_in=l.input.length;;){for(0===l.avail_out&&(l.output=new Uint8Array(t),l.next_out=0,l.avail_out=t),a=w.inflate(l,F),a===d&&c&&(a=w.inflateSetDictionary(l,c),a===x?a=w.inflate(l,F):a===V&&(a=d));l.avail_in>0&&a===o&&l.state.wrap>0&&0!==q[l.next_in];)w.inflateReset(l),a=w.inflate(l,F);switch(a){case T:case V:case d:case U:return this.onEnd(a),this.ended=!0,!1}if(B=l.avail_out,l.next_out&&(0===l.avail_out||a===o))if("string"===this.options.to){let q=O.utf8border(l.output,l.next_out),I=l.next_out-q,w=O.buf2string(l.output,q);l.next_out=I,l.avail_out=t-I,I&&l.output.set(l.output.subarray(q,q+I),0),this.onData(w)}else this.onData(l.output.length===l.next_out?l.output:l.output.subarray(0,l.next_out));if(a!==x||0!==B){if(a===o)return a=w.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===l.avail_in)break}}return!0},B.prototype.onData=function(q){this.chunks.push(q)},B.prototype.onEnd=function(q){q===x&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.sI=this.strm.sI},q.exports.Inflate=B,q.exports.inflate=v,q.exports.inflateRaw=function(q,I){return(I=I||{}).raw=!0,v(q,I)},q.exports.ungzip=v,q.exports.constants=l(13876)},13879:q=>{"use strict";const I=(q,I)=>Object.prototype.hasOwnProperty.call(q,I);q.exports.assign=function(q){const l=Array.prototype.slice.call(arguments,1);for(;l.length;){const w=l.shift();if(w){if("object"!==typeof w)throw new TypeError(w+"must be non-object");for(const l in w)I(w,l)&&(q[l]=w[l])}}return q},q.exports.flattenChunks=q=>{let I=0;for(let w=0,t=q.length;w<t;w++)I+=q[w].length;const l=new Uint8Array(I);for(let w=0,t=0,O=q.length;w<O;w++){let I=q[w];l.set(I,t),t+=I.length}return l}},13881:q=>{"use strict";let I=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(w){I=!1}const l=new Uint8Array(256);for(let t=0;t<256;t++)l[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;l[254]=l[254]=1,q.exports.string2buf=q=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(q);let I,l,w,t,O,c=q.length,a=0;for(t=0;t<c;t++)l=q.charCodeAt(t),55296===(64512&l)&&t+1<c&&(w=q.charCodeAt(t+1),56320===(64512&w)&&(l=65536+(l-55296<<10)+(w-56320),t++)),a+=l<128?1:l<2048?2:l<65536?3:4;for(I=new Uint8Array(a),O=0,t=0;O<a;t++)l=q.charCodeAt(t),55296===(64512&l)&&t+1<c&&(w=q.charCodeAt(t+1),56320===(64512&w)&&(l=65536+(l-55296<<10)+(w-56320),t++)),l<128?I[O++]=l:l<2048?(I[O++]=192|l>>>6,I[O++]=128|63&l):l<65536?(I[O++]=224|l>>>12,I[O++]=128|l>>>6&63,I[O++]=128|63&l):(I[O++]=240|l>>>18,I[O++]=128|l>>>12&63,I[O++]=128|l>>>6&63,I[O++]=128|63&l);return I};q.exports.buf2string=(q,w)=>{const t=w||q.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(q.subarray(0,w));let O,c;const a=new Array(2*t);for(c=0,O=0;O<t;){let I=q[O++];if(I<128){a[c++]=I;continue}let w=l[I];if(w>4)a[c++]=65533,O+=w-1;else{for(I&=2===w?31:3===w?15:7;w>1&&O<t;)I=I<<6|63&q[O++],w--;w>1?a[c++]=65533:I<65536?a[c++]=I:(I-=65536,a[c++]=55296|I>>10&1023,a[c++]=56320|1023&I)}}return((q,l)=>{if(l<65534&&q.subarray&&I)return String.fromCharCode.apply(null,q.length===l?q:q.subarray(0,l));let w="";for(let I=0;I<l;I++)w+=String.fromCharCode(q[I]);return w})(a,c)},q.exports.utf8border=(q,I)=>{(I=I||q.length)>q.length&&(I=q.length);let w=I-1;for(;w>=0&&128===(192&q[w]);)w--;return w<0||0===w?I:w+l[q[w]]>I?w:I}},13859:q=>{"use strict";q.exports=(q,I,l,w)=>{let t=65535&q,O=q>>>16&65535,c=0;for(;0!==l;){c=l>2e3?2e3:l,l-=c;do{t=t+I[w++]|0,O=O+t|0}while(--c);t%=65521,O%=65521}return t|O<<16}},13876:q=>{"use strict";q.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13864:q=>{"use strict";const I=new Uint32Array((()=>{let q,I=[];for(var l=0;l<256;l++){q=l;for(var w=0;w<8;w++)q=1&q?3988292384^q>>>1:q>>>1;I[l]=q}return I})());q.exports=(q,l,w,t)=>{const O=I,c=t+w;q^=-1;for(let I=t;I<c;I++)q=q>>>8^O[255&(q^l[I])];return~q}},13852:(q,I,l)=>{"use strict";const{_tr_init:w,_tr_stored_block:t,_tr_flush_block:O,_tr_tally:c,_tr_align:a}=l(13855),F=l(13859),s=l(13864),Z=l(13870),{Z_NO_FLUSH:r,Z_PARTIAL_FLUSH:x,Z_FULL_FLUSH:o,Z_FINISH:d,Z_BLOCK:T,Z_OK:V,Z_STREAM_END:U,Z_STREAM_ERROR:B,Z_DATA_ERROR:v,Z_BUF_ERROR:k,Z_DEFAULT_COMPRESSION:C,Z_FILTERED:R,Z_HUFFMAN_ONLY:W,Z_RLE:e,Z_FIXED:i,Z_DEFAULT_STRATEGY:S,Z_UNKNOWN:g,Z_DEFLATED:p}=l(13876),X=258,K=262,D=103,M=113,n=666,f=(q,I)=>(q.sI=Z[I],I),L=q=>(q<<1)-(q>4?9:0),E=q=>{let I=q.length;for(;--I>=0;)q[I]=0};let j=(q,I,l)=>(I<<q.hash_shift^l)&q.hash_mask;const h=q=>{const I=q.state;let l=I.pending;l>q.avail_out&&(l=q.avail_out),0!==l&&(q.output.set(I.pending_buf.subarray(I.pending_out,I.pending_out+l),q.next_out),q.next_out+=l,I.pending_out+=l,q.total_out+=l,q.avail_out-=l,I.pending-=l,0===I.pending&&(I.pending_out=0))},u=(q,I)=>{O(q,q.block_start>=0?q.block_start:-1,q.strstart-q.block_start,I),q.block_start=q.strstart,h(q.strm)},P=(q,I)=>{q.pending_buf[q.pending++]=I},mq=(q,I)=>{q.pending_buf[q.pending++]=I>>>8&255,q.pending_buf[q.pending++]=255&I},Y=(q,I,l,w)=>{let t=q.avail_in;return t>w&&(t=w),0===t?0:(q.avail_in-=t,I.set(q.input.subarray(q.next_in,q.next_in+t),l),1===q.state.wrap?q.adler=F(q.adler,I,t,l):2===q.state.wrap&&(q.adler=s(q.adler,I,t,l)),q.next_in+=t,q.total_in+=t,t)},y=(q,I)=>{let l,w,t=q.max_chain_length,O=q.strstart,c=q.prev_length,a=q.nice_match;const F=q.strstart>q.w_size-K?q.strstart-(q.w_size-K):0,s=q.window,Z=q.w_mask,r=q.prev,x=q.strstart+X;let o=s[O+c-1],d=s[O+c];q.prev_length>=q.good_match&&(t>>=2),a>q.lookahead&&(a=q.lookahead);do{if(l=I,s[l+c]===d&&s[l+c-1]===o&&s[l]===s[O]&&s[++l]===s[O+1]){O+=2,l++;do{}while(s[++O]===s[++l]&&s[++O]===s[++l]&&s[++O]===s[++l]&&s[++O]===s[++l]&&s[++O]===s[++l]&&s[++O]===s[++l]&&s[++O]===s[++l]&&s[++O]===s[++l]&&O<x);if(w=X-(x-O),O=x-X,w>c){if(q.match_start=I,c=w,w>=a)break;o=s[O+c-1],d=s[O+c]}}}while((I=r[I&Z])>F&&0!==--t);return c<=q.lookahead?c:q.lookahead},G=q=>{const I=q.w_size;let l,w,t,O,c;do{if(O=q.window_size-q.lookahead-q.strstart,q.strstart>=I+(I-K)){q.window.set(q.window.subarray(I,I+I),0),q.match_start-=I,q.strstart-=I,q.block_start-=I,w=q.hash_size,l=w;do{t=q.head[--l],q.head[l]=t>=I?t-I:0}while(--w);w=I,l=w;do{t=q.prev[--l],q.prev[l]=t>=I?t-I:0}while(--w);O+=I}if(0===q.strm.avail_in)break;if(w=Y(q.strm,q.window,q.strstart+q.lookahead,O),q.lookahead+=w,q.lookahead+q.insert>=3)for(c=q.strstart-q.insert,q.ins_h=q.window[c],q.ins_h=j(q,q.ins_h,q.window[c+1]);q.insert&&(q.ins_h=j(q,q.ins_h,q.window[c+3-1]),q.prev[c&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=c,c++,q.insert--,!(q.lookahead+q.insert<3)););}while(q.lookahead<K&&0!==q.strm.avail_in)},N=(q,I)=>{let l,w;for(;;){if(q.lookahead<K){if(G(q),q.lookahead<K&&I===r)return 1;if(0===q.lookahead)break}if(l=0,q.lookahead>=3&&(q.ins_h=j(q,q.ins_h,q.window[q.strstart+3-1]),l=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),0!==l&&q.strstart-l<=q.w_size-K&&(q.match_length=y(q,l)),q.match_length>=3)if(w=c(q,q.strstart-q.match_start,q.match_length-3),q.lookahead-=q.match_length,q.match_length<=q.max_lazy_match&&q.lookahead>=3){q.match_length--;do{q.strstart++,q.ins_h=j(q,q.ins_h,q.window[q.strstart+3-1]),l=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart}while(0!==--q.match_length);q.strstart++}else q.strstart+=q.match_length,q.match_length=0,q.ins_h=q.window[q.strstart],q.ins_h=j(q,q.ins_h,q.window[q.strstart+1]);else w=c(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++;if(w&&(u(q,!1),0===q.strm.avail_out))return 1}return q.insert=q.strstart<2?q.strstart:2,I===d?(u(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(u(q,!1),0===q.strm.avail_out)?1:2},J=(q,I)=>{let l,w,t;for(;;){if(q.lookahead<K){if(G(q),q.lookahead<K&&I===r)return 1;if(0===q.lookahead)break}if(l=0,q.lookahead>=3&&(q.ins_h=j(q,q.ins_h,q.window[q.strstart+3-1]),l=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),q.prev_length=q.match_length,q.prev_match=q.match_start,q.match_length=2,0!==l&&q.prev_length<q.max_lazy_match&&q.strstart-l<=q.w_size-K&&(q.match_length=y(q,l),q.match_length<=5&&(q.strategy===R||3===q.match_length&&q.strstart-q.match_start>4096)&&(q.match_length=2)),q.prev_length>=3&&q.match_length<=q.prev_length){t=q.strstart+q.lookahead-3,w=c(q,q.strstart-1-q.prev_match,q.prev_length-3),q.lookahead-=q.prev_length-1,q.prev_length-=2;do{++q.strstart<=t&&(q.ins_h=j(q,q.ins_h,q.window[q.strstart+3-1]),l=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart)}while(0!==--q.prev_length);if(q.match_available=0,q.match_length=2,q.strstart++,w&&(u(q,!1),0===q.strm.avail_out))return 1}else if(q.match_available){if(w=c(q,0,q.window[q.strstart-1]),w&&u(q,!1),q.strstart++,q.lookahead--,0===q.strm.avail_out)return 1}else q.match_available=1,q.strstart++,q.lookahead--}return q.match_available&&(w=c(q,0,q.window[q.strstart-1]),q.match_available=0),q.insert=q.strstart<2?q.strstart:2,I===d?(u(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(u(q,!1),0===q.strm.avail_out)?1:2};function z(q,I,l,w,t){this.good_length=q,this.max_lazy=I,this.nice_length=l,this.max_chain=w,this.func=t}const H=[new z(0,0,0,0,((q,I)=>{let l=65535;for(l>q.pending_buf_size-5&&(l=q.pending_buf_size-5);;){if(q.lookahead<=1){if(G(q),0===q.lookahead&&I===r)return 1;if(0===q.lookahead)break}q.strstart+=q.lookahead,q.lookahead=0;const w=q.block_start+l;if((0===q.strstart||q.strstart>=w)&&(q.lookahead=q.strstart-w,q.strstart=w,u(q,!1),0===q.strm.avail_out))return 1;if(q.strstart-q.block_start>=q.w_size-K&&(u(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,I===d?(u(q,!0),0===q.strm.avail_out?3:4):(q.strstart>q.block_start&&(u(q,!1),q.strm.avail_out),1)})),new z(4,4,8,4,N),new z(4,5,16,8,N),new z(4,6,32,32,N),new z(4,4,16,16,J),new z(8,16,32,32,J),new z(8,16,128,128,J),new z(8,32,128,256,J),new z(32,128,258,1024,J),new z(32,258,258,4096,J)];function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=p,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),E(this.dyn_ltree),E(this.dyn_dtree),E(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),E(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),E(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Q=q=>{if(!q||!q.state)return f(q,B);q.total_in=q.total_out=0,q.data_type=g;const I=q.state;return I.pending=0,I.pending_out=0,I.wrap<0&&(I.wrap=-I.wrap),I.status=I.wrap?42:M,q.adler=2===I.wrap?0:1,I.last_flush=r,w(I),V},b=q=>{const I=Q(q);var l;return I===V&&((l=q.state).window_size=2*l.w_size,E(l.head),l.max_lazy_match=H[l.level].max_lazy,l.good_match=H[l.level].good_length,l.nice_match=H[l.level].nice_length,l.max_chain_length=H[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=2,l.match_available=0,l.ins_h=0),I},qq=(q,I,l,w,t,O)=>{if(!q)return B;let c=1;if(I===C&&(I=6),w<0?(c=0,w=-w):w>15&&(c=2,w-=16),t<1||t>9||l!==p||w<8||w>15||I<0||I>9||O<0||O>i)return f(q,B);8===w&&(w=9);const a=new A;return q.state=a,a.strm=q,a.wrap=c,a.gzhead=null,a.w_bits=w,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=t+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<t+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=I,a.strategy=O,a.method=l,b(q)};q.exports.deflateInit=(q,I)=>qq(q,I,p,15,8,S),q.exports.deflateInit2=qq,q.exports.deflateReset=b,q.exports.deflateResetKeep=Q,q.exports.deflateSetHeader=(q,I)=>q&&q.state?2!==q.state.wrap?B:(q.state.gzhead=I,V):B,q.exports.deflate=(q,I)=>{let l,w;if(!q||!q.state||I>T||I<0)return q?f(q,B):B;const O=q.state;if(!q.output||!q.input&&0!==q.avail_in||O.status===n&&I!==d)return f(q,0===q.avail_out?k:B);O.strm=q;const F=O.last_flush;if(O.last_flush=I,42===O.status)if(2===O.wrap)q.adler=0,P(O,31),P(O,139),P(O,8),O.gzhead?(P(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),P(O,255&O.gzhead.time),P(O,O.gzhead.time>>8&255),P(O,O.gzhead.time>>16&255),P(O,O.gzhead.time>>24&255),P(O,9===O.level?2:O.strategy>=W||O.level<2?4:0),P(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(P(O,255&O.gzhead.extra.length),P(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(q.adler=s(q.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(P(O,0),P(O,0),P(O,0),P(O,0),P(O,0),P(O,9===O.level?2:O.strategy>=W||O.level<2?4:0),P(O,3),O.status=M);else{let I=p+(O.w_bits-8<<4)<<8,l=-1;l=O.strategy>=W||O.level<2?0:O.level<6?1:6===O.level?2:3,I|=l<<6,0!==O.strstart&&(I|=32),I+=31-I%31,O.status=M,mq(O,I),0!==O.strstart&&(mq(O,q.adler>>>16),mq(O,65535&q.adler)),q.adler=1}if(69===O.status)if(O.gzhead.extra){for(l=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>l&&(q.adler=s(q.adler,O.pending_buf,O.pending-l,l)),h(q),l=O.pending,O.pending!==O.pending_buf_size));)P(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>l&&(q.adler=s(q.adler,O.pending_buf,O.pending-l,l)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(73===O.status)if(O.gzhead.name){l=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>l&&(q.adler=s(q.adler,O.pending_buf,O.pending-l,l)),h(q),l=O.pending,O.pending===O.pending_buf_size)){w=1;break}w=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,P(O,w)}while(0!==w);O.gzhead.hcrc&&O.pending>l&&(q.adler=s(q.adler,O.pending_buf,O.pending-l,l)),0===w&&(O.gzindex=0,O.status=91)}else O.status=91;if(91===O.status)if(O.gzhead.comment){l=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>l&&(q.adler=s(q.adler,O.pending_buf,O.pending-l,l)),h(q),l=O.pending,O.pending===O.pending_buf_size)){w=1;break}w=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,P(O,w)}while(0!==w);O.gzhead.hcrc&&O.pending>l&&(q.adler=s(q.adler,O.pending_buf,O.pending-l,l)),0===w&&(O.status=D)}else O.status=D;if(O.status===D&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&h(q),O.pending+2<=O.pending_buf_size&&(P(O,255&q.adler),P(O,q.adler>>8&255),q.adler=0,O.status=M)):O.status=M),0!==O.pending){if(h(q),0===q.avail_out)return O.last_flush=-1,V}else if(0===q.avail_in&&L(I)<=L(F)&&I!==d)return f(q,k);if(O.status===n&&0!==q.avail_in)return f(q,k);if(0!==q.avail_in||0!==O.lookahead||I!==r&&O.status!==n){let l=O.strategy===W?((q,I)=>{let l;for(;;){if(0===q.lookahead&&(G(q),0===q.lookahead)){if(I===r)return 1;break}if(q.match_length=0,l=c(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,l&&(u(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,I===d?(u(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(u(q,!1),0===q.strm.avail_out)?1:2})(O,I):O.strategy===e?((q,I)=>{let l,w,t,O;const a=q.window;for(;;){if(q.lookahead<=X){if(G(q),q.lookahead<=X&&I===r)return 1;if(0===q.lookahead)break}if(q.match_length=0,q.lookahead>=3&&q.strstart>0&&(t=q.strstart-1,w=a[t],w===a[++t]&&w===a[++t]&&w===a[++t])){O=q.strstart+X;do{}while(w===a[++t]&&w===a[++t]&&w===a[++t]&&w===a[++t]&&w===a[++t]&&w===a[++t]&&w===a[++t]&&w===a[++t]&&t<O);q.match_length=X-(O-t),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=3?(l=c(q,1,q.match_length-3),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(l=c(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),l&&(u(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,I===d?(u(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(u(q,!1),0===q.strm.avail_out)?1:2})(O,I):H[O.level].func(O,I);if(3!==l&&4!==l||(O.status=n),1===l||3===l)return 0===q.avail_out&&(O.last_flush=-1),V;if(2===l&&(I===x?a(O):I!==T&&(t(O,0,0,!1),I===o&&(E(O.head),0===O.lookahead&&(O.strstart=0,O.block_start=0,O.insert=0))),h(q),0===q.avail_out))return O.last_flush=-1,V}return I!==d?V:O.wrap<=0?U:(2===O.wrap?(P(O,255&q.adler),P(O,q.adler>>8&255),P(O,q.adler>>16&255),P(O,q.adler>>24&255),P(O,255&q.total_in),P(O,q.total_in>>8&255),P(O,q.total_in>>16&255),P(O,q.total_in>>24&255)):(mq(O,q.adler>>>16),mq(O,65535&q.adler)),h(q),O.wrap>0&&(O.wrap=-O.wrap),0!==O.pending?V:U)},q.exports.deflateEnd=q=>{if(!q||!q.state)return B;const I=q.state.status;return 42!==I&&69!==I&&73!==I&&91!==I&&I!==D&&I!==M&&I!==n?f(q,B):(q.state=null,I===M?f(q,v):V)},q.exports.deflateSetDictionary=(q,I)=>{let l=I.length;if(!q||!q.state)return B;const w=q.state,t=w.wrap;if(2===t||1===t&&42!==w.status||w.lookahead)return B;if(1===t&&(q.adler=F(q.adler,I,l,0)),w.wrap=0,l>=w.w_size){0===t&&(E(w.head),w.strstart=0,w.block_start=0,w.insert=0);let q=new Uint8Array(w.w_size);q.set(I.subarray(l-w.w_size,l),0),I=q,l=w.w_size}const O=q.avail_in,c=q.next_in,a=q.input;for(q.avail_in=l,q.next_in=0,q.input=I,G(w);w.lookahead>=3;){let q=w.strstart,I=w.lookahead-2;do{w.ins_h=j(w,w.ins_h,w.window[q+3-1]),w.prev[q&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=q,q++}while(--I);w.strstart=q,w.lookahead=2,G(w)}return w.strstart+=w.lookahead,w.block_start=w.strstart,w.insert=w.lookahead,w.lookahead=0,w.match_length=w.prev_length=2,w.match_available=0,q.next_in=c,q.input=a,q.avail_in=O,w.wrap=t,V},q.exports.deflateInfo="pako deflate (from Nodeca project)"},13928:q=>{"use strict";q.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13916:q=>{"use strict";q.exports=function(q,I){let l,w,t,O,c,a,F,s,Z,r,x,o,d,T,V,U,B,v,k,C,R,W,e,i;const S=q.state;l=q.next_in,e=q.input,w=l+(q.avail_in-5),t=q.next_out,i=q.output,O=t-(I-q.avail_out),c=t+(q.avail_out-257),a=S.dmax,F=S.wsize,s=S.whave,Z=S.wnext,r=S.window,x=S.hold,o=S.bits,d=S.lencode,T=S.distcode,V=(1<<S.lenbits)-1,U=(1<<S.distbits)-1;q:do{o<15&&(x+=e[l++]<<o,o+=8,x+=e[l++]<<o,o+=8),B=d[x&V];I:for(;;){if(v=B>>>24,x>>>=v,o-=v,v=B>>>16&255,0===v)i[t++]=65535&B;else{if(!(16&v)){if(0===(64&v)){B=d[(65535&B)+(x&(1<<v)-1)];continue I}if(32&v){S.mode=12;break q}q.sI="invalid literal/length code",S.mode=30;break q}k=65535&B,v&=15,v&&(o<v&&(x+=e[l++]<<o,o+=8),k+=x&(1<<v)-1,x>>>=v,o-=v),o<15&&(x+=e[l++]<<o,o+=8,x+=e[l++]<<o,o+=8),B=T[x&U];l:for(;;){if(v=B>>>24,x>>>=v,o-=v,v=B>>>16&255,!(16&v)){if(0===(64&v)){B=T[(65535&B)+(x&(1<<v)-1)];continue l}q.sI="invalid distance code",S.mode=30;break q}if(C=65535&B,v&=15,o<v&&(x+=e[l++]<<o,o+=8,o<v&&(x+=e[l++]<<o,o+=8)),C+=x&(1<<v)-1,C>a){q.sI="invalid distance too far back",S.mode=30;break q}if(x>>>=v,o-=v,v=t-O,C>v){if(v=C-v,v>s&&S.sane){q.sI="invalid distance too far back",S.mode=30;break q}if(R=0,W=r,0===Z){if(R+=F-v,v<k){k-=v;do{i[t++]=r[R++]}while(--v);R=t-C,W=i}}else if(Z<v){if(R+=F+Z-v,v-=Z,v<k){k-=v;do{i[t++]=r[R++]}while(--v);if(R=0,Z<k){v=Z,k-=v;do{i[t++]=r[R++]}while(--v);R=t-C,W=i}}}else if(R+=Z-v,v<k){k-=v;do{i[t++]=r[R++]}while(--v);R=t-C,W=i}for(;k>2;)i[t++]=W[R++],i[t++]=W[R++],i[t++]=W[R++],k-=3;k&&(i[t++]=W[R++],k>1&&(i[t++]=W[R++]))}else{R=t-C;do{i[t++]=i[R++],i[t++]=i[R++],i[t++]=i[R++],k-=3}while(k>2);k&&(i[t++]=i[R++],k>1&&(i[t++]=i[R++]))}break}}break}}while(l<w&&t<c);k=o>>3,l-=k,o-=k<<3,x&=(1<<o)-1,q.next_in=l,q.next_out=t,q.avail_in=l<w?w-l+5:5-(l-w),q.avail_out=t<c?c-t+257:257-(t-c),S.hold=x,S.bits=o}},13908:(q,I,l)=>{"use strict";const w=l(13859),t=l(13864),O=l(13916),c=l(13920),{Z_FINISH:a,Z_BLOCK:F,Z_TREES:s,Z_OK:Z,Z_STREAM_END:r,Z_NEED_DICT:x,Z_STREAM_ERROR:o,Z_DATA_ERROR:d,Z_MEM_ERROR:T,Z_BUF_ERROR:V,Z_DEFLATED:U}=l(13876),B=12,v=30,k=q=>(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24);function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const R=q=>{if(!q||!q.state)return o;const I=q.state;return q.total_in=q.total_out=I.total=0,q.sI="",I.wrap&&(q.adler=1&I.wrap),I.mode=1,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new Int32Array(852),I.distcode=I.distdyn=new Int32Array(592),I.sane=1,I.back=-1,Z},W=q=>{if(!q||!q.state)return o;const I=q.state;return I.wsize=0,I.whave=0,I.wnext=0,R(q)},e=(q,I)=>{let l;if(!q||!q.state)return o;const w=q.state;return I<0?(l=0,I=-I):(l=1+(I>>4),I<48&&(I&=15)),I&&(I<8||I>15)?o:(null!==w.window&&w.wbits!==I&&(w.window=null),w.wrap=l,w.wbits=I,W(q))},i=(q,I)=>{if(!q)return o;const l=new C;q.state=l,l.window=null;const w=e(q,I);return w!==Z&&(q.state=null),w};let S,g,p=!0;const X=q=>{if(p){S=new Int32Array(512),g=new Int32Array(32);let I=0;for(;I<144;)q.lens[I++]=8;for(;I<256;)q.lens[I++]=9;for(;I<280;)q.lens[I++]=7;for(;I<288;)q.lens[I++]=8;for(c(1,q.lens,0,288,S,0,q.work,{bits:9}),I=0;I<32;)q.lens[I++]=5;c(2,q.lens,0,32,g,0,q.work,{bits:5}),p=!1}q.lencode=S,q.lenbits=9,q.distcode=g,q.distbits=5},K=(q,I,l,w)=>{let t;const O=q.state;return null===O.window&&(O.wsize=1<<O.wbits,O.wnext=0,O.whave=0,O.window=new Uint8Array(O.wsize)),w>=O.wsize?(O.window.set(I.subarray(l-O.wsize,l),0),O.wnext=0,O.whave=O.wsize):(t=O.wsize-O.wnext,t>w&&(t=w),O.window.set(I.subarray(l-w,l-w+t),O.wnext),(w-=t)?(O.window.set(I.subarray(l-w,l),0),O.wnext=w,O.whave=O.wsize):(O.wnext+=t,O.wnext===O.wsize&&(O.wnext=0),O.whave<O.wsize&&(O.whave+=t))),0};q.exports.inflateReset=W,q.exports.inflateReset2=e,q.exports.inflateResetKeep=R,q.exports.inflateInit=q=>i(q,15),q.exports.inflateInit2=i,q.exports.inflate=(q,I)=>{let l,C,R,W,e,i,S,g,p,D,M,n,f,L,E,j,h,u,P,mq,Y,y,G=0;const N=new Uint8Array(4);let J,z;const H=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!q||!q.state||!q.output||!q.input&&0!==q.avail_in)return o;l=q.state,l.mode===B&&(l.mode=13),e=q.next_out,R=q.output,S=q.avail_out,W=q.next_in,C=q.input,i=q.avail_in,g=l.hold,p=l.bits,D=i,M=S,y=Z;q:for(;;)switch(l.mode){case 1:if(0===l.wrap){l.mode=13;break}for(;p<16;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if(2&l.wrap&&35615===g){l.check=0,N[0]=255&g,N[1]=g>>>8&255,l.check=t(l.check,N,2,0),g=0,p=0,l.mode=2;break}if(l.flags=0,l.head&&(l.head.done=!1),!(1&l.wrap)||(((255&g)<<8)+(g>>8))%31){q.sI="incorrect header check",l.mode=v;break}if((15&g)!==U){q.sI="unknown compression method",l.mode=v;break}if(g>>>=4,p-=4,Y=8+(15&g),0===l.wbits)l.wbits=Y;else if(Y>l.wbits){q.sI="invalid window size",l.mode=v;break}l.dmax=1<<l.wbits,q.adler=l.check=1,l.mode=512&g?10:B,g=0,p=0;break;case 2:for(;p<16;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if(l.flags=g,(255&l.flags)!==U){q.sI="unknown compression method",l.mode=v;break}if(57344&l.flags){q.sI="unknown header flags set",l.mode=v;break}l.head&&(l.head.text=g>>8&1),512&l.flags&&(N[0]=255&g,N[1]=g>>>8&255,l.check=t(l.check,N,2,0)),g=0,p=0,l.mode=3;case 3:for(;p<32;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}l.head&&(l.head.time=g),512&l.flags&&(N[0]=255&g,N[1]=g>>>8&255,N[2]=g>>>16&255,N[3]=g>>>24&255,l.check=t(l.check,N,4,0)),g=0,p=0,l.mode=4;case 4:for(;p<16;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}l.head&&(l.head.xflags=255&g,l.head.os=g>>8),512&l.flags&&(N[0]=255&g,N[1]=g>>>8&255,l.check=t(l.check,N,2,0)),g=0,p=0,l.mode=5;case 5:if(1024&l.flags){for(;p<16;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}l.length=g,l.head&&(l.head.extra_len=g),512&l.flags&&(N[0]=255&g,N[1]=g>>>8&255,l.check=t(l.check,N,2,0)),g=0,p=0}else l.head&&(l.head.extra=null);l.mode=6;case 6:if(1024&l.flags&&(n=l.length,n>i&&(n=i),n&&(l.head&&(Y=l.head.extra_len-l.length,l.head.extra||(l.head.extra=new Uint8Array(l.head.extra_len)),l.head.extra.set(C.subarray(W,W+n),Y)),512&l.flags&&(l.check=t(l.check,C,n,W)),i-=n,W+=n,l.length-=n),l.length))break q;l.length=0,l.mode=7;case 7:if(2048&l.flags){if(0===i)break q;n=0;do{Y=C[W+n++],l.head&&Y&&l.length<65536&&(l.head.name+=String.fromCharCode(Y))}while(Y&&n<i);if(512&l.flags&&(l.check=t(l.check,C,n,W)),i-=n,W+=n,Y)break q}else l.head&&(l.head.name=null);l.length=0,l.mode=8;case 8:if(4096&l.flags){if(0===i)break q;n=0;do{Y=C[W+n++],l.head&&Y&&l.length<65536&&(l.head.comment+=String.fromCharCode(Y))}while(Y&&n<i);if(512&l.flags&&(l.check=t(l.check,C,n,W)),i-=n,W+=n,Y)break q}else l.head&&(l.head.comment=null);l.mode=9;case 9:if(512&l.flags){for(;p<16;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if(g!==(65535&l.check)){q.sI="header crc mismatch",l.mode=v;break}g=0,p=0}l.head&&(l.head.hcrc=l.flags>>9&1,l.head.done=!0),q.adler=l.check=0,l.mode=B;break;case 10:for(;p<32;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}q.adler=l.check=k(g),g=0,p=0,l.mode=11;case 11:if(0===l.havedict)return q.next_out=e,q.avail_out=S,q.next_in=W,q.avail_in=i,l.hold=g,l.bits=p,x;q.adler=l.check=1,l.mode=B;case B:if(I===F||I===s)break q;case 13:if(l.last){g>>>=7&p,p-=7&p,l.mode=27;break}for(;p<3;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}switch(l.last=1&g,g>>>=1,p-=1,3&g){case 0:l.mode=14;break;case 1:if(X(l),l.mode=20,I===s){g>>>=2,p-=2;break q}break;case 2:l.mode=17;break;case 3:q.sI="invalid block type",l.mode=v}g>>>=2,p-=2;break;case 14:for(g>>>=7&p,p-=7&p;p<32;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if((65535&g)!==(g>>>16^65535)){q.sI="invalid stored block lengths",l.mode=v;break}if(l.length=65535&g,g=0,p=0,l.mode=15,I===s)break q;case 15:l.mode=16;case 16:if(n=l.length,n){if(n>i&&(n=i),n>S&&(n=S),0===n)break q;R.set(C.subarray(W,W+n),e),i-=n,W+=n,S-=n,e+=n,l.length-=n;break}l.mode=B;break;case 17:for(;p<14;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if(l.nlen=257+(31&g),g>>>=5,p-=5,l.ndist=1+(31&g),g>>>=5,p-=5,l.ncode=4+(15&g),g>>>=4,p-=4,l.nlen>286||l.ndist>30){q.sI="too many length or distance symbols",l.mode=v;break}l.have=0,l.mode=18;case 18:for(;l.have<l.ncode;){for(;p<3;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}l.lens[H[l.have++]]=7&g,g>>>=3,p-=3}for(;l.have<19;)l.lens[H[l.have++]]=0;if(l.lencode=l.lendyn,l.lenbits=7,J={bits:l.lenbits},y=c(0,l.lens,0,19,l.lencode,0,l.work,J),l.lenbits=J.bits,y){q.sI="invalid code lengths set",l.mode=v;break}l.have=0,l.mode=19;case 19:for(;l.have<l.nlen+l.ndist;){for(;G=l.lencode[g&(1<<l.lenbits)-1],E=G>>>24,j=G>>>16&255,h=65535&G,!(E<=p);){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if(h<16)g>>>=E,p-=E,l.lens[l.have++]=h;else{if(16===h){for(z=E+2;p<z;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if(g>>>=E,p-=E,0===l.have){q.sI="invalid bit length repeat",l.mode=v;break}Y=l.lens[l.have-1],n=3+(3&g),g>>>=2,p-=2}else if(17===h){for(z=E+3;p<z;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}g>>>=E,p-=E,Y=0,n=3+(7&g),g>>>=3,p-=3}else{for(z=E+7;p<z;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}g>>>=E,p-=E,Y=0,n=11+(127&g),g>>>=7,p-=7}if(l.have+n>l.nlen+l.ndist){q.sI="invalid bit length repeat",l.mode=v;break}for(;n--;)l.lens[l.have++]=Y}}if(l.mode===v)break;if(0===l.lens[256]){q.sI="invalid code -- missing end-of-block",l.mode=v;break}if(l.lenbits=9,J={bits:l.lenbits},y=c(1,l.lens,0,l.nlen,l.lencode,0,l.work,J),l.lenbits=J.bits,y){q.sI="invalid literal/lengths set",l.mode=v;break}if(l.distbits=6,l.distcode=l.distdyn,J={bits:l.distbits},y=c(2,l.lens,l.nlen,l.ndist,l.distcode,0,l.work,J),l.distbits=J.bits,y){q.sI="invalid distances set",l.mode=v;break}if(l.mode=20,I===s)break q;case 20:l.mode=21;case 21:if(i>=6&&S>=258){q.next_out=e,q.avail_out=S,q.next_in=W,q.avail_in=i,l.hold=g,l.bits=p,O(q,M),e=q.next_out,R=q.output,S=q.avail_out,W=q.next_in,C=q.input,i=q.avail_in,g=l.hold,p=l.bits,l.mode===B&&(l.back=-1);break}for(l.back=0;G=l.lencode[g&(1<<l.lenbits)-1],E=G>>>24,j=G>>>16&255,h=65535&G,!(E<=p);){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if(j&&0===(240&j)){for(u=E,P=j,mq=h;G=l.lencode[mq+((g&(1<<u+P)-1)>>u)],E=G>>>24,j=G>>>16&255,h=65535&G,!(u+E<=p);){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}g>>>=u,p-=u,l.back+=u}if(g>>>=E,p-=E,l.back+=E,l.length=h,0===j){l.mode=26;break}if(32&j){l.back=-1,l.mode=B;break}if(64&j){q.sI="invalid literal/length code",l.mode=v;break}l.extra=15&j,l.mode=22;case 22:if(l.extra){for(z=l.extra;p<z;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}l.length+=g&(1<<l.extra)-1,g>>>=l.extra,p-=l.extra,l.back+=l.extra}l.was=l.length,l.mode=23;case 23:for(;G=l.distcode[g&(1<<l.distbits)-1],E=G>>>24,j=G>>>16&255,h=65535&G,!(E<=p);){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if(0===(240&j)){for(u=E,P=j,mq=h;G=l.distcode[mq+((g&(1<<u+P)-1)>>u)],E=G>>>24,j=G>>>16&255,h=65535&G,!(u+E<=p);){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}g>>>=u,p-=u,l.back+=u}if(g>>>=E,p-=E,l.back+=E,64&j){q.sI="invalid distance code",l.mode=v;break}l.offset=h,l.extra=15&j,l.mode=24;case 24:if(l.extra){for(z=l.extra;p<z;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}l.offset+=g&(1<<l.extra)-1,g>>>=l.extra,p-=l.extra,l.back+=l.extra}if(l.offset>l.dmax){q.sI="invalid distance too far back",l.mode=v;break}l.mode=25;case 25:if(0===S)break q;if(n=M-S,l.offset>n){if(n=l.offset-n,n>l.whave&&l.sane){q.sI="invalid distance too far back",l.mode=v;break}n>l.wnext?(n-=l.wnext,f=l.wsize-n):f=l.wnext-n,n>l.length&&(n=l.length),L=l.window}else L=R,f=e-l.offset,n=l.length;n>S&&(n=S),S-=n,l.length-=n;do{R[e++]=L[f++]}while(--n);0===l.length&&(l.mode=21);break;case 26:if(0===S)break q;R[e++]=l.length,S--,l.mode=21;break;case 27:if(l.wrap){for(;p<32;){if(0===i)break q;i--,g|=C[W++]<<p,p+=8}if(M-=S,q.total_out+=M,l.total+=M,M&&(q.adler=l.check=l.flags?t(l.check,R,M,e-M):w(l.check,R,M,e-M)),M=S,(l.flags?g:k(g))!==l.check){q.sI="incorrect data check",l.mode=v;break}g=0,p=0}l.mode=28;case 28:if(l.wrap&&l.flags){for(;p<32;){if(0===i)break q;i--,g+=C[W++]<<p,p+=8}if(g!==(4294967295&l.total)){q.sI="incorrect length check",l.mode=v;break}g=0,p=0}l.mode=29;case 29:y=r;break q;case v:y=d;break q;case 31:return T;default:return o}return q.next_out=e,q.avail_out=S,q.next_in=W,q.avail_in=i,l.hold=g,l.bits=p,(l.wsize||M!==q.avail_out&&l.mode<v&&(l.mode<27||I!==a))&&K(q,q.output,q.next_out,M-q.avail_out)?(l.mode=31,T):(D-=q.avail_in,M-=q.avail_out,q.total_in+=D,q.total_out+=M,l.total+=M,l.wrap&&M&&(q.adler=l.check=l.flags?t(l.check,R,M,q.next_out-M):w(l.check,R,M,q.next_out-M)),q.data_type=l.bits+(l.last?64:0)+(l.mode===B?128:0)+(20===l.mode||15===l.mode?256:0),(0===D&&0===M||I===a)&&y===Z&&(y=V),y)},q.exports.inflateEnd=q=>{if(!q||!q.state)return o;let I=q.state;return I.window&&(I.window=null),q.state=null,Z},q.exports.inflateGetHeader=(q,I)=>{if(!q||!q.state)return o;const l=q.state;return 0===(2&l.wrap)?o:(l.head=I,I.done=!1,Z)},q.exports.inflateSetDictionary=(q,I)=>{const l=I.length;let t,O,c;return q&&q.state?(t=q.state,0!==t.wrap&&11!==t.mode?o:11===t.mode&&(O=1,O=w(O,I,l,0),O!==t.check)?d:(c=K(q,I,l,l),c?(t.mode=31,T):(t.havedict=1,Z))):o},q.exports.inflateInfo="pako inflate (from Nodeca project)"},13920:q=>{"use strict";const I=15,l=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),w=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),t=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),O=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);q.exports=(q,c,a,F,s,Z,r,x)=>{const o=x.bits;let d,T,V,U,B,v,k=0,C=0,R=0,W=0,e=0,i=0,S=0,g=0,p=0,X=0,K=null,D=0;const M=new Uint16Array(16),n=new Uint16Array(16);let f,L,E,j=null,h=0;for(k=0;k<=I;k++)M[k]=0;for(C=0;C<F;C++)M[c[a+C]]++;for(e=o,W=I;W>=1&&0===M[W];W--);if(e>W&&(e=W),0===W)return s[Z++]=20971520,s[Z++]=20971520,x.bits=1,0;for(R=1;R<W&&0===M[R];R++);for(e<R&&(e=R),g=1,k=1;k<=I;k++)if(g<<=1,g-=M[k],g<0)return-1;if(g>0&&(0===q||1!==W))return-1;for(n[1]=0,k=1;k<I;k++)n[k+1]=n[k]+M[k];for(C=0;C<F;C++)0!==c[a+C]&&(r[n[c[a+C]]++]=C);if(0===q?(K=j=r,v=19):1===q?(K=l,D-=257,j=w,h-=257,v=256):(K=t,j=O,v=-1),X=0,C=0,k=R,B=Z,i=e,S=0,V=-1,p=1<<e,U=p-1,1===q&&p>852||2===q&&p>592)return 1;for(;;){f=k-S,r[C]<v?(L=0,E=r[C]):r[C]>v?(L=j[h+r[C]],E=K[D+r[C]]):(L=96,E=0),d=1<<k-S,T=1<<i,R=T;do{T-=d,s[B+(X>>S)+T]=f<<24|L<<16|E}while(0!==T);for(d=1<<k-1;X&d;)d>>=1;if(0!==d?(X&=d-1,X+=d):X=0,C++,0===--M[k]){if(k===W)break;k=c[a+r[C]]}if(k>e&&(X&U)!==V){for(0===S&&(S=e),B+=R,i=k-S,g=1<<i;i+S<W&&(g-=M[i+S],!(g<=0));)i++,g<<=1;if(p+=1<<i,1===q&&p>852||2===q&&p>592)return 1;V=X&U,s[V]=e<<24|i<<16|B-Z}}return 0!==X&&(s[B+X]=k-S<<24|64<<16),x.bits=e,0}},13870:q=>{"use strict";q.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13855:q=>{"use strict";function I(q){let I=q.length;for(;--I>=0;)q[I]=0}const l=256,w=286,t=30,O=15,c=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),F=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),s=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Z=new Array(576);I(Z);const r=new Array(60);I(r);const x=new Array(512);I(x);const o=new Array(256);I(o);const d=new Array(29);I(d);const T=new Array(t);function V(q,I,l,w,t){this.static_tree=q,this.extra_bits=I,this.extra_base=l,this.elems=w,this.max_length=t,this.has_stree=q&&q.length}let U,B,v;function k(q,I){this.dyn_tree=q,this.max_code=0,this.stat_desc=I}I(T);const C=q=>q<256?x[q]:x[256+(q>>>7)],R=(q,I)=>{q.pending_buf[q.pending++]=255&I,q.pending_buf[q.pending++]=I>>>8&255},W=(q,I,l)=>{q.bi_valid>16-l?(q.bi_buf|=I<<q.bi_valid&65535,R(q,q.bi_buf),q.bi_buf=I>>16-q.bi_valid,q.bi_valid+=l-16):(q.bi_buf|=I<<q.bi_valid&65535,q.bi_valid+=l)},e=(q,I,l)=>{W(q,l[2*I],l[2*I+1])},i=(q,I)=>{let l=0;do{l|=1&q,q>>>=1,l<<=1}while(--I>0);return l>>>1},S=(q,I,l)=>{const w=new Array(16);let t,c,a=0;for(t=1;t<=O;t++)w[t]=a=a+l[t-1]<<1;for(c=0;c<=I;c++){let I=q[2*c+1];0!==I&&(q[2*c]=i(w[I]++,I))}},g=q=>{let I;for(I=0;I<w;I++)q.dyn_ltree[2*I]=0;for(I=0;I<t;I++)q.dyn_dtree[2*I]=0;for(I=0;I<19;I++)q.bl_tree[2*I]=0;q.dyn_ltree[512]=1,q.opt_len=q.static_len=0,q.last_lit=q.matches=0},p=q=>{q.bi_valid>8?R(q,q.bi_buf):q.bi_valid>0&&(q.pending_buf[q.pending++]=q.bi_buf),q.bi_buf=0,q.bi_valid=0},X=(q,I,l,w)=>{const t=2*I,O=2*l;return q[t]<q[O]||q[t]===q[O]&&w[I]<=w[l]},K=(q,I,l)=>{const w=q.heap[l];let t=l<<1;for(;t<=q.heap_len&&(t<q.heap_len&&X(I,q.heap[t+1],q.heap[t],q.depth)&&t++,!X(I,w,q.heap[t],q.depth));)q.heap[l]=q.heap[t],l=t,t<<=1;q.heap[l]=w},D=(q,I,w)=>{let t,O,F,s,Z=0;if(0!==q.last_lit)do{t=q.pending_buf[q.d_buf+2*Z]<<8|q.pending_buf[q.d_buf+2*Z+1],O=q.pending_buf[q.l_buf+Z],Z++,0===t?e(q,O,I):(F=o[O],e(q,F+l+1,I),s=c[F],0!==s&&(O-=d[F],W(q,O,s)),t--,F=C(t),e(q,F,w),s=a[F],0!==s&&(t-=T[F],W(q,t,s)))}while(Z<q.last_lit);e(q,256,I)},M=(q,I)=>{const l=I.dyn_tree,w=I.stat_desc.static_tree,t=I.stat_desc.has_stree,c=I.stat_desc.elems;let a,F,s,Z=-1;for(q.heap_len=0,q.heap_max=573,a=0;a<c;a++)0!==l[2*a]?(q.heap[++q.heap_len]=Z=a,q.depth[a]=0):l[2*a+1]=0;for(;q.heap_len<2;)s=q.heap[++q.heap_len]=Z<2?++Z:0,l[2*s]=1,q.depth[s]=0,q.opt_len--,t&&(q.static_len-=w[2*s+1]);for(I.max_code=Z,a=q.heap_len>>1;a>=1;a--)K(q,l,a);s=c;do{a=q.heap[1],q.heap[1]=q.heap[q.heap_len--],K(q,l,1),F=q.heap[1],q.heap[--q.heap_max]=a,q.heap[--q.heap_max]=F,l[2*s]=l[2*a]+l[2*F],q.depth[s]=(q.depth[a]>=q.depth[F]?q.depth[a]:q.depth[F])+1,l[2*a+1]=l[2*F+1]=s,q.heap[1]=s++,K(q,l,1)}while(q.heap_len>=2);q.heap[--q.heap_max]=q.heap[1],((q,I)=>{const l=I.dyn_tree,w=I.max_code,t=I.stat_desc.static_tree,c=I.stat_desc.has_stree,a=I.stat_desc.extra_bits,F=I.stat_desc.extra_base,s=I.stat_desc.max_length;let Z,r,x,o,d,T,V=0;for(o=0;o<=O;o++)q.bl_count[o]=0;for(l[2*q.heap[q.heap_max]+1]=0,Z=q.heap_max+1;Z<573;Z++)r=q.heap[Z],o=l[2*l[2*r+1]+1]+1,o>s&&(o=s,V++),l[2*r+1]=o,r>w||(q.bl_count[o]++,d=0,r>=F&&(d=a[r-F]),T=l[2*r],q.opt_len+=T*(o+d),c&&(q.static_len+=T*(t[2*r+1]+d)));if(0!==V){do{for(o=s-1;0===q.bl_count[o];)o--;q.bl_count[o]--,q.bl_count[o+1]+=2,q.bl_count[s]--,V-=2}while(V>0);for(o=s;0!==o;o--)for(r=q.bl_count[o];0!==r;)x=q.heap[--Z],x>w||(l[2*x+1]!==o&&(q.opt_len+=(o-l[2*x+1])*l[2*x],l[2*x+1]=o),r--)}})(q,I),S(l,Z,q.bl_count)},n=(q,I,l)=>{let w,t,O=-1,c=I[1],a=0,F=7,s=4;for(0===c&&(F=138,s=3),I[2*(l+1)+1]=65535,w=0;w<=l;w++)t=c,c=I[2*(w+1)+1],++a<F&&t===c||(a<s?q.bl_tree[2*t]+=a:0!==t?(t!==O&&q.bl_tree[2*t]++,q.bl_tree[32]++):a<=10?q.bl_tree[34]++:q.bl_tree[36]++,a=0,O=t,0===c?(F=138,s=3):t===c?(F=6,s=3):(F=7,s=4))},f=(q,I,l)=>{let w,t,O=-1,c=I[1],a=0,F=7,s=4;for(0===c&&(F=138,s=3),w=0;w<=l;w++)if(t=c,c=I[2*(w+1)+1],!(++a<F&&t===c)){if(a<s)do{e(q,t,q.bl_tree)}while(0!==--a);else 0!==t?(t!==O&&(e(q,t,q.bl_tree),a--),e(q,16,q.bl_tree),W(q,a-3,2)):a<=10?(e(q,17,q.bl_tree),W(q,a-3,3)):(e(q,18,q.bl_tree),W(q,a-11,7));a=0,O=t,0===c?(F=138,s=3):t===c?(F=6,s=3):(F=7,s=4)}};let L=!1;const E=(q,I,l,w)=>{W(q,0+(w?1:0),3),((q,I,l,w)=>{p(q),w&&(R(q,l),R(q,~l)),q.pending_buf.set(q.window.subarray(I,I+l),q.pending),q.pending+=l})(q,I,l,!0)};q.exports._tr_init=q=>{L||((()=>{let q,I,l,s,k;const C=new Array(16);for(l=0,s=0;s<28;s++)for(d[s]=l,q=0;q<1<<c[s];q++)o[l++]=s;for(o[l-1]=s,k=0,s=0;s<16;s++)for(T[s]=k,q=0;q<1<<a[s];q++)x[k++]=s;for(k>>=7;s<t;s++)for(T[s]=k<<7,q=0;q<1<<a[s]-7;q++)x[256+k++]=s;for(I=0;I<=O;I++)C[I]=0;for(q=0;q<=143;)Z[2*q+1]=8,q++,C[8]++;for(;q<=255;)Z[2*q+1]=9,q++,C[9]++;for(;q<=279;)Z[2*q+1]=7,q++,C[7]++;for(;q<=287;)Z[2*q+1]=8,q++,C[8]++;for(S(Z,287,C),q=0;q<t;q++)r[2*q+1]=5,r[2*q]=i(q,5);U=new V(Z,c,257,w,O),B=new V(r,a,0,t,O),v=new V(new Array(0),F,0,19,7)})(),L=!0),q.l_desc=new k(q.dyn_ltree,U),q.d_desc=new k(q.dyn_dtree,B),q.bl_desc=new k(q.bl_tree,v),q.bi_buf=0,q.bi_valid=0,g(q)},q.exports._tr_stored_block=E,q.exports._tr_flush_block=(q,I,w,t)=>{let O,c,a=0;q.level>0?(2===q.strm.data_type&&(q.strm.data_type=(q=>{let I,w=4093624447;for(I=0;I<=31;I++,w>>>=1)if(1&w&&0!==q.dyn_ltree[2*I])return 0;if(0!==q.dyn_ltree[18]||0!==q.dyn_ltree[20]||0!==q.dyn_ltree[26])return 1;for(I=32;I<l;I++)if(0!==q.dyn_ltree[2*I])return 1;return 0})(q)),M(q,q.l_desc),M(q,q.d_desc),a=(q=>{let I;for(n(q,q.dyn_ltree,q.l_desc.max_code),n(q,q.dyn_dtree,q.d_desc.max_code),M(q,q.bl_desc),I=18;I>=3&&0===q.bl_tree[2*s[I]+1];I--);return q.opt_len+=3*(I+1)+5+5+4,I})(q),O=q.opt_len+3+7>>>3,c=q.static_len+3+7>>>3,c<=O&&(O=c)):O=c=w+5,w+4<=O&&-1!==I?E(q,I,w,t):4===q.strategy||c===O?(W(q,2+(t?1:0),3),D(q,Z,r)):(W(q,4+(t?1:0),3),((q,I,l,w)=>{let t;for(W(q,I-257,5),W(q,l-1,5),W(q,w-4,4),t=0;t<w;t++)W(q,q.bl_tree[2*s[t]+1],3);f(q,q.dyn_ltree,I-1),f(q,q.dyn_dtree,l-1)})(q,q.l_desc.max_code+1,q.d_desc.max_code+1,a+1),D(q,q.dyn_ltree,q.dyn_dtree)),g(q),t&&p(q)},q.exports._tr_tally=(q,I,w)=>(q.pending_buf[q.d_buf+2*q.last_lit]=I>>>8&255,q.pending_buf[q.d_buf+2*q.last_lit+1]=255&I,q.pending_buf[q.l_buf+q.last_lit]=255&w,q.last_lit++,0===I?q.dyn_ltree[2*w]++:(q.matches++,I--,q.dyn_ltree[2*(o[w]+l+1)]++,q.dyn_dtree[2*C(I)]++),q.last_lit===q.lit_bufsize-1),q.exports._tr_align=q=>{W(q,2,3),e(q,256,Z),(q=>{16===q.bi_valid?(R(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):q.bi_valid>=8&&(q.pending_buf[q.pending++]=255&q.bi_buf,q.bi_buf>>=8,q.bi_valid-=8)})(q)}},13890:q=>{"use strict";q.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.sI="",this.state=null,this.data_type=2,this.adler=0}},13497:q=>{function I(q,I,l){for(var w=q.length,t=-1/0,O=1/0,c=0;c<w;c++){var a=(l[0][c]-q[c])/I[c],F=(l[1][c]-q[c])/I[c];if(a>F){var s=a;a=F,F=s}if(F<t||a>O)return 1/0;a>t&&(t=a),F<O&&(O=F)}return t>O?1/0:t}q.exports=function(q,l,w,t){var O=I(l,w,t);if(O===1/0)q=null;else{q=q||[];for(var c=0;c<l.length;c++)q[c]=l[c]+w[c]*O}return q},q.exports.distance=I},14926:(q,I,l)=>{"use strict";l.d(I,{d:()=>c});var w=l(38);const t=w.useLayoutEffect;const O=function(q){var I=(0,w.useRef)(q);return t((function(){I.current=q})),I};var c=function(q){var I=O(q);(0,w.cI)((function(){var q=function(q){var l;if(null!=I.current&&(l=I.current(q)),q.defaultPrevented&&(q.returnValue=""),"string"===typeof l)return q.returnValue=l,l};return window.addEventListener("beforeunload",q),function(){window.removeEventListener("beforeunload",q)}}),[])}},14887:(q,I,l)=>{"use strict";var w=l(14895),t=Array.prototype.concat,O=Array.prototype.slice,c=q.exports=function(q){for(var I=[],l=0,c=q.length;l<c;l++){var a=q[l];w(a)?I=t.call(I,O.call(a)):I.push(a)}return I};c.wrap=function(q){return function(){return q(c(arguments))}}},14895:q=>{q.exports=function(q){return!(!q||"string"===typeof q)&&(q instanceof Array||Array.isArray(q)||q.length>=0&&(q.splice instanceof Function||Object.getOwnPropertyDescriptor(q,q.length-1)&&"String"!==q.constructor.name))}},13792:(q,I,l)=>{var w=l(13801);function t(q){for(var I,l,t=0,O=q.length,c=0;c<q.length;){for(I=q[c],l=0;c<O&&q[c]===I;)++c,++l;t+=w.log2(l)/7|0,t+=w.log2(I>>>0)/7|0,t+=2}return t}I.size=t,I.encode=function(q,I){I||(I=new Uint8Array(t(q)));for(var l,w,O=0,c=I.length,a=0;a<q.length;){for(l=q[a],w=0;a<q.length&&q[a]===l;)++a,++w;for(;O<c&&w>=128;)I[O++]=128+(127&w),w>>>=7;if(O>=c)throw new Error("RLE buffer overflow");for(I[O++]=w,l>>>=0;O<c&&l>=128;)I[O++]=128+(127&l),l>>>=7;if(O>=c)throw new Error("RLE buffer overflow");I[O++]=l}return I},I.decode=function(q,I){for(var l,w,t,O,c=I.length,a=q.length,F=0,s=0;s<a;){for(l=0,w=0;s<a&&q[s]>=128;)l+=(127&q[s++])<<w,w+=7;if(l+=q[s++]<<w,s>=a)throw new Error("RLE buffer underrun");if(F+l>c)throw new Error("Chunk buffer overflow");for(t=0,w=0;s<a&&q[s]>=128;)t+=(127&q[s++])<<w,w+=7;if(s>=a)throw new Error("RLE buffer underrun");for(t+=q[s++]<<w,O=0;O<l;++O)I[F++]=t}return I}},13801:(q,I)=>{"use strict";function l(q){var I=32;return(q&=-q)&&I--,65535&q&&(I-=16),16711935&q&&(I-=8),252645135&q&&(I-=4),858993459&q&&(I-=2),1431655765&q&&(I-=1),I}I.INT_BITS=32,I.INT_MAX=2147483647,I.INT_MIN=-1<<31,I.sign=function(q){return(q>0)-(q<0)},I.abs=function(q){var I=q>>31;return(q^I)-I},I.min=function(q,I){return I^(q^I)&-(q<I)},I.max=function(q,I){return q^(q^I)&-(q<I)},I.isPow2=function(q){return!(q&q-1)&&!!q},I.log2=function(q){var I,l;return I=(q>65535)<<4,I|=l=((q>>>=I)>255)<<3,I|=l=((q>>>=l)>15)<<2,(I|=l=((q>>>=l)>3)<<1)|(q>>>=l)>>1},I.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},I.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},I.countTrailingZeros=l,I.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},I.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},I.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var w=new Array(256);!function(q){for(var I=0;I<256;++I){var l=I,w=I,t=7;for(l>>>=1;l;l>>>=1)w<<=1,w|=1&l,--t;q[I]=w<<t&255}}(w),I.reverse=function(q){return w[255&q]<<24|w[q>>>8&255]<<16|w[q>>>16&255]<<8|w[q>>>24&255]},I.interleave2=function(q,I){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))<<1},I.deinterleave2=function(q,I){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>I&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},I.interleave3=function(q,I,l){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<1)|(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<2},I.deinterleave3=function(q,I){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>I&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},I.nextCombination=function(q){var I=q|q-1;return I+1|(~I&-~I)-1>>>l(q)+1}},13829:q=>{"use strict";q.exports=function(q,I,l,w){var t=self||window;try{try{var O;try{O=new t.Blob([q])}catch(s){(O=new(t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder)).append(q),O=O.getBlob()}var c=t.URL||t.webkitURL,a=c.createObjectURL(O),F=new t[I](a,l);return c.revokeObjectURL(a),F}catch(s){return new t[I]("data:application/javascript,".concat(encodeURIComponent(q)),l)}}catch(s){if(!w)throw Error("Inline worker is not supported");return new t[I](w,l)}}},13486:(q,I,l)=>{"use strict";function w(q,I,l,w,t){var O={};return Object.keys(w).forEach((function(q){O[q]=w[q]})),O.enumerable=!!O.enumerable,O.configurable=!!O.configurable,("value"in O||O.initializer)&&(O.writable=!0),O=l.slice().reverse().reduce((function(l,w){return w(q,I,l)||l}),O),t&&void 0!==O.initializer&&(O.value=O.initializer?O.initializer.call(t):void 0,O.initializer=void 0),void 0===O.initializer&&(Object.defineProperty(q,I,O),O=null),O}l.d(I,{e:()=>w})},13480:(q,I,l)=>{"use strict";function w(q,I,l,w){l&&Object.defineProperty(q,I,{enumerable:l.enumerable,configurable:l.configurable,writable:l.writable,value:l.initializer?l.initializer.call(w):void 0})}l.d(I,{e:()=>w})},14921:(q,I,l)=>{"use strict";l.d(I,{b:()=>c,f:()=>r,j:()=>a,n:()=>O,o:()=>F,r:()=>t,v:()=>s,z:()=>Z});var w=l(12965);class t{constructor(){this._easingMode=t.EASINGMODE_EASEIN}setEasingMode(q){const I=Math.min(Math.max(q,0),2);this._easingMode=I}getEasingMode(){return this._easingMode}easeInCore(q){throw new Error("You must implement this method")}ease(q){switch(this._easingMode){case t.EASINGMODE_EASEIN:return this.easeInCore(q);case t.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-q)}return q>=.5?.5*(1-this.easeInCore(2*(1-q)))+.5:.5*this.easeInCore(2*q)}}t.EASINGMODE_EASEIN=0,t.EASINGMODE_EASEOUT=1,t.EASINGMODE_EASEINOUT=2;class O extends t{easeInCore(q){return q=Math.max(0,Math.min(1,q)),1-Math.sqrt(1-q*q)}}class c extends t{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=q}easeInCore(q){const I=Math.max(0,this.amplitude);return Math.pow(q,3)-q*I*Math.sin(3.141592653589793*q)}}class a extends t{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=q,this.bounciness=I}easeInCore(q){const I=Math.max(0,this.bounces);let l=this.bounciness;l<=1&&(l=1.001);const w=Math.pow(l,I),t=1-l,O=(1-w)/t+.5*w,c=q*O,a=Math.log(-c*(1-l)+1)/Math.log(l),F=Math.floor(a),s=F+1,Z=(1-Math.pow(l,F))/(t*O),r=.5*(Z+(1-Math.pow(l,s))/(t*O)),x=q-r,o=r-Z;return-Math.pow(1/l,I-F)/(o*o)*(x-o)*(x+o)}}class F extends t{easeInCore(q){return q*q*q}}class s extends t{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=q,this.springiness=I}easeInCore(q){let I;const l=Math.max(0,this.oscillations),w=Math.max(0,this.springiness);return I=0==w?q:(Math.exp(w*q)-1)/(Math.exp(w)-1),I*Math.sin((6.283185307179586*l+1.5707963267948966)*q)}}class Z extends t{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=q}easeInCore(q){return this.exponent<=0?q:(Math.exp(this.exponent*q)-1)/(Math.exp(this.exponent)-1)}}class r extends t{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=q,this.y1=I,this.x2=l,this.y2=w}easeInCore(q){return w.b.Interpolate(q,this.x1,this.y1,this.x2,this.y2)}}},14371:(q,I,l)=>{"use strict";l.d(I,{e:()=>c});var w=l(12747),t=l(12757),O=l(13171);class c extends O.d{get _matrix(){return this._compose(),this.wo}set _matrix(q){(q.updateFlag!==this.wo.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.wo.t(q),this._markAsDirtyAndDecompose())}constructor(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(q,I.Wq(),!1),this.name=q,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=I,this.wo=(null===t||void 0===t?void 0:t.clone())??w.Matrix.Identity(),this._restMatrix=O??this.wo.clone(),this._bindMatrix=c??this.wo.clone(),this._index=a,this._absoluteMatrix=new w.Matrix,this._absoluteBindMatrix=new w.Matrix,this._absoluteInverseBindMatrix=new w.Matrix,this._finalMatrix=new w.Matrix,I.bones.push(this),this.setParent(l,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(q){this.setParent(q)}setParent(q){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==q){if(this.parent){const q=this.parent.children.indexOf(this);-1!==q&&this.parent.children.splice(q,1)}this._parentNode=q,this.parent&&this.parent.children.push(this),I&&this._updateAbsoluteBindMatrices(),this.TZ()}}getLocalMatrix(){return this._compose(),this.wo}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(q){this._restMatrix.t(q)}setRestPose(q){this.setRestMatrix(q)}getBindPose(){return this.getBindMatrix()}setBindMatrix(q){this.kc(q)}setBindPose(q){this.setBindMatrix(q)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const q=w.TmpVectors.dI[0],I=w.TmpVectors.Quaternion[0],l=w.TmpVectors.dI[1];this.getRestMatrix().decompose(q,I,l),this._linkedTransformNode.position.t(l),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??w.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.t(I),this._linkedTransformNode.Xc.t(q)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(q){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=q,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.TF}set position(q){this._decompose(),this.TF.t(q),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(q){this.setRotation(q)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(q){this.setRotationQuaternion(q)}get Xc(){return this.getScale()}set Xc(q){this.setScale(q)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=w.dI.Zero(),this._localRotation=w.Quaternion.Zero(),this.TF=w.dI.Zero()),this.wo.decompose(this._localScaling,this._localRotation,this.TF))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,w.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.TF,this.wo)):this._needToCompose=!1)}kc(q){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.t(q),I&&this._updateAbsoluteBindMatrices(),l?this._matrix=q:this.TZ()}_updateAbsoluteBindMatrices(q){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(q||(q=this._bindMatrix),this.parent?q.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.t(q),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),I)for(let l=0;l<this.children.length;l++)this.children[l]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}TZ(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.TZ(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.TZ(),this._needToDecompose=!0}_updatePosition(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const O=this.getLocalMatrix();if(0==I)t?(O.addAtIndex(12,q.x),O.addAtIndex(13,q.y),O.addAtIndex(14,q.z)):O.setTranslationFromFloats(q.x,q.y,q.z);else{let I=null;l&&(I=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=c._TmpMats[0],F=c._TmpVecs[0];this.parent?l&&I?(a.t(this.parent.getAbsoluteMatrix()),a.multiplyToRef(I,a)):a.t(this.parent.getAbsoluteMatrix()):w.Matrix.IdentityToRef(a),t&&a.setTranslationFromFloats(0,0,0),a.invert(),w.dI.TransformCoordinatesToRef(q,a,F),t?(O.addAtIndex(12,F.x),O.addAtIndex(13,F.y),O.addAtIndex(14,F.z)):O.setTranslationFromFloats(F.x,F.y,F.z)}this._markAsDirtyAndDecompose()}translate(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,I,l,!0)}setPosition(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,I,l,!1)}setAbsolutePosition(q,I){this.setPosition(q,1,I)}scale(q,I,l){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const O=this.getLocalMatrix(),a=c._TmpMats[0];w.Matrix.ScalingToRef(q,I,l,a),a.multiplyToRef(O,O),a.invert();for(const w of this.children){const t=w.getLocalMatrix();t.multiplyToRef(a,t),t.multiplyAtIndex(12,q),t.multiplyAtIndex(13,I),t.multiplyAtIndex(14,l),w._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),t)for(const w of this.children)w.scale(q,I,l,t)}setScale(q){this._decompose(),this._localScaling.t(q),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(q){this._decompose(),q.t(this._localScaling)}setYawPitchRoll(q,I,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4?arguments[4]:void 0;if(0===t){const a=c._TmpQuat;return w.Quaternion.RotationYawPitchRollToRef(q,I,l,a),void this.setRotationQuaternion(a,t,O)}const a=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,O))return;const F=c._TmpMats[1];w.Matrix.RotationYawPitchRollToRef(q,I,l,F),a.multiplyToRef(F,F),this._rotateWithMatrix(F,t,O)}rotate(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;const O=c._TmpMats[0];O.setTranslationFromFloats(0,0,0),w.Matrix.RotationAxisToRef(q,I,O),this._rotateWithMatrix(O,l,t)}setAxisAngle(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3?arguments[3]:void 0;if(0===l){const O=c._TmpQuat;return w.Quaternion.RotationAxisToRef(q,I,O),void this.setRotationQuaternion(O,l,t)}const O=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,t))return;const a=c._TmpMats[1];w.Matrix.RotationAxisToRef(q,I,a),O.multiplyToRef(a,a),this._rotateWithMatrix(a,l,t)}setRotation(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(q.y,q.x,q.z,I,l)}setRotationQuaternion(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;if(0===I)return this._decompose(),this._localRotation.t(q),void this._markAsDirtyAndCompose();const t=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,l))return;const O=c._TmpMats[1];w.Matrix.FromQuaternionToRef(q,O),t.multiplyToRef(O,O),this._rotateWithMatrix(O,I,l)}setRotationMatrix(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;if(0===I){const t=c._TmpQuat;return w.Quaternion.FromRotationMatrixToRef(q,t),void this.setRotationQuaternion(t,I,l)}const t=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,l))return;const O=c._TmpMats[1];O.t(q),t.multiplyToRef(q,O),this._rotateWithMatrix(O,I,l)}_rotateWithMatrix(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;const w=this.getLocalMatrix(),t=w.m[12],O=w.m[13],a=w.m[14],F=this.getParent(),s=c._TmpMats[3],Z=c._TmpMats[4];F&&1==I?(l?(s.t(l.getWorldMatrix()),F.getAbsoluteMatrix().multiplyToRef(s,s)):s.t(F.getAbsoluteMatrix()),Z.t(s),Z.invert(),w.multiplyToRef(s,w),w.multiplyToRef(q,w),w.multiplyToRef(Z,w)):1==I&&l?(s.t(l.getWorldMatrix()),Z.t(s),Z.invert(),w.multiplyToRef(s,w),w.multiplyToRef(q,w),w.multiplyToRef(Z,w)):w.multiplyToRef(q,w),w.setTranslationFromFloats(t,O,a),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(q,I){const l=c._TmpMats[2];return q.t(this.getAbsoluteMatrix()),I?(q.multiplyToRef(I.getWorldMatrix(),q),w.Matrix.ScalingToRef(I.Xc.x,I.Xc.y,I.Xc.z,l)):w.Matrix.IdentityToRef(l),q.invert(),!isNaN(q.m[0])&&(l.multiplyAtIndex(0,this._scalingDeterminant),q.multiplyToRef(l,q),!0)}mc(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=w.dI.Zero();return this.getPositionToRef(q,I,l),l}getPositionToRef(){let q=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const q=this.getLocalMatrix();I.x=q.m[12],I.y=q.m[13],I.z=q.m[14]}else{let l=null;q&&(l=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let w=c._TmpMats[0];q&&l?(w.t(this.getAbsoluteMatrix()),w.multiplyToRef(l,w)):w=this.getAbsoluteMatrix(),I.x=w.m[12],I.y=w.m[13],I.z=w.m[14]}}getAbsolutePosition(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const I=w.dI.Zero();return this.getPositionToRef(1,q,I),I}getAbsolutePositionToRef(q,I){this.getPositionToRef(1,q,I)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.wo.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.t(this.wo);const q=this._skeleton.getPoseMatrix();q&&this._absoluteMatrix.multiplyToRef(q,this._absoluteMatrix)}const q=this.children,I=q.length;for(let l=0;l<I;l++)q[l].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}yF(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=w.dI.Zero();return this.getDirectionToRef(q,I,l),l}getDirectionToRef(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,t=null;I&&(t=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=c._TmpMats[0];O.t(this.getAbsoluteMatrix()),I&&t&&O.multiplyToRef(t,O),w.dI.TransformNormalToRef(q,O,l),l.normalize()}getRotation(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=w.dI.Zero();return this.getRotationToRef(q,I,l),l}getRotationToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;const w=c._TmpQuat;this.getRotationQuaternionToRef(q,I,w),w.toEulerAnglesToRef(l)}getRotationQuaternion(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=w.Quaternion.Identity();return this.getRotationQuaternionToRef(q,I,l),l}getRotationQuaternionToRef(){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),I.t(this._localRotation);else{const l=c._TmpMats[0],w=this.getAbsoluteMatrix();q?w.multiplyToRef(q.getWorldMatrix(),l):l.t(w),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.decompose(void 0,I,void 0)}}getRotationMatrix(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1?arguments[1]:void 0;const l=w.Matrix.Identity();return this.getRotationMatrixToRef(q,I,l),l}getRotationMatrixToRef(){let q=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(I);else{const l=c._TmpMats[0],w=this.getAbsoluteMatrix();q?w.multiplyToRef(q.getWorldMatrix(),l):l.t(w),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.getRotationMatrixToRef(I)}}getAbsolutePositionFromLocal(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=w.dI.Zero();return this.getAbsolutePositionFromLocalToRef(q,I,l),l}getAbsolutePositionFromLocalToRef(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,t=null;I&&(t=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=c._TmpMats[0];O.t(this.getAbsoluteMatrix()),I&&t&&O.multiplyToRef(t,O),w.dI.TransformCoordinatesToRef(q,O,l)}getLocalPositionFromAbsolute(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=w.dI.Zero();return this.getLocalPositionFromAbsoluteToRef(q,I,l),l}getLocalPositionFromAbsoluteToRef(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,t=null;I&&(t=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=c._TmpMats[0];O.t(this.getAbsoluteMatrix()),I&&t&&O.multiplyToRef(t,O),O.invert(),w.dI.TransformCoordinatesToRef(q,O,l)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const q=this._skeleton.bones.indexOf(this);if(-1!==q&&this._skeleton.bones.splice(q,1),this._parentNode&&this._parentNode.children){const q=this._parentNode.children,I=q.indexOf(this);-1!==I&&q.splice(I,1)}super.dispose()}}c._TmpVecs=(0,t.d)(2,w.dI.Zero),c._TmpQuat=w.Quaternion.Identity(),c._TmpMats=(0,t.d)(5,w.Matrix.Identity)},14919:(q,I,l)=>{"use strict";l.d(I,{d:()=>M});var w=l(12735),t=l(12740),O=l(12573),c=l(12747),a=l(12761),F=l(13171),s=l(13184),Z=l(13024),r=l(12601),x=l(12752);class o{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(q){this._idleRotationSpeed=q}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(q){this._idleRotationWaitTime=q}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(q){this._idleRotationSpinupTime=q}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(q){this._attachedCamera=q;const I=this._attachedCamera.Wq();this._onPrePointerObservableObserver=I.onPrePointerObservable.add((q=>{q.type!==Z.c.POINTERDOWN?q.type===Z.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const q=r.e.Now;let I=0;null!=this._lastFrameTime&&(I=q-this._lastFrameTime),this._lastFrameTime=q,this._applyUserInteraction();const l=q-this._lastInteractionTime-this._idleRotationWaitTime,w=Math.max(Math.min(l/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*w,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(I/1e3))}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.Wq();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(q){this._lastInteractionTime=q??r.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<x.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let q=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(q=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?q:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=r.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var d=l(14921),T=l(13247);class V{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(q){if(this._autoTransitionRange===q)return;this._autoTransitionRange=q;const I=this._attachedCamera;I&&(q?this._onMeshTargetChangedObserver=I.onMeshTargetChangedObservable.add((q=>{if(q&&(q.Cc(!0),q.getBoundingInfo)){const I=q.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*I,this.upperRadiusTransitionRange=.05*I}})):this._onMeshTargetChangedObserver&&I.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(q){this._attachedCamera=q,this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(q){return!!this._attachedCamera&&(this._attachedCamera.radius===q&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(q){if(!this._attachedCamera)return;this._radiusBounceTransition||(V.EasingFunction.setEasingMode(V.EasingMode),this._radiusBounceTransition=T.d.CreateAnimation("radius",T.d.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const I=T.d.TransitionTo("radius",this._attachedCamera.radius+q,this._attachedCamera,this._attachedCamera.Wq(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));I&&this._animatables.push(I)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}V.EasingFunction=new d.b(.3),V.EasingMode=d.r.EASINGMODE_EASEOUT;class U{constructor(){this.onTargetFramingAnimationEndObservable=new O.d,this._mode=U.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(q){this._mode=q}get mode(){return this._mode}set radiusScale(q){this._radiusScale=q}get radiusScale(){return this._radiusScale}set positionScale(q){this._positionScale=q}get positionScale(){return this._positionScale}set defaultElevation(q){this._defaultElevation=q}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(q){this._elevationReturnTime=q}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(q){this._elevationReturnWaitTime=q}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(q){this._framingTime=q}get framingTime(){return this._framingTime}init(){}attach(q){this._attachedCamera=q;const I=this._attachedCamera.Wq();U.EasingFunction.setEasingMode(U.EasingMode),this._onPrePointerObservableObserver=I.onPrePointerObservable.add((q=>{q.type!==Z.c.POINTERDOWN?q.type===Z.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=q.onMeshTargetChangedObservable.add((q=>{q&&q.getBoundingInfo&&this.zoomOnMesh(q,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.Wq();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.Cc(!0);const w=q.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(w.minimumWorld,w.maximumWorld,I,l)}zoomOnMeshHierarchy(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.Cc(!0);const w=q.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(w.min,w.max,I,l)}zoomOnMeshesHierarchy(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new c.dI(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new c.dI(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let O=0;O<q.length;O++){const I=q[O].getHierarchyBoundingVectors(!0);c.dI.CheckExtends(I.min,w,t),c.dI.CheckExtends(I.max,w,t)}this.zoomOnBoundingInfo(w,t,I,l)}zoomOnBoundingInfo(q,I){let l,w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const O=q.y,a=O+(I.y-O)*this._positionScale,F=I.TI(q).scale(.5);if(!isFinite(a))return!1;if(w)l=new c.dI(0,a,0);else{const I=q.add(F);l=new c.dI(I.x,a,I.z)}this._vectorTransition||(this._vectorTransition=T.d.CreateAnimation("target",T.d.ANIMATIONTYPE_VECTOR3,60,U.EasingFunction)),this._betaIsAnimating=!0;let s=T.d.TransitionTo("target",l,this._attachedCamera,this._attachedCamera.Wq(),60,this._vectorTransition,this._framingTime);s&&this._animatables.push(s);let Z=0;if(this._mode===U.FitFrustumSidesMode){const l=this._calculateLowerRadiusFromModelBoundingSphere(q,I);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=F.length()+this._attachedCamera.vc),Z=l}else this._mode===U.IgnoreBoundsSizeMode&&(Z=this._calculateLowerRadiusFromModelBoundingSphere(q,I),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.vc));if(this.autoCorrectCameraLimitsAndSensibility){const l=I.TI(q).length();this._attachedCamera.panningSensibility=5e3/l,this._attachedCamera.wheelPrecision=100/Z}return this._radiusTransition||(this._radiusTransition=T.d.CreateAnimation("radius",T.d.ANIMATIONTYPE_FLOAT,60,U.EasingFunction)),s=T.d.TransitionTo("radius",Z,this._attachedCamera,this._attachedCamera.Wq(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),t&&t(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),s&&this._animatables.push(s),!0}_calculateLowerRadiusFromModelBoundingSphere(q,I){const l=this._attachedCamera;if(!l)return 0;let w=l._calculateLowerRadiusFromModelBoundingSphere(q,I,this._radiusScale);return l.lowerRadiusLimit&&this._mode===U.IgnoreBoundsSizeMode&&(w=w<l.lowerRadiusLimit?l.lowerRadiusLimit:w),l.upperRadiusLimit&&(w=w>l.upperRadiusLimit?l.upperRadiusLimit:w),w}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const q=r.e.Now-this._lastInteractionTime,I=.5*Math.PI-this._defaultElevation,l=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>l&&q>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=T.d.CreateAnimation("beta",T.d.ANIMATIONTYPE_FLOAT,60,U.EasingFunction));const q=T.d.TransitionTo("beta",I,this._attachedCamera,this._attachedCamera.Wq(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));q&&this._animatables.push(q)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=r.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}U.EasingFunction=new d.z,U.EasingMode=d.r.EASINGMODE_EASEINOUT,U.IgnoreBoundsSizeMode=0,U.FitFrustumSidesMode=1;var B=l(13186),v=l(13211),k=l(14366),C=l(12564);class R{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(q){q=C.Tools.BackCompatCameraNoPreventDefault(arguments);const I=this.camera.getEngine(),l=I.getInputElement();let w=0,t=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=O=>{var c,a;const F=O.event,s="touch"===F.pointerType;if(O.type!==Z.c.POINTERMOVE&&-1===this.buttons.indexOf(F.button))return;const r=F.target;if(this._altKey=F.altKey,this._ctrlKey=F.ctrlKey,this._metaKey=F.metaKey,this._shiftKey=F.shiftKey,this._buttonsPressed=F.buttons,I.isPointerLock){const q=F.movementX,I=F.movementY;this.onTouch(null,q,I),this._pointA=null,this._pointB=null}else{if(O.type!==Z.c.POINTERDOWN&&O.type!==Z.c.POINTERDOUBLETAP&&s&&(null===(c=this._pointA)||void 0===c?void 0:c.pointerId)!==F.pointerId&&(null===(a=this._pointB)||void 0===a?void 0:a.pointerId)!==F.pointerId)return;if(O.type!==Z.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!s)if(O.type===Z.c.POINTERDOUBLETAP)this.onDoubleTap(F.pointerType);else if(O.type!==Z.c.POINTERUP||this._currentMousePointerIdDown!==F.pointerId&&!s){if(O.type===Z.c.POINTERMOVE)if(q||F.preventDefault(),this._pointA&&null===this._pointB){const q=F.clientX-this._pointA.x,I=F.clientY-this._pointA.y;this._pointA.x=F.clientX,this._pointA.y=F.clientY,this.onTouch(this._pointA,q,I)}else if(this._pointA&&this._pointB){const q=this._pointA.pointerId===F.pointerId?this._pointA:this._pointB;q.x=F.clientX,q.y=F.clientY;const I=this._pointA.x-this._pointB.x,l=this._pointA.y-this._pointB.y,c=I*I+l*l,a={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:F.pointerId,type:O.type};this.onMultiTouch(this._pointA,this._pointB,w,c,t,a),t=a,w=c}}else{try{null===r||void 0===r||r.releasePointerCapture(F.pointerId)}catch(x){}s||(this._pointB=null),I._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==F.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==F.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==w||t)&&(this.onMultiTouch(this._pointA,this._pointB,w,0,t,null),w=0,t=null),this._currentMousePointerIdDown=-1,this.onButtonUp(F),q||F.preventDefault()}else{try{null===r||void 0===r||r.setPointerCapture(F.pointerId)}catch(x){}if(null===this._pointA)this._pointA={x:F.clientX,y:F.clientY,pointerId:F.pointerId,type:F.pointerType};else{if(null!==this._pointB)return;this._pointB={x:F.clientX,y:F.clientY,pointerId:F.pointerId,type:F.pointerType}}-1!==this._currentMousePointerIdDown||s||(this._currentMousePointerIdDown=F.pointerId),this.onButtonDown(F),q||(F.preventDefault(),l&&l.focus())}}},this._observer=this.camera.Wq()._inputManager._addCameraPointerObserver(this._pointerInput,Z.c.POINTERDOWN|Z.c.POINTERUP|Z.c.POINTERMOVE|Z.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,w=0,t=null,this.onLostFocus()},this._contextMenuBind=q=>this.onContextMenu(q),l&&l.addEventListener("contextmenu",this._contextMenuBind,!1);const O=this.camera.Wq().getEngine().getHostWindow();O&&C.Tools.RegisterTopRootEvents(O,[{name:"blur",handler:this._onLostFocus}])}tx(){if(this._onLostFocus){const q=this.camera.Wq().getEngine().getHostWindow();q&&C.Tools.UnregisterTopRootEvents(q,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Wq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const q=this.camera.Wq().getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(q){}onTouch(q,I,l){}onMultiTouch(q,I,l,w,t,O){}onContextMenu(q){q.preventDefault()}onButtonDown(q){}onButtonUp(q){}onLostFocus(){}}(0,w.d)([(0,t.D)()],R.prototype,"buttons",void 0);class W extends R{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(q,I){if(0!==this.panningSensibility&&q&&I){const l=I.x-q.x,w=I.y-q.y;this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=w/this.panningSensibility}}_computePinchZoom(q,I){const l=this.camera.radius||W.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=l*Math.sqrt(q)/Math.sqrt(I):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(I-q)*l*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(I-q)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(q,I,l){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-I/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility):(this.camera.inertialAlphaOffset-=I/this.angularSensibilityX,this.camera.inertialBetaOffset-=l/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(q,I,l,w,t,O){0===l&&null===t||0===w&&null===O||(this.multiTouchPanAndZoom?(this._computePinchZoom(l,w),this._computeMultiTouchPanning(t,O)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(w)-Math.sqrt(l))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(l,w),this._isPinching=!0):this._computeMultiTouchPanning(t,O)):this.multiTouchPanning?this._computeMultiTouchPanning(t,O):this.pinchZoom&&this._computePinchZoom(l,w))}onButtonDown(q){this._isPanClick=q.button===this.camera._panningMouseButton}onButtonUp(q){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}W.MinimumRadiusForPinch=.001,(0,w.d)([(0,t.D)()],W.prototype,"buttons",void 0),(0,w.d)([(0,t.D)()],W.prototype,"angularSensibilityX",void 0),(0,w.d)([(0,t.D)()],W.prototype,"angularSensibilityY",void 0),(0,w.d)([(0,t.D)()],W.prototype,"pinchPrecision",void 0),(0,w.d)([(0,t.D)()],W.prototype,"pinchDeltaPercentage",void 0),(0,w.d)([(0,t.D)()],W.prototype,"useNaturalPinchZoom",void 0),(0,w.d)([(0,t.D)()],W.prototype,"pinchZoom",void 0),(0,w.d)([(0,t.D)()],W.prototype,"panningSensibility",void 0),(0,w.d)([(0,t.D)()],W.prototype,"multiTouchPanning",void 0),(0,w.d)([(0,t.D)()],W.prototype,"multiTouchPanAndZoom",void 0),k.c.ArcRotateCameraPointersInput=W;var e=l(13027);class i{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(q){q=C.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Wq(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((I=>{const l=I.event;if(!l.metaKey)if(I.type===e.c.KEYDOWN){if(this._ctrlPressed=l.ctrlKey,this._altPressed=l.altKey,-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysReset.indexOf(l.keyCode)){-1===this._keys.indexOf(l.keyCode)&&this._keys.push(l.keyCode),l.preventDefault&&(q||l.preventDefault())}}else if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysReset.indexOf(l.keyCode)){const I=this._keys.indexOf(l.keyCode);I>=0&&this._keys.splice(I,1),l.preventDefault&&(q||l.preventDefault())}})))}tx(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let I=0;I<this._keys.length;I++){const l=this._keys[I];-1!==this.keysLeft.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX-=1/this.panningSensibility:q.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset+=1/this.zoomingSensibility:q.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX+=1/this.panningSensibility:q.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset-=1/this.zoomingSensibility:q.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(l)&&q.useInputToRestoreState&&q.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,w.d)([(0,t.D)()],i.prototype,"keysUp",void 0),(0,w.d)([(0,t.D)()],i.prototype,"keysDown",void 0),(0,w.d)([(0,t.D)()],i.prototype,"keysLeft",void 0),(0,w.d)([(0,t.D)()],i.prototype,"keysRight",void 0),(0,w.d)([(0,t.D)()],i.prototype,"keysReset",void 0),(0,w.d)([(0,t.D)()],i.prototype,"panningSensibility",void 0),(0,w.d)([(0,t.D)()],i.prototype,"zoomingSensibility",void 0),(0,w.d)([(0,t.D)()],i.prototype,"useAltToZoom",void 0),(0,w.d)([(0,t.D)()],i.prototype,"angularSpeed",void 0),k.c.ArcRotateCameraKeyboardMoveInput=i;var S=l(12794),g=l(13036);class p{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new c.dI(0,0,0),this._globalOffset=new c.dI(0,0,0),this._inertialPanning=c.dI.Zero()}_computeDeltaFromMouseWheelLegacyEvent(q,I){let l=0;const w=.01*q*this.wheelDeltaPercentage*I;return l=q>0?w/(1+this.wheelDeltaPercentage):w*(1+this.wheelDeltaPercentage),l}attachControl(q){q=C.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=I=>{if(I.type!==Z.c.POINTERWHEEL)return;const l=I.event;let w=0;const t=l.deltaMode===g.b.DOM_DELTA_LINE?40:1,O=-l.deltaY*t;if(this.customComputeDeltaFromMouseWheel)w=this.customComputeDeltaFromMouseWheel(O,this,l);else if(this.wheelDeltaPercentage){if(w=this._computeDeltaFromMouseWheelLegacyEvent(O,this.camera.radius),w>0){let q=this.camera.radius,I=this.camera.inertialRadiusOffset+w;for(let l=0;l<20&&!(q<=I)&&!(Math.abs(I*this.camera.inertia)<.001);l++)q-=I,I*=this.camera.inertia;q=(0,a.Clamp)(q,0,Number.MAX_VALUE),w=this._computeDeltaFromMouseWheelLegacyEvent(O,q)}}else w=O/(40*this.wheelPrecision);w&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(w)):this.camera.inertialRadiusOffset+=w),l.preventDefault&&(q||l.preventDefault())},this._observer=this.camera.Wq()._inputManager._addCameraPointerObserver(this._wheel,Z.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Kc(0)}tx(){this._observer&&(this.camera.Wq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const q=this.camera;0+q.inertialAlphaOffset+q.inertialBetaOffset+q.inertialRadiusOffset&&(this._updateHitPlane(),q.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(q.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const q=this.camera,I=q.target.TI(q.position);this._hitPlane=S.c.FromPositionAndNormal(q.target,I)}_getPosition(){const q=this.camera,I=q.Wq(),l=I.createPickingRay(I.pointerX,I.pointerY,c.Matrix.Identity(),q,!1);0===q.targetScreenOffset.x&&0===q.targetScreenOffset.y||(this._viewOffset.set(q.targetScreenOffset.x,q.targetScreenOffset.y,0),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),this._globalOffset=c.dI.TransformNormal(this._viewOffset,q._cameraTransformMatrix),l.origin.addInPlace(this._globalOffset));let w=0;return this._hitPlane&&(w=l.intersectsPlane(this._hitPlane)??0),l.origin.addInPlace(l.direction.scaleInPlace(w))}_zoomToMouse(q){const I=this.camera,l=1-I.inertia;if(I.lowerRadiusLimit){const w=I.lowerRadiusLimit??0;I.radius-(I.inertialRadiusOffset+q)/l<w&&(q=(I.radius-w)*l-I.inertialRadiusOffset)}if(I.upperRadiusLimit){const w=I.upperRadiusLimit??0;I.radius-(I.inertialRadiusOffset+q)/l>w&&(q=(I.radius-w)*l-I.inertialRadiusOffset)}const w=q/l/I.radius,t=this._getPosition(),O=c.TmpVectors.dI[6];t.subtractToRef(I.target,O),O.scaleInPlace(w),O.scaleInPlace(l),this._inertialPanning.addInPlace(O),I.inertialRadiusOffset+=q}_zeroIfClose(q){Math.abs(q.x)<x.d&&(q.x=0),Math.abs(q.y)<x.d&&(q.y=0),Math.abs(q.z)<x.d&&(q.z=0)}}(0,w.d)([(0,t.D)()],p.prototype,"wheelPrecision",void 0),(0,w.d)([(0,t.D)()],p.prototype,"zoomToMouseLocation",void 0),(0,w.d)([(0,t.D)()],p.prototype,"wheelDeltaPercentage",void 0),k.c.ArcRotateCameraMouseWheelInput=p;class X extends k.d{constructor(q){super(q)}addMouseWheel(){return this.add(new p),this}addPointers(){return this.add(new W),this}addKeyboard(){return this.add(new i),this}}var K=l(12711);function D(q,I){return isNaN(q)?I:q}F.d.AddNodeConstructor("ArcRotateCamera",((q,I)=>()=>new M(q,0,0,1,c.dI.Zero(),I)));class M extends v.c{get target(){return this._target}set target(q){this.setTarget(q)}get targetHost(){return this._targetHost}set targetHost(q){q&&this.setTarget(q)}getTarget(){return this.target}get position(){return this._position}set position(q){this.setPosition(q)}set upVector(q){this._upToYMatrix||(this._yToUpMatrix=new c.Matrix,this._upToYMatrix=new c.Matrix,this._upVector=c.dI.Zero()),q.normalize(),this._upVector.t(q),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){c.Matrix.RotationAlignToRef(c.dI.UpReadOnly,this._upVector,this._yToUpMatrix),c.Matrix.RotationAlignToRef(this._upVector,c.dI.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityX:0}set angularSensibilityX(q){const I=this.inputs.attached.pointers;I&&(I.angularSensibilityX=q)}get angularSensibilityY(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityY:0}set angularSensibilityY(q){const I=this.inputs.attached.pointers;I&&(I.angularSensibilityY=q)}get pinchPrecision(){const q=this.inputs.attached.pointers;return q?q.pinchPrecision:0}set pinchPrecision(q){const I=this.inputs.attached.pointers;I&&(I.pinchPrecision=q)}get pinchDeltaPercentage(){const q=this.inputs.attached.pointers;return q?q.pinchDeltaPercentage:0}set pinchDeltaPercentage(q){const I=this.inputs.attached.pointers;I&&(I.pinchDeltaPercentage=q)}get useNaturalPinchZoom(){const q=this.inputs.attached.pointers;return!!q&&q.useNaturalPinchZoom}set useNaturalPinchZoom(q){const I=this.inputs.attached.pointers;I&&(I.useNaturalPinchZoom=q)}get panningSensibility(){const q=this.inputs.attached.pointers;return q?q.panningSensibility:0}set panningSensibility(q){const I=this.inputs.attached.pointers;I&&(I.panningSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const I=this.inputs.attached.keyboard;I&&(I.keysUp=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const I=this.inputs.attached.keyboard;I&&(I.keysDown=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const I=this.inputs.attached.keyboard;I&&(I.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const I=this.inputs.attached.keyboard;I&&(I.keysRight=q)}get wheelPrecision(){const q=this.inputs.attached.mousewheel;return q?q.wheelPrecision:0}set wheelPrecision(q){const I=this.inputs.attached.mousewheel;I&&(I.wheelPrecision=q)}get zoomToMouseLocation(){const q=this.inputs.attached.mousewheel;return!!q&&q.zoomToMouseLocation}set zoomToMouseLocation(q){const I=this.inputs.attached.mousewheel;I&&(I.zoomToMouseLocation=q)}get wheelDeltaPercentage(){const q=this.inputs.attached.mousewheel;return q?q.wheelDeltaPercentage:0}set wheelDeltaPercentage(q){const I=this.inputs.attached.mousewheel;I&&(I.wheelDeltaPercentage=q)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(q){q!==this.useBouncingBehavior&&(q?(this._bouncingBehavior=new V,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(q){q!==this.useFramingBehavior&&(q?(this._framingBehavior=new U,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(q){q!==this.useAutoRotationBehavior&&(q?(this._autoRotationBehavior=new o,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(q,I,l,w,t,a){var F;let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(q,c.dI.Zero(),a,s),F=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=c.dI.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=c.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new c.Matrix,this.panningAxis=new c.dI(1,1,0),this._transformedDirection=new c.dI,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new O.d,this.checkCollisions=!1,this.collisionRadius=new c.dI(.5,.5,.5),this._previousPosition=c.dI.Zero(),this._collisionVelocity=c.dI.Zero(),this._newPosition=c.dI.Zero(),this._computationVector=c.dI.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new c.dI(NaN,NaN,NaN),this._goalTargetScreenOffset=new c.Vector2(NaN,NaN),this._onCollisionPositionChange=function(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;l?(F.setPosition(I),F.Qo&&F.Qo(l)):F._previousPosition.t(F._position);const w=Math.cos(F.alpha),t=Math.sin(F.alpha),O=Math.cos(F.beta);let c=Math.sin(F.beta);0===c&&(c=1e-4);const a=F._getTargetPosition();F._computationVector.gc(F.radius*w*c,F.radius*O,F.radius*t*c),a.addToRef(F._computationVector,F._newPosition),F._position.t(F._newPosition);let s=F.upVector;F.allowUpsideDown&&F.beta<0&&(s=s.clone(),s=s.negate()),F._computeViewMatrix(F._position,a,s),F._viewMatrix.addAtIndex(12,F.targetScreenOffset.x),F._viewMatrix.addAtIndex(13,F.targetScreenOffset.y),F._collisionTriggered=!1},this._target=c.dI.Zero(),t&&this.setTarget(t),this.alpha=I,this.beta=l,this.radius=w,this.getViewMatrix(),this.inputs=new X(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new c.dI(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=c.Vector2.Zero()}_updateCache(q){q||super._updateCache(),this._cache._target.t(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.t(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const q=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?q.addToRef(this._targetBoundingCenter,this._target):this._target.t(q)}const q=this._getLockedTargetPosition();return q||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>x.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,O=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=O?this._currentInterpolationFactor=O:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=D(q,this._goalAlpha),this._goalBeta=D(I,this._goalBeta),this._goalRadius=D(l,this._goalRadius),this._goalTarget.set(D(w.x,this._goalTarget.x),D(w.y,this._goalTarget.y),D(w.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(D(t.x,this._goalTargetScreenOffset.x),D(t.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,a.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,a.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,a.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,a.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(q,I){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const t=arguments;I=C.Tools.BackCompatCameraNoPreventDefault(t),this._useCtrlForPanning=l,this._panningMouseButton=w,"boolean"===typeof t[0]&&(t.length>1&&(this._useCtrlForPanning=t[1]),t.length>2&&(this._panningMouseButton=t[2])),this.inputs.attachElement(I),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}tx(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let q=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){q=!0;const I=this.invertRotation?-1:1,l=this._calculateHandednessMultiplier();let w=this.inertialAlphaOffset*l;this.beta<0&&(w*=-1),this.alpha+=w*I,this.beta+=this.inertialBetaOffset*I,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<x.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<x.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*x.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){q=!0;const I=new c.dI(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),I.multiplyInPlace(this.panningAxis),c.dI.TransformNormalToRef(I,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const q=this.upVector,I=c.dI.CrossToRef(this._transformedDirection,q,this._transformedDirection);c.dI.CrossToRef(q,I,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);c.dI.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.t(this._transformedDirection)}else{if(this.parent){const q=c.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.transposeToRef(q),c.dI.TransformCoordinatesToRef(this._transformedDirection,q,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*x.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*x.d&&(this.inertialPanningY=0)}if(q)this.stopInterpolation();else if(this._isInterpolating){let q=!1;const I=this._scene.getEngine().getDeltaTime()/1e3,l=1-Math.pow(2,-I/this._currentInterpolationFactor),w=D(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const I=c.TmpVectors.dI[0].set(D(this._goalTarget.x,this._target.x),D(this._goalTarget.y,this._target.y),D(this._goalTarget.z,this._target.z));c.dI.LerpToRef(this.target,I,l,this._target),10*c.dI.Distance(this.target,I)/w<x.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.t(I),this.setTarget(this.target,!1,!0,!0)):q=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const I=c.Quaternion.RotationAlphaBetaGammaToRef(D(this._goalAlpha,this.alpha),D(this._goalBeta,this.beta),0,c.TmpVectors.Quaternion[0]),w=c.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,c.TmpVectors.Quaternion[1]),t=c.Quaternion.SlerpToRef(w,I,l,c.TmpVectors.Quaternion[2]);t.normalize();const O=t.toAlphaBetaGammaToRef(c.TmpVectors.dI[0]);if(this.alpha=O.x,this.beta=O.y,t.isApprox(I,x.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const q=I.toAlphaBetaGammaToRef(c.TmpVectors.dI[0]);this.alpha=q.x,this.beta=q.y}else q=!0}if(isNaN(this._goalRadius)||(this.radius+=(w-this.radius)*l,Math.abs(w/this.radius-1)<x.d?(this._goalRadius=NaN,this.radius=w):q=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const I=c.TmpVectors.Vector2[0].set(D(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),D(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));c.Vector2.LerpToRef(this.targetScreenOffset,I,l,this.targetScreenOffset),c.Vector2.Distance(this.targetScreenOffset,I)<x.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.t(I)):q=!0}this._isInterpolating=q}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||c.dI.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const q=this.alpha;var I,l;this.alpha=function(q){let I=Math.PI/2;return 0===q.x&&0===q.z||(I=Math.acos(q.x/Math.sqrt(Math.pow(q.x,2)+Math.pow(q.z,2)))),q.z<0&&(I=2*Math.PI-I),I}(this._computationVector),this.beta=(I=this._computationVector.y,l=this.radius,Math.acos(I/l));const w=Math.round((q-this.alpha)/(2*Math.PI));this.alpha+=2*w*Math.PI,this._checkLimits()}setPosition(q){this._position.equals(q)||(this._position.t(q),this.rebuildAnglesAndRadius())}setTarget(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(w=this.overrideCloneAlphaBetaRadius??w,q.Cc)I&&q.getBoundingInfo?this._targetBoundingCenter=q.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,q.Cc(),this._targetHost=q,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const I=q,w=this._getTargetPosition();if(w&&!l&&w.equals(I))return;this._targetHost=null,this._target=I,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}w||this.rebuildAnglesAndRadius()}_getViewMatrix(){const q=Math.cos(this.alpha),I=Math.sin(this.alpha),l=Math.cos(this.beta);let w=Math.sin(this.beta);0===w&&(w=1e-4),0===this.radius&&(this.radius=1e-4);const t=this._getTargetPosition();if(this._computationVector.gc(this.radius*q*w,this.radius*l,this.radius*I*w),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||c.dI.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),t.addToRef(this._computationVector,this._newPosition),this.Wq().collisionsEnabled&&this.checkCollisions){const q=this.Wq().collisionCoordinator;this._collider||(this._collider=q.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,q.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.t(this._newPosition);let q=this.upVector;this.allowUpsideDown&&w<0&&(q=q.negate()),this._computeViewMatrix(this._position,t,q),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.t(t),this._viewMatrix}zoomOn(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q=q||this.Wq().meshes;const l=s.c.MinMax(q);let w=this._calculateLowerRadiusFromModelBoundingSphere(l.min,l.max);if(w=Math.max(Math.min(w,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=w*this.zoomOnFactor,this.mode===B.d.ORTHOGRAPHIC_CAMERA){const q=this.Wq().getEngine().getAspectRatio(this),I=w*this.zoomOnFactor/2;this.orthoLeft=-I*q,this.orthoRight=I*q,this.orthoBottom=-I,this.orthoTop=I}this.focusOn({min:l.min,max:l.max,distance:w},I)}focusOn(q){let I,l,w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===q.min){const w=q||this.Wq().meshes;I=s.c.MinMax(w),l=c.dI.Distance(I.min,I.max)}else{I=q,l=q.distance}this._target=s.c.Center(I),w||(this.maxZ=2*l)}createRigCamera(q,I){let l=0;switch(this.cameraRigMode){case B.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.d.RIG_MODE_VR:l=this._cameraRigParams.stereoHalfAngle*(0===I?1:-1);break;case B.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:l=this._cameraRigParams.stereoHalfAngle*(0===I?-1:1)}const w=new M(q,this.alpha+l,this.beta,this.radius,this._target,this.Wq());return w._cameraRigParams={},w.isRigCamera=!0,w.rigParent=this,w.upVector=this.upVector,w.mode=this.mode,w.orthoLeft=this.orthoLeft,w.orthoRight=this.orthoRight,w.orthoBottom=this.orthoBottom,w.orthoTop=this.orthoTop,w}_updateRigCameras(){const q=this._rigCameras[0],I=this._rigCameras[1];switch(q.beta=I.beta=this.beta,this.cameraRigMode){case B.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.d.RIG_MODE_VR:q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case B.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const w=c.dI.Distance(q,I),t=this.Wq().getEngine().getAspectRatio(this),O=Math.tan(this.fov/2),a=O*t,F=.5*w*l,s=F*Math.sqrt(1+1/(a*a)),Z=F*Math.sqrt(1+1/(O*O));return Math.max(s,Z)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,w.d)([(0,t.D)()],M.prototype,"alpha",void 0),(0,w.d)([(0,t.D)()],M.prototype,"beta",void 0),(0,w.d)([(0,t.D)()],M.prototype,"radius",void 0),(0,w.d)([(0,t.D)()],M.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,w.d)([(0,t.C)("target")],M.prototype,"_target",void 0),(0,w.d)([(0,t.v)("targetHost")],M.prototype,"_targetHost",void 0),(0,w.d)([(0,t.D)()],M.prototype,"inertialAlphaOffset",void 0),(0,w.d)([(0,t.D)()],M.prototype,"inertialBetaOffset",void 0),(0,w.d)([(0,t.D)()],M.prototype,"inertialRadiusOffset",void 0),(0,w.d)([(0,t.D)()],M.prototype,"lowerAlphaLimit",void 0),(0,w.d)([(0,t.D)()],M.prototype,"upperAlphaLimit",void 0),(0,w.d)([(0,t.D)()],M.prototype,"lowerBetaLimit",void 0),(0,w.d)([(0,t.D)()],M.prototype,"upperBetaLimit",void 0),(0,w.d)([(0,t.D)()],M.prototype,"lowerRadiusLimit",void 0),(0,w.d)([(0,t.D)()],M.prototype,"upperRadiusLimit",void 0),(0,w.d)([(0,t.D)()],M.prototype,"lowerTargetYLimit",void 0),(0,w.d)([(0,t.D)()],M.prototype,"inertialPanningX",void 0),(0,w.d)([(0,t.D)()],M.prototype,"inertialPanningY",void 0),(0,w.d)([(0,t.D)()],M.prototype,"pinchToPanMaxDistance",void 0),(0,w.d)([(0,t.D)()],M.prototype,"panningDistanceLimit",void 0),(0,w.d)([(0,t.C)()],M.prototype,"panningOriginTarget",void 0),(0,w.d)([(0,t.D)()],M.prototype,"panningInertia",void 0),(0,w.d)([(0,t.D)()],M.prototype,"zoomToMouseLocation",null),(0,w.d)([(0,t.D)()],M.prototype,"zoomOnFactor",void 0),(0,w.d)([(0,t.B)()],M.prototype,"targetScreenOffset",void 0),(0,w.d)([(0,t.D)()],M.prototype,"allowUpsideDown",void 0),(0,w.d)([(0,t.D)()],M.prototype,"useInputToRestoreState",void 0),(0,w.d)([(0,t.D)()],M.prototype,"restoreStateInterpolationFactor",void 0),(0,K.e)("BABYLON.ArcRotateCamera",M)},14366:(q,I,l)=>{"use strict";l.d(I,{c:()=>c,d:()=>a});var w=l(12591),t=l(12777),O=l(13186),c={};class a{constructor(q){this.attachedToElement=!1,this.attached={},this.camera=q,this.checkInputs=()=>{}}add(q){const I=q.getSimpleName();this.attached[I]?w.b.Warn("camera input of type "+I+" already exists on camera"):(this.attached[I]=q,q.camera=this.camera,q.checkInputs&&(this.checkInputs=this._addCheckInputs(q.checkInputs.bind(q))),this.attachedToElement&&q.attachControl(this.noPreventDefault))}remove(q){for(const I in this.attached){const l=this.attached[I];if(l===q)return l.tx(),l.camera=null,delete this.attached[I],void this.rebuildInputCheck()}}removeByType(q){for(const I in this.attached){const l=this.attached[I];l.getClassName()===q&&(l.tx(),l.camera=null,delete this.attached[I],this.rebuildInputCheck())}}_addCheckInputs(q){const I=this.checkInputs;return()=>{I(),q()}}attachInput(q){this.attachedToElement&&q.attachControl(this.noPreventDefault)}attachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){q=!O.d.ForceAttachControlToAlwaysPreventDefault&&q,this.attachedToElement=!0,this.noPreventDefault=q;for(const I in this.attached)this.attached[I].attachControl(q)}}detachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const I in this.attached)this.attached[I].tx(),q&&(this.attached[I].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const q in this.attached){const I=this.attached[q];I.checkInputs&&(this.checkInputs=this._addCheckInputs(I.checkInputs.bind(I)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(q){const I={};for(const l in this.attached){const q=this.attached[l],w=t.c.Serialize(q);I[q.getClassName()]=w}q.inputsmgr=I}parse(q){const I=q.inputsmgr;if(I){this.clear();for(const q in I){const l=c[q];if(l){const w=I[q],O=t.c.Parse((()=>new l),w,null);this.add(O)}}}else for(const l in this.attached){const I=c[this.attached[l].getClassName()];if(I){const w=t.c.Parse((()=>new I),q,null);this.remove(this.attached[l]),this.add(w)}}}}},14361:(q,I,l)=>{"use strict";l.d(I,{b:()=>R});var w=l(12735),t=l(12740),O=l(12747),c=l(13211),a=l(14366),F=l(13027),s=l(12564);class Z{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(q){q=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Wq(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((I=>{const l=I.event;if(!l.metaKey)if(I.type===F.c.KEYDOWN){if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysUpward.indexOf(l.keyCode)||-1!==this.keysDownward.indexOf(l.keyCode)||-1!==this.keysRotateLeft.indexOf(l.keyCode)||-1!==this.keysRotateRight.indexOf(l.keyCode)||-1!==this.keysRotateUp.indexOf(l.keyCode)||-1!==this.keysRotateDown.indexOf(l.keyCode)){-1===this._keys.indexOf(l.keyCode)&&this._keys.push(l.keyCode),q||l.preventDefault()}}else if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysUpward.indexOf(l.keyCode)||-1!==this.keysDownward.indexOf(l.keyCode)||-1!==this.keysRotateLeft.indexOf(l.keyCode)||-1!==this.keysRotateRight.indexOf(l.keyCode)||-1!==this.keysRotateUp.indexOf(l.keyCode)||-1!==this.keysRotateDown.indexOf(l.keyCode)){const I=this._keys.indexOf(l.keyCode);I>=0&&this._keys.splice(I,1),q||l.preventDefault()}})))}tx(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let I=0;I<this._keys.length;I++){const l=this._keys[I],w=q._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(l)?q._localDirection.gc(-w,0,0):-1!==this.keysUp.indexOf(l)?q._localDirection.gc(0,0,w):-1!==this.keysRight.indexOf(l)?q._localDirection.gc(w,0,0):-1!==this.keysDown.indexOf(l)?q._localDirection.gc(0,0,-w):-1!==this.keysUpward.indexOf(l)?q._localDirection.gc(0,w,0):-1!==this.keysDownward.indexOf(l)?q._localDirection.gc(0,-w,0):-1!==this.keysRotateLeft.indexOf(l)?(q._localDirection.gc(0,0,0),q.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(l)?(q._localDirection.gc(0,0,0),q.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(l)?(q._localDirection.gc(0,0,0),q.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(l)&&(q._localDirection.gc(0,0,0),q.cameraRotation.x+=this._getLocalRotation()),q.Wq().useRightHandedSystem&&(q._localDirection.z*=-1),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),O.dI.TransformNormalToRef(q._localDirection,q._cameraTransformMatrix,q._transformedDirection),q.cameraDirection.addInPlace(q._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const q=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*q}}(0,w.d)([(0,t.D)()],Z.prototype,"keysUp",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"keysUpward",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"keysDown",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"keysDownward",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"keysLeft",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"keysRight",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"rotationSpeed",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"keysRotateLeft",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"keysRotateRight",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"keysRotateUp",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"keysRotateDown",void 0),a.c.FreeCameraKeyboardMoveInput=Z;var r=l(12573),x=l(13024);class o{constructor(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=q,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new r.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(q){q=s.Tools.BackCompatCameraNoPreventDefault(arguments);const I=this.camera.getEngine(),l=I.getInputElement();this._pointerInput||(this._pointerInput=w=>{const t=w.event,O="touch"===t.pointerType;if(!this.touchEnabled&&O)return;if(w.type!==x.c.POINTERMOVE&&-1===this.buttons.indexOf(t.button))return;const c=t.target;if(w.type===x.c.POINTERDOWN){if(O&&-1!==this._activePointerId||!O&&-1!==this._currentActiveButton)return;this._activePointerId=t.pointerId;try{null===c||void 0===c||c.setPointerCapture(t.pointerId)}catch(a){}-1===this._currentActiveButton&&(this._currentActiveButton=t.button),this._previousPosition={x:t.clientX,y:t.clientY},q||(t.preventDefault(),l&&l.focus()),I.isPointerLock&&this._onMouseMove&&this._onMouseMove(w.event)}else if(w.type===x.c.POINTERUP){if(O&&this._activePointerId!==t.pointerId||!O&&this._currentActiveButton!==t.button)return;try{null===c||void 0===c||c.releasePointerCapture(t.pointerId)}catch(a){}this._currentActiveButton=-1,this._previousPosition=null,q||t.preventDefault(),this._activePointerId=-1}else if(w.type===x.c.POINTERMOVE&&(this._activePointerId===t.pointerId||!O))if(I.isPointerLock&&this._onMouseMove)this._onMouseMove(w.event);else if(this._previousPosition){const I=this.camera._calculateHandednessMultiplier(),l=(t.clientX-this._previousPosition.x)*I,w=t.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=l/this.angularSensibility,this.camera.cameraRotation.x+=w/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:l,offsetY:w}),this._previousPosition={x:t.clientX,y:t.clientY},q||t.preventDefault()}}),this._onMouseMove=l=>{if(!I.isPointerLock)return;const w=this.camera._calculateHandednessMultiplier(),t=l.movementX*w;this.camera.cameraRotation.y+=t/this.angularSensibility;const O=l.movementY;this.camera.cameraRotation.x+=O/this.angularSensibility,this._previousPosition=null,q||l.preventDefault()},this._observer=this.camera.Wq()._inputManager._addCameraPointerObserver(this._pointerInput,x.c.POINTERDOWN|x.c.POINTERUP|x.c.POINTERMOVE),l&&(this._contextMenuBind=q=>this.onContextMenu(q),l.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(q){q.preventDefault()}tx(){if(this._observer){if(this.camera.Wq()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,w.d)([(0,t.D)()],o.prototype,"buttons",void 0),(0,w.d)([(0,t.D)()],o.prototype,"angularSensibility",void 0),a.c.FreeCameraMouseInput=o;var d,T=l(13036);class V{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new r.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(q){q=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=I=>{if(I.type!==x.c.POINTERWHEEL)return;const l=I.event,w=l.deltaMode===T.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*w*l.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*w*l.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*w*l.deltaZ/this._normalize,l.preventDefault&&(q||l.preventDefault())},this._observer=this.camera.Wq()._inputManager._addCameraPointerObserver(this._wheel,x.c.POINTERWHEEL)}tx(){this._observer&&(this.camera.Wq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,w.d)([(0,t.D)()],V.prototype,"wheelPrecisionX",void 0),(0,w.d)([(0,t.D)()],V.prototype,"wheelPrecisionY",void 0),(0,w.d)([(0,t.D)()],V.prototype,"wheelPrecisionZ",void 0),function(q){q[q.MoveRelative=0]="MoveRelative",q[q.RotateRelative=1]="RotateRelative",q[q.MoveScene=2]="MoveScene"}(d||(d={}));class U extends V{constructor(){super(...arguments),this._moveRelative=O.dI.Zero(),this._rotateRelative=O.dI.Zero(),this._moveScene=O.dI.Zero(),this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(q){null===q&&this._wheelXAction!==d.MoveRelative||(this._wheelXAction=d.MoveRelative,this._wheelXActionCoordinate=q)}get wheelXMoveRelative(){return this._wheelXAction!==d.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(q){null===q&&this._wheelYAction!==d.MoveRelative||(this._wheelYAction=d.MoveRelative,this._wheelYActionCoordinate=q)}get wheelYMoveRelative(){return this._wheelYAction!==d.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(q){null===q&&this._wheelZAction!==d.MoveRelative||(this._wheelZAction=d.MoveRelative,this._wheelZActionCoordinate=q)}get wheelZMoveRelative(){return this._wheelZAction!==d.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(q){null===q&&this._wheelXAction!==d.RotateRelative||(this._wheelXAction=d.RotateRelative,this._wheelXActionCoordinate=q)}get wheelXRotateRelative(){return this._wheelXAction!==d.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(q){null===q&&this._wheelYAction!==d.RotateRelative||(this._wheelYAction=d.RotateRelative,this._wheelYActionCoordinate=q)}get wheelYRotateRelative(){return this._wheelYAction!==d.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(q){null===q&&this._wheelZAction!==d.RotateRelative||(this._wheelZAction=d.RotateRelative,this._wheelZActionCoordinate=q)}get wheelZRotateRelative(){return this._wheelZAction!==d.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(q){null===q&&this._wheelXAction!==d.MoveScene||(this._wheelXAction=d.MoveScene,this._wheelXActionCoordinate=q)}get wheelXMoveScene(){return this._wheelXAction!==d.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(q){null===q&&this._wheelYAction!==d.MoveScene||(this._wheelYAction=d.MoveScene,this._wheelYActionCoordinate=q)}get wheelYMoveScene(){return this._wheelYAction!==d.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(q){null===q&&this._wheelZAction!==d.MoveScene||(this._wheelZAction=d.MoveScene,this._wheelZActionCoordinate=q)}get wheelZMoveScene(){return this._wheelZAction!==d.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Kc(0),this._rotateRelative.Kc(0),this._moveScene.Kc(0),this._updateCamera(),this.camera.Wq().useRightHandedSystem&&(this._moveRelative.z*=-1);const q=O.Matrix.Zero();this.camera.getViewMatrix().invertToRef(q);const I=O.dI.Zero();O.dI.TransformNormalToRef(this._moveRelative,q,I),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(I),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(q,I,l){if(0===q)return;if(null===I||null===l)return;let w=null;switch(I){case d.MoveRelative:w=this._moveRelative;break;case d.RotateRelative:w=this._rotateRelative;break;case d.MoveScene:w=this._moveScene}switch(l){case 0:w.set(q,0,0);break;case 1:w.set(0,q,0);break;case 2:w.set(0,0,q)}}}(0,w.d)([(0,t.D)()],U.prototype,"wheelXMoveRelative",null),(0,w.d)([(0,t.D)()],U.prototype,"wheelYMoveRelative",null),(0,w.d)([(0,t.D)()],U.prototype,"wheelZMoveRelative",null),(0,w.d)([(0,t.D)()],U.prototype,"wheelXRotateRelative",null),(0,w.d)([(0,t.D)()],U.prototype,"wheelYRotateRelative",null),(0,w.d)([(0,t.D)()],U.prototype,"wheelZRotateRelative",null),(0,w.d)([(0,t.D)()],U.prototype,"wheelXMoveScene",null),(0,w.d)([(0,t.D)()],U.prototype,"wheelYMoveScene",null),(0,w.d)([(0,t.D)()],U.prototype,"wheelZMoveScene",null),a.c.FreeCameraMouseWheelInput=U;class B{constructor(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=q,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=s.Tools.IsSafari()}attachControl(q){q=s.Tools.BackCompatCameraNoPreventDefault(arguments);let I=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=l=>{const w=l.event,t="mouse"===w.pointerType||this._isSafari&&"undefined"===typeof w.pointerType;if(this.allowMouse||!t)if(l.type===x.c.POINTERDOWN){if(q||w.preventDefault(),this._pointerPressed.push(w.pointerId),1!==this._pointerPressed.length)return;I={x:w.clientX,y:w.clientY}}else if(l.type===x.c.POINTERUP){q||w.preventDefault();const l=this._pointerPressed.indexOf(w.pointerId);if(-1===l)return;if(this._pointerPressed.splice(l,1),0!=l)return;I=null,this._offsetX=null,this._offsetY=null}else if(l.type===x.c.POINTERMOVE){if(q||w.preventDefault(),!I)return;if(0!=this._pointerPressed.indexOf(w.pointerId))return;this._offsetX=w.clientX-I.x,this._offsetY=-(w.clientY-I.y)}}),this._observer=this.camera.Wq()._inputManager._addCameraPointerObserver(this._pointerInput,x.c.POINTERDOWN|x.c.POINTERUP|x.c.POINTERMOVE),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.addEventListener("blur",this._onLostFocus)}}tx(){if(this._pointerInput){if(this._observer&&(this.camera.Wq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const q=this.camera,I=q._calculateHandednessMultiplier();q.cameraRotation.y=I*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)q.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const I=q._computeLocalCameraSpeed(),l=new O.dI(0,0,0!==this.touchMoveSensibility?I*this._offsetY/this.touchMoveSensibility:0);O.Matrix.RotationYawPitchRollToRef(q.rotation.y,q.rotation.x,0,q._cameraRotationMatrix),q.cameraDirection.addInPlace(O.dI.TransformCoordinates(l,q._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,w.d)([(0,t.D)()],B.prototype,"touchAngularSensibility",void 0),(0,w.d)([(0,t.D)()],B.prototype,"touchMoveSensibility",void 0),a.c.FreeCameraTouchInput=B;class v extends a.d{constructor(q){super(q),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new Z),this}addMouse(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new o(q),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new U,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new B),this}clear(){super.clear(),this._mouseInput=null}}var k=l(12711),C=l(12656);class R extends c.c{get angularSensibility(){const q=this.inputs.attached.mouse;return q?q.angularSensibility:0}set angularSensibility(q){const I=this.inputs.attached.mouse;I&&(I.angularSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const I=this.inputs.attached.keyboard;I&&(I.keysUp=q)}get keysUpward(){const q=this.inputs.attached.keyboard;return q?q.keysUpward:[]}set keysUpward(q){const I=this.inputs.attached.keyboard;I&&(I.keysUpward=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const I=this.inputs.attached.keyboard;I&&(I.keysDown=q)}get keysDownward(){const q=this.inputs.attached.keyboard;return q?q.keysDownward:[]}set keysDownward(q){const I=this.inputs.attached.keyboard;I&&(I.keysDownward=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const I=this.inputs.attached.keyboard;I&&(I.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const I=this.inputs.attached.keyboard;I&&(I.keysRight=q)}get keysRotateLeft(){const q=this.inputs.attached.keyboard;return q?q.keysRotateLeft:[]}set keysRotateLeft(q){const I=this.inputs.attached.keyboard;I&&(I.keysRotateLeft=q)}get keysRotateRight(){const q=this.inputs.attached.keyboard;return q?q.keysRotateRight:[]}set keysRotateRight(q){const I=this.inputs.attached.keyboard;I&&(I.keysRotateRight=q)}get keysRotateUp(){const q=this.inputs.attached.keyboard;return q?q.keysRotateUp:[]}set keysRotateUp(q){const I=this.inputs.attached.keyboard;I&&(I.keysRotateUp=q)}get keysRotateDown(){const q=this.inputs.attached.keyboard;return q?q.keysRotateDown:[]}set keysRotateDown(q){const I=this.inputs.attached.keyboard;I&&(I.keysRotateDown=q)}constructor(q,I,l){var w;super(q,I,l,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),w=this,this.ellipsoid=new O.dI(.5,1,.5),this.ellipsoidOffset=new O.dI(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=O.dI.Zero(),this._diffPosition=O.dI.Zero(),this._newPosition=O.dI.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w._newPosition.t(I),w._newPosition.subtractToRef(w._oldPosition,w._diffPosition),w._diffPosition.length()>C.d.CollisionsEpsilon&&(w.position.addToRef(w._diffPosition,w._deferredPositionUpdate),w._deferOnly?w._deferredUpdated=!0:w.position.t(w._deferredPositionUpdate),w.Qo&&l&&w.Qo(l))},this.inputs=new v(this),this.inputs.addKeyboard().addMouse()}attachControl(q,I){I=s.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(I)}tx(){this.inputs.detachElement(),this.cameraDirection=new O.dI(0,0,0),this.cameraRotation=new O.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(q){this._collisionMask=isNaN(q)?-1:q}_collideWithWorld(q){let I;I=this.parent?O.dI.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,I.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const l=this.Wq().collisionCoordinator;this._collider||(this._collider=l.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let w=q;this.applyGravity&&(w=q.add(this.Wq().gravity)),l.getNewPosition(this._oldPosition,w,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=O.dI.Zero(),this._transformedDirection=O.dI.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(q){this._needMoveForGravity=q}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Wq().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Yc"}}(0,w.d)([(0,t.C)()],R.prototype,"ellipsoid",void 0),(0,w.d)([(0,t.C)()],R.prototype,"ellipsoidOffset",void 0),(0,w.d)([(0,t.D)()],R.prototype,"checkCollisions",void 0),(0,w.d)([(0,t.D)()],R.prototype,"applyGravity",void 0),(0,k.e)("BABYLON.FreeCamera",R)},14964:(q,I,l)=>{"use strict";l.d(I,{b:()=>O});var w=l(12839),t=l(14971);class O{constructor(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=l,this.Rr=[],this._maxBlockCapacity=I||64,this._selectionContent=new w.d(1024),this._creationFunc=q}update(q,I,l){t.e._CreateBlocks(q,I,l,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}gZ(q){for(let I=0;I<this.uZ.length;I++){this.uZ[I].addEntry(q)}}SZ(q){for(let I=0;I<this.uZ.length;I++){this.uZ[I].removeEntry(q)}}select(q,I){this._selectionContent.reset();for(let l=0;l<this.uZ.length;l++){this.uZ[l].select(q,this._selectionContent,I)}return I?this._selectionContent.concat(this.Rr):this._selectionContent.concatWithNoDuplicate(this.Rr),this._selectionContent}intersects(q,I,l){this._selectionContent.reset();for(let w=0;w<this.uZ.length;w++){this.uZ[w].intersects(q,I,this._selectionContent,l)}return l?this._selectionContent.concat(this.Rr):this._selectionContent.concatWithNoDuplicate(this.Rr),this._selectionContent}intersectsRay(q){this._selectionContent.reset();for(let I=0;I<this.uZ.length;I++){this.uZ[I].intersectsRay(q,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Rr),this._selectionContent}}O.CreationFuncForMeshes=(q,I)=>{const l=q.getBoundingInfo();!q.isBlocked&&l.boundingBox.intersectsMinMax(I.gr,I.pr)&&I.entries.push(q)},O.CreationFuncForSubMeshes=(q,I)=>{q.getBoundingInfo().boundingBox.intersectsMinMax(I.gr,I.pr)&&I.entries.push(q)}},14971:(q,I,l)=>{"use strict";l.d(I,{e:()=>O});var w=l(12747),t=l(13098);class O{constructor(q,I,l,w,t,O){this.entries=[],this.Xr=new Array,this._capacity=l,this._depth=w,this._maxDepth=t,this._creationFunc=O,this._minPoint=q,this._maxPoint=I,this.Xr.push(q.clone()),this.Xr.push(I.clone()),this.Xr.push(q.clone()),this.Xr[2].x=I.x,this.Xr.push(q.clone()),this.Xr[3].y=I.y,this.Xr.push(q.clone()),this.Xr[4].z=I.z,this.Xr.push(I.clone()),this.Xr[5].z=q.z,this.Xr.push(I.clone()),this.Xr[6].x=q.x,this.Xr.push(I.clone()),this.Xr[7].y=q.y}get Zl(){return this._capacity}get gr(){return this._minPoint}get pr(){return this._maxPoint}addEntry(q){if(this.uZ)for(let I=0;I<this.uZ.length;I++){this.uZ[I].addEntry(q)}else this._creationFunc(q,this),this.entries.length>this.Zl&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(q){if(this.uZ){for(let I=0;I<this.uZ.length;I++){this.uZ[I].removeEntry(q)}return}const I=this.entries.indexOf(q);I>-1&&this.entries.splice(I,1)}addEntries(q){for(let I=0;I<q.length;I++){const l=q[I];this.addEntry(l)}}select(q,I,l){if(t.e.IsInFrustum(this.Xr,q)){if(this.uZ){for(let w=0;w<this.uZ.length;w++){this.uZ[w].select(q,I,l)}return}l?I.concat(this.entries):I.concatWithNoDuplicate(this.entries)}}intersects(q,I,l,w){if(t.e.IntersectsSphere(this._minPoint,this._maxPoint,q,I)){if(this.uZ){for(let t=0;t<this.uZ.length;t++){this.uZ[t].intersects(q,I,l,w)}return}w?l.concat(this.entries):l.concatWithNoDuplicate(this.entries)}}intersectsRay(q,I){if(q.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.uZ){for(let l=0;l<this.uZ.length;l++){this.uZ[l].intersectsRay(q,I)}return}I.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){O._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(q,I,l,t,c,a,F,s){F.uZ=new Array;const Z=new w.dI((I.x-q.x)/2,(I.y-q.y)/2,(I.z-q.z)/2);for(let w=0;w<2;w++)for(let I=0;I<2;I++)for(let r=0;r<2;r++){const x=q.add(Z.multiplyByFloats(w,I,r)),o=q.add(Z.multiplyByFloats(w+1,I+1,r+1)),d=new O(x,o,t,c+1,a,s);d.addEntries(l),F.uZ.push(d)}}}},14980:(q,I,l)=>{"use strict";l.d(I,{c:()=>Z});var w=l(12987),t=l(12747),O=l(13173),c=l(14123),a=l(13021),F=l(14964),s=l(12612);w.e.prototype.createOrUpdateSelectionOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,l=this._getComponent(a.c.NAME_OCTREE);l||(l=new Z(this),this.o(l)),this.kr||(this.kr=new F.b(F.b.CreationFuncForMeshes,q,I));const w=this.getWorldExtends();return this.kr.update(w.min,w.max,this.meshes),this.kr},Object.defineProperty(w.e.prototype,"selectionOctree",{get:function(){return this.kr},enumerable:!0,configurable:!0}),O.b.prototype.createOrUpdateSubmeshesOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const l=this.Wq();let w=l._getComponent(a.c.NAME_OCTREE);w||(w=new Z(l),l.o(w)),this._submeshesOctree||(this._submeshesOctree=new F.b(F.b.CreationFuncForSubMeshes,q,I)),this.Cc(!0);const t=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(t.minimumWorld,t.maximumWorld,this.Tc),this._submeshesOctree};class Z{constructor(q){this.name=a.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new c.e(t.dI.Zero(),new t.dI(1,1,1)),(q=q||s.e.LastCreatedScene)&&(this.VI=q,this.VI.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.VI.getActiveSubMeshCandidates=q=>this.getActiveSubMeshCandidates(q),this.VI.getCollidingSubMeshCandidates=(q,I)=>this.getCollidingSubMeshCandidates(q,I),this.VI.getIntersectingSubMeshCandidates=(q,I)=>this.getIntersectingSubMeshCandidates(q,I))}register(){this.VI.onMeshRemovedObservable.add((q=>{const I=this.VI.selectionOctree;if(void 0!==I&&null!==I){const l=I.Rr.indexOf(q);-1!==l&&I.Rr.splice(l,1)}})),this.VI.onMeshImportedObservable.add((q=>{const I=this.VI.selectionOctree;void 0!==I&&null!==I&&I.gZ(q)}))}getActiveMeshCandidates(){var q;return(null===(q=this.VI.kr)||void 0===q?void 0:q.select(this.VI.frustumPlanes))||this.VI._getDefaultMeshCandidates()}getActiveSubMeshCandidates(q){if(q._submeshesOctree&&q.useOctreeForRenderingSelection){return q._submeshesOctree.select(this.VI.frustumPlanes)}return this.VI._getDefaultSubMeshCandidates(q)}getIntersectingSubMeshCandidates(q,I){if(q._submeshesOctree&&q.useOctreeForPicking){c.e.TransformToRef(I,q.getWorldMatrix(),this._tempRay);return q._submeshesOctree.intersectsRay(this._tempRay)}return this.VI._getDefaultSubMeshCandidates(q)}getCollidingSubMeshCandidates(q,I){if(q._submeshesOctree&&q.useOctreeForCollisions){const l=I._velocityWorldLength+Math.max(I._radius.x,I._radius.y,I._radius.z);return q._submeshesOctree.intersects(I._basePointWorld,l)}return this.VI._getDefaultSubMeshCandidates(q)}rebuild(){}dispose(){}}},14123:(q,I,l)=>{"use strict";l.d(I,{e:()=>o});var w=l(12987),t=l(13186),O=l(12752),c=l(12747),a=l(12757),F=l(13089),s=l(13017),Z=l(12612),r=l(13040);const x={internalPickerForMesh:void 0};class o{constructor(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.d;this.origin=q,this.direction=I,this.length=l,this.epsilon=w}clone(){return new o(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const w=o._TmpVector3[0].gc(q.x-l,q.y-l,q.z-l),t=o._TmpVector3[1].gc(I.x+l,I.y+l,I.z+l);let O,c,a,F,s=0,Z=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<w.x||this.origin.x>t.x)return!1}else if(O=1/this.direction.x,c=(w.x-this.origin.x)*O,a=(t.x-this.origin.x)*O,a===-1/0&&(a=1/0),c>a&&(F=c,c=a,a=F),s=Math.max(c,s),Z=Math.min(a,Z),s>Z)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<w.y||this.origin.y>t.y)return!1}else if(O=1/this.direction.y,c=(w.y-this.origin.y)*O,a=(t.y-this.origin.y)*O,a===-1/0&&(a=1/0),c>a&&(F=c,c=a,a=F),s=Math.max(c,s),Z=Math.min(a,Z),s>Z)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<w.z||this.origin.z>t.z)return!1}else if(O=1/this.direction.z,c=(w.z-this.origin.z)*O,a=(t.z-this.origin.z)*O,a===-1/0&&(a=1/0),c>a&&(F=c,c=a,a=F),s=Math.max(c,s),Z=Math.min(a,Z),s>Z)return!1;return!0}intersectsBox(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(q.minimum,q.maximum,I)}intersectsSphere(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=q.center.x-this.origin.x,w=q.center.y-this.origin.y,t=q.center.z-this.origin.z,O=l*l+w*w+t*t,c=q.radius+I,a=c*c;if(O<=a)return!0;const F=l*this.direction.x+w*this.direction.y+t*this.direction.z;if(F<0)return!1;return O-F*F<=a}intersectsTriangle(q,I,l){const w=o._TmpVector3[0],t=o._TmpVector3[1],O=o._TmpVector3[2],a=o._TmpVector3[3],s=o._TmpVector3[4];I.subtractToRef(q,w),l.subtractToRef(q,t),c.dI.CrossToRef(this.direction,t,O);const Z=c.dI.Dot(w,O);if(0===Z)return null;const r=1/Z;this.origin.subtractToRef(q,a);const x=c.dI.Dot(a,O)*r;if(x<-this.epsilon||x>1+this.epsilon)return null;c.dI.CrossToRef(a,w,s);const d=c.dI.Dot(this.direction,s)*r;if(d<-this.epsilon||x+d>1+this.epsilon)return null;const T=c.dI.Dot(t,s)*r;return T>this.length?null:new F.b(1-x-d,x,T)}intersectsPlane(q){let I;const l=c.dI.Dot(q.normal,this.direction);if(Math.abs(l)<9.99999997475243e-7)return null;{const w=c.dI.Dot(q.normal,this.origin);return I=(-q.d-w)/l,I<0?I<-9.99999997475243e-7?null:0:I}}intersectsAxis(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(q){case"y":{const q=(this.origin.y-I)/this.direction.y;return q>0?null:new c.dI(this.origin.x+this.direction.x*-q,I,this.origin.z+this.direction.z*-q)}case"x":{const q=(this.origin.x-I)/this.direction.x;return q>0?null:new c.dI(I,this.origin.y+this.direction.y*-q,this.origin.z+this.direction.z*-q)}case"z":{const q=(this.origin.z-I)/this.direction.z;return q>0?null:new c.dI(this.origin.x+this.direction.x*-q,this.origin.y+this.direction.y*-q,I)}default:return null}}intersectsMesh(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=c.TmpVectors.Matrix[0];return q.getWorldMatrix().invertToRef(a),this._tmpRay?o.TransformToRef(this,a,this._tmpRay):this._tmpRay=o.Transform(this,a),q.intersects(this._tmpRay,I,l,w,t,O)}intersectsMeshes(q,I,l){l?l.length=0:l=[];for(let w=0;w<q.length;w++){const t=this.intersectsMesh(q[w],I);t.hit&&l.push(t)}return l.sort(this._comparePickingInfo),l}_comparePickingInfo(q,I){return q.distance<I.distance?-1:q.distance>I.distance?1:0}intersectionSegment(q,I,l){const w=this.origin,t=c.TmpVectors.dI[0],O=c.TmpVectors.dI[1],a=c.TmpVectors.dI[2],F=c.TmpVectors.dI[3];I.subtractToRef(q,t),this.direction.scaleToRef(o._Rayl,a),w.addToRef(a,O),q.subtractToRef(w,F);const s=c.dI.Dot(t,t),Z=c.dI.Dot(t,a),r=c.dI.Dot(a,a),x=c.dI.Dot(t,F),d=c.dI.Dot(a,F),T=s*r-Z*Z;let V,U,B=T,v=T;T<o._Smallnum?(V=0,B=1,U=d,v=r):(V=Z*d-r*x,U=s*d-Z*x,V<0?(V=0,U=d,v=r):V>B&&(V=B,U=d+Z,v=r)),U<0?(U=0,-x<0?V=0:-x>s?V=B:(V=-x,B=s)):U>v&&(U=v,-x+Z<0?V=0:-x+Z>s?V=B:(V=-x+Z,B=s));const k=Math.abs(V)<o._Smallnum?0:V/B,C=Math.abs(U)<o._Smallnum?0:U/v,R=c.TmpVectors.dI[4];a.scaleToRef(C,R);const W=c.TmpVectors.dI[5];t.scaleToRef(k,W),W.addInPlace(F);const e=c.TmpVectors.dI[6];W.subtractToRef(R,e);return C>0&&C<=this.length&&e.lengthSquared()<l*l?W.length():-1}update(q,I,l,w,t,O,a){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){o._RayDistant||(o._RayDistant=o.Zero()),o._RayDistant.unprojectRayToRef(q,I,l,w,c.Matrix.IdentityReadOnly,O,a);const F=c.TmpVectors.Matrix[0];t.invertToRef(F),o.TransformToRef(o._RayDistant,F,this)}else this.unprojectRayToRef(q,I,l,w,t,O,a);return this}static Zero(){return new o(c.dI.Zero(),c.dI.Zero())}static CreateNew(q,I,l,w,t,O,c){return o.Zero().update(q,I,l,w,t,O,c)}static CreateNewFromTo(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.Matrix.IdentityReadOnly;const w=new o(new c.dI(0,0,0),new c.dI(0,0,0));return o.CreateFromToToRef(q,I,w,l)}static CreateFromToToRef(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c.Matrix.IdentityReadOnly;l.origin.t(q);const t=I.subtractToRef(q,l.direction),O=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return l.length=O,l.direction.normalize(),o.TransformToRef(l,w,l)}static Transform(q,I){const l=new o(new c.dI(0,0,0),new c.dI(0,0,0));return o.TransformToRef(q,I,l),l}static TransformToRef(q,I,l){c.dI.TransformCoordinatesToRef(q.origin,I,l.origin),c.dI.TransformNormalToRef(q.direction,I,l.direction),l.length=q.length,l.epsilon=q.epsilon;const w=l.direction,t=w.length();if(0!==t&&1!==t){const q=1/t;w.x*=q,w.y*=q,w.z*=q,l.length*=t}return l}unprojectRayToRef(q,I,l,w,t,O,a){const F=c.TmpVectors.Matrix[0];t.multiplyToRef(O,F),F.multiplyToRef(a,F),F.invert();const s=Z.e.LastCreatedEngine,r=c.TmpVectors.dI[0];r.x=q/l*2-1,r.y=-(I/w*2-1),r.z=null!==s&&void 0!==s&&s.Ic?1:null!==s&&void 0!==s&&s.isNDCHalfZRange?0:-1;const x=c.TmpVectors.dI[1].gc(r.x,r.y,1-1e-8),o=c.TmpVectors.dI[2],d=c.TmpVectors.dI[3];c.dI._UnprojectFromInvertedMatrixToRef(r,F,o),c.dI._UnprojectFromInvertedMatrixToRef(x,F,d),this.origin.t(o),d.subtractToRef(o,this.direction),this.direction.normalize()}}function d(q,I,l,w,t){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const c=o.Zero();return T(q,I,l,w,c,t,O),c}function T(q,I,l,w,t,O){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const s=q.getEngine();if(!O&&!(O=q.activeCamera))return q;const Z=O.viewport,r=s.getRenderHeight(),{x:x,y:o,width:d,height:T}=Z.toGlobal(s.getRenderWidth(),r),V=1/s.getHardwareScalingLevel();return I=I*V-x,l=l*V-(r-o-T),t.update(I,l,d,T,w||c.Matrix.IdentityReadOnly,a?c.Matrix.IdentityReadOnly:O.getViewMatrix(),O.getProjectionMatrix(),F),q}function V(q,I,l,w,t){if(!s.b)return q;const O=q.getEngine();if(!t&&!(t=q.activeCamera))throw new Error("Active camera not set");const a=t.viewport,F=O.getRenderHeight(),{x:Z,y:r,width:x,height:o}=a.toGlobal(O.getRenderWidth(),F),d=c.Matrix.Identity(),T=1/O.getHardwareScalingLevel();return I=I*T-Z,l=l*T-(F-r-o),w.update(I,l,x,o,d,d,t.getProjectionMatrix()),q}function U(q,I,l,w,t,O,c,a){const F=I(w,l.enableDistantPicking),s=l.intersects(F,t,c,O,w,a);return s&&s.hit?!t&&null!=q&&s.distance>=q.distance?null:s:null}function B(q,I,l,w,t,O){let a=null;const F=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),Z=q.cameraToUseForPointers||q.activeCamera,r=x.internalPickerForMesh||U;for(let s=0;s<q.meshes.length;s++){const x=q.meshes[s];if(l){if(!l(x,-1))continue}else if(!x.isEnabled()||!x.isVisible||!x.ss)continue;const o=F&&x.isWorldMatrixCameraDependent(),d=x.Cc(o,Z);if(x.hasThinInstances&&x.ys){const q=r(a,I,x,d,!0,!0,O);if(q){if(t)return q;const F=c.TmpVectors.Matrix[1],s=x.thinInstanceGetWorldMatrices();for(let q=0;q<s.length;q++){if(l&&!l(x,q))continue;s[q].multiplyToRef(d,F);const c=r(a,I,x,F,w,t,O,!0);if(c&&(a=c,a.thinInstanceIndex=q,w))return a}}}else{const q=r(a,I,x,d,w,t,O);if(q&&(a=q,w))return a}}return a||new s.b}function v(q,I,l,w){if(!s.b)return null;const t=[],O=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),a=q.cameraToUseForPointers||q.activeCamera,F=x.internalPickerForMesh||U;for(let s=0;s<q.meshes.length;s++){const Z=q.meshes[s];if(l){if(!l(Z,-1))continue}else if(!Z.isEnabled()||!Z.isVisible||!Z.ss)continue;const r=O&&Z.isWorldMatrixCameraDependent(),x=Z.Cc(r,a);if(Z.hasThinInstances&&Z.ys){if(F(null,I,Z,x,!0,!0,w)){const q=c.TmpVectors.Matrix[1],O=Z.thinInstanceGetWorldMatrices();for(let c=0;c<O.length;c++){if(l&&!l(Z,c))continue;O[c].multiplyToRef(x,q);const a=F(null,I,Z,q,!1,!1,w,!0);a&&(a.thinInstanceIndex=c,t.push(a))}}}else{const q=F(null,I,Z,x,!1,!1,w);q&&t.push(q)}}return t}function k(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,w=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;w||(w=q.getWorldMatrix()),I.length=l,t?I.origin.t(t):I.origin.t(q.position);const O=c.TmpVectors.dI[2];O.set(0,0,q._scene.useRightHandedSystem?-1:1);const a=c.TmpVectors.dI[3];return c.dI.TransformNormalToRef(O,w,a),c.dI.NormalizeToRef(a,I.direction),I}var C,R;o._TmpVector3=(0,a.d)(6,c.dI.Zero),o._RayDistant=o.Zero(),o._Smallnum=1e-8,o._Rayl=1e9,C=w.e,(R=t.d)&&(R.prototype.getForwardRay=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,I=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return k(this,new o(c.dI.Zero(),c.dI.Zero(),q),q,I,l)},R.prototype.getForwardRayToRef=function(q){return k(this,q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),C&&(r.c._IsPickingAvailable=!0,C.prototype.createPickingRay=function(q,I,l,w){return d(this,q,I,l,w,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),w.e.prototype.createPickingRayToRef=function(q,I,l,w,t){return T(this,q,I,l,w,t,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},w.e.prototype.createPickingRayInCameraSpace=function(q,I,l){return function(q,I,l,w){const t=o.Zero();return V(q,I,l,t,w),t}(this,q,I,l)},w.e.prototype.createPickingRayInCameraSpaceToRef=function(q,I,l,w){return V(this,q,I,l,w)},w.e.prototype.pickWithBoundingInfo=function(q,I,l,w,t){return function(q,I,l,w,t,O){if(!s.b)return null;const a=B(q,(w=>(q._tempPickingRay||(q._tempPickingRay=o.Zero()),T(q,I,l,w,q._tempPickingRay,O||null),q._tempPickingRay)),w,t,!0);return a&&(a.ray=d(q,I,l,c.Matrix.Identity(),O||null)),a}(this,q,I,l,w,t)},w.e.prototype.ol=function(q,I,l,w,t,O){return function(q,I,l,w,t,O,a){const F=B(q,((w,t)=>(q._tempPickingRay||(q._tempPickingRay=o.Zero()),T(q,I,l,w,q._tempPickingRay,O||null,!1,t),q._tempPickingRay)),w,t,!1,a);return F&&(F.ray=d(q,I,l,c.Matrix.Identity(),O||null)),F}(this,q,I,l,w,t,O)},w.e.prototype.pickWithRay=function(q,I,l,w){return function(q,I,l,w,t){const O=B(q,(l=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=c.Matrix.Identity()),l.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=o.Zero()),o.TransformToRef(I,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),l,w,!1,t);return O&&(O.ray=I),O}(this,q,I,l,w)},w.e.prototype.multiPick=function(q,I,l,w,t){return function(q,I,l,w,t,O){return v(q,(w=>d(q,I,l,w,t||null)),w,O)}(this,q,I,l,w,t)},w.e.prototype.multiPickWithRay=function(q,I,l){return function(q,I,l,w){return v(q,(l=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=c.Matrix.Identity()),l.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=o.Zero()),o.TransformToRef(I,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),l,w)}(this,q,I,l)}},14412:(q,I,l)=>{"use strict";var w=l(12687),t=l(12591),O=l(12615),c=l(12718),a=l(12656),F=l(12700);a.d.prototype._partialLoadFile=function(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(q,(q=>{l[I]=q,l._internalCount++,6===l._internalCount&&w(l)}),void 0,void 0,!0,((q,I)=>{t&&q&&t(q.status+" "+q.statusText,I)}))},a.d.prototype._cascadeLoadFiles=function(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=[];t._internalCount=0;for(let O=0;O<6;O++)this._partialLoadFile(l[O],O,t,I,w)},a.d.prototype._cascadeLoadImgs=function(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5?arguments[5]:void 0;const c=[];c._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(w[a],a,c,q,I,l,t,O)},a.d.prototype._partialLoadImg=function(q,I,l,w,t,a){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7?arguments[7]:void 0;const Z=(0,c.d)();(0,O.r)(q,(q=>{l[I]=q,l._internalCount++,w&&w.removePendingData(Z),6===l._internalCount&&a&&a(t,l)}),((q,I)=>{w&&w.removePendingData(Z),F&&F(q,I)}),w?w.offlineProvider:null,s),w&&w.addPendingData(Z)},a.d.prototype.createCubeTextureBase=function(q,I,l,O){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,T=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,V=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,U=arguments.length>14&&void 0!==arguments[14]&&arguments[14],B=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const v=d||new w.b(this,7);v.isCube=!0,v.url=q,v.generateMipMaps=!O,v._lodGenerationScale=x,v._lodGenerationOffset=o,v._useSRGBBuffer=!!U&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!O),v!==d&&(v.label=q.substring(0,60)),this._doNotHandleContextLost||(v._extension=Z,v._files=l,v._buffer=B);const k=q;this._transformTextureUrl&&!d&&(q=this._transformTextureUrl(q));const C=Z??function(q){const I=q.split("?")[0],l=I.lastIndexOf(".");return l>-1?I.substring(l).toLowerCase():""}(q),R=(0,F.b)(C),W=(q,I)=>{v.dispose(),a?a(q,I):q&&t.b.Warn(q)},e=(w,a)=>{q===k?w&&W(w.status+" "+w.statusText,a):(t.b.Warn(`Failed to load ${q}, falling back to the ${k}`),this.createCubeTextureBase(k,I,l,!!O,c,W,s,Z,r,x,o,v,T,V,U,B))};if(R)R.then((w=>{const t=q=>{T&&T(v,q),w.loadCubeData(q,v,r,c,((q,I)=>{W(q,I)}))};B?t(B):l&&6===l.length?w.supportCascades?this._cascadeLoadFiles(I,(q=>t(q.map((q=>new Uint8Array(q))))),l,W):W("Textures type does not support cascades."):this._loadFile(q,(q=>t(new Uint8Array(q))),void 0,void 0,!0,e)}));else{if(!l||0===l.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(I,v,((q,I)=>{V&&V(q,I)}),l,W)}return this._internalTexturesCache.push(v),v}},14984:(q,I,l)=>{"use strict";l(12591);var w=l(12875);l(12687),l(12828),l(12683),l(12925),l(12880);w.d},14437:(q,I,l)=>{"use strict";l.d(I,{d:()=>t});var w=l(12711);class t{constructor(q){this.value=this._toInt(q)}_toInt(q){return 0|q}add(q){return new t(this.value+q.value)}TI(q){return new t(this.value-q.value)}multiply(q){return new t(Math.imul(this.value,q.value))}divide(q){return new t(this.value/q.value)}getClassName(){return t.ClassName}equals(q){return this.value===q.value}static FromValue(q){return new t(q)}toString(){return this.value.toString()}}t.ClassName="FlowGraphInteger",(0,w.e)("FlowGraphInteger",t)},14443:(q,I,l)=>{"use strict";l.d(I,{b:()=>t,f:()=>O});var w=l(12747);class t{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ac=q}get m(){return this.ac}transformVector(q){return this.transformVectorToRef(q,new w.Vector2)}transformVectorToRef(q,I){return I.x=q.x*this.ac[0]+q.y*this.ac[1],I.y=q.x*this.ac[2]+q.y*this.ac[3],I}Uc(){return this.toArray()}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let I=0;I<4;I++)q[I]=this.ac[I];return q}dl(q){for(let I=0;I<4;I++)this.ac[I]=q[I];return this}multiplyToRef(q,I){const l=q.ac,w=this.ac,t=I.ac;return t[0]=l[0]*w[0]+l[1]*w[2],t[1]=l[0]*w[1]+l[1]*w[3],t[2]=l[2]*w[0]+l[3]*w[2],t[3]=l[2]*w[1]+l[3]*w[3],I}multiply(q){return this.multiplyToRef(q,new t)}divideToRef(q,I){const l=this.ac,w=q.ac,t=I.ac;return t[0]=l[0]/w[0],t[1]=l[1]/w[1],t[2]=l[2]/w[2],t[3]=l[3]/w[3],I}divide(q){return this.divideToRef(q,new t)}addToRef(q,I){const l=this.ac,w=q.m,t=I.m;return t[0]=l[0]+w[0],t[1]=l[1]+w[1],t[2]=l[2]+w[2],t[3]=l[3]+w[3],I}add(q){return this.addToRef(q,new t)}subtractToRef(q,I){const l=this.ac,w=q.m,t=I.m;return t[0]=l[0]-w[0],t[1]=l[1]-w[1],t[2]=l[2]-w[2],t[3]=l[3]-w[3],I}TI(q){return this.subtractToRef(q,new t)}transpose(){const q=this.ac;return new t([q[0],q[2],q[1],q[3]])}determinant(){const q=this.ac;return q[0]*q[3]-q[1]*q[2]}inverse(){const q=this.determinant();if(0===q)throw new Error("Matrix is not invertible");const I=this.ac,l=1/q;return new t([I[3]*l,-I[1]*l,-I[2]*l,I[0]*l])}equals(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=this.ac,w=q.m;return 0===I?l[0]===w[0]&&l[1]===w[1]&&l[2]===w[2]&&l[3]===w[3]:Math.abs(l[0]-w[0])<I&&Math.abs(l[1]-w[1])<I&&Math.abs(l[2]-w[2])<I&&Math.abs(l[3]-w[3])<I}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ac.join(", ")})`}}class O{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ac=q}get m(){return this.ac}transformVector(q){return this.transformVectorToRef(q,new w.dI)}transformVectorToRef(q,I){const l=this.ac;return I.x=q.x*l[0]+q.y*l[1]+q.z*l[2],I.y=q.x*l[3]+q.y*l[4]+q.z*l[5],I.z=q.x*l[6]+q.y*l[7]+q.z*l[8],I}multiplyToRef(q,I){const l=q.ac,w=this.ac,t=I.m;return t[0]=l[0]*w[0]+l[1]*w[3]+l[2]*w[6],t[1]=l[0]*w[1]+l[1]*w[4]+l[2]*w[7],t[2]=l[0]*w[2]+l[1]*w[5]+l[2]*w[8],t[3]=l[3]*w[0]+l[4]*w[3]+l[5]*w[6],t[4]=l[3]*w[1]+l[4]*w[4]+l[5]*w[7],t[5]=l[3]*w[2]+l[4]*w[5]+l[5]*w[8],t[6]=l[6]*w[0]+l[7]*w[3]+l[8]*w[6],t[7]=l[6]*w[1]+l[7]*w[4]+l[8]*w[7],t[8]=l[6]*w[2]+l[7]*w[5]+l[8]*w[8],I}multiply(q){return this.multiplyToRef(q,new O)}divideToRef(q,I){const l=this.ac,w=q.m,t=I.m;return t[0]=l[0]/w[0],t[1]=l[1]/w[1],t[2]=l[2]/w[2],t[3]=l[3]/w[3],t[4]=l[4]/w[4],t[5]=l[5]/w[5],t[6]=l[6]/w[6],t[7]=l[7]/w[7],t[8]=l[8]/w[8],I}divide(q){return this.divideToRef(q,new O)}addToRef(q,I){const l=this.ac,w=q.m,t=I.m;return t[0]=l[0]+w[0],t[1]=l[1]+w[1],t[2]=l[2]+w[2],t[3]=l[3]+w[3],t[4]=l[4]+w[4],t[5]=l[5]+w[5],t[6]=l[6]+w[6],t[7]=l[7]+w[7],t[8]=l[8]+w[8],I}add(q){return this.addToRef(q,new O)}subtractToRef(q,I){const l=this.ac,w=q.m,t=I.m;return t[0]=l[0]-w[0],t[1]=l[1]-w[1],t[2]=l[2]-w[2],t[3]=l[3]-w[3],t[4]=l[4]-w[4],t[5]=l[5]-w[5],t[6]=l[6]-w[6],t[7]=l[7]-w[7],t[8]=l[8]-w[8],I}TI(q){return this.subtractToRef(q,new O)}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let I=0;I<9;I++)q[I]=this.ac[I];return q}Uc(){return this.toArray()}dl(q){for(let I=0;I<9;I++)this.ac[I]=q[I];return this}transpose(){const q=this.ac;return new O([q[0],q[3],q[6],q[1],q[4],q[7],q[2],q[5],q[8]])}determinant(){const q=this.ac;return q[0]*(q[4]*q[8]-q[5]*q[7])-q[1]*(q[3]*q[8]-q[5]*q[6])+q[2]*(q[3]*q[7]-q[4]*q[6])}inverse(){const q=this.determinant();if(0===q)throw new Error("Matrix is not invertible");const I=this.ac,l=1/q;return new O([(I[4]*I[8]-I[5]*I[7])*l,(I[2]*I[7]-I[1]*I[8])*l,(I[1]*I[5]-I[2]*I[4])*l,(I[5]*I[6]-I[3]*I[8])*l,(I[0]*I[8]-I[2]*I[6])*l,(I[2]*I[3]-I[0]*I[5])*l,(I[3]*I[7]-I[4]*I[6])*l,(I[1]*I[6]-I[0]*I[7])*l,(I[0]*I[4]-I[1]*I[3])*l])}equals(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=this.ac,w=q.m;return 0===I?l[0]===w[0]&&l[1]===w[1]&&l[2]===w[2]&&l[3]===w[3]&&l[4]===w[4]&&l[5]===w[5]&&l[6]===w[6]&&l[7]===w[7]&&l[8]===w[8]:Math.abs(l[0]-w[0])<I&&Math.abs(l[1]-w[1])<I&&Math.abs(l[2]-w[2])<I&&Math.abs(l[3]-w[3])<I&&Math.abs(l[4]-w[4])<I&&Math.abs(l[5]-w[5])<I&&Math.abs(l[6]-w[6])<I&&Math.abs(l[7]-w[7])<I&&Math.abs(l[8]-w[8])<I}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ac.join(", ")})`}}},14447:(q,I,l)=>{"use strict";var w;function t(q,I,l,w){switch(I){case"Animation":return w?q.animations.find((q=>q.uniqueId===l))??null:q.animations[l]??null;case"AnimationGroup":return w?q.animationGroups.find((q=>q.uniqueId===l))??null:q.animationGroups[l]??null;case"Mesh":return w?q.meshes.find((q=>q.uniqueId===l))??null:q.meshes[l]??null;case"Material":return w?q.materials.find((q=>q.uniqueId===l))??null:q.materials[l]??null;case"LZ":return w?q.cameras.find((q=>q.uniqueId===l))??null:q.cameras[l]??null;case"Light":return w?q.lights.find((q=>q.uniqueId===l))??null:q.lights[l]??null;default:return null}}l.d(I,{b:()=>t}),function(q){q.Animation="Animation",q.AnimationGroup="AnimationGroup",q.Mesh="Mesh",q.Material="Material",q.LZ="LZ",q.Light="Light"}(w||(w={}))},14486:(q,I,l)=>{"use strict";l.d(I,{c:()=>t});var w=l(14488);class t extends w.e{constructor(q,I){if(super(q),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),I)for(const l of I)this._eventsSignalOutputs[l]=this._registerSignalOutput(l+"Event")}_executeOnTick(q){}_startPendingTasks(q){q._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(q),this._resetAfterCanceled(q)),this._preparePendingTasks(q),q._addPendingBlock(this),this.out._activateSignal(q),q._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(q){q._deleteExecutionVariable(this,"_initialized"),q._removePendingBlock(this)}}},14457:(q,I,l)=>{"use strict";l.d(I,{c:()=>s});var w=l(12718),t=l(12711),O=l(14466),c=l(12573),a=l(14430);class F extends O.e{constructor(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:w.defaultValue,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(q,I,l),this.richType=w,this._defaultValue=t,this._optional=O,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new c.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(q){this._isDisabled!==q&&(this._isDisabled=q,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(q,I){I._getConnectionValue(this)!==q&&(I._setConnectionValue(this,q),this.onValueChangedObservable.notifyObservers(q))}resetToDefaultValue(q){q._setConnectionValue(this,this._defaultValue)}connectTo(q){this._isDisabled||super.connectTo(q)}_getValueOrDefault(q){const I=q._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(I):I}getValue(q){if(1===this.connectionType){q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(q);const I=this._getValueOrDefault(q);return this._lastValue=I,this.richType.typeTransformer?this.richType.typeTransformer(I):I}const I=this.isConnected()?this._connectedPoint[0].getValue(q):this._getValueOrDefault(q);return this._lastValue=I,this.richType.typeTransformer?this.richType.typeTransformer(I):I}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.richType={},this.richType.serialize(q.richType),q.optional=this._optional,(0,a.e)("defaultValue",this._defaultValue,q)}}(0,t.e)("FlowGraphDataConnection",F);class s{constructor(q){var I;this.config=q,this.uniqueId=(0,w.d)(),this.name=(null===(I=this.config)||void 0===I?void 0:I.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(q){}registerDataInput(q,I,l){const w=new F(q,0,this,I,l);return this.dataInputs.push(w),w}registerDataOutput(q,I,l){const w=new F(q,1,this,I,l);return this.dataOutputs.push(w),w}getDataInput(q){return this.dataInputs.find((I=>I.name===q))}getDataOutput(q){return this.dataOutputs.find((I=>I.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.e;if(q.uniqueId=this.uniqueId,q.config={},this.config){const l=this.config,w=Object.keys(l);for(const t of w)I(t,l[t],q.config)}q.dataInputs=[],q.dataOutputs=[],q.className=this.getClassName();for(const l of this.dataInputs){const I={};l.serialize(I),q.dataInputs.push(I)}for(const l of this.dataOutputs){const I={};l.serialize(I),q.dataOutputs.push(I)}}deserialize(q){}_log(q,I,l){var w;null===(w=q.logger)||void 0===w||w.addLogItem({action:I,Tl:l,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14466:(q,I,l)=>{"use strict";l.d(I,{e:()=>O});var w,t=l(12718);!function(q){q[q.Input=0]="Input",q[q.Output=1]="Output"}(w||(w={}));class O{constructor(q,I,l){this._ownerBlock=l,this._connectedPoint=[],this.uniqueId=(0,t.d)(),this.connectedPointIds=[],this.name=q,this._connectionType=I}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(q){if(this._connectionType===q._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||q._isSingularConnection()&&q._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(q),q._connectedPoint.push(this)}disconnectFrom(q){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const l=this._connectedPoint.indexOf(q),w=q._connectedPoint.indexOf(this);-1!==l&&-1!==w&&(I&&this._connectedPoint.splice(l,1),q._connectedPoint.splice(w,1))}disconnectFromAll(){for(const q of this._connectedPoint)this.disconnectFrom(q,!1);this._connectedPoint.length=0}dispose(){for(const q of this._connectedPoint)this.disconnectFrom(q)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q.uniqueId=this.uniqueId,q.name=this.name,q._connectionType=this._connectionType,q.connectedPointIds=[],q.className=this.getClassName();for(const I of this._connectedPoint)q.connectedPointIds.push(I.uniqueId)}getClassName(){return"FGConnection"}deserialize(q){this.uniqueId=q.uniqueId,this.name=q.name,this._connectionType=q._connectionType,this.connectedPointIds=q.connectedPointIds}}},14422:(q,I,l)=>{"use strict";l.d(I,{c:()=>v});var w,t=l(12573),O=l(12735),c=l(12740),a=l(12718),F=l(14430),s=l(14447),Z=l(12591);!function(q){q.ExecuteBlock="ExecuteBlock",q.ExecuteEvent="ExecuteEvent",q.TriggerConnection="TriggerConnection",q.ContextVariableSet="ContextVariableSet",q.GlobalVariableSet="GlobalVariableSet",q.GlobalVariableDelete="GlobalVariableDelete",q.GlobalVariableGet="GlobalVariableGet",q.AddConnection="AddConnection",q.GetConnectionValue="GetConnectionValue",q.SetConnectionValue="SetConnectionValue",q.ActivateSignal="ActivateSignal",q.ContextVariableGet="ContextVariableGet"}(w||(w={}));class r{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(q){if(q.time||(q.time=Date.now()),this.log.push(q),this.logToConsole){var I;const l=null===(I=q.Tl)||void 0===I?void 0:I.value;"object"===typeof l&&l.getClassName?Z.b.Log(`[FGLog] ${q.className}:${q.uniqueId.split("-")[0]} ${q.action} - ${JSON.stringify(l.getClassName())}: ${l.toString()}`):Z.b.Log(`[FGLog] ${q.className}:${q.uniqueId.split("-")[0]} ${q.action} - ${JSON.stringify(q.Tl)}`)}}getItemsOfType(q){return this.log.filter((I=>I.action===q))}}class x{get enableLogging(){return this._enableLogging}set enableLogging(q){this._enableLogging!==q&&(this._enableLogging=q,this._enableLogging?(this.logger=new r,this.logger.logToConsole=!0):this.logger=null)}constructor(q){this.uniqueId=(0,a.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new t.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=q,this.assetsContext=q.assetsContext??q.VI}hasVariable(q){return q in this._userVariables}setVariable(q,I){var l;this._userVariables[q]=I,null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Tl:{name:q,value:I}})}getAsset(q,I){return(0,s.b)(this.assetsContext,q,I)}getVariable(q){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Tl:{name:q,value:this._userVariables[q]}}),this._userVariables[q]}get userVariables(){return this._userVariables}Wq(){return this._configuration.VI}_getUniqueIdPrefixedName(q,I){return`${q.uniqueId}_${I}`}_getGlobalContextVariable(q,I){var l;return null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Tl:{name:q,defaultValue:I,possibleValue:this._globalContextVariables[q]}}),this._hasGlobalContextVariable(q)?this._globalContextVariables[q]:I}_setGlobalContextVariable(q,I){var l;null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Tl:{name:q,value:I}}),this._globalContextVariables[q]=I}_deleteGlobalContextVariable(q){var I;null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Tl:{name:q}}),delete this._globalContextVariables[q]}_hasGlobalContextVariable(q){return q in this._globalContextVariables}_setExecutionVariable(q,I,l){this._executionVariables[this._getUniqueIdPrefixedName(q,I)]=l}_getExecutionVariable(q,I,l){return this._hasExecutionVariable(q,I)?this._executionVariables[this._getUniqueIdPrefixedName(q,I)]:l}_deleteExecutionVariable(q,I){delete this._executionVariables[this._getUniqueIdPrefixedName(q,I)]}_hasExecutionVariable(q,I){return this._getUniqueIdPrefixedName(q,I)in this._executionVariables}_hasConnectionValue(q){return q.uniqueId in this._connectionValues}_setConnectionValue(q,I){var l;this._connectionValues[q.uniqueId]=I,null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Tl:{connectionPointId:q.uniqueId,value:I}})}_setConnectionValueByKey(q,I){this._connectionValues[q]=I}_getConnectionValue(q){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Tl:{connectionPointId:q.uniqueId,value:this._connectionValues[q.uniqueId]}}),this._connectionValues[q.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(q){this._pendingBlocks.includes(q)||(this._pendingBlocks.push(q),this._pendingBlocks.sort(((q,I)=>q.priority-I.priority)))}_removePendingBlock(q){const I=this._pendingBlocks.indexOf(q);-1!==I&&this._pendingBlocks.splice(I,1)}_clearPendingBlocks(){for(const q of this._pendingBlocks)q._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(q){var I;this.onNodeExecutedObservable.notifyObservers(q),null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:q.getClassName(),uniqueId:q.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(q){this._setGlobalContextVariable("timeSinceStart",q.timeSinceStart),this._setGlobalContextVariable("deltaTime",q.deltaTime);for(const l of this._pendingBlocks){var I;null===(I=l._executeOnTick)||void 0===I||I.call(l,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.e;q.uniqueId=this.uniqueId,q._userVariables={};for(const w in this._userVariables)I(w,this._userVariables[w],q._userVariables);q._connectionValues={};for(const w in this._connectionValues)I(w,this._connectionValues[w],q._connectionValues);var l;this.assetsContext!==this.Wq()&&(q._assetsContext={meshes:this.assetsContext.meshes.map((q=>q.id)),materials:this.assetsContext.materials.map((q=>q.id)),textures:this.assetsContext.textures.map((q=>q.name)),animations:this.assetsContext.animations.map((q=>q.name)),lights:this.assetsContext.lights.map((q=>q.id)),cameras:this.assetsContext.cameras.map((q=>q.id)),To:null===(l=this.assetsContext.To)||void 0===l?void 0:l.map((q=>q.name)),skeletons:this.assetsContext.skeletons.map((q=>q.id)),Kx:this.assetsContext.Kx.map((q=>q.name)),geometries:this.assetsContext.geometries.map((q=>q.id)),multiMaterials:this.assetsContext.multiMaterials.map((q=>q.id)),transformNodes:this.assetsContext.transformNodes.map((q=>q.id))})}getClassName(){return"FlowGraphContext"}}(0,O.d)([(0,c.D)()],x.prototype,"uniqueId",void 0);var o=l(14451),d=l(13024);class T{constructor(q){this.onEventTriggeredObservable=new t.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=q,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.tc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const q=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Tl:{timeSinceStart:this._startingTime,deltaTime:q}}),this._startingTime+=q})),this._meshPickedObserver=this._scene.onPointerObservable.add((q=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Tl:q})}),d.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((q=>{const I=q.pointerId,l=q.mesh,w=this._pointerUnderMeshState[I];!w&&l?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Tl:{pointerId:I,mesh:l}}):w&&!l?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Tl:{pointerId:I,mesh:w}}):w&&l&&w!==l&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Tl:{pointerId:I,mesh:w,over:l}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Tl:{pointerId:I,mesh:l,out:w}})),this._pointerUnderMeshState[I]=l}),d.c.POINTERMOVE)}dispose(){var q,I,l,w,t;null===(q=this._sceneDisposeObserver)||void 0===q||q.remove(),null===(I=this._sceneReadyObserver)||void 0===I||I.remove(),null===(l=this._sceneOnBeforeRenderObserver)||void 0===l||l.remove(),null===(w=this._meshPickedObserver)||void 0===w||w.remove(),null===(t=this._meshUnderPointerObserver)||void 0===t||t.remove(),this.onEventTriggeredObservable.clear()}}var V,U=l(14473);!function(q){q[q.Stopped=0]="Stopped",q[q.Started=1]="Started"}(V||(V={}));class B{get state(){return this._state}set state(q){this._state=q,this.onStateChangedObservable.notifyObservers(q)}constructor(q){this.onStateChangedObservable=new t.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=q.VI,this._sceneEventCoordinator=new T(this._scene),this._coordinator=q.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((q=>{for(const I of this._executionContexts){const l=this._getContextualOrder(q.type,I);for(const w of l)if(!w._executeEvent(I,q.Tl))break}switch(q.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const I of this._executionContexts)I._notifyOnTick(q.Tl);break;case"SceneDispose":this.dispose()}}))}createContext(){const q=new x({VI:this._scene,coordinator:this._coordinator});return this._executionContexts.push(q),q}getContext(q){return this._executionContexts[q]}addEventBlock(q){if("PointerOver"!==q.type&&"PointerOut"!==q.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==q.type&&this._eventBlocks[q.type].push(q),1===this.state)for(const I of this._executionContexts)q._startPendingTasks(I);else this.onStateChangedObservable.addOnce((I=>{if(1===I)for(const l of this._executionContexts)q._startPendingTasks(l)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((q=>{1===q&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const q of this._executionContexts)for(const I in this._eventBlocks){const l=this._getContextualOrder(I,q);for(const I of l)I._startPendingTasks(q)}}_getContextualOrder(q,I){const l=this._eventBlocks[q].sort(((q,I)=>I.initPriority-q.initPriority));if("MeshPick"===q){const q=[];for(const w of l){const t=w.asset.getValue(I);let O=0;for(;O<l.length;O++){const q=l[O].asset.getValue(I);if(t&&q&&(0,U.r)(t,q))break}q.splice(O,0,w)}return q}return l}dispose(){var q;if(0!==this.state){this.state=0;for(const q of this._executionContexts)q._clearPendingBlocks();this._executionContexts.length=0;for(const q in this._eventBlocks)this._eventBlocks[q].length=0;null===(q=this._eventObserver)||void 0===q||q.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(q){const I=[],l=new Set;for(const w in this._eventBlocks)for(const q of this._eventBlocks[w])I.push(q),l.add(q.uniqueId);for(;I.length>0;){const w=I.pop();q(w);for(const q of w.dataInputs)for(const w of q._connectedPoint)l.has(w._ownerBlock.uniqueId)||(I.push(w._ownerBlock),l.add(w._ownerBlock.uniqueId));if(w instanceof o.e)for(const q of w.signalOutputs)for(const w of q._connectedPoint)l.has(w._ownerBlock.uniqueId)||(I.push(w._ownerBlock),l.add(w._ownerBlock.uniqueId))}}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1?arguments[1]:void 0;q.allBlocks=[],this.visitAllBlocks((I=>{const l={};I.serialize(l),q.allBlocks.push(l)})),q.executionContexts=[];for(const l of this._executionContexts){const w={};l.serialize(w,I),q.executionContexts.push(w)}}}class v{constructor(q){this.config=q,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.VI.tc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.VI.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const q=this._executeOnNextFrame.slice(0);if(q.length)for(const I of q){this.notifyCustomEvent(I.id,I.data,!1);const q=this._executeOnNextFrame.findIndex((q=>q.uniqueId===I.uniqueId));-1!==q&&this._executeOnNextFrame.splice(q,1)}}));(v.SceneCoordinators.get(this.config.VI)??[]).push(this)}createGraph(){const q=new B({VI:this.config.VI,coordinator:this});return this._flowGraphs.push(q),q}removeGraph(q){const I=this._flowGraphs.indexOf(q);-1!==I&&(q.dispose(),this._flowGraphs.splice(I,1))}start(){for(const q of this._flowGraphs)q.start()}dispose(){var q,I;for(const t of this._flowGraphs)t.dispose();this._flowGraphs.length=0,null===(q=this._disposeObserver)||void 0===q||q.remove(),null===(I=this._onBeforeRenderObserver)||void 0===I||I.remove();const l=v.SceneCoordinators.get(this.config.VI)??[],w=l.indexOf(this);-1!==w&&l.splice(w,1)}serialize(q,I){q._flowGraphs=[];for(const l of this._flowGraphs){const w={};l.serialize(w,I),q._flowGraphs.push(w)}q.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(q){let I=this._customEventsMap.get(q);return I||(I=new t.d,this._customEventsMap.set(q,I)),I}notifyCustomEvent(q,I){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:q,data:I,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(q)){const I=this._eventExecutionCounter.get(q);if(this._eventExecutionCounter.set(q,I+1),I>=v.MaxEventTypeExecutionPerFrame)return void(I===v.MaxEventTypeExecutionPerFrame&&Z.b.Warn(`FlowGraphCoordinator: Too many executions of event "${q}".`))}else this._eventExecutionCounter.set(q,1);const l=this._customEventsMap.get(q);l&&l.notifyObservers(I)}}v.MaxEventsPerType=30,v.MaxEventTypeExecutionPerFrame=30,v.SceneCoordinators=new Map},14477:(q,I,l)=>{"use strict";l.d(I,{b:()=>t});var w=l(14486);class t extends w.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(q){q._notifyExecuteNode(this),this.done._activateSignal(q)}}},14451:(q,I,l)=>{"use strict";l.d(I,{e:()=>a});var w=l(14457),t=l(14466),O=l(12711);class c extends t.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(q){super.connectTo(q),this._connectedPoint.sort(((q,I)=>I.priority-q.priority))}_activateSignal(q){var I;if(null===(I=q.logger)||void 0===I||I.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Tl:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(q,this),q._increaseExecutionId();else for(const l of this._connectedPoint)l._activateSignal(q)}}(0,O.e)("FlowGraphSignalConnection",c);class a extends w.c{constructor(q){super(q),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(q){const I=new c(q,0,this);return this.signalInputs.push(I),I}_registerSignalOutput(q){const I=new c(q,1,this);return this.signalOutputs.push(I),I}_unregisterSignalInput(q){const I=this.signalInputs.findIndex((I=>I.name===q));-1!==I&&(this.signalInputs[I].dispose(),this.signalInputs.splice(I,1))}_unregisterSignalOutput(q){const I=this.signalOutputs.findIndex((I=>I.name===q));-1!==I&&(this.signalOutputs[I].dispose(),this.signalOutputs.splice(I,1))}_reportError(q,I){this.error.Tl="string"===typeof I?new Error(I):I,this.error._activateSignal(q)}getSignalInput(q){return this.signalInputs.find((I=>I.name===q))}getSignalOutput(q){return this.signalOutputs.find((I=>I.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.signalInputs=[],q.signalOutputs=[];for(const I of this.signalInputs){const l={};I.serialize(l),q.signalInputs.push(l)}for(const I of this.signalOutputs){const l={};I.serialize(l),q.signalOutputs.push(l)}}deserialize(q){for(let I=0;I<q.signalInputs.length;I++){const l=this.getSignalInput(q.signalInputs[I].name);if(!l)throw new Error("Could not find signal input with name "+q.signalInputs[I].name+" in block "+q.className);l.deserialize(q.signalInputs[I])}for(let I=0;I<q.signalOutputs.length;I++){const l=this.getSignalOutput(q.signalOutputs[I].name);if(!l)throw new Error("Could not find signal output with name "+q.signalOutputs[I].name+" in block "+q.className);l.deserialize(q.signalOutputs[I])}}getClassName(){return"FlowGraphExecutionBlock"}}},14488:(q,I,l)=>{"use strict";l.d(I,{e:()=>t});var w=l(14451);class t extends w.e{constructor(q){super(q),this.out=this._registerSignalOutput("out")}}},14441:(q,I,l)=>{"use strict";l.d(I,{A:()=>Z,E:()=>o,F:()=>d,H:()=>T,K:()=>i,M:()=>S,P:()=>e,R:()=>W,e:()=>s,g:()=>x,k:()=>R,m:()=>V,o:()=>U,r:()=>B,v:()=>r,w:()=>C});var w,t=l(12747),O=l(12789),c=l(14437),a=l(14443);!function(q){q.Any="any",q.String="string",q.Number="number",q.Boolean="boolean",q.Object="object",q.Integer="FlowGraphInteger",q.Vector2="Vector2",q.dI="dI",q.Vector4="Vector4",q.Quaternion="Quaternion",q.Matrix="Matrix",q.Matrix2D="Matrix2D",q.Matrix3D="Matrix3D",q.BI="BI",q.Dc="Dc"}(w||(w={}));class F{constructor(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=q,this.defaultValue=I,this.animationType=l}serialize(q){q.typeName=this.typeName,q.defaultValue=this.defaultValue}}const s=new F("any",void 0),Z=new F("string",""),r=new F("number",0,0),x=new F("boolean",!1),o=new F("Vector2",t.Vector2.Zero(),5),d=new F("dI",t.dI.Zero(),1),T=new F("Vector4",t.Vector4.Zero()),V=new F("Matrix",t.Matrix.Identity(),3),U=new F("Matrix2D",new a.b),B=new F("Matrix3D",new a.f),v=new F("BI",O.BI.Black(),4),k=new F("Dc",new O.Dc(0,0,0,0),7),C=new F("Quaternion",t.Quaternion.Identity(),2);C.typeTransformer=q=>{if(q.getClassName){if("Vector4"===q.getClassName())return t.Quaternion.vI(q.Uc());if("dI"===q.getClassName())return t.Quaternion.FromEulerVector(q);if("Matrix"===q.getClassName())return t.Quaternion.FromRotationMatrix(q)}return q};const R=new F("FlowGraphInteger",new c.d(0),0);function W(q){const I=q;switch(typeof q){case"string":return Z;case"number":return r;case"boolean":return x;case"object":if(I.getClassName)switch(I.getClassName()){case"Vector2":return o;case"dI":return d;case"Vector4":return T;case"Matrix":return V;case"BI":return v;case"Dc":return k;case"Quaternion":return C;case"FlowGraphInteger":return R;case"Matrix2D":return U;case"Matrix3D":return B}return s;default:return s}}function e(q){switch(q){case"string":return Z;case"number":return r;case"boolean":return x;case"Vector2":return o;case"dI":return d;case"Vector4":return T;case"Matrix":return V;case"BI":return v;case"Dc":return k;case"Quaternion":return C;case"FlowGraphInteger":return R;case"Matrix2D":return U;case"Matrix3D":return B;default:return s}}function i(q){switch(q){case"number":default:return 0;case"Vector2":return 5;case"dI":return 1;case"Matrix":return 3;case"BI":return 4;case"Dc":return 7;case"Quaternion":return 2}}function S(q){switch(q){case 0:return r;case 5:return o;case 1:return d;case 3:return V;case 4:return v;case 7:return k;case 2:return C;default:return s}}},14430:(q,I,l)=>{"use strict";l.d(I,{b:()=>Z,e:()=>s,f:()=>r});var w=l(12789),t=l(12747),O=l(14437),c=l(14441),a=l(14443);function F(q){return"Vector2"===q||"dI"===q||"Vector4"===q||"Quaternion"===q||"BI"===q||"Dc"===q}function s(q,I,l){var w;const t=(null===I||void 0===I||null===(w=I.getClassName)||void 0===w?void 0:w.call(I))??"";if(F(t)||function(q){return"Matrix"===q||"Matrix2D"===q||"Matrix3D"===q}(t))l[q]={value:I.Uc(),className:t};else if("FlowGraphInteger"===t)l[q]={value:I.value,className:t};else if(t&&(I.id||I.name))l[q]={id:I.id,name:I.name,className:t};else{if("object"===typeof I)throw new Error(`Could not serialize value ${I}`);l[q]=I}}function Z(q,I,l,s){const r=I[q];let x;const o=(null===r||void 0===r?void 0:r.type)??(null===r||void 0===r?void 0:r.className);if(function(q){return"Mesh"===q||"AbstractMesh"===q||"GroundMesh"===q||"InstanceMesh"===q||"LinesMesh"===q||"GoldbergMesh"===q||"GreasedLineMesh"===q||"TrailMesh"===q}(o)){let q=s.meshes.filter((q=>r.id?q.id===r.id:q.name===r.name));0===q.length&&(q=s.transformNodes.filter((q=>r.id?q.id===r.id:q.name===r.name))),x=r.uniqueId?q.find((q=>q.uniqueId===r.uniqueId)):q[0]}else if(F(o))x=function(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===q)return t.Vector2.vI(I);if("dI"===q)return l&&(I[2]*=-1),t.dI.vI(I);if("Vector4"===q)return t.Vector4.vI(I);if("Quaternion"===q)return l&&(I[2]*=-1,I[3]*=-1),t.Quaternion.vI(I);if("BI"===q)return new w.BI(I[0],I[1],I[2]);if("Dc"===q)return new w.Dc(I[0],I[1],I[2],I[3]);throw new Error(`Unknown vector class name ${q}`)}(o,r.value);else if(function(q){return"AnimationGroup"===q}(o)){const q=s.animationGroups.filter((q=>q.name===r.name));x=1===q.length?q[0]:q.find((q=>q.uniqueId===r.uniqueId))}else x="Matrix"===o?t.Matrix.vI(r.value):"Matrix2D"===o?new a.b(r.value):"Matrix3D"===o?new a.f(r.value):"FlowGraphInteger"===o?O.d.FromValue(r.value):"number"===o||"string"===o||"boolean"===o?r.value[0]:r&&void 0!==r.value?r.value:Array.isArray(r)?r.reduce(((q,I)=>I.eventData?(q[I.id]={type:(0,c.P)(I.type)},"undefined"!==typeof I.value&&(q[I.id].value=Z("value",I,l,s)),q):q),{}):r;return x}function r(q){return"FlowGraphJsonPointerParserBlock"===q}},14473:(q,I,l)=>{"use strict";function w(q,I){return!(!q.parent||q.parent!==I&&!w(q.parent,I))}function t(q){if(q.getClassName)return q.getClassName()}function O(q,I){return q===I&&("Vector2"===q||"dI"===q||"Vector4"===q||"Quaternion"===q)}function c(q,I){return q===I&&("Matrix"===q||"Matrix2D"===q||"Matrix3D"===q)}function a(q,I){return"FlowGraphInteger"===q&&"FlowGraphInteger"===I}function F(q,I){const l="number"===typeof q||"number"===typeof(null===q||void 0===q?void 0:q.value);return l&&!I?!isNaN(s(q)):l}function s(q){return"number"===typeof q?q:q.value}l.d(I,{e:()=>a,i:()=>c,k:()=>O,n:()=>t,r:()=>w,s:()=>s,w:()=>F})},13820:(q,I,l)=>{"use strict";l.r(I),l.d(I,{SceneInstrumentation:()=>O});var w=l(12564),t=l(12970);class O{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(q){q!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=q,q?(this._onBeforeActiveMeshesEvaluationObserver=this.VI.onBeforeActiveMeshesEvaluationObservable.add((()=>{w.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.VI.onAfterActiveMeshesEvaluationObservable.add((()=>{w.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.VI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.VI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(q){q!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=q,q?(this._onBeforeRenderTargetsRenderObserver=this.VI.onBeforeRenderTargetsRenderObservable.add((()=>{w.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.VI.onAfterRenderTargetsRenderObservable.add((()=>{w.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.VI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.VI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(q){q!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=q,q?(this._onBeforeParticlesRenderingObserver=this.VI.onBeforeParticlesRenderingObservable.add((()=>{w.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.VI.onAfterParticlesRenderingObservable.add((()=>{w.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.VI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.VI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(q){q!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=q,this.VI.spriteManagers&&(q?(this._onBeforeSpritesRenderingObserver=this.VI.onBeforeSpritesRenderingObservable.add((()=>{w.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.VI.onAfterSpritesRenderingObservable.add((()=>{w.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.VI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.VI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(q){q!==this._capturePhysicsTime&&this.VI.onBeforePhysicsObservable&&(this._capturePhysicsTime=q,q?(this._onBeforePhysicsObserver=this.VI.onBeforePhysicsObservable.add((()=>{w.Tools.StartPerformanceCounter("yc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.VI.onAfterPhysicsObservable.add((()=>{w.Tools.EndPerformanceCounter("yc"),this._physicsTime.endMonitoring()}))):(this.VI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.VI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(q){q!==this._captureAnimationsTime&&(this._captureAnimationsTime=q,q?this._onAfterAnimationsObserver=this.VI.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.VI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(q){this._captureFrameTime=q}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(q){this._captureInterFrameTime=q}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(q){q!==this._captureRenderTime&&(this._captureRenderTime=q,q?(this._onBeforeDrawPhaseObserver=this.VI.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),w.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.VI.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),w.Tools.EndPerformanceCounter("Main render")}))):(this.VI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.VI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(q){q!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=q,q?(this._onBeforeCameraRenderObserver=this.VI.onBeforeCameraRenderObservable.add((q=>{this._cameraRenderTime.beginMonitoring(),w.Tools.StartPerformanceCounter(`Rendering camera ${q.name}`)})),this._onAfterCameraRenderObserver=this.VI.onAfterCameraRenderObservable.add((q=>{this._cameraRenderTime.endMonitoring(!1),w.Tools.EndPerformanceCounter(`Rendering camera ${q.name}`)}))):(this.VI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.VI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.VI.getEngine()._drawCalls}constructor(q){this.VI=q,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new t.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new t.b,this._captureFrameTime=!1,this._frameTime=new t.b,this._captureRenderTime=!1,this._renderTime=new t.b,this._captureInterFrameTime=!1,this._interFrameTime=new t.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new t.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new t.b,this._capturePhysicsTime=!1,this._physicsTime=new t.b,this._captureAnimationsTime=!1,this._animationsTime=new t.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new t.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=q.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(w.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.VI.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=q.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(w.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.wc(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.wc(),this._captureParticlesRenderTime&&this._particlesRenderTime.wc(),this._captureSpritesRenderTime&&this._spritesRenderTime.wc(),this._captureRenderTime&&this._renderTime.wc(),this._captureCameraRenderTime&&this._cameraRenderTime.wc()}))}dispose(){this._disposed||(this.VI.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.VI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.VI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.VI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.VI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.VI.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.VI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.VI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.VI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.VI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.VI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.VI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.VI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.VI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.VI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.VI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.VI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.VI=null,this._disposed=!0)}}},14416:(q,I,l)=>{"use strict";l.d(I,{e:()=>Z});var w=l(12735),t=l(12740),O=l(12747),c=l(13171),a=l(13257),F=l(13301),s=l(12711);c.d.AddNodeConstructor("Light_Type_1",((q,I)=>()=>new Z(q,O.dI.Zero(),I)));class Z extends F.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(q){this._shadowFrustumSize=q,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(q){this._shadowOrthoScale=q,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(q){this._orthoLeft=q}get orthoRight(){return this._orthoRight}set orthoRight(q){this._orthoRight=q}get orthoTop(){return this._orthoTop}set orthoTop(q){this._orthoTop=q}get orthoBottom(){return this._orthoBottom}set orthoBottom(q){this._orthoBottom=q}constructor(q,I,l){super(q,l),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=I.scale(-1),this.direction=I}getClassName(){return"Gc"}getTypeID(){return a.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(q,I,l){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(q):this._setDefaultAutoExtendShadowProjectionMatrix(q,I,l)}_setDefaultFixedFrustumShadowProjectionMatrix(q){const I=this.Wq().activeCamera;I&&O.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:I.vc,void 0!==this.shadowMaxZ?this.shadowMaxZ:I.maxZ,q,this.Wq().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(q,I,l){const w=this.Wq().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const q=O.dI.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let w=Number.MAX_VALUE,t=-Number.MAX_VALUE;for(let c=0;c<l.length;c++){const a=l[c];if(!a)continue;const F=a.getBoundingInfo().boundingBox;for(let l=0;l<F.vectorsWorld.length;l++)O.dI.TransformCoordinatesToRef(F.vectorsWorld[l],I,q),q.x<this._orthoLeft&&(this._orthoLeft=q.x),q.y<this._orthoBottom&&(this._orthoBottom=q.y),q.x>this._orthoRight&&(this._orthoRight=q.x),q.y>this._orthoTop&&(this._orthoTop=q.y),this.autoCalcShadowZBounds&&(q.z<w&&(w=q.z),q.z>t&&(t=q.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=w,this._shadowMaxZ=t)}const t=this._orthoRight-this._orthoLeft,c=this._orthoTop-this._orthoBottom,a=void 0!==this.shadowMinZ?this.shadowMinZ:(null===w||void 0===w?void 0:w.vc)||0,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===w||void 0===w?void 0:w.maxZ)||1e4,s=this.Wq().getEngine().Ic;O.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-t*this.shadowOrthoScale,this._orthoRight+t*this.shadowOrthoScale,this._orthoBottom-c*this.shadowOrthoScale,this._orthoTop+c*this.shadowOrthoScale,s?F:a,s?a:F,q,this.Wq().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,I){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,I),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,I),this)}transferToNodeMaterialEffect(q,I){return this.computeTransformedInformation()?(q.setFloat3(I,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(q.setFloat3(I,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(q){const I=this._scene.getEngine();return!I.Ic&&I.isNDCHalfZRange?0:1}getDepthMaxZ(q){const I=this._scene.getEngine();return I.Ic&&I.isNDCHalfZRange?0:1}prepareLightSpecificDefines(q,I){q["DIRLIGHT"+I]=!0}}(0,w.d)([(0,t.D)()],Z.prototype,"shadowFrustumSize",null),(0,w.d)([(0,t.D)()],Z.prototype,"shadowOrthoScale",null),(0,w.d)([(0,t.D)()],Z.prototype,"autoUpdateExtends",void 0),(0,w.d)([(0,t.D)()],Z.prototype,"autoCalcShadowZBounds",void 0),(0,w.d)([(0,t.D)("orthoLeft")],Z.prototype,"_orthoLeft",void 0),(0,w.d)([(0,t.D)("orthoRight")],Z.prototype,"_orthoRight",void 0),(0,w.d)([(0,t.D)("orthoTop")],Z.prototype,"_orthoTop",void 0),(0,w.d)([(0,t.D)("orthoBottom")],Z.prototype,"_orthoBottom",void 0),(0,s.e)("BABYLON.DirectionalLight",Z)},14924:(q,I,l)=>{"use strict";l.d(I,{b:()=>Z});var w=l(12735),t=l(12740),O=l(12747),c=l(12789),a=l(13171),F=l(13257),s=l(12711);a.d.AddNodeConstructor("Light_Type_3",((q,I)=>()=>new Z(q,O.dI.Zero(),I)));class Z extends F.d{constructor(q,I,l){super(q,l),this.groundColor=new c.BI(0,0,0),this.direction=I||O.dI.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Nc"}setDirectionToTarget(q){return this.direction=O.dI.Normalize(q.TI(O.dI.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(q,I){const l=O.dI.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",l.x,l.y,l.z,0,I),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Ec),I),this}transferToNodeMaterialEffect(q,I){const l=O.dI.Normalize(this.direction);return q.setFloat3(I,l.x,l.y,l.z),this}Cc(){return this._worldMatrix||(this._worldMatrix=O.Matrix.Identity()),this._worldMatrix}getTypeID(){return F.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(q,I){q["HEMILIGHT"+I]=!0}}(0,w.d)([(0,t.k)()],Z.prototype,"groundColor",void 0),(0,w.d)([(0,t.C)()],Z.prototype,"direction",void 0),(0,s.e)("BABYLON.HemisphericLight",Z)},14392:(q,I,l)=>{"use strict";l.d(I,{b:()=>r});var w=l(12735),t=l(12740),O=l(12747),c=l(13171),a=l(13257),F=l(13301),s=l(12733),Z=l(12711);c.d.AddNodeConstructor("Light_Type_2",((q,I)=>()=>new r(q,O.dI.Zero(),O.dI.Zero(),0,0,I)));class r extends F.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(q){this._iesProfileTexture!==q&&(this._iesProfileTexture=q,this._iesProfileTexture&&r._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(q){this._angle=q,this._cosHalfAngle=Math.cos(.5*q),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(q){this._innerAngle=q,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(q){this._shadowAngleScale=q,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(q){this._projectionTextureLightNear=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(q){this._projectionTextureLightFar=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(q){this._projectionTextureUpDirection=q,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(q){this._projectionTexture!==q&&(this._projectionTexture=q,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(r._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):r._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(q){return void 0!==q.onGeneratedObservable}static _IsTexture(q){return void 0!==q.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(q){this._projectionTextureProjectionLightMatrix=q,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(q,I,l,w,t,c){super(q,c),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=O.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=O.dI.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=O.dI.Zero(),this._projectionTextureViewLightMatrix=O.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=O.Matrix.Zero(),this._projectionTextureScalingMatrix=O.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=I,this.direction=l,this.angle=w,this.exponent=t}getClassName(){return"SpotLight"}getTypeID(){return a.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(q){super._setDirection(q),this._projectionTextureViewLightDirty=!0}_setPosition(q){super._setPosition(q),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(q,I,l){const w=this.Wq().activeCamera;if(!w)return;this._shadowAngleScale=this._shadowAngleScale||1;const t=this._shadowAngleScale*this._angle,c=void 0!==this.shadowMinZ?this.shadowMinZ:w.vc,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,F=this.Wq().getEngine().Ic;O.Matrix.PerspectiveFovLHToRef(t,1,F?a:c,F?c:a,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,F)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),O.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const q=this.projectionTextureLightFar,I=this.projectionTextureLightNear,l=q/(q-I),w=-l*I,t=1/Math.tan(this._angle/2);O.Matrix.FromValuesToRef(t/1,0,0,0,0,t,0,0,0,0,l,1,0,0,w,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof s.d){const q=this._projectionTexture.uScale/2,I=this._projectionTexture.vScale/2;O.Matrix.FromValuesToRef(q,0,0,0,0,I,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(q,I){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),q.setMatrix("textureProjectionMatrix"+I,this._projectionTextureMatrix),q.setTexture("projectionLightTexture"+I,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&q.setTexture("iesLightTexture"+I,this._iesProfileTexture),this}transferToEffect(q,I){let l;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,I),l=O.dI.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,I),l=O.dI.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",l.x,l.y,l.z,this._cosHalfAngle,I),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,I),this}transferToNodeMaterialEffect(q,I){let l;return l=this.computeTransformedInformation()?O.dI.Normalize(this.transformedDirection):O.dI.Normalize(this.direction),this.Wq().useRightHandedSystem?q.setFloat3(I,-l.x,-l.y,-l.z):q.setFloat3(I,l.x,l.y,l.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(q){const I=this._scene.getEngine(),l=void 0!==this.shadowMinZ?this.shadowMinZ:(null===q||void 0===q?void 0:q.vc)??0;return I.Ic&&I.isNDCHalfZRange?l:this._scene.getEngine().isNDCHalfZRange?0:l}getDepthMaxZ(q){const I=this._scene.getEngine(),l=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===q||void 0===q?void 0:q.maxZ)??1e4;return I.Ic&&I.isNDCHalfZRange?0:l}prepareLightSpecificDefines(q,I){q["SPOTLIGHT"+I]=!0,q["PROJECTEDLIGHTTEXTURE"+I]=!(!this.projectionTexture||!this.projectionTexture.isReady()),q["IESLIGHTTEXTURE"+I]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,w.d)([(0,t.D)()],r.prototype,"angle",null),(0,w.d)([(0,t.D)()],r.prototype,"innerAngle",null),(0,w.d)([(0,t.D)()],r.prototype,"shadowAngleScale",null),(0,w.d)([(0,t.D)()],r.prototype,"exponent",void 0),(0,w.d)([(0,t.D)()],r.prototype,"projectionTextureLightNear",null),(0,w.d)([(0,t.D)()],r.prototype,"projectionTextureLightFar",null),(0,w.d)([(0,t.D)()],r.prototype,"projectionTextureUpDirection",null),(0,w.d)([(0,t.z)("projectedLightTexture")],r.prototype,"_projectionTexture",void 0),(0,Z.e)("BABYLON.SpotLight",r)},14116:(q,I,l)=>{"use strict";l.d(I,{d:()=>c,f:()=>O,i:()=>a});const w={},t={};function O(q,I){w[q]=I}function c(q,I){t[q]=I}function a(q){return t[q]?t[q]:null}},14011:(q,I,l)=>{"use strict";l.d(I,{b:()=>W,c:()=>f});var w,t=l(12564),O=l(12573),c=l(12987),a=l(12612),F=l(12591),s=l(13200),Z=l(12615),r=l(12619),x=l(12718),o=l(12656),d=l(12607);!function(q){q[q.Clean=0]="Clean",q[q.Stop=1]="Stop",q[q.Sync=2]="Sync",q[q.NoSync=3]="NoSync"}(w||(w={}));const T=new O.d,V={};let U=!1;function B(){return V[".babylon"]}function v(q,I){const l=V[q];return l||(F.b.Warn("Unable to find a plugin to load "+q+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),I?B():void 0)}function k(q,I,l){let w="Unable to load from "+(q.rawData?"binary data":q.url);return I?w+=`: ${I}`:l&&(w+=`: ${l}`),w}async function C(q,I,l,w,t,O,c,a,F){var s;const r="data:"===(x=q.url).substring(0,5)?x.substring(5):null;var x;if(q.rawData&&!c)throw"When using ArrayBufferView to load data the file extension must be provided.";const U=r||c?"":function(q){const I=q.indexOf("?");-1!==I&&(q=q.substring(0,I));const l=q.lastIndexOf(".");return q.substring(l,q.length).toLowerCase()}(q.url);let k=c?v(c,!0):r?function(q){for(const I in V){const l=V[I].plugin;if(l.canDirectLoad&&l.canDirectLoad(q))return V[I]}return B()}(q.url):v(U,!1);if(!k&&U){if(q.url&&!q.url.startsWith("blob:")){const I=await async function(q,I){const l=I.method||"GET";return await new Promise(((w,t)=>{const O=new d.c;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const q={};if(I.responseHeaders)for(const l of I.responseHeaders)q[l]=O.getResponseHeader(l)||"";w({response:O.response,headerValues:q})}else t(`Unable to fetch data from ${q}. Error code: ${O.status}`)})),O.open(l,q),O.send()}))}(q.url,{method:"HEAD",responseHeaders:["Content-Type"]}),l=I.headerValues?I.headerValues["Content-Type"]:"";l&&(k=function(q){for(const I in V){const l=V[I];if(l.mimeType===q)return l}}(l))}k||(k=B())}if(!k)throw new Error(`No plugin or fallback for ${c??q.url}`);if(!1===(null===F||void 0===F||null===(s=F[k.plugin.name])||void 0===s?void 0:s.enabled))throw new Error(`The '${k.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(q.rawData&&!k.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(q=>{if(k.plugin.createPlugin){const I=k.plugin.createPlugin(F??{});return I instanceof Promise?(I.then(q).catch((q=>{t("Error instantiating plugin.",q)})),null):(q(I),I)}return q(k.plugin),k.plugin})((F=>{var s;if(!F)throw`The loader plugin corresponding to the '${c}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(T.notifyObservers(F),r&&(F.canDirectLoad&&F.canDirectLoad(q.url)||!(0,Z.k)(q.url))){if(F.directLoad){const q=F.directLoad(I,r);q instanceof Promise?q.then((q=>{l(F,q)})).catch((q=>{t("Error in directLoad of _loadData: "+q,q)})):l(F,q)}else l(F,r);return}const x=k.isBinary,d=(q,w)=>{I.Z?t("Scene has been disposed"):l(F,q,w)};let V=null,U=!1;null===(s=F.tc)||void 0===s||s.add((()=>{U=!0,V&&(V.abort(),V=null),O()}));const B=()=>{if(U)return;const l=(q,I)=>{t(null===q||void 0===q?void 0:q.statusText,I)};if(!F.loadFile&&q.rawData)throw"Plugin does not support loading ArrayBufferView.";V=F.loadFile?F.loadFile(I,q.rawData||q.file||q.url,q.rootUrl,d,w,x,l,a):I._loadFile(q.file||q.url,d,w,!0,x,l)},v=I.getEngine();let C=v.enableOfflineSupport;if(C){let l=!1;for(const w of I.disableOfflineSupportExceptionRules)if(w.test(q.url)){l=!0;break}C=!l}C&&o.d.OfflineProviderFactory?I.offlineProvider=o.d.OfflineProviderFactory(q.url,B,v.disableManifestCheck):B()}))}function R(q,I){let l,w,O=null,c=null;if(I)if(I.name)l=`file:${I.name}`,w=I.name,O=I;else if(ArrayBuffer.isView(I))l="",w=(0,x.d)(),c=I;else if(I.startsWith("data:"))l=I,w="";else if(q){const O=I;if("/"===O.substring(0,1))return t.Tools.Error("Wrong sceneFilename parameter"),null;l=q+O,w=O}else l=I,w=t.Tools.GetFilename(I),q=t.Tools.GetFolderPath(I);else l=q,w=t.Tools.GetFilename(q),q=t.Tools.GetFolderPath(q);return{url:l,rootUrl:q,name:w,file:O,rawData:c}}function W(q){if("string"===typeof q.extensions){const I=q.extensions;V[I.toLowerCase()]={plugin:q,isBinary:!1}}else{const I=q.extensions,l=Object.keys(I);for(const w of l)V[w.toLowerCase()]={plugin:q,isBinary:I[w].isBinary,mimeType:I[w].mimeType}}}async function e(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.e.LastCreatedScene,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!w)return F.b.Error("No scene available to import mesh to"),null;const o=R(I,l);if(!o)return null;const d={};w.addPendingData(d);const T=()=>{w.removePendingData(d)},V=(q,I)=>{const l=k(o,q,I);c?c(w,l,new r.f(l,r.e.SceneLoaderError,I)):F.b.Error(l),T()},U=O?q=>{try{O(q)}catch(I){V("Error in onProgress callback: "+I,I)}}:void 0,B=(q,I,l,O,c,a,F,s)=>{if(w.importedMeshesFiles.push(o.url),t)try{t(q,I,l,O,c,a,F,s)}catch(Z){V("Error in onSuccess callback: "+Z,Z)}w.removePendingData(d)};return await C(o,w,((I,l,t)=>{if(I.rewriteRootURL&&(o.rootUrl=I.rewriteRootURL(o.rootUrl,t)),I.importMesh){const t=[],O=[],c=[];if(!I.importMesh(q,w,l,o.rootUrl,t,O,c,V))return;w.loadingPluginName=I.name,B(t,O,c,[],[],[],[],[])}else{I.importMeshAsync(q,w,l,o.rootUrl,U,o.name).then((q=>{w.loadingPluginName=I.name,B(q.meshes,q.Kx,q.skeletons,q.animationGroups,q.transformNodes,q.geometries,q.lights,q.spriteManagers)})).catch((q=>{V(q.message,q)}))}}),U,V,T,s,Z,x)}async function i(q,I,l,w,t,O,c,a){return await new Promise(((F,s)=>{try{e(q,I,l,w,((q,I,l,w,t,O,c,a)=>{F({meshes:q,Kx:I,skeletons:l,animationGroups:w,transformNodes:t,geometries:O,lights:c,spriteManagers:a})}),t,((q,I,l)=>{s(l||new Error(I))}),O,c,a).catch(s)}catch(r){s(r)}}))}async function S(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.e.LastCreatedEngine,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};l?await p(q,I,new c.e(l),w,O,F,s,Z,r):t.Tools.Error("No engine available")}async function g(q,I,l,w,t,O,c){return await new Promise(((a,F)=>{S(q,I,l,(q=>{a(q)}),w,((q,I,l)=>{F(l||new Error(I))}),t,O,c)}))}async function p(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.e.LastCreatedScene,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!l)return F.b.Error("No scene available to append to"),null;const o=R(q,I);if(!o)return null;const d={};l.addPendingData(d);const T=()=>{l.removePendingData(d)};s.b.ShowLoadingScreen&&!U&&(U=!0,l.getEngine().displayLoadingUI(),l.executeWhenReady((()=>{l.getEngine().hideLoadingUI(),U=!1})));const V=(q,I)=>{const w=k(o,q,I);O?O(l,w,new r.f(w,r.e.SceneLoaderError,I)):F.b.Error(w),T()},B=t?q=>{try{t(q)}catch(I){V("Error in onProgress callback",I)}}:void 0,v=()=>{if(w)try{w(l)}catch(q){V("Error in onSuccess callback",q)}l.removePendingData(d)};return await C(o,l,((q,I)=>{if(q.load){if(!q.load(l,I,o.rootUrl,V))return;l.loadingPluginName=q.name,v()}else{q.loadAsync(l,I,o.rootUrl,B,o.name).then((()=>{l.loadingPluginName=q.name,v()})).catch((q=>{V(q.message,q)}))}}),B,V,T,c,Z,x)}async function X(q,I,l,w,t,O,c){return await new Promise(((a,F)=>{try{p(q,I,l,(q=>{a(q)}),w,((q,I,l)=>{F(l||new Error(I))}),t,O,c).catch(F)}catch(r){F(r)}}))}async function K(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.e.LastCreatedScene,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!l)return F.b.Error("No scene available to load asset container to"),null;const x=R(q,I);if(!x)return null;const o={};l.addPendingData(o);const d=()=>{l.removePendingData(o)},T=(q,I)=>{const w=k(x,q,I);O?O(l,w,new r.f(w,r.e.SceneLoaderError,I)):F.b.Error(w),d()},V=t?q=>{try{t(q)}catch(I){T("Error in onProgress callback",I)}}:void 0,U=q=>{if(w)try{w(q)}catch(I){T("Error in onSuccess callback",I)}l.removePendingData(o)};return await C(x,l,((q,I)=>{if(q.loadAssetContainer){const w=q.loadAssetContainer(l,I,x.rootUrl,T);if(!w)return;w.populateRootNodes(),l.loadingPluginName=q.name,U(w)}else if(q.loadAssetContainerAsync){q.loadAssetContainerAsync(l,I,x.rootUrl,V,x.name).then((I=>{I.populateRootNodes(),l.loadingPluginName=q.name,U(I)})).catch((q=>{T(q.message,q)}))}else T("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),V,T,d,c,s,Z)}async function D(q,I,l,w,t,O,c){return await new Promise(((a,F)=>{try{K(q,I,l,(q=>{a(q)}),w,((q,I,l)=>{F(l||new Error(I))}),t,O,c).catch(F)}catch(r){F(r)}}))}async function M(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.e.LastCreatedScene,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",o=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!l)return void F.b.Error("No scene available to load animations to");if(w){for(const w of l.animatables)w.reset();l.stopAllAnimations();const q=l.animationGroups.slice();for(const l of q)l.dispose();const I=l.getNodes();for(const l of I)l.animations&&(l.animations=[])}else switch(t){case 0:const q=l.animationGroups.slice();for(const I of q)I.dispose();break;case 1:for(const I of l.animationGroups)I.stop();break;case 2:for(const I of l.animationGroups)I.reset(),I.restart();break;case 3:break;default:return void F.b.Error("Unknown animation group loading mode value '"+t+"'")}const d=l.animatables.length;await K(q,I,l,(q=>{q.mergeAnimationsTo(l,l.animatables.slice(d),O),q.dispose(),l.onAnimationFileImportedObservable.notifyObservers(l),c&&c(l)}),s,Z,r,x,o)}async function n(q,I,l,w,t,O,c,a,F,s){return await new Promise(((Z,x)=>{try{M(q,I,l,w,t,O,(q=>{Z(q)}),c,((q,I,l)=>{x(l||new Error(I))}),a,F,s).catch(x)}catch(r){x(r)}}))}class f{static get ForceFullSceneLoadingForIncremental(){return s.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(q){s.b.ForceFullSceneLoadingForIncremental=q}static get ShowLoadingScreen(){return s.b.ShowLoadingScreen}static set ShowLoadingScreen(q){s.b.ShowLoadingScreen=q}static get loggingLevel(){return s.b.loggingLevel}static set loggingLevel(q){s.b.loggingLevel=q}static get CleanBoneMatrixWeights(){return s.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(q){s.b.CleanBoneMatrixWeights=q}static GetDefaultPlugin(){return B()}static GetPluginForExtension(q){var I;return null===(I=v(q,!0))||void 0===I?void 0:I.plugin}static IsPluginForExtensionAvailable(q){return function(q){return!!V[q]}(q)}static RegisterPlugin(q){W(q)}static ImportMesh(q,I,l,w,t,O,c,F,s){e(q,I,l,w,t,O,c,F,s).catch((q=>null===c||void 0===c?void 0:c(a.e.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async ImportMeshAsync(q,I,l,w,t,O,c){return await i(q,I,l,w,t,O,c)}static Load(q,I,l,w,t,O,c,F){S(q,I,l,w,t,O,c,F).catch((q=>null===O||void 0===O?void 0:O(a.e.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async LoadAsync(q,I,l,w,t,O){return await g(q,I,l,w,t,O)}static Append(q,I,l,w,t,O,c,F){p(q,I,l,w,t,O,c,F).catch((q=>null===O||void 0===O?void 0:O(l??a.e.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async AppendAsync(q,I,l,w,t,O){return await X(q,I,l,w,t,O)}static LoadAssetContainer(q,I,l,w,t,O,c,F){K(q,I,l,w,t,O,c,F).catch((q=>null===O||void 0===O?void 0:O(l??a.e.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async LoadAssetContainerAsync(q,I,l,w,t,O){return await D(q,I,l,w,t,O)}static ImportAnimations(q,I,l,w,t,O,c,F,s,Z,r){M(q,I,l,w,t,O,c,F,s,Z,r).catch((q=>null===s||void 0===s?void 0:s(l??a.e.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async ImportAnimationsAsync(q,I,l,w,t,O,c,a,F,s,Z){return await n(q,I,l,w,t,O,a,s,Z)}}f.NO_LOGGING=0,f.MINIMAL_LOGGING=1,f.SUMMARY_LOGGING=2,f.DETAILED_LOGGING=3,f.OnPluginActivatedObservable=T},14403:(q,I,l)=>{"use strict";l.d(I,{d:()=>x});var w=l(12735),t=l(12740),O=l(12564),c=l(12747),a=l(12765),F=l(12733),s=l(12711),Z=l(12573),r=l(12777);l(14412);class x extends a.e{set boundingBoxSize(q){if(this._boundingBoxSize&&this._boundingBoxSize.equals(q))return;this._boundingBoxSize=q;const I=this.Wq();I&&I.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(q){this._rotationY=q,this.setReflectionTextureMatrix(c.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(q,I,l){let w="";for(const t of q)w+=t;return new x(w,I,null,l,q)}static CreateFromPrefilteredData(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=I.useDelayedTextureLoading;I.useDelayedTextureLoading=!1;const O=new x(q,I,null,!1,null,null,null,void 0,!0,l,w);return I.useDelayedTextureLoading=t,O}constructor(q,I){var l;let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,U=arguments.length>13?arguments[13]:void 0,B=arguments.length>14?arguments[14]:void 0;super(I),this.onLoadObservable=new Z.d,this.boundingBoxPosition=c.dI.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new c.Matrix,this._buffer=null,this.name=q,this.url=q,this._noMipmap=t,this.Bc=!1,this.isCube=!0,this._textureMatrix=c.Matrix.Identity(),this.coordinatesMode=F.d.CUBIC_MODE;let v=null,k=null;null===w||Array.isArray(w)?(this._noMipmap=t,this._format=r,this._createPolynomials=d,v=w,this._loaderOptions=U,this._useSRGBBuffer=B,this._lodScale=T,this._lodOffset=V):(v=w.extensions??null,this._noMipmap=w.noMipmap??!1,O=w.files??null,k=w.buffer??null,this._format=w.format??5,x=w.prefiltered??!1,o=w.forcedExtension??null,this._createPolynomials=w.createPolynomials??!1,this._lodScale=w.lodScale??.8,this._lodOffset=w.lodOffset??0,this._loaderOptions=w.loaderOptions,this._useSRGBBuffer=w.useSRGBBuffer,a=w.J??null,s=w.onError??null),(q||O)&&this.updateURL(q,o,a,x,s,v,null===(l=this.Wq())||void 0===l?void 0:l.useDelayedTextureLoading,O,k)}getClassName(){return"CubeTexture"}updateURL(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=q),this.url=q,I&&(this._forcedExtension=I);const s=q.lastIndexOf("."),Z=I||(s>-1?q.substring(s).toLowerCase():""),r=0===Z.indexOf(".dds"),x=0===Z.indexOf(".env"),o=0===Z.indexOf(".basis");if(x?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=w,w&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),a)this._files=a;else if(o||x||r||O||(O=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,O){for(let I=0;I<O.length;I++)this._files.push(q+O[I]);this._extensions=O}this._buffer=F,c?(this.delayLoadState=4,this._delayedOnLoad=l,this._delayedOnError=t):this._loadTexture(l,t)}delayLoad(q){4===this.delayLoadState&&(q&&(this._forcedExtension=q),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(q){var I,l;if(q.updateFlag===this._textureMatrix.updateFlag)return;q.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(l=this.Wq())||void 0===l||l.markAllMaterialsAsDirty(1,(q=>-1!==q.getActiveTextures().indexOf(this))));if(this._textureMatrix=q,null===(I=this.Wq())||void 0===I||!I.useRightHandedSystem)return;const w=c.TmpVectors.dI[0],t=c.TmpVectors.Quaternion[0],O=c.TmpVectors.dI[1];this._textureMatrix.decompose(w,t,O),t.z*=-1,t.w*=-1,c.Matrix.ComposeToRef(w,t,O,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var q;return null!==(q=this.Wq())&&void 0!==q&&q.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=this.Wq(),w=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const t=()=>{var I;(this.onLoadObservable.notifyObservers(this),w)&&(w.dispose(),null===(I=this.Wq())||void 0===I||I.markAllMaterialsAsDirty(1));q&&q()},c=(q,l)=>{this._loadingError=!0,this._errorObject={message:q,exception:l},I&&I(q,l),F.d.OnTextureLoadErrorObservable.notifyObservers(this)};var a;this._texture?this._texture.isReady?O.Tools.SetImmediate((()=>t())):this._texture.onLoadedObservable.add((()=>t())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,l,this._lodScale,this._lodOffset,q,c,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,l,this._files,this._noMipmap,q,c,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(a=this._texture)||void 0===a||a.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(q,I,l){const w=r.c.Parse((()=>{let w=!1;return q.prefiltered&&(w=q.prefiltered),new x(l+(q.url??q.name),I,q.extensions,!1,q.files||null,null,null,void 0,w,q.forcedExtension)}),q,I);if(q.boundingBoxPosition&&(w.boundingBoxPosition=c.dI.vI(q.boundingBoxPosition)),q.boundingBoxSize&&(w.boundingBoxSize=c.dI.vI(q.boundingBoxSize)),q.animations)for(let t=0;t<q.animations.length;t++){const I=q.animations[t],l=(0,s.b)("BABYLON.Animation");l&&w.animations.push(l.Parse(I))}return w}clone(){let q=0;const I=r.c.Clone((()=>{const I=new x(this.url,this.Wq()||this._getEngine(),this._extensions,this._noMipmap,this._files);return q=I.uniqueId,I}),this);return I.uniqueId=q,I}}(0,w.d)([(0,t.D)()],x.prototype,"url",void 0),(0,w.d)([(0,t.C)()],x.prototype,"boundingBoxPosition",void 0),(0,w.d)([(0,t.C)()],x.prototype,"boundingBoxSize",null),(0,w.d)([(0,t.D)("rotationY")],x.prototype,"rotationY",null),(0,w.d)([(0,t.D)("files")],x.prototype,"_files",void 0),(0,w.d)([(0,t.D)("forcedExtension")],x.prototype,"_forcedExtension",void 0),(0,w.d)([(0,t.D)("extensions")],x.prototype,"_extensions",void 0),(0,w.d)([(0,t.t)("textureMatrix")],x.prototype,"_textureMatrix",void 0),(0,w.d)([(0,t.t)("textureMatrixRefraction")],x.prototype,"_textureMatrixRefraction",void 0),F.d._CubeTextureParser=x.Parse,(0,s.e)("BABYLON.CubeTexture",x)},14932:(q,I,l)=>{"use strict";l.d(I,{d:()=>F});var w=l(12591),t=l(12733),O=l(12720),c=l(12877),a=l(12687);c.ThinEngine.prototype.createDynamicTexture=function(q,I,l,w){const t=new a.b(this,4);return t.baseWidth=q,t.baseHeight=I,l&&(q=this.needPOTTextures?(0,O.f)(q,this._caps.maxTextureSize):q,I=this.needPOTTextures?(0,O.f)(I,this._caps.maxTextureSize):I),t.width=q,t.height=I,t.isReady=!1,t.generateMipMaps=l,t.samplingMode=w,this.updateTextureSamplingMode(w,t),this._internalTexturesCache.push(t),t},c.ThinEngine.prototype.updateDynamicTexture=function(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!q)return;const c=this._gl,a=c.TEXTURE_2D,F=this._bindTextureDirectly(a,q,!0,O);this._unpackFlipY(void 0===l?q.invertY:l),w&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const s=this._getWebGLTextureType(q.type),Z=this._getInternalFormat(t||q.format),r=this._getRGBABufferInternalSizedFormat(q.type,Z);c.texImage2D(a,0,r,Z,s,I),q.generateMipMaps&&c.generateMipmap(a),F||this._bindTextureDirectly(a,null),w&&c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),t&&(q.format=t),q._dynamicTextureSource=I,q._premulAlpha=w,q.invertY=l||!1,q.isReady=!0};class F extends t.d{constructor(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,a=arguments.length>6?arguments[6]:void 0;const F=!l||l._isScene;super(null,F?l:null===l||void 0===l?void 0:l.VI,F?!w:l,a,O,void 0,void 0,void 0,void 0,c),this.name=q,this.wrapU=t.d.CLAMP_ADDRESSMODE,this.wrapV=t.d.CLAMP_ADDRESSMODE,this._generateMipMaps=w;const s=this._getEngine();if(!s)return;if(I.getContext)this._canvas=I,this._ownCanvas=!1,this._texture=s.createDynamicTexture(this._canvas.width,this._canvas.height,w,O);else{this._canvas=s.createCanvas(1,1),this._ownCanvas=!0;const q=I;q.width||0===q.width?this._texture=s.createDynamicTexture(q.width,q.height,w,O):this._texture=s.createDynamicTexture(I,I,w,O)}const Z=this.getSize();this._canvas.width!==Z.width&&(this._canvas.width=Z.width),this._canvas.height!==Z.height&&(this._canvas.height=Z.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(q){this._canvas.width=q.width,this._canvas.height=q.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(q.width,q.height,this._generateMipMaps,this.samplingMode)}scale(q){const I=this.getSize();I.width*=q,I.height*=q,this._recreate(I)}scaleTo(q,I){const l=this.getSize();l.width=q,l.height=I,this._recreate(l)}getContext(){return this._context}clear(q){const I=this.getSize();q&&(this._context.fillStyle=q),this._context.clearRect(0,0,I.width,I.height)}update(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===q||q,I,this._format||void 0,void 0,l)}drawText(q,I,l,w,t,O,c){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const F=this.getSize();if(O&&(this._context.fillStyle=O,this._context.fillRect(0,0,F.width,F.height)),this._context.font=w,null===I||void 0===I){const l=this._context.measureText(q);I=(F.width-l.width)/2}if(null===l||void 0===l){const q=parseInt(w.replace(/\D/g,""));l=F.height/2+q/3.65}this._context.fillStyle=t||"",this._context.fillText(q,I,l),a&&this.update(c)}dispose(){var q,I;(super.dispose(),this._ownCanvas)&&(null===(q=this._canvas)||void 0===q||null===(I=q.remove)||void 0===I||I.call(q));this._canvas=null,this._context=null}clone(){const q=this.Wq();if(!q)return this;const I=this.getSize(),l=new F(this.name,I,q,this._generateMipMaps);return l.Bc=this.Bc,l.level=this.level,l.wrapU=this.wrapU,l.wrapV=this.wrapV,l}serialize(){const q=this.Wq();q&&!q.isReady()&&w.b.Warn("The scene must be ready before serializing the dynamic texture");const I=super.serialize();return F._IsCanvasElement(this._canvas)&&(I.base64String=this._canvas.toDataURL()),I.invertY=this._invertY,I.samplingMode=this.samplingMode,I}static _IsCanvasElement(q){return void 0!==q.toDataURL}_rebuild(){this.update()}}},14326:(q,I,l)=>{"use strict";l.d(I,{e:()=>t});var w=l(12733);class t extends w.d{get depth(){return this._depth}constructor(q,I,l,t,O,c){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:w.d.TRILINEAR_SAMPLINGMODE,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,r=arguments.length>10?arguments[10]:void 0;super(null,c,!a,F),this.format=O,this._texture=c.getEngine().createRawTexture2DArray(q,I,l,t,O,a,F,s,null,Z,r),this._depth=t,this.is2DArray=!0}update(q){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,q,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(q,I,l,w,O){return new t(q,I,l,w,5,O,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14130:(q,I,l)=>{"use strict";l.d(I,{c:()=>a,e:()=>F,f:()=>O,g:()=>c});var w=l(12761),t=l(12747);function O(q,I){return`{X: ${q.x.toFixed(I)} Y: ${q.y.toFixed(I)}}`}function c(q,I){return`{X: ${q._x.toFixed(I)} Y: ${q._y.toFixed(I)} Z: ${q._z.toFixed(I)}}`}function a(q,I){return 2*Math.acos((0,w.Clamp)(t.Quaternion.Dot(q,I)))}function F(q,I){const l=new t.Quaternion;return function(q,I,l){const O=t.dI.Cross(q,I),c=Math.acos((0,w.Clamp)(t.dI.Dot(q,I),-1,1));t.Quaternion.RotationAxisToRef(O,c,l)}(q,I,l),l}},13960:(q,I,l)=>{"use strict";l.d(I,{c:()=>s});var w=l(12747),t=l(12789),O=l(13184),c=l(13175),a=l(12802);l(13967);function F(q){let I=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const l=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],O=[];let F=[];const s=q.width||q.size||1,Z=q.height||q.size||1,r=q.depth||q.size||1,x=q.wrap||!1;let o=void 0===q.topBaseAt?1:q.topBaseAt,d=void 0===q.bottomBaseAt?0:q.bottomBaseAt;o=(o+4)%4,d=(d+4)%4;let T=[2,0,3,1][o],V=[2,0,1,3][d],U=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(x){I=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],U=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let q=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],l=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const w=[17,18,19,16],t=[22,23,20,21];for(;T>0;)q.unshift(q.pop()),w.unshift(w.pop()),T--;for(;V>0;)l.unshift(l.pop()),t.unshift(t.pop()),V--;q=q.flat(),l=l.flat(),U=U.concat(q).concat(l),I.push(w[0],w[2],w[3],w[0],w[1],w[2]),I.push(t[0],t[2],t[3],t[0],t[1],t[2])}const B=[s/2,Z/2,r/2];F=U.reduce(((q,I,l)=>q.concat(I*B[l%3])),[]);const v=0===q.sideOrientation?0:q.sideOrientation||c.e.DEFAULTSIDE,k=q.faceUV||new Array(6),C=q.faceColors,R=[];for(let c=0;c<6;c++)void 0===k[c]&&(k[c]=new w.Vector4(0,0,1,1)),C&&void 0===C[c]&&(C[c]=new t.Dc(1,1,1,1));for(let w=0;w<6;w++)if(O.push(k[w].z,a.b?1-k[w].w:k[w].w),O.push(k[w].x,a.b?1-k[w].w:k[w].w),O.push(k[w].x,a.b?1-k[w].y:k[w].y),O.push(k[w].z,a.b?1-k[w].y:k[w].y),C)for(let q=0;q<4;q++)R.push(C[w].r,C[w].g,C[w].b,C[w].a);c.e._ComputeSides(v,F,I,l,O,q.frontUVs,q.backUVs);const W=new c.e;if(W.indices=I,W.iq=F,W.Sq=l,W.pq=O,C){const q=v===c.e.DOUBLESIDE?R.concat(R):R;W.gq=q}return W}function s(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new O.c(q,l);I.sideOrientation=O.c._GetDefaultSideOrientation(I.sideOrientation),w._originalBuilderSideOrientation=I.sideOrientation;return F(I).Kq(w,I.updatable),w}c.e.CreateBox=F,O.c.CreateBox=function(q,I){return s(q,{size:I,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14121:(q,I,l)=>{"use strict";l.d(I,{d:()=>a});var w=l(13184),t=l(13175),O=l(12802);function c(q){const I=[],l=[],w=[],c=[],a=q.radius||.5,F=q.tessellation||64,s=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,Z=0===q.sideOrientation?0:q.sideOrientation||t.e.DEFAULTSIDE;I.push(0,0,0),c.push(.5,.5);const r=2*Math.PI*s,x=1===s?r/F:r/(F-1);let o=0;for(let t=0;t<F;t++){const q=Math.cos(o),l=Math.sin(o),w=(q+1)/2,t=(1-l)/2;I.push(a*q,a*l,0),c.push(w,O.b?1-t:t),o+=x}1===s&&(I.push(I[3],I[4],I[5]),c.push(c[2],O.b?1-c[3]:c[3]));const d=I.length/3;for(let t=1;t<d-1;t++)l.push(t+1,0,t);t.e.ComputeNormals(I,l,w),t.e._ComputeSides(Z,I,l,w,c,q.frontUVs,q.backUVs);const T=new t.e;return T.indices=l,T.iq=I,T.Sq=w,T.pq=c,T}function a(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new w.c(q,l);I.sideOrientation=w.c._GetDefaultSideOrientation(I.sideOrientation),t._originalBuilderSideOrientation=I.sideOrientation;return c(I).Kq(t,I.updatable),t}t.e.CreateDisc=c,w.c.CreateDisc=function(q,I,l){return a(q,{radius:I,tessellation:l,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13967:(q,I,l)=>{"use strict";l.d(I,{g:()=>V,c:()=>B,k:()=>U});var w=l(12747),t=l(12789),O=l(13184),c=l(13175),a=l(12821);O.c._GroundMeshParser=(q,I)=>F.Parse(q,I);class F extends O.c{constructor(q,I){super(q,I),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=q,this._subdivisionsY=q,this.subdivide(q);const l=this;l.createOrUpdateSubmeshesOctree&&l.createOrUpdateSubmeshesOctree(I)}getHeightAtCoordinates(q,I){const l=this.getWorldMatrix(),t=w.TmpVectors.Matrix[5];l.invertToRef(t);const O=w.TmpVectors.dI[8];if(w.dI.TransformCoordinatesFromFloatsToRef(q,0,I,t,O),q=O.x,I=O.z,q<this._minX||q>=this._maxX||I<=this._minZ||I>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const c=this._getFacetAt(q,I),a=-(c.x*q+c.z*I+c.w)/c.y;return w.dI.TransformCoordinatesFromFloatsToRef(0,a,0,l,O),O.y}getNormalAtCoordinates(q,I){const l=new w.dI(0,1,0);return this.getNormalAtCoordinatesToRef(q,I,l),l}getNormalAtCoordinatesToRef(q,I,l){const t=this.getWorldMatrix(),O=w.TmpVectors.Matrix[5];t.invertToRef(O);const c=w.TmpVectors.dI[8];if(w.dI.TransformCoordinatesFromFloatsToRef(q,0,I,O,c),q=c.x,I=c.z,q<this._minX||q>this._maxX||I<this._minZ||I>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(q,I);return w.dI.TransformNormalFromFloatsToRef(a.x,a.y,a.z,t,l),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(q,I){const l=Math.floor((q+this._maxX)*this._subdivisionsX/this._width),w=Math.floor(-(I+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),t=this._heightQuads[w*this._subdivisionsX+l];let O;return O=I<t.slope.x*q+t.slope.y?t.facet1:t.facet2,O}_initHeightQuads(){const q=this._subdivisionsX,I=this._subdivisionsY;this._heightQuads=[];for(let l=0;l<I;l++)for(let I=0;I<q;I++){const t={slope:w.Vector2.Zero(),facet1:new w.Vector4(0,0,0,0),facet2:new w.Vector4(0,0,0,0)};this._heightQuads[l*q+I]=t}return this}_computeHeightQuads(){const q=this.getVerticesData(a.c.PositionKind);if(!q)return this;const I=w.TmpVectors.dI[3],l=w.TmpVectors.dI[2],t=w.TmpVectors.dI[1],O=w.TmpVectors.dI[0],c=w.TmpVectors.dI[4],F=w.TmpVectors.dI[5],s=w.TmpVectors.dI[6],Z=w.TmpVectors.dI[7],r=w.TmpVectors.dI[8];let x=0,o=0,d=0,T=0,V=0,U=0,B=0;const v=this._subdivisionsX,k=this._subdivisionsY;for(let a=0;a<k;a++)for(let k=0;k<v;k++){x=3*k,o=a*(v+1)*3,d=(a+1)*(v+1)*3,I.x=q[o+x],I.y=q[o+x+1],I.z=q[o+x+2],l.x=q[o+x+3],l.y=q[o+x+4],l.z=q[o+x+5],t.x=q[d+x],t.y=q[d+x+1],t.z=q[d+x+2],O.x=q[d+x+3],O.y=q[d+x+4],O.z=q[d+x+5],T=(O.z-I.z)/(O.x-I.x),V=I.z-T*I.x,l.subtractToRef(I,c),t.subtractToRef(I,F),O.subtractToRef(I,s),w.dI.CrossToRef(s,F,Z),w.dI.CrossToRef(c,s,r),Z.normalize(),r.normalize(),U=-(Z.x*I.x+Z.y*I.y+Z.z*I.z),B=-(r.x*l.x+r.y*l.y+r.z*l.z);const C=this._heightQuads[a*v+k];C.slope.gc(T,V),C.facet1.gc(Z.x,Z.y,Z.z,U),C.facet2.gc(r.x,r.y,r.z,B)}return this}serialize(q){super.serialize(q),q.subdivisionsX=this._subdivisionsX,q.subdivisionsY=this._subdivisionsY,q.minX=this._minX,q.maxX=this._maxX,q.vc=this._minZ,q.maxZ=this._maxZ,q.width=this._width,q.height=this._height}static Parse(q,I){const l=new F(q.name,I);return l._subdivisionsX=q.subdivisionsX||1,l._subdivisionsY=q.subdivisionsY||1,l._minX=q.minX,l._maxX=q.maxX,l._minZ=q.vc,l._maxZ=q.maxZ,l._width=q.width,l._height=q.height,l}}var s=l(12564),Z=l(12612),r=l(12752),x=l(12802);function o(q){const I=[],l=[],t=[],O=[];let a,F;const s=q.width||q.size||1,Z=q.height||q.size||1,r=0|(q.subdivisionsX||q.subdivisions||1),o=0|(q.subdivisionsY||q.subdivisions||1);for(a=0;a<=o;a++)for(F=0;F<=r;F++){const q=new w.dI(F*s/r-s/2,0,(o-a)*Z/o-Z/2),I=new w.dI(0,1,0);l.push(q.x,q.y,q.z),t.push(I.x,I.y,I.z),O.push(F/r,x.b?a/o:1-a/o)}for(a=0;a<o;a++)for(F=0;F<r;F++)I.push(F+1+(a+1)*(r+1)),I.push(F+1+a*(r+1)),I.push(F+a*(r+1)),I.push(F+(a+1)*(r+1)),I.push(F+1+(a+1)*(r+1)),I.push(F+a*(r+1));const d=new c.e;return d.indices=I,d.iq=l,d.Sq=t,d.pq=O,d}function d(q){const I=void 0!==q.xmin&&null!==q.xmin?q.xmin:-1,l=void 0!==q.zmin&&null!==q.zmin?q.zmin:-1,t=void 0!==q.xmax&&null!==q.xmax?q.xmax:1,O=void 0!==q.zmax&&null!==q.zmax?q.zmax:1,a=q.subdivisions||{w:1,h:1},F=q.precision||{w:1,h:1},s=[],Z=[],r=[],x=[];let o,d,T,V;a.h=a.h<1?1:a.h,a.w=a.w<1?1:a.w,F.w=F.w<1?1:F.w,F.h=F.h<1?1:F.h;const U=(t-I)/a.w,B=(O-l)/a.h;function v(q,I,l,t){const O=Z.length/3,c=F.w+1;for(o=0;o<F.h;o++)for(d=0;d<F.w;d++){const q=[O+d+o*c,O+(d+1)+o*c,O+(d+1)+(o+1)*c,O+d+(o+1)*c];s.push(q[1]),s.push(q[2]),s.push(q[3]),s.push(q[0]),s.push(q[1]),s.push(q[3])}const a=w.dI.Zero(),T=new w.dI(0,1,0);for(o=0;o<=F.h;o++)for(a.z=o*(t-I)/F.h+I,d=0;d<=F.w;d++)a.x=d*(l-q)/F.w+q,a.y=0,Z.push(a.x,a.y,a.z),r.push(T.x,T.y,T.z),x.push(d/F.w,o/F.h)}for(T=0;T<a.h;T++)for(V=0;V<a.w;V++)v(I+V*U,l+T*B,I+(V+1)*U,l+(T+1)*B);const k=new c.e;return k.indices=s,k.iq=Z,k.Sq=r,k.pq=x,k}function T(q){const I=[],l=[],O=[],a=[];let F,s;const Z=q.colorFilter||new t.BI(.3,.59,.11),x=q.alphaFilter||0;let o=!1;if(q.minHeight>q.maxHeight){o=!0;const I=q.maxHeight;q.maxHeight=q.minHeight,q.minHeight=I}for(F=0;F<=q.subdivisions;F++)for(s=0;s<=q.subdivisions;s++){const I=new w.dI(s*q.width/q.subdivisions-q.width/2,0,(q.subdivisions-F)*q.height/q.subdivisions-q.height/2),t=4*(((I.x+q.width/2)/q.width*(q.bufferWidth-1)|0)+((1-(I.z+q.height/2)/q.height)*(q.bufferHeight-1)|0)*q.bufferWidth);let c=q.buffer[t]/255,d=q.buffer[t+1]/255,T=q.buffer[t+2]/255;const V=q.buffer[t+3]/255;o&&(c=1-c,d=1-d,T=1-T);const U=c*Z.r+d*Z.g+T*Z.b;I.y=V>=x?q.minHeight+(q.maxHeight-q.minHeight)*U:q.minHeight-r.d,q.heightBuffer&&(q.heightBuffer[F*(q.subdivisions+1)+s]=I.y),l.push(I.x,I.y,I.z),O.push(0,0,0),a.push(s/q.subdivisions,1-F/q.subdivisions)}for(F=0;F<q.subdivisions;F++)for(s=0;s<q.subdivisions;s++){const w=s+1+(F+1)*(q.subdivisions+1),t=s+1+F*(q.subdivisions+1),O=s+F*(q.subdivisions+1),c=s+(F+1)*(q.subdivisions+1),a=l[3*w+1]>=q.minHeight,Z=l[3*t+1]>=q.minHeight,r=l[3*O+1]>=q.minHeight;a&&Z&&r&&(I.push(w),I.push(t),I.push(O));l[3*c+1]>=q.minHeight&&a&&r&&(I.push(c),I.push(w),I.push(O))}c.e.ComputeNormals(l,I,O);const d=new c.e;return d.indices=I,d.iq=l,d.Sq=O,d.pq=a,d}function V(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=new F(q,arguments.length>2?arguments[2]:void 0);l._setReady(!1),l._subdivisionsX=I.subdivisionsX||I.subdivisions||1,l._subdivisionsY=I.subdivisionsY||I.subdivisions||1,l._width=I.width||1,l._height=I.height||1,l._maxX=l._width/2,l._maxZ=l._height/2,l._minX=-l._maxX,l._minZ=-l._maxZ;return o(I).Kq(l,I.updatable),l._setReady(!0),l}function U(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new O.c(q,l);return d(I).Kq(w,I.updatable),w}function B(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const O=l.width||10,c=l.height||10,a=l.subdivisions||1,r=l.minHeight||0,x=l.maxHeight||1,o=l.colorFilter||new t.BI(.3,.59,.11),d=l.alphaFilter||0,V=l.updatable,U=l.onReady;w=w||Z.e.LastCreatedScene;const B=new F(q,w);let v;B._subdivisionsX=a,B._subdivisionsY=a,B._width=O,B._height=c,B._maxX=B._width/2,B._maxZ=B._height/2,B._minX=-B._maxX,B._minZ=-B._maxZ,B._setReady(!1),l.passHeightBufferInCallback&&(v=new Float32Array((a+1)*(a+1)));const k=(q,I,l)=>{T({width:O,height:c,subdivisions:a,minHeight:r,maxHeight:x,colorFilter:o,buffer:q,bufferWidth:I,bufferHeight:l,alphaFilter:d,heightBuffer:v}).Kq(B,V),U&&U(B,v),B._setReady(!0)};if("string"===typeof I){const q=q=>{var I;const l=q.width,t=q.height;if(w.Z)return;const O=null===(I=w)||void 0===I?void 0:I.getEngine().resizeImageBitmap(q,l,t);k(O,l,t)};s.Tools.LoadImage(I,q,l.onError?l.onError:()=>{},w.offlineProvider)}else k(I.data,I.width,I.height);return B}c.e.CreateGround=o,c.e.CreateTiledGround=d,c.e.CreateGroundFromHeightMap=T,O.c.CreateGround=(q,I,l,w,t,O)=>V(q,{width:I,height:l,subdivisions:w,updatable:O},t),O.c.CreateTiledGround=(q,I,l,w,t,O,c,a,F)=>U(q,{xmin:I,zmin:l,xmax:w,zmax:t,subdivisions:O,precision:c,updatable:F},a),O.c.CreateGroundFromHeightMap=(q,I,l,w,t,O,c,a,F,s,Z)=>B(q,I,{width:l,height:w,subdivisions:t,minHeight:O,maxHeight:c,updatable:F,onReady:s,alphaFilter:Z},a)},14644:(q,I,l)=>{"use strict";l.d(I,{c:()=>o,f:()=>r,g:()=>x});var w=l(12747),t=l(13184),O=l(13175),c=l(13263),a=l(12821),F=l(12591);function s(q){const I=[],l=[],w=q.lines,t=q.gq,c=[];let a=0;for(let O=0;O<w.length;O++){const q=w[O];for(let w=0;w<q.length;w++){const{x:F,y:s,z:Z}=q[w];if(l.push(F,s,Z),t){const q=t[O],{r:I,g:l,b:a,a:F}=q[w];c.push(I,l,a,F)}w>0&&(I.push(a-1),I.push(a)),a++}}const F=new O.e;return F.indices=I,F.iq=l,t&&(F.gq=c),F}function Z(q){const I=q.dashSize||3,l=q.gapSize||1,t=q.dashNb||200,c=q.points,a=[],F=[],s=w.dI.Zero();let Z=0,r=0,x=0,o=0,d=0,T=0,V=0;for(V=0;V<c.length-1;V++)c[V+1].subtractToRef(c[V],s),Z+=s.length();for(x=Z/t,o=I*x/(I+l),V=0;V<c.length-1;V++){c[V+1].subtractToRef(c[V],s),r=Math.floor(s.length()/x),s.normalize();for(let q=0;q<r;q++)d=x*q,a.push(c[V].x+d*s.x,c[V].y+d*s.y,c[V].z+d*s.z),a.push(c[V].x+(d+o)*s.x,c[V].y+(d+o)*s.y,c[V].z+(d+o)*s.z),F.push(T,T+1),T+=2}const U=new O.e;return U.iq=a,U.indices=F,U}function r(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=I.instance,t=I.lines,O=I.gq;if(w){const q=w.getVerticesData(a.c.PositionKind);let I,l;O&&(I=w.getVerticesData(a.c.ColorKind));let c=0,F=0;for(let w=0;w<t.length;w++){const a=t[w];for(let t=0;t<a.length;t++)q[c]=a[t].x,q[c+1]=a[t].y,q[c+2]=a[t].z,O&&I&&(l=O[w],I[F]=l[t].r,I[F+1]=l[t].g,I[F+2]=l[t].b,I[F+3]=l[t].a,F+=4),c+=3}return w.updateVerticesData(a.c.PositionKind,q,!1,!1),O&&I&&w.updateVerticesData(a.c.ColorKind,I,!1,!1),w.refreshBoundingInfo(),w}const F=!!O,Z=new c.d(q,l,null,void 0,void 0,F,I.useVertexAlpha,I.material);return s(I).Kq(Z,I.updatable),Z}function x(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=I.gq?[I.gq]:null;return r(q,{lines:[I.points],updatable:I.updatable,instance:I.instance,gq:w,useVertexAlpha:I.useVertexAlpha,material:I.material},l)}function o(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=I.points,a=I.instance,s=I.gapSize||1,r=I.dashSize||3;if(a){const q=q=>{const I=w.dI.Zero(),l=q.length/6;let t=0,c=0,F=0,s=0,Z=0,r=0,x=0,o=0;for(x=0;x<O.length-1;x++)O[x+1].subtractToRef(O[x],I),t+=I.length();F=t/l;const d=a._creationDataStorage.dashSize;for(s=d*F/(d+a._creationDataStorage.gapSize),x=0;x<O.length-1;x++)for(O[x+1].subtractToRef(O[x],I),c=Math.floor(I.length()/F),I.normalize(),o=0;o<c&&r<q.length;)Z=F*o,q[r]=O[x].x+Z*I.x,q[r+1]=O[x].y+Z*I.y,q[r+2]=O[x].z+Z*I.z,q[r+3]=O[x].x+(Z+s)*I.x,q[r+4]=O[x].y+(Z+s)*I.y,q[r+5]=O[x].z+(Z+s)*I.z,r+=6,o++;for(;r<q.length;)q[r]=O[x].x,q[r+1]=O[x].y,q[r+2]=O[x].z,r+=3};return(I.dashNb||I.dashSize||I.gapSize||I.useVertexAlpha||I.material)&&F.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),a.updateMeshPositions(q,!1),a}const x=new c.d(q,l,null,void 0,void 0,void 0,I.useVertexAlpha,I.material);return Z(I).Kq(x,I.updatable),x._creationDataStorage=new t.e,x._creationDataStorage.dashSize=r,x._creationDataStorage.gapSize=s,x}O.e.CreateLineSystem=s,O.e.CreateDashedLines=Z,t.c.Ys=function(q,I){return x(q,{points:I,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},t.c.CreateDashedLines=function(q,I,l,w,t){return o(q,{points:I,dashSize:l,gapSize:w,dashNb:t,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},14017:(q,I,l)=>{"use strict";l.d(I,{e:()=>a,h:()=>F});var w=l(13184),t=l(13175),O=l(12802);function c(q){const I=[],l=[],w=[],c=[],a=void 0!==q.width?q.width:void 0!==q.size?q.size:1,F=void 0!==q.height?q.height:void 0!==q.size?q.size:1,s=0===q.sideOrientation?0:q.sideOrientation||t.e.DEFAULTSIDE,Z=a/2,r=F/2;l.push(-Z,-r,0),w.push(0,0,-1),c.push(0,O.b?1:0),l.push(Z,-r,0),w.push(0,0,-1),c.push(1,O.b?1:0),l.push(Z,r,0),w.push(0,0,-1),c.push(1,O.b?0:1),l.push(-Z,r,0),w.push(0,0,-1),c.push(0,O.b?0:1),I.push(0),I.push(1),I.push(2),I.push(0),I.push(2),I.push(3),t.e._ComputeSides(s,l,I,w,c,q.frontUVs,q.backUVs);const x=new t.e;return x.indices=I,x.iq=l,x.Sq=w,x.pq=c,x}function a(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new w.c(q,l);I.sideOrientation=w.c._GetDefaultSideOrientation(I.sideOrientation),t._originalBuilderSideOrientation=I.sideOrientation;return c(I).Kq(t,I.updatable),I.sourcePlane&&(t.translate(I.sourcePlane.normal,-I.sourcePlane.d),t.setDirection(I.sourcePlane.normal.scale(-1))),t}const F={Ns:a};t.e.Ns=c,w.c.Ns=(q,I,l,w,t)=>a(q,{size:I,width:I,height:I,sideOrientation:t,updatable:w},l)},14108:(q,I,l)=>{"use strict";l.d(I,{e:()=>F});var w=l(12747),t=l(13184),O=l(13175),c=l(12802);function a(q){const I=0|(q.segments||32),l=q.diameterX||q.diameter||1,t=q.diameterY||q.diameter||1,a=q.diameterZ||q.diameter||1,F=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,s=q.slice&&q.slice<=0?1:q.slice||1,Z=0===q.sideOrientation?0:q.sideOrientation||O.e.DEFAULTSIDE,r=!!q.dedupTopBottomIndices,x=new w.dI(l/2,t/2,a/2),o=2+I,d=2*o,T=[],V=[],U=[],B=[];for(let O=0;O<=o;O++){const q=O/o,I=q*Math.PI*s;for(let l=0;l<=d;l++){const t=l/d,O=t*Math.PI*2*F,a=w.Matrix.RotationZ(-I),s=w.Matrix.RotationY(O),Z=w.dI.TransformCoordinates(w.dI.Up(),a),r=w.dI.TransformCoordinates(Z,s),o=r.multiply(x),T=r.divide(x).normalize();V.push(o.x,o.y,o.z),U.push(T.x,T.y,T.z),B.push(t,c.b?1-q:q)}if(O>0){const q=V.length/3;for(let I=q-2*(d+1);I+d+2<q;I++)r?(O>1&&(T.push(I),T.push(I+1),T.push(I+d+1)),(O<o||s<1)&&(T.push(I+d+1),T.push(I+1),T.push(I+d+2))):(T.push(I),T.push(I+1),T.push(I+d+1),T.push(I+d+1),T.push(I+1),T.push(I+d+2))}}O.e._ComputeSides(Z,V,T,U,B,q.frontUVs,q.backUVs);const v=new O.e;return v.indices=T,v.iq=V,v.Sq=U,v.pq=B,v}function F(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new t.c(q,l);I.sideOrientation=t.c._GetDefaultSideOrientation(I.sideOrientation),w._originalBuilderSideOrientation=I.sideOrientation;return a(I).Kq(w,I.updatable),w}O.e.CreateSphere=a,t.c.CreateSphere=(q,I,l,w,t,O)=>F(q,{segments:I,diameterX:l,diameterY:l,diameterZ:l,sideOrientation:O,updatable:t},w)},14941:(q,I,l)=>{"use strict";l.d(I,{b:()=>a});var w=l(13283),t=l(14414),O=l(13293),c=l(13175);class a{static get Configuration(){return{get decoder(){return t.b.DefaultConfiguration},set decoder(q){t.b.DefaultConfiguration=q}}}static set Configuration(q){t.b.DefaultConfiguration=q.decoder}static get DecoderAvailable(){return(0,w.g)(t.b.DefaultConfiguration)}static get Default(){return a._Default??(a._Default=new a),a._Default}static ResetDefault(q){a._Default&&(q||a._Default.dispose(),a._Default=null)}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.DefaultNumWorkers;const I="number"===typeof q?{...t.b.DefaultConfiguration,numWorkers:q}:{...t.b.DefaultConfiguration,...q};this._decoder=new t.b(I)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(q,I,l){return this._decoder.decodeMeshToMeshDataAsync(q,I,l)}async decodeMeshToGeometryAsync(q,I,l,w){return await this._decoder.decodeMeshToGeometryAsync(q,I,l,w)}async _decodeMeshToGeometryForGltfAsync(q,I,l,w,t,O){return await this._decoder._decodeMeshToGeometryForGltfAsync(q,I,l,w,t,O)}async decodeMeshAsync(q,I){const l=await this._decoder.decodeMeshToMeshDataAsync(q,I),w=new c.e;l.indices&&(w.indices=l.indices);for(const t of l.attributes){const q=O.c.GetFloatData(t.data,t.size,O.c.GetDataType(t.data),t.byteOffset,t.byteStride,t.normalized,l.totalVertices);w.set(q,t.kind)}return w}}a.DefaultNumWorkers=(0,w.d)(),a._Default=null},14414:(q,I,l)=>{"use strict";l.d(I,{b:()=>s});var w=l(13283),t=l(12564),O=l(13194),c=l(13293),a=l(12591),F=l(13290);class s extends w.b{static get DefaultAvailable(){return(0,w.g)(s.DefaultConfiguration)}static get Default(){return s._Default??(s._Default=new s),s._Default}static ResetDefault(q){s._Default&&(q||s._Default.dispose(),s._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(q,I){return{module:await(I||DracoDecoderModule)({wasmBinary:q})}}_getWorkerContent(){return`${F.c}(${F.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultConfiguration)}decodeMeshToMeshDataAsync(q,I,l){const w=q instanceof ArrayBuffer?new Int8Array(q):new Int8Array(q.buffer,q.byteOffset,q.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async q=>await new Promise(((t,O)=>{q.push(((q,c)=>{let F=null;const s=[],Z=I=>{q.removeEventListener("error",Z),q.removeEventListener("message",r),O(I),c()},r=I=>{const w=I.data;switch(w.id){case"indices":F=w.data;break;case"attribute":s.push({kind:w.kind,data:w.data,size:w.size,byteOffset:w.byteOffset,byteStride:w.byteStride,normalized:(O=w.kind,x=w.normalized,l&&void 0!==l[O]?(x!==l[O]&&a.b.Warn(`Normalized flag from Draco data (${x}) does not match normalized flag from glTF accessor (${l[O]}). Using flag from glTF accessor.`),l[O]):x)});break;case"decodeMeshDone":q.removeEventListener("error",Z),q.removeEventListener("message",r),t({indices:F,attributes:s,totalVertices:w.totalVertices}),c()}var O,x};q.addEventListener("error",Z),q.addEventListener("message",r);const x=w.slice();q.postMessage({id:"decodeMesh",dataView:x,attributes:I},[x.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((q=>{let l=null;const t=[],O=(0,F.c)(q.module,w,I,(q=>{l=q}),((q,I,l,w,O,c)=>{t.push({kind:q,data:I,size:l,byteOffset:w,byteStride:O,normalized:c})}));return{indices:l,attributes:t,totalVertices:O}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(q,I,l,w){const t=await this.decodeMeshToMeshDataAsync(l,w),a=new O.c(q,I);t.indices&&a.setIndices(t.indices);for(const O of t.attributes)a.setVerticesBuffer(new c.c(I.getEngine(),O.data,O.kind,!1,void 0,O.byteStride,void 0,O.byteOffset,O.size,void 0,O.normalized,!0),t.totalVertices);return a}async _decodeMeshToGeometryForGltfAsync(q,I,l,w,t,a){const F=await this.decodeMeshToMeshDataAsync(l,w,t),s=new O.c(q,I);a&&(s._boundingInfo=a,s.useBoundingInfoFromGeometry=!0),F.indices&&s.setIndices(F.indices);for(const O of F.attributes)s.setVerticesBuffer(new c.c(I.getEngine(),O.data,O.kind,!1,void 0,O.byteStride,void 0,O.byteOffset,O.size,void 0,O.normalized,!0),F.totalVertices);return s}}s.DefaultConfiguration={wasmUrl:`${t.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${t.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${t.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},s._Default=null},14640:(q,I,l)=>{"use strict";l.d(I,{c:()=>aq});var w=l(12747),t=l(13184),O=l(12821),c=l(13175),a=l(12802);function F(q){let I=q.pathArray;const l=q.closeArray||!1,w=q.closePath||!1,t=q.invertUV||!1,F=Math.floor(I[0].length/2);let s=q.offset||F;s=s>F?F:Math.floor(s);const Z=0===q.sideOrientation?0:q.sideOrientation||c.e.DEFAULTSIDE,r=q.pq,x=q.gq,o=[],d=[],T=[],V=[],U=[],B=[],v=[],k=[];let C;const R=[],W=[];let e,i,S;if(I.length<2){const q=[],l=[];for(i=0;i<I[0].length-s;i++)q.push(I[0][i]),l.push(I[0][i+s]);I=[q,l]}let g=0;const p=w?1:0,X=l?1:0;let K,D,M,n,f,L;for(C=I[0].length,e=0;e<I.length+X;e++){for(v[e]=0,U[e]=[0],K=e===I.length?I[0]:I[e],D=K.length,C=C<D?C:D,S=0;S<D;)o.push(K[S].x,K[S].y,K[S].z),S>0&&(M=K[S].TI(K[S-1]).length(),n=M+v[e],U[e].push(n),v[e]=n),S++;w&&(S--,o.push(K[0].x,K[0].y,K[0].z),M=K[S].TI(K[0]).length(),n=M+v[e],U[e].push(n),v[e]=n),R[e]=D+p,W[e]=g,g+=D+p}let E,j,h=null,u=null;for(i=0;i<C+p;i++)for(k[i]=0,B[i]=[0],e=0;e<I.length-1+X;e++)f=I[e],L=e===I.length-1?I[0]:I[e+1],i===C?(h=f[0],u=L[0]):(h=f[i],u=L[i]),M=u.TI(h).length(),n=M+k[i],B[i].push(n),k[i]=n;if(r)for(e=0;e<r.length;e++)V.push(r[e].x,a.b?1-r[e].y:r[e].y);else for(e=0;e<I.length+X;e++)for(i=0;i<C+p;i++)E=0!=v[e]?U[e][i]/v[e]:0,j=0!=k[i]?B[i][e]/k[i]:0,t?V.push(j,E):V.push(E,a.b?1-j:j);e=0;let P=0,mq=R[e]-1,Y=R[e+1]-1,y=mq<Y?mq:Y,G=W[1]-W[0];const N=R.length-1;for(;P<=y&&e<N;)d.push(P,P+G,P+1),d.push(P+G+1,P+1,P+G),P+=1,P===y&&(e++,G=W[e+1]-W[e],mq=R[e]-1,Y=R[e+1]-1,P=W[e],y=mq<Y?mq+P:Y+P);if(c.e.ComputeNormals(o,d,T),w){let q=0,l=0;for(e=0;e<I.length;e++){q=3*W[e],l=e+1<I.length?3*(W[e+1]-1):T.length-3,T[q]=.5*(T[q]+T[l]),T[q+1]=.5*(T[q+1]+T[l+1]),T[q+2]=.5*(T[q+2]+T[l+2]);const w=Math.sqrt(T[q]*T[q]+T[q+1]*T[q+1]+T[q+2]*T[q+2]);T[q]/=w,T[q+1]/=w,T[q+2]/=w,T[l]=T[q],T[l+1]=T[q+1],T[l+2]=T[q+2]}}if(l){let q=3*W[0],l=3*W[I.length];for(i=0;i<C+p;i++){T[q]=.5*(T[q]+T[l]),T[q+1]=.5*(T[q+1]+T[l+1]),T[q+2]=.5*(T[q+2]+T[l+2]);const I=Math.sqrt(T[q]*T[q]+T[q+1]*T[q+1]+T[q+2]*T[q+2]);T[q]/=I,T[q+1]/=I,T[q+2]/=I,T[l]=T[q],T[l+1]=T[q+1],T[l+2]=T[q+2],q+=3,l+=3}}c.e._ComputeSides(Z,o,d,T,V,q.frontUVs,q.backUVs);let J=null;if(x){J=new Float32Array(4*x.length);for(let q=0;q<x.length;q++)J[4*q]=x[q].r,J[4*q+1]=x[q].g,J[4*q+2]=x[q].b,J[4*q+3]=x[q].a}const z=new c.e,H=new Float32Array(o),A=new Float32Array(T),Q=new Float32Array(V);return z.indices=d,z.iq=H,z.Sq=A,z.pq=Q,J&&z.set(J,O.c.ColorKind),w&&(z._idx=W),z}function s(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=I.pathArray,Z=I.closeArray,r=I.closePath,x=t.c._GetDefaultSideOrientation(I.sideOrientation),o=I.instance,d=I.updatable;if(o){const q=w.TmpVectors.dI[0].Kc(Number.MAX_VALUE),l=w.TmpVectors.dI[1].Kc(-Number.MAX_VALUE),F=I=>{let w=s[0].length;const O=o;let c=0;const a=O._originalBuilderSideOrientation===t.c.DOUBLESIDE?2:1;for(let t=1;t<=a;++t)for(let a=0;a<s.length;++a){const t=s[a],F=t.length;w=w<F?w:F;for(let O=0;O<w;++O){const w=t[O];I[c]=w.x,I[c+1]=w.y,I[c+2]=w.z,q.minimizeInPlaceFromFloats(w.x,w.y,w.z),l.maximizeInPlaceFromFloats(w.x,w.y,w.z),c+=3}if(O._creationDataStorage&&O._creationDataStorage.closePath){const q=t[0];I[c]=q.x,I[c+1]=q.y,I[c+2]=q.z,c+=3}}},Z=o.getVerticesData(O.c.PositionKind);if(F(Z),o.hasBoundingInfo?o.getBoundingInfo().reConstruct(q,l,o._worldMatrix):o.buildBoundingInfo(q,l,o._worldMatrix),o.updateVerticesData(O.c.PositionKind,Z,!1,!1),I.gq){const q=o.getVerticesData(O.c.ColorKind);for(let l=0,w=0;l<I.gq.length;l++,w+=4){const t=I.gq[l];q[w]=t.r,q[w+1]=t.g,q[w+2]=t.b,q[w+3]=t.a}o.updateVerticesData(O.c.ColorKind,q,!1,!1)}if(I.pq){const q=o.getVerticesData(O.c.UVKind);for(let l=0;l<I.pq.length;l++)q[2*l]=I.pq[l].x,q[2*l+1]=a.b?1-I.pq[l].y:I.pq[l].y;o.updateVerticesData(O.c.UVKind,q,!1,!1)}if(!o.areNormalsFrozen||o.isFacetDataEnabled){const q=o.ec(),I=o.getVerticesData(O.c.NormalKind),l=o.isFacetDataEnabled?o.getFacetDataParameters():null;if(c.e.ComputeNormals(Z,q,I,l),o._creationDataStorage&&o._creationDataStorage.closePath){let q=0,l=0;for(let w=0;w<s.length;w++)q=3*o._creationDataStorage.idx[w],l=w+1<s.length?3*(o._creationDataStorage.idx[w+1]-1):I.length-3,I[q]=.5*(I[q]+I[l]),I[q+1]=.5*(I[q+1]+I[l+1]),I[q+2]=.5*(I[q+2]+I[l+2]),I[l]=I[q],I[l+1]=I[q+1],I[l+2]=I[q+2]}o.areNormalsFrozen||o.updateVerticesData(O.c.NormalKind,I,!1,!1)}return o}{const w=new t.c(q,l);w._originalBuilderSideOrientation=x,w._creationDataStorage=new t.e;const O=F(I);return r&&(w._creationDataStorage.idx=O._idx),w._creationDataStorage.closePath=r,w._creationDataStorage.closeArray=Z,O.Kq(w,d),w}}c.e.CreateRibbon=F,t.c.CreateRibbon=function(q,I){return s(q,{pathArray:I,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var Z=l(14121),r=l(13960),x=l(12789);function o(q){const I=q.pattern||t.c.NO_FLIP,l=q.tileWidth||q.tileSize||1,w=q.tileHeight||q.tileSize||1,O=q.alignHorizontal||0,a=q.alignVertical||0,F=q.width||q.size||1,s=Math.floor(F/l);let Z=F-s*l;const r=q.height||q.size||1,x=Math.floor(r/w);let o=r-x*w;const d=l*s/2,T=w*x/2;let V=0,U=0,B=0,v=0,k=0,C=0;if(Z>0||o>0){switch(B=-d,v=-T,k=d,C=T,O){case t.c.CENTER:Z/=2,B-=Z,k+=Z;break;case t.c.LEFT:k+=Z,V=-Z/2;break;case t.c.RIGHT:B-=Z,V=Z/2}switch(a){case t.c.CENTER:o/=2,v-=o,C+=o;break;case t.c.BOTTOM:C+=o,U=-o/2;break;case t.c.TOP:v-=o,U=o/2}}const R=[],W=[],e=[];e[0]=[0,0,1,0,1,1,0,1],e[1]=[0,0,1,0,1,1,0,1],I!==t.c.ROTATE_TILE&&I!==t.c.ROTATE_ROW||(e[1]=[1,1,0,1,0,0,1,0]),I!==t.c.FLIP_TILE&&I!==t.c.FLIP_ROW||(e[1]=[1,0,0,0,0,1,1,1]),I!==t.c.FLIP_N_ROTATE_TILE&&I!==t.c.FLIP_N_ROTATE_ROW||(e[1]=[0,1,1,1,1,0,0,0]);let i=[];const S=[],g=[];let p=0;for(let c=0;c<x;c++)for(let q=0;q<s;q++)R.push(q*l-d+V,c*w-T+U,0),R.push((q+1)*l-d+V,c*w-T+U,0),R.push((q+1)*l-d+V,(c+1)*w-T+U,0),R.push(q*l-d+V,(c+1)*w-T+U,0),g.push(p,p+1,p+3,p+1,p+2,p+3),i=I===t.c.FLIP_TILE||I===t.c.ROTATE_TILE||I===t.c.FLIP_N_ROTATE_TILE?i.concat(e[(q%2+c%2)%2]):I===t.c.FLIP_ROW||I===t.c.ROTATE_ROW||I===t.c.FLIP_N_ROTATE_ROW?i.concat(e[c%2]):i.concat(e[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),p+=4;if(Z>0||o>0){const q=o>0&&(a===t.c.CENTER||a===t.c.TOP),c=o>0&&(a===t.c.CENTER||a===t.c.BOTTOM),F=Z>0&&(O===t.c.CENTER||O===t.c.RIGHT),r=Z>0&&(O===t.c.CENTER||O===t.c.LEFT);let e,X,K,D,M=[];if(q&&F&&(R.push(B+V,v+U,0),R.push(-d+V,v+U,0),R.push(-d+V,v+o+U,0),R.push(B+V,v+o+U,0),g.push(p,p+1,p+3,p+1,p+2,p+3),p+=4,e=1-Z/l,X=1-o/w,K=1,D=1,M=[e,X,K,X,K,D,e,D],I===t.c.ROTATE_ROW&&(M=[1-e,1-X,1-K,1-X,1-K,1-D,1-e,1-D]),I===t.c.FLIP_ROW&&(M=[1-e,X,1-K,X,1-K,D,1-e,D]),I===t.c.FLIP_N_ROTATE_ROW&&(M=[e,1-X,K,1-X,K,1-D,e,1-D]),i=i.concat(M),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&r&&(R.push(d+V,v+U,0),R.push(k+V,v+U,0),R.push(k+V,v+o+U,0),R.push(d+V,v+o+U,0),g.push(p,p+1,p+3,p+1,p+2,p+3),p+=4,e=0,X=1-o/w,K=Z/l,D=1,M=[e,X,K,X,K,D,e,D],(I===t.c.ROTATE_ROW||I===t.c.ROTATE_TILE&&s%2===0)&&(M=[1-e,1-X,1-K,1-X,1-K,1-D,1-e,1-D]),(I===t.c.FLIP_ROW||I===t.c.FLIP_TILE&&s%2===0)&&(M=[1-e,X,1-K,X,1-K,D,1-e,D]),(I===t.c.FLIP_N_ROTATE_ROW||I===t.c.FLIP_N_ROTATE_TILE&&s%2===0)&&(M=[e,1-X,K,1-X,K,1-D,e,1-D]),i=i.concat(M),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),c&&F&&(R.push(B+V,T+U,0),R.push(-d+V,T+U,0),R.push(-d+V,C+U,0),R.push(B+V,C+U,0),g.push(p,p+1,p+3,p+1,p+2,p+3),p+=4,e=1-Z/l,X=0,K=1,D=o/w,M=[e,X,K,X,K,D,e,D],(I===t.c.ROTATE_ROW&&x%2===1||I===t.c.ROTATE_TILE&&x%1===0)&&(M=[1-e,1-X,1-K,1-X,1-K,1-D,1-e,1-D]),(I===t.c.FLIP_ROW&&x%2===1||I===t.c.FLIP_TILE&&x%2===0)&&(M=[1-e,X,1-K,X,1-K,D,1-e,D]),(I===t.c.FLIP_N_ROTATE_ROW&&x%2===1||I===t.c.FLIP_N_ROTATE_TILE&&x%2===0)&&(M=[e,1-X,K,1-X,K,1-D,e,1-D]),i=i.concat(M),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),c&&r&&(R.push(d+V,T+U,0),R.push(k+V,T+U,0),R.push(k+V,C+U,0),R.push(d+V,C+U,0),g.push(p,p+1,p+3,p+1,p+2,p+3),p+=4,e=0,X=0,K=Z/l,D=o/w,M=[e,X,K,X,K,D,e,D],(I===t.c.ROTATE_ROW&&x%2===1||I===t.c.ROTATE_TILE&&(x+s)%2===1)&&(M=[1-e,1-X,1-K,1-X,1-K,1-D,1-e,1-D]),(I===t.c.FLIP_ROW&&x%2===1||I===t.c.FLIP_TILE&&(x+s)%2===1)&&(M=[1-e,X,1-K,X,1-K,D,1-e,D]),(I===t.c.FLIP_N_ROTATE_ROW&&x%2===1||I===t.c.FLIP_N_ROTATE_TILE&&(x+s)%2===1)&&(M=[e,1-X,K,1-X,K,1-D,e,1-D]),i=i.concat(M),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q){const q=[];e=0,X=1-o/w,K=1,D=1,q[0]=[e,X,K,X,K,D,e,D],q[1]=[e,X,K,X,K,D,e,D],I!==t.c.ROTATE_TILE&&I!==t.c.ROTATE_ROW||(q[1]=[1-e,1-X,1-K,1-X,1-K,1-D,1-e,1-D]),I!==t.c.FLIP_TILE&&I!==t.c.FLIP_ROW||(q[1]=[1-e,X,1-K,X,1-K,D,1-e,D]),I!==t.c.FLIP_N_ROTATE_TILE&&I!==t.c.FLIP_N_ROTATE_ROW||(q[1]=[e,1-X,K,1-X,K,1-D,e,1-D]);for(let w=0;w<s;w++)R.push(w*l-d+V,v+U,0),R.push((w+1)*l-d+V,v+U,0),R.push((w+1)*l-d+V,v+o+U,0),R.push(w*l-d+V,v+o+U,0),g.push(p,p+1,p+3,p+1,p+2,p+3),p+=4,i=I===t.c.FLIP_TILE||I===t.c.ROTATE_TILE||I===t.c.FLIP_N_ROTATE_TILE?i.concat(q[(w+1)%2]):I===t.c.FLIP_ROW||I===t.c.ROTATE_ROW||I===t.c.FLIP_N_ROTATE_ROW?i.concat(q[1]):i.concat(q[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){const q=[];e=0,X=0,K=1,D=o/w,q[0]=[e,X,K,X,K,D,e,D],q[1]=[e,X,K,X,K,D,e,D],I!==t.c.ROTATE_TILE&&I!==t.c.ROTATE_ROW||(q[1]=[1-e,1-X,1-K,1-X,1-K,1-D,1-e,1-D]),I!==t.c.FLIP_TILE&&I!==t.c.FLIP_ROW||(q[1]=[1-e,X,1-K,X,1-K,D,1-e,D]),I!==t.c.FLIP_N_ROTATE_TILE&&I!==t.c.FLIP_N_ROTATE_ROW||(q[1]=[e,1-X,K,1-X,K,1-D,e,1-D]);for(let w=0;w<s;w++)R.push(w*l-d+V,C-o+U,0),R.push((w+1)*l-d+V,C-o+U,0),R.push((w+1)*l-d+V,C+U,0),R.push(w*l-d+V,C+U,0),g.push(p,p+1,p+3,p+1,p+2,p+3),p+=4,i=I===t.c.FLIP_TILE||I===t.c.ROTATE_TILE||I===t.c.FLIP_N_ROTATE_TILE?i.concat(q[(w+x)%2]):I===t.c.FLIP_ROW||I===t.c.ROTATE_ROW||I===t.c.FLIP_N_ROTATE_ROW?i.concat(q[x%2]):i.concat(q[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const q=[];e=1-Z/l,X=0,K=1,D=1,q[0]=[e,X,K,X,K,D,e,D],q[1]=[e,X,K,X,K,D,e,D],I!==t.c.ROTATE_TILE&&I!==t.c.ROTATE_ROW||(q[1]=[1-e,1-X,1-K,1-X,1-K,1-D,1-e,1-D]),I!==t.c.FLIP_TILE&&I!==t.c.FLIP_ROW||(q[1]=[1-e,X,1-K,X,1-K,D,1-e,D]),I!==t.c.FLIP_N_ROTATE_TILE&&I!==t.c.FLIP_N_ROTATE_ROW||(q[1]=[e,1-X,K,1-X,K,1-D,e,1-D]);for(let l=0;l<x;l++)R.push(B+V,l*w-T+U,0),R.push(B+Z+V,l*w-T+U,0),R.push(B+Z+V,(l+1)*w-T+U,0),R.push(B+V,(l+1)*w-T+U,0),g.push(p,p+1,p+3,p+1,p+2,p+3),p+=4,i=I===t.c.FLIP_TILE||I===t.c.ROTATE_TILE||I===t.c.FLIP_N_ROTATE_TILE?i.concat(q[(l+1)%2]):I===t.c.FLIP_ROW||I===t.c.ROTATE_ROW||I===t.c.FLIP_N_ROTATE_ROW?i.concat(q[l%2]):i.concat(q[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(r){const q=[];e=0,X=0,K=Z/w,D=1,q[0]=[e,X,K,X,K,D,e,D],q[1]=[e,X,K,X,K,D,e,D],I!==t.c.ROTATE_TILE&&I!==t.c.ROTATE_ROW||(q[1]=[1-e,1-X,1-K,1-X,1-K,1-D,1-e,1-D]),I!==t.c.FLIP_TILE&&I!==t.c.FLIP_ROW||(q[1]=[1-e,X,1-K,X,1-K,D,1-e,D]),I!==t.c.FLIP_N_ROTATE_TILE&&I!==t.c.FLIP_N_ROTATE_ROW||(q[1]=[e,1-X,K,1-X,K,1-D,e,1-D]);for(let l=0;l<x;l++)R.push(k-Z+V,l*w-T+U,0),R.push(k+V,l*w-T+U,0),R.push(k+V,(l+1)*w-T+U,0),R.push(k-Z+V,(l+1)*w-T+U,0),g.push(p,p+1,p+3,p+1,p+2,p+3),p+=4,i=I===t.c.FLIP_TILE||I===t.c.ROTATE_TILE||I===t.c.FLIP_N_ROTATE_TILE?i.concat(q[(l+s)%2]):I===t.c.FLIP_ROW||I===t.c.ROTATE_ROW||I===t.c.FLIP_N_ROTATE_ROW?i.concat(q[l%2]):i.concat(q[0]),S.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),W.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const X=0===q.sideOrientation?0:q.sideOrientation||c.e.DEFAULTSIDE;c.e._ComputeSides(X,R,g,W,i,q.frontUVs,q.backUVs);const K=new c.e;K.indices=g,K.iq=R,K.Sq=W,K.pq=i;const D=X===c.e.DOUBLESIDE?S.concat(S):S;return K.gq=D,K}function d(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new t.c(q,l);I.sideOrientation=t.c._GetDefaultSideOrientation(I.sideOrientation),w._originalBuilderSideOrientation=I.sideOrientation;return o(I).Kq(w,I.updatable),w}function T(q){const I=q.faceUV||new Array(6),l=q.faceColors,O=q.pattern||t.c.NO_FLIP,F=q.width||q.size||1,s=q.height||q.size||1,Z=q.depth||q.size||1,r=q.tileWidth||q.tileSize||1,d=q.tileHeight||q.tileSize||1,T=q.alignHorizontal||0,V=q.alignVertical||0,U=0===q.sideOrientation?0:q.sideOrientation||c.e.DEFAULTSIDE;for(let t=0;t<6;t++)void 0===I[t]&&(I[t]=new w.Vector4(0,0,1,1)),l&&void 0===l[t]&&(l[t]=new x.Dc(1,1,1,1));const B=F/2,v=s/2,k=Z/2,C=[];for(let w=0;w<2;w++)C[w]=o({pattern:O,tileWidth:r,tileHeight:d,width:F,height:s,alignVertical:V,alignHorizontal:T,sideOrientation:U});for(let w=2;w<4;w++)C[w]=o({pattern:O,tileWidth:r,tileHeight:d,width:Z,height:s,alignVertical:V,alignHorizontal:T,sideOrientation:U});let R=V;V===t.c.BOTTOM?R=t.c.TOP:V===t.c.TOP&&(R=t.c.BOTTOM);for(let w=4;w<6;w++)C[w]=o({pattern:O,tileWidth:r,tileHeight:d,width:F,height:Z,alignVertical:R,alignHorizontal:T,sideOrientation:U});let W=[],e=[],i=[],S=[];const g=[],p=[],X=[],K=[];let D=0,M=0;for(let t=0;t<6;t++){const q=C[t].iq.length;p[t]=[],X[t]=[];for(let I=0;I<q/3;I++)p[t].push(new w.dI(C[t].iq[3*I],C[t].iq[3*I+1],C[t].iq[3*I+2])),X[t].push(new w.dI(C[t].Sq[3*I],C[t].Sq[3*I+1],C[t].Sq[3*I+2]));D=C[t].pq.length,K[t]=[];for(let l=0;l<D;l+=2)K[t][l]=I[t].x+(I[t].z-I[t].x)*C[t].pq[l],K[t][l+1]=I[t].y+(I[t].w-I[t].y)*C[t].pq[l+1],a.b&&(K[t][l+1]=1-K[t][l+1]);if(i=i.concat(K[t]),S=S.concat(C[t].indices.map((q=>q+M))),M+=p[t].length,l)for(let I=0;I<4;I++)g.push(l[t].r,l[t].g,l[t].b,l[t].a)}const n=new w.dI(0,0,k),f=w.Matrix.RotationY(Math.PI);W=p[0].map((q=>w.dI.TransformNormal(q,f).add(n))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[]),e=X[0].map((q=>w.dI.TransformNormal(q,f))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[]),W=W.concat(p[1].map((q=>q.TI(n))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[])),e=e.concat(X[1].map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[]));const L=new w.dI(B,0,0),E=w.Matrix.RotationY(-Math.PI/2);W=W.concat(p[2].map((q=>w.dI.TransformNormal(q,E).add(L))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[])),e=e.concat(X[2].map((q=>w.dI.TransformNormal(q,E))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[]));const j=w.Matrix.RotationY(Math.PI/2);W=W.concat(p[3].map((q=>w.dI.TransformNormal(q,j).TI(L))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[])),e=e.concat(X[3].map((q=>w.dI.TransformNormal(q,j))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[]));const h=new w.dI(0,v,0),u=w.Matrix.RotationX(Math.PI/2);W=W.concat(p[4].map((q=>w.dI.TransformNormal(q,u).add(h))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[])),e=e.concat(X[4].map((q=>w.dI.TransformNormal(q,u))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[]));const P=w.Matrix.RotationX(-Math.PI/2);W=W.concat(p[5].map((q=>w.dI.TransformNormal(q,P).TI(h))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[])),e=e.concat(X[5].map((q=>w.dI.TransformNormal(q,P))).map((q=>[q.x,q.y,q.z])).reduce(((q,I)=>q.concat(I)),[])),c.e._ComputeSides(U,W,S,e,i);const mq=new c.e;if(mq.indices=S,mq.iq=W,mq.Sq=e,mq.pq=i,l){const q=U===c.e.DOUBLESIDE?g.concat(g):g;mq.gq=q}return mq}function V(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new t.c(q,l);I.sideOrientation=t.c._GetDefaultSideOrientation(I.sideOrientation),w._originalBuilderSideOrientation=I.sideOrientation;return T(I).Kq(w,I.updatable),w}c.e.CreateTiledPlane=o;c.e.CreateTiledBox=T;var U=l(14108),B=l(12987),v=l(12953);function k(q){const I=q.height||2;let l=0===q.diameterTop?0:q.diameterTop||q.diameter||1,O=0===q.diameterBottom?0:q.diameterBottom||q.diameter||1;l=l||1e-5,O=O||1e-5;const F=0|(q.tessellation||24),s=0|(q.subdivisions||1),Z=!!q.hasRings,r=!!q.enclose,o=0===q.cap?0:q.cap||t.c.CAP_ALL,d=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,T=0===q.sideOrientation?0:q.sideOrientation||c.e.DEFAULTSIDE,V=q.faceUV||new Array(3),U=q.faceColors,B=2+(1+(1!==d&&r?2:0))*(Z?s:1);let k;for(k=0;k<B;k++)U&&void 0===U[k]&&(U[k]=new x.Dc(1,1,1,1));for(k=0;k<B;k++)V&&void 0===V[k]&&(V[k]=new w.Vector4(0,0,1,1));const C=[],R=[],W=[],e=[],i=[],S=2*Math.PI*d/F;let g,p,X;const K=(O-l)/2/I,D=w.dI.Zero(),M=w.dI.Zero(),n=w.dI.Zero(),f=w.dI.Zero(),L=w.dI.Zero(),E=v.c.Y;let j,h,u,P=1,mq=1,Y=0,y=0;for(j=0;j<=s;j++)for(p=j/s,X=(p*(l-O)+O)/2,P=Z&&0!==j&&j!==s?2:1,u=0;u<P;u++){for(Z&&(mq+=u),r&&(mq+=2*u),h=0;h<=F;h++)g=h*S,D.x=Math.cos(-g)*X,D.y=-I/2+p*I,D.z=Math.sin(-g)*X,0===l&&j===s?(M.x=W[W.length-3*(F+1)],M.y=W[W.length-3*(F+1)+1],M.z=W[W.length-3*(F+1)+2]):(M.x=D.x,M.z=D.z,M.y=Math.sqrt(M.x*M.x+M.z*M.z)*K,M.normalize()),0===h&&(n.t(D),f.t(M)),R.push(D.x,D.y,D.z),W.push(M.x,M.y,M.z),y=Z?Y!==mq?V[mq].y:V[mq].w:V[mq].y+(V[mq].w-V[mq].y)*p,e.push(V[mq].x+(V[mq].z-V[mq].x)*h/F,a.b?1-y:y),U&&i.push(U[mq].r,U[mq].g,U[mq].b,U[mq].a);1!==d&&r&&(R.push(D.x,D.y,D.z),R.push(0,D.y,0),R.push(0,D.y,0),R.push(n.x,n.y,n.z),w.dI.CrossToRef(E,M,L),L.normalize(),W.push(L.x,L.y,L.z,L.x,L.y,L.z),w.dI.CrossToRef(f,E,L),L.normalize(),W.push(L.x,L.y,L.z,L.x,L.y,L.z),y=Z?Y!==mq?V[mq+1].y:V[mq+1].w:V[mq+1].y+(V[mq+1].w-V[mq+1].y)*p,e.push(V[mq+1].x,a.b?1-y:y),e.push(V[mq+1].z,a.b?1-y:y),y=Z?Y!==mq?V[mq+2].y:V[mq+2].w:V[mq+2].y+(V[mq+2].w-V[mq+2].y)*p,e.push(V[mq+2].x,a.b?1-y:y),e.push(V[mq+2].z,a.b?1-y:y),U&&(i.push(U[mq+1].r,U[mq+1].g,U[mq+1].b,U[mq+1].a),i.push(U[mq+1].r,U[mq+1].g,U[mq+1].b,U[mq+1].a),i.push(U[mq+2].r,U[mq+2].g,U[mq+2].b,U[mq+2].a),i.push(U[mq+2].r,U[mq+2].g,U[mq+2].b,U[mq+2].a))),Y!==mq&&(Y=mq)}const G=1!==d&&r?F+4:F;for(j=0,mq=0;mq<s;mq++){let q=0,I=0,l=0,w=0;for(h=0;h<F;h++)q=j*(G+1)+h,I=(j+1)*(G+1)+h,l=j*(G+1)+(h+1),w=(j+1)*(G+1)+(h+1),C.push(q,I,l),C.push(w,l,I);1!==d&&r&&(C.push(q+2,I+2,l+2),C.push(w+2,l+2,I+2),C.push(q+4,I+4,l+4),C.push(w+4,l+4,I+4)),j=Z?j+2:j+1}const N=q=>{const t=q?l/2:O/2;if(0===t)return;let c,s,Z;const r=q?V[B-1]:V[0];let x=null;U&&(x=q?U[B-1]:U[0]);const o=R.length/3,T=q?I/2:-I/2,v=new w.dI(0,T,0);R.push(v.x,v.y,v.z),W.push(0,q?1:-1,0);const k=r.y+.5*(r.w-r.y);e.push(r.x+.5*(r.z-r.x),a.b?1-k:k),x&&i.push(x.r,x.g,x.b,x.a);const S=new w.Vector2(.5,.5);for(Z=0;Z<=F;Z++){c=2*Math.PI*Z*d/F;const I=Math.cos(-c),l=Math.sin(-c);s=new w.dI(I*t,T,l*t);const O=new w.Vector2(I*S.x+.5,l*S.y+.5);R.push(s.x,s.y,s.z),W.push(0,q?1:-1,0);const o=r.y+(r.w-r.y)*O.y;e.push(r.x+(r.z-r.x)*O.x,a.b?1-o:o),x&&i.push(x.r,x.g,x.b,x.a)}for(Z=0;Z<F;Z++)q?(C.push(o),C.push(o+(Z+2)),C.push(o+(Z+1))):(C.push(o),C.push(o+(Z+1)),C.push(o+(Z+2)))};o!==t.c.CAP_START&&o!==t.c.CAP_ALL||N(!1),o!==t.c.CAP_END&&o!==t.c.CAP_ALL||N(!0),c.e._ComputeSides(T,R,C,W,e,q.frontUVs,q.backUVs);const J=new c.e;return J.indices=C,J.iq=R,J.Sq=W,J.pq=e,U&&(J.gq=i),J}function C(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const w=new t.c(q,l);I.sideOrientation=t.c._GetDefaultSideOrientation(I.sideOrientation),w._originalBuilderSideOrientation=I.sideOrientation;return k(I).Kq(w,I.updatable),w}function R(q){const I=[],l=[],t=[],O=[],F=q.diameter||1,s=q.thickness||.5,Z=0|(q.tessellation||16),r=0===q.sideOrientation?0:q.sideOrientation||c.e.DEFAULTSIDE,x=Z+1;for(let c=0;c<=Z;c++){const q=c/Z,r=c*Math.PI*2/Z-Math.PI/2,o=w.Matrix.Translation(F/2,0,0).multiply(w.Matrix.RotationY(r));for(let F=0;F<=Z;F++){const r=1-F/Z,d=F*Math.PI*2/Z+Math.PI,T=Math.cos(d),V=Math.sin(d);let U=new w.dI(T,V,0),B=U.scale(s/2);const v=new w.Vector2(q,r);B=w.dI.TransformCoordinates(B,o),U=w.dI.TransformNormal(U,o),l.push(B.x,B.y,B.z),t.push(U.x,U.y,U.z),O.push(v.x,a.b?1-v.y:v.y);const k=(c+1)%x,C=(F+1)%x;I.push(c*x+F),I.push(c*x+C),I.push(k*x+F),I.push(c*x+C),I.push(k*x+C),I.push(k*x+F)}}c.e._ComputeSides(r,l,I,t,O,q.frontUVs,q.backUVs);const o=new c.e;return o.indices=I,o.iq=l,o.Sq=t,o.pq=O,o}function W(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const w=new t.c(q,l);I.sideOrientation=t.c._GetDefaultSideOrientation(I.sideOrientation),w._originalBuilderSideOrientation=I.sideOrientation;return R(I).Kq(w,I.updatable),w}c.e.CreateCylinder=k,t.c.CreateCylinder=(q,I,l,w,O,c,a,F,s)=>{void 0!==a&&a instanceof B.e||(void 0!==a&&(s=F||t.c.DEFAULTSIDE,F=a),a=c,c=1);return C(q,{height:I,diameterTop:l,diameterBottom:w,tessellation:O,subdivisions:c,sideOrientation:s,updatable:F},a)};function e(q){const I=[],l=[],t=[],O=[],F=q.radius||2,s=q.tube||.5,Z=q.radialSegments||32,r=q.tubularSegments||32,x=q.p||2,o=q.q||3,d=0===q.sideOrientation?0:q.sideOrientation||c.e.DEFAULTSIDE,T=q=>{const I=Math.cos(q),l=Math.sin(q),t=o/x*q,O=Math.cos(t),c=F*(2+O)*.5*I,a=F*(2+O)*l*.5,s=F*Math.sin(t)*.5;return new w.dI(c,a,s)};let V,U;for(V=0;V<=Z;V++){const q=V%Z/Z*2*x*Math.PI,I=T(q),t=T(q+.01),c=t.TI(I);let F=t.add(I);const o=w.dI.Cross(c,F);for(F=w.dI.Cross(o,c),o.normalize(),F.normalize(),U=0;U<r;U++){const q=U%r/r*2*Math.PI,w=-s*Math.cos(q),t=s*Math.sin(q);l.push(I.x+w*F.x+t*o.x),l.push(I.y+w*F.y+t*o.y),l.push(I.z+w*F.z+t*o.z),O.push(V/Z),O.push(a.b?1-U/r:U/r)}}for(V=0;V<Z;V++)for(U=0;U<r;U++){const q=(U+1)%r,l=V*r+U,w=(V+1)*r+U,t=(V+1)*r+q,O=V*r+q;I.push(O),I.push(w),I.push(l),I.push(O),I.push(t),I.push(w)}c.e.ComputeNormals(l,I,t),c.e._ComputeSides(d,l,I,t,O,q.frontUVs,q.backUVs);const B=new c.e;return B.indices=I,B.iq=l,B.Sq=t,B.pq=O,B}function i(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const w=new t.c(q,l);I.sideOrientation=t.c._GetDefaultSideOrientation(I.sideOrientation),w._originalBuilderSideOrientation=I.sideOrientation;return e(I).Kq(w,I.updatable),w}c.e.CreateTorus=R,t.c.CreateTorus=(q,I,l,w,t,O,c)=>W(q,{diameter:I,thickness:l,tessellation:w,sideOrientation:c,updatable:O},t);c.e.CreateTorusKnot=e,t.c.CreateTorusKnot=(q,I,l,w,t,O,c,a,F,s)=>i(q,{radius:I,tube:l,radialSegments:w,tubularSegments:t,p:O,q:c,sideOrientation:s,updatable:F},a);var S=l(14644),g=l(13273),p=l(12965);function X(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=I.path,O=I.shape,c=I.scale||1,a=I.rotation||0,F=0===I.cap?0:I.cap||t.c.NO_CAP,s=I.updatable,Z=t.c._GetDefaultSideOrientation(I.sideOrientation),r=I.instance||null,x=I.invertUV||!1,o=I.closeShape||!1,d=I.closePath||!1,T=I.capFunction||null;return D(q,O,w,c,a,null,null,d,o,F,!1,l,!!s,Z,r,x,I.frontUVs||null,I.backUVs||null,I.firstNormal||null,!!I.adjustFrame,T)}function K(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=I.path,O=I.shape,c=I.scaleFunction||(()=>1),a=I.rotationFunction||(()=>0),F=I.closePath||I.ribbonCloseArray||!1,s=I.closeShape||I.ribbonClosePath||!1,Z=0===I.cap?0:I.cap||t.c.NO_CAP,r=I.updatable,x=I.firstNormal||null,o=I.adjustFrame||!1,d=t.c._GetDefaultSideOrientation(I.sideOrientation),T=I.instance,V=I.invertUV||!1,U=I.capFunction||null;return D(q,O,w,null,null,c,a,F,s,Z,!0,l,!!r,d,T||null,V,I.frontUVs||null,I.backUVs||null,x,o,U||null)}function D(q,I,l,O,c,a,F,Z,r,x,o,d,T,V,U,B,v,k,C,R,W){const e=(q,I,l,O,c,a,F,s,Z,r,x)=>{const o=l.getTangents(),d=l.getNormals(),T=l.getBinormals(),V=l.getDistances();if(x)for(let t=0;t<o.length;t++)if(0==o[t].x&&0==o[t].y&&0==o[t].z&&o[t].t(o[t-1]),0==d[t].x&&0==d[t].y&&0==d[t].z&&d[t].t(d[t-1]),0==T[t].x&&0==T[t].y&&0==T[t].z&&T[t].t(T[t-1]),t>0){let q=o[t-1];w.dI.Dot(q,o[t])<0&&o[t].scaleInPlace(-1),q=d[t-1],w.dI.Dot(q,d[t])<0&&d[t].scaleInPlace(-1),q=T[t-1],w.dI.Dot(q,T[t])<0&&T[t].scaleInPlace(-1)}let U=0;const B=r&&s?s:()=>null!==a?a:0,v=r&&F?F:()=>null!==c?c:1;let k=Z===t.c.NO_CAP||Z===t.c.CAP_END?0:2;const C=w.TmpVectors.Matrix[0];for(let t=0;t<I.length;t++){const l=[],c=B(t,V[t]),a=v(t,V[t]);w.Matrix.RotationAxisToRef(o[t],U,C);for(let O=0;O<q.length;O++){const c=o[t].scale(q[O].z).add(d[t].scale(q[O].x)).add(T[t].scale(q[O].y)),F=w.dI.Zero();w.dI.TransformCoordinatesToRef(c,C,F),F.scaleInPlace(a).addInPlace(I[t]),l[O]=F}O[k]=l,U+=c,k++}const R=W||(q=>{const I=Array(),l=w.dI.Zero();let t;for(t=0;t<q.length;t++)l.addInPlace(q[t]);for(l.scaleInPlace(1/q.length),t=0;t<q.length;t++)I.push(l);return I});switch(Z){case t.c.NO_CAP:break;case t.c.CAP_START:O[0]=R(O[2]),O[1]=O[2];break;case t.c.CAP_END:O[k]=O[k-1],O[k+1]=R(O[k-1]);break;case t.c.CAP_ALL:O[0]=R(O[2]),O[1]=O[2],O[k]=O[k-1],O[k+1]=R(O[k-1])}return O};let i,S;if(U){const q=U._creationDataStorage;return i=C?q.path3D.update(l,C):q.path3D.update(l),S=e(I,l,q.path3D,q.pathArray,O,c,a,F,q.cap,o,R),U=s("",{pathArray:S,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:U},d||void 0)}i=C?new p.h(l,C):new p.h(l);S=e(I,l,i,new Array,O,c,a,F,x=x<0||x>3?0:x,o,R);const g=s(q,{pathArray:S,closeArray:Z,closePath:r,updatable:T,sideOrientation:V,invertUV:B,frontUVs:v||void 0,backUVs:k||void 0},d);return g._creationDataStorage.pathArray=S,g._creationDataStorage.path3D=i,g._creationDataStorage.cap=x,g}function M(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=I.arc?I.arc<=0||I.arc>1?1:I.arc:1,c=void 0===I.closed||I.closed,a=I.shape,F=I.radius||1,Z=I.tessellation||64,r=I.clip||0,x=I.updatable,o=t.c._GetDefaultSideOrientation(I.sideOrientation),d=I.cap||t.c.NO_CAP,T=2*Math.PI,V=[],U=I.invertUV||!1;let B=0,v=0;const k=T/Z*O;let C,R;for(B=0;B<=Z-r;B++){for(R=[],d!=t.c.CAP_START&&d!=t.c.CAP_ALL||(R.push(new w.dI(0,a[0].y,0)),R.push(new w.dI(Math.cos(B*k)*a[0].x*F,a[0].y,Math.sin(B*k)*a[0].x*F))),v=0;v<a.length;v++)C=new w.dI(Math.cos(B*k)*a[v].x*F,a[v].y,Math.sin(B*k)*a[v].x*F),R.push(C);d!=t.c.CAP_END&&d!=t.c.CAP_ALL||(R.push(new w.dI(Math.cos(B*k)*a[a.length-1].x*F,a[a.length-1].y,Math.sin(B*k)*a[a.length-1].x*F)),R.push(new w.dI(0,a[a.length-1].y,0))),V.push(R)}return s(q,{pathArray:V,closeArray:c,sideOrientation:o,updatable:x,invertUV:U,frontUVs:I.frontUVs,backUVs:I.backUVs},l)}t.c.ExtrudeShape=function(q,I,l,w,O,c){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0,Z=arguments.length>9?arguments[9]:void 0;return X(q,{shape:I,path:l,scale:w,rotation:O,cap:0===c?0:c||t.c.NO_CAP,sideOrientation:s,instance:Z,updatable:F},a)},t.c.ExtrudeShapeCustom=(q,I,l,w,O,c,a,F,s,Z,r,x)=>K(q,{shape:I,path:l,scaleFunction:w,rotationFunction:O,ribbonCloseArray:c,ribbonClosePath:a,cap:0===F?0:F||t.c.NO_CAP,sideOrientation:r,instance:x,updatable:Z},s);t.c.CreateLathe=(q,I,l,w,t,O,c)=>M(q,{shape:I,radius:l,tessellation:w,sideOrientation:c,updatable:O},t);var n=l(14017),f=l(13967);function L(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=I.path;let c=I.instance,a=1;void 0!==I.radius?a=I.radius:c&&(a=c._creationDataStorage.radius);const F=I.tessellation||64,Z=I.radiusFunction||null;let r=I.cap||t.c.NO_CAP;const x=I.invertUV||!1,o=I.updatable,d=t.c._GetDefaultSideOrientation(I.sideOrientation);I.arc=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1;const T=(q,I,l,O,c,a,F,s)=>{const Z=I.getTangents(),r=I.getNormals(),x=I.getDistances(),o=2*Math.PI/c*s,d=a||(()=>O);let T,V,U,B;const v=w.TmpVectors.Matrix[0];let k=F===t.c.NO_CAP||F===t.c.CAP_END?0:2;for(let t=0;t<q.length;t++){V=d(t,x[t]),T=Array(),U=r[t];for(let I=0;I<c;I++)w.Matrix.RotationAxisToRef(Z[t],o*I,v),B=T[I]?T[I]:w.dI.Zero(),w.dI.TransformCoordinatesToRef(U,v,B),B.scaleInPlace(V).addInPlace(q[t]),T[I]=B;l[k]=T,k++}const C=(I,l)=>{const w=Array();for(let t=0;t<I;t++)w.push(q[l]);return w};switch(F){case t.c.NO_CAP:break;case t.c.CAP_START:l[0]=C(c,0),l[1]=l[2].slice(0);break;case t.c.CAP_END:l[k]=l[k-1].slice(0),l[k+1]=C(c,q.length-1);break;case t.c.CAP_ALL:l[0]=C(c,0),l[1]=l[2].slice(0),l[k]=l[k-1].slice(0),l[k+1]=C(c,q.length-1)}return l};let V,U;if(c){const q=c._creationDataStorage,l=I.arc||q.arc;return V=q.path3D.update(O),U=T(O,V,q.pathArray,a,q.tessellation,Z,q.cap,l),c=s("",{pathArray:U,instance:c}),q.path3D=V,q.pathArray=U,q.arc=l,q.radius=a,c}V=new p.h(O);r=r<0||r>3?0:r,U=T(O,V,new Array,a,F,Z,r,I.arc);const B=s(q,{pathArray:U,closePath:!0,closeArray:!1,updatable:o,sideOrientation:d,invertUV:x,frontUVs:I.frontUVs,backUVs:I.backUVs},l);return B._creationDataStorage.pathArray=U,B._creationDataStorage.path3D=V,B._creationDataStorage.tessellation=F,B._creationDataStorage.cap=r,B._creationDataStorage.arc=I.arc,B._creationDataStorage.radius=a,B}function E(q){const I=[];I[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},I[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},I[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},I[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},I[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},I[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},I[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},I[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},I[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},I[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},I[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},I[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},I[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},I[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},I[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const l=q.type&&(q.type<0||q.type>=I.length)?0:q.type||0,t=q.size,O=q.sizeX||t||1,F=q.sizeY||t||1,s=q.sizeZ||t||1,Z=q.custom||I[l],r=Z.face.length,o=q.faceUV||new Array(r),d=q.faceColors,T=void 0===q.flat||q.flat,V=0===q.sideOrientation?0:q.sideOrientation||c.e.DEFAULTSIDE,U=[],B=[],v=[],k=[],C=[];let R=0,W=0;const e=[];let i,S,g,p,X,K,D=0,M=0;if(T)for(M=0;M<r;M++)d&&void 0===d[M]&&(d[M]=new x.Dc(1,1,1,1)),o&&void 0===o[M]&&(o[M]=new w.Vector4(0,0,1,1));if(T)for(M=0;M<r;M++){const q=Z.face[M].length;for(g=2*Math.PI/q,p=.5*Math.tan(g/2),X=.5,D=0;D<q;D++)U.push(Z.vertex[Z.face[M][D]][0]*O,Z.vertex[Z.face[M][D]][1]*F,Z.vertex[Z.face[M][D]][2]*s),e.push(R),R++,i=o[M].x+(o[M].z-o[M].x)*(.5+p),S=o[M].y+(o[M].w-o[M].y)*(X-.5),k.push(i,a.b?1-S:S),K=p*Math.cos(g)-X*Math.sin(g),X=p*Math.sin(g)+X*Math.cos(g),p=K,d&&C.push(d[M].r,d[M].g,d[M].b,d[M].a);for(D=0;D<q-2;D++)B.push(e[0+W],e[D+2+W],e[D+1+W]);W+=q}else{for(D=0;D<Z.vertex.length;D++)U.push(Z.vertex[D][0]*O,Z.vertex[D][1]*F,Z.vertex[D][2]*s),k.push(0,a.b?1:0);for(M=0;M<r;M++)for(D=0;D<Z.face[M].length-2;D++)B.push(Z.face[M][0],Z.face[M][D+2],Z.face[M][D+1])}c.e.ComputeNormals(U,B,v),c.e._ComputeSides(V,U,B,v,k,q.frontUVs,q.backUVs);const n=new c.e;return n.iq=U,n.indices=B,n.Sq=v,n.pq=k,d&&T&&(n.gq=C),n}function j(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new t.c(q,l);I.sideOrientation=t.c._GetDefaultSideOrientation(I.sideOrientation),w._originalBuilderSideOrientation=I.sideOrientation;return E(I).Kq(w,I.updatable),w}t.c.CreateTube=(q,I,l,w,t,O,c,a,F,s)=>L(q,{path:I,radius:l,tessellation:w,radiusFunction:t,arc:1,cap:O,updatable:a,sideOrientation:F,instance:s},c);function h(q){const I=q.sideOrientation||c.e.DEFAULTSIDE,l=q.radius||1,t=void 0===q.flat||q.flat,O=0|(q.subdivisions||4),F=q.radiusX||l,s=q.radiusY||l,Z=q.radiusZ||l,r=(1+Math.sqrt(5))/2,x=[-1,r,-0,1,r,0,-1,-r,0,1,-r,0,0,-1,-r,0,1,-r,0,-1,r,0,1,r,r,0,1,r,0,-1,-r,0,1,-r,0,-1],o=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],d=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],T=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],V=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],U=[],B=[],v=[],k=[];let C=0;const R=new Array(3),W=new Array(3);let e;for(e=0;e<3;e++)R[e]=w.dI.Zero(),W[e]=w.Vector2.Zero();for(let c=0;c<20;c++){for(e=0;e<3;e++){const q=o[3*c+e];R[e].gc(x[3*d[q]],x[3*d[q]+1],x[3*d[q]+2]),R[e].normalize(),W[e].gc(.134765625*T[2*q]+.05859375+-.0390625*V[c],.2333984375*T[2*q+1]+.025390625+.01953125*V[c])}const q=(q,I,l,c)=>{const r=w.dI.Lerp(R[0],R[2],I/O),x=w.dI.Lerp(R[1],R[2],I/O),o=O===I?R[2]:w.dI.Lerp(r,x,q/(O-I));let d;if(o.normalize(),t){const q=w.dI.Lerp(R[0],R[2],c/O),I=w.dI.Lerp(R[1],R[2],c/O);d=w.dI.Lerp(q,I,l/(O-c))}else d=new w.dI(o.x,o.y,o.z);d.x/=F,d.y/=s,d.z/=Z,d.normalize();const T=w.Vector2.Lerp(W[0],W[2],I/O),V=w.Vector2.Lerp(W[1],W[2],I/O),e=O===I?W[2]:w.Vector2.Lerp(T,V,q/(O-I));B.push(o.x*F,o.y*s,o.z*Z),v.push(d.x,d.y,d.z),k.push(e.x,a.b?1-e.y:e.y),U.push(C),C++};for(let I=0;I<O;I++)for(let l=0;l+I<O;l++)q(l,I,l+1/3,I+1/3),q(l+1,I,l+1/3,I+1/3),q(l,I+1,l+1/3,I+1/3),l+I+1<O&&(q(l+1,I,l+2/3,I+2/3),q(l+1,I+1,l+2/3,I+2/3),q(l,I+1,l+2/3,I+2/3))}c.e._ComputeSides(I,B,U,v,k,q.frontUVs,q.backUVs);const i=new c.e;return i.indices=U,i.iq=B,i.Sq=v,i.pq=k,i}function u(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new t.c(q,l);I.sideOrientation=t.c._GetDefaultSideOrientation(I.sideOrientation),w._originalBuilderSideOrientation=I.sideOrientation;return h(I).Kq(w,I.updatable),w}c.e.CreatePolyhedron=E,t.c.CreatePolyhedron=(q,I,l)=>j(q,I,l);c.e.CreateIcoSphere=h,t.c.CreateIcoSphere=(q,I,l)=>u(q,I,l);var P=l(12761);const mq=new w.dI(1,0,0),Y=new w.dI(-1,0,0),y=new w.dI(0,1,0),G=new w.dI(0,-1,0),N=new w.dI(0,0,1),J=new w.dI(0,0,-1);class z{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.dI.Zero(),I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.dI.Up(),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.Vector2.Zero(),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=q,this.normal=I,this.uv=l,this.vertexIdx=t,this.vertexIdxForBones=O,this.localPositionOverride=c,this.localNormalOverride=a,this.matrixIndicesOverride=F,this.matrixWeightsOverride=s}clone(){var q,I,l,w;return new z(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(q=this.localPositionOverride)||void 0===q?void 0:q.slice(),null===(I=this.localNormalOverride)||void 0===I?void 0:I.slice(),null===(l=this.matrixIndicesOverride)||void 0===l?void 0:l.slice(),null===(w=this.matrixWeightsOverride)||void 0===w?void 0:w.slice())}}function H(q,I,l){var F,s,Z,r,x;const o=!!I.skeleton,d=!(null===(F=I.morphTargetManager)||void 0===F||!F.numTargets),T=l.localMode||o,V=I.ec(),U=o||d?I.OF(!0,!0):I.getVerticesData(O.c.PositionKind),B=o||d?I.getNormalsData(!0,!0):I.getVerticesData(O.c.NormalKind),v=T?o?I.getVerticesData(O.c.PositionKind):U:null,k=T?o?I.getVerticesData(O.c.NormalKind):B:null,C=I.getVerticesData(O.c.UVKind),R=o?I.getVerticesData(O.c.MatricesIndicesKind):null,W=o?I.getVerticesData(O.c.MatricesWeightsKind):null,e=o?I.getVerticesData(O.c.MatricesIndicesExtraKind):null,i=o?I.getVerticesData(O.c.MatricesWeightsExtraKind):null,S=l.position||w.dI.Zero();let g=l.normal||w.dI.Up();const p=l.size||w.dI.One(),X=l.angle||0;if(!g){const q=new w.dI(0,0,1),l=I.Wq().activeCamera,t=w.dI.TransformCoordinates(q,l.getWorldMatrix());g=l.globalPosition.TI(t)}const K=-Math.atan2(g.z,g.x)-Math.PI/2,D=Math.sqrt(g.x*g.x+g.z*g.z),M=Math.atan2(g.y,D),n=new c.e;n.indices=[],n.iq=[],n.Sq=[],n.pq=[],n.matricesIndices=o?[]:null,n.matricesWeights=o?[]:null,n.matricesIndicesExtra=e?[]:null,n.matricesWeightsExtra=i?[]:null;let f=0;const L=(q,I)=>{const t=new z;if(!V||!U||!B)return t;const O=V[q];if(t.vertexIdx=3*O,t.vertexIdxForBones=4*O,t.position=new w.dI(U[3*O],U[3*O+1],U[3*O+2]),w.dI.TransformCoordinatesToRef(t.position,I,t.position),t.normal=new w.dI(B[3*O],B[3*O+1],B[3*O+2]),w.dI.TransformNormalToRef(t.normal,I,t.normal),l.captureUVS&&C){const q=C[2*O+1];t.uv=new w.Vector2(C[2*O],a.b?1-q:q)}return t},E=[0,0,0,0],j=(q,I)=>{if(0===q.length)return q;const l=.5*Math.abs(w.dI.Dot(p,I)),t=(q,I,l,w)=>{for(let t=0;t<w;++t)if(q[l+t]===I)return l+t;return-1},O=(q,O)=>{const c=w.dI.GetClipFactor(q.position,O.position,I,l);let a=E,F=E;if(R&&W){const I=q.matrixIndicesOverride?0:q.vertexIdxForBones,l=q.matrixIndicesOverride??R,w=q.matrixWeightsOverride??W,s=O.matrixIndicesOverride?0:O.vertexIdxForBones,Z=O.matrixIndicesOverride??R,r=O.matrixWeightsOverride??W;a=[0,0,0,0],F=[0,0,0,0];let x=0;for(let q=0;q<4;++q)if(w[I+q]>0){const O=t(Z,l[I+q],s,4);a[x]=l[I+q],F[x]=(0,P.Lerp)(w[I+q],O>=0?r[O]:0,c),x++}for(let q=0;q<4&&x<4;++q){const w=Z[s+q];-1===t(l,w,I,4)&&(a[x]=w,F[x]=(0,P.Lerp)(0,r[s+q],c),x++)}const o=F[0]+F[1]+F[2]+F[3];F[0]/=o,F[1]/=o,F[2]/=o,F[3]/=o}const s=q.localPositionOverride?q.localPositionOverride[0]:(null===v||void 0===v?void 0:v[q.vertexIdx])??0,Z=q.localPositionOverride?q.localPositionOverride[1]:(null===v||void 0===v?void 0:v[q.vertexIdx+1])??0,r=q.localPositionOverride?q.localPositionOverride[2]:(null===v||void 0===v?void 0:v[q.vertexIdx+2])??0,x=O.localPositionOverride?O.localPositionOverride[0]:(null===v||void 0===v?void 0:v[O.vertexIdx])??0,o=O.localPositionOverride?O.localPositionOverride[1]:(null===v||void 0===v?void 0:v[O.vertexIdx+1])??0,d=O.localPositionOverride?O.localPositionOverride[2]:(null===v||void 0===v?void 0:v[O.vertexIdx+2])??0,T=q.localNormalOverride?q.localNormalOverride[0]:(null===k||void 0===k?void 0:k[q.vertexIdx])??0,V=q.localNormalOverride?q.localNormalOverride[1]:(null===k||void 0===k?void 0:k[q.vertexIdx+1])??0,U=q.localNormalOverride?q.localNormalOverride[2]:(null===k||void 0===k?void 0:k[q.vertexIdx+2])??0,B=T+((O.localNormalOverride?O.localNormalOverride[0]:(null===k||void 0===k?void 0:k[O.vertexIdx])??0)-T)*c,C=V+((O.localNormalOverride?O.localNormalOverride[1]:(null===k||void 0===k?void 0:k[O.vertexIdx+1])??0)-V)*c,e=U+((O.localNormalOverride?O.localNormalOverride[2]:(null===k||void 0===k?void 0:k[O.vertexIdx+2])??0)-U)*c,i=Math.sqrt(B*B+C*C+e*e);return new z(w.dI.Lerp(q.position,O.position,c),w.dI.Lerp(q.normal,O.normal,c).normalize(),w.Vector2.Lerp(q.uv,O.uv,c),-1,-1,v?[s+(x-s)*c,Z+(o-Z)*c,r+(d-r)*c]:null,k?[B/i,C/i,e/i]:null,a,F)};let c=null;q.length>3&&(c=[]);for(let a=0;a<q.length;a+=3){let t=0,F=null,s=null,Z=null,r=null;const x=w.dI.Dot(q[a].position,I)-l>0,o=w.dI.Dot(q[a+1].position,I)-l>0,d=w.dI.Dot(q[a+2].position,I)-l>0;switch(t=(x?1:0)+(o?1:0)+(d?1:0),t){case 0:q.length>3?(c.push(q[a]),c.push(q[a+1]),c.push(q[a+2])):c=q;break;case 1:if(c=c??new Array,x&&(F=q[a+1],s=q[a+2],Z=O(q[a],F),r=O(q[a],s)),o){F=q[a],s=q[a+2],Z=O(q[a+1],F),r=O(q[a+1],s),c.push(Z),c.push(s.clone()),c.push(F.clone()),c.push(s.clone()),c.push(Z.clone()),c.push(r);break}d&&(F=q[a],s=q[a+1],Z=O(q[a+2],F),r=O(q[a+2],s)),F&&s&&Z&&r&&(c.push(F.clone()),c.push(s.clone()),c.push(Z),c.push(r),c.push(Z.clone()),c.push(s.clone()));break;case 2:c=c??new Array,x||(F=q[a].clone(),s=O(F,q[a+1]),Z=O(F,q[a+2]),c.push(F),c.push(s),c.push(Z)),o||(F=q[a+1].clone(),s=O(F,q[a+2]),Z=O(F,q[a]),c.push(F),c.push(s),c.push(Z)),d||(F=q[a+2].clone(),s=O(F,q[a]),Z=O(F,q[a+1]),c.push(F),c.push(s),c.push(Z))}}return c},h=I instanceof t.c?I:null,u=null===h||void 0===h?void 0:h._thinInstanceDataStorage.matrixData,H=(null===h||void 0===h?void 0:h.nc)||1,A=w.TmpVectors.Matrix[0];A.t(w.Matrix.IdentityReadOnly);for(let t=0;t<H;++t){if(null!==h&&void 0!==h&&h.hasThinInstances&&u){const q=16*t;A.setRowFromFloats(0,u[q+0],u[q+1],u[q+2],u[q+3]),A.setRowFromFloats(1,u[q+4],u[q+5],u[q+6],u[q+7]),A.setRowFromFloats(2,u[q+8],u[q+9],u[q+10],u[q+11]),A.setRowFromFloats(3,u[q+12],u[q+13],u[q+14],u[q+15])}const q=w.Matrix.RotationYawPitchRoll(K,M,X).multiply(w.Matrix.Translation(S.x,S.y,S.z)),O=w.Matrix.Invert(q),c=I.getWorldMatrix(),F=A.multiply(c).multiply(O),s=new Array(3);for(let I=0;I<V.length;I+=3){let q=s;if(q[0]=L(I,F),q[1]=L(I+1,F),q[2]=L(I+2,F),!(l.cullBackFaces&&-q[0].normal.z<=0&&-q[1].normal.z<=0&&-q[2].normal.z<=0)&&(q=j(q,mq),q&&(q=j(q,Y),q&&(q=j(q,y),q&&(q=j(q,G),q&&(q=j(q,N),q&&(q=j(q,J),q)))))))for(let I=0;I<q.length;I++){const w=q[I];if(n.indices.push(f),T?(w.localPositionOverride?(n.iq[3*f]=w.localPositionOverride[0],n.iq[3*f+1]=w.localPositionOverride[1],n.iq[3*f+2]=w.localPositionOverride[2]):v&&(n.iq[3*f]=v[w.vertexIdx],n.iq[3*f+1]=v[w.vertexIdx+1],n.iq[3*f+2]=v[w.vertexIdx+2]),w.localNormalOverride?(n.Sq[3*f]=w.localNormalOverride[0],n.Sq[3*f+1]=w.localNormalOverride[1],n.Sq[3*f+2]=w.localNormalOverride[2]):k&&(n.Sq[3*f]=k[w.vertexIdx],n.Sq[3*f+1]=k[w.vertexIdx+1],n.Sq[3*f+2]=k[w.vertexIdx+2])):(w.position.toArray(n.iq,3*f),w.normal.toArray(n.Sq,3*f)),n.matricesIndices&&n.matricesWeights&&(w.matrixIndicesOverride?(n.matricesIndices[4*f]=w.matrixIndicesOverride[0],n.matricesIndices[4*f+1]=w.matrixIndicesOverride[1],n.matricesIndices[4*f+2]=w.matrixIndicesOverride[2],n.matricesIndices[4*f+3]=w.matrixIndicesOverride[3]):(R&&(n.matricesIndices[4*f]=R[w.vertexIdxForBones],n.matricesIndices[4*f+1]=R[w.vertexIdxForBones+1],n.matricesIndices[4*f+2]=R[w.vertexIdxForBones+2],n.matricesIndices[4*f+3]=R[w.vertexIdxForBones+3]),e&&n.matricesIndicesExtra&&(n.matricesIndicesExtra[4*f]=e[w.vertexIdxForBones],n.matricesIndicesExtra[4*f+1]=e[w.vertexIdxForBones+1],n.matricesIndicesExtra[4*f+2]=e[w.vertexIdxForBones+2],n.matricesIndicesExtra[4*f+3]=e[w.vertexIdxForBones+3])),w.matrixWeightsOverride?(n.matricesWeights[4*f]=w.matrixWeightsOverride[0],n.matricesWeights[4*f+1]=w.matrixWeightsOverride[1],n.matricesWeights[4*f+2]=w.matrixWeightsOverride[2],n.matricesWeights[4*f+3]=w.matrixWeightsOverride[3]):(W&&(n.matricesWeights[4*f]=W[w.vertexIdxForBones],n.matricesWeights[4*f+1]=W[w.vertexIdxForBones+1],n.matricesWeights[4*f+2]=W[w.vertexIdxForBones+2],n.matricesWeights[4*f+3]=W[w.vertexIdxForBones+3]),i&&n.matricesWeightsExtra&&(n.matricesWeightsExtra[4*f]=i[w.vertexIdxForBones],n.matricesWeightsExtra[4*f+1]=i[w.vertexIdxForBones+1],n.matricesWeightsExtra[4*f+2]=i[w.vertexIdxForBones+2],n.matricesWeightsExtra[4*f+3]=i[w.vertexIdxForBones+3]))),l.captureUVS)w.uv.toArray(n.pq,2*f);else{n.pq.push(.5+w.position.x/p.x);const q=.5+w.position.y/p.y;n.pq.push(a.b?1-q:q)}f++}}}0===n.indices.length&&(n.indices=null),0===n.iq.length&&(n.iq=null),0===n.Sq.length&&(n.Sq=null),0===n.pq.length&&(n.pq=null),0===(null===(s=n.matricesIndices)||void 0===s?void 0:s.length)&&(n.matricesIndices=null),0===(null===(Z=n.matricesWeights)||void 0===Z?void 0:Z.length)&&(n.matricesWeights=null),0===(null===(r=n.matricesIndicesExtra)||void 0===r?void 0:r.length)&&(n.matricesIndicesExtra=null),0===(null===(x=n.matricesWeightsExtra)||void 0===x?void 0:x.length)&&(n.matricesWeightsExtra=null);const Q=new t.c(q,I.Wq());return n.Kq(Q),T?(Q.skeleton=I.skeleton,Q.parent=I):(Q.position=S.clone(),Q.rotation=new w.dI(M,K,X)),Q.Cc(!0),Q.refreshBoundingInfo(!0,!0),Q}function A(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const I=0|Math.max(q.subdivisions?q.subdivisions:2,1),l=0|Math.max(q.tessellation?q.tessellation:16,3),t=Math.max(q.height?q.height:1,0),O=Math.max(q.radius?q.radius:.25,0),F=0|Math.max(q.capSubdivisions?q.capSubdivisions:6,1),s=l,Z=I,r=Math.max(q.radiusTop?q.radiusTop:O,0),x=Math.max(q.radiusBottom?q.radiusBottom:O,0),o=t-(r+x),d=2*Math.PI,T=Math.max(q.topCapSubdivisions?q.topCapSubdivisions:F,1),V=Math.max(q.bottomCapSubdivisions?q.bottomCapSubdivisions:F,1),U=Math.acos((x-r)/t);let B=[];const v=[],k=[],C=[];let R=0;const W=[],e=.5*o,i=.5*Math.PI;let S,g;const p=w.dI.Zero(),X=w.dI.Zero(),K=Math.cos(U),D=Math.sin(U),M=new w.Vector2(r*D,e+r*K).TI(new w.Vector2(x*D,x*K-e)).length(),n=r*U+M+x*(i-U);let f=0;for(g=0;g<=T;g++){const q=[],I=i-U*(g/T);f+=r*U/T;const l=Math.cos(I),w=Math.sin(I),t=l*r;for(S=0;S<=s;S++){const I=S/s,O=I*d+0,c=Math.sin(O),F=Math.cos(O);X.x=t*c,X.y=e+w*r,X.z=t*F,v.push(X.x,X.y,X.z),p.set(l*c,w,l*F),k.push(p.x,p.y,p.z),C.push(I,a.b?f/n:1-f/n),q.push(R),R++}W.push(q)}const L=t-r-x+K*r-K*x,E=D*(x-r)/L;for(g=1;g<=Z;g++){const q=[];f+=M/Z;const I=D*(g*(x-r)/Z+r);for(S=0;S<=s;S++){const l=S/s,w=l*d+0,t=Math.sin(w),O=Math.cos(w);X.x=I*t,X.y=e+K*r-g*L/Z,X.z=I*O,v.push(X.x,X.y,X.z),p.set(t,E,O).normalize(),k.push(p.x,p.y,p.z),C.push(l,a.b?f/n:1-f/n),q.push(R),R++}W.push(q)}for(g=1;g<=V;g++){const q=[],I=i-U-(Math.PI-U)*(g/V);f+=x*U/V;const l=Math.cos(I),w=Math.sin(I),t=l*x;for(S=0;S<=s;S++){const I=S/s,O=I*d+0,c=Math.sin(O),F=Math.cos(O);X.x=t*c,X.y=w*x-e,X.z=t*F,v.push(X.x,X.y,X.z),p.set(l*c,w,l*F),k.push(p.x,p.y,p.z),C.push(I,a.b?f/n:1-f/n),q.push(R),R++}W.push(q)}for(S=0;S<s;S++)for(g=0;g<T+Z+V;g++){const q=W[g][S],I=W[g+1][S],l=W[g+1][S+1],w=W[g][S+1];B.push(q),B.push(I),B.push(w),B.push(I),B.push(l),B.push(w)}if(B=B.reverse(),q.orientation&&!q.orientation.equals(w.dI.Up())){const I=new w.Matrix;q.orientation.clone().scale(.5*Math.PI).cross(w.dI.Up()).toQuaternion().toRotationMatrix(I);const l=w.dI.Zero();for(let q=0;q<v.length;q+=3)l.set(v[q],v[q+1],v[q+2]),w.dI.TransformCoordinatesToRef(l.clone(),I,l),v[q]=l.x,v[q+1]=l.y,v[q+2]=l.z}const j=new c.e;return j.iq=v,j.Sq=k,j.pq=C,j.indices=B,j}function Q(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:w.dI.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new t.c(q,l);return A(I).Kq(O,I.updatable),O}t.c.CreateDecal=(q,I,l,w,t,O)=>H(q,I,{position:l,normal:w,size:t,angle:O});t.c.CreateCapsule=(q,I,l)=>Q(q,I,l),c.e.CreateCapsule=A;var b=l(12591),qq=l(12752);class Iq{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=q,this.y=I,q!==Math.floor(q)&&(q=Math.floor(q),b.b.Warn("x is not an integer, floor(x) used")),I!==Math.floor(I)&&(I=Math.floor(I),b.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Iq(this.x,this.y)}rotate60About(q){const I=this.x;return this.x=q.x+q.y-this.y,this.y=I+this.y-q.x,this}rotateNeg60About(q){const I=this.x;return this.x=I+this.y-q.y,this.y=q.x+q.y-I,this}rotate120(q,I){q!==Math.floor(q)&&(q=Math.floor(q),b.b.Warn("m not an integer only floor(m) used")),I!==Math.floor(I)&&(I=Math.floor(I),b.b.Warn("n not an integer only floor(n) used"));const l=this.x;return this.x=q-l-this.y,this.y=I+l,this}rotateNeg120(q,I){q!==Math.floor(q)&&(q=Math.floor(q),b.b.Warn("m is not an integer, floor(m) used")),I!==Math.floor(I)&&(I=Math.floor(I),b.b.Warn("n is not an integer,   floor(n) used"));const l=this.x;return this.x=this.y-I,this.y=q+I-l-this.y,this}toCartesianOrigin(q,I){const l=w.dI.Zero();return l.x=q.x+2*this.x*I+this.y*I,l.y=q.y+Math.sqrt(3)*this.y*I,l}static Zero(){return new Iq(0,0)}}class lq{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new wq("icosahedron","Regular",[[0,qq.h,-1],[-qq.h,1,0],[-1,0,-qq.h],[1,0,-qq.h],[qq.h,1,0],[0,qq.h,1],[-1,0,qq.h],[-qq.h,-1,0],[0,-qq.h,-1],[qq.h,-1,0],[1,0,qq.h],[0,-qq.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let q=12;const I={},l=this.m,w=this.n;let t,O,c,a,F,s=l,Z=1,r=0;0!==w&&(s=(0,P.HighestCommonFactor)(l,w)),Z=l/s,r=w/s;const x=Iq.Zero(),o=new Iq(l,w),d=new Iq(-w,l+w),T=Iq.Zero(),V=Iq.Zero(),U=Iq.Zero();let B,v,k,C,R=[];const W=[],e=this.vertByDist,i=(l,w,t,O)=>{B=l+"|"+t,v=w+"|"+O,B in I||v in I?B in I&&!(v in I)?I[v]=I[B]:v in I&&!(B in I)&&(I[B]=I[v]):(I[B]=q,I[v]=q,q++),e[t][0]>2?W[I[B]]=[-e[t][0],e[t][1],I[B]]:W[I[B]]=[R[e[t][0]],e[t][1],I[B]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let S=0;S<20;S++){if(R=this.IDATA.face[S],c=R[2],a=R[1],F=R[0],k=x.x+"|"+x.y,B=S+"|"+k,B in I||(I[B]=c,W[c]=[R[e[k][0]],e[k][1]]),k=o.x+"|"+o.y,B=S+"|"+k,B in I||(I[B]=a,W[a]=[R[e[k][0]],e[k][1]]),k=d.x+"|"+d.y,B=S+"|"+k,B in I||(I[B]=F,W[F]=[R[e[k][0]],e[k][1]]),t=this.IDATA.edgematch[S][0],O=this.IDATA.edgematch[S][1],"B"===O)for(let q=1;q<s;q++)V.x=l-q*(Z+r),V.y=w+q*Z,U.x=-q*r,U.y=q*(Z+r),k=V.x+"|"+V.y,C=U.x+"|"+U.y,i(S,t,k,C);if("O"===O)for(let q=1;q<s;q++)U.x=-q*r,U.y=q*(Z+r),T.x=q*Z,T.y=q*r,k=U.x+"|"+U.y,C=T.x+"|"+T.y,i(S,t,k,C);if(t=this.IDATA.edgematch[S][2],O=this.IDATA.edgematch[S][3],O&&"A"===O)for(let q=1;q<s;q++)T.x=q*Z,T.y=q*r,V.x=l-(s-q)*(Z+r),V.y=w+(s-q)*Z,k=T.x+"|"+T.y,C=V.x+"|"+V.y,i(S,t,k,C);for(let l=0;l<this.vertices.length;l++)k=this.vertices[l].x+"|"+this.vertices[l].y,B=S+"|"+k,B in I||(I[B]=q++,e[k][0]>2?W[I[B]]=[-e[k][0],e[k][1],I[B]]:W[I[B]]=[R[e[k][0]],e[k][1],I[B]])}this.closestTo=W,this.vecToidx=I}calcCoeffs(){const q=this.m,I=this.n,l=Math.sqrt(3)/3,w=q*q+I*I+q*I;this.coau=(q+I)/w,this.cobu=-I/w,this.coav=-l*(q-I)/w,this.cobv=l*(2*q+I)/w}createInnerFacets(){const q=this.m,I=this.n;for(let l=0;l<I+q+1;l++)for(let q=this.min[l];q<this.max[l]+1;q++)q<this.max[l]&&q<this.max[l+1]+1&&this.innerFacets.push(["|"+q+"|"+l,"|"+q+"|"+(l+1),"|"+(q+1)+"|"+l]),l>0&&q<this.max[l-1]&&q+1<this.max[l]+1&&this.innerFacets.push(["|"+q+"|"+l,"|"+(q+1)+"|"+l,"|"+(q+1)+"|"+(l-1)])}edgeVecsABOB(){const q=this.m,I=this.n,l=new Iq(-I,q+I);for(let w=1;w<q+I;w++){const q=new Iq(this.min[w],w),I=new Iq(this.min[w-1],w-1),t=new Iq(this.min[w+1],w+1),O=q.clone(),c=I.clone(),a=t.clone();O.rotate60About(l),c.rotate60About(l),a.rotate60About(l);const F=new Iq(this.max[O.y],O.y),s=new Iq(this.max[O.y-1],O.y-1),Z=new Iq(this.max[O.y-1]-1,O.y-1);O.x===F.x&&O.y===F.y||(O.x!==s.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,s,Z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,Z,F])):O.y===a.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,I,s]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([q,s,t])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,I,s]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,s,F])))}}mapABOBtoOBOA(){const q=new Iq(0,0);for(let I=0;I<this.isoVecsABOB.length;I++){const l=[];for(let w=0;w<3;w++)q.x=this.isoVecsABOB[I][w].x,q.y=this.isoVecsABOB[I][w].y,0===this.vertexTypes[I][w]&&q.rotateNeg120(this.m,this.n),l.push(q.clone());this.isoVecsOBOA.push(l)}}mapABOBtoBAOA(){const q=new Iq(0,0);for(let I=0;I<this.isoVecsABOB.length;I++){const l=[];for(let w=0;w<3;w++)q.x=this.isoVecsABOB[I][w].x,q.y=this.isoVecsABOB[I][w].y,1===this.vertexTypes[I][w]&&q.rotate120(this.m,this.n),l.push(q.clone());this.isoVecsBAOA.push(l)}}MapToFace(q,I){const l=this.IDATA.face[q],t=l[2],O=l[1],c=l[0],a=w.dI.vI(this.IDATA.vertex[t]),F=w.dI.vI(this.IDATA.vertex[O]),s=w.dI.vI(this.IDATA.vertex[c]),Z=F.TI(a),r=s.TI(a),x=Z.scale(this.coau).add(r.scale(this.cobu)),o=Z.scale(this.coav).add(r.scale(this.cobv)),d=[];let T,V=w.TmpVectors.dI[0];for(let w=0;w<this.cartesian.length;w++)V=x.scale(this.cartesian[w].x).add(o.scale(this.cartesian[w].y)).add(a),d[w]=[V.x,V.y,V.z],T=q+"|"+this.vertices[w].x+"|"+this.vertices[w].y,I.vertex[this.vecToidx[T]]=[V.x,V.y,V.z]}build(q,I){const l=[],w=Iq.Zero(),t=new Iq(q,I),O=new Iq(-I,q+I);l.push(w,t,O);for(let k=I;k<q+1;k++)for(let I=0;I<q+1-k;I++)l.push(new Iq(I,k));if(I>0){const w=(0,P.HighestCommonFactor)(q,I),t=q/w,O=I/w;for(let a=1;a<w;a++)l.push(new Iq(a*t,a*O)),l.push(new Iq(-a*O,a*(t+O))),l.push(new Iq(q-a*(t+O),I+a*t));const c=q/I;for(let a=1;a<I;a++)for(let w=0;w<a*c;w++)l.push(new Iq(w,a)),l.push(new Iq(w,a).rotate120(q,I)),l.push(new Iq(w,a).rotateNeg120(q,I))}l.sort(((q,I)=>q.x-I.x)),l.sort(((q,I)=>q.y-I.y));const c=new Array(q+I+1),a=new Array(q+I+1);for(let k=0;k<c.length;k++)c[k]=1/0,a[k]=-1/0;let F=0,s=0;const Z=l.length;for(let k=0;k<Z;k++)s=l[k].x,F=l[k].y,c[F]=Math.min(s,c[F]),a[F]=Math.max(s,a[F]);const r=(l,w)=>{const t=l.clone();return"A"===w&&t.rotateNeg120(q,I),"B"===w&&t.rotate120(q,I),t.x<0?t.y:t.x+t.y},x=[],o=[],d=[],T=[],V={},U=[];let B=-1,v=-1;for(let k=0;k<Z;k++)x[k]=l[k].toCartesianOrigin(new Iq(0,0),.5),o[k]=r(l[k],"O"),d[k]=r(l[k],"A"),T[k]=r(l[k],"B"),o[k]===d[k]&&d[k]===T[k]?(B=3,v=o[k]):o[k]===d[k]?(B=4,v=o[k]):d[k]===T[k]?(B=5,v=d[k]):T[k]===o[k]&&(B=6,v=o[k]),o[k]<d[k]&&o[k]<T[k]&&(B=2,v=o[k]),d[k]<o[k]&&d[k]<T[k]&&(B=1,v=d[k]),T[k]<d[k]&&T[k]<o[k]&&(B=0,v=T[k]),U.push([B,v,l[k].x,l[k].y]);U.sort(((q,I)=>q[2]-I[2])),U.sort(((q,I)=>q[3]-I[3])),U.sort(((q,I)=>q[1]-I[1])),U.sort(((q,I)=>q[0]-I[0]));for(let k=0;k<U.length;k++)V[U[k][2]+"|"+U[k][3]]=[U[k][0],U[k][1],k];return this.m=q,this.n=I,this.vertices=l,this.vertByDist=V,this.cartesian=x,this.min=c,this.max=a,this}}class wq{constructor(q,I,l,w){this.name=q,this.category=I,this.vertex=l,this.face=w}}class tq extends wq{innerToData(q,I){for(let l=0;l<I.innerFacets.length;l++)this.face.push(I.innerFacets[l].map((l=>I.vecToidx[q+l])))}mapABOBtoDATA(q,I){const l=I.IDATA.edgematch[q][0];for(let w=0;w<I.isoVecsABOB.length;w++){const t=[];for(let O=0;O<3;O++)0===I.vertexTypes[w][O]?t.push(q+"|"+I.isoVecsABOB[w][O].x+"|"+I.isoVecsABOB[w][O].y):t.push(l+"|"+I.isoVecsABOB[w][O].x+"|"+I.isoVecsABOB[w][O].y);this.face.push([I.vecToidx[t[0]],I.vecToidx[t[1]],I.vecToidx[t[2]]])}}mapOBOAtoDATA(q,I){const l=I.IDATA.edgematch[q][0];for(let w=0;w<I.isoVecsOBOA.length;w++){const t=[];for(let O=0;O<3;O++)1===I.vertexTypes[w][O]?t.push(q+"|"+I.isoVecsOBOA[w][O].x+"|"+I.isoVecsOBOA[w][O].y):t.push(l+"|"+I.isoVecsOBOA[w][O].x+"|"+I.isoVecsOBOA[w][O].y);this.face.push([I.vecToidx[t[0]],I.vecToidx[t[1]],I.vecToidx[t[2]]])}}mapBAOAtoDATA(q,I){const l=I.IDATA.edgematch[q][2];for(let w=0;w<I.isoVecsBAOA.length;w++){const t=[];for(let O=0;O<3;O++)1===I.vertexTypes[w][O]?t.push(q+"|"+I.isoVecsBAOA[w][O].x+"|"+I.isoVecsBAOA[w][O].y):t.push(l+"|"+I.isoVecsBAOA[w][O].x+"|"+I.isoVecsBAOA[w][O].y);this.face.push([I.vecToidx[t[0]],I.vecToidx[t[1]],I.vecToidx[t[2]]])}}orderData(q){const I=[];for(let O=0;O<13;O++)I[O]=[];const l=q.closestTo;for(let O=0;O<l.length;O++)l[O][0]>-1?l[O][1]>0&&I[l[O][0]].push([O,l[O][1]]):I[12].push([O,l[O][0]]);const w=[];for(let O=0;O<12;O++)w[O]=O;let t=12;for(let O=0;O<12;O++){I[O].sort(((q,I)=>q[1]-I[1]));for(let q=0;q<I[O].length;q++)w[I[O][q][0]]=t++}for(let O=0;O<I[12].length;O++)w[I[12][O][0]]=t++;for(let O=0;O<this.vertex.length;O++)this.vertex[O].push(w[O]);this.vertex.sort(((q,I)=>q[3]-I[3]));for(let O=0;O<this.vertex.length;O++)this.vertex[O].pop();for(let O=0;O<this.face.length;O++)for(let q=0;q<this.face[O].length;q++)this.face[O][q]=w[this.face[O][q]];this.sharedNodes=I[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(q,I){const l=[],w=[];let t=I.pop();w.push(t);let O=this.face[t].indexOf(q);O=(O+2)%3;let c=this.face[t][O];l.push(c);let a=0;for(;I.length>0;)t=I[a],this.face[t].indexOf(c)>-1?(O=(this.face[t].indexOf(c)+1)%3,c=this.face[t][O],l.push(c),w.push(t),I.splice(a,1),a=0):a++;return this.adjacentFaces.push(l),w}toGoldbergPolyhedronData(){const q=new wq("GeoDual","Goldberg",[],[]);q.name="GD dual";const I=this.vertex.length,l=new Array(I);for(let F=0;F<I;F++)l[F]=[];for(let F=0;F<this.face.length;F++)for(let q=0;q<3;q++)l[this.face[F][q]].push(F);let w=0,t=0,O=0,c=[],a=[];this.adjacentFaces=[];for(let F=0;F<l.length;F++){q.face[F]=this.setOrder(F,l[F].concat([]));for(const I of l[F]){w=0,t=0,O=0,c=this.face[I];for(let q=0;q<3;q++)a=this.vertex[c[q]],w+=a[0],t+=a[1],O+=a[2];q.vertex[I]=[w/3,t/3,O/3]}}return q}static BuildGeodesicData(q){const I=new tq("Geodesic-m-n","Geodesic",[[0,qq.h,-1],[-qq.h,1,0],[-1,0,-qq.h],[1,0,-qq.h],[qq.h,1,0],[0,qq.h,1],[-1,0,qq.h],[-qq.h,-1,0],[0,-qq.h,-1],[qq.h,-1,0],[1,0,qq.h],[0,-qq.h,1]],[]);q.setIndices(),q.calcCoeffs(),q.createInnerFacets(),q.edgeVecsABOB(),q.mapABOBtoOBOA(),q.mapABOBtoBAOA();for(let l=0;l<q.IDATA.face.length;l++)q.MapToFace(l,I),I.innerToData(l,q),"B"===q.IDATA.edgematch[l][1]&&I.mapABOBtoDATA(l,q),"O"===q.IDATA.edgematch[l][1]&&I.mapOBOAtoDATA(l,q),"A"===q.IDATA.edgematch[l][3]&&I.mapBAOAtoDATA(l,q);I.orderData(q);return I.vertex=I.vertex.map((function(q){const I=q[0],l=q[1],w=q[2],t=Math.sqrt(I*I+l*l+w*w);return q[0]*=1/t,q[1]*=1/t,q[2]*=1/t,q})),I}}t.c._GoldbergMeshParser=(q,I)=>Oq.Parse(q,I);class Oq extends t.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(q,I){return void 0===I?(q>this.goldbergData.nbUnsharedFaces-1&&(b.b.Warn("Maximum number of unshared faces used"),q=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+q):(q>11&&(b.b.Warn("Last pole used"),q=11),I>this.goldbergData.nbFacesAtPole-1&&(b.b.Warn("Maximum number of faces at a pole used"),I=this.goldbergData.nbFacesAtPole-1),12+q*this.goldbergData.nbFacesAtPole+I)}_changeGoldbergFaceColors(q){for(let l=0;l<q.length;l++){const I=q[l][0],w=q[l][1],t=q[l][2];for(let q=I;q<w+1;q++)this.goldbergData.faceColors[q]=t}const I=[];for(let l=0;l<12;l++)for(let q=0;q<5;q++)I.push(this.goldbergData.faceColors[l].r,this.goldbergData.faceColors[l].g,this.goldbergData.faceColors[l].b,this.goldbergData.faceColors[l].a);for(let l=12;l<this.goldbergData.faceColors.length;l++)for(let q=0;q<6;q++)I.push(this.goldbergData.faceColors[l].r,this.goldbergData.faceColors[l].g,this.goldbergData.faceColors[l].b,this.goldbergData.faceColors[l].a);return I}setGoldbergFaceColors(q){const I=this._changeGoldbergFaceColors(q);this.fq(O.c.ColorKind,I)}updateGoldbergFaceColors(q){const I=this._changeGoldbergFaceColors(q);this.updateVerticesData(O.c.ColorKind,I)}_changeGoldbergFaceUVs(q){const I=this.getVerticesData(O.c.UVKind);for(let l=0;l<q.length;l++){const w=q[l][0],t=q[l][1],O=q[l][2],c=q[l][3],a=q[l][4],F=[],s=[];let Z,r;for(let q=0;q<5;q++)Z=O.x+c*Math.cos(a+q*Math.PI/2.5),r=O.y+c*Math.sin(a+q*Math.PI/2.5),Z<0&&(Z=0),Z>1&&(Z=1),F.push(Z,r);for(let q=0;q<6;q++)Z=O.x+c*Math.cos(a+q*Math.PI/3),r=O.y+c*Math.sin(a+q*Math.PI/3),Z<0&&(Z=0),Z>1&&(Z=1),s.push(Z,r);for(let q=w;q<Math.min(12,t+1);q++)for(let l=0;l<5;l++)I[10*q+2*l]=F[2*l],I[10*q+2*l+1]=F[2*l+1];for(let q=Math.max(12,w);q<t+1;q++)for(let l=0;l<6;l++)I[12*q-24+2*l]=s[2*l],I[12*q-23+2*l]=s[2*l+1]}return I}setGoldbergFaceUVs(q){const I=this._changeGoldbergFaceUVs(q);this.fq(O.c.UVKind,I)}updateGoldbergFaceUVs(q){const I=this._changeGoldbergFaceUVs(q);this.updateVerticesData(O.c.UVKind,I)}placeOnGoldbergFaceAt(q,I,l){const t=w.dI.RotationFromAxis(this.goldbergData.faceXaxis[I],this.goldbergData.faceYaxis[I],this.goldbergData.faceZaxis[I]);q.rotation=t,q.position=this.goldbergData.faceCenters[I].add(this.goldbergData.faceXaxis[I].scale(l.x)).add(this.goldbergData.faceYaxis[I].scale(l.y)).add(this.goldbergData.faceZaxis[I].scale(l.z))}serialize(q){super.serialize(q),q.type="GoldbergMesh";const I={};if(I.adjacentFaces=this.goldbergData.adjacentFaces,I.nbSharedFaces=this.goldbergData.nbSharedFaces,I.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,I.nbFaces=this.goldbergData.nbFaces,I.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){I.faceColors=[];for(const q of this.goldbergData.faceColors)I.faceColors.push(q.Uc())}if(this.goldbergData.faceCenters){I.faceCenters=[];for(const q of this.goldbergData.faceCenters)I.faceCenters.push(q.Uc())}if(this.goldbergData.faceZaxis){I.faceZaxis=[];for(const q of this.goldbergData.faceZaxis)I.faceZaxis.push(q.Uc())}if(this.goldbergData.faceYaxis){I.faceYaxis=[];for(const q of this.goldbergData.faceYaxis)I.faceYaxis.push(q.Uc())}if(this.goldbergData.faceXaxis){I.faceXaxis=[];for(const q of this.goldbergData.faceXaxis)I.faceXaxis.push(q.Uc())}q.goldbergData=I}static Parse(q,I){const l=q.goldbergData;l.faceColors=l.faceColors.map((q=>x.Dc.vI(q))),l.faceCenters=l.faceCenters.map((q=>w.dI.vI(q))),l.faceZaxis=l.faceZaxis.map((q=>w.dI.vI(q))),l.faceXaxis=l.faceXaxis.map((q=>w.dI.vI(q))),l.faceYaxis=l.faceYaxis.map((q=>w.dI.vI(q)));const t=new Oq(q.name,I);return t.goldbergData=l,t}}var cq=l(13269);const aq={CreateBox:r.c,CreateTiledBox:V,CreateSphere:U.e,CreateDisc:Z.d,CreateIcoSphere:u,CreateRibbon:s,CreateCylinder:C,CreateTorus:W,CreateTorusKnot:i,CreateLineSystem:S.f,Ys:S.g,CreateDashedLines:S.c,ExtrudeShape:X,ExtrudeShapeCustom:K,CreateLathe:M,CreateTiledPlane:d,Ns:n.e,CreateGround:f.g,CreateTiledGround:f.k,CreateGroundFromHeightMap:f.c,CreatePolygon:g.e,ExtrudePolygon:g.i,CreateTube:L,CreatePolyhedron:j,CreateGeodesic:function(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=I.m||1;w!==Math.floor(w)&&(w=Math.floor(w),b.b.Warn("m not an integer only floor(m) used"));let t=I.n||0;if(t!==Math.floor(t)&&(t=Math.floor(t),b.b.Warn("n not an integer only floor(n) used")),t>w){const q=t;t=w,w=q,b.b.Warn("n > m therefore m and n swapped")}const O=new lq;return O.build(w,t),j(q,{custom:tq.BuildGeodesicData(O),size:I.size,sizeX:I.sizeX,sizeY:I.sizeY,sizeZ:I.sizeZ,faceUV:I.faceUV,faceColors:I.faceColors,flat:I.flat,updatable:I.updatable,sideOrientation:I.sideOrientation,frontUVs:I.frontUVs,backUVs:I.backUVs},l)},CreateGoldberg:function(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=I.size,F=I.sizeX||O||1,s=I.sizeY||O||1,Z=I.sizeZ||O||1;let r=I.m||1;r!==Math.floor(r)&&(r=Math.floor(r),b.b.Warn("m not an integer only floor(m) used"));let o=I.n||0;if(o!==Math.floor(o)&&(o=Math.floor(o),b.b.Warn("n not an integer only floor(n) used")),o>r){const q=o;o=r,r=q,b.b.Warn("n > m therefore m and n swapped")}const d=new lq;d.build(r,o);const T=tq.BuildGeodesicData(d),V=T.toGoldbergPolyhedronData(),U=new Oq(q,l);I.sideOrientation=t.c._GetDefaultSideOrientation(I.sideOrientation),U._originalBuilderSideOrientation=I.sideOrientation;(function(q,I){const l=q.size,t=q.sizeX||l||1,O=q.sizeY||l||1,F=q.sizeZ||l||1,s=0===q.sideOrientation?0:q.sideOrientation||c.e.DEFAULTSIDE,Z=[],r=[],x=[],o=[];let d=1/0,T=-1/0,V=1/0,U=-1/0;for(let w=0;w<I.vertex.length;w++)d=Math.min(d,I.vertex[w][0]*t),T=Math.max(T,I.vertex[w][0]*t),V=Math.min(V,I.vertex[w][1]*O),U=Math.max(U,I.vertex[w][1]*O);let B=0;for(let c=0;c<I.face.length;c++){const q=I.face[c],l=w.dI.vI(I.vertex[q[0]]),s=w.dI.vI(I.vertex[q[2]]),v=w.dI.vI(I.vertex[q[1]]),k=s.TI(l),C=v.TI(l),R=w.dI.Cross(C,k).normalize();for(let w=0;w<q.length;w++){x.push(R.x,R.y,R.z);const l=I.vertex[q[w]];Z.push(l[0]*t,l[1]*O,l[2]*F);const c=(l[1]*O-V)/(U-V);o.push((l[0]*t-d)/(T-d),a.b?1-c:c)}for(let I=0;I<q.length-2;I++)r.push(B,B+I+2,B+I+1);B+=q.length}c.e._ComputeSides(s,Z,r,x,o);const v=new c.e;return v.iq=Z,v.indices=r,v.Sq=x,v.pq=o,v})(I,V).Kq(U,I.updatable),U.goldbergData.nbSharedFaces=T.sharedNodes,U.goldbergData.nbUnsharedFaces=T.poleNodes,U.goldbergData.adjacentFaces=T.adjacentFaces,U.goldbergData.nbFaces=U.goldbergData.nbSharedFaces+U.goldbergData.nbUnsharedFaces,U.goldbergData.nbFacesAtPole=(U.goldbergData.nbUnsharedFaces-12)/12;for(let t=0;t<T.vertex.length;t++)U.goldbergData.faceCenters.push(w.dI.vI(T.vertex[t])),U.goldbergData.faceCenters[t].x*=F,U.goldbergData.faceCenters[t].y*=s,U.goldbergData.faceCenters[t].z*=Z,U.goldbergData.faceColors.push(new x.Dc(1,1,1,1));for(let t=0;t<V.face.length;t++){const q=V.face[t],I=w.dI.vI(V.vertex[q[0]]),l=w.dI.vI(V.vertex[q[2]]),O=w.dI.vI(V.vertex[q[1]]),c=l.TI(I),a=O.TI(I),F=w.dI.Cross(a,c).normalize(),s=w.dI.Cross(a,F).normalize();U.goldbergData.faceXaxis.push(a.normalize()),U.goldbergData.faceYaxis.push(F),U.goldbergData.faceZaxis.push(s)}return U},CreateDecal:H,CreateCapsule:Q,CreateText:cq.f}},14040:(q,I,l)=>{"use strict";l.d(I,{c:()=>aI});var w=l(12747),t=l(13139);class O extends t.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var c=l(12789),a=(l(12909),l(12711));class F{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(q){this._targetStopDuration!==q&&(this._targetStopDuration=q)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(q){this._noiseTexture!==q&&(this._noiseTexture=q,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(q){this._animationSheetEnabled!==q&&(this._animationSheetEnabled=q)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(q){this._isAnimationSheetEnabled!=q&&(this._isAnimationSheetEnabled=q,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(q){this._useLogarithmicDepth=q&&this.Wq().getEngine().getCaps().fragmentDepthSupported}Wq(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(q){switch(q){case F.BLENDMODE_MULTIPLYADD:return;case F.BLENDMODE_ADD:q=1;break;case F.BLENDMODE_ONEONE:q=6;break;case F.BLENDMODE_STANDARD:q=2;break;case F.BLENDMODE_MULTIPLY:q=4;break;case F.BLENDMODE_SUBTRACT:q=3}this._engine.setAlphaMode(q)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:w.dI.Zero()}set direction1(q){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=q)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:w.dI.Zero()}set direction2(q){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=q)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:w.dI.Zero()}set minEmitBox(q){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=q)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:w.dI.Zero()}set maxEmitBox(q){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=q)}get billboardMode(){return this._billboardMode}set billboardMode(q){this._billboardMode!==q&&(this._billboardMode=q,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(q){this._isBillboardBased!==q&&(this._isBillboardBased=q,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q)}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(!q&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=q)}_reset(){}_removeGradientAndTexture(q,I,l){if(!I)return this;let w=0;for(const t of I){if(t.gradient===q){I.splice(w,1);break}w++}return l&&l.dispose(),this}constructor(q){this.animations=[],this.renderingGroupId=0,this.wI=w.dI.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new w.dI(10,10,10),this.onAnimationEnd=null,this.blendMode=F.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new w.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.us=new w.dI(0,0,0),this._useLogarithmicDepth=!1,this.gravity=w.dI.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new c.Dc(1,1,1,1),this.color2=new c.Dc(1,1,1,1),this.colorDead=new c.Dc(0,0,0,1),this.textureMask=new c.Dc(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new O,this.id=q,this.name=q}createPointEmitter(q,I){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new w.dI(0,1,0),arguments.length>2&&void 0!==arguments[2]||new w.dI(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new w.dI(0,1,0),arguments.length>4&&void 0!==arguments[4]||new w.dI(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new w.dI(0,1,0),arguments.length>3&&void 0!==arguments[3]||new w.dI(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(q,I,l,w){throw new Error("Method not implemented.")}}F.BLENDMODE_ONEONE=0,F.BLENDMODE_STANDARD=1,F.BLENDMODE_ADD=2,F.BLENDMODE_MULTIPLY=3,F.BLENDMODE_MULTIPLYADD=4,F.BLENDMODE_SUBTRACT=-1,(0,a.e)("BABYLON.BaseParticleSystem",F);var s=l(12761),Z=l(12599);class r{constructor(){this.direction1=new w.dI(0,1,0),this.direction2=new w.dI(0,1,0),this.minEmitBox=new w.dI(-.5,-.5,-.5),this.maxEmitBox=new w.dI(.5,.5,.5)}startDirectionFunction(q,I,l,t){const O=(0,s.RandomRange)(this.direction1.x,this.direction2.x),c=(0,s.RandomRange)(this.direction1.y,this.direction2.y),a=(0,s.RandomRange)(this.direction1.z,this.direction2.z);if(t)return I.x=O,I.y=c,void(I.z=a);w.dI.TransformNormalFromFloatsToRef(O,c,a,q,I)}startPositionFunction(q,I,l,t){const O=(0,s.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),c=(0,s.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),a=(0,s.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(t)return I.x=O,I.y=c,void(I.z=a);w.dI.TransformCoordinatesFromFloatsToRef(O,c,a,q,I)}clone(){const q=new r;return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2),q.setVector3("minEmitBox",this.minEmitBox),q.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3),q.addUniform("minEmitBox",3),q.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.Uc(),q.direction2=this.direction2.Uc(),q.minEmitBox=this.minEmitBox.Uc(),q.maxEmitBox=this.maxEmitBox.Uc(),q}parse(q){w.dI.FromArrayToRef(q.direction1,0,this.direction1),w.dI.FromArrayToRef(q.direction2,0,this.direction2),w.dI.FromArrayToRef(q.minEmitBox,0,this.minEmitBox),w.dI.FromArrayToRef(q.maxEmitBox,0,this.maxEmitBox)}}class x{get radius(){return this._radius}set radius(q){this._radius=q,this._buildHeight()}get angle(){return this._angle}set angle(q){this._angle=q,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=l,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=I,this.radius=q}startDirectionFunction(q,I,l,t){t?w.TmpVectors.dI[0].t(l.TF).normalize():l.position.subtractToRef(q.getTranslation(),w.TmpVectors.dI[0]).normalize();const O=(0,s.RandomRange)(0,this.directionRandomizer),c=(0,s.RandomRange)(0,this.directionRandomizer),a=(0,s.RandomRange)(0,this.directionRandomizer);I.x=w.TmpVectors.dI[0].x+O,I.y=w.TmpVectors.dI[0].y+c,I.z=w.TmpVectors.dI[0].z+a,I.normalize()}startPositionFunction(q,I,l,t){const O=(0,s.RandomRange)(0,2*Math.PI);let c;this.emitFromSpawnPointOnly?c=1e-4:(c=(0,s.RandomRange)(0,this.heightRange),c=1-c*c);let a=this._radius-(0,s.RandomRange)(0,this._radius*this.radiusRange);a*=c;const F=a*Math.sin(O),Z=a*Math.cos(O),r=c*this._height;if(t)return I.x=F,I.y=r,void(I.z=Z);w.dI.TransformCoordinatesFromFloatsToRef(F,r,Z,q,I)}clone(){const q=new x(this._radius,this._angle,this.directionRandomizer);return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat2("radius",this._radius,this.radiusRange),q.setFloat("coneAngle",this._angle),q.setFloat2("height",this._height,this.heightRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",2),q.addUniform("coneAngle",1),q.addUniform("height",2),q.addUniform("directionRandomizer",1)}getEffectDefines(){let q="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(q+="\n#define CONEEMITTERSPAWNPOINT"),q}getClassName(){return"ConeParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this._radius,q.angle=this._angle,q.directionRandomizer=this.directionRandomizer,q.radiusRange=this.radiusRange,q.heightRange=this.heightRange,q.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,q}parse(q){this.radius=q.radius,this.angle=q.angle,this.directionRandomizer=q.directionRandomizer,this.radiusRange=void 0!==q.radiusRange?q.radiusRange:1,this.heightRange=void 0!==q.radiusRange?q.heightRange:1,this.emitFromSpawnPointOnly=void 0!==q.emitFromSpawnPointOnly&&q.emitFromSpawnPointOnly}}class o extends x{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.dI(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.dI(0,1,0);super(q,I),this.direction1=l,this.direction2=t}startDirectionFunction(q,I){const l=(0,s.RandomRange)(this.direction1.x,this.direction2.x),t=(0,s.RandomRange)(this.direction1.y,this.direction2.y),O=(0,s.RandomRange)(this.direction1.z,this.direction2.z);w.dI.TransformNormalFromFloatsToRef(l,t,O,q,I)}clone(){const q=new o(this.radius,this.angle,this.direction1,this.direction2);return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.Uc(),q.direction2=this.direction2.Uc(),q}parse(q){super.parse(q),this.direction1.t(q.direction1),this.direction2.t(q.direction2)}}class d{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=q,this.height=I,this.radiusRange=l,this.directionRandomizer=t,this._tempVector=w.dI.Zero()}startDirectionFunction(q,I,l,t,O){l.position.subtractToRef(q.getTranslation(),this._tempVector),this._tempVector.normalize(),w.dI.TransformNormalToRef(this._tempVector,O,this._tempVector);const c=(0,s.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let a=Math.atan2(this._tempVector.x,this._tempVector.z);a+=(0,s.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=c,this._tempVector.x=Math.sin(a),this._tempVector.z=Math.cos(a),this._tempVector.normalize(),t?I.t(this._tempVector):w.dI.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,q,I)}startPositionFunction(q,I,l,t){const O=(0,s.RandomRange)(-this.height/2,this.height/2),c=(0,s.RandomRange)(0,2*Math.PI),a=(0,s.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),F=Math.sqrt(a)*this.radius,Z=F*Math.cos(c),r=F*Math.sin(c);t?I.gc(Z,O,r):w.dI.TransformCoordinatesFromFloatsToRef(Z,O,r,q,I)}clone(){const q=new d(this.radius,this.directionRandomizer);return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.height=this.height,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.height=q.height,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class T extends d{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.dI(0,1,0),O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.dI(0,1,0);super(q,I,l),this.direction1=t,this.direction2=O}startDirectionFunction(q,I,l,t){const O=(0,s.RandomRange)(this.direction1.x,this.direction2.x),c=(0,s.RandomRange)(this.direction1.y,this.direction2.y),a=(0,s.RandomRange)(this.direction1.z,this.direction2.z);t?I.gc(O,c,a):w.dI.TransformNormalFromFloatsToRef(O,c,a,q,I)}clone(){const q=new T(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.Uc(),q.direction2=this.direction2.Uc(),q}parse(q){super.parse(q),w.dI.FromArrayToRef(q.direction1,0,this.direction1),w.dI.FromArrayToRef(q.direction2,0,this.direction2)}}class V{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=q,this.radiusRange=I,this.directionRandomizer=l}startDirectionFunction(q,I,l,t){const O=l.position.TI(q.getTranslation()).normalize(),c=(0,s.RandomRange)(0,this.directionRandomizer),a=(0,s.RandomRange)(0,this.directionRandomizer),F=(0,s.RandomRange)(0,this.directionRandomizer);O.x+=c,O.y+=a,O.z+=F,O.normalize(),t?I.t(O):w.dI.TransformNormalFromFloatsToRef(O.x,O.y,O.z,q,I)}startPositionFunction(q,I,l,t){const O=this.radius-(0,s.RandomRange)(0,this.radius*this.radiusRange),c=(0,s.RandomRange)(0,1),a=(0,s.RandomRange)(0,2*Math.PI),F=Math.acos(2*c-1),Z=O*Math.cos(a)*Math.sin(F),r=O*Math.cos(F),x=O*Math.sin(a)*Math.sin(F);t?I.gc(Z,Math.abs(r),x):w.dI.TransformCoordinatesFromFloatsToRef(Z,Math.abs(r),x,q,I)}clone(){const q=new V(this.radius,this.directionRandomizer);return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class U{constructor(){this.direction1=new w.dI(0,1,0),this.direction2=new w.dI(0,1,0)}startDirectionFunction(q,I,l,t){const O=(0,s.RandomRange)(this.direction1.x,this.direction2.x),c=(0,s.RandomRange)(this.direction1.y,this.direction2.y),a=(0,s.RandomRange)(this.direction1.z,this.direction2.z);t?I.gc(O,c,a):w.dI.TransformNormalFromFloatsToRef(O,c,a,q,I)}startPositionFunction(q,I,l,t){t?I.gc(0,0,0):w.dI.TransformCoordinatesFromFloatsToRef(0,0,0,q,I)}clone(){const q=new U;return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.Uc(),q.direction2=this.direction2.Uc(),q}parse(q){w.dI.FromArrayToRef(q.direction1,0,this.direction1),w.dI.FromArrayToRef(q.direction2,0,this.direction2)}}class B{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=q,this.radiusRange=I,this.directionRandomizer=l}startDirectionFunction(q,I,l,t){const O=l.position.TI(q.getTranslation()).normalize(),c=(0,s.RandomRange)(0,this.directionRandomizer),a=(0,s.RandomRange)(0,this.directionRandomizer),F=(0,s.RandomRange)(0,this.directionRandomizer);O.x+=c,O.y+=a,O.z+=F,O.normalize(),t?I.t(O):w.dI.TransformNormalFromFloatsToRef(O.x,O.y,O.z,q,I)}startPositionFunction(q,I,l,t){const O=this.radius-(0,s.RandomRange)(0,this.radius*this.radiusRange),c=(0,s.RandomRange)(0,1),a=(0,s.RandomRange)(0,2*Math.PI),F=Math.acos(2*c-1),Z=O*Math.cos(a)*Math.sin(F),r=O*Math.cos(F),x=O*Math.sin(a)*Math.sin(F);t?I.gc(Z,r,x):w.dI.TransformCoordinatesFromFloatsToRef(Z,r,x,q,I)}clone(){const q=new B(this.radius,this.directionRandomizer);return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class v extends B{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.dI(0,1,0),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.dI(0,1,0);super(q),this.direction1=I,this.direction2=l}startDirectionFunction(q,I){const l=(0,s.RandomRange)(this.direction1.x,this.direction2.x),t=(0,s.RandomRange)(this.direction1.y,this.direction2.y),O=(0,s.RandomRange)(this.direction1.z,this.direction2.z);w.dI.TransformNormalFromFloatsToRef(l,t,O,q,I)}clone(){const q=new v(this.radius,this.direction1,this.direction2);return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.Uc(),q.direction2=this.direction2.Uc(),q}parse(q){super.parse(q),this.direction1.t(q.direction1),this.direction2.t(q.direction2)}}class k{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(q,I,l,t){const O=w.TmpVectors.dI[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,l,O);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,l,O);const q=w.TmpVectors.dI[1];O.subtractToRef(l.position,q),q.scaleToRef(1/l.lifeTime,O)}else O.set(0,0,0);t?I.t(O):w.dI.TransformNormalToRef(O,q,I)}startPositionFunction(q,I,l,t){const O=w.TmpVectors.dI[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,l,O):O.set(0,0,0),t?I.t(O):w.dI.TransformCoordinatesToRef(O,q,I)}clone(){const q=new k;return Z.d.DeepCopy(this,q),q}applyToShader(q){}buildUniformLayout(q){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.particlePositionGenerator=this.particlePositionGenerator,q.particleDestinationGenerator=this.particleDestinationGenerator,q}parse(q){q.particlePositionGenerator&&(this.particlePositionGenerator=q.particlePositionGenerator),q.particleDestinationGenerator&&(this.particleDestinationGenerator=q.particleDestinationGenerator)}}var C=l(12821);class R{get mesh(){return this._mesh}set mesh(q){this._mesh!==q&&(this._mesh=q,q?(this._indices=q.ec(),this._positions=q.getVerticesData(C.c.PositionKind),this._normals=q.getVerticesData(C.c.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=w.dI.Zero(),this._mesh=null,this.direction1=new w.dI(0,1,0),this.direction2=new w.dI(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=q}startDirectionFunction(q,I,l,t){if(this.useMeshNormalsForDirection&&this._normals)return void w.dI.TransformNormalToRef(this._storedNormal,q,I);const O=(0,s.RandomRange)(this.direction1.x,this.direction2.x),c=(0,s.RandomRange)(this.direction1.y,this.direction2.y),a=(0,s.RandomRange)(this.direction1.z,this.direction2.z);t?I.gc(O,c,a):w.dI.TransformNormalFromFloatsToRef(O,c,a,q,I)}startPositionFunction(q,I,l,t){if(!this._indices||!this._positions)return;const O=3*(Math.random()*(this._indices.length/3)|0),c=Math.random(),a=Math.random()*(1-c),F=1-c-a,s=this._indices[O],Z=this._indices[O+1],r=this._indices[O+2],x=w.TmpVectors.dI[0],o=w.TmpVectors.dI[1],d=w.TmpVectors.dI[2],T=w.TmpVectors.dI[3];w.dI.FromArrayToRef(this._positions,3*s,x),w.dI.FromArrayToRef(this._positions,3*Z,o),w.dI.FromArrayToRef(this._positions,3*r,d),T.x=c*x.x+a*o.x+F*d.x,T.y=c*x.y+a*o.y+F*d.y,T.z=c*x.z+a*o.z+F*d.z,t?I.gc(T.x,T.y,T.z):w.dI.TransformCoordinatesFromFloatsToRef(T.x,T.y,T.z,q,I),this.useMeshNormalsForDirection&&this._normals&&(w.dI.FromArrayToRef(this._normals,3*s,x),w.dI.FromArrayToRef(this._normals,3*Z,o),w.dI.FromArrayToRef(this._normals,3*r,d),this._storedNormal.x=c*x.x+a*o.x+F*d.x,this._storedNormal.y=c*x.y+a*o.y+F*d.y,this._storedNormal.z=c*x.z+a*o.z+F*d.z)}clone(){const q=new R(this.mesh);return Z.d.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var q;const I={};return I.type=this.getClassName(),I.direction1=this.direction1.Uc(),I.direction2=this.direction2.Uc(),I.meshId=null===(q=this.mesh)||void 0===q?void 0:q.id,I.useMeshNormalsForDirection=this.useMeshNormalsForDirection,I}parse(q,I){w.dI.FromArrayToRef(q.direction1,0,this.direction1),w.dI.FromArrayToRef(q.direction2,0,this.direction2),q.meshId&&I&&(this.mesh=I.getLastMeshById(q.meshId)),this.useMeshNormalsForDirection=q.useMeshNormalsForDirection}}class W{_isUbo(q){return void 0!==q.addUniform}constructor(q){this._isUbo(q)?(this.setMatrix3x3=q.updateMatrix3x3.bind(q),this.setMatrix2x2=q.updateMatrix2x2.bind(q),this.setFloat=q.updateFloat.bind(q),this.setFloat2=q.updateFloat2.bind(q),this.setFloat3=q.updateFloat3.bind(q),this.setFloat4=q.updateFloat4.bind(q),this.setFloatArray=q.updateFloatArray.bind(q),this.setArray=q.updateArray.bind(q),this.setIntArray=q.updateIntArray.bind(q),this.setMatrix=q.kc.bind(q),this.setMatrices=q.updateMatrices.bind(q),this.setVector3=q.updateVector3.bind(q),this.setVector4=q.updateVector4.bind(q),this.setColor3=q.updateColor3.bind(q),this.setColor4=q.updateColor4.bind(q),this.setDirectColor4=q.updateDirectColor4.bind(q),this.setInt=q.updateInt.bind(q),this.setInt2=q.updateInt2.bind(q),this.setInt3=q.updateInt3.bind(q),this.setInt4=q.updateInt4.bind(q)):(this.setMatrix3x3=q.setMatrix3x3.bind(q),this.setMatrix2x2=q.setMatrix2x2.bind(q),this.setFloat=q.setFloat.bind(q),this.setFloat2=q.setFloat2.bind(q),this.setFloat3=q.setFloat3.bind(q),this.setFloat4=q.setFloat4.bind(q),this.setFloatArray=q.setFloatArray.bind(q),this.setArray=q.setArray.bind(q),this.setIntArray=q.setIntArray.bind(q),this.setMatrix=q.setMatrix.bind(q),this.setMatrices=q.setMatrices.bind(q),this.setVector3=q.setVector3.bind(q),this.setVector4=q.setVector4.bind(q),this.setColor3=q.setColor3.bind(q),this.setColor4=q.setColor4.bind(q),this.setDirectColor4=q.setDirectColor4.bind(q),this.setInt=q.setInt.bind(q),this.setInt2=q.setInt2.bind(q),this.setInt3=q.setInt3.bind(q),this.setInt4=q.setInt4.bind(q))}}var e=l(12664);const i="gpuUpdateParticlesPixelShader",S="#version 300 es\nvoid main() {discard;}\n";e.e.ShadersStore[i]||(e.e.ShadersStore[i]=S);const g="gpuUpdateParticlesVertexShader",p="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";e.e.ShadersStore[g]||(e.e.ShadersStore[g]=p);(0,a.e)("BABYLON.WebGL2ParticleSystem",class{constructor(q,I){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=q,this._engine=I,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var q;return(null===(q=this._updateEffect)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof k&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=q,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new W(this._updateEffect)}createVertexBuffers(q,I){this._updateVAO.push(this._createUpdateVAO(q)),this._renderVAO.push(this._engine.recordVertexArrayObject(I,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=I}createParticleBuffer(q){return q}bindDrawBuffers(q,I,l){l?this._engine.bindBuffers(this._renderVertexBuffers,l,I):this._engine.bindVertexArrayObject(this._renderVAO[q],null)}preUpdateParticleBuffer(){const q=this._engine;if(this._engine.enableEffect(this._updateEffect),!q.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(q,I,l){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[q],null);const w=this._engine;w.bindTransformFeedbackBuffer(I.getBuffer()),w.setRasterizerState(!1),w.beginTransformFeedback(!0),w.drawArraysType(3,0,l),w.endTransformFeedback(),w.setRasterizerState(!0),w.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let q=0;q<this._updateVAO.length;q++)this._engine.releaseVertexArrayObject(this._updateVAO[q]);this._updateVAO.length=0;for(let q=0;q<this._renderVAO.length;q++)this._engine.releaseVertexArrayObject(this._renderVAO[q]);this._renderVAO.length=0}_createUpdateVAO(q){const I={};I.position=q.createVertexBuffer("position",0,3);let l=3;I.age=q.createVertexBuffer("age",l,1),l+=1,I.size=q.createVertexBuffer("size",l,3),l+=3,I.life=q.createVertexBuffer("life",l,1),l+=1,I.seed=q.createVertexBuffer("seed",l,4),l+=4,I.direction=q.createVertexBuffer("direction",l,3),l+=3,this._parent.particleEmitterType instanceof k&&(I.initialPosition=q.createVertexBuffer("initialPosition",l,3),l+=3),this._parent._colorGradientsTexture||(I.color=q.createVertexBuffer("color",l,4),l+=4),this._parent._isBillboardBased||(I.initialDirection=q.createVertexBuffer("initialDirection",l,3),l+=3),this._parent.noiseTexture&&(I.noiseCoordinates1=q.createVertexBuffer("noiseCoordinates1",l,3),l+=3,I.noiseCoordinates2=q.createVertexBuffer("noiseCoordinates2",l,3),l+=3),this._parent._angularSpeedGradientsTexture?(I.angle=q.createVertexBuffer("angle",l,1),l+=1):(I.angle=q.createVertexBuffer("angle",l,2),l+=2),this._parent._isAnimationSheetEnabled&&(I.cellIndex=q.createVertexBuffer("cellIndex",l,1),l+=1,this._parent.spriteRandomStartCell&&(I.cellStartOffset=q.createVertexBuffer("cellStartOffset",l,1),l+=1));const w=this._engine.recordVertexArrayObject(I,null,this._updateEffect);return this._engine.bindArrayBuffer(null),w}});class X{constructor(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,w=arguments.length>3?arguments[3]:void 0;this._engine=q,this._label=w,this._engine._storageBuffers.push(this),this._create(I,l)}_create(q,I){this._bufferSize=q,this._creationFlags=I,this._buffer=this._engine.createStorageBuffer(q,I,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(q,I,l){this._buffer&&this._engine.updateStorageBuffer(this._buffer,q,I,l)}async read(q,I,l,w){return await this._engine.readFromStorageBuffer(this._buffer,q,I,l,w)}dispose(){const q=this._engine._storageBuffers,I=q.indexOf(this);-1!==I&&(q[I]=q[q.length-1],q.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var K=l(12735),D=l(12740),M=l(12777),n=l(12733),f=l(13048),L=l(12591),E=l(12696),j=l(12970);class h{constructor(){this._gpuTimeInFrameId=-1,this.counter=new j.b}_addDuration(q,I){q<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==q?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(I,!1),this._gpuTimeInFrameId=q):this.counter.addCount(I,!1))}}var u=l(12647);class P{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=q,this._engine=I,this.uniqueId=f.e.UniqueId,I.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new h),this._engine.getCaps().supportComputeShaders?w.bindingsMapping?(this._context=I.createComputeContext(),this._shaderPath=l,this._options={bindingsMapping:{},defines:[],...w}):L.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):L.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(q,I){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const w=this._bindings[q];this._bindings[q]={type:l?0:4,object:I,indexInGroupEntries:null===w||void 0===w?void 0:w.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!w||w.object!==I||w.type!==this._bindings[q].type)}setStorageTexture(q,I){const l=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==I),this._bindings[q]={type:1,object:I,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setExternalTexture(q,I){const l=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==I),this._bindings[q]={type:6,object:I,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setVideoTexture(q,I){return!!I.externalTexture&&(this.setExternalTexture(q,I.externalTexture),!0)}setUniformBuffer(q,I){const l=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==I),this._bindings[q]={type:P._BufferIsDataBuffer(I)?7:2,object:I,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setStorageBuffer(q,I){const l=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==I),this._bindings[q]={type:P._BufferIsDataBuffer(I)?7:3,object:I,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setTextureSampler(q,I){const l=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!l||!I.compareSampler(l.object)),this._bindings[q]={type:5,object:I,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}isReady(){let q=this._effect;for(const t in this._bindings){const q=this._bindings[t],I=q.type,l=q.object;switch(I){case 0:case 4:case 1:if(!l.isReady())return!1;break;case 6:if(!l.isReady())return!1;break}}const I=[],l=this._shaderPath;if(this._options.defines)for(let t=0;t<this._options.defines.length;t++)I.push(this._options.defines[t]);const w=I.join("\n");return this._cachedDefines!==w&&(this._cachedDefines=w,q=this._engine.createComputeEffect(l,{defines:w,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=q),!!q.isReady()}dispatch(q,I,l){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,q,I,l,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const l=P._BufferIsDataBuffer(q)?q:q.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,l,I,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const I in this._bindings){const l=this._bindings[I];if(!this._options.bindingsMapping[I])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+I+"'");switch(l.type){case 0:{const w=this._samplers[I],t=l.object;var q;if(!w||!t._texture||!w.compareSampler(t._texture))this._samplers[I]=(new E.b).setParameters(t.wrapU,t.wrapV,t.wrapR,t.anisotropicFilteringLevel,t._texture.samplingMode,null===(q=t._texture)||void 0===q?void 0:q._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const q=l.object;q.getBuffer()!==l.buffer&&(l.buffer=q.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((t=>{(0,u.e)((()=>this.dispatch(q,I,l)),t,void 0,w)}))}serialize(){const q=M.c.Serialize(this);q.options=this._options,q.shaderPath=this._shaderPath,q.ux={},q.textures={};for(const I in this._bindings){const l=this._bindings[I],w=l.object;switch(l.type){case 0:case 4:case 1:{const t=w.serialize();t&&(q.textures[I]=t,q.ux[I]={type:l.type});break}}}return q}static Parse(q,I,l){const w=M.c.Parse((()=>new P(q.name,I.getEngine(),q.shaderPath,q.options)),q,I,l);for(const t in q.textures){const O=q.ux[t],c=n.d.Parse(q.textures[t],I,l);0===O.type?w.setTexture(t,c):4===O.type?w.setTexture(t,c,!1):w.setStorageTexture(t,c)}return w}static _BufferIsDataBuffer(q){return void 0!==q.underlyingResource}}(0,K.d)([(0,D.D)()],P.prototype,"name",void 0),(0,K.d)([(0,D.D)()],P.prototype,"fastMode",void 0),(0,a.e)("BABYLON.ComputeShader",P);var mq=l(13009);const Y="gpuUpdateParticlesComputeShader",y="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";e.e.ShadersStoreWGSL[Y]||(e.e.ShadersStoreWGSL[Y]=y);(0,a.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(q,I){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=q,this._engine=I}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var q;return(null===(q=this._updateComputeShader)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){var I;const l={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(l.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(l.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(l.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(l.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(l.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(l.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(l.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new P("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:l,defines:q.split("\n")}),null===(I=this._simParamsComputeShader)||void 0===I||I.dispose(),this._simParamsComputeShader=new mq.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new W(this._simParamsComputeShader)}createVertexBuffers(q,I){this._renderVertexBuffers.push(I)}createParticleBuffer(q){const I=new X(this._engine,4*q.length,11,"ComputeShaderParticleSystemBuffer");return I.update(q),this._bufferComputeShader.push(I),I.getBuffer()}bindDrawBuffers(q,I,l){this._engine.bindBuffers(this._renderVertexBuffers[q],l,I)}preUpdateParticleBuffer(){}updateParticleBuffer(q,I,l){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[q]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^q]),this._updateComputeShader.dispatch(Math.ceil(l/64))}releaseBuffers(){var q;for(let I=0;I<this._bufferComputeShader.length;++I)this._bufferComputeShader[I].dispose();this._bufferComputeShader.length=0,null===(q=this._simParamsComputeShader)||void 0===q||q.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class G{constructor(q,I,l){this.gradient=q,this.color1=I,this.color2=l}getColorToRef(q){this.color2?c.Dc.LerpToRef(this.color1,this.color2,Math.random(),q):q.t(this.color1)}}class N{constructor(q,I){this.gradient=q,this.color=I}}class J{constructor(q,I,l){this.gradient=q,this.factor1=I,this.factor2=l}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class z{static GetCurrentGradient(q,I,l){if(I[0].gradient>q)return void l(I[0],I[0],1);for(let t=0;t<I.length-1;t++){const w=I[t],O=I[t+1];if(q>=w.gradient&&q<=O.gradient){return void l(w,O,(q-w.gradient)/(O.gradient-w.gradient))}}const w=I.length-1;l(I[w],I[w],1)}}var H=l(12573),A=l(13206),Q=l(12612);class b{constructor(q){this.particleSystem=q,this.position=w.dI.Zero(),this.direction=w.dI.Zero(),this.color=new c.Dc(0,0,0,0),this.colorStep=new c.Dc(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new w.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new c.Dc(0,0,0,0),this._currentColor2=new c.Dc(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=b._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let q=this.age,I=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===I?(I=1,q=this._randomCellOffset):q+=this._randomCellOffset);const l=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let w;w=this._initialSpriteCellLoop?(0,s.Clamp)(q*I%this.lifeTime/this.lifeTime):(0,s.Clamp)(q*I/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+w*l|0}_inheritParticleInfoToSubEmitter(q){if(q.particleSystem.wI.position){const I=q.particleSystem.wI;if(I.position.t(this.position),q.inheritDirection){const q=w.TmpVectors.dI[0];this.direction.normalizeToRef(q),I.setDirection(q,0,Math.PI/2)}}else{q.particleSystem.wI.t(this.position)}this.direction.scaleToRef(q.inheritedVelocityAmount/2,w.TmpVectors.dI[0]),q.particleSystem._inheritedVelocityOffset.t(w.TmpVectors.dI[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const q of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(q)}_reset(){this.age=0,this.id=b._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(q){q.position.t(this.position),this._initialDirection?q._initialDirection?q._initialDirection.t(this._initialDirection):q._initialDirection=this._initialDirection.clone():q._initialDirection=null,q.direction.t(this.direction),this.TF&&(q.TF?q.TF.t(this.TF):q.TF=this.TF.clone()),q.color.t(this.color),q.colorStep.t(this.colorStep),q.lifeTime=this.lifeTime,q.age=this.age,q._randomCellOffset=this._randomCellOffset,q.size=this.size,q.scale.t(this.scale),q.angle=this.angle,q.angularSpeed=this.angularSpeed,q.particleSystem=this.particleSystem,q.cellIndex=this.cellIndex,q.id=this.id,q._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(q._currentColorGradient=this._currentColorGradient,q._currentColor1.t(this._currentColor1),q._currentColor2.t(this._currentColor2)),this._currentSizeGradient&&(q._currentSizeGradient=this._currentSizeGradient,q._currentSize1=this._currentSize1,q._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(q._currentAngularSpeedGradient=this._currentAngularSpeedGradient,q._currentAngularSpeed1=this._currentAngularSpeed1,q._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(q._currentVelocityGradient=this._currentVelocityGradient,q._currentVelocity1=this._currentVelocity1,q._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(q._currentLimitVelocityGradient=this._currentLimitVelocityGradient,q._currentLimitVelocity1=this._currentLimitVelocity1,q._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(q._currentDragGradient=this._currentDragGradient,q._currentDrag1=this._currentDrag1,q._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(q._initialStartSpriteCellId=this._initialStartSpriteCellId,q._initialEndSpriteCellId=this._initialEndSpriteCellId,q._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(q.remapData&&this.remapData?q.remapData.t(this.remapData):q.remapData=new w.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.t(this._randomNoiseCoordinates1),q._randomNoiseCoordinates2.t(this._randomNoiseCoordinates2)):(q._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),q._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}b._Count=0;var qq=l(12865),Iq=(l(12903),l(13116)),lq=l(13109),wq=l(13001);function tq(q,I){const l=(0,s.RandomRange)(0,1);c.Dc.LerpToRef(I.color1,I.color2,l,q.color),I.colorDead.subtractToRef(q.color,I._colorDiff),I._colorDiff.scaleToRef(1/q.lifeTime,q.colorStep)}function Oq(q,I){q._currentColorGradient=I._colorGradients[0],q._currentColorGradient.getColorToRef(q.color),q._currentColor1.t(q.color),I._colorGradients.length>1?I._colorGradients[1].getColorToRef(q._currentColor2):q._currentColor2.t(q.color)}function cq(q,I){const l=I._colorGradients;z.GetCurrentGradient(I._ratio,l,((I,l,w)=>{I!==q._currentColorGradient&&(q._currentColor1.t(q._currentColor2),l.getColorToRef(q._currentColor2),q._currentColorGradient=I),c.Dc.LerpToRef(q._currentColor1,q._currentColor2,w,q.color)}))}function aq(q,I){q.colorStep.scaleToRef(I._scaledUpdateSpeed,I._scaledColorStep),q.color.addInPlace(I._scaledColorStep),q.color.a<0&&(q.color.a=0)}function Fq(q,I){z.GetCurrentGradient(I._ratio,I._angularSpeedGradients,((I,l,w)=>{I!==q._currentAngularSpeedGradient&&(q._currentAngularSpeed1=q._currentAngularSpeed2,q._currentAngularSpeed2=l.getFactor(),q._currentAngularSpeedGradient=I),q.angularSpeed=(0,s.Lerp)(q._currentAngularSpeed1,q._currentAngularSpeed2,w)}))}function sq(q,I){q.angle+=q.angularSpeed*I._scaledUpdateSpeed}function Zq(q,I){I.particleEmitterType.startDirectionFunction(I._emitterWorldMatrix,q.direction,q,I.isLocal,I._emitterInverseWorldMatrix)}function rq(q,I){I.startDirectionFunction(I._emitterWorldMatrix,q.direction,q,I.isLocal)}function xq(q,I){q._currentVelocityGradient=I._velocityGradients[0],q._currentVelocity1=q._currentVelocityGradient.getFactor(),I._velocityGradients.length>1?q._currentVelocity2=I._velocityGradients[1].getFactor():q._currentVelocity2=q._currentVelocity1}function oq(q,I){q._currentLimitVelocityGradient=I._limitVelocityGradients[0],q._currentLimitVelocity1=q._currentLimitVelocityGradient.getFactor(),I._limitVelocityGradients.length>1?q._currentLimitVelocity2=I._limitVelocityGradients[1].getFactor():q._currentLimitVelocity2=q._currentLimitVelocity1}function dq(q,I){z.GetCurrentGradient(I._ratio,I._velocityGradients,((l,w,t)=>{l!==q._currentVelocityGradient&&(q._currentVelocity1=q._currentVelocity2,q._currentVelocity2=w.getFactor(),q._currentVelocityGradient=l),I._directionScale*=(0,s.Lerp)(q._currentVelocity1,q._currentVelocity2,t)}))}function Tq(q,I){z.GetCurrentGradient(I._ratio,I._limitVelocityGradients,((l,w,t)=>{l!==q._currentLimitVelocityGradient&&(q._currentLimitVelocity1=q._currentLimitVelocity2,q._currentLimitVelocity2=w.getFactor(),q._currentLimitVelocityGradient=l);const O=(0,s.Lerp)(q._currentLimitVelocity1,q._currentLimitVelocity2,t);q.direction.length()>O&&q.direction.scaleInPlace(I.limitVelocityDamping)}))}function Vq(q,I){q.direction.scaleToRef(I._directionScale,I._scaledDirection)}function Uq(q,I){I.particleEmitterType.startPositionFunction(I._emitterWorldMatrix,q.position,q,I.isLocal)}function Bq(q,I){I.startPositionFunction(I._emitterWorldMatrix,q.position,q,I.isLocal)}function vq(q,I){q.TF?q.TF.t(q.position):q.TF=q.position.clone(),w.dI.TransformCoordinatesToRef(q.TF,I._emitterWorldMatrix,q.position)}function kq(q,I){I.isLocal&&q.TF?(q.TF.addInPlace(I._scaledDirection),w.dI.TransformCoordinatesToRef(q.TF,I._emitterWorldMatrix,q.position)):q.position.addInPlace(I._scaledDirection)}function Cq(q,I){q._currentDragGradient=I._dragGradients[0],q._currentDrag1=q._currentDragGradient.getFactor(),I._dragGradients.length>1?q._currentDrag2=I._dragGradients[1].getFactor():q._currentDrag2=q._currentDrag1}function Rq(q,I){z.GetCurrentGradient(I._ratio,I._dragGradients,((l,w,t)=>{l!==q._currentDragGradient&&(q._currentDrag1=q._currentDrag2,q._currentDrag2=w.getFactor(),q._currentDragGradient=l);const O=(0,s.Lerp)(q._currentDrag1,q._currentDrag2,t);I._scaledDirection.scaleInPlace(1-O)}))}function Wq(q,I){q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.gc(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2.gc(Math.random(),Math.random(),Math.random())):(q._randomNoiseCoordinates1=new w.dI(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2=new w.dI(Math.random(),Math.random(),Math.random()))}function eq(q,I){const l=I._noiseTextureData,t=I._noiseTextureSize;if(l&&t&&q._randomNoiseCoordinates1){const O=I._fetchR(q._randomNoiseCoordinates1.x,q._randomNoiseCoordinates1.y,t.width,t.height,l),c=I._fetchR(q._randomNoiseCoordinates1.z,q._randomNoiseCoordinates2.x,t.width,t.height,l),a=I._fetchR(q._randomNoiseCoordinates2.y,q._randomNoiseCoordinates2.z,t.width,t.height,l),F=w.TmpVectors.dI[0],s=w.TmpVectors.dI[1];F.gc((2*O-1)*I.noiseStrength.x,(2*c-1)*I.noiseStrength.y,(2*a-1)*I.noiseStrength.z),F.scaleToRef(I._tempScaledUpdateSpeed,s),q.direction.addInPlace(s)}}function iq(q,I){I.gravity.scaleToRef(I._tempScaledUpdateSpeed,I._scaledGravity),q.direction.addInPlace(I._scaledGravity)}function Sq(q,I){q.size=(0,s.RandomRange)(I.minSize,I.maxSize),q.scale.gc((0,s.RandomRange)(I.minScaleX,I.maxScaleX),(0,s.RandomRange)(I.minScaleY,I.maxScaleY))}function gq(q,I){q._currentSizeGradient=I._sizeGradients[0],q._currentSize1=q._currentSizeGradient.getFactor(),q.size=q._currentSize1,I._sizeGradients.length>1?q._currentSize2=I._sizeGradients[1].getFactor():q._currentSize2=q._currentSize1,q.scale.gc((0,s.RandomRange)(I.minScaleX,I.maxScaleX),(0,s.RandomRange)(I.minScaleY,I.maxScaleY))}function pq(q,I){const l=I._actualFrame/I.targetStopDuration;z.GetCurrentGradient(l,I._startSizeGradients,((l,w,t)=>{l!==I._currentStartSizeGradient&&(I._currentStartSize1=I._currentStartSize2,I._currentStartSize2=w.getFactor(),I._currentStartSizeGradient=l);const O=(0,s.Lerp)(I._currentStartSize1,I._currentStartSize2,t);q.scale.scaleInPlace(O)}))}function Xq(q,I){z.GetCurrentGradient(I._ratio,I._sizeGradients,((I,l,w)=>{I!==q._currentSizeGradient&&(q._currentSize1=q._currentSize2,q._currentSize2=l.getFactor(),q._currentSizeGradient=I),q.size=(0,s.Lerp)(q._currentSize1,q._currentSize2,w)}))}function Kq(q,I){q.remapData=new w.Vector4(0,1,0,1)}function Dq(q,I){I._colorRemapGradients&&I._colorRemapGradients.length>0&&z.GetCurrentGradient(I._ratio,I._colorRemapGradients,((I,l,w)=>{const t=(0,s.Lerp)(I.factor1,l.factor1,w),O=(0,s.Lerp)(I.factor2,l.factor2,w);q.remapData.x=t,q.remapData.y=O-t})),I._alphaRemapGradients&&I._alphaRemapGradients.length>0&&z.GetCurrentGradient(I._ratio,I._alphaRemapGradients,((I,l,w)=>{const t=(0,s.Lerp)(I.factor1,l.factor1,w),O=(0,s.Lerp)(I.factor2,l.factor2,w);q.remapData.z=t,q.remapData.w=O-t}))}function Mq(q,I){const l=(0,s.Clamp)(I._actualFrame/I.targetStopDuration);z.GetCurrentGradient(l,I._lifeTimeGradients,((I,w)=>{const t=I,O=w,c=t.getFactor(),a=O.getFactor(),F=(l-t.gradient)/(O.gradient-t.gradient);q.lifeTime=(0,s.Lerp)(c,a,F)})),I._emitPower=(0,s.RandomRange)(I.minEmitPower,I.maxEmitPower)}function nq(q,I){q.lifeTime=(0,s.RandomRange)(I.minLifeTime,I.maxLifeTime),I._emitPower=(0,s.RandomRange)(I.minEmitPower,I.maxEmitPower)}function fq(q,I){0===I._emitPower?(q._initialDirection?q._initialDirection.t(q.direction):q._initialDirection=q.direction.clone(),q.direction.set(0,0,0)):(q._initialDirection=null,q.direction.scaleInPlace(I._emitPower)),q.direction.addInPlace(I._inheritedVelocityOffset)}function Lq(q,I){q.angularSpeed=(0,s.RandomRange)(I.minAngularSpeed,I.maxAngularSpeed),q.angle=(0,s.RandomRange)(I.minInitialRotation,I.maxInitialRotation)}function Eq(q,I){q._currentAngularSpeedGradient=I._angularSpeedGradients[0],q.angularSpeed=q._currentAngularSpeedGradient.getFactor(),q._currentAngularSpeed1=q.angularSpeed,I._angularSpeedGradients.length>1?q._currentAngularSpeed2=I._angularSpeedGradients[1].getFactor():q._currentAngularSpeed2=q._currentAngularSpeed1,q.angle=(0,s.RandomRange)(I.minInitialRotation,I.maxInitialRotation)}function jq(q,I){q._initialStartSpriteCellId=I.startSpriteCellID,q._initialEndSpriteCellId=I.endSpriteCellID,q._initialSpriteCellLoop=I.spriteCellLoop}function hq(q,I){q.previousItem=I.previousItem,q.nextItem=I,I.previousItem&&(I.previousItem.nextItem=q),I.previousItem=q}function uq(q,I){q.previousItem=I,q.nextItem=I.nextItem,I.nextItem&&(I.nextItem.previousItem=q),I.nextItem=q}function Pq(q,I){let l=I;for(;l.nextItem;)l=l.nextItem;q.previousItem=l,q.nextItem=l.nextItem,l.nextItem=q}function mI(q){q.previousItem&&(q.previousItem.nextItem=q.nextItem),q.nextItem&&(q.nextItem.previousItem=q.previousItem)}class Yq extends F{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(q){this._startDirectionFunction!==q&&(this._startDirectionFunction=q,this._directionProcessing.process=q?rq:Zq)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(q){this._startPositionFunction!==q&&(this._startPositionFunction=q,this._positionCreation.process=q?Bq:Uq)}set onDispose(q){this._onDisposeObserver&&this.tc.remove(this._onDisposeObserver),this._onDisposeObserver=this.tc.add(q)}get Z(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(q){this._useRampGradients!==q&&(this._useRampGradients=q,this._resetEffect(),q?(this._rampCreation={process:Kq,previousItem:null,nextItem:null},uq(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Dq,previousItem:null,nextItem:null},uq(this._remapGradientProcessing,this._gravityProcessing)):(mI(this._rampCreation),mI(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(q){this._isLocal!==q&&(this._isLocal=q,q?(this._isLocalCreation={process:vq,previousItem:null,nextItem:null},uq(this._isLocalCreation,this._positionCreation)):mI(this._isLocalCreation))}get particles(){return this.Mx}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(q){this._animationSheetEnabled!==q&&(this._animationSheetEnabled=q,q?(this._sheetCreation={process:jq,previousItem:null,nextItem:null},uq(this._sheetCreation,this._colorCreation)):mI(this._sheetCreation),this._reset())}getActiveCount(){return this.Mx.length}getClassName(){return"hc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var q;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[I])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[I]=new qq.e(this._engine),this._customWrappers[I].effect=q,this._customWrappers[I].drawContext&&(this._customWrappers[I].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new H.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(q){if(this.noiseTexture!==q){if(this._noiseTexture=q,!q)return mI(this._noiseCreation),void mI(this._noiseProcessing);this._noiseCreation={process:Wq,previousItem:null,nextItem:null},uq(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:eq,previousItem:null,nextItem:null},uq(this._noiseProcessing,this._positionProcessing)}}constructor(q,I,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(q),this._emitterInverseWorldMatrix=w.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new w.dI,this.tc=new H.d,this.onStoppedObservable=new H.d,this.onStartedObservable=new H.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Mx=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new c.Dc(0,0,0,0),this._colorDiff=new c.Dc(0,0,0,0),this._scaledDirection=w.dI.Zero(),this._scaledGravity=w.dI.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=q=>{},this.recycleParticle=q=>{const I=this.Mx.pop();I!==q&&I.copyTo(q),this._stockParticles.push(I)},this._createParticle=()=>{let q;return 0!==this._stockParticles.length?(q=this._stockParticles.pop(),q._reset()):q=new b(this),this._prepareParticle(q),q},this.paused=!1,this._shadersLoaded=!1,this._capacity=I,this._epsilon=a,l&&"Scene"!==l.getClassName()?(this._engine=l,this.defaultProjectionMatrix=w.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=l||Q.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Kx.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:nq,previousItem:null,nextItem:null},this._positionCreation={process:Uq,previousItem:null,nextItem:null},uq(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Zq,previousItem:null,nextItem:null},uq(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:fq,previousItem:null,nextItem:null},uq(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Sq,previousItem:null,nextItem:null},uq(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Lq,previousItem:null,nextItem:null},uq(this._angleCreation,this._sizeCreation),this._colorCreation={process:tq,previousItem:null,nextItem:null},uq(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,F||(this._colorProcessing={process:aq,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:sq,previousItem:null,nextItem:null},uq(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Vq,previousItem:null,nextItem:null},uq(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:kq,previousItem:null,nextItem:null},uq(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:iq,previousItem:null,nextItem:null},uq(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=O,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new qq.e(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new r,this.updateFunction=q=>{var I;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(I=this.noiseTexture.getContent())||void 0===I||I.then((q=>{this._noiseTextureData=q})));const l=q===this.Mx;for(let w=0;w<q.length;w++){const I=q[w];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const t=I.age;if(I.age+=this._tempScaledUpdateSpeed,I.age>I.lifeTime){const q=I.age-t,l=I.lifeTime-t;this._tempScaledUpdateSpeed=l*this._tempScaledUpdateSpeed/q,I.age=I.lifeTime}this._ratio=I.age/I.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let O=this._updateQueueStart;for(;O;)O.process(I,this),O=O.nextItem;if(this._isAnimationSheetEnabled&&!F&&I.updateCellIndex(),I._inheritParticleInfoToSubEmitters(),I.age>=I.lifeTime){if(this._emitFromParticle(I),I._attachedSubEmitters){for(const q of I._attachedSubEmitters)q.particleSystem.disposeOnStop=!0,q.particleSystem.stop();I._attachedSubEmitters=null}this.recycleParticle(I),l&&w--}else;}}}serialize(q){throw new Error("Method not implemented.")}clone(q,I){throw new Error("Method not implemented.")}_addFactorGradient(q,I,l,w){const t=new J(I,l,w);q.push(t),q.sort(((q,I)=>q.gradient<I.gradient?-1:q.gradient>I.gradient?1:0))}_removeFactorGradient(q,I){if(!q)return;let l=0;for(const w of q){if(w.gradient===I){q.splice(l,1);break}l++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Mq:this._lifeTimeCreation.process=nq}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:pq,previousItem:null,nextItem:null},uq(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(mI(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(q){this.targetStopDuration!==q&&(this._targetStopDuration=q,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(q,I,l){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,q,I,l),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(q){return this._removeFactorGradient(this._lifeTimeGradients,q),this._syncLifeTimeCreation(),this}addSizeGradient(q,I,l){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=gq,this._sizeGradientProcessing={process:Xq,previousItem:null,nextItem:null},hq(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,q,I,l),this}removeSizeGradient(q){var I;return this._removeFactorGradient(this._sizeGradients,q),0===(null===(I=this._sizeGradients)||void 0===I?void 0:I.length)&&(mI(this._sizeGradientProcessing),this._sizeCreation.process=Sq),this}addColorRemapGradient(q,I,l){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,q,I,l),this}removeColorRemapGradient(q){return this._removeFactorGradient(this._colorRemapGradients,q),this}addAlphaRemapGradient(q,I,l){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,q,I,l),this}removeAlphaRemapGradient(q){return this._removeFactorGradient(this._alphaRemapGradients,q),this}addAngularSpeedGradient(q,I,l){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Eq,this._angularSpeedGradientProcessing={process:Fq,previousItem:null,nextItem:null},hq(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,q,I,l),this}removeAngularSpeedGradient(q){var I;return this._removeFactorGradient(this._angularSpeedGradients,q),0===(null===(I=this._angularSpeedGradients)||void 0===I?void 0:I.length)&&(this._angleCreation.process=Lq,mI(this._angularSpeedGradientProcessing)),this}addVelocityGradient(q,I,l){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:xq,previousItem:null,nextItem:null},uq(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:dq,previousItem:null,nextItem:null},hq(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,q,I,l),this}removeVelocityGradient(q){var I;return this._removeFactorGradient(this._velocityGradients,q),0===(null===(I=this._velocityGradients)||void 0===I?void 0:I.length)&&(mI(this._velocityCreation),mI(this._velocityGradientProcessing)),this}addLimitVelocityGradient(q,I,l){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:oq,previousItem:null,nextItem:null},uq(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Tq,previousItem:null,nextItem:null},uq(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,q,I,l),this}removeLimitVelocityGradient(q){var I;return this._removeFactorGradient(this._limitVelocityGradients,q),0===(null===(I=this._limitVelocityGradients)||void 0===I?void 0:I.length)&&(mI(this._limitVelocityCreation),mI(this._limitVelocityGradientProcessing)),this}addDragGradient(q,I,l){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Cq,previousItem:null,nextItem:null},hq(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Rq,previousItem:null,nextItem:null},hq(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,q,I,l),this}removeDragGradient(q){var I;return this._removeFactorGradient(this._dragGradients,q),0===(null===(I=this._dragGradients)||void 0===I?void 0:I.length)&&(mI(this._dragCreation),mI(this._dragGradientProcessing)),this}addEmitRateGradient(q,I,l){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,q,I,l),this}removeEmitRateGradient(q){return this._removeFactorGradient(this._emitRateGradients,q),this}addStartSizeGradient(q,I,l){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,q,I,l),this._syncStartSizeCreation(),this}removeStartSizeGradient(q){return this._removeFactorGradient(this._startSizeGradients,q),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const q=new Uint8Array(4*this._rawTextureWidth),I=c.TmpColors.BI[0];for(let l=0;l<this._rawTextureWidth;l++){const w=l/this._rawTextureWidth;z.GetCurrentGradient(w,this._rampGradients,((w,t,O)=>{c.BI.LerpToRef(w.color,t.color,O,I),q[4*l]=255*I.r,q[4*l+1]=255*I.g,q[4*l+2]=255*I.b,q[4*l+3]=255}))}this._rampGradientsTexture=A.d.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((q,I)=>q.gradient<I.gradient?-1:q.gradient>I.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(q,I){this._rampGradients||(this._rampGradients=[]);const l=new N(q,I);return this._rampGradients.push(l),this._syncRampGradientTexture(),this}removeRampGradient(q){return this._removeGradientAndTexture(q,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(q,I,l){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Oq,this._colorProcessing.process=cq);const w=new G(q,I,l);return this._colorGradients.push(w),this._colorGradients.sort(((q,I)=>q.gradient<I.gradient?-1:q.gradient>I.gradient?1:0)),this}removeColorGradient(q){if(!this._colorGradients)return this;let I=0;for(const l of this._colorGradients){if(l.gradient===q){this._colorGradients.splice(I,1);break}I++}return 0===this._colorGradients.length&&(this._colorCreation.process=tq,this._colorProcessing.process=aq),this}resetDrawCache(){if(this._drawWrappers){for(const q of this._drawWrappers)if(q)for(const I of q)null===I||void 0===I||I.dispose();this._drawWrappers=[]}}_fetchR(q,I,l,w,t){return t[4*(((q=.5*Math.abs(q)+.5)*l%l|0)+((I=.5*Math.abs(I)+.5)*w%w|0)*l)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const q=this._engine,I=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*I),this._vertexBuffer=new C.b(q,this._vertexData,!0,I);let l=0;const w=this._vertexBuffer.createVertexBuffer(C.c.PositionKind,l,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[C.c.PositionKind]=w,l+=3;const t=this._vertexBuffer.createVertexBuffer(C.c.ColorKind,l,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[C.c.ColorKind]=t,l+=4;const O=this._vertexBuffer.createVertexBuffer("angle",l,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=O,l+=1;const c=this._vertexBuffer.createVertexBuffer("size",l,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=c,l+=2,this._isAnimationSheetEnabled){const q=this._vertexBuffer.createVertexBuffer("cellIndex",l,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=q,l+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const q=this._vertexBuffer.createVertexBuffer("direction",l,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=q,l+=3}if(this._useRampGradients){const q=this._vertexBuffer.createVertexBuffer("remapData",l,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=q,l+=4}let a;if(this._useInstancing){const I=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new C.b(q,I,!1,2),a=this._spriteBuffer.createVertexBuffer("offset",0,2)}else a=this._vertexBuffer.createVertexBuffer("offset",l,2,this._vertexBufferSize,this._useInstancing),l+=2;this._vertexBuffers.offset=a,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const q=[],I=[];let l=0;for(let w=0;w<this._capacity;w++)q.push(l),q.push(l+1),q.push(l+2),q.push(l),q.push(l+2),q.push(l+3),I.push(l,l+1,l+1,l+2,l+2,l+3,l+3,l,l,l+3),l+=4;this._indexBuffer=this._engine.createIndexBuffer(q),this._linesIndexBuffer=this._engine.createIndexBuffer(I)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(q)setTimeout((()=>{this.start(0)}),q);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var I;-1!==(null===(I=this.wI)||void 0===I?void 0:I.getClassName().indexOf("Mesh"))&&this.wI.Cc(!0);const q=this.noiseTexture;if(q&&q.onGeneratedObservable)q.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let I=0;I<this.preWarmCycles;I++)this.animate(!0),q.render()}))}));else for(let I=0;I<this.preWarmCycles;I++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(q))}_postStop(q){}reset(){this._stockParticles.length=0,this.Mx.length=0}_appendParticleVertex(q,I,l,t){let O=q*this._vertexBufferSize;if(this._vertexData[O++]=I.position.x+this.us.x,this._vertexData[O++]=I.position.y+this.us.y,this._vertexData[O++]=I.position.z+this.us.z,this._vertexData[O++]=I.color.r,this._vertexData[O++]=I.color.g,this._vertexData[O++]=I.color.b,this._vertexData[O++]=I.color.a,this._vertexData[O++]=I.angle,this._vertexData[O++]=I.scale.x*I.size,this._vertexData[O++]=I.scale.y*I.size,this._isAnimationSheetEnabled&&(this._vertexData[O++]=I.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[O++]=I.direction.x,this._vertexData[O++]=I.direction.y,this._vertexData[O++]=I.direction.z);else if(I._initialDirection){let q=I._initialDirection;this.isLocal&&(w.dI.TransformNormalToRef(q,this._emitterWorldMatrix,w.TmpVectors.dI[0]),q=w.TmpVectors.dI[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[O++]=q.x,this._vertexData[O++]=q.y,this._vertexData[O++]=q.z}else{let q=I.direction;this.isLocal&&(w.dI.TransformNormalToRef(q,this._emitterWorldMatrix,w.TmpVectors.dI[0]),q=w.TmpVectors.dI[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[O++]=q.x,this._vertexData[O++]=q.y,this._vertexData[O++]=q.z}this._useRampGradients&&I.remapData&&(this._vertexData[O++]=I.remapData.x,this._vertexData[O++]=I.remapData.y,this._vertexData[O++]=I.remapData.z,this._vertexData[O++]=I.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===l?l=this._epsilon:1===l&&(l=1-this._epsilon),0===t?t=this._epsilon:1===t&&(t=1-this._epsilon)),this._vertexData[O++]=l,this._vertexData[O++]=t)}_prepareParticle(q){}_createNewOnes(q){let I;for(let l=0;l<q&&this.Mx.length!==this._capacity;l++){I=this._createParticle(),this.Mx.push(I);let q=this._createQueueStart;for(;q;)q.process(I,this),q=q.nextItem;I._inheritParticleInfoToSubEmitters()}}_update(q){if(this._alive=this.Mx.length>0,this.wI.position){const q=this.wI;this._emitterWorldMatrix=q.getWorldMatrix()}else{const q=this.wI;this._emitterWorldMatrix=w.Matrix.Translation(q.x,q.y,q.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Mx),this._createNewOnes(q)}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=[C.c.PositionKind,C.c.ColorKind,"angle","offset","size"];return q&&w.push("cellIndex"),I||w.push("direction"),l&&w.push("remapData"),w}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Iq.b)(w),q&&w.push("particlesInfos"),I&&w.push("logarithmicDepthConstant"),l&&(w.push("vFogInfos"),w.push("vFogColor")),w}fillDefines(q,I){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Iq.k)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&q.push("#define FOG")),this._isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),I===F.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&q.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case 2:q.push("#define BILLBOARDY");break;case 8:case 9:q.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&q.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:q.push("#define BILLBOARDMODE_ALL")}l&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,I,l){I.push(...Yq._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),q.push(...Yq._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),l.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,wq.i)(q,this._imageProcessingConfigurationDefines),(0,wq.e)(l,this._imageProcessingConfigurationDefines))}_getWrapper(q){const I=this._getCustomDrawWrapper(q);if(null!==I&&void 0!==I&&I.effect)return I;const l=[];this.fillDefines(l,q);const w=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let t=this._drawWrappers[w];t||(t=this._drawWrappers[w]=[]);let O=t[q];O||(O=new qq.e(this._engine),O.drawContext&&(O.drawContext.useInstancing=this._useInstancing),t[q]=O);const c=l.join("\n");if(O.defines!==c){const q=[],I=[],l=[];this.fillUniformsAttributesAndSamplerNames(I,q,l),O.setEffect(this._engine.createEffect("particles",q,I,l,c,void 0,void 0,void 0,void 0,this._shaderLanguage),c)}return O}animate(){var q;let I,l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!l&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(l?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this.manualEmitCount>-1)I=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let q=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const I=this._actualFrame/this.targetStopDuration;z.GetCurrentGradient(I,this._emitRateGradients,((I,l,w)=>{I!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=l.getFactor(),this._currentEmitRateGradient=I),q=(0,s.Lerp)(this._currentEmitRate1,this._currentEmitRate2,w)}))}I=q*this._scaledUpdateSpeed|0,this._newPartsExcess+=q*this._scaledUpdateSpeed-I}if(this._newPartsExcess>1&&(I+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?I=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(I),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!l){let q=0;for(let I=0;I<this.Mx.length;I++){const l=this.Mx[I];this._appendParticleVertices(q,l),q+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Mx.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(q,I){this._appendParticleVertex(q++,I,0,0),this._useInstancing||(this._appendParticleVertex(q++,I,1,0),this._appendParticleVertex(q++,I,1,1),this._appendParticleVertex(q++,I,0,1))}rebuild(){var q;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(q=this._spriteBuffer)||void 0===q||q._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Yq.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(l.bind(l,14214)),Promise.resolve().then(l.bind(l,14158))])):await Promise.all([Promise.resolve().then(l.bind(l,14151)),Promise.resolve().then(l.bind(l,14137))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.wI||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==F.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(F.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(F.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(q){const I=this._getWrapper(q),l=I.effect,t=this._engine;t.enableEffect(I);const O=this.defaultViewMatrix??this._scene.getViewMatrix();if(l.setTexture("diffuseSampler",this.particleTexture),l.setMatrix("view",O),l.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();l.setFloat3("particlesInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,this.spriteCellWidth/q.width)}if(l.setVector2("translationPivot",this.translationPivot),l.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;l.setVector3("eyePosition",q.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),l.setTexture("rampSampler",this._rampGradientsTexture));const c=l.defines;var a,F,s,Z,r,x;(this._scene&&((0,Iq.c)(l,this,this._scene),this.applyFog&&(0,lq.f)(this._scene,void 0,l)),c.indexOf("#define BILLBOARDMODE_ALL")>=0&&(O.invertToRef(w.TmpVectors.Matrix[0]),l.setMatrix("invView",w.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?t.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,l):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,l)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?t.bindBuffers(this._vertexBuffers,null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?this._linesIndexBuffer:this._indexBuffer,l):t.bindBuffers(this._vertexBuffers,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBufferUseInstancing:null,l);(this.useLogarithmicDepth&&this._scene&&(0,lq.l)(c,l,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(l),this._setEngineBasedOnBlendMode(q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(l),this._useInstancing)?null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?t.drawElementsType(6,0,10,this.Mx.length):t.drawArraysType(7,0,4,this.Mx.length):null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?t.drawElementsType(1,0,10*this.Mx.length):t.drawElementsType(0,0,6*this.Mx.length);return this.Mx.length}render(){if(!this.isReady()||!this.Mx.length)return 0;const q=this._engine;q.setState&&(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0));let I=0;return I=this.blendMode===F.BLENDMODE_MULTIPLYADD?this._render(F.BLENDMODE_MULTIPLY)+this._render(F.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),I}_onDispose(){}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(I,l),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const q=this._scene.Kx.indexOf(this);q>-1&&this._scene.Kx.splice(q,1),this._scene._activeParticleSystems.dispose()}this.tc.notifyObservers(this),this.tc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Yq.ForceGLSL=!1;var yq,Gq=l(12603);!function(q){q[q.ATTACHED=0]="ATTACHED",q[q.END=1]="END"}(yq||(yq={}));class Nq{constructor(q){if(this.particleSystem=q,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!q.wI||!q.wI.dispose){const I=(0,a.b)("BABYLON.AbstractMesh");q.wI=new I("SubemitterSystemEmitter",q.Wq()),q._disposeEmitterOnDispose=!0}}clone(){let q=this.particleSystem.wI;if(q){if(q instanceof w.dI)q=q.clone();else if(-1!==q.getClassName().indexOf("Mesh")){q=new((0,a.b)("BABYLON.Mesh"))("",q.Wq()),q.isVisible=!1}}else q=new w.dI;const I=new Nq(this.particleSystem.clone(this.particleSystem.name,q));return I.particleSystem.name+="Clone",I.type=this.type,I.inheritDirection=this.inheritDirection,I.inheritedVelocityAmount=this.inheritedVelocityAmount,I.particleSystem._disposeEmitterOnDispose=!0,I.particleSystem.disposeOnStop=!0,I}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};return I.type=this.type,I.inheritDirection=this.inheritDirection,I.inheritedVelocityAmount=this.inheritedVelocityAmount,I.particleSystem=this.particleSystem.serialize(q),I}static _ParseParticleSystem(q,I,l){throw(0,Gq.b)("ParseParticle")}static Parse(q,I,l){const w=q.particleSystem,t=new Nq(Nq._ParseParticleSystem(w,I,l,!0));return t.type=q.type,t.inheritDirection=q.inheritDirection,t.inheritedVelocityAmount=q.inheritedVelocityAmount,t.particleSystem._isSubEmitter=!0,t}dispose(){this.particleSystem.dispose()}}var Jq=l(12656);function zq(q,I){const l=new U;return l.direction1=q,l.direction2=I,l}function Hq(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Aq(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Qq(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.dI(0,1,0),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.dI(0,1,0);return new v(q,I,l)}function bq(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function qI(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.dI(0,1,0),O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.dI(0,1,0);return new T(q,I,l,t,O)}function II(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new x(q,I)}function lI(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.dI(0,1,0),t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.dI(0,1,0);return new o(q,I,l,t)}const wI=w.dI.Zero(),tI=w.dI.Zero(),OI=w.dI.Zero();class cI{constructor(){this.strength=0,this.position=w.dI.Zero()}_processParticle(q,I){this.position.subtractToRef(q.position,wI);const l=wI.lengthSquared()+1;wI.normalize().scaleToRef(this.strength/l,tI),tI.scaleToRef(I._tempScaledUpdateSpeed,OI),q.direction.addInPlace(OI)}serialize(){return{position:this.position.Uc(),strength:this.strength}}}class aI extends Yq{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=q=>{if(!this._subEmitters||0===this._subEmitters.length)return;const I=Math.floor(Math.random()*this._subEmitters.length);for(const l of this._subEmitters[I])if(1===l.type){const I=l.clone();q._inheritParticleInfoToSubEmitter(I),I.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(I.particleSystem),I.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(q,I){const l=zq(q,I);return this.particleEmitterType=l,l}get flowMap(){return this._flowMap}set flowMap(q){this._flowMap!==q&&(this._flowMap=q,this._flowMapUpdate&&(mI(this._flowMapUpdate),this._flowMapUpdate=null),q&&(this._flowMapUpdate={process:q=>{var I;const l=null===(I=this.Wq())||void 0===I?void 0:I.getTransformMatrix();this._flowMap._processParticle(q,this.flowMapStrength*this._tempScaledUpdateSpeed,l)},previousItem:null,nextItem:null},uq(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(q){this._attractors.push(q),1===this._attractors.length&&(this._attractorUpdate={process:q=>{for(const I of this._attractors)I._processParticle(q,this)},previousItem:null,nextItem:null},uq(this._attractorUpdate,this._directionProcessing))}removeAttractor(q){const I=this._attractors.indexOf(q);-1!==I&&this._attractors.splice(I,1),0===this._attractors.length&&mI(this._attractorUpdate)}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(q)}createHemisphericEmitter(){const q=Hq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=Aq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=Qq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.dI(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.dI(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=bq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=qI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.dI(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.dI(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=II(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=lI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.dI(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.dI(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,I,l,w){const t=new r;return this.particleEmitterType=t,this.direction1=q,this.direction2=I,this.minEmitBox=l,this.maxEmitBox=w,t}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const q of this.subEmitters)q instanceof aI?this._subEmitters.push([new Nq(q)]):q instanceof Nq?this._subEmitters.push([q]):q instanceof Array&&this._subEmitters.push(q)}_stopSubEmitters(){if(this.activeSubSystems){for(const q of this.activeSubSystems)q.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const q=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==q&&this._rootParticleSystem.activeSubSystems.splice(q,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(q){q&&this._stopSubEmitters()}_prepareParticle(q){if(this._subEmitters&&this._subEmitters.length>0){const I=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];q._attachedSubEmitters=[];for(const l of I)if(0===l.type){const I=l.clone();q._attachedSubEmitters.push(I),I.particleSystem.start()}}}_onDispose(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),q&&this.particles)for(const l of this.particles)if(l._attachedSubEmitters)for(let q=l._attachedSubEmitters.length-1;q>=0;q-=1)l._attachedSubEmitters[q].dispose();if(I&&this.activeSubSystems)for(let l=this.activeSubSystems.length-1;l>=0;l-=1)this.activeSubSystems[l].dispose();if(this._subEmitters&&this._subEmitters.length){for(let q=0;q<this._subEmitters.length;q++)for(const I of this._subEmitters[q])I.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.wI&&this.wI.dispose&&this.wI.dispose(!0)}static _Parse(q,I,l,t){let O;O=l instanceof Jq.d?null:l;const F=(0,a.b)("BABYLON.Texture");if(F&&O&&(q.texture?I.particleTexture=F.Parse(q.texture,O,t):q.textureName&&(I.particleTexture=new F(t+q.textureName,O,!1,void 0===q.invertY||q.invertY),I.particleTexture.name=q.textureName)),q.emitterId||0===q.emitterId||void 0!==q.wI?q.emitterId&&O?I.wI=O.getLastMeshById(q.emitterId):I.wI=w.dI.vI(q.wI):I.wI=w.dI.Zero(),I.isLocal=!!q.isLocal,void 0!==q.renderingGroupId&&(I.renderingGroupId=q.renderingGroupId),void 0!==q.isBillboardBased&&(I.isBillboardBased=q.isBillboardBased),void 0!==q.billboardMode&&(I.billboardMode=q.billboardMode),void 0!==q.useLogarithmicDepth&&(I.useLogarithmicDepth=q.useLogarithmicDepth),q.animations){for(let l=0;l<q.animations.length;l++){const w=q.animations[l],t=(0,a.b)("BABYLON.Animation");t&&I.animations.push(t.Parse(w))}I.beginAnimationOnStart=q.beginAnimationOnStart,I.beginAnimationFrom=q.beginAnimationFrom,I.beginAnimationTo=q.beginAnimationTo,I.beginAnimationLoop=q.beginAnimationLoop}if(q.autoAnimate&&O&&O.beginAnimation(I,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),I.startDelay=0|q.startDelay,I.minAngularSpeed=q.minAngularSpeed,I.maxAngularSpeed=q.maxAngularSpeed,I.minSize=q.minSize,I.maxSize=q.maxSize,q.minScaleX&&(I.minScaleX=q.minScaleX,I.maxScaleX=q.maxScaleX,I.minScaleY=q.minScaleY,I.maxScaleY=q.maxScaleY),void 0!==q.preWarmCycles&&(I.preWarmCycles=q.preWarmCycles,I.preWarmStepOffset=q.preWarmStepOffset),void 0!==q.minInitialRotation&&(I.minInitialRotation=q.minInitialRotation,I.maxInitialRotation=q.maxInitialRotation),I.minLifeTime=q.minLifeTime,I.maxLifeTime=q.maxLifeTime,I.minEmitPower=q.minEmitPower,I.maxEmitPower=q.maxEmitPower,I.emitRate=q.emitRate,I.gravity=w.dI.vI(q.gravity),q.noiseStrength&&(I.noiseStrength=w.dI.vI(q.noiseStrength)),I.color1=c.Dc.vI(q.color1),I.color2=c.Dc.vI(q.color2),I.colorDead=c.Dc.vI(q.colorDead),I.updateSpeed=q.updateSpeed,I.targetStopDuration=q.targetStopDuration,I.blendMode=q.blendMode,q.colorGradients)for(const w of q.colorGradients)I.addColorGradient(w.gradient,c.Dc.vI(w.color1),w.color2?c.Dc.vI(w.color2):void 0);if(q.rampGradients){for(const l of q.rampGradients)I.addRampGradient(l.gradient,c.BI.vI(l.color));I.useRampGradients=q.useRampGradients}if(q.colorRemapGradients)for(const w of q.colorRemapGradients)I.addColorRemapGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(q.alphaRemapGradients)for(const w of q.alphaRemapGradients)I.addAlphaRemapGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(q.sizeGradients)for(const w of q.sizeGradients)I.addSizeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(q.angularSpeedGradients)for(const w of q.angularSpeedGradients)I.addAngularSpeedGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(q.velocityGradients)for(const w of q.velocityGradients)I.addVelocityGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(q.dragGradients)for(const w of q.dragGradients)I.addDragGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(q.emitRateGradients)for(const w of q.emitRateGradients)I.addEmitRateGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(q.startSizeGradients)for(const w of q.startSizeGradients)I.addStartSizeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(q.lifeTimeGradients)for(const w of q.lifeTimeGradients)I.addLifeTimeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(q.limitVelocityGradients){for(const l of q.limitVelocityGradients)I.addLimitVelocityGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);I.limitVelocityDamping=q.limitVelocityDamping}if(q.noiseTexture&&O){const l=(0,a.b)("BABYLON.ProceduralTexture");I.noiseTexture=l.Parse(q.noiseTexture,O,t)}let s;if(q.particleEmitterType){switch(q.particleEmitterType.type){case"SphereParticleEmitter":s=new B;break;case"SphereDirectedParticleEmitter":s=new v;break;case"ConeEmitter":case"ConeParticleEmitter":s=new x;break;case"ConeDirectedParticleEmitter":s=new o;break;case"CylinderParticleEmitter":s=new d;break;case"CylinderDirectedParticleEmitter":s=new T;break;case"HemisphericParticleEmitter":s=new V;break;case"PointParticleEmitter":s=new U;break;case"MeshParticleEmitter":s=new R;break;case"CustomParticleEmitter":s=new k;break;default:s=new r}s.parse(q.particleEmitterType,O)}else s=new r,s.parse(q,O);I.particleEmitterType=s,I.startSpriteCellID=q.startSpriteCellID,I.endSpriteCellID=q.endSpriteCellID,I.spriteCellLoop=q.spriteCellLoop??!0,I.spriteCellWidth=q.spriteCellWidth,I.spriteCellHeight=q.spriteCellHeight,I.spriteCellChangeSpeed=q.spriteCellChangeSpeed,I.spriteRandomStartCell=q.spriteRandomStartCell,I.disposeOnStop=q.disposeOnStop??!1,I.manualEmitCount=q.manualEmitCount??-1}static Parse(q,I,l){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4?arguments[4]:void 0;const a=q.name;let F,s,Z=null,r=null;if(I instanceof Jq.d?F=I:(s=I,F=s.getEngine()),q.customShader&&F.createEffectForParticles){r=q.customShader;const I=r.shaderOptions.defines.length>0?r.shaderOptions.defines.join("\n"):"";Z=F.createEffectForParticles(r.shaderPath.fragmentElement,r.shaderOptions.uniforms,r.shaderOptions.samplers,I)}const x=new aI(a,O||q.Zl,I,Z,q.isAnimationSheetEnabled);if(x.customShader=r,x._rootUrl=l,q.id&&(x.id=q.id),q.subEmitters){x.subEmitters=[];for(const w of q.subEmitters){const q=[];for(const t of w)q.push(Nq.Parse(t,I,l));x.subEmitters.push(q)}}if(q.attractors)for(const c of q.attractors){const q=new cI;q.position=w.dI.vI(c.position),q.strength=c.strength,x.addAttractor(q)}return aI._Parse(q,x,I,l),q.textureMask&&(x.textureMask=c.Dc.vI(q.textureMask)),q.us&&(x.us=w.dI.vI(q.us)),q.preventAutoStart&&(x.preventAutoStart=q.preventAutoStart),t||x.preventAutoStart||x.start(),x}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};if(aI._Serialize(I,this,q),I.textureMask=this.textureMask.Uc(),I.customShader=this.customShader,I.preventAutoStart=this.preventAutoStart,I.us=this.us.Uc(),this.subEmitters){I.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const l of this._subEmitters){const w=[];for(const I of l)w.push(I.serialize(q));I.subEmitters.push(w)}}if(this._attractors&&this._attractors.length){I.attractors=[];for(const q of this._attractors)I.attractors.push(q.serialize())}return I}static _Serialize(q,I,l){if(q.name=I.name,q.id=I.id,q.Zl=I.getCapacity(),q.disposeOnStop=I.disposeOnStop,q.manualEmitCount=I.manualEmitCount,I.wI.position){const l=I.wI;q.emitterId=l.id}else{const l=I.wI;q.wI=l.Uc()}I.particleEmitterType&&(q.particleEmitterType=I.particleEmitterType.serialize()),I.particleTexture&&(l?q.texture=I.particleTexture.serialize():(q.textureName=I.particleTexture.name,q.invertY=!!I.particleTexture._invertY)),q.isLocal=I.isLocal,M.c.AppendSerializedAnimations(I,q),q.beginAnimationOnStart=I.beginAnimationOnStart,q.beginAnimationFrom=I.beginAnimationFrom,q.beginAnimationTo=I.beginAnimationTo,q.beginAnimationLoop=I.beginAnimationLoop,q.startDelay=I.startDelay,q.renderingGroupId=I.renderingGroupId,q.isBillboardBased=I.isBillboardBased,q.billboardMode=I.billboardMode,q.minAngularSpeed=I.minAngularSpeed,q.maxAngularSpeed=I.maxAngularSpeed,q.minSize=I.minSize,q.maxSize=I.maxSize,q.minScaleX=I.minScaleX,q.maxScaleX=I.maxScaleX,q.minScaleY=I.minScaleY,q.maxScaleY=I.maxScaleY,q.minEmitPower=I.minEmitPower,q.maxEmitPower=I.maxEmitPower,q.minLifeTime=I.minLifeTime,q.maxLifeTime=I.maxLifeTime,q.emitRate=I.emitRate,q.gravity=I.gravity.Uc(),q.noiseStrength=I.noiseStrength.Uc(),q.color1=I.color1.Uc(),q.color2=I.color2.Uc(),q.colorDead=I.colorDead.Uc(),q.updateSpeed=I.updateSpeed,q.targetStopDuration=I.targetStopDuration,q.blendMode=I.blendMode,q.preWarmCycles=I.preWarmCycles,q.preWarmStepOffset=I.preWarmStepOffset,q.minInitialRotation=I.minInitialRotation,q.maxInitialRotation=I.maxInitialRotation,q.startSpriteCellID=I.startSpriteCellID,q.spriteCellLoop=I.spriteCellLoop,q.endSpriteCellID=I.endSpriteCellID,q.spriteCellChangeSpeed=I.spriteCellChangeSpeed,q.spriteCellWidth=I.spriteCellWidth,q.spriteCellHeight=I.spriteCellHeight,q.spriteRandomStartCell=I.spriteRandomStartCell,q.isAnimationSheetEnabled=I.isAnimationSheetEnabled,q.useLogarithmicDepth=I.useLogarithmicDepth;const w=I.getColorGradients();if(w){q.colorGradients=[];for(const I of w){const l={gradient:I.gradient,color1:I.color1.Uc()};I.color2?l.color2=I.color2.Uc():l.color2=I.color1.Uc(),q.colorGradients.push(l)}}const t=I.getRampGradients();if(t){q.rampGradients=[];for(const I of t){const l={gradient:I.gradient,color:I.color.Uc()};q.rampGradients.push(l)}q.useRampGradients=I.useRampGradients}const O=I.getColorRemapGradients();if(O){q.colorRemapGradients=[];for(const I of O){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.colorRemapGradients.push(l)}}const c=I.getAlphaRemapGradients();if(c){q.alphaRemapGradients=[];for(const I of c){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.alphaRemapGradients.push(l)}}const a=I.getSizeGradients();if(a){q.sizeGradients=[];for(const I of a){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.sizeGradients.push(l)}}const F=I.getAngularSpeedGradients();if(F){q.angularSpeedGradients=[];for(const I of F){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.angularSpeedGradients.push(l)}}const s=I.getVelocityGradients();if(s){q.velocityGradients=[];for(const I of s){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.velocityGradients.push(l)}}const Z=I.getDragGradients();if(Z){q.dragGradients=[];for(const I of Z){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.dragGradients.push(l)}}const r=I.getEmitRateGradients();if(r){q.emitRateGradients=[];for(const I of r){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.emitRateGradients.push(l)}}const x=I.getStartSizeGradients();if(x){q.startSizeGradients=[];for(const I of x){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.startSizeGradients.push(l)}}const o=I.getLifeTimeGradients();if(o){q.lifeTimeGradients=[];for(const I of o){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.lifeTimeGradients.push(l)}}const d=I.getLimitVelocityGradients();if(d){q.limitVelocityGradients=[];for(const I of d){const l={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?l.factor2=I.factor2:l.factor2=I.factor1,q.limitVelocityGradients.push(l)}q.limitVelocityDamping=I.limitVelocityDamping}I.noiseTexture&&(q.noiseTexture=I.noiseTexture.serialize())}clone(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w={...this._customWrappers};let t=null;const O=this._engine;if(O.createEffectForParticles&&null!=this.customShader){t=this.customShader;const q=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"",I=O.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,q);w[0]?w[0].effect=I:this.setCustomEffect(I,0)}const c=this.serialize(l),a=aI.Parse(c,this._scene||this._engine,this._rootUrl);return a.name=q,a.customShader=t,a._customWrappers=w,void 0===I&&(I=this.wI),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.wI=I,this.preventAutoStart||a.start(),a}}aI.BILLBOARDMODE_Y=2,aI.BILLBOARDMODE_ALL=7,aI.BILLBOARDMODE_STRETCHED=8,aI.BILLBOARDMODE_STRETCHED_LOCAL=9,Nq._ParseParticleSystem=aI.Parse;var FI=l(12990),sI=l(12987),ZI=l(12875);ZI.d.prototype.createTransformFeedback=function(){const q=this._gl.createTransformFeedback();if(!q)throw new Error("Unable to create Transform Feedback");return q},ZI.d.prototype.deleteTransformFeedback=function(q){this._gl.deleteTransformFeedback(q)},ZI.d.prototype.bindTransformFeedback=function(q){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,q)},ZI.d.prototype.beginTransformFeedback=function(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(q?this._gl.POINTS:this._gl.TRIANGLES)},ZI.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},ZI.d.prototype.setTranformFeedbackVaryings=function(q,I){this._gl.transformFeedbackVaryings(q,I,this._gl.INTERLEAVED_ATTRIBS)},ZI.d.prototype.bindTransformFeedbackBuffer=function(q){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q?q.underlyingResource:null)},ZI.d.prototype.readTransformFeedbackBuffer=function(q){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q)};const rI="clipPlaneFragmentDeclaration2",xI="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";e.e.IncludesShadersStore[rI]||(e.e.IncludesShadersStore[rI]=xI);l(14045),l(14053),l(14060),l(14066),l(14069),l(14072),l(14077),l(14082);const oI="gpuRenderParticlesPixelShader",dI="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";e.e.ShadersStore[oI]||(e.e.ShadersStore[oI]=dI);const TI="clipPlaneVertexDeclaration2",VI="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";e.e.IncludesShadersStore[TI]||(e.e.IncludesShadersStore[TI]=VI);l(14089),l(14092),l(14098),l(14105);const UI="gpuRenderParticlesVertexShader",BI="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";e.e.ShadersStore[UI]||(e.e.ShadersStore[UI]=BI);class vI extends F{static get IsSupported(){if(!Q.e.LastCreatedEngine)return!1;const q=Q.e.LastCreatedEngine.getCaps();return q.supportTransformFeedbacks||q.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(q){this._maxActiveParticleCount=Math.min(q,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(q){this.maxActiveParticleCount=q}createPointEmitter(q,I){const l=zq(q,I);return this.particleEmitterType=l,l}createHemisphericEmitter(){const q=Hq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=Aq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=Qq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.dI(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.dI(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=bq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=qI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.dI(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.dI(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=II(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=lI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.dI(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.dI(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,I,l,w){const t=new r;return this.particleEmitterType=t,this.direction1=q,this.direction2=I,this.minEmitBox=l,this.maxEmitBox=w,t}get flowMap(){return this._flowMap}set flowMap(q){this._flowMap!==q&&(this._flowMap=q)}isReady(){if(!this.wI||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==aI.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(aI.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(aI.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";q?setTimeout((()=>{this.start(0)}),q):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var q;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[I])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[I]=new qq.e(this._engine),this._customWrappers[I].effect=q}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new H.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(q,I,l){return super._removeGradientAndTexture(q,I,l),this._releaseBuffers(),this}addColorGradient(q,I){this._colorGradients||(this._colorGradients=[]);const l=new G(q,I);return this._colorGradients.push(l),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(q&&this._colorGradients.sort(((q,I)=>q.gradient<I.gradient?-1:q.gradient>I.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(q){return this._removeGradientAndTexture(q,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const I in this._drawWrappers){var q;null===(q=this._drawWrappers[I].drawContext)||void 0===q||q.reset()}}_addFactorGradient(q,I,l){const w=new J(I,l);q.push(w),this._releaseBuffers()}addSizeGradient(q,I){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,q,I),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(q){return this._removeGradientAndTexture(q,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(q,I){if(!q)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&q.sort(((q,I)=>q.gradient<I.gradient?-1:q.gradient>I.gradient?1:0));const l=this;l[I]&&(l[I].dispose(),l[I]=null)}addAngularSpeedGradient(q,I){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,q,I),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(q){return this._removeGradientAndTexture(q,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(q,I){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,q,I),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(q){return this._removeGradientAndTexture(q,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(q,I){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,q,I),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(q){return this._removeGradientAndTexture(q,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(q,I){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,q,I),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(q){return this._removeGradientAndTexture(q,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(q){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(q,I,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(q),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.tc=new H.d,this.onStoppedObservable=new H.d,this.onStartedObservable=new H.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,l&&"Scene"!==l.getClassName()?(this._engine=l,this.defaultProjectionMatrix=w.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=l||Q.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Kx.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,a.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,a.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new qq.e(this._engine)},this._customWrappers[0].effect=t,this._drawWrappers={0:new qq.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(I=I??{}).randomTextureSize||delete I.randomTextureSize;const c={Zl:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...I},F=I;isFinite(F)&&(c.Zl=F),this._capacity=c.Zl,this._maxActiveParticleCount=c.Zl,this._currentActiveCount=0,this._isAnimationSheetEnabled=O,this.particleEmitterType=new r;const s=Math.min(this._engine.getCaps().maxTextureSize,c.randomTextureSize);let Z=[];for(let w=0;w<s;++w)Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random());this._randomTexture=new A.d(new Float32Array(Z),s,1,5,l,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,Z=[];for(let w=0;w<s;++w)Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random());this._randomTexture2=new A.d(new Float32Array(Z),s,1,5,l,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=s}_reset(){this._releaseBuffers()}_createVertexBuffers(q,I,l){const w={};w.position=I.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let t=3;w.age=I.createVertexBuffer("age",t,1,this._attributesStrideSize,!0),t+=1,w.size=I.createVertexBuffer("size",t,3,this._attributesStrideSize,!0),t+=3,w.life=I.createVertexBuffer("life",t,1,this._attributesStrideSize,!0),t+=1,t+=4,this.billboardMode===aI.BILLBOARDMODE_STRETCHED&&(w.direction=I.createVertexBuffer("direction",t,3,this._attributesStrideSize,!0)),t+=3,this._platform.alignDataInBuffer&&(t+=1),this.particleEmitterType instanceof k&&(t+=3,this._platform.alignDataInBuffer&&(t+=1)),this._colorGradientsTexture||(w.color=I.createVertexBuffer("color",t,4,this._attributesStrideSize,!0),t+=4),this._isBillboardBased||(w.initialDirection=I.createVertexBuffer("initialDirection",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),this.noiseTexture&&(w.noiseCoordinates1=I.createVertexBuffer("noiseCoordinates1",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1),w.noiseCoordinates2=I.createVertexBuffer("noiseCoordinates2",t,3,this._attributesStrideSize,!0),t+=3,this._platform.alignDataInBuffer&&(t+=1)),w.angle=I.createVertexBuffer("angle",t,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?t++:t+=2,this._isAnimationSheetEnabled&&(w.cellIndex=I.createVertexBuffer("cellIndex",t,1,this._attributesStrideSize,!0),t+=1,this.spriteRandomStartCell&&(w.cellStartOffset=I.createVertexBuffer("cellStartOffset",t,1,this._attributesStrideSize,!0),t+=1)),w.offset=l.createVertexBuffer("offset",0,2),w.uv=l.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(w),this._platform.createVertexBuffers(q,w),this.resetDrawCache()}_initialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!q)return;const I=this._engine,l=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof k&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const t=this.particleEmitterType instanceof k,O=w.TmpVectors.dI[0];let c=0;for(let w=0;w<this._capacity;w++)if(l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),t?(this.particleEmitterType.particleDestinationGenerator(w,null,O),l.push(O.x),l.push(O.y),l.push(O.z)):(l.push(0),l.push(0),l.push(0)),this._platform.alignDataInBuffer&&l.push(0),c+=16,t&&(this.particleEmitterType.particlePositionGenerator(w,null,O),l.push(O.x),l.push(O.y),l.push(O.z),this._platform.alignDataInBuffer&&l.push(0),c+=4),this._colorGradientsTexture||(l.push(0),l.push(0),l.push(0),l.push(0),c+=4),this.isBillboardBased||(l.push(0),l.push(0),l.push(0),this._platform.alignDataInBuffer&&l.push(0),c+=4),this.noiseTexture&&(l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),this._platform.alignDataInBuffer&&l.push(0),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),this._platform.alignDataInBuffer&&l.push(0),c+=8),l.push(0),c+=1,this._angularSpeedGradientsTexture||(l.push(0),c+=1),this._isAnimationSheetEnabled&&(l.push(0),c+=1,this.spriteRandomStartCell&&(l.push(0),c+=1)),this._platform.alignDataInBuffer){let q=3-(c+3&3);for(c+=q;q-- >0;)l.push(0)}const a=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),F=this._platform.createParticleBuffer(l),s=this._platform.createParticleBuffer(l);this._buffer0=new C.b(I,F,!1,this._attributesStrideSize),this._buffer1=new C.b(I,s,!1,this._attributesStrideSize),this._spriteBuffer=new C.b(I,a,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let q=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(q+="\n#define BILLBOARD"),this._colorGradientsTexture&&(q+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(q+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(q+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(q+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(q+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(q+="\n#define DRAGGRADIENTS"),this._flowMap&&(q+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(q+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(q+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(q+="\n#define NOISE"),this.isLocal&&(q+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===q||(this._cachedUpdateDefines=q,this._updateBuffer=this._platform.createUpdateBuffer(q)),this._platform.isUpdateBufferReady()}_getWrapper(q){const I=this._getCustomDrawWrapper(q);if(null!==I&&void 0!==I&&I.effect)return I;const l=[];this.fillDefines(l,q);let w=this._drawWrappers[q];w||(w=new qq.e(this._engine),w.drawContext&&(w.drawContext.useInstancing=!0),this._drawWrappers[q]=w);const t=l.join("\n");if(w.defines!==t){const q=[],I=[],l=[];this.fillUniformsAttributesAndSamplerNames(I,q,l),w.setEffect(this._engine.createEffect("gpuRenderParticles",q,I,l,t),t)}return w}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=[C.c.PositionKind,"age","life","size","angle"];return q||t.push(C.c.ColorKind),I&&t.push("cellIndex"),l||t.push("initialDirection"),w&&t.push("direction"),t.push("offset",C.c.UVKind),t}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=["emitterWM","us","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Iq.b)(w),q&&w.push("sheetInfos"),I&&w.push("logarithmicDepthConstant"),l&&(w.push("vFogInfos"),w.push("vFogColor")),w}fillDefines(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Iq.k)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==sI.e.FOGMODE_NONE&&q.push("#define FOG")),I===aI.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this.isLocal&&q.push("#define LOCAL"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case aI.BILLBOARDMODE_Y:q.push("#define BILLBOARDY");break;case aI.BILLBOARDMODE_STRETCHED:q.push("#define BILLBOARDSTRETCHED");break;case aI.BILLBOARDMODE_ALL:q.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&q.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),l&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,I,l){I.push(...vI._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===aI.BILLBOARDMODE_STRETCHED)),q.push(...vI._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),l.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(FI.c.PrepareUniforms(q,this._imageProcessingConfigurationDefines),FI.c.PrepareSamplers(l,this._imageProcessingConfigurationDefines))}animate(){var q;let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(I?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(q,I){const l=this[I];if(!q||!q.length||l)return;const w=new Float32Array(this._rawTextureWidth);for(let t=0;t<this._rawTextureWidth;t++){const I=t/this._rawTextureWidth;z.GetCurrentGradient(I,q,((q,I,l)=>{w[t]=(0,s.Lerp)(q.factor1,I.factor1,l)}))}this[I]=A.d.CreateRTexture(w,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[I].name=I.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const q=new Uint8Array(4*this._rawTextureWidth),I=c.TmpColors.Dc[0];for(let l=0;l<this._rawTextureWidth;l++){const w=l/this._rawTextureWidth;z.GetCurrentGradient(w,this._colorGradients,((w,t,O)=>{c.Dc.LerpToRef(w.color1,t.color1,O,I),q[4*l]=255*I.r,q[4*l+1]=255*I.g,q[4*l+2]=255*I.b,q[4*l+3]=255*I.a}))}this._colorGradientsTexture=A.d.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(q,I){var l,t,O,c;const a=this._getWrapper(q),F=a.effect;this._engine.enableEffect(a);const s=(null===(l=this._scene)||void 0===l?void 0:l.getViewMatrix())||w.Matrix.IdentityReadOnly;if(F.setMatrix("view",s),F.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),F.setTexture("diffuseSampler",this.particleTexture),F.setVector2("translationPivot",this.translationPivot),F.setVector3("us",this.us),this.isLocal&&F.setMatrix("emitterWM",I),this._colorGradientsTexture?F.setTexture("colorGradientSampler",this._colorGradientsTexture):F.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();F.setFloat3("sheetInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,q.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;F.setVector3("eyePosition",q.globalPosition)}const Z=F.defines;if(this._scene&&((0,Iq.c)(F,this,this._scene),this.applyFog&&(0,lq.f)(this._scene,void 0,F)),Z.indexOf("#define BILLBOARDMODE_ALL")>=0){const q=s.clone();q.invert(),F.setMatrix("invView",q)}return this.useLogarithmicDepth&&this._scene&&(0,lq.l)(Z,F,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(F),this._setEngineBasedOnBlendMode(q),this._platform.bindDrawBuffers(this._targetIndex,F,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(F),null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(c=this._scene)&&void 0!==c&&c.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(q){if(!this.wI||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!q)if(this.wI.position){q=this.wI.getWorldMatrix()}else{const I=this.wI;q=w.TmpVectors.Matrix[0],w.Matrix.TranslationToRef(I.x,I.y,I.z,q)}const I=this._engine,l=I.getDepthWrite();if(I.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const q=this.Wq();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",q.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",q),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const t=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=t,I.setDepthWrite(l)}render(){let q,I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!I&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let q=0;q<this.preWarmCycles;q++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const q=0|this._accumulatedCount;this._accumulatedCount-=q,this._currentActiveCount+=q}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.wI.position){q=this.wI.getWorldMatrix()}else{const I=this.wI;q=w.TmpVectors.Matrix[0],w.Matrix.TranslationToRef(I.x,I.y,I.z,q)}const t=this._engine;this.updateInAnimate||this._update(q);let O=0;return I||l||(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0),O=this.blendMode===aI.BLENDMODE_MULTIPLYADD?this._render(aI.BLENDMODE_MULTIPLY,q)+this._render(aI.BLENDMODE_ADD,q):this._render(this.blendMode,q),this._engine.setAlphaMode(0)),O}rebuild(){const q=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(q,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,q()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const I in this._drawWrappers){this._drawWrappers[I].dispose()}if(this._drawWrappers={},this._scene){const q=this._scene.Kx.indexOf(this);q>-1&&this._scene.Kx.splice(q,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let I=0;I<this._renderVertexBuffers.length;++I){const q=this._renderVertexBuffers[I];for(const I in q)q[I].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.tc.notifyObservers(this),this.tc.clear()}clone(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w={...this._customWrappers};let t=null;const O=this._engine;if(O.createEffectForParticles&&null!=this.customShader){t=this.customShader;const q=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"";w[0]=O.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,q,void 0,void 0,void 0,this)}const c=this.serialize(l),a=vI.Parse(c,this._scene||this._engine,this._rootUrl);return a.name=q,a.customShader=t,a._customWrappers=w,void 0===I&&(I=this.wI),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.wI=I,a}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};return aI._Serialize(I,this,q),I.activeParticleCount=this.activeParticleCount,I.randomTextureSize=this._randomTextureSize,I.customShader=this.customShader,I}static Parse(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0;const O=q.name;let c,a;I instanceof Jq.d?c=I:(a=I,c=a.getEngine());const F=new vI(O,{Zl:t||q.Zl,randomTextureSize:q.randomTextureSize},I,null,q.isAnimationSheetEnabled);if(F._rootUrl=l,q.customShader&&c.createEffectForParticles){const I=q.customShader,l=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"",w=c.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,l,void 0,void 0,void 0,F);F.setCustomEffect(w,0),F.customShader=I}return q.id&&(F.id=q.id),q.activeParticleCount&&(F.activeParticleCount=q.activeParticleCount),aI._Parse(q,F,I,l),q.preventAutoStart&&(F.preventAutoStart=q.preventAutoStart),w||F.preventAutoStart||F.start(),F}}var kI=l(12564),CI=l(14108),RI=l(13122);class WI{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(q){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const I of this.systems)I.wI=q;this._emitterNode=q}setEmitterAsSphere(q,I,l){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:q,renderingGroupId:I};const w=(0,CI.e)("emitterSphere",{diameter:q.diameter,segments:q.segments},l);w.renderingGroupId=I;const t=new RI.UI("emitterSphereMaterial",l);t.emissiveColor=q.color,w.material=t;for(const O of this.systems)O.wI=w;this._emitterNode=w}start(q){for(const I of this.systems)q&&(I.wI=q),I.start()}dispose(){for(const q of this.systems)q.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={systems:[]};for(const l of this.systems)I.systems.push(l.serialize(q));return this._emitterNode&&(I.wI=this._emitterCreationOptions),I}static Parse(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;const t=new WI,O=this.BaseAssetsUrl+"/textures/";I=I||Q.e.LastCreatedScene;for(const c of q.systems)t.systems.push(l?vI.Parse(c,I,O,!0,w):aI.Parse(c,I,O,!0,w));if(q.wI){const l=q.wI.options;if("Sphere"===q.wI.kind)t.setEmitterAsSphere({diameter:l.diameter,segments:l.segments,color:c.BI.vI(l.color)},q.wI.renderingGroupId,I)}return t}}WI.BaseAssetsUrl="https://assets.babylonjs.com/particles";var eI=l(12607);class iI{static CreateDefault(q){let I,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,w=arguments.length>2?arguments[2]:void 0;I=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new vI("default system",{Zl:l},w):new aI("default system",l,w),I.wI=q;const t=kI.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return I.particleTexture=new n.d(t,I.Wq()),I.createConeEmitter(.1,Math.PI/4),I.color1=new c.Dc(1,1,1,1),I.color2=new c.Dc(1,1,1,1),I.colorDead=new c.Dc(1,1,1,0),I.minSize=.1,I.maxSize=.1,I.minEmitPower=2,I.maxEmitPower=2,I.updateSpeed=1/60,I.emitRate=30,I}static CreateAsync(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;I||(I=Q.e.LastCreatedScene);const t={};return I.addPendingData(t),new Promise(((O,c)=>{if(l&&!vI.IsSupported)return I.removePendingData(t),c("Particle system with GPU is not supported.");kI.Tools.LoadFile(`${iI.BaseAssetsUrl}/systems/${q}.json`,(q=>{I.removePendingData(t);const c=JSON.parse(q.toString());return O(WI.Parse(c,I,l,w))}),void 0,void 0,void 0,(()=>(I.removePendingData(t),c(`An error occurred with the creation of your particle system. Check if your type '${q}' exists.`))))}))}static ExportSet(q){const I=new WI;for(const l of q)I.systems.push(l);return I}static ParseFromFileAsync(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",O=arguments.length>5?arguments[5]:void 0;return new Promise(((c,a)=>{const F=new eI.c;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const I=JSON.parse(F.responseText);let a;a=w?vI.Parse(I,l,t,!1,O):aI.Parse(I,l,t,!1,O),q&&(a.name=q),c(a)}else a("Unable to load the particle system")})),F.open("GET",I),F.send()}))}static ParseFromSnippetAsync(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0;if("_BLANK"===q){const q=this.CreateDefault(null);return q.start(),Promise.resolve(q)}return new Promise(((O,c)=>{const a=new eI.c;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const c=JSON.parse(JSON.parse(a.responseText).jsonPayload),F=JSON.parse(c.particleSystem);let s;s=l?vI.Parse(F,I,w,!1,t):aI.Parse(F,I,w,!1,t),s.snippetId=q,O(s)}else c("Unable to load the snippet "+q)})),a.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),a.send()}))}}iI.BaseAssetsUrl=WI.BaseAssetsUrl,iI.SnippetUrl="https://snippet.babylonjs.com",iI.CreateFromSnippetAsync=iI.ParseFromSnippetAsync;var SI=l(13184),gI=l(13021),pI=l(14116);(0,pI.f)(gI.c.NAME_PARTICLESYSTEM,((q,I,l,w)=>{const t=(0,pI.i)(gI.c.NAME_PARTICLESYSTEM);if(t&&void 0!==q.Kx&&null!==q.Kx)for(let O=0,c=q.Kx.length;O<c;O++){const c=q.Kx[O];l.Kx.push(t(c,I,w))}})),(0,pI.d)(gI.c.NAME_PARTICLESYSTEM,((q,I,l)=>{if(q.activeParticleCount){return vI.Parse(q,I,l)}return aI.Parse(q,I,l)})),Jq.d.prototype.createEffectForParticles=function(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",O=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,F=arguments.length>7?arguments[7]:void 0,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Z=arguments.length>9?arguments[9]:void 0,r=[],x=[];const o=[];return F?F.fillUniformsAttributesAndSamplerNames(x,r,o):(r=aI._GetAttributeNamesOrOptions(),x=aI._GetEffectCreationOptions()),-1===t.indexOf(" BILLBOARD")&&(t+="\n#define BILLBOARD\n"),null!==F&&void 0!==F&&F.isAnimationSheetEnabled&&-1===t.indexOf(" ANIMATESHEET")&&(t+="\n#define ANIMATESHEET\n"),-1===w.indexOf("diffuseSampler")&&w.push("diffuseSampler"),this.createEffect({vertex:Z??(null===F||void 0===F?void 0:F.vertexShaderName)??"particles",fragmentElement:q},r,x.concat(I),o.concat(w),t,O,c,a,void 0,s,(async()=>{0===s?await Promise.resolve().then(l.bind(l,14151)):await Promise.resolve().then(l.bind(l,14214))}))},SI.c.prototype.getEmittedParticleSystems=function(){const q=[];for(let I=0;I<this.Wq().Kx.length;I++){const l=this.Wq().Kx[I];l.wI===this&&q.push(l)}return q},SI.c.prototype.getHierarchyEmittedParticleSystems=function(){const q=[],I=this.getDescendants();I.push(this);for(let l=0;l<this.Wq().Kx.length;l++){const w=this.Wq().Kx[l],t=w.wI;t.position&&-1!==I.indexOf(t)&&q.push(w)}return q};l(13096),l(13103),l(13173);l(13175),l(14121),l(12953),l(13082),l(13203);l(12948);var XI;l(14123),l(12765);!function(q){q[q.Color=2]="Color",q[q.UV=1]="UV",q[q.Random=0]="Random",q[q.Stated=3]="Stated"}(XI||(XI={}));var KI=l(12975);const DI=new w.dI(0,0,0),MI=new w.dI(0,0,0),nI=new w.dI(0,0,0);class fI{constructor(q,I,l){this.width=q,this.height=I,this.data=l}processFlowable(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2?arguments[2]:void 0;if(!l)return;l instanceof w.Matrix?w.dI.TransformCoordinatesToRef(q.position,l,nI):(nI.x=l.x,nI.y=l.y,nI.z=l.z);const t=.5*nI.x+.5,O=1-(.5*nI.y+.5),c=Math.floor(t*this.width),a=Math.floor(O*this.height);if(c<0||c>=this.width||a<0||a>=this.height)return;const F=4*(a*this.width+c),s=this.data[F]/255*2-1,Z=this.data[F+1]/255*2-1,r=this.data[F+2]/255*2-1,x=this.data[F+3]/255;DI.set(s,Z,r),DI.scaleToRef(I*x,MI),q.direction.addInPlace(MI)}_processParticle(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2?arguments[2]:void 0;this.processFlowable(q,I,l)}static async FromUrlAsync(q){return await new Promise(((I,l)=>{const w=document.createElement("canvas"),t=w.getContext("2d");let O=null;const c=new Image;c.crossOrigin="anonymous",c.src=q,c.onerror=I=>{l(new Error(`Failed to load image: ${q} : ${I}`))},c.onload=()=>{w.width=c.width,w.height=c.height,t.drawImage(c,0,0),O=t.getImageData(0,0,w.width,w.height),I(new fI(w.width,w.height,O.data))}}))}static async ExtractFromTextureAsync(q){return await new Promise(((I,l)=>{if(!q.isReady())return void q.onLoadObservable.addOnce((async()=>{try{const l=await this.ExtractFromTextureAsync(q);I(l)}catch(w){l(w)}}));const w=q.getSize();KI.i.GetTextureDataAsync(q,w.width,w.height).then((q=>{I(new fI(w.width,w.height,new Uint8ClampedArray(q)))})).catch(l)}))}}var LI,EI,jI,hI,uI,PI,ml,YI,yI;!function(q){q[q.Int=1]="Int",q[q.Float=2]="Float",q[q.Vector2=4]="Vector2",q[q.dI=8]="dI",q[q.Matrix=16]="Matrix",q[q.Particle=32]="Particle",q[q.Texture=64]="Texture",q[q.Dc=128]="Dc",q[q.FloatGradient=256]="FloatGradient",q[q.Vector2Gradient=512]="Vector2Gradient",q[q.Vector3Gradient=1024]="Vector3Gradient",q[q.Color4Gradient=2048]="Color4Gradient",q[q.System=4096]="System",q[q.AutoDetect=8192]="AutoDetect",q[q.BasedOnInput=16384]="BasedOnInput",q[q.Undefined=32768]="Undefined",q[q.All=65535]="All"}(LI||(LI={})),function(q){q[q.Compatible=0]="Compatible",q[q.TypeIncompatible=1]="TypeIncompatible",q[q.HierarchyIssue=2]="HierarchyIssue"}(EI||(EI={})),function(q){q[q.Input=0]="Input",q[q.Output=1]="Output"}(jI||(jI={}));class GI{get direction(){return this._direction}get type(){if(this._type===LI.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===LI.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(q){this._type=q}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((q=>q.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(q,I,l){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=LI.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new H.d,this.onDisconnectionObservable=new H.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=I,this.name=q,this._direction=l}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(q){var I;return this.isConnected?null!==(I=this._connectedPoint)&&void 0!==I&&I._storedFunction?this._connectedPoint._storedFunction(q):this._connectedPoint._storedValue:this.value}canConnectTo(q){return 0===this.checkCompatibilityState(q)}checkCompatibilityState(q){const I=this._ownerBlock,l=q.ownerBlock;if(this.type!==q.type&&q.innerType!==LI.AutoDetect)return q.acceptedConnectionPointTypes&&-1!==q.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(q.excludedConnectionPointTypes&&-1!==q.excludedConnectionPointTypes.indexOf(this.type))return 1;let w=l,t=I;return 0===this.direction&&(w=I,t=l),w.isAnAncestorOf(t)?2:0}connectTo(q){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(q))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${q.ownerBlock.name}".${q.name}`;return this._endpoints.push(q),q._connectedPoint=this,this.onConnectionObservable.notifyObservers(q),q.onConnectionObservable.notifyObservers(this),this}disconnectFrom(q){const I=this._endpoints.indexOf(q);return-1===I||(this._endpoints.splice(I,1),q._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(q),q.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(q){let I=1;for(;I<LI.All;)q&I||this.excludedConnectionPointTypes.push(I),I<<=1}serialize(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const I={};return I.name=this.name,I.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Uc?(I.valueType="BABYLON."+this.value.getClassName(),I.value=this.value.Uc()):(I.valueType="number",I.value=this.value)),q&&this.connectedPoint&&(I.inputName=this.name,I.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,I.targetConnectionName=this.connectedPoint.name,I.isExposedOnFrame=!0,I.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(I.isExposedOnFrame=!0,I.exposedPortPosition=this.exposedPortPosition),I}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class NI{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(q){this._name=q}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(q){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new H.d,this.tc=new H.d,this.onInputChangedObservable=new H.d,this.visibleOnFrame=!1,this._name=q,this.uniqueId=f.e.UniqueId}_inputRename(q){return q}_outputRename(q){return q}isAnAncestorOf(q){for(const I of this._outputs)if(I.hasEndpoints)for(const l of I.endpoints){if(l.ownerBlock===q)return!0;if(l.ownerBlock.isAnAncestorOf(q))return!0}return!1}isAnAncestorOfType(q){if(this.getClassName()===q)return!0;for(const I of this._outputs)if(I.hasEndpoints)for(const l of I.endpoints)if(l.ownerBlock.isAnAncestorOfType(q))return!0;return!1}getInputByName(q){const I=this._inputs.filter((I=>I.name===q));return I.length?I[0]:null}_linkConnectionTypes(q,I){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[I]._acceptedConnectionPointType=this._inputs[q]:(this._inputs[q]._linkedConnectionSource=this._inputs[I],this._inputs[q]._isMainLinkSource=!0),this._inputs[I]._linkedConnectionSource=this._inputs[q]}registerInput(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0;const c=new GI(q,this,0);return c.type=I,c.isOptional=l,c.defaultValue=w,c.value=w,c.valueMin=t,c.valueMax=O,this._inputs.push(c),this.onInputChangedObservable.notifyObservers(c),this}registerOutput(q,I,l){return(l=l??new GI(q,this,1)).type=I,this._outputs.push(l),this}_build(q){}_customBuildStep(q){}build(q){if(this._buildId===q.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((q=>q.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=q.buildId;for(const I of this._inputs){if(!I.connectedPoint){I.isOptional||q.notConnectedNonOptionalInputs.push(I);continue}const l=I.connectedPoint.ownerBlock;l&&l!==this&&!l.isSystem&&l.build(q)}return this._customBuildStep(q),q.verbose&&L.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(q),this.onBuildObservable.notifyObservers(this),!1}serialize(){const q={};q.customType="BABYLON."+this.getClassName(),q.id=this.uniqueId,q.name=this.name,q.visibleOnFrame=this.visibleOnFrame,q.inputs=[],q.outputs=[];for(const I of this.inputs)q.inputs.push(I.serialize());for(const I of this.outputs)q.outputs.push(I.serialize(!1));return q}_deserialize(q){this._name=q.name,this.comments=q.comments,this.visibleOnFrame=!!q.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(q)}_deserializePortDisplayNamesAndExposedOnFrame(q){const I=q.inputs,l=q.outputs;if(I)for(const w of I){const q=this.inputs.find((q=>q.name===w.name));if(!q)return;if(w.displayName&&(q.displayName=w.displayName),w.isExposedOnFrame&&(q.isExposedOnFrame=w.isExposedOnFrame,q.exposedPortPosition=w.exposedPortPosition),void 0!==w.value&&null!==w.value)if("number"===w.valueType)q.value=w.value;else{const I=(0,a.b)(w.valueType);I&&(q.value=I.vI(w.value))}}if(l)for(let w=0;w<l.length;w++){const q=l[w];q.displayName&&(this.outputs[w].displayName=q.displayName),q.isExposedOnFrame&&(this.outputs[w].isExposedOnFrame=q.isExposedOnFrame,this.outputs[w].exposedPortPosition=q.exposedPortPosition)}}clone(){const q=this.serialize(),I=(0,a.b)(q.customType);if(I){const l=new I;return l._deserialize(q),l}return null}dispose(){this.tc.notifyObservers(this),this.tc.clear();for(const q of this.inputs)q.dispose();for(const q of this.outputs)q.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function JI(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",w=arguments.length>3?arguments[3]:void 0;return(t,O)=>{let c=t._propStore;c||(c=[],t._propStore=c),c.push({propertyName:O,displayName:q,type:I,groupName:l,options:w??{},className:t.getClassName()})}}(0,K.d)([(0,D.D)("comment")],NI.prototype,"comments",void 0),function(q){q[q.Boolean=0]="Boolean",q[q.Float=1]="Float",q[q.Int=2]="Int",q[q.Vector2=3]="Vector2",q[q.List=4]="List",q[q.Dc=5]="Dc",q[q.SamplingMode=6]="SamplingMode",q[q.TextureFormat=7]="TextureFormat",q[q.TextureType=8]="TextureType"}(hI||(hI={})),function(q){q[q.None=0]="None",q[q.Position=1]="Position",q[q.Direction=2]="Direction",q[q.Age=3]="Age",q[q.Lifetime=4]="Lifetime",q[q.Color=5]="Color",q[q.ScaledDirection=6]="ScaledDirection",q[q.Scale=7]="Scale",q[q.AgeGradient=8]="AgeGradient",q[q.Angle=9]="Angle",q[q.SpriteCellIndex=16]="SpriteCellIndex",q[q.SpriteCellStart=17]="SpriteCellStart",q[q.SpriteCellEnd=18]="SpriteCellEnd"}(uI||(uI={})),function(q){q[q.None=0]="None",q[q.Time=1]="Time",q[q.Delta=2]="Delta",q[q.Emitter=3]="Emitter"}(PI||(PI={}));class zI{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let q="";for(const I of this.notConnectedNonOptionalInputs)q+=`input ${I.name} from block ${I.ownerBlock.name}[${I.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(q)throw"Build of Node Particle System Set failed:\n"+q}adapt(q,I){const l=q.getConnectedValue(this)||0;if(q.type===I)return l;switch(I){case LI.Vector2:return new w.Vector2(l,l);case LI.dI:return new w.dI(l,l,l);case LI.Dc:return new c.Dc(l,l,l,l)}return null}getContextualValue(q){if(!this.particleContext||!this.systemContext)return null;switch(q){case uI.Position:return this.particleContext.position;case uI.Direction:return this.particleContext.direction;case uI.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case uI.Color:return this.particleContext.color;case uI.Age:return this.particleContext.age;case uI.Lifetime:return this.particleContext.lifeTime;case uI.Angle:return this.particleContext.angle;case uI.Scale:return this.particleContext.scale;case uI.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case uI.SpriteCellEnd:return this.systemContext.endSpriteCellID;case uI.SpriteCellIndex:return this.particleContext.cellIndex;case uI.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.wI.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.wI.absolutePosition:this.systemContext.wI:null}getSystemValue(q){if(!this.particleContext||!this.systemContext)return null;switch(q){case PI.Time:return this.systemContext._actualFrame;case PI.Delta:return this.systemContext._scaledUpdateSpeed;case PI.Emitter:if(this.isEmitterTransformNode){return this.systemContext.wI.absolutePosition}return this.systemContext.wI}return null}}function HI(q,I,l){const w=new zI;w.VI=I;const t=q.createSystem(w);return t.canStart=()=>!0,t.wI=l.clone(),t.disposeOnStop=!0,t.start(),t}class AI extends NI{constructor(q){super(q),this.blendMode=F.BLENDMODE_ONEONE,this.Zl=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",LI.Particle),this.registerInput("texture",LI.Texture),this.registerInput("onStart",LI.System,!0),this.registerInput("onEnd",LI.System,!0),this.registerOutput("system",LI.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(q){q.Zl=this.Zl,q.buildId=this._buildId++,this.build(q);const I=this.particle.getConnectedValue(q);return I.particleTexture=this.texture.getConnectedValue(q),I.emitRate=this.emitRate,I.blendMode=this.blendMode,I.name=this.name,I._nodeGenerated=!0,I._targetStopDuration=this.targetStopDuration,I.startDelay=this.startDelay,this.system._storedValue=this,I.canStart=()=>!this.doNoStart,I.onStartedObservable.add((l=>{const w=this.onStart.getConnectedValue(q);w&&l.onStartedObservable.addOnce((()=>{q.systemContext=I;const l=HI(w,q.VI,q.emitterPosition);this.tc.addOnce((()=>{l.dispose()}))}));const t=this.onEnd.getConnectedValue(q);t&&l.onStoppedObservable.addOnce((()=>{q.systemContext=I;const l=HI(t,q.VI,q.emitterPosition);this.tc.addOnce((()=>{l.dispose()}))}))})),this.tc.addOnce((()=>{I.dispose()})),I}serialize(){const q=super.serialize();return q.Zl=this.Zl,q.emitRate=this.emitRate,q.blendMode=this.blendMode,q.doNoStart=this.doNoStart,q.targetStopDuration=this.targetStopDuration,q.startDelay=this.startDelay,q}_deserialize(q){super._deserialize(q),this.Zl=q.Zl,this.emitRate=q.emitRate,this.doNoStart=!!q.doNoStart,void 0!==q.blendMode&&(this.blendMode=q.blendMode),void 0!==q.targetStopDuration&&(this.targetStopDuration=q.targetStopDuration),void 0!==q.startDelay&&(this.startDelay=q.startDelay)}}(0,K.d)([JI("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:F.BLENDMODE_ONEONE},{label:"Standard",value:F.BLENDMODE_STANDARD},{label:"Add",value:F.BLENDMODE_ADD},{label:"Multiply",value:F.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:F.BLENDMODE_MULTIPLYADD}]})],AI.prototype,"blendMode",void 0),(0,K.d)([JI("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],AI.prototype,"Zl",void 0),(0,K.d)([JI("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],AI.prototype,"emitRate",void 0),(0,K.d)([JI("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],AI.prototype,"targetStopDuration",void 0),(0,K.d)([JI("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],AI.prototype,"startDelay",void 0),(0,K.d)([JI("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],AI.prototype,"doNoStart",void 0),(0,a.e)("BABYLON.SystemBlock",AI);class QI extends NI{get type(){if(this._type===LI.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=LI.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=LI.Vector2,this._type;case"dI":return this._type=LI.dI,this._type;case"Dc":return this._type=LI.Dc,this._type;case"Matrix":return this._type=LI.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===uI.None&&this._systemSource!==PI.None}get systemSource(){return this._systemSource}set systemSource(q){if(this._systemSource=q,q!==PI.None){switch(this._contextualSource=uI.None,this._type=LI.Float,q){case PI.Time:case PI.Delta:this._type=LI.Float;break;case PI.Emitter:this._type=LI.dI}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==uI.None}get contextualValue(){return this._contextualSource}set contextualValue(q){if(this._contextualSource=q,q!==uI.None){switch(this._systemSource=PI.None,q){case uI.Scale:this._type=LI.Vector2;break;case uI.Position:case uI.Direction:case uI.ScaledDirection:this._type=LI.dI;break;case uI.Color:this._type=LI.Dc;break;case uI.Age:case uI.Lifetime:case uI.Angle:case uI.AgeGradient:this._type=LI.Float;break;case uI.SpriteCellEnd:case uI.SpriteCellStart:case uI.SpriteCellIndex:this._type=LI.Int}this.output&&(this.output.type=this._type)}}constructor(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:LI.AutoDetect;super(q),this._type=LI.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new H.d,this._systemSource=PI.None,this._contextualSource=uI.None,this._type=I,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",I)}get value(){return this._storedValue}set value(q){this.type===LI.Float&&this.min!==this.max&&(q=Math.max(this.min,q),q=Math.min(this.max,q)),this._storedValue=q,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(q){this._valueCallback=q}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case LI.Int:case LI.Float:this.value=0;break;case LI.Vector2:this.value=w.Vector2.Zero();break;case LI.dI:this.value=w.dI.Zero();break;case LI.Dc:this.value=new c.Dc(1,1,1,1);break;case LI.Matrix:this.value=w.Matrix.Identity()}}_build(q){super._build(q),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=q=>q.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=q=>q.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const q=super.serialize();return q.type=this.type,q.contextualValue=this.contextualValue,q.systemSource=this.systemSource,q.min=this.min,q.max=this.max,q.groupInInspector=this.groupInInspector,q.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Uc?(q.valueType="BABYLON."+this._storedValue.getClassName(),q.value=this._storedValue.Uc()):(q.valueType="number",q.value=this._storedValue)),q}_deserialize(q){if(super._deserialize(q),this._type=q.type,this.contextualValue=q.contextualValue,this.systemSource=q.systemSource||PI.None,this.min=q.min||0,this.max=q.max||0,this.groupInInspector=q.groupInInspector||"",void 0!==q.displayInInspector&&(this.displayInInspector=q.displayInInspector),q.valueType)if("number"===q.valueType)this._storedValue=q.value;else{const I=(0,a.b)(q.valueType);I&&(this._storedValue=I.vI(q.value))}}}(0,a.e)("BABYLON.ParticleInputBlock",QI);class bI extends NI{get url(){return this._url}set url(q){this._url!==q&&(this._cachedData=null,this._url=q,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(q){this._textureDataUrl!==q&&(this._cachedData=null,this._textureDataUrl=q,this._url="",this._sourceTexture=null)}set sourceTexture(q){this._sourceTexture!==q&&(this._cachedData=null,this._sourceTexture=q,this._url="",this._textureDataUrl="")}constructor(q){super(q),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",LI.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const q=this.texture._storedValue;return await new Promise(((I,l)=>{if(!q.isReady())return void q.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),I(this._cachedData)}catch(q){l(q)}}));const w=q.getSize();KI.i.GetTextureDataAsync(q,w.width,w.height).then((l=>{this._cachedData={width:w.width,height:w.height,data:new Uint8ClampedArray(l)},q.dispose(),I(this._cachedData)})).catch(l)}))}_build(q){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new n.d(this._textureDataUrl,q.VI):this.texture._storedValue=new n.d(this._url,q.VI):this.texture._storedValue=null}serialize(){const q=super.serialize();return q.url=this.url,q.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(q.textureDataUrl=this.textureDataUrl),q}_deserialize(q){super._deserialize(q),this.url=q.url,this.serializedCachedData=!!q.serializedCachedData,q.textureDataUrl&&(this.textureDataUrl=q.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,a.e)("BABYLON.ParticleTextureSourceBlock",bI);class ql extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerInput("position",LI.dI),this.registerOutput("output",LI.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(q){const I=this.particle.getConnectedValue(q);if(this.output._storedValue=I,!this.position.isConnected)return;const l={process:l=>{q.particleContext=l,q.systemContext=I,l.position.t(this.position.getConnectedValue(q))},previousItem:null,nextItem:null};I._updateQueueStart?Pq(l,I._updateQueueStart):I._updateQueueStart=l}}(0,a.e)("BABYLON.UpdatePositionBlock",ql),function(q){q[q.Add=0]="Add",q[q.Subtract=1]="Subtract",q[q.Multiply=2]="Multiply",q[q.Divide=3]="Divide",q[q.Max=4]="Max",q[q.Min=5]="Min"}(ml||(ml={}));class Il extends NI{constructor(q){super(q),this.operation=ml.Add,this.registerInput("left",LI.AutoDetect),this.registerInput("right",LI.AutoDetect),this.registerOutput("output",LI.BasedOnInput),this.output._typeConnectionSource=this.left;const I=[LI.Matrix,LI.Particle,LI.Texture,LI.System,LI.FloatGradient,LI.Color4Gradient,LI.Vector2Gradient,LI.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...I),this.right.excludedConnectionPointTypes.push(...I),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(q){let I;const l=this.left,t=this.right;if(!l.isConnected||!t.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const O=l.type===LI.Float||l.type===LI.Int,a=t.type===LI.Float||t.type===LI.Int,F=O&&a;switch(this.operation){case ml.Add:I=F?q=>l.getConnectedValue(q)+t.getConnectedValue(q):O?q=>q.adapt(l,t.type).add(t.getConnectedValue(q)):q=>l.getConnectedValue(q).add(q.adapt(t,l.type));break;case ml.Subtract:I=F?q=>l.getConnectedValue(q)-t.getConnectedValue(q):O?q=>q.adapt(l,t.type).TI(t.getConnectedValue(q)):q=>l.getConnectedValue(q).TI(q.adapt(t,l.type));break;case ml.Multiply:I=F?q=>l.getConnectedValue(q)*t.getConnectedValue(q):O?q=>q.adapt(l,t.type).multiply(t.getConnectedValue(q)):q=>l.getConnectedValue(q).multiply(q.adapt(t,l.type));break;case ml.Divide:I=F?q=>l.getConnectedValue(q)/t.getConnectedValue(q):O?q=>q.adapt(l,t.type).divide(t.getConnectedValue(q)):q=>l.getConnectedValue(q).divide(q.adapt(t,l.type));break;case ml.Min:if(F)I=q=>Math.min(l.getConnectedValue(q),t.getConnectedValue(q));else{const[q,a]=O?[t,l]:[l,t];switch(q.type){case LI.Vector2:I=I=>w.Vector2.Minimize(q.getConnectedValue(I),I.adapt(a,q.type));break;case LI.dI:I=I=>w.dI.Minimize(q.getConnectedValue(I),I.adapt(a,q.type));break;case LI.Dc:I=I=>{const l=q.getConnectedValue(I),{r:w,g:t,b:O,a:F}=I.adapt(a,q.type);return new c.Dc(Math.min(l.r,w),Math.min(l.g,t),Math.min(l.b,O),Math.min(l.a,F))}}}break;case ml.Max:if(!F){const[q,a]=O?[t,l]:[l,t];switch(q.type){case LI.Vector2:I=I=>w.Vector2.Maximize(q.getConnectedValue(I),I.adapt(a,q.type));break;case LI.dI:I=I=>w.dI.Maximize(q.getConnectedValue(I),I.adapt(a,q.type));break;case LI.Dc:I=I=>{const l=q.getConnectedValue(I),{r:w,g:t,b:O,a:F}=I.adapt(a,q.type);return new c.Dc(Math.max(l.r,w),Math.min(l.g,t),Math.min(l.b,O),Math.min(l.a,F))}}break}I=q=>Math.max(l.getConnectedValue(q),t.getConnectedValue(q))}this.output._storedFunction=q=>l.type===LI.Int?0|I(q):I(q)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===LI.Int||this.left.type===LI.Float&&this.right.type!==LI.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[q,I]of[[this.left,this.right],[this.right,this.left]])q.acceptedConnectionPointTypes=[LI.Int,LI.Float],I.isConnected&&(q.acceptedConnectionPointTypes.push(I.type),I.type!==LI.Int&&I.type!==LI.Float||q.acceptedConnectionPointTypes.push(LI.Vector2,LI.dI,LI.Dc))}dispose(){super.dispose();for(const q of this._connectionObservers)q.remove();this._connectionObservers.length=0}serialize(){const q=super.serialize();return q.operation=this.operation,q}_deserialize(q){super._deserialize(q),this.operation=q.operation}}(0,K.d)([JI("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:ml.Add},{label:"Subtract",value:ml.Subtract},{label:"Multiply",value:ml.Multiply},{label:"Divide",value:ml.Divide},{label:"Max",value:ml.Max},{label:"Min",value:ml.Min}]})],Il.prototype,"operation",void 0),(0,a.e)("BABYLON.ParticleMathBlock",Il);class ll extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerInput("direction1",LI.dI,!0,new w.dI(0,1,0)),this.registerInput("direction2",LI.dI,!0,new w.dI(0,1,0)),this.registerInput("minEmitBox",LI.dI,!0,new w.dI(-.5,-.5,-.5)),this.registerInput("maxEmitBox",LI.dI,!0,new w.dI(.5,.5,.5)),this.registerOutput("output",LI.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(q){const I=this.particle.getConnectedValue(q);I._directionCreation.process=l=>{q.particleContext=l,q.systemContext=I;const t=this.direction1.getConnectedValue(q),O=this.direction2.getConnectedValue(q),c=(0,s.RandomRange)(t.x,O.x),a=(0,s.RandomRange)(t.y,O.y),F=(0,s.RandomRange)(t.z,O.z);q.isEmitterTransformNode?w.dI.TransformNormalFromFloatsToRef(c,a,F,q.emitterWorldMatrix,l.direction):l.direction.gc(c,a,F)},I._positionCreation.process=l=>{q.particleContext=l,q.systemContext=I;const t=this.minEmitBox.getConnectedValue(q),O=this.maxEmitBox.getConnectedValue(q),c=(0,s.RandomRange)(t.x,O.x),a=(0,s.RandomRange)(t.y,O.y),F=(0,s.RandomRange)(t.z,O.z);q.isEmitterTransformNode?w.dI.TransformCoordinatesFromFloatsToRef(c,a,F,q.emitterWorldMatrix,l.position):(l.position.gc(c,a,F),l.position.addInPlace(q.emitterPosition))},this.output._storedValue=I}}(0,a.e)("BABYLON.BoxShapeBlock",ll);class wl extends NI{constructor(q){super(q),this.registerInput("emitPower",LI.Float,!0,1),this.registerInput("lifeTime",LI.Float,!0,1),this.registerInput("color",LI.Dc,!0,new c.Dc(1,1,1,1)),this.registerInput("scale",LI.Vector2,!0,new w.Vector2(1,1)),this.registerInput("angle",LI.Float,!0,0),this.registerOutput("particle",LI.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(q){const I=new aI(this.name,q.Zl,q.VI,null,!1,void 0,!0);I.particleEmitterType=new U,I._lifeTimeCreation.process=(I,l)=>{q.particleContext=I,I.lifeTime=this.lifeTime.getConnectedValue(q),l._emitPower=this.emitPower.getConnectedValue(q)},I._colorCreation.process=I=>{q.particleContext=I,I.color.t(this.color.getConnectedValue(q))},I._sizeCreation.process=I=>{q.particleContext=I,I.size=1,I.scale.t(this.scale.getConnectedValue(q))},I._angleCreation.process=I=>{q.particleContext=I,I.angle=this.angle.getConnectedValue(q)},this.particle._storedValue=I}}(0,a.e)("BABYLON.CreateParticleBlock",wl);class tl{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const q=[];for(const I of this.attachedBlocks)I.isInput&&q.push(I);return q}constructor(q){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new H.d,this.name=q}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(q){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(q)&&this.attachedBlocks.push(q);for(const l of q.inputs){const w=l.connectedPoint;if(w){const l=w.ownerBlock;l!==q&&this._initializeBlock(l,I)}}}async buildAsync(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((l=>{const w=new WI;for(const q of this._systemBlocks)this._initializeBlock(q);for(const t of this.systemBlocks){const l=new zI;l.buildId=this._buildId++,l.VI=q,l.verbose=I;const O=t.createSystem(l);l.emitErrors(),w.systems.push(O)}this.onBuildObservable.notifyObservers(this),l(w)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const q=new AI("Particle system"),I=new ql("Update position");I.output.connectTo(q.particle);const l=new QI("Position");l.contextualValue=uI.Position;const w=new QI("Scaled direction");w.contextualValue=uI.ScaledDirection;const t=new Il("Add");t.operation=ml.Add,l.output.connectTo(t.left),w.output.connectTo(t.right),t.output.connectTo(I.position);const O=new wl("Create particle"),c=new ll("Box shape");O.particle.connectTo(c.particle),c.output.connectTo(I.particle);const a=new bI("Texture");a.texture.connectTo(q.texture),a.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(q)}removeBlock(q){const I=this.attachedBlocks.indexOf(q);if(I>-1&&this.attachedBlocks.splice(I,1),q.isSystem){const I=this._systemBlocks.indexOf(q);I>-1&&this._systemBlocks.splice(I,1)}}parseSerializedObject(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I||this.clear();const l={};for(const w of q.uZ){const q=(0,a.b)(w.customType);if(q){const I=new q;I._deserialize(w),l[w.id]=I,this.attachedBlocks.push(I),I.isSystem&&this._systemBlocks.push(I)}}for(const w of this.attachedBlocks)if(w.isTeleportOut){const q=w,I=q._tempEntryPointUniqueId;if(I){const w=l[I];w&&w.attachToEndpoint(q)}}for(let w=0;w<q.uZ.length;w++){const t=q.uZ[w],O=l[t.id];O&&(O.inputs.length&&t.inputs.some((q=>q.targetConnectionName))&&!I||this._restoreConnections(O,q,l))}if(q.locations||q.editorData&&q.editorData.locations){const w=q.locations||q.editorData.locations;for(const q of w)l[q.Bw]&&(q.Bw=l[q.Bw].uniqueId);I&&this.editorData&&this.editorData.locations&&w.concat(this.editorData.locations),q.locations?this.editorData={locations:w}:(this.editorData=q.editorData,this.editorData.locations=w);const t=[];for(const q in l)t[q]=l[q].uniqueId;this.editorData.map=t}this.comment=q.comment}_restoreConnections(q,I,l){for(const w of q.outputs)for(const t of I.uZ){const O=l[t.id];if(O)for(const c of t.inputs)if(l[c.targetBlockId]!==q||c.targetConnectionName!==w.name);else{const q=O.getInputByName(c.inputName);if(!q||q.isConnected)continue;w.connectTo(q,!0),this._restoreConnections(O,I,l)}}}serialize(q){const I=q?{}:M.c.Serialize(this);I.editorData=JSON.parse(JSON.stringify(this.editorData));let l=[];q?l=q:I.customType="BABYLON.NodeParticleSystemSet",I.uZ=[];for(const w of l)I.uZ.push(w.serialize());if(!q)for(const w of this.attachedBlocks)-1===l.indexOf(w)&&I.uZ.push(w.serialize());return I}dispose(){for(const q of this.attachedBlocks)q.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(q){const I=new tl(q);return I.setToDefault(),I}static Parse(q){const I=M.c.Parse((()=>new tl(q.name)),q,null);return I.parseSerializedObject(q),I}static ParseFromSnippetAsync(q,I){return"_BLANK"===q?Promise.resolve(tl.CreateDefault("blank")):new Promise(((l,w)=>{const t=new eI.c;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const c=JSON.parse(JSON.parse(t.responseText).jsonPayload),a=JSON.parse(c.nodeParticle);I||(I=M.c.Parse((()=>new tl(q)),a,null)),I.parseSerializedObject(a),I.snippetId=q;try{l(I)}catch(O){w(O)}}else w("Unable to load the snippet "+q)})),t.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),t.send()}))}}tl.EditorURL=`${kI.Tools._DefaultCdnUrl}/v${Jq.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,tl.SnippetUrl="https://snippet.babylonjs.com",(0,K.d)([(0,D.D)()],tl.prototype,"name",void 0),(0,K.d)([(0,D.D)("comment")],tl.prototype,"comment",void 0),function(q){q[q.None=0]="None",q[q.PerParticle=1]="PerParticle",q[q.PerSystem=2]="PerSystem"}(YI||(YI={}));class Ol extends NI{constructor(q){super(q),this._currentLockId=-2,this.lockMode=YI.PerParticle,this.registerInput("min",LI.AutoDetect,!0,0),this.registerInput("max",LI.AutoDetect,!0,1),this.registerOutput("output",LI.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(LI.Float|LI.Int|LI.Vector2|LI.dI|LI.Dc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(LI.Float|LI.Int|LI.Vector2|LI.dI|LI.Dc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=LI.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let q=null;switch(this._currentLockId=-2,this.min.type){case LI.AutoDetect:case LI.Int:case LI.Float:q=q=>{const I=this.min.getConnectedValue(q)||0,l=this.max.getConnectedValue(q)||1;return I+Math.random()*(l-I)};break;case LI.Vector2:q=q=>{const I=this.min.getConnectedValue(q)||w.Vector2.Zero(),l=this.max.getConnectedValue(q)||w.Vector2.One();return new w.Vector2(I.x+Math.random()*(l.x-I.x),I.y+Math.random()*(l.y-I.y))};break;case LI.dI:q=q=>{const I=this.min.getConnectedValue(q)||w.dI.Zero(),l=this.max.getConnectedValue(q)||w.dI.One();return new w.dI(I.x+Math.random()*(l.x-I.x),I.y+Math.random()*(l.y-I.y),I.z+Math.random()*(l.z-I.z))};break;case LI.Dc:q=q=>{const I=this.min.getConnectedValue(q)||new c.Dc(0,0,0,0),l=this.max.getConnectedValue(q)||new c.Dc(1,1,1,1);return new c.Dc(I.x+Math.random()*(l.x-I.x),I.y+Math.random()*(l.y-I.y),I.z+Math.random()*(l.z-I.z),I.w+Math.random()*(l.w-I.w))}}this.output._storedFunction=I=>{var l;let w=0;switch(this.lockMode){case YI.PerParticle:w=(null===(l=I.particleContext)||void 0===l?void 0:l.id)||-1;break;case YI.PerSystem:w=I.buildId||0}return this._currentLockId!==w&&(this.lockMode!==YI.None&&(this._currentLockId=w),this.output._storedValue=q(I)),this.output._storedValue}}serialize(){const q=super.serialize();return q.lockMode=this.lockMode,q}_deserialize(q){super._deserialize(q),this.lockMode=q.lockMode}}(0,K.d)([JI("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:YI.None},{label:"Per particle",value:YI.PerParticle},{label:"Per system",value:YI.PerSystem}]})],Ol.prototype,"lockMode",void 0),(0,a.e)("BABYLON.ParticleRandomBlock",Ol);class cl extends NI{constructor(q){super(q),this._currentLockId=-2,this.lockMode=YI.PerParticle,this.registerInput("min",LI.AutoDetect),this.registerInput("max",LI.AutoDetect),this.registerOutput("output",LI.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const I=[LI.Matrix,LI.Particle,LI.Texture,LI.System,LI.FloatGradient,LI.Color4Gradient,LI.Vector2Gradient,LI.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...I),this.max.excludedConnectionPointTypes.push(...I)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let q=null;switch(this._currentLockId=-2,this.min.type){case LI.Float:case LI.Int:q=q=>{const I=this.min.getConnectedValue(q),l=this.max.getConnectedValue(q);return Math.random()*(l-I)+I};break;case LI.Vector2:q=q=>{const I=this.min.getConnectedValue(q),l=this.max.getConnectedValue(q);return new w.Vector2(Math.random()*(l.x-I.x)+I.x,Math.random()*(l.y-I.y)+I.y)};break;case LI.dI:q=q=>{const I=this.min.getConnectedValue(q),l=this.max.getConnectedValue(q);return new w.dI(Math.random()*(l.x-I.x)+I.x,Math.random()*(l.y-I.y)+I.y,Math.random()*(l.z-I.z)+I.z)};break;case LI.Dc:q=q=>{const I=this.min.getConnectedValue(q),l=this.max.getConnectedValue(q);return new c.Dc(Math.random()*(l.r-I.r)+I.r,Math.random()*(l.g-I.g)+I.g,Math.random()*(l.b-I.b)+I.b,Math.random()*(l.a-I.a)+I.a)}}this.output._storedFunction=I=>{var l;let w=0;switch(this.lockMode){case YI.PerParticle:w=(null===(l=I.particleContext)||void 0===l?void 0:l.id)||-1;break;case YI.PerSystem:w=I.buildId||0}return this._currentLockId!==w&&(this.lockMode!==YI.None&&(this._currentLockId=w),this.output._storedValue=q(I)),this.output._storedValue}}serialize(){const q=super.serialize();return q.lockMode=this.lockMode,q}_deserialize(q){super._deserialize(q),void 0!==q.lockMode&&(this.lockMode=q.lockMode)}}(0,K.d)([JI("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:YI.None},{label:"Per particle",value:YI.PerParticle},{label:"Per system",value:YI.PerSystem}]})],cl.prototype,"lockMode",void 0),(0,a.e)("BABYLON.RandomRangeBlock",cl);(0,a.e)("BABYLON.ParticleLerpBlock",class extends NI{constructor(q){super(q),this.registerInput("left",LI.AutoDetect),this.registerInput("right",LI.AutoDetect),this.registerInput("gradient",LI.Float,!0,0,0,1),this.registerOutput("output",LI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(LI.Float|LI.Int|LI.Vector2|LI.dI|LI.Dc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const q=(q,I,l)=>(1-q)*I+q*l;this.output._storedFunction=I=>{const l=this.left.getConnectedValue(I),t=this.right.getConnectedValue(I),O=this.gradient.getConnectedValue(I);switch(this.left.type){case LI.Int:case LI.Float:return q(O,l,t);case LI.Vector2:return new w.Vector2(q(O,l.x,t.x),q(O,l.y,t.y));case LI.dI:return new w.dI(q(O,l.x,t.x),q(O,l.y,t.y),q(O,l.z,t.z));case LI.Dc:return new c.Dc(q(O,l.r,t.r),q(O,l.g,t.g),q(O,l.b,t.b),q(O,l.a,t.a))}return 0}}});(0,a.e)("BABYLON.UpdateDirectionBlock",class extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerInput("direction",LI.dI),this.registerOutput("output",LI.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(q){const I=this.particle.getConnectedValue(q);if(this.output._storedValue=I,!this.direction.isConnected)return;const l={process:l=>{q.particleContext=l,q.systemContext=I,l.direction.t(this.direction.getConnectedValue(q))},previousItem:null,nextItem:null};I._updateQueueStart?Pq(l,I._updateQueueStart):I._updateQueueStart=l}});(0,a.e)("BABYLON.UpdateColorBlock",class extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerInput("color",LI.Dc),this.registerOutput("output",LI.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(q){const I=this.particle.getConnectedValue(q);if(this.output._storedValue=I,!this.color.isConnected)return;const l={process:l=>{q.particleContext=l,q.systemContext=I,l.color.t(this.color.getConnectedValue(q))},previousItem:null,nextItem:null};I._updateQueueStart?Pq(l,I._updateQueueStart):I._updateQueueStart=l}});(0,a.e)("BABYLON.UpdateScaleBlock",class extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerInput("scale",LI.Vector2),this.registerOutput("output",LI.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(q){const I=this.particle.getConnectedValue(q);if(this.output._storedValue=I,!this.scale.isConnected)return;const l={process:l=>{q.particleContext=l,q.systemContext=I,l.scale.t(this.scale.getConnectedValue(q))},previousItem:null,nextItem:null};I._updateQueueStart?Pq(l,I._updateQueueStart):I._updateQueueStart=l}});(0,a.e)("BABYLON.UpdateAngleBlock",class extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerInput("angle",LI.Float),this.registerOutput("output",LI.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(q){const I=this.particle.getConnectedValue(q);if(this.output._storedValue=I,!this.angle.isConnected)return;const l={process:l=>{q.particleContext=l,q.systemContext=I,l.angle=this.angle.getConnectedValue(q)},previousItem:null,nextItem:null};I._updateQueueStart?Pq(l,I._updateQueueStart):I._updateQueueStart=l}});(0,a.e)("BABYLON.BasicPositionUpdateBlock",class extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerOutput("output",LI.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(q){const I=this.particle.getConnectedValue(q),l={process:l=>{q.particleContext=l,q.systemContext=I,l.direction.scaleToRef(I._directionScale,I._scaledDirection),l.position.addInPlace(I._scaledDirection)},previousItem:null,nextItem:null};I._updateQueueStart?Pq(l,I._updateQueueStart):I._updateQueueStart=l,this.output._storedValue=I}});(0,a.e)("BABYLON.BasicSpriteUpdateBlock",class extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerOutput("output",LI.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(q){const I=this.particle.getConnectedValue(q),l={process:l=>{q.particleContext=l,q.systemContext=I,l.updateCellIndex()},previousItem:null,nextItem:null};I._updateQueueStart?Pq(l,I._updateQueueStart):I._updateQueueStart=l,this.output._storedValue=I}});(0,a.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerInput("cellIndex",LI.Int),this.registerOutput("output",LI.Particle),this.cellIndex.acceptedConnectionPointTypes=[LI.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(q){const I=this.particle.getConnectedValue(q);if(this.output._storedValue=I,!this.cellIndex.isConnected)return;const l={process:l=>{q.particleContext=l,q.systemContext=I,l.cellIndex=Math.floor(this.cellIndex.getConnectedValue(q))},previousItem:null,nextItem:null};I._updateQueueStart?Pq(l,I._updateQueueStart):I._updateQueueStart=l}});class al extends NI{constructor(q){super(q),this.strength=1,this.registerInput("particle",LI.Particle),this.registerInput("flowMap",LI.Texture),this.registerOutput("output",LI.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(q){var I;const l=this.particle.getConnectedValue(q),w=q.VI;let t;(null===(I=this.flowMap.connectedPoint)||void 0===I?void 0:I.ownerBlock).extractTextureContentAsync().then((q=>{q&&(t=new fI(q.width,q.height,q.data))}));const O={process:q=>{const I=w.getTransformMatrix();t&&t._processParticle(q,this.strength*l._tempScaledUpdateSpeed,I)},previousItem:null,nextItem:null};l._updateQueueStart?Pq(O,l._updateQueueStart):l._updateQueueStart=O,this.output._storedValue=l}serialize(){const q=super.serialize();return q.strength=this.strength,q}_deserialize(q){super._deserialize(q),this.strength=q.strength}}(0,K.d)([JI("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],al.prototype,"strength",void 0),(0,a.e)("BABYLON.UpdateFlowMapBlock",al);(0,a.e)("BABYLON.SphereShapeBlock",class extends NI{constructor(q){super(q),this.registerInput("input",LI.Particle),this.registerInput("radius",LI.Float,!0,1),this.registerInput("radiusRange",LI.Float,!0,1,0,1),this.registerInput("directionRandomizer",LI.Float,!0,0,0,1),this.registerOutput("output",LI.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(q){const I=this.input.getConnectedValue(q);I._directionCreation.process=l=>{q.particleContext=l,q.systemContext=I;const t=this.directionRandomizer.getConnectedValue(q),O=l.position.TI(q.emitterPosition).normalize(),c=(0,s.RandomRange)(0,t),a=(0,s.RandomRange)(0,t),F=(0,s.RandomRange)(0,t);O.x+=c,O.y+=a,O.z+=F,O.normalize(),q.isEmitterTransformNode?w.dI.TransformNormalFromFloatsToRef(c,a,F,q.emitterWorldMatrix,l.direction):l.direction.gc(c,a,F)},I._positionCreation.process=l=>{q.particleContext=l,q.systemContext=I;const t=this.radius.getConnectedValue(q),O=this.radiusRange.getConnectedValue(q),c=t-(0,s.RandomRange)(0,t*O),a=(0,s.RandomRange)(0,1),F=(0,s.RandomRange)(0,2*Math.PI),Z=Math.acos(2*a-1),r=c*Math.cos(F)*Math.sin(Z),x=c*Math.cos(Z),o=c*Math.sin(F)*Math.sin(Z);q.isEmitterTransformNode?w.dI.TransformCoordinatesFromFloatsToRef(r,x,o,q.emitterWorldMatrix,l.position):(l.position.gc(r,x,o),l.position.addInPlace(q.emitterPosition))},this.output._storedValue=I}});(0,a.e)("BABYLON.PointShapeBlock",class extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerInput("direction1",LI.dI,!0,new w.dI(0,1,0)),this.registerInput("direction2",LI.dI,!0,new w.dI(0,1,0)),this.registerOutput("output",LI.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){const I=this.particle.getConnectedValue(q);I._directionCreation.process=l=>{q.particleContext=l,q.systemContext=I;const t=this.direction1.getConnectedValue(q),O=this.direction2.getConnectedValue(q),c=(0,s.RandomRange)(t.x,O.x),a=(0,s.RandomRange)(t.y,O.y),F=(0,s.RandomRange)(t.z,O.z);q.isEmitterTransformNode?w.dI.TransformNormalFromFloatsToRef(c,a,F,q.emitterWorldMatrix,l.direction):l.direction.gc(c,a,F)},I._positionCreation.process=l=>{q.systemContext=I,q.isEmitterTransformNode?w.dI.TransformCoordinatesFromFloatsToRef(0,0,0,q.emitterWorldMatrix,l.position):l.position.t(q.emitterPosition)},this.output._storedValue=I}});(0,a.e)("BABYLON.CustomShapeBlock",class extends NI{constructor(q){super(q),this.registerInput("particle",LI.Particle),this.registerInput("position",LI.dI,!0,new w.dI(0,0,0)),this.registerInput("direction",LI.dI,!0,new w.dI(0,1,0)),this.registerOutput("output",LI.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){const I=this.particle.getConnectedValue(q);I._directionCreation.process=l=>{q.particleContext=l,q.systemContext=I;const t=this.direction.getConnectedValue(q);q.isEmitterTransformNode?w.dI.TransformNormalToRef(t,q.emitterWorldMatrix,l.direction):l.direction.t(t)},I._positionCreation.process=l=>{q.particleContext=l,q.systemContext=I;const t=this.position.getConnectedValue(q);q.isEmitterTransformNode?w.dI.TransformCoordinatesToRef(t,q.emitterWorldMatrix,l.position):(l.position.t(t),l.position.addInPlace(q.emitterPosition))},this.output._storedValue=I}});(0,a.e)("BABYLON.CylinderShapeBlock",class extends NI{constructor(q){super(q),this._tempVector=w.dI.Zero(),this.registerInput("particle",LI.Particle),this.registerInput("radius",LI.Float,!0,1),this.registerInput("height",LI.Float,!0,1,0),this.registerInput("radiusRange",LI.Float,!0,1,0,1),this.registerInput("directionRandomizer",LI.Float,!0,0,0,1),this.registerOutput("output",LI.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(q){const I=this.particle.getConnectedValue(q);I._directionCreation.process=l=>{q.particleContext=l,q.systemContext=I;const t=this.directionRandomizer.getConnectedValue(q);l.position.subtractToRef(q.emitterPosition,this._tempVector),this._tempVector.normalize(),q.isEmitterTransformNode&&w.dI.TransformNormalToRef(this._tempVector,q.emitterInverseWorldMatrix,this._tempVector);const O=(0,s.RandomRange)(-t/2,t/2);let c=Math.atan2(this._tempVector.x,this._tempVector.z);c+=(0,s.RandomRange)(-Math.PI/2,Math.PI/2)*t,this._tempVector.y=O,this._tempVector.x=Math.sin(c),this._tempVector.z=Math.cos(c),this._tempVector.normalize(),q.isEmitterTransformNode?w.dI.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,q.emitterWorldMatrix,l.direction):l.direction.t(this._tempVector)},I._positionCreation.process=l=>{q.particleContext=l,q.systemContext=I;const t=this.height.getConnectedValue(q),O=this.radiusRange.getConnectedValue(q),c=this.radius.getConnectedValue(q),a=(0,s.RandomRange)(-t/2,t/2),F=(0,s.RandomRange)(0,2*Math.PI),Z=(0,s.RandomRange)((1-O)*(1-O),1),r=Math.sqrt(Z)*c,x=r*Math.cos(F),o=r*Math.sin(F);q.isEmitterTransformNode?w.dI.TransformCoordinatesFromFloatsToRef(x,a,o,q.emitterWorldMatrix,l.position):(l.position.gc(x,a,o),l.position.addInPlace(q.emitterPosition))},this.output._storedValue=I}});class Fl extends NI{constructor(q){super(q),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",LI.Particle),this.registerOutput("output",LI.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);const I=this.particle.getConnectedValue(q);I._isAnimationSheetEnabled=!0,I.spriteCellWidth=this.width,I.spriteCellHeight=this.height,I.startSpriteCellID=this.start,I.endSpriteCellID=this.end,I.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=I}serialize(){const q=super.serialize();return q.width=this.width,q.height=this.height,q.start=this.start,q.end=this.end,q.randomStartCell=this.randomStartCell,q}_deserialize(q){super._deserialize(q),this.width=q.width,this.height=q.height,this.start=q.start,this.end=q.end,this.randomStartCell=q.randomStartCell}}(0,K.d)([JI("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fl.prototype,"start",void 0),(0,K.d)([JI("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fl.prototype,"end",void 0),(0,K.d)([JI("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fl.prototype,"width",void 0),(0,K.d)([JI("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fl.prototype,"height",void 0),(0,K.d)([JI("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Fl.prototype,"loop",void 0),(0,K.d)([JI("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Fl.prototype,"randomStartCell",void 0),(0,a.e)("BABYLON.SetupSpriteSheetBlock",Fl);class sl extends NI{constructor(q){super(q),this.reference=0,this.registerInput("value",LI.AutoDetect),this.registerOutput("output",LI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=q=>{switch(q){case LI.Float:return LI.FloatGradient;case LI.Vector2:return LI.Vector2Gradient;case LI.dI:return LI.Vector3Gradient;case LI.Dc:return LI.Color4Gradient}return q},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(LI.Float|LI.Vector2|LI.dI|LI.Dc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=q=>null}serialize(){const q=super.serialize();return q.reference=this.reference,q}_deserialize(q){super._deserialize(q),this.reference=q.reference}}(0,K.d)([JI("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],sl.prototype,"reference",void 0),(0,a.e)("BABYLON.ParticleGradientValueBlock",sl);(0,a.e)("BABYLON.ParticleGradientBlock",class extends NI{constructor(q){super(q),this._entryCount=1,this.registerInput("gradient",LI.Float,!0,1,0,1),this.registerInput("value0",LI.AutoDetect),this.registerOutput("output",LI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=q=>{switch(q){case LI.FloatGradient:return LI.Float;case LI.Vector2Gradient:return LI.Vector2;case LI.Vector3Gradient:return LI.dI;case LI.Color4Gradient:return LI.Dc}return q},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(LI.FloatGradient|LI.Vector2Gradient|LI.Vector3Gradient|LI.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(q){this._inputs[q].onConnectionObservable.add((()=>{this._entryCount>q||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),LI.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const q=[];for(let l=1;l<this._inputs.length;l++){var I;if(this._inputs[l].isConnected)q.push(null===(I=this._inputs[l].connectedPoint)||void 0===I?void 0:I.ownerBlock)}q.sort(((q,I)=>q.reference-I.reference)),this.output._storedFunction=I=>{const l=this.gradient.getConnectedValue(I);if(1===q.length)return q[0].value.getConnectedValue(I);let t=null;for(let O=q.length-1;O>=0;O--){const a=q[O];if(a.reference<=l){const q=a.value.getConnectedValue(I);if(t){const O=t.value.getConnectedValue(I),F=t.reference,Z=a.reference,r=Math.max(0,Math.min(1,(l-Z)/(F-Z)));switch(this.output.type){case LI.Float:return(0,s.Lerp)(q,O,r);case LI.Vector2:return w.Vector2.Lerp(q,O,r);case LI.dI:return w.dI.Lerp(q,O,r);case LI.Dc:return c.Dc.Lerp(q,O,r)}}return q}t=a}return 0}}});(0,a.e)("BABYLON.ParticleConverterBlock",class extends NI{constructor(q){super(q),this.registerInput("color ",LI.Dc,!0),this.registerInput("xyz ",LI.dI,!0),this.registerInput("xy ",LI.Vector2,!0),this.registerInput("zw ",LI.Vector2,!0),this.registerInput("x ",LI.Float,!0),this.registerInput("y ",LI.Float,!0),this.registerInput("z ",LI.Float,!0),this.registerInput("w ",LI.Float,!0),this.registerOutput("color",LI.Dc),this.registerOutput("xyz",LI.dI),this.registerOutput("xy",LI.Vector2),this.registerOutput("zw",LI.Vector2),this.registerOutput("x",LI.Float),this.registerOutput("y",LI.Float),this.registerOutput("z",LI.Float),this.registerOutput("w",LI.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(q){return"color "===q?"colorIn":"xyz "===q?"xyzIn":"xy "===q?"xyIn":"zw "===q?"zwIn":"x "===q?"xIn":"y "===q?"yIn":"z "===q?"zIn":"w "===q?"wIn":q}_outputRename(q){switch(q){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return q}}_build(q){super._build(q);const I=this.xIn,l=this.yIn,t=this.zIn,O=this.wIn,a=this.xyIn,F=this.zwIn,s=this.xyzIn,Z=this.colorIn,r=this.colorOut,x=this.xyzOut,o=this.xyOut,d=this.zwOut,T=this.xOut,V=this.yOut,U=this.zOut,B=this.wOut,v=q=>{if(Z.isConnected)return Z.getConnectedValue(q);let w=0,r=0,x=0,o=0;if(I.isConnected&&(w=I.getConnectedValue(q)),l.isConnected&&(r=l.getConnectedValue(q)),t.isConnected&&(x=t.getConnectedValue(q)),O.isConnected&&(o=O.getConnectedValue(q)),a.isConnected){const I=a.getConnectedValue(q);I&&(w=I.x,r=I.y)}if(F.isConnected){const I=F.getConnectedValue(q);I&&(x=I.x,o=I.y)}if(s.isConnected){const I=s.getConnectedValue(q);I&&(w=I.x,r=I.y,x=I.z)}return new c.Dc(w,r,x,o)};r._storedFunction=q=>v(q),x._storedFunction=q=>{const I=v(q);return new w.dI(I.r,I.g,I.b)},o._storedFunction=q=>{const I=v(q);return new w.Vector2(I.r,I.g)},d._storedFunction=q=>{const I=v(q);return new w.Vector2(I.b,I.a)},T._storedFunction=q=>v(q).r,V._storedFunction=q=>v(q).g,U._storedFunction=q=>v(q).b,B._storedFunction=q=>v(q).a}}),function(q){q[q.Cos=0]="Cos",q[q.Sin=1]="Sin",q[q.Abs=2]="Abs",q[q.Exp=3]="Exp",q[q.Exp2=4]="Exp2",q[q.Round=5]="Round",q[q.Floor=6]="Floor",q[q.Ceiling=7]="Ceiling",q[q.Sqrt=8]="Sqrt",q[q.Log=9]="Log",q[q.Tan=10]="Tan",q[q.ArcTan=11]="ArcTan",q[q.ArcCos=12]="ArcCos",q[q.ArcSin=13]="ArcSin",q[q.Sign=14]="Sign",q[q.Negate=15]="Negate",q[q.OneMinus=16]="OneMinus",q[q.Reciprocal=17]="Reciprocal",q[q.ToDegrees=18]="ToDegrees",q[q.ToRadians=19]="ToRadians",q[q.Fract=20]="Fract"}(yI||(yI={}));class Zl extends NI{constructor(q){super(q),this.operation=yI.Cos,this.registerInput("input",LI.AutoDetect),this.registerOutput("output",LI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(LI.Float|LI.Int|LI.Vector2|LI.dI|LI.Dc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);let I=null;switch(this.operation){case yI.Cos:I=q=>Math.cos(q);break;case yI.Sin:I=q=>Math.sin(q);break;case yI.Abs:I=q=>Math.abs(q);break;case yI.Exp:I=q=>Math.exp(q);break;case yI.Exp2:I=q=>Math.pow(2,q);break;case yI.Round:I=q=>Math.round(q);break;case yI.Floor:I=q=>Math.floor(q);break;case yI.Ceiling:I=q=>Math.ceil(q);break;case yI.Sqrt:I=q=>Math.sqrt(q);break;case yI.Log:I=q=>Math.log(q);break;case yI.Tan:I=q=>Math.tan(q);break;case yI.ArcTan:I=q=>Math.atan(q);break;case yI.ArcCos:I=q=>Math.acos(q);break;case yI.ArcSin:I=q=>Math.asin(q);break;case yI.Sign:I=q=>Math.sign(q);break;case yI.Negate:I=q=>-q;break;case yI.OneMinus:I=q=>1-q;break;case yI.Reciprocal:I=q=>1/q;break;case yI.ToRadians:I=q=>q*Math.PI/180;break;case yI.ToDegrees:I=q=>180*q/Math.PI;break;case yI.Fract:I=q=>q>=0?q-Math.floor(q):q-Math.ceil(q)}if(!I)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case LI.Int:case LI.Float:this.output._storedFunction=q=>{const l=this.input.getConnectedValue(q);return I(l)};break;case LI.Vector2:this.output._storedFunction=q=>{const l=this.input.getConnectedValue(q);return new w.Vector2(I(l.x),I(l.y))};break;case LI.dI:this.output._storedFunction=q=>{const l=this.input.getConnectedValue(q);return new w.dI(I(l.x),I(l.y),I(l.z))};break;case LI.Dc:this.output._storedFunction=q=>{const l=this.input.getConnectedValue(q);return new c.Dc(I(l.r),I(l.g),I(l.b),I(l.a))}}return this}serialize(){const q=super.serialize();return q.operation=this.operation,q}_deserialize(q){super._deserialize(q),this.operation=q.operation}}(0,K.d)([JI("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:yI.Cos},{label:"Sin",value:yI.Sin},{label:"Abs",value:yI.Abs},{label:"Exp",value:yI.Exp},{label:"Exp2",value:yI.Exp2},{label:"Round",value:yI.Round},{label:"Floor",value:yI.Floor},{label:"Ceiling",value:yI.Ceiling},{label:"Sqrt",value:yI.Sqrt},{label:"Log",value:yI.Log},{label:"Tan",value:yI.Tan},{label:"ArcTan",value:yI.ArcTan},{label:"ArcCos",value:yI.ArcCos},{label:"ArcSin",value:yI.ArcSin},{label:"Sign",value:yI.Sign},{label:"Negate",value:yI.Negate},{label:"OneMinus",value:yI.OneMinus},{label:"Reciprocal",value:yI.Reciprocal},{label:"ToDegrees",value:yI.ToDegrees},{label:"ToRadians",value:yI.ToRadians},{label:"Fract",value:yI.Fract}]})],Zl.prototype,"operation",void 0),(0,a.e)("BABYLON.ParticleTrigonometryBlock",Zl);var rl,xl=l(14130);class ol extends NI{constructor(q){super(q),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",LI.AutoDetect),this.registerOutput("output",LI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(LI.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(LI.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(LI.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(LI.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(LI.System),this._inputs[0].excludedConnectionPointTypes.push(LI.Particle),this._inputs[0].excludedConnectionPointTypes.push(LI.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const I=q=>{const I=this.input.getConnectedValue(q);if(this.log.length>=this.stackSize)return I;if(null===I||void 0===I)return this.log.push(["null",""]),I;switch(this.input.type){case LI.Vector2:this.log.push([(0,xl.f)(I,4),I.toString()]);break;case LI.dI:this.log.push([(0,xl.g)(I,4),I.toString()]);break;case LI.Dc:this.log.push([`{R: ${I.r.toFixed(4)} G: ${I.g.toFixed(4)} B: ${I.b.toFixed(4)} A: ${I.a.toFixed(4)}}`,I.toString()]);break;default:this.log.push([I.toString(),I.toString()])}return I};this.output.isConnected?this.output._storedFunction=I:this.output._storedValue=I(q)}serialize(){const q=super.serialize();return q.stackSize=this.stackSize,q}_deserialize(q){super._deserialize(q),this.stackSize=q.stackSize}}(0,K.d)([JI("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],ol.prototype,"stackSize",void 0),(0,a.e)("BABYLON.ParticleDebugBlock",ol);(0,a.e)("BABYLON.ParticleElbowBlock",class extends NI{constructor(q){super(q),this.registerInput("input",LI.AutoDetect),this.registerOutput("output",LI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);const I=this._outputs[0],l=this._inputs[0];I._storedFunction=q=>l.getConnectedValue(q)}});(0,a.e)("BABYLON.ParticleTeleportInBlock",class extends NI{get endpoints(){return this._endpoints}constructor(q){super(q),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",LI.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(q){if(this.getClassName()===q)return!0;for(const I of this.endpoints)if(I.isAnAncestorOfType(q))return!0;return!1}isAnAncestorOf(q){for(const I of this.endpoints){if(I===q)return!0;if(I.isAnAncestorOf(q))return!0}return!1}attachToEndpoint(q){q.detach(),this._endpoints.push(q),q._entryPoint=this,q._outputs[0]._typeConnectionSource=this._inputs[0],q._tempEntryPointUniqueId=null,q.name="> "+this.name}detachFromEndpoint(q){const I=this._endpoints.indexOf(q);-1!==I&&(this._endpoints.splice(I,1),q._outputs[0]._typeConnectionSource=null,q._entryPoint=null)}_build(){for(const q of this._endpoints)q.output._storedFunction=q=>this.input.getConnectedValue(q)}});(0,a.e)("BABYLON.ParticleTeleportOutBlock",class extends NI{constructor(q){super(q),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",LI.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(q){this.entryPoint&&this.entryPoint.build(q)}clone(){const q=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(q),q}serialize(){var q;const I=super.serialize();return I.entryPoint=(null===(q=this.entryPoint)||void 0===q?void 0:q.uniqueId)??"",I}_deserialize(q){super._deserialize(q),this._tempEntryPointUniqueId=q.entryPoint}}),function(q){q[q.Equal=0]="Equal",q[q.NotEqual=1]="NotEqual",q[q.LessThan=2]="LessThan",q[q.GreaterThan=3]="GreaterThan",q[q.LessOrEqual=4]="LessOrEqual",q[q.GreaterOrEqual=5]="GreaterOrEqual",q[q.Xor=6]="Xor",q[q.Or=7]="Or",q[q.And=8]="And"}(rl||(rl={}));class dl extends NI{constructor(q){super(q),this.test=rl.Equal,this.epsilon=0,this.registerInput("left",LI.Float),this.registerInput("right",LI.Float,!0,0),this.registerInput("ifTrue",LI.AutoDetect,!0,1),this.registerInput("ifFalse",LI.AutoDetect,!0,0),this.registerOutput("output",LI.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=LI.Float,this._inputs[0].acceptedConnectionPointTypes.push(LI.Int),this._inputs[1].acceptedConnectionPointTypes.push(LI.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const q=q=>{const I=this.left.getConnectedValue(q),l=this.right.getConnectedValue(q);let w=!1;switch(this.test){case rl.Equal:w=(0,s.WithinEpsilon)(I,l,this.epsilon);break;case rl.NotEqual:w=!(0,s.WithinEpsilon)(I,l,this.epsilon);break;case rl.LessThan:w=I<l+this.epsilon;break;case rl.GreaterThan:w=I>l-this.epsilon;break;case rl.LessOrEqual:w=I<=l+this.epsilon;break;case rl.GreaterOrEqual:w=I>=l-this.epsilon;break;case rl.Xor:w=!!I&&!l||!I&&!!l;break;case rl.Or:w=!!I||!!l;break;case rl.And:w=!!I&&!!l}return w};this.output._storedFunction=I=>q(I)?this.ifTrue.getConnectedValue(I):this.ifFalse.getConnectedValue(I)}serialize(){const q=super.serialize();return q.test=this.test,q.epsilon=this.epsilon,q}_deserialize(q){super._deserialize(q),this.test=q.test,void 0!==q.epsilon&&(this.epsilon=q.epsilon)}}(0,K.d)([JI("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:rl.Equal},{label:"NotEqual",value:rl.NotEqual},{label:"LessThan",value:rl.LessThan},{label:"GreaterThan",value:rl.GreaterThan},{label:"LessOrEqual",value:rl.LessOrEqual},{label:"GreaterOrEqual",value:rl.GreaterOrEqual},{label:"Xor",value:rl.Xor},{label:"Or",value:rl.Or},{label:"And",value:rl.And}]})],dl.prototype,"test",void 0),(0,K.d)([JI("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],dl.prototype,"epsilon",void 0),(0,a.e)("BABYLON.ParticleConditionBlock",dl);class Tl extends NI{constructor(q){super(q),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",LI.Particle),this.registerInput("condition",LI.Float,!0,0),this.registerInput("system",LI.System),this.registerOutput("output",LI.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){this._triggerCount=0;const I=this.input.getConnectedValue(q),l={process:l=>{if(q.particleContext=l,q.systemContext=I,0!==this.condition.getConnectedValue(q)&&(0===this.limit||this._triggerCount<this.limit)){const w=(new Date).getTime();if(this._previousOne&&w-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=w;const t=this.system.getConnectedValue(q);if(t){const w=HI(t,q.VI,l.position);w.tc.addOnce((()=>{this._triggerCount--})),I.tc.addOnce((()=>{w.dispose()}))}}},previousItem:null,nextItem:null};I._updateQueueStart?Pq(l,I._updateQueueStart):I._updateQueueStart=l,this.output._storedValue=I}serialize(){const q=super.serialize();return q.limit=this.limit,q.delay=this.delay,q}_deserialize(q){super._deserialize(q),void 0!==q.limit&&(this.limit=q.limit),void 0!==q.delay&&(this.delay=q.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,K.d)([JI("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tl.prototype,"limit",void 0),(0,K.d)([JI("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Tl.prototype,"delay",void 0),(0,a.e)("BABYLON.ParticleTriggerBlock",Tl);l(14137),l(14151),l(14158),l(14214)},14196:(q,I,l)=>{"use strict";var w=l(12664);const t="clipPlaneFragment",O="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14160:(q,I,l)=>{"use strict";var w=l(12664);const t="clipPlaneFragmentDeclaration",O="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14223:(q,I,l)=>{"use strict";var w=l(12664);const t="clipPlaneVertex",O="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14216:(q,I,l)=>{"use strict";var w=l(12664);const t="clipPlaneVertexDeclaration",O="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14207:(q,I,l)=>{"use strict";var w=l(12664);const t="fogFragment",O="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14192:(q,I,l)=>{"use strict";var w=l(12664);const t="fogFragmentDeclaration",O="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14228:(q,I,l)=>{"use strict";var w=l(12664);const t="fogVertex",O="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14221:(q,I,l)=>{"use strict";var w=l(12664);const t="fogVertexDeclaration",O="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14177:(q,I,l)=>{"use strict";var w=l(12664);const t="helperFunctions",O="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14165:(q,I,l)=>{"use strict";var w=l(12664);const t="imageProcessingDeclaration",O="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14186:(q,I,l)=>{"use strict";var w=l(12664);const t="imageProcessingFunctions",O="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14173:(q,I,l)=>{"use strict";var w=l(12664);const t="logDepthDeclaration",O="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14198:(q,I,l)=>{"use strict";var w=l(12664);const t="logDepthFragment",O="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14232:(q,I,l)=>{"use strict";var w=l(12664);const t="logDepthVertex",O="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";w.e.IncludesShadersStoreWGSL[t]||(w.e.IncludesShadersStoreWGSL[t]=O)},14158:(q,I,l)=>{"use strict";l.r(I),l.d(I,{particlesPixelShaderWGSL:()=>c});var w=l(12664);l(14160),l(14165),l(14173),l(14177),l(14186),l(14192),l(14196),l(14198),l(14207);const t="particlesPixelShader",O="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";w.e.ShadersStoreWGSL[t]||(w.e.ShadersStoreWGSL[t]=O);const c={name:t,shader:O}},14214:(q,I,l)=>{"use strict";l.r(I),l.d(I,{particlesVertexShaderWGSL:()=>c});var w=l(12664);l(14216),l(14221),l(14173),l(14223),l(14228),l(14232);const t="particlesVertexShader",O="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";w.e.ShadersStoreWGSL[t]||(w.e.ShadersStoreWGSL[t]=O);const c={name:t,shader:O}},14072:(q,I,l)=>{"use strict";var w=l(12664);const t="clipPlaneFragment",O="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14144:(q,I,l)=>{"use strict";var w=l(12664);const t="clipPlaneFragmentDeclaration",O="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14092:(q,I,l)=>{"use strict";var w=l(12664);const t="clipPlaneVertex",O="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14156:(q,I,l)=>{"use strict";var w=l(12664);const t="clipPlaneVertexDeclaration",O="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14082:(q,I,l)=>{"use strict";var w=l(12664);const t="fogFragment",O="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14069:(q,I,l)=>{"use strict";var w=l(12664);const t="fogFragmentDeclaration",O="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14098:(q,I,l)=>{"use strict";var w=l(12664);const t="fogVertex",O="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14089:(q,I,l)=>{"use strict";var w=l(12664);const t="fogVertexDeclaration",O="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14060:(q,I,l)=>{"use strict";var w=l(12664);const t="helperFunctions",O="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14045:(q,I,l)=>{"use strict";var w=l(12664);const t="imageProcessingDeclaration",O="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14066:(q,I,l)=>{"use strict";var w=l(12664);const t="imageProcessingFunctions",O="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14053:(q,I,l)=>{"use strict";var w=l(12664);const t="logDepthDeclaration",O="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14077:(q,I,l)=>{"use strict";var w=l(12664);const t="logDepthFragment",O="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14105:(q,I,l)=>{"use strict";var w=l(12664);const t="logDepthVertex",O="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";w.e.IncludesShadersStore[t]||(w.e.IncludesShadersStore[t]=O)},14137:(q,I,l)=>{"use strict";l.r(I),l.d(I,{particlesPixelShader:()=>c});var w=l(12664);l(14144),l(14045),l(14053),l(14060),l(14066),l(14069),l(14072),l(14077),l(14082);const t="particlesPixelShader",O="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";w.e.ShadersStore[t]||(w.e.ShadersStore[t]=O);const c={name:t,shader:O}},14151:(q,I,l)=>{"use strict";l.r(I),l.d(I,{particlesVertexShader:()=>c});var w=l(12664);l(14156),l(14089),l(14053),l(14092),l(14098),l(14105);const t="particlesVertexShader",O="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";w.e.ShadersStore[t]||(w.e.ShadersStore[t]=O);const c={name:t,shader:O}},14491:(q,I,l)=>{"use strict";l.r(I),l.d(I,{FlowGraphGLTFDataProvider:()=>O});var w=l(14457),t=l(14441);class O extends w.c{constructor(q){var I,l;super();const w=q.glTF,O=(null===(I=w.animations)||void 0===I?void 0:I.map((q=>q._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",t.e,O);const c=(null===(l=w.nodes)||void 0===l?void 0:l.map((q=>q._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",t.e,c)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14385:(q,I,l)=>{"use strict";l.d(I,{e:()=>V,g:()=>d,i:()=>o,k:()=>T});var w=l(12747),t=l(13208),O=l(12789),c=l(14392);const a=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class F{constructor(q,I){this._gltf=q,this._infoTree=I}convert(q){let I,l=this._gltf,w=this._infoTree;if(!q.startsWith("/"))throw new Error("Path must start with a /");const t=q.split("/");if(t.shift(),t[t.length-1].includes(".length")){const q=t[t.length-1].split(".");t.pop(),t.push(...q)}let O=!1;for(const F of t){const t="length"===F;if(t&&!w.__array__)throw new Error(`Path ${q} is invalid`);if(w.__ignoreObjectTree__&&(O=!0),w.__array__&&!t)w=w.__array__;else if(w=w[F],!w)throw new Error(`Path ${q} is invalid`);if(!O)if(void 0===l){if(!a.find((I=>I.regex.test(q))))throw new Error(`Path ${q} is invalid`)}else if(!t){var c;l=null===(c=l)||void 0===c?void 0:c[F]}(w.__target__||t)&&(I=l)}return{object:I,info:w}}}function s(q,I,l,w){const t=Z(q,I);return w?t[l][w]:t[l]}function Z(q,I,l){var w,O;return null===(w=q._data)||void 0===w||null===(O=w[(null===l||void 0===l?void 0:l.fillMode)??t.c.MATERIAL_TriangleFillMode])||void 0===O?void 0:O.babylonMaterial}function r(q,I){return{offset:{componentsCount:2,type:"Vector2",get:(l,t,O)=>{const c=s(l,O,q,I);return new w.Vector2(null===c||void 0===c?void 0:c.uOffset,null===c||void 0===c?void 0:c.vOffset)},getTarget:Z,set:(l,w,t,O)=>{const c=s(w,O,q,I);c.uOffset=l.x,c.vOffset=l.y},getPropertyName:[()=>`${q}${I?"."+I:""}.uOffset`,()=>`${q}${I?"."+I:""}.vOffset`]},rotation:{type:"number",get:(l,w,t)=>{var O;return null===(O=s(l,t,q,I))||void 0===O?void 0:O.wAng},getTarget:Z,set:(l,w,t,O)=>s(w,O,q,I).wAng=l,getPropertyName:[()=>`${q}${I?"."+I:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(l,t,O)=>{const c=s(l,O,q,I);return new w.Vector2(null===c||void 0===c?void 0:c.uScale,null===c||void 0===c?void 0:c.vScale)},getTarget:Z,set:(l,w,t,O)=>{const c=s(w,O,q,I);c.uScale=l.x,c.vScale=l.y},getPropertyName:[()=>`${q}${I?"."+I:""}.uScale`,()=>`${q}${I?"."+I:""}.vScale`]}}}const x={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:q=>{var I,l;return new w.Vector2((null===(I=q._babylonCamera)||void 0===I?void 0:I.orthoLeft)??0,(null===(l=q._babylonCamera)||void 0===l?void 0:l.orthoRight)??0)},set:(q,I)=>{I._babylonCamera&&(I._babylonCamera.orthoLeft=q.x,I._babylonCamera.orthoRight=q.y)},getTarget:q=>q,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:q=>{var I,l;return new w.Vector2((null===(I=q._babylonCamera)||void 0===I?void 0:I.orthoBottom)??0,(null===(l=q._babylonCamera)||void 0===l?void 0:l.orthoTop)??0)},set:(q,I)=>{I._babylonCamera&&(I._babylonCamera.orthoBottom=q.x,I._babylonCamera.orthoTop=q.y)},getTarget:q=>q,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:q=>{var I;return null===(I=q._babylonCamera)||void 0===I?void 0:I.maxZ},set:(q,I)=>{I._babylonCamera&&(I._babylonCamera.maxZ=q)},getTarget:q=>q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:q=>{var I;return null===(I=q._babylonCamera)||void 0===I?void 0:I.vc},set:(q,I)=>{I._babylonCamera&&(I._babylonCamera.vc=q)},getTarget:q=>q,getPropertyName:[()=>"vc"]}},perspective:{aspectRatio:{type:"number",get:q=>{var I;return null===(I=q._babylonCamera)||void 0===I?void 0:I.getEngine().getAspectRatio(q._babylonCamera)},getTarget:q=>q,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:q=>{var I;return null===(I=q._babylonCamera)||void 0===I?void 0:I.fov},set:(q,I)=>{I._babylonCamera&&(I._babylonCamera.fov=q)},getTarget:q=>q,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:q=>{var I;return null===(I=q._babylonCamera)||void 0===I?void 0:I.maxZ},set:(q,I)=>{I._babylonCamera&&(I._babylonCamera.maxZ=q)},getTarget:q=>q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:q=>{var I;return null===(I=q._babylonCamera)||void 0===I?void 0:I.vc},set:(q,I)=>{I._babylonCamera&&(I._babylonCamera.vc=q)},getTarget:q=>q,getPropertyName:[()=>"vc"]}}}},nodes:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"dI",get:q=>{var I;return null===(I=q._babylonTransformNode)||void 0===I?void 0:I.position},set:(q,I)=>{var l;return null===(l=I._babylonTransformNode)||void 0===l?void 0:l.position.t(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:q=>{var I;return null===(I=q._babylonTransformNode)||void 0===I?void 0:I.rotationQuaternion},set:(q,I)=>{var l,w;return null===(l=I._babylonTransformNode)||void 0===l||null===(w=l.rotationQuaternion)||void 0===w?void 0:w.t(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"dI",get:q=>{var I;return null===(I=q._babylonTransformNode)||void 0===I?void 0:I.Xc},set:(q,I)=>{var l;return null===(l=I._babylonTransformNode)||void 0===l?void 0:l.Xc.t(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"Xc"]},weights:{length:{type:"number",get:q=>q._numMorphTargets,getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(q,I)=>{var l,w;return void 0!==I?null===(l=q._primitiveBabylonMeshes)||void 0===l||null===(w=l[0].morphTargetManager)||void 0===w?void 0:w.getTarget(I).influence:void 0},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(q,I)=>[0],getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:q=>{var I,l,t;return w.Matrix.Compose(null===(I=q._babylonTransformNode)||void 0===I?void 0:I.Xc,null===(l=q._babylonTransformNode)||void 0===l?void 0:l.rotationQuaternion,null===(t=q._babylonTransformNode)||void 0===t?void 0:t.position)},getTarget:q=>q._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:q=>{var I,l,t,O;const c=w.Matrix.Identity();let a=q.parent;for(;a&&a.parent;)a=a.parent;const F=(null===(I=q._babylonTransformNode)||void 0===I?void 0:I.position._isDirty)||(null===(l=q._babylonTransformNode)||void 0===l||null===(t=l.rotationQuaternion)||void 0===t?void 0:t._isDirty)||(null===(O=q._babylonTransformNode)||void 0===O?void 0:O.Xc._isDirty);if(a){var s;const I=null===(s=a._babylonTransformNode)||void 0===s?void 0:s.Cc(!0).invert();var Z,r;if(I)null===(Z=q._babylonTransformNode)||void 0===Z||null===(r=Z.Cc(F))||void 0===r||r.multiplyToRef(I,c)}else q._babylonTransformNode&&c.t(q._babylonTransformNode.Cc(F));return c},getTarget:q=>q._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:q=>{var I,l;return null===(I=q._babylonTransformNode)||void 0===I||null===(l=I.getChildren((q=>q instanceof c.b),!0)[0])||void 0===l?void 0:l.Ec},getTarget:q=>{var I;return null===(I=q._babylonTransformNode)||void 0===I?void 0:I.getChildren((q=>q instanceof c.b),!0)[0]},set:(q,I)=>{if(I._babylonTransformNode){const l=I._babylonTransformNode.getChildren((q=>q instanceof c.b),!0)[0];l&&(l.Ec=q)}}},color:{type:"BI",get:q=>{var I,l;return null===(I=q._babylonTransformNode)||void 0===I||null===(l=I.getChildren((q=>q instanceof c.b),!0)[0])||void 0===l?void 0:l.jc},getTarget:q=>{var I;return null===(I=q._babylonTransformNode)||void 0===I?void 0:I.getChildren((q=>q instanceof c.b),!0)[0]},set:(q,I)=>{if(I._babylonTransformNode){const l=I._babylonTransformNode.getChildren((q=>q instanceof c.b),!0)[0];l&&(l.jc=q)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"BI",get:(q,I,l)=>Z(q,I,l).emissiveColor,set:(q,I,l,w)=>Z(I,l,w).emissiveColor.t(q),getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:r("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(q,I,l)=>{var w;return null===(w=s(q,l,"bumpTexture"))||void 0===w?void 0:w.level},set:(q,I,l,w)=>{const t=s(I,w,"bumpTexture");t&&(t.level=q)},getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:r("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(q,I,l)=>Z(q,I,l).ambientTextureStrength,set:(q,I,l,w)=>{const t=Z(I,l,w);t&&(t.ambientTextureStrength=q)},getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:r("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Dc",get:(q,I,l)=>{const w=Z(q,I,l);return O.Dc.FromColor3(w.albedoColor,w.alpha)},set:(q,I,l,w)=>{const t=Z(I,l,w);t.albedoColor.set(q.r,q.g,q.b),t.alpha=q.a},getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:r("albedoTexture")}},metallicFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).metallic,set:(q,I,l,w)=>{const t=Z(I,l,w);t&&(t.metallic=q)},getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).roughness,set:(q,I,l,w)=>{const t=Z(I,l,w);t&&(t.roughness=q)},getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:r("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(q,I,l)=>Z(q,I,l).anisotropy.Ec,set:(q,I,l,w)=>{Z(I,l,w).anisotropy.Ec=q},getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(q,I,l)=>Z(q,I,l).anisotropy.angle,set:(q,I,l,w)=>{Z(I,l,w).anisotropy.angle=q},getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:r("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).clearCoat.Ec,set:(q,I,l,w)=>{Z(I,l,w).clearCoat.Ec=q},getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).clearCoat.roughness,set:(q,I,l,w)=>{Z(I,l,w).clearCoat.roughness=q},getTarget:(q,I,l)=>Z(q,I,l),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:r("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(q,I,l)=>{var w;return null===(w=Z(q,I,l).clearCoat.bumpTexture)||void 0===w?void 0:w.level},getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).clearCoat.bumpTexture.level=q},extensions:{KHR_texture_transform:r("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:r("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(q,I,l)=>Z(q,I,l).subSurface.dispersion,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).subSurface.dispersion=q}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(q,I,l)=>Z(q,I,l).emissiveIntensity,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).emissiveIntensity=q}},KHR_materials_ior:{ior:{type:"number",get:(q,I,l)=>Z(q,I,l).indexOfRefraction,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).indexOfRefraction=q}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).iridescence.Ec,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).iridescence.Ec=q},iridescenceIor:{type:"number",get:(q,I,l)=>Z(q,I,l).iridescence.indexOfRefraction,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).iridescence.indexOfRefraction=q},iridescenceTexture:{extensions:{KHR_texture_transform:r("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(q,I,l)=>Z(q,I,l).iridescence.maximumThickness,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).iridescence.maximumThickness=q},iridescenceThicknessMinimum:{type:"number",get:(q,I,l)=>Z(q,I,l).iridescence.minimumThickness,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).iridescence.minimumThickness=q},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:r("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"BI",get:(q,I,l)=>Z(q,I,l).sheen.color,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).sheen.color.t(q)},sheenColorTexture:{extensions:{KHR_texture_transform:r("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).sheen.Ec,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).sheen.Ec=q},sheenRoughnessTexture:{extensions:{KHR_texture_transform:r("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).metallicF0Factor,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).metallicF0Factor=q,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"BI",get:(q,I,l)=>Z(q,I,l).metallicReflectanceColor,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).metallicReflectanceColor.t(q),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:r("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:r("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).subSurface.refractionIntensity,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).subSurface.refractionIntensity=q,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:r("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).subSurface.translucencyIntensity,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).subSurface.translucencyIntensity=q},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:r("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"BI",get:(q,I,l)=>Z(q,I,l).subSurface.translucencyColor,getTarget:Z,set:(q,I,l,w)=>{var t;return q&&(null===(t=Z(I,l,w).subSurface.translucencyColor)||void 0===t?void 0:t.t(q))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:r("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"BI",get:(q,I,l)=>Z(q,I,l).subSurface.tintColor,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).subSurface.tintColor.t(q)},attenuationDistance:{type:"number",get:(q,I,l)=>Z(q,I,l).subSurface.tintColorAtDistance,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).subSurface.tintColorAtDistance=q},thicknessFactor:{type:"number",get:(q,I,l)=>Z(q,I,l).subSurface.maximumThickness,getTarget:Z,set:(q,I,l,w)=>Z(I,l,w).subSurface.maximumThickness=q},thicknessTexture:{extensions:{KHR_texture_transform:r("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonLight)),getPropertyName:[q=>"length"]},__array__:{__target__:!0,color:{type:"BI",get:q=>{var I;return null===(I=q._babylonLight)||void 0===I?void 0:I.jc},set:(q,I)=>{var l;return null===(l=I._babylonLight)||void 0===l?void 0:l.jc.t(q)},getTarget:q=>q._babylonLight,getPropertyName:[q=>"diffuse"]},Ec:{type:"number",get:q=>{var I;return null===(I=q._babylonLight)||void 0===I?void 0:I.Ec},set:(q,I)=>I._babylonLight?I._babylonLight.Ec=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"intensity"]},range:{type:"number",get:q=>{var I;return null===(I=q._babylonLight)||void 0===I?void 0:I.range},set:(q,I)=>I._babylonLight?I._babylonLight.range=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"range"]},spot:{innerConeAngle:{type:"number",get:q=>{var I;return null===(I=q._babylonLight)||void 0===I?void 0:I.innerAngle},set:(q,I)=>I._babylonLight?I._babylonLight.innerAngle=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"innerConeAngle"]},outerConeAngle:{type:"number",get:q=>{var I;return null===(I=q._babylonLight)||void 0===I?void 0:I.angle},set:(q,I)=>I._babylonLight?I._babylonLight.angle=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonLight)),getPropertyName:[q=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonTexture)),getPropertyName:[q=>"length"]},__array__:{__target__:!0,Ec:{type:"number",get:q=>{var I;return null===(I=q._babylonTexture)||void 0===I?void 0:I.level},set:(q,I)=>{I._babylonTexture&&(I._babylonTexture.level=q)},getTarget:q=>q._babylonTexture},rotation:{type:"Quaternion",get:q=>{var I;return q._babylonTexture&&w.Quaternion.FromRotationMatrix(null===(I=q._babylonTexture)||void 0===I?void 0:I.getReflectionTextureMatrix())},set:(q,I)=>{var l;I._babylonTexture&&(null!==(l=I._babylonTexture.Wq())&&void 0!==l&&l.useRightHandedSystem||(q=w.Quaternion.Inverse(q)),w.Matrix.FromQuaternionToRef(q,I._babylonTexture.getReflectionTextureMatrix()))},getTarget:q=>q._babylonTexture}}}}},animations:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>{var I;return null===(I=q.primitives[0]._instanceData)||void 0===I?void 0:I.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function o(q){return new F(q,x)}function d(q){const I=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let l=x;for(const w of I)w&&(l=l[w]);if(l&&l.type&&l.get)return l}function T(q,I){const l=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let w=x;for(const t of l)t&&(w=w[t]);w&&w.type&&w.get&&(w.interpolation=I)}function V(q,I){const l=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let w=x;for(const t of l)if(t){if(!w[t]){if("?"===t){w.__ignoreObjectTree__=!0;continue}w[t]={},"__array__"===t&&(w[t].__target__=!0)}w=w[t]}Object.assign(w,I)}},14399:(q,I,l)=>{"use strict";l.r(I),l.d(I,{AnimationPropertyInfo:()=>s,TransformNodeAnimationPropertyInfo:()=>Z,WeightAnimationPropertyInfo:()=>r,getQuaternion:()=>a,getVector3:()=>c,getWeights:()=>F});var w=l(13247),t=l(12747),O=l(14385);function c(q,I,l,w){return t.dI.vI(I,l).scaleInPlace(w)}function a(q,I,l,w){return t.Quaternion.vI(I,l).scaleInPlace(w)}function F(q,I,l,w){const t=new Array(q._numMorphTargets);for(let O=0;O<t.length;O++)t[O]=I[l++]*w;return t}class s{constructor(q,I,l,w){this.type=q,this.name=I,this.getValue=l,this.getStride=w}_buildAnimation(q,I,l){const t=new w.d(q,this.name,I,this.type);return t.setKeys(l),t}}class Z extends s{buildAnimations(q,I,l,w){const t=[];return t.push({babylonAnimatable:q._babylonTransformNode,babylonAnimation:this._buildAnimation(I,l,w)}),t}}class r extends s{buildAnimations(q,I,l,t){const O=[];if(q._numMorphTargets)for(let c=0;c<q._numMorphTargets;c++){const a=new w.d(`${I}_${c}`,this.name,l,this.type);if(a.setKeys(t.map((q=>({frame:q.frame,inTangent:q.inTangent?q.inTangent[c]:void 0,value:q.value[c],outTangent:q.outTangent?q.outTangent[c]:void 0,interpolation:q.interpolation})))),q._primitiveBabylonMeshes)for(const I of q._primitiveBabylonMeshes)if(I.morphTargetManager){const q=I.morphTargetManager.getTarget(c),l=a.clone();q.animations.push(l),O.push({babylonAnimatable:q,babylonAnimation:l})}}return O}}(0,O.k)("/nodes/{}/translation",[new Z(w.d.ANIMATIONTYPE_VECTOR3,"position",c,(()=>3))]),(0,O.k)("/nodes/{}/rotation",[new Z(w.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",a,(()=>4))]),(0,O.k)("/nodes/{}/scale",[new Z(w.d.ANIMATIONTYPE_VECTOR3,"Xc",c,(()=>3))]),(0,O.k)("/nodes/{}/weights",[new r(w.d.ANIMATIONTYPE_FLOAT,"influence",F,(q=>q._numMorphTargets))])},14356:(q,I,l)=>{"use strict";class w{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((q,I)=>{this._resolve=q,this._reject=I}))}}var t=l(12747),O=l(12789),c=l(12564),a=l(13186),F=l(14361),s=l(14371),Z=l(12573),r=l(13206),x=l(13247),o=l(13250),d=l(12612),T=l(12591),V=l(12599);class U{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(q){this._useTextureToStoreBoneMatrices=q,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(q,I,l){this.name=q,this.id=I,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=t.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new Z.d,this.bones=[],this._scene=l||d.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const w=this._scene.getEngine().getCaps();this._canUseTextureForBones=w.textureFloat&&w.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((q=>!q.getParent()))}getTransformMatrices(q){if(this.needInitialSkinMatrix){if(!q)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return q._bonesTransformMatrices||this.prepare(!0),q._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(q){return this.needInitialSkinMatrix&&q._transformMatrixTexture?q._transformMatrixTexture:this._transformMatrixTexture}Wq(){return this._scene}toString(q){let I=`Name: ${this.name}, nBones: ${this.bones.length}`;if(I+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,q){I+=", Ranges: {";let q=!0;for(const l in this._ranges)q&&(I+=", ",q=!1),I+=l;I+="}"}return I}getBoneIndexByName(q){for(let I=0,l=this.bones.length;I<l;I++)if(this.bones[I].name===q)return I;return-1}createAnimationRange(q,I,l){if(!this._ranges[q]){this._ranges[q]=new o.d(q,I,l);for(let w=0,t=this.bones.length;w<t;w++)this.bones[w].animations[0]&&this.bones[w].animations[0].createRange(q,I,l)}}deleteAnimationRange(q){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let l=0,w=this.bones.length;l<w;l++)this.bones[l].animations[0]&&this.bones[l].animations[0].deleteRange(q,I);this._ranges[q]=null}getAnimationRange(q){return this._ranges[q]||null}getAnimationRanges(){const q=[];let I;for(I in this._ranges)q.push(this._ranges[I]);return q}copyAnimationRange(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[I]||!q.getAnimationRange(I))return!1;let w=!0;const t=this._getHighestAnimationFrame()+1,O={},c=q.bones;let a,F;for(F=0,a=c.length;F<a;F++)O[c[F].name]=c[F];this.bones.length!==c.length&&(T.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${c.length}`),w=!1);const s=l&&this.dimensionsAtRest&&q.dimensionsAtRest?this.dimensionsAtRest.divide(q.dimensionsAtRest):null;for(F=0,a=this.bones.length;F<a;F++){const q=this.bones[F].name,c=O[q];c?w=w&&this.bones[F].copyAnimationRange(c,I,t,l,s):(T.b.Warn("copyAnimationRange: not same rig, missing source bone "+q),w=!1)}const Z=q.getAnimationRange(I);return Z&&(this._ranges[I]=new o.d(I,Z.from+t,Z.to+t)),w}returnToRest(){for(const q of this.bones)-1!==q._index&&q.returnToRest()}_getHighestAnimationFrame(){let q=0;for(let I=0,l=this.bones.length;I<l;I++)if(this.bones[I].animations[0]){const l=this.bones[I].animations[0].getHighestFrame();q<l&&(q=l)}return q}beginAnimation(q,I,l,w){const t=this.getAnimationRange(q);return t?this._scene.beginAnimation(this,t.from,t.to,I,l,w):null}static MakeAnimationAdditive(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;const w=q.getAnimationRange(l);if(!w)return null;const t=q._scene.getAllAnimatablesByTarget(q);let O=null;for(let a=0;a<t.length;a++){const q=t[a];if(q.fromFrame===(null===w||void 0===w?void 0:w.from)&&q.toFrame===(null===w||void 0===w?void 0:w.to)){O=q;break}}const c=q.getAnimatables();for(let a=0;a<c.length;a++){const q=c[a].animations;if(q)for(let w=0;w<q.length;w++)x.d.MakeAnimationAdditive(q[w],I,l)}return O&&(O.isAdditive=!0),q}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(q){this._meshesWithPoseMatrix.push(q)}_unregisterMeshWithPoseMatrix(q){const I=this._meshesWithPoseMatrix.indexOf(q);I>-1&&this._meshesWithPoseMatrix.splice(I,1)}_computeTransformMatrices(q,I){this.onBeforeComputeObservable.notifyObservers(this);for(let l=0;l<this.bones.length;l++){const w=this.bones[l];w._childUpdateId++;const t=w.getParent();if(t?w.getLocalMatrix().multiplyToRef(t.getFinalMatrix(),w.getFinalMatrix()):I?w.getLocalMatrix().multiplyToRef(I,w.getFinalMatrix()):w.getFinalMatrix().t(w.getLocalMatrix()),-1!==w._index){const I=null===w._index?l:w._index;w.getAbsoluteInverseBindMatrix().multiplyToArray(w.getFinalMatrix(),q,16*I)}}this._identity.copyToArray(q,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const q=this.Wq().getRenderId();if(this._currentRenderId===q)return;this._currentRenderId=q}if(this._numBonesWithLinkedTransformNode>0)for(const q of this.bones)if(q._linkedTransformNode){const I=q._linkedTransformNode;q.position=I.position,I.rotationQuaternion?q.rotationQuaternion=I.rotationQuaternion:q.rotation=I.rotation,q.Xc=I.Xc}if(this.needInitialSkinMatrix)for(const q of this._meshesWithPoseMatrix){const I=q.getPoseMatrix();let l=this._isDirty;if(q._bonesTransformMatrices&&q._bonesTransformMatrices.length===16*(this.bones.length+1)||(q._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),l=!0),l){if(this._synchronizedWithMesh!==q){this._synchronizedWithMesh=q;for(const q of this.bones)if(!q.getParent()){q.getBindMatrix().multiplyToRef(I,t.TmpVectors.Matrix[1]),q._updateAbsoluteBindMatrices(t.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const I=4*(this.bones.length+1);q._transformMatrixTexture&&q._transformMatrixTexture.getSize().width===I||(q._transformMatrixTexture&&q._transformMatrixTexture.dispose(),q._transformMatrixTexture=r.d.CreateRGBATexture(q._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(q._bonesTransformMatrices,I),this.isUsingTextureForMatrices&&q._transformMatrixTexture&&q._transformMatrixTexture.update(q._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=r.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let q=0;q<this.bones.length;q++)this._animatables.push(this.bones[q])}return this._animatables}clone(q,I){const l=new U(q,I||q,this._scene);l.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let w=0;w<this.bones.length;w++){const q=this.bones[w];let I=null;const t=q.getParent();if(t){const q=this.bones.indexOf(t);I=l.bones[q]}const O=new s.e(q.name,l,I,q.getBindMatrix().clone(),q.getRestMatrix().clone());O._index=q._index,q._linkedTransformNode&&O.linkTransformNode(q._linkedTransformNode),V.d.DeepCopy(q.animations,O.animations)}if(this._ranges){l._ranges={};for(const q in this._ranges){const I=this._ranges[q];I&&(l._ranges[q]=I.clone())}}return this._isDirty=!0,l.prepare(!0),l}enableBlending(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const I of this.bones)for(const l of I.animations)l.enableBlending=!0,l.blendingSpeed=q}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Wq().stopAnimation(this),this.Wq().removeSkeleton(this),this._parentContainer){const q=this._parentContainer.skeletons.indexOf(this);q>-1&&this._parentContainer.skeletons.splice(q,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const q={};q.name=this.name,q.id=this.id,this.dimensionsAtRest&&(q.dimensionsAtRest=this.dimensionsAtRest.Uc()),q.bones=[],q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let l=0;l<this.bones.length;l++){var I;const w=this.bones[l],t=w.getParent(),O={parentBoneIndex:t?this.bones.indexOf(t):-1,index:w.getIndex(),name:w.name,id:w.id,matrix:w.getBindMatrix().Uc(),rest:w.getRestMatrix().Uc(),linkedTransformNodeId:null===(I=w.getTransformNode())||void 0===I?void 0:I.id};q.bones.push(O),w.length&&(O.length=w.length),w.metadata&&(O.metadata=w.metadata),w.animations&&w.animations.length>0&&(O.animation=w.animations[0].serialize()),q.ranges=[];for(const I in this._ranges){const l=this._ranges[I];if(!l)continue;const w={};w.name=I,w.from=l.from,w.to=l.to,q.ranges.push(w)}}return q}static Parse(q,I){const l=new U(q.name,q.id,I);let w;for(q.dimensionsAtRest&&(l.dimensionsAtRest=t.dI.vI(q.dimensionsAtRest)),l.needInitialSkinMatrix=q.needInitialSkinMatrix,w=0;w<q.bones.length;w++){const I=q.bones[w],O=q.bones[w].index;let c=null;I.parentBoneIndex>-1&&(c=l.bones[I.parentBoneIndex]);const a=I.rest?t.Matrix.vI(I.rest):null,F=new s.e(I.name,l,c,t.Matrix.vI(I.matrix),a,null,O);void 0!==I.id&&null!==I.id&&(F.id=I.id),I.length&&(F.length=I.length),I.metadata&&(F.metadata=I.metadata),I.animation&&F.animations.push(x.d.Parse(I.animation)),void 0!==I.linkedTransformNodeId&&null!==I.linkedTransformNodeId&&(l._hasWaitingData=!0,F._waitingTransformNodeId=I.linkedTransformNodeId)}if(q.ranges)for(w=0;w<q.ranges.length;w++){const I=q.ranges[w];l.createAnimationRange(I.name,I.from,I.to)}return l}computeAbsoluteMatrices(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||q)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(q)}getPoseMatrix(){let q=null;return this._meshesWithPoseMatrix.length>0&&(q=this._meshesWithPoseMatrix[0].getPoseMatrix()),q}sortBones(){const q=[],I=new Array(this.bones.length);for(let l=0;l<this.bones.length;l++)this._sortBones(l,q,I);this.bones=q}_sortBones(q,I,l){if(l[q])return;l[q]=!0;const w=this.bones[q];if(!w)return;void 0===w._index&&(w._index=q);const t=w.getParent();t&&this._sortBones(this.bones.indexOf(t),I,l),I.push(w)}setCurrentPoseAsRest(){for(const q of this.bones)q.setCurrentPoseAsRest()}}var B=l(13074),v=l(13216),k=l(12733),C=l(13166),R=l(12821),W=l(13194),e=l(13173),i=l(13184),S=l(13254),g=l(12839),p=l(14326);class X{set areUpdatesFrozen(q){q?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new g.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,q||(q=d.e.LastCreatedScene),this._scene=q,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const q=this._scene.getEngine().getCaps();this._canUseTextureForTargets=q.canUseGLVertexID&&q.textureFloat&&q.maxVertexTextureImageUnits>0&&q.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return X.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?X.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(q){this._numMaxInfluencers!==q&&(this._numMaxInfluencers=q,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(q){this._useTextureToStoreTargets!==q&&(this._useTextureToStoreTargets=q,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var q;return X.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(q=this._scene)&&void 0!==q&&q.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(q){return this._activeTargets.data[q]}getTarget(q){return this._targets[q]}getTargetByName(q){for(const I of this._targets)if(I.name===q)return I;return null}addTarget(q){this._targets.push(q),this._targetInfluenceChangedObservers.push(q.onInfluenceChanged.add((q=>{this.areUpdatesFrozen&&q&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(q)}))),this._targetDataLayoutChangedObservers.push(q._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(q){const I=this._targets.indexOf(q);I>=0&&(this._targets.splice(I,1),q.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(I,1)[0]),q._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(I,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(q)}_bind(q){q.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),q.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),q.setTexture("morphTargets",this._targetStoreTexture),q.setInt("morphTargetCount",this.numInfluencers)}clone(){const q=new X(this._scene);for(const I of this._targets)q.addTarget(I.clone());return q.enablePositionMorphing=this.enablePositionMorphing,q.enableNormalMorphing=this.enableNormalMorphing,q.enableTangentMorphing=this.enableTangentMorphing,q.enableUVMorphing=this.enableUVMorphing,q.enableUV2Morphing=this.enableUV2Morphing,q.enableColorMorphing=this.enableColorMorphing,q}serialize(){const q={};q.id=this.uniqueId,q.targets=[];for(const I of this._targets)q.targets.push(I.serialize());return q}_syncActiveTargets(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const I=!!this._targetStoreTexture,l=this.isUsingTextureForTargets;(this._mustSynchronize||I!==l)&&(this._mustSynchronize=!1,this.synchronize());let w=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let t=-1;for(const O of this._targets)if(t++,0!==O.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=X.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(O),this._morphTargetTextureIndices[w]=t,this._tempInfluences[w++]=O.influence}this._morphTargetTextureIndices.length!==w&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,w)),this._influences&&this._influences.length===w||(this._influences=new Float32Array(w));for(let O=0;O<w;O++)this._influences[O]=this._tempInfluences[O];if(q&&this._scene)for(const O of this._scene.meshes)O.morphTargetManager===this&&(l?O._markSubMeshesAsAttributesDirty():O._syncGeometryWithMorphTargetManager())}synchronize(){var q;if(!this._scene||this.areUpdatesFrozen)return;const I=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(q=this._targetStoreTexture)||void 0===q||q.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>I.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const l of this._targets){this._supportsPositions=this._supportsPositions&&l.hasPositions,this._supportsNormals=this._supportsNormals&&l.hasNormals,this._supportsTangents=this._supportsTangents&&l.hasTangents,this._supportsUVs=this._supportsUVs&&l.hasUVs,this._supportsUV2s=this._supportsUV2s&&l.hasUV2s,this._supportsColors=this._supportsColors&&l.hasColors;const q=l.vertexCount;if(0===this._vertexCount)this._vertexCount=q;else if(this._vertexCount!==q)return void T.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${l.name}": ${q}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const q=I.getCaps().maxTextureSize;this._textureWidth>q&&(this._textureHeight=Math.ceil(this._textureWidth/q),this._textureWidth=q);const l=this._targets.length,w=new Float32Array(l*this._textureWidth*this._textureHeight*4);let t=0;for(let I=0;I<l;I++){const q=this._targets[I],l=q.getPositions(),O=q.getNormals(),c=q.getUVs(),a=q.getTangents(),F=q.getUV2s(),s=q.getColors();t=I*this._textureWidth*this._textureHeight*4;for(let I=0;I<this._vertexCount;I++)this._supportsPositions&&l&&(w[t]=l[3*I],w[t+1]=l[3*I+1],w[t+2]=l[3*I+2],t+=4),this._supportsNormals&&O&&(w[t]=O[3*I],w[t+1]=O[3*I+1],w[t+2]=O[3*I+2],t+=4),this._supportsUVs&&c&&(w[t]=c[2*I],w[t+1]=c[2*I+1],t+=4),this._supportsTangents&&a&&(w[t]=a[3*I],w[t+1]=a[3*I+1],w[t+2]=a[3*I+2],t+=4),this._supportsUV2s&&F&&(w[t]=F[2*I],w[t+1]=F[2*I+1],t+=4),this._supportsColors&&s&&(w[t]=s[4*I],w[t+1]=s[4*I+1],w[t+2]=s[4*I+2],w[t+3]=s[4*I+3],t+=4)}this._targetStoreTexture=p.e.CreateRGBATexture(w,this._textureWidth,this._textureHeight,l,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const l of this._scene.meshes)l.morphTargetManager===this&&l._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const q=this._parentContainer.morphTargetManagers.indexOf(this);q>-1&&this._parentContainer.morphTargetManagers.splice(q,1),this._parentContainer=null}for(const q of this._targets)this._scene.stopAnimation(q)}}static Parse(q,I){const l=new X(I);for(const w of q.targets)l.addTarget(S.b.Parse(w,I));return l}}X.EnableTextureStorage=!0,X.MaxActiveMorphTargetsInVertexAttributeMode=8,X.ConstantTargetCountForTextureMode=0;var K=l(14379),D=l(12615),M=l(13096);const n=new Map,f=n;function L(q,I,l){E(q)&&T.b.Warn(`Extension with the name '${q}' already exists`),n.set(q,{isGLTFExtension:I,factory:l})}function E(q){return n.delete(q)}var j=l(14385),h=l(13295),u=l(12830);class P{static Get(q,I,l){if(!I||void 0==l||!I[l])throw new Error(`${q}: Failed to find index (${l})`);return I[l]}static TryGet(q,I){return q&&void 0!=I&&q[I]?q[I]:null}static Assign(q){if(q)for(let I=0;I<q.length;I++)q[I].index=I}}function mq(q){if(q.min&&q.max){const I=q.min,l=q.max,w=t.TmpVectors.dI[0].gc(I[0],I[1],I[2]),O=t.TmpVectors.dI[1].gc(l[0],l[1],l[2]);if(q.normalized&&5126!==q.componentType){let I=1;switch(q.componentType){case 5120:I=127;break;case 5121:I=255;break;case 5122:I=32767;break;case 5123:I=65535}const l=1/I;w.scaleInPlace(l),O.scaleInPlace(l)}return new M.b(w,O)}return null}class Y{static RegisterExtension(q,I){L(q,!1,I)}static UnregisterExtension(q){return E(q)}get rc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(q){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=q}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((q=>q.dispose&&q.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(q,I,l,w,t,O){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=I,this._assetContainer=l,this._loadData(w);let O=null;if(q){const I={};if(this._gltf.nodes)for(const q of this._gltf.nodes)q.name&&(I[q.name]=q.index);O=(q instanceof Array?q:[q]).map((q=>{const l=I[q];if(void 0===l)throw new Error(`Failed to find node '${q}'`);return l}))}return await this._loadAsync(t,c,O,(()=>({meshes:this._getMeshes(),Kx:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=q,this._loadData(I),await this._loadAsync(l,t,null,(()=>{}))}async _loadAsync(q,I,l,w){return await Promise.resolve().then((async()=>{this._rootUrl=q,this._uniqueRootUrl=!q.startsWith("file:")&&I?q:`${q}${Date.now()}/`,this._fileName=I,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const t=`${K.l[K.l.LOADING]} => ${K.l[K.l.READY]}`,O=`${K.l[K.l.LOADING]} => ${K.l[K.l.COMPLETE]}`;this._parent._startPerformanceCounter(t),this._parent._startPerformanceCounter(O),this._parent._setState(K.l.LOADING),this._extensionsOnLoading();const a=new Array;if(!this.parent.loadOnlyMaterials)if(l)a.push(this.loadSceneAsync("/nodes",{nodes:l,index:-1}));else if(void 0!=this._gltf.VI||this._gltf.scenes&&this._gltf.scenes[0]){const q=P.Get("/scene",this._gltf.scenes,this._gltf.VI||0);a.push(this.loadSceneAsync(`/scenes/${q.index}`,q))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let q=0;q<this._gltf.materials.length;++q){const I=this._gltf.materials[q],l="/materials/"+q,w=B.c.TriangleFillMode;a.push(this._loadMaterialAsync(l,I,null,w,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&a.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&a.push(this._compileShadowGeneratorsAsync());const F=Promise.all(a).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.oF(!0);for(const q of this._babylonScene.materials){const I=q;void 0!==I.maxSimultaneousLights&&(I.maxSimultaneousLights=Math.max(I.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(K.l.READY),this._skipStartAnimationStep||this._startAnimations(),w()}));return await F.then((q=>(this._parent._endPerformanceCounter(t),c.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(O),this._parent._setState(K.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(q=>{this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()}))})),q)))})).catch((q=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()),q}))}_loadData(q){if(this._gltf=q.json,this._setupData(),q.bin){const I=this._gltf.buffers;if(I&&I[0]&&!I[0].uri){const l=I[0];(l.byteLength<q.bin.byteLength-3||l.byteLength>q.bin.byteLength)&&T.b.Warn(`Binary buffer length (${l.byteLength}) from JSON does not match chunk length (${q.bin.byteLength})`),this._bin=q.bin}else T.b.Warn("Unexpected BIN chunk")}}_setupData(){if(P.Assign(this._gltf.accessors),P.Assign(this._gltf.animations),P.Assign(this._gltf.buffers),P.Assign(this._gltf.bufferViews),P.Assign(this._gltf.cameras),P.Assign(this._gltf.images),P.Assign(this._gltf.materials),P.Assign(this._gltf.meshes),P.Assign(this._gltf.nodes),P.Assign(this._gltf.samplers),P.Assign(this._gltf.scenes),P.Assign(this._gltf.skins),P.Assign(this._gltf.textures),this._gltf.nodes){const q={};for(const l of this._gltf.nodes)if(l.children)for(const I of l.children)q[I]=l.index;const I=this._createRootNode();for(const l of this._gltf.nodes){const w=q[l.index];l.parent=void 0===w?I:this._gltf.nodes[w]}}}async _loadExtensionsAsync(){const q=[];if(f.forEach(((I,l)=>{var w;!1===(null===(w=this.parent.extensionOptions[l])||void 0===w?void 0:w.enabled)?I.isGLTFExtension&&this.isExtensionUsed(l)&&T.b.Warn(`Extension ${l} is used but has been explicitly disabled.`):I.isGLTFExtension&&!this.isExtensionUsed(l)||q.push((async()=>{const q=await I.factory(this);return q.name!==l&&T.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${q.name} !== ${l}`),this._parent.onExtensionLoadedObservable.notifyObservers(q),q})())})),this._extensions.push(...await Promise.all(q)),this._extensions.sort(((q,I)=>(q.order||Number.MAX_VALUE)-(I.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const l of this._gltf.extensionsRequired){if(!this._extensions.some((q=>q.name===l&&q.enabled))){var I;if(!1===(null===(I=this.parent.extensionOptions[l])||void 0===I?void 0:I.enabled))throw new Error(`Required extension ${l} is disabled`);throw new Error(`Required extension ${l} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new i.c("__root__",this._babylonScene);this._rootBabylonMesh=q,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.oF(!1);const I={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case K.k.AUTO:this._babylonScene.useRightHandedSystem||(I.rotation=[0,1,0,0],I.scale=[1,1,-1],Y._LoadTransform(I,this._rootBabylonMesh));break;case K.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(q),I}loadSceneAsync(q,I){const l=this._extensionsLoadSceneAsync(q,I);if(l)return l;const w=new Array;if(this.logOpen(`${q} ${I.name||""}`),I.nodes)for(const t of I.nodes){const I=P.Get(`${q}/nodes/${t}`,this._gltf.nodes,t);w.push(this.loadNodeAsync(`/nodes/${I.index}`,I,(q=>{q.parent=this._rootBabylonMesh})))}for(const t of this._postSceneLoadActions)t();return w.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(w).then((()=>{}))}_forEachPrimitive(q,I){if(q._primitiveBabylonMeshes)for(const l of q._primitiveBabylonMeshes)I(l)}_getGeometries(){const q=[],I=this._gltf.nodes;if(I)for(const l of I)this._forEachPrimitive(l,(I=>{const l=I.Wc;l&&-1===q.indexOf(l)&&q.push(l)}));return q}_getMeshes(){const q=[];this._rootBabylonMesh instanceof e.b&&q.push(this._rootBabylonMesh);const I=this._gltf.nodes;if(I)for(const l of I)this._forEachPrimitive(l,(I=>{q.push(I)}));return q}_getTransformNodes(){const q=[],I=this._gltf.nodes;if(I)for(const l of I)l._babylonTransformNode&&"Pc"===l._babylonTransformNode.getClassName()&&q.push(l._babylonTransformNode),l._babylonTransformNodeForSkin&&q.push(l._babylonTransformNodeForSkin);return q}_getSkeletons(){const q=[],I=this._gltf.skins;if(I)for(const l of I)l._data&&q.push(l._data.babylonSkeleton);return q}_getAnimationGroups(){const q=[],I=this._gltf.animations;if(I)for(const l of I)l._babylonAnimationGroup&&q.push(l._babylonAnimationGroup);return q}_startAnimations(){switch(this._parent.animationStartMode){case K.g.NONE:break;case K.g.FIRST:{const q=this._getAnimationGroups();0!==q.length&&q[0].start(!0);break}case K.g.ALL:{const q=this._getAnimationGroups();for(const I of q)I.start(!0);break}default:return void T.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadNodeAsync(q,I,l);if(w)return w;if(I._babylonTransformNode)throw new Error(`${q}: Invalid recursive node hierarchy`);const t=new Array;this.logOpen(`${q} ${I.name||""}`);const O=w=>{if(Y.AddPointerMetadata(w,q),Y._LoadTransform(I,w),void 0!=I.camera){const l=P.Get(`${q}/camera`,this._gltf.cameras,I.camera);t.push(this.loadCameraAsync(`/cameras/${l.index}`,l,(q=>{q.parent=w,this._babylonScene.useRightHandedSystem||(w.Xc.x=-1)})))}if(I.children)for(const l of I.children){const I=P.Get(`${q}/children/${l}`,this._gltf.nodes,l);t.push(this.loadNodeAsync(`/nodes/${I.index}`,I,(q=>{q.parent=w})))}l(w)},c=void 0!=I.mesh,a=this._parent.loadSkins&&void 0!=I.skin;if(!c||a){const q=I.name||`node${I.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new C.d(q,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==I.mesh?I._babylonTransformNode=l:I._babylonTransformNodeForSkin=l,O(l)}if(c)if(a){const l=P.Get(`${q}/mesh`,this._gltf.meshes,I.mesh);t.push(this._loadMeshAsync(`/meshes/${l.index}`,I,l,(l=>{const w=I._babylonTransformNodeForSkin;l.metadata=(0,h.d)(w.metadata,l.metadata||{});const O=P.Get(`${q}/skin`,this._gltf.skins,I.skin);t.push(this._loadSkinAsync(`/skins/${O.index}`,I,O,(q=>{this._forEachPrimitive(I,(I=>{I.skeleton=q})),this._postSceneLoadActions.push((()=>{if(void 0!=O.skeleton){const q=P.Get(`/skins/${O.index}/skeleton`,this._gltf.nodes,O.skeleton).parent;I.index===q.index?l.parent=w.parent:l.parent=q._babylonTransformNode}else l.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:w,skinnedNode:l})}))})))})))}else{const l=P.Get(`${q}/mesh`,this._gltf.meshes,I.mesh);t.push(this._loadMeshAsync(`/meshes/${l.index}`,I,l,O))}return this.logClose(),Promise.all(t).then((()=>(this._forEachPrimitive(I,(q=>{const I=q;!I.isAnInstance&&I.Wc&&I.Wc.useBoundingInfoFromGeometry?q.Mq():q.refreshBoundingInfo(!0,!0)})),I._babylonTransformNode)))}_loadMeshAsync(q,I,l,w){const t=l.primitives;if(!t||!t.length)throw new Error(`${q}: Primitives are missing`);void 0==t[0].index&&P.Assign(t);const O=new Array;this.logOpen(`${q} ${l.name||""}`);const c=I.name||`node${I.index}`;if(1===t.length){const w=l.primitives[0];O.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${w.index}`,c,I,l,w,(q=>{I._babylonTransformNode=q,I._primitiveBabylonMeshes=[q]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,I._babylonTransformNode=new C.d(c,this._babylonScene),I._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._primitiveBabylonMeshes=[];for(const w of t)O.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${w.index}`,`${c}_primitive${w.index}`,I,l,w,(q=>{q.parent=I._babylonTransformNode,I._primitiveBabylonMeshes.push(q)})))}return w(I._babylonTransformNode),this.logClose(),Promise.all(O).then((()=>I._babylonTransformNode))}_loadMeshPrimitiveAsync(q,I,l,w,t,O){const c=this._extensionsLoadMeshPrimitiveAsync(q,I,l,w,t,O);if(c)return c;this.logOpen(`${q}`);const a=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==l.skin&&!w.primitives[0].targets;let F,s;if(a&&t._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,F=t._instanceData.babylonSourceMesh.createInstance(I),F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s=t._instanceData.promise;else{const O=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new i.c(I,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.sideOrientation=this._babylonScene.useRightHandedSystem?B.c.CounterClockWiseSideOrientation:B.c.ClockWiseSideOrientation,this._createMorphTargets(q,l,w,t,c),O.push(this._loadVertexDataAsync(q,t,c).then((async I=>await this._loadMorphTargetsAsync(q,t,c,I).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,I.Kq(c),I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const Z=Y._GetDrawMode(q,t.mode);if(void 0==t.material){let q=this._defaultBabylonMaterialData[Z];q||(q=this._createDefaultMaterial("__GLTFLoader._default",Z),this._parent.onMaterialLoadedObservable.notifyObservers(q),this._defaultBabylonMaterialData[Z]=q),c.material=q}else if(!this.parent.skipMaterials){const I=P.Get(`${q}/material`,this._gltf.materials,t.material);O.push(this._loadMaterialAsync(`/materials/${I.index}`,I,c,Z,(q=>{c.material=q})))}s=Promise.all(O),a&&(t._instanceData={babylonSourceMesh:c,promise:s}),F=c}return Y.AddPointerMetadata(F,q),this._parent.onMeshLoadedObservable.notifyObservers(F),O(F),this.logClose(),s.then((()=>F))}_loadVertexDataAsync(q,I,l){const w=this._extensionsLoadVertexDataAsync(q,I,l);if(w)return w;const t=I.attributes;if(!t)throw new Error(`${q}: Attributes are missing`);const O=new Array,c=new W.c(l.name,this._babylonScene);if(void 0==I.indices)l.isUnIndexed=!0;else{const l=P.Get(`${q}/indices`,this._gltf.accessors,I.indices);O.push(this._loadIndicesAccessorAsync(`/accessors/${l.index}`,l).then((q=>{c.setIndices(q)})))}const a=(I,w,a)=>{if(void 0==t[I])return;l._delayInfo=l._delayInfo||[],-1===l._delayInfo.indexOf(w)&&l._delayInfo.push(w);const F=P.Get(`${q}/attributes/${I}`,this._gltf.accessors,t[I]);O.push(this._loadVertexAccessorAsync(`/accessors/${F.index}`,F,w).then((q=>{if(q.getKind()===R.c.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!l.skeleton){const q=mq(F);q&&(c._boundingInfo=q,c.useBoundingInfoFromGeometry=!0)}c.setVerticesBuffer(q,F.count)}))),w==R.c.MatricesIndicesExtraKind&&(l.numBoneInfluencers=8),a&&a(F)};return a("POSITION",R.c.PositionKind),a("NORMAL",R.c.NormalKind),a("TANGENT",R.c.TangentKind),a("TEXCOORD_0",R.c.UVKind),a("TEXCOORD_1",R.c.UV2Kind),a("TEXCOORD_2",R.c.UV3Kind),a("TEXCOORD_3",R.c.UV4Kind),a("TEXCOORD_4",R.c.UV5Kind),a("TEXCOORD_5",R.c.UV6Kind),a("JOINTS_0",R.c.MatricesIndicesKind),a("WEIGHTS_0",R.c.MatricesWeightsKind),a("JOINTS_1",R.c.MatricesIndicesExtraKind),a("WEIGHTS_1",R.c.MatricesWeightsExtraKind),a("COLOR_0",R.c.ColorKind,(q=>{"VEC4"===q.type&&(l.hasVertexAlpha=!0)})),Promise.all(O).then((()=>c))}_createMorphTargets(q,I,l,w,t){if(!w.targets||!this._parent.loadMorphTargets)return;if(void 0==I._numMorphTargets)I._numMorphTargets=w.targets.length;else if(w.targets.length!==I._numMorphTargets)throw new Error(`${q}: Primitives do not have the same number of targets`);const O=l.extras?l.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,t.morphTargetManager=new X(this._babylonScene),t.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.morphTargetManager.areUpdatesFrozen=!0;for(let c=0;c<w.targets.length;c++){const q=I.weights?I.weights[c]:l.weights?l.weights[c]:0,w=O?O[c]:`morphTarget${c}`;t.morphTargetManager.addTarget(new S.b(w,q,t.Wq()))}}_loadMorphTargetsAsync(q,I,l,w){if(!I.targets||!this._parent.loadMorphTargets)return Promise.resolve();const t=new Array,O=l.morphTargetManager;for(let c=0;c<O.numTargets;c++){const l=O.getTarget(c);t.push(this._loadMorphTargetVertexDataAsync(`${q}/targets/${c}`,w,I.targets[c],l))}return Promise.all(t).then((()=>{O.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(q,I,l,w){const t=new Array,O=(w,O,c)=>{if(void 0==l[w])return;const a=I.getVertexBuffer(O);if(!a)return;const F=P.Get(`${q}/${w}`,this._gltf.accessors,l[w]);t.push(this._loadFloatAccessorAsync(`/accessors/${F.index}`,F).then((q=>{c(a,q)})))};return O("POSITION",R.c.PositionKind,((q,I)=>{const l=new Float32Array(I.length);q.forEach(I.length,((q,w)=>{l[w]=I[w]+q})),w.setPositions(l)})),O("NORMAL",R.c.NormalKind,((q,I)=>{const l=new Float32Array(I.length);q.forEach(l.length,((q,w)=>{l[w]=I[w]+q})),w.setNormals(l)})),O("TANGENT",R.c.TangentKind,((q,I)=>{const l=new Float32Array(I.length/3*4);let t=0;q.forEach(I.length/3*4,((q,w)=>{(w+1)%4!==0&&(l[t]=I[t]+q,t++)})),w.setTangents(l)})),O("TEXCOORD_0",R.c.UVKind,((q,I)=>{const l=new Float32Array(I.length);q.forEach(I.length,((q,w)=>{l[w]=I[w]+q})),w.setUVs(l)})),O("TEXCOORD_1",R.c.UV2Kind,((q,I)=>{const l=new Float32Array(I.length);q.forEach(I.length,((q,w)=>{l[w]=I[w]+q})),w.setUV2s(l)})),O("COLOR_0",R.c.ColorKind,((I,l)=>{let t=null;const O=I.getSize();if(3===O){t=new Float32Array(l.length/3*4),I.forEach(l.length,((q,I)=>{const w=Math.floor(I/3),O=I%3;t[4*w+O]=l[3*w+O]+q}));for(let q=0;q<l.length/3;++q)t[4*q+3]=1}else{if(4!==O)throw new Error(`${q}: Invalid number of components (${O}) for COLOR_0 attribute`);t=new Float32Array(l.length),I.forEach(l.length,((q,I)=>{t[I]=l[I]+q}))}w.setColors(t)})),await Promise.all(t).then((()=>{}))}static _LoadTransform(q,I){if(void 0!=q.skin)return;let l=t.dI.Zero(),w=t.Quaternion.Identity(),O=t.dI.One();if(q.matrix){t.Matrix.vI(q.matrix).decompose(O,w,l)}else q.translation&&(l=t.dI.vI(q.translation)),q.rotation&&(w=t.Quaternion.vI(q.rotation)),q.scale&&(O=t.dI.vI(q.scale));I.position=l,I.rotationQuaternion=w,I.Xc=O}_loadSkinAsync(q,I,l,w){if(!this._parent.loadSkins)return Promise.resolve();const t=this._extensionsLoadSkinAsync(q,I,l);if(t)return t;if(l._data)return w(l._data.babylonSkeleton),l._data.promise;const O=`skeleton${l.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new U(l.name||O,O,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(q,l,c);const a=this._loadSkinInverseBindMatricesDataAsync(q,l).then((q=>{this._updateBoneMatrices(c,q)}));return l._data={babylonSkeleton:c,promise:a},w(c),a}_loadBones(q,I,l){if(void 0==I.skeleton||this._parent.alwaysComputeSkeletonRootNode){const l=this._findSkeletonRootNode(`${q}/joints`,I.joints);if(l)if(void 0===I.skeleton)I.skeleton=l.index;else{const w=(q,I)=>{for(;I.parent;I=I.parent)if(I.parent===q)return!0;return!1},t=P.Get(`${q}/skeleton`,this._gltf.nodes,I.skeleton);t===l||w(t,l)||(T.b.Warn(`${q}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),I.skeleton=l.index)}else T.b.Warn(`${q}: Failed to find common root`)}const w={};for(const t of I.joints){const O=P.Get(`${q}/joints/${t}`,this._gltf.nodes,t);this._loadBone(O,I,l,w)}}_findSkeletonRootNode(q,I){if(0===I.length)return null;const l={};for(const t of I){const I=[];let w=P.Get(`${q}/${t}`,this._gltf.nodes,t);for(;-1!==w.index;)I.unshift(w),w=w.parent;l[t]=I}let w=null;for(let t=0;;++t){let q=l[I[0]];if(t>=q.length)return w;const O=q[t];for(let c=1;c<I.length;++c)if(q=l[I[c]],t>=q.length||O!==q[t])return w;w=O}}_loadBone(q,I,l,w){q._isJoint=!0;let t=w[q.index];if(t)return t;let O=null;q.index!==I.skeleton&&(q.parent&&-1!==q.parent.index?O=this._loadBone(q.parent,I,l,w):void 0!==I.skeleton&&T.b.Warn(`/skins/${I.index}/skeleton: Skeleton node is not a common root`));const c=I.joints.indexOf(q.index);return t=new s.e(q.name||`joint${q.index}`,l,O,this._getNodeMatrix(q),null,null,c),w[q.index]=t,this._postSceneLoadActions.push((()=>{t.linkTransformNode(q._babylonTransformNode)})),t}_loadSkinInverseBindMatricesDataAsync(q,I){if(void 0==I.inverseBindMatrices)return Promise.resolve(null);const l=P.Get(`${q}/inverseBindMatrices`,this._gltf.accessors,I.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${l.index}`,l)}_updateBoneMatrices(q,I){for(const l of q.bones){const q=t.Matrix.Identity(),w=l._index;I&&-1!==w&&(t.Matrix.FromArrayToRef(I,16*w,q),q.invertToRef(q));const O=l.getParent();O&&q.multiplyToRef(O.getAbsoluteInverseBindMatrix(),q),l.kc(q,!1,!1),l._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(q){return q.matrix?t.Matrix.vI(q.matrix):t.Matrix.Compose(q.scale?t.dI.vI(q.scale):t.dI.One(),q.rotation?t.Quaternion.vI(q.rotation):t.Quaternion.Identity(),q.translation?t.dI.vI(q.translation):t.dI.Zero())}loadCameraAsync(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadCameraAsync(q,I,l);if(w)return w;const O=new Array;this.logOpen(`${q} ${I.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new F.b(I.name||`camera${I.index}`,t.dI.Zero(),this._babylonScene,!1);switch(c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._babylonCamera=c,c.setTarget(new t.dI(0,0,-1)),I.type){case"perspective":{const l=I.perspective;if(!l)throw new Error(`${q}: Camera perspective properties are missing`);c.fov=l.yfov,c.vc=l.znear,c.maxZ=l.zfar||0;break}case"orthographic":if(!I.orthographic)throw new Error(`${q}: Camera orthographic properties are missing`);c.mode=a.d.ORTHOGRAPHIC_CAMERA,c.orthoLeft=-I.orthographic.xmag,c.orthoRight=I.orthographic.xmag,c.orthoBottom=-I.orthographic.ymag,c.orthoTop=I.orthographic.ymag,c.vc=I.orthographic.znear,c.maxZ=I.orthographic.zfar;break;default:throw new Error(`${q}: Invalid camera type (${I.type})`)}return Y.AddPointerMetadata(c,q),this._parent.onCameraLoadedObservable.notifyObservers(c),l(c),this.logClose(),Promise.all(O).then((()=>c))}_loadAnimationsAsync(){const q=this._gltf.animations;if(!q)return Promise.resolve();const I=new Array;for(let l=0;l<q.length;l++){const w=q[l];I.push(this.loadAnimationAsync(`/animations/${w.index}`,w).then((q=>{0===q.targetedAnimations.length&&q.dispose()})))}return Promise.all(I).then((()=>{}))}loadAnimationAsync(q,I){const w=this._extensionsLoadAnimationAsync(q,I);return w||l.e(78).then(l.bind(l,15931)).then((l=>{let{AnimationGroup:w}=l;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new w(I.name||`animation${I.index}`,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._babylonAnimationGroup=t;const O=new Array;P.Assign(I.channels),P.Assign(I.samplers);for(const c of I.channels)O.push(this._loadAnimationChannelAsync(`${q}/channels/${c.index}`,q,I,c,((q,I)=>{q.animations=q.animations||[],q.animations.push(I),t.addTargetedAnimation(I,q)})));return Promise.all(O).then((()=>(t.normalize(0),t)))}))}async _loadAnimationChannelAsync(q,I,w,t,O){const c=this._extensionsLoadAnimationChannelAsync(q,I,w,t,O);if(c)return await c;if(void 0==t.target.node)return await Promise.resolve();const a=P.Get(`${q}/target/node`,this._gltf.nodes,t.target.node),F=t.target.path,s="weights"===F;if(s&&!a._numMorphTargets||!s&&!a._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!s&&!a._isJoint)return await Promise.resolve();let Z;switch(await Promise.resolve().then(l.bind(l,14399)),F){case"translation":var r;Z=null===(r=(0,j.g)("/nodes/{}/translation"))||void 0===r?void 0:r.interpolation;break;case"rotation":var x;Z=null===(x=(0,j.g)("/nodes/{}/rotation"))||void 0===x?void 0:x.interpolation;break;case"scale":var o;Z=null===(o=(0,j.g)("/nodes/{}/scale"))||void 0===o?void 0:o.interpolation;break;case"weights":var d;Z=null===(d=(0,j.g)("/nodes/{}/weights"))||void 0===d?void 0:d.interpolation;break;default:throw new Error(`${q}/target/path: Invalid value (${t.target.path})`)}if(!Z)throw new Error(`${q}/target/path: Could not find interpolation properties for target path (${t.target.path})`);const T={object:a,info:Z};return await this._loadAnimationChannelFromTargetInfoAsync(q,I,w,t,T,O)}_loadAnimationChannelFromTargetInfoAsync(q,I,l,w,t,O){const c=this.parent.targetFps,a=1/c,F=P.Get(`${q}/sampler`,l.samplers,w.sampler);return this._loadAnimationSamplerAsync(`${I}/samplers/${w.sampler}`,F).then((q=>{let I=0;const F=t.object,s=t.info;for(const t of s){const s=t.getStride(F),Z=q.input,r=q.output,x=new Array(Z.length);let o=0;switch(q.interpolation){case"STEP":for(let q=0;q<Z.length;q++){const I=t.getValue(F,r,o,1);o+=s,x[q]={frame:Z[q]*c,value:I,interpolation:1}}break;case"CUBICSPLINE":for(let q=0;q<Z.length;q++){const I=t.getValue(F,r,o,a);o+=s;const l=t.getValue(F,r,o,1);o+=s;const w=t.getValue(F,r,o,a);o+=s,x[q]={frame:Z[q]*c,inTangent:I,value:l,outTangent:w}}break;case"LINEAR":for(let q=0;q<Z.length;q++){const I=t.getValue(F,r,o,1);o+=s,x[q]={frame:Z[q]*c,value:I}}}if(o>0){const q=`${l.name||`animation${l.index}`}_channel${w.index}_${I}`,a=t.buildAnimations(F,q,c,x);for(const l of a)I++,O(l.babylonAnimatable,l.babylonAnimation)}}}))}_loadAnimationSamplerAsync(q,I){if(I._data)return I._data;const l=I.interpolation||"LINEAR";switch(l){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${q}/interpolation: Invalid value (${I.interpolation})`)}const w=P.Get(`${q}/input`,this._gltf.accessors,I.input),t=P.Get(`${q}/output`,this._gltf.accessors,I.output);return I._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${w.index}`,w),this._loadFloatAccessorAsync(`/accessors/${t.index}`,t)]).then((q=>{let[I,w]=q;return{input:I,interpolation:l,output:w}})),I._data}loadBufferAsync(q,I,l,w){const t=this._extensionsLoadBufferAsync(q,I,l,w);if(t)return t;if(!I._data)if(I.uri)I._data=this.loadUriAsync(`${q}/uri`,I,I.uri);else{if(!this._bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);I._data=this._bin.readAsync(0,I.byteLength)}return I._data.then((I=>{try{return new Uint8Array(I.buffer,I.byteOffset+l,w)}catch(t){throw new Error(`${q}: ${t.message}`)}}))}loadBufferViewAsync(q,I){const l=this._extensionsLoadBufferViewAsync(q,I);if(l)return l;if(I._data)return I._data;const w=P.Get(`${q}/buffer`,this._gltf.buffers,I.buffer);return I._data=this.loadBufferAsync(`/buffers/${w.index}`,w,I.byteOffset||0,I.byteLength),I._data}_loadAccessorAsync(q,I,l){if(I._data)return I._data;const w=Y._GetNumComponents(q,I.type),t=w*R.c.GetTypeByteLength(I.componentType),O=w*I.count;if(void 0==I.bufferView)I._data=Promise.resolve(new l(O));else{const c=P.Get(`${q}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${c.index}`,c).then((a=>{if(5126!==I.componentType||I.normalized||c.byteStride&&c.byteStride!==t){const q=new l(O);return R.c.ForEach(a,I.byteOffset||0,c.byteStride||t,w,I.componentType,q.length,I.normalized||!1,((I,l)=>{q[l]=I})),q}return Y._GetTypedArray(q,I.componentType,a,I.byteOffset,O)}))}if(I.sparse){const O=I.sparse;I._data=I._data.then((c=>{const a=c,F=P.Get(`${q}/sparse/indices/bufferView`,this._gltf.bufferViews,O.indices.bufferView),s=P.Get(`${q}/sparse/values/bufferView`,this._gltf.bufferViews,O.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${F.index}`,F),this.loadBufferViewAsync(`/bufferViews/${s.index}`,s)]).then((c=>{let[F,s]=c;const Z=Y._GetTypedArray(`${q}/sparse/indices`,O.indices.componentType,F,O.indices.byteOffset,O.count),r=w*O.count;let x;if(5126!==I.componentType||I.normalized){const c=Y._GetTypedArray(`${q}/sparse/values`,I.componentType,s,O.values.byteOffset,r);x=new l(r),R.c.ForEach(c,0,t,w,I.componentType,x.length,I.normalized||!1,((q,I)=>{x[I]=q}))}else x=Y._GetTypedArray(`${q}/sparse/values`,I.componentType,s,O.values.byteOffset,r);let o=0;for(let q=0;q<Z.length;q++){let I=Z[q]*w;for(let q=0;q<w;q++)a[I++]=x[o++]}return a}))}))}return I._data}_loadFloatAccessorAsync(q,I){return this._loadAccessorAsync(q,I,Float32Array)}_loadIndicesAccessorAsync(q,I){if("SCALAR"!==I.type)throw new Error(`${q}/type: Invalid value ${I.type}`);if(5121!==I.componentType&&5123!==I.componentType&&5125!==I.componentType)throw new Error(`${q}/componentType: Invalid value ${I.componentType}`);if(I._data)return I._data;if(I.sparse){const l=Y._GetTypedArrayConstructor(`${q}/componentType`,I.componentType);I._data=this._loadAccessorAsync(q,I,l)}else{const l=P.Get(`${q}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((l=>Y._GetTypedArray(q,I.componentType,l,I.byteOffset,I.count)))}return I._data}_loadVertexBufferViewAsync(q){if(q._babylonBuffer)return q._babylonBuffer;const I=this._babylonScene.getEngine();return q._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((q=>new R.b(I,q,!1))),q._babylonBuffer}_loadVertexAccessorAsync(q,I,l){var w;if(null!==(w=I._babylonVertexBuffer)&&void 0!==w&&w[l])return I._babylonVertexBuffer[l];I._babylonVertexBuffer||(I._babylonVertexBuffer={});const t=this._babylonScene.getEngine();if(I.sparse||void 0==I.bufferView)I._babylonVertexBuffer[l]=this._loadFloatAccessorAsync(q,I).then((q=>new R.c(t,q,l,!1)));else{const w=P.Get(`${q}/bufferView`,this._gltf.bufferViews,I.bufferView);I._babylonVertexBuffer[l]=this._loadVertexBufferViewAsync(w).then((O=>{const c=Y._GetNumComponents(q,I.type);return new R.c(t,O,l,!1,void 0,w.byteStride,void 0,I.byteOffset,c,I.componentType,I.normalized,!0,void 0,!0)}))}return I._babylonVertexBuffer[l]}_loadMaterialMetallicRoughnessPropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;return I&&(I.baseColorFactor?(l.albedoColor=O.BI.vI(I.baseColorFactor),l.alpha=I.baseColorFactor[3]):l.albedoColor=O.BI.White(),l.metallic=void 0==I.metallicFactor?1:I.metallicFactor,l.roughness=void 0==I.roughnessFactor?1:I.roughnessFactor,I.baseColorTexture&&w.push(this.loadTextureInfoAsync(`${q}/baseColorTexture`,I.baseColorTexture,(q=>{q.name=`${l.name} (Base Color)`,l.albedoTexture=q}))),I.metallicRoughnessTexture&&(I.metallicRoughnessTexture.nonColorData=!0,w.push(this.loadTextureInfoAsync(`${q}/metallicRoughnessTexture`,I.metallicRoughnessTexture,(q=>{q.name=`${l.name} (Metallic Roughness)`,l.metallicTexture=q}))),l.useMetallnessFromMetallicTextureBlue=!0,l.useRoughnessFromMetallicTextureGreen=!0,l.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(w).then((()=>{}))}_loadMaterialAsync(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const O=this._extensionsLoadMaterialAsync(q,I,l,w,t);if(O)return O;I._data=I._data||{};let c=I._data[w];if(!c){this.logOpen(`${q} ${I.name||""}`);const l=this.createMaterial(q,I,w);c={babylonMaterial:l,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(q,I,l)},I._data[w]=c,Y.AddPointerMetadata(l,q),this._parent.onMaterialLoadedObservable.notifyObservers(l),this.logClose()}return l&&(c.babylonMeshes.push(l),l.tc.addOnce((()=>{const q=c.babylonMeshes.indexOf(l);-1!==q&&c.babylonMeshes.splice(q,1)}))),t(c.babylonMaterial),c.promise.then((()=>c.babylonMaterial))}_createDefaultMaterial(q,I){this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new v.c(q,this._babylonScene);return l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.fillMode=I,l.enableSpecularAntiAliasing=!0,l.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,l.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,l.transparencyMode=v.c.PBRMATERIAL_OPAQUE,l.metallic=1,l.roughness=1,l}createMaterial(q,I,l){const w=this._extensionsCreateMaterial(q,I,l);if(w)return w;const t=I.name||`material${I.index}`;return this._createDefaultMaterial(t,l)}loadMaterialPropertiesAsync(q,I,l){const w=this._extensionsLoadMaterialPropertiesAsync(q,I,l);if(w)return w;const t=new Array;return t.push(this.loadMaterialBasePropertiesAsync(q,I,l)),I.pbrMetallicRoughness&&t.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${q}/pbrMetallicRoughness`,I.pbrMetallicRoughness,l)),this.loadMaterialAlphaProperties(q,I,l),Promise.all(t).then((()=>{}))}loadMaterialBasePropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;return l.emissiveColor=I.emissiveFactor?O.BI.vI(I.emissiveFactor):new O.BI(0,0,0),I.doubleSided&&(l.Sc=!1,l.twoSidedLighting=!0),I.normalTexture&&(I.normalTexture.nonColorData=!0,w.push(this.loadTextureInfoAsync(`${q}/normalTexture`,I.normalTexture,(q=>{q.name=`${l.name} (Normal)`,l.bumpTexture=q}))),l.invertNormalMapX=!this._babylonScene.useRightHandedSystem,l.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=I.normalTexture.scale&&l.bumpTexture&&(l.bumpTexture.level=I.normalTexture.scale),l.forceIrradianceInFragment=!0),I.occlusionTexture&&(I.occlusionTexture.nonColorData=!0,w.push(this.loadTextureInfoAsync(`${q}/occlusionTexture`,I.occlusionTexture,(q=>{q.name=`${l.name} (Occlusion)`,l.ambientTexture=q}))),l.useAmbientInGrayScale=!0,void 0!=I.occlusionTexture.strength&&(l.ambientTextureStrength=I.occlusionTexture.strength)),I.emissiveTexture&&w.push(this.loadTextureInfoAsync(`${q}/emissiveTexture`,I.emissiveTexture,(q=>{q.name=`${l.name} (Emissive)`,l.emissiveTexture=q}))),Promise.all(w).then((()=>{}))}loadMaterialAlphaProperties(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);switch(I.alphaMode||"OPAQUE"){case"OPAQUE":l.transparencyMode=v.c.PBRMATERIAL_OPAQUE,l.alpha=1;break;case"MASK":l.transparencyMode=v.c.PBRMATERIAL_ALPHATEST,l.alphaCutOff=void 0==I.alphaCutoff?.5:I.alphaCutoff,l.albedoTexture&&(l.albedoTexture.Bc=!0);break;case"BLEND":l.transparencyMode=v.c.PBRMATERIAL_ALPHABLEND,l.albedoTexture&&(l.albedoTexture.Bc=!0,l.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${q}/alphaMode: Invalid value (${I.alphaMode})`)}}loadTextureInfoAsync(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadTextureInfoAsync(q,I,l);if(w)return w;if(this.logOpen(`${q}`),I.texCoord>=6)throw new Error(`${q}/texCoord: Invalid value (${I.texCoord})`);const t=P.Get(`${q}/index`,this._gltf.textures,I.index);t._textureInfo=I;const O=this._loadTextureAsync(`/textures/${I.index}`,t,(w=>{w.coordinatesIndex=I.texCoord||0,Y.AddPointerMetadata(w,q),this._parent.onTextureLoadedObservable.notifyObservers(w),l(w)}));return this.logClose(),O}_loadTextureAsync(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadTextureAsync(q,I,l);if(w)return w;this.logOpen(`${q} ${I.name||""}`);const t=void 0==I.sampler?Y.DefaultSampler:P.Get(`${q}/sampler`,this._gltf.samplers,I.sampler),O=P.Get(`${q}/source`,this._gltf.images,I.source),c=this._createTextureAsync(q,t,O,l,void 0,!I._textureInfo.nonColorData);return this.logClose(),c}_createTextureAsync(q,I,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},O=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;const a=this._loadSampler(`/samplers/${I.index}`,I),F=new Array,s=new w;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z={noMipmap:a.noMipMaps,invertY:!1,samplingMode:a.samplingMode,J:()=>{this._disposed||s.resolve()},onError:(I,l)=>{this._disposed||s.reject(new Error(`${q}: ${l&&l.message?l.message:I||"Failed to load texture"}`))},mimeType:l.mimeType??(0,D.i)(l.uri??""),loaderOptions:O,useSRGBBuffer:!!c&&this._parent.useSRGBBuffers},r=new k.d(null,this._babylonScene,Z);return r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.push(s.promise),F.push(this.loadImageAsync(`/images/${l.index}`,l).then((q=>{const I=l.uri||`${this._fileName}#image${l.index}`,w=`data:${this._uniqueRootUrl}${I}`;r.updateURL(w,q);const t=r.getInternalTexture();t&&(t.label=l.name)}))),r.wrapU=a.wrapU,r.wrapV=a.wrapV,t(r),this._parent.useGltfTextureNames&&(r.name=l.name||l.uri||`image${l.index}`),Promise.all(F).then((()=>r))}_loadSampler(q,I){return I._data||(I._data={noMipMaps:9728===I.minFilter||9729===I.minFilter,samplingMode:Y._GetTextureSamplingMode(q,I),wrapU:Y._GetTextureWrapMode(`${q}/wrapS`,I.wrapS),wrapV:Y._GetTextureWrapMode(`${q}/wrapT`,I.wrapT)}),I._data}loadImageAsync(q,I){if(!I._data){if(this.logOpen(`${q} ${I.name||""}`),I.uri)I._data=this.loadUriAsync(`${q}/uri`,I,I.uri);else{const l=P.Get(`${q}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)}this.logClose()}return I._data}loadUriAsync(q,I,l){const w=this._extensionsLoadUriAsync(q,I,l);if(w)return w;if(!Y._ValidateUri(l))throw new Error(`${q}: '${l}' is invalid`);if((0,D.k)(l)){const I=new Uint8Array((0,D.e)(l));return this.log(`${q}: Decoded ${l.substring(0,64)}... (${I.length} bytes)`),Promise.resolve(I)}return this.log(`${q}: Loading ${l}`),this._parent.preprocessUrlAsync(this._rootUrl+l).then((I=>new Promise(((w,t)=>{this._parent._loadFile(this._babylonScene,I,(I=>{this._disposed||(this.log(`${q}: Loaded ${l} (${I.byteLength} bytes)`),w(new Uint8Array(I)))}),!0,(I=>{t(new D.m(`${q}: Failed to load '${l}'${I?": "+I.status+" "+I.statusText:""}`,I))}))}))))}static AddPointerMetadata(q,I){q.metadata=q.metadata||{};const l=q._internalMetadata=q._internalMetadata||{},w=l.rc=l.rc||{};(w.pointers=w.pointers||[]).push(I)}static _GetTextureWrapMode(q,I){switch(I=void 0==I?10497:I){case 33071:return k.d.CLAMP_ADDRESSMODE;case 33648:return k.d.MIRROR_ADDRESSMODE;case 10497:return k.d.WRAP_ADDRESSMODE;default:return T.b.Warn(`${q}: Invalid value (${I})`),k.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(q,I){const l=void 0==I.magFilter?9729:I.magFilter,w=void 0==I.minFilter?9987:I.minFilter;if(9729===l)switch(w){case 9728:return k.d.LINEAR_NEAREST;case 9729:return k.d.LINEAR_LINEAR;case 9984:return k.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return k.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return k.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return k.d.LINEAR_LINEAR_MIPLINEAR;default:return T.b.Warn(`${q}/minFilter: Invalid value (${w})`),k.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==l&&T.b.Warn(`${q}/magFilter: Invalid value (${l})`),w){case 9728:return k.d.NEAREST_NEAREST;case 9729:return k.d.NEAREST_LINEAR;case 9984:return k.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return k.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return k.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return k.d.NEAREST_LINEAR_MIPLINEAR;default:return T.b.Warn(`${q}/minFilter: Invalid value (${w})`),k.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(q,I){try{return(0,u.l)(I)}catch(l){throw new Error(`${q}: ${l.message}`)}}static _GetTypedArray(q,I,l,w,t){const O=l.buffer;w=l.byteOffset+(w||0);const c=Y._GetTypedArrayConstructor(`${q}/componentType`,I),a=R.c.GetTypeByteLength(I);return w%a!==0?(T.b.Warn(`${q}: Copying buffer as byte offset (${w}) is not a multiple of component type byte length (${a})`),new c(O.slice(w,w+t*a),0)):new c(O,w,t)}static _GetNumComponents(q,I){switch(I){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${q}: Invalid type (${I})`)}static _ValidateUri(q){return c.Tools.IsBase64(q)||-1===q.indexOf("..")}static _GetDrawMode(q,I){switch(void 0==I&&(I=4),I){case 0:return B.c.PointListDrawMode;case 1:return B.c.LineListDrawMode;case 2:return B.c.LineLoopDrawMode;case 3:return B.c.LineStripDrawMode;case 4:return B.c.TriangleFillMode;case 5:return B.c.TriangleStripDrawMode;case 6:return B.c.TriangleFanDrawMode}throw new Error(`${q}: Invalid mesh primitive mode (${I})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const q=new Array;if(this._gltf.materials)for(const I of this._gltf.materials)if(I._data)for(const l in I._data){const w=I._data[l];for(const I of w.babylonMeshes){I.Cc(!0);const l=w.babylonMaterial;q.push(l.forceCompilationAsync(I)),q.push(l.forceCompilationAsync(I,{useInstances:!0})),this._parent.useClipPlane&&(q.push(l.forceCompilationAsync(I,{clipPlane:!0})),q.push(l.forceCompilationAsync(I,{clipPlane:!0,useInstances:!0})))}}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const q=new Array,I=this._babylonScene.lights;for(const l of I){const I=l.getShadowGenerator();I&&q.push(I.forceCompilationAsync())}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(q){for(const I of this._extensions)I.enabled&&q(I)}_applyExtensions(q,I,l){for(const w of this._extensions)if(w.enabled){const t=`${w.name}.${I}`,O=q;O._activeLoaderExtensionFunctions=O._activeLoaderExtensionFunctions||{};const c=O._activeLoaderExtensionFunctions;if(!c[t]){c[t]=!0;try{const q=l(w);if(q)return q}finally{delete c[t]}}}return null}_extensionsOnLoading(){this._forEachExtensions((q=>q.onLoading&&q.onLoading()))}_extensionsOnReady(){this._forEachExtensions((q=>q.onReady&&q.onReady()))}_extensionsLoadSceneAsync(q,I){return this._applyExtensions(I,"loadScene",(l=>l.loadSceneAsync&&l.loadSceneAsync(q,I)))}_extensionsLoadNodeAsync(q,I,l){return this._applyExtensions(I,"loadNode",(w=>w.loadNodeAsync&&w.loadNodeAsync(q,I,l)))}_extensionsLoadCameraAsync(q,I,l){return this._applyExtensions(I,"loadCamera",(w=>w.loadCameraAsync&&w.loadCameraAsync(q,I,l)))}_extensionsLoadVertexDataAsync(q,I,l){return this._applyExtensions(I,"loadVertexData",(w=>w._loadVertexDataAsync&&w._loadVertexDataAsync(q,I,l)))}_extensionsLoadMeshPrimitiveAsync(q,I,l,w,t,O){return this._applyExtensions(t,"loadMeshPrimitive",(c=>c._loadMeshPrimitiveAsync&&c._loadMeshPrimitiveAsync(q,I,l,w,t,O)))}_extensionsLoadMaterialAsync(q,I,l,w,t){return this._applyExtensions(I,"loadMaterial",(O=>O._loadMaterialAsync&&O._loadMaterialAsync(q,I,l,w,t)))}_extensionsCreateMaterial(q,I,l){return this._applyExtensions(I,"createMaterial",(w=>w.createMaterial&&w.createMaterial(q,I,l)))}_extensionsLoadMaterialPropertiesAsync(q,I,l){return this._applyExtensions(I,"loadMaterialProperties",(w=>w.loadMaterialPropertiesAsync&&w.loadMaterialPropertiesAsync(q,I,l)))}_extensionsLoadTextureInfoAsync(q,I,l){return this._applyExtensions(I,"loadTextureInfo",(w=>w.loadTextureInfoAsync&&w.loadTextureInfoAsync(q,I,l)))}_extensionsLoadTextureAsync(q,I,l){return this._applyExtensions(I,"loadTexture",(w=>w._loadTextureAsync&&w._loadTextureAsync(q,I,l)))}_extensionsLoadAnimationAsync(q,I){return this._applyExtensions(I,"loadAnimation",(l=>l.loadAnimationAsync&&l.loadAnimationAsync(q,I)))}_extensionsLoadAnimationChannelAsync(q,I,l,w,t){return this._applyExtensions(l,"loadAnimationChannel",(O=>O._loadAnimationChannelAsync&&O._loadAnimationChannelAsync(q,I,l,w,t)))}_extensionsLoadSkinAsync(q,I,l){return this._applyExtensions(l,"loadSkin",(w=>w._loadSkinAsync&&w._loadSkinAsync(q,I,l)))}_extensionsLoadUriAsync(q,I,l){return this._applyExtensions(I,"loadUri",(w=>w._loadUriAsync&&w._loadUriAsync(q,I,l)))}_extensionsLoadBufferViewAsync(q,I){return this._applyExtensions(I,"loadBufferView",(l=>l.loadBufferViewAsync&&l.loadBufferViewAsync(q,I)))}_extensionsLoadBufferAsync(q,I,l,w){return this._applyExtensions(I,"loadBuffer",(t=>t.loadBufferAsync&&t.loadBufferAsync(q,I,l,w)))}static LoadExtensionAsync(q,I,l,w){if(!I.extensions)return null;const t=I.extensions[l];return t?w(`${q}/extensions/${l}`,t):null}static LoadExtraAsync(q,I,l,w){if(!I.extras)return null;const t=I.extras[l];return t?w(`${q}/extras/${l}`,t):null}isExtensionUsed(q){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(q)}logOpen(q){this._parent._logOpen(q)}logClose(){this._parent._logClose()}log(q){this._parent._log(q)}startPerformanceCounter(q){this._parent._startPerformanceCounter(q)}endPerformanceCounter(q){this._parent._endPerformanceCounter(q)}}Y.DefaultSampler={index:-1},K.d._CreateGLTF2Loader=q=>new Y(q);var y=l(14399),G=l(12939),N=l(12777),J=l(14401),z=l(14403);class H extends z.d{constructor(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",q),this._texture=q.getEngine().createRawCubeTexture(I,l,w,t,O,c,a,F)}update(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,q,I,l,w,t)}updateRGBDAsync(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,J.j)(this._texture,q,I,l,w).then((()=>{}))}clone(){return N.c.Clone((()=>{const q=this.Wq(),I=this._texture,l=new H(q,I._bufferViewArray,I.width,I.format,I.type,I.generateMipMaps,I.invertY,I.samplingMode,I._compression);return 13===I.source&&l.updateRGBDAsync(I._bufferViewArrayArray,I._sphericalPolynomial,I._lodGenerationScale,I._lodGenerationOffset),l}),this)}}const A="EXT_lights_image_based";class Q{constructor(q){this.name=A,this._loader=q,this.enabled=this._loader.isExtensionUsed(A)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.rc.extensions;if(q&&q[this.name]){const I=q[this.name];this._lights=I.lights}}loadSceneAsync(q,I){return Y.LoadExtensionAsync(q,I,this.name,(async(l,w)=>{this._loader._allMaterialsDirtyRequired=!0;const t=new Array;t.push(this._loader.loadSceneAsync(q,I)),this._loader.logOpen(`${l}`);const O=P.Get(`${l}/light`,this._lights,w.qc);return t.push(this._loadLightAsync(`/extensions/${this.name}/lights/${w.qc}`,O).then((q=>{this._loader.babylonScene.environmentTexture=q}))),this._loader.logClose(),await Promise.all(t).then((()=>{}))}))}_loadLightAsync(q,I){if(!I._loaded){const l=new Array;this._loader.logOpen(`${q}`);const w=new Array(I.specularImages.length);for(let t=0;t<I.specularImages.length;t++){const O=I.specularImages[t];w[t]=new Array(O.length);for(let I=0;I<O.length;I++){const c=`${q}/specularImages/${t}/${I}`;this._loader.logOpen(`${c}`);const a=O[I],F=P.Get(c,this._loader.rc.images,a);l.push(this._loader.loadImageAsync(`/images/${a}`,F).then((q=>{w[t][I]=q}))),this._loader.logClose()}}this._loader.logClose(),I._loaded=Promise.all(l).then((async()=>{const l=new H(this._loader.babylonScene,null,I.specularImageSize);if(l.name=I.name||"environment",I._babylonTexture=l,void 0!=I.Ec&&(l.level=I.Ec),I.rotation){let q=t.Quaternion.vI(I.rotation);this._loader.babylonScene.useRightHandedSystem||(q=t.Quaternion.Inverse(q)),t.Matrix.FromQuaternionToRef(q,l.getReflectionTextureMatrix())}if(!I.irradianceCoefficients)throw new Error(`${q}: Irradiance coefficients are missing`);const O=G.d.vI(I.irradianceCoefficients);O.scaleInPlace(I.Ec),O.convertIrradianceToLambertianRadiance();const c=G.e.FromHarmonics(O),a=(w.length-1)/Math.log2(I.specularImageSize);return await l.updateRGBDAsync(w,c,a)}))}return I._loaded.then((()=>I._babylonTexture))}}E(A),L(A,!0,(q=>new Q(q)));l(13279);const b="EXT_mesh_gpu_instancing";class qq{constructor(q){this.name=b,this._loader=q,this.enabled=this._loader.isExtensionUsed(b)}dispose(){this._loader=null}loadNodeAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(q,w)=>{this._loader._disableInstancedMesh++;const O=this._loader.loadNodeAsync(`/nodes/${I.index}`,I,l);if(this._loader._disableInstancedMesh--,!I._primitiveBabylonMeshes)return await O;const c=new Array;let a=0;const F=I=>{if(void 0==w.attributes[I])return void c.push(Promise.resolve(null));const l=P.Get(`${q}/attributes/${I}`,this._loader.rc.accessors,w.attributes[I]);if(c.push(this._loader._loadFloatAccessorAsync(`/accessors/${l.bufferView}`,l)),0===a)a=l.count;else if(a!==l.count)throw new Error(`${q}/attributes: Instance buffer accessors do not have the same count.`)};return F("TRANSLATION"),F("ROTATION"),F("SCALE"),await O.then((async q=>{const[l,w,O]=await Promise.all(c),F=new Float32Array(16*a);t.TmpVectors.dI[0].gc(0,0,0),t.TmpVectors.Quaternion[0].gc(0,0,0,1),t.TmpVectors.dI[1].gc(1,1,1);for(let I=0;I<a;++I)l&&t.dI.FromArrayToRef(l,3*I,t.TmpVectors.dI[0]),w&&t.Quaternion.FromArrayToRef(w,4*I,t.TmpVectors.Quaternion[0]),O&&t.dI.FromArrayToRef(O,3*I,t.TmpVectors.dI[1]),t.Matrix.ComposeToRef(t.TmpVectors.dI[1],t.TmpVectors.Quaternion[0],t.TmpVectors.dI[0],t.TmpVectors.Matrix[0]),t.TmpVectors.Matrix[0].copyToArray(F,16*I);for(const t of I._primitiveBabylonMeshes)t.yr("matrix",F,16,!0);return q}))}))}}E(b),L(b,!0,(q=>new qq(q)));let Iq=0,lq=null;class wq{static get Default(){return wq._Default||(wq._Default=new wq),wq._Default}constructor(){const q=wq.Configuration.decoder;this._decoderModulePromise=c.Tools.LoadBabylonScriptAsync(q.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(q,I,l,w,t){await this._decoderModulePromise,0===Iq&&(MeshoptDecoder.useWorkers(1),Iq=1);const O=await MeshoptDecoder.decodeGltfBufferAsync(I,l,q,w,t);return null!==lq&&clearTimeout(lq),lq=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Iq=0,lq=null}),1e3),O}}wq.Configuration={decoder:{url:`${c.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},wq._Default=null;const tq="EXT_meshopt_compression";class Oq{constructor(q){this.name=tq,this.enabled=q.isExtensionUsed(tq),this._loader=q}dispose(){this._loader=null}loadBufferViewAsync(q,I){return Y.LoadExtensionAsync(q,I,this.name,(async(l,w)=>{const t=I;if(t._meshOptData)return await t._meshOptData;const O=P.Get(`${q}/buffer`,this._loader.rc.buffers,w.buffer);return t._meshOptData=this._loader.loadBufferAsync(`/buffers/${O.index}`,O,w.byteOffset||0,w.byteLength).then((async q=>await wq.Default.decodeGltfBufferAsync(q,w.count,w.byteStride,w.mode,w.filter))),await t._meshOptData}))}}E(tq),L(tq,!0,(q=>new Oq(q)));const cq="EXT_texture_webp";class aq{constructor(q){this.name=cq,this._loader=q,this.enabled=q.isExtensionUsed(cq)}dispose(){this._loader=null}_loadTextureAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=void 0==I.sampler?Y.DefaultSampler:P.Get(`${q}/sampler`,this._loader.rc.samplers,I.sampler),c=P.Get(`${w}/source`,this._loader.rc.images,t.source);return await this._loader._createTextureAsync(q,O,c,(q=>{l(q)}),void 0,!I._textureInfo.nonColorData)}))}}E(cq),L(cq,!0,(q=>new aq(q)));const Fq="EXT_texture_avif";class sq{constructor(q){this.name=Fq,this._loader=q,this.enabled=q.isExtensionUsed(Fq)}dispose(){this._loader=null}_loadTextureAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=void 0==I.sampler?Y.DefaultSampler:P.Get(`${q}/sampler`,this._loader.rc.samplers,I.sampler),c=P.Get(`${w}/source`,this._loader.rc.images,t.source);return await this._loader._createTextureAsync(q,O,c,(q=>{l(q)}),void 0,!I._textureInfo.nonColorData)}))}}E(Fq),L(Fq,!0,(q=>new sq(q)));var Zq=l(14392),rq=l(13257);const xq="EXT_lights_ies";class oq{constructor(q){this.name=xq,this._loader=q,this.enabled=this._loader.isExtensionUsed(xq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.rc.extensions;if(q&&q[this.name]){const I=q[this.name];this._lights=I.lights,P.Assign(this._lights)}}loadNodeAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,c)=>{let a,F;this._loader._allMaterialsDirtyRequired=!0;const s=await this._loader.loadNodeAsync(q,I,(q=>{F=P.Get(w,this._lights,c.qc);const I=F.name||q.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a=new Zq.b(I,t.dI.Zero(),t.dI.Backward(),0,1,this._loader.babylonScene),a.angle=Math.PI/2,a.innerAngle=0,a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,F._babylonLight=a,a.falloffType=rq.d.FALLOFF_GLTF,a.jc=c.color?O.BI.vI(c.color):O.BI.White(),a.Ec=c.multiplier||1,a.range=Number.MAX_VALUE,a.parent=q,this._loader._babylonLights.push(a),Y.AddPointerMetadata(a,w),l(q)}));let Z;if(F.uri)Z=await this._loader.loadUriAsync(q,F,F.uri);else{const I=P.Get(`${q}/bufferView`,this._loader.rc.bufferViews,F.bufferView);Z=await this._loader.loadBufferViewAsync(`/bufferViews/${I.index}`,I)}return a.iesProfileTexture=new k.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,Z,!0,void 0,void 0,void 0,void 0,".ies"),s}))}}E(xq),L(xq,!0,(q=>new oq(q)));var dq=l(14414);const Tq="KHR_draco_mesh_compression";class Vq{constructor(q){this.name=Tq,this.useNormalizedFlagFromAccessor=!0,this._loader=q,this.enabled=dq.b.DefaultAvailable&&this._loader.isExtensionUsed(Tq)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{if(void 0!=I.mode&&4!==I.mode&&5!==I.mode)throw new Error(`${q}: Unsupported mode ${I.mode}`);const O={},c={},a=(q,w)=>{const a=t.attributes[q];if(void 0!=a&&(l._delayInfo=l._delayInfo||[],-1===l._delayInfo.indexOf(w)&&l._delayInfo.push(w),O[w]=a,this.useNormalizedFlagFromAccessor)){const l=P.TryGet(this._loader.rc.accessors,I.attributes[q]);l&&(c[w]=l.normalized||!1)}};a("POSITION",R.c.PositionKind),a("NORMAL",R.c.NormalKind),a("TANGENT",R.c.TangentKind),a("TEXCOORD_0",R.c.UVKind),a("TEXCOORD_1",R.c.UV2Kind),a("TEXCOORD_2",R.c.UV3Kind),a("TEXCOORD_3",R.c.UV4Kind),a("TEXCOORD_4",R.c.UV5Kind),a("TEXCOORD_5",R.c.UV6Kind),a("JOINTS_0",R.c.MatricesIndicesKind),a("WEIGHTS_0",R.c.MatricesWeightsKind),a("COLOR_0",R.c.ColorKind);const F=P.Get(w,this._loader.rc.bufferViews,t.bufferView);return F._dracoBabylonGeometry||(F._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((async w=>{const t=this.dracoDecoder||dq.b.Default,a=P.TryGet(this._loader.rc.accessors,I.attributes.POSITION),F=this._loader.parent.alwaysComputeBoundingBox||l.skeleton||!a?null:mq(a);return await t._decodeMeshToGeometryForGltfAsync(l.name,this._loader.babylonScene,w,O,c,F).catch((I=>{throw new Error(`${q}: ${I.message}`)}))}))),await F._dracoBabylonGeometry}))}}E(Tq),L(Tq,!0,(q=>new Vq(q)));var Uq=l(14416),Bq=l(12735),vq=l(12740),kq=l(13171),Cq=l(13301),Rq=l(12711);kq.d.AddNodeConstructor("Light_Type_0",((q,I)=>()=>new Wq(q,t.dI.Zero(),I)));class Wq extends Cq.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(q){this._shadowAngle=q,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(q){const I=this.needCube();if(this._direction=q,this.needCube()!==I&&this._shadowGenerators){const q=this._shadowGenerators.values();for(let I=q.next();!0!==I.done;I=q.next()){I.value.recreateShadowMap()}}}constructor(q,I,l){super(q,l),this._shadowAngle=Math.PI/2,this.position=I}getClassName(){return"PointLight"}getTypeID(){return rq.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(q){if(this.direction)return super.getShadowDirection(q);switch(q){case 0:return new t.dI(1,0,0);case 1:return new t.dI(-1,0,0);case 2:return new t.dI(0,-1,0);case 3:return new t.dI(0,1,0);case 4:return new t.dI(0,0,1);case 5:return new t.dI(0,0,-1)}return t.dI.Zero()}_setDefaultShadowProjectionMatrix(q,I,l){const w=this.Wq().activeCamera;if(!w)return;const O=void 0!==this.shadowMinZ?this.shadowMinZ:w.vc,c=void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,a=this.Wq().getEngine().Ic;t.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,a?c:O,a?O:c,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,I){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,I):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,I),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,I),this}transferToNodeMaterialEffect(q,I){return this.computeTransformedInformation()?q.setFloat3(I,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):q.setFloat3(I,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(q,I){q["POINTLIGHT"+I]=!0}}(0,Bq.d)([(0,vq.D)()],Wq.prototype,"shadowAngle",null),(0,Rq.e)("BABYLON.PointLight",Wq);const eq="KHR_lights_punctual";class iq{constructor(q){this.name=eq,this._loader=q,this.enabled=this._loader.isExtensionUsed(eq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.rc.extensions;if(q&&q[this.name]){const I=q[this.name];this._lights=I.lights,P.Assign(this._lights)}}loadNodeAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,c)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(q,I,(q=>{let I;const a=P.Get(w,this._lights,c.qc),F=a.name||q.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a.type){case"directional":{const q=new Uq.e(F,t.dI.Backward(),this._loader.babylonScene);q.position.Kc(0),I=q;break}case"point":I=new Wq(F,t.dI.Zero(),this._loader.babylonScene);break;case"spot":{const q=new Zq.b(F,t.dI.Zero(),t.dI.Backward(),0,1,this._loader.babylonScene);q.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4),q.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0),I=q;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${w}: Invalid light type (${a.type})`)}I._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=I,I.falloffType=rq.d.FALLOFF_GLTF,I.jc=a.color?O.BI.vI(a.color):O.BI.White(),I.Ec=void 0==a.Ec?1:a.Ec,I.range=void 0==a.range?Number.MAX_VALUE:a.range,I.parent=q,this._loader._babylonLights.push(I),Y.AddPointerMetadata(I,w),l(q)})))))}}E(eq),L(eq,!0,(q=>new iq(q)));const Sq="KHR_materials_pbrSpecularGlossiness";class gq{constructor(q){this.name=Sq,this.order=200,this._loader=q,this.enabled=this._loader.isExtensionUsed(Sq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;return O.push(this._loader.loadMaterialBasePropertiesAsync(q,I,l)),O.push(this._loadSpecularGlossinessPropertiesAsync(w,t,l)),this._loader.loadMaterialAlphaProperties(q,I,l),await Promise.all(O).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;return l.metallic=null,l.roughness=null,I.diffuseFactor?(l.albedoColor=O.BI.vI(I.diffuseFactor),l.alpha=I.diffuseFactor[3]):l.albedoColor=O.BI.White(),l.reflectivityColor=I.specularFactor?O.BI.vI(I.specularFactor):O.BI.White(),l.microSurface=void 0==I.glossinessFactor?1:I.glossinessFactor,I.diffuseTexture&&w.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTexture`,I.diffuseTexture,(q=>{q.name=`${l.name} (Diffuse)`,l.albedoTexture=q}))),I.specularGlossinessTexture&&(w.push(this._loader.loadTextureInfoAsync(`${q}/specularGlossinessTexture`,I.specularGlossinessTexture,(q=>{q.name=`${l.name} (Specular Glossiness)`,l.reflectivityTexture=q,l.reflectivityTexture.Bc=!0}))),l.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(w).then((()=>{}))}}E(Sq),L(Sq,!0,(q=>new gq(q)));const pq="KHR_materials_unlit";class Xq{constructor(q){this.name=pq,this.order=210,this._loader=q,this.enabled=this._loader.isExtensionUsed(pq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async()=>await this._loadUnlitPropertiesAsync(q,I,l)))}_loadUnlitPropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;l.unlit=!0;const t=I.pbrMetallicRoughness;return t&&(t.baseColorFactor?(l.albedoColor=O.BI.vI(t.baseColorFactor),l.alpha=t.baseColorFactor[3]):l.albedoColor=O.BI.White(),t.baseColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${q}/baseColorTexture`,t.baseColorTexture,(q=>{q.name=`${l.name} (Base Color)`,l.albedoTexture=q})))),I.doubleSided&&(l.Sc=!1,l.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(q,I,l),Promise.all(w).then((()=>{}))}}E(pq),L(pq,!0,(q=>new Xq(q)));const Kq="KHR_materials_clearcoat";class Dq{constructor(q){this.name=Kq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(Kq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadClearCoatPropertiesAsync(w,t,l)),await Promise.all(O)}))}_loadClearCoatPropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;return l.clearCoat.isEnabled=!0,l.clearCoat.useRoughnessFromMainTexture=!1,l.clearCoat.remapF0OnInterfaceChange=!1,void 0!=I.clearcoatFactor?l.clearCoat.Ec=I.clearcoatFactor:l.clearCoat.Ec=0,I.clearcoatTexture&&w.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatTexture`,I.clearcoatTexture,(q=>{q.name=`${l.name} (ClearCoat)`,l.clearCoat.texture=q}))),void 0!=I.clearcoatRoughnessFactor?l.clearCoat.roughness=I.clearcoatRoughnessFactor:l.clearCoat.roughness=0,I.clearcoatRoughnessTexture&&(I.clearcoatRoughnessTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatRoughnessTexture`,I.clearcoatRoughnessTexture,(q=>{q.name=`${l.name} (ClearCoat Roughness)`,l.clearCoat.textureRoughness=q})))),I.clearcoatNormalTexture&&(I.clearcoatNormalTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatNormalTexture`,I.clearcoatNormalTexture,(q=>{q.name=`${l.name} (ClearCoat Normal)`,l.clearCoat.bumpTexture=q}))),l.invertNormalMapX=!l.Wq().useRightHandedSystem,l.invertNormalMapY=l.Wq().useRightHandedSystem,void 0!=I.clearcoatNormalTexture.scale&&(l.clearCoat.bumpTexture.level=I.clearcoatNormalTexture.scale)),Promise.all(w).then((()=>{}))}}E(Kq),L(Kq,!0,(q=>new Dq(q)));const Mq="KHR_materials_iridescence";class nq{constructor(q){this.name=Mq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(Mq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadIridescencePropertiesAsync(w,t,l)),await Promise.all(O).then((()=>{}))}))}_loadIridescencePropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;return l.iridescence.isEnabled=!0,l.iridescence.Ec=I.iridescenceFactor??0,l.iridescence.indexOfRefraction=I.iridescenceIor??I.iridescenceIOR??1.3,l.iridescence.minimumThickness=I.iridescenceThicknessMinimum??100,l.iridescence.maximumThickness=I.iridescenceThicknessMaximum??400,I.iridescenceTexture&&w.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceTexture`,I.iridescenceTexture,(q=>{q.name=`${l.name} (Iridescence)`,l.iridescence.texture=q}))),I.iridescenceThicknessTexture&&w.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceThicknessTexture`,I.iridescenceThicknessTexture,(q=>{q.name=`${l.name} (Iridescence Thickness)`,l.iridescence.thicknessTexture=q}))),Promise.all(w).then((()=>{}))}}E(Mq),L(Mq,!0,(q=>new nq(q)));const fq="KHR_materials_anisotropy";class Lq{constructor(q){this.name=fq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(fq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadIridescencePropertiesAsync(w,t,l)),await Promise.all(O)}))}async _loadIridescencePropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;l.anisotropy.isEnabled=!0,l.anisotropy.Ec=I.anisotropyStrength??0,l.anisotropy.angle=I.anisotropyRotation??0,I.anisotropyTexture&&(I.anisotropyTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${q}/anisotropyTexture`,I.anisotropyTexture,(q=>{q.name=`${l.name} (Anisotropy Intensity)`,l.anisotropy.texture=q})))),await Promise.all(w)}}E(fq),L(fq,!0,(q=>new Lq(q)));const Eq="KHR_materials_emissive_strength";class jq{constructor(q){this.name=Eq,this.order=170,this._loader=q,this.enabled=this._loader.isExtensionUsed(Eq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>await this._loader.loadMaterialPropertiesAsync(q,I,l).then((()=>{this._loadEmissiveProperties(w,t,l)}))))}_loadEmissiveProperties(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);void 0!==I.emissiveStrength&&(l.emissiveIntensity=I.emissiveStrength)}}E(Eq),L(Eq,!0,(q=>new jq(q)));const hq="KHR_materials_sheen";class uq{constructor(q){this.name=hq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(hq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadSheenPropertiesAsync(w,t,l)),await Promise.all(O).then((()=>{}))}))}_loadSheenPropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;return l.sheen.isEnabled=!0,l.sheen.Ec=1,void 0!=I.sheenColorFactor?l.sheen.color=O.BI.vI(I.sheenColorFactor):l.sheen.color=O.BI.Black(),I.sheenColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${q}/sheenColorTexture`,I.sheenColorTexture,(q=>{q.name=`${l.name} (Sheen Color)`,l.sheen.texture=q}))),void 0!==I.sheenRoughnessFactor?l.sheen.roughness=I.sheenRoughnessFactor:l.sheen.roughness=0,I.sheenRoughnessTexture&&(I.sheenRoughnessTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${q}/sheenRoughnessTexture`,I.sheenRoughnessTexture,(q=>{q.name=`${l.name} (Sheen Roughness)`,l.sheen.textureRoughness=q})))),l.sheen.albedoScaling=!0,l.sheen.useRoughnessFromMainTexture=!1,Promise.all(w).then((()=>{}))}}E(hq),L(hq,!0,(q=>new uq(q)));var Pq=l(13208);const mI="KHR_materials_specular";class Yq{constructor(q){this.name=mI,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(mI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;if(O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadSpecularPropertiesAsync(w,t,l)),t.extensions&&t.extensions.EXT_materials_specular_edge_color&&l instanceof v.c){t.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(l.brdf.dielectricSpecularModel=Pq.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,l.brdf.conductorSpecularModel=Pq.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(O).then((()=>{}))}))}_loadSpecularPropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;return void 0!==I.specularFactor&&(l.metallicF0Factor=I.specularFactor),void 0!==I.specularColorFactor&&(l.metallicReflectanceColor=O.BI.vI(I.specularColorFactor)),I.specularTexture&&(I.specularTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${q}/specularTexture`,I.specularTexture,(q=>{q.name=`${l.name} (Specular)`,l.metallicReflectanceTexture=q,l.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),I.specularColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${q}/specularColorTexture`,I.specularColorTexture,(q=>{q.name=`${l.name} (Specular Color)`,l.reflectanceTexture=q}))),Promise.all(w).then((()=>{}))}}E(mI),L(mI,!0,(q=>new Yq(q)));const yq="KHR_materials_ior";class Gq{constructor(q){this.name=yq,this.order=180,this._loader=q,this.enabled=this._loader.isExtensionUsed(yq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadIorPropertiesAsync(w,t,l)),await Promise.all(O).then((()=>{}))}))}_loadIorPropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);return void 0!==I.ior?l.indexOfRefraction=I.ior:l.indexOfRefraction=Gq._DEFAULT_IOR,Promise.resolve()}}Gq._DEFAULT_IOR=1.5,E(yq),L(yq,!0,(q=>new Gq(q)));const Nq="KHR_materials_variants";class Jq{constructor(q){this.name=Nq,this._loader=q,this.enabled=this._loader.isExtensionUsed(Nq)}dispose(){this._loader=null}static GetAvailableVariants(q){const I=this._GetExtensionMetadata(q);return I?Object.keys(I.variants):[]}getAvailableVariants(q){return Jq.GetAvailableVariants(q)}static SelectVariant(q,I){const l=this._GetExtensionMetadata(q);if(!l)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Nq} extension`);const w=q=>{const I=l.variants[q];if(I)for(const l of I)l.mesh.material=l.material};if(I instanceof Array)for(const t of I)w(t);else w(I);l.lastSelected=I}selectVariant(q,I){Jq.SelectVariant(q,I)}static Reset(q){const I=this._GetExtensionMetadata(q);if(!I)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Nq} extension`);for(const l of I.original)l.mesh.material=l.material;I.lastSelected=null}reset(q){Jq.Reset(q)}static GetLastSelectedVariant(q){const I=this._GetExtensionMetadata(q);if(!I)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Nq} extension`);return I.lastSelected}getLastSelectedVariant(q){return Jq.GetLastSelectedVariant(q)}static _GetExtensionMetadata(q){var I,l;return(null===q||void 0===q||null===(I=q._internalMetadata)||void 0===I||null===(l=I.rc)||void 0===l?void 0:l[Nq])||null}onLoading(){const q=this._loader.rc.extensions;if(q&&q[this.name]){const I=q[this.name];this._variants=I.variants}}onReady(){const q=this._loader.rootBabylonMesh;if(q){var I;const l=this._loader.parent.extensionOptions[Nq];null!==l&&void 0!==l&&l.defaultVariant&&Jq.SelectVariant(q,l.defaultVariant),null===l||void 0===l||null===(I=l.onLoaded)||void 0===I||I.call(l,{get variants(){return Jq.GetAvailableVariants(q)},get selectedVariant(){const I=Jq.GetLastSelectedVariant(q);return I?Array.isArray(I)?I[0]:I:Jq.GetAvailableVariants(q)[0]},set selectedVariant(I){Jq.SelectVariant(q,I)}})}}_loadMeshPrimitiveAsync(q,I,l,w,t,O){return Y.LoadExtensionAsync(q,t,this.name,(async(c,a)=>{const F=new Array;return F.push(this._loader._loadMeshPrimitiveAsync(q,I,l,w,t,(I=>{if(O(I),I instanceof i.c){const l=Y._GetDrawMode(q,t.mode),w=this._loader.rootBabylonMesh,O=w?w._internalMetadata=w._internalMetadata||{}:{},s=O.rc=O.rc||{},Z=s[Nq]=s[Nq]||{lastSelected:null,original:[],variants:{}};Z.original.push({mesh:I,material:I.material});for(let q=0;q<a.mappings.length;++q){const t=a.mappings[q],O=P.Get(`${c}/mappings/${q}/material`,this._loader.rc.materials,t.material);F.push(this._loader._loadMaterialAsync(`#/materials/${t.material}`,O,I,l,(q=>{for(let l=0;l<t.variants.length;++l){const O=t.variants[l],c=P.Get(`/extensions/${Nq}/variants/${O}`,this._variants,O);Z.variants[c.name]=Z.variants[c.name]||[],Z.variants[c.name].push({mesh:I,material:q}),I.onClonedObservable.add((q=>{const l=q;let t=null,O=l;do{if(O=O.parent,!O)return;t=Jq._GetExtensionMetadata(O)}while(null===t);if(w&&t===Jq._GetExtensionMetadata(w)){O._internalMetadata={};for(const q in w._internalMetadata)O._internalMetadata[q]=w._internalMetadata[q];O._internalMetadata.rc=[];for(const q in w._internalMetadata.rc)O._internalMetadata.rc[q]=w._internalMetadata.rc[q];O._internalMetadata.rc[Nq]={lastSelected:null,original:[],variants:{}};for(const q of t.original)O._internalMetadata.rc[Nq].original.push({mesh:q.mesh,material:q.material});for(const q in t.variants)if(Object.prototype.hasOwnProperty.call(t.variants,q)){O._internalMetadata.rc[Nq].variants[q]=[];for(const I of t.variants[q])O._internalMetadata.rc[Nq].variants[q].push({mesh:I.mesh,material:I.material})}t=O._internalMetadata.rc[Nq]}for(const w of t.original)w.mesh===I&&(w.mesh=l);for(const w of t.variants[c.name])w.mesh===I&&(w.mesh=l)}))}})))}}}))),await Promise.all(F).then((q=>{let[I]=q;return I}))}))}}E(Nq),L(Nq,!0,(q=>new Jq(q)));var zq=l(12805);class Hq{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Pq.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(q,I){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Hq._GetDefaultOptions(),...q},this._scene=I,this._scene._transmissionHelper=this,this.onErrorObservable=new Z.d,this._scene.tc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(q){if(!Object.keys(q).filter((I=>this._options[I]!==q[I])).length)return;const I={...this._options,...q},l=this._options;this._options=I,I.renderSize===l.renderSize&&I.renderTargetTextureType===l.renderTargetTextureType&&I.generateMipmaps===l.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=I.samples,this._opaqueRenderTarget.lodGenerationScale=I.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=I.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(q){return!!q&&!!(q instanceof v.c&&q.subSurface.isRefractionEnabled)}_addMesh(q){this._materialObservers[q.uniqueId]=q.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),c.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(q.material)?(q.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(q)&&this._transparentMeshesCache.push(q)):-1===this._opaqueMeshesCache.indexOf(q)&&this._opaqueMeshesCache.push(q)}))}_removeMesh(q){q.onMaterialChangedObservable.remove(this._materialObservers[q.uniqueId]),delete this._materialObservers[q.uniqueId];let I=this._transparentMeshesCache.indexOf(q);-1!==I&&this._transparentMeshesCache.splice(I,1),I=this._opaqueMeshesCache.indexOf(q),-1!==I&&this._opaqueMeshesCache.splice(I,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(q){const I=this._transparentMeshesCache.indexOf(q),l=this._opaqueMeshesCache.indexOf(q);this._shouldRenderAsTransmission(q.material)?(q.material instanceof v.c&&(q.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==l?(this._opaqueMeshesCache.splice(l,1),this._transparentMeshesCache.push(q)):-1===I&&this._transparentMeshesCache.push(q)):-1!==I?(this._transparentMeshesCache.splice(I,1),this._opaqueMeshesCache.push(q)):-1===l&&this._opaqueMeshesCache.push(q)}_isRenderTargetValid(){var q;return null!==(null===(q=this._opaqueRenderTarget)||void 0===q?void 0:q.getInternalTexture())}_setupRenderTargets(){var q;let I;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new zq.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(q=this._options.clearColor)||void 0===q?void 0:q.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((q=>{I=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?q.clearColor.t(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(q.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=I}));for(const l of this._transparentMeshesCache)this._shouldRenderAsTransmission(l.material)&&(l.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Aq="KHR_materials_transmission";class Qq{constructor(q){this.name=Aq,this.order=175,this._loader=q,this.enabled=this._loader.isExtensionUsed(Aq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadTransparentPropertiesAsync(w,I,l,t)),await Promise.all(O).then((()=>{}))}))}_loadTransparentPropertiesAsync(q,I,l,w){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const t=l;if(t.subSurface.isRefractionEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.useAlbedoToTintRefraction=!0,void 0===w.transmissionFactor)return t.subSurface.refractionIntensity=0,t.subSurface.isRefractionEnabled=!1,Promise.resolve();{var O;t.subSurface.refractionIntensity=w.transmissionFactor;const q=t.Wq();if(t.subSurface.refractionIntensity&&!q._transmissionHelper)new Hq({},t.Wq());else if(t.subSurface.refractionIntensity&&(null===(O=q._transmissionHelper)||void 0===O||!O._isRenderTargetValid())){var c;null===(c=q._transmissionHelper)||void 0===c||c._setupRenderTargets()}}return t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,w.transmissionTexture?(w.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/transmissionTexture`,w.transmissionTexture,void 0).then((q=>{q.name=`${l.name} (Transmission)`,t.subSurface.refractionIntensityTexture=q,t.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}E(Aq),L(Aq,!0,(q=>new Qq(q)));const bq="KHR_materials_diffuse_transmission";class qI{constructor(q){this.name=bq,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(bq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadTranslucentPropertiesAsync(w,I,l,t)),await Promise.all(O).then((()=>{}))}))}_loadTranslucentPropertiesAsync(q,I,l,w){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const t=l;if(t.subSurface.isTranslucencyEnabled=!0,t.subSurface.volumeIndexOfRefraction=1,t.subSurface.minimumThickness=0,t.subSurface.maximumThickness=0,t.subSurface.useAlbedoToTintTranslucency=!1,void 0===w.diffuseTransmissionFactor)return t.subSurface.translucencyIntensity=0,t.subSurface.isTranslucencyEnabled=!1,Promise.resolve();t.subSurface.translucencyIntensity=w.diffuseTransmissionFactor;const c=new Array;return t.subSurface.useGltfStyleTextures=!0,w.diffuseTransmissionTexture&&(w.diffuseTransmissionTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionTexture`,w.diffuseTransmissionTexture).then((q=>{q.name=`${l.name} (Diffuse Transmission)`,t.subSurface.translucencyIntensityTexture=q})))),void 0!==w.diffuseTransmissionColorFactor?t.subSurface.translucencyColor=O.BI.vI(w.diffuseTransmissionColorFactor):t.subSurface.translucencyColor=O.BI.White(),w.diffuseTransmissionColorTexture&&c.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionColorTexture`,w.diffuseTransmissionColorTexture).then((q=>{q.name=`${l.name} (Diffuse Transmission Color)`,t.subSurface.translucencyColorTexture=q}))),Promise.all(c).then((()=>{}))}}E(bq),L(bq,!0,(q=>new qI(q)));const II="KHR_materials_volume";class lI{constructor(q){this.name=II,this.order=173,this._loader=q,this.enabled=this._loader.isExtensionUsed(II),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadVolumePropertiesAsync(w,I,l,t)),await Promise.all(O).then((()=>{}))}))}_loadVolumePropertiesAsync(q,I,l,w){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);if(!l.subSurface.isRefractionEnabled&&!l.subSurface.isTranslucencyEnabled||!w.thicknessFactor)return Promise.resolve();l.subSurface.volumeIndexOfRefraction=l.indexOfRefraction;const t=void 0!==w.attenuationDistance?w.attenuationDistance:Number.MAX_VALUE;return l.subSurface.tintColorAtDistance=t,void 0!==w.attenuationColor&&3==w.attenuationColor.length&&l.subSurface.tintColor.gc(w.attenuationColor[0],w.attenuationColor[1],w.attenuationColor[2]),l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=w.thicknessFactor,l.subSurface.useThicknessAsDepth=!0,w.thicknessTexture?(w.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/thicknessTexture`,w.thicknessTexture).then((q=>{q.name=`${l.name} (Thickness)`,l.subSurface.thicknessTexture=q,l.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}E(II),L(II,!0,(q=>new lI(q)));const wI="KHR_materials_dispersion";class tI{constructor(q){this.name=wI,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(wI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadDispersionPropertiesAsync(w,I,l,t)),await Promise.all(O).then((()=>{}))}))}_loadDispersionPropertiesAsync(q,I,l,w){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);return l.subSurface.isRefractionEnabled&&w.dispersion?(l.subSurface.isDispersionEnabled=!0,l.subSurface.dispersion=w.dispersion,Promise.resolve()):Promise.resolve()}}E(wI),L(wI,!0,(q=>new tI(q)));const OI="EXT_materials_diffuse_roughness";class cI{constructor(q){this.name=OI,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(OI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(q,I,l)),O.push(this._loadDiffuseRoughnessPropertiesAsync(w,t,l)),await Promise.all(O).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(q,I,l){if(!(l instanceof v.c))throw new Error(`${q}: Material type not supported`);const w=new Array;return l.brdf.baseDiffuseModel=Pq.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=I.diffuseRoughnessFactor?l.baseDiffuseRoughness=I.diffuseRoughnessFactor:l.baseDiffuseRoughness=0,I.diffuseRoughnessTexture&&w.push(this._loader.loadTextureInfoAsync(`${q}/diffuseRoughnessTexture`,I.diffuseRoughnessTexture,(q=>{q.name=`${l.name} (Diffuse Roughness)`,l.baseDiffuseRoughnessTexture=q}))),Promise.all(w).then((()=>{}))}}E(OI),L(OI,!0,(q=>new cI(q)));const aI="KHR_mesh_quantization";class FI{constructor(q){this.name=aI,this.enabled=q.isExtensionUsed(aI)}dispose(){}}E(aI),L(aI,!0,(q=>new FI(q)));const sI="KHR_texture_basisu";class ZI{constructor(q){this.name=sI,this._loader=q,this.enabled=q.isExtensionUsed(sI)}dispose(){this._loader=null}_loadTextureAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>{const O=void 0==I.sampler?Y.DefaultSampler:P.Get(`${q}/sampler`,this._loader.rc.samplers,I.sampler),c=P.Get(`${w}/source`,this._loader.rc.images,t.source);return await this._loader._createTextureAsync(q,O,c,(q=>{l(q)}),I._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!I._textureInfo.nonColorData)}))}}E(sI),L(sI,!0,(q=>new ZI(q)));const rI="KHR_texture_transform";class xI{constructor(q){this.name=rI,this._loader=q,this.enabled=this._loader.isExtensionUsed(rI)}dispose(){this._loader=null}loadTextureInfoAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(w,t)=>await this._loader.loadTextureInfoAsync(q,I,(q=>{if(!(q instanceof k.d))throw new Error(`${w}: Texture type not supported`);t.offset&&(q.uOffset=t.offset[0],q.vOffset=t.offset[1]),q.uRotationCenter=0,q.vRotationCenter=0,t.rotation&&(q.wAng=-t.rotation),t.scale&&(q.uScale=t.scale[0],q.vScale=t.scale[1]),void 0!=t.texCoord&&(q.coordinatesIndex=t.texCoord),l(q)}))))}}E(rI),L(rI,!0,(q=>new xI(q)));const oI="KHR_xmp_json_ld";class dI{constructor(q){this.name=oI,this.order=100,this._loader=q,this.enabled=this._loader.isExtensionUsed(oI)}dispose(){this._loader=null}onLoading(){var q,I,l;if(null===this._loader.rootBabylonMesh)return;const w=null===(q=this._loader.rc.extensions)||void 0===q?void 0:q.KHR_xmp_json_ld,t=null===(I=this._loader.rc.asset)||void 0===I||null===(l=I.extensions)||void 0===l?void 0:l.KHR_xmp_json_ld;if(w&&t){const q=+t.packet;w.packets&&q<w.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=w.packets[q])}}}function TI(q,I,l,w){return O.BI.vI(I,l).scale(w)}function VI(q,I,l,w){return I[l]*w}function UI(q,I,l,w){return-I[l]*w}function BI(q,I,l,w){return I[l+1]*w}function vI(q,I,l,w){return I[l]*w*2}function kI(q){return{scale:[new RI(x.d.ANIMATIONTYPE_FLOAT,`${q}.uScale`,VI,(()=>2)),new RI(x.d.ANIMATIONTYPE_FLOAT,`${q}.vScale`,BI,(()=>2))],offset:[new RI(x.d.ANIMATIONTYPE_FLOAT,`${q}.uOffset`,VI,(()=>2)),new RI(x.d.ANIMATIONTYPE_FLOAT,`${q}.vOffset`,BI,(()=>2))],rotation:[new RI(x.d.ANIMATIONTYPE_FLOAT,`${q}.wAng`,UI,(()=>1))]}}E(oI),L(oI,!0,(q=>new dI(q)));class CI extends y.AnimationPropertyInfo{buildAnimations(q,I,l,w){return[{babylonAnimatable:q._babylonCamera,babylonAnimation:this._buildAnimation(I,l,w)}]}}class RI extends y.AnimationPropertyInfo{buildAnimations(q,I,l,w){const t=[];for(const O in q._data)t.push({babylonAnimatable:q._data[O].babylonMaterial,babylonAnimation:this._buildAnimation(I,l,w)});return t}}class WI extends y.AnimationPropertyInfo{buildAnimations(q,I,l,w){return[{babylonAnimatable:q._babylonLight,babylonAnimation:this._buildAnimation(I,l,w)}]}}(0,j.k)("/cameras/{}/orthographic/xmag",[new CI(x.d.ANIMATIONTYPE_FLOAT,"orthoLeft",UI,(()=>1)),new CI(x.d.ANIMATIONTYPE_FLOAT,"orthoRight",BI,(()=>1))]),(0,j.k)("/cameras/{}/orthographic/ymag",[new CI(x.d.ANIMATIONTYPE_FLOAT,"orthoBottom",UI,(()=>1)),new CI(x.d.ANIMATIONTYPE_FLOAT,"orthoTop",BI,(()=>1))]),(0,j.k)("/cameras/{}/orthographic/zfar",[new CI(x.d.ANIMATIONTYPE_FLOAT,"maxZ",VI,(()=>1))]),(0,j.k)("/cameras/{}/orthographic/znear",[new CI(x.d.ANIMATIONTYPE_FLOAT,"vc",VI,(()=>1))]),(0,j.k)("/cameras/{}/perspective/yfov",[new CI(x.d.ANIMATIONTYPE_FLOAT,"fov",VI,(()=>1))]),(0,j.k)("/cameras/{}/perspective/zfar",[new CI(x.d.ANIMATIONTYPE_FLOAT,"maxZ",VI,(()=>1))]),(0,j.k)("/cameras/{}/perspective/znear",[new CI(x.d.ANIMATIONTYPE_FLOAT,"vc",VI,(()=>1))]),(0,j.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new RI(x.d.ANIMATIONTYPE_COLOR3,"albedoColor",TI,(()=>4)),new RI(x.d.ANIMATIONTYPE_FLOAT,"alpha",(function(q,I,l,w){return I[l+3]*w}),(()=>4))]),(0,j.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"metallic",VI,(()=>1))]),(0,j.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"roughness",VI,(()=>1))]);const eI=kI("albedoTexture");(0,j.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",eI.scale),(0,j.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",eI.offset),(0,j.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",eI.rotation);const iI=kI("metallicTexture");(0,j.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",iI.scale),(0,j.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",iI.offset),(0,j.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",iI.rotation),(0,j.k)("/materials/{}/emissiveFactor",[new RI(x.d.ANIMATIONTYPE_COLOR3,"emissiveColor",TI,(()=>3))]);const SI=kI("bumpTexture");(0,j.k)("/materials/{}/normalTexture/scale",[new RI(x.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",VI,(()=>1))]),(0,j.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",SI.scale),(0,j.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",SI.offset),(0,j.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",SI.rotation),(0,j.k)("/materials/{}/occlusionTexture/strength",[new RI(x.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",VI,(()=>1))]);const gI=kI("ambientTexture");(0,j.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",gI.scale),(0,j.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",gI.offset),(0,j.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",gI.rotation);const pI=kI("emissiveTexture");(0,j.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",pI.scale),(0,j.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",pI.offset),(0,j.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",pI.rotation),(0,j.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new RI(x.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new RI(x.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",VI,(()=>1))]);const XI=kI("anisotropy.texture");(0,j.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",XI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",XI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",XI.rotation),(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",VI,(()=>1))]);const KI=kI("clearCoat.texture");(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",KI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",KI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",KI.rotation);const DI=kI("clearCoat.bumpTexture");(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new RI(x.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",DI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",DI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",DI.rotation);const MI=kI("clearCoat.textureRoughness");(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",MI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",MI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",MI.rotation),(0,j.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new RI(x.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new RI(x.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new RI(x.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new RI(x.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",VI,(()=>1))]);const nI=kI("iridescence.texture");(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",nI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",nI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",nI.rotation);const fI=kI("iridescence.thicknessTexture");(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",fI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",fI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",fI.rotation),(0,j.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new RI(x.d.ANIMATIONTYPE_COLOR3,"sheen.color",TI,(()=>3))]),(0,j.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",VI,(()=>1))]);const LI=kI("sheen.texture");(0,j.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",LI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",LI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",LI.rotation);const EI=kI("sheen.textureRoughness");(0,j.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",EI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",EI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",EI.rotation),(0,j.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new RI(x.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",TI,(()=>3))]);const jI=kI("metallicReflectanceTexture");(0,j.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",jI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",jI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",jI.rotation);const hI=kI("reflectanceTexture");(0,j.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",hI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",hI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",hI.rotation),(0,j.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",VI,(()=>1))]);const uI=kI("subSurface.refractionIntensityTexture");(0,j.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",uI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",uI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",uI.rotation),(0,j.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new RI(x.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",TI,(()=>3))]),(0,j.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new RI(x.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",VI,(()=>1))]),(0,j.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",VI,(()=>1))]);const PI=kI("subSurface.thicknessTexture");(0,j.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",PI.scale),(0,j.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",PI.offset),(0,j.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",PI.rotation),(0,j.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new RI(x.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",VI,(()=>1))]);const ml=kI("subSurface.translucencyIntensityTexture");(0,j.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",ml.scale),(0,j.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",ml.offset),(0,j.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",ml.rotation),(0,j.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new RI(x.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",TI,(()=>3))]);const YI=kI("subSurface.translucencyColorTexture");(0,j.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",YI.scale),(0,j.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",YI.offset),(0,j.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",YI.rotation),(0,j.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new WI(x.d.ANIMATIONTYPE_COLOR3,"diffuse",TI,(()=>3))]),(0,j.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new WI(x.d.ANIMATIONTYPE_FLOAT,"intensity",VI,(()=>1))]),(0,j.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new WI(x.d.ANIMATIONTYPE_FLOAT,"range",VI,(()=>1))]),(0,j.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new WI(x.d.ANIMATIONTYPE_FLOAT,"innerAngle",vI,(()=>1))]),(0,j.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new WI(x.d.ANIMATIONTYPE_FLOAT,"angle",vI,(()=>1))]),(0,j.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new WI(x.d.ANIMATIONTYPE_COLOR3,"diffuse",TI,(()=>3))]),(0,j.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new WI(x.d.ANIMATIONTYPE_FLOAT,"intensity",VI,(()=>1))]);const yI="KHR_animation_pointer";class GI{constructor(q){this.name=yI,this._loader=q,this._pathToObjectConverter=(0,j.i)(this._loader.rc)}get enabled(){return this._loader.isExtensionUsed(yI)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(q,I,l,w,t){var O;const c=null===(O=w.target.extensions)||void 0===O?void 0:O.KHR_animation_pointer;if(!c||!this._pathToObjectConverter)return null;"pointer"!==w.target.path&&T.b.Warn(`${q}/target/path: Value (${w.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=w.target.node&&T.b.Warn(`${q}/target/node: Value (${w.target.node}) must not be present when using the ${this.name} extension`);const a=`${q}/extensions/${this.name}`,F=c.pointer;if(!F)throw new Error(`${a}: Pointer is missing`);try{const O=this._pathToObjectConverter.convert(F);if(!O.info.interpolation)throw new Error(`${a}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(q,I,l,w,{object:O.object,info:O.info.interpolation},t)}catch(s){return T.b.Warn(`${a}/pointer: Invalid pointer (${F}) skipped`),null}}}E(yI),L(yI,!0,(q=>new GI(q)));class NI{constructor(q,I,l){this.frame=q,this.action=I,this.onlyOnce=l,this.isDone=!1}_clone(){return new NI(this.frame,this.action,this.onlyOnce)}}var JI=l(12603),zI=l(12656),HI=l(12647);class AI{get loop(){return this._loop}set loop(q){q!==this._loop&&(this._loop=q,this.updateOptions({loop:q}))}get currentTime(){var q;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(q=zI.d.audioEngine)&&void 0!==q&&q.audioContext&&(this.isPlaying||this.isPaused)){const q=this.isPaused?0:zI.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+q}return 0}get spatialSound(){return this._spatialSound}set spatialSound(q){if(q==this._spatialSound)return;const I=this.isPlaying;this.pause(),q?(this._spatialSound=q,this._updateSpatialParameters()):this._disableSpatialSound(),I&&this.play()}constructor(q,I,l){var w;let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new Z.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=t.dI.Zero(),this._localDirection=new t.dI(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=q,l=l||d.e.LastCreatedScene)if(this._scene=l,AI._SceneComponentInitialization(l),this._readyToPlayCallback=O,this._customAttenuationFunction=(q,I,l,w,t)=>I<l?q*(1-I/l):0,a&&(this.autoplay=a.autoplay||!1,this._loop=a.loop||!1,void 0!==a.volume&&(this._volume=a.volume),this._spatialSound=a.spatialSound??!1,this.maxDistance=a.maxDistance??100,this.useCustomAttenuation=a.useCustomAttenuation??!1,this.rolloffFactor=a.rolloffFactor||1,this.refDistance=a.refDistance||1,this.distanceModel=a.distanceModel||"linear",this._playbackRate=a.playbackRate||1,this._streaming=a.streaming??!1,this._length=a.length,this._offset=a.offset),null!==(w=zI.d.audioEngine)&&void 0!==w&&w.canUseWebAudio&&zI.d.audioEngine.audioContext){this._soundGain=zI.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let q=!0;if(I)try{"string"===typeof I?(this._urlType="String",this._url=I):I instanceof ArrayBuffer?this._urlType="ArrayBuffer":I instanceof HTMLMediaElement?this._urlType="MediaElement":I instanceof MediaStream?this._urlType="MediaStream":I instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(I)&&(this._urlType="Array");let l=[],w=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=zI.d.audioEngine.audioContext.createMediaElementSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=zI.d.audioEngine.audioContext.createMediaStreamSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":I.byteLength>0&&(w=!0,this._soundLoaded(I));break;case"AudioBuffer":this._audioBufferLoaded(I);break;case"String":l.push(I);case"Array":0===l.length&&(l=I);for(let q=0;q<l.length;q++){const I=l[q];if(w=a&&a.skipCodecCheck||-1!==I.indexOf(".mp3",I.length-4)&&zI.d.audioEngine.isMP3supported||-1!==I.indexOf(".ogg",I.length-4)&&zI.d.audioEngine.isOGGsupported||-1!==I.indexOf(".wav",I.length-4)||-1!==I.indexOf(".m4a",I.length-4)||-1!==I.indexOf(".mp4",I.length-4)||-1!==I.indexOf("blob:"),w){this._streaming?(this._htmlAudioElement=new Audio(I),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,c.Tools.SetCorsBehavior(I,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(I,(q=>{this._soundLoaded(q)}),void 0,!0,!0,(q=>{q&&T.b.Error("XHR "+q.status+" error on: "+I+"."),T.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:q=!1}q?w||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):T.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(F){T.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),zI.d.audioEngine&&!zI.d.audioEngine.WarnedWebAudioUnsupported&&(T.b.Error("Web Audio is not supported by your browser."),zI.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var q;null!==(q=zI.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(q){var I;null!==(I=zI.d.audioEngine)&&void 0!==I&&I.audioContext&&(this._audioBuffer=q,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(q){var I;null!==(I=zI.d.audioEngine)&&void 0!==I&&I.audioContext&&zI.d.audioEngine.audioContext.decodeAudioData(q,(q=>{this._audioBufferLoaded(q)}),(q=>{T.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+q)}))}setAudioBuffer(q){var I;null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&(this._audioBuffer=q,this._isReadyToPlay=!0)}updateOptions(q){q&&(this.loop=q.loop??this.loop,this.maxDistance=q.maxDistance??this.maxDistance,this.useCustomAttenuation=q.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=q.rolloffFactor??this.rolloffFactor,this.refDistance=q.refDistance??this.refDistance,this.distanceModel=q.distanceModel??this.distanceModel,this._playbackRate=q.playbackRate??this._playbackRate,this._length=q.length??void 0,this.spatialSound=q.spatialSound??this._spatialSound,this._setOffset(q.offset??void 0),this.setVolume(q.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var q;null!==(q=zI.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&zI.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??zI.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var q;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(q=this._soundPanner)||void 0===q||q.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var q;null!==(q=zI.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(q){var I;null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(q),this._isOutputConnected=!0)}setDirectionalCone(q,I,l){I<q?T.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=q,this._coneOuterAngle=I,this._coneOuterGain=l,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!=this._coneInnerAngle){var I;if(this._coneOuterAngle<q)return void T.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q,null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!=this._coneOuterAngle){var I;if(q<this._coneInnerAngle)return void T.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q,null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(q){var I;q.equals(this._position)||(this._position.t(q),null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(q){var I;this._localDirection=q,null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const q=this._connectedTransformNode.getWorldMatrix(),I=t.dI.TransformNormal(this._localDirection,q);I.normalize(),this._soundPanner.orientationX.value=I.x,this._soundPanner.orientationY.value=I.y,this._soundPanner.orientationZ.value=I.z}updateDistanceFromListener(){var q;if(null!==(q=zI.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const q=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.TI(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,q,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(q){this._customAttenuationFunction=q}play(q,I,l){var w;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(w=zI.d.audioEngine)&&void 0!==w&&w.audioContext)try{var t,O;this._clearTimeoutsAndObservers();let w=q?(null===(t=zI.d.audioEngine)||void 0===t?void 0:t.audioContext.currentTime)+q:null===(O=zI.d.audioEngine)||void 0===O?void 0:O.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=zI.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const q=()=>{var l;if(null!==(l=zI.d.audioEngine)&&void 0!==l&&l.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=I??0;const l=this._htmlAudioElement.play();void 0!==l&&l.catch((()=>{var I,l;(null===(I=zI.d.audioEngine)||void 0===I||I.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(l=zI.d.audioEngine)||void 0===l?void 0:l.onAudioUnlockedObservable.addOnce((()=>{q()})))}))}else{var w;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(w=zI.d.audioEngine)||void 0===w?void 0:w.onAudioUnlockedObservable.addOnce((()=>{q()}))}};q()}}else{var c;const t=()=>{var t;if(null!==(t=zI.d.audioEngine)&&void 0!==t&&t.audioContext){var O;if(l=l||this._length,void 0!==I&&this._setOffset(I),this._soundSource){const q=this._soundSource;q.onended=()=>{q.disconnect()}}if(this._soundSource=null===(O=zI.d.audioEngine)||void 0===O?void 0:O.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var c;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==I&&(this._soundSource.loopStart=I),void 0!==l&&(this._soundSource.loopEnd=(0|I)+l),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},w=q?(null===(c=zI.d.audioEngine)||void 0===c?void 0:c.audioContext.currentTime)+q:zI.d.audioEngine.audioContext.currentTime;const t=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(w,t,this.loop?void 0:l)}}};"suspended"===(null===(c=zI.d.audioEngine)||void 0===c?void 0:c.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var q;"suspended"===(null===(q=zI.d.audioEngine)||void 0===q?void 0:q.audioContext.state)?(zI.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=zI.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{t()})))):t()}),500):t()}this._startTime=w,this.isPlaying=!0,this.isPaused=!1}catch(a){T.b.Error("Error while trying to play audio: "+this.name+", "+a.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(q){var I;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var l;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(l=this._streamingSource)||void 0===l||l.disconnect();this.isPlaying=!1}else if(null!==(I=zI.d.audioEngine)&&void 0!==I&&I.audioContext&&this._soundSource){const I=q?zI.d.audioEngine.audioContext.currentTime+q:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(I)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var I;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(I=this._streamingSource)||void 0===I||I.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(q=zI.d.audioEngine)&&void 0!==q&&q.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=zI.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(q,I){var l;null!==(l=zI.d.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._soundGain&&(I&&zI.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(zI.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,zI.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(q,zI.d.audioEngine.audioContext.currentTime+I)):this._soundGain.gain.value=q),this._volume=q}setPlaybackRate(q){this._playbackRate=q,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(q){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=q,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=q=>this._onRegisterAfterWorldMatrixUpdate(q),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(q){var I;if(q.getBoundingInfo){const I=q.getBoundingInfo();this.setPosition(I.boundingSphere.centerWorld)}else this.setPosition(q.absolutePosition);null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const q=()=>{(0,HI.e)((()=>this._isReadyToPlay),(()=>{l._audioBuffer=this.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play(0,this._offset,this._length)}),void 0,300)},I={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},l=new AI(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,I);return this.useCustomAttenuation&&l.setAttenuationFunction(this._customAttenuationFunction),l.setPosition(this._position),l.setPlaybackRate(this._playbackRate),q(),l}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const q={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(q.connectedMeshId=this._connectedTransformNode.id),q.position=this._position.Uc(),q.refDistance=this.refDistance,q.distanceModel=this.distanceModel,q.isDirectional=this._isDirectional,q.localDirectionToMesh=this._localDirection.Uc(),q.coneInnerAngle=this._coneInnerAngle,q.coneOuterAngle=this._coneOuterAngle,q.coneOuterGain=this._coneOuterGain),q}static Parse(q,I,l,w){const O=q.name;let c;c=q.url?l+q.url:l+O;const a={autoplay:q.autoplay,loop:q.loop,volume:q.volume,spatialSound:q.spatialSound,maxDistance:q.maxDistance,rolloffFactor:q.rolloffFactor,refDistance:q.refDistance,distanceModel:q.distanceModel,playbackRate:q.playbackRate};let F;if(w){const q=()=>{(0,HI.e)((()=>w._isReadyToPlay),(()=>{F._audioBuffer=w.getAudioBuffer(),F._isReadyToPlay=!0,F.autoplay&&F.play(0,F._offset,F._length)}),void 0,300)};F=new AI(O,new ArrayBuffer(0),I,null,a),q()}else F=new AI(O,c,I,(()=>{I.removePendingData(F)}),a),I.addPendingData(F);if(q.position){const I=t.dI.vI(q.position);F.setPosition(I)}if(q.isDirectional&&(F.setDirectionalCone(q.coneInnerAngle||360,q.coneOuterAngle||360,q.coneOuterGain||0),q.localDirectionToMesh)){const I=t.dI.vI(q.localDirectionToMesh);F.setLocalDirectionToMesh(I)}if(q.connectedMeshId){const l=I.getMeshById(q.connectedMeshId);l&&F.attachToMesh(l)}return q.metadata&&(F.metadata=q.metadata),F}_setOffset(q){this._offset!==q&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=q)}_clearTimeoutsAndObservers(){var q;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(q=zI.d.audioEngine)||void 0===q||q.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}AI._SceneComponentInitialization=q=>{throw(0,JI.b)("AudioSceneComponent")},(0,Rq.e)("BABYLON.Sound",AI);class QI{constructor(q,I,l){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],I.length!==l.length)throw new Error("Sounds length does not equal weights length");this.loop=q,this._weights=l;let w=0;for(const O of l)w+=O;const t=w>0?1/w:0;for(let O=0;O<this._weights.length;O++)this._weights[O]*=t;this._sounds=I;for(const O of this._sounds)O.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!==this._coneInnerAngle){if(this._coneOuterAngle<q)return void T.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q;for(const I of this._sounds)I.directionalConeInnerAngle=q}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!==this._coneOuterAngle){if(q<this._coneInnerAngle)return void T.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q;for(const I of this._sounds)I.directionalConeOuterAngle=q}}get volume(){return this._volume}set volume(q){if(q!==this._volume)for(const I of this._sounds)I.setVolume(q)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(q){if(!this.isPaused){this.stop();const q=Math.random();let I=0;for(let l=0;l<this._weights.length;l++)if(I+=this._weights[l],q<=I){this._currentIndex=l;break}}const I=this._sounds[this._currentIndex??0];I.isReady()?I.play(0,this.isPaused?void 0:q):I.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class bI{constructor(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(q=q||d.e.LastCreatedScene)&&(this._scene=q,this.soundCollection=[],this._options=I,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var q;null!==(q=zI.d.audioEngine)&&void 0!==q&&q.canUseWebAudio&&zI.d.audioEngine.audioContext&&(this._outputAudioNode=zI.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(zI.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(zI.d.audioEngine&&zI.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(q){var I;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&q.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==q.soundTrackId&&(-1===q.soundTrackId?this._scene.mainSoundTrack.removeSound(q):this._scene.soundTracks&&this._scene.soundTracks[q.soundTrackId].removeSound(q)),this.soundCollection.push(q),q.soundTrackId=this.id}removeSound(q){const I=this.soundCollection.indexOf(q);-1!==I&&this.soundCollection.splice(I,1)}setVolume(q){var I;null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=q)}switchPanningModelToHRTF(){var q;if(null!==(q=zI.d.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let I=0;I<this.soundCollection.length;I++)this.soundCollection[I].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var q;if(null!==(q=zI.d.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let I=0;I<this.soundCollection.length;I++)this.soundCollection[I].switchPanningModelToEqualPower()}connectToAnalyser(q){var I;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=q,null!==(I=zI.d.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,zI.d.audioEngine.masterGain))}}var ql=l(13021),Il=l(12987),ll=l(12582);zI.d.AudioEngineFactory=(q,I,l)=>new wl(q,I,l);class wl{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new Z.d,this.onAudioLockedObservable=new Z.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ll.f)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const w=document.createElement("audio");this._hostElement=q,this._audioContext=I,this._audioDestination=l;try{w&&w.canPlayType&&(w.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||w.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(t){}try{w&&w.canPlayType&&w.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(t){}}lock(){this._triggerSuspendedState()}unlock(){var q,I;if("running"===(null===(q=this._audioContext)||void 0===q?void 0:q.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(I=this._audioContext)||void 0===I||I.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{T.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var q;null===(q=this._audioContext)||void 0===q||q.addEventListener("statechange",(()=>{var q;this.unlocked&&"running"!==(null===(q=this._audioContext)||void 0===q?void 0:q.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var q;return null!==(q=this._audioContext)&&void 0!==q&&q.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(q){this.canUseWebAudio=!1,T.b.Error("Web Audio: "+q.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(q){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const q=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",I=document.createElement("style");I.appendChild(document.createTextNode(q)),document.getElementsByTagName("head")[0].appendChild(I),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var q;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(q=this._audioContext)||void 0===q||q.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(q){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=q)}connectToAnalyser(q){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=q,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var tl=l(12601);(0,l(14116).f)(ql.c.NAME_AUDIO,((q,I,l,w)=>{let t,O=[];if(l.To=l.To||[],void 0!==q.To&&null!==q.To)for(let a=0,F=q.To.length;a<F;a++){var c;const F=q.To[a];null!==(c=zI.d.audioEngine)&&void 0!==c&&c.canUseWebAudio?(F.url||(F.url=F.name),O[F.url]?l.To.push(AI.Parse(F,I,w,O[F.url])):(t=AI.Parse(F,I,w),O[F.url]=t,l.To.push(t))):l.To.push(new AI(F.name,null,I))}O=[]})),Object.defineProperty(Il.e.prototype,"mainSoundTrack",{get:function(){let q=this._getComponent(ql.c.NAME_AUDIO);return q||(q=new Ol(this),this.o(q)),this._mainSoundTrack||(this._mainSoundTrack=new bI(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Il.e.prototype.getSoundByName=function(q){let I;for(I=0;I<this.mainSoundTrack.soundCollection.length;I++)if(this.mainSoundTrack.soundCollection[I].name===q)return this.mainSoundTrack.soundCollection[I];if(this.soundTracks)for(let l=0;l<this.soundTracks.length;l++)for(I=0;I<this.soundTracks[l].soundCollection.length;I++)if(this.soundTracks[l].soundCollection[I].name===q)return this.soundTracks[l].soundCollection[I];return null},Object.defineProperty(Il.e.prototype,"audioEnabled",{get:function(){let q=this._getComponent(ql.c.NAME_AUDIO);return q||(q=new Ol(this),this.o(q)),q.audioEnabled},set:function(q){let I=this._getComponent(ql.c.NAME_AUDIO);I||(I=new Ol(this),this.o(I)),q?I.enableAudio():I.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Il.e.prototype,"headphone",{get:function(){let q=this._getComponent(ql.c.NAME_AUDIO);return q||(q=new Ol(this),this.o(q)),q.headphone},set:function(q){let I=this._getComponent(ql.c.NAME_AUDIO);I||(I=new Ol(this),this.o(I)),q?I.switchAudioModeForHeadphones():I.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Il.e.prototype,"audioListenerPositionProvider",{get:function(){let q=this._getComponent(ql.c.NAME_AUDIO);return q||(q=new Ol(this),this.o(q)),q.audioListenerPositionProvider},set:function(q){let I=this._getComponent(ql.c.NAME_AUDIO);if(I||(I=new Ol(this),this.o(I)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");I.audioListenerPositionProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(Il.e.prototype,"audioListenerRotationProvider",{get:function(){let q=this._getComponent(ql.c.NAME_AUDIO);return q||(q=new Ol(this),this.o(q)),q.audioListenerRotationProvider},set:function(q){let I=this._getComponent(ql.c.NAME_AUDIO);if(I||(I=new Ol(this),this.o(I)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");I.audioListenerRotationProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(Il.e.prototype,"audioPositioningRefreshRate",{get:function(){let q=this._getComponent(ql.c.NAME_AUDIO);return q||(q=new Ol(this),this.o(q)),q.audioPositioningRefreshRate},set:function(q){let I=this._getComponent(ql.c.NAME_AUDIO);I||(I=new Ol(this),this.o(I)),I.audioPositioningRefreshRate=q},enumerable:!0,configurable:!0});class Ol{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(q){this.name=ql.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new t.dI,this._cachedCameraPosition=new t.dI,this._lastCheck=0,this._invertMatrixTemp=new t.Matrix,this._cameraDirectionTemp=new t.dI,(q=q||d.e.LastCreatedScene)&&(this.VI=q,q.soundTracks=[],q.To=[])}register(){this.VI._afterRenderStage.registerStep(ql.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(q){if(q.To=[],this.VI.soundTracks)for(let I=0;I<this.VI.soundTracks.length;I++){const l=this.VI.soundTracks[I];for(let I=0;I<l.soundCollection.length;I++)q.To.push(l.soundCollection[I].serialize())}}addFromContainer(q){if(q.To)for(const I of q.To)I.play(),I.autoplay=!0,this.VI.mainSoundTrack.addSound(I)}removeFromContainer(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(q.To)for(const l of q.To)l.stop(),l.autoplay=!1,this.VI.mainSoundTrack.removeSound(l),I&&l.dispose()}dispose(){const q=this.VI;if(q._mainSoundTrack&&q.mainSoundTrack.dispose(),q.soundTracks)for(let I=0;I<q.soundTracks.length;I++)q.soundTracks[I].dispose()}disableAudio(){const q=this.VI;let I;for(this._audioEnabled=!1,zI.d.audioEngine&&zI.d.audioEngine.audioContext&&zI.d.audioEngine.audioContext.suspend(),I=0;I<q.mainSoundTrack.soundCollection.length;I++)q.mainSoundTrack.soundCollection[I].pause();if(q.soundTracks)for(I=0;I<q.soundTracks.length;I++)for(let l=0;l<q.soundTracks[I].soundCollection.length;l++)q.soundTracks[I].soundCollection[l].pause()}enableAudio(){const q=this.VI;let I;for(this._audioEnabled=!0,zI.d.audioEngine&&zI.d.audioEngine.audioContext&&zI.d.audioEngine.audioContext.resume(),I=0;I<q.mainSoundTrack.soundCollection.length;I++)q.mainSoundTrack.soundCollection[I].isPaused&&q.mainSoundTrack.soundCollection[I].play();if(q.soundTracks)for(I=0;I<q.soundTracks.length;I++)for(let l=0;l<q.soundTracks[I].soundCollection.length;l++)q.soundTracks[I].soundCollection[l].isPaused&&q.soundTracks[I].soundCollection[l].play()}switchAudioModeForHeadphones(){const q=this.VI;if(this._headphone=!0,q.mainSoundTrack.switchPanningModelToHRTF(),q.soundTracks)for(let I=0;I<q.soundTracks.length;I++)q.soundTracks[I].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const q=this.VI;if(this._headphone=!1,q.mainSoundTrack.switchPanningModelToEqualPower(),q.soundTracks)for(let I=0;I<q.soundTracks.length;I++)q.soundTracks[I].switchPanningModelToEqualPower()}_afterRender(){const q=tl.e.Now;if(this._lastCheck&&q-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=q;const I=this.VI;if(!this._audioEnabled||!I._mainSoundTrack||!I.soundTracks||0===I._mainSoundTrack.soundCollection.length&&1===I.soundTracks.length)return;const l=zI.d.audioEngine;if(l&&l.audioContext){let q,w=I.activeCamera;if(I.activeCameras&&I.activeCameras.length>0&&(w=I.activeCameras[0]),this.audioListenerPositionProvider){const q=this.audioListenerPositionProvider();l.audioContext.listener.setPosition(q.x||0,q.y||0,q.z||0)}else w?this._cachedCameraPosition.equals(w.globalPosition)||(this._cachedCameraPosition.t(w.globalPosition),l.audioContext.listener.setPosition(w.globalPosition.x,w.globalPosition.y,w.globalPosition.z)):l.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const q=this.audioListenerRotationProvider();l.audioContext.listener.setOrientation(q.x||0,q.y||0,q.z||0,0,1,0)}else w?(w.rigCameras&&w.rigCameras.length>0&&(w=w.rigCameras[0]),w.getViewMatrix().invertToRef(this._invertMatrixTemp),t.dI.TransformNormalToRef(Ol._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.t(this._cameraDirectionTemp),l.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):l.audioContext.listener.setOrientation(0,0,0,0,1,0);for(q=0;q<I.mainSoundTrack.soundCollection.length;q++){const l=I.mainSoundTrack.soundCollection[q];l.useCustomAttenuation&&l.updateDistanceFromListener()}if(I.soundTracks)for(q=0;q<I.soundTracks.length;q++)for(let l=0;l<I.soundTracks[q].soundCollection.length;l++){const w=I.soundTracks[q].soundCollection[l];w.useCustomAttenuation&&w.updateDistanceFromListener()}}}}Ol._CameraDirection=new t.dI(0,0,-1),AI._SceneComponentInitialization=q=>{let I=q._getComponent(ql.c.NAME_AUDIO);I||(I=new Ol(q),q.o(I))};const cl="MSFT_audio_emitter";class al{constructor(q){this.name=cl,this._loader=q,this.enabled=this._loader.isExtensionUsed(cl)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const q=this._loader.rc.extensions;if(q&&q[this.name]){const I=q[this.name];this._clips=I.clips,this._emitters=I.emitters,P.Assign(this._clips),P.Assign(this._emitters)}}loadSceneAsync(q,I){return Y.LoadExtensionAsync(q,I,this.name,(async(l,w)=>{const t=new Array;t.push(this._loader.loadSceneAsync(q,I));for(const q of w.emitters){const I=P.Get(`${l}/emitters`,this._emitters,q);if(void 0!=I.refDistance||void 0!=I.maxDistance||void 0!=I.rolloffFactor||void 0!=I.distanceModel||void 0!=I.innerAngle||void 0!=I.outerAngle)throw new Error(`${l}: Direction or Distance properties are not allowed on emitters attached to a scene`);t.push(this._loadEmitterAsync(`${l}/emitters/${I.index}`,I))}await Promise.all(t)}))}loadNodeAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(q,w)=>{const O=new Array,a=await this._loader.loadNodeAsync(q,I,(I=>{for(const l of w.emitters){const w=P.Get(`${q}/emitters`,this._emitters,l);O.push(this._loadEmitterAsync(`${q}/emitters/${w.index}`,w).then((()=>{for(const q of w._babylonSounds)q.attachToMesh(I),void 0==w.innerAngle&&void 0==w.outerAngle||(q.setLocalDirectionToMesh(t.dI.Forward()),q.setDirectionalCone(2*c.Tools.ToDegrees(void 0==w.innerAngle?Math.PI:w.innerAngle),2*c.Tools.ToDegrees(void 0==w.outerAngle?Math.PI:w.outerAngle),0))})))}l(I)}));return await Promise.all(O),a}))}loadAnimationAsync(q,I){return Y.LoadExtensionAsync(q,I,this.name,(async(l,w)=>{const t=await this._loader.loadAnimationAsync(q,I),O=new Array;P.Assign(w.events);for(const c of w.events)O.push(this._loadAnimationEventAsync(`${l}/events/${c.index}`,q,I,c,t));return await Promise.all(O),t}))}_loadClipAsync(q,I){if(I._objectURL)return I._objectURL;let l;if(I.uri)l=this._loader.loadUriAsync(q,I,I.uri);else{const w=P.Get(`${q}/bufferView`,this._loader.rc.bufferViews,I.bufferView);l=this._loader.loadBufferViewAsync(`/bufferViews/${w.index}`,w)}return I._objectURL=l.then((q=>URL.createObjectURL(new Blob([q],{type:I.mimeType})))),I._objectURL}_loadEmitterAsync(q,I){if(I._babylonSounds=I._babylonSounds||[],!I._babylonData){const q=new Array,l=I.name||`emitter${I.index}`,w={loop:!1,autoplay:!1,volume:void 0==I.volume?1:I.volume};for(let O=0;O<I.clips.length;O++){const t=`/extensions/${this.name}/clips`,c=P.Get(t,this._clips,I.clips[O].clip);q.push(this._loadClipAsync(`${t}/${I.clips[O].clip}`,c).then((q=>{const t=I._babylonSounds[O]=new AI(l,q,this._loader.babylonScene,null,w);t.refDistance=I.refDistance||1,t.maxDistance=I.maxDistance||256,t.rolloffFactor=I.rolloffFactor||1,t.distanceModel=I.distanceModel||"exponential"})))}const t=Promise.all(q).then((()=>{const q=I.clips.map((q=>q.weight||1)),l=new QI(I.loop||!1,I._babylonSounds,q);I.innerAngle&&(l.directionalConeInnerAngle=2*c.Tools.ToDegrees(I.innerAngle)),I.outerAngle&&(l.directionalConeOuterAngle=2*c.Tools.ToDegrees(I.outerAngle)),I.volume&&(l.volume=I.volume),I._babylonData.sound=l}));I._babylonData={loaded:t}}return I._babylonData.loaded}_getEventAction(q,I,l,w,t){switch(l){case"play":return q=>{const l=(t||0)+(q-w);I.play(l)};case"stop":return()=>{I.stop()};case"pause":return()=>{I.pause()};default:throw new Error(`${q}: Unsupported action ${l}`)}}_loadAnimationEventAsync(q,I,l,w,t){if(0==t.targetedAnimations.length)return Promise.resolve();const O=t.targetedAnimations[0],c=w.wI,a=P.Get(`/extensions/${this.name}/emitters`,this._emitters,c);return this._loadEmitterAsync(q,a).then((()=>{const I=a._babylonData.sound;if(I){const l=new NI(w.time,this._getEventAction(q,I,w.action,w.time,w.startOffset));O.animation.addEvent(l),t.onAnimationGroupEndObservable.add((()=>{I.stop()})),t.onAnimationGroupPauseObservable.add((()=>{I.pause()}))}}))}}E(cl),L(cl,!0,(q=>new al(q)));const Fl="MSFT_lod";class sl{constructor(q){var I;this.name=Fl,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Z.d,this.onMaterialLODsLoadedObservable=new Z.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=q,this.maxLODsToLoad=(null===(I=this._loader.parent.extensionOptions[Fl])||void 0===I?void 0:I.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Fl)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let q=0;q<this._nodePromiseLODs.length;q++){const I=Promise.all(this._nodePromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Node LOD ${q}`),this._loader.log(`Loaded node LOD ${q}`)),this.onNodeLODsLoadedObservable.notifyObservers(q),q!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${q+1}`),this._loadBufferLOD(this._nodeBufferLODs,q+1),this._nodeSignalLODs[q]&&this._nodeSignalLODs[q].resolve())}));this._loader._completePromises.push(I)}for(let q=0;q<this._materialPromiseLODs.length;q++){const I=Promise.all(this._materialPromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Material LOD ${q}`),this._loader.log(`Loaded material LOD ${q}`)),this.onMaterialLODsLoadedObservable.notifyObservers(q),q!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${q+1}`),this._loadBufferLOD(this._materialBufferLODs,q+1),this._materialSignalLODs[q]&&this._materialSignalLODs[q].resolve())}));this._loader._completePromises.push(I)}}loadSceneAsync(q,I){const l=this._loader.loadSceneAsync(q,I);return this._loadBufferLOD(this._bufferLODs,0),l}loadNodeAsync(q,I,l){return Y.LoadExtensionAsync(q,I,this.name,(async(q,t)=>{let O;const c=this._getLODs(q,I,this._loader.rc.nodes,t.ids);this._loader.logOpen(`${q}`);for(let I=0;I<c.length;I++){const q=c[I];0!==I&&(this._nodeIndexLOD=I,this._nodeSignalLODs[I]=this._nodeSignalLODs[I]||new w);const t=q=>{l(q),q.oF(!1)},a=this._loader.loadNodeAsync(`/nodes/${q.index}`,q,t).then((q=>{if(0!==I){const q=c[I-1];q._babylonTransformNode&&(this._disposeTransformNode(q._babylonTransformNode),delete q._babylonTransformNode)}return q.oF(!0),q}));this._nodePromiseLODs[I]=this._nodePromiseLODs[I]||[],0===I?O=a:(this._nodeIndexLOD=null,this._nodePromiseLODs[I].push(a))}return this._loader.logClose(),await O}))}_loadMaterialAsync(q,I,l,w,t){return this._nodeIndexLOD?null:Y.LoadExtensionAsync(q,I,this.name,(async(q,O)=>{let c;const a=this._getLODs(q,I,this._loader.rc.materials,O.ids);this._loader.logOpen(`${q}`);for(let I=0;I<a.length;I++){const q=a[I];0!==I&&(this._materialIndexLOD=I);const O=this._loader._loadMaterialAsync(`/materials/${q.index}`,q,l,w,(q=>{0===I&&t(q)})).then((q=>{if(0!==I){t(q);const l=a[I-1]._data;l[w]&&(this._disposeMaterials([l[w].babylonMaterial]),delete l[w])}return q}));this._materialPromiseLODs[I]=this._materialPromiseLODs[I]||[],0===I?c=O:(this._materialIndexLOD=null,this._materialPromiseLODs[I].push(O))}return this._loader.logClose(),await c}))}_loadUriAsync(q,I,l){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const t=this._nodeIndexLOD-1;return this._nodeSignalLODs[t]=this._nodeSignalLODs[t]||new w,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(q,I,l)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const t=this._materialIndexLOD-1;return this._materialSignalLODs[t]=this._materialSignalLODs[t]||new w,this._materialSignalLODs[t].promise.then((async()=>await this._loader.loadUriAsync(q,I,l)))}return null}loadBufferAsync(q,I,l,t){if(this._loader.parent.useRangeRequests&&!I.uri){if(!this._loader.bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);const I=async(q,I)=>{const O=l,c=O+t-1;let a=q[I];return a?(a.start=Math.min(a.start,O),a.end=Math.max(a.end,c)):(a={start:O,end:c,loaded:new w},q[I]=a),await a.loaded.promise.then((q=>new Uint8Array(q.buffer,q.byteOffset+l-a.start,t)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?I(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?I(this._materialBufferLODs,this._materialIndexLOD):I(this._bufferLODs,0)}return null}_loadBufferLOD(q,I){const l=q[I];l&&(this._loader.log(`Loading buffer range [${l.start}-${l.end}]`),this._loader.bin.readAsync(l.start,l.end-l.start+1).then((q=>{l.loaded.resolve(q)}),(q=>{l.loaded.reject(q)})))}_getLODs(q,I,l,w){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const t=[];for(let O=w.length-1;O>=0;O--)if(t.push(P.Get(`${q}/ids/${w[O]}`,l,w[O])),t.length===this.maxLODsToLoad)return t;return t.push(I),t}_disposeTransformNode(q){const I=[],l=q.material;l&&I.push(l);for(const t of q.getChildMeshes())t.material&&I.push(t.material);q.dispose();const w=I.filter((q=>this._loader.babylonScene.meshes.every((I=>I.material!=q))));this._disposeMaterials(w)}_disposeMaterials(q){const I={};for(const l of q){for(const q of l.getActiveTextures())I[q.uniqueId]=q;l.dispose()}for(const l in I)for(const q of this._loader.babylonScene.materials)q.hasTexture(I[l])&&delete I[l];for(const l in I)I[l].dispose()}}E(Fl),L(Fl,!0,(q=>new sl(q)));const Zl="MSFT_minecraftMesh";class rl{constructor(q){this.name=Zl,this._loader=q,this.enabled=this._loader.isExtensionUsed(Zl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtraAsync(q,I,this.name,(async(w,t)=>{if(t){if(!(l instanceof v.c))throw new Error(`${w}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(q,I,l);return l.needAlphaBlending()&&(l.forceDepthWrite=!0,l.separateCullingPass=!0),l.Sc=l.forceDepthWrite,l.twoSidedLighting=!0,await t}}))}}E(Zl),L(Zl,!0,(q=>new rl(q)));const xl="MSFT_sRGBFactors";class ol{constructor(q){this.name=xl,this._loader=q,this.enabled=this._loader.isExtensionUsed(xl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,I,l){return Y.LoadExtraAsync(q,I,this.name,(async(w,t)=>{if(t){if(!(l instanceof v.c))throw new Error(`${w}: Material type not supported`);const t=this._loader.loadMaterialPropertiesAsync(q,I,l),O=l.Wq().getEngine().useExactSrgbConversions;return l.albedoTexture||l.albedoColor.toLinearSpaceToRef(l.albedoColor,O),l.reflectivityTexture||l.reflectivityColor.toLinearSpaceToRef(l.reflectivityColor,O),await t}}))}}E(xl),L(xl,!0,(q=>new ol(q)));var dl=l(14422);const Tl={};var Vl=l(14477),Ul=l(14451),Bl=l(14430),vl=l(14441);function kl(q,I){for(const l of q)for(const q of l.dataOutputs)if(q.uniqueId===I)return q;throw new Error("Could not find data out connection with unique id "+I)}function Cl(q,I){for(const l of q)if(l instanceof Ul.e)for(const q of l.signalInputs)if(q.uniqueId===I)return q;throw new Error("Could not find signal in connection with unique id "+I)}async function Rl(q,I){const w=await Promise.all(q.allBlocks.map((async q=>{const I=function(q){switch(q){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([l.e(78),l.e(79)]).then(l.bind(l,15936))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await l.e(80).then(l.bind(l,15944))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await l.e(81).then(l.bind(l,15953))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await l.e(82).then(l.bind(l,15959))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await l.e(83).then(l.bind(l,15961))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await l.e(84).then(l.bind(l,15968))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await l.e(85).then(l.bind(l,15974))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await l.e(86).then(l.bind(l,15977))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await l.e(87).then(l.bind(l,15986))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await l.e(90).then(l.bind(l,16019))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await l.e(90).then(l.bind(l,16019))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await l.e(90).then(l.bind(l,16019))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await l.e(90).then(l.bind(l,16019))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await l.e(95).then(l.bind(l,16024))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await l.e(96).then(l.bind(l,16030))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await l.e(97).then(l.bind(l,16036))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await l.e(98).then(l.bind(l,16039))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await l.e(99).then(l.bind(l,16047))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await l.e(100).then(l.bind(l,16049))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await l.e(101).then(l.bind(l,16055))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await l.e(102).then(l.bind(l,16064))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await l.e(103).then(l.bind(l,16073))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await l.e(104).then(l.bind(l,16075))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await l.e(105).then(l.bind(l,16077))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await l.e(106).then(l.bind(l,16086))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await l.e(107).then(l.bind(l,16089))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await l.e(108).then(l.bind(l,16091))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await l.e(109).then(l.bind(l,16094))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await l.e(110).then(l.bind(l,16099))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await l.e(111).then(l.bind(l,16107))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await l.e(112).then(l.bind(l,16111))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await l.e(113).then(l.bind(l,16118))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await l.e(92).then(l.bind(l,16127))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await l.e(114).then(l.bind(l,16132))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await l.e(115).then(l.bind(l,16141))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await l.e(116).then(l.bind(l,16147))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await l.e(93).then(l.bind(l,16150))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await l.e(88).then(l.bind(l,15992))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await l.e(94).then(l.bind(l,16155))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await l.e(94).then(l.bind(l,16155))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await l.e(94).then(l.bind(l,16155))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await l.e(94).then(l.bind(l,16155))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await l.e(94).then(l.bind(l,16155))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await l.e(94).then(l.bind(l,16155))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await l.e(94).then(l.bind(l,16155))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await l.e(94).then(l.bind(l,16155))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await l.e(89).then(l.bind(l,16014))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await l.e(90).then(l.bind(l,16019))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await l.e(90).then(l.bind(l,16019))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await l.e(91).then(l.bind(l,16164))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await l.e(91).then(l.bind(l,16164))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await l.e(91).then(l.bind(l,16164))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await l.e(91).then(l.bind(l,16164))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await l.e(91).then(l.bind(l,16164))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await l.e(91).then(l.bind(l,16164))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await l.e(117).then(l.bind(l,16170))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await l.e(118).then(l.bind(l,16177))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await l.e(119).then(l.bind(l,16184))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await l.e(120).then(l.bind(l,16193))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await l.e(121).then(l.bind(l,16196))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await l.e(122).then(l.bind(l,16203))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await l.e(123).then(l.bind(l,16210))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await l.e(124).then(l.bind(l,16217))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await l.e(125).then(l.bind(l,16219))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await l.e(126).then(l.bind(l,16228))).FlowGraphDataSwitchBlock;default:if(Tl[q])return Tl[q];throw new Error(`Unknown block name ${q}`)}}(q.className);return await I()})));return function(q,I,l){const w=I.coordinator.createGraph(),t=[],O=I.valueParseFunction??Bl.b;for(let c=0;c<q.allBlocks.length;c++){const a=el(q.allBlocks[c],{VI:I.coordinator.config.VI,pathConverter:I.pathConverter,assetsContainer:I.coordinator.config.VI,valueParseFunction:O},l[c]);t.push(a),a instanceof Vl.b&&w.addEventBlock(a)}for(const c of t){for(const q of c.dataInputs)for(const I of q.connectedPointIds){const l=kl(t,I);q.connectTo(l)}if(c instanceof Ul.e)for(const q of c.signalOutputs)for(const I of q.connectedPointIds){const l=Cl(t,I);q.connectTo(l)}}for(const c of q.executionContexts)Wl(c,{graph:w,valueParseFunction:O},q.rightHanded);return w}(q,I,w)}function Wl(q,I,l){const w=I.graph.createContext();q.enableLogging&&(w.enableLogging=!0),w.treatDataAsRightHanded=l||!1;const t=I.valueParseFunction??Bl.b;w.uniqueId=q.uniqueId;const O=w.Wq();if(q._assetsContext){var c,a,F,s,Z,r,x,o,d,T;const I=q._assetsContext,l={meshes:null===(c=I.meshes)||void 0===c?void 0:c.map((q=>O.getMeshById(q))),lights:null===(a=I.lights)||void 0===a?void 0:a.map((q=>O.getLightByName(q))),cameras:null===(F=I.cameras)||void 0===F?void 0:F.map((q=>O.getCameraByName(q))),materials:null===(s=I.materials)||void 0===s?void 0:s.map((q=>O.getMaterialById(q))),textures:null===(Z=I.textures)||void 0===Z?void 0:Z.map((q=>O.getTextureByName(q))),animations:null===(r=I.animations)||void 0===r?void 0:r.map((q=>O.animations.find((I=>I.name===q)))),skeletons:null===(x=I.skeletons)||void 0===x?void 0:x.map((q=>O.getSkeletonByName(q))),Kx:null===(o=I.Kx)||void 0===o?void 0:o.map((q=>O.getParticleSystemById(q))),animationGroups:null===(d=I.animationGroups)||void 0===d?void 0:d.map((q=>O.getAnimationGroupByName(q))),transformNodes:null===(T=I.transformNodes)||void 0===T?void 0:T.map((q=>O.getTransformNodeById(q))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],To:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};w.assetsContext=l}for(const V in q._userVariables){const I=t(V,q._userVariables,w.assetsContext,O);w.userVariables[V]=I}for(const V in q._connectionValues){const I=t(V,q._connectionValues,w.assetsContext,O);w._setConnectionValueByKey(V,I)}return w}function el(q,I,l){const w={},t=I.valueParseFunction??Bl.b;if(q.config)for(const c in q.config)w[c]=t(c,q.config,I.assetsContainer||I.VI,I.VI);if((0,Bl.f)(q.className)){if(!I.pathConverter)throw new Error("Path converter is required for this block");w.pathConverter=I.pathConverter}const O=new l(w);O.uniqueId=q.uniqueId;for(let c=0;c<q.dataInputs.length;c++){const I=O.getDataInput(q.dataInputs[c].name);if(!I)throw new Error("Could not find data input with name "+q.dataInputs[c].name+" in block "+q.className);I.deserialize(q.dataInputs[c])}for(let c=0;c<q.dataOutputs.length;c++){const I=O.getDataOutput(q.dataOutputs[c].name);if(!I)throw new Error("Could not find data output with name "+q.dataOutputs[c].name+" in block "+q.className);I.deserialize(q.dataOutputs[c])}return O.metadata=q.metadata,O.deserialize&&O.deserialize(q),O}function il(q){const[I,l]=q.split(":");return Sl({op:I,extension:l})}function Sl(q){var I;let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const w=q.extension?null===(I=pl[q.extension])||void 0===I?void 0:I[q.op]:Xl[q.op];if(!w&&(T.b.Warn(`No mapping found for operation ${q.op} and extension ${q.extension||"KHR_interactivity"}`),l)){const I={},l={flows:{}};if(q.inputValueSockets){I.values={};for(const l in q.inputValueSockets)I.values[l]={name:l}}return q.outputValueSockets&&(l.values={},Object.keys(q.outputValueSockets).forEach((q=>{l.values[q]={name:q}}))),{uZ:[],inputs:I,outputs:l}}return w}function gl(q,I,l){pl[I]||(pl[I]={}),pl[I][q]=l}const pl={BABYLON:{"flow/log":{uZ:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Xl={"event/onStart":{uZ:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{uZ:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{uZ:["FlowGraphSendCustomEventBlock"],extraProcessor(q,I,l,w,t){if("event/send"!==I.op||!q.configuration||1!==Object.keys(q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const O=q.configuration.event.value[0];if("number"!==typeof O)throw new Error("Event id should be a number");const c=w.arrays.events[O],a=t[0];return a.config||(a.config={}),a.config.eventId=c.eventId,a.config.eventData=c.eventData,t}},"event/receive":{uZ:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(q,I){var l;if(!q.configuration)return T.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const w=q.configuration.event;if(!w)return T.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const t=w.value[0];if("number"!==typeof t)return T.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(l=I.events)||void 0===l?void 0:l[t])?{valid:!0}:(T.b.Error(`Event with id ${t} not found`),{valid:!1,error:`Event with id ${t} not found`})},extraProcessor(q,I,l,w,t){if("event/receive"!==I.op||!q.configuration||1!==Object.keys(q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const O=q.configuration.event.value[0];if("number"!==typeof O)throw new Error("Event id should be a number");const c=w.arrays.events[O],a=t[0];return a.config||(a.config={}),a.config.eventId=c.eventId,a.config.eventData=c.eventData,t}},"math/e":Kl("FlowGraphEBlock"),"math/pi":Kl("FlowGraphPIBlock"),"math/inf":Kl("FlowGraphInfBlock"),"math/nan":Kl("FlowGraphNaNBlock"),"math/abs":Kl("FlowGraphAbsBlock"),"math/sign":Kl("FlowGraphSignBlock"),"math/trunc":Kl("FlowGraphTruncBlock"),"math/floor":Kl("FlowGraphFloorBlock"),"math/ceil":Kl("FlowGraphCeilBlock"),"math/round":{uZ:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t){var O;return(O=t[0]).config||(O.config={}),t[0].config.roundHalfAwayFromZero=!0,t}},"math/fract":Kl("FlowGraphFractBlock"),"math/neg":Kl("FlowGraphNegationBlock"),"math/add":Kl("FlowGraphAddBlock",["a","b"],!0),"math/sub":Kl("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{uZ:["FlowGraphMultiplyBlock"],extraProcessor(q,I,l,w,t){var O;(O=t[0]).config||(O.config={}),t[0].config.useMatrixPerComponent=!0,t[0].config.preventIntegerFloatArithmetic=!0;let c=-1;return Object.keys(q.values||{}).find((I=>{var l;return void 0!==(null===(l=q.values)||void 0===l?void 0:l[I].type)&&(c=q.values[I].type,!0)})),-1!==c&&(t[0].config.type=w.arrays.types[c].flowGraphType),t},validation:q=>q.values?Dl(q):{valid:!0}},"math/div":Kl("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Kl("FlowGraphModuloBlock",["a","b"]),"math/min":Kl("FlowGraphMinBlock",["a","b"]),"math/max":Kl("FlowGraphMaxBlock",["a","b"]),"math/clamp":Kl("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Kl("FlowGraphSaturateBlock"),"math/mix":Kl("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Kl("FlowGraphEqualityBlock",["a","b"]),"math/lt":Kl("FlowGraphLessThanBlock",["a","b"]),"math/le":Kl("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Kl("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Kl("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Kl("FlowGraphIsNaNBlock"),"math/isinf":Kl("FlowGraphIsInfBlock"),"math/select":{uZ:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{uZ:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Kl("FlowGraphSinBlock"),"math/cos":Kl("FlowGraphCosBlock"),"math/tan":Kl("FlowGraphTanBlock"),"math/asin":Kl("FlowGraphASinBlock"),"math/acos":Kl("FlowGraphACosBlock"),"math/atan":Kl("FlowGraphATanBlock"),"math/atan2":Kl("FlowGraphATan2Block",["a","b"]),"math/sinh":Kl("FlowGraphSinhBlock"),"math/cosh":Kl("FlowGraphCoshBlock"),"math/tanh":Kl("FlowGraphTanhBlock"),"math/asinh":Kl("FlowGraphASinhBlock"),"math/acosh":Kl("FlowGraphACoshBlock"),"math/atanh":Kl("FlowGraphATanhBlock"),"math/exp":Kl("FlowGraphExponentialBlock"),"math/log":Kl("FlowGraphLogBlock"),"math/log2":Kl("FlowGraphLog2Block"),"math/log10":Kl("FlowGraphLog10Block"),"math/sqrt":Kl("FlowGraphSquareRootBlock"),"math/cbrt":Kl("FlowGraphCubeRootBlock"),"math/pow":Kl("FlowGraphPowerBlock",["a","b"]),"math/length":Kl("FlowGraphLengthBlock"),"math/normalize":Kl("FlowGraphNormalizeBlock"),"math/dot":Kl("FlowGraphDotBlock",["a","b"]),"math/cross":Kl("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Kl("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Kl("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{uZ:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{uZ:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{uZ:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{uZ:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{uZ:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{uZ:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{uZ:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Kl("FlowGraphTransposeBlock"),"math/determinant":Kl("FlowGraphDeterminantBlock"),"math/inverse":Kl("FlowGraphInvertMatrixBlock"),"math/matmul":Kl("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{uZ:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Xc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t,O){const c=t[0].dataInputs.find((q=>"rotationQuaternion"===q.name));if(!c)throw new Error("Rotation quaternion input not found");return O._connectionValues[c.uniqueId]&&(O._connectionValues[c.uniqueId].type="Quaternion"),t}},"math/matDecompose":{uZ:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Xc"}}}},"math/quatConjugate":Kl("FlowGraphConjugateBlock",["a"]),"math/quatMul":{uZ:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t){var O;return(O=t[0]).config||(O.config={}),t[0].config.type="Quaternion",t}},"math/quatAngleBetween":Kl("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{uZ:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Kl("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Kl("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{uZ:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t){var O;return(O=t[0]).config||(O.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract2x2":{uZ:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{uZ:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t){var O;return(O=t[0]).config||(O.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract3x3":{uZ:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{uZ:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t){var O;return(O=t[0]).config||(O.config={}),t[0].config.inputIsColumnMajor=!0,t}},"math/extract4x4":{uZ:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{uZ:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t,O){var c,a;(a=t[0]).config||(a.config={});const F=t[0].dataInputs[0];return t[0].config.valueType=(null===(c=O._connectionValues[F.uniqueId])||void 0===c?void 0:c.type)??"FlowGraphInteger",t}},"math/and":{uZ:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t,O){var c,a,F;(F=t[0]).config||(F.config={});const s=t[0].dataInputs[0],Z=t[0].dataInputs[1];return t[0].config.valueType=(null===(c=O._connectionValues[s.uniqueId])||void 0===c?void 0:c.type)??(null===(a=O._connectionValues[Z.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",t}},"math/or":{uZ:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t,O){var c,a,F;(F=t[0]).config||(F.config={});const s=t[0].dataInputs[0],Z=t[0].dataInputs[1];return t[0].config.valueType=(null===(c=O._connectionValues[s.uniqueId])||void 0===c?void 0:c.type)??(null===(a=O._connectionValues[Z.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",t}},"math/xor":{uZ:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,I,l,w,t,O){var c,a,F;(F=t[0]).config||(F.config={});const s=t[0].dataInputs[0],Z=t[0].dataInputs[1];return t[0].config.valueType=(null===(c=O._connectionValues[s.uniqueId])||void 0===c?void 0:c.type)??(null===(a=O._connectionValues[Z.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",t}},"math/asr":Kl("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Kl("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Kl("FlowGraphLeadingZerosBlock"),"math/ctz":Kl("FlowGraphTrailingZerosBlock"),"math/popcnt":Kl("FlowGraphOneBitsCounterBlock"),"math/rad":Kl("FlowGraphDegToRadBlock"),"math/deg":Kl("FlowGraphRadToDegBlock"),"type/boolToInt":Kl("FlowGraphBooleanToInt"),"type/boolToFloat":Kl("FlowGraphBooleanToFloat"),"type/intToBool":Kl("FlowGraphIntToBoolean"),"type/intToFloat":Kl("FlowGraphIntToFloat"),"type/floatToInt":Kl("FlowGraphFloatToInt"),"type/floatToBool":Kl("FlowGraphFloatToBoolean"),"flow/sequence":{uZ:["FlowGraphSequenceBlock"],extraProcessor(q,I,l,w,t){const O=t[0];return O.config||(O.config={}),O.config.outputSignalCount=Object.keys(q.flows||[]).length,O.signalOutputs.forEach(((q,I)=>{q.name="out_"+I})),t}},"flow/branch":{uZ:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{uZ:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(q){if(q.configuration&&q.configuration.cases){const I=q.configuration.cases.value;if(!I.every((q=>"number"===typeof q&&/^-?\d+$/.test(q.toString()))))return T.b.Warn("Switch cases should be integers. Using empty array instead."),q.configuration.cases.value=[],{valid:!0};const l=new Set(I);q.configuration.cases.value=Array.from(l)}return{valid:!0}},extraProcessor(q,I,l,w,t){if("flow/switch"!==I.op||!q.flows||0===Object.keys(q.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return t[0].signalOutputs.forEach((q=>{"default"!==q.name&&(q.name="out_"+q.name)})),t}},"flow/while":{uZ:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{uZ:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(q,I,l,w,t){const O=t[0];return O.config||(O.config={}),O.config.incrementIndexWhenLoopDone=!0,t}},"flow/doN":{uZ:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{uZ:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(q,I,l,w,t){if("flow/multiGate"!==I.op||!q.flows||0===Object.keys(q.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const O=t[0];return O.config||(O.config={}),O.config.outputSignalCount=Object.keys(q.flows).length,O.signalOutputs.forEach(((q,I)=>{q.name="out_"+I})),t}},"flow/waitAll":{uZ:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(q){var I,l;return"number"!==typeof(null===(I=q.configuration)||void 0===I||null===(l=I.inputFlows)||void 0===l?void 0:l.value[0])&&(q.configuration=q.configuration||{inputFlows:{value:[0]}},q.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{uZ:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{uZ:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{uZ:["FlowGraphCancelDelayBlock"]},"variable/get":{uZ:["FlowGraphGetVariableBlock"],validation(q){var I,l;return null!==(I=q.configuration)&&void 0!==I&&null!==(l=I.variable)&&void 0!==l&&l.value?{valid:!0}:(T.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(q,I)=>[I.getVariableName(q[0])]}}},"variable/set":{uZ:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(q,I)=>[I.getVariableName(q[0])]}}},"variable/setMultiple":{uZ:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(q,I)=>[q[0].map((q=>I.getVariableName(q)))]}},extraProcessor:(q,I,l,w,t)=>(t[0].dataInputs.forEach((q=>{q.name=w.getVariableName(+q.name)})),t)},"variable/interpolate":{uZ:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(q,I)=>[I.getVariableName(q[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:q=>!0===q[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",el:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",el:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",el:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",el:"FlowGraphPlayAnimationBlock"},out:{name:"out",el:"FlowGraphPlayAnimationBlock"},done:{name:"done",el:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(q,I,l,w,t){var O,c,a;const F=t[0],s=null===(O=q.configuration)||void 0===O?void 0:O.variable.value[0];if("number"!==typeof s)throw T.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const Z=w.arrays.staticVariables[s];"undefined"===typeof F.config.animationType.value&&(w.arrays.staticVariables,F.config.animationType.value=(0,vl.K)(Z.type));const r=t[4];return r.config||(r.config={}),(c=r.config).variable||(c.variable={}),r.config.variable.value=w.getVariableName(s),(a=t[3]).config||(a.config={}),t}},"pointer/get":{uZ:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",el:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",el:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,I,l,w,t)=>(t.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className&&(q.config||(q.config={}),q.config.outputValue=!0)})),t)},"pointer/set":{uZ:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",el:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",el:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,I,l,w,t)=>(t.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className&&(q.config||(q.config={}),q.config.outputValue=!0)})),t)},"pointer/interpolate":{uZ:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",el:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",el:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",el:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",el:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",el:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",el:"FlowGraphPlayAnimationBlock"},out:{name:"out",el:"FlowGraphPlayAnimationBlock"},done:{name:"done",el:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,I,l,w,t)=>(t.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className?(I.config||(I.config={}),I.config.outputValue=!0):"FlowGraphInterpolationBlock"===I.className&&(I.config||(I.config={}),Object.keys(q.values||[]).forEach((l=>{var t;const O=null===(t=q.values)||void 0===t?void 0:t[l];if("value"===l&&O){const q=O.type;void 0!==q&&(I.config.animationType=w.arrays.types[q].flowGraphType)}})))})),t)},"animation/start":{uZ:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",el:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(q,I)=>[q[0]*I._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(q,I)=>[q[0]*I._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,I,l,w,t,O,c){const a=t[t.length-1];return a.config||(a.config={}),a.config.glTF=c,t}},"animation/stop":{uZ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",el:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,I,l,w,t,O,c){const a=t[t.length-1];return a.config||(a.config={}),a.config.glTF=c,t}},"animation/stopAt":{uZ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",el:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(q,I)=>[q[0]*I._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,I,l,w,t,O,c){const a=t[t.length-1];return a.config||(a.config={}),a.config.glTF=c,t}},"math/switch":{uZ:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(q){if(q.configuration&&q.configuration.cases){const I=q.configuration.cases.value;if(!I.every((q=>"number"===typeof q&&/^-?\d+$/.test(q.toString()))))return T.b.Warn("Switch cases should be integers. Using empty array instead."),q.configuration.cases.value=[],{valid:!0};const l=new Set(I);q.configuration.cases.value=Array.from(l)}return{valid:!0}},extraProcessor(q,I,l,w,t){const O=t[0];return O.dataInputs.forEach((q=>{"default"!==q.name&&"case"!==q.name&&(q.name="in_"+q.name)})),O.config||(O.config={}),O.config.treatCasesAsIntegers=!0,t}},"debug/log":{uZ:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Kl(q){let I=arguments.length>2?arguments[2]:void 0;return{uZ:[q],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((q,I)=>(q[I]={name:I},q)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(q,l,w,t,O){var c;if(I){(c=O[0]).config||(c.config={}),O[0].config.preventIntegerFloatArithmetic=!0;let I=-1;Object.keys(q.values||{}).find((l=>{var w;return void 0!==(null===(w=q.values)||void 0===w?void 0:w[l].type)&&(I=q.values[l].type,!0)})),-1!==I&&(O[0].config.type=t.arrays.types[I].flowGraphType)}return O},validation:q=>I?Dl(q):{valid:!0}}}function Dl(q){if(q.values){const I=Object.keys(q.values).map((I=>q.values[I].type)).filter((q=>void 0!==q));if(!I.every((q=>q===I[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Xl["math/compose"]=Xl["math/matCompose"],Xl["math/decompose"]=Xl["math/matDecompose"];var Ml=l(12718);const nl={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"dI",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class fl{constructor(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=q,this._gltf=I,this._animationTargetFps=l,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const q of this._interactivityGraph.types)this._types.push(nl[q.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const q of this._interactivityGraph.declarations){const I=Sl(q);if(!I)throw T.b.Error(["No mapping found for declaration",q]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:I,fullOperationName:q.extension?q.op+":"+q.extension:q.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const q of this._interactivityGraph.variables){const I=this._parseVariable(q);this._staticVariables.push(I)}}_parseVariable(q,I){const l=this._types[q.type];if(!l)throw T.b.Error(["No type found for variable",q]),new Error("Error parsing variables");if(q.value&&q.value.length!==l.length)throw T.b.Error(["Invalid value length for variable",q,l]),new Error("Error parsing variables");const w=q.value||[];if(!w.length)switch(l.flowGraphType){case"boolean":w.push(!1);break;case"FlowGraphInteger":w.push(0);break;case"number":w.push(NaN);break;case"Vector2":w.push(NaN,NaN);break;case"dI":w.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":w.fill(NaN,0,4);break;case"Matrix":w.fill(NaN,0,16);break;case"Matrix3D":w.fill(NaN,0,9)}return"number"===l.elementType&&"string"===typeof w[0]&&(w[0]=parseFloat(w[0])),{type:l.flowGraphType,value:I?I(w,this):w}}_parseEvents(){if(this._interactivityGraph.events)for(const q of this._interactivityGraph.events){const I={eventId:q.id||"internalEvent_"+this._internalEventsCounter++};q.values&&(I.eventData=Object.keys(q.values).map((I=>{var l;const w=null===(l=q.values)||void 0===l?void 0:l[I];if(!w)throw T.b.Error(["No value found for event key",I]),new Error("Error parsing events");const t=this._types[w.type];if(!t)throw T.b.Error(["No type found for event value",w]),new Error("Error parsing events");const O="undefined"!==typeof w.value?this._parseVariable(w):void 0;return{id:I,type:t.flowGraphType,eventData:!0,value:O}}))),this._events.push(I)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const I of this._interactivityGraph.nodes){if("number"!==typeof I.declaration)throw T.b.Error(["No declaration found for node",I]),new Error("Error parsing nodes");const l=this._mappings[I.declaration];if(!l)throw T.b.Error(["No mapping found for node",I]),new Error("Error parsing nodes");if(l.flowGraphMapping.validation){const w=l.flowGraphMapping.validation(I,this._interactivityGraph,this._gltf);var q;if(!w.valid)throw new Error(`Error validating interactivity node ${null===(q=this._interactivityGraph.declarations)||void 0===q?void 0:q[I.declaration].op} - ${w.error}`)}const w=[];for(const q of l.flowGraphMapping.uZ){const t=this._getEmptyBlock(q,l.fullOperationName);this._parseNodeConfiguration(I,t,l.flowGraphMapping,q),w.push(t)}this._nodes.push({uZ:w,fullOperationName:l.fullOperationName})}}_getEmptyBlock(q,I){return{uniqueId:(0,Ml.d)(),className:q,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:I,metadata:{}}}_parseNodeConfiguration(q,I,l,w){const t=I.config;if(q.configuration){const I=Object.keys(q.configuration);for(const a of I){var O,c;const I=null===(O=q.configuration)||void 0===O?void 0:O[a];if(!I)throw T.b.Error(["No value found for node configuration",a]),new Error("Error parsing node configuration");const F=null===(c=l.configuration)||void 0===c?void 0:c[a];if(F&&F.el?F.el===w:0===l.uZ.indexOf(w)){const q=(null===F||void 0===F?void 0:F.name)||a;I&&"undefined"!==typeof I.value||"undefined"===typeof(null===F||void 0===F?void 0:F.defaultValue)?I.value.length>=0?t[q]={value:1===I.value.length?I.value[0]:I.value}:T.b.Warn(["Invalid value for node configuration",I]):t[q]={value:F.defaultValue},F&&F.dataTransformer&&(t[q].value=F.dataTransformer([t[q].value],this)[0])}}}}_parseNodeConnections(q){for(let R=0;R<this._nodes.length;R++){var I;const W=null===(I=this._interactivityGraph.nodes)||void 0===I?void 0:I[R];if(!W)throw T.b.Error(["No node found for interactivity node",this._nodes[R]]),new Error("Error parsing node connections");const e=this._nodes[R],i=this._mappings[W.declaration];if(!i)throw T.b.Error(["No mapping found for node",W]),new Error("Error parsing node connections");const S=W.flows||{},g=Object.keys(S).sort();for(const q of g){var l,w,t,O;const I=S[q],s=null===(l=i.flowGraphMapping.outputs)||void 0===l||null===(w=l.flows)||void 0===w?void 0:w[q],Z=(null===s||void 0===s?void 0:s.name)||q,r=this._createNewSocketConnection(Z,!0);(s&&s.el&&e.uZ.find((q=>q.className===s.el))||e.uZ[0]).signalOutputs.push(r);const x=I.node,o=this._nodes[x];if(!o)throw T.b.Error(["No node found for input node id",x]),new Error("Error parsing node connections");const d=il(o.fullOperationName);if(!d)throw T.b.Error(["No mapping found for input node",o]),new Error("Error parsing node connections");let V=null===(t=d.inputs)||void 0===t||null===(O=t.flows)||void 0===O?void 0:O[I.socket||"in"],U=!1;if(!V)for(const q in null===(c=d.inputs)||void 0===c?void 0:c.flows){var c,a,F;if(q.startsWith("[")&&q.endsWith("]"))U=!0,V=null===(a=d.inputs)||void 0===a||null===(F=a.flows)||void 0===F?void 0:F[q]}const B=V?U?V.name.replace("$1",I.socket||""):V.name:I.socket||"in",v=V&&V.el&&o.uZ.find((q=>q.className===V.el))||o.uZ[0];let k=v.signalInputs.find((q=>q.name===B));k||(k=this._createNewSocketConnection(B),v.signalInputs.push(k)),k.connectedPointIds.push(r.uniqueId),r.connectedPointIds.push(k.uniqueId)}const p=W.values||{},X=Object.keys(p);for(const I of X){var s,Z;const l=p[I];let w=null===(s=i.flowGraphMapping.inputs)||void 0===s||null===(Z=s.values)||void 0===Z?void 0:Z[I],t=!1;if(!w)for(const q in null===(r=i.flowGraphMapping.inputs)||void 0===r?void 0:r.values){var r,x,o;if(q.startsWith("[")&&q.endsWith("]"))t=!0,w=null===(x=i.flowGraphMapping.inputs)||void 0===x||null===(o=x.values)||void 0===o?void 0:o[q]}const O=w?t?w.name.replace("$1",I):w.name:I,c=this._createNewSocketConnection(O);if((w&&w.el&&e.uZ.find((q=>q.className===w.el))||e.uZ[0]).dataInputs.push(c),void 0!==l.value){const I=this._parseVariable(l,w&&w.dataTransformer);q._connectionValues[c.uniqueId]=I}else{if("undefined"===typeof l.node)throw T.b.Error(["Invalid value for value connection",l]),new Error("Error parsing node connections");{var d,V,U;const q=l.node,I=l.socket||"value",w=this._nodes[q];if(!w)throw T.b.Error(["No node found for output socket reference",l]),new Error("Error parsing node connections");const t=il(w.fullOperationName);if(!t)throw T.b.Error(["No mapping found for output socket reference",l]),new Error("Error parsing node connections");let O=null===(d=t.outputs)||void 0===d||null===(V=d.values)||void 0===V?void 0:V[I],a=!1;if(!O)for(const l in null===(B=t.outputs)||void 0===B?void 0:B.values){var B,v,k;if(l.startsWith("[")&&l.endsWith("]"))a=!0,O=null===(v=t.outputs)||void 0===v||null===(k=v.values)||void 0===k?void 0:k[l]}const F=O?a?O.name.replace("$1",I):null===(U=O)||void 0===U?void 0:U.name:I,s=O&&O.el&&w.uZ.find((q=>q.className===O.el))||w.uZ[0];let Z=s.dataOutputs.find((q=>q.name===F));Z||(Z=this._createNewSocketConnection(F,!0),s.dataOutputs.push(Z)),c.connectedPointIds.push(Z.uniqueId),Z.connectedPointIds.push(c.uniqueId)}}}if(i.flowGraphMapping.interBlockConnectors)for(const q of i.flowGraphMapping.interBlockConnectors){const I=q.input,l=q.output,w=q.isVariable;this._connectFlowGraphNodes(I,l,e.uZ[q.inputBlockIndex],e.uZ[q.outputBlockIndex],w)}if(i.flowGraphMapping.extraProcessor){var C;const I=null===(C=this._interactivityGraph.declarations)||void 0===C?void 0:C[W.declaration];if(!I)throw T.b.Error(["No declaration found for extra processor",W]),new Error("Error parsing node connections");e.uZ=i.flowGraphMapping.extraProcessor(W,I,i.flowGraphMapping,this,e.uZ,q,this._gltf)}}}_createNewSocketConnection(q,I){return{uniqueId:(0,Ml.d)(),name:q,_connectionType:I?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(q,I,l,w,t){const O=t?l.dataInputs:l.signalInputs,c=t?w.dataOutputs:w.signalOutputs,a=O.find((I=>I.name===q))||this._createNewSocketConnection(q),F=c.find((q=>q.name===I))||this._createNewSocketConnection(I,!0);O.find((I=>I.name===q))||O.push(a),c.find((q=>q.name===I))||c.push(F),a.connectedPointIds.push(F.uniqueId),F.connectedPointIds.push(a.uniqueId)}getVariableName(q){return"staticVariable_"+q}serializeToFlowGraph(){const q={uniqueId:(0,Ml.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(q);for(let I=0;I<this._staticVariables.length;I++){const l=this._staticVariables[I];q._userVariables[this.getVariableName(I)]=l}return{rightHanded:!0,allBlocks:this._nodes.reduce(((q,I)=>q.concat(I.uZ)),[]),executionContexts:[q]}}}const Ll="KHR_interactivity";class El{constructor(q){this._loader=q,this.name=Ll,this.enabled=this._loader.isExtensionUsed(Ll),this._pathConverter=(0,j.i)(this._loader.rc),q._skipStartAnimationStep=!0;const I=q.babylonScene;I&&function(q){(0,j.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!q.activeCamera)return new t.Quaternion(NaN,NaN,NaN,NaN);const I=t.Quaternion.FromRotationMatrix(q.activeCamera.getWorldMatrix()).normalize();return q.useRightHandedSystem||(I.w*=-1,I.x*=-1),I},type:"Quaternion",getTarget:()=>q.activeCamera}),(0,j.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!q.activeCamera)return new t.dI(NaN,NaN,NaN);const I=q.activeCamera.getWorldMatrix().getTranslation();return q.useRightHandedSystem||(I.x*=-1),I},type:"dI",getTarget:()=>q.activeCamera}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:q=>{var I;return(null===(I=q._babylonAnimationGroup)||void 0===I?void 0:I.isPlaying)??!1},type:"boolean",getTarget:q=>q._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:q=>{var I;return((null===(I=q._babylonAnimationGroup)||void 0===I?void 0:I.from)??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:q=>{var I;return((null===(I=q._babylonAnimationGroup)||void 0===I?void 0:I.to)??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:q=>{var I;return((null===(I=q._babylonAnimationGroup)||void 0===I?void 0:I.getCurrentFrame())??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:q=>{var I;return((null===(I=q._babylonAnimationGroup)||void 0===I?void 0:I.getCurrentFrame())??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup})}(I)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var q;if(!this._loader.babylonScene||!this._pathConverter)return;const I=this._loader.babylonScene,l=null===(q=this._loader.rc.extensions)||void 0===q?void 0:q.KHR_interactivity;if(!l)return;const w=new dl.c({VI:I});w.dispatchEventsSynchronously=!1;const t=l.graphs.map((q=>new fl(q,this._loader.rc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(t.map((async q=>await Rl(q,{coordinator:w,pathConverter:this._pathConverter})))),w.start()}}var jl;jl=async()=>(await Promise.resolve().then(l.bind(l,14491))).FlowGraphGLTFDataProvider,Tl[`${Ll}/${"FlowGraphGLTFDataProvider"}`]=jl,E(Ll),L(Ll,!0,(q=>new El(q)));const hl="KHR_node_visibility";(0,j.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:q=>{const I=q._babylonTransformNode;return!I||void 0===I.isVisible||I.isVisible},set:(q,I)=>{var l,w;null===(l=I._primitiveBabylonMeshes)||void 0===l||l.forEach((q=>{q.inheritVisibility=!0})),I._babylonTransformNode&&(I._babylonTransformNode.isVisible=q),null===(w=I._primitiveBabylonMeshes)||void 0===w||w.forEach((I=>{I.isVisible=q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class ul{constructor(q){this.name=hl,this._loader=q,this.enabled=q.isExtensionUsed(hl)}async onReady(){var q;null===(q=this._loader.rc.nodes)||void 0===q||q.forEach((q=>{var I,l,w,t;(null===(I=q._primitiveBabylonMeshes)||void 0===I||I.forEach((q=>{q.inheritVisibility=!0})),null!==(l=q.extensions)&&void 0!==l&&l.KHR_node_visibility)&&(!1===(null===(w=q.extensions)||void 0===w?void 0:w.KHR_node_visibility.visible)&&(q._babylonTransformNode&&(q._babylonTransformNode.isVisible=!1),null===(t=q._primitiveBabylonMeshes)||void 0===t||t.forEach((q=>{q.isVisible=!1}))))}))}dispose(){this._loader=null}}E(hl),L(hl,!0,(q=>new ul(q)));const Pl="KHR_node_selectability";gl("event/onSelect",Pl,{uZ:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",el:"FlowGraphGetVariableBlock",dataTransformer:q=>["pickedMesh_"+q[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",el:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,I,l,w,t,O,c){var a,F,s,Z,r,x;const o=t[t.length-1];o.config=o.config||{},o.config.glTF=c;const d=null===(a=q.configuration)||void 0===a||null===(F=a.nodeIndex)||void 0===F?void 0:F.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const T="pickedMesh_"+d;return t[1].config.variable=T,O._userVariables[T]={className:"Mesh",id:null===c||void 0===c||null===(s=c.nodes)||void 0===s||null===(Z=s[d]._babylonTransformNode)||void 0===Z?void 0:Z.id,uniqueId:null===c||void 0===c||null===(r=c.nodes)||void 0===r||null===(x=r[d]._babylonTransformNode)||void 0===x?void 0:x.uniqueId},t}}),(0,j.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:q=>{const I=q._babylonTransformNode;return!I||void 0===I.ss||I.ss},set:(q,I)=>{var l;null===(l=I._primitiveBabylonMeshes)||void 0===l||l.forEach((I=>{I.ss=q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"ss"],type:"boolean"});class mw{constructor(q){this.name=Pl,this._loader=q,this.enabled=q.isExtensionUsed(Pl)}async onReady(){var q;null===(q=this._loader.rc.nodes)||void 0===q||q.forEach((q=>{var I,l,w;null!==(I=q.extensions)&&void 0!==I&&I.KHR_node_selectability&&!1===(null===(l=q.extensions)||void 0===l?void 0:l.KHR_node_selectability.selectable)&&(null===(w=q._babylonTransformNode)||void 0===w||w.getChildMeshes().forEach((q=>{q.ss=!1})))}))}dispose(){this._loader=null}}E(Pl),L(Pl,!0,(q=>new mw(q)));const Yl="KHR_node_hoverability",yl="targetMeshPointerOver_";gl("event/onHoverIn",Yl,{uZ:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",el:"FlowGraphGetVariableBlock",dataTransformer:q=>[yl+q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",el:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,I,l,w,t,O,c){var a,F,s,Z,r,x;const o=t[t.length-1];o.config=o.config||{},o.config.glTF=c;const d=null===(a=q.configuration)||void 0===a||null===(F=a.nodeIndex)||void 0===F?void 0:F.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const T=yl+d;return t[1].config.variable=T,O._userVariables[T]={className:"Mesh",id:null===c||void 0===c||null===(s=c.nodes)||void 0===s||null===(Z=s[d]._babylonTransformNode)||void 0===Z?void 0:Z.id,uniqueId:null===c||void 0===c||null===(r=c.nodes)||void 0===r||null===(x=r[d]._babylonTransformNode)||void 0===x?void 0:x.uniqueId},t}});const Gl="targetMeshPointerOut_";gl("event/onHoverOut",Yl,{uZ:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",el:"FlowGraphGetVariableBlock",dataTransformer:q=>[Gl+q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",el:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,I,l,w,t,O,c){var a,F,s,Z,r,x;const o=t[t.length-1];o.config=o.config||{},o.config.glTF=c;const d=null===(a=q.configuration)||void 0===a||null===(F=a.nodeIndex)||void 0===F?void 0:F.value[0];if(void 0===d||"number"!==typeof d)throw new Error("nodeIndex not found in configuration");const T=Gl+d;return t[1].config.variable=T,O._userVariables[T]={className:"Mesh",id:null===c||void 0===c||null===(s=c.nodes)||void 0===s||null===(Z=s[d]._babylonTransformNode)||void 0===Z?void 0:Z.id,uniqueId:null===c||void 0===c||null===(r=c.nodes)||void 0===r||null===(x=r[d]._babylonTransformNode)||void 0===x?void 0:x.uniqueId},t}}),(0,j.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:q=>{const I=q._babylonTransformNode;return!I||void 0===I.pointerOverDisableMeshTesting||I.pointerOverDisableMeshTesting},set:(q,I)=>{var l;null===(l=I._primitiveBabylonMeshes)||void 0===l||l.forEach((I=>{I.pointerOverDisableMeshTesting=!q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Nl{constructor(q){this.name=Yl,this._loader=q,this.enabled=q.isExtensionUsed(Yl)}async onReady(){var q;null===(q=this._loader.rc.nodes)||void 0===q||q.forEach((q=>{var I,l,w;null!==(I=q.extensions)&&void 0!==I&&I.KHR_node_hoverability&&!1===(null===(l=q.extensions)||void 0===l?void 0:l.KHR_node_hoverability.hoverable)&&(null===(w=q._babylonTransformNode)||void 0===w||w.getChildMeshes().forEach((q=>{q.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}E(Yl),L(Yl,!0,(q=>new Nl(q)));const Jl="ExtrasAsMetadata";class zl{_assignExtras(q,I){if(I.extras&&Object.keys(I.extras).length>0){const l=q.metadata=q.metadata||{};(l.rc=l.rc||{}).extras=I.extras}}constructor(q){this.name=Jl,this.enabled=!0,this._loader=q}dispose(){this._loader=null}loadNodeAsync(q,I,l){return this._loader.loadNodeAsync(q,I,(q=>{this._assignExtras(q,I),l(q)}))}loadCameraAsync(q,I,l){return this._loader.loadCameraAsync(q,I,(q=>{this._assignExtras(q,I),l(q)}))}createMaterial(q,I,l){const w=this._loader.createMaterial(q,I,l);return this._assignExtras(w,I),w}}E(Jl),L(Jl,!1,(q=>new zl(q)));l(14491)},14379:(q,I,l)=>{"use strict";l.d(I,{d:()=>D,g:()=>i,k:()=>e,l:()=>S});var w=l(12573),t=l(12564),O=l(14011),c=l(13184),a=l(13166),F=l(13173),s=l(12591),Z=l(12612),r=l(13180),x=l(13257),o=l(13186),d=l(12786);class T{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Kx=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.To=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(q){this._environmentTexture=q}getNodes(){let q=[];q=q.concat(this.meshes),q=q.concat(this.lights),q=q.concat(this.cameras),q=q.concat(this.transformNodes);for(const I of this.skeletons)q=q.concat(I.bones);return q}}class V extends T{}class U{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const q=this.rootNodes;for(const w of q)w.dispose();q.length=0;const I=this.skeletons;for(const w of I)w.dispose();I.length=0;const l=this.animationGroups;for(const w of l)w.dispose();l.length=0}}class B extends T{constructor(q){super(),this._wasAddedToScene=!1,(q=q||Z.e.LastCreatedScene)&&(this.VI=q,this.proceduralTextures=[],q.tc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=q.getEngine().onContextRestoredObservable.add((()=>{for(const q of this.geometries)q._rebuild();for(const q of this.meshes)q._rebuild();for(const q of this.Kx)q.rebuild();for(const q of this.textures)q._rebuild()})))}_topologicalSort(q){const I=new Map;for(const c of q)I.set(c.uniqueId,c);const l={dependsOn:new Map,dependedBy:new Map};for(const c of q){const q=c.uniqueId;l.dependsOn.set(q,new Set),l.dependedBy.set(q,new Set)}for(const c of q){const q=c.uniqueId,w=l.dependsOn.get(q);if(c instanceof r.e){const t=c.sourceMesh;I.has(t.uniqueId)&&(w.add(t.uniqueId),l.dependedBy.get(t.uniqueId).add(q))}const t=l.dependedBy.get(q);for(const O of c.getDescendants()){const w=O.uniqueId;if(I.has(w)){t.add(w);l.dependsOn.get(w).add(q)}}}const w=[],t=[];for(const c of q){const q=c.uniqueId;0===l.dependsOn.get(q).size&&(t.push(c),I.delete(q))}const O=t;for(;O.length>0;){const q=O.shift();w.push(q);const t=l.dependedBy.get(q.uniqueId);for(const w of Array.from(t.values())){const t=l.dependsOn.get(w);t.delete(q.uniqueId),0===t.size&&I.get(w)&&(O.push(I.get(w)),I.delete(w))}}return I.size>0&&(s.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),I.forEach((q=>{s.b.Error(q.name)}))),w}_addNodeAndDescendantsToList(q,I,l,w){if(l&&(!w||w(l))&&!I.has(l.uniqueId)){q.push(l),I.add(l.uniqueId);for(const t of l.getDescendants(!0))this._addNodeAndDescendantsToList(q,I,t,w)}}_isNodeInContainer(q){return q instanceof F.b&&-1!==this.meshes.indexOf(q)||(q instanceof a.d&&-1!==this.transformNodes.indexOf(q)||(q instanceof x.d&&-1!==this.lights.indexOf(q)||q instanceof o.d&&-1!==this.cameras.indexOf(q)))}_isValidHierarchy(){for(const q of this.meshes)if(q.parent&&!this._isNodeInContainer(q.parent))return s.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.transformNodes)if(q.parent&&!this._isNodeInContainer(q.parent))return s.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.lights)if(q.parent&&!this._isNodeInContainer(q.parent))return s.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.cameras)if(q.parent&&!this._isNodeInContainer(q.parent))return s.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||t.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const w={},O={},a=new U,F=[],s=[],Z={doNotInstantiate:!0,...l},r=[],x=new Set;for(const t of this.transformNodes)null===t.parent&&this._addNodeAndDescendantsToList(r,x,t,Z.predicate);for(const t of this.meshes)null===t.parent&&this._addNodeAndDescendantsToList(r,x,t,Z.predicate);const o=this._topologicalSort(r),d=(l,t)=>{if(((I,l)=>{if(w[I.uniqueId]=l.uniqueId,O[l.uniqueId]=l,q&&(l.name=q(I.name)),l instanceof c.c){const q=l;if(q.morphTargetManager){const l=I.morphTargetManager;q.morphTargetManager=l.clone();for(let I=0;I<l.numTargets;I++){const t=l.getTarget(I),c=q.morphTargetManager.getTarget(I);w[t.uniqueId]=c.uniqueId,O[c.uniqueId]=c}}}})(l,t),l.parent){const q=w[l.parent.uniqueId],I=O[q];t.parent=I||l.parent}if(t.position&&l.position&&t.position.t(l.position),t.rotationQuaternion&&l.rotationQuaternion&&t.rotationQuaternion.t(l.rotationQuaternion),t.rotation&&l.rotation&&t.rotation.t(l.rotation),t.Xc&&l.Xc&&t.Xc.t(l.Xc),t.material){const c=t;if(c.material)if(I){const I=l.material;if(-1===s.indexOf(I)){let l=I.clone(q?q(I.name):"Clone of "+I.name);if(s.push(I),w[I.uniqueId]=l.uniqueId,O[l.uniqueId]=l,"MultiMaterial"===I.getClassName()){const t=I;for(const I of t.Mc)I&&(l=I.clone(q?q(I.name):"Clone of "+I.name),s.push(I),w[I.uniqueId]=l.uniqueId,O[l.uniqueId]=l);t.Mc=t.Mc.map((q=>q&&O[w[q.uniqueId]]))}}"InstancedMesh"!==c.getClassName()&&(c.material=O[w[I.uniqueId]])}else"MultiMaterial"===c.material.getClassName()?-1===this.VI.multiMaterials.indexOf(c.material)&&this.VI.addMultiMaterial(c.material):-1===this.VI.materials.indexOf(c.material)&&this.VI.addMaterial(c.material)}null===t.parent&&a.rootNodes.push(t)};for(const t of o)if("InstancedMesh"===t.getClassName()){const q=t,I=q.sourceMesh,l=w[I.uniqueId];d(q,("number"===typeof l?O[l]:I).createInstance(q.name))}else{let q=!0;"Pc"===t.getClassName()||"Node"===t.getClassName()||t.skeleton||!t.getTotalVertices||0===t.getTotalVertices()?q=!1:Z.doNotInstantiate&&(q="function"===typeof Z.doNotInstantiate?!Z.doNotInstantiate(t):!Z.doNotInstantiate);const I=q?t.createInstance(`instance of ${t.name}`):t.clone(`Clone of ${t.name}`,null,!0);if(!I)throw new Error(`Could not clone or instantiate node on Asset Container ${t.name}`);d(t,I)}for(const t of this.skeletons){if(Z.predicate&&!Z.predicate(t))continue;const I=t.clone(q?q(t.name):"Clone of "+t.name);for(const q of this.meshes)if(q.skeleton===t&&!q.isAnInstance){const l=O[w[q.uniqueId]];if(!l||l.isAnInstance)continue;if(l.skeleton=I,-1!==F.indexOf(I))continue;F.push(I);for(const q of I.bones)q._linkedTransformNode&&(q._linkedTransformNode=O[w[q._linkedTransformNode.uniqueId]])}a.skeletons.push(I)}for(const t of this.animationGroups){if(Z.predicate&&!Z.predicate(t))continue;const I=t.clone(q?q(t.name):"Clone of "+t.name,(q=>O[w[q.uniqueId]]||q));a.animationGroups.push(I)}return a}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||t.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.VI.environmentTexture=this.environmentTexture);for(const q of this.VI._serializableComponents)q.addFromContainer(this);this.VI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const I=[];for(const l of this.cameras)q&&!q(l)||(this.VI.addCamera(l),I.push(l));for(const l of this.lights)q&&!q(l)||(this.VI.addLight(l),I.push(l));for(const l of this.meshes)q&&!q(l)||(this.VI.gZ(l),I.push(l));for(const l of this.skeletons)q&&!q(l)||this.VI.addSkeleton(l);for(const l of this.animations)q&&!q(l)||this.VI.addAnimation(l);for(const l of this.animationGroups)q&&!q(l)||this.VI.addAnimationGroup(l);for(const l of this.multiMaterials)q&&!q(l)||this.VI.addMultiMaterial(l);for(const l of this.materials)q&&!q(l)||this.VI.addMaterial(l);for(const l of this.morphTargetManagers)q&&!q(l)||this.VI.addMorphTargetManager(l);for(const l of this.geometries)q&&!q(l)||this.VI.addGeometry(l);for(const l of this.transformNodes)q&&!q(l)||(this.VI.addTransformNode(l),I.push(l));for(const l of this.actionManagers)q&&!q(l)||this.VI.addActionManager(l);for(const l of this.textures)q&&!q(l)||this.VI.addTexture(l);for(const l of this.reflectionProbes)q&&!q(l)||this.VI.addReflectionProbe(l);for(const l of I)l.parent&&-1===this.VI.getNodes().indexOf(l.parent)&&(l.setParent?l.setParent(null):l.parent=null)}removeAllFromScene(){this._isValidHierarchy()||t.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.VI.environmentTexture&&(this.VI.environmentTexture=null);for(const q of this.VI._serializableComponents)q.removeFromContainer(this)}removeFromScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const I of this.cameras)q&&!q(I)||this.VI.removeCamera(I);for(const I of this.lights)q&&!q(I)||this.VI.removeLight(I);for(const I of this.meshes)q&&!q(I)||this.VI.SZ(I,!0);for(const I of this.skeletons)q&&!q(I)||this.VI.removeSkeleton(I);for(const I of this.animations)q&&!q(I)||this.VI.removeAnimation(I);for(const I of this.animationGroups)q&&!q(I)||this.VI.removeAnimationGroup(I);for(const I of this.multiMaterials)q&&!q(I)||this.VI.removeMultiMaterial(I);for(const I of this.materials)q&&!q(I)||this.VI.removeMaterial(I);for(const I of this.morphTargetManagers)q&&!q(I)||this.VI.removeMorphTargetManager(I);for(const I of this.geometries)q&&!q(I)||this.VI.removeGeometry(I);for(const I of this.transformNodes)q&&!q(I)||this.VI.removeTransformNode(I);for(const I of this.actionManagers)q&&!q(I)||this.VI.removeActionManager(I);for(const I of this.textures)q&&!q(I)||this.VI.removeTexture(I);for(const I of this.reflectionProbes)q&&!q(I)||this.VI.removeReflectionProbe(I)}dispose(){const q=this.cameras.slice(0);for(const o of q)o.dispose();this.cameras.length=0;const I=this.lights.slice(0);for(const o of I)o.dispose();this.lights.length=0;const l=this.meshes.slice(0);for(const o of l)o.dispose();this.meshes.length=0;const w=this.skeletons.slice(0);for(const o of w)o.dispose();this.skeletons.length=0;const t=this.animationGroups.slice(0);for(const o of t)o.dispose();this.animationGroups.length=0;const O=this.multiMaterials.slice(0);for(const o of O)o.dispose();this.multiMaterials.length=0;const c=this.materials.slice(0);for(const o of c)o.dispose();this.materials.length=0;const a=this.geometries.slice(0);for(const o of a)o.dispose();this.geometries.length=0;const F=this.transformNodes.slice(0);for(const o of F)o.dispose();this.transformNodes.length=0;const s=this.actionManagers.slice(0);for(const o of s)o.dispose();this.actionManagers.length=0;const Z=this.textures.slice(0);for(const o of Z)o.dispose();this.textures.length=0;const r=this.reflectionProbes.slice(0);for(const o of r)o.dispose();this.reflectionProbes.length=0;const x=this.morphTargetManagers.slice(0);for(const o of x)o.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const o of this.VI._serializableComponents)o.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.VI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(q,I,l){if(q&&I)for(const w of q){let q=!0;if(l)for(const I of l)if(w===I){q=!1;break}q&&(I.push(w),w._parentContainer=this)}}moveAllFromScene(q){this._wasAddedToScene=!1,void 0===q&&(q=new V);for(const I in this)Object.prototype.hasOwnProperty.call(this,I)&&(this[I]=this[I]||("_environmentTexture"===I?null:[]),this._moveAssets(this.VI[I],this[I],q[I]));this.environmentTexture=this.VI.environmentTexture,this.removeAllFromScene()}createRootMesh(){const q=new c.c("assetContainerRootMesh",this.VI);for(const I of this.meshes)I.parent||q.addChild(I);return this.meshes.unshift(q),q}mergeAnimationsTo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.e.LastCreatedScene,I=arguments.length>1?arguments[1]:void 0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!q)return s.b.Error("No scene available to merge animations to"),[];const w=l||(I=>{let l=null;const w=I.animations.length?I.animations[0].targetProperty:"",t=I.name.split(".").join("").split("_primitive")[0];switch(w){case"position":case"rotationQuaternion":l=q.getTransformNodeByName(I.name)||q.getTransformNodeByName(t);break;case"influence":l=q.getMorphTargetByName(I.name)||q.getMorphTargetByName(t);break;default:l=q.getNodeByName(I.name)||q.getNodeByName(t)}return l}),t=this.getNodes();for(const a of t){const q=w(a);if(null!==q){for(const I of a.animations){const l=q.animations.filter((q=>q.targetProperty===I.targetProperty));for(const I of l){const l=q.animations.indexOf(I,0);l>-1&&q.animations.splice(l,1)}}q.animations=q.animations.concat(a.animations)}}const O=[],c=this.animationGroups.slice();for(const a of c){O.push(a.clone(a.name,w));for(const q of a.animatables)q.stop()}for(const a of I){const I=w(a.target);I&&(q.beginAnimation(I,a.fromFrame,a.toFrame,a.loopAnimation,a.speedRatio,a.onAnimationEnd?a.onAnimationEnd:void 0,void 0,!0,void 0,a.onAnimationLoop?a.onAnimationLoop:void 0),q.stopAnimation(a.target))}return O}populateRootNodes(){this.rootNodes.length=0;for(const q of this.meshes)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.transformNodes)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.lights)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.cameras)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q)}addAllAssetsToContainer(q){if(!q)return;const I=[],l=new Set;for(I.push(q);I.length>0;){const q=I.pop();if(q instanceof c.c?(q.Wc&&-1===this.geometries.indexOf(q.Wc)&&this.geometries.push(q.Wc),this.meshes.push(q)):q instanceof r.e?this.meshes.push(q):q instanceof a.d?this.transformNodes.push(q):q instanceof x.d?this.lights.push(q):q instanceof o.d&&this.cameras.push(q),q instanceof F.b){if(q.material&&-1===this.materials.indexOf(q.material)){this.materials.push(q.material);for(const I of q.material.getActiveTextures())-1===this.textures.indexOf(I)&&this.textures.push(I)}q.skeleton&&-1===this.skeletons.indexOf(q.skeleton)&&this.skeletons.push(q.skeleton),q.morphTargetManager&&-1===this.morphTargetManagers.indexOf(q.morphTargetManager)&&this.morphTargetManagers.push(q.morphTargetManager)}for(const w of q.getChildren())l.has(w)||I.push(w);l.add(q)}this.populateRootNodes()}_getByTags(q,I,l){if(void 0===I)return q;const w=[];for(const t in q){const O=q[t];d.e&&d.e.MatchesQuery(O,I)&&(!l||l(O))&&w.push(O)}return w}getMeshesByTags(q,I){return this._getByTags(this.meshes,q,I)}getCamerasByTags(q,I){return this._getByTags(this.cameras,q,I)}getLightsByTags(q,I){return this._getByTags(this.lights,q,I)}getMaterialsByTags(q,I){return this._getByTags(this.materials,q,I).concat(this._getByTags(this.multiMaterials,q,I))}getTransformNodesByTags(q,I){return this._getByTags(this.transformNodes,q,I)}}var v=l(12625);class k{constructor(q){this.byteOffset=0,this.buffer=q}async loadAsync(q){const I=await this.buffer.readAsync(this.byteOffset,q);this._dataView=new DataView(I.buffer,I.byteOffset,I.byteLength),this._dataByteOffset=0}readUint32(){const q=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,q}readUint8Array(q){const I=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,q);return this._dataByteOffset+=q,this.byteOffset+=q,I}readString(q){return(0,v.g)(this.readUint8Array(q))}skipBytes(q){this._dataByteOffset+=q,this.byteOffset+=q}}var C=l(14381);const R="Z2xURg",W={name:"rc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:q=>-1!==q.indexOf("asset")&&-1!==q.indexOf("version")||q.startsWith("data:base64,"+R)||q.startsWith("data:;base64,"+R)||q.startsWith("data:application/octet-stream;base64,"+R)||q.startsWith("data:model/gltf-binary;base64,"+R)};var e,i,S,g=l(12615),p=l(12619);function X(q,I,l){try{return Promise.resolve(new Uint8Array(q,I,l))}catch(w){return Promise.reject(w)}}!function(q){q[q.AUTO=0]="AUTO",q[q.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(e||(e={})),function(q){q[q.NONE=0]="NONE",q[q.FIRST=1]="FIRST",q[q.ALL=2]="ALL"}(i||(i={})),function(q){q[q.LOADING=0]="LOADING",q[q.READY=1]="READY",q[q.COMPLETE=2]="COMPLETE"}(S||(S={}));class K{constructor(){this.coordinateSystemMode=e.AUTO,this.animationStartMode=i.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=q=>Promise.resolve(q),this.extensionOptions={}}t(q){q&&(this.onParsed=q.onParsed,this.coordinateSystemMode=q.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=q.animationStartMode??this.animationStartMode,this.loadNodeAnimations=q.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=q.loadSkins??this.loadSkins,this.loadMorphTargets=q.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=q.compileMaterials??this.compileMaterials,this.useClipPlane=q.useClipPlane??this.useClipPlane,this.compileShadowGenerators=q.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=q.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=q.useRangeRequests??this.useRangeRequests,this.createInstances=q.createInstances??this.createInstances,this.alwaysComputeBoundingBox=q.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=q.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=q.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=q.skipMaterials??this.skipMaterials,this.useSRGBBuffers=q.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=q.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=q.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=q.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=q.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=q.customRootNode,this.onMeshLoaded=q.onMeshLoaded,this.onSkinLoaded=q.onSkinLoaded,this.onTextureLoaded=q.onTextureLoaded,this.onMaterialLoaded=q.onMaterialLoaded,this.onCameraLoaded=q.onCameraLoaded,this.extensionOptions=q.extensionOptions??this.extensionOptions)}}class D extends K{constructor(q){super(),this.onParsedObservable=new w.d,this.onMeshLoadedObservable=new w.d,this.onSkinLoadedObservable=new w.d,this.onTextureLoadedObservable=new w.d,this.onMaterialLoadedObservable=new w.d,this.onCameraLoadedObservable=new w.d,this.onCompleteObservable=new w.d,this.onErrorObservable=new w.d,this.tc=new w.d,this.onExtensionLoadedObservable=new w.d,this.validate=!1,this.onValidatedObservable=new w.d,this._loader=null,this._state=null,this._requests=new Array,this.name=W.name,this.extensions=W.extensions,this.onLoaderStateChangedObservable=new w.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.t(q)}set onParsed(q){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),q&&(this._onParsedObserver=this.onParsedObservable.add(q))}set onMeshLoaded(q){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),q&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(q))}set onSkinLoaded(q){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),q&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((I=>q(I.node,I.skinnedNode))))}set onTextureLoaded(q){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),q&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(q))}set onMaterialLoaded(q){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),q&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(q))}set onCameraLoaded(q){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),q&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(q))}set onComplete(q){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(q)}set onError(q){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(q)}set onDispose(q){this._onDisposeObserver&&this.tc.remove(this._onDisposeObserver),this._onDisposeObserver=this.tc.add(q)}set onExtensionLoaded(q){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(q)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(q){this._loggingEnabled!==q&&(this._loggingEnabled=q,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(q){this._capturePerformanceCounters!==q&&(this._capturePerformanceCounters=q,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(q){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(q)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const q of this._requests)q.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=q=>Promise.resolve(q),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.tc.notifyObservers(void 0),this.tc.clear()}loadFile(q,I,l,O,c,a,F,Z){if(ArrayBuffer.isView(I))return this._loadBinary(q,I,l,O,F,Z),null;this._progressCallback=c;const r=I.name||t.Tools.GetFilename(I);if(a){if(this.useRangeRequests){this.validate&&s.b.Warn("glTF validation is not supported when range requests are enabled");const l={abort:()=>{},onCompleteObservable:new w.d},t={readAsync:(l,w)=>new Promise(((t,O)=>{this._loadFile(q,I,(q=>{t(new Uint8Array(q))}),!0,(q=>{O(q)}),(q=>{q.setRequestHeader("Range",`bytes=${l}-${l+w-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new k(t)).then((q=>{l.onCompleteObservable.notifyObservers(l),O(q)}),F?q=>F(void 0,q):void 0),l}return this._loadFile(q,I,(I=>{this._validate(q,new Uint8Array(I,0,I.byteLength),l,r),this._unpackBinaryAsync(new k({readAsync:(q,l)=>X(I,q,l),byteLength:I.byteLength})).then((q=>{O(q)}),F?q=>F(void 0,q):void 0)}),!0,F)}return this._loadFile(q,I,(I=>{try{this._validate(q,I,l,r),O({json:this._parseJson(I)})}catch{F&&F()}}),!1,F)}_loadBinary(q,I,l,w,t,O){this._validate(q,new Uint8Array(I.buffer,I.byteOffset,I.byteLength),l,O),this._unpackBinaryAsync(new k({readAsync:(q,l)=>function(q,I,l){try{if(I<0||I>=q.byteLength)throw new RangeError("Offset is out of range.");if(I+l>q.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(q.buffer,q.byteOffset+I,l))}catch(w){return Promise.reject(w)}}(I,q,l),byteLength:I.byteLength})).then((q=>{w(q)}),t?q=>t(void 0,q):void 0)}importMeshAsync(q,I,l,w,t,O){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(l),this.onParsedObservable.clear(),this._log(`Loading ${O||""}`),this._loader=this._getLoader(l),this._loader.importMeshAsync(q,I,null,l,w,t,O))))}loadAsync(q,I,l,w,t){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(I),this._loader.loadAsync(q,I,l,w,t))))}loadAssetContainerAsync(q,I,l,w,t){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(I);const O=new B(q),c=[];this.onMaterialLoadedObservable.add((q=>{c.push(q)}));const a=[];this.onTextureLoadedObservable.add((q=>{a.push(q)}));const F=[];this.onCameraLoadedObservable.add((q=>{F.push(q)}));const s=[];return this.onMeshLoadedObservable.add((q=>{q.morphTargetManager&&s.push(q.morphTargetManager)})),this._loader.importMeshAsync(null,q,O,I,l,w,t).then((q=>(Array.prototype.push.apply(O.geometries,q.geometries),Array.prototype.push.apply(O.meshes,q.meshes),Array.prototype.push.apply(O.Kx,q.Kx),Array.prototype.push.apply(O.skeletons,q.skeletons),Array.prototype.push.apply(O.animationGroups,q.animationGroups),Array.prototype.push.apply(O.materials,c),Array.prototype.push.apply(O.textures,a),Array.prototype.push.apply(O.lights,q.lights),Array.prototype.push.apply(O.transformNodes,q.transformNodes),Array.prototype.push.apply(O.cameras,F),Array.prototype.push.apply(O.morphTargetManagers,s),O)))}))}canDirectLoad(q){return W.canDirectLoad(q)}directLoad(q,I){if(I.startsWith("base64,"+R)||I.startsWith(";base64,"+R)||I.startsWith("application/octet-stream;base64,"+R)||I.startsWith("model/gltf-binary;base64,"+R)){const l=(0,g.e)(I);return this._validate(q,new Uint8Array(l,0,l.byteLength)),this._unpackBinaryAsync(new k({readAsync:(q,I)=>X(l,q,I),byteLength:l.byteLength}))}return this._validate(q,I),Promise.resolve({json:this._parseJson(I)})}createPlugin(q){return new D(q[W.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((q,I)=>{this.onCompleteObservable.addOnce((()=>{q()})),this.onErrorObservable.addOnce((q=>{I(q)}))}))}_setState(q){this._state!==q&&(this._state=q,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(S[this._state]))}_loadFile(q,I,l,w,t,O){const c=q._loadFile(I,l,(q=>{this._onProgress(q,c)}),!0,w,t,O);return c.onCompleteObservable.add((()=>{c._lengthComputable=!0,c._total=c._loaded})),this._requests.push(c),c}_onProgress(q,I){if(!this._progressCallback)return;I._lengthComputable=q.lengthComputable,I._loaded=q.loaded,I._total=q.total;let l=!0,w=0,t=0;for(const O of this._requests){if(void 0===O._lengthComputable||void 0===O._loaded||void 0===O._total)return;l=l&&O._lengthComputable,w+=O._loaded,t+=O._total}this._progressCallback({lengthComputable:l,loaded:w,total:l?t:0})}_validate(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),C.e.ValidateAsync(I,l,w,(I=>this.preprocessUrlAsync(l+I).then((I=>q._loadFileAsync(I,void 0,!0,!0).then((q=>new Uint8Array(q,0,q.byteLength))))))).then((q=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(q),this.onValidatedObservable.clear()}),(q=>{this._endPerformanceCounter("Validate JSON"),t.Tools.Warn(`Failed to validate: ${q.message}`),this.onValidatedObservable.clear()})))}_getLoader(q){const I=q.json.asset||{};this._log(`Asset version: ${I.version}`),I.minVersion&&this._log(`Asset minimum version: ${I.minVersion}`),I.generator&&this._log(`Asset generator: ${I.generator}`);const l=D._parseVersion(I.version);if(!l)throw new Error("Invalid version: "+I.version);if(void 0!==I.minVersion){const q=D._parseVersion(I.minVersion);if(!q)throw new Error("Invalid minimum version: "+I.minVersion);if(D._compareVersion(q,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+I.minVersion)}const w={1:D._CreateGLTF1Loader,2:D._CreateGLTF2Loader}[l.major];if(!w)throw new Error("Unsupported version: "+I.version);return w(this)}_parseJson(q){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${q.length}`);const I=JSON.parse(q);return this._endPerformanceCounter("Parse JSON"),I}_unpackBinaryAsync(q){return this._startPerformanceCounter("Unpack Binary"),q.loadAsync(20).then((()=>{const I=q.readUint32();if(1179937895!==I)throw new p.f("Unexpected magic: "+I,p.e.GLTFLoaderUnexpectedMagicError);const l=q.readUint32();this.loggingEnabled&&this._log(`Binary version: ${l}`);const w=q.readUint32();let t;switch(this.useRangeRequests||w===q.buffer.byteLength||s.b.Warn(`Length in header does not match actual data length: ${w} != ${q.buffer.byteLength}`),l){case 1:t=this._unpackBinaryV1Async(q,w);break;case 2:t=this._unpackBinaryV2Async(q,w);break;default:throw new Error("Unsupported version: "+l)}return this._endPerformanceCounter("Unpack Binary"),t}))}_unpackBinaryV1Async(q,I){const l=q.readUint32(),w=q.readUint32();if(0!==w)throw new Error(`Unexpected content format: ${w}`);const t=I-q.byteOffset,O={json:this._parseJson(q.readString(l)),bin:null};if(0!==t){const I=q.byteOffset;O.bin={readAsync:(l,w)=>q.buffer.readAsync(I+l,w),byteLength:t}}return Promise.resolve(O)}_unpackBinaryV2Async(q,I){const l=1313821514,w=5130562,t=q.readUint32();if(q.readUint32()!==l)throw new Error("First chunk format is not JSON");return q.byteOffset+t===I?q.loadAsync(t).then((()=>({json:this._parseJson(q.readString(t)),bin:null}))):q.loadAsync(t+8).then((()=>{const O={json:this._parseJson(q.readString(t)),bin:null},c=()=>{const t=q.readUint32();switch(q.readUint32()){case l:throw new Error("Unexpected JSON chunk");case w:{const I=q.byteOffset;O.bin={readAsync:(l,w)=>q.buffer.readAsync(I+l,w),byteLength:t},q.skipBytes(t);break}default:q.skipBytes(t)}return q.byteOffset!==I?q.loadAsync(8).then(c):Promise.resolve(O)};return c()}))}static _parseVersion(q){if("1.0"===q||"1.0.1"===q)return{major:1,minor:0};const I=(q+"").match(/^(\d+)\.(\d+)/);return I?{major:parseInt(I[1]),minor:parseInt(I[2])}:null}static _compareVersion(q,I){return q.major>I.major?1:q.major<I.major?-1:q.minor>I.minor?1:q.minor<I.minor?-1:0}_logOpen(q){this._log(q),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(q){const I=D._logSpaces.substring(0,2*this._logIndentLevel);s.b.Log(`${I}${q}`)}_logDisabled(q){}_startPerformanceCounterEnabled(q){t.Tools.StartPerformanceCounter(q)}_startPerformanceCounterDisabled(q){}_endPerformanceCounterEnabled(q){t.Tools.EndPerformanceCounter(q)}_endPerformanceCounterDisabled(q){}}D.IncrementalLoading=!0,D.HomogeneousCoordinates=!1,D._logSpaces="                                ",(0,O.b)(new D)},14381:(q,I,l)=>{"use strict";l.d(I,{e:()=>c});var w=l(12564);function t(q,I,l,w){const t={externalResourceFunction:w};return l&&(t.uri="file:"===I?l:I+l),ArrayBuffer.isView(q)?GLTFValidator.validateBytes(q,t):GLTFValidator.validateString(q,t)}function O(){const q=[];onmessage=I=>{const l=I.data;switch(l.id){case"init":importScripts(l.url);break;case"validate":t(l.data,l.rootUrl,l.fileName,(I=>new Promise(((l,w)=>{const t=q.length;q.push({resolve:l,reject:w}),postMessage({id:"getExternalResource",index:t,uri:I})})))).then((q=>{postMessage({id:"validate.resolve",value:q})}),(q=>{postMessage({id:"validate.reject",reason:q})}));break;case"getExternalResource.resolve":q[l.index].resolve(l.value);break;case"getExternalResource.reject":q[l.index].reject(l.reason)}}}class c{static ValidateAsync(q,I,l,c){return"function"===typeof Worker?new Promise(((a,F)=>{const s=`${t}(${O})()`,Z=URL.createObjectURL(new Blob([s],{type:"application/javascript"})),r=new Worker(Z),x=q=>{r.removeEventListener("error",x),r.removeEventListener("message",o),F(q)},o=q=>{const I=q.data;switch(I.id){case"getExternalResource":c(I.uri).then((q=>{r.postMessage({id:"getExternalResource.resolve",index:I.index,value:q},[q.buffer])}),(q=>{r.postMessage({id:"getExternalResource.reject",index:I.index,reason:q})}));break;case"validate.resolve":r.removeEventListener("error",x),r.removeEventListener("message",o),a(I.value),r.terminate();break;case"validate.reject":r.removeEventListener("error",x),r.removeEventListener("message",o),F(I.reason),r.terminate()}};if(r.addEventListener("error",x),r.addEventListener("message",o),r.postMessage({id:"init",url:w.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(q)){const w=q.slice();r.postMessage({id:"validate",data:w,rootUrl:I,fileName:l},[w.buffer])}else r.postMessage({id:"validate",data:q,rootUrl:I,fileName:l})})):(this._LoadScriptPromise||(this._LoadScriptPromise=w.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>t(q,I,l,c))))}}c.Configuration={url:`${w.Tools._DefaultCdnUrl}/gltf_validator.js`}},14934:(q,I,l)=>{"use strict";l.d(I,{d:()=>W});var w=l(12735),t=l(12740),O=l(12777),c=l(12747),a=l(13139),F=l(13065),s=l(12821),Z=l(12987),r=l(12711),x=l(12664);l(14144),l(14053),l(14069),l(14060),l(14072),l(14077),l(14082);const o="imageProcessingCompatibility",d="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";x.e.IncludesShadersStore[o]||(x.e.IncludesShadersStore[o]=d);const T="skyPixelShader",V="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";x.e.ShadersStore[T]||(x.e.ShadersStore[T]=V);l(14156),l(14089),l(14092),l(14105),l(14098);const U="skyVertexShader",B="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";x.e.ShadersStore[U]||(x.e.ShadersStore[U]=B);var v=l(13059),k=l(13116),C=l(13109);class R extends a.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class W extends F.c{constructor(q,I){super(q,I),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new c.dI(0,100,0),this.useSunPosition=!1,this.cameraOffset=c.dI.Zero(),this.up=c.dI.Up(),this.dithering=!1,this._cameraPosition=c.dI.Zero(),this._skyOrientation=new c.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(q,I){const l=I._drawWrapper;if(this.isFrozen&&l.effect&&l._wasPreviouslyReady)return!0;I.materialDefines||(I.materialDefines=new R);const w=I.materialDefines,t=this.Wq();if(this._isReadyForSubMesh(I))return!0;if((0,C._)(q,t,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,w),(0,C.S)(q,w,!0,!1),w.IMAGEPROCESSINGPOSTPROCESS!==t.imageProcessingConfiguration.applyByPostProcess&&w.markAsMiscDirty(),w.DITHER!==this.dithering&&w.markAsMiscDirty(),w.isDirty){w.markAsProcessed(),t.resetCachedMaterial();const q=new v.b;w.FOG&&q.addFallback(1,"FOG"),w.IMAGEPROCESSINGPOSTPROCESS=t.imageProcessingConfiguration.applyByPostProcess,w.DITHER=this.dithering;const l=[s.c.PositionKind];w.VERTEXCOLOR&&l.push(s.c.ColorKind);const O="sky",c=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,k.b)(c);const a=w.toString();I.setEffect(t.getEngine().createEffect(O,l,c,[],a,q,this.onCompiled,this.onError),w,this._materialContext)}return!(!I.effect||!I.effect.isReady())&&(w._renderId=t.getRenderId(),l._wasPreviouslyReady=!0,!0)}bindForSubMesh(q,I,l){const w=this.Wq(),t=l.materialDefines;if(!t)return;const O=l.effect;if(!O)return;this._activeEffect=O,this.bindOnlyWorldMatrix(q),this._activeEffect.setMatrix("viewProjection",w.getTransformMatrix()),this._mustRebind(w,O,l)&&((0,k.c)(O,this,w),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,C.l)(t,O,w)),w.fogEnabled&&I.applyFog&&w.fogMode!==Z.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",w.getViewMatrix()),(0,C.f)(w,I,this._activeEffect);const a=w.activeCamera;if(a){const q=a.getWorldMatrix();this._cameraPosition.x=q.m[12],this._cameraPosition.y=q.m[13],this._cameraPosition.z=q.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const q=Math.PI*(this.inclination-.5),I=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(I)*Math.cos(q),this.sunPosition.y=this.distance*Math.sin(-q),this.sunPosition.z=this.distance*Math.sin(I)*Math.cos(q),c.Quaternion.FromUnitVectorsToRef(c.dI.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(I,this._activeEffect,l)}getAnimatables(){return[]}dispose(q){super.dispose(q)}clone(q){return O.c.Clone((()=>new W(q,this.Wq())),this)}serialize(){const q=super.serialize();return q.customType="BABYLON.SkyMaterial",q}getClassName(){return"SkyMaterial"}static Parse(q,I,l){return O.c.Parse((()=>new W(q.name,I)),q,I,l)}}(0,w.d)([(0,t.D)()],W.prototype,"luminance",void 0),(0,w.d)([(0,t.D)()],W.prototype,"turbidity",void 0),(0,w.d)([(0,t.D)()],W.prototype,"rayleigh",void 0),(0,w.d)([(0,t.D)()],W.prototype,"mieCoefficient",void 0),(0,w.d)([(0,t.D)()],W.prototype,"mieDirectionalG",void 0),(0,w.d)([(0,t.D)()],W.prototype,"distance",void 0),(0,w.d)([(0,t.D)()],W.prototype,"inclination",void 0),(0,w.d)([(0,t.D)()],W.prototype,"azimuth",void 0),(0,w.d)([(0,t.C)()],W.prototype,"sunPosition",void 0),(0,w.d)([(0,t.D)()],W.prototype,"useSunPosition",void 0),(0,w.d)([(0,t.C)()],W.prototype,"cameraOffset",void 0),(0,w.d)([(0,t.C)()],W.prototype,"up",void 0),(0,w.d)([(0,t.D)()],W.prototype,"dithering",void 0),(0,r.e)("BABYLON.SkyMaterial",W)},13411:(q,I,l)=>{"use strict";function w(q,I){I.headers=q.headers||{},I.statusMessage=q.statusText,I.statusCode=q.status,I.data=q.response}function t(q,I,l){return new Promise((function(t,O){l=l||{};var c,a,F,s=new XMLHttpRequest,Z=l.body,r=l.headers||{};for(c in l.timeout&&(s.timeout=l.timeout),s.ontimeout=s.onerror=function(q){q.timeout="timeout"==q.type,O(q)},s.open(q,I.href||I),s.onload=function(){for(F=s.getAllResponseHeaders().trim().split(/[\r\n]+/),w(s,s);a=F.shift();)a=a.split(": "),s.headers[a.shift().toLowerCase()]=a.join(": ");if((a=s.headers["content-type"])&&~a.indexOf("application/json"))try{s.data=JSON.parse(s.data,l.reviver)}catch(q){return w(s,q),O(q)}(s.status>=400?O:t)(s)},typeof FormData<"u"&&Z instanceof FormData||Z&&"object"==typeof Z&&(r["content-type"]="application/json",Z=JSON.stringify(Z)),s.withCredentials=!!l.withCredentials,r)s.setRequestHeader(c,r[c]);s.send(Z)}))}l.r(I),l.d(I,{del:()=>F,get:()=>O,patch:()=>a,post:()=>c,put:()=>s,send:()=>t});var O=t.bind(t,"GET"),c=t.bind(t,"POST"),a=t.bind(t,"PATCH"),F=t.bind(t,"DELETE"),s=t.bind(t,"PUT")},15047:(q,I,l)=>{"use strict";l.d(I,{e:()=>r});const w=.5*(Math.sqrt(3)-1),t=(3-Math.sqrt(3))/6,O=1/3,c=1/6,a=(Math.sqrt(5)-1)/4,F=(5-Math.sqrt(5))/20,s=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const r=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const I="function"==typeof q?q:function(q){let I=0,l=0,w=0,t=1;const O=function(){let q=4022871197;return function(I){I=I.toString();for(let l=0;l<I.length;l++){q+=I.charCodeAt(l);let w=.02519603282416938*q;q=w>>>0,w-=q,w*=q,q=w>>>0,w-=q,q+=4294967296*w}return 2.3283064365386963e-10*(q>>>0)}}();I=O(" "),l=O(" "),w=O(" "),I-=O(q),I<0&&(I+=1);l-=O(q),l<0&&(l+=1);w-=O(q),w<0&&(w+=1);return function(){const q=2091639*I+2.3283064365386963e-10*t;return I=l,l=w,w=q-(t=0|q)}}(q);this.p=function(q){const I=new Uint8Array(256);for(let l=0;l<256;l++)I[l]=l;for(let l=0;l<255;l++){const w=l+~~(q()*(256-l)),t=I[l];I[l]=I[w],I[w]=t}return I}(I),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let l=0;l<512;l++)this.perm[l]=this.p[255&l],this.permMod12[l]=this.perm[l]%12}noise2D(q,I){const l=this.permMod12,O=this.perm;let c=0,a=0,F=0;const Z=(q+I)*w,r=Math.floor(q+Z),x=Math.floor(I+Z),o=(r+x)*t,d=q-(r-o),T=I-(x-o);let V,U;d>T?(V=1,U=0):(V=0,U=1);const B=d-V+t,v=T-U+t,k=d-1+2*t,C=T-1+2*t,R=255&r,W=255&x;let e=.5-d*d-T*T;if(e>=0){const q=3*l[R+O[W]];e*=e,c=e*e*(s[q]*d+s[q+1]*T)}let i=.5-B*B-v*v;if(i>=0){const q=3*l[R+V+O[W+U]];i*=i,a=i*i*(s[q]*B+s[q+1]*v)}let S=.5-k*k-C*C;if(S>=0){const q=3*l[R+1+O[W+1]];S*=S,F=S*S*(s[q]*k+s[q+1]*C)}return 70*(c+a+F)}noise3D(q,I,l){const w=this.permMod12,t=this.perm;let a,F,Z,r;const x=(q+I+l)*O,o=Math.floor(q+x),d=Math.floor(I+x),T=Math.floor(l+x),V=(o+d+T)*c,U=q-(o-V),B=I-(d-V),v=l-(T-V);let k,C,R,W,e,i;U>=B?B>=v?(k=1,C=0,R=0,W=1,e=1,i=0):U>=v?(k=1,C=0,R=0,W=1,e=0,i=1):(k=0,C=0,R=1,W=1,e=0,i=1):B<v?(k=0,C=0,R=1,W=0,e=1,i=1):U<v?(k=0,C=1,R=0,W=0,e=1,i=1):(k=0,C=1,R=0,W=1,e=1,i=0);const S=U-k+c,g=B-C+c,p=v-R+c,X=U-W+2*c,K=B-e+2*c,D=v-i+2*c,M=U-1+.5,n=B-1+.5,f=v-1+.5,L=255&o,E=255&d,j=255&T;let h=.6-U*U-B*B-v*v;if(h<0)a=0;else{const q=3*w[L+t[E+t[j]]];h*=h,a=h*h*(s[q]*U+s[q+1]*B+s[q+2]*v)}let u=.6-S*S-g*g-p*p;if(u<0)F=0;else{const q=3*w[L+k+t[E+C+t[j+R]]];u*=u,F=u*u*(s[q]*S+s[q+1]*g+s[q+2]*p)}let P=.6-X*X-K*K-D*D;if(P<0)Z=0;else{const q=3*w[L+W+t[E+e+t[j+i]]];P*=P,Z=P*P*(s[q]*X+s[q+1]*K+s[q+2]*D)}let mq=.6-M*M-n*n-f*f;if(mq<0)r=0;else{const q=3*w[L+1+t[E+1+t[j+1]]];mq*=mq,r=mq*mq*(s[q]*M+s[q+1]*n+s[q+2]*f)}return 32*(a+F+Z+r)}noise4D(q,I,l,w){const t=this.perm;let O,c,s,r,x;const o=(q+I+l+w)*a,d=Math.floor(q+o),T=Math.floor(I+o),V=Math.floor(l+o),U=Math.floor(w+o),B=(d+T+V+U)*F,v=q-(d-B),k=I-(T-B),C=l-(V-B),R=w-(U-B);let W=0,e=0,i=0,S=0;v>k?W++:e++,v>C?W++:i++,v>R?W++:S++,k>C?e++:i++,k>R?e++:S++,C>R?i++:S++;const g=W>=3?1:0,p=e>=3?1:0,X=i>=3?1:0,K=S>=3?1:0,D=W>=2?1:0,M=e>=2?1:0,n=i>=2?1:0,f=S>=2?1:0,L=W>=1?1:0,E=e>=1?1:0,j=i>=1?1:0,h=S>=1?1:0,u=v-g+F,P=k-p+F,mq=C-X+F,Y=R-K+F,y=v-D+2*F,G=k-M+2*F,N=C-n+2*F,J=R-f+2*F,z=v-L+3*F,H=k-E+3*F,A=C-j+3*F,Q=R-h+3*F,b=v-1+4*F,qq=k-1+4*F,Iq=C-1+4*F,lq=R-1+4*F,wq=255&d,tq=255&T,Oq=255&V,cq=255&U;let aq=.6-v*v-k*k-C*C-R*R;if(aq<0)O=0;else{const q=t[wq+t[tq+t[Oq+t[cq]]]]%32*4;aq*=aq,O=aq*aq*(Z[q]*v+Z[q+1]*k+Z[q+2]*C+Z[q+3]*R)}let Fq=.6-u*u-P*P-mq*mq-Y*Y;if(Fq<0)c=0;else{const q=t[wq+g+t[tq+p+t[Oq+X+t[cq+K]]]]%32*4;Fq*=Fq,c=Fq*Fq*(Z[q]*u+Z[q+1]*P+Z[q+2]*mq+Z[q+3]*Y)}let sq=.6-y*y-G*G-N*N-J*J;if(sq<0)s=0;else{const q=t[wq+D+t[tq+M+t[Oq+n+t[cq+f]]]]%32*4;sq*=sq,s=sq*sq*(Z[q]*y+Z[q+1]*G+Z[q+2]*N+Z[q+3]*J)}let Zq=.6-z*z-H*H-A*A-Q*Q;if(Zq<0)r=0;else{const q=t[wq+L+t[tq+E+t[Oq+j+t[cq+h]]]]%32*4;Zq*=Zq,r=Zq*Zq*(Z[q]*z+Z[q+1]*H+Z[q+2]*A+Z[q+3]*Q)}let rq=.6-b*b-qq*qq-Iq*Iq-lq*lq;if(rq<0)x=0;else{const q=t[wq+1+t[tq+1+t[Oq+1+t[cq+1]]]]%32*4;rq*=rq,x=rq*rq*(Z[q]*b+Z[q+1]*qq+Z[q+2]*Iq+Z[q+3]*lq)}return 27*(O+c+s+r+x)}}}}]);