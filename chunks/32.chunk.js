/*! For license information please see f8awm.32.09fa7ea2.chunk.js.LICENSE.txt */
(self["9x1utqq1axc"]=self["9x1utqq1axc"]||[]).push([[32],{14268:(y,c,A)=>{"use strict";var l=A(14270),w=A(14279),N=A(14283);A.g.__TYPEDARRAY_POOL||(A.g.__TYPEDARRAY_POOL={UINT8:w([32,0]),UINT16:w([32,0]),UINT32:w([32,0]),INT8:w([32,0]),INT16:w([32,0]),INT32:w([32,0]),FLOAT:w([32,0]),DOUBLE:w([32,0]),DATA:w([32,0]),UINT8C:w([32,0]),BUFFER:w([32,0])});var p="undefined"!==typeof Uint8ClampedArray,W=A.g.__TYPEDARRAY_POOL;W.UINT8C||(W.UINT8C=w([32,0])),W.BUFFER||(W.BUFFER=w([32,0]));var h=W.DATA,I=W.BUFFER;function q(y){if(y){var c=y.length||y.byteLength,A=l.log2(c);h[A].push(y)}}function o(y){y=l.nextPow2(y);var c=l.log2(y),A=h[c];return A.length>0?A.pop():new ArrayBuffer(y)}function O(y){return new Uint8Array(o(y),0,y)}function L(y){return new Uint16Array(o(2*y),0,y)}function i(y){return new Uint32Array(o(4*y),0,y)}function H(y){return new Int8Array(o(y),0,y)}function P(y){return new Int16Array(o(2*y),0,y)}function D(y){return new Int32Array(o(4*y),0,y)}function t(y){return new Float32Array(o(4*y),0,y)}function s(y){return new Float64Array(o(8*y),0,y)}function B(y){return p?new Uint8ClampedArray(o(y),0,y):O(y)}function X(y){return new DataView(o(y),0,y)}c.free=function(y){if(N(y))I[l.log2(y.length)].push(y);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(y)&&(y=y.buffer),!y)return;var c=y.length||y.byteLength,A=0|l.log2(c);h[A].push(y)}},c.freeUint8=c.freeUint16=c.freeUint32=c.freeInt8=c.freeInt16=c.freeInt32=c.freeFloat32=c.freeFloat=c.freeFloat64=c.freeDouble=c.freeUint8Clamped=c.freeDataView=function(y){q(y.buffer)},c.freeArrayBuffer=q,c.freeBuffer=function(y){I[l.log2(y.length)].push(y)},c.malloc=function(y,c){if(void 0===c||"arraybuffer"===c)return o(y);switch(c){case"uint8":return O(y);case"uint16":return L(y);case"uint32":return i(y);case"int8":return H(y);case"int16":return P(y);case"int32":return D(y);case"float":case"float32":return t(y);case"double":case"float64":return s(y);case"uint8_clamped":return B(y);case"buffer":throw"Buffer not supported";case"data":case"dataview":return X(y);default:return null}return null},c.mallocArrayBuffer=o,c.mallocUint8=O,c.mallocUint16=L,c.mallocUint32=i,c.mallocInt8=H,c.mallocInt16=P,c.mallocInt32=D,c.mallocFloat32=c.mallocFloat=t,c.mallocFloat64=c.mallocDouble=s,c.mallocUint8Clamped=B,c.mallocDataView=X,c.clearCache=function(){for(var y=0;y<32;++y)W.UINT8[y].length=0,W.UINT16[y].length=0,W.UINT32[y].length=0,W.INT8[y].length=0,W.INT16[y].length=0,W.INT32[y].length=0,W.FLOAT[y].length=0,W.DOUBLE[y].length=0,W.UINT8C[y].length=0,h[y].length=0,I[y].length=0}},14365:(y,c,A)=>{y.exports=w;var l=A(13103);function w(y,c){if(!(this instanceof w))return new w(y,c);var A=l.create();l.add(A,y,c),this.base=l.min(l.create(),y,A),this.Mq=l.clone(c),this.max=l.max(l.create(),y,A),this.mag=l.length(this.Mq)}var N=w.prototype;N.width=function(){return this.Mq[0]},N.height=function(){return this.Mq[1]},N.depth=function(){return this.Mq[2]},N.x0=function(){return this.base[0]},N.y0=function(){return this.base[1]},N.z0=function(){return this.base[2]},N.x1=function(){return this.max[0]},N.y1=function(){return this.max[1]},N.z1=function(){return this.max[2]},N.translate=function(y){return l.add(this.max,this.max,y),l.add(this.base,this.base,y),this},N.setPosition=function(y){return l.add(this.max,y,this.Mq),l.j(this.base,y),this},N.expand=function(y){var c=l.create(),A=l.create();return l.max(c,y.max,this.max),l.min(A,y.base,this.base),l.xc(c,c,A),new w(A,c)},N.intersects=function(y){return!(y.base[0]>this.max[0])&&(!(y.base[1]>this.max[1])&&(!(y.base[2]>this.max[2])&&(!(y.max[0]<this.base[0])&&(!(y.max[1]<this.base[1])&&!(y.max[2]<this.base[2])))))},N.touches=function(y){var c=this.union(y);return null!==c&&(0==c.width()||0==c.height()||0==c.depth())},N.union=function(y){if(!this.intersects(y))return null;var c=Math.max(y.base[0],this.base[0]),A=Math.max(y.base[1],this.base[1]),l=Math.max(y.base[2],this.base[2]);return new w([c,A,l],[Math.min(y.max[0],this.max[0])-c,Math.min(y.max[1],this.max[1])-A,Math.min(y.max[2],this.max[2])-l])}},14270:(y,c)=>{"use strict";function A(y){var c=32;return(y&=-y)&&c--,65535&y&&(c-=16),16711935&y&&(c-=8),252645135&y&&(c-=4),858993459&y&&(c-=2),1431655765&y&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(y){return(y>0)-(y<0)},c.abs=function(y){var c=y>>31;return(y^c)-c},c.min=function(y,c){return c^(y^c)&-(y<c)},c.max=function(y,c){return y^(y^c)&-(y<c)},c.isPow2=function(y){return!(y&y-1)&&!!y},c.log2=function(y){var c,A;return c=(y>65535)<<4,c|=A=((y>>>=c)>255)<<3,c|=A=((y>>>=A)>15)<<2,(c|=A=((y>>>=A)>3)<<1)|(y>>>=A)>>1},c.log10=function(y){return y>=1e9?9:y>=1e8?8:y>=1e7?7:y>=1e6?6:y>=1e5?5:y>=1e4?4:y>=1e3?3:y>=100?2:y>=10?1:0},c.popCount=function(y){return 16843009*((y=(858993459&(y-=y>>>1&1431655765))+(y>>>2&858993459))+(y>>>4)&252645135)>>>24},c.countTrailingZeros=A,c.nextPow2=function(y){return y+=0===y,--y,y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)+1},c.prevPow2=function(y){return y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)-(y>>>1)},c.parity=function(y){return y^=y>>>16,y^=y>>>8,y^=y>>>4,27030>>>(y&=15)&1};var l=new Array(256);!function(y){for(var c=0;c<256;++c){var A=c,l=c,w=7;for(A>>>=1;A;A>>>=1)l<<=1,l|=1&A,--w;y[c]=l<<w&255}}(l),c.reverse=function(y){return l[255&y]<<24|l[y>>>8&255]<<16|l[y>>>16&255]<<8|l[y>>>24&255]},c.interleave2=function(y,c){return(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(y,c){return(y=65535&((y=16711935&((y=252645135&((y=858993459&((y=y>>>c&1431655765)|y>>>1))|y>>>2))|y>>>4))|y>>>16))<<16>>16},c.interleave3=function(y,c,A){return y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2),(y|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<2},c.deinterleave3=function(y,c){return(y=1023&((y=4278190335&((y=251719695&((y=3272356035&((y=y>>>c&1227133513)|y>>>2))|y>>>4))|y>>>8))|y>>>16))<<22>>22},c.nextCombination=function(y){var c=y|y-1;return c+1|(~c&-~c)-1>>>A(y)+1}},14263:(y,c,A)=>{"use strict";y.exports=function(y,c,A){switch(arguments.length){case 1:return l=[],I(w=y,w,q,!0),l;case 2:return"function"===typeof c?I(y,y,c,!0):function(y,c){return l=[],I(y,c,q,!1),l}(y,c);case 3:return I(y,c,A,!1);default:throw new Error("box-intersect: Invalid arguments")}var w};var l,w=A(14268),N=A(14288),p=A(14301);function W(y,c){for(var A=0;A<y;++A)if(!(c[A]<=c[A+y]))return!0;return!1}function h(y,c,A,l){for(var w=0,N=0,p=0,h=y.length;p<h;++p){var I=y[p];if(!W(c,I)){for(var q=0;q<2*c;++q)A[w++]=I[q];l[N++]=p}}return N}function I(y,c,A,l){var W=y.length,I=c.length;if(!(W<=0||I<=0)){var q=y[0].length>>>1;if(!(q<=0)){var o,O=w.mallocDouble(2*q*W),L=w.mallocInt32(W);if((W=h(y,q,O,L))>0){if(1===q&&l)N.init(W),o=N.sweepComplete(q,A,0,W,O,L,0,W,O,L);else{var i=w.mallocDouble(2*q*I),H=w.mallocInt32(I);(I=h(c,q,i,H))>0&&(N.init(W+I),o=1===q?N.sweepBipartite(q,A,0,W,O,L,0,I,i,H):p(q,A,l,W,O,L,I,i,H),w.free(i),w.free(H))}w.free(O),w.free(L)}return o}}}function q(y,c){l.push([y,c])}},14304:(y,c)=>{"use strict";var A="d",l="ax",w="fp",N="es",p="rs",W="re",h="rb",I="bs",q="be",o="bb",O=[A,l,"vv",p,W,h,"ri",I,q,o,"bi"];function L(y){var c="bruteForce"+(y?"Full":"Partial"),l=[],p=O.slice();y||p.splice(3,0,w);var W=["function "+c+"("+p.join()+"){"];function h(c,w){var p=function(y,c,l){var w="bruteForce"+(y?"Red":"Blue")+(c?"Flip":"")+(l?"Full":""),p=["function ",w,"(",O.join(),"){","var ",N,"=2*",A,";"],W="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",h="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(l?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return y?p.push(W,"Q",":",h):p.push(h,"Q",":",W),l?p.push("if(y1<x0||x1<y0)continue;"):c?p.push("if(y0<=x0||x1<y0)continue;"):p.push("if(y0<x0||x1<y0)continue;"),p.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),c?p.push("yi,xi"):p.push("xi,yi"),p.push(");if(rv!==void 0)return rv;}}}"),{name:w,code:p.join("")}}(c,w,y);l.push(p.code),W.push("return "+p.name+"("+O.join()+");")}W.push("if(re-rs>be-bs){"),y?(h(!0,!1),W.push("}else{"),h(!1,!1)):(W.push("if(fp){"),h(!0,!0),W.push("}else{"),h(!0,!1),W.push("}}else{if(fp){"),h(!1,!0),W.push("}else{"),h(!1,!1),W.push("}")),W.push("}}return "+c);var I=l.join("")+W.join("");return new Function(I)()}c.partial=L(!1),c.full=L(!0)},14301:(y,c,A)=>{"use strict";y.exports=function(y,c,A,N,q,S,M,k,a){!function(y,c){var A=8*w.log2(c+1)*(y+1)|0,N=w.nextPow2(B*A);C.length<N&&(l.free(C),C=l.mallocInt32(N));var p=w.nextPow2(X*A);K.length<p&&(l.free(K),K=l.mallocDouble(p))}(y,N+M);var u,G=0,j=2*y;my(G++,0,0,N,0,M,A?16:0,-1/0,1/0),A||my(G++,0,0,M,0,N,1,-1/0,1/0);for(;G>0;){var f=(G-=1)*B,V=C[f],J=C[f+1],U=C[f+2],e=C[f+3],Q=C[f+4],Y=C[f+5],g=G*X,x=K[g],F=K[g+1],R=1&Y,r=!!(16&Y),n=q,E=S,b=k,Z=a;if(R&&(n=k,E=a,b=q,Z=S),!(2&Y&&J>=(U=P(y,V,J,U,n,E,F)))&&!(4&Y&&(J=D(y,V,J,U,n,E,x))>=U)){var v=U-J,d=Q-e;if(r){if(y*v*(v+d)<L){if(void 0!==(u=h.scanComplete(y,V,c,J,U,n,E,e,Q,b,Z)))return u;continue}}else{if(y*Math.min(v,d)<o){if(void 0!==(u=p(y,V,c,R,J,U,n,E,e,Q,b,Z)))return u;continue}if(y*v*d<O){if(void 0!==(u=h.scanBipartite(y,V,c,R,J,U,n,E,e,Q,b,Z)))return u;continue}}var yy=i(y,V,J,U,n,E,x,F);if(J<yy)if(y*(yy-J)<o){if(void 0!==(u=W(y,V+1,c,J,yy,n,E,e,Q,b,Z)))return u}else if(V===y-2){if(void 0!==(u=R?h.sweepBipartite(y,c,e,Q,b,Z,J,yy,n,E):h.sweepBipartite(y,c,J,yy,n,E,e,Q,b,Z)))return u}else my(G++,V+1,J,yy,e,Q,R,-1/0,1/0),my(G++,V+1,e,Q,J,yy,1^R,-1/0,1/0);if(yy<U){var cy=I(y,V,e,Q,b,Z),Ay=b[j*cy+V],ly=H(y,V,cy,Q,b,Z,Ay);if(ly<Q&&my(G++,V,yy,U,ly,Q,(4|R)+(r?16:0),Ay,F),e<cy&&my(G++,V,yy,U,e,cy,(2|R)+(r?16:0),x,Ay),cy+1===ly){if(void 0!==(u=r?z(y,V,c,yy,U,n,E,cy,b,Z[cy]):T(y,V,c,R,yy,U,n,E,cy,b,Z[cy])))return u}else if(cy<ly){var wy;if(r){if(yy<(wy=t(y,V,yy,U,n,E,Ay))){var Ny=H(y,V,yy,wy,n,E,Ay);if(V===y-2){if(yy<Ny&&void 0!==(u=h.sweepComplete(y,c,yy,Ny,n,E,cy,ly,b,Z)))return u;if(Ny<wy&&void 0!==(u=h.sweepBipartite(y,c,Ny,wy,n,E,cy,ly,b,Z)))return u}else yy<Ny&&my(G++,V+1,yy,Ny,cy,ly,16,-1/0,1/0),Ny<wy&&(my(G++,V+1,Ny,wy,cy,ly,0,-1/0,1/0),my(G++,V+1,cy,ly,Ny,wy,1,-1/0,1/0))}}else yy<(wy=R?s(y,V,yy,U,n,E,Ay):t(y,V,yy,U,n,E,Ay))&&(V===y-2?u=R?h.sweepBipartite(y,c,cy,ly,b,Z,yy,wy,n,E):h.sweepBipartite(y,c,yy,wy,n,E,cy,ly,b,Z):(my(G++,V+1,yy,wy,cy,ly,R,-1/0,1/0),my(G++,V+1,cy,ly,yy,wy,1^R,-1/0,1/0)))}}}}};var l=A(14268),w=A(14270),N=A(14304),p=N.partial,W=N.full,h=A(14288),I=A(14308),q=A(14316),o=128,O=1<<22,L=1<<22,i=q("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),H=q("lo===p0",["p0"]),P=q("lo<p0",["p0"]),D=q("hi<=p0",["p0"]),t=q("lo<=p0&&p0<=hi",["p0"]),s=q("lo<p0&&p0<=hi",["p0"]),B=6,X=2,C=l.mallocInt32(1024),K=l.mallocDouble(1024);function my(y,c,A,l,w,N,p,W,h){var I=B*y;C[I]=c,C[I+1]=A,C[I+2]=l,C[I+3]=w,C[I+4]=N,C[I+5]=p;var q=X*y;K[q]=W,K[q+1]=h}function T(y,c,A,l,w,N,p,W,h,I,q){var o=2*y,O=h*o,L=I[O+c];y:for(var i=w,H=w*o;i<N;++i,H+=o){var P=p[H+c],D=p[H+c+y];if(!(L<P||D<L)&&(!l||L!==P)){for(var t,s=W[i],B=c+1;B<y;++B){P=p[H+B],D=p[H+B+y];var X=I[O+B],C=I[O+B+y];if(D<X||C<P)continue y}if(void 0!==(t=l?A(q,s):A(s,q)))return t}}}function z(y,c,A,l,w,N,p,W,h,I){var q=2*y,o=W*q,O=h[o+c];y:for(var L=l,i=l*q;L<w;++L,i+=q){var H=p[L];if(H!==I){var P=N[i+c],D=N[i+c+y];if(!(O<P||D<O)){for(var t=c+1;t<y;++t){P=N[i+t],D=N[i+t+y];var s=h[o+t],B=h[o+t+y];if(D<s||B<P)continue y}var X=A(H,I);if(void 0!==X)return X}}}}},14308:(y,c,A)=>{"use strict";y.exports=function(y,c,A,p,W,h){if(p<=A+1)return A;var I=A,q=p,o=p+A>>>1,O=2*y,L=o,i=W[O*o+c];for(;I<q;){if(q-I<w){N(y,c,I,q,W,h),i=W[O*o+c];break}var H=q-I,P=Math.random()*H+I|0,D=W[O*P+c],t=Math.random()*H+I|0,s=W[O*t+c],B=Math.random()*H+I|0,X=W[O*B+c];D<=s?X>=s?(L=t,i=s):D>=X?(L=P,i=D):(L=B,i=X):s>=X?(L=t,i=s):X>=D?(L=P,i=D):(L=B,i=X);for(var C=O*(q-1),K=O*L,my=0;my<O;++my,++C,++K){var T=W[C];W[C]=W[K],W[K]=T}var z=h[q-1];h[q-1]=h[L],h[L]=z;for(C=O*(q-1),K=O*(L=l(y,c,I,q-1,W,h,i)),my=0;my<O;++my,++C,++K){T=W[C];W[C]=W[K],W[K]=T}z=h[q-1];if(h[q-1]=h[L],h[L]=z,o<L){for(q=L-1;I<q&&W[O*(q-1)+c]===i;)q-=1;q+=1}else{if(!(L<o))break;for(I=L+1;I<q&&W[O*I+c]===i;)I+=1}}return l(y,c,A,o,W,h,W[O*o+c])};var l=A(14316)("lo<p0",["p0"]),w=8;function N(y,c,A,l,w,N){for(var p=2*y,W=p*(A+1)+c,h=A+1;h<l;++h,W+=p)for(var I=w[W],q=h,o=p*(h-1);q>A&&w[o+c]>I;--q,o-=p){for(var O=o,L=o+p,i=0;i<p;++i,++O,++L){var H=w[O];w[O]=w[L],w[L]=H}var P=N[q];N[q]=N[q-1],N[q-1]=P}}},14316:y=>{"use strict";y.exports=function(y,A){var l="abcdef".split("").concat(A),w=[];y.indexOf("lo")>=0&&w.push("lo=e[k+n]");y.indexOf("hi")>=0&&w.push("hi=e[k+o]");return l.push(c.replace("_",w.join()).replace("$",y)),Function.apply(void 0,l)};var c="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14293:y=>{"use strict";y.exports=function(y,l){l<=4*c?A(0,l-1,y):I(0,l-1,y)};var c=32;function A(y,c,A){for(var l=2*(y+1),w=y+1;w<=c;++w){for(var N=A[l++],p=A[l++],W=w,h=l-2;W-- >y;){var I=A[h-2],q=A[h-1];if(I<N)break;if(I===N&&q<p)break;A[h]=I,A[h+1]=q,h-=2}A[h]=N,A[h+1]=p}}function l(y,c,A){c*=2;var l=A[y*=2],w=A[y+1];A[y]=A[c],A[y+1]=A[c+1],A[c]=l,A[c+1]=w}function w(y,c,A){c*=2,A[y*=2]=A[c],A[y+1]=A[c+1]}function N(y,c,A,l){c*=2,A*=2;var w=l[y*=2],N=l[y+1];l[y]=l[c],l[y+1]=l[c+1],l[c]=l[A],l[c+1]=l[A+1],l[A]=w,l[A+1]=N}function p(y,c,A,l,w){c*=2,w[y*=2]=w[c],w[c]=A,w[y+1]=w[c+1],w[c+1]=l}function W(y,c,A){c*=2;var l=A[y*=2],w=A[c];return!(l<w)&&(l!==w||A[y+1]>A[c+1])}function h(y,c,A,l){var w=l[y*=2];return w<c||w===c&&l[y+1]<A}function I(y,q,o){var O=(q-y+1)/6|0,L=y+O,i=q-O,H=y+q>>1,P=H-O,D=H+O,t=L,s=P,B=H,X=D,C=i,K=y+1,my=q-1,T=0;W(t,s,o)&&(T=t,t=s,s=T),W(X,C,o)&&(T=X,X=C,C=T),W(t,B,o)&&(T=t,t=B,B=T),W(s,B,o)&&(T=s,s=B,B=T),W(t,X,o)&&(T=t,t=X,X=T),W(B,X,o)&&(T=B,B=X,X=T),W(s,C,o)&&(T=s,s=C,C=T),W(s,B,o)&&(T=s,s=B,B=T),W(X,C,o)&&(T=X,X=C,C=T);for(var z=o[2*s],S=o[2*s+1],M=o[2*X],k=o[2*X+1],a=2*t,u=2*B,G=2*C,j=2*L,f=2*H,V=2*i,J=0;J<2;++J){var U=o[a+J],e=o[u+J],Q=o[G+J];o[j+J]=U,o[f+J]=e,o[V+J]=Q}w(P,y,o),w(D,q,o);for(var Y=K;Y<=my;++Y)if(h(Y,z,S,o))Y!==K&&l(Y,K,o),++K;else if(!h(Y,M,k,o))for(;;){if(h(my,M,k,o)){h(my,z,S,o)?(N(Y,K,my,o),++K,--my):(l(Y,my,o),--my);break}if(--my<Y)break}p(y,K-1,z,S,o),p(q,my+1,M,k,o),K-2-y<=c?A(y,K-2,o):I(y,K-2,o),q-(my+2)<=c?A(my+2,q,o):I(my+2,q,o),my-K<=c?A(K,my,o):I(K,my,o)}},14288:(y,c,A)=>{"use strict";y.exports={init:function(y){var c=w.nextPow2(y);h.length<c&&(l.free(h),h=l.mallocInt32(c));I.length<c&&(l.free(I),I=l.mallocInt32(c));q.length<c&&(l.free(q),q=l.mallocInt32(c));o.length<c&&(l.free(o),o=l.mallocInt32(c));O.length<c&&(l.free(O),O=l.mallocInt32(c));L.length<c&&(l.free(L),L=l.mallocInt32(c));var A=8*c;i.length<A&&(l.free(i),i=l.mallocDouble(A))},sweepBipartite:function(y,c,A,l,w,W,O,L,D,t){for(var s=0,B=2*y,X=y-1,C=B-1,K=A;K<l;++K){var my=W[K],T=B*K;i[s++]=w[T+X],i[s++]=-(my+1),i[s++]=w[T+C],i[s++]=my}for(K=O;K<L;++K){my=t[K]+p;var z=B*K;i[s++]=D[z+X],i[s++]=-my,i[s++]=D[z+C],i[s++]=my}var S=s>>>1;N(i,S);var M=0,k=0;for(K=0;K<S;++K){var a=0|i[2*K+1];if(a>=p)H(q,o,k--,a=a-p|0);else if(a>=0)H(h,I,M--,a);else if(a<=-p){a=-a-p|0;for(var u=0;u<M;++u){if(void 0!==(G=c(h[u],a)))return G}P(q,o,k++,a)}else{a=-a-1|0;for(u=0;u<k;++u){var G;if(void 0!==(G=c(a,q[u])))return G}P(h,I,M++,a)}}},sweepComplete:function(y,c,A,l,w,p,W,D,t,s){for(var B=0,X=2*y,C=y-1,K=X-1,my=A;my<l;++my){var T=p[my]+1<<1,z=X*my;i[B++]=w[z+C],i[B++]=-T,i[B++]=w[z+K],i[B++]=T}for(my=W;my<D;++my){T=s[my]+1<<1;var S=X*my;i[B++]=t[S+C],i[B++]=1|-T,i[B++]=t[S+K],i[B++]=1|T}var M=B>>>1;N(i,M);var k=0,a=0,u=0;for(my=0;my<M;++my){var G=0|i[2*my+1],j=1&G;if(my<M-1&&G>>1===i[2*my+3]>>1&&(j=2,my+=1),G<0){for(var f=-(G>>1)-1,V=0;V<u;++V){if(void 0!==(J=c(O[V],f)))return J}if(0!==j)for(V=0;V<k;++V){if(void 0!==(J=c(h[V],f)))return J}if(1!==j)for(V=0;V<a;++V){var J;if(void 0!==(J=c(q[V],f)))return J}0===j?P(h,I,k++,f):1===j?P(q,o,a++,f):2===j&&P(O,L,u++,f)}else{f=(G>>1)-1;0===j?H(h,I,k--,f):1===j?H(q,o,a--,f):2===j&&H(O,L,u--,f)}}},scanBipartite:function(y,c,A,l,w,W,q,o,O,L,D,t){var s=0,B=2*y,X=c,C=c+y,K=1,my=1;l?my=p:K=p;for(var T=w;T<W;++T){var z=T+K,S=B*T;i[s++]=q[S+X],i[s++]=-z,i[s++]=q[S+C],i[s++]=z}for(T=O;T<L;++T){z=T+my;var M=B*T;i[s++]=D[M+X],i[s++]=-z}var k=s>>>1;N(i,k);var a=0;for(T=0;T<k;++T){var u=0|i[2*T+1];if(u<0){var G=!1;if((z=-u)>=p?(G=!l,z-=p):(G=!!l,z-=1),G)P(h,I,a++,z);else{var j=t[z],f=B*z,V=D[f+c+1],J=D[f+c+1+y];y:for(var U=0;U<a;++U){var e=h[U],Q=B*e;if(!(J<q[Q+c+1]||q[Q+c+1+y]<V)){for(var Y=c+2;Y<y;++Y)if(D[f+Y+y]<q[Q+Y]||q[Q+Y+y]<D[f+Y])continue y;var g,x=o[e];if(void 0!==(g=l?A(j,x):A(x,j)))return g}}}}else H(h,I,a--,u-K)}},scanComplete:function(y,c,A,l,w,W,I,q,o,O,L){for(var H=0,P=2*y,D=c,t=c+y,s=l;s<w;++s){var B=s+p,X=P*s;i[H++]=W[X+D],i[H++]=-B,i[H++]=W[X+t],i[H++]=B}for(s=q;s<o;++s){B=s+1;var C=P*s;i[H++]=O[C+D],i[H++]=-B}var K=H>>>1;N(i,K);var my=0;for(s=0;s<K;++s){var T=0|i[2*s+1];if(T<0){if((B=-T)>=p)h[my++]=B-p;else{var z=L[B-=1],S=P*B,M=O[S+c+1],k=O[S+c+1+y];y:for(var a=0;a<my;++a){var u=h[a],G=I[u];if(G===z)break;var j=P*u;if(!(k<W[j+c+1]||W[j+c+1+y]<M)){for(var f=c+2;f<y;++f)if(O[S+f+y]<W[j+f]||W[j+f+y]<O[S+f])continue y;var V=A(G,z);if(void 0!==V)return V}}}}else{for(B=T-p,a=my-1;a>=0;--a)if(h[a]===B){for(f=a+1;f<my;++f)h[f-1]=h[f];break}--my}}}};var l=A(14268),w=A(14270),N=A(14293),p=1<<28,W=1024,h=l.mallocInt32(W),I=l.mallocInt32(W),q=l.mallocInt32(W),o=l.mallocInt32(W),O=l.mallocInt32(W),L=l.mallocInt32(W),i=l.mallocDouble(8192);function H(y,c,A,l){var w=c[l],N=y[A-1];y[w]=N,c[N]=w}function P(y,c,A,l){y[A]=l,c[l]=A}},14279:y=>{"use strict";function c(y,A,l){var w=0|y[l];if(w<=0)return[];var N,p=new Array(w);if(l===y.length-1)for(N=0;N<w;++N)p[N]=A;else for(N=0;N<w;++N)p[N]=c(y,A,l+1);return p}y.exports=function(y,A){switch("undefined"===typeof A&&(A=0),typeof y){case"number":if(y>0)return function(y,c){var A,l;for(A=new Array(y),l=0;l<y;++l)A[l]=c;return A}(0|y,A);break;case"object":if("number"===typeof y.length)return c(y,A,0)}return[]}},14230:(y,c,A)=>{y.exports=function(){var y=this;this.components={},this.comps=this.components;var c=this.components,A=1,w={},N=[],p=[],W={timeout:!1,removals:[],multiComps:[]};function h(y,A){var l=c[A],N=w[A],p=N.hash[y];p&&(N.remove(y),l.Oc&&(l.multi?(p.forEach((c=>{c&&l.Oc(y,c)})),p.length=0):l.Oc(y,p)),W.removals.push(N),I())}function I(){W.timeout||(W.timeout=!0,setTimeout(q,1))}function q(){W.timeout=!1,o()}function o(){W.multiComps.length&&function(y){for(var c=0;c<y.length;c++){var{entID:A,data:l}=y[c],w=l.hash[A];if(w){for(var N=0;N<w.length;N++)w[N]||(w.splice(N,1),N--);0===w.length&&(l.remove(A),W.removals.push(l))}}y.length=0}(W.multiComps),W.removals.length&&function(y){for(var c=0;c<y.length;c++){y[c].flush()}y.length=0}(W.removals)}this.Ro=w,this._systems=N,this._renderSystems=p,this.CI=function(c){var l=A++;return Array.isArray(c)&&c.forEach((c=>y.LI(l,c))),l},this.deleteEntity=function(c){return Object.keys(w).forEach((y=>{w[y].hash[c]&&h(c,y)})),y},this.rq=function(y){if(!y)throw new Error("Missing component definition");var A=y.name;if(!A)throw new Error("Component definition must have a name property.");if("string"!==typeof A)throw new Error("Component name must be a string.");if(""===A)throw new Error("Component name must be a non-empty string.");if(w[A])throw new Error(`Component ${A} already exists.`);var W={};return W.name=A,W.multi=!!y.multi,W.order=isNaN(y.order)?99:y.order,W.stateConstructor=y.stateConstructor||null,W.state=y.state||{},W.FW=y.FW||null,W.Oc=y.Oc||null,W.system=y.system||null,W.ZW=y.ZW||null,c[A]=W,w[A]=new l,w[A]._pendingMultiCleanup=!1,w[A]._multiCleanupIDs=W.multi?[]:null,W.system&&(N.push(A),N.sort(((y,A)=>c[y].order-c[A].order))),W.ZW&&(p.push(A),p.sort(((y,A)=>c[y].order-c[A].order))),A},this.overwriteComponent=function(y,A){var l=c[y];if(!l)throw new Error(`Unknown component: ${y}`);if(!A)throw new Error("Missing component definition");if(l.name!==A.name)throw new Error("Overwriting component must use the same name property.");var W={};W.name=y,W.multi=!!A.multi,W.order=isNaN(A.order)?99:A.order,W.state=A.state||{},W.FW=A.FW||null,W.Oc=A.Oc||null,W.system=A.system||null,W.ZW=A.ZW||null,c[y]=W,w[y]._pendingMultiCleanup=!1,w[y]._multiCleanupIDs=W.multi?[]:null;var h=N.indexOf(y);W.system&&h<0&&N.push(y),!W.system&&h>=0&&N.splice(h,1),N.sort(((y,A)=>c[y].order-c[A].order));var I=p.indexOf(y);W.ZW&&I<0&&p.push(y),!W.ZW&&I>=0&&p.splice(I,1),p.sort(((y,A)=>c[y].order-c[A].order));var q=W.state;return this.Lq(y).forEach((y=>{for(var c in q)c in y||(y[c]=q[c]);W.FW&&W.FW(y.EW,y)})),y},this.deleteComponent=function(A){var l=w[A];if(!l)throw new Error(`Unknown component: ${A}`);l.flush(),l.list.forEach((y=>{y&&h(y.EW||y[0].EW,A)}));var W=N.indexOf(A),I=p.indexOf(A);return W>-1&&N.splice(W,1),I>-1&&p.splice(I,1),w[A].dispose(),delete w[A],delete c[A],y},this.LI=function(y,A,l){var N,p=c[A],W=w[A];if(!W)throw new Error(`Unknown component: ${A}.`);if(W.hash[y]&&!p.multi)throw new Error(`Entity ${y} already has component: ${A}.`);if(p.stateConstructor){if(!(N=new p.stateConstructor).hasOwnProperty("EW"))throw new Error(`Component ${p.name} stateConstructor type does not have property __id`)}else N=Object.assign({},{EW:y},p.state,l);if(N.EW=y,p.multi){var h=W.hash[y];h||(h=[],W.add(y,h)),h.push(N)}else W.add(y,N);return p.FW&&p.FW(y,N),this},this.TI=function(y,c){var A=w[c];if(!A)throw new Error(`Unknown component: ${c}.`);return!!A.hash[y]},this.tI=function(c,A){if(!w[A])throw new Error(`Unknown component: ${A}.`);return h(c,A),y},this.getState=function(y,c){var A=w[c];if(!A)throw new Error(`Unknown component: ${c}.`);return A.hash[y]},this.Lq=function(y){var c=w[y];if(!c)throw new Error(`Unknown component: ${y}.`);return o(),c.list},this.GL=function(y){if(!w[y])throw new Error(`Unknown component: ${y}.`);var c=w[y].hash;return y=>c[y]},this.VL=function(y){if(!w[y])throw new Error(`Unknown component: ${y}.`);var c=w[y].hash;return y=>!!c[y]},this.VW=function(A){o();for(var l=0;l<N.length;l++){var p=N[l],W=c[p],h=w[p];W.system(A,h.list),o()}return y},this.render=function(A){o();for(var l=0;l<p.length;l++){var N=p[l],W=c[N],h=w[N];W.ZW(A,h.list),o()}return y},this.removeMultiComponent=function(A,l,N){var p=c[l],h=w[l];if(!h)throw new Error(`Unknown component: ${l}.`);if(!p.multi)throw new Error("removeMultiComponent called on non-multi component");return function(y,c,A,l){var w=A.hash[y];if(w){var N=w[l];N&&(w[l]=null,c.Oc&&c.Oc(y,N),W.multiComps.push({entID:y,data:A}),I())}}(A,p,h,N),y}};var l=A(14239)},14239:y=>{function c(y,c){var A=y._map[c];if(delete y.hash[c],delete y._map[c],A===y.list.length-1)y.list.pop();else{var l=y.list.pop();if(y.list[A]=l,null===l||null===l[0]){var w=y.list.length;for(var N in y._map)if(y._map[N]===w)return void(y._map[N]=A)}else{var p=l.EW||l[0].EW;y._map[p]=A}}}y.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(y,c){if("number"===typeof this._map[y]){var A=this._map[y];this.hash[y]=c,this.list[A]=c}else this._map[y]=this.list.length,this.hash[y]=c,this.list.push(c)}remove(y){var c=this._map[y];this.hash[y]=null,this.list[c]=null,this._pendingRemovals.push(y)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var y=0;y<this._pendingRemovals.length;y++){var A=this._pendingRemovals[y];null===this.hash[A]&&c(this,A)}this._pendingRemovals.length=0}}},14184:y=>{"use strict";var c,A="object"===typeof Reflect?Reflect:null,l=function(y,c,A){return Function.prototype.apply.call(y,c,A)};c=A&&"function"===typeof A.ownKeys?A.ownKeys:Object.getOwnPropertySymbols?function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:function(y){return Object.getOwnPropertyNames(y)};var w=Number.isNaN||function(y){return y!==y};function N(){N.init.call(this)}y.exports=N,y.exports.once=function(y,c){return new Promise((function(A,l){function w(A){y.removeListener(c,N),l(A)}function N(){"function"===typeof y.removeListener&&y.removeListener("error",w),A([].slice.call(arguments))}H(y,c,N,{once:!0}),"error"!==c&&function(y,c,A){"function"===typeof y.on&&H(y,"error",c,A)}(y,w,{once:!0})}))},N.EventEmitter=N,N.prototype._events=void 0,N.prototype._eventsCount=0,N.prototype._maxListeners=void 0;var p=10;function W(y){if("function"!==typeof y)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}function h(y){return void 0===y._maxListeners?N.defaultMaxListeners:y._maxListeners}function I(y,c,A,l){var w,N,p,I;if(W(A),void 0===(N=y._events)?(N=y._events=Object.create(null),y._eventsCount=0):(void 0!==N.newListener&&(y.emit("newListener",c,A.listener?A.listener:A),N=y._events),p=N[c]),void 0===p)p=N[c]=A,++y._eventsCount;else if("function"===typeof p?p=N[c]=l?[A,p]:[p,A]:l?p.unshift(A):p.push(A),(w=h(y))>0&&p.length>w&&!p.warned){p.warned=!0;var q=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");q.name="MaxListenersExceededWarning",q.Ic=y,q.type=c,q.count=p.length,I=q,console&&console.warn&&console.warn(I)}return y}function q(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function o(y,c,A){var l={fired:!1,wrapFn:void 0,target:y,type:c,listener:A},w=q.bind(l);return w.listener=A,l.wrapFn=w,w}function O(y,c,A){var l=y._events;if(void 0===l)return[];var w=l[c];return void 0===w?[]:"function"===typeof w?A?[w.listener||w]:[w]:A?function(y){for(var c=new Array(y.length),A=0;A<c.length;++A)c[A]=y[A].listener||y[A];return c}(w):i(w,w.length)}function L(y){var c=this._events;if(void 0!==c){var A=c[y];if("function"===typeof A)return 1;if(void 0!==A)return A.length}return 0}function i(y,c){for(var A=new Array(c),l=0;l<c;++l)A[l]=y[l];return A}function H(y,c,A,l){if("function"===typeof y.on)l.once?y.once(c,A):y.on(c,A);else{if("function"!==typeof y.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y);y.addEventListener(c,(function w(N){l.once&&y.removeEventListener(c,w),A(N)}))}}Object.defineProperty(N,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(y){if("number"!==typeof y||y<0||w(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");p=y}}),N.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},N.prototype.setMaxListeners=function(y){if("number"!==typeof y||y<0||w(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this},N.prototype.getMaxListeners=function(){return h(this)},N.prototype.emit=function(y){for(var c=[],A=1;A<arguments.length;A++)c.push(arguments[A]);var w="error"===y,N=this._events;if(void 0!==N)w=w&&void 0===N.error;else if(!w)return!1;if(w){var p;if(c.length>0&&(p=c[0]),p instanceof Error)throw p;var W=new Error("Unhandled error."+(p?" ("+p.message+")":""));throw W.context=p,W}var h=N[y];if(void 0===h)return!1;if("function"===typeof h)l(h,this,c);else{var I=h.length,q=i(h,I);for(A=0;A<I;++A)l(q[A],this,c)}return!0},N.prototype.addListener=function(y,c){return I(this,y,c,!1)},N.prototype.on=N.prototype.addListener,N.prototype.prependListener=function(y,c){return I(this,y,c,!0)},N.prototype.once=function(y,c){return W(c),this.on(y,o(this,y,c)),this},N.prototype.prependOnceListener=function(y,c){return W(c),this.prependListener(y,o(this,y,c)),this},N.prototype.removeListener=function(y,c){var A,l,w,N,p;if(W(c),void 0===(l=this._events))return this;if(void 0===(A=l[y]))return this;if(A===c||A.listener===c)0===--this._eventsCount?this._events=Object.create(null):(delete l[y],l.removeListener&&this.emit("removeListener",y,A.listener||c));else if("function"!==typeof A){for(w=-1,N=A.length-1;N>=0;N--)if(A[N]===c||A[N].listener===c){p=A[N].listener,w=N;break}if(w<0)return this;0===w?A.shift():function(y,c){for(;c+1<y.length;c++)y[c]=y[c+1];y.pop()}(A,w),1===A.length&&(l[y]=A[0]),void 0!==l.removeListener&&this.emit("removeListener",y,p||c)}return this},N.prototype.off=N.prototype.removeListener,N.prototype.qc=function(y){var c,A,l;if(void 0===(A=this._events))return this;if(void 0===A.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==A[y]&&(0===--this._eventsCount?this._events=Object.create(null):delete A[y]),this;if(0===arguments.length){var w,N=Object.keys(A);for(l=0;l<N.length;++l)"removeListener"!==(w=N[l])&&this.qc(w);return this.qc("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(c=A[y]))this.removeListener(y,c);else if(void 0!==c)for(l=c.length-1;l>=0;l--)this.removeListener(y,c[l]);return this},N.prototype.listeners=function(y){return O(this,y,!0)},N.prototype.rawListeners=function(y){return O(this,y,!1)},N.listenerCount=function(y,c){return"function"===typeof y.listenerCount?y.listenerCount(c):L.call(y,c)},N.prototype.listenerCount=L,N.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]}},14510:y=>{"use strict";y.exports=function(y,c,A,l,w,N){var p=+c[0],W=+c[1],h=+c[2],I=+A[0],q=+A[1],o=+A[2],O=Math.sqrt(I*I+q*q+o*o);if(0===O)throw new Error("Can't raycast along a zero vector");return function(y,c,A,l,w,N,p,W,h,I){for(var q=0,o=Math.floor,O=0|o(c),L=0|o(A),i=0|o(l),H=w>0?1:-1,P=N>0?1:-1,D=p>0?1:-1,t=Math.abs(1/w),s=Math.abs(1/N),B=Math.abs(1/p),X=t<1/0?t*(H>0?O+1-c:c-O):1/0,C=s<1/0?s*(P>0?L+1-A:A-L):1/0,K=B<1/0?B*(D>0?i+1-l:l-i):1/0,my=-1;q<=W;){var T=y(O,L,i);if(T)return h&&(h[0]=c+q*w,h[1]=A+q*N,h[2]=l+q*p),I&&(I[0]=I[1]=I[2]=0,0===my&&(I[0]=-H),1===my&&(I[1]=-P),2===my&&(I[2]=-D)),T;X<C?X<K?(O+=H,q=X,X+=t,my=0):(i+=D,q=K,K+=B,my=2):C<K?(L+=P,q=C,C+=s,my=1):(i+=D,q=K,K+=B,my=2)}return h&&(h[0]=c+q*w,h[1]=A+q*N,h[2]=l+q*p),I&&(I[0]=I[1]=I[2]=0),0}(y,p,W,h,I/=O,q/=O,o/=O,l="undefined"===typeof l?64:+l,w,N)}},14546:(y,c,A)=>{"use strict";A.d(c,{c:()=>N});var l=A(14184);function w(){this.jO=!1,this.stopPropagation=!1,this.fO=!1,this.disabled=!1}class N{constructor(y,c){this.version="0.7.0";var A=Object.assign({},new w,c||{});this.element=y||document,this.jO=!!A.jO,this.stopPropagation=!!A.stopPropagation,this.fO=!!A.fO,this.disabled=!!A.disabled,this.filterEvents=(y,c)=>!0,this.down=new l.EventEmitter,this.up=new l.EventEmitter,this.state={},this.Wq={dx:0,dy:0,KL:0,pq:0,mi:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?W(this):document.addEventListener("DOMContentLoaded",(y=>{W(this)}),{once:!0})}bind(y){for(var c=arguments.length,A=new Array(c>1?c-1:0),l=1;l<c;l++)A[l-1]=arguments[l];A.forEach((c=>{var A=this._keyBindmap[c]||[];A.includes(y)||(A.push(y),this._keyBindmap[c]=A)})),this.state[y]=!!this.state[y],this.pressCount[y]=this.pressCount[y]||0,this.releaseCount[y]=this.releaseCount[y]||0}unbind(y){for(var c in this._keyBindmap){var A=this._keyBindmap[c],l=A.indexOf(y);l>-1&&A.splice(l,1)}}getBindings(){var y={};for(var c in this._keyBindmap){this._keyBindmap[c].forEach((A=>{y[A]=y[A]||[],y[A].push(c)}))}return y}VW(){p(this.Wq),p(this.pressCount),p(this.releaseCount)}}function p(y){for(var c in y)y[c]=0}function W(y){window.addEventListener("keydown",i.bind(null,y,!0),!1),window.addEventListener("keyup",i.bind(null,y,!1),!1);var c={passive:!0};y.element.addEventListener("touchstart",o.bind(void 0,y),{passive:!1}),y.element.addEventListener("touchend",L.bind(void 0,y),c),y.element.addEventListener("mousedown",H.bind(null,y,!0),c),window.document.addEventListener("mouseup",H.bind(null,y,!1),c),y.element.addEventListener("touchmove",P.bind(null,y),c),y.element.addEventListener("mousemove",P.bind(null,y),c),window.PointerEvent,y.element.addEventListener("wheel",D.bind(null,y),c),y.element.addEventListener("contextmenu",t.bind(null,y),!1),window.addEventListener("blur",s.bind(null,y),!1)}var h=0,I=0,q=null;function o(y,c){c.preventDefault(),O(c)}function O(y){let c=!1;for(let A=0;A<y.touches.length;++A)if(y.touches[A].identifier===q){c=!0;break}if(!c){const c=y.changedTouches[0];h=c.clientX,I=c.clientY,q=c.identifier}}function L(y,c){for(var A=c.changedTouches,l=0;l<A.length;++l)A[l].identifier===q&&(q=null)}function i(y,c,A){B(A.code,c,y,A)}function H(y,c,A){if("pointerId"in A)if(c){if(null!==y._touches.currID)return;y._touches.currID=A.pointerId}else{if(y._touches.currID!==A.pointerId)return;y._touches.currID=null}return B("Mouse"+("button"in A?A.button+1:1),c,y,A),!1}function P(y,c){var A=c.movementX||c.mozMovementX||0,l=c.movementY||c.mozMovementY||0;if(c.touches&&0===(A|l)){var w=function(y){O(y);for(let c=0;c<y.changedTouches.length;++c)if(y.changedTouches[c].identifier==q){const A=y.changedTouches[c],l=[A.clientX-h,A.clientY-I];return h=A.clientX,I=A.clientY,l}return console.error(`Did not find touch id ${q}`),[0,0]}(c);A=w[0],l=w[1]}y.Wq.dx+=A,y.Wq.dy+=l}function D(y,c){var A=1;switch(c.deltaMode){case 0:A=1;break;case 1:A=12;break;case 2:A=y.element.clientHeight||window.innerHeight}y.Wq.KL+=(c.deltaX||0)*A,y.Wq.pq+=(c.deltaY||0)*A,y.Wq.mi+=(c.deltaZ||0)*A}function t(y,c){if(!y.fO)return c.preventDefault(),!1}function s(y){for(var c in y._keyStates)y._keyStates[c]&&(/^Mouse\d/.test(c)||B(c,!1,y,{code:c,note:"xmvj68ec8sl",preventDefault:()=>{},stopPropagation:()=>{}}))}function B(y,c,A,l){var w=A._keyBindmap[y];w&&(X(A._keyStates[y],c)&&(A._keyStates[y]=c,w.forEach((y=>{(!A.filterEvents||A.filterEvents(l,y))&&function(y,c,A,l){var w=c?A.pressCount:A.releaseCount;w[y]=(w[y]||0)+1;var N=A._bindPressCount[y]||0;(N+=c?1:-1)<0&&(N=0);A._bindPressCount[y]=N;var p=A.state[y];if(X(p,N)){A.state[y]=N>0;var W=c?A.down:A.up;A.disabled||W.emit(y,l)}}(y,c,A,l)}))),"button"in l||(A.jO&&!l.defaultPrevented&&l.preventDefault(),A.stopPropagation&&l.stopPropagation()))}function X(y,c){return y?!c:c}},13155:y=>{y.exports=function(y,c,A){return y[0]=c[0]+A[0],y[1]=c[1]+A[1],y[2]=c[2]+A[2],y}},13122:(y,c,A)=>{y.exports=function(y,c){var A=l(y[0],y[1],y[2]),p=l(c[0],c[1],c[2]);w(A,A),w(p,p);var W=N(A,p);return W>1?0:Math.acos(W)};var l=A(13129),w=A(13133),N=A(13140)},13220:y=>{y.exports=function(y,c){return y[0]=Math.ceil(c[0]),y[1]=Math.ceil(c[1]),y[2]=Math.ceil(c[2]),y}},13120:y=>{y.exports=function(y){var c=new Float32Array(3);return c[0]=y[0],c[1]=y[1],c[2]=y[2],c}},13143:y=>{y.exports=function(y,c){return y[0]=c[0],y[1]=c[1],y[2]=c[2],y}},13113:y=>{y.exports=function(){var y=new Float32Array(3);return y[0]=0,y[1]=0,y[2]=0,y}},13289:y=>{y.exports=function(y,c,A){var l=c[0],w=c[1],N=c[2],p=A[0],W=A[1],h=A[2];return y[0]=w*h-N*W,y[1]=N*p-l*h,y[2]=l*W-w*p,y}},13250:(y,c,A)=>{y.exports=A(13246)},13246:y=>{y.exports=function(y,c){var A=c[0]-y[0],l=c[1]-y[1],w=c[2]-y[2];return Math.sqrt(A*A+l*l+w*w)}},13198:(y,c,A)=>{y.exports=A(13189)},13189:y=>{y.exports=function(y,c,A){return y[0]=c[0]/A[0],y[1]=c[1]/A[1],y[2]=c[2]/A[2],y}},13140:y=>{y.exports=function(y,c){return y[0]*c[0]+y[1]*c[1]+y[2]*c[2]}},13106:y=>{y.exports=1e-6},13150:(y,c,A)=>{y.exports=function(y,c){var A=y[0],w=y[1],N=y[2],p=c[0],W=c[1],h=c[2];return Math.abs(A-p)<=l*Math.max(1,Math.abs(A),Math.abs(p))&&Math.abs(w-W)<=l*Math.max(1,Math.abs(w),Math.abs(W))&&Math.abs(N-h)<=l*Math.max(1,Math.abs(N),Math.abs(h))};var l=A(13106)},13152:y=>{y.exports=function(y,c){return y[0]===c[0]&&y[1]===c[1]&&y[2]===c[2]}},13217:y=>{y.exports=function(y,c){return y[0]=Math.floor(c[0]),y[1]=Math.floor(c[1]),y[2]=Math.floor(c[2]),y}},13341:(y,c,A)=>{y.exports=function(y,c,A,w,N,p){var W,h;c||(c=3);A||(A=0);h=w?Math.min(w*c+A,y.length):y.length;for(W=A;W<h;W+=c)l[0]=y[W],l[1]=y[W+1],l[2]=y[W+2],N(l,l,p),y[W]=l[0],y[W+1]=l[1],y[W+2]=l[2];return y};var l=A(13113)()},13129:y=>{y.exports=function(y,c,A){var l=new Float32Array(3);return l[0]=y,l[1]=c,l[2]=A,l}},13103:(y,c,A)=>{y.exports={EPSILON:A(13106),create:A(13113),clone:A(13120),angle:A(13122),zW:A(13129),j:A(13143),set:A(13147),equals:A(13150),exactEquals:A(13152),add:A(13155),xc:A(13162),sub:A(13168),multiply:A(13174),mul:A(13180),divide:A(13189),div:A(13198),min:A(13206),max:A(13213),floor:A(13217),ceil:A(13220),round:A(13228),scale:A(13237),SW:A(13239),distance:A(13246),i:A(13250),squaredDistance:A(13252),sqrDist:A(13256),length:A(13265),len:A(13268),squaredLength:A(13271),MW:A(13280),negate:A(13283),inverse:A(13286),normalize:A(13133),dot:A(13140),cross:A(13289),PW:A(13296),random:A(13303),transformMat4:A(13312),transformMat3:A(13315),transformQuat:A(13320),kW:A(13324),aW:A(13328),uW:A(13333),forEach:A(13341)}},13286:y=>{y.exports=function(y,c){return y[0]=1/c[0],y[1]=1/c[1],y[2]=1/c[2],y}},13268:(y,c,A)=>{y.exports=A(13265)},13265:y=>{y.exports=function(y){var c=y[0],A=y[1],l=y[2];return Math.sqrt(c*c+A*A+l*l)}},13296:y=>{y.exports=function(y,c,A,l){var w=c[0],N=c[1],p=c[2];return y[0]=w+l*(A[0]-w),y[1]=N+l*(A[1]-N),y[2]=p+l*(A[2]-p),y}},13213:y=>{y.exports=function(y,c,A){return y[0]=Math.max(c[0],A[0]),y[1]=Math.max(c[1],A[1]),y[2]=Math.max(c[2],A[2]),y}},13206:y=>{y.exports=function(y,c,A){return y[0]=Math.min(c[0],A[0]),y[1]=Math.min(c[1],A[1]),y[2]=Math.min(c[2],A[2]),y}},13180:(y,c,A)=>{y.exports=A(13174)},13174:y=>{y.exports=function(y,c,A){return y[0]=c[0]*A[0],y[1]=c[1]*A[1],y[2]=c[2]*A[2],y}},13283:y=>{y.exports=function(y,c){return y[0]=-c[0],y[1]=-c[1],y[2]=-c[2],y}},13133:y=>{y.exports=function(y,c){var A=c[0],l=c[1],w=c[2],N=A*A+l*l+w*w;N>0&&(N=1/Math.sqrt(N),y[0]=c[0]*N,y[1]=c[1]*N,y[2]=c[2]*N);return y}},13303:y=>{y.exports=function(y,c){c=c||1;var A=2*Math.random()*Math.PI,l=2*Math.random()-1,w=Math.sqrt(1-l*l)*c;return y[0]=Math.cos(A)*w,y[1]=Math.sin(A)*w,y[2]=l*c,y}},13324:y=>{y.exports=function(y,c,A,l){var w=A[1],N=A[2],p=c[1]-w,W=c[2]-N,h=Math.sin(l),I=Math.cos(l);return y[0]=c[0],y[1]=w+p*I-W*h,y[2]=N+p*h+W*I,y}},13328:y=>{y.exports=function(y,c,A,l){var w=A[0],N=A[2],p=c[0]-w,W=c[2]-N,h=Math.sin(l),I=Math.cos(l);return y[0]=w+W*h+p*I,y[1]=c[1],y[2]=N+W*I-p*h,y}},13333:y=>{y.exports=function(y,c,A,l){var w=A[0],N=A[1],p=c[0]-w,W=c[1]-N,h=Math.sin(l),I=Math.cos(l);return y[0]=w+p*I-W*h,y[1]=N+p*h+W*I,y[2]=c[2],y}},13228:y=>{y.exports=function(y,c){return y[0]=Math.round(c[0]),y[1]=Math.round(c[1]),y[2]=Math.round(c[2]),y}},13237:y=>{y.exports=function(y,c,A){return y[0]=c[0]*A,y[1]=c[1]*A,y[2]=c[2]*A,y}},13239:y=>{y.exports=function(y,c,A,l){return y[0]=c[0]+A[0]*l,y[1]=c[1]+A[1]*l,y[2]=c[2]+A[2]*l,y}},13147:y=>{y.exports=function(y,c,A,l){return y[0]=c,y[1]=A,y[2]=l,y}},13256:(y,c,A)=>{y.exports=A(13252)},13280:(y,c,A)=>{y.exports=A(13271)},13252:y=>{y.exports=function(y,c){var A=c[0]-y[0],l=c[1]-y[1],w=c[2]-y[2];return A*A+l*l+w*w}},13271:y=>{y.exports=function(y){var c=y[0],A=y[1],l=y[2];return c*c+A*A+l*l}},13168:(y,c,A)=>{y.exports=A(13162)},13162:y=>{y.exports=function(y,c,A){return y[0]=c[0]-A[0],y[1]=c[1]-A[1],y[2]=c[2]-A[2],y}},13315:y=>{y.exports=function(y,c,A){var l=c[0],w=c[1],N=c[2];return y[0]=l*A[0]+w*A[3]+N*A[6],y[1]=l*A[1]+w*A[4]+N*A[7],y[2]=l*A[2]+w*A[5]+N*A[8],y}},13312:y=>{y.exports=function(y,c,A){var l=c[0],w=c[1],N=c[2],p=A[3]*l+A[7]*w+A[11]*N+A[15];return p=p||1,y[0]=(A[0]*l+A[4]*w+A[8]*N+A[12])/p,y[1]=(A[1]*l+A[5]*w+A[9]*N+A[13])/p,y[2]=(A[2]*l+A[6]*w+A[10]*N+A[14])/p,y}},13320:y=>{y.exports=function(y,c,A){var l=c[0],w=c[1],N=c[2],p=A[0],W=A[1],h=A[2],I=A[3],q=I*l+W*N-h*w,o=I*w+h*l-p*N,O=I*N+p*w-W*l,L=-p*l-W*w-h*N;return y[0]=q*I+L*-p+o*-h-O*-W,y[1]=o*I+L*-W+O*-p-q*-h,y[2]=O*I+L*-h+q*-W-o*-p,y}},14210:y=>{"use strict";y.exports=function(y){for(var c=new Array(y),A=0;A<y;++A)c[A]=A;return c}},14283:y=>{y.exports=function(y){return null!=y&&null!=y.constructor&&"function"===typeof y.constructor.isBuffer&&y.constructor.isBuffer(y)}},14516:(y,c,A)=>{"use strict";A.d(c,{c:()=>l});class l{constructor(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.io=!1,this.Ho=!1,this.Oo=30,this.Lo=0,this.mO=!1,this.fullscreen=!1,this.Do=function(y){},this.so=function(){},this.Co=function(){},this.Pc=function(){},this.Bo=function(y){},this.onFullscreenChanged=function(y){},I((()=>{!function(y,c){y._nowObject=performance||Date,y._lastTick=0,y._renderAccum=0,y._rt=0,y._frameCB=W.bind(null,y),requestAnimationFrame(y._frameCB),c>0&&(y._intervalCB=p.bind(null,y),y._interval=setInterval(y._intervalCB,Math.max(c,1e3/y.Oo/2)))}(this,c),function(y,c){if(!c)return;var A=!1,l=!1;document.addEventListener("pointerlockchange",(l=>{A=document.pointerLockElement===c,y.Bo(A)})),document.addEventListener("fullscreenchange",(A=>{l=document.fullscreenElement===c,y.onFullscreenChanged(l)})),Object.defineProperty(y,"mO",{get:()=>A,set:y=>{y&&!A?h(c):A&&!y&&function(y){y.exitPointerLock&&y.exitPointerLock()}(document)}}),Object.defineProperty(y,"fullscreen",{get:()=>l,set:y=>{y&&!l?c.requestFullscreen():l&&!y&&document.exitFullscreen()}}),c.addEventListener("click",(w=>{y.io&&!A&&h(c),y.Ho&&!l&&c.requestFullscreen()}));var w=()=>y.Pc();if(window.ResizeObserver){new ResizeObserver(w).observe(c)}else window.addEventListener("resize",w)}(this,y),this.Co()}))}}var w=3,N=20;function p(y){for(var c=1e3/y.Oo,A=y._nowObject.now()+N,l=0;y._nowObject.now()>=y._lastTick+c&&y._nowObject.now()<A&&++l<=w;)y.Do(c),y._lastTick+=c;var p=5*(c+5),W=y._nowObject.now();if(W-y._lastTick>p)for(;W>=y._lastTick+c;)y._lastTick+=c}function W(y){requestAnimationFrame(y._frameCB),p(y);var c=y._nowObject.now(),A=c-y._rt;if(y._rt=c,y.Lo>0){y._renderAccum+=A;var l=1e3/y.Lo;if(y._renderAccum<l)return;y._renderAccum=Math.min(y._renderAccum-l,l)}var w=1e3/y.Oo,N=(c-y._lastTick)/w;y.so(A,N,w)}function h(y){y.requestPointerLock&&y.requestPointerLock()}var I=y=>{if("loading"===document.readyState){var c=()=>{document.removeEventListener("readystatechange",c),y()};document.addEventListener("readystatechange",c)}else setTimeout(y,1)}},14203:(y,c,A)=>{var l=A(14210),w=A(14218),N="undefined"!==typeof Float64Array;function p(y,c){return y[0]-c[0]}function W(){var y,c=this.stride,A=new Array(c.length);for(y=0;y<A.length;++y)A[y]=[Math.abs(c[y]),y];A.sort(p);var l=new Array(A.length);for(y=0;y<l.length;++y)l[y]=A[y][1];return l}function h(y,c){var A=["View",c,"d",y].join("");c<0&&(A="View_Nil"+y);var w="generic"===y;if(-1===c){var N="function "+A+"(a){this.data=a;};var proto="+A+".prototype;proto.dtype='"+y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+A+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+A+"(a){return new "+A+"(a);}";return new Function(N)()}if(0===c){N="function "+A+"(a,d) {this.data = a;this.offset = d};var proto="+A+".prototype;proto.dtype='"+y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+A+"_copy() {return new "+A+"(this.data,this.offset)};proto.pick=function "+A+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+A+"_get(){return "+(w?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+A+"_set(v){return "+(w?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+A+"(a,b,c,d){return new "+A+"(a,d)}";return new Function("TrivialArray",N)(I[y][0])}N=["'use strict'"];var p=l(c),h=p.map((function(y){return"i"+y})),q="this.offset+"+p.map((function(y){return"this.stride["+y+"]*i"+y})).join("+"),o=p.map((function(y){return"b"+y})).join(","),O=p.map((function(y){return"c"+y})).join(",");N.push("function "+A+"(a,"+o+","+O+",d){this.data=a","this.shape=["+o+"]","this.stride=["+O+"]","this.offset=d|0}","var proto="+A+".prototype","proto.dtype='"+y+"'","proto.dimension="+c),N.push("Object.defineProperty(proto,'size',{get:function "+A+"_size(){return "+p.map((function(y){return"this.shape["+y+"]"})).join("*"),"}})"),1===c?N.push("proto.order=[0]"):(N.push("Object.defineProperty(proto,'order',{get:"),c<4?(N.push("function "+A+"_order(){"),2===c?N.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&N.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):N.push("ORDER})")),N.push("proto.set=function "+A+"_set("+h.join(",")+",v){"),w?N.push("return this.data.set("+q+",v)}"):N.push("return this.data["+q+"]=v}"),N.push("proto.get=function "+A+"_get("+h.join(",")+"){"),w?N.push("return this.data.get("+q+")}"):N.push("return this.data["+q+"]}"),N.push("proto.index=function "+A+"_index(",h.join(),"){return "+q+"}"),N.push("proto.hi=function "+A+"_hi("+h.join(",")+"){return new "+A+"(this.data,"+p.map((function(y){return["(typeof i",y,"!=='number'||i",y,"<0)?this.shape[",y,"]:i",y,"|0"].join("")})).join(",")+","+p.map((function(y){return"this.stride["+y+"]"})).join(",")+",this.offset)}");var L=p.map((function(y){return"a"+y+"=this.shape["+y+"]"})),i=p.map((function(y){return"c"+y+"=this.stride["+y+"]"}));N.push("proto.lo=function "+A+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+L.join(",")+","+i.join(","));for(var H=0;H<c;++H)N.push("if(typeof i"+H+"==='number'&&i"+H+">=0){d=i"+H+"|0;b+=c"+H+"*d;a"+H+"-=d}");N.push("return new "+A+"(this.data,"+p.map((function(y){return"a"+y})).join(",")+","+p.map((function(y){return"c"+y})).join(",")+",b)}"),N.push("proto.step=function "+A+"_step("+h.join(",")+"){var "+p.map((function(y){return"a"+y+"=this.shape["+y+"]"})).join(",")+","+p.map((function(y){return"b"+y+"=this.stride["+y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(H=0;H<c;++H)N.push("if(typeof i"+H+"==='number'){d=i"+H+"|0;if(d<0){c+=b"+H+"*(a"+H+"-1);a"+H+"=ceil(-a"+H+"/d)}else{a"+H+"=ceil(a"+H+"/d)}b"+H+"*=d}");N.push("return new "+A+"(this.data,"+p.map((function(y){return"a"+y})).join(",")+","+p.map((function(y){return"b"+y})).join(",")+",c)}");var P=new Array(c),D=new Array(c);for(H=0;H<c;++H)P[H]="a[i"+H+"]",D[H]="b[i"+H+"]";N.push("proto.transpose=function "+A+"_transpose("+h+"){"+h.map((function(y,c){return y+"=("+y+"===undefined?"+c+":"+y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+A+"(this.data,"+P.join(",")+","+D.join(",")+",this.offset)}"),N.push("proto.pick=function "+A+"_pick("+h+"){var a=[],b=[],c=this.offset");for(H=0;H<c;++H)N.push("if(typeof i"+H+"==='number'&&i"+H+">=0){c=(c+this.stride["+H+"]*i"+H+")|0}else{a.push(this.shape["+H+"]);b.push(this.stride["+H+"])}");return N.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),N.push("return function construct_"+A+"(data,shape,stride,offset){return new "+A+"(data,"+p.map((function(y){return"shape["+y+"]"})).join(",")+","+p.map((function(y){return"stride["+y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",N.join("\n"))(I[y],W)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};y.exports=function(y,c,A,l){if(void 0===y)return(0,I.array[0])([]);"number"===typeof y&&(y=[y]),void 0===c&&(c=[y.length]);var p=c.length;if(void 0===A){A=new Array(p);for(var W=p-1,q=1;W>=0;--W)A[W]=q,q*=c[W]}if(void 0===l){l=0;for(W=0;W<p;++W)A[W]<0&&(l-=(c[W]-1)*A[W])}for(var o=function(y){if(w(y))return"buffer";if(N)switch(Object.prototype.toString.call(y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(y)?"array":"generic"}(y),O=I[o];O.length<=p+1;)O.push(h(o,O.length-1));return(0,O[p+1])(y,c,A,l)}},14218:y=>{function c(y){return!!y.constructor&&"function"===typeof y.constructor.isBuffer&&y.constructor.isBuffer(y)}y.exports=function(y){return null!=y&&(c(y)||function(y){return"function"===typeof y.readFloatLE&&"function"===typeof y.slice&&c(y.slice(0,0))}(y)||!!y._isBuffer)}},14374:y=>{"use strict";var c=[],A=[],l=[],w=[],N=[],p=[],W=[],h=[],I=[],q=[],o=[],O=[];y.exports=function(y,L,i,H,P,D){for(var t=W,s=I,B=q,X=O,C=0;C<3;C++)t[C]=+i[C],B[C]=+L.max[C],s[C]=+L.base[C];D||(D=1e-10);var K=function(y,W,I,q,O,L){var i=c,H=A,P=l,D=w,t=N,s=p,B=h,X=Math.floor,C=0,K=0,my=0,T=0,z=0;if(S(),0===my)return 0;for(T=a();K<=my;){if(M(T)&&k())return C;T=a()}for(C+=my,z=0;z<3;z++)q[z]+=I[z],O[z]+=I[z];return C;function S(){if(K=0,0!==(my=Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2])))for(var y=0;y<3;y++){var c=I[y]>=0;D[y]=c?1:-1;var A=c?O[y]:q[y];i[y]=c?q[y]:O[y],H[y]=u(A,D[y]),P[y]=G(i[y],D[y]),B[y]=I[y]/my,t[y]=Math.abs(1/B[y]);var l=c?H[y]+1-A:A-H[y];s[y]=t[y]<1/0?t[y]*l:1/0}}function M(c){for(var A=D[0],l=0===c?H[0]:P[0],w=H[0]+A,N=D[1],p=1===c?H[1]:P[1],W=H[1]+N,h=D[2],I=2===c?H[2]:P[2],q=H[2]+h,o=l;o!=w;o+=A)for(var O=p;O!=W;O+=N)for(var L=I;L!=q;L+=h)if(y(o,O,L))return!0;return!1}function k(){C+=K;var y=D[T],c=K/my,A=o;for(z=0;z<3;z++){var l=I[z]*c;q[z]+=l,O[z]+=l,A[z]=I[z]-l}if(y>0?O[T]=Math.round(O[T]):q[T]=Math.round(q[T]),W(C,T,y,A))return!0;for(z=0;z<3;z++)I[z]=A[z];return S(),0===my}function a(){var y=s[0]<s[1]?s[0]<s[2]?0:2:s[1]<s[2]?1:2,c=s[y]-K;for(K=s[y],H[y]+=D[y],s[y]+=t[y],z=0;z<3;z++)i[z]+=c*B[z],P[z]=G(i[z],D[z]);return y}function u(y,c){return X(y-c*L)}function G(y,c){return X(y+c*L)}}(y,H,t,s,B,D);if(!P){for(C=0;C<3;C++)X[C]=i[C]>0?B[C]-L.max[C]:s[C]-L.base[C];L.translate(X)}return K}},14551:(y,c,A)=>{"use strict";A.d(c,{d:()=>o});var l=A(14365),w=A(13103);class N{constructor(y,c,A,N,p,W,h){this.Oq=new l(y.base,y.Mq),this.Lw=c,this.friction=A,this.restitution=N,this.IW=p,this.FL=W,this.qW=!!h,this.Sq=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.fi=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.YI=w.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=w.create(),this._impulses=w.create(),this._sleepFrameCount=10}loadFromCopy(y){w.j(this.Oq.base,y.Oq.base),w.j(this.Oq.Mq,y.Oq.Mq),w.j(this.Oq.max,y.Oq.max),this.Oq.mag=y.Oq.mag,this.Lw=y.Lw,this.friction=y.friction,this.restitution=y.restitution,this.IW=y.IW,this.FL=y.FL,this.qW=y.qW,this.Sq=y.Sq,this.fluidDrag=y.fluidDrag,this.fi=y.fi,this.preventFallOffEdge=y.preventFallOffEdge,this.rolledBackLastTick=y.rolledBackLastTick,w.j(this.YI,y.YI),w.j(this.resting,y.resting),this.inFluid=y.inFluid,this._ratioInFluid=y._ratioInFluid,w.j(this._forces,y._forces),w.j(this._impulses,y._impulses),this._sleepFrameCount=y._sleepFrameCount}setPosition(y){p(y),w.xc(y,y,this.Oq.base),this.Oq.translate(y),this.FI()}Dc(){return w.clone(this.Oq.base)}applyForce(y){p(y),w.add(this._forces,this._forces,y),this.FI()}applyImpulse(y){p(y),w.add(this._impulses,this._impulses,y),this.FI()}FI(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var p=y=>{};var W=A(14365),h=A(13103),I=A(14374);function q(){this.Sq=.1,this.fluidDrag=.4,this.HW=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function o(y,c,A){y=Object.assign(new q,y),this.gravity=y.gravity||[0,-10,0],this.Sq=y.Sq||.1,this.HW=y.HW||2,this.fluidDrag=y.fluidDrag||.4,this.minBounceImpulse=y.minBounceImpulse,this.bodies=[],this.LL=y.LL,this.testSolid=c,this.testFluid=A}o.prototype.vL=function(y,c,A,l,w,p){y=y||new W([0,0,0],[1,1,1]),"undefined"==typeof c&&(c=1),"undefined"==typeof A&&(A=1),"undefined"==typeof l&&(l=0),"undefined"==typeof w&&(w=1);var h=new N(y,c,A,l,w,p);return this.bodies.push(h),h},o.prototype.dL=function(y){var c=this.bodies.indexOf(y);c<0||(this.bodies.splice(c,1),y.Oq=y.FL=null)};var O=h.create(),L=h.create(),i=h.create(),H=h.create(),P=h.create(),D=h.create(),t=h.create(),s=new W([0,0,0],[1,1,1]),B=new N(s,1,1,0,1,(()=>{}),!1);function X(y,c,A){return c=A,c*=1-(1-y.ratioInFluid)**2}o.prototype.VW=function(y){y/=1e3;var c=U(0,h.squaredLength(this.gravity));this.bodies.forEach((A=>function(y,c,A,l){h.j(P,c.resting),y.LL&&B.loadFromCopy(c);if(c.Lw<=0)return h.set(c.YI,0,0,0),h.set(c._forces,0,0,0),void h.set(c._impulses,0,0,0);var w=l||0===c.IW;if(function(y,c,A,l){if(c._sleepFrameCount>0)return!1;if(l)return!0;var w=!1,N=.5*A*A*c.IW;return h.scale(J,y.gravity,N),I(y.testSolid,c.Oq,J,(function(){return w=!0,!0}),!0),w}(y,c,A,w))return;c._sleepFrameCount--,function(y,c){var A=c.Oq,l=Math.floor(A.base[0]),w=Math.floor(A.base[2]),N=Math.floor(A.base[1]),p=Math.floor(A.max[1]);if(!y.testFluid(l,N,w))return c.inFluid=!1,void(c.ratioInFluid=0);var W=1,I=N+1;for(;I<=p&&y.testFluid(l,I,w);)W++,I++;var q=(N+W-A.base[1])/A.Mq[1];q>1&&(q=1);var o=A.Mq[0]*A.Mq[1]*A.Mq[2]*q,O=K;h.scale(O,y.gravity,-y.HW*o*c.IW),c.applyForce(O),c.inFluid=!0,c.ratioInFluid=q}(y,c),Q(c._forces),Q(c._impulses),Q(c.YI),Q(c.resting),h.scale(O,c._forces,1/c.Lw),h.SW(O,O,y.gravity,c.IW),h.scale(L,c._impulses,1/c.Lw),h.SW(L,L,O,A),h.add(c.YI,c.YI,L),c.friction&&(my(y,0,c,L,A),my(y,1,c,L,A),my(y,2,c,L,A));var N=c.fluidDrag>=0?c.fluidDrag:y.fluidDrag,p=c.Sq>=0?c.Sq:y.Sq,W=p,q=p;c.inFluid&&(W=X(c,W,c.fluidDragHoriz>=0?c.fluidDragHoriz:N),q=X(c,q,c.fluidDragVert>=0?c.fluidDragVert:N));W=Math.max(1-W*A/c.Lw,0),q=Math.max(1-q*A/c.Lw,0),h.set(C,W,q,W),h.multiply(c.YI,c.YI,C),h.scale(i,c.YI,A),h.set(c._forces,0,0,0),h.set(c._impulses,0,0,0),c.qW&&e(S,c.Oq);h.j(D,i),h.set(t,0,0,0),c.preventFallOffEdge&&function(y,c,A,l){if(!c.resting[1]||A[1]>0)return;var w=j;e(w,c.Oq);for(var N=0;N<3;N+=2){h.set(G,0,0,0),G[N]=A[N];var p=!0;(p=(p=(p=(p=p&&!V(y,w.base[0]+G[0]+1e-5,w.base[1],w.base[2]+G[2]+1e-5))&&!V(y,w.max[0]+G[0]-1e-5,w.base[1],w.base[2]+G[2]+1e-5))&&!V(y,w.base[0]+G[0]+1e-5,w.base[1],w.max[2]+G[2]-1e-5))&&!V(y,w.max[0]+G[0]-1e-5,w.base[1],w.max[2]+G[2]-1e-5))?(l[N]=A[N]>0?1:-1,A[N]=0):0===N&&(h.set(f,A[0],0,0),z(y,w,f,l,c.slideOnCollision))}}(y,c,i,t);z(y,c.Oq,i,c.resting,c.slideOnCollision),c.qW&&function(y,c,A,l){if(c.resting[1]>=0&&!c.inFluid)return;var w=0!==c.resting[0],N=0!==c.resting[2];if(!w&&!N)return;var p=Math.abs(l[0]/l[2]),W=4;if(!w&&p>W)return;if(!N&&p<1/W)return;h.add(k,A.base,l);var q=y.testSolid;I(q,A,l,(function(y,c,A,l){if(1!==c)return!0;l[c]=0}));var o=A.base[1],O=c.inFluid?1.951:1.001,L=Math.floor(o+O)-o;h.set(a,0,L,0);var i=!1;if(I(q,A,a,(function(y,c,A,l){return i=!0,!0})),i)return;h.xc(u,k,A.base),u[1]=0,z(y,A,u,M,!0);var H=U(A.base[0],k[0]),P=U(A.base[2],k[2]);if(w&&!H&&(!P||!N))return;if(N&&(!H||!w)&&!P)return;var D=!0;if(D=D&&!V(y,A.base[0]+1e-5,A.base[1],A.base[2]+1e-5),D=D&&!V(y,A.max[0]-1e-5,A.base[1],A.base[2]+1e-5),D=D&&!V(y,A.base[0]+1e-5,A.base[1],A.max[2]-1e-5),D=D&&!V(y,A.max[0]-1e-5,A.base[1],A.max[2]-1e-5),D)return;e(c.Oq,A),c.resting[0]=M[0],c.resting[2]=M[2],c.fi&&c.fi()}(y,c,S,D);for(var o=0;o<3;++o)c.resting[o]=c.resting[o]||t[o],H[o]=0,c.resting[o]&&(P[o]||(H[o]=-c.YI[o]),c.YI[o]=0);var s=h.length(H);s>.001&&(h.scale(H,H,c.Lw),c.FL&&c.FL(H),c.restitution>0&&s>y.minBounceImpulse&&(h.scale(H,H,c.restitution),c.applyImpulse(H)));var T=h.squaredLength(c.YI);T>1e-5&&c.FI();y.LL&&y.LL(c)?(c.loadFromCopy(B),c.rolledBackLastTick=!0):c.rolledBackLastTick=!1}(this,A,y,c)))};var C=h.create([0,0,0]);var K=h.create();function my(y,c,A,l,w){var N=A.resting[c],p=l[c];if(!A.alwaysApplyHorizFriction||1!==c){if(0===N)return;if(N*p<=0)return}h.j(T,A.YI),T[c]=0;var W=h.length(T);if(!U(W,0)){var I=Math.abs(A.friction*y.gravity[c]*w),q=W>I?(W-I)/W:0;A.YI[(c+1)%3]*=q,A.YI[(c+2)%3]*=q}}var T=h.create();function z(y,c,A,l,w){return h.set(l,0,0,0),I(y.testSolid,c,A,(function(y,c,A,N){l[c]=A,N[c]=0,w||(N[0]=0,N[1]=0,N[2]=0)}))}var S=new W([],[]),M=h.create(),k=h.create(),a=h.create(),u=h.create();var G=h.create(),j=new W([],[]),f=h.create();function V(y,c,A,l){return y.testSolid(Math.floor(c),Math.floor(A-1),Math.floor(l))}var J=h.create();function U(y,c){return Math.abs(y-c)<1e-5}function e(y,c){for(var A=0;A<3;A++)y.base[A]=c.base[A],y.max[A]=c.max[A],y.Mq[A]=c.Mq[A]}var Q=function(y){}},12980:function(y,c){!function(y){"use strict";var c=function(y,A){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,c){y.__proto__=c}||function(y,c){for(var A in c)Object.prototype.hasOwnProperty.call(c,A)&&(y[A]=c[A])},c(y,A)};function A(y,A){if("function"!==typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function l(){this.constructor=y}c(y,A),y.prototype=null===A?Object.create(A):(l.prototype=A.prototype,new l)}function l(y,c,A,l){var w,N=arguments.length,p=N<3?c:null===l?l=Object.getOwnPropertyDescriptor(c,A):l;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)p=Reflect.decorate(y,c,A,l);else for(var W=y.length-1;W>=0;W--)(w=y[W])&&(p=(N<3?w(p):N>3?w(c,A,p):w(c,A))||p);return N>3&&p&&Object.defineProperty(c,A,p),p}function w(y,c,A){if(A||2===arguments.length)for(var l,w=0,N=c.length;w<N;w++)!l&&w in c||(l||(l=Array.prototype.slice.call(c,0,w)),l[w]=c[w]);return y.concat(l||Array.prototype.slice.call(c))}var N,p=255,W=213;y.OPERATION=void 0,(N=y.OPERATION||(y.OPERATION={}))[N.ADD=128]="ADD",N[N.REPLACE=0]="REPLACE",N[N.DELETE=64]="DELETE",N[N.DELETE_AND_ADD=192]="DELETE_AND_ADD",N[N.TOUCH=1]="TOUCH",N[N.CLEAR=10]="CLEAR";var h=function(){function c(y,c,A){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=y,this.setParent(c,A)}return c.prototype.setParent=function(y,c,A){var l=this;if(this.indexes||(this.indexes=this.ref instanceof uy?this.ref._definition.indexes:{}),this.parent=y,this.parentIndex=A,c)if(this.root=c,this.ref instanceof uy){var w=this.ref._definition;for(var N in w.schema){var p=this.ref[N];if(p&&p.$changes){var W=w.indexes[N];p.$changes.setParent(this.ref,c,W)}}}else"object"===typeof this.ref&&this.ref.forEach((function(y,c){if(y instanceof uy){var A=y.$changes,w=l.ref.$changes.indexes[c];A.setParent(l.ref,l.root,w)}}))},c.prototype.operation=function(y){this.changes.set(--this.currentCustomOperation,y)},c.prototype.change=function(c,A){void 0===A&&(A=y.OPERATION.ADD);var l="number"===typeof c?c:this.indexes[c];this.assertValidIndex(l,c);var w=this.changes.get(l);w&&w.op!==y.OPERATION.DELETE&&w.op!==y.OPERATION.TOUCH||this.changes.set(l,{op:w&&w.op===y.OPERATION.DELETE?y.OPERATION.DELETE_AND_ADD:A,index:l}),this.allChanges.add(l),this.changed=!0,this.touchParents()},c.prototype.touch=function(c){var A="number"===typeof c?c:this.indexes[c];this.assertValidIndex(A,c),this.changes.has(A)||this.changes.set(A,{op:y.OPERATION.TOUCH,index:A}),this.allChanges.add(A),this.touchParents()},c.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},c.prototype.getType=function(y){if(this.ref._definition)return(c=this.ref._definition).schema[c.fieldsByIndex[y]];var c,A=(c=this.parent._definition).schema[c.fieldsByIndex[this.parentIndex]];return Object.values(A)[0]},c.prototype.getChildrenFilter=function(){var y=this.parent._definition.childFilters;return y&&y[this.parentIndex]},c.prototype.getValue=function(y){return this.ref.getByIndex(y)},c.prototype.delete=function(c){var A="number"===typeof c?c:this.indexes[c];if(void 0!==A){var l=this.getValue(A);this.changes.set(A,{op:y.OPERATION.DELETE,index:A}),this.allChanges.delete(A),delete this.caches[A],l&&l.$changes&&(l.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(c," (").concat(A,")"))},c.prototype.discard=function(c,A){var l=this;void 0===c&&(c=!1),void 0===A&&(A=!1),this.ref instanceof uy||this.changes.forEach((function(c){if(c.op===y.OPERATION.DELETE){var A=l.ref.getIndex(c.index);delete l.indexes[A]}})),this.changes.clear(),this.changed=c,A&&this.allChanges.clear(),this.currentCustomOperation=0},c.prototype.discardAll=function(){var y=this;this.changes.forEach((function(c){var A=y.getValue(c.index);A&&A.$changes&&A.$changes.discardAll()})),this.discard()},c.prototype.cache=function(y,c){this.caches[y]=c},c.prototype.clone=function(){return new c(this.ref,this.parent,this.root)},c.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},c.prototype.assertValidIndex=function(y,c){if(void 0===y)throw new Error('ChangeTree: missing index for field "'.concat(c,'"'))},c}();function I(y,c,A,l){return y[c]||(y[c]=[]),y[c].push(A),null===l||void 0===l||l.forEach((function(y,c){return A(y,c)})),function(){return o(y[c],y[c].indexOf(A))}}function q(c){var A=this,l="string"!==typeof this.$changes.getType();this.$items.forEach((function(w,N){c.push({refId:A.$changes.refId,op:y.OPERATION.DELETE,field:N,value:void 0,previousValue:w}),l&&A.$changes.root.removeRef(w.$changes.refId)}))}function o(y,c){if(-1===c||c>=y.length)return!1;for(var A=y.length-1,l=c;l<A;l++)y[l]=y[l+1];return y.length=A,!0}var O=function(y,c){var A=y.toString(),l=c.toString();return A<l?-1:A>l?1:0};function L(y){return y.$proxy=!0,y=new Proxy(y,{get:function(y,c){return"symbol"===typeof c||isNaN(c)?y[c]:y.at(c)},set:function(y,c,A){if("symbol"===typeof c||isNaN(c))y[c]=A;else{var l=Array.from(y.$items.keys()),w=parseInt(l[c]||c);void 0===A||null===A?y.deleteAt(w):y.setAt(w,A)}return!0},deleteProperty:function(y,c){return"number"===typeof c?y.deleteAt(c):delete y[c],!0}})}var i=function(){function c(){for(var y=[],c=0;c<arguments.length;c++)y[c]=arguments[c];this.$changes=new h(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,y)}return c.prototype.FW=function(c,A){return void 0===A&&(A=!0),I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,c,A?this.$items:void 0)},c.prototype.Oc=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,c)},c.is=function(y){return Array.isArray(y)||void 0!==y.array},Object.defineProperty(c.prototype,"length",{get:function(){return this.$items.size},set:function(y){0===y?this.clear():this.splice(y,this.length-y)},enumerable:!1,configurable:!0}),c.prototype.push=function(){for(var y,c=this,A=[],l=0;l<arguments.length;l++)A[l]=arguments[l];return A.forEach((function(A){y=c.$refId++,c.setAt(y,A)})),y},c.prototype.pop=function(){var y=Array.from(this.$indexes.values()).pop();if(void 0!==y){this.$changes.delete(y),this.$indexes.delete(y);var c=this.$items.get(y);return this.$items.delete(y),c}},c.prototype.at=function(y){var c=Array.from(this.$items.keys())[y];return this.$items.get(c)},c.prototype.setAt=function(c,A){var l,w;if(void 0!==A&&null!==A){if(this.$items.get(c)!==A){void 0!==A.$changes&&A.$changes.setParent(this,this.$changes.root,c);var N=null!==(w=null===(l=this.$changes.indexes[c])||void 0===l?void 0:l.op)&&void 0!==w?w:y.OPERATION.ADD;this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,A),this.$changes.change(c,N)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},c.prototype.deleteAt=function(y){var c=Array.from(this.$items.keys())[y];return void 0!==c&&this.$deleteAt(c)},c.prototype.$deleteAt=function(y){return this.$changes.delete(y),this.$indexes.delete(y),this.$items.delete(y)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&q.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.concat=function(){for(var y,A=[],l=0;l<arguments.length;l++)A[l]=arguments[l];return new(c.bind.apply(c,w([void 0],(y=Array.from(this.$items.values())).concat.apply(y,A),!1)))},c.prototype.join=function(y){return Array.from(this.$items.values()).join(y)},c.prototype.reverse=function(){var y=this,c=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(A,l){y.setAt(c[l],A)})),this},c.prototype.shift=function(){var y=Array.from(this.$items.keys()).shift();if(void 0!==y){var c=this.$items.get(y);return this.$deleteAt(y),c}},c.prototype.slice=function(y,A){var l=new c;return l.push.apply(l,Array.from(this.$items.values()).slice(y,A)),l},c.prototype.sort=function(y){var c=this;void 0===y&&(y=O);var A=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(y).forEach((function(y,l){c.setAt(A[l],y)})),this},c.prototype.splice=function(y,c){void 0===c&&(c=this.length-y);for(var A=Array.from(this.$items.keys()),l=[],w=y;w<y+c;w++)l.push(this.$items.get(A[w])),this.$deleteAt(A[w]);return l},c.prototype.unshift=function(){for(var y=this,c=[],A=0;A<arguments.length;A++)c[A]=arguments[A];var l=this.length,w=c.length,N=Array.from(this.$items.values());return c.forEach((function(c,A){y.setAt(A,c)})),N.forEach((function(c,A){y.setAt(w+A,c)})),l+w},c.prototype.indexOf=function(y,c){return Array.from(this.$items.values()).indexOf(y,c)},c.prototype.lastIndexOf=function(y,c){return void 0===c&&(c=this.length-1),Array.from(this.$items.values()).lastIndexOf(y,c)},c.prototype.every=function(y,c){return Array.from(this.$items.values()).every(y,c)},c.prototype.some=function(y,c){return Array.from(this.$items.values()).some(y,c)},c.prototype.forEach=function(y,c){Array.from(this.$items.values()).forEach(y,c)},c.prototype.map=function(y,c){return Array.from(this.$items.values()).map(y,c)},c.prototype.filter=function(y,c){return Array.from(this.$items.values()).filter(y,c)},c.prototype.reduce=function(y,c){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},c.prototype.reduceRight=function(y,c){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},c.prototype.find=function(y,c){return Array.from(this.$items.values()).find(y,c)},c.prototype.findIndex=function(y,c){return Array.from(this.$items.values()).findIndex(y,c)},c.prototype.fill=function(y,c,A){throw new Error("ArraySchema#fill() not implemented")},c.prototype.copyWithin=function(y,c,A){throw new Error("ArraySchema#copyWithin() not implemented")},c.prototype.toString=function(){return this.$items.toString()},c.prototype.toLocaleString=function(){return this.$items.toLocaleString()},c.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},c.prototype.includes=function(y,c){return Array.from(this.$items.values()).includes(y,c)},c.prototype.flatMap=function(y,c){throw new Error("ArraySchema#flatMap() is not supported.")},c.prototype.flat=function(y){throw new Error("ArraySchema#flat() is not supported.")},c.prototype.findLast=function(){var y=Array.from(this.$items.values());return y.findLast.apply(y,arguments)},c.prototype.findLastIndex=function(){var y=Array.from(this.$items.values());return y.findLastIndex.apply(y,arguments)},c.prototype.setIndex=function(y,c){this.$indexes.set(y,c)},c.prototype.getIndex=function(y){return this.$indexes.get(y)},c.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},c.prototype.deleteByIndex=function(y){var c=this.$indexes.get(y);this.$items.delete(c),this.$indexes.delete(y)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){return this.toArray().map((function(y){return"function"===typeof y.toJSON?y.toJSON():y}))},c.prototype.clone=function(y){return y?new(c.bind.apply(c,w([void 0],Array.from(this.$items.values()),!1))):new(c.bind.apply(c,w([void 0],this.map((function(y){return y.$changes?y.clone():y})),!1)))},c}();function H(y){return y.$proxy=!0,y=new Proxy(y,{get:function(y,c){return"symbol"!==typeof c&&"undefined"===typeof y[c]?y.get(c):y[c]},set:function(y,c,A){return"symbol"!==typeof c&&-1===c.indexOf("$")&&"FW"!==c&&"Oc"!==c&&"onChange"!==c?y.set(c,A):y[c]=A,!0},deleteProperty:function(y,c){return y.delete(c),!0}})}var P=function(){function c(y){var A=this;if(this.$changes=new h(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,y)if(y instanceof Map||y instanceof c)y.forEach((function(y,c){return A.set(c,y)}));else for(var l in y)this.set(l,y[l])}return c.prototype.FW=function(c,A){return void 0===A&&(A=!0),I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,c,A?this.$items:void 0)},c.prototype.Oc=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,c)},c.is=function(y){return void 0!==y.map},c.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.set=function(c,A){if(void 0===A||null===A)throw new Error("MapSchema#set('".concat(c,"', ").concat(A,"): trying to set ").concat(A," value on '").concat(c,"'."));c=c.toString();var l="undefined"!==typeof this.$changes.indexes[c],w=l?this.$changes.indexes[c]:this.$refId++,N=l?y.OPERATION.REPLACE:y.OPERATION.ADD,p=void 0!==A.$changes;if(p&&A.$changes.setParent(this,this.$changes.root,w),l){if(!p&&this.$items.get(c)===A)return;p&&this.$items.get(c)!==A&&(N=y.OPERATION.ADD)}else this.$changes.indexes[c]=w,this.$indexes.set(w,c);return this.$items.set(c,A),this.$changes.change(c,N),this},c.prototype.get=function(y){return this.$items.get(y)},c.prototype.delete=function(y){return this.$changes.delete(y),this.$items.delete(y)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&q.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(y){return this.$items.has(y)},c.prototype.forEach=function(y){this.$items.forEach(y)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(y,c){this.$indexes.set(y,c)},c.prototype.getIndex=function(y){return this.$indexes.get(y)},c.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},c.prototype.deleteByIndex=function(y){var c=this.$indexes.get(y);this.$items.delete(c),this.$indexes.delete(y)},c.prototype.toJSON=function(){var y={};return this.forEach((function(c,A){y[A]="function"===typeof c.toJSON?c.toJSON():c})),y},c.prototype.clone=function(y){var A;return y?A=Object.assign(new c,this):(A=new c,this.forEach((function(y,c){y.$changes?A.set(c,y.clone()):A.set(c,y)}))),A},c}(),D={};function t(y,c){D[y]=c}function s(y){return D[y]}var B=function(){function y(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return y.create=function(c){var A=new y;return A.schema=Object.assign({},c&&c.schema||{}),A.indexes=Object.assign({},c&&c.indexes||{}),A.fieldsByIndex=Object.assign({},c&&c.fieldsByIndex||{}),A.descriptors=Object.assign({},c&&c.descriptors||{}),A.deprecated=Object.assign({},c&&c.deprecated||{}),A},y.prototype.addField=function(y,c){var A=this.getNextFieldIndex();this.fieldsByIndex[A]=y,this.indexes[y]=A,this.schema[y]=Array.isArray(c)?{array:c[0]}:c},y.prototype.hasField=function(y){return void 0!==this.indexes[y]},y.prototype.addFilter=function(y,c){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[y]]=c,this.indexesWithFilters.push(this.indexes[y]),!0},y.prototype.addChildrenFilter=function(y,c){var A=this.indexes[y],l=this.schema[y];if(s(Object.keys(l)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[A]=c,!0;console.warn("@filterChildren: field '".concat(y,"' can't have children. Ignoring filter."))},y.prototype.getChildrenFilter=function(y){return this.childFilters&&this.childFilters[this.indexes[y]]},y.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},y}();function X(y){return y._context&&y._context.useFilters}var C=function(){function y(){this.types={},this.schemas=new Map,this.useFilters=!1}return y.prototype.has=function(y){return this.schemas.has(y)},y.prototype.get=function(y){return this.types[y]},y.prototype.add=function(y,c){void 0===c&&(c=this.schemas.size),y._definition=B.create(y._definition),y._typeid=c,this.types[c]=y,this.schemas.set(y,c)},y.create=function(c){return void 0===c&&(c={}),function(A){return c.context||(c.context=new y),my(A,c)}},y}(),K=new C;function my(y,c){return void 0===c&&(c={}),function(A,l){var N=c.context||K,p=A.constructor;if(p._context=N,!y)throw new Error("".concat(p.name,': @type() reference provided for "').concat(l,"\" is undefined. Make sure you don't have any circular dependencies."));N.has(p)||N.add(p);var W=p._definition;if(W.addField(l,y),W.descriptors[l]){if(W.deprecated[l])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(l,"' definition on '").concat(p.name,"'.\nCheck @type() annotation"))}catch(D){var h=D.stack.split("\n")[4].trim();throw new Error("".concat(D.message," ").concat(h))}}var I=i.is(y),q=!I&&P.is(y);if("string"!==typeof y&&!uy.is(y)){var o=Object.values(y)[0];"string"===typeof o||N.has(o)||N.add(o)}if(c.manual)W.descriptors[l]={enumerable:!0,configurable:!0,writable:!0};else{var O="_".concat(l);W.descriptors[O]={enumerable:!1,configurable:!1,writable:!0},W.descriptors[l]={get:function(){return this[O]},set:function(y){y!==this[O]&&(void 0!==y&&null!==y?(!I||y instanceof i||(y=new(i.bind.apply(i,w([void 0],y,!1)))),!q||y instanceof P||(y=new P(y)),void 0===y.$proxy&&(q?y=H(y):I&&(y=L(y))),this.$changes.change(l),y.$changes&&y.$changes.setParent(this,this.$changes.root,this._definition.indexes[l])):this[O]&&this.$changes.delete(l),this[O]=y)},enumerable:!0,configurable:!0}}}}function T(y){return function(c,A){var l=c.constructor;l._definition.addFilter(A,y)&&(l._context.useFilters=!0)}}function z(y){return function(c,A){var l=c.constructor;l._definition.addChildrenFilter(A,y)&&(l._context.useFilters=!0)}}function S(y){return void 0===y&&(y=!0),function(c,A){var l=c.constructor._definition;l.deprecated[A]=!0,y&&(l.descriptors[A]={get:function(){throw new Error("".concat(A," is deprecated."))},set:function(y){},enumerable:!1,configurable:!0})}}function M(y,c,A){for(var l in void 0===A&&(A={}),A.context||(A.context=y._context||A.context||K),c)my(c[l],A)(y.prototype,l);return y}function k(y){for(var c=0,A=0,l=0,w=y.length;l<w;l++)(c=y.charCodeAt(l))<128?A+=1:c<2048?A+=2:c<55296||c>=57344?A+=3:(l++,A+=4);return A}function a(y,c,A){for(var l=0,w=0,N=A.length;w<N;w++)(l=A.charCodeAt(w))<128?y[c++]=l:l<2048?(y[c++]=192|l>>6,y[c++]=128|63&l):l<55296||l>=57344?(y[c++]=224|l>>12,y[c++]=128|l>>6&63,y[c++]=128|63&l):(w++,l=65536+((1023&l)<<10|1023&A.charCodeAt(w)),y[c++]=240|l>>18,y[c++]=128|l>>12&63,y[c++]=128|l>>6&63,y[c++]=128|63&l)}function u(y,c){y.push(255&c)}function G(y,c){y.push(255&c)}function j(y,c){y.push(255&c),y.push(c>>8&255)}function f(y,c){y.push(255&c),y.push(c>>8&255)}function V(y,c){y.push(255&c),y.push(c>>8&255),y.push(c>>16&255),y.push(c>>24&255)}function J(y,c){var A=c>>24,l=c>>16,w=c>>8,N=c;y.push(255&N),y.push(255&w),y.push(255&l),y.push(255&A)}function U(y,c){var A=Math.floor(c/Math.pow(2,32));J(y,c>>>0),J(y,A)}function e(y,c){var A=c/Math.pow(2,32)|0;J(y,c>>>0),J(y,A)}function Q(y,c){R(y,c)}function Y(y,c){r(y,c)}var g=new Int32Array(2),x=new Float32Array(g.buffer),F=new Float64Array(g.buffer);function R(y,c){x[0]=c,V(y,g[0])}function r(y,c){F[0]=c,V(y,g[0]),V(y,g[1])}function n(y,c){return G(y,c?1:0)}function E(y,c){c||(c="");var A=k(c),l=0;if(A<32)y.push(160|A),l=1;else if(A<256)y.push(217),G(y,A),l=2;else if(A<65536)y.push(218),f(y,A),l=3;else{if(!(A<4294967296))throw new Error("String too long");y.push(219),J(y,A),l=5}return a(y,y.length,c),l+A}function b(y,c){return isNaN(c)?b(y,0):isFinite(c)?c!==(0|c)?(y.push(203),r(y,c),9):c>=0?c<128?(G(y,c),1):c<256?(y.push(204),G(y,c),2):c<65536?(y.push(205),f(y,c),3):c<4294967296?(y.push(206),J(y,c),5):(y.push(207),e(y,c),9):c>=-32?(y.push(224|c+32),1):c>=-128?(y.push(208),u(y,c),2):c>=-32768?(y.push(209),j(y,c),3):c>=-2147483648?(y.push(210),V(y,c),5):(y.push(211),U(y,c),9):b(y,c>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var Z=Object.freeze({__proto__:null,utf8Write:a,int8:u,uint8:G,int16:j,uint16:f,int32:V,uint32:J,int64:U,uint64:e,float32:Q,float64:Y,writeFloat32:R,writeFloat64:r,boolean:n,string:E,number:b});function v(y,c,A){for(var l="",w=0,N=c,p=c+A;N<p;N++){var W=y[N];0!==(128&W)?192!==(224&W)?224!==(240&W)?240!==(248&W)?console.error("Invalid byte "+W.toString(16)):(w=(7&W)<<18|(63&y[++N])<<12|(63&y[++N])<<6|63&y[++N])>=65536?(w-=65536,l+=String.fromCharCode(55296+(w>>>10),56320+(1023&w))):l+=String.fromCharCode(w):l+=String.fromCharCode((15&W)<<12|(63&y[++N])<<6|63&y[++N]):l+=String.fromCharCode((31&W)<<6|63&y[++N]):l+=String.fromCharCode(W)}return l}function d(y,c){return yy(y,c)<<24>>24}function yy(y,c){return y[c.offset++]}function cy(y,c){return Ay(y,c)<<16>>16}function Ay(y,c){return y[c.offset++]|y[c.offset++]<<8}function ly(y,c){return y[c.offset++]|y[c.offset++]<<8|y[c.offset++]<<16|y[c.offset++]<<24}function wy(y,c){return ly(y,c)>>>0}function Ny(y,c){return Oy(y,c)}function py(y,c){return Ly(y,c)}function Wy(y,c){var A=wy(y,c);return ly(y,c)*Math.pow(2,32)+A}function hy(y,c){var A=wy(y,c);return wy(y,c)*Math.pow(2,32)+A}var Iy=new Int32Array(2),qy=new Float32Array(Iy.buffer),oy=new Float64Array(Iy.buffer);function Oy(y,c){return Iy[0]=ly(y,c),qy[0]}function Ly(y,c){return Iy[0]=ly(y,c),Iy[1]=ly(y,c),oy[0]}function iy(y,c){return yy(y,c)>0}function Hy(y,c){var A,l=y[c.offset++];l<192?A=31&l:217===l?A=yy(y,c):218===l?A=Ay(y,c):219===l&&(A=wy(y,c));var w=v(y,c.offset,A);return c.offset+=A,w}function Py(y,c){var A=y[c.offset];return A<192&&A>160||217===A||218===A||219===A}function Dy(y,c){var A=y[c.offset++];return A<128?A:202===A?Oy(y,c):203===A?Ly(y,c):204===A?yy(y,c):205===A?Ay(y,c):206===A?wy(y,c):207===A?hy(y,c):208===A?d(y,c):209===A?cy(y,c):210===A?ly(y,c):211===A?Wy(y,c):A>223?-1*(255-A+1):void 0}function ty(y,c){var A=y[c.offset];return A<128||A>=202&&A<=211}function sy(y,c){return y[c.offset]<160}function By(y,c){return y[c.offset-1]===p&&(y[c.offset]<128||y[c.offset]>=202&&y[c.offset]<=211)}var Xy=Object.freeze({__proto__:null,int8:d,uint8:yy,int16:cy,uint16:Ay,int32:ly,uint32:wy,float32:Ny,float64:py,int64:Wy,uint64:hy,readFloat32:Oy,readFloat64:Ly,boolean:iy,string:Hy,stringCheck:Py,number:Dy,numberCheck:ty,arrayCheck:sy,switchStructureCheck:By}),Cy=function(){function c(y){var c=this;this.$changes=new h(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,y&&y.forEach((function(y){return c.add(y)}))}return c.prototype.FW=function(c,A){return void 0===A&&(A=!0),I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,c,A?this.$items:void 0)},c.prototype.Oc=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,c)},c.is=function(y){return void 0!==y.collection},c.prototype.add=function(y){var c=this.$refId++;return void 0!==y.$changes&&y.$changes.setParent(this,this.$changes.root,c),this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,y),this.$changes.change(c),c},c.prototype.at=function(y){var c=Array.from(this.$items.keys())[y];return this.$items.get(c)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(y){for(var c,A,l=this.$items.entries();(A=l.next())&&!A.done;)if(y===A.value[1]){c=A.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&q.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(y){return Array.from(this.$items.values()).some((function(c){return c===y}))},c.prototype.forEach=function(y){var c=this;this.$items.forEach((function(A,l,w){return y(A,l,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(y,c){this.$indexes.set(y,c)},c.prototype.getIndex=function(y){return this.$indexes.get(y)},c.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},c.prototype.deleteByIndex=function(y){var c=this.$indexes.get(y);this.$items.delete(c),this.$indexes.delete(y)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var y=[];return this.forEach((function(c,A){y.push("function"===typeof c.toJSON?c.toJSON():c)})),y},c.prototype.clone=function(y){var A;return y?A=Object.assign(new c,this):(A=new c,this.forEach((function(y){y.$changes?A.add(y.clone()):A.add(y)}))),A},c}(),Ky=function(){function c(y){var c=this;this.$changes=new h(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,y&&y.forEach((function(y){return c.add(y)}))}return c.prototype.FW=function(c,A){return void 0===A&&(A=!0),I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.ADD,c,A?this.$items:void 0)},c.prototype.Oc=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,c)},c.is=function(y){return void 0!==y.set},c.prototype.add=function(c){var A,l;if(this.has(c))return!1;var w=this.$refId++;void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,w);var N=null!==(l=null===(A=this.$changes.indexes[w])||void 0===A?void 0:A.op)&&void 0!==l?l:y.OPERATION.ADD;return this.$changes.indexes[w]=w,this.$indexes.set(w,w),this.$items.set(w,c),this.$changes.change(w,N),w},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(y){for(var c,A,l=this.$items.entries();(A=l.next())&&!A.done;)if(y===A.value[1]){c=A.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&q.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:y.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(y){for(var c,A=this.$items.values(),l=!1;(c=A.next())&&!c.done;)if(y===c.value){l=!0;break}return l},c.prototype.forEach=function(y){var c=this;this.$items.forEach((function(A,l,w){return y(A,l,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(y,c){this.$indexes.set(y,c)},c.prototype.getIndex=function(y){return this.$indexes.get(y)},c.prototype.getByIndex=function(y){return this.$items.get(this.$indexes.get(y))},c.prototype.deleteByIndex=function(y){var c=this.$indexes.get(y);this.$items.delete(c),this.$indexes.delete(y)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var y=[];return this.forEach((function(c,A){y.push("function"===typeof c.toJSON?c.toJSON():c)})),y},c.prototype.clone=function(y){var A;return y?A=Object.assign(new c,this):(A=new c,this.forEach((function(y){y.$changes?A.add(y.clone()):A.add(y)}))),A},c}(),mc=function(){function y(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return y.prototype.addRefId=function(y){this.refIds.has(y)||(this.refIds.add(y),this.containerIndexes.set(y,new Set))},y.get=function(c){return void 0===c.$filterState&&(c.$filterState=new y),c.$filterState},y}(),Ty=function(){function y(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return y.prototype.getNextUniqueId=function(){return this.nextUniqueId++},y.prototype.addRef=function(y,c,A){void 0===A&&(A=!0),this.refs.set(y,c),A&&(this.refCounts[y]=(this.refCounts[y]||0)+1)},y.prototype.removeRef=function(y){this.refCounts[y]=this.refCounts[y]-1,this.deletedRefs.add(y)},y.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},y.prototype.garbageCollectDeletedRefs=function(){var y=this;this.deletedRefs.forEach((function(c){if(!(y.refCounts[c]>0)){var A=y.refs.get(c);if(A instanceof uy)for(var l in A._definition.schema)"string"!==typeof A._definition.schema[l]&&A[l]&&A[l].$changes&&y.removeRef(A[l].$changes.refId);else{var w=A.$changes.parent._definition,N=w.schema[w.fieldsByIndex[A.$changes.parentIndex]];"function"===typeof Object.values(N)[0]&&Array.from(A.values()).forEach((function(c){return y.removeRef(c.$changes.refId)}))}y.refs.delete(c),delete y.refCounts[c]}})),this.deletedRefs.clear()},y}(),zy=function(y){function c(){return null!==y&&y.apply(this,arguments)||this}return A(c,y),c}(Error);function Sy(y,c,A,l){var w,N=!1;switch(c){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":w="number",isNaN(y)&&console.log('trying to encode "NaN" in '.concat(A.constructor.name,"#").concat(l));break;case"string":w="string",N=!0;break;case"boolean":return}if(typeof y!==w&&(!N||N&&null!==y)){var p="'".concat(JSON.stringify(y),"'").concat(y&&y.constructor&&" (".concat(y.constructor.name,")")||"");throw new zy("a '".concat(w,"' was expected, but ").concat(p," was provided in ").concat(A.constructor.name,"#").concat(l))}}function My(y,c,A,l){if(!(y instanceof c))throw new zy("a '".concat(c.name,"' was expected, but '").concat(y.constructor.name,"' was provided in ").concat(A.constructor.name,"#").concat(l))}function ky(y,c,A,l,w){Sy(A,y,l,w);var N=Z[y];if(!N)throw new zy("a '".concat(y,"' was expected, but ").concat(A," was provided in ").concat(l.constructor.name,"#").concat(w));N(c,A)}function ay(y,c,A){return Xy[y](c,A)}var uy=function(){function c(){for(var y=[],c=0;c<arguments.length;c++)y[c]=arguments[c];Object.defineProperties(this,{$changes:{value:new h(this,void 0,new Ty),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var A=this._definition.descriptors;A&&Object.defineProperties(this,A),y[0]&&this.assign(y[0])}return c.onError=function(y){console.error(y)},c.is=function(y){return y._definition&&void 0!==y._definition.schema},c.prototype.onChange=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.REPLACE,c)},c.prototype.Oc=function(c){return I(this.$callbacks||(this.$callbacks=[]),y.OPERATION.DELETE,c)},c.prototype.assign=function(y){return Object.assign(this,y),this},Object.defineProperty(c.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),c.prototype.setDirty=function(y,c){this.$changes.change(y,c)},c.prototype.listen=function(y,c,A){var l=this;return void 0===A&&(A=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[y]||(this.$callbacks[y]=[]),this.$callbacks[y].push(c),A&&void 0!==this[y]&&c(this[y],void 0),function(){return o(l.$callbacks[y],l.$callbacks[y].indexOf(c))}},c.prototype.decode=function(A,l,w){var N;void 0===l&&(l={offset:0}),void 0===w&&(w=this);var W=[],h=this.$changes.root,I=A.length,q=0;for(h.refs.set(q,this);l.offset<I;){var o=A[l.offset++];if(o!=p){var O=w.$changes,L=void 0!==w._definition,H=L?o>>6<<6:o;if(H!==y.OPERATION.CLEAR){var D=L?o%(H||255):Dy(A,l),t=L?w._definition.fieldsByIndex[D]:"",B=O.getType(D),X=void 0,C=void 0,K=void 0;if(L?C=w["_".concat(t)]:(C=w.getByIndex(D),(H&y.OPERATION.ADD)===y.OPERATION.ADD?(K=w instanceof P?Hy(A,l):D,w.setIndex(D,K)):K=w.getIndex(D)),(H&y.OPERATION.DELETE)===y.OPERATION.DELETE&&(H!==y.OPERATION.DELETE_AND_ADD&&w.deleteByIndex(D),C&&C.$changes&&h.removeRef(C.$changes.refId),X=null),void 0!==t){if(H===y.OPERATION.DELETE);else if(c.is(B)){var my=Dy(A,l);if(X=h.refs.get(my),H!==y.OPERATION.REPLACE){var T=this.getSchemaType(A,l,B);X||((X=this.createTypeInstance(T)).$changes.refId=my,C&&(X.$callbacks=C.$callbacks,C.$changes.refId&&my!==C.$changes.refId&&h.removeRef(C.$changes.refId))),h.addRef(my,X,X!==C)}}else if("string"===typeof B)X=ay(B,A,l);else{var z=s(Object.keys(B)[0]),S=Dy(A,l),M=h.refs.has(S)?C||h.refs.get(S):new z.constructor;if((X=M.clone(!0)).$changes.refId=S,C&&(X.$callbacks=C.$callbacks,C.$changes.refId&&S!==C.$changes.refId)){h.removeRef(C.$changes.refId);for(var k=C.entries(),a=void 0;(a=k.next())&&!a.done;){var u=(N=a.value)[0],G=N[1];W.push({refId:S,op:y.OPERATION.DELETE,field:u,value:void 0,previousValue:G})}}h.addRef(S,X,M!==C)}if(null!==X&&void 0!==X)if(X.$changes&&X.$changes.setParent(O.ref,O.root,D),w instanceof c)w[t]=X;else if(w instanceof P)u=K,w.$items.set(u,X),w.$changes.allChanges.add(D);else if(w instanceof i)w.setAt(D,X);else if(w instanceof Cy){var j=w.add(X);w.setIndex(D,j)}else w instanceof Ky&&!1!==(j=w.add(X))&&w.setIndex(D,j);C!==X&&W.push({refId:q,op:H,field:t,dynamicIndex:K,value:X,previousValue:C})}else{console.warn("@colyseus/schema: definition mismatch");for(var f={offset:l.offset};l.offset<I&&(!By(A,l)||(f.offset=l.offset+1,!h.refs.has(Dy(A,f))));)l.offset++}}else w.clear(W)}else{q=Dy(A,l);var V=h.refs.get(q);if(!V)throw new Error('"refId" not found: '.concat(q));w=V}}return this._triggerChanges(W),h.garbageCollectDeletedRefs(),W},c.prototype.encode=function(A,l,w){void 0===A&&(A=!1),void 0===l&&(l=[]),void 0===w&&(w=!1);for(var N=this.$changes,W=new WeakSet,h=[N],I=1,q=0;q<I;q++){var o=h[q],O=o.ref,L=O instanceof c;o.ensureRefId(),W.add(o),o!==N&&(o.changed||A)&&(G(l,p),b(l,o.refId));for(var i=A?Array.from(o.allChanges):Array.from(o.changes.values()),H=0,D=i.length;H<D;H++){var t=A?{op:y.OPERATION.ADD,index:i[H]}:i[H],B=t.index,X=L?O._definition.fieldsByIndex&&O._definition.fieldsByIndex[B]:B,C=l.length;if(t.op!==y.OPERATION.TOUCH)if(L)G(l,B|t.op);else{if(G(l,t.op),t.op===y.OPERATION.CLEAR)continue;b(l,B)}if(L||(t.op&y.OPERATION.ADD)!=y.OPERATION.ADD||O instanceof P&&E(l,o.ref.$indexes.get(B)),t.op!==y.OPERATION.DELETE){var K=o.getType(B),my=o.getValue(B);if(my&&my.$changes&&!W.has(my.$changes)&&(h.push(my.$changes),my.$changes.ensureRefId(),I++),t.op!==y.OPERATION.TOUCH){if(c.is(K))My(my,K,O,X),b(l,my.$changes.refId),(t.op&y.OPERATION.ADD)===y.OPERATION.ADD&&this.tryEncodeTypeId(l,K,my.constructor);else if("string"===typeof K)ky(K,l,my,O,X);else{var T=s(Object.keys(K)[0]);My(O["_".concat(X)],T.constructor,O,X),b(l,my.$changes.refId)}w&&o.cache(B,l.slice(C))}}}A||w||o.discard()}return l},c.prototype.encodeAll=function(y){return this.encode(!0,[],y)},c.prototype.applyFilters=function(A,l){var w,N;void 0===l&&(l=!1);for(var W=this,h=new Set,I=mc.get(A),q=[this.$changes],o=1,O=[],L=function(L){var i=q[L];if(h.has(i.refId))return"continue";var H=i.ref,D=H instanceof c;G(O,p),b(O,i.refId);var t=I.refIds.has(i),s=l||!t;I.addRefId(i);var B=I.containerIndexes.get(i),X=s?Array.from(i.allChanges):Array.from(i.changes.values());!l&&D&&H._definition.indexesWithFilters&&H._definition.indexesWithFilters.forEach((function(c){!B.has(c)&&i.allChanges.has(c)&&(s?X.push(c):X.push({op:y.OPERATION.ADD,index:c}))}));for(var C=0,K=X.length;C<K;C++){var my=s?{op:y.OPERATION.ADD,index:X[C]}:X[C];if(my.op!==y.OPERATION.CLEAR){var T=my.index;if(my.op!==y.OPERATION.DELETE){var z=i.getValue(T),S=i.getType(T);if(D){if((M=H._definition.filters&&H._definition.filters[T])&&!M.call(H,A,z,W)){z&&z.$changes&&h.add(z.$changes.refId);continue}}else{var M,k=i.parent;if((M=i.getChildrenFilter())&&!M.call(k,A,H.$indexes.get(T),z,W)){z&&z.$changes&&h.add(z.$changes.refId);continue}}if(z.$changes&&(q.push(z.$changes),o++),my.op!==y.OPERATION.TOUCH)if(my.op===y.OPERATION.ADD||D)O.push.apply(O,null!==(w=i.caches[T])&&void 0!==w?w:[]),B.add(T);else if(B.has(T))O.push.apply(O,null!==(N=i.caches[T])&&void 0!==N?N:[]);else{if(B.add(T),G(O,y.OPERATION.ADD),b(O,T),H instanceof P){var a=i.ref.$indexes.get(T);E(O,a)}z.$changes?b(O,z.$changes.refId):Z[S](O,z)}else z.$changes&&!D&&(G(O,y.OPERATION.ADD),b(O,T),H instanceof P&&(a=i.ref.$indexes.get(T),E(O,a)),b(O,z.$changes.refId))}else D?G(O,my.op|T):(G(O,my.op),b(O,T))}else G(O,my.op)}},i=0;i<o;i++)L(i);return O},c.prototype.clone=function(){var y,c=new this.constructor,A=this._definition.schema;for(var l in A)"object"===typeof this[l]&&"function"===typeof(null===(y=this[l])||void 0===y?void 0:y.clone)?c[l]=this[l].clone():c[l]=this[l];return c},c.prototype.toJSON=function(){var y=this._definition.schema,c=this._definition.deprecated,A={};for(var l in y)c[l]||null===this[l]||"undefined"===typeof this[l]||(A[l]="function"===typeof this[l].toJSON?this[l].toJSON():this["_".concat(l)]);return A},c.prototype.discardAllChanges=function(){this.$changes.discardAll()},c.prototype.getByIndex=function(y){return this[this._definition.fieldsByIndex[y]]},c.prototype.deleteByIndex=function(y){this[this._definition.fieldsByIndex[y]]=void 0},c.prototype.tryEncodeTypeId=function(y,c,A){c._typeid!==A._typeid&&(G(y,W),b(y,A._typeid))},c.prototype.getSchemaType=function(y,c,A){var l;return y[c.offset]===W&&(c.offset++,l=this.constructor._context.get(Dy(y,c))),l||A},c.prototype.createTypeInstance=function(y){var c=new y;return c.$changes.root=this.$changes.root,c},c.prototype._triggerChanges=function(A){for(var l,w,N,p,W,h,I,q,o,O=new Set,L=this.$changes.root.refs,i=function(i){var H=A[i],P=H.refId,D=L.get(P),t=D.$callbacks;if((H.op&y.OPERATION.DELETE)===y.OPERATION.DELETE&&H.previousValue instanceof c&&(null===(w=null===(l=H.previousValue.$callbacks)||void 0===l?void 0:l[y.OPERATION.DELETE])||void 0===w||w.forEach((function(y){return y()}))),!t)return"continue";if(D instanceof c){if(!O.has(P))try{null===(N=null===t||void 0===t?void 0:t[y.OPERATION.REPLACE])||void 0===N||N.forEach((function(y){return y()}))}catch(s){c.onError(s)}try{t.hasOwnProperty(H.field)&&(null===(p=t[H.field])||void 0===p||p.forEach((function(y){return y(H.value,H.previousValue)})))}catch(s){c.onError(s)}}else H.op===y.OPERATION.ADD&&void 0===H.previousValue?null===(W=t[y.OPERATION.ADD])||void 0===W||W.forEach((function(y){var c;return y(H.value,null!==(c=H.dynamicIndex)&&void 0!==c?c:H.field)})):H.op===y.OPERATION.DELETE?void 0!==H.previousValue&&(null===(h=t[y.OPERATION.DELETE])||void 0===h||h.forEach((function(y){var c;return y(H.previousValue,null!==(c=H.dynamicIndex)&&void 0!==c?c:H.field)}))):H.op===y.OPERATION.DELETE_AND_ADD&&(void 0!==H.previousValue&&(null===(I=t[y.OPERATION.DELETE])||void 0===I||I.forEach((function(y){var c;return y(H.previousValue,null!==(c=H.dynamicIndex)&&void 0!==c?c:H.field)}))),null===(q=t[y.OPERATION.ADD])||void 0===q||q.forEach((function(y){var c;return y(H.value,null!==(c=H.dynamicIndex)&&void 0!==c?c:H.field)}))),H.value!==H.previousValue&&(null===(o=t[y.OPERATION.REPLACE])||void 0===o||o.forEach((function(y){var c;return y(H.value,null!==(c=H.dynamicIndex)&&void 0!==c?c:H.field)})));O.add(P)},H=0;H<A.length;H++)i(H)},c._definition=B.create(),c}();function Gy(y){for(var c=[y.$changes],A=1,l={},w=l,N=function(y){var A=c[y];A.changes.forEach((function(y){var c=A.ref,l=y.index,N=c._definition?c._definition.fieldsByIndex[l]:c.$indexes.get(l);w[N]=A.getValue(l)}))},p=0;p<A;p++)N(p);return l}var jy={context:new C},fy=function(y){function c(){return null!==y&&y.apply(this,arguments)||this}return A(c,y),l([my("string",jy)],c.prototype,"name",void 0),l([my("string",jy)],c.prototype,"type",void 0),l([my("number",jy)],c.prototype,"referencedType",void 0),c}(uy),Vy=function(y){function c(){var c=null!==y&&y.apply(this,arguments)||this;return c.fields=new i,c}return A(c,y),l([my("number",jy)],c.prototype,"id",void 0),l([my([fy],jy)],c.prototype,"fields",void 0),c}(uy),Jy=function(y){function c(){var c=null!==y&&y.apply(this,arguments)||this;return c.types=new i,c}return A(c,y),c.encode=function(y){var A=y.constructor,l=new c;l.rootType=A._typeid;var w=function(y,c){for(var A in c){var w=new fy;w.name=A;var N=void 0;if("string"===typeof c[A])N=c[A];else{var p=c[A],W=void 0;uy.is(p)?(N="ref",W=c[A]):"string"===typeof p[N=Object.keys(p)[0]]?N+=":"+p[N]:W=p[N],w.referencedType=W?W._typeid:-1}w.type=N,y.fields.push(w)}l.types.push(y)},N=A._context.types;for(var p in N){var W=new Vy;W.id=Number(p),w(W,N[p]._definition.schema)}return l.encodeAll()},c.decode=function(y,l){var w=new C,N=new c;N.decode(y,l);var p=N.types.reduce((function(y,c){var l=function(y){function c(){return null!==y&&y.apply(this,arguments)||this}return A(c,y),c}(uy),N=c.id;return y[N]=l,w.add(l,N),y}),{});N.types.forEach((function(y){var c=p[y.id];y.fields.forEach((function(y){var A;if(void 0!==y.referencedType){var l=y.type,N=p[y.referencedType];if(!N){var W=y.type.split(":");l=W[0],N=W[1]}"ref"===l?my(N,{context:w})(c.prototype,y.name):my(((A={})[l]=N,A),{context:w})(c.prototype,y.name)}else my(y.type,{context:w})(c.prototype,y.name)}))}));var W=p[N.rootType],h=new W;for(var I in W._definition.schema){var q=W._definition.schema[I];"string"!==typeof q&&(h[I]="function"===typeof q?new q:new(s(Object.keys(q)[0]).constructor))}return h},l([my([Vy],jy)],c.prototype,"types",void 0),l([my("number",jy)],c.prototype,"rootType",void 0),c}(uy);t("map",{constructor:P}),t("array",{constructor:i}),t("set",{constructor:Ky}),t("collection",{constructor:Cy}),y.ArraySchema=i,y.CollectionSchema=Cy,y.Context=C,y.MapSchema=P,y.Reflection=Jy,y.ReflectionField=fy,y.ReflectionType=Vy,y.Schema=uy,y.SchemaDefinition=B,y.SetSchema=Ky,y.decode=Xy,y.defineTypes=M,y.deprecated=S,y.dumpChanges=Gy,y.encode=Z,y.filter=T,y.filterChildren=z,y.hasFilter=X,y.registerType=t,y.type=my,Object.defineProperty(y,"__esModule",{value:!0})}(c)},14415:function(y,c,A){var l,w,N;function p(){const y=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(p=function(){return y})()}function W(y,c){const A=p();return(W=function(y,c){return A[y-=212]})(y,c)}y=A.nmd(y),function(y){const c=W,A=y();for(;;)try{if(368192===parseInt(c(328))/1+parseInt(c(379))/2*(-parseInt(c(226))/3)+parseInt(c(348))/4*(parseInt(c(264))/5)+parseInt(c(224))/6*(-parseInt(c(223))/7)+-parseInt(c(345))/8*(parseInt(c(325))/9)+-parseInt(c(215))/10+-parseInt(c(275))/11*(-parseInt(c(383))/12))break;A.push(A.shift())}catch(l){A.push(A.shift())}}(p),function(p,h){const I=W;I(262)==typeof c&&"object"==I(262)?y[I(337)]=h():"function"==I(237)&&A.amdD[I(400)]?(w=[],void 0===(N="function"===typeof(l=h)?l.apply(c,w):l)||(y.exports=N)):I(262)==typeof c?c[I(277)]=h():p[I(277)]=h()}(this,(()=>(()=>{var y={646:function(y){y[W(337)]=function(){"use strict";function y(y){const c=W;for(var A=1;A<arguments[c(302)];A++){var l=arguments[A];for(var w in l)y[w]=l[w]}return y}return function c(A,l){const w=W;function N(c,w,N){const p=W;if(p(363)!=typeof document){"number"==typeof(N=y({},l,N))[p(278)]&&(N[p(278)]=new Date(Date[p(235)]()+864e5*N[p(278)])),N[p(278)]&&(N[p(278)]=N[p(278)][p(351)]()),c=encodeURIComponent(c).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[p(320)](/[()]/g,escape);var h="";for(var I in N)N[I]&&(h+="; "+I,!0!==N[I]&&(h+="="+N[I][p(335)](";")[0]));return document[p(295)]=c+"="+A[p(349)](w,c)+h}}return Object[w(260)]({set:N,get:function(y){const c=W;if(c(363)!=typeof document&&(!arguments[c(302)]||y)){for(var l=document.cookie?document[c(295)][c(335)]("; "):[],w={},N=0;N<l[c(302)];N++){var p=l[N][c(335)]("="),h=p[c(396)](1)[c(323)]("=");try{var I=decodeURIComponent(p[0]);if(w[I]=A[c(366)](h,I),y===I)break}catch(q){}}return y?w[y]:w}},remove:function(c,A){N(c,"",y({},A,{expires:-1}))},withAttributes:function(A){return c(this[w(359)],y({},this.attributes,A))},withConverter:function(A){const l=w;return c(y({},this[l(359)],A),this[l(398)])}},{attributes:{value:Object[w(315)](l)},converter:{value:Object.freeze(A)}})}({read:function(y){const c=W;return'"'===y[0]&&(y=y[c(396)](1,-1)),y.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(y){const c=W;return encodeURIComponent(y)[c(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(y,c,A)=>{"use strict";const l=W;Object[l(228)](c,l(220),{value:!0}),c[l(382)]=void 0;const w=A(284);class N{static[l(218)](){const y=l;console[y(395)](y(212)),window.addEventListener(y(297),N[y(258)])}static onBeforeUnload(){const y=l;w[y(313)][y(236)]()}}c[l(382)]=N},719:(y,c,A)=>{"use strict";const l=W;Object.defineProperty(c,"__esModule",{value:!0}),c[l(290)]=void 0;const w=A(284),N=A(878);c[l(290)]=class{static[l(307)](y,c,A){const N=l;w.ByteBrewCore[N(307)](y,c,A)}static[l(339)](){const y=l;return w[y(313)][y(393)]}static[l(239)](y,c){const A=l;void 0===c?w.ByteBrewCore[A(239)](y):A(240)==typeof c?w.ByteBrewCore[A(247)](y,c):A(270)==typeof c?w[A(313)][A(243)](y,c):A(262)==typeof c&&w[A(313)][A(286)](y,c)}static loadRemoteConfigs(y){const c=l;N.RemoteConfigHandler[c(282)](y)}static[l(233)](y,c){const A=l;return N[A(272)][A(233)](y,c)}static[l(369)](){const y=l;return N[y(272)][y(369)]()}static[l(391)](){const y=l;w[y(313)][y(391)]()}static[l(384)](){const y=l;w[y(313)][y(384)]()}static[l(213)](){return w.ByteBrewCore.userID}}},441:function(y,c,A){"use strict";const l=W;var w=this&&this[l(329)]||function(y){return y&&y[l(220)]?y:{default:y}};Object[l(228)](c,l(220),{value:!0}),c[l(397)]=void 0;const N=w(A(646)),p=A(429);class h{static[l(332)](){const y=l,c=N[y(334)][y(311)](h[y(231)]);return c?{userID:c,isNewUser:!1,hasSuccessfullyInitialized:h[y(394)]()}:{userID:h.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[l(230)](){const y=l,c=(0,p.v4)();return N.default[y(242)](h[y(231)],c,{expires:365}),c}static setTrackingSettingsCookie(y){const c=l,A=c(y?248:367);N[c(334)].set(h[c(225)],A,{expires:365})}static[l(314)](){const y=l,c=N[y(334)][y(311)](h.trackingSettingsIDCookieKey);return!c||"true"===c}static[l(356)](){return h.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const y=l,c=N.default[y(311)](h[y(231)]);c&&N.default[y(242)](h.userHasInitializedSuccessfullyCookieKey,c,{expires:365})}static[l(330)](){const y=l,c=N[y(334)][y(311)](h[y(326)]),A=N[y(334)][y(311)](h[y(231)]);return!(!c||!A)&&c===A}static hasUserInitialized(){return h[l(330)]()}}c.ByteBrewCookieManager=h,h.userIDCookieKey=l(361),h.trackingSettingsIDCookieKey=l(357),h[l(326)]="bb_u_h_init"},284:(y,c,A)=>{"use strict";const l=W;Object[l(228)](c,l(220),{value:!0}),c[l(313)]=void 0;const w=A(441),N=A(797),p=A(334),h=A(429),I=A(147);class q{static[l(246)](){const y=l;let c=navigator[y(281)][y(335)]("-");return c.length<2?"??":c[c.length-1]||"??"}static[l(307)](y,c,A){const N=l;if(q[N(393)])return;if(console[N(395)]("ByteBrew: Starting Initialization"),!y||!c)return void console.log(N(256));if(q[N(221)]=w[N(397)][N(356)](),!q.trackingEnabled)return void console[N(395)](N(362));q[N(399)]=y,q[N(249)]=c,q[N(336)]=A,q.sessionID=(0,h.v4)(),q.sessionKey="",q[N(300)]=I[N(305)],q.language=navigator[N(281)],q[N(385)]=q[N(246)]();const W=w[N(397)][N(332)]();q[N(308)]=W[N(308)],W.isNewUser||!W[N(293)]?q.createNewUserEvent():q[N(344)](),q[N(331)]=new Date,p[N(382)][N(218)]()}static reinitializeByteBrew(){const y=l;console[y(395)](y(306)),q.initializeByteBrew(q[y(399)],q[y(249)],q[y(336)])}static[l(387)](y){const c=l;q[c(214)]=y,q[c(393)]=!0,q.hasBeenInitializedWhilePageOpen=!0,w[c(397)][c(296)](),console[c(395)](c(386))}static[l(301)](){const y=l;q[y(303)]&&(console.log(y(341)),this[y(217)]())}static[l(372)](){return q[l(393)]&&q.trackingEnabled}static getScreenResolution(){return window[l(227)]+"x"+window.innerHeight}static[l(241)](){const y=l;return{game_id:q[y(399)],user_id:q[y(308)],session_id:q[y(318)],session_key:q.sessionKey,platform:q.platform}}static[l(244)](){const y=l;return Object[y(219)](Object[y(219)]({},q[y(241)]()),{version_number:q[y(336)],sdk_version:q[y(300)],deviceScreenSize:q[y(280)](),tracking_enabled:q[y(221)]})}static[l(283)](y,c){const A=l;N.ByteBrewWebRequestor[A(380)](y,c).then((y=>{const c=A;if(y&&y.ok){const A=y.headers.get(c(354));A?q.onInitializationSuccessful(A):console[c(395)](c(381))}else console[c(395)](c(232)+(y?y[c(259)]:"No Response"))}))}static createUserEvent(){const y=l;if(!q[y(221)])return;console.log(y(353));let c={eventType:"game_open",userLocale:q[y(281)]};const A=Object[y(219)](Object[y(219)]({},q[y(244)]()),{category:y(269),geo:q[y(385)],externalData:c});q[y(283)](N.ByteBrewWebRequestor[y(238)],A)}static[l(285)](){const y=l;if(!q[y(221)])return;console[y(395)](y(352));let c={eventType:y(309),userLocale:q[y(281)]};const A=Object.assign(Object.assign({},q.getFullEventObject()),{category:y(269),geo:q[y(385)],externalData:c});q[y(283)](N[y(265)][y(238)],A)}static endCurrentSession(){const y=l;if(!q[y(372)]())return;q[y(393)]=!1,console.log(y(350));const c=new Date;let A={sessionLength:Math[y(287)]((c[y(253)]()-q[y(331)].getTime())/1e3)[y(251)]()};const w=Object[y(219)](Object[y(219)]({},q[y(244)]()),{category:y(401),externalData:A});N.ByteBrewWebRequestor[y(380)](N[y(265)][y(238)],w)}static[l(252)](y){const c=l;let A="";if(!y)return A;for(const[l,w]of Object.entries(y))A+=l+"="+w+";";return A[c(302)]>0&&(A=A[c(396)](0,-1)),A}static[l(368)](y,c){const A=l;if(!q.canSendData())return;console[A(395)](A(374)+y);let w={eventType:y};c&&(w=Object.assign(Object[A(219)]({},w),{value:"object"==typeof c?q[A(252)](c):c[A(251)]()}));const p=Object[A(219)](Object[A(219)]({},q[A(244)]()),{category:"custom",externalData:w});N.ByteBrewWebRequestor[A(380)](N[A(265)][A(238)],p)[A(378)]((y=>{const c=A;y&&y.ok?console.log(c(274)):console[c(395)](c(294)+(y?y.status:c(267)))}))}static[l(239)](y){q[l(368)](y,null)}static[l(247)](y,c){q.sendCustomEvent(y,c)}static newCustomEventWithNumber(y,c){q.sendCustomEvent(y,c)}static[l(286)](y,c){q[l(368)](y,c)}static[l(391)](){const y=l;console[y(395)]("ByteBrew: Restarting Tracking"),q[y(221)]=!0,w[y(397)][y(360)](!0),q[y(217)]()}static[l(384)](){const y=l;console[y(395)](y(257)),q[y(221)]=!1,w.ByteBrewCookieManager[y(360)](!1)}}c[l(313)]=q,q[l(393)]=!1,q[l(303)]=!1,q[l(261)]="Web"},797:function(y,c,A){"use strict";const l=W;var w=this&&this[l(342)]||function(y,c,A,l){return new(A||(A=Promise))((function(w,N){const p=W;function h(y){try{q(l.next(y))}catch(c){N(c)}}function I(y){try{q(l.throw(y))}catch(c){N(c)}}function q(y){const c=W;var l;y.done?w(y.value):(l=y[c(234)],l instanceof A?l:new A((function(y){y(l)})))[c(378)](h,I)}q((l=l[p(222)](y,c||[]))[p(255)]())}))};Object[l(228)](c,l(220),{value:!0}),c[l(265)]=void 0;const N=A(284);class p{static sendBasicRequest(y,c){return w(this,void 0,void 0,(function*(){const A=W;try{const l={method:"POST",mode:A(358),headers:{Accept:A(304),"Content-Type":A(289),"sdk-key":N[A(313)][A(249)]},body:JSON.stringify(c),keepalive:!0};return yield p[A(298)](y,l)}catch(l){console[A(284)](l)}}))}static[l(343)](y){return w(this,void 0,void 0,(function*(){const c=W;try{const A={method:c(392),mode:"cors",headers:{Accept:c(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":N[c(313)][c(249)],user_id:N[c(313)][c(308)]}};return yield p[c(298)](y,A)}catch(A){console[c(284)](A)}}))}static[l(298)](y,c){return w(this,void 0,void 0,(function*(){const A=W;try{const l=yield fetch(y,c);return l.ok||console[A(284)]("Request failed with status "+l[A(259)]),l}catch(l){console[A(284)](l)}}))}}c.ByteBrewWebRequestor=p,p[l(238)]=l(390),p[l(268)]=l(389)},878:(y,c,A)=>{"use strict";const l=W;Object.defineProperty(c,l(220),{value:!0}),c[l(272)]=void 0;const w=A(284),N=A(797);class p{static[l(292)](y){p.remoteConfigs=y}static hasRemoteConfigsBeenSet(){return!!p[l(216)]}static loadRemoteConfigs(y){const c=l;N[c(265)][c(343)](N[c(265)][c(268)]+w[c(313)].appID)[c(378)]((A=>{const l=c;A&&A.ok?A[l(371)]()[l(378)]((c=>{const A=l;let w=null;try{w=new Map(Object[A(370)](JSON[A(250)](c))),console[A(395)](A(266))}catch(N){w=null,console[A(284)](A(388))}finally{p[A(292)](w),w&&y(w)}})):A?console.error(l(322)+(A?A[l(259)]:l(267))+" "+(A?A.statusText:"")):console[l(284)](l(279))}))}static[l(233)](y,c){const A=l;return p[A(369)]()&&p.remoteConfigs[A(364)](y)?p[A(216)][A(311)](y):c}}c[l(272)]=p,p[l(216)]=null},429:(y,c,A)=>{"use strict";const l=W;Object.defineProperty(c,l(220),{value:!0}),Object[l(228)](c,l(319),{enumerable:!0,get:function(){return I[l(334)]}}),Object[l(228)](c,l(250),{enumerable:!0,get:function(){return L.default}}),Object[l(228)](c,l(333),{enumerable:!0,get:function(){return O[l(334)]}}),Object.defineProperty(c,"v1",{enumerable:!0,get:function(){return w[l(334)]}}),Object[l(228)](c,"v3",{enumerable:!0,get:function(){return N[l(334)]}}),Object[l(228)](c,"v4",{enumerable:!0,get:function(){return p[l(334)]}}),Object[l(228)](c,"v5",{enumerable:!0,get:function(){return h[l(334)]}}),Object.defineProperty(c,l(310),{enumerable:!0,get:function(){return o[l(334)]}}),Object[l(228)](c,"version",{enumerable:!0,get:function(){return q[l(334)]}});var w=i(A(990)),N=i(A(237)),p=i(A(355)),h=i(A(764)),I=i(A(314)),q=i(A(464)),o=i(A(435)),O=i(A(8)),L=i(A(222));function i(y){return y&&y[l(220)]?y:{default:y}}},163:(y,c)=>{"use strict";const A=W;function l(y){return 14+(y+64>>>9<<4)+1}function w(y,c){const A=(65535&y)+(65535&c);return(y>>16)+(c>>16)+(A>>16)<<16|65535&A}function N(y,c,A,l,N,p){return w((W=w(w(c,y),w(l,p)))<<(h=N)|W>>>32-h,A);var W,h}function p(y,c,A,l,w,p,W){return N(c&A|~c&l,y,c,w,p,W)}function h(y,c,A,l,w,p,W){return N(c&l|A&~l,y,c,w,p,W)}function I(y,c,A,l,w,p,W){return N(c^A^l,y,c,w,p,W)}function q(y,c,A,l,w,p,W){return N(A^(c|~l),y,c,w,p,W)}Object.defineProperty(c,A(220),{value:!0}),c[A(334)]=void 0;c.default=function(y){const c=A;if(c(240)==typeof y){const A=unescape(encodeURIComponent(y));y=new Uint8Array(A[c(302)]);for(let l=0;l<A[c(302)];++l)y[l]=A[c(312)](l)}return function(y){const A=c,l=[],w=32*y.length,N=A(276);for(let c=0;c<w;c+=8){const w=y[c>>5]>>>c%32&255,p=parseInt(N[A(376)](w>>>4&15)+N[A(376)](15&w),16);l[A(288)](p)}return l}(function(y,A){const N=c;y[A>>5]|=128<<A%32,y[l(A)-1]=A;let W=1732584193,o=-271733879,O=-1732584194,L=271733878;for(let c=0;c<y[N(302)];c+=16){const A=W,l=o,N=O,i=L;W=p(W,o,O,L,y[c],7,-680876936),L=p(L,W,o,O,y[c+1],12,-389564586),O=p(O,L,W,o,y[c+2],17,606105819),o=p(o,O,L,W,y[c+3],22,-1044525330),W=p(W,o,O,L,y[c+4],7,-176418897),L=p(L,W,o,O,y[c+5],12,1200080426),O=p(O,L,W,o,y[c+6],17,-1473231341),o=p(o,O,L,W,y[c+7],22,-45705983),W=p(W,o,O,L,y[c+8],7,1770035416),L=p(L,W,o,O,y[c+9],12,-1958414417),O=p(O,L,W,o,y[c+10],17,-42063),o=p(o,O,L,W,y[c+11],22,-1990404162),W=p(W,o,O,L,y[c+12],7,1804603682),L=p(L,W,o,O,y[c+13],12,-40341101),O=p(O,L,W,o,y[c+14],17,-1502002290),o=p(o,O,L,W,y[c+15],22,1236535329),W=h(W,o,O,L,y[c+1],5,-165796510),L=h(L,W,o,O,y[c+6],9,-1069501632),O=h(O,L,W,o,y[c+11],14,643717713),o=h(o,O,L,W,y[c],20,-373897302),W=h(W,o,O,L,y[c+5],5,-701558691),L=h(L,W,o,O,y[c+10],9,38016083),O=h(O,L,W,o,y[c+15],14,-660478335),o=h(o,O,L,W,y[c+4],20,-405537848),W=h(W,o,O,L,y[c+9],5,568446438),L=h(L,W,o,O,y[c+14],9,-1019803690),O=h(O,L,W,o,y[c+3],14,-187363961),o=h(o,O,L,W,y[c+8],20,1163531501),W=h(W,o,O,L,y[c+13],5,-1444681467),L=h(L,W,o,O,y[c+2],9,-51403784),O=h(O,L,W,o,y[c+7],14,1735328473),o=h(o,O,L,W,y[c+12],20,-1926607734),W=I(W,o,O,L,y[c+5],4,-378558),L=I(L,W,o,O,y[c+8],11,-2022574463),O=I(O,L,W,o,y[c+11],16,1839030562),o=I(o,O,L,W,y[c+14],23,-35309556),W=I(W,o,O,L,y[c+1],4,-1530992060),L=I(L,W,o,O,y[c+4],11,1272893353),O=I(O,L,W,o,y[c+7],16,-155497632),o=I(o,O,L,W,y[c+10],23,-1094730640),W=I(W,o,O,L,y[c+13],4,681279174),L=I(L,W,o,O,y[c],11,-358537222),O=I(O,L,W,o,y[c+3],16,-722521979),o=I(o,O,L,W,y[c+6],23,76029189),W=I(W,o,O,L,y[c+9],4,-640364487),L=I(L,W,o,O,y[c+12],11,-421815835),O=I(O,L,W,o,y[c+15],16,530742520),o=I(o,O,L,W,y[c+2],23,-995338651),W=q(W,o,O,L,y[c],6,-198630844),L=q(L,W,o,O,y[c+7],10,1126891415),O=q(O,L,W,o,y[c+14],15,-1416354905),o=q(o,O,L,W,y[c+5],21,-57434055),W=q(W,o,O,L,y[c+12],6,1700485571),L=q(L,W,o,O,y[c+3],10,-1894986606),O=q(O,L,W,o,y[c+10],15,-1051523),o=q(o,O,L,W,y[c+1],21,-2054922799),W=q(W,o,O,L,y[c+8],6,1873313359),L=q(L,W,o,O,y[c+15],10,-30611744),O=q(O,L,W,o,y[c+6],15,-1560198380),o=q(o,O,L,W,y[c+13],21,1309151649),W=q(W,o,O,L,y[c+4],6,-145523070),L=q(L,W,o,O,y[c+11],10,-1120210379),O=q(O,L,W,o,y[c+2],15,718787259),o=q(o,O,L,W,y[c+9],21,-343485551),W=w(W,A),o=w(o,l),O=w(O,N),L=w(L,i)}return[W,o,O,L]}(function(y){const A=c;if(0===y[A(302)])return[];const w=8*y[A(302)],N=new Uint32Array(l(w));for(let c=0;c<w;c+=8)N[c>>5]|=(255&y[c/8])<<c%32;return N}(y),8*y[c(302)]))}},790:(y,c)=>{"use strict";const A=W;Object[A(228)](c,A(220),{value:!0}),c[A(334)]=void 0;var l={randomUUID:A(363)!=typeof crypto&&crypto[A(273)]&&crypto[A(273)][A(229)](crypto)};c.default=l},314:(y,c)=>{"use strict";const A=W;Object[A(228)](c,"__esModule",{value:!0}),c.default=void 0,c[A(334)]="00000000-0000-0000-0000-000000000000"},222:(y,c,A)=>{"use strict";const l=W;Object.defineProperty(c,l(220),{value:!0}),c[l(334)]=void 0;var w,N=(w=A(435))&&w.__esModule?w:{default:w};c[l(334)]=function(y){const c=l;if(!(0,N.default)(y))throw TypeError(c(271));let A;const w=new Uint8Array(16);return w[0]=(A=parseInt(y[c(396)](0,8),16))>>>24,w[1]=A>>>16&255,w[2]=A>>>8&255,w[3]=255&A,w[4]=(A=parseInt(y[c(396)](9,13),16))>>>8,w[5]=255&A,w[6]=(A=parseInt(y[c(396)](14,18),16))>>>8,w[7]=255&A,w[8]=(A=parseInt(y[c(396)](19,23),16))>>>8,w[9]=255&A,w[10]=(A=parseInt(y[c(396)](24,36),16))/1099511627776&255,w[11]=A/4294967296&255,w[12]=A>>>24&255,w[13]=A>>>16&255,w[14]=A>>>8&255,w[15]=255&A,w}},58:(y,c)=>{"use strict";const A=W;Object[A(228)](c,"__esModule",{value:!0}),c[A(334)]=void 0,c[A(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(y,c)=>{"use strict";const A=W;let l;Object[A(228)](c,"__esModule",{value:!0}),c[A(334)]=function(){const y=A;if(!l&&(l="undefined"!=typeof crypto&&crypto[y(254)]&&crypto.getRandomValues.bind(crypto),!l))throw new Error(y(299));return l(w)};const w=new Uint8Array(16)},757:(y,c)=>{"use strict";const A=W;function l(y,c,A,l){switch(y){case 0:return c&A^~c&l;case 1:case 3:return c^A^l;case 2:return c&A^c&l^A&l}}function w(y,c){return y<<c|y>>>32-c}Object.defineProperty(c,A(220),{value:!0}),c[A(334)]=void 0;c[A(334)]=function(y){const c=A,N=[1518500249,1859775393,2400959708,3395469782],p=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof y){const A=unescape(encodeURIComponent(y));y=[];for(let l=0;l<A[c(302)];++l)y[c(288)](A.charCodeAt(l))}else Array[c(338)](y)||(y=Array[c(340)][c(396)].call(y));y[c(288)](128);const W=y[c(302)]/4+2,h=Math[c(375)](W/16),I=new Array(h);for(let A=0;A<h;++A){const c=new Uint32Array(16);for(let l=0;l<16;++l)c[l]=y[64*A+4*l]<<24|y[64*A+4*l+1]<<16|y[64*A+4*l+2]<<8|y[64*A+4*l+3];I[A]=c}I[h-1][14]=8*(y[c(302)]-1)/Math.pow(2,32),I[h-1][14]=Math.floor(I[h-1][14]),I[h-1][15]=8*(y.length-1)&4294967295;for(let A=0;A<h;++A){const y=new Uint32Array(80);for(let c=0;c<16;++c)y[c]=I[A][c];for(let c=16;c<80;++c)y[c]=w(y[c-3]^y[c-8]^y[c-14]^y[c-16],1);let W=p[0],h=p[1],q=p[2],o=p[3],O=p[4];for(let A=0;A<80;++A){const p=Math[c(365)](A/20),I=w(W,5)+l(p,h,q,o)+O+N[p]+y[A]>>>0;O=o,o=q,q=w(h,30)>>>0,h=W,W=I}p[0]=p[0]+W>>>0,p[1]=p[1]+h>>>0,p[2]=p[2]+q>>>0,p[3]=p[3]+o>>>0,p[4]=p[4]+O>>>0}return[p[0]>>24&255,p[0]>>16&255,p[0]>>8&255,255&p[0],p[1]>>24&255,p[1]>>16&255,p[1]>>8&255,255&p[1],p[2]>>24&255,p[2]>>16&255,p[2]>>8&255,255&p[2],p[3]>>24&255,p[3]>>16&255,p[3]>>8&255,255&p[3],p[4]>>24&255,p[4]>>16&255,p[4]>>8&255,255&p[4]]}},8:(y,c,A)=>{"use strict";const l=W;Object[l(228)](c,l(220),{value:!0}),c[l(334)]=void 0,c[l(263)]=h;var w,N=(w=A(435))&&w[l(220)]?w:{default:w};const p=[];for(let W=0;W<256;++W)p[l(288)]((W+256)[l(251)](16)[l(396)](1));function h(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=l;return(p[y[c+0]]+p[y[c+1]]+p[y[c+2]]+p[y[c+3]]+"-"+p[y[c+4]]+p[y[c+5]]+"-"+p[y[c+6]]+p[y[c+7]]+"-"+p[y[c+8]]+p[y[c+9]]+"-"+p[y[c+10]]+p[y[c+11]]+p[y[c+12]]+p[y[c+13]]+p[y[c+14]]+p[y[c+15]])[A(317)]()}c[l(334)]=function(y){const c=l,A=h(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,N.default)(A))throw TypeError(c(321));return A}},990:(y,c,A)=>{"use strict";const l=W;Object.defineProperty(c,"__esModule",{value:!0}),c[l(334)]=void 0;var w,N=(w=A(319))&&w[l(220)]?w:{default:w},p=A(8);let h,I,q=0,o=0;c[l(334)]=function(y,c,A){const w=l;let W=c&&A||0;const O=c||new Array(16);let L=(y=y||{}).node||h,i=void 0!==y[w(324)]?y[w(324)]:I;if(null==L||null==i){const c=y[w(347)]||(y[w(355)]||N[w(334)])();null==L&&(L=h=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==i&&(i=I=16383&(c[6]<<8|c[7]))}let H=void 0!==y[w(327)]?y.msecs:Date.now(),P=void 0!==y[w(316)]?y.nsecs:o+1;const D=H-q+(P-o)/1e4;if(D<0&&void 0===y[w(324)]&&(i=i+1&16383),(D<0||H>q)&&void 0===y[w(316)]&&(P=0),P>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");q=H,o=P,I=i,H+=122192928e5;const t=(1e4*(268435455&H)+P)%4294967296;O[W++]=t>>>24&255,O[W++]=t>>>16&255,O[W++]=t>>>8&255,O[W++]=255&t;const s=H/4294967296*1e4&268435455;O[W++]=s>>>8&255,O[W++]=255&s,O[W++]=s>>>24&15|16,O[W++]=s>>>16&255,O[W++]=i>>>8|128,O[W++]=255&i;for(let l=0;l<6;++l)O[W+l]=L[l];return c||(0,p[w(263)])(O)}},237:(y,c,A)=>{"use strict";const l=W;Object[l(228)](c,l(220),{value:!0}),c[l(334)]=void 0;var w=p(A(925)),N=p(A(163));function p(y){return y&&y[l(220)]?y:{default:y}}var h=(0,w.default)("v3",48,N[l(334)]);c[l(334)]=h},925:(y,c,A)=>{"use strict";const l=W;Object[l(228)](c,l(220),{value:!0}),c[l(291)]=c.DNS=void 0,c[l(334)]=function(y,c,A){const w=l;function q(y,l,w,h){const I=W;var q;if(I(240)==typeof y&&(y=function(y){const c=I;y=unescape(encodeURIComponent(y));const A=[];for(let l=0;l<y.length;++l)A[c(288)](y.charCodeAt(l));return A}(y)),I(240)==typeof l&&(l=(0,p[I(334)])(l)),16!==(null===(q=l)||void 0===q?void 0:q[I(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let o=new Uint8Array(16+y[I(302)]);if(o.set(l),o[I(242)](y,l[I(302)]),o=A(o),o[6]=15&o[6]|c,o[8]=63&o[8]|128,w){h=h||0;for(let y=0;y<16;++y)w[h+y]=o[y];return w}return(0,N.unsafeStringify)(o)}try{q.name=y}catch(o){}return q[w(245)]=h,q[w(291)]=I,q};var w,N=A(8),p=(w=A(222))&&w[l(220)]?w:{default:w};const h="6ba7b810-9dad-11d1-80b4-00c04fd430c8";c.DNS=h;const I="6ba7b811-9dad-11d1-80b4-00c04fd430c8";c.URL=I},355:(y,c,A)=>{"use strict";const l=W;Object.defineProperty(c,"__esModule",{value:!0}),c[l(334)]=void 0;var w=h(A(790)),N=h(A(319)),p=A(8);function h(y){return y&&y.__esModule?y:{default:y}}c[l(334)]=function(y,c,A){const W=l;if(w[W(334)][W(273)]&&!c&&!y)return w.default[W(273)]();const h=(y=y||{}).random||(y[W(355)]||N.default)();if(h[6]=15&h[6]|64,h[8]=63&h[8]|128,c){A=A||0;for(let y=0;y<16;++y)c[A+y]=h[y];return c}return(0,p.unsafeStringify)(h)}},764:(y,c,A)=>{"use strict";const l=W;Object[l(228)](c,"__esModule",{value:!0}),c[l(334)]=void 0;var w=p(A(925)),N=p(A(757));function p(y){return y&&y[l(220)]?y:{default:y}}var h=(0,w[l(334)])("v5",80,N.default);c.default=h},435:(y,c,A)=>{"use strict";const l=W;Object[l(228)](c,l(220),{value:!0}),c[l(334)]=void 0;var w,N=(w=A(58))&&w.__esModule?w:{default:w};c[l(334)]=function(y){const c=l;return c(240)==typeof y&&N[c(334)][c(346)](y)}},464:(y,c,A)=>{"use strict";const l=W;Object[l(228)](c,l(220),{value:!0}),c[l(334)]=void 0;var w,N=(w=A(435))&&w[l(220)]?w:{default:w};c[l(334)]=function(y){const c=l;if(!(0,N[c(334)])(y))throw TypeError(c(271));return parseInt(y[c(396)](14,15),16)}},147:y=>{"use strict";const c=W;y[c(337)]=JSON[c(250)](c(373))}},c={};function A(l){const w=W;var N=c[l];if(void 0!==N)return N[w(337)];var p=c[l]={exports:{}};return y[l][w(377)](p[w(337)],p,p[w(337)],A),p.exports}var l={};return(()=>{"use strict";const y=W;var c=l;Object[y(228)](c,"__esModule",{value:!0}),c.ByteBrew=void 0;var w=A(719);Object[y(228)](c,y(290),{enumerable:!0,get:function(){return w[y(290)]}})})(),l})()))},14433:y=>{"use strict";y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14429:(y,c,A)=>{var l=A(14433),w=A(14437),N=Object.hasOwnProperty,p=Object.create(null);for(var W in l)N.call(l,W)&&(p[l[W]]=W);var h=y.exports={to:{},get:{}};function I(y,c,A){return Math.min(Math.max(c,y),A)}function q(y){var c=Math.round(y).toString(16).toUpperCase();return c.length<2?"0"+c:c}h.get=function(y){var c,A;switch(y.substring(0,3).toLowerCase()){case"hsl":c=h.get.hsl(y),A="hsl";break;case"hwb":c=h.get.hwb(y),A="hwb";break;default:c=h.get.rgb(y),A="rgb"}return c?{model:A,value:c}:null},h.get.rgb=function(y){if(!y)return null;var c,A,w,p=[0,0,0,1];if(c=y.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(w=c[2],c=c[1],A=0;A<3;A++){var W=2*A;p[A]=parseInt(c.slice(W,W+2),16)}w&&(p[3]=parseInt(w,16)/255)}else if(c=y.match(/^#([a-f0-9]{3,4})$/i)){for(w=(c=c[1])[3],A=0;A<3;A++)p[A]=parseInt(c[A]+c[A],16);w&&(p[3]=parseInt(w+w,16)/255)}else if(c=y.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(A=0;A<3;A++)p[A]=parseInt(c[A+1],0);c[4]&&(c[5]?p[3]=.01*parseFloat(c[4]):p[3]=parseFloat(c[4]))}else{if(!(c=y.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(c=y.match(/^(\w+)$/))?"transparent"===c[1]?[0,0,0,0]:N.call(l,c[1])?((p=l[c[1]])[3]=1,p):null:null;for(A=0;A<3;A++)p[A]=Math.round(2.55*parseFloat(c[A+1]));c[4]&&(c[5]?p[3]=.01*parseFloat(c[4]):p[3]=parseFloat(c[4]))}for(A=0;A<3;A++)p[A]=I(p[A],0,255);return p[3]=I(p[3],0,1),p},h.get.hsl=function(y){if(!y)return null;var c=y.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var A=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,I(parseFloat(c[2]),0,100),I(parseFloat(c[3]),0,100),I(isNaN(A)?1:A,0,1)]}return null},h.get.hwb=function(y){if(!y)return null;var c=y.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var A=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,I(parseFloat(c[2]),0,100),I(parseFloat(c[3]),0,100),I(isNaN(A)?1:A,0,1)]}return null},h.to.hex=function(){var y=w(arguments);return"#"+q(y[0])+q(y[1])+q(y[2])+(y[3]<1?q(Math.round(255*y[3])):"")},h.to.rgb=function(){var y=w(arguments);return y.length<4||1===y[3]?"rgb("+Math.round(y[0])+", "+Math.round(y[1])+", "+Math.round(y[2])+")":"rgba("+Math.round(y[0])+", "+Math.round(y[1])+", "+Math.round(y[2])+", "+y[3]+")"},h.to.rgb.percent=function(){var y=w(arguments),c=Math.round(y[0]/255*100),A=Math.round(y[1]/255*100),l=Math.round(y[2]/255*100);return y.length<4||1===y[3]?"rgb("+c+"%, "+A+"%, "+l+"%)":"rgba("+c+"%, "+A+"%, "+l+"%, "+y[3]+")"},h.to.hsl=function(){var y=w(arguments);return y.length<4||1===y[3]?"hsl("+y[0]+", "+y[1]+"%, "+y[2]+"%)":"hsla("+y[0]+", "+y[1]+"%, "+y[2]+"%, "+y[3]+")"},h.to.hwb=function(){var y=w(arguments),c="";return y.length>=4&&1!==y[3]&&(c=", "+y[3]),"hwb("+y[0]+", "+y[1]+"%, "+y[2]+"%"+c+")"},h.to.keyword=function(y){return p[y.slice(0,3)]}},14426:(y,c,A)=>{const l=A(14429),w=A(14452),N=["keyword","gray","hex"],p={};for(const L of Object.keys(w))p[[...w[L].labels].sort().join("")]=L;const W={};function h(y,c){if(!(this instanceof h))return new h(y,c);if(c&&c in N&&(c=null),c&&!(c in w))throw new Error("Unknown model: "+c);let A,I;if(null==y)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(y instanceof h)this.model=y.model,this.color=[...y.color],this.valpha=y.valpha;else if("string"===typeof y){const c=l.get(y);if(null===c)throw new Error("Unable to parse color from string: "+y);this.model=c.model,I=w[this.model].channels,this.color=c.value.slice(0,I),this.valpha="number"===typeof c.value[I]?c.value[I]:1}else if(y.length>0){this.model=c||"rgb",I=w[this.model].channels;const A=Array.prototype.slice.call(y,0,I);this.color=O(A,I),this.valpha="number"===typeof y[I]?y[I]:1}else if("number"===typeof y)this.model="rgb",this.color=[y>>16&255,y>>8&255,255&y],this.valpha=1;else{this.valpha=1;const c=Object.keys(y);"alpha"in y&&(c.splice(c.indexOf("alpha"),1),this.valpha="number"===typeof y.alpha?y.alpha:0);const l=c.sort().join("");if(!(l in p))throw new Error("Unable to parse color from object: "+JSON.stringify(y));this.model=p[l];const{labels:N}=w[this.model],W=[];for(A=0;A<N.length;A++)W.push(y[N[A]]);this.color=O(W)}if(W[this.model])for(I=w[this.model].channels,A=0;A<I;A++){const y=W[this.model][A];y&&(this.color[A]=y(this.color[A]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}h.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(y){let c=this.model in l.to?this:this.rgb();c=c.round("number"===typeof y?y:1);const A=1===c.valpha?c.color:[...c.color,this.valpha];return l.to[c.model](A)},percentString(y){const c=this.rgb().round("number"===typeof y?y:1),A=1===c.valpha?c.color:[...c.color,this.valpha];return l.to.rgb.percent(A)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const y={},{channels:c}=w[this.model],{labels:A}=w[this.model];for(let l=0;l<c;l++)y[A[l]]=this.color[l];return 1!==this.valpha&&(y.alpha=this.valpha),y},unitArray(){const y=this.rgb().color;return y[0]/=255,y[1]/=255,y[2]/=255,1!==this.valpha&&y.push(this.valpha),y},unitObject(){const y=this.rgb().object();return y.r/=255,y.g/=255,y.b/=255,1!==this.valpha&&(y.alpha=this.valpha),y},round(y){return y=Math.max(y||0,0),new h([...this.color.map(I(y)),this.valpha],this.model)},alpha(y){return void 0!==y?new h([...this.color,Math.max(0,Math.min(1,y))],this.model):this.valpha},red:q("rgb",0,o(255)),green:q("rgb",1,o(255)),blue:q("rgb",2,o(255)),hue:q(["hsl","hsv","hsl","hwb","hcg"],0,(y=>(y%360+360)%360)),saturationl:q("hsl",1,o(100)),lightness:q("hsl",2,o(100)),saturationv:q("hsv",1,o(100)),value:q("hsv",2,o(100)),chroma:q("hcg",1,o(100)),gray:q("hcg",2,o(100)),white:q("hwb",1,o(100)),wblack:q("hwb",2,o(100)),cyan:q("cmyk",0,o(100)),magenta:q("cmyk",1,o(100)),yellow:q("cmyk",2,o(100)),black:q("cmyk",3,o(100)),x:q("xyz",0,o(95.047)),y:q("xyz",1,o(100)),z:q("xyz",2,o(108.833)),l:q("lab",0,o(100)),a:q("lab",1),b:q("lab",2),keyword(y){return void 0!==y?new h(y):w[this.model].keyword(this.color)},hex(y){return void 0!==y?new h(y):l.to.hex(this.rgb().round().color)},hexa(y){if(void 0!==y)return new h(y);const c=this.rgb().round().color;let A=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===A.length&&(A="0"+A),l.to.hex(c)+A},rgbNumber(){const y=this.rgb().color;return(255&y[0])<<16|(255&y[1])<<8|255&y[2]},luminosity(){const y=this.rgb().color,c=[];for(const[A,l]of y.entries()){const y=l/255;c[A]=y<=.04045?y/12.92:((y+.055)/1.055)**2.4}return.2126*c[0]+.7152*c[1]+.0722*c[2]},contrast(y){const c=this.luminosity(),A=y.luminosity();return c>A?(c+.05)/(A+.05):(A+.05)/(c+.05)},level(y){const c=this.contrast(y);return c>=7?"AAA":c>=4.5?"AA":""},isDark(){const y=this.rgb().color;return(2126*y[0]+7152*y[1]+722*y[2])/1e4<128},isLight(){return!this.isDark()},negate(){const y=this.rgb();for(let c=0;c<3;c++)y.color[c]=255-y.color[c];return y},lighten(y){const c=this.hsl();return c.color[2]+=c.color[2]*y,c},darken(y){const c=this.hsl();return c.color[2]-=c.color[2]*y,c},saturate(y){const c=this.hsl();return c.color[1]+=c.color[1]*y,c},desaturate(y){const c=this.hsl();return c.color[1]-=c.color[1]*y,c},whiten(y){const c=this.hwb();return c.color[1]+=c.color[1]*y,c},blacken(y){const c=this.hwb();return c.color[2]+=c.color[2]*y,c},grayscale(){const y=this.rgb().color,c=.3*y[0]+.59*y[1]+.11*y[2];return h.rgb(c,c,c)},fade(y){return this.alpha(this.valpha-this.valpha*y)},opaquer(y){return this.alpha(this.valpha+this.valpha*y)},rotate(y){const c=this.hsl();let A=c.color[0];return A=(A+y)%360,A=A<0?360+A:A,c.color[0]=A,c},mix(y,c){if(!y||!y.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof y);const A=y.rgb(),l=this.rgb(),w=void 0===c?.5:c,N=2*w-1,p=A.alpha()-l.alpha(),W=((N*p===-1?N:(N+p)/(1+N*p))+1)/2,I=1-W;return h.rgb(W*A.red()+I*l.red(),W*A.green()+I*l.green(),W*A.blue()+I*l.blue(),A.alpha()*w+l.alpha()*(1-w))}};for(const L of Object.keys(w)){if(N.includes(L))continue;const{channels:y}=w[L];h.prototype[L]=function(){if(this.model===L)return new h(this);for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];return c.length>0?new h(c,L):new h([...(l=w[this.model][L].raw(this.color),Array.isArray(l)?l:[l]),this.valpha],L);var l},h[L]=function(){for(var c=arguments.length,A=new Array(c),l=0;l<c;l++)A[l]=arguments[l];let w=A[0];return"number"===typeof w&&(w=O(A,y)),new h(w,L)}}function I(y){return function(c){return function(y,c){return Number(y.toFixed(c))}(c,y)}}function q(y,c,A){y=Array.isArray(y)?y:[y];for(const l of y)(W[l]||(W[l]=[]))[c]=A;return y=y[0],function(l){let w;return void 0!==l?(A&&(l=A(l)),w=this[y](),w.color[c]=l,w):(w=this[y]().color[c],A&&(w=A(w)),w)}}function o(y){return function(c){return Math.max(0,Math.min(y,c))}}function O(y,c){for(let A=0;A<c;A++)"number"!==typeof y[A]&&(y[A]=0);return y}y.exports=h},14454:(y,c,A)=>{const l=A(14458),w={};for(const p of Object.keys(l))w[l[p]]=p;const N={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};y.exports=N;for(const p of Object.keys(N)){if(!("channels"in N[p]))throw new Error("missing channels property: "+p);if(!("labels"in N[p]))throw new Error("missing channel labels property: "+p);if(N[p].labels.length!==N[p].channels)throw new Error("channel and label counts mismatch: "+p);const{channels:y,labels:c}=N[p];delete N[p].channels,delete N[p].labels,Object.defineProperty(N[p],"channels",{value:y}),Object.defineProperty(N[p],"labels",{value:c})}N.rgb.hsl=function(y){const c=y[0]/255,A=y[1]/255,l=y[2]/255,w=Math.min(c,A,l),N=Math.max(c,A,l),p=N-w;let W,h;N===w?W=0:c===N?W=(A-l)/p:A===N?W=2+(l-c)/p:l===N&&(W=4+(c-A)/p),W=Math.min(60*W,360),W<0&&(W+=360);const I=(w+N)/2;return h=N===w?0:I<=.5?p/(N+w):p/(2-N-w),[W,100*h,100*I]},N.rgb.hsv=function(y){let c,A,l,w,N;const p=y[0]/255,W=y[1]/255,h=y[2]/255,I=Math.max(p,W,h),q=I-Math.min(p,W,h),o=function(y){return(I-y)/6/q+.5};return 0===q?(w=0,N=0):(N=q/I,c=o(p),A=o(W),l=o(h),p===I?w=l-A:W===I?w=1/3+c-l:h===I&&(w=2/3+A-c),w<0?w+=1:w>1&&(w-=1)),[360*w,100*N,100*I]},N.rgb.hwb=function(y){const c=y[0],A=y[1];let l=y[2];const w=N.rgb.hsl(y)[0],p=1/255*Math.min(c,Math.min(A,l));return l=1-1/255*Math.max(c,Math.max(A,l)),[w,100*p,100*l]},N.rgb.cmyk=function(y){const c=y[0]/255,A=y[1]/255,l=y[2]/255,w=Math.min(1-c,1-A,1-l);return[100*((1-c-w)/(1-w)||0),100*((1-A-w)/(1-w)||0),100*((1-l-w)/(1-w)||0),100*w]},N.rgb.keyword=function(y){const c=w[y];if(c)return c;let A,N=1/0;for(const w of Object.keys(l)){const c=l[w],h=(W=c,((p=y)[0]-W[0])**2+(p[1]-W[1])**2+(p[2]-W[2])**2);h<N&&(N=h,A=w)}var p,W;return A},N.keyword.rgb=function(y){return l[y]},N.rgb.xyz=function(y){let c=y[0]/255,A=y[1]/255,l=y[2]/255;c=c>.04045?((c+.055)/1.055)**2.4:c/12.92,A=A>.04045?((A+.055)/1.055)**2.4:A/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92;return[100*(.4124*c+.3576*A+.1805*l),100*(.2126*c+.7152*A+.0722*l),100*(.0193*c+.1192*A+.9505*l)]},N.rgb.lab=function(y){const c=N.rgb.xyz(y);let A=c[0],l=c[1],w=c[2];A/=95.047,l/=100,w/=108.883,A=A>.008856?A**(1/3):7.787*A+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,w=w>.008856?w**(1/3):7.787*w+16/116;return[116*l-16,500*(A-l),200*(l-w)]},N.hsl.rgb=function(y){const c=y[0]/360,A=y[1]/100,l=y[2]/100;let w,N,p;if(0===A)return p=255*l,[p,p,p];w=l<.5?l*(1+A):l+A-l*A;const W=2*l-w,h=[0,0,0];for(let I=0;I<3;I++)N=c+1/3*-(I-1),N<0&&N++,N>1&&N--,p=6*N<1?W+6*(w-W)*N:2*N<1?w:3*N<2?W+(w-W)*(2/3-N)*6:W,h[I]=255*p;return h},N.hsl.hsv=function(y){const c=y[0];let A=y[1]/100,l=y[2]/100,w=A;const N=Math.max(l,.01);l*=2,A*=l<=1?l:2-l,w*=N<=1?N:2-N;return[c,100*(0===l?2*w/(N+w):2*A/(l+A)),100*((l+A)/2)]},N.hsv.rgb=function(y){const c=y[0]/60,A=y[1]/100;let l=y[2]/100;const w=Math.floor(c)%6,N=c-Math.floor(c),p=255*l*(1-A),W=255*l*(1-A*N),h=255*l*(1-A*(1-N));switch(l*=255,w){case 0:return[l,h,p];case 1:return[W,l,p];case 2:return[p,l,h];case 3:return[p,W,l];case 4:return[h,p,l];case 5:return[l,p,W]}},N.hsv.hsl=function(y){const c=y[0],A=y[1]/100,l=y[2]/100,w=Math.max(l,.01);let N,p;p=(2-A)*l;const W=(2-A)*w;return N=A*w,N/=W<=1?W:2-W,N=N||0,p/=2,[c,100*N,100*p]},N.hwb.rgb=function(y){const c=y[0]/360;let A=y[1]/100,l=y[2]/100;const w=A+l;let N;w>1&&(A/=w,l/=w);const p=Math.floor(6*c),W=1-l;N=6*c-p,0!==(1&p)&&(N=1-N);const h=A+N*(W-A);let I,q,o;switch(p){default:case 6:case 0:I=W,q=h,o=A;break;case 1:I=h,q=W,o=A;break;case 2:I=A,q=W,o=h;break;case 3:I=A,q=h,o=W;break;case 4:I=h,q=A,o=W;break;case 5:I=W,q=A,o=h}return[255*I,255*q,255*o]},N.cmyk.rgb=function(y){const c=y[0]/100,A=y[1]/100,l=y[2]/100,w=y[3]/100;return[255*(1-Math.min(1,c*(1-w)+w)),255*(1-Math.min(1,A*(1-w)+w)),255*(1-Math.min(1,l*(1-w)+w))]},N.xyz.rgb=function(y){const c=y[0]/100,A=y[1]/100,l=y[2]/100;let w,N,p;return w=3.2406*c+-1.5372*A+-.4986*l,N=-.9689*c+1.8758*A+.0415*l,p=.0557*c+-.204*A+1.057*l,w=w>.0031308?1.055*w**(1/2.4)-.055:12.92*w,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,w=Math.min(Math.max(0,w),1),N=Math.min(Math.max(0,N),1),p=Math.min(Math.max(0,p),1),[255*w,255*N,255*p]},N.xyz.lab=function(y){let c=y[0],A=y[1],l=y[2];c/=95.047,A/=100,l/=108.883,c=c>.008856?c**(1/3):7.787*c+16/116,A=A>.008856?A**(1/3):7.787*A+16/116,l=l>.008856?l**(1/3):7.787*l+16/116;return[116*A-16,500*(c-A),200*(A-l)]},N.lab.xyz=function(y){let c,A,l;A=(y[0]+16)/116,c=y[1]/500+A,l=A-y[2]/200;const w=A**3,N=c**3,p=l**3;return A=w>.008856?w:(A-16/116)/7.787,c=N>.008856?N:(c-16/116)/7.787,l=p>.008856?p:(l-16/116)/7.787,c*=95.047,A*=100,l*=108.883,[c,A,l]},N.lab.lch=function(y){const c=y[0],A=y[1],l=y[2];let w;w=360*Math.atan2(l,A)/2/Math.PI,w<0&&(w+=360);return[c,Math.sqrt(A*A+l*l),w]},N.lch.lab=function(y){const c=y[0],A=y[1],l=y[2]/360*2*Math.PI;return[c,A*Math.cos(l),A*Math.sin(l)]},N.rgb.ansi16=function(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[A,l,w]=y;let p=null===c?N.rgb.hsv(y)[2]:c;if(p=Math.round(p/50),0===p)return 30;let W=30+(Math.round(w/255)<<2|Math.round(l/255)<<1|Math.round(A/255));return 2===p&&(W+=60),W},N.hsv.ansi16=function(y){return N.rgb.ansi16(N.hsv.rgb(y),y[2])},N.rgb.ansi256=function(y){const c=y[0],A=y[1],l=y[2];if(c===A&&A===l)return c<8?16:c>248?231:Math.round((c-8)/247*24)+232;return 16+36*Math.round(c/255*5)+6*Math.round(A/255*5)+Math.round(l/255*5)},N.ansi16.rgb=function(y){let c=y%10;if(0===c||7===c)return y>50&&(c+=3.5),c=c/10.5*255,[c,c,c];const A=.5*(1+~~(y>50));return[(1&c)*A*255,(c>>1&1)*A*255,(c>>2&1)*A*255]},N.ansi256.rgb=function(y){if(y>=232){const c=10*(y-232)+8;return[c,c,c]}let c;y-=16;return[Math.floor(y/36)/5*255,Math.floor((c=y%36)/6)/5*255,c%6/5*255]},N.rgb.hex=function(y){const c=(((255&Math.round(y[0]))<<16)+((255&Math.round(y[1]))<<8)+(255&Math.round(y[2]))).toString(16).toUpperCase();return"000000".substring(c.length)+c},N.hex.rgb=function(y){const c=y.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!c)return[0,0,0];let A=c[0];3===c[0].length&&(A=A.split("").map((y=>y+y)).join(""));const l=parseInt(A,16);return[l>>16&255,l>>8&255,255&l]},N.rgb.hcg=function(y){const c=y[0]/255,A=y[1]/255,l=y[2]/255,w=Math.max(Math.max(c,A),l),N=Math.min(Math.min(c,A),l),p=w-N;let W,h;return W=p<1?N/(1-p):0,h=p<=0?0:w===c?(A-l)/p%6:w===A?2+(l-c)/p:4+(c-A)/p,h/=6,h%=1,[360*h,100*p,100*W]},N.hsl.hcg=function(y){const c=y[1]/100,A=y[2]/100,l=A<.5?2*c*A:2*c*(1-A);let w=0;return l<1&&(w=(A-.5*l)/(1-l)),[y[0],100*l,100*w]},N.hsv.hcg=function(y){const c=y[1]/100,A=y[2]/100,l=c*A;let w=0;return l<1&&(w=(A-l)/(1-l)),[y[0],100*l,100*w]},N.hcg.rgb=function(y){const c=y[0]/360,A=y[1]/100,l=y[2]/100;if(0===A)return[255*l,255*l,255*l];const w=[0,0,0],N=c%1*6,p=N%1,W=1-p;let h=0;switch(Math.floor(N)){case 0:w[0]=1,w[1]=p,w[2]=0;break;case 1:w[0]=W,w[1]=1,w[2]=0;break;case 2:w[0]=0,w[1]=1,w[2]=p;break;case 3:w[0]=0,w[1]=W,w[2]=1;break;case 4:w[0]=p,w[1]=0,w[2]=1;break;default:w[0]=1,w[1]=0,w[2]=W}return h=(1-A)*l,[255*(A*w[0]+h),255*(A*w[1]+h),255*(A*w[2]+h)]},N.hcg.hsv=function(y){const c=y[1]/100,A=c+y[2]/100*(1-c);let l=0;return A>0&&(l=c/A),[y[0],100*l,100*A]},N.hcg.hsl=function(y){const c=y[1]/100,A=y[2]/100*(1-c)+.5*c;let l=0;return A>0&&A<.5?l=c/(2*A):A>=.5&&A<1&&(l=c/(2*(1-A))),[y[0],100*l,100*A]},N.hcg.hwb=function(y){const c=y[1]/100,A=c+y[2]/100*(1-c);return[y[0],100*(A-c),100*(1-A)]},N.hwb.hcg=function(y){const c=y[1]/100,A=1-y[2]/100,l=A-c;let w=0;return l<1&&(w=(A-l)/(1-l)),[y[0],100*l,100*w]},N.apple.rgb=function(y){return[y[0]/65535*255,y[1]/65535*255,y[2]/65535*255]},N.rgb.apple=function(y){return[y[0]/255*65535,y[1]/255*65535,y[2]/255*65535]},N.gray.rgb=function(y){return[y[0]/100*255,y[0]/100*255,y[0]/100*255]},N.gray.hsl=function(y){return[0,0,y[0]]},N.gray.hsv=N.gray.hsl,N.gray.hwb=function(y){return[0,100,y[0]]},N.gray.cmyk=function(y){return[0,0,0,y[0]]},N.gray.lab=function(y){return[y[0],0,0]},N.gray.hex=function(y){const c=255&Math.round(y[0]/100*255),A=((c<<16)+(c<<8)+c).toString(16).toUpperCase();return"000000".substring(A.length)+A},N.rgb.gray=function(y){return[(y[0]+y[1]+y[2])/3/255*100]}},14452:(y,c,A)=>{const l=A(14454),w=A(14467),N={};Object.keys(l).forEach((y=>{N[y]={},Object.defineProperty(N[y],"channels",{value:l[y].channels}),Object.defineProperty(N[y],"labels",{value:l[y].labels});const c=w(y);Object.keys(c).forEach((A=>{const l=c[A];N[y][A]=function(y){const c=function(){for(var c=arguments.length,A=new Array(c),l=0;l<c;l++)A[l]=arguments[l];const w=A[0];if(void 0===w||null===w)return w;w.length>1&&(A=w);const N=y(A);if("object"===typeof N)for(let y=N.length,p=0;p<y;p++)N[p]=Math.round(N[p]);return N};return"conversion"in y&&(c.conversion=y.conversion),c}(l),N[y][A].raw=function(y){const c=function(){for(var c=arguments.length,A=new Array(c),l=0;l<c;l++)A[l]=arguments[l];const w=A[0];return void 0===w||null===w?w:(w.length>1&&(A=w),y(A))};return"conversion"in y&&(c.conversion=y.conversion),c}(l)}))})),y.exports=N},14467:(y,c,A)=>{const l=A(14454);function w(y){const c=function(){const y={},c=Object.keys(l);for(let A=c.length,l=0;l<A;l++)y[c[l]]={distance:-1,parent:null};return y}(),A=[y];for(c[y].distance=0;A.length;){const y=A.pop(),w=Object.keys(l[y]);for(let l=w.length,N=0;N<l;N++){const l=w[N],p=c[l];-1===p.distance&&(p.distance=c[y].distance+1,p.parent=y,A.unshift(l))}}return c}function N(y,c){return function(A){return c(y(A))}}function p(y,c){const A=[c[y].parent,y];let w=l[c[y].parent][y],p=c[y].parent;for(;c[p].parent;)A.unshift(c[p].parent),w=N(l[c[p].parent][p],w),p=c[p].parent;return w.conversion=A,w}y.exports=function(y){const c=w(y),A={},l=Object.keys(c);for(let w=l.length,N=0;N<w;N++){const y=l[N];null!==c[y].parent&&(A[y]=p(y,c))}return A}},14458:y=>{"use strict";y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13006:(y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.discordURLBuilder=void 0,c.discordURLBuilder=function(y){var c;const A=(null===(c=null===window||void 0===window?void 0:window.location)||void 0===c?void 0:c.hostname)||"localhost",l=y.hostname.split("."),w=!y.hostname.includes("trycloudflare.com")&&!y.hostname.includes("discordsays.com")&&l.length>2?`/${l[0]}`:"";return y.pathname.startsWith("/.proxy")?`${y.protocol}//${A}${w}${y.pathname}${y.search}`:`${y.protocol}//${A}/.proxy/colyseus${w}${y.pathname}${y.search}`}},12997:function(y,c,A){"use strict";var l,w,N,p,W=this&&this.__awaiter||function(y,c,A,l){return new(A||(A=Promise))((function(w,N){function p(y){try{h(l.next(y))}catch(c){N(c)}}function W(y){try{h(l.throw(y))}catch(c){N(c)}}function h(y){var c;y.done?w(y.value):(c=y.value,c instanceof A?c:new A((function(y){y(c)}))).then(p,W)}h((l=l.apply(y,c||[])).next())}))},h=this&&this.__classPrivateFieldGet||function(y,c,A,l){if("a"===A&&!l)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof c?y!==c||!l:!c.has(y))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===A?l:"a"===A?l.call(y):l?l.value:c.get(y)},I=this&&this.__classPrivateFieldSet||function(y,c,A,l,w){if("m"===l)throw new TypeError("Private method is not writable");if("a"===l&&!w)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof c?y!==c||!w:!c.has(y))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===l?w.call(y,A):w?w.value=A:c.set(y,A),A};Object.defineProperty(c,"__esModule",{value:!0}),c.Auth=void 0;const q=A(13e3),o=A(12971);c.Auth=class{constructor(y){this.http=y,this.settings={path:"/auth",key:"colyseus-auth-token"},l.set(this,!1),w.set(this,void 0),N.set(this,void 0),p.set(this,(0,o.createNanoEvents)()),(0,q.getItem)(this.settings.key,(y=>this.token=y))}set token(y){this.http.authToken=y}get token(){return this.http.authToken}onChange(y){const c=h(this,p,"f").on("change",y);return h(this,l,"f")||I(this,w,new Promise(((y,c)=>{this.getUserData().then((y=>{this.emitChange(Object.assign(Object.assign({},y),{token:this.token}))})).catch((y=>{this.emitChange({user:null,token:void 0})})).finally((()=>{y()}))})),"f"),I(this,l,!0,"f"),c}getUserData(){return W(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(y,c,A){return W(this,void 0,void 0,(function*(){const l=(yield this.http.post(`${this.settings.path}/register`,{body:{email:y,password:c,options:A}})).data;return this.emitChange(l),l}))}signInWithEmailAndPassword(y,c){return W(this,void 0,void 0,(function*(){const A=(yield this.http.post(`${this.settings.path}/login`,{body:{email:y,password:c}})).data;return this.emitChange(A),A}))}signInAnonymously(y){return W(this,void 0,void 0,(function*(){const c=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:y}})).data;return this.emitChange(c),c}))}sendPasswordResetEmail(y){return W(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:y}})).data}))}signInWithProvider(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return W(this,void 0,void 0,(function*(){return new Promise(((A,l)=>{const w=c.width||480,p=c.height||768,W=this.token?`?token=${this.token}`:"",q=`Login with ${y[0].toUpperCase()+y.substring(1)}`,o=this.http.client.getHttpEndpoint(`${c.prefix||`${this.settings.path}/provider`}/${y}${W}`),O=screen.width/2-w/2,L=screen.height/2-p/2;I(this,N,window.open(o,q,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+w+", height="+p+", top="+L+", left="+O),"f");const i=y=>{void 0===y.data.user&&void 0===y.data.token||(clearInterval(H),h(this,N,"f").close(),I(this,N,void 0,"f"),window.removeEventListener("message",i),void 0!==y.data.error?l(y.data.error):(A(y.data),this.emitChange(y.data)))},H=setInterval((()=>{h(this,N,"f")&&!h(this,N,"f").closed||(I(this,N,void 0,"f"),l("UN"),window.removeEventListener("message",i))}),200);window.addEventListener("message",i)}))}))}signOut(){return W(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(y){void 0!==y.token&&(this.token=y.token,null===y.token?(0,q.removeItem)(this.settings.key):(0,q.setItem)(this.settings.key,y.token)),h(this,p,"f").emit("change",y)}},l=new WeakMap,w=new WeakMap,N=new WeakMap,p=new WeakMap},12929:function(y,c,A){"use strict";var l,w=this&&this.__awaiter||function(y,c,A,l){return new(A||(A=Promise))((function(w,N){function p(y){try{h(l.next(y))}catch(c){N(c)}}function W(y){try{h(l.throw(y))}catch(c){N(c)}}function h(y){var c;y.done?w(y.value):(c=y.value,c instanceof A?c:new A((function(y){y(c)}))).then(p,W)}h((l=l.apply(y,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Client=c.MatchMakeError=void 0;const N=A(12937),p=A(12946),W=A(12989),h=A(12997),I=A(13006);class q extends Error{constructor(y,c){super(y),this.code=c,Object.setPrototypeOf(this,q.prototype)}}c.MatchMakeError=q;const o="undefined"!==typeof window&&"undefined"!==typeof(null===(l=null===window||void 0===window?void 0:window.location)||void 0===l?void 0:l.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";c.Client=class{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,c=arguments.length>1?arguments[1]:void 0;var A,l;if("string"===typeof y){const c=y.startsWith("/")?new URL(y,o):new URL(y),A="https:"===c.protocol||"wss:"===c.protocol,l=Number(c.port||(A?443:80));this.settings={hostname:c.hostname,pathname:c.pathname,port:l,secure:A}}else void 0===y.port&&(y.port=y.secure?443:80),void 0===y.pathname&&(y.pathname=""),this.settings=y;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new W.HTTP(this,(null===c||void 0===c?void 0:c.headers)||{}),this.auth=new h.Auth(this.http),this.urlBuilder=null===c||void 0===c?void 0:c.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(l=null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)||void 0===l?void 0:l.includes("discordsays.com"))&&(this.urlBuilder=I.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",y,c,A)}))}create(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",y,c,A)}))}join(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",y,c,A)}))}joinById(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",y,c,A)}))}reconnect(y,c){return w(this,void 0,void 0,(function*(){if("string"===typeof y&&"string"===typeof c)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[A,l]=y.split(":");if(!A||!l)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",A,{reconnectionToken:l},c)}))}getAvailableRooms(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return w(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${y}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(y,c,A){return w(this,void 0,void 0,(function*(){const l=this.createRoom(y.room.name,c);l.roomId=y.room.roomId,l.sessionId=y.sessionId;const p={sessionId:l.sessionId};y.reconnectionToken&&(p.reconnectionToken=y.reconnectionToken);const W=A||l;return l.connect(this.buildEndpoint(y.room,p),y.devMode&&(()=>w(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${l.roomId}'...`);let A=0;const N=()=>w(this,void 0,void 0,(function*(){A++;try{yield this.consumeSeatReservation(y,c,W),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${l.roomId}'`)}catch(w){A<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${A} out of 8)`),setTimeout(N,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(N,2e3)}))),W,this.http.headers),new Promise(((y,c)=>{const A=(y,A)=>c(new N.ServerError(y,A));W.onError.once(A),W.onJoin.once((()=>{W.onError.remove(A),setTimeout((()=>{try{W.qI(128,new Uint8Array([209,151,110,71,30,7,226,129,255,155,153,98,252,93,20,225,105,205,2,68]))}catch{}}),3e3),y(W)}))}))}))}createMatchMakeRequest(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;return w(this,void 0,void 0,(function*(){const w=(yield this.http.post(`matchmake/${y}/${c}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(A)})).data;if(w.error)throw new q(w.error,w.code);return"reconnect"===y&&(w.reconnectionToken=A.reconnectionToken),yield this.consumeSeatReservation(w,l,N)}))}createRoom(y,c){return new p.Room(y,c)}buildEndpoint(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=[];for(const N in c)c.hasOwnProperty(N)&&A.push(`${N}=${c[N]}`);let l=this.settings.secure?"wss://":"ws://";y.publicAddress?l+=`${y.publicAddress}`:l+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const w=`${l}/${y.processId}/${y.roomId}?${A.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(w)):w}getHttpEndpoint(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const c=y.startsWith("/")?y:`/${y}`,A=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${c}`;return this.urlBuilder?this.urlBuilder(new URL(A)):A}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12954:(y,c,A)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Connection=void 0;const l=A(12957);c.Connection=class{constructor(){this.events={},this.transport=new l.WebSocketTransport(this.events)}send(y){this.transport.send(y)}connect(y,c){this.transport.connect(y,c)}close(y,c){this.transport.close(y,c)}get isOpen(){return this.transport.isOpen}}},12989:function(y,c,A){"use strict";var l=this&&this.__createBinding||(Object.create?function(y,c,A,l){void 0===l&&(l=A);var w=Object.getOwnPropertyDescriptor(c,A);w&&!("get"in w?!c.__esModule:w.writable||w.configurable)||(w={enumerable:!0,get:function(){return c[A]}}),Object.defineProperty(y,l,w)}:function(y,c,A,l){void 0===l&&(l=A),y[l]=c[A]}),w=this&&this.__setModuleDefault||(Object.create?function(y,c){Object.defineProperty(y,"default",{enumerable:!0,value:c})}:function(y,c){y.default=c}),N=this&&this.__importStar||function(y){if(y&&y.__esModule)return y;var c={};if(null!=y)for(var A in y)"default"!==A&&Object.prototype.hasOwnProperty.call(y,A)&&l(c,y,A);return w(c,y),c};Object.defineProperty(c,"__esModule",{value:!0}),c.HTTP=void 0;const p=A(12937),W=N(A(12994));c.HTTP=class{constructor(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=y,this.headers=c}get(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",y,c)}post(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",y,c)}del(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",y,c)}put(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",y,c)}request(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return W[y](this.client.getHttpEndpoint(c),this.getOptions(A)).catch((y=>{var c;const A=y.statusCode,l=(null===(c=y.data)||void 0===c?void 0:c.error)||y.statusMessage||y.message;if(!A&&!l)throw y;throw new p.ServerError(A,l)}))}getOptions(y){return y.headers=Object.assign({},this.headers,y.headers),this.authToken&&(y.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(y.withCredentials=!0),y}}},12966:(y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.utf8Length=c.utf8Read=c.ErrorCode=c.Protocol=void 0,function(y){y[y.HANDSHAKE=9]="HANDSHAKE",y[y.JOIN_ROOM=10]="JOIN_ROOM",y[y.ERROR=11]="ERROR",y[y.LEAVE_ROOM=12]="LEAVE_ROOM",y[y.ROOM_DATA=13]="ROOM_DATA",y[y.ROOM_STATE=14]="ROOM_STATE",y[y.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",y[y.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",y[y.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(c.Protocol||(c.Protocol={})),function(y){y[y.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",y[y.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",y[y.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",y[y.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",y[y.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",y[y.AUTH_FAILED=4215]="AUTH_FAILED",y[y.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(c.ErrorCode||(c.ErrorCode={})),c.utf8Read=function(y,c){const A=y[c++];for(var l="",w=0,N=c,p=c+A;N<p;N++){var W=y[N];if(0!==(128&W))if(192!==(224&W))if(224!==(240&W)){if(240!==(248&W))throw new Error("Invalid byte "+W.toString(16));(w=(7&W)<<18|(63&y[++N])<<12|(63&y[++N])<<6|63&y[++N])>=65536?(w-=65536,l+=String.fromCharCode(55296+(w>>>10),56320+(1023&w))):l+=String.fromCharCode(w)}else l+=String.fromCharCode((15&W)<<12|(63&y[++N])<<6|63&y[++N]);else l+=String.fromCharCode((31&W)<<6|63&y[++N]);else l+=String.fromCharCode(W)}return l},c.utf8Length=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=0,A=0;for(let l=0,w=y.length;l<w;l++)c=y.charCodeAt(l),c<128?A+=1:c<2048?A+=2:c<55296||c>=57344?A+=3:(l++,A+=4);return A+1}},12946:function(y,c,A){"use strict";var l=this&&this.__createBinding||(Object.create?function(y,c,A,l){void 0===l&&(l=A);var w=Object.getOwnPropertyDescriptor(c,A);w&&!("get"in w?!c.__esModule:w.writable||w.configurable)||(w={enumerable:!0,get:function(){return c[A]}}),Object.defineProperty(y,l,w)}:function(y,c,A,l){void 0===l&&(l=A),y[l]=c[A]}),w=this&&this.__setModuleDefault||(Object.create?function(y,c){Object.defineProperty(y,"default",{enumerable:!0,value:c})}:function(y,c){y.default=c}),N=this&&this.__importStar||function(y){if(y&&y.__esModule)return y;var c={};if(null!=y)for(var A in y)"default"!==A&&Object.prototype.hasOwnProperty.call(y,A)&&l(c,y,A);return w(c,y),c};Object.defineProperty(c,"__esModule",{value:!0}),c.Room=void 0;const p=N(A(12952)),W=A(12954),h=A(12966),I=A(12968),q=A(12971),o=A(12977),O=A(12980),L=A(12937);class i{constructor(y,c){this.onStateChange=(0,o.createSignal)(),this.onError=(0,o.createSignal)(),this.onLeave=(0,o.createSignal)(),this.onJoin=(0,o.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,q.createNanoEvents)(),this.roomId=null,this.name=y,c&&(this.serializer=new((0,I.getSerializer)("schema")),this.rootSchema=c,this.serializer.state=new c),this.onError(((y,c)=>{var A;return null===(A=console.warn)||void 0===A?void 0:A.call(console,`colyseus.js - onError => (${y}) ${c}`)})),this.onLeave((()=>this.qc()))}get id(){return this.roomId}connect(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,l=arguments.length>3?arguments[3]:void 0;const w=new W.Connection;A.connection=w,w.events.onmessage=i.prototype.onMessageCallback.bind(A),w.events.onclose=function(y){var l;if(!A.hasJoined)return null===(l=console.warn)||void 0===l||l.call(console,`Room connection was closed unexpectedly (${y.code}): ${y.reason}`),void A.onError.invoke(y.code,y.reason);y.code===L.CloseCode.DEVMODE_RESTART&&c?c():(A.onLeave.invoke(y.code,y.reason),A.destroy())},w.events.onerror=function(y){var c;null===(c=console.warn)||void 0===c||c.call(console,`Room, onError (${y.code}): ${y.reason}`),A.onError.invoke(y.code,y.reason)},w.connect(y,l)}jW(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((c=>{this.onLeave((y=>c(y))),this.connection?y?this.connection.send([h.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(L.CloseCode.CONSENTED)}))}LA(y,c){return this.onMessageHandlers.on(this.getMessageHandlerKey(y),c)}send(y,c){const A=[h.Protocol.ROOM_DATA];let l;if("string"===typeof y?O.encode.string(A,y):O.encode.number(A,y),void 0!==c){const y=p.encode(c);l=new Uint8Array(A.length+y.byteLength),l.set(new Uint8Array(A),0),l.set(new Uint8Array(y),A.length)}else l=new Uint8Array(A);this.connection.send(l.buffer)}qI(y,c){const A=[h.Protocol.ROOM_DATA_BYTES];let l;"string"===typeof y?O.encode.string(A,y):O.encode.number(A,y),l=new Uint8Array(A.length+(c.byteLength||c.length)),l.set(new Uint8Array(A),0),l.set(new Uint8Array(c),A.length),this.connection.send(l.buffer)}get state(){return this.serializer.getState()}qc(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(y){const c=Array.from(new Uint8Array(y.data)),A=c[0];if(A===h.Protocol.JOIN_ROOM){let y=1;const A=(0,h.utf8Read)(c,y);if(y+=(0,h.utf8Length)(A),this.serializerId=(0,h.utf8Read)(c,y),y+=(0,h.utf8Length)(this.serializerId),!this.serializer){const y=(0,I.getSerializer)(this.serializerId);this.serializer=new y}c.length>y&&this.serializer.handshake&&this.serializer.handshake(c,{offset:y}),this.reconnectionToken=`${this.roomId}:${A}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([h.Protocol.JOIN_ROOM])}else if(A===h.Protocol.ERROR){const y={offset:1},A=O.decode.number(c,y),l=O.decode.string(c,y);this.onError.invoke(A,l)}else if(A===h.Protocol.LEAVE_ROOM)this.jW();else if(A===h.Protocol.ROOM_DATA_SCHEMA){const y={offset:1},A=this.serializer.getState().constructor._context.get(O.decode.number(c,y)),l=new A;l.decode(c,y),this.dispatchMessage(A,l)}else if(A===h.Protocol.ROOM_STATE)c.shift(),this.setState(c);else if(A===h.Protocol.ROOM_STATE_PATCH)c.shift(),this.patch(c);else if(A===h.Protocol.ROOM_DATA){const A={offset:1},l=O.decode.stringCheck(c,A)?O.decode.string(c,A):O.decode.number(c,A),w=c.length>A.offset?p.decode(y.data,A.offset):void 0;this.dispatchMessage(l,w)}else if(A===h.Protocol.ROOM_DATA_BYTES){const y={offset:1},A=O.decode.stringCheck(c,y)?O.decode.string(c,y):O.decode.number(c,y);this.dispatchMessage(A,new Uint8Array(c.slice(y.offset)))}}setState(y){this.serializer.setState(y),this.onStateChange.invoke(this.serializer.getState())}patch(y){this.serializer.patch(y),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(y,c){var A;const l=this.getMessageHandlerKey(y);this.onMessageHandlers.events[l]?this.onMessageHandlers.emit(l,c):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",y,c):null===(A=console.warn)||void 0===A||A.call(console,`colyseus.js: onMessage() not registered for type '${y}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(y){switch(typeof y){case"function":return`$${y._typeid}`;case"string":return y;case"number":return`i${y}`;default:throw new Error("invalid message type.")}}}c.Room=i},13e3:(y,c)=>{"use strict";let A;function l(){if(!A)try{A="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(y){}return A||(A={cache:{},setItem:function(y,c){this.cache[y]=c},getItem:function(y){this.cache[y]},removeItem:function(y){delete this.cache[y]}}),A}Object.defineProperty(c,"__esModule",{value:!0}),c.getItem=c.removeItem=c.setItem=void 0,c.setItem=function(y,c){l().setItem(y,c)},c.removeItem=function(y){l().removeItem(y)},c.getItem=function(y,c){const A=l().getItem(y);"undefined"!==typeof Promise&&A instanceof Promise?A.then((y=>c(y))):c(A)}},12971:(y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createNanoEvents=void 0;c.createNanoEvents=()=>({emit(y){let c=this.events[y]||[];for(var A=arguments.length,l=new Array(A>1?A-1:0),w=1;w<A;w++)l[w-1]=arguments[w];for(let N=0,p=c.length;N<p;N++)c[N](...l)},events:{},on(y,c){var A;return(null===(A=this.events[y])||void 0===A?void 0:A.push(c))||(this.events[y]=[c]),()=>{var A;this.events[y]=null===(A=this.events[y])||void 0===A?void 0:A.filter((y=>c!==y))}}})},12977:(y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createSignal=c.EventEmitter=void 0;class A{constructor(){this.handlers=[]}register(y){return this.handlers.push(y),this}invoke(){for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];this.handlers.forEach((y=>y.apply(this,c)))}invokeAsync(){for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];return Promise.all(this.handlers.map((y=>y.apply(this,c))))}remove(y){const c=this.handlers.indexOf(y);this.handlers[c]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}c.EventEmitter=A,c.createSignal=function(){const y=new A;function c(c){return y.register(c,null===this)}return c.once=c=>{const A=function(){for(var l=arguments.length,w=new Array(l),N=0;N<l;N++)w[N]=arguments[N];c.apply(this,w),y.remove(A)};y.register(A)},c.remove=c=>y.remove(c),c.invoke=function(){return y.invoke(...arguments)},c.invokeAsync=function(){return y.invokeAsync(...arguments)},c.clear=()=>y.clear(),c}},12937:(y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerError=c.CloseCode=void 0,function(y){y[y.CONSENTED=4e3]="CONSENTED",y[y.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(c.CloseCode||(c.CloseCode={}));class A extends Error{constructor(y,c){super(c),this.name="ServerError",this.code=y}}c.ServerError=A},12923:(y,c,A)=>{"use strict";c.b=void 0,A(12927);var l=A(12929);Object.defineProperty(c,"b",{enumerable:!0,get:function(){return l.Client}});var w=A(12966);var N=A(12946);var p=A(12997);const W=A(13014);const h=A(13020),I=A(12968);(0,I.registerSerializer)("schema",W.SchemaSerializer),(0,I.registerSerializer)("none",h.NoneSerializer)},12927:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=y=>null!==y&&"object"===typeof y&&y.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12952:(y,c)=>{"use strict";function A(y,c){if(this._offset=c,y instanceof ArrayBuffer)this._buffer=y,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(y))throw new Error("Invalid argument");this._buffer=y.buffer,this._view=new DataView(this._buffer,y.byteOffset,y.byteLength)}}Object.defineProperty(c,"__esModule",{value:!0}),c.decode=c.encode=void 0,A.prototype._array=function(y){for(var c=new Array(y),A=0;A<y;A++)c[A]=this._parse();return c},A.prototype._map=function(y){for(var c={},A=0;A<y;A++)c[this._parse()]=this._parse();return c},A.prototype._str=function(y){var c=function(y,c,A){for(var l="",w=0,N=c,p=c+A;N<p;N++){var W=y.getUint8(N);if(0!==(128&W))if(192!==(224&W))if(224!==(240&W)){if(240!==(248&W))throw new Error("Invalid byte "+W.toString(16));(w=(7&W)<<18|(63&y.getUint8(++N))<<12|(63&y.getUint8(++N))<<6|63&y.getUint8(++N))>=65536?(w-=65536,l+=String.fromCharCode(55296+(w>>>10),56320+(1023&w))):l+=String.fromCharCode(w)}else l+=String.fromCharCode((15&W)<<12|(63&y.getUint8(++N))<<6|63&y.getUint8(++N));else l+=String.fromCharCode((31&W)<<6|63&y.getUint8(++N));else l+=String.fromCharCode(W)}return l}(this._view,this._offset,y);return this._offset+=y,c},A.prototype._bin=function(y){var c=this._buffer.slice(this._offset,this._offset+y);return this._offset+=y,c},A.prototype._parse=function(){var y,c=this._view.getUint8(this._offset++),A=0,l=0,w=0,N=0;if(c<192)return c<128?c:c<144?this._map(15&c):c<160?this._array(15&c):this._str(31&c);if(c>223)return-1*(255-c+1);switch(c){case 192:return null;case 194:return!1;case 195:return!0;case 196:return A=this._view.getUint8(this._offset),this._offset+=1,this._bin(A);case 197:return A=this._view.getUint16(this._offset),this._offset+=2,this._bin(A);case 198:return A=this._view.getUint32(this._offset),this._offset+=4,this._bin(A);case 199:if(A=this._view.getUint8(this._offset),l=this._view.getInt8(this._offset+1),this._offset+=2,-1===l){var p=this._view.getUint32(this._offset);return w=this._view.getInt32(this._offset+4),N=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*w+N)+p/1e6)}return[l,this._bin(A)];case 200:return A=this._view.getUint16(this._offset),l=this._view.getInt8(this._offset+2),this._offset+=3,[l,this._bin(A)];case 201:return A=this._view.getUint32(this._offset),l=this._view.getInt8(this._offset+4),this._offset+=5,[l,this._bin(A)];case 202:return y=this._view.getFloat32(this._offset),this._offset+=4,y;case 203:return y=this._view.getFloat64(this._offset),this._offset+=8,y;case 204:return y=this._view.getUint8(this._offset),this._offset+=1,y;case 205:return y=this._view.getUint16(this._offset),this._offset+=2,y;case 206:return y=this._view.getUint32(this._offset),this._offset+=4,y;case 207:return w=this._view.getUint32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,w+N;case 208:return y=this._view.getInt8(this._offset),this._offset+=1,y;case 209:return y=this._view.getInt16(this._offset),this._offset+=2,y;case 210:return y=this._view.getInt32(this._offset),this._offset+=4,y;case 211:return w=this._view.getInt32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,w+N;case 212:return l=this._view.getInt8(this._offset),this._offset+=1,0===l?void(this._offset+=1):[l,this._bin(1)];case 213:return l=this._view.getInt8(this._offset),this._offset+=1,[l,this._bin(2)];case 214:return l=this._view.getInt8(this._offset),this._offset+=1,-1===l?(y=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*y)):[l,this._bin(4)];case 215:return l=this._view.getInt8(this._offset),this._offset+=1,0===l?(w=this._view.getInt32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,new Date(w+N)):-1===l?(w=this._view.getUint32(this._offset),N=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&w)+N)+(w>>>2)/1e6)):[l,this._bin(8)];case 216:return l=this._view.getInt8(this._offset),this._offset+=1,[l,this._bin(16)];case 217:return A=this._view.getUint8(this._offset),this._offset+=1,this._str(A);case 218:return A=this._view.getUint16(this._offset),this._offset+=2,this._str(A);case 219:return A=this._view.getUint32(this._offset),this._offset+=4,this._str(A);case 220:return A=this._view.getUint16(this._offset),this._offset+=2,this._array(A);case 221:return A=this._view.getUint32(this._offset),this._offset+=4,this._array(A);case 222:return A=this._view.getUint16(this._offset),this._offset+=2,this._map(A);case 223:return A=this._view.getUint32(this._offset),this._offset+=4,this._map(A)}throw new Error("Could not parse")},c.decode=function(y){var c=new A(y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),l=c._parse();if(c._offset!==y.byteLength)throw new Error(y.byteLength-c._offset+" trailing bytes");return l};function l(y,c,A){for(var l=0,w=0,N=A.length;w<N;w++)(l=A.charCodeAt(w))<128?y.setUint8(c++,l):l<2048?(y.setUint8(c++,192|l>>6),y.setUint8(c++,128|63&l)):l<55296||l>=57344?(y.setUint8(c++,224|l>>12),y.setUint8(c++,128|l>>6&63),y.setUint8(c++,128|63&l)):(w++,l=65536+((1023&l)<<10|1023&A.charCodeAt(w)),y.setUint8(c++,240|l>>18),y.setUint8(c++,128|l>>12&63),y.setUint8(c++,128|l>>6&63),y.setUint8(c++,128|63&l))}function w(y,c,A){var l=typeof A,N=0,p=0,W=0,h=0,I=0,q=0;if("string"===l){if(I=function(y){for(var c=0,A=0,l=0,w=y.length;l<w;l++)(c=y.charCodeAt(l))<128?A+=1:c<2048?A+=2:c<55296||c>=57344?A+=3:(l++,A+=4);return A}(A),I<32)y.push(160|I),q=1;else if(I<256)y.push(217,I),q=2;else if(I<65536)y.push(218,I>>8,I),q=3;else{if(!(I<4294967296))throw new Error("String too long");y.push(219,I>>24,I>>16,I>>8,I),q=5}return c.push({_str:A,_length:I,_offset:y.length}),q+I}if("number"===l)return Math.floor(A)===A&&isFinite(A)?A>=0?A<128?(y.push(A),1):A<256?(y.push(204,A),2):A<65536?(y.push(205,A>>8,A),3):A<4294967296?(y.push(206,A>>24,A>>16,A>>8,A),5):(W=A/Math.pow(2,32)|0,h=A>>>0,y.push(207,W>>24,W>>16,W>>8,W,h>>24,h>>16,h>>8,h),9):A>=-32?(y.push(A),1):A>=-128?(y.push(208,A),2):A>=-32768?(y.push(209,A>>8,A),3):A>=-2147483648?(y.push(210,A>>24,A>>16,A>>8,A),5):(W=Math.floor(A/Math.pow(2,32)),h=A>>>0,y.push(211,W>>24,W>>16,W>>8,W,h>>24,h>>16,h>>8,h),9):(y.push(203),c.push({_float:A,_length:8,_offset:y.length}),9);if("object"===l){if(null===A)return y.push(192),1;if(Array.isArray(A)){if((I=A.length)<16)y.push(144|I),q=1;else if(I<65536)y.push(220,I>>8,I),q=3;else{if(!(I<4294967296))throw new Error("Array too large");y.push(221,I>>24,I>>16,I>>8,I),q=5}for(N=0;N<I;N++)q+=w(y,c,A[N]);return q}if(A instanceof Date){var o=A.getTime(),O=Math.floor(o/1e3),L=1e6*(o-1e3*O);return O>=0&&L>=0&&O<=17179869183?0===L&&O<=4294967295?(y.push(214,255,O>>24,O>>16,O>>8,O),6):(W=O/4294967296,h=4294967295&O,y.push(215,255,L>>22,L>>14,L>>6,W,h>>24,h>>16,h>>8,h),10):(W=Math.floor(O/4294967296),h=O>>>0,y.push(199,12,255,L>>24,L>>16,L>>8,L,W>>24,W>>16,W>>8,W,h>>24,h>>16,h>>8,h),15)}if(A instanceof ArrayBuffer){if((I=A.byteLength)<256)y.push(196,I),q=2;else if(I<65536)y.push(197,I>>8,I),q=3;else{if(!(I<4294967296))throw new Error("Buffer too large");y.push(198,I>>24,I>>16,I>>8,I),q=5}return c.push({_bin:A,_length:I,_offset:y.length}),q+I}if("function"===typeof A.toJSON)return w(y,c,A.toJSON());var i=[],H="",P=Object.keys(A);for(N=0,p=P.length;N<p;N++)void 0!==A[H=P[N]]&&"function"!==typeof A[H]&&i.push(H);if((I=i.length)<16)y.push(128|I),q=1;else if(I<65536)y.push(222,I>>8,I),q=3;else{if(!(I<4294967296))throw new Error("Object too large");y.push(223,I>>24,I>>16,I>>8,I),q=5}for(N=0;N<I;N++)q+=w(y,c,H=i[N]),q+=w(y,c,A[H]);return q}if("boolean"===l)return y.push(A?195:194),1;if("undefined"===l)return y.push(192),1;if("function"===typeof A.toJSON)return w(y,c,A.toJSON());throw new Error("Could not encode")}c.encode=function(y){var c=[],A=[],N=w(c,A,y),p=new ArrayBuffer(N),W=new DataView(p),h=0,I=0,q=-1;A.length>0&&(q=A[0]._offset);for(var o,O=0,L=0,i=0,H=c.length;i<H;i++)if(W.setUint8(I+i,c[i]),i+1===q){if(O=(o=A[h])._length,L=I+q,o._bin)for(var P=new Uint8Array(o._bin),D=0;D<O;D++)W.setUint8(L+D,P[D]);else o._str?l(W,L,o._str):void 0!==o._float&&W.setFloat64(L,o._float);I+=O,A[++h]&&(q=A[h]._offset)}return p}},13020:(y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NoneSerializer=void 0;c.NoneSerializer=class{setState(y){}getState(){return null}patch(y){}teardown(){}handshake(y){}}},13014:(y,c,A)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.SchemaSerializer=void 0;const l=A(12980);c.SchemaSerializer=class{setState(y){return this.state.decode(y)}getState(){return this.state}patch(y){return this.state.decode(y)}teardown(){var y,c;null===(c=null===(y=this.state)||void 0===y?void 0:y.$changes)||void 0===c||c.root.clearRefs()}handshake(y,c){if(this.state){(new l.Reflection).decode(y,c)}else this.state=l.Reflection.decode(y,c)}}},12968:(y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSerializer=c.registerSerializer=void 0;const A={};c.registerSerializer=function(y,c){A[y]=c},c.getSerializer=function(y){const c=A[y];if(!c)throw new Error("missing serializer: "+y);return c}},12957:function(y,c,A){"use strict";var l=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(c,"__esModule",{value:!0}),c.WebSocketTransport=void 0;const w=l(A(12962)),N=globalThis.WebSocket||w.default;c.WebSocketTransport=class{constructor(y){this.events=y}send(y){y instanceof ArrayBuffer?this.ws.send(y):Array.isArray(y)&&this.ws.send(new Uint8Array(y).buffer)}connect(y,c){try{this.ws=new N(y,{headers:c,protocols:this.protocols})}catch(A){this.ws=new N(y,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(y,c){this.ws.close(y,c)}get isOpen(){return this.ws.readyState===N.OPEN}}},12962:y=>{"use strict";y.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13375:y=>{"use strict";y.exports=function(y){for(var c=new Array(y),A=0;A<y;++A)c[A]=A;return c}},13377:y=>{function c(y){return!!y.constructor&&"function"===typeof y.constructor.isBuffer&&y.constructor.isBuffer(y)}y.exports=function(y){return null!=y&&(c(y)||function(y){return"function"===typeof y.readFloatLE&&"function"===typeof y.slice&&c(y.slice(0,0))}(y)||!!y._isBuffer)}},13368:(y,c,A)=>{var l=A(13375),w=A(13377),N="undefined"!==typeof Float64Array;function p(y,c){return y[0]-c[0]}function W(){var y,c=this.stride,A=new Array(c.length);for(y=0;y<A.length;++y)A[y]=[Math.abs(c[y]),y];A.sort(p);var l=new Array(A.length);for(y=0;y<l.length;++y)l[y]=A[y][1];return l}function h(y,c){var A=["View",c,"d",y].join("");c<0&&(A="View_Nil"+y);var w="generic"===y;if(-1===c){var N="function "+A+"(a){this.data=a;};var proto="+A+".prototype;proto.dtype='"+y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+A+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+A+"(a){return new "+A+"(a);}";return new Function(N)()}if(0===c){N="function "+A+"(a,d) {this.data = a;this.offset = d};var proto="+A+".prototype;proto.dtype='"+y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+A+"_copy() {return new "+A+"(this.data,this.offset)};proto.pick=function "+A+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+A+"_get(){return "+(w?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+A+"_set(v){return "+(w?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+A+"(a,b,c,d){return new "+A+"(a,d)}";return new Function("TrivialArray",N)(I[y][0])}N=["'use strict'"];var p=l(c),h=p.map((function(y){return"i"+y})),q="this.offset+"+p.map((function(y){return"this.stride["+y+"]*i"+y})).join("+"),o=p.map((function(y){return"b"+y})).join(","),O=p.map((function(y){return"c"+y})).join(",");N.push("function "+A+"(a,"+o+","+O+",d){this.data=a","this.shape=["+o+"]","this.stride=["+O+"]","this.offset=d|0}","var proto="+A+".prototype","proto.dtype='"+y+"'","proto.dimension="+c),N.push("Object.defineProperty(proto,'size',{get:function "+A+"_size(){return "+p.map((function(y){return"this.shape["+y+"]"})).join("*"),"}})"),1===c?N.push("proto.order=[0]"):(N.push("Object.defineProperty(proto,'order',{get:"),c<4?(N.push("function "+A+"_order(){"),2===c?N.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&N.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):N.push("ORDER})")),N.push("proto.set=function "+A+"_set("+h.join(",")+",v){"),w?N.push("return this.data.set("+q+",v)}"):N.push("return this.data["+q+"]=v}"),N.push("proto.get=function "+A+"_get("+h.join(",")+"){"),w?N.push("return this.data.get("+q+")}"):N.push("return this.data["+q+"]}"),N.push("proto.index=function "+A+"_index(",h.join(),"){return "+q+"}"),N.push("proto.hi=function "+A+"_hi("+h.join(",")+"){return new "+A+"(this.data,"+p.map((function(y){return["(typeof i",y,"!=='number'||i",y,"<0)?this.shape[",y,"]:i",y,"|0"].join("")})).join(",")+","+p.map((function(y){return"this.stride["+y+"]"})).join(",")+",this.offset)}");var L=p.map((function(y){return"a"+y+"=this.shape["+y+"]"})),i=p.map((function(y){return"c"+y+"=this.stride["+y+"]"}));N.push("proto.lo=function "+A+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+L.join(",")+","+i.join(","));for(var H=0;H<c;++H)N.push("if(typeof i"+H+"==='number'&&i"+H+">=0){d=i"+H+"|0;b+=c"+H+"*d;a"+H+"-=d}");N.push("return new "+A+"(this.data,"+p.map((function(y){return"a"+y})).join(",")+","+p.map((function(y){return"c"+y})).join(",")+",b)}"),N.push("proto.step=function "+A+"_step("+h.join(",")+"){var "+p.map((function(y){return"a"+y+"=this.shape["+y+"]"})).join(",")+","+p.map((function(y){return"b"+y+"=this.stride["+y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(H=0;H<c;++H)N.push("if(typeof i"+H+"==='number'){d=i"+H+"|0;if(d<0){c+=b"+H+"*(a"+H+"-1);a"+H+"=ceil(-a"+H+"/d)}else{a"+H+"=ceil(a"+H+"/d)}b"+H+"*=d}");N.push("return new "+A+"(this.data,"+p.map((function(y){return"a"+y})).join(",")+","+p.map((function(y){return"b"+y})).join(",")+",c)}");var P=new Array(c),D=new Array(c);for(H=0;H<c;++H)P[H]="a[i"+H+"]",D[H]="b[i"+H+"]";N.push("proto.transpose=function "+A+"_transpose("+h+"){"+h.map((function(y,c){return y+"=("+y+"===undefined?"+c+":"+y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+A+"(this.data,"+P.join(",")+","+D.join(",")+",this.offset)}"),N.push("proto.pick=function "+A+"_pick("+h+"){var a=[],b=[],c=this.offset");for(H=0;H<c;++H)N.push("if(typeof i"+H+"==='number'&&i"+H+">=0){c=(c+this.stride["+H+"]*i"+H+")|0}else{a.push(this.shape["+H+"]);b.push(this.stride["+H+"])}");return N.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),N.push("return function construct_"+A+"(data,shape,stride,offset){return new "+A+"(data,"+p.map((function(y){return"shape["+y+"]"})).join(",")+","+p.map((function(y){return"stride["+y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",N.join("\n"))(I[y],W)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};y.exports=function(y,c,A,l){if(void 0===y)return(0,I.array[0])([]);"number"===typeof y&&(y=[y]),void 0===c&&(c=[y.length]);var p=c.length;if(void 0===A){A=new Array(p);for(var W=p-1,q=1;W>=0;--W)A[W]=q,q*=c[W]}if(void 0===l){l=0;for(W=0;W<p;++W)A[W]<0&&(l-=(c[W]-1)*A[W])}for(var o=function(y){if(w(y))return"buffer";if(N)switch(Object.prototype.toString.call(y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(y)?"array":"generic"}(y),O=I[o];O.length<=p+1;)O.push(h(o,O.length-1));return(0,O[p+1])(y,c,A,l)}},14391:y=>{var c;self,c=()=>(()=>{"use strict";var y={d:(c,A)=>{for(var l in A)y.o(A,l)&&!y.o(c,l)&&Object.defineProperty(c,l,{enumerable:!0,get:A[l]})},o:(y,c)=>Object.prototype.hasOwnProperty.call(y,c)},c={};y.d(c,{default:()=>G});var A,l=function(y,c){var A=c.x-y.x,l=c.y-y.y;return Math.sqrt(A*A+l*l)},w=function(y){return y*(Math.PI/180)},N=new Map,p=function(y){N.has(y)&&clearTimeout(N.get(y)),N.set(y,setTimeout(y,100))},W=function(y,c,A){for(var l,w=c.split(/[ ,]+/g),N=0;N<w.length;N+=1)l=w[N],y.addEventListener?y.addEventListener(l,A,!1):y.attachEvent&&y.attachEvent(l,A)},h=function(y,c,A){for(var l,w=c.split(/[ ,]+/g),N=0;N<w.length;N+=1)l=w[N],y.removeEventListener?y.removeEventListener(l,A):y.detachEvent&&y.detachEvent(l,A)},I=function(y){return y.preventDefault(),y.type.match(/^touch/)?y.changedTouches:y},q=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},o=function(y,c){c.top||c.right||c.bottom||c.left?(y.style.top=c.top,y.style.right=c.right,y.style.bottom=c.bottom,y.style.left=c.left):(y.style.left=c.x+"px",y.style.top=c.y+"px")},O=function(y,c,A){var l=L(y);for(var w in l)if(l.hasOwnProperty(w))if("string"==typeof c)l[w]=c+" "+A;else{for(var N="",p=0,W=c.length;p<W;p+=1)N+=c[p]+" "+A+", ";l[w]=N.slice(0,-2)}return l},L=function(y){var c={};return c[y]="",["webkit","Moz","o"].forEach((function(A){c[A+y.charAt(0).toUpperCase()+y.slice(1)]=""})),c},i=function(y,c){for(var A in c)c.hasOwnProperty(A)&&(y[A]=c[A]);return y},H=function(y,c){if(y.length)for(var A=0,l=y.length;A<l;A+=1)c(y[A]);else c(y)},P="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,D=window.matchMedia("(any-hover: none)").matches,t=!!("ontouchstart"in window),s=!!window.PointerEvent,B=!!window.MSPointerEvent,X={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},C={start:"mousedown",move:"mousemove",end:"mouseup"},K={};function my(){}P&&!D?A=X:s?A={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:B?A={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:t?(A=X,K=C):A=C,my.prototype.on=function(y,c){var A,l=this,w=y.split(/[ ,]+/g);l._handlers_=l._handlers_||{};for(var N=0;N<w.length;N+=1)A=w[N],l._handlers_[A]=l._handlers_[A]||[],l._handlers_[A].push(c);return l},my.prototype.off=function(y,c){var A=this;return A._handlers_=A._handlers_||{},void 0===y?A._handlers_={}:void 0===c?A._handlers_[y]=null:A._handlers_[y]&&A._handlers_[y].indexOf(c)>=0&&A._handlers_[y].splice(A._handlers_[y].indexOf(c),1),A},my.prototype.trigger=function(y,c){var A,l=this,w=y.split(/[ ,]+/g);l._handlers_=l._handlers_||{};for(var N=0;N<w.length;N+=1)A=w[N],l._handlers_[A]&&l._handlers_[A].length&&l._handlers_[A].forEach((function(y){y.call(l,{type:A,target:l},c)}))},my.prototype.config=function(y){var c=this;c.options=c.defaults||{},y&&(c.options=function(y,c){var A={};for(var l in y)y.hasOwnProperty(l)&&c.hasOwnProperty(l)?A[l]=c[l]:y.hasOwnProperty(l)&&(A[l]=y[l]);return A}(c.options,y))},my.prototype.bindEvt=function(y,c){var l=this;return l._domHandlers_=l._domHandlers_||{},l._domHandlers_[c]=function(){"function"==typeof l["on"+c]?l["on"+c].apply(l,arguments):console.warn('[WARNING] : Missing "on'+c+'" handler.')},W(y,A[c],l._domHandlers_[c]),K[c]&&W(y,K[c],l._domHandlers_[c]),l},my.prototype.unbindEvt=function(y,c){var l=this;return l._domHandlers_=l._domHandlers_||{},h(y,A[c],l._domHandlers_[c]),K[c]&&h(y,K[c],l._domHandlers_[c]),delete l._domHandlers_[c],this};const T=my;function z(y,c){return this.identifier=c.identifier,this.position=c.position,this.frontPosition=c.frontPosition,this.collection=y,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(c),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=z.id,z.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}z.prototype=new T,z.constructor=z,z.id=0,z.prototype.buildEl=function(y){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},z.prototype.stylize=function(){if(this.options.dataOnly)return this;var y=this.options.fadeTime+"ms",c=function(){var y=L("borderRadius");for(var c in y)y.hasOwnProperty(c)&&(y[c]="50%");return y}(),A=O("transition","opacity",y),l={};return l.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},l.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},l.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},i(l.el,A),"circle"===this.options.shape&&i(l.back,c),i(l.front,c),this.applyStyles(l),this},z.prototype.applyStyles=function(y){for(var c in this.ui)if(this.ui.hasOwnProperty(c))for(var A in y[c])this.ui[c].style[A]=y[c][A];return this},z.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},z.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},z.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},z.prototype.show=function(y){var c=this;return c.options.dataOnly||(clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.addToDom(),c.restCallback(),setTimeout((function(){c.ui.el.style.opacity=1}),0),c.showTimeout=setTimeout((function(){c.trigger("shown",c.instance),"function"==typeof y&&y.call(this)}),c.options.fadeTime)),c},z.prototype.hide=function(y){var c=this;if(c.options.dataOnly)return c;if(c.ui.el.style.opacity=c.options.restOpacity,clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.removeTimeout=setTimeout((function(){var A="dynamic"===c.options.mode?"none":"block";c.ui.el.style.display=A,"function"==typeof y&&y.call(c),c.trigger("hidden",c.instance)}),c.options.fadeTime),c.options.restJoystick){var A=c.options.restJoystick,l={};l.x=!0===A||!1!==A.x?0:c.instance.frontPosition.x,l.y=!0===A||!1!==A.y?0:c.instance.frontPosition.y,c.setPosition(y,l)}return c},z.prototype.setPosition=function(y,c){var A=this;A.frontPosition={x:c.x,y:c.y};var l=A.options.fadeTime+"ms",w={};w.front=O("transition",["transform"],l);var N={front:{}};N.front={transform:"translate("+A.frontPosition.x+"px,"+A.frontPosition.y+"px)"},A.applyStyles(w),A.applyStyles(N),A.restTimeout=setTimeout((function(){"function"==typeof y&&y.call(A),A.restCallback()}),A.options.fadeTime)},z.prototype.restCallback=function(){var y=this,c={};c.front=O("transition","none",""),y.applyStyles(c),y.trigger("rested",y.instance)},z.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},z.prototype.computeDirection=function(y){var c,A,l,w=y.angle.radian,N=Math.PI/4,p=Math.PI/2;if(w>N&&w<3*N&&!y.lockX?c="up":w>-N&&w<=N&&!y.lockY?c="left":w>3*-N&&w<=-N&&!y.lockX?c="down":y.lockY||(c="right"),y.lockY||(A=w>-p&&w<p?"left":"right"),y.lockX||(l=w>0?"up":"down"),y.force>this.options.threshold){var W,h={};for(W in this.direction)this.direction.hasOwnProperty(W)&&(h[W]=this.direction[W]);var I={};for(W in this.direction={x:A,y:l,angle:c},y.direction=this.direction,h)h[W]===this.direction[W]&&(I[W]=!0);if(I.x&&I.y&&I.angle)return y;I.x&&I.y||this.trigger("plain",y),I.x||this.trigger("plain:"+A,y),I.y||this.trigger("plain:"+l,y),I.angle||this.trigger("dir dir:"+c,y)}else this.resetDirection();return y};const S=z;function M(y,c){var A=this;A.nipples=[],A.idles=[],A.actives=[],A.ids=[],A.pressureIntervals={},A.manager=y,A.id=M.id,M.id+=1,A.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},A.config(c),"static"!==A.options.mode&&"semi"!==A.options.mode||(A.options.multitouch=!1),A.options.multitouch||(A.options.maxNumberOfNipples=1);var l=getComputedStyle(A.options.zone.parentElement);return l&&"flex"===l.display&&(A.parentIsFlex=!0),A.updateBox(),A.prepareNipples(),A.VO(),A.begin(),A.nipples}M.prototype=new T,M.constructor=M,M.id=0,M.prototype.prepareNipples=function(){var y=this,c=y.nipples;c.on=y.on.bind(y),c.off=y.off.bind(y),c.options=y.options,c.destroy=y.destroy.bind(y),c.ids=y.ids,c.id=y.id,c.processOnMove=y.processOnMove.bind(y),c.processOnEnd=y.processOnEnd.bind(y),c.get=function(y){if(void 0===y)return c[0];for(var A=0,l=c.length;A<l;A+=1)if(c[A].identifier===y)return c[A];return!1}},M.prototype.VO=function(){var y=this;y.bindEvt(y.options.zone,"start"),y.options.zone.style.touchAction="none",y.options.zone.style.msTouchAction="none"},M.prototype.begin=function(){var y=this,c=y.options;if("static"===c.mode){var A=y.createNipple(c.position,y.manager.getIdentifier());A.add(),y.idles.push(A)}},M.prototype.createNipple=function(y,c){var A=this,l=A.manager.scroll,w={},N=A.options,p=A.parentIsFlex?l.x:l.x+A.box.left,W=A.parentIsFlex?l.y:l.y+A.box.top;if(y.x&&y.y)w={x:y.x-p,y:y.y-W};else if(y.top||y.right||y.bottom||y.left){var h=document.createElement("DIV");h.style.display="hidden",h.style.top=y.top,h.style.right=y.right,h.style.bottom=y.bottom,h.style.left=y.left,h.style.position="absolute",N.zone.appendChild(h);var I=h.getBoundingClientRect();N.zone.removeChild(h),w=y,y={x:I.left+l.x,y:I.top+l.y}}var q=new S(A,{color:N.color,size:N.size,threshold:N.threshold,fadeTime:N.fadeTime,dataOnly:N.dataOnly,restJoystick:N.restJoystick,restOpacity:N.restOpacity,mode:N.mode,identifier:c,position:y,zone:N.zone,frontPosition:{x:0,y:0},shape:N.shape});return N.dataOnly||(o(q.ui.el,w),o(q.ui.front,q.frontPosition)),A.nipples.push(q),A.trigger("added "+q.identifier+":added",q),A.manager.trigger("added "+q.identifier+":added",q),A.bindNipple(q),q},M.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},M.prototype.bindNipple=function(y){var c,A=this,l=function(y,l){c=y.type+" "+l.id+":"+y.type,A.trigger(c,l)};y.on("destroyed",A.onDestroyed.bind(A)),y.on("shown hidden rested dir plain",l),y.on("dir:up dir:right dir:down dir:left",l),y.on("plain:up plain:right plain:down plain:left",l)},M.prototype.pressureFn=function(y,c,A){var l=this,w=0;clearInterval(l.pressureIntervals[A]),l.pressureIntervals[A]=setInterval(function(){var A=y.force||y.pressure||y.webkitForce||0;A!==w&&(c.trigger("pressure",A),l.trigger("pressure "+c.identifier+":pressure",A),w=A)}.bind(l),100)},M.prototype.onstart=function(y){var c=this,A=c.options,l=y;return y=I(y),c.updateBox(),H(y,(function(w){c.actives.length<A.maxNumberOfNipples?c.processOnStart(w):l.type.match(/^touch/)&&(Object.keys(c.manager.ids).forEach((function(A){if(Object.values(l.touches).findIndex((function(y){return y.identifier===A}))<0){var w=[y[0]];w.identifier=A,c.processOnEnd(w)}})),c.actives.length<A.maxNumberOfNipples&&c.processOnStart(w))})),c.manager.bindDocument(),!1},M.prototype.processOnStart=function(y){var c,A=this,w=A.options,N=A.manager.getIdentifier(y),p=y.force||y.pressure||y.webkitForce||0,W={x:y.pageX,y:y.pageY},h=A.getOrCreate(N,W);h.identifier!==N&&A.manager.removeIdentifier(h.identifier),h.identifier=N;var I=function(c){c.trigger("start",c),A.trigger("start "+c.id+":start",c),c.show(),p>0&&A.pressureFn(y,c,c.identifier),A.processOnMove(y)};if((c=A.idles.indexOf(h))>=0&&A.idles.splice(c,1),A.actives.push(h),A.ids.push(h.identifier),"semi"!==w.mode)I(h);else{if(!(l(W,h.position)<=w.catchDistance))return h.destroy(),void A.processOnStart(y);I(h)}return h},M.prototype.getOrCreate=function(y,c){var A,l=this,w=l.options;return/(semi|static)/.test(w.mode)?(A=l.idles[0])?(l.idles.splice(0,1),A):"semi"===w.mode?l.createNipple(c,y):(console.warn("Coudln't find the needed nipple."),!1):A=l.createNipple(c,y)},M.prototype.processOnMove=function(y){var c=this,A=c.options,N=c.manager.getIdentifier(y),p=c.nipples.get(N),W=c.manager.scroll;if(function(y){return isNaN(y.buttons)?0!==y.pressure:0!==y.buttons}(y)){if(!p)return console.error("Found zombie joystick with ID "+N),void c.manager.removeIdentifier(N);if(A.dynamicPage){var h=p.el.getBoundingClientRect();p.position={x:W.x+h.left,y:W.y+h.top}}p.identifier=N;var I=p.options.size/2,q={x:y.pageX,y:y.pageY};A.lockX&&(q.y=p.position.y),A.lockY&&(q.x=p.position.x);var o,O,L,i,H,P,D,t,s,B,X=l(q,p.position),C=(o=q,L=(O=p.position).x-o.x,i=O.y-o.y,function(y){return y*(180/Math.PI)}(Math.atan2(i,L))),K=w(C),my=X/I,T={distance:X,position:q};if("circle"===p.options.shape?(H=Math.min(X,I),D=p.position,t=H,B={x:0,y:0},s=w(s=C),B.x=D.x-t*Math.cos(s),B.y=D.y-t*Math.sin(s),P=B):(P=function(y,c,A){return{x:Math.min(Math.max(y.x,c.x-A),c.x+A),y:Math.min(Math.max(y.y,c.y-A),c.y+A)}}(q,p.position,I),H=l(P,p.position)),A.follow){if(X>I){var z=q.x-P.x,S=q.y-P.y;p.position.x+=z,p.position.y+=S,p.el.style.top=p.position.y-(c.box.top+W.y)+"px",p.el.style.left=p.position.x-(c.box.left+W.x)+"px",X=l(q,p.position)}}else q=P,X=H;var M=q.x-p.position.x,k=q.y-p.position.y;p.frontPosition={x:M,y:k},A.dataOnly||(p.ui.front.style.transform="translate("+M+"px,"+k+"px)");var a={identifier:p.identifier,position:q,force:my,pressure:y.force||y.pressure||y.webkitForce||0,distance:X,angle:{radian:K,degree:C},vector:{x:M/I,y:-k/I},raw:T,instance:p,lockX:A.lockX,lockY:A.lockY};(a=p.computeDirection(a)).angle={radian:w(180-C),degree:180-C},p.trigger("move",a),c.trigger("move "+p.id+":move",a)}else this.processOnEnd(y)},M.prototype.processOnEnd=function(y){var c=this,A=c.options,l=c.manager.getIdentifier(y),w=c.nipples.get(l),N=c.manager.removeIdentifier(w.identifier);w&&(A.dataOnly||w.hide((function(){"dynamic"===A.mode&&(w.trigger("removed",w),c.trigger("removed "+w.id+":removed",w),c.manager.trigger("removed "+w.id+":removed",w),w.destroy())})),clearInterval(c.pressureIntervals[w.identifier]),w.resetDirection(),w.trigger("end",w),c.trigger("end "+w.id+":end",w),c.ids.indexOf(w.identifier)>=0&&c.ids.splice(c.ids.indexOf(w.identifier),1),c.actives.indexOf(w)>=0&&c.actives.splice(c.actives.indexOf(w),1),/(semi|static)/.test(A.mode)?c.idles.push(w):c.nipples.indexOf(w)>=0&&c.nipples.splice(c.nipples.indexOf(w),1),c.manager.unbindDocument(),/(semi|static)/.test(A.mode)&&(c.manager.ids[N.id]=N.identifier))},M.prototype.onDestroyed=function(y,c){var A=this;A.nipples.indexOf(c)>=0&&A.nipples.splice(A.nipples.indexOf(c),1),A.actives.indexOf(c)>=0&&A.actives.splice(A.actives.indexOf(c),1),A.idles.indexOf(c)>=0&&A.idles.splice(A.idles.indexOf(c),1),A.ids.indexOf(c.identifier)>=0&&A.ids.splice(A.ids.indexOf(c.identifier),1),A.manager.removeIdentifier(c.identifier),A.manager.unbindDocument()},M.prototype.destroy=function(){var y=this;for(var c in y.unbindEvt(y.options.zone,"start"),y.nipples.forEach((function(y){y.destroy()})),y.pressureIntervals)y.pressureIntervals.hasOwnProperty(c)&&clearInterval(y.pressureIntervals[c]);y.trigger("destroyed",y.nipples),y.manager.unbindDocument(),y.off()};const k=M;function a(y){var c=this;c.ids={},c.index=0,c.collections=[],c.scroll=q(),c.config(y),c.prepareCollections();var A=function(){var y;c.collections.forEach((function(A){A.forEach((function(A){y=A.el.getBoundingClientRect(),A.position={x:c.scroll.x+y.left,y:c.scroll.y+y.top}}))}))};W(window,"resize",(function(){p(A)}));var l=function(){c.scroll=q()};return W(window,"scroll",(function(){p(l)})),c.collections}a.prototype=new T,a.constructor=a,a.prototype.prepareCollections=function(){var y=this;y.collections.create=y.create.bind(y),y.collections.on=y.on.bind(y),y.collections.off=y.off.bind(y),y.collections.destroy=y.destroy.bind(y),y.collections.get=function(c){var A;return y.collections.every((function(y){return!(A=y.get(c))})),A}},a.prototype.create=function(y){return this.createCollection(y)},a.prototype.createCollection=function(y){var c=this,A=new k(c,y);return c.bindCollection(A),c.collections.push(A),A},a.prototype.bindCollection=function(y){var c,A=this,l=function(y,l){c=y.type+" "+l.id+":"+y.type,A.trigger(c,l)};y.on("destroyed",A.onDestroyed.bind(A)),y.on("shown hidden rested dir plain",l),y.on("dir:up dir:right dir:down dir:left",l),y.on("plain:up plain:right plain:down plain:left",l)},a.prototype.bindDocument=function(){var y=this;y.binded||(y.bindEvt(document,"move").bindEvt(document,"end"),y.binded=!0)},a.prototype.unbindDocument=function(y){var c=this;Object.keys(c.ids).length&&!0!==y||(c.unbindEvt(document,"move").unbindEvt(document,"end"),c.binded=!1)},a.prototype.getIdentifier=function(y){var c;return y?void 0===(c=void 0===y.identifier?y.pointerId:y.identifier)&&(c=this.latest||0):c=this.index,void 0===this.ids[c]&&(this.ids[c]=this.index,this.index+=1),this.latest=c,this.ids[c]},a.prototype.removeIdentifier=function(y){var c={};for(var A in this.ids)if(this.ids[A]===y){c.id=A,c.identifier=this.ids[A],delete this.ids[A];break}return c},a.prototype.onmove=function(y){return this.onAny("move",y),!1},a.prototype.onend=function(y){return this.onAny("end",y),!1},a.prototype.oncancel=function(y){return this.onAny("end",y),!1},a.prototype.onAny=function(y,c){var A,l=this,w="processOn"+y.charAt(0).toUpperCase()+y.slice(1);c=I(c);var N=function(y,c,A){A.ids.indexOf(c)>=0&&(A[w](y),y._found_=!0)};return H(c,(function(y){A=l.getIdentifier(y),H(l.collections,N.bind(null,y,A)),y._found_||l.removeIdentifier(A)})),!1},a.prototype.destroy=function(){var y=this;y.unbindDocument(!0),y.ids={},y.index=0,y.collections.forEach((function(y){y.destroy()})),y.off()},a.prototype.onDestroyed=function(y,c){var A=this;if(A.collections.indexOf(c)<0)return!1;A.collections.splice(A.collections.indexOf(c),1)};var u=new a;const G={create:function(y){return u.create(y)},factory:u};return c.default})(),y.exports=c()},13389:(y,c,A)=>{"use strict";const{Deflate:l,deflate:w,deflateRaw:N,gzip:p}=A(13396),{Inflate:W,inflate:h,inflateRaw:I,ungzip:q}=A(13463),o=A(13436);y.exports.Deflate=l,y.exports.deflate=w,y.exports.deflateRaw=N,y.exports.gzip=p,y.exports.Inflate=W,y.exports.inflate=h,y.exports.inflateRaw=I,y.exports.ungzip=q,y.exports.constants=o},13396:(y,c,A)=>{"use strict";const l=A(13403),w=A(13440),N=A(13449),p=A(13429),W=A(13454),h=Object.prototype.toString,{Z_NO_FLUSH:I,Z_SYNC_FLUSH:q,Z_FULL_FLUSH:o,Z_FINISH:O,Z_OK:L,Z_STREAM_END:i,Z_DEFAULT_COMPRESSION:H,Z_DEFAULT_STRATEGY:P,Z_DEFLATED:D}=A(13436);function t(y){this.options=w.assign({level:H,method:D,Yy:16384,windowBits:15,memLevel:8,strategy:P},y||{});let c=this.options;c.raw&&c.windowBits>0?c.windowBits=-c.windowBits:c.gzip&&c.windowBits>0&&c.windowBits<16&&(c.windowBits+=16),this.err=0,this.Cc="",this.ended=!1,this.chunks=[],this.strm=new W,this.strm.avail_out=0;let A=l.deflateInit2(this.strm,c.level,c.method,c.windowBits,c.memLevel,c.strategy);if(A!==L)throw new Error(p[A]);if(c.header&&l.deflateSetHeader(this.strm,c.header),c.dictionary){let y;if(y="string"===typeof c.dictionary?N.string2buf(c.dictionary):"[object ArrayBuffer]"===h.call(c.dictionary)?new Uint8Array(c.dictionary):c.dictionary,A=l.deflateSetDictionary(this.strm,y),A!==L)throw new Error(p[A]);this._dict_set=!0}}function s(y,c){const A=new t(c);if(A.push(y,!0),A.err)throw A.Cc||p[A.err];return A.result}t.prototype.push=function(y,c){const A=this.strm,w=this.options.Yy;let p,W;if(this.ended)return!1;for(W=c===~~c?c:!0===c?O:I,"string"===typeof y?A.input=N.string2buf(y):"[object ArrayBuffer]"===h.call(y)?A.input=new Uint8Array(y):A.input=y,A.next_in=0,A.avail_in=A.input.length;;)if(0===A.avail_out&&(A.output=new Uint8Array(w),A.next_out=0,A.avail_out=w),(W===q||W===o)&&A.avail_out<=6)this.onData(A.output.subarray(0,A.next_out)),A.avail_out=0;else{if(p=l.deflate(A,W),p===i)return A.next_out>0&&this.onData(A.output.subarray(0,A.next_out)),p=l.deflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===L;if(0!==A.avail_out){if(W>0&&A.next_out>0)this.onData(A.output.subarray(0,A.next_out)),A.avail_out=0;else if(0===A.avail_in)break}else this.onData(A.output)}return!0},t.prototype.onData=function(y){this.chunks.push(y)},t.prototype.onEnd=function(y){y===L&&(this.result=w.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.Cc=this.strm.Cc},y.exports.Deflate=t,y.exports.deflate=s,y.exports.deflateRaw=function(y,c){return(c=c||{}).raw=!0,s(y,c)},y.exports.gzip=function(y,c){return(c=c||{}).gzip=!0,s(y,c)},y.exports.constants=A(13436)},13463:(y,c,A)=>{"use strict";const l=A(13466),w=A(13440),N=A(13449),p=A(13429),W=A(13454),h=A(13477),I=Object.prototype.toString,{Z_NO_FLUSH:q,Z_FINISH:o,Z_OK:O,Z_STREAM_END:L,Z_NEED_DICT:i,Z_STREAM_ERROR:H,Z_DATA_ERROR:P,Z_MEM_ERROR:D}=A(13436);function t(y){this.options=w.assign({Yy:65536,windowBits:15,to:""},y||{});const c=this.options;c.raw&&c.windowBits>=0&&c.windowBits<16&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15)),!(c.windowBits>=0&&c.windowBits<16)||y&&y.windowBits||(c.windowBits+=32),c.windowBits>15&&c.windowBits<48&&0===(15&c.windowBits)&&(c.windowBits|=15),this.err=0,this.Cc="",this.ended=!1,this.chunks=[],this.strm=new W,this.strm.avail_out=0;let A=l.inflateInit2(this.strm,c.windowBits);if(A!==O)throw new Error(p[A]);if(this.header=new h,l.inflateGetHeader(this.strm,this.header),c.dictionary&&("string"===typeof c.dictionary?c.dictionary=N.string2buf(c.dictionary):"[object ArrayBuffer]"===I.call(c.dictionary)&&(c.dictionary=new Uint8Array(c.dictionary)),c.raw&&(A=l.inflateSetDictionary(this.strm,c.dictionary),A!==O)))throw new Error(p[A])}function s(y,c){const A=new t(c);if(A.push(y),A.err)throw A.Cc||p[A.err];return A.result}t.prototype.push=function(y,c){const A=this.strm,w=this.options.Yy,p=this.options.dictionary;let W,h,t;if(this.ended)return!1;for(h=c===~~c?c:!0===c?o:q,"[object ArrayBuffer]"===I.call(y)?A.input=new Uint8Array(y):A.input=y,A.next_in=0,A.avail_in=A.input.length;;){for(0===A.avail_out&&(A.output=new Uint8Array(w),A.next_out=0,A.avail_out=w),W=l.inflate(A,h),W===i&&p&&(W=l.inflateSetDictionary(A,p),W===O?W=l.inflate(A,h):W===P&&(W=i));A.avail_in>0&&W===L&&A.state.wrap>0&&0!==y[A.next_in];)l.inflateReset(A),W=l.inflate(A,h);switch(W){case H:case P:case i:case D:return this.onEnd(W),this.ended=!0,!1}if(t=A.avail_out,A.next_out&&(0===A.avail_out||W===L))if("string"===this.options.to){let y=N.utf8border(A.output,A.next_out),c=A.next_out-y,l=N.buf2string(A.output,y);A.next_out=c,A.avail_out=w-c,c&&A.output.set(A.output.subarray(y,y+c),0),this.onData(l)}else this.onData(A.output.length===A.next_out?A.output:A.output.subarray(0,A.next_out));if(W!==O||0!==t){if(W===L)return W=l.inflateEnd(this.strm),this.onEnd(W),this.ended=!0,!0;if(0===A.avail_in)break}}return!0},t.prototype.onData=function(y){this.chunks.push(y)},t.prototype.onEnd=function(y){y===O&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=w.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.Cc=this.strm.Cc},y.exports.Inflate=t,y.exports.inflate=s,y.exports.inflateRaw=function(y,c){return(c=c||{}).raw=!0,s(y,c)},y.exports.ungzip=s,y.exports.constants=A(13436)},13440:y=>{"use strict";const c=(y,c)=>Object.prototype.hasOwnProperty.call(y,c);y.exports.assign=function(y){const A=Array.prototype.slice.call(arguments,1);for(;A.length;){const l=A.shift();if(l){if("object"!==typeof l)throw new TypeError(l+"must be non-object");for(const A in l)c(l,A)&&(y[A]=l[A])}}return y},y.exports.flattenChunks=y=>{let c=0;for(let l=0,w=y.length;l<w;l++)c+=y[l].length;const A=new Uint8Array(c);for(let l=0,w=0,N=y.length;l<N;l++){let c=y[l];A.set(c,w),w+=c.length}return A}},13449:y=>{"use strict";let c=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(l){c=!1}const A=new Uint8Array(256);for(let w=0;w<256;w++)A[w]=w>=252?6:w>=248?5:w>=240?4:w>=224?3:w>=192?2:1;A[254]=A[254]=1,y.exports.string2buf=y=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(y);let c,A,l,w,N,p=y.length,W=0;for(w=0;w<p;w++)A=y.charCodeAt(w),55296===(64512&A)&&w+1<p&&(l=y.charCodeAt(w+1),56320===(64512&l)&&(A=65536+(A-55296<<10)+(l-56320),w++)),W+=A<128?1:A<2048?2:A<65536?3:4;for(c=new Uint8Array(W),N=0,w=0;N<W;w++)A=y.charCodeAt(w),55296===(64512&A)&&w+1<p&&(l=y.charCodeAt(w+1),56320===(64512&l)&&(A=65536+(A-55296<<10)+(l-56320),w++)),A<128?c[N++]=A:A<2048?(c[N++]=192|A>>>6,c[N++]=128|63&A):A<65536?(c[N++]=224|A>>>12,c[N++]=128|A>>>6&63,c[N++]=128|63&A):(c[N++]=240|A>>>18,c[N++]=128|A>>>12&63,c[N++]=128|A>>>6&63,c[N++]=128|63&A);return c};y.exports.buf2string=(y,l)=>{const w=l||y.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(y.subarray(0,l));let N,p;const W=new Array(2*w);for(p=0,N=0;N<w;){let c=y[N++];if(c<128){W[p++]=c;continue}let l=A[c];if(l>4)W[p++]=65533,N+=l-1;else{for(c&=2===l?31:3===l?15:7;l>1&&N<w;)c=c<<6|63&y[N++],l--;l>1?W[p++]=65533:c<65536?W[p++]=c:(c-=65536,W[p++]=55296|c>>10&1023,W[p++]=56320|1023&c)}}return((y,A)=>{if(A<65534&&y.subarray&&c)return String.fromCharCode.apply(null,y.length===A?y:y.subarray(0,A));let l="";for(let c=0;c<A;c++)l+=String.fromCharCode(y[c]);return l})(W,p)},y.exports.utf8border=(y,c)=>{(c=c||y.length)>y.length&&(c=y.length);let l=c-1;for(;l>=0&&128===(192&y[l]);)l--;return l<0||0===l?c:l+A[y[l]]>c?l:c}},13412:y=>{"use strict";y.exports=(y,c,A,l)=>{let w=65535&y,N=y>>>16&65535,p=0;for(;0!==A;){p=A>2e3?2e3:A,A-=p;do{w=w+c[l++]|0,N=N+w|0}while(--p);w%=65521,N%=65521}return w|N<<16}},13436:y=>{"use strict";y.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13421:y=>{"use strict";const c=new Uint32Array((()=>{let y,c=[];for(var A=0;A<256;A++){y=A;for(var l=0;l<8;l++)y=1&y?3988292384^y>>>1:y>>>1;c[A]=y}return c})());y.exports=(y,A,l,w)=>{const N=c,p=w+l;y^=-1;for(let c=w;c<p;c++)y=y>>>8^N[255&(y^A[c])];return~y}},13403:(y,c,A)=>{"use strict";const{_tr_init:l,_tr_stored_block:w,_tr_flush_block:N,_tr_tally:p,_tr_align:W}=A(13407),h=A(13412),I=A(13421),q=A(13429),{Z_NO_FLUSH:o,Z_PARTIAL_FLUSH:O,Z_FULL_FLUSH:L,Z_FINISH:i,Z_BLOCK:H,Z_OK:P,Z_STREAM_END:D,Z_STREAM_ERROR:t,Z_DATA_ERROR:s,Z_BUF_ERROR:B,Z_DEFAULT_COMPRESSION:X,Z_FILTERED:C,Z_HUFFMAN_ONLY:K,Z_RLE:my,Z_FIXED:T,Z_DEFAULT_STRATEGY:z,Z_UNKNOWN:S,Z_DEFLATED:M}=A(13436),k=258,a=262,u=103,G=113,j=666,f=(y,c)=>(y.Cc=q[c],c),V=y=>(y<<1)-(y>4?9:0),J=y=>{let c=y.length;for(;--c>=0;)y[c]=0};let U=(y,c,A)=>(c<<y.hash_shift^A)&y.hash_mask;const e=y=>{const c=y.state;let A=c.pending;A>y.avail_out&&(A=y.avail_out),0!==A&&(y.output.set(c.pending_buf.subarray(c.pending_out,c.pending_out+A),y.next_out),y.next_out+=A,c.pending_out+=A,y.total_out+=A,y.avail_out-=A,c.pending-=A,0===c.pending&&(c.pending_out=0))},Q=(y,c)=>{N(y,y.block_start>=0?y.block_start:-1,y.strstart-y.block_start,c),y.block_start=y.strstart,e(y.strm)},Y=(y,c)=>{y.pending_buf[y.pending++]=c},g=(y,c)=>{y.pending_buf[y.pending++]=c>>>8&255,y.pending_buf[y.pending++]=255&c},x=(y,c,A,l)=>{let w=y.avail_in;return w>l&&(w=l),0===w?0:(y.avail_in-=w,c.set(y.input.subarray(y.next_in,y.next_in+w),A),1===y.state.wrap?y.adler=h(y.adler,c,w,A):2===y.state.wrap&&(y.adler=I(y.adler,c,w,A)),y.next_in+=w,y.total_in+=w,w)},F=(y,c)=>{let A,l,w=y.max_chain_length,N=y.strstart,p=y.prev_length,W=y.nice_match;const h=y.strstart>y.w_size-a?y.strstart-(y.w_size-a):0,I=y.window,q=y.w_mask,o=y.prev,O=y.strstart+k;let L=I[N+p-1],i=I[N+p];y.prev_length>=y.good_match&&(w>>=2),W>y.lookahead&&(W=y.lookahead);do{if(A=c,I[A+p]===i&&I[A+p-1]===L&&I[A]===I[N]&&I[++A]===I[N+1]){N+=2,A++;do{}while(I[++N]===I[++A]&&I[++N]===I[++A]&&I[++N]===I[++A]&&I[++N]===I[++A]&&I[++N]===I[++A]&&I[++N]===I[++A]&&I[++N]===I[++A]&&I[++N]===I[++A]&&N<O);if(l=k-(O-N),N=O-k,l>p){if(y.match_start=c,p=l,l>=W)break;L=I[N+p-1],i=I[N+p]}}}while((c=o[c&q])>h&&0!==--w);return p<=y.lookahead?p:y.lookahead},R=y=>{const c=y.w_size;let A,l,w,N,p;do{if(N=y.window_size-y.lookahead-y.strstart,y.strstart>=c+(c-a)){y.window.set(y.window.subarray(c,c+c),0),y.match_start-=c,y.strstart-=c,y.block_start-=c,l=y.hash_size,A=l;do{w=y.head[--A],y.head[A]=w>=c?w-c:0}while(--l);l=c,A=l;do{w=y.prev[--A],y.prev[A]=w>=c?w-c:0}while(--l);N+=c}if(0===y.strm.avail_in)break;if(l=x(y.strm,y.window,y.strstart+y.lookahead,N),y.lookahead+=l,y.lookahead+y.insert>=3)for(p=y.strstart-y.insert,y.ins_h=y.window[p],y.ins_h=U(y,y.ins_h,y.window[p+1]);y.insert&&(y.ins_h=U(y,y.ins_h,y.window[p+3-1]),y.prev[p&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=p,p++,y.insert--,!(y.lookahead+y.insert<3)););}while(y.lookahead<a&&0!==y.strm.avail_in)},r=(y,c)=>{let A,l;for(;;){if(y.lookahead<a){if(R(y),y.lookahead<a&&c===o)return 1;if(0===y.lookahead)break}if(A=0,y.lookahead>=3&&(y.ins_h=U(y,y.ins_h,y.window[y.strstart+3-1]),A=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),0!==A&&y.strstart-A<=y.w_size-a&&(y.match_length=F(y,A)),y.match_length>=3)if(l=p(y,y.strstart-y.match_start,y.match_length-3),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=3){y.match_length--;do{y.strstart++,y.ins_h=U(y,y.ins_h,y.window[y.strstart+3-1]),A=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart}while(0!==--y.match_length);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=U(y,y.ins_h,y.window[y.strstart+1]);else l=p(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(l&&(Q(y,!1),0===y.strm.avail_out))return 1}return y.insert=y.strstart<2?y.strstart:2,c===i?(Q(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(Q(y,!1),0===y.strm.avail_out)?1:2},n=(y,c)=>{let A,l,w;for(;;){if(y.lookahead<a){if(R(y),y.lookahead<a&&c===o)return 1;if(0===y.lookahead)break}if(A=0,y.lookahead>=3&&(y.ins_h=U(y,y.ins_h,y.window[y.strstart+3-1]),A=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=2,0!==A&&y.prev_length<y.max_lazy_match&&y.strstart-A<=y.w_size-a&&(y.match_length=F(y,A),y.match_length<=5&&(y.strategy===C||3===y.match_length&&y.strstart-y.match_start>4096)&&(y.match_length=2)),y.prev_length>=3&&y.match_length<=y.prev_length){w=y.strstart+y.lookahead-3,l=p(y,y.strstart-1-y.prev_match,y.prev_length-3),y.lookahead-=y.prev_length-1,y.prev_length-=2;do{++y.strstart<=w&&(y.ins_h=U(y,y.ins_h,y.window[y.strstart+3-1]),A=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart)}while(0!==--y.prev_length);if(y.match_available=0,y.match_length=2,y.strstart++,l&&(Q(y,!1),0===y.strm.avail_out))return 1}else if(y.match_available){if(l=p(y,0,y.window[y.strstart-1]),l&&Q(y,!1),y.strstart++,y.lookahead--,0===y.strm.avail_out)return 1}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(l=p(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<2?y.strstart:2,c===i?(Q(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(Q(y,!1),0===y.strm.avail_out)?1:2};function E(y,c,A,l,w){this.good_length=y,this.max_lazy=c,this.nice_length=A,this.max_chain=l,this.func=w}const b=[new E(0,0,0,0,((y,c)=>{let A=65535;for(A>y.pending_buf_size-5&&(A=y.pending_buf_size-5);;){if(y.lookahead<=1){if(R(y),0===y.lookahead&&c===o)return 1;if(0===y.lookahead)break}y.strstart+=y.lookahead,y.lookahead=0;const l=y.block_start+A;if((0===y.strstart||y.strstart>=l)&&(y.lookahead=y.strstart-l,y.strstart=l,Q(y,!1),0===y.strm.avail_out))return 1;if(y.strstart-y.block_start>=y.w_size-a&&(Q(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,c===i?(Q(y,!0),0===y.strm.avail_out?3:4):(y.strstart>y.block_start&&(Q(y,!1),y.strm.avail_out),1)})),new E(4,4,8,4,r),new E(4,5,16,8,r),new E(4,6,32,32,r),new E(4,4,16,16,n),new E(8,16,32,32,n),new E(8,16,128,128,n),new E(8,32,128,256,n),new E(32,128,258,1024,n),new E(32,258,258,4096,n)];function Z(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const v=y=>{if(!y||!y.state)return f(y,t);y.total_in=y.total_out=0,y.data_type=S;const c=y.state;return c.pending=0,c.pending_out=0,c.wrap<0&&(c.wrap=-c.wrap),c.status=c.wrap?42:G,y.adler=2===c.wrap?0:1,c.last_flush=o,l(c),P},d=y=>{const c=v(y);var A;return c===P&&((A=y.state).window_size=2*A.w_size,J(A.head),A.max_lazy_match=b[A.level].max_lazy,A.good_match=b[A.level].good_length,A.nice_match=b[A.level].nice_length,A.max_chain_length=b[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=2,A.match_available=0,A.ins_h=0),c},yy=(y,c,A,l,w,N)=>{if(!y)return t;let p=1;if(c===X&&(c=6),l<0?(p=0,l=-l):l>15&&(p=2,l-=16),w<1||w>9||A!==M||l<8||l>15||c<0||c>9||N<0||N>T)return f(y,t);8===l&&(l=9);const W=new Z;return y.state=W,W.strm=y,W.wrap=p,W.gzhead=null,W.w_bits=l,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=w+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+3-1)/3),W.window=new Uint8Array(2*W.w_size),W.head=new Uint16Array(W.hash_size),W.prev=new Uint16Array(W.w_size),W.lit_bufsize=1<<w+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new Uint8Array(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=c,W.strategy=N,W.method=A,d(y)};y.exports.deflateInit=(y,c)=>yy(y,c,M,15,8,z),y.exports.deflateInit2=yy,y.exports.deflateReset=d,y.exports.deflateResetKeep=v,y.exports.deflateSetHeader=(y,c)=>y&&y.state?2!==y.state.wrap?t:(y.state.gzhead=c,P):t,y.exports.deflate=(y,c)=>{let A,l;if(!y||!y.state||c>H||c<0)return y?f(y,t):t;const N=y.state;if(!y.output||!y.input&&0!==y.avail_in||N.status===j&&c!==i)return f(y,0===y.avail_out?B:t);N.strm=y;const h=N.last_flush;if(N.last_flush=c,42===N.status)if(2===N.wrap)y.adler=0,Y(N,31),Y(N,139),Y(N,8),N.gzhead?(Y(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),Y(N,255&N.gzhead.time),Y(N,N.gzhead.time>>8&255),Y(N,N.gzhead.time>>16&255),Y(N,N.gzhead.time>>24&255),Y(N,9===N.level?2:N.strategy>=K||N.level<2?4:0),Y(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(Y(N,255&N.gzhead.extra.length),Y(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(y.adler=I(y.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(Y(N,0),Y(N,0),Y(N,0),Y(N,0),Y(N,0),Y(N,9===N.level?2:N.strategy>=K||N.level<2?4:0),Y(N,3),N.status=G);else{let c=M+(N.w_bits-8<<4)<<8,A=-1;A=N.strategy>=K||N.level<2?0:N.level<6?1:6===N.level?2:3,c|=A<<6,0!==N.strstart&&(c|=32),c+=31-c%31,N.status=G,g(N,c),0!==N.strstart&&(g(N,y.adler>>>16),g(N,65535&y.adler)),y.adler=1}if(69===N.status)if(N.gzhead.extra){for(A=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>A&&(y.adler=I(y.adler,N.pending_buf,N.pending-A,A)),e(y),A=N.pending,N.pending!==N.pending_buf_size));)Y(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>A&&(y.adler=I(y.adler,N.pending_buf,N.pending-A,A)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(73===N.status)if(N.gzhead.name){A=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>A&&(y.adler=I(y.adler,N.pending_buf,N.pending-A,A)),e(y),A=N.pending,N.pending===N.pending_buf_size)){l=1;break}l=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,Y(N,l)}while(0!==l);N.gzhead.hcrc&&N.pending>A&&(y.adler=I(y.adler,N.pending_buf,N.pending-A,A)),0===l&&(N.gzindex=0,N.status=91)}else N.status=91;if(91===N.status)if(N.gzhead.comment){A=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>A&&(y.adler=I(y.adler,N.pending_buf,N.pending-A,A)),e(y),A=N.pending,N.pending===N.pending_buf_size)){l=1;break}l=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,Y(N,l)}while(0!==l);N.gzhead.hcrc&&N.pending>A&&(y.adler=I(y.adler,N.pending_buf,N.pending-A,A)),0===l&&(N.status=u)}else N.status=u;if(N.status===u&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&e(y),N.pending+2<=N.pending_buf_size&&(Y(N,255&y.adler),Y(N,y.adler>>8&255),y.adler=0,N.status=G)):N.status=G),0!==N.pending){if(e(y),0===y.avail_out)return N.last_flush=-1,P}else if(0===y.avail_in&&V(c)<=V(h)&&c!==i)return f(y,B);if(N.status===j&&0!==y.avail_in)return f(y,B);if(0!==y.avail_in||0!==N.lookahead||c!==o&&N.status!==j){let A=N.strategy===K?((y,c)=>{let A;for(;;){if(0===y.lookahead&&(R(y),0===y.lookahead)){if(c===o)return 1;break}if(y.match_length=0,A=p(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++,A&&(Q(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,c===i?(Q(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(Q(y,!1),0===y.strm.avail_out)?1:2})(N,c):N.strategy===my?((y,c)=>{let A,l,w,N;const W=y.window;for(;;){if(y.lookahead<=k){if(R(y),y.lookahead<=k&&c===o)return 1;if(0===y.lookahead)break}if(y.match_length=0,y.lookahead>=3&&y.strstart>0&&(w=y.strstart-1,l=W[w],l===W[++w]&&l===W[++w]&&l===W[++w])){N=y.strstart+k;do{}while(l===W[++w]&&l===W[++w]&&l===W[++w]&&l===W[++w]&&l===W[++w]&&l===W[++w]&&l===W[++w]&&l===W[++w]&&w<N);y.match_length=k-(N-w),y.match_length>y.lookahead&&(y.match_length=y.lookahead)}if(y.match_length>=3?(A=p(y,1,y.match_length-3),y.lookahead-=y.match_length,y.strstart+=y.match_length,y.match_length=0):(A=p(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++),A&&(Q(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,c===i?(Q(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(Q(y,!1),0===y.strm.avail_out)?1:2})(N,c):b[N.level].func(N,c);if(3!==A&&4!==A||(N.status=j),1===A||3===A)return 0===y.avail_out&&(N.last_flush=-1),P;if(2===A&&(c===O?W(N):c!==H&&(w(N,0,0,!1),c===L&&(J(N.head),0===N.lookahead&&(N.strstart=0,N.block_start=0,N.insert=0))),e(y),0===y.avail_out))return N.last_flush=-1,P}return c!==i?P:N.wrap<=0?D:(2===N.wrap?(Y(N,255&y.adler),Y(N,y.adler>>8&255),Y(N,y.adler>>16&255),Y(N,y.adler>>24&255),Y(N,255&y.total_in),Y(N,y.total_in>>8&255),Y(N,y.total_in>>16&255),Y(N,y.total_in>>24&255)):(g(N,y.adler>>>16),g(N,65535&y.adler)),e(y),N.wrap>0&&(N.wrap=-N.wrap),0!==N.pending?P:D)},y.exports.deflateEnd=y=>{if(!y||!y.state)return t;const c=y.state.status;return 42!==c&&69!==c&&73!==c&&91!==c&&c!==u&&c!==G&&c!==j?f(y,t):(y.state=null,c===G?f(y,s):P)},y.exports.deflateSetDictionary=(y,c)=>{let A=c.length;if(!y||!y.state)return t;const l=y.state,w=l.wrap;if(2===w||1===w&&42!==l.status||l.lookahead)return t;if(1===w&&(y.adler=h(y.adler,c,A,0)),l.wrap=0,A>=l.w_size){0===w&&(J(l.head),l.strstart=0,l.block_start=0,l.insert=0);let y=new Uint8Array(l.w_size);y.set(c.subarray(A-l.w_size,A),0),c=y,A=l.w_size}const N=y.avail_in,p=y.next_in,W=y.input;for(y.avail_in=A,y.next_in=0,y.input=c,R(l);l.lookahead>=3;){let y=l.strstart,c=l.lookahead-2;do{l.ins_h=U(l,l.ins_h,l.window[y+3-1]),l.prev[y&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=y,y++}while(--c);l.strstart=y,l.lookahead=2,R(l)}return l.strstart+=l.lookahead,l.block_start=l.strstart,l.insert=l.lookahead,l.lookahead=0,l.match_length=l.prev_length=2,l.match_available=0,y.next_in=p,y.input=W,y.avail_in=N,l.wrap=w,P},y.exports.deflateInfo="pako deflate (from Nodeca project)"},13477:y=>{"use strict";y.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13469:y=>{"use strict";y.exports=function(y,c){let A,l,w,N,p,W,h,I,q,o,O,L,i,H,P,D,t,s,B,X,C,K,my,T;const z=y.state;A=y.next_in,my=y.input,l=A+(y.avail_in-5),w=y.next_out,T=y.output,N=w-(c-y.avail_out),p=w+(y.avail_out-257),W=z.dmax,h=z.wsize,I=z.whave,q=z.wnext,o=z.window,O=z.hold,L=z.bits,i=z.lencode,H=z.distcode,P=(1<<z.lenbits)-1,D=(1<<z.distbits)-1;y:do{L<15&&(O+=my[A++]<<L,L+=8,O+=my[A++]<<L,L+=8),t=i[O&P];c:for(;;){if(s=t>>>24,O>>>=s,L-=s,s=t>>>16&255,0===s)T[w++]=65535&t;else{if(!(16&s)){if(0===(64&s)){t=i[(65535&t)+(O&(1<<s)-1)];continue c}if(32&s){z.mode=12;break y}y.Cc="invalid literal/length code",z.mode=30;break y}B=65535&t,s&=15,s&&(L<s&&(O+=my[A++]<<L,L+=8),B+=O&(1<<s)-1,O>>>=s,L-=s),L<15&&(O+=my[A++]<<L,L+=8,O+=my[A++]<<L,L+=8),t=H[O&D];A:for(;;){if(s=t>>>24,O>>>=s,L-=s,s=t>>>16&255,!(16&s)){if(0===(64&s)){t=H[(65535&t)+(O&(1<<s)-1)];continue A}y.Cc="invalid distance code",z.mode=30;break y}if(X=65535&t,s&=15,L<s&&(O+=my[A++]<<L,L+=8,L<s&&(O+=my[A++]<<L,L+=8)),X+=O&(1<<s)-1,X>W){y.Cc="invalid distance too far back",z.mode=30;break y}if(O>>>=s,L-=s,s=w-N,X>s){if(s=X-s,s>I&&z.sane){y.Cc="invalid distance too far back",z.mode=30;break y}if(C=0,K=o,0===q){if(C+=h-s,s<B){B-=s;do{T[w++]=o[C++]}while(--s);C=w-X,K=T}}else if(q<s){if(C+=h+q-s,s-=q,s<B){B-=s;do{T[w++]=o[C++]}while(--s);if(C=0,q<B){s=q,B-=s;do{T[w++]=o[C++]}while(--s);C=w-X,K=T}}}else if(C+=q-s,s<B){B-=s;do{T[w++]=o[C++]}while(--s);C=w-X,K=T}for(;B>2;)T[w++]=K[C++],T[w++]=K[C++],T[w++]=K[C++],B-=3;B&&(T[w++]=K[C++],B>1&&(T[w++]=K[C++]))}else{C=w-X;do{T[w++]=T[C++],T[w++]=T[C++],T[w++]=T[C++],B-=3}while(B>2);B&&(T[w++]=T[C++],B>1&&(T[w++]=T[C++]))}break}}break}}while(A<l&&w<p);B=L>>3,A-=B,L-=B<<3,O&=(1<<L)-1,y.next_in=A,y.next_out=w,y.avail_in=A<l?l-A+5:5-(A-l),y.avail_out=w<p?p-w+257:257-(w-p),z.hold=O,z.bits=L}},13466:(y,c,A)=>{"use strict";const l=A(13412),w=A(13421),N=A(13469),p=A(13472),{Z_FINISH:W,Z_BLOCK:h,Z_TREES:I,Z_OK:q,Z_STREAM_END:o,Z_NEED_DICT:O,Z_STREAM_ERROR:L,Z_DATA_ERROR:i,Z_MEM_ERROR:H,Z_BUF_ERROR:P,Z_DEFLATED:D}=A(13436),t=12,s=30,B=y=>(y>>>24&255)+(y>>>8&65280)+((65280&y)<<8)+((255&y)<<24);function X(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const C=y=>{if(!y||!y.state)return L;const c=y.state;return y.total_in=y.total_out=c.total=0,y.Cc="",c.wrap&&(y.adler=1&c.wrap),c.mode=1,c.last=0,c.havedict=0,c.dmax=32768,c.head=null,c.hold=0,c.bits=0,c.lencode=c.lendyn=new Int32Array(852),c.distcode=c.distdyn=new Int32Array(592),c.sane=1,c.back=-1,q},K=y=>{if(!y||!y.state)return L;const c=y.state;return c.wsize=0,c.whave=0,c.wnext=0,C(y)},my=(y,c)=>{let A;if(!y||!y.state)return L;const l=y.state;return c<0?(A=0,c=-c):(A=1+(c>>4),c<48&&(c&=15)),c&&(c<8||c>15)?L:(null!==l.window&&l.wbits!==c&&(l.window=null),l.wrap=A,l.wbits=c,K(y))},T=(y,c)=>{if(!y)return L;const A=new X;y.state=A,A.window=null;const l=my(y,c);return l!==q&&(y.state=null),l};let z,S,M=!0;const k=y=>{if(M){z=new Int32Array(512),S=new Int32Array(32);let c=0;for(;c<144;)y.lens[c++]=8;for(;c<256;)y.lens[c++]=9;for(;c<280;)y.lens[c++]=7;for(;c<288;)y.lens[c++]=8;for(p(1,y.lens,0,288,z,0,y.work,{bits:9}),c=0;c<32;)y.lens[c++]=5;p(2,y.lens,0,32,S,0,y.work,{bits:5}),M=!1}y.lencode=z,y.lenbits=9,y.distcode=S,y.distbits=5},a=(y,c,A,l)=>{let w;const N=y.state;return null===N.window&&(N.wsize=1<<N.wbits,N.wnext=0,N.whave=0,N.window=new Uint8Array(N.wsize)),l>=N.wsize?(N.window.set(c.subarray(A-N.wsize,A),0),N.wnext=0,N.whave=N.wsize):(w=N.wsize-N.wnext,w>l&&(w=l),N.window.set(c.subarray(A-l,A-l+w),N.wnext),(l-=w)?(N.window.set(c.subarray(A-l,A),0),N.wnext=l,N.whave=N.wsize):(N.wnext+=w,N.wnext===N.wsize&&(N.wnext=0),N.whave<N.wsize&&(N.whave+=w))),0};y.exports.inflateReset=K,y.exports.inflateReset2=my,y.exports.inflateResetKeep=C,y.exports.inflateInit=y=>T(y,15),y.exports.inflateInit2=T,y.exports.inflate=(y,c)=>{let A,X,C,K,my,T,z,S,M,u,G,j,f,V,J,U,e,Q,Y,g,x,F,R=0;const r=new Uint8Array(4);let n,E;const b=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!y||!y.state||!y.output||!y.input&&0!==y.avail_in)return L;A=y.state,A.mode===t&&(A.mode=13),my=y.next_out,C=y.output,z=y.avail_out,K=y.next_in,X=y.input,T=y.avail_in,S=A.hold,M=A.bits,u=T,G=z,F=q;y:for(;;)switch(A.mode){case 1:if(0===A.wrap){A.mode=13;break}for(;M<16;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if(2&A.wrap&&35615===S){A.check=0,r[0]=255&S,r[1]=S>>>8&255,A.check=w(A.check,r,2,0),S=0,M=0,A.mode=2;break}if(A.flags=0,A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&S)<<8)+(S>>8))%31){y.Cc="incorrect header check",A.mode=s;break}if((15&S)!==D){y.Cc="unknown compression method",A.mode=s;break}if(S>>>=4,M-=4,x=8+(15&S),0===A.wbits)A.wbits=x;else if(x>A.wbits){y.Cc="invalid window size",A.mode=s;break}A.dmax=1<<A.wbits,y.adler=A.check=1,A.mode=512&S?10:t,S=0,M=0;break;case 2:for(;M<16;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if(A.flags=S,(255&A.flags)!==D){y.Cc="unknown compression method",A.mode=s;break}if(57344&A.flags){y.Cc="unknown header flags set",A.mode=s;break}A.head&&(A.head.text=S>>8&1),512&A.flags&&(r[0]=255&S,r[1]=S>>>8&255,A.check=w(A.check,r,2,0)),S=0,M=0,A.mode=3;case 3:for(;M<32;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}A.head&&(A.head.time=S),512&A.flags&&(r[0]=255&S,r[1]=S>>>8&255,r[2]=S>>>16&255,r[3]=S>>>24&255,A.check=w(A.check,r,4,0)),S=0,M=0,A.mode=4;case 4:for(;M<16;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}A.head&&(A.head.xflags=255&S,A.head.os=S>>8),512&A.flags&&(r[0]=255&S,r[1]=S>>>8&255,A.check=w(A.check,r,2,0)),S=0,M=0,A.mode=5;case 5:if(1024&A.flags){for(;M<16;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}A.length=S,A.head&&(A.head.extra_len=S),512&A.flags&&(r[0]=255&S,r[1]=S>>>8&255,A.check=w(A.check,r,2,0)),S=0,M=0}else A.head&&(A.head.extra=null);A.mode=6;case 6:if(1024&A.flags&&(j=A.length,j>T&&(j=T),j&&(A.head&&(x=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Uint8Array(A.head.extra_len)),A.head.extra.set(X.subarray(K,K+j),x)),512&A.flags&&(A.check=w(A.check,X,j,K)),T-=j,K+=j,A.length-=j),A.length))break y;A.length=0,A.mode=7;case 7:if(2048&A.flags){if(0===T)break y;j=0;do{x=X[K+j++],A.head&&x&&A.length<65536&&(A.head.name+=String.fromCharCode(x))}while(x&&j<T);if(512&A.flags&&(A.check=w(A.check,X,j,K)),T-=j,K+=j,x)break y}else A.head&&(A.head.name=null);A.length=0,A.mode=8;case 8:if(4096&A.flags){if(0===T)break y;j=0;do{x=X[K+j++],A.head&&x&&A.length<65536&&(A.head.comment+=String.fromCharCode(x))}while(x&&j<T);if(512&A.flags&&(A.check=w(A.check,X,j,K)),T-=j,K+=j,x)break y}else A.head&&(A.head.comment=null);A.mode=9;case 9:if(512&A.flags){for(;M<16;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if(S!==(65535&A.check)){y.Cc="header crc mismatch",A.mode=s;break}S=0,M=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),y.adler=A.check=0,A.mode=t;break;case 10:for(;M<32;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}y.adler=A.check=B(S),S=0,M=0,A.mode=11;case 11:if(0===A.havedict)return y.next_out=my,y.avail_out=z,y.next_in=K,y.avail_in=T,A.hold=S,A.bits=M,O;y.adler=A.check=1,A.mode=t;case t:if(c===h||c===I)break y;case 13:if(A.last){S>>>=7&M,M-=7&M,A.mode=27;break}for(;M<3;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}switch(A.last=1&S,S>>>=1,M-=1,3&S){case 0:A.mode=14;break;case 1:if(k(A),A.mode=20,c===I){S>>>=2,M-=2;break y}break;case 2:A.mode=17;break;case 3:y.Cc="invalid block type",A.mode=s}S>>>=2,M-=2;break;case 14:for(S>>>=7&M,M-=7&M;M<32;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if((65535&S)!==(S>>>16^65535)){y.Cc="invalid stored block lengths",A.mode=s;break}if(A.length=65535&S,S=0,M=0,A.mode=15,c===I)break y;case 15:A.mode=16;case 16:if(j=A.length,j){if(j>T&&(j=T),j>z&&(j=z),0===j)break y;C.set(X.subarray(K,K+j),my),T-=j,K+=j,z-=j,my+=j,A.length-=j;break}A.mode=t;break;case 17:for(;M<14;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if(A.nlen=257+(31&S),S>>>=5,M-=5,A.ndist=1+(31&S),S>>>=5,M-=5,A.ncode=4+(15&S),S>>>=4,M-=4,A.nlen>286||A.ndist>30){y.Cc="too many length or distance symbols",A.mode=s;break}A.have=0,A.mode=18;case 18:for(;A.have<A.ncode;){for(;M<3;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}A.lens[b[A.have++]]=7&S,S>>>=3,M-=3}for(;A.have<19;)A.lens[b[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,n={bits:A.lenbits},F=p(0,A.lens,0,19,A.lencode,0,A.work,n),A.lenbits=n.bits,F){y.Cc="invalid code lengths set",A.mode=s;break}A.have=0,A.mode=19;case 19:for(;A.have<A.nlen+A.ndist;){for(;R=A.lencode[S&(1<<A.lenbits)-1],J=R>>>24,U=R>>>16&255,e=65535&R,!(J<=M);){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if(e<16)S>>>=J,M-=J,A.lens[A.have++]=e;else{if(16===e){for(E=J+2;M<E;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if(S>>>=J,M-=J,0===A.have){y.Cc="invalid bit length repeat",A.mode=s;break}x=A.lens[A.have-1],j=3+(3&S),S>>>=2,M-=2}else if(17===e){for(E=J+3;M<E;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}S>>>=J,M-=J,x=0,j=3+(7&S),S>>>=3,M-=3}else{for(E=J+7;M<E;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}S>>>=J,M-=J,x=0,j=11+(127&S),S>>>=7,M-=7}if(A.have+j>A.nlen+A.ndist){y.Cc="invalid bit length repeat",A.mode=s;break}for(;j--;)A.lens[A.have++]=x}}if(A.mode===s)break;if(0===A.lens[256]){y.Cc="invalid code -- missing end-of-block",A.mode=s;break}if(A.lenbits=9,n={bits:A.lenbits},F=p(1,A.lens,0,A.nlen,A.lencode,0,A.work,n),A.lenbits=n.bits,F){y.Cc="invalid literal/lengths set",A.mode=s;break}if(A.distbits=6,A.distcode=A.distdyn,n={bits:A.distbits},F=p(2,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,n),A.distbits=n.bits,F){y.Cc="invalid distances set",A.mode=s;break}if(A.mode=20,c===I)break y;case 20:A.mode=21;case 21:if(T>=6&&z>=258){y.next_out=my,y.avail_out=z,y.next_in=K,y.avail_in=T,A.hold=S,A.bits=M,N(y,G),my=y.next_out,C=y.output,z=y.avail_out,K=y.next_in,X=y.input,T=y.avail_in,S=A.hold,M=A.bits,A.mode===t&&(A.back=-1);break}for(A.back=0;R=A.lencode[S&(1<<A.lenbits)-1],J=R>>>24,U=R>>>16&255,e=65535&R,!(J<=M);){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if(U&&0===(240&U)){for(Q=J,Y=U,g=e;R=A.lencode[g+((S&(1<<Q+Y)-1)>>Q)],J=R>>>24,U=R>>>16&255,e=65535&R,!(Q+J<=M);){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}S>>>=Q,M-=Q,A.back+=Q}if(S>>>=J,M-=J,A.back+=J,A.length=e,0===U){A.mode=26;break}if(32&U){A.back=-1,A.mode=t;break}if(64&U){y.Cc="invalid literal/length code",A.mode=s;break}A.extra=15&U,A.mode=22;case 22:if(A.extra){for(E=A.extra;M<E;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}A.length+=S&(1<<A.extra)-1,S>>>=A.extra,M-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=23;case 23:for(;R=A.distcode[S&(1<<A.distbits)-1],J=R>>>24,U=R>>>16&255,e=65535&R,!(J<=M);){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if(0===(240&U)){for(Q=J,Y=U,g=e;R=A.distcode[g+((S&(1<<Q+Y)-1)>>Q)],J=R>>>24,U=R>>>16&255,e=65535&R,!(Q+J<=M);){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}S>>>=Q,M-=Q,A.back+=Q}if(S>>>=J,M-=J,A.back+=J,64&U){y.Cc="invalid distance code",A.mode=s;break}A.offset=e,A.extra=15&U,A.mode=24;case 24:if(A.extra){for(E=A.extra;M<E;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}A.offset+=S&(1<<A.extra)-1,S>>>=A.extra,M-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){y.Cc="invalid distance too far back",A.mode=s;break}A.mode=25;case 25:if(0===z)break y;if(j=G-z,A.offset>j){if(j=A.offset-j,j>A.whave&&A.sane){y.Cc="invalid distance too far back",A.mode=s;break}j>A.wnext?(j-=A.wnext,f=A.wsize-j):f=A.wnext-j,j>A.length&&(j=A.length),V=A.window}else V=C,f=my-A.offset,j=A.length;j>z&&(j=z),z-=j,A.length-=j;do{C[my++]=V[f++]}while(--j);0===A.length&&(A.mode=21);break;case 26:if(0===z)break y;C[my++]=A.length,z--,A.mode=21;break;case 27:if(A.wrap){for(;M<32;){if(0===T)break y;T--,S|=X[K++]<<M,M+=8}if(G-=z,y.total_out+=G,A.total+=G,G&&(y.adler=A.check=A.flags?w(A.check,C,G,my-G):l(A.check,C,G,my-G)),G=z,(A.flags?S:B(S))!==A.check){y.Cc="incorrect data check",A.mode=s;break}S=0,M=0}A.mode=28;case 28:if(A.wrap&&A.flags){for(;M<32;){if(0===T)break y;T--,S+=X[K++]<<M,M+=8}if(S!==(4294967295&A.total)){y.Cc="incorrect length check",A.mode=s;break}S=0,M=0}A.mode=29;case 29:F=o;break y;case s:F=i;break y;case 31:return H;default:return L}return y.next_out=my,y.avail_out=z,y.next_in=K,y.avail_in=T,A.hold=S,A.bits=M,(A.wsize||G!==y.avail_out&&A.mode<s&&(A.mode<27||c!==W))&&a(y,y.output,y.next_out,G-y.avail_out)?(A.mode=31,H):(u-=y.avail_in,G-=y.avail_out,y.total_in+=u,y.total_out+=G,A.total+=G,A.wrap&&G&&(y.adler=A.check=A.flags?w(A.check,C,G,y.next_out-G):l(A.check,C,G,y.next_out-G)),y.data_type=A.bits+(A.last?64:0)+(A.mode===t?128:0)+(20===A.mode||15===A.mode?256:0),(0===u&&0===G||c===W)&&F===q&&(F=P),F)},y.exports.inflateEnd=y=>{if(!y||!y.state)return L;let c=y.state;return c.window&&(c.window=null),y.state=null,q},y.exports.inflateGetHeader=(y,c)=>{if(!y||!y.state)return L;const A=y.state;return 0===(2&A.wrap)?L:(A.head=c,c.done=!1,q)},y.exports.inflateSetDictionary=(y,c)=>{const A=c.length;let w,N,p;return y&&y.state?(w=y.state,0!==w.wrap&&11!==w.mode?L:11===w.mode&&(N=1,N=l(N,c,A,0),N!==w.check)?i:(p=a(y,c,A,A),p?(w.mode=31,H):(w.havedict=1,q))):L},y.exports.inflateInfo="pako inflate (from Nodeca project)"},13472:y=>{"use strict";const c=15,A=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),l=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),w=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),N=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);y.exports=(y,p,W,h,I,q,o,O)=>{const L=O.bits;let i,H,P,D,t,s,B=0,X=0,C=0,K=0,my=0,T=0,z=0,S=0,M=0,k=0,a=null,u=0;const G=new Uint16Array(16),j=new Uint16Array(16);let f,V,J,U=null,e=0;for(B=0;B<=c;B++)G[B]=0;for(X=0;X<h;X++)G[p[W+X]]++;for(my=L,K=c;K>=1&&0===G[K];K--);if(my>K&&(my=K),0===K)return I[q++]=20971520,I[q++]=20971520,O.bits=1,0;for(C=1;C<K&&0===G[C];C++);for(my<C&&(my=C),S=1,B=1;B<=c;B++)if(S<<=1,S-=G[B],S<0)return-1;if(S>0&&(0===y||1!==K))return-1;for(j[1]=0,B=1;B<c;B++)j[B+1]=j[B]+G[B];for(X=0;X<h;X++)0!==p[W+X]&&(o[j[p[W+X]]++]=X);if(0===y?(a=U=o,s=19):1===y?(a=A,u-=257,U=l,e-=257,s=256):(a=w,U=N,s=-1),k=0,X=0,B=C,t=q,T=my,z=0,P=-1,M=1<<my,D=M-1,1===y&&M>852||2===y&&M>592)return 1;for(;;){f=B-z,o[X]<s?(V=0,J=o[X]):o[X]>s?(V=U[e+o[X]],J=a[u+o[X]]):(V=96,J=0),i=1<<B-z,H=1<<T,C=H;do{H-=i,I[t+(k>>z)+H]=f<<24|V<<16|J}while(0!==H);for(i=1<<B-1;k&i;)i>>=1;if(0!==i?(k&=i-1,k+=i):k=0,X++,0===--G[B]){if(B===K)break;B=p[W+o[X]]}if(B>my&&(k&D)!==P){for(0===z&&(z=my),t+=C,T=B-z,S=1<<T;T+z<K&&(S-=G[T+z],!(S<=0));)T++,S<<=1;if(M+=1<<T,1===y&&M>852||2===y&&M>592)return 1;P=k&D,I[P]=my<<24|T<<16|t-q}}return 0!==k&&(I[t+k]=B-z<<24|64<<16),O.bits=my,0}},13429:y=>{"use strict";y.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13407:y=>{"use strict";function c(y){let c=y.length;for(;--c>=0;)y[c]=0}const A=256,l=286,w=30,N=15,p=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),W=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),q=new Array(576);c(q);const o=new Array(60);c(o);const O=new Array(512);c(O);const L=new Array(256);c(L);const i=new Array(29);c(i);const H=new Array(w);function P(y,c,A,l,w){this.static_tree=y,this.extra_bits=c,this.extra_base=A,this.elems=l,this.max_length=w,this.has_stree=y&&y.length}let D,t,s;function B(y,c){this.dyn_tree=y,this.max_code=0,this.stat_desc=c}c(H);const X=y=>y<256?O[y]:O[256+(y>>>7)],C=(y,c)=>{y.pending_buf[y.pending++]=255&c,y.pending_buf[y.pending++]=c>>>8&255},K=(y,c,A)=>{y.bi_valid>16-A?(y.bi_buf|=c<<y.bi_valid&65535,C(y,y.bi_buf),y.bi_buf=c>>16-y.bi_valid,y.bi_valid+=A-16):(y.bi_buf|=c<<y.bi_valid&65535,y.bi_valid+=A)},my=(y,c,A)=>{K(y,A[2*c],A[2*c+1])},T=(y,c)=>{let A=0;do{A|=1&y,y>>>=1,A<<=1}while(--c>0);return A>>>1},z=(y,c,A)=>{const l=new Array(16);let w,p,W=0;for(w=1;w<=N;w++)l[w]=W=W+A[w-1]<<1;for(p=0;p<=c;p++){let c=y[2*p+1];0!==c&&(y[2*p]=T(l[c]++,c))}},S=y=>{let c;for(c=0;c<l;c++)y.dyn_ltree[2*c]=0;for(c=0;c<w;c++)y.dyn_dtree[2*c]=0;for(c=0;c<19;c++)y.bl_tree[2*c]=0;y.dyn_ltree[512]=1,y.opt_len=y.static_len=0,y.last_lit=y.matches=0},M=y=>{y.bi_valid>8?C(y,y.bi_buf):y.bi_valid>0&&(y.pending_buf[y.pending++]=y.bi_buf),y.bi_buf=0,y.bi_valid=0},k=(y,c,A,l)=>{const w=2*c,N=2*A;return y[w]<y[N]||y[w]===y[N]&&l[c]<=l[A]},a=(y,c,A)=>{const l=y.heap[A];let w=A<<1;for(;w<=y.heap_len&&(w<y.heap_len&&k(c,y.heap[w+1],y.heap[w],y.depth)&&w++,!k(c,l,y.heap[w],y.depth));)y.heap[A]=y.heap[w],A=w,w<<=1;y.heap[A]=l},u=(y,c,l)=>{let w,N,h,I,q=0;if(0!==y.last_lit)do{w=y.pending_buf[y.d_buf+2*q]<<8|y.pending_buf[y.d_buf+2*q+1],N=y.pending_buf[y.l_buf+q],q++,0===w?my(y,N,c):(h=L[N],my(y,h+A+1,c),I=p[h],0!==I&&(N-=i[h],K(y,N,I)),w--,h=X(w),my(y,h,l),I=W[h],0!==I&&(w-=H[h],K(y,w,I)))}while(q<y.last_lit);my(y,256,c)},G=(y,c)=>{const A=c.dyn_tree,l=c.stat_desc.static_tree,w=c.stat_desc.has_stree,p=c.stat_desc.elems;let W,h,I,q=-1;for(y.heap_len=0,y.heap_max=573,W=0;W<p;W++)0!==A[2*W]?(y.heap[++y.heap_len]=q=W,y.depth[W]=0):A[2*W+1]=0;for(;y.heap_len<2;)I=y.heap[++y.heap_len]=q<2?++q:0,A[2*I]=1,y.depth[I]=0,y.opt_len--,w&&(y.static_len-=l[2*I+1]);for(c.max_code=q,W=y.heap_len>>1;W>=1;W--)a(y,A,W);I=p;do{W=y.heap[1],y.heap[1]=y.heap[y.heap_len--],a(y,A,1),h=y.heap[1],y.heap[--y.heap_max]=W,y.heap[--y.heap_max]=h,A[2*I]=A[2*W]+A[2*h],y.depth[I]=(y.depth[W]>=y.depth[h]?y.depth[W]:y.depth[h])+1,A[2*W+1]=A[2*h+1]=I,y.heap[1]=I++,a(y,A,1)}while(y.heap_len>=2);y.heap[--y.heap_max]=y.heap[1],((y,c)=>{const A=c.dyn_tree,l=c.max_code,w=c.stat_desc.static_tree,p=c.stat_desc.has_stree,W=c.stat_desc.extra_bits,h=c.stat_desc.extra_base,I=c.stat_desc.max_length;let q,o,O,L,i,H,P=0;for(L=0;L<=N;L++)y.bl_count[L]=0;for(A[2*y.heap[y.heap_max]+1]=0,q=y.heap_max+1;q<573;q++)o=y.heap[q],L=A[2*A[2*o+1]+1]+1,L>I&&(L=I,P++),A[2*o+1]=L,o>l||(y.bl_count[L]++,i=0,o>=h&&(i=W[o-h]),H=A[2*o],y.opt_len+=H*(L+i),p&&(y.static_len+=H*(w[2*o+1]+i)));if(0!==P){do{for(L=I-1;0===y.bl_count[L];)L--;y.bl_count[L]--,y.bl_count[L+1]+=2,y.bl_count[I]--,P-=2}while(P>0);for(L=I;0!==L;L--)for(o=y.bl_count[L];0!==o;)O=y.heap[--q],O>l||(A[2*O+1]!==L&&(y.opt_len+=(L-A[2*O+1])*A[2*O],A[2*O+1]=L),o--)}})(y,c),z(A,q,y.bl_count)},j=(y,c,A)=>{let l,w,N=-1,p=c[1],W=0,h=7,I=4;for(0===p&&(h=138,I=3),c[2*(A+1)+1]=65535,l=0;l<=A;l++)w=p,p=c[2*(l+1)+1],++W<h&&w===p||(W<I?y.bl_tree[2*w]+=W:0!==w?(w!==N&&y.bl_tree[2*w]++,y.bl_tree[32]++):W<=10?y.bl_tree[34]++:y.bl_tree[36]++,W=0,N=w,0===p?(h=138,I=3):w===p?(h=6,I=3):(h=7,I=4))},f=(y,c,A)=>{let l,w,N=-1,p=c[1],W=0,h=7,I=4;for(0===p&&(h=138,I=3),l=0;l<=A;l++)if(w=p,p=c[2*(l+1)+1],!(++W<h&&w===p)){if(W<I)do{my(y,w,y.bl_tree)}while(0!==--W);else 0!==w?(w!==N&&(my(y,w,y.bl_tree),W--),my(y,16,y.bl_tree),K(y,W-3,2)):W<=10?(my(y,17,y.bl_tree),K(y,W-3,3)):(my(y,18,y.bl_tree),K(y,W-11,7));W=0,N=w,0===p?(h=138,I=3):w===p?(h=6,I=3):(h=7,I=4)}};let V=!1;const J=(y,c,A,l)=>{K(y,0+(l?1:0),3),((y,c,A,l)=>{M(y),l&&(C(y,A),C(y,~A)),y.pending_buf.set(y.window.subarray(c,c+A),y.pending),y.pending+=A})(y,c,A,!0)};y.exports._tr_init=y=>{V||((()=>{let y,c,A,I,B;const X=new Array(16);for(A=0,I=0;I<28;I++)for(i[I]=A,y=0;y<1<<p[I];y++)L[A++]=I;for(L[A-1]=I,B=0,I=0;I<16;I++)for(H[I]=B,y=0;y<1<<W[I];y++)O[B++]=I;for(B>>=7;I<w;I++)for(H[I]=B<<7,y=0;y<1<<W[I]-7;y++)O[256+B++]=I;for(c=0;c<=N;c++)X[c]=0;for(y=0;y<=143;)q[2*y+1]=8,y++,X[8]++;for(;y<=255;)q[2*y+1]=9,y++,X[9]++;for(;y<=279;)q[2*y+1]=7,y++,X[7]++;for(;y<=287;)q[2*y+1]=8,y++,X[8]++;for(z(q,287,X),y=0;y<w;y++)o[2*y+1]=5,o[2*y]=T(y,5);D=new P(q,p,257,l,N),t=new P(o,W,0,w,N),s=new P(new Array(0),h,0,19,7)})(),V=!0),y.l_desc=new B(y.dyn_ltree,D),y.d_desc=new B(y.dyn_dtree,t),y.bl_desc=new B(y.bl_tree,s),y.bi_buf=0,y.bi_valid=0,S(y)},y.exports._tr_stored_block=J,y.exports._tr_flush_block=(y,c,l,w)=>{let N,p,W=0;y.level>0?(2===y.strm.data_type&&(y.strm.data_type=(y=>{let c,l=4093624447;for(c=0;c<=31;c++,l>>>=1)if(1&l&&0!==y.dyn_ltree[2*c])return 0;if(0!==y.dyn_ltree[18]||0!==y.dyn_ltree[20]||0!==y.dyn_ltree[26])return 1;for(c=32;c<A;c++)if(0!==y.dyn_ltree[2*c])return 1;return 0})(y)),G(y,y.l_desc),G(y,y.d_desc),W=(y=>{let c;for(j(y,y.dyn_ltree,y.l_desc.max_code),j(y,y.dyn_dtree,y.d_desc.max_code),G(y,y.bl_desc),c=18;c>=3&&0===y.bl_tree[2*I[c]+1];c--);return y.opt_len+=3*(c+1)+5+5+4,c})(y),N=y.opt_len+3+7>>>3,p=y.static_len+3+7>>>3,p<=N&&(N=p)):N=p=l+5,l+4<=N&&-1!==c?J(y,c,l,w):4===y.strategy||p===N?(K(y,2+(w?1:0),3),u(y,q,o)):(K(y,4+(w?1:0),3),((y,c,A,l)=>{let w;for(K(y,c-257,5),K(y,A-1,5),K(y,l-4,4),w=0;w<l;w++)K(y,y.bl_tree[2*I[w]+1],3);f(y,y.dyn_ltree,c-1),f(y,y.dyn_dtree,A-1)})(y,y.l_desc.max_code+1,y.d_desc.max_code+1,W+1),u(y,y.dyn_ltree,y.dyn_dtree)),S(y),w&&M(y)},y.exports._tr_tally=(y,c,l)=>(y.pending_buf[y.d_buf+2*y.last_lit]=c>>>8&255,y.pending_buf[y.d_buf+2*y.last_lit+1]=255&c,y.pending_buf[y.l_buf+y.last_lit]=255&l,y.last_lit++,0===c?y.dyn_ltree[2*l]++:(y.matches++,c--,y.dyn_ltree[2*(L[l]+A+1)]++,y.dyn_dtree[2*X(c)]++),y.last_lit===y.lit_bufsize-1),y.exports._tr_align=y=>{K(y,2,3),my(y,256,q),(y=>{16===y.bi_valid?(C(y,y.bi_buf),y.bi_buf=0,y.bi_valid=0):y.bi_valid>=8&&(y.pending_buf[y.pending++]=255&y.bi_buf,y.bi_buf>>=8,y.bi_valid-=8)})(y)}},13454:y=>{"use strict";y.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Cc="",this.state=null,this.data_type=2,this.adler=0}},13091:y=>{function c(y,c,A){for(var l=y.length,w=-1/0,N=1/0,p=0;p<l;p++){var W=(A[0][p]-y[p])/c[p],h=(A[1][p]-y[p])/c[p];if(W>h){var I=W;W=h,h=I}if(h<w||W>N)return 1/0;W>w&&(w=W),h<N&&(N=h)}return w>N?1/0:w}y.exports=function(y,A,l,w){var N=c(A,l,w);if(N===1/0)y=null;else{y=y||[];for(var p=0;p<A.length;p++)y[p]=A[p]+l[p]*N}return y},y.exports.distance=c},14486:(y,c,A)=>{"use strict";A.d(c,{c:()=>p});var l=A(33);const w=l.useLayoutEffect;const N=function(y){var c=(0,l.useRef)(y);return w((function(){c.current=y})),c};var p=function(y){var c=N(y);(0,l.Lc)((function(){var y=function(y){var A;if(null!=c.current&&(A=c.current(y)),y.defaultPrevented&&(y.returnValue=""),"string"===typeof A)return y.returnValue=A,A};return window.addEventListener("beforeunload",y),function(){window.removeEventListener("beforeunload",y)}}),[])}},14437:(y,c,A)=>{"use strict";var l=A(14444),w=Array.prototype.concat,N=Array.prototype.slice,p=y.exports=function(y){for(var c=[],A=0,p=y.length;A<p;A++){var W=y[A];l(W)?c=w.call(c,N.call(W)):c.push(W)}return c};p.wrap=function(y){return function(){return y(p(arguments))}}},14444:y=>{y.exports=function(y){return!(!y||"string"===typeof y)&&(y instanceof Array||Array.isArray(y)||y.length>=0&&(y.splice instanceof Function||Object.getOwnPropertyDescriptor(y,y.length-1)&&"String"!==y.constructor.name))}},13362:(y,c,A)=>{var l=A(13364);function w(y){for(var c,A,w=0,N=y.length,p=0;p<y.length;){for(c=y[p],A=0;p<N&&y[p]===c;)++p,++A;w+=l.log2(A)/7|0,w+=l.log2(c>>>0)/7|0,w+=2}return w}c.size=w,c.encode=function(y,c){c||(c=new Uint8Array(w(y)));for(var A,l,N=0,p=c.length,W=0;W<y.length;){for(A=y[W],l=0;W<y.length&&y[W]===A;)++W,++l;for(;N<p&&l>=128;)c[N++]=128+(127&l),l>>>=7;if(N>=p)throw new Error("RLE buffer overflow");for(c[N++]=l,A>>>=0;N<p&&A>=128;)c[N++]=128+(127&A),A>>>=7;if(N>=p)throw new Error("RLE buffer overflow");c[N++]=A}return c},c.decode=function(y,c){for(var A,l,w,N,p=c.length,W=y.length,h=0,I=0;I<W;){for(A=0,l=0;I<W&&y[I]>=128;)A+=(127&y[I++])<<l,l+=7;if(A+=y[I++]<<l,I>=W)throw new Error("RLE buffer underrun");if(h+A>p)throw new Error("Chunk buffer overflow");for(w=0,l=0;I<W&&y[I]>=128;)w+=(127&y[I++])<<l,l+=7;if(I>=W)throw new Error("RLE buffer underrun");for(w+=y[I++]<<l,N=0;N<A;++N)c[h++]=w}return c}},13364:(y,c)=>{"use strict";function A(y){var c=32;return(y&=-y)&&c--,65535&y&&(c-=16),16711935&y&&(c-=8),252645135&y&&(c-=4),858993459&y&&(c-=2),1431655765&y&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(y){return(y>0)-(y<0)},c.abs=function(y){var c=y>>31;return(y^c)-c},c.min=function(y,c){return c^(y^c)&-(y<c)},c.max=function(y,c){return y^(y^c)&-(y<c)},c.isPow2=function(y){return!(y&y-1)&&!!y},c.log2=function(y){var c,A;return c=(y>65535)<<4,c|=A=((y>>>=c)>255)<<3,c|=A=((y>>>=A)>15)<<2,(c|=A=((y>>>=A)>3)<<1)|(y>>>=A)>>1},c.log10=function(y){return y>=1e9?9:y>=1e8?8:y>=1e7?7:y>=1e6?6:y>=1e5?5:y>=1e4?4:y>=1e3?3:y>=100?2:y>=10?1:0},c.popCount=function(y){return 16843009*((y=(858993459&(y-=y>>>1&1431655765))+(y>>>2&858993459))+(y>>>4)&252645135)>>>24},c.countTrailingZeros=A,c.nextPow2=function(y){return y+=0===y,--y,y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)+1},c.prevPow2=function(y){return y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,(y|=y>>>16)-(y>>>1)},c.parity=function(y){return y^=y>>>16,y^=y>>>8,y^=y>>>4,27030>>>(y&=15)&1};var l=new Array(256);!function(y){for(var c=0;c<256;++c){var A=c,l=c,w=7;for(A>>>=1;A;A>>>=1)l<<=1,l|=1&A,--w;y[c]=l<<w&255}}(l),c.reverse=function(y){return l[255&y]<<24|l[y>>>8&255]<<16|l[y>>>16&255]<<8|l[y>>>24&255]},c.interleave2=function(y,c){return(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(y,c){return(y=65535&((y=16711935&((y=252645135&((y=858993459&((y=y>>>c&1431655765)|y>>>1))|y>>>2))|y>>>4))|y>>>16))<<16>>16},c.interleave3=function(y,c,A){return y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2),(y|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<2},c.deinterleave3=function(y,c){return(y=1023&((y=4278190335&((y=251719695&((y=3272356035&((y=y>>>c&1227133513)|y>>>2))|y>>>4))|y>>>8))|y>>>16))<<22>>22},c.nextCombination=function(y){var c=y|y-1;return c+1|(~c&-~c)-1>>>A(y)+1}},13383:y=>{"use strict";y.exports=function(y,c,A,l){var w=self||window;try{try{var N;try{N=new w.Blob([y])}catch(I){(N=new(w.BlobBuilder||w.WebKitBlobBuilder||w.MozBlobBuilder||w.MSBlobBuilder)).append(y),N=N.getBlob()}var p=w.URL||w.webkitURL,W=p.createObjectURL(N),h=new w[c](W,A);return p.revokeObjectURL(W),h}catch(I){return new w[c]("data:application/javascript,".concat(encodeURIComponent(y)),A)}}catch(I){if(!l)throw Error("Inline worker is not supported");return new w[c](l,A)}}},13077:(y,c,A)=>{"use strict";function l(y,c,A,l,w){var N={};return Object.keys(l).forEach((function(y){N[y]=l[y]})),N.enumerable=!!N.enumerable,N.configurable=!!N.configurable,("value"in N||N.initializer)&&(N.writable=!0),N=A.slice().reverse().reduce((function(A,l){return l(y,c,A)||A}),N),w&&void 0!==N.initializer&&(N.value=N.initializer?N.initializer.call(w):void 0,N.initializer=void 0),void 0===N.initializer&&(Object.defineProperty(y,c,N),N=null),N}A.d(c,{d:()=>l})},13075:(y,c,A)=>{"use strict";function l(y,c,A,l){A&&Object.defineProperty(y,c,{enumerable:A.enumerable,configurable:A.configurable,writable:A.writable,value:A.initializer?A.initializer.call(l):void 0})}A.d(c,{d:()=>l})},14473:(y,c,A)=>{"use strict";A.d(c,{e:()=>p,f:()=>o,g:()=>W,h:()=>N,i:()=>h,k:()=>w,m:()=>I,n:()=>q});var l=A(12529);class w{constructor(){this._easingMode=w.EASINGMODE_EASEIN}setEasingMode(y){const c=Math.min(Math.max(y,0),2);this._easingMode=c}getEasingMode(){return this._easingMode}easeInCore(y){throw new Error("You must implement this method")}ease(y){switch(this._easingMode){case w.EASINGMODE_EASEIN:return this.easeInCore(y);case w.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-y)}return y>=.5?.5*(1-this.easeInCore(2*(1-y)))+.5:.5*this.easeInCore(2*y)}}w.EASINGMODE_EASEIN=0,w.EASINGMODE_EASEOUT=1,w.EASINGMODE_EASEINOUT=2;class N extends w{easeInCore(y){return y=Math.max(0,Math.min(1,y)),1-Math.sqrt(1-y*y)}}class p extends w{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=y}easeInCore(y){const c=Math.max(0,this.amplitude);return Math.pow(y,3)-y*c*Math.sin(3.141592653589793*y)}}class W extends w{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=y,this.bounciness=c}easeInCore(y){const c=Math.max(0,this.bounces);let A=this.bounciness;A<=1&&(A=1.001);const l=Math.pow(A,c),w=1-A,N=(1-l)/w+.5*l,p=y*N,W=Math.log(-p*(1-A)+1)/Math.log(A),h=Math.floor(W),I=h+1,q=(1-Math.pow(A,h))/(w*N),o=.5*(q+(1-Math.pow(A,I))/(w*N)),O=y-o,L=o-q;return-Math.pow(1/A,c-h)/(L*L)*(O-L)*(O+L)}}class h extends w{easeInCore(y){return y*y*y}}class I extends w{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=y,this.springiness=c}easeInCore(y){let c;const A=Math.max(0,this.oscillations),l=Math.max(0,this.springiness);return c=0==l?y:(Math.exp(l*y)-1)/(Math.exp(l)-1),c*Math.sin((6.283185307179586*A+1.5707963267948966)*y)}}class q extends w{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=y}easeInCore(y){return this.exponent<=0?y:(Math.exp(this.exponent*y)-1)/(Math.exp(this.exponent)-1)}}class o extends w{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=y,this.y1=c,this.x2=A,this.y2=l}easeInCore(y){return l.d.Interpolate(y,this.x1,this.y1,this.x2,this.y2)}}},13917:(y,c,A)=>{"use strict";A.d(c,{d:()=>p});var l=A(12325),w=A(12337),N=A(12743);class p extends N.b{get _matrix(){return this._compose(),this.vO}set _matrix(y){(y.updateFlag!==this.vO.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.vO.p(y),this._markAsDirtyAndDecompose())}constructor(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(y,c.mc(),!1),this.name=y,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=c,this.vO=(null===w||void 0===w?void 0:w.clone())??l.Matrix.Identity(),this._restMatrix=N??this.vO.clone(),this._bindMatrix=p??this.vO.clone(),this._index=W,this._absoluteMatrix=new l.Matrix,this._absoluteBindMatrix=new l.Matrix,this._absoluteInverseBindMatrix=new l.Matrix,this._finalMatrix=new l.Matrix,c.bones.push(this),this.setParent(A,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(y){this.setParent(y)}setParent(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==y){if(this.parent){const y=this.parent.children.indexOf(this);-1!==y&&this.parent.children.splice(y,1)}this._parentNode=y,this.parent&&this.parent.children.push(this),c&&this._updateAbsoluteBindMatrices(),this.Bq()}}getLocalMatrix(){return this._compose(),this.vO}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(y){this._restMatrix.p(y)}setRestPose(y){this.setRestMatrix(y)}getBindPose(){return this.getBindMatrix()}setBindMatrix(y){this.Qc(y)}setBindPose(y){this.setBindMatrix(y)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const y=l.TmpVectors.gc[0],c=l.TmpVectors.Quaternion[0],A=l.TmpVectors.gc[1];this.getRestMatrix().decompose(y,c,A),this._linkedTransformNode.position.p(A),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??l.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.p(c),this._linkedTransformNode.bc.p(y)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(y){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=y,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.hh}set position(y){this._decompose(),this.hh.p(y),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(y){this.setRotation(y)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(y){this.setRotationQuaternion(y)}get bc(){return this.getScale()}set bc(y){this.setScale(y)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=l.gc.Zero(),this._localRotation=l.Quaternion.Zero(),this.hh=l.gc.Zero()),this.vO.decompose(this._localScaling,this._localRotation,this.hh))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,l.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.hh,this.vO)):this._needToCompose=!1)}Qc(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(y),c&&this._updateAbsoluteBindMatrices(),A?this._matrix=y:this.Bq()}_updateAbsoluteBindMatrices(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(y||(y=this._bindMatrix),this.parent?y.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(y),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),c)for(let A=0;A<this.children.length;A++)this.children[A]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Bq(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Bq(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Bq(),this._needToDecompose=!0}_updatePosition(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=this.getLocalMatrix();if(0==c)w?(N.addAtIndex(12,y.x),N.addAtIndex(13,y.y),N.addAtIndex(14,y.z)):N.setTranslationFromFloats(y.x,y.y,y.z);else{let c=null;A&&(c=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const W=p._TmpMats[0],h=p._TmpVecs[0];this.parent?A&&c?(W.p(this.parent.getAbsoluteMatrix()),W.multiplyToRef(c,W)):W.p(this.parent.getAbsoluteMatrix()):l.Matrix.IdentityToRef(W),w&&W.setTranslationFromFloats(0,0,0),W.invert(),l.gc.TransformCoordinatesToRef(y,W,h),w?(N.addAtIndex(12,h.x),N.addAtIndex(13,h.y),N.addAtIndex(14,h.z)):N.setTranslationFromFloats(h.x,h.y,h.z)}this._markAsDirtyAndDecompose()}translate(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this._updatePosition(y,c,A,!0)}setPosition(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this._updatePosition(y,c,A,!1)}setAbsolutePosition(y,c){this.setPosition(y,1,c)}scale(y,c,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.getLocalMatrix(),W=p._TmpMats[0];l.Matrix.ScalingToRef(y,c,A,W),W.multiplyToRef(N,N),W.invert();for(const l of this.children){const w=l.getLocalMatrix();w.multiplyToRef(W,w),w.multiplyAtIndex(12,y),w.multiplyAtIndex(13,c),w.multiplyAtIndex(14,A),l._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),w)for(const l of this.children)l.scale(y,c,A,w)}setScale(y){this._decompose(),this._localScaling.p(y),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(y){this._decompose(),y.p(this._localScaling)}setYawPitchRoll(y,c,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4?arguments[4]:void 0;if(0===w){const W=p._TmpQuat;return l.Quaternion.RotationYawPitchRollToRef(y,c,A,W),void this.setRotationQuaternion(W,w,N)}const W=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(W,N))return;const h=p._TmpMats[1];l.Matrix.RotationYawPitchRollToRef(y,c,A,h),W.multiplyToRef(h,h),this._rotateWithMatrix(h,w,N)}rotate(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3?arguments[3]:void 0;const N=p._TmpMats[0];N.setTranslationFromFloats(0,0,0),l.Matrix.RotationAxisToRef(y,c,N),this._rotateWithMatrix(N,A,w)}setAxisAngle(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3?arguments[3]:void 0;if(0===A){const N=p._TmpQuat;return l.Quaternion.RotationAxisToRef(y,c,N),void this.setRotationQuaternion(N,A,w)}const N=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,w))return;const W=p._TmpMats[1];l.Matrix.RotationAxisToRef(y,c,W),N.multiplyToRef(W,W),this._rotateWithMatrix(W,A,w)}setRotation(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(y.y,y.x,y.z,c,A)}setRotationQuaternion(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;if(0===c)return this._decompose(),this._localRotation.p(y),void this._markAsDirtyAndCompose();const w=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,A))return;const N=p._TmpMats[1];l.Matrix.FromQuaternionToRef(y,N),w.multiplyToRef(N,N),this._rotateWithMatrix(N,c,A)}setRotationMatrix(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;if(0===c){const w=p._TmpQuat;return l.Quaternion.FromRotationMatrixToRef(y,w),void this.setRotationQuaternion(w,c,A)}const w=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,A))return;const N=p._TmpMats[1];N.p(y),w.multiplyToRef(y,N),this._rotateWithMatrix(N,c,A)}_rotateWithMatrix(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;const l=this.getLocalMatrix(),w=l.m[12],N=l.m[13],W=l.m[14],h=this.getParent(),I=p._TmpMats[3],q=p._TmpMats[4];h&&1==c?(A?(I.p(A.getWorldMatrix()),h.getAbsoluteMatrix().multiplyToRef(I,I)):I.p(h.getAbsoluteMatrix()),q.p(I),q.invert(),l.multiplyToRef(I,l),l.multiplyToRef(y,l),l.multiplyToRef(q,l)):1==c&&A?(I.p(A.getWorldMatrix()),q.p(I),q.invert(),l.multiplyToRef(I,l),l.multiplyToRef(y,l),l.multiplyToRef(q,l)):l.multiplyToRef(y,l),l.setTranslationFromFloats(w,N,W),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(y,c){const A=p._TmpMats[2];return y.p(this.getAbsoluteMatrix()),c?(y.multiplyToRef(c.getWorldMatrix(),y),l.Matrix.ScalingToRef(c.bc.x,c.bc.y,c.bc.z,A)):l.Matrix.IdentityToRef(A),y.invert(),!isNaN(y.m[0])&&(A.multiplyAtIndex(0,this._scalingDeterminant),y.multiplyToRef(A,y),!0)}Dc(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=l.gc.Zero();return this.getPositionToRef(y,c,A),A}getPositionToRef(){let y=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const y=this.getLocalMatrix();c.x=y.m[12],c.y=y.m[13],c.z=y.m[14]}else{let A=null;y&&(A=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let l=p._TmpMats[0];y&&A?(l.p(this.getAbsoluteMatrix()),l.multiplyToRef(A,l)):l=this.getAbsoluteMatrix(),c.x=l.m[12],c.y=l.m[13],c.z=l.m[14]}}getAbsolutePosition(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=l.gc.Zero();return this.getPositionToRef(1,y,c),c}getAbsolutePositionToRef(y,c){this.getPositionToRef(1,y,c)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.vO.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.vO);const y=this._skeleton.getPoseMatrix();y&&this._absoluteMatrix.multiplyToRef(y,this._absoluteMatrix)}const y=this.children,c=y.length;for(let A=0;A<c;A++)y[A].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Zh(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=l.gc.Zero();return this.getDirectionToRef(y,c,A),A}getDirectionToRef(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,w=null;c&&(w=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=p._TmpMats[0];N.p(this.getAbsoluteMatrix()),c&&w&&N.multiplyToRef(w,N),l.gc.TransformNormalToRef(y,N,A),A.normalize()}getRotation(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=l.gc.Zero();return this.getRotationToRef(y,c,A),A}getRotationToRef(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;const l=p._TmpQuat;this.getRotationQuaternionToRef(y,c,l),l.toEulerAnglesToRef(A)}getRotationQuaternion(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=l.Quaternion.Identity();return this.getRotationQuaternionToRef(y,c,A),A}getRotationQuaternionToRef(){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),c.p(this._localRotation);else{const A=p._TmpMats[0],l=this.getAbsoluteMatrix();y?l.multiplyToRef(y.getWorldMatrix(),A):A.p(l),A.multiplyAtIndex(0,this._scalingDeterminant),A.multiplyAtIndex(1,this._scalingDeterminant),A.multiplyAtIndex(2,this._scalingDeterminant),A.decompose(void 0,c,void 0)}}getRotationMatrix(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0;const A=l.Matrix.Identity();return this.getRotationMatrixToRef(y,c,A),A}getRotationMatrixToRef(){let y=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(c);else{const A=p._TmpMats[0],l=this.getAbsoluteMatrix();y?l.multiplyToRef(y.getWorldMatrix(),A):A.p(l),A.multiplyAtIndex(0,this._scalingDeterminant),A.multiplyAtIndex(1,this._scalingDeterminant),A.multiplyAtIndex(2,this._scalingDeterminant),A.getRotationMatrixToRef(c)}}getAbsolutePositionFromLocal(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=l.gc.Zero();return this.getAbsolutePositionFromLocalToRef(y,c,A),A}getAbsolutePositionFromLocalToRef(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,w=null;c&&(w=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=p._TmpMats[0];N.p(this.getAbsoluteMatrix()),c&&w&&N.multiplyToRef(w,N),l.gc.TransformCoordinatesToRef(y,N,A)}getLocalPositionFromAbsolute(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=l.gc.Zero();return this.getLocalPositionFromAbsoluteToRef(y,c,A),A}getLocalPositionFromAbsoluteToRef(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,w=null;c&&(w=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=p._TmpMats[0];N.p(this.getAbsoluteMatrix()),c&&w&&N.multiplyToRef(w,N),N.invert(),l.gc.TransformCoordinatesToRef(y,N,A)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const y=this._skeleton.bones.indexOf(this);if(-1!==y&&this._skeleton.bones.splice(y,1),this._parentNode&&this._parentNode.children){const y=this._parentNode.children,c=y.indexOf(this);-1!==c&&y.splice(c,1)}super.dispose()}}p._TmpVecs=(0,w.d)(2,l.gc.Zero),p._TmpQuat=l.Quaternion.Identity(),p._TmpMats=(0,w.d)(5,l.Matrix.Identity)},14470:(y,c,A)=>{"use strict";A.d(c,{d:()=>G});var l=A(12307),w=A(12310),N=A(12153),p=A(12325),W=A(12340),h=A(12743),I=A(12773),q=A(12592),o=A(12171),O=A(12330);class L{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(y){this._zoomStopsAnimation=y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(y){this._idleRotationSpeed=y}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(y){this._idleRotationWaitTime=y}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(y){this._idleRotationSpinupTime=y}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(y){this._attachedCamera=y;const c=this._attachedCamera.mc();this._onPrePointerObservableObserver=c.onPrePointerObservable.add((y=>{y.type!==q.c.POINTERDOWN?y.type===q.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=y.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const y=o.d.Now;let c=0;null!=this._lastFrameTime&&(c=y-this._lastFrameTime),this._lastFrameTime=y,this._applyUserInteraction();const A=y-this._lastInteractionTime-this._idleRotationWaitTime,l=Math.max(Math.min(A/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*l,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(c/1e3))}))}detach(){if(!this._attachedCamera)return;const y=this._attachedCamera.mc();this._onPrePointerObservableObserver&&y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(y){this._lastInteractionTime=y??o.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<O.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let y=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(y=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?y:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=o.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var i=A(14473),H=A(12845);class P{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(y){if(this._autoTransitionRange===y)return;this._autoTransitionRange=y;const c=this._attachedCamera;c&&(y?this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add((y=>{if(y&&(y.Yc(!0),y.getBoundingInfo)){const c=y.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*c,this.upperRadiusTransitionRange=.05*c}})):this._onMeshTargetChangedObserver&&c.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(y){this._attachedCamera=y,this._onAfterCheckInputsObserver=y.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(y){return!!this._attachedCamera&&(this._attachedCamera.radius===y&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(y){if(!this._attachedCamera)return;this._radiusBounceTransition||(P.EasingFunction.setEasingMode(P.EasingMode),this._radiusBounceTransition=H.b.CreateAnimation("radius",H.b.ANIMATIONTYPE_FLOAT,60,P.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const c=H.b.TransitionTo("radius",this._attachedCamera.radius+y,this._attachedCamera,this._attachedCamera.mc(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));c&&this._animatables.push(c)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}P.EasingFunction=new i.e(.3),P.EasingMode=i.k.EASINGMODE_EASEOUT;class D{constructor(){this.onTargetFramingAnimationEndObservable=new N.d,this._mode=D.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(y){this._mode=y}get mode(){return this._mode}set radiusScale(y){this._radiusScale=y}get radiusScale(){return this._radiusScale}set positionScale(y){this._positionScale=y}get positionScale(){return this._positionScale}set defaultElevation(y){this._defaultElevation=y}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(y){this._elevationReturnTime=y}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(y){this._elevationReturnWaitTime=y}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(y){this._zoomStopsAnimation=y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(y){this._framingTime=y}get framingTime(){return this._framingTime}init(){}attach(y){this._attachedCamera=y;const c=this._attachedCamera.mc();D.EasingFunction.setEasingMode(D.EasingMode),this._onPrePointerObservableObserver=c.onPrePointerObservable.add((y=>{y.type!==q.c.POINTERDOWN?y.type===q.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=y.onMeshTargetChangedObservable.add((y=>{y&&y.getBoundingInfo&&this.zoomOnMesh(y,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=y.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const y=this._attachedCamera.mc();this._onPrePointerObservableObserver&&y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y.Yc(!0);const l=y.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(l.minimumWorld,l.maximumWorld,c,A)}zoomOnMeshHierarchy(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y.Yc(!0);const l=y.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(l.min,l.max,c,A)}zoomOnMeshesHierarchy(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new p.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),w=new p.gc(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let N=0;N<y.length;N++){const c=y[N].getHierarchyBoundingVectors(!0);p.gc.CheckExtends(c.min,l,w),p.gc.CheckExtends(c.max,l,w)}this.zoomOnBoundingInfo(l,w,c,A)}zoomOnBoundingInfo(y,c){let A,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const N=y.y,W=N+(c.y-N)*this._positionScale,h=c.xc(y).scale(.5);if(!isFinite(W))return!1;if(l)A=new p.gc(0,W,0);else{const c=y.add(h);A=new p.gc(c.x,W,c.z)}this._vectorTransition||(this._vectorTransition=H.b.CreateAnimation("target",H.b.ANIMATIONTYPE_VECTOR3,60,D.EasingFunction)),this._betaIsAnimating=!0;let I=H.b.TransitionTo("target",A,this._attachedCamera,this._attachedCamera.mc(),60,this._vectorTransition,this._framingTime);I&&this._animatables.push(I);let q=0;if(this._mode===D.FitFrustumSidesMode){const A=this._calculateLowerRadiusFromModelBoundingSphere(y,c);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=h.length()+this._attachedCamera.ec),q=A}else this._mode===D.IgnoreBoundsSizeMode&&(q=this._calculateLowerRadiusFromModelBoundingSphere(y,c),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ec));if(this.autoCorrectCameraLimitsAndSensibility){const A=c.xc(y).length();this._attachedCamera.panningSensibility=5e3/A,this._attachedCamera.wheelPrecision=100/q}return this._radiusTransition||(this._radiusTransition=H.b.CreateAnimation("radius",H.b.ANIMATIONTYPE_FLOAT,60,D.EasingFunction)),I=H.b.TransitionTo("radius",q,this._attachedCamera,this._attachedCamera.mc(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),w&&w(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),I&&this._animatables.push(I),!0}_calculateLowerRadiusFromModelBoundingSphere(y,c){const A=this._attachedCamera;if(!A)return 0;let l=A._calculateLowerRadiusFromModelBoundingSphere(y,c,this._radiusScale);return A.lowerRadiusLimit&&this._mode===D.IgnoreBoundsSizeMode&&(l=l<A.lowerRadiusLimit?A.lowerRadiusLimit:l),A.upperRadiusLimit&&(l=l>A.upperRadiusLimit?A.upperRadiusLimit:l),l}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const y=o.d.Now-this._lastInteractionTime,c=.5*Math.PI-this._defaultElevation,A=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>A&&y>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=H.b.CreateAnimation("beta",H.b.ANIMATIONTYPE_FLOAT,60,D.EasingFunction));const y=H.b.TransitionTo("beta",c,this._attachedCamera,this._attachedCamera.mc(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));y&&this._animatables.push(y)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=o.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}D.EasingFunction=new i.n,D.EasingMode=i.k.EASINGMODE_EASEINOUT,D.IgnoreBoundsSizeMode=0,D.FitFrustumSidesMode=1;var t=A(12775),s=A(12805),B=A(13908),X=A(12144);class C{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(y){y=X.Tools.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),A=c.getInputElement();let l=0,w=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=N=>{var p,W;const h=N.event,I="touch"===h.pointerType;if(N.type!==q.c.POINTERMOVE&&-1===this.buttons.indexOf(h.button))return;const o=h.target;if(this._altKey=h.altKey,this._ctrlKey=h.ctrlKey,this._metaKey=h.metaKey,this._shiftKey=h.shiftKey,this._buttonsPressed=h.buttons,c.isPointerLock){const y=h.movementX,c=h.movementY;this.onTouch(null,y,c),this._pointA=null,this._pointB=null}else{if(N.type!==q.c.POINTERDOWN&&N.type!==q.c.POINTERDOUBLETAP&&I&&(null===(p=this._pointA)||void 0===p?void 0:p.pointerId)!==h.pointerId&&(null===(W=this._pointB)||void 0===W?void 0:W.pointerId)!==h.pointerId)return;if(N.type!==q.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!I)if(N.type===q.c.POINTERDOUBLETAP)this.onDoubleTap(h.pointerType);else if(N.type!==q.c.POINTERUP||this._currentMousePointerIdDown!==h.pointerId&&!I){if(N.type===q.c.POINTERMOVE)if(y||h.preventDefault(),this._pointA&&null===this._pointB){const y=h.clientX-this._pointA.x,c=h.clientY-this._pointA.y;this._pointA.x=h.clientX,this._pointA.y=h.clientY,this.onTouch(this._pointA,y,c)}else if(this._pointA&&this._pointB){const y=this._pointA.pointerId===h.pointerId?this._pointA:this._pointB;y.x=h.clientX,y.y=h.clientY;const c=this._pointA.x-this._pointB.x,A=this._pointA.y-this._pointB.y,p=c*c+A*A,W={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:h.pointerId,type:N.type};this.onMultiTouch(this._pointA,this._pointB,l,p,w,W),w=W,l=p}}else{try{null===o||void 0===o||o.releasePointerCapture(h.pointerId)}catch(O){}I||(this._pointB=null),c._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==h.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==h.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==l||w)&&(this.onMultiTouch(this._pointA,this._pointB,l,0,w,null),l=0,w=null),this._currentMousePointerIdDown=-1,this.onButtonUp(h),y||h.preventDefault()}else{try{null===o||void 0===o||o.setPointerCapture(h.pointerId)}catch(O){}if(null===this._pointA)this._pointA={x:h.clientX,y:h.clientY,pointerId:h.pointerId,type:h.pointerType};else{if(null!==this._pointB)return;this._pointB={x:h.clientX,y:h.clientY,pointerId:h.pointerId,type:h.pointerType}}-1!==this._currentMousePointerIdDown||I||(this._currentMousePointerIdDown=h.pointerId),this.onButtonDown(h),y||(h.preventDefault(),A&&A.focus())}}},this._observer=this.camera.mc()._inputManager._addCameraPointerObserver(this._pointerInput,q.c.POINTERDOWN|q.c.POINTERUP|q.c.POINTERMOVE|q.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,l=0,w=null,this.onLostFocus()},this._contextMenuBind=y=>this.onContextMenu(y),A&&A.addEventListener("contextmenu",this._contextMenuBind,!1);const N=this.camera.mc().getEngine().getHostWindow();N&&X.Tools.RegisterTopRootEvents(N,[{name:"blur",handler:this._onLostFocus}])}IO(){if(this._onLostFocus){const y=this.camera.mc().getEngine().getHostWindow();y&&X.Tools.UnregisterTopRootEvents(y,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.mc()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const y=this.camera.mc().getEngine().getInputElement();y&&y.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(y){}onTouch(y,c,A){}onMultiTouch(y,c,A,l,w,N){}onContextMenu(y){y.preventDefault()}onButtonDown(y){}onButtonUp(y){}onLostFocus(){}}(0,l.b)([(0,w.P)()],C.prototype,"buttons",void 0);class K extends C{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(y,c){if(0!==this.panningSensibility&&y&&c){const A=c.x-y.x,l=c.y-y.y;this.camera.inertialPanningX+=-A/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility}}_computePinchZoom(y,c){const A=this.camera.radius||K.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=A*Math.sqrt(y)/Math.sqrt(c):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(c-y)*A*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(c-y)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(y,c,A){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility):(this.camera.inertialAlphaOffset-=c/this.angularSensibilityX,this.camera.inertialBetaOffset-=A/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(y,c,A,l,w,N){0===A&&null===w||0===l&&null===N||(this.multiTouchPanAndZoom?(this._computePinchZoom(A,l),this._computeMultiTouchPanning(w,N)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(l)-Math.sqrt(A))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(A,l),this._isPinching=!0):this._computeMultiTouchPanning(w,N)):this.multiTouchPanning?this._computeMultiTouchPanning(w,N):this.pinchZoom&&this._computePinchZoom(A,l))}onButtonDown(y){this._isPanClick=y.button===this.camera._panningMouseButton}onButtonUp(y){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}K.MinimumRadiusForPinch=.001,(0,l.b)([(0,w.P)()],K.prototype,"buttons",void 0),(0,l.b)([(0,w.P)()],K.prototype,"angularSensibilityX",void 0),(0,l.b)([(0,w.P)()],K.prototype,"angularSensibilityY",void 0),(0,l.b)([(0,w.P)()],K.prototype,"pinchPrecision",void 0),(0,l.b)([(0,w.P)()],K.prototype,"pinchDeltaPercentage",void 0),(0,l.b)([(0,w.P)()],K.prototype,"useNaturalPinchZoom",void 0),(0,l.b)([(0,w.P)()],K.prototype,"pinchZoom",void 0),(0,l.b)([(0,w.P)()],K.prototype,"panningSensibility",void 0),(0,l.b)([(0,w.P)()],K.prototype,"multiTouchPanning",void 0),(0,l.b)([(0,w.P)()],K.prototype,"multiTouchPanAndZoom",void 0),B.d.ArcRotateCameraPointersInput=K;var my=A(12601);class T{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(y){y=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.mc(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const A=c.event;if(!A.metaKey)if(c.type===my.b.KEYDOWN){if(this._ctrlPressed=A.ctrlKey,this._altPressed=A.altKey,-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysReset.indexOf(A.keyCode)){-1===this._keys.indexOf(A.keyCode)&&this._keys.push(A.keyCode),A.preventDefault&&(y||A.preventDefault())}}else if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysReset.indexOf(A.keyCode)){const c=this._keys.indexOf(A.keyCode);c>=0&&this._keys.splice(c,1),A.preventDefault&&(y||A.preventDefault())}})))}IO(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const y=this.camera;for(let c=0;c<this._keys.length;c++){const A=this._keys[c];-1!==this.keysLeft.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningX-=1/this.panningSensibility:y.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?y.inertialRadiusOffset+=1/this.zoomingSensibility:y.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningX+=1/this.panningSensibility:y.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?y.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?y.inertialRadiusOffset-=1/this.zoomingSensibility:y.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(A)&&y.useInputToRestoreState&&y.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,l.b)([(0,w.P)()],T.prototype,"keysUp",void 0),(0,l.b)([(0,w.P)()],T.prototype,"keysDown",void 0),(0,l.b)([(0,w.P)()],T.prototype,"keysLeft",void 0),(0,l.b)([(0,w.P)()],T.prototype,"keysRight",void 0),(0,l.b)([(0,w.P)()],T.prototype,"keysReset",void 0),(0,l.b)([(0,w.P)()],T.prototype,"panningSensibility",void 0),(0,l.b)([(0,w.P)()],T.prototype,"zoomingSensibility",void 0),(0,l.b)([(0,w.P)()],T.prototype,"useAltToZoom",void 0),(0,l.b)([(0,w.P)()],T.prototype,"angularSpeed",void 0),B.d.ArcRotateCameraKeyboardMoveInput=T;var z=A(12384),S=A(12604);class M{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new p.gc(0,0,0),this._globalOffset=new p.gc(0,0,0),this._inertialPanning=p.gc.Zero()}_computeDeltaFromMouseWheelLegacyEvent(y,c){let A=0;const l=.01*y*this.wheelDeltaPercentage*c;return A=y>0?l/(1+this.wheelDeltaPercentage):l*(1+this.wheelDeltaPercentage),A}attachControl(y){y=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==q.c.POINTERWHEEL)return;const A=c.event;let l=0;const w=A.deltaMode===S.b.DOM_DELTA_LINE?40:1,N=-A.deltaY*w;if(this.customComputeDeltaFromMouseWheel)l=this.customComputeDeltaFromMouseWheel(N,this,A);else if(this.wheelDeltaPercentage){if(l=this._computeDeltaFromMouseWheelLegacyEvent(N,this.camera.radius),l>0){let y=this.camera.radius,c=this.camera.inertialRadiusOffset+l;for(let A=0;A<20&&!(y<=c)&&!(Math.abs(c*this.camera.inertia)<.001);A++)y-=c,c*=this.camera.inertia;y=(0,W.Clamp)(y,0,Number.MAX_VALUE),l=this._computeDeltaFromMouseWheelLegacyEvent(N,y)}}else l=N/(40*this.wheelPrecision);l&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(l)):this.camera.inertialRadiusOffset+=l),A.preventDefault&&(y||A.preventDefault())},this._observer=this.camera.mc()._inputManager._addCameraPointerObserver(this._wheel,q.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.vc(0)}IO(){this._observer&&(this.camera.mc()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const y=this.camera;0+y.inertialAlphaOffset+y.inertialBetaOffset+y.inertialRadiusOffset&&(this._updateHitPlane(),y.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(y.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const y=this.camera,c=y.target.xc(y.position);this._hitPlane=z.c.FromPositionAndNormal(y.target,c)}_getPosition(){const y=this.camera,c=y.mc(),A=c.createPickingRay(c.pointerX,c.pointerY,p.Matrix.Identity(),y,!1);0===y.targetScreenOffset.x&&0===y.targetScreenOffset.y||(this._viewOffset.set(y.targetScreenOffset.x,y.targetScreenOffset.y,0),y.getViewMatrix().invertToRef(y._cameraTransformMatrix),this._globalOffset=p.gc.TransformNormal(this._viewOffset,y._cameraTransformMatrix),A.origin.addInPlace(this._globalOffset));let l=0;return this._hitPlane&&(l=A.intersectsPlane(this._hitPlane)??0),A.origin.addInPlace(A.direction.scaleInPlace(l))}_zoomToMouse(y){const c=this.camera,A=1-c.inertia;if(c.lowerRadiusLimit){const l=c.lowerRadiusLimit??0;c.radius-(c.inertialRadiusOffset+y)/A<l&&(y=(c.radius-l)*A-c.inertialRadiusOffset)}if(c.upperRadiusLimit){const l=c.upperRadiusLimit??0;c.radius-(c.inertialRadiusOffset+y)/A>l&&(y=(c.radius-l)*A-c.inertialRadiusOffset)}const l=y/A/c.radius,w=this._getPosition(),N=p.TmpVectors.gc[6];w.subtractToRef(c.target,N),N.scaleInPlace(l),N.scaleInPlace(A),this._inertialPanning.addInPlace(N),c.inertialRadiusOffset+=y}_zeroIfClose(y){Math.abs(y.x)<O.b&&(y.x=0),Math.abs(y.y)<O.b&&(y.y=0),Math.abs(y.z)<O.b&&(y.z=0)}}(0,l.b)([(0,w.P)()],M.prototype,"wheelPrecision",void 0),(0,l.b)([(0,w.P)()],M.prototype,"zoomToMouseLocation",void 0),(0,l.b)([(0,w.P)()],M.prototype,"wheelDeltaPercentage",void 0),B.d.ArcRotateCameraMouseWheelInput=M;class k extends B.g{constructor(y){super(y)}addMouseWheel(){return this.add(new M),this}addPointers(){return this.add(new K),this}addKeyboard(){return this.add(new T),this}}var a=A(12283);function u(y,c){return isNaN(y)?c:y}h.b.AddNodeConstructor("ArcRotateCamera",((y,c)=>()=>new G(y,0,0,1,p.gc.Zero(),c)));class G extends s.b{get target(){return this._target}set target(y){this.setTarget(y)}get targetHost(){return this._targetHost}set targetHost(y){y&&this.setTarget(y)}getTarget(){return this.target}get position(){return this._position}set position(y){this.setPosition(y)}set upVector(y){this._upToYMatrix||(this._yToUpMatrix=new p.Matrix,this._upToYMatrix=new p.Matrix,this._upVector=p.gc.Zero()),y.normalize(),this._upVector.p(y),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){p.Matrix.RotationAlignToRef(p.gc.UpReadOnly,this._upVector,this._yToUpMatrix),p.Matrix.RotationAlignToRef(this._upVector,p.gc.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const y=this.inputs.attached.pointers;return y?y.angularSensibilityX:0}set angularSensibilityX(y){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=y)}get angularSensibilityY(){const y=this.inputs.attached.pointers;return y?y.angularSensibilityY:0}set angularSensibilityY(y){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=y)}get pinchPrecision(){const y=this.inputs.attached.pointers;return y?y.pinchPrecision:0}set pinchPrecision(y){const c=this.inputs.attached.pointers;c&&(c.pinchPrecision=y)}get pinchDeltaPercentage(){const y=this.inputs.attached.pointers;return y?y.pinchDeltaPercentage:0}set pinchDeltaPercentage(y){const c=this.inputs.attached.pointers;c&&(c.pinchDeltaPercentage=y)}get useNaturalPinchZoom(){const y=this.inputs.attached.pointers;return!!y&&y.useNaturalPinchZoom}set useNaturalPinchZoom(y){const c=this.inputs.attached.pointers;c&&(c.useNaturalPinchZoom=y)}get panningSensibility(){const y=this.inputs.attached.pointers;return y?y.panningSensibility:0}set panningSensibility(y){const c=this.inputs.attached.pointers;c&&(c.panningSensibility=y)}get keysUp(){const y=this.inputs.attached.keyboard;return y?y.keysUp:[]}set keysUp(y){const c=this.inputs.attached.keyboard;c&&(c.keysUp=y)}get keysDown(){const y=this.inputs.attached.keyboard;return y?y.keysDown:[]}set keysDown(y){const c=this.inputs.attached.keyboard;c&&(c.keysDown=y)}get keysLeft(){const y=this.inputs.attached.keyboard;return y?y.keysLeft:[]}set keysLeft(y){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=y)}get keysRight(){const y=this.inputs.attached.keyboard;return y?y.keysRight:[]}set keysRight(y){const c=this.inputs.attached.keyboard;c&&(c.keysRight=y)}get wheelPrecision(){const y=this.inputs.attached.mousewheel;return y?y.wheelPrecision:0}set wheelPrecision(y){const c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=y)}get zoomToMouseLocation(){const y=this.inputs.attached.mousewheel;return!!y&&y.zoomToMouseLocation}set zoomToMouseLocation(y){const c=this.inputs.attached.mousewheel;c&&(c.zoomToMouseLocation=y)}get wheelDeltaPercentage(){const y=this.inputs.attached.mousewheel;return y?y.wheelDeltaPercentage:0}set wheelDeltaPercentage(y){const c=this.inputs.attached.mousewheel;c&&(c.wheelDeltaPercentage=y)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(y){y!==this.useBouncingBehavior&&(y?(this._bouncingBehavior=new P,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(y){y!==this.useFramingBehavior&&(y?(this._framingBehavior=new D,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(y){y!==this.useAutoRotationBehavior&&(y?(this._autoRotationBehavior=new L,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(y,c,A,l,w,W){var h;let I=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(y,p.gc.Zero(),W,I),h=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=p.gc.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=p.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new p.Matrix,this.panningAxis=new p.gc(1,1,0),this._transformedDirection=new p.gc,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new N.d,this.checkCollisions=!1,this.collisionRadius=new p.gc(.5,.5,.5),this._previousPosition=p.gc.Zero(),this._collisionVelocity=p.gc.Zero(),this._newPosition=p.gc.Zero(),this._computationVector=p.gc.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new p.gc(NaN,NaN,NaN),this._goalTargetScreenOffset=new p.Vector2(NaN,NaN),this._onCollisionPositionChange=function(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A?(h.setPosition(c),h.FL&&h.FL(A)):h._previousPosition.p(h._position);const l=Math.cos(h.alpha),w=Math.sin(h.alpha),N=Math.cos(h.beta);let p=Math.sin(h.beta);0===p&&(p=1e-4);const W=h._getTargetPosition();h._computationVector.Ec(h.radius*l*p,h.radius*N,h.radius*w*p),W.addToRef(h._computationVector,h._newPosition),h._position.p(h._newPosition);let I=h.upVector;h.allowUpsideDown&&h.beta<0&&(I=I.clone(),I=I.negate()),h._computeViewMatrix(h._position,W,I),h._viewMatrix.addAtIndex(12,h.targetScreenOffset.x),h._viewMatrix.addAtIndex(13,h.targetScreenOffset.y),h._collisionTriggered=!1},this._target=p.gc.Zero(),w&&this.setTarget(w),this.alpha=c,this.beta=A,this.radius=l,this.getViewMatrix(),this.inputs=new k(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new p.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=p.Vector2.Zero()}_updateCache(y){y||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const y=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?y.addToRef(this._targetBoundingCenter,this._target):this._target.p(y)}const y=this._getLockedTargetPosition();return y||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>O.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,N=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=N?this._currentInterpolationFactor=N:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=u(y,this._goalAlpha),this._goalBeta=u(c,this._goalBeta),this._goalRadius=u(A,this._goalRadius),this._goalTarget.set(u(l.x,this._goalTarget.x),u(l.y,this._goalTarget.y),u(l.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(u(w.x,this._goalTargetScreenOffset.x),u(w.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,W.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,W.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,W.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,W.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const w=arguments;c=X.Tools.BackCompatCameraNoPreventDefault(w),this._useCtrlForPanning=A,this._panningMouseButton=l,"boolean"===typeof w[0]&&(w.length>1&&(this._useCtrlForPanning=w[1]),w.length>2&&(this._panningMouseButton=w[2])),this.inputs.attachElement(c),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}IO(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let y=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){y=!0;const c=this.invertRotation?-1:1,A=this._calculateHandednessMultiplier();let l=this.inertialAlphaOffset*A;this.beta<0&&(l*=-1),this.alpha+=l*c,this.beta+=this.inertialBetaOffset*c,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<O.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<O.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*O.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){y=!0;const c=new p.gc(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),c.multiplyInPlace(this.panningAxis),p.gc.TransformNormalToRef(c,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const y=this.upVector,c=p.gc.CrossToRef(this._transformedDirection,y,this._transformedDirection);p.gc.CrossToRef(y,c,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);p.gc.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const y=p.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(y),y.transposeToRef(y),p.gc.TransformCoordinatesToRef(this._transformedDirection,y,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*O.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*O.b&&(this.inertialPanningY=0)}if(y)this.stopInterpolation();else if(this._isInterpolating){let y=!1;const c=this._scene.getEngine().getDeltaTime()/1e3,A=1-Math.pow(2,-c/this._currentInterpolationFactor),l=u(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const c=p.TmpVectors.gc[0].set(u(this._goalTarget.x,this._target.x),u(this._goalTarget.y,this._target.y),u(this._goalTarget.z,this._target.z));p.gc.LerpToRef(this.target,c,A,this._target),10*p.gc.Distance(this.target,c)/l<O.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(c),this.setTarget(this.target,!1,!0,!0)):y=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const c=p.Quaternion.RotationAlphaBetaGammaToRef(u(this._goalAlpha,this.alpha),u(this._goalBeta,this.beta),0,p.TmpVectors.Quaternion[0]),l=p.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,p.TmpVectors.Quaternion[1]),w=p.Quaternion.SlerpToRef(l,c,A,p.TmpVectors.Quaternion[2]);w.normalize();const N=w.toAlphaBetaGammaToRef(p.TmpVectors.gc[0]);if(this.alpha=N.x,this.beta=N.y,w.isApprox(c,O.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const y=c.toAlphaBetaGammaToRef(p.TmpVectors.gc[0]);this.alpha=y.x,this.beta=y.y}else y=!0}if(isNaN(this._goalRadius)||(this.radius+=(l-this.radius)*A,Math.abs(l/this.radius-1)<O.b?(this._goalRadius=NaN,this.radius=l):y=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const c=p.TmpVectors.Vector2[0].set(u(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),u(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));p.Vector2.LerpToRef(this.targetScreenOffset,c,A,this.targetScreenOffset),p.Vector2.Distance(this.targetScreenOffset,c)<O.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(c)):y=!0}this._isInterpolating=y}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.gc.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const y=this.alpha;var c,A;this.alpha=function(y){let c=Math.PI/2;return 0===y.x&&0===y.z||(c=Math.acos(y.x/Math.sqrt(Math.pow(y.x,2)+Math.pow(y.z,2)))),y.z<0&&(c=2*Math.PI-c),c}(this._computationVector),this.beta=(c=this._computationVector.y,A=this.radius,Math.acos(c/A));const l=Math.round((y-this.alpha)/(2*Math.PI));this.alpha+=2*l*Math.PI,this._checkLimits()}setPosition(y){this._position.equals(y)||(this._position.p(y),this.rebuildAnglesAndRadius())}setTarget(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(l=this.overrideCloneAlphaBetaRadius??l,y.Yc)c&&y.getBoundingInfo?this._targetBoundingCenter=y.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,y.Yc(),this._targetHost=y,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const c=y,l=this._getTargetPosition();if(l&&!A&&l.equals(c))return;this._targetHost=null,this._target=c,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}l||this.rebuildAnglesAndRadius()}_getViewMatrix(){const y=Math.cos(this.alpha),c=Math.sin(this.alpha),A=Math.cos(this.beta);let l=Math.sin(this.beta);0===l&&(l=1e-4),0===this.radius&&(this.radius=1e-4);const w=this._getTargetPosition();if(this._computationVector.Ec(this.radius*y*l,this.radius*A,this.radius*c*l),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.gc.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),w.addToRef(this._computationVector,this._newPosition),this.mc().collisionsEnabled&&this.checkCollisions){const y=this.mc().collisionCoordinator;this._collider||(this._collider=y.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,y.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let y=this.upVector;this.allowUpsideDown&&l<0&&(y=y.negate()),this._computeViewMatrix(this._position,w,y),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(w),this._viewMatrix}zoomOn(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y=y||this.mc().meshes;const A=I.b.MinMax(y);let l=this._calculateLowerRadiusFromModelBoundingSphere(A.min,A.max);if(l=Math.max(Math.min(l,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=l*this.zoomOnFactor,this.mode===t.c.ORTHOGRAPHIC_CAMERA){const y=this.mc().getEngine().getAspectRatio(this),c=l*this.zoomOnFactor/2;this.orthoLeft=-c*y,this.orthoRight=c*y,this.orthoBottom=-c,this.orthoTop=c}this.focusOn({min:A.min,max:A.max,distance:l},c)}focusOn(y){let c,A,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===y.min){const l=y||this.mc().meshes;c=I.b.MinMax(l),A=p.gc.Distance(c.min,c.max)}else{c=y,A=y.distance}this._target=I.b.Center(c),l||(this.maxZ=2*A)}createRigCamera(y,c){let A=0;switch(this.cameraRigMode){case t.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case t.c.RIG_MODE_VR:A=this._cameraRigParams.stereoHalfAngle*(0===c?1:-1);break;case t.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:A=this._cameraRigParams.stereoHalfAngle*(0===c?-1:1)}const l=new G(y,this.alpha+A,this.beta,this.radius,this._target,this.mc());return l._cameraRigParams={},l.isRigCamera=!0,l.rigParent=this,l.upVector=this.upVector,l.mode=this.mode,l.orthoLeft=this.orthoLeft,l.orthoRight=this.orthoRight,l.orthoBottom=this.orthoBottom,l.orthoTop=this.orthoTop,l}_updateRigCameras(){const y=this._rigCameras[0],c=this._rigCameras[1];switch(y.beta=c.beta=this.beta,this.cameraRigMode){case t.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case t.c.RIG_MODE_VR:y.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case t.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:y.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const l=p.gc.Distance(y,c),w=this.mc().getEngine().getAspectRatio(this),N=Math.tan(this.fov/2),W=N*w,h=.5*l*A,I=h*Math.sqrt(1+1/(W*W)),q=h*Math.sqrt(1+1/(N*N));return Math.max(I,q)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,l.b)([(0,w.P)()],G.prototype,"alpha",void 0),(0,l.b)([(0,w.P)()],G.prototype,"beta",void 0),(0,l.b)([(0,w.P)()],G.prototype,"radius",void 0),(0,l.b)([(0,w.P)()],G.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,l.b)([(0,w.M)("target")],G.prototype,"_target",void 0),(0,l.b)([(0,w.y)("targetHost")],G.prototype,"_targetHost",void 0),(0,l.b)([(0,w.P)()],G.prototype,"inertialAlphaOffset",void 0),(0,l.b)([(0,w.P)()],G.prototype,"inertialBetaOffset",void 0),(0,l.b)([(0,w.P)()],G.prototype,"inertialRadiusOffset",void 0),(0,l.b)([(0,w.P)()],G.prototype,"lowerAlphaLimit",void 0),(0,l.b)([(0,w.P)()],G.prototype,"upperAlphaLimit",void 0),(0,l.b)([(0,w.P)()],G.prototype,"lowerBetaLimit",void 0),(0,l.b)([(0,w.P)()],G.prototype,"upperBetaLimit",void 0),(0,l.b)([(0,w.P)()],G.prototype,"lowerRadiusLimit",void 0),(0,l.b)([(0,w.P)()],G.prototype,"upperRadiusLimit",void 0),(0,l.b)([(0,w.P)()],G.prototype,"lowerTargetYLimit",void 0),(0,l.b)([(0,w.P)()],G.prototype,"inertialPanningX",void 0),(0,l.b)([(0,w.P)()],G.prototype,"inertialPanningY",void 0),(0,l.b)([(0,w.P)()],G.prototype,"pinchToPanMaxDistance",void 0),(0,l.b)([(0,w.P)()],G.prototype,"panningDistanceLimit",void 0),(0,l.b)([(0,w.M)()],G.prototype,"panningOriginTarget",void 0),(0,l.b)([(0,w.P)()],G.prototype,"panningInertia",void 0),(0,l.b)([(0,w.P)()],G.prototype,"zoomToMouseLocation",null),(0,l.b)([(0,w.P)()],G.prototype,"zoomOnFactor",void 0),(0,l.b)([(0,w.J)()],G.prototype,"targetScreenOffset",void 0),(0,l.b)([(0,w.P)()],G.prototype,"allowUpsideDown",void 0),(0,l.b)([(0,w.P)()],G.prototype,"useInputToRestoreState",void 0),(0,l.b)([(0,w.P)()],G.prototype,"restoreStateInterpolationFactor",void 0),(0,a.f)("BABYLON.ArcRotateCamera",G)},13908:(y,c,A)=>{"use strict";A.d(c,{d:()=>p,g:()=>W});var l=A(12161),w=A(12363),N=A(12775),p={};class W{constructor(y){this.attachedToElement=!1,this.attached={},this.camera=y,this.checkInputs=()=>{}}add(y){const c=y.getSimpleName();this.attached[c]?l.c.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=y,y.camera=this.camera,y.checkInputs&&(this.checkInputs=this._addCheckInputs(y.checkInputs.bind(y))),this.attachedToElement&&y.attachControl(this.noPreventDefault))}remove(y){for(const c in this.attached){const A=this.attached[c];if(A===y)return A.IO(),A.camera=null,delete this.attached[c],void this.rebuildInputCheck()}}removeByType(y){for(const c in this.attached){const A=this.attached[c];A.getClassName()===y&&(A.IO(),A.camera=null,delete this.attached[c],this.rebuildInputCheck())}}_addCheckInputs(y){const c=this.checkInputs;return()=>{c(),y()}}attachInput(y){this.attachedToElement&&y.attachControl(this.noPreventDefault)}attachElement(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){y=!N.c.ForceAttachControlToAlwaysPreventDefault&&y,this.attachedToElement=!0,this.noPreventDefault=y;for(const c in this.attached)this.attached[c].attachControl(y)}}detachElement(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const c in this.attached)this.attached[c].IO(),y&&(this.attached[c].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const y in this.attached){const c=this.attached[y];c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(y){const c={};for(const A in this.attached){const y=this.attached[A],l=w.d.Serialize(y);c[y.getClassName()]=l}y.inputsmgr=c}parse(y){const c=y.inputsmgr;if(c){this.clear();for(const y in c){const A=p[y];if(A){const l=c[y],N=w.d.Parse((()=>new A),l,null);this.add(N)}}}else for(const A in this.attached){const c=p[this.attached[A].getClassName()];if(c){const l=w.d.Parse((()=>new c),y,null);this.remove(this.attached[A]),this.add(l)}}}}},13902:(y,c,A)=>{"use strict";A.d(c,{b:()=>C});var l=A(12307),w=A(12310),N=A(12325),p=A(12805),W=A(13908),h=A(12601),I=A(12144);class q{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(y){y=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.mc(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const A=c.event;if(!A.metaKey)if(c.type===h.b.KEYDOWN){if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysUpward.indexOf(A.keyCode)||-1!==this.keysDownward.indexOf(A.keyCode)||-1!==this.keysRotateLeft.indexOf(A.keyCode)||-1!==this.keysRotateRight.indexOf(A.keyCode)||-1!==this.keysRotateUp.indexOf(A.keyCode)||-1!==this.keysRotateDown.indexOf(A.keyCode)){-1===this._keys.indexOf(A.keyCode)&&this._keys.push(A.keyCode),y||A.preventDefault()}}else if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysUpward.indexOf(A.keyCode)||-1!==this.keysDownward.indexOf(A.keyCode)||-1!==this.keysRotateLeft.indexOf(A.keyCode)||-1!==this.keysRotateRight.indexOf(A.keyCode)||-1!==this.keysRotateUp.indexOf(A.keyCode)||-1!==this.keysRotateDown.indexOf(A.keyCode)){const c=this._keys.indexOf(A.keyCode);c>=0&&this._keys.splice(c,1),y||A.preventDefault()}})))}IO(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const y=this.camera;for(let c=0;c<this._keys.length;c++){const A=this._keys[c],l=y._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(A)?y._localDirection.Ec(-l,0,0):-1!==this.keysUp.indexOf(A)?y._localDirection.Ec(0,0,l):-1!==this.keysRight.indexOf(A)?y._localDirection.Ec(l,0,0):-1!==this.keysDown.indexOf(A)?y._localDirection.Ec(0,0,-l):-1!==this.keysUpward.indexOf(A)?y._localDirection.Ec(0,l,0):-1!==this.keysDownward.indexOf(A)?y._localDirection.Ec(0,-l,0):-1!==this.keysRotateLeft.indexOf(A)?(y._localDirection.Ec(0,0,0),y.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(A)?(y._localDirection.Ec(0,0,0),y.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(A)?(y._localDirection.Ec(0,0,0),y.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(A)&&(y._localDirection.Ec(0,0,0),y.cameraRotation.x+=this._getLocalRotation()),y.mc().useRightHandedSystem&&(y._localDirection.z*=-1),y.getViewMatrix().invertToRef(y._cameraTransformMatrix),N.gc.TransformNormalToRef(y._localDirection,y._cameraTransformMatrix,y._transformedDirection),y.cameraDirection.addInPlace(y._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const y=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*y}}(0,l.b)([(0,w.P)()],q.prototype,"keysUp",void 0),(0,l.b)([(0,w.P)()],q.prototype,"keysUpward",void 0),(0,l.b)([(0,w.P)()],q.prototype,"keysDown",void 0),(0,l.b)([(0,w.P)()],q.prototype,"keysDownward",void 0),(0,l.b)([(0,w.P)()],q.prototype,"keysLeft",void 0),(0,l.b)([(0,w.P)()],q.prototype,"keysRight",void 0),(0,l.b)([(0,w.P)()],q.prototype,"rotationSpeed",void 0),(0,l.b)([(0,w.P)()],q.prototype,"keysRotateLeft",void 0),(0,l.b)([(0,w.P)()],q.prototype,"keysRotateRight",void 0),(0,l.b)([(0,w.P)()],q.prototype,"keysRotateUp",void 0),(0,l.b)([(0,w.P)()],q.prototype,"keysRotateDown",void 0),W.d.FreeCameraKeyboardMoveInput=q;var o=A(12153),O=A(12592);class L{constructor(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=y,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new o.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(y){y=I.Tools.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),A=c.getInputElement();this._pointerInput||(this._pointerInput=l=>{const w=l.event,N="touch"===w.pointerType;if(!this.touchEnabled&&N)return;if(l.type!==O.c.POINTERMOVE&&-1===this.buttons.indexOf(w.button))return;const p=w.target;if(l.type===O.c.POINTERDOWN){if(N&&-1!==this._activePointerId||!N&&-1!==this._currentActiveButton)return;this._activePointerId=w.pointerId;try{null===p||void 0===p||p.setPointerCapture(w.pointerId)}catch(W){}-1===this._currentActiveButton&&(this._currentActiveButton=w.button),this._previousPosition={x:w.clientX,y:w.clientY},y||(w.preventDefault(),A&&A.focus()),c.isPointerLock&&this._onMouseMove&&this._onMouseMove(l.event)}else if(l.type===O.c.POINTERUP){if(N&&this._activePointerId!==w.pointerId||!N&&this._currentActiveButton!==w.button)return;try{null===p||void 0===p||p.releasePointerCapture(w.pointerId)}catch(W){}this._currentActiveButton=-1,this._previousPosition=null,y||w.preventDefault(),this._activePointerId=-1}else if(l.type===O.c.POINTERMOVE&&(this._activePointerId===w.pointerId||!N))if(c.isPointerLock&&this._onMouseMove)this._onMouseMove(l.event);else if(this._previousPosition){const c=this.camera._calculateHandednessMultiplier(),A=(w.clientX-this._previousPosition.x)*c,l=w.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=A/this.angularSensibility,this.camera.cameraRotation.x+=l/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:A,offsetY:l}),this._previousPosition={x:w.clientX,y:w.clientY},y||w.preventDefault()}}),this._onMouseMove=A=>{if(!c.isPointerLock)return;const l=this.camera._calculateHandednessMultiplier(),w=A.movementX*l;this.camera.cameraRotation.y+=w/this.angularSensibility;const N=A.movementY;this.camera.cameraRotation.x+=N/this.angularSensibility,this._previousPosition=null,y||A.preventDefault()},this._observer=this.camera.mc()._inputManager._addCameraPointerObserver(this._pointerInput,O.c.POINTERDOWN|O.c.POINTERUP|O.c.POINTERMOVE),A&&(this._contextMenuBind=y=>this.onContextMenu(y),A.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(y){y.preventDefault()}IO(){if(this._observer){if(this.camera.mc()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const y=this.camera.getEngine().getInputElement();y&&y.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,l.b)([(0,w.P)()],L.prototype,"buttons",void 0),(0,l.b)([(0,w.P)()],L.prototype,"angularSensibility",void 0),W.d.FreeCameraMouseInput=L;var i,H=A(12604);class P{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new o.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(y){y=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==O.c.POINTERWHEEL)return;const A=c.event,l=A.deltaMode===H.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*l*A.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*l*A.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*l*A.deltaZ/this._normalize,A.preventDefault&&(y||A.preventDefault())},this._observer=this.camera.mc()._inputManager._addCameraPointerObserver(this._wheel,O.c.POINTERWHEEL)}IO(){this._observer&&(this.camera.mc()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,l.b)([(0,w.P)()],P.prototype,"wheelPrecisionX",void 0),(0,l.b)([(0,w.P)()],P.prototype,"wheelPrecisionY",void 0),(0,l.b)([(0,w.P)()],P.prototype,"wheelPrecisionZ",void 0),function(y){y[y.MoveRelative=0]="MoveRelative",y[y.RotateRelative=1]="RotateRelative",y[y.MoveScene=2]="MoveScene"}(i||(i={}));class D extends P{constructor(){super(...arguments),this._moveRelative=N.gc.Zero(),this._rotateRelative=N.gc.Zero(),this._moveScene=N.gc.Zero(),this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(y){null===y&&this._wheelXAction!==i.MoveRelative||(this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=y)}get wheelXMoveRelative(){return this._wheelXAction!==i.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(y){null===y&&this._wheelYAction!==i.MoveRelative||(this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=y)}get wheelYMoveRelative(){return this._wheelYAction!==i.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(y){null===y&&this._wheelZAction!==i.MoveRelative||(this._wheelZAction=i.MoveRelative,this._wheelZActionCoordinate=y)}get wheelZMoveRelative(){return this._wheelZAction!==i.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(y){null===y&&this._wheelXAction!==i.RotateRelative||(this._wheelXAction=i.RotateRelative,this._wheelXActionCoordinate=y)}get wheelXRotateRelative(){return this._wheelXAction!==i.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(y){null===y&&this._wheelYAction!==i.RotateRelative||(this._wheelYAction=i.RotateRelative,this._wheelYActionCoordinate=y)}get wheelYRotateRelative(){return this._wheelYAction!==i.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(y){null===y&&this._wheelZAction!==i.RotateRelative||(this._wheelZAction=i.RotateRelative,this._wheelZActionCoordinate=y)}get wheelZRotateRelative(){return this._wheelZAction!==i.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(y){null===y&&this._wheelXAction!==i.MoveScene||(this._wheelXAction=i.MoveScene,this._wheelXActionCoordinate=y)}get wheelXMoveScene(){return this._wheelXAction!==i.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(y){null===y&&this._wheelYAction!==i.MoveScene||(this._wheelYAction=i.MoveScene,this._wheelYActionCoordinate=y)}get wheelYMoveScene(){return this._wheelYAction!==i.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(y){null===y&&this._wheelZAction!==i.MoveScene||(this._wheelZAction=i.MoveScene,this._wheelZActionCoordinate=y)}get wheelZMoveScene(){return this._wheelZAction!==i.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.vc(0),this._rotateRelative.vc(0),this._moveScene.vc(0),this._updateCamera(),this.camera.mc().useRightHandedSystem&&(this._moveRelative.z*=-1);const y=N.Matrix.Zero();this.camera.getViewMatrix().invertToRef(y);const c=N.gc.Zero();N.gc.TransformNormalToRef(this._moveRelative,y,c),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(c),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(y,c,A){if(0===y)return;if(null===c||null===A)return;let l=null;switch(c){case i.MoveRelative:l=this._moveRelative;break;case i.RotateRelative:l=this._rotateRelative;break;case i.MoveScene:l=this._moveScene}switch(A){case 0:l.set(y,0,0);break;case 1:l.set(0,y,0);break;case 2:l.set(0,0,y)}}}(0,l.b)([(0,w.P)()],D.prototype,"wheelXMoveRelative",null),(0,l.b)([(0,w.P)()],D.prototype,"wheelYMoveRelative",null),(0,l.b)([(0,w.P)()],D.prototype,"wheelZMoveRelative",null),(0,l.b)([(0,w.P)()],D.prototype,"wheelXRotateRelative",null),(0,l.b)([(0,w.P)()],D.prototype,"wheelYRotateRelative",null),(0,l.b)([(0,w.P)()],D.prototype,"wheelZRotateRelative",null),(0,l.b)([(0,w.P)()],D.prototype,"wheelXMoveScene",null),(0,l.b)([(0,w.P)()],D.prototype,"wheelYMoveScene",null),(0,l.b)([(0,w.P)()],D.prototype,"wheelZMoveScene",null),W.d.FreeCameraMouseWheelInput=D;class t{constructor(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=y,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=I.Tools.IsSafari()}attachControl(y){y=I.Tools.BackCompatCameraNoPreventDefault(arguments);let c=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=A=>{const l=A.event,w="mouse"===l.pointerType||this._isSafari&&"undefined"===typeof l.pointerType;if(this.allowMouse||!w)if(A.type===O.c.POINTERDOWN){if(y||l.preventDefault(),this._pointerPressed.push(l.pointerId),1!==this._pointerPressed.length)return;c={x:l.clientX,y:l.clientY}}else if(A.type===O.c.POINTERUP){y||l.preventDefault();const A=this._pointerPressed.indexOf(l.pointerId);if(-1===A)return;if(this._pointerPressed.splice(A,1),0!=A)return;c=null,this._offsetX=null,this._offsetY=null}else if(A.type===O.c.POINTERMOVE){if(y||l.preventDefault(),!c)return;if(0!=this._pointerPressed.indexOf(l.pointerId))return;this._offsetX=l.clientX-c.x,this._offsetY=-(l.clientY-c.y)}}),this._observer=this.camera.mc()._inputManager._addCameraPointerObserver(this._pointerInput,O.c.POINTERDOWN|O.c.POINTERUP|O.c.POINTERMOVE),this._onLostFocus){const y=this.camera.getEngine().getInputElement();y&&y.addEventListener("blur",this._onLostFocus)}}IO(){if(this._pointerInput){if(this._observer&&(this.camera.mc()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const y=this.camera.getEngine().getInputElement();y&&y.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const y=this.camera,c=y._calculateHandednessMultiplier();y.cameraRotation.y=c*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)y.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const c=y._computeLocalCameraSpeed(),A=new N.gc(0,0,0!==this.touchMoveSensibility?c*this._offsetY/this.touchMoveSensibility:0);N.Matrix.RotationYawPitchRollToRef(y.rotation.y,y.rotation.x,0,y._cameraRotationMatrix),y.cameraDirection.addInPlace(N.gc.TransformCoordinates(A,y._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,l.b)([(0,w.P)()],t.prototype,"touchAngularSensibility",void 0),(0,l.b)([(0,w.P)()],t.prototype,"touchMoveSensibility",void 0),W.d.FreeCameraTouchInput=t;class s extends W.g{constructor(y){super(y),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new q),this}addMouse(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new L(y),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new D,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new t),this}clear(){super.clear(),this._mouseInput=null}}var B=A(12283),X=A(12220);class C extends p.b{get angularSensibility(){const y=this.inputs.attached.mouse;return y?y.angularSensibility:0}set angularSensibility(y){const c=this.inputs.attached.mouse;c&&(c.angularSensibility=y)}get keysUp(){const y=this.inputs.attached.keyboard;return y?y.keysUp:[]}set keysUp(y){const c=this.inputs.attached.keyboard;c&&(c.keysUp=y)}get keysUpward(){const y=this.inputs.attached.keyboard;return y?y.keysUpward:[]}set keysUpward(y){const c=this.inputs.attached.keyboard;c&&(c.keysUpward=y)}get keysDown(){const y=this.inputs.attached.keyboard;return y?y.keysDown:[]}set keysDown(y){const c=this.inputs.attached.keyboard;c&&(c.keysDown=y)}get keysDownward(){const y=this.inputs.attached.keyboard;return y?y.keysDownward:[]}set keysDownward(y){const c=this.inputs.attached.keyboard;c&&(c.keysDownward=y)}get keysLeft(){const y=this.inputs.attached.keyboard;return y?y.keysLeft:[]}set keysLeft(y){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=y)}get keysRight(){const y=this.inputs.attached.keyboard;return y?y.keysRight:[]}set keysRight(y){const c=this.inputs.attached.keyboard;c&&(c.keysRight=y)}get keysRotateLeft(){const y=this.inputs.attached.keyboard;return y?y.keysRotateLeft:[]}set keysRotateLeft(y){const c=this.inputs.attached.keyboard;c&&(c.keysRotateLeft=y)}get keysRotateRight(){const y=this.inputs.attached.keyboard;return y?y.keysRotateRight:[]}set keysRotateRight(y){const c=this.inputs.attached.keyboard;c&&(c.keysRotateRight=y)}get keysRotateUp(){const y=this.inputs.attached.keyboard;return y?y.keysRotateUp:[]}set keysRotateUp(y){const c=this.inputs.attached.keyboard;c&&(c.keysRotateUp=y)}get keysRotateDown(){const y=this.inputs.attached.keyboard;return y?y.keysRotateDown:[]}set keysRotateDown(y){const c=this.inputs.attached.keyboard;c&&(c.keysRotateDown=y)}constructor(y,c,A){var l;super(y,c,A,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),l=this,this.ellipsoid=new N.gc(.5,1,.5),this.ellipsoidOffset=new N.gc(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=N.gc.Zero(),this._diffPosition=N.gc.Zero(),this._newPosition=N.gc.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;l._newPosition.p(c),l._newPosition.subtractToRef(l._oldPosition,l._diffPosition),l._diffPosition.length()>X.b.CollisionsEpsilon&&(l.position.addToRef(l._diffPosition,l._deferredPositionUpdate),l._deferOnly?l._deferredUpdated=!0:l.position.p(l._deferredPositionUpdate),l.FL&&A&&l.FL(A))},this.inputs=new s(this),this.inputs.addKeyboard().addMouse()}attachControl(y,c){c=I.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(c)}IO(){this.inputs.detachElement(),this.cameraDirection=new N.gc(0,0,0),this.cameraRotation=new N.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(y){this._collisionMask=isNaN(y)?-1:y}_collideWithWorld(y){let c;c=this.parent?N.gc.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,c.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const A=this.mc().collisionCoordinator;this._collider||(this._collider=A.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let l=y;this.applyGravity&&(l=y.add(this.mc().gravity)),A.getNewPosition(this._oldPosition,l,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=N.gc.Zero(),this._transformedDirection=N.gc.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(y){this._needMoveForGravity=y}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.mc().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"qh"}}(0,l.b)([(0,w.M)()],C.prototype,"ellipsoid",void 0),(0,l.b)([(0,w.M)()],C.prototype,"ellipsoidOffset",void 0),(0,l.b)([(0,w.P)()],C.prototype,"checkCollisions",void 0),(0,l.b)([(0,w.P)()],C.prototype,"applyGravity",void 0),(0,B.f)("BABYLON.FreeCamera",C)},14525:(y,c,A)=>{"use strict";A.d(c,{d:()=>N});var l=A(12419),w=A(14533);class N{constructor(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=A,this.So=[],this._maxBlockCapacity=c||64,this._selectionContent=new l.d(1024),this._creationFunc=y}update(y,c,A){w.c._CreateBlocks(y,c,A,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Gq(y){for(let c=0;c<this.Rq.length;c++){this.Rq[c].addEntry(y)}}uq(y){for(let c=0;c<this.Rq.length;c++){this.Rq[c].removeEntry(y)}}select(y,c){this._selectionContent.reset();for(let A=0;A<this.Rq.length;A++){this.Rq[A].select(y,this._selectionContent,c)}return c?this._selectionContent.concat(this.So):this._selectionContent.concatWithNoDuplicate(this.So),this._selectionContent}intersects(y,c,A){this._selectionContent.reset();for(let l=0;l<this.Rq.length;l++){this.Rq[l].intersects(y,c,this._selectionContent,A)}return A?this._selectionContent.concat(this.So):this._selectionContent.concatWithNoDuplicate(this.So),this._selectionContent}intersectsRay(y){this._selectionContent.reset();for(let c=0;c<this.Rq.length;c++){this.Rq[c].intersectsRay(y,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.So),this._selectionContent}}N.CreationFuncForMeshes=(y,c)=>{const A=y.getBoundingInfo();!y.isBlocked&&A.boundingBox.intersectsMinMax(c.Go,c.jo)&&c.entries.push(y)},N.CreationFuncForSubMeshes=(y,c)=>{y.getBoundingInfo().boundingBox.intersectsMinMax(c.Go,c.jo)&&c.entries.push(y)}},14533:(y,c,A)=>{"use strict";A.d(c,{c:()=>N});var l=A(12325),w=A(12660);class N{constructor(y,c,A,l,w,N){this.entries=[],this.fo=new Array,this._capacity=A,this._depth=l,this._maxDepth=w,this._creationFunc=N,this._minPoint=y,this._maxPoint=c,this.fo.push(y.clone()),this.fo.push(c.clone()),this.fo.push(y.clone()),this.fo[2].x=c.x,this.fo.push(y.clone()),this.fo[3].y=c.y,this.fo.push(y.clone()),this.fo[4].z=c.z,this.fo.push(c.clone()),this.fo[5].z=y.z,this.fo.push(c.clone()),this.fo[6].x=y.x,this.fo.push(c.clone()),this.fo[7].y=y.y}get PA(){return this._capacity}get Go(){return this._minPoint}get jo(){return this._maxPoint}addEntry(y){if(this.Rq)for(let c=0;c<this.Rq.length;c++){this.Rq[c].addEntry(y)}else this._creationFunc(y,this),this.entries.length>this.PA&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(y){if(this.Rq){for(let c=0;c<this.Rq.length;c++){this.Rq[c].removeEntry(y)}return}const c=this.entries.indexOf(y);c>-1&&this.entries.splice(c,1)}addEntries(y){for(let c=0;c<y.length;c++){const A=y[c];this.addEntry(A)}}select(y,c,A){if(w.b.IsInFrustum(this.fo,y)){if(this.Rq){for(let l=0;l<this.Rq.length;l++){this.Rq[l].select(y,c,A)}return}A?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}}intersects(y,c,A,l){if(w.b.IntersectsSphere(this._minPoint,this._maxPoint,y,c)){if(this.Rq){for(let w=0;w<this.Rq.length;w++){this.Rq[w].intersects(y,c,A,l)}return}l?A.concat(this.entries):A.concatWithNoDuplicate(this.entries)}}intersectsRay(y,c){if(y.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Rq){for(let A=0;A<this.Rq.length;A++){this.Rq[A].intersectsRay(y,c)}return}c.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){N._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(y,c,A,w,p,W,h,I){h.Rq=new Array;const q=new l.gc((c.x-y.x)/2,(c.y-y.y)/2,(c.z-y.z)/2);for(let l=0;l<2;l++)for(let c=0;c<2;c++)for(let o=0;o<2;o++){const O=y.add(q.multiplyByFloats(l,c,o)),L=y.add(q.multiplyByFloats(l+1,c+1,o+1)),i=new N(O,L,w,p+1,W,I);i.addEntries(A),h.Rq.push(i)}}}},14537:(y,c,A)=>{"use strict";A.d(c,{d:()=>q});var l=A(12553),w=A(12325),N=A(12752),p=A(13653),W=A(12584),h=A(14525),I=A(12184);l.b.prototype.createOrUpdateSelectionOctree=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,A=this._getComponent(W.b.NAME_OCTREE);A||(A=new q(this),this.sc(A)),this.To||(this.To=new h.d(h.d.CreationFuncForMeshes,y,c));const l=this.getWorldExtends();return this.To.update(l.min,l.max,this.meshes),this.To},Object.defineProperty(l.b.prototype,"selectionOctree",{get:function(){return this.To},enumerable:!0,configurable:!0}),N.c.prototype.createOrUpdateSubmeshesOctree=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const A=this.mc();let l=A._getComponent(W.b.NAME_OCTREE);l||(l=new q(A),A.sc(l)),this._submeshesOctree||(this._submeshesOctree=new h.d(h.d.CreationFuncForSubMeshes,y,c)),this.Yc(!0);const w=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(w.minimumWorld,w.maximumWorld,this.jc),this._submeshesOctree};class q{constructor(y){this.name=W.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new p.d(w.gc.Zero(),new w.gc(1,1,1)),(y=y||I.c.LastCreatedScene)&&(this.Fc=y,this.Fc.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Fc.getActiveSubMeshCandidates=y=>this.getActiveSubMeshCandidates(y),this.Fc.getCollidingSubMeshCandidates=(y,c)=>this.getCollidingSubMeshCandidates(y,c),this.Fc.getIntersectingSubMeshCandidates=(y,c)=>this.getIntersectingSubMeshCandidates(y,c))}register(){this.Fc.onMeshRemovedObservable.add((y=>{const c=this.Fc.selectionOctree;if(void 0!==c&&null!==c){const A=c.So.indexOf(y);-1!==A&&c.So.splice(A,1)}})),this.Fc.onMeshImportedObservable.add((y=>{const c=this.Fc.selectionOctree;void 0!==c&&null!==c&&c.Gq(y)}))}getActiveMeshCandidates(){var y;return(null===(y=this.Fc.To)||void 0===y?void 0:y.select(this.Fc.frustumPlanes))||this.Fc._getDefaultMeshCandidates()}getActiveSubMeshCandidates(y){if(y._submeshesOctree&&y.useOctreeForRenderingSelection){return y._submeshesOctree.select(this.Fc.frustumPlanes)}return this.Fc._getDefaultSubMeshCandidates(y)}getIntersectingSubMeshCandidates(y,c){if(y._submeshesOctree&&y.useOctreeForPicking){p.d.TransformToRef(c,y.getWorldMatrix(),this._tempRay);return y._submeshesOctree.intersectsRay(this._tempRay)}return this.Fc._getDefaultSubMeshCandidates(y)}getCollidingSubMeshCandidates(y,c){if(y._submeshesOctree&&y.useOctreeForCollisions){const A=c._velocityWorldLength+Math.max(c._radius.x,c._radius.y,c._radius.z);return y._submeshesOctree.intersects(c._basePointWorld,A)}return this.Fc._getDefaultSubMeshCandidates(y)}rebuild(){}dispose(){}}},13653:(y,c,A)=>{"use strict";A.d(c,{d:()=>L});var l=A(12553),w=A(12775),N=A(12330),p=A(12325),W=A(12337),h=A(12647),I=A(12577),q=A(12184),o=A(12609);const O={internalPickerForMesh:void 0};class L{constructor(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.b;this.origin=y,this.direction=c,this.length=A,this.epsilon=l}clone(){return new L(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const l=L._TmpVector3[0].Ec(y.x-A,y.y-A,y.z-A),w=L._TmpVector3[1].Ec(c.x+A,c.y+A,c.z+A);let N,p,W,h,I=0,q=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<l.x||this.origin.x>w.x)return!1}else if(N=1/this.direction.x,p=(l.x-this.origin.x)*N,W=(w.x-this.origin.x)*N,W===-1/0&&(W=1/0),p>W&&(h=p,p=W,W=h),I=Math.max(p,I),q=Math.min(W,q),I>q)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<l.y||this.origin.y>w.y)return!1}else if(N=1/this.direction.y,p=(l.y-this.origin.y)*N,W=(w.y-this.origin.y)*N,W===-1/0&&(W=1/0),p>W&&(h=p,p=W,W=h),I=Math.max(p,I),q=Math.min(W,q),I>q)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<l.z||this.origin.z>w.z)return!1}else if(N=1/this.direction.z,p=(l.z-this.origin.z)*N,W=(w.z-this.origin.z)*N,W===-1/0&&(W=1/0),p>W&&(h=p,p=W,W=h),I=Math.max(p,I),q=Math.min(W,q),I>q)return!1;return!0}intersectsBox(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(y.minimum,y.maximum,c)}intersectsSphere(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=y.center.x-this.origin.x,l=y.center.y-this.origin.y,w=y.center.z-this.origin.z,N=A*A+l*l+w*w,p=y.radius+c,W=p*p;if(N<=W)return!0;const h=A*this.direction.x+l*this.direction.y+w*this.direction.z;if(h<0)return!1;return N-h*h<=W}intersectsTriangle(y,c,A){const l=L._TmpVector3[0],w=L._TmpVector3[1],N=L._TmpVector3[2],W=L._TmpVector3[3],I=L._TmpVector3[4];c.subtractToRef(y,l),A.subtractToRef(y,w),p.gc.CrossToRef(this.direction,w,N);const q=p.gc.Dot(l,N);if(0===q)return null;const o=1/q;this.origin.subtractToRef(y,W);const O=p.gc.Dot(W,N)*o;if(O<-this.epsilon||O>1+this.epsilon)return null;p.gc.CrossToRef(W,l,I);const i=p.gc.Dot(this.direction,I)*o;if(i<-this.epsilon||O+i>1+this.epsilon)return null;const H=p.gc.Dot(w,I)*o;return H>this.length?null:new h.b(1-O-i,O,H)}intersectsPlane(y){let c;const A=p.gc.Dot(y.normal,this.direction);if(Math.abs(A)<9.99999997475243e-7)return null;{const l=p.gc.Dot(y.normal,this.origin);return c=(-y.d-l)/A,c<0?c<-9.99999997475243e-7?null:0:c}}intersectsAxis(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(y){case"y":{const y=(this.origin.y-c)/this.direction.y;return y>0?null:new p.gc(this.origin.x+this.direction.x*-y,c,this.origin.z+this.direction.z*-y)}case"x":{const y=(this.origin.x-c)/this.direction.x;return y>0?null:new p.gc(c,this.origin.y+this.direction.y*-y,this.origin.z+this.direction.z*-y)}case"z":{const y=(this.origin.z-c)/this.direction.z;return y>0?null:new p.gc(this.origin.x+this.direction.x*-y,this.origin.y+this.direction.y*-y,c)}default:return null}}intersectsMesh(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const W=p.TmpVectors.Matrix[0];return y.getWorldMatrix().invertToRef(W),this._tmpRay?L.TransformToRef(this,W,this._tmpRay):this._tmpRay=L.Transform(this,W),y.intersects(this._tmpRay,c,A,l,w,N)}intersectsMeshes(y,c,A){A?A.length=0:A=[];for(let l=0;l<y.length;l++){const w=this.intersectsMesh(y[l],c);w.hit&&A.push(w)}return A.sort(this._comparePickingInfo),A}_comparePickingInfo(y,c){return y.distance<c.distance?-1:y.distance>c.distance?1:0}intersectionSegment(y,c,A){const l=this.origin,w=p.TmpVectors.gc[0],N=p.TmpVectors.gc[1],W=p.TmpVectors.gc[2],h=p.TmpVectors.gc[3];c.subtractToRef(y,w),this.direction.scaleToRef(L._Rayl,W),l.addToRef(W,N),y.subtractToRef(l,h);const I=p.gc.Dot(w,w),q=p.gc.Dot(w,W),o=p.gc.Dot(W,W),O=p.gc.Dot(w,h),i=p.gc.Dot(W,h),H=I*o-q*q;let P,D,t=H,s=H;H<L._Smallnum?(P=0,t=1,D=i,s=o):(P=q*i-o*O,D=I*i-q*O,P<0?(P=0,D=i,s=o):P>t&&(P=t,D=i+q,s=o)),D<0?(D=0,-O<0?P=0:-O>I?P=t:(P=-O,t=I)):D>s&&(D=s,-O+q<0?P=0:-O+q>I?P=t:(P=-O+q,t=I));const B=Math.abs(P)<L._Smallnum?0:P/t,X=Math.abs(D)<L._Smallnum?0:D/s,C=p.TmpVectors.gc[4];W.scaleToRef(X,C);const K=p.TmpVectors.gc[5];w.scaleToRef(B,K),K.addInPlace(h);const my=p.TmpVectors.gc[6];K.subtractToRef(C,my);return X>0&&X<=this.length&&my.lengthSquared()<A*A?K.length():-1}update(y,c,A,l,w,N,W){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){L._RayDistant||(L._RayDistant=L.Zero()),L._RayDistant.unprojectRayToRef(y,c,A,l,p.Matrix.IdentityReadOnly,N,W);const h=p.TmpVectors.Matrix[0];w.invertToRef(h),L.TransformToRef(L._RayDistant,h,this)}else this.unprojectRayToRef(y,c,A,l,w,N,W);return this}static Zero(){return new L(p.gc.Zero(),p.gc.Zero())}static CreateNew(y,c,A,l,w,N,p){return L.Zero().update(y,c,A,l,w,N,p)}static CreateNewFromTo(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.Matrix.IdentityReadOnly;const l=new L(new p.gc(0,0,0),new p.gc(0,0,0));return L.CreateFromToToRef(y,c,l,A)}static CreateFromToToRef(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.Matrix.IdentityReadOnly;A.origin.p(y);const w=c.subtractToRef(y,A.direction),N=Math.sqrt(w.x*w.x+w.y*w.y+w.z*w.z);return A.length=N,A.direction.normalize(),L.TransformToRef(A,l,A)}static Transform(y,c){const A=new L(new p.gc(0,0,0),new p.gc(0,0,0));return L.TransformToRef(y,c,A),A}static TransformToRef(y,c,A){p.gc.TransformCoordinatesToRef(y.origin,c,A.origin),p.gc.TransformNormalToRef(y.direction,c,A.direction),A.length=y.length,A.epsilon=y.epsilon;const l=A.direction,w=l.length();if(0!==w&&1!==w){const y=1/w;l.x*=y,l.y*=y,l.z*=y,A.length*=w}return A}unprojectRayToRef(y,c,A,l,w,N,W){const h=p.TmpVectors.Matrix[0];w.multiplyToRef(N,h),h.multiplyToRef(W,h),h.invert();const I=q.c.LastCreatedEngine,o=p.TmpVectors.gc[0];o.x=y/A*2-1,o.y=-(c/l*2-1),o.z=null!==I&&void 0!==I&&I.Xc?1:null!==I&&void 0!==I&&I.isNDCHalfZRange?0:-1;const O=p.TmpVectors.gc[1].Ec(o.x,o.y,1-1e-8),L=p.TmpVectors.gc[2],i=p.TmpVectors.gc[3];p.gc._UnprojectFromInvertedMatrixToRef(o,h,L),p.gc._UnprojectFromInvertedMatrixToRef(O,h,i),this.origin.p(L),i.subtractToRef(L,this.direction),this.direction.normalize()}}function i(y,c,A,l,w){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=L.Zero();return H(y,c,A,l,p,w,N),p}function H(y,c,A,l,w,N){let W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const I=y.getEngine();if(!N&&!(N=y.activeCamera))return y;const q=N.viewport,o=I.getRenderHeight(),{x:O,y:L,width:i,height:H}=q.toGlobal(I.getRenderWidth(),o),P=1/I.getHardwareScalingLevel();return c=c*P-O,A=A*P-(o-L-H),w.update(c,A,i,H,l||p.Matrix.IdentityReadOnly,W?p.Matrix.IdentityReadOnly:N.getViewMatrix(),N.getProjectionMatrix(),h),y}function P(y,c,A,l,w){if(!I.c)return y;const N=y.getEngine();if(!w&&!(w=y.activeCamera))throw new Error("Active camera not set");const W=w.viewport,h=N.getRenderHeight(),{x:q,y:o,width:O,height:L}=W.toGlobal(N.getRenderWidth(),h),i=p.Matrix.Identity(),H=1/N.getHardwareScalingLevel();return c=c*H-q,A=A*H-(h-o-L),l.update(c,A,O,L,i,i,w.getProjectionMatrix()),y}function D(y,c,A,l,w,N,p,W){const h=c(l,A.enableDistantPicking),I=A.intersects(h,w,p,N,l,W);return I&&I.hit?!w&&null!=y&&I.distance>=y.distance?null:I:null}function t(y,c,A,l,w,N){let W=null;const h=!!(y.activeCameras&&y.activeCameras.length>1&&y.cameraToUseForPointers!==y.activeCamera),q=y.cameraToUseForPointers||y.activeCamera,o=O.internalPickerForMesh||D;for(let I=0;I<y.meshes.length;I++){const O=y.meshes[I];if(A){if(!A(O,-1))continue}else if(!O.isEnabled()||!O.isVisible||!O.HI)continue;const L=h&&O.isWorldMatrixCameraDependent(),i=O.Yc(L,q);if(O.hasThinInstances&&O.ZI){const y=o(W,c,O,i,!0,!0,N);if(y){if(w)return y;const h=p.TmpVectors.Matrix[1],I=O.thinInstanceGetWorldMatrices();for(let y=0;y<I.length;y++){if(A&&!A(O,y))continue;I[y].multiplyToRef(i,h);const p=o(W,c,O,h,l,w,N,!0);if(p&&(W=p,W.thinInstanceIndex=y,l))return W}}}else{const y=o(W,c,O,i,l,w,N);if(y&&(W=y,l))return W}}return W||new I.c}function s(y,c,A,l){if(!I.c)return null;const w=[],N=!!(y.activeCameras&&y.activeCameras.length>1&&y.cameraToUseForPointers!==y.activeCamera),W=y.cameraToUseForPointers||y.activeCamera,h=O.internalPickerForMesh||D;for(let I=0;I<y.meshes.length;I++){const q=y.meshes[I];if(A){if(!A(q,-1))continue}else if(!q.isEnabled()||!q.isVisible||!q.HI)continue;const o=N&&q.isWorldMatrixCameraDependent(),O=q.Yc(o,W);if(q.hasThinInstances&&q.ZI){if(h(null,c,q,O,!0,!0,l)){const y=p.TmpVectors.Matrix[1],N=q.thinInstanceGetWorldMatrices();for(let p=0;p<N.length;p++){if(A&&!A(q,p))continue;N[p].multiplyToRef(O,y);const W=h(null,c,q,y,!1,!1,l,!0);W&&(W.thinInstanceIndex=p,w.push(W))}}}else{const y=h(null,c,q,O,!1,!1,l);y&&w.push(y)}}return w}function B(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,l=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0;l||(l=y.getWorldMatrix()),c.length=A,w?c.origin.p(w):c.origin.p(y.position);const N=p.TmpVectors.gc[2];N.set(0,0,y._scene.useRightHandedSystem?-1:1);const W=p.TmpVectors.gc[3];return p.gc.TransformNormalToRef(N,l,W),p.gc.NormalizeToRef(W,c.direction),c}var X,C;L._TmpVector3=(0,W.d)(6,p.gc.Zero),L._RayDistant=L.Zero(),L._Smallnum=1e-8,L._Rayl=1e9,X=l.b,(C=w.c)&&(C.prototype.getForwardRay=function(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,c=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;return B(this,new L(p.gc.Zero(),p.gc.Zero(),y),y,c,A)},C.prototype.getForwardRayToRef=function(y){return B(this,y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),X&&(o.e._IsPickingAvailable=!0,X.prototype.createPickingRay=function(y,c,A,l){return i(this,y,c,A,l,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),l.b.prototype.createPickingRayToRef=function(y,c,A,l,w){return H(this,y,c,A,l,w,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},l.b.prototype.createPickingRayInCameraSpace=function(y,c,A){return function(y,c,A,l){const w=L.Zero();return P(y,c,A,w,l),w}(this,y,c,A)},l.b.prototype.createPickingRayInCameraSpaceToRef=function(y,c,A,l){return P(this,y,c,A,l)},l.b.prototype.pickWithBoundingInfo=function(y,c,A,l,w){return function(y,c,A,l,w,N){if(!I.c)return null;const W=t(y,(l=>(y._tempPickingRay||(y._tempPickingRay=L.Zero()),H(y,c,A,l,y._tempPickingRay,N||null),y._tempPickingRay)),l,w,!0);return W&&(W.ray=i(y,c,A,p.Matrix.Identity(),N||null)),W}(this,y,c,A,l,w)},l.b.prototype.rA=function(y,c,A,l,w,N){return function(y,c,A,l,w,N,W){const h=t(y,((l,w)=>(y._tempPickingRay||(y._tempPickingRay=L.Zero()),H(y,c,A,l,y._tempPickingRay,N||null,!1,w),y._tempPickingRay)),l,w,!1,W);return h&&(h.ray=i(y,c,A,p.Matrix.Identity(),N||null)),h}(this,y,c,A,l,w,N)},l.b.prototype.pickWithRay=function(y,c,A,l){return function(y,c,A,l,w){const N=t(y,(A=>(y._pickWithRayInverseMatrix||(y._pickWithRayInverseMatrix=p.Matrix.Identity()),A.invertToRef(y._pickWithRayInverseMatrix),y._cachedRayForTransform||(y._cachedRayForTransform=L.Zero()),L.TransformToRef(c,y._pickWithRayInverseMatrix,y._cachedRayForTransform),y._cachedRayForTransform)),A,l,!1,w);return N&&(N.ray=c),N}(this,y,c,A,l)},l.b.prototype.multiPick=function(y,c,A,l,w){return function(y,c,A,l,w,N){return s(y,(l=>i(y,c,A,l,w||null)),l,N)}(this,y,c,A,l,w)},l.b.prototype.multiPickWithRay=function(y,c,A){return function(y,c,A,l){return s(y,(A=>(y._pickWithRayInverseMatrix||(y._pickWithRayInverseMatrix=p.Matrix.Identity()),A.invertToRef(y._pickWithRayInverseMatrix),y._cachedRayForTransform||(y._cachedRayForTransform=L.Zero()),L.TransformToRef(c,y._pickWithRayInverseMatrix,y._cachedRayForTransform),y._cachedRayForTransform)),A,l)}(this,y,c,A)}},13959:(y,c,A)=>{"use strict";var l=A(12255),w=A(12161),N=A(12191),p=A(12287),W=A(12220),h=A(12267);W.b.prototype._partialLoadFile=function(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(y,(y=>{A[c]=y,A._internalCount++,6===A._internalCount&&l(A)}),void 0,void 0,!0,((y,c)=>{w&&y&&w(y.status+" "+y.statusText,c)}))},W.b.prototype._cascadeLoadFiles=function(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const w=[];w._internalCount=0;for(let N=0;N<6;N++)this._partialLoadFile(A[N],N,w,c,l)},W.b.prototype._cascadeLoadImgs=function(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5?arguments[5]:void 0;const p=[];p._internalCount=0;for(let W=0;W<6;W++)this._partialLoadImg(l[W],W,p,y,c,A,w,N)},W.b.prototype._partialLoadImg=function(y,c,A,l,w,W){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7?arguments[7]:void 0;const q=(0,p.e)();(0,N.t)(y,(y=>{A[c]=y,A._internalCount++,l&&l.removePendingData(q),6===A._internalCount&&W&&W(w,A)}),((y,c)=>{l&&l.removePendingData(q),h&&h(y,c)}),l?l.offlineProvider:null,I),l&&l.addPendingData(q)},W.b.prototype.createCubeTextureBase=function(y,c,A,N){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6?arguments[6]:void 0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]&&arguments[8],O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,L=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,H=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,P=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,D=arguments.length>14&&void 0!==arguments[14]&&arguments[14],t=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const s=i||new l.c(this,7);s.isCube=!0,s.url=y,s.generateMipMaps=!N,s._lodGenerationScale=O,s._lodGenerationOffset=L,s._useSRGBBuffer=!!D&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!N),s!==i&&(s.label=y.substring(0,60)),this._doNotHandleContextLost||(s._extension=q,s._files=A,s._buffer=t);const B=y;this._transformTextureUrl&&!i&&(y=this._transformTextureUrl(y));const X=q??function(y){const c=y.split("?")[0],A=c.lastIndexOf(".");return A>-1?c.substring(A).toLowerCase():""}(y),C=(0,h.b)(X),K=(y,c)=>{s.dispose(),W?W(y,c):y&&w.c.Warn(y)},my=(l,W)=>{y===B?l&&K(l.status+" "+l.statusText,W):(w.c.Warn(`Failed to load ${y}, falling back to the ${B}`),this.createCubeTextureBase(B,c,A,!!N,p,K,I,q,o,O,L,s,H,P,D,t))};if(C)C.then((l=>{const w=y=>{H&&H(s,y),l.loadCubeData(y,s,o,p,((y,c)=>{K(y,c)}))};t?w(t):A&&6===A.length?l.supportCascades?this._cascadeLoadFiles(c,(y=>w(y.map((y=>new Uint8Array(y))))),A,K):K("Textures type does not support cascades."):this._loadFile(y,(y=>w(new Uint8Array(y))),void 0,void 0,!0,my)}));else{if(!A||0===A.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(c,s,((y,c)=>{P&&P(y,c)}),A,K)}return this._internalTexturesCache.push(s),s}},14539:(y,c,A)=>{"use strict";A(12161);var l=A(12454);A(12255),A(12408),A(12251),A(12497),A(12463);l.c},13986:(y,c,A)=>{"use strict";A.d(c,{b:()=>w});var l=A(12283);class w{constructor(y){this.value=this._toInt(y)}_toInt(y){return 0|y}add(y){return new w(this.value+y.value)}xc(y){return new w(this.value-y.value)}multiply(y){return new w(Math.imul(this.value,y.value))}divide(y){return new w(this.value/y.value)}getClassName(){return w.ClassName}equals(y){return this.value===y.value}static FromValue(y){return new w(y)}toString(){return this.value.toString()}}w.ClassName="FlowGraphInteger",(0,l.f)("FlowGraphInteger",w)},13995:(y,c,A)=>{"use strict";A.d(c,{d:()=>w,f:()=>N});var l=A(12325);class w{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.kc=y}get m(){return this.kc}transformVector(y){return this.transformVectorToRef(y,new l.Vector2)}transformVectorToRef(y,c){return c.x=y.x*this.kc[0]+y.y*this.kc[1],c.y=y.x*this.kc[2]+y.y*this.kc[3],c}fc(){return this.toArray()}toArray(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<4;c++)y[c]=this.kc[c];return y}nA(y){for(let c=0;c<4;c++)this.kc[c]=y[c];return this}multiplyToRef(y,c){const A=y.kc,l=this.kc,w=c.kc;return w[0]=A[0]*l[0]+A[1]*l[2],w[1]=A[0]*l[1]+A[1]*l[3],w[2]=A[2]*l[0]+A[3]*l[2],w[3]=A[2]*l[1]+A[3]*l[3],c}multiply(y){return this.multiplyToRef(y,new w)}divideToRef(y,c){const A=this.kc,l=y.kc,w=c.kc;return w[0]=A[0]/l[0],w[1]=A[1]/l[1],w[2]=A[2]/l[2],w[3]=A[3]/l[3],c}divide(y){return this.divideToRef(y,new w)}addToRef(y,c){const A=this.kc,l=y.m,w=c.m;return w[0]=A[0]+l[0],w[1]=A[1]+l[1],w[2]=A[2]+l[2],w[3]=A[3]+l[3],c}add(y){return this.addToRef(y,new w)}subtractToRef(y,c){const A=this.kc,l=y.m,w=c.m;return w[0]=A[0]-l[0],w[1]=A[1]-l[1],w[2]=A[2]-l[2],w[3]=A[3]-l[3],c}xc(y){return this.subtractToRef(y,new w)}transpose(){const y=this.kc;return new w([y[0],y[2],y[1],y[3]])}determinant(){const y=this.kc;return y[0]*y[3]-y[1]*y[2]}inverse(){const y=this.determinant();if(0===y)throw new Error("Matrix is not invertible");const c=this.kc,A=1/y;return new w([c[3]*A,-c[1]*A,-c[2]*A,c[0]*A])}equals(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=this.kc,l=y.m;return 0===c?A[0]===l[0]&&A[1]===l[1]&&A[2]===l[2]&&A[3]===l[3]:Math.abs(A[0]-l[0])<c&&Math.abs(A[1]-l[1])<c&&Math.abs(A[2]-l[2])<c&&Math.abs(A[3]-l[3])<c}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.kc.join(", ")})`}}class N{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.kc=y}get m(){return this.kc}transformVector(y){return this.transformVectorToRef(y,new l.gc)}transformVectorToRef(y,c){const A=this.kc;return c.x=y.x*A[0]+y.y*A[1]+y.z*A[2],c.y=y.x*A[3]+y.y*A[4]+y.z*A[5],c.z=y.x*A[6]+y.y*A[7]+y.z*A[8],c}multiplyToRef(y,c){const A=y.kc,l=this.kc,w=c.m;return w[0]=A[0]*l[0]+A[1]*l[3]+A[2]*l[6],w[1]=A[0]*l[1]+A[1]*l[4]+A[2]*l[7],w[2]=A[0]*l[2]+A[1]*l[5]+A[2]*l[8],w[3]=A[3]*l[0]+A[4]*l[3]+A[5]*l[6],w[4]=A[3]*l[1]+A[4]*l[4]+A[5]*l[7],w[5]=A[3]*l[2]+A[4]*l[5]+A[5]*l[8],w[6]=A[6]*l[0]+A[7]*l[3]+A[8]*l[6],w[7]=A[6]*l[1]+A[7]*l[4]+A[8]*l[7],w[8]=A[6]*l[2]+A[7]*l[5]+A[8]*l[8],c}multiply(y){return this.multiplyToRef(y,new N)}divideToRef(y,c){const A=this.kc,l=y.m,w=c.m;return w[0]=A[0]/l[0],w[1]=A[1]/l[1],w[2]=A[2]/l[2],w[3]=A[3]/l[3],w[4]=A[4]/l[4],w[5]=A[5]/l[5],w[6]=A[6]/l[6],w[7]=A[7]/l[7],w[8]=A[8]/l[8],c}divide(y){return this.divideToRef(y,new N)}addToRef(y,c){const A=this.kc,l=y.m,w=c.m;return w[0]=A[0]+l[0],w[1]=A[1]+l[1],w[2]=A[2]+l[2],w[3]=A[3]+l[3],w[4]=A[4]+l[4],w[5]=A[5]+l[5],w[6]=A[6]+l[6],w[7]=A[7]+l[7],w[8]=A[8]+l[8],c}add(y){return this.addToRef(y,new N)}subtractToRef(y,c){const A=this.kc,l=y.m,w=c.m;return w[0]=A[0]-l[0],w[1]=A[1]-l[1],w[2]=A[2]-l[2],w[3]=A[3]-l[3],w[4]=A[4]-l[4],w[5]=A[5]-l[5],w[6]=A[6]-l[6],w[7]=A[7]-l[7],w[8]=A[8]-l[8],c}xc(y){return this.subtractToRef(y,new N)}toArray(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<9;c++)y[c]=this.kc[c];return y}fc(){return this.toArray()}nA(y){for(let c=0;c<9;c++)this.kc[c]=y[c];return this}transpose(){const y=this.kc;return new N([y[0],y[3],y[6],y[1],y[4],y[7],y[2],y[5],y[8]])}determinant(){const y=this.kc;return y[0]*(y[4]*y[8]-y[5]*y[7])-y[1]*(y[3]*y[8]-y[5]*y[6])+y[2]*(y[3]*y[7]-y[4]*y[6])}inverse(){const y=this.determinant();if(0===y)throw new Error("Matrix is not invertible");const c=this.kc,A=1/y;return new N([(c[4]*c[8]-c[5]*c[7])*A,(c[2]*c[7]-c[1]*c[8])*A,(c[1]*c[5]-c[2]*c[4])*A,(c[5]*c[6]-c[3]*c[8])*A,(c[0]*c[8]-c[2]*c[6])*A,(c[2]*c[3]-c[0]*c[5])*A,(c[3]*c[7]-c[4]*c[6])*A,(c[1]*c[6]-c[0]*c[7])*A,(c[0]*c[4]-c[1]*c[3])*A])}equals(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=this.kc,l=y.m;return 0===c?A[0]===l[0]&&A[1]===l[1]&&A[2]===l[2]&&A[3]===l[3]&&A[4]===l[4]&&A[5]===l[5]&&A[6]===l[6]&&A[7]===l[7]&&A[8]===l[8]:Math.abs(A[0]-l[0])<c&&Math.abs(A[1]-l[1])<c&&Math.abs(A[2]-l[2])<c&&Math.abs(A[3]-l[3])<c&&Math.abs(A[4]-l[4])<c&&Math.abs(A[5]-l[5])<c&&Math.abs(A[6]-l[6])<c&&Math.abs(A[7]-l[7])<c&&Math.abs(A[8]-l[8])<c}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.kc.join(", ")})`}}},14e3:(y,c,A)=>{"use strict";var l;function w(y,c,A,l){switch(c){case"Animation":return l?y.animations.find((y=>y.uniqueId===A))??null:y.animations[A]??null;case"AnimationGroup":return l?y.animationGroups.find((y=>y.uniqueId===A))??null:y.animationGroups[A]??null;case"Mesh":return l?y.meshes.find((y=>y.uniqueId===A))??null:y.meshes[A]??null;case"Material":return l?y.materials.find((y=>y.uniqueId===A))??null:y.materials[A]??null;case"Yq":return l?y.cameras.find((y=>y.uniqueId===A))??null:y.cameras[A]??null;case"Light":return l?y.lights.find((y=>y.uniqueId===A))??null:y.lights[A]??null;default:return null}}A.d(c,{e:()=>w}),function(y){y.Animation="Animation",y.AnimationGroup="AnimationGroup",y.Mesh="Mesh",y.Material="Material",y.Yq="Yq",y.Light="Light"}(l||(l={}))},14029:(y,c,A)=>{"use strict";A.d(c,{c:()=>w});var l=A(14036);class w extends l.e{constructor(y,c){if(super(y),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),c)for(const A of c)this._eventsSignalOutputs[A]=this._registerSignalOutput(A+"Event")}_executeOnTick(y){}_startPendingTasks(y){y._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(y),this._resetAfterCanceled(y)),this._preparePendingTasks(y),y._addPendingBlock(this),this.out._activateSignal(y),y._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(y){y._deleteExecutionVariable(this,"_initialized"),y._removePendingBlock(this)}}},14010:(y,c,A)=>{"use strict";A.d(c,{e:()=>I});var l=A(12287),w=A(12283),N=A(14016),p=A(12153),W=A(13980);class h extends N.b{constructor(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l.defaultValue,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(y,c,A),this.richType=l,this._defaultValue=w,this._optional=N,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new p.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(y){this._isDisabled!==y&&(this._isDisabled=y,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(y,c){c._getConnectionValue(this)!==y&&(c._setConnectionValue(this,y),this.onValueChangedObservable.notifyObservers(y))}resetToDefaultValue(y){y._setConnectionValue(this,this._defaultValue)}connectTo(y){this._isDisabled||super.connectTo(y)}_getValueOrDefault(y){const c=y._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(c):c}getValue(y){if(1===this.connectionType){y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(y);const c=this._getValueOrDefault(y);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}const c=this.isConnected()?this._connectedPoint[0].getValue(y):this._getValueOrDefault(y);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(y),y.richType={},this.richType.serialize(y.richType),y.optional=this._optional,(0,W.c)("defaultValue",this._defaultValue,y)}}(0,w.f)("FlowGraphDataConnection",h);class I{constructor(y){var c;this.config=y,this.uniqueId=(0,l.e)(),this.name=(null===(c=this.config)||void 0===c?void 0:c.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(y){}registerDataInput(y,c,A){const l=new h(y,0,this,c,A);return this.dataInputs.push(l),l}registerDataOutput(y,c,A){const l=new h(y,1,this,c,A);return this.dataOutputs.push(l),l}getDataInput(y){return this.dataInputs.find((c=>c.name===y))}getDataOutput(y){return this.dataOutputs.find((c=>c.name===y))}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.c;if(y.uniqueId=this.uniqueId,y.config={},this.config){const A=this.config,l=Object.keys(A);for(const w of l)c(w,A[w],y.config)}y.dataInputs=[],y.dataOutputs=[],y.className=this.getClassName();for(const A of this.dataInputs){const c={};A.serialize(c),y.dataInputs.push(c)}for(const A of this.dataOutputs){const c={};A.serialize(c),y.dataOutputs.push(c)}}deserialize(y){}_log(y,c,A){var l;null===(l=y.logger)||void 0===l||l.addLogItem({action:c,EA:A,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14016:(y,c,A)=>{"use strict";A.d(c,{b:()=>N});var l,w=A(12287);!function(y){y[y.Input=0]="Input",y[y.Output=1]="Output"}(l||(l={}));class N{constructor(y,c,A){this._ownerBlock=A,this._connectedPoint=[],this.uniqueId=(0,w.e)(),this.connectedPointIds=[],this.name=y,this._connectionType=c}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(y){if(this._connectionType===y._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||y._isSingularConnection()&&y._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(y),y._connectedPoint.push(this)}disconnectFrom(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=this._connectedPoint.indexOf(y),l=y._connectedPoint.indexOf(this);-1!==A&&-1!==l&&(c&&this._connectedPoint.splice(A,1),y._connectedPoint.splice(l,1))}disconnectFromAll(){for(const y of this._connectedPoint)this.disconnectFrom(y,!1);this._connectedPoint.length=0}dispose(){for(const y of this._connectedPoint)this.disconnectFrom(y)}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y.uniqueId=this.uniqueId,y.name=this.name,y._connectionType=this._connectionType,y.connectedPointIds=[],y.className=this.getClassName();for(const c of this._connectedPoint)y.connectedPointIds.push(c.uniqueId)}getClassName(){return"FGConnection"}deserialize(y){this.uniqueId=y.uniqueId,this.name=y.name,this._connectionType=y._connectionType,this.connectedPointIds=y.connectedPointIds}}},13973:(y,c,A)=>{"use strict";A.d(c,{d:()=>s});var l,w=A(12153),N=A(12307),p=A(12310),W=A(12287),h=A(13980),I=A(14e3),q=A(12161);!function(y){y.ExecuteBlock="ExecuteBlock",y.ExecuteEvent="ExecuteEvent",y.TriggerConnection="TriggerConnection",y.ContextVariableSet="ContextVariableSet",y.GlobalVariableSet="GlobalVariableSet",y.GlobalVariableDelete="GlobalVariableDelete",y.GlobalVariableGet="GlobalVariableGet",y.AddConnection="AddConnection",y.GetConnectionValue="GetConnectionValue",y.SetConnectionValue="SetConnectionValue",y.ActivateSignal="ActivateSignal",y.ContextVariableGet="ContextVariableGet"}(l||(l={}));class o{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(y){if(y.time||(y.time=Date.now()),this.log.push(y),this.logToConsole){var c;const A=null===(c=y.EA)||void 0===c?void 0:c.value;"object"===typeof A&&A.getClassName?q.c.Log(`[FGLog] ${y.className}:${y.uniqueId.split("-")[0]} ${y.action} - ${JSON.stringify(A.getClassName())}: ${A.toString()}`):q.c.Log(`[FGLog] ${y.className}:${y.uniqueId.split("-")[0]} ${y.action} - ${JSON.stringify(y.EA)}`)}}getItemsOfType(y){return this.log.filter((c=>c.action===y))}}class O{get enableLogging(){return this._enableLogging}set enableLogging(y){this._enableLogging!==y&&(this._enableLogging=y,this._enableLogging?(this.logger=new o,this.logger.logToConsole=!0):this.logger=null)}constructor(y){this.uniqueId=(0,W.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new w.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=y,this.assetsContext=y.assetsContext??y.Fc}hasVariable(y){return y in this._userVariables}setVariable(y,c){var A;this._userVariables[y]=c,null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",EA:{name:y,value:c}})}getAsset(y,c){return(0,I.e)(this.assetsContext,y,c)}getVariable(y){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",EA:{name:y,value:this._userVariables[y]}}),this._userVariables[y]}get userVariables(){return this._userVariables}mc(){return this._configuration.Fc}_getUniqueIdPrefixedName(y,c){return`${y.uniqueId}_${c}`}_getGlobalContextVariable(y,c){var A;return null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",EA:{name:y,defaultValue:c,possibleValue:this._globalContextVariables[y]}}),this._hasGlobalContextVariable(y)?this._globalContextVariables[y]:c}_setGlobalContextVariable(y,c){var A;null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",EA:{name:y,value:c}}),this._globalContextVariables[y]=c}_deleteGlobalContextVariable(y){var c;null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",EA:{name:y}}),delete this._globalContextVariables[y]}_hasGlobalContextVariable(y){return y in this._globalContextVariables}_setExecutionVariable(y,c,A){this._executionVariables[this._getUniqueIdPrefixedName(y,c)]=A}_getExecutionVariable(y,c,A){return this._hasExecutionVariable(y,c)?this._executionVariables[this._getUniqueIdPrefixedName(y,c)]:A}_deleteExecutionVariable(y,c){delete this._executionVariables[this._getUniqueIdPrefixedName(y,c)]}_hasExecutionVariable(y,c){return this._getUniqueIdPrefixedName(y,c)in this._executionVariables}_hasConnectionValue(y){return y.uniqueId in this._connectionValues}_setConnectionValue(y,c){var A;this._connectionValues[y.uniqueId]=c,null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",EA:{connectionPointId:y.uniqueId,value:c}})}_setConnectionValueByKey(y,c){this._connectionValues[y]=c}_getConnectionValue(y){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",EA:{connectionPointId:y.uniqueId,value:this._connectionValues[y.uniqueId]}}),this._connectionValues[y.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(y){this._pendingBlocks.includes(y)||(this._pendingBlocks.push(y),this._pendingBlocks.sort(((y,c)=>y.priority-c.priority)))}_removePendingBlock(y){const c=this._pendingBlocks.indexOf(y);-1!==c&&this._pendingBlocks.splice(c,1)}_clearPendingBlocks(){for(const y of this._pendingBlocks)y._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(y){var c;this.onNodeExecutedObservable.notifyObservers(y),null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:y.getClassName(),uniqueId:y.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(y){this._setGlobalContextVariable("timeSinceStart",y.timeSinceStart),this._setGlobalContextVariable("deltaTime",y.deltaTime);for(const A of this._pendingBlocks){var c;null===(c=A._executeOnTick)||void 0===c||c.call(A,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.c;y.uniqueId=this.uniqueId,y._userVariables={};for(const l in this._userVariables)c(l,this._userVariables[l],y._userVariables);y._connectionValues={};for(const l in this._connectionValues)c(l,this._connectionValues[l],y._connectionValues);var A;this.assetsContext!==this.mc()&&(y._assetsContext={meshes:this.assetsContext.meshes.map((y=>y.id)),materials:this.assetsContext.materials.map((y=>y.id)),textures:this.assetsContext.textures.map((y=>y.name)),animations:this.assetsContext.animations.map((y=>y.name)),lights:this.assetsContext.lights.map((y=>y.id)),cameras:this.assetsContext.cameras.map((y=>y.id)),IL:null===(A=this.assetsContext.IL)||void 0===A?void 0:A.map((y=>y.name)),skeletons:this.assetsContext.skeletons.map((y=>y.id)),MO:this.assetsContext.MO.map((y=>y.name)),geometries:this.assetsContext.geometries.map((y=>y.id)),multiMaterials:this.assetsContext.multiMaterials.map((y=>y.id)),transformNodes:this.assetsContext.transformNodes.map((y=>y.id))})}getClassName(){return"FlowGraphContext"}}(0,N.b)([(0,p.P)()],O.prototype,"uniqueId",void 0);var L=A(14003),i=A(12592);class H{constructor(y){this.onEventTriggeredObservable=new w.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=y,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.zc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const y=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",EA:{timeSinceStart:this._startingTime,deltaTime:y}}),this._startingTime+=y})),this._meshPickedObserver=this._scene.onPointerObservable.add((y=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",EA:y})}),i.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((y=>{const c=y.pointerId,A=y.mesh,l=this._pointerUnderMeshState[c];!l&&A?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",EA:{pointerId:c,mesh:A}}):l&&!A?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",EA:{pointerId:c,mesh:l}}):l&&A&&l!==A&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",EA:{pointerId:c,mesh:l,over:A}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",EA:{pointerId:c,mesh:A,out:l}})),this._pointerUnderMeshState[c]=A}),i.c.POINTERMOVE)}dispose(){var y,c,A,l,w;null===(y=this._sceneDisposeObserver)||void 0===y||y.remove(),null===(c=this._sceneReadyObserver)||void 0===c||c.remove(),null===(A=this._sceneOnBeforeRenderObserver)||void 0===A||A.remove(),null===(l=this._meshPickedObserver)||void 0===l||l.remove(),null===(w=this._meshUnderPointerObserver)||void 0===w||w.remove(),this.onEventTriggeredObservable.clear()}}var P,D=A(14021);!function(y){y[y.Stopped=0]="Stopped",y[y.Started=1]="Started"}(P||(P={}));class t{get state(){return this._state}set state(y){this._state=y,this.onStateChangedObservable.notifyObservers(y)}constructor(y){this.onStateChangedObservable=new w.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=y.Fc,this._sceneEventCoordinator=new H(this._scene),this._coordinator=y.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((y=>{for(const c of this._executionContexts){const A=this._getContextualOrder(y.type,c);for(const l of A)if(!l._executeEvent(c,y.EA))break}switch(y.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const c of this._executionContexts)c._notifyOnTick(y.EA);break;case"SceneDispose":this.dispose()}}))}createContext(){const y=new O({Fc:this._scene,coordinator:this._coordinator});return this._executionContexts.push(y),y}getContext(y){return this._executionContexts[y]}addEventBlock(y){if("PointerOver"!==y.type&&"PointerOut"!==y.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==y.type&&this._eventBlocks[y.type].push(y),1===this.state)for(const c of this._executionContexts)y._startPendingTasks(c);else this.onStateChangedObservable.addOnce((c=>{if(1===c)for(const A of this._executionContexts)y._startPendingTasks(A)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((y=>{1===y&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const y of this._executionContexts)for(const c in this._eventBlocks){const A=this._getContextualOrder(c,y);for(const c of A)c._startPendingTasks(y)}}_getContextualOrder(y,c){const A=this._eventBlocks[y].sort(((y,c)=>c.initPriority-y.initPriority));if("MeshPick"===y){const y=[];for(const l of A){const w=l.asset.getValue(c);let N=0;for(;N<A.length;N++){const y=A[N].asset.getValue(c);if(w&&y&&(0,D.i)(w,y))break}y.splice(N,0,l)}return y}return A}dispose(){var y;if(0!==this.state){this.state=0;for(const y of this._executionContexts)y._clearPendingBlocks();this._executionContexts.length=0;for(const y in this._eventBlocks)this._eventBlocks[y].length=0;null===(y=this._eventObserver)||void 0===y||y.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(y){const c=[],A=new Set;for(const l in this._eventBlocks)for(const y of this._eventBlocks[l])c.push(y),A.add(y.uniqueId);for(;c.length>0;){const l=c.pop();y(l);for(const y of l.dataInputs)for(const l of y._connectedPoint)A.has(l._ownerBlock.uniqueId)||(c.push(l._ownerBlock),A.add(l._ownerBlock.uniqueId));if(l instanceof L.c)for(const y of l.signalOutputs)for(const l of y._connectedPoint)A.has(l._ownerBlock.uniqueId)||(c.push(l._ownerBlock),A.add(l._ownerBlock.uniqueId))}}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;y.allBlocks=[],this.visitAllBlocks((c=>{const A={};c.serialize(A),y.allBlocks.push(A)})),y.executionContexts=[];for(const A of this._executionContexts){const l={};A.serialize(l,c),y.executionContexts.push(l)}}}class s{constructor(y){this.config=y,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Fc.zc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Fc.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const y=this._executeOnNextFrame.slice(0);if(y.length)for(const c of y){this.notifyCustomEvent(c.id,c.data,!1);const y=this._executeOnNextFrame.findIndex((y=>y.uniqueId===c.uniqueId));-1!==y&&this._executeOnNextFrame.splice(y,1)}}));(s.SceneCoordinators.get(this.config.Fc)??[]).push(this)}createGraph(){const y=new t({Fc:this.config.Fc,coordinator:this});return this._flowGraphs.push(y),y}removeGraph(y){const c=this._flowGraphs.indexOf(y);-1!==c&&(y.dispose(),this._flowGraphs.splice(c,1))}start(){for(const y of this._flowGraphs)y.start()}dispose(){var y,c;for(const w of this._flowGraphs)w.dispose();this._flowGraphs.length=0,null===(y=this._disposeObserver)||void 0===y||y.remove(),null===(c=this._onBeforeRenderObserver)||void 0===c||c.remove();const A=s.SceneCoordinators.get(this.config.Fc)??[],l=A.indexOf(this);-1!==l&&A.splice(l,1)}serialize(y,c){y._flowGraphs=[];for(const A of this._flowGraphs){const l={};A.serialize(l,c),y._flowGraphs.push(l)}y.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(y){let c=this._customEventsMap.get(y);return c||(c=new w.d,this._customEventsMap.set(y,c)),c}notifyCustomEvent(y,c){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:y,data:c,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(y)){const c=this._eventExecutionCounter.get(y);if(this._eventExecutionCounter.set(y,c+1),c>=s.MaxEventTypeExecutionPerFrame)return void(c===s.MaxEventTypeExecutionPerFrame&&q.c.Warn(`FlowGraphCoordinator: Too many executions of event "${y}".`))}else this._eventExecutionCounter.set(y,1);const A=this._customEventsMap.get(y);A&&A.notifyObservers(c)}}s.MaxEventsPerType=30,s.MaxEventTypeExecutionPerFrame=30,s.SceneCoordinators=new Map},14023:(y,c,A)=>{"use strict";A.d(c,{b:()=>w});var l=A(14029);class w extends l.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(y){y._notifyExecuteNode(this),this.done._activateSignal(y)}}},14003:(y,c,A)=>{"use strict";A.d(c,{c:()=>W});var l=A(14010),w=A(14016),N=A(12283);class p extends w.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(y){super.connectTo(y),this._connectedPoint.sort(((y,c)=>c.priority-y.priority))}_activateSignal(y){var c;if(null===(c=y.logger)||void 0===c||c.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,EA:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(y,this),y._increaseExecutionId();else for(const A of this._connectedPoint)A._activateSignal(y)}}(0,N.f)("FlowGraphSignalConnection",p);class W extends l.e{constructor(y){super(y),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(y){const c=new p(y,0,this);return this.signalInputs.push(c),c}_registerSignalOutput(y){const c=new p(y,1,this);return this.signalOutputs.push(c),c}_unregisterSignalInput(y){const c=this.signalInputs.findIndex((c=>c.name===y));-1!==c&&(this.signalInputs[c].dispose(),this.signalInputs.splice(c,1))}_unregisterSignalOutput(y){const c=this.signalOutputs.findIndex((c=>c.name===y));-1!==c&&(this.signalOutputs[c].dispose(),this.signalOutputs.splice(c,1))}_reportError(y,c){this.error.EA="string"===typeof c?new Error(c):c,this.error._activateSignal(y)}getSignalInput(y){return this.signalInputs.find((c=>c.name===y))}getSignalOutput(y){return this.signalOutputs.find((c=>c.name===y))}serialize(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(y),y.signalInputs=[],y.signalOutputs=[];for(const c of this.signalInputs){const A={};c.serialize(A),y.signalInputs.push(A)}for(const c of this.signalOutputs){const A={};c.serialize(A),y.signalOutputs.push(A)}}deserialize(y){for(let c=0;c<y.signalInputs.length;c++){const A=this.getSignalInput(y.signalInputs[c].name);if(!A)throw new Error("Could not find signal input with name "+y.signalInputs[c].name+" in block "+y.className);A.deserialize(y.signalInputs[c])}for(let c=0;c<y.signalOutputs.length;c++){const A=this.getSignalOutput(y.signalOutputs[c].name);if(!A)throw new Error("Could not find signal output with name "+y.signalOutputs[c].name+" in block "+y.className);A.deserialize(y.signalOutputs[c])}}getClassName(){return"FlowGraphExecutionBlock"}}},14036:(y,c,A)=>{"use strict";A.d(c,{e:()=>w});var l=A(14003);class w extends l.c{constructor(y){super(y),this.out=this._registerSignalOutput("out")}}},13993:(y,c,A)=>{"use strict";A.d(c,{A:()=>q,E:()=>L,H:()=>i,K:()=>H,O:()=>T,R:()=>z,S:()=>my,U:()=>K,e:()=>I,f:()=>O,j:()=>C,m:()=>P,o:()=>D,p:()=>t,s:()=>o,w:()=>X});var l,w=A(12325),N=A(12375),p=A(13986),W=A(13995);!function(y){y.Any="any",y.String="string",y.Number="number",y.Boolean="boolean",y.Object="object",y.Integer="FlowGraphInteger",y.Vector2="Vector2",y.gc="gc",y.Vector4="Vector4",y.Quaternion="Quaternion",y.Matrix="Matrix",y.Matrix2D="Matrix2D",y.Matrix3D="Matrix3D",y.dc="dc",y.ip="ip"}(l||(l={}));class h{constructor(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=y,this.defaultValue=c,this.animationType=A}serialize(y){y.typeName=this.typeName,y.defaultValue=this.defaultValue}}const I=new h("any",void 0),q=new h("string",""),o=new h("number",0,0),O=new h("boolean",!1),L=new h("Vector2",w.Vector2.Zero(),5),i=new h("gc",w.gc.Zero(),1),H=new h("Vector4",w.Vector4.Zero()),P=new h("Matrix",w.Matrix.Identity(),3),D=new h("Matrix2D",new W.d),t=new h("Matrix3D",new W.f),s=new h("dc",N.dc.Black(),4),B=new h("ip",new N.ip(0,0,0,0),7),X=new h("Quaternion",w.Quaternion.Identity(),2);X.typeTransformer=y=>{if(y.getClassName){if("Vector4"===y.getClassName())return w.Quaternion.yA(y.fc());if("gc"===y.getClassName())return w.Quaternion.FromEulerVector(y);if("Matrix"===y.getClassName())return w.Quaternion.FromRotationMatrix(y)}return y};const C=new h("FlowGraphInteger",new p.b(0),0);function K(y){const c=y;switch(typeof y){case"string":return q;case"number":return o;case"boolean":return O;case"object":if(c.getClassName)switch(c.getClassName()){case"Vector2":return L;case"gc":return i;case"Vector4":return H;case"Matrix":return P;case"dc":return s;case"ip":return B;case"Quaternion":return X;case"FlowGraphInteger":return C;case"Matrix2D":return D;case"Matrix3D":return t}return I;default:return I}}function my(y){switch(y){case"string":return q;case"number":return o;case"boolean":return O;case"Vector2":return L;case"gc":return i;case"Vector4":return H;case"Matrix":return P;case"dc":return s;case"ip":return B;case"Quaternion":return X;case"FlowGraphInteger":return C;case"Matrix2D":return D;case"Matrix3D":return t;default:return I}}function T(y){switch(y){case"number":default:return 0;case"Vector2":return 5;case"gc":return 1;case"Matrix":return 3;case"dc":return 4;case"ip":return 7;case"Quaternion":return 2}}function z(y){switch(y){case 0:return o;case 5:return L;case 1:return i;case 3:return P;case 4:return s;case 7:return B;case 2:return X;default:return I}}},13980:(y,c,A)=>{"use strict";A.d(c,{b:()=>q,c:()=>I,g:()=>o});var l=A(12375),w=A(12325),N=A(13986),p=A(13993),W=A(13995);function h(y){return"Vector2"===y||"gc"===y||"Vector4"===y||"Quaternion"===y||"dc"===y||"ip"===y}function I(y,c,A){var l;const w=(null===c||void 0===c||null===(l=c.getClassName)||void 0===l?void 0:l.call(c))??"";if(h(w)||function(y){return"Matrix"===y||"Matrix2D"===y||"Matrix3D"===y}(w))A[y]={value:c.fc(),className:w};else if("FlowGraphInteger"===w)A[y]={value:c.value,className:w};else if(w&&(c.id||c.name))A[y]={id:c.id,name:c.name,className:w};else{if("object"===typeof c)throw new Error(`Could not serialize value ${c}`);A[y]=c}}function q(y,c,A,I){const o=c[y];let O;const L=(null===o||void 0===o?void 0:o.type)??(null===o||void 0===o?void 0:o.className);if(function(y){return"Mesh"===y||"AbstractMesh"===y||"GroundMesh"===y||"InstanceMesh"===y||"LinesMesh"===y||"GoldbergMesh"===y||"GreasedLineMesh"===y||"TrailMesh"===y}(L)){let y=I.meshes.filter((y=>o.id?y.id===o.id:y.name===o.name));0===y.length&&(y=I.transformNodes.filter((y=>o.id?y.id===o.id:y.name===o.name))),O=o.uniqueId?y.find((y=>y.uniqueId===o.uniqueId)):y[0]}else if(h(L))O=function(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===y)return w.Vector2.yA(c);if("gc"===y)return A&&(c[2]*=-1),w.gc.yA(c);if("Vector4"===y)return w.Vector4.yA(c);if("Quaternion"===y)return A&&(c[2]*=-1,c[3]*=-1),w.Quaternion.yA(c);if("dc"===y)return new l.dc(c[0],c[1],c[2]);if("ip"===y)return new l.ip(c[0],c[1],c[2],c[3]);throw new Error(`Unknown vector class name ${y}`)}(L,o.value);else if(function(y){return"AnimationGroup"===y}(L)){const y=I.animationGroups.filter((y=>y.name===o.name));O=1===y.length?y[0]:y.find((y=>y.uniqueId===o.uniqueId))}else O="Matrix"===L?w.Matrix.yA(o.value):"Matrix2D"===L?new W.d(o.value):"Matrix3D"===L?new W.f(o.value):"FlowGraphInteger"===L?N.b.FromValue(o.value):"number"===L||"string"===L||"boolean"===L?o.value[0]:o&&void 0!==o.value?o.value:Array.isArray(o)?o.reduce(((y,c)=>c.eventData?(y[c.id]={type:(0,p.S)(c.type)},"undefined"!==typeof c.value&&(y[c.id].value=q("value",c,A,I)),y):y),{}):o;return O}function o(y){return"FlowGraphJsonPointerParserBlock"===y}},14021:(y,c,A)=>{"use strict";function l(y,c){return!(!y.parent||y.parent!==c&&!l(y.parent,c))}function w(y){if(y.getClassName)return y.getClassName()}function N(y,c){return y===c&&("Vector2"===y||"gc"===y||"Vector4"===y||"Quaternion"===y)}function p(y,c){return y===c&&("Matrix"===y||"Matrix2D"===y||"Matrix3D"===y)}function W(y,c){return"FlowGraphInteger"===y&&"FlowGraphInteger"===c}function h(y,c){const A="number"===typeof y||"number"===typeof(null===y||void 0===y?void 0:y.value);return A&&!c?!isNaN(I(y)):A}function I(y){return"number"===typeof y?y:y.value}A.d(c,{b:()=>W,c:()=>p,d:()=>N,g:()=>w,i:()=>l,j:()=>I,l:()=>h})},13379:(y,c,A)=>{"use strict";A.r(c),A.d(c,{SceneInstrumentation:()=>N});var l=A(12144),w=A(12536);class N{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(y){y!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=y,y?(this._onBeforeActiveMeshesEvaluationObserver=this.Fc.onBeforeActiveMeshesEvaluationObservable.add((()=>{l.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Fc.onAfterActiveMeshesEvaluationObservable.add((()=>{l.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Fc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Fc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(y){y!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=y,y?(this._onBeforeRenderTargetsRenderObserver=this.Fc.onBeforeRenderTargetsRenderObservable.add((()=>{l.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Fc.onAfterRenderTargetsRenderObservable.add((()=>{l.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Fc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Fc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(y){y!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=y,y?(this._onBeforeParticlesRenderingObserver=this.Fc.onBeforeParticlesRenderingObservable.add((()=>{l.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Fc.onAfterParticlesRenderingObservable.add((()=>{l.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Fc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Fc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(y){y!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=y,this.Fc.spriteManagers&&(y?(this._onBeforeSpritesRenderingObserver=this.Fc.onBeforeSpritesRenderingObservable.add((()=>{l.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Fc.onAfterSpritesRenderingObservable.add((()=>{l.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Fc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Fc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(y){y!==this._capturePhysicsTime&&this.Fc.onBeforePhysicsObservable&&(this._capturePhysicsTime=y,y?(this._onBeforePhysicsObserver=this.Fc.onBeforePhysicsObservable.add((()=>{l.Tools.StartPerformanceCounter("Hh"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Fc.onAfterPhysicsObservable.add((()=>{l.Tools.EndPerformanceCounter("Hh"),this._physicsTime.endMonitoring()}))):(this.Fc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Fc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(y){y!==this._captureAnimationsTime&&(this._captureAnimationsTime=y,y?this._onAfterAnimationsObserver=this.Fc.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Fc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(y){this._captureFrameTime=y}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(y){this._captureInterFrameTime=y}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(y){y!==this._captureRenderTime&&(this._captureRenderTime=y,y?(this._onBeforeDrawPhaseObserver=this.Fc.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),l.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Fc.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),l.Tools.EndPerformanceCounter("Main render")}))):(this.Fc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Fc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(y){y!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=y,y?(this._onBeforeCameraRenderObserver=this.Fc.onBeforeCameraRenderObservable.add((y=>{this._cameraRenderTime.beginMonitoring(),l.Tools.StartPerformanceCounter(`Rendering camera ${y.name}`)})),this._onAfterCameraRenderObserver=this.Fc.onAfterCameraRenderObservable.add((y=>{this._cameraRenderTime.endMonitoring(!1),l.Tools.EndPerformanceCounter(`Rendering camera ${y.name}`)}))):(this.Fc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Fc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Fc.getEngine()._drawCalls}constructor(y){this.Fc=y,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new w.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new w.d,this._captureFrameTime=!1,this._frameTime=new w.d,this._captureRenderTime=!1,this._renderTime=new w.d,this._captureInterFrameTime=!1,this._interFrameTime=new w.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new w.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new w.d,this._capturePhysicsTime=!1,this._physicsTime=new w.d,this._captureAnimationsTime=!1,this._animationsTime=new w.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new w.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=y.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(l.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Fc.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=y.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(l.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Tc(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Tc(),this._captureParticlesRenderTime&&this._particlesRenderTime.Tc(),this._captureSpritesRenderTime&&this._spritesRenderTime.Tc(),this._captureRenderTime&&this._renderTime.Tc(),this._captureCameraRenderTime&&this._cameraRenderTime.Tc()}))}dispose(){this._disposed||(this.Fc.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Fc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Fc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Fc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Fc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Fc.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Fc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Fc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Fc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Fc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Fc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Fc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Fc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Fc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Fc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Fc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Fc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Fc=null,this._disposed=!0)}}},13964:(y,c,A)=>{"use strict";A.d(c,{b:()=>q});var l=A(12307),w=A(12310),N=A(12325),p=A(12743),W=A(12860),h=A(12915),I=A(12283);p.b.AddNodeConstructor("Light_Type_1",((y,c)=>()=>new q(y,N.gc.Zero(),c)));class q extends h.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(y){this._shadowFrustumSize=y,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(y){this._shadowOrthoScale=y,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(y){this._orthoLeft=y}get orthoRight(){return this._orthoRight}set orthoRight(y){this._orthoRight=y}get orthoTop(){return this._orthoTop}set orthoTop(y){this._orthoTop=y}get orthoBottom(){return this._orthoBottom}set orthoBottom(y){this._orthoBottom=y}constructor(y,c,A){super(y,A),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=c.scale(-1),this.direction=c}getClassName(){return"Ph"}getTypeID(){return W.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(y,c,A){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(y):this._setDefaultAutoExtendShadowProjectionMatrix(y,c,A)}_setDefaultFixedFrustumShadowProjectionMatrix(y){const c=this.mc().activeCamera;c&&N.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:c.ec,void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,y,this.mc().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(y,c,A){const l=this.mc().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const y=N.gc.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let l=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let p=0;p<A.length;p++){const W=A[p];if(!W)continue;const h=W.getBoundingInfo().boundingBox;for(let A=0;A<h.vectorsWorld.length;A++)N.gc.TransformCoordinatesToRef(h.vectorsWorld[A],c,y),y.x<this._orthoLeft&&(this._orthoLeft=y.x),y.y<this._orthoBottom&&(this._orthoBottom=y.y),y.x>this._orthoRight&&(this._orthoRight=y.x),y.y>this._orthoTop&&(this._orthoTop=y.y),this.autoCalcShadowZBounds&&(y.z<l&&(l=y.z),y.z>w&&(w=y.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=l,this._shadowMaxZ=w)}const w=this._orthoRight-this._orthoLeft,p=this._orthoTop-this._orthoBottom,W=void 0!==this.shadowMinZ?this.shadowMinZ:(null===l||void 0===l?void 0:l.ec)||0,h=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===l||void 0===l?void 0:l.maxZ)||1e4,I=this.mc().getEngine().Xc;N.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-w*this.shadowOrthoScale,this._orthoRight+w*this.shadowOrthoScale,this._orthoBottom-p*this.shadowOrthoScale,this._orthoTop+p*this.shadowOrthoScale,I?h:W,I?W:h,y,this.mc().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(y,c){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,c),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,c),this)}transferToNodeMaterialEffect(y,c){return this.computeTransformedInformation()?(y.setFloat3(c,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(y.setFloat3(c,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(y){const c=this._scene.getEngine();return!c.Xc&&c.isNDCHalfZRange?0:1}getDepthMaxZ(y){const c=this._scene.getEngine();return c.Xc&&c.isNDCHalfZRange?0:1}prepareLightSpecificDefines(y,c){y["DIRLIGHT"+c]=!0}}(0,l.b)([(0,w.P)()],q.prototype,"shadowFrustumSize",null),(0,l.b)([(0,w.P)()],q.prototype,"shadowOrthoScale",null),(0,l.b)([(0,w.P)()],q.prototype,"autoUpdateExtends",void 0),(0,l.b)([(0,w.P)()],q.prototype,"autoCalcShadowZBounds",void 0),(0,l.b)([(0,w.P)("orthoLeft")],q.prototype,"_orthoLeft",void 0),(0,l.b)([(0,w.P)("orthoRight")],q.prototype,"_orthoRight",void 0),(0,l.b)([(0,w.P)("orthoTop")],q.prototype,"_orthoTop",void 0),(0,l.b)([(0,w.P)("orthoBottom")],q.prototype,"_orthoBottom",void 0),(0,I.f)("BABYLON.DirectionalLight",q)},14479:(y,c,A)=>{"use strict";A.d(c,{e:()=>q});var l=A(12307),w=A(12310),N=A(12325),p=A(12375),W=A(12743),h=A(12860),I=A(12283);W.b.AddNodeConstructor("Light_Type_3",((y,c)=>()=>new q(y,N.gc.Zero(),c)));class q extends h.b{constructor(y,c,A){super(y,A),this.groundColor=new p.dc(0,0,0),this.direction=c||N.gc.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"th"}setDirectionToTarget(y){return this.direction=N.gc.Normalize(y.xc(N.gc.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(y,c){const A=N.gc.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",A.x,A.y,A.z,0,c),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.JW),c),this}transferToNodeMaterialEffect(y,c){const A=N.gc.Normalize(this.direction);return y.setFloat3(c,A.x,A.y,A.z),this}Yc(){return this._worldMatrix||(this._worldMatrix=N.Matrix.Identity()),this._worldMatrix}getTypeID(){return h.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(y,c){y["HEMILIGHT"+c]=!0}}(0,l.b)([(0,w.l)()],q.prototype,"groundColor",void 0),(0,l.b)([(0,w.M)()],q.prototype,"direction",void 0),(0,I.f)("BABYLON.HemisphericLight",q)},13934:(y,c,A)=>{"use strict";A.d(c,{e:()=>o});var l=A(12307),w=A(12310),N=A(12325),p=A(12743),W=A(12860),h=A(12915),I=A(12303),q=A(12283);p.b.AddNodeConstructor("Light_Type_2",((y,c)=>()=>new o(y,N.gc.Zero(),N.gc.Zero(),0,0,c)));class o extends h.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(y){this._iesProfileTexture!==y&&(this._iesProfileTexture=y,this._iesProfileTexture&&o._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(y){this._angle=y,this._cosHalfAngle=Math.cos(.5*y),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(y){this._innerAngle=y,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(y){this._shadowAngleScale=y,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(y){this._projectionTextureLightNear=y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(y){this._projectionTextureLightFar=y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(y){this._projectionTextureUpDirection=y,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(y){this._projectionTexture!==y&&(this._projectionTexture=y,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(o._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):o._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(y){return void 0!==y.onGeneratedObservable}static _IsTexture(y){return void 0!==y.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(y){this._projectionTextureProjectionLightMatrix=y,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(y,c,A,l,w,p){super(y,p),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=N.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=N.gc.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=N.gc.Zero(),this._projectionTextureViewLightMatrix=N.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=N.Matrix.Zero(),this._projectionTextureScalingMatrix=N.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=c,this.direction=A,this.angle=l,this.exponent=w}getClassName(){return"SpotLight"}getTypeID(){return W.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(y){super._setDirection(y),this._projectionTextureViewLightDirty=!0}_setPosition(y){super._setPosition(y),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(y,c,A){const l=this.mc().activeCamera;if(!l)return;this._shadowAngleScale=this._shadowAngleScale||1;const w=this._shadowAngleScale*this._angle,p=void 0!==this.shadowMinZ?this.shadowMinZ:l.ec,W=void 0!==this.shadowMaxZ?this.shadowMaxZ:l.maxZ,h=this.mc().getEngine().Xc;N.Matrix.PerspectiveFovLHToRef(w,1,h?W:p,h?p:W,y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,h)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),N.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const y=this.projectionTextureLightFar,c=this.projectionTextureLightNear,A=y/(y-c),l=-A*c,w=1/Math.tan(this._angle/2);N.Matrix.FromValuesToRef(w/1,0,0,0,0,w,0,0,0,0,A,1,0,0,l,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof I.d){const y=this._projectionTexture.uScale/2,c=this._projectionTexture.vScale/2;N.Matrix.FromValuesToRef(y,0,0,0,0,c,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(y,c){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),y.setMatrix("textureProjectionMatrix"+c,this._projectionTextureMatrix),y.setTexture("projectionLightTexture"+c,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&y.setTexture("iesLightTexture"+c,this._iesProfileTexture),this}transferToEffect(y,c){let A;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,c),A=N.gc.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,c),A=N.gc.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",A.x,A.y,A.z,this._cosHalfAngle,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,c),this}transferToNodeMaterialEffect(y,c){let A;return A=this.computeTransformedInformation()?N.gc.Normalize(this.transformedDirection):N.gc.Normalize(this.direction),this.mc().useRightHandedSystem?y.setFloat3(c,-A.x,-A.y,-A.z):y.setFloat3(c,A.x,A.y,A.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(y){const c=this._scene.getEngine(),A=void 0!==this.shadowMinZ?this.shadowMinZ:(null===y||void 0===y?void 0:y.ec)??0;return c.Xc&&c.isNDCHalfZRange?A:this._scene.getEngine().isNDCHalfZRange?0:A}getDepthMaxZ(y){const c=this._scene.getEngine(),A=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===y||void 0===y?void 0:y.maxZ)??1e4;return c.Xc&&c.isNDCHalfZRange?0:A}prepareLightSpecificDefines(y,c){y["SPOTLIGHT"+c]=!0,y["PROJECTEDLIGHTTEXTURE"+c]=!(!this.projectionTexture||!this.projectionTexture.isReady()),y["IESLIGHTTEXTURE"+c]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,l.b)([(0,w.P)()],o.prototype,"angle",null),(0,l.b)([(0,w.P)()],o.prototype,"innerAngle",null),(0,l.b)([(0,w.P)()],o.prototype,"shadowAngleScale",null),(0,l.b)([(0,w.P)()],o.prototype,"exponent",void 0),(0,l.b)([(0,w.P)()],o.prototype,"projectionTextureLightNear",null),(0,l.b)([(0,w.P)()],o.prototype,"projectionTextureLightFar",null),(0,l.b)([(0,w.P)()],o.prototype,"projectionTextureUpDirection",null),(0,l.b)([(0,w.F)("projectedLightTexture")],o.prototype,"_projectionTexture",void 0),(0,q.f)("BABYLON.SpotLight",o)},13643:(y,c,A)=>{"use strict";A.d(c,{b:()=>p,d:()=>N,f:()=>W});const l={},w={};function N(y,c){l[y]=c}function p(y,c){w[y]=c}function W(y){return w[y]?w[y]:null}},13558:(y,c,A)=>{"use strict";A.d(c,{b:()=>K,d:()=>f});var l,w=A(12144),N=A(12153),p=A(12553),W=A(12184),h=A(12161),I=A(12788),q=A(12191),o=A(12193),O=A(12287),L=A(12220),i=A(12182);!function(y){y[y.Clean=0]="Clean",y[y.Stop=1]="Stop",y[y.Sync=2]="Sync",y[y.NoSync=3]="NoSync"}(l||(l={}));const H=new N.d,P={};let D=!1;function t(){return P[".babylon"]}function s(y,c){const A=P[y];return A||(h.c.Warn("Unable to find a plugin to load "+y+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),c?t():void 0)}function B(y,c,A){let l="Unable to load from "+(y.rawData?"binary data":y.url);return c?l+=`: ${c}`:A&&(l+=`: ${A}`),l}async function X(y,c,A,l,w,N,p,W,h){var I;const o="data:"===(O=y.url).substring(0,5)?O.substring(5):null;var O;if(y.rawData&&!p)throw"When using ArrayBufferView to load data the file extension must be provided.";const D=o||p?"":function(y){const c=y.indexOf("?");-1!==c&&(y=y.substring(0,c));const A=y.lastIndexOf(".");return y.substring(A,y.length).toLowerCase()}(y.url);let B=p?s(p,!0):o?function(y){for(const c in P){const A=P[c].plugin;if(A.canDirectLoad&&A.canDirectLoad(y))return P[c]}return t()}(y.url):s(D,!1);if(!B&&D){if(y.url&&!y.url.startsWith("blob:")){const c=await async function(y,c){const A=c.method||"GET";return await new Promise(((l,w)=>{const N=new i.d;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const y={};if(c.responseHeaders)for(const A of c.responseHeaders)y[A]=N.getResponseHeader(A)||"";l({response:N.response,headerValues:y})}else w(`Unable to fetch data from ${y}. Error code: ${N.status}`)})),N.open(A,y),N.send()}))}(y.url,{method:"HEAD",responseHeaders:["Content-Type"]}),A=c.headerValues?c.headerValues["Content-Type"]:"";A&&(B=function(y){for(const c in P){const A=P[c];if(A.mimeType===y)return A}}(A))}B||(B=t())}if(!B)throw new Error(`No plugin or fallback for ${p??y.url}`);if(!1===(null===h||void 0===h||null===(I=h[B.plugin.name])||void 0===I?void 0:I.enabled))throw new Error(`The '${B.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(y.rawData&&!B.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(y=>{if(B.plugin.createPlugin){const c=B.plugin.createPlugin(h??{});return c instanceof Promise?(c.then(y).catch((y=>{w("Error instantiating plugin.",y)})),null):(y(c),c)}return y(B.plugin),B.plugin})((h=>{var I;if(!h)throw`The loader plugin corresponding to the '${p}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(H.notifyObservers(h),o&&(h.canDirectLoad&&h.canDirectLoad(y.url)||!(0,q.o)(y.url))){if(h.directLoad){const y=h.directLoad(c,o);y instanceof Promise?y.then((y=>{A(h,y)})).catch((y=>{w("Error in directLoad of _loadData: "+y,y)})):A(h,y)}else A(h,o);return}const O=B.isBinary,i=(y,l)=>{c.I?w("Scene has been disposed"):A(h,y,l)};let P=null,D=!1;null===(I=h.zc)||void 0===I||I.add((()=>{D=!0,P&&(P.abort(),P=null),N()}));const t=()=>{if(D)return;const A=(y,c)=>{w(null===y||void 0===y?void 0:y.statusText,c)};if(!h.loadFile&&y.rawData)throw"Plugin does not support loading ArrayBufferView.";P=h.loadFile?h.loadFile(c,y.rawData||y.file||y.url,y.rootUrl,i,l,O,A,W):c._loadFile(y.file||y.url,i,l,!0,O,A)},s=c.getEngine();let X=s.enableOfflineSupport;if(X){let A=!1;for(const l of c.disableOfflineSupportExceptionRules)if(l.test(y.url)){A=!0;break}X=!A}X&&L.b.OfflineProviderFactory?c.offlineProvider=L.b.OfflineProviderFactory(y.url,t,s.disableManifestCheck):t()}))}function C(y,c){let A,l,N=null,p=null;if(c)if(c.name)A=`file:${c.name}`,l=c.name,N=c;else if(ArrayBuffer.isView(c))A="",l=(0,O.e)(),p=c;else if(c.startsWith("data:"))A=c,l="";else if(y){const N=c;if("/"===N.substring(0,1))return w.Tools.Error("Wrong sceneFilename parameter"),null;A=y+N,l=N}else A=c,l=w.Tools.GetFilename(c),y=w.Tools.GetFolderPath(c);else A=y,l=w.Tools.GetFilename(y),y=w.Tools.GetFolderPath(y);return{url:A,rootUrl:y,name:l,file:N,rawData:p}}function K(y){if("string"===typeof y.extensions){const c=y.extensions;P[c.toLowerCase()]={plugin:y,isBinary:!1}}else{const c=y.extensions,A=Object.keys(c);for(const l of A)P[l.toLowerCase()]={plugin:y,isBinary:c[l].isBinary,mimeType:c[l].mimeType}}}async function my(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:W.c.LastCreatedScene,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!l)return h.c.Error("No scene available to import mesh to"),null;const L=C(c,A);if(!L)return null;const i={};l.addPendingData(i);const H=()=>{l.removePendingData(i)},P=(y,c)=>{const A=B(L,y,c);p?p(l,A,new o.f(A,o.d.SceneLoaderError,c)):h.c.Error(A),H()},D=N?y=>{try{N(y)}catch(c){P("Error in onProgress callback: "+c,c)}}:void 0,t=(y,c,A,N,p,W,h,I)=>{if(l.importedMeshesFiles.push(L.url),w)try{w(y,c,A,N,p,W,h,I)}catch(q){P("Error in onSuccess callback: "+q,q)}l.removePendingData(i)};return await X(L,l,((c,A,w)=>{if(c.rewriteRootURL&&(L.rootUrl=c.rewriteRootURL(L.rootUrl,w)),c.importMesh){const w=[],N=[],p=[];if(!c.importMesh(y,l,A,L.rootUrl,w,N,p,P))return;l.loadingPluginName=c.name,t(w,N,p,[],[],[],[],[])}else{c.importMeshAsync(y,l,A,L.rootUrl,D,L.name).then((y=>{l.loadingPluginName=c.name,t(y.meshes,y.MO,y.skeletons,y.animationGroups,y.transformNodes,y.geometries,y.lights,y.spriteManagers)})).catch((y=>{P(y.message,y)}))}}),D,P,H,I,q,O)}async function T(y,c,A,l,w,N,p,W){return await new Promise(((h,I)=>{try{my(y,c,A,l,((y,c,A,l,w,N,p,W)=>{h({meshes:y,MO:c,skeletons:A,animationGroups:l,transformNodes:w,geometries:N,lights:p,spriteManagers:W})}),w,((y,c,A)=>{I(A||new Error(c))}),N,p,W).catch(I)}catch(o){I(o)}}))}async function z(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.c.LastCreatedEngine,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};A?await M(y,c,new p.b(A),l,N,h,I,q,o):w.Tools.Error("No engine available")}async function S(y,c,A,l,w,N,p){return await new Promise(((W,h)=>{z(y,c,A,(y=>{W(y)}),l,((y,c,A)=>{h(A||new Error(c))}),w,N,p)}))}async function M(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.c.LastCreatedScene,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",O=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!A)return h.c.Error("No scene available to append to"),null;const L=C(y,c);if(!L)return null;const i={};A.addPendingData(i);const H=()=>{A.removePendingData(i)};I.e.ShowLoadingScreen&&!D&&(D=!0,A.getEngine().displayLoadingUI(),A.executeWhenReady((()=>{A.getEngine().hideLoadingUI(),D=!1})));const P=(y,c)=>{const l=B(L,y,c);N?N(A,l,new o.f(l,o.d.SceneLoaderError,c)):h.c.Error(l),H()},t=w?y=>{try{w(y)}catch(c){P("Error in onProgress callback",c)}}:void 0,s=()=>{if(l)try{l(A)}catch(y){P("Error in onSuccess callback",y)}A.removePendingData(i)};return await X(L,A,((y,c)=>{if(y.load){if(!y.load(A,c,L.rootUrl,P))return;A.loadingPluginName=y.name,s()}else{y.loadAsync(A,c,L.rootUrl,t,L.name).then((()=>{A.loadingPluginName=y.name,s()})).catch((y=>{P(y.message,y)}))}}),t,P,H,p,q,O)}async function k(y,c,A,l,w,N,p){return await new Promise(((W,h)=>{try{M(y,c,A,(y=>{W(y)}),l,((y,c,A)=>{h(A||new Error(c))}),w,N,p).catch(h)}catch(o){h(o)}}))}async function a(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.c.LastCreatedScene,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!A)return h.c.Error("No scene available to load asset container to"),null;const O=C(y,c);if(!O)return null;const L={};A.addPendingData(L);const i=()=>{A.removePendingData(L)},H=(y,c)=>{const l=B(O,y,c);N?N(A,l,new o.f(l,o.d.SceneLoaderError,c)):h.c.Error(l),i()},P=w?y=>{try{w(y)}catch(c){H("Error in onProgress callback",c)}}:void 0,D=y=>{if(l)try{l(y)}catch(c){H("Error in onSuccess callback",c)}A.removePendingData(L)};return await X(O,A,((y,c)=>{if(y.loadAssetContainer){const l=y.loadAssetContainer(A,c,O.rootUrl,H);if(!l)return;l.populateRootNodes(),A.loadingPluginName=y.name,D(l)}else if(y.loadAssetContainerAsync){y.loadAssetContainerAsync(A,c,O.rootUrl,P,O.name).then((c=>{c.populateRootNodes(),A.loadingPluginName=y.name,D(c)})).catch((y=>{H(y.message,y)}))}else H("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),P,H,i,p,I,q)}async function u(y,c,A,l,w,N,p){return await new Promise(((W,h)=>{try{a(y,c,A,(y=>{W(y)}),l,((y,c,A)=>{h(A||new Error(c))}),w,N,p).catch(h)}catch(o){h(o)}}))}async function G(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.c.LastCreatedScene,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,O=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",L=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!A)return void h.c.Error("No scene available to load animations to");if(l){for(const l of A.animatables)l.reset();A.stopAllAnimations();const y=A.animationGroups.slice();for(const A of y)A.dispose();const c=A.getNodes();for(const A of c)A.animations&&(A.animations=[])}else switch(w){case 0:const y=A.animationGroups.slice();for(const c of y)c.dispose();break;case 1:for(const c of A.animationGroups)c.stop();break;case 2:for(const c of A.animationGroups)c.reset(),c.restart();break;case 3:break;default:return void h.c.Error("Unknown animation group loading mode value '"+w+"'")}const i=A.animatables.length;await a(y,c,A,(y=>{y.mergeAnimationsTo(A,A.animatables.slice(i),N),y.dispose(),A.onAnimationFileImportedObservable.notifyObservers(A),p&&p(A)}),I,q,o,O,L)}async function j(y,c,A,l,w,N,p,W,h,I){return await new Promise(((q,O)=>{try{G(y,c,A,l,w,N,(y=>{q(y)}),p,((y,c,A)=>{O(A||new Error(c))}),W,h,I).catch(O)}catch(o){O(o)}}))}class f{static get ForceFullSceneLoadingForIncremental(){return I.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(y){I.e.ForceFullSceneLoadingForIncremental=y}static get ShowLoadingScreen(){return I.e.ShowLoadingScreen}static set ShowLoadingScreen(y){I.e.ShowLoadingScreen=y}static get loggingLevel(){return I.e.loggingLevel}static set loggingLevel(y){I.e.loggingLevel=y}static get CleanBoneMatrixWeights(){return I.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(y){I.e.CleanBoneMatrixWeights=y}static GetDefaultPlugin(){return t()}static GetPluginForExtension(y){var c;return null===(c=s(y,!0))||void 0===c?void 0:c.plugin}static IsPluginForExtensionAvailable(y){return function(y){return!!P[y]}(y)}static RegisterPlugin(y){K(y)}static ImportMesh(y,c,A,l,w,N,p,h,I){my(y,c,A,l,w,N,p,h,I).catch((y=>null===p||void 0===p?void 0:p(W.c.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async ImportMeshAsync(y,c,A,l,w,N,p){return await T(y,c,A,l,w,N,p)}static Load(y,c,A,l,w,N,p,h){z(y,c,A,l,w,N,p,h).catch((y=>null===N||void 0===N?void 0:N(W.c.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async LoadAsync(y,c,A,l,w,N){return await S(y,c,A,l,w,N)}static Append(y,c,A,l,w,N,p,h){M(y,c,A,l,w,N,p,h).catch((y=>null===N||void 0===N?void 0:N(A??W.c.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async AppendAsync(y,c,A,l,w,N){return await k(y,c,A,l,w,N)}static LoadAssetContainer(y,c,A,l,w,N,p,h){a(y,c,A,l,w,N,p,h).catch((y=>null===N||void 0===N?void 0:N(A??W.c.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async LoadAssetContainerAsync(y,c,A,l,w,N){return await u(y,c,A,l,w,N)}static ImportAnimations(y,c,A,l,w,N,p,h,I,q,o){G(y,c,A,l,w,N,p,h,I,q,o).catch((y=>null===I||void 0===I?void 0:I(A??W.c.LastCreatedScene,null===y||void 0===y?void 0:y.message,y)))}static async ImportAnimationsAsync(y,c,A,l,w,N,p,W,h,I,q){return await j(y,c,A,l,w,N,W,I,q)}}f.NO_LOGGING=0,f.MINIMAL_LOGGING=1,f.SUMMARY_LOGGING=2,f.DETAILED_LOGGING=3,f.OnPluginActivatedObservable=H},13952:(y,c,A)=>{"use strict";A.d(c,{e:()=>O});var l=A(12307),w=A(12310),N=A(12144),p=A(12325),W=A(12348),h=A(12303),I=A(12283),q=A(12153),o=A(12363);A(13959);class O extends W.d{set boundingBoxSize(y){if(this._boundingBoxSize&&this._boundingBoxSize.equals(y))return;this._boundingBoxSize=y;const c=this.mc();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(y){this._rotationY=y,this.setReflectionTextureMatrix(p.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(y,c,A){let l="";for(const w of y)l+=w;return new O(l,c,null,A,y)}static CreateFromPrefilteredData(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=c.useDelayedTextureLoading;c.useDelayedTextureLoading=!1;const N=new O(y,c,null,!1,null,null,null,void 0,!0,A,l);return c.useDelayedTextureLoading=w,N}constructor(y,c){var A;let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8],L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,i=arguments.length>10&&void 0!==arguments[10]&&arguments[10],H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,D=arguments.length>13?arguments[13]:void 0,t=arguments.length>14?arguments[14]:void 0;super(c),this.onLoadObservable=new q.d,this.boundingBoxPosition=p.gc.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new p.Matrix,this._buffer=null,this.name=y,this.url=y,this._noMipmap=w,this.Vc=!1,this.isCube=!0,this._textureMatrix=p.Matrix.Identity(),this.coordinatesMode=h.d.CUBIC_MODE;let s=null,B=null;null===l||Array.isArray(l)?(this._noMipmap=w,this._format=o,this._createPolynomials=i,s=l,this._loaderOptions=D,this._useSRGBBuffer=t,this._lodScale=H,this._lodOffset=P):(s=l.extensions??null,this._noMipmap=l.noMipmap??!1,N=l.files??null,B=l.buffer??null,this._format=l.format??5,O=l.prefiltered??!1,L=l.forcedExtension??null,this._createPolynomials=l.createPolynomials??!1,this._lodScale=l.lodScale??.8,this._lodOffset=l.lodOffset??0,this._loaderOptions=l.loaderOptions,this._useSRGBBuffer=l.useSRGBBuffer,W=l.R??null,I=l.onError??null),(y||N)&&this.updateURL(y,L,W,O,I,s,null===(A=this.mc())||void 0===A?void 0:A.useDelayedTextureLoading,N,B)}getClassName(){return"CubeTexture"}updateURL(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=y),this.url=y,c&&(this._forcedExtension=c);const I=y.lastIndexOf("."),q=c||(I>-1?y.substring(I).toLowerCase():""),o=0===q.indexOf(".dds"),O=0===q.indexOf(".env"),L=0===q.indexOf(".basis");if(O?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=l,l&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),W)this._files=W;else if(L||O||o||N||(N=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,N){for(let c=0;c<N.length;c++)this._files.push(y+N[c]);this._extensions=N}this._buffer=h,p?(this.delayLoadState=4,this._delayedOnLoad=A,this._delayedOnError=w):this._loadTexture(A,w)}delayLoad(y){4===this.delayLoadState&&(y&&(this._forcedExtension=y),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(y){var c,A;if(y.updateFlag===this._textureMatrix.updateFlag)return;y.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(A=this.mc())||void 0===A||A.markAllMaterialsAsDirty(1,(y=>-1!==y.getActiveTextures().indexOf(this))));if(this._textureMatrix=y,null===(c=this.mc())||void 0===c||!c.useRightHandedSystem)return;const l=p.TmpVectors.gc[0],w=p.TmpVectors.Quaternion[0],N=p.TmpVectors.gc[1];this._textureMatrix.decompose(l,w,N),w.z*=-1,w.w*=-1,p.Matrix.ComposeToRef(l,w,N,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var y;return null!==(y=this.mc())&&void 0!==y&&y.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=this.mc(),l=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const w=()=>{var c;(this.onLoadObservable.notifyObservers(this),l)&&(l.dispose(),null===(c=this.mc())||void 0===c||c.markAllMaterialsAsDirty(1));y&&y()},p=(y,A)=>{this._loadingError=!0,this._errorObject={message:y,exception:A},c&&c(y,A),h.d.OnTextureLoadErrorObservable.notifyObservers(this)};var W;this._texture?this._texture.isReady?N.Tools.SetImmediate((()=>w())):this._texture.onLoadedObservable.add((()=>w())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,A,this._lodScale,this._lodOffset,y,p,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,A,this._files,this._noMipmap,y,p,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(W=this._texture)||void 0===W||W.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(y,c,A){const l=o.d.Parse((()=>{let l=!1;return y.prefiltered&&(l=y.prefiltered),new O(A+(y.url??y.name),c,y.extensions,!1,y.files||null,null,null,void 0,l,y.forcedExtension)}),y,c);if(y.boundingBoxPosition&&(l.boundingBoxPosition=p.gc.yA(y.boundingBoxPosition)),y.boundingBoxSize&&(l.boundingBoxSize=p.gc.yA(y.boundingBoxSize)),y.animations)for(let w=0;w<y.animations.length;w++){const c=y.animations[w],A=(0,I.d)("BABYLON.Animation");A&&l.animations.push(A.Parse(c))}return l}clone(){let y=0;const c=o.d.Clone((()=>{const c=new O(this.url,this.mc()||this._getEngine(),this._extensions,this._noMipmap,this._files);return y=c.uniqueId,c}),this);return c.uniqueId=y,c}}(0,l.b)([(0,w.P)()],O.prototype,"url",void 0),(0,l.b)([(0,w.M)()],O.prototype,"boundingBoxPosition",void 0),(0,l.b)([(0,w.M)()],O.prototype,"boundingBoxSize",null),(0,l.b)([(0,w.P)("rotationY")],O.prototype,"rotationY",null),(0,l.b)([(0,w.P)("files")],O.prototype,"_files",void 0),(0,l.b)([(0,w.P)("forcedExtension")],O.prototype,"_forcedExtension",void 0),(0,l.b)([(0,w.P)("extensions")],O.prototype,"_extensions",void 0),(0,l.b)([(0,w.w)("textureMatrix")],O.prototype,"_textureMatrix",void 0),(0,l.b)([(0,w.w)("textureMatrixRefraction")],O.prototype,"_textureMatrixRefraction",void 0),h.d._CubeTextureParser=O.Parse,(0,I.f)("BABYLON.CubeTexture",O)},14494:(y,c,A)=>{"use strict";A.d(c,{b:()=>h});var l=A(12161),w=A(12303),N=A(12291),p=A(12458),W=A(12255);p.ThinEngine.prototype.createDynamicTexture=function(y,c,A,l){const w=new W.c(this,4);return w.baseWidth=y,w.baseHeight=c,A&&(y=this.needPOTTextures?(0,N.f)(y,this._caps.maxTextureSize):y,c=this.needPOTTextures?(0,N.f)(c,this._caps.maxTextureSize):c),w.width=y,w.height=c,w.isReady=!1,w.generateMipMaps=A,w.samplingMode=l,this.updateTextureSamplingMode(l,w),this._internalTexturesCache.push(w),w},p.ThinEngine.prototype.updateDynamicTexture=function(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!y)return;const p=this._gl,W=p.TEXTURE_2D,h=this._bindTextureDirectly(W,y,!0,N);this._unpackFlipY(void 0===A?y.invertY:A),l&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const I=this._getWebGLTextureType(y.type),q=this._getInternalFormat(w||y.format),o=this._getRGBABufferInternalSizedFormat(y.type,q);p.texImage2D(W,0,o,q,I,c),y.generateMipMaps&&p.generateMipmap(W),h||this._bindTextureDirectly(W,null),l&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),w&&(y.format=w),y._dynamicTextureSource=c,y._premulAlpha=l,y.invertY=A||!1,y.isReady=!0};class h extends w.d{constructor(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,W=arguments.length>6?arguments[6]:void 0;const h=!A||A._isScene;super(null,h?A:null===A||void 0===A?void 0:A.Fc,h?!l:A,W,N,void 0,void 0,void 0,void 0,p),this.name=y,this.wrapU=w.d.CLAMP_ADDRESSMODE,this.wrapV=w.d.CLAMP_ADDRESSMODE,this._generateMipMaps=l;const I=this._getEngine();if(!I)return;if(c.getContext)this._canvas=c,this._ownCanvas=!1,this._texture=I.createDynamicTexture(this._canvas.width,this._canvas.height,l,N);else{this._canvas=I.createCanvas(1,1),this._ownCanvas=!0;const y=c;y.width||0===y.width?this._texture=I.createDynamicTexture(y.width,y.height,l,N):this._texture=I.createDynamicTexture(c,c,l,N)}const q=this.getSize();this._canvas.width!==q.width&&(this._canvas.width=q.width),this._canvas.height!==q.height&&(this._canvas.height=q.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(y){this._canvas.width=y.width,this._canvas.height=y.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(y.width,y.height,this._generateMipMaps,this.samplingMode)}scale(y){const c=this.getSize();c.width*=y,c.height*=y,this._recreate(c)}scaleTo(y,c){const A=this.getSize();A.width=y,A.height=c,this._recreate(A)}getContext(){return this._context}clear(y){const c=this.getSize();y&&(this._context.fillStyle=y),this._context.clearRect(0,0,c.width,c.height)}update(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===y||y,c,this._format||void 0,void 0,A)}drawText(y,c,A,l,w,N,p){let W=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const h=this.getSize();if(N&&(this._context.fillStyle=N,this._context.fillRect(0,0,h.width,h.height)),this._context.font=l,null===c||void 0===c){const A=this._context.measureText(y);c=(h.width-A.width)/2}if(null===A||void 0===A){const y=parseInt(l.replace(/\D/g,""));A=h.height/2+y/3.65}this._context.fillStyle=w||"",this._context.fillText(y,c,A),W&&this.update(p)}dispose(){var y,c;(super.dispose(),this._ownCanvas)&&(null===(y=this._canvas)||void 0===y||null===(c=y.remove)||void 0===c||c.call(y));this._canvas=null,this._context=null}clone(){const y=this.mc();if(!y)return this;const c=this.getSize(),A=new h(this.name,c,y,this._generateMipMaps);return A.Vc=this.Vc,A.level=this.level,A.wrapU=this.wrapU,A.wrapV=this.wrapV,A}serialize(){const y=this.mc();y&&!y.isReady()&&l.c.Warn("The scene must be ready before serializing the dynamic texture");const c=super.serialize();return h._IsCanvasElement(this._canvas)&&(c.base64String=this._canvas.toDataURL()),c.invertY=this._invertY,c.samplingMode=this.samplingMode,c}static _IsCanvasElement(y){return void 0!==y.toDataURL}_rebuild(){this.update()}}},13860:(y,c,A)=>{"use strict";A.d(c,{d:()=>w});var l=A(12303);class w extends l.d{get depth(){return this._depth}constructor(y,c,A,w,N,p){let W=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],h=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:l.d.TRILINEAR_SAMPLINGMODE,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,o=arguments.length>10?arguments[10]:void 0;super(null,p,!W,h),this.format=N,this._texture=p.getEngine().createRawTexture2DArray(y,c,A,w,N,W,h,I,null,q,o),this._depth=w,this.is2DArray=!0}update(y){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,y,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(y,c,A,l,N){return new w(y,c,A,l,5,N,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13661:(y,c,A)=>{"use strict";A.d(c,{d:()=>W,h:()=>h,l:()=>N,n:()=>p});var l=A(12340),w=A(12325);function N(y,c){return`{X: ${y.x.toFixed(c)} Y: ${y.y.toFixed(c)}}`}function p(y,c){return`{X: ${y._x.toFixed(c)} Y: ${y._y.toFixed(c)} Z: ${y._z.toFixed(c)}}`}function W(y,c){return 2*Math.acos((0,l.Clamp)(w.Quaternion.Dot(y,c)))}function h(y,c){const A=new w.Quaternion;return function(y,c,A){const N=w.gc.Cross(y,c),p=Math.acos((0,l.Clamp)(w.gc.Dot(y,c),-1,1));w.Quaternion.RotationAxisToRef(N,p,A)}(y,c,A),A}},13508:(y,c,A)=>{"use strict";A.d(c,{c:()=>I});var l=A(12325),w=A(12375),N=A(12773),p=A(12758),W=A(12386);A(13516);function h(y){let c=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const A=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],N=[];let h=[];const I=y.width||y.size||1,q=y.height||y.size||1,o=y.depth||y.size||1,O=y.wrap||!1;let L=void 0===y.topBaseAt?1:y.topBaseAt,i=void 0===y.bottomBaseAt?0:y.bottomBaseAt;L=(L+4)%4,i=(i+4)%4;let H=[2,0,3,1][L],P=[2,0,1,3][i],D=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(O){c=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],D=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let y=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],A=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const l=[17,18,19,16],w=[22,23,20,21];for(;H>0;)y.unshift(y.pop()),l.unshift(l.pop()),H--;for(;P>0;)A.unshift(A.pop()),w.unshift(w.pop()),P--;y=y.flat(),A=A.flat(),D=D.concat(y).concat(A),c.push(l[0],l[2],l[3],l[0],l[1],l[2]),c.push(w[0],w[2],w[3],w[0],w[1],w[2])}const t=[I/2,q/2,o/2];h=D.reduce(((y,c,A)=>y.concat(c*t[A%3])),[]);const s=0===y.sideOrientation?0:y.sideOrientation||p.b.DEFAULTSIDE,B=y.faceUV||new Array(6),X=y.faceColors,C=[];for(let p=0;p<6;p++)void 0===B[p]&&(B[p]=new l.Vector4(0,0,1,1)),X&&void 0===X[p]&&(X[p]=new w.ip(1,1,1,1));for(let l=0;l<6;l++)if(N.push(B[l].z,W.b?1-B[l].w:B[l].w),N.push(B[l].x,W.b?1-B[l].w:B[l].w),N.push(B[l].x,W.b?1-B[l].y:B[l].y),N.push(B[l].z,W.b?1-B[l].y:B[l].y),X)for(let y=0;y<4;y++)C.push(X[l].r,X[l].g,X[l].b,X[l].a);p.b._ComputeSides(s,h,c,A,N,y.frontUVs,y.backUVs);const K=new p.b;if(K.indices=c,K.zy=h,K.Sy=A,K.ky=N,X){const y=s===p.b.DOUBLESIDE?C.concat(C):C;K.My=y}return K}function I(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new N.b(y,A);c.sideOrientation=N.b._GetDefaultSideOrientation(c.sideOrientation),l._originalBuilderSideOrientation=c.sideOrientation;return h(c).Gy(l,c.updatable),l}p.b.CreateBox=h,N.b.CreateBox=function(y,c){return I(y,{size:c,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13645:(y,c,A)=>{"use strict";A.d(c,{c:()=>W});var l=A(12773),w=A(12758),N=A(12386);function p(y){const c=[],A=[],l=[],p=[],W=y.radius||.5,h=y.tessellation||64,I=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1,q=0===y.sideOrientation?0:y.sideOrientation||w.b.DEFAULTSIDE;c.push(0,0,0),p.push(.5,.5);const o=2*Math.PI*I,O=1===I?o/h:o/(h-1);let L=0;for(let w=0;w<h;w++){const y=Math.cos(L),A=Math.sin(L),l=(y+1)/2,w=(1-A)/2;c.push(W*y,W*A,0),p.push(l,N.b?1-w:w),L+=O}1===I&&(c.push(c[3],c[4],c[5]),p.push(p[2],N.b?1-p[3]:p[3]));const i=c.length/3;for(let w=1;w<i-1;w++)A.push(w+1,0,w);w.b.ComputeNormals(c,A,l),w.b._ComputeSides(q,c,A,l,p,y.frontUVs,y.backUVs);const H=new w.b;return H.indices=A,H.zy=c,H.Sy=l,H.ky=p,H}function W(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new l.b(y,A);c.sideOrientation=l.b._GetDefaultSideOrientation(c.sideOrientation),w._originalBuilderSideOrientation=c.sideOrientation;return p(c).Gy(w,c.updatable),w}w.b.CreateDisc=p,l.b.CreateDisc=function(y,c,A){return W(y,{radius:c,tessellation:A,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13516:(y,c,A)=>{"use strict";A.d(c,{c:()=>P,b:()=>t,f:()=>D});var l=A(12325),w=A(12375),N=A(12773),p=A(12758),W=A(12400);N.b._GroundMeshParser=(y,c)=>h.Parse(y,c);class h extends N.b{constructor(y,c){super(y,c),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=y,this._subdivisionsY=y,this.subdivide(y);const A=this;A.createOrUpdateSubmeshesOctree&&A.createOrUpdateSubmeshesOctree(c)}getHeightAtCoordinates(y,c){const A=this.getWorldMatrix(),w=l.TmpVectors.Matrix[5];A.invertToRef(w);const N=l.TmpVectors.gc[8];if(l.gc.TransformCoordinatesFromFloatsToRef(y,0,c,w,N),y=N.x,c=N.z,y<this._minX||y>=this._maxX||c<=this._minZ||c>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const p=this._getFacetAt(y,c),W=-(p.x*y+p.z*c+p.w)/p.y;return l.gc.TransformCoordinatesFromFloatsToRef(0,W,0,A,N),N.y}getNormalAtCoordinates(y,c){const A=new l.gc(0,1,0);return this.getNormalAtCoordinatesToRef(y,c,A),A}getNormalAtCoordinatesToRef(y,c,A){const w=this.getWorldMatrix(),N=l.TmpVectors.Matrix[5];w.invertToRef(N);const p=l.TmpVectors.gc[8];if(l.gc.TransformCoordinatesFromFloatsToRef(y,0,c,N,p),y=p.x,c=p.z,y<this._minX||y>this._maxX||c<this._minZ||c>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const W=this._getFacetAt(y,c);return l.gc.TransformNormalFromFloatsToRef(W.x,W.y,W.z,w,A),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(y,c){const A=Math.floor((y+this._maxX)*this._subdivisionsX/this._width),l=Math.floor(-(c+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),w=this._heightQuads[l*this._subdivisionsX+A];let N;return N=c<w.slope.x*y+w.slope.y?w.facet1:w.facet2,N}_initHeightQuads(){const y=this._subdivisionsX,c=this._subdivisionsY;this._heightQuads=[];for(let A=0;A<c;A++)for(let c=0;c<y;c++){const w={slope:l.Vector2.Zero(),facet1:new l.Vector4(0,0,0,0),facet2:new l.Vector4(0,0,0,0)};this._heightQuads[A*y+c]=w}return this}_computeHeightQuads(){const y=this.getVerticesData(W.e.PositionKind);if(!y)return this;const c=l.TmpVectors.gc[3],A=l.TmpVectors.gc[2],w=l.TmpVectors.gc[1],N=l.TmpVectors.gc[0],p=l.TmpVectors.gc[4],h=l.TmpVectors.gc[5],I=l.TmpVectors.gc[6],q=l.TmpVectors.gc[7],o=l.TmpVectors.gc[8];let O=0,L=0,i=0,H=0,P=0,D=0,t=0;const s=this._subdivisionsX,B=this._subdivisionsY;for(let W=0;W<B;W++)for(let B=0;B<s;B++){O=3*B,L=W*(s+1)*3,i=(W+1)*(s+1)*3,c.x=y[L+O],c.y=y[L+O+1],c.z=y[L+O+2],A.x=y[L+O+3],A.y=y[L+O+4],A.z=y[L+O+5],w.x=y[i+O],w.y=y[i+O+1],w.z=y[i+O+2],N.x=y[i+O+3],N.y=y[i+O+4],N.z=y[i+O+5],H=(N.z-c.z)/(N.x-c.x),P=c.z-H*c.x,A.subtractToRef(c,p),w.subtractToRef(c,h),N.subtractToRef(c,I),l.gc.CrossToRef(I,h,q),l.gc.CrossToRef(p,I,o),q.normalize(),o.normalize(),D=-(q.x*c.x+q.y*c.y+q.z*c.z),t=-(o.x*A.x+o.y*A.y+o.z*A.z);const X=this._heightQuads[W*s+B];X.slope.Ec(H,P),X.facet1.Ec(q.x,q.y,q.z,D),X.facet2.Ec(o.x,o.y,o.z,t)}return this}serialize(y){super.serialize(y),y.subdivisionsX=this._subdivisionsX,y.subdivisionsY=this._subdivisionsY,y.minX=this._minX,y.maxX=this._maxX,y.ec=this._minZ,y.maxZ=this._maxZ,y.width=this._width,y.height=this._height}static Parse(y,c){const A=new h(y.name,c);return A._subdivisionsX=y.subdivisionsX||1,A._subdivisionsY=y.subdivisionsY||1,A._minX=y.minX,A._maxX=y.maxX,A._minZ=y.ec,A._maxZ=y.maxZ,A._width=y.width,A._height=y.height,A}}var I=A(12144),q=A(12184),o=A(12330),O=A(12386);function L(y){const c=[],A=[],w=[],N=[];let W,h;const I=y.width||y.size||1,q=y.height||y.size||1,o=0|(y.subdivisionsX||y.subdivisions||1),L=0|(y.subdivisionsY||y.subdivisions||1);for(W=0;W<=L;W++)for(h=0;h<=o;h++){const y=new l.gc(h*I/o-I/2,0,(L-W)*q/L-q/2),c=new l.gc(0,1,0);A.push(y.x,y.y,y.z),w.push(c.x,c.y,c.z),N.push(h/o,O.b?W/L:1-W/L)}for(W=0;W<L;W++)for(h=0;h<o;h++)c.push(h+1+(W+1)*(o+1)),c.push(h+1+W*(o+1)),c.push(h+W*(o+1)),c.push(h+(W+1)*(o+1)),c.push(h+1+(W+1)*(o+1)),c.push(h+W*(o+1));const i=new p.b;return i.indices=c,i.zy=A,i.Sy=w,i.ky=N,i}function i(y){const c=void 0!==y.xmin&&null!==y.xmin?y.xmin:-1,A=void 0!==y.zmin&&null!==y.zmin?y.zmin:-1,w=void 0!==y.xmax&&null!==y.xmax?y.xmax:1,N=void 0!==y.zmax&&null!==y.zmax?y.zmax:1,W=y.subdivisions||{w:1,h:1},h=y.precision||{w:1,h:1},I=[],q=[],o=[],O=[];let L,i,H,P;W.h=W.h<1?1:W.h,W.w=W.w<1?1:W.w,h.w=h.w<1?1:h.w,h.h=h.h<1?1:h.h;const D=(w-c)/W.w,t=(N-A)/W.h;function s(y,c,A,w){const N=q.length/3,p=h.w+1;for(L=0;L<h.h;L++)for(i=0;i<h.w;i++){const y=[N+i+L*p,N+(i+1)+L*p,N+(i+1)+(L+1)*p,N+i+(L+1)*p];I.push(y[1]),I.push(y[2]),I.push(y[3]),I.push(y[0]),I.push(y[1]),I.push(y[3])}const W=l.gc.Zero(),H=new l.gc(0,1,0);for(L=0;L<=h.h;L++)for(W.z=L*(w-c)/h.h+c,i=0;i<=h.w;i++)W.x=i*(A-y)/h.w+y,W.y=0,q.push(W.x,W.y,W.z),o.push(H.x,H.y,H.z),O.push(i/h.w,L/h.h)}for(H=0;H<W.h;H++)for(P=0;P<W.w;P++)s(c+P*D,A+H*t,c+(P+1)*D,A+(H+1)*t);const B=new p.b;return B.indices=I,B.zy=q,B.Sy=o,B.ky=O,B}function H(y){const c=[],A=[],N=[],W=[];let h,I;const q=y.colorFilter||new w.dc(.3,.59,.11),O=y.alphaFilter||0;let L=!1;if(y.minHeight>y.maxHeight){L=!0;const c=y.maxHeight;y.maxHeight=y.minHeight,y.minHeight=c}for(h=0;h<=y.subdivisions;h++)for(I=0;I<=y.subdivisions;I++){const c=new l.gc(I*y.width/y.subdivisions-y.width/2,0,(y.subdivisions-h)*y.height/y.subdivisions-y.height/2),w=4*(((c.x+y.width/2)/y.width*(y.bufferWidth-1)|0)+((1-(c.z+y.height/2)/y.height)*(y.bufferHeight-1)|0)*y.bufferWidth);let p=y.buffer[w]/255,i=y.buffer[w+1]/255,H=y.buffer[w+2]/255;const P=y.buffer[w+3]/255;L&&(p=1-p,i=1-i,H=1-H);const D=p*q.r+i*q.g+H*q.b;c.y=P>=O?y.minHeight+(y.maxHeight-y.minHeight)*D:y.minHeight-o.b,y.heightBuffer&&(y.heightBuffer[h*(y.subdivisions+1)+I]=c.y),A.push(c.x,c.y,c.z),N.push(0,0,0),W.push(I/y.subdivisions,1-h/y.subdivisions)}for(h=0;h<y.subdivisions;h++)for(I=0;I<y.subdivisions;I++){const l=I+1+(h+1)*(y.subdivisions+1),w=I+1+h*(y.subdivisions+1),N=I+h*(y.subdivisions+1),p=I+(h+1)*(y.subdivisions+1),W=A[3*l+1]>=y.minHeight,q=A[3*w+1]>=y.minHeight,o=A[3*N+1]>=y.minHeight;W&&q&&o&&(c.push(l),c.push(w),c.push(N));A[3*p+1]>=y.minHeight&&W&&o&&(c.push(p),c.push(l),c.push(N))}p.b.ComputeNormals(A,c,N);const i=new p.b;return i.indices=c,i.zy=A,i.Sy=N,i.ky=W,i}function P(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=new h(y,arguments.length>2?arguments[2]:void 0);A._setReady(!1),A._subdivisionsX=c.subdivisionsX||c.subdivisions||1,A._subdivisionsY=c.subdivisionsY||c.subdivisions||1,A._width=c.width||1,A._height=c.height||1,A._maxX=A._width/2,A._maxZ=A._height/2,A._minX=-A._maxX,A._minZ=-A._maxZ;return L(c).Gy(A,c.updatable),A._setReady(!0),A}function D(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new N.b(y,A);return i(c).Gy(l,c.updatable),l}function t(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=A.width||10,p=A.height||10,W=A.subdivisions||1,o=A.minHeight||0,O=A.maxHeight||1,L=A.colorFilter||new w.dc(.3,.59,.11),i=A.alphaFilter||0,P=A.updatable,D=A.onReady;l=l||q.c.LastCreatedScene;const t=new h(y,l);let s;t._subdivisionsX=W,t._subdivisionsY=W,t._width=N,t._height=p,t._maxX=t._width/2,t._maxZ=t._height/2,t._minX=-t._maxX,t._minZ=-t._maxZ,t._setReady(!1),A.passHeightBufferInCallback&&(s=new Float32Array((W+1)*(W+1)));const B=(y,c,A)=>{H({width:N,height:p,subdivisions:W,minHeight:o,maxHeight:O,colorFilter:L,buffer:y,bufferWidth:c,bufferHeight:A,alphaFilter:i,heightBuffer:s}).Gy(t,P),D&&D(t,s),t._setReady(!0)};if("string"===typeof c){const y=y=>{var c;const A=y.width,w=y.height;if(l.I)return;const N=null===(c=l)||void 0===c?void 0:c.getEngine().resizeImageBitmap(y,A,w);B(N,A,w)};I.Tools.LoadImage(c,y,A.onError?A.onError:()=>{},l.offlineProvider)}else B(c.data,c.width,c.height);return t}p.b.CreateGround=L,p.b.CreateTiledGround=i,p.b.CreateGroundFromHeightMap=H,N.b.CreateGround=(y,c,A,l,w,N)=>P(y,{width:c,height:A,subdivisions:l,updatable:N},w),N.b.CreateTiledGround=(y,c,A,l,w,N,p,W,h)=>D(y,{xmin:c,zmin:A,xmax:l,zmax:w,subdivisions:N,precision:p,updatable:h},W),N.b.CreateGroundFromHeightMap=(y,c,A,l,w,N,p,W,h,I,q)=>t(y,c,{width:A,height:l,subdivisions:w,minHeight:N,maxHeight:p,updatable:h,onReady:I,alphaFilter:q},W)},14151:(y,c,A)=>{"use strict";A.d(c,{c:()=>L,f:()=>o,g:()=>O});var l=A(12325),w=A(12773),N=A(12758),p=A(12869),W=A(12400),h=A(12161);function I(y){const c=[],A=[],l=y.lines,w=y.My,p=[];let W=0;for(let N=0;N<l.length;N++){const y=l[N];for(let l=0;l<y.length;l++){const{x:h,y:I,z:q}=y[l];if(A.push(h,I,q),w){const y=w[N],{r:c,g:A,b:W,a:h}=y[l];p.push(c,A,W,h)}l>0&&(c.push(W-1),c.push(W)),W++}}const h=new N.b;return h.indices=c,h.zy=A,w&&(h.My=p),h}function q(y){const c=y.dashSize||3,A=y.gapSize||1,w=y.dashNb||200,p=y.points,W=[],h=[],I=l.gc.Zero();let q=0,o=0,O=0,L=0,i=0,H=0,P=0;for(P=0;P<p.length-1;P++)p[P+1].subtractToRef(p[P],I),q+=I.length();for(O=q/w,L=c*O/(c+A),P=0;P<p.length-1;P++){p[P+1].subtractToRef(p[P],I),o=Math.floor(I.length()/O),I.normalize();for(let y=0;y<o;y++)i=O*y,W.push(p[P].x+i*I.x,p[P].y+i*I.y,p[P].z+i*I.z),W.push(p[P].x+(i+L)*I.x,p[P].y+(i+L)*I.y,p[P].z+(i+L)*I.z),h.push(H,H+1),H+=2}const D=new N.b;return D.zy=W,D.indices=h,D}function o(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=c.instance,w=c.lines,N=c.My;if(l){const y=l.getVerticesData(W.e.PositionKind);let c,A;N&&(c=l.getVerticesData(W.e.ColorKind));let p=0,h=0;for(let l=0;l<w.length;l++){const W=w[l];for(let w=0;w<W.length;w++)y[p]=W[w].x,y[p+1]=W[w].y,y[p+2]=W[w].z,N&&c&&(A=N[l],c[h]=A[w].r,c[h+1]=A[w].g,c[h+2]=A[w].b,c[h+3]=A[w].a,h+=4),p+=3}return l.updateVerticesData(W.e.PositionKind,y,!1,!1),N&&c&&l.updateVerticesData(W.e.ColorKind,c,!1,!1),l.refreshBoundingInfo(),l}const h=!!N,q=new p.c(y,A,null,void 0,void 0,h,c.useVertexAlpha,c.material);return I(c).Gy(q,c.updatable),q}function O(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=c.My?[c.My]:null;return o(y,{lines:[c.points],updatable:c.updatable,instance:c.instance,My:l,useVertexAlpha:c.useVertexAlpha,material:c.material},A)}function L(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=c.points,W=c.instance,I=c.gapSize||1,o=c.dashSize||3;if(W){const y=y=>{const c=l.gc.Zero(),A=y.length/6;let w=0,p=0,h=0,I=0,q=0,o=0,O=0,L=0;for(O=0;O<N.length-1;O++)N[O+1].subtractToRef(N[O],c),w+=c.length();h=w/A;const i=W._creationDataStorage.dashSize;for(I=i*h/(i+W._creationDataStorage.gapSize),O=0;O<N.length-1;O++)for(N[O+1].subtractToRef(N[O],c),p=Math.floor(c.length()/h),c.normalize(),L=0;L<p&&o<y.length;)q=h*L,y[o]=N[O].x+q*c.x,y[o+1]=N[O].y+q*c.y,y[o+2]=N[O].z+q*c.z,y[o+3]=N[O].x+(q+I)*c.x,y[o+4]=N[O].y+(q+I)*c.y,y[o+5]=N[O].z+(q+I)*c.z,o+=6,L++;for(;o<y.length;)y[o]=N[O].x,y[o+1]=N[O].y,y[o+2]=N[O].z,o+=3};return(c.dashNb||c.dashSize||c.gapSize||c.useVertexAlpha||c.material)&&h.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),W.updateMeshPositions(y,!1),W}const O=new p.c(y,A,null,void 0,void 0,void 0,c.useVertexAlpha,c.material);return q(c).Gy(O,c.updatable),O._creationDataStorage=new w.c,O._creationDataStorage.dashSize=o,O._creationDataStorage.gapSize=I,O}N.b.CreateLineSystem=I,N.b.CreateDashedLines=q,w.b.bI=function(y,c){return O(y,{points:c,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},w.b.CreateDashedLines=function(y,c,A,l,w){return L(y,{points:c,dashSize:A,gapSize:l,dashNb:w,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13562:(y,c,A)=>{"use strict";A.d(c,{d:()=>W,h:()=>h});var l=A(12773),w=A(12758),N=A(12386);function p(y){const c=[],A=[],l=[],p=[],W=void 0!==y.width?y.width:void 0!==y.size?y.size:1,h=void 0!==y.height?y.height:void 0!==y.size?y.size:1,I=0===y.sideOrientation?0:y.sideOrientation||w.b.DEFAULTSIDE,q=W/2,o=h/2;A.push(-q,-o,0),l.push(0,0,-1),p.push(0,N.b?1:0),A.push(q,-o,0),l.push(0,0,-1),p.push(1,N.b?1:0),A.push(q,o,0),l.push(0,0,-1),p.push(1,N.b?0:1),A.push(-q,o,0),l.push(0,0,-1),p.push(0,N.b?0:1),c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),w.b._ComputeSides(I,A,c,l,p,y.frontUVs,y.backUVs);const O=new w.b;return O.indices=c,O.zy=A,O.Sy=l,O.ky=p,O}function W(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new l.b(y,A);c.sideOrientation=l.b._GetDefaultSideOrientation(c.sideOrientation),w._originalBuilderSideOrientation=c.sideOrientation;return p(c).Gy(w,c.updatable),c.sourcePlane&&(w.translate(c.sourcePlane.normal,-c.sourcePlane.d),w.setDirection(c.sourcePlane.normal.scale(-1))),w}const h={dI:W};w.b.dI=p,l.b.dI=(y,c,A,l,w)=>W(y,{size:c,width:c,height:c,sideOrientation:w,updatable:l},A)},13635:(y,c,A)=>{"use strict";A.d(c,{e:()=>h});var l=A(12325),w=A(12773),N=A(12758),p=A(12386);function W(y){const c=0|(y.segments||32),A=y.diameterX||y.diameter||1,w=y.diameterY||y.diameter||1,W=y.diameterZ||y.diameter||1,h=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1,I=y.slice&&y.slice<=0?1:y.slice||1,q=0===y.sideOrientation?0:y.sideOrientation||N.b.DEFAULTSIDE,o=!!y.dedupTopBottomIndices,O=new l.gc(A/2,w/2,W/2),L=2+c,i=2*L,H=[],P=[],D=[],t=[];for(let N=0;N<=L;N++){const y=N/L,c=y*Math.PI*I;for(let A=0;A<=i;A++){const w=A/i,N=w*Math.PI*2*h,W=l.Matrix.RotationZ(-c),I=l.Matrix.RotationY(N),q=l.gc.TransformCoordinates(l.gc.Up(),W),o=l.gc.TransformCoordinates(q,I),L=o.multiply(O),H=o.divide(O).normalize();P.push(L.x,L.y,L.z),D.push(H.x,H.y,H.z),t.push(w,p.b?1-y:y)}if(N>0){const y=P.length/3;for(let c=y-2*(i+1);c+i+2<y;c++)o?(N>1&&(H.push(c),H.push(c+1),H.push(c+i+1)),(N<L||I<1)&&(H.push(c+i+1),H.push(c+1),H.push(c+i+2))):(H.push(c),H.push(c+1),H.push(c+i+1),H.push(c+i+1),H.push(c+1),H.push(c+i+2))}}N.b._ComputeSides(q,P,H,D,t,y.frontUVs,y.backUVs);const s=new N.b;return s.indices=H,s.zy=P,s.Sy=D,s.ky=t,s}function h(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new w.b(y,A);c.sideOrientation=w.b._GetDefaultSideOrientation(c.sideOrientation),l._originalBuilderSideOrientation=c.sideOrientation;return W(c).Gy(l,c.updatable),l}N.b.CreateSphere=W,w.b.CreateSphere=(y,c,A,l,w,N)=>h(y,{segments:c,diameterX:A,diameterY:A,diameterZ:A,sideOrientation:N,updatable:w},l)},14500:(y,c,A)=>{"use strict";A.d(c,{c:()=>W});var l=A(12887),w=A(13962),N=A(12904),p=A(12758);class W{static get Configuration(){return{get decoder(){return w.c.DefaultConfiguration},set decoder(y){w.c.DefaultConfiguration=y}}}static set Configuration(y){w.c.DefaultConfiguration=y.decoder}static get DecoderAvailable(){return(0,l.f)(w.c.DefaultConfiguration)}static get Default(){return W._Default??(W._Default=new W),W._Default}static ResetDefault(y){W._Default&&(y||W._Default.dispose(),W._Default=null)}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.DefaultNumWorkers;const c="number"===typeof y?{...w.c.DefaultConfiguration,numWorkers:y}:{...w.c.DefaultConfiguration,...y};this._decoder=new w.c(c)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(y,c,A){return this._decoder.decodeMeshToMeshDataAsync(y,c,A)}async decodeMeshToGeometryAsync(y,c,A,l){return await this._decoder.decodeMeshToGeometryAsync(y,c,A,l)}async _decodeMeshToGeometryForGltfAsync(y,c,A,l,w,N){return await this._decoder._decodeMeshToGeometryForGltfAsync(y,c,A,l,w,N)}async decodeMeshAsync(y,c){const A=await this._decoder.decodeMeshToMeshDataAsync(y,c),l=new p.b;A.indices&&(l.indices=A.indices);for(const w of A.attributes){const y=N.e.GetFloatData(w.data,w.size,N.e.GetDataType(w.data),w.byteOffset,w.byteStride,w.normalized,A.totalVertices);l.set(y,w.kind)}return l}}W.DefaultNumWorkers=(0,l.e)(),W._Default=null},13962:(y,c,A)=>{"use strict";A.d(c,{c:()=>I});var l=A(12887),w=A(12144),N=A(12783),p=A(12904),W=A(12161),h=A(12901);class I extends l.b{static get DefaultAvailable(){return(0,l.f)(I.DefaultConfiguration)}static get Default(){return I._Default??(I._Default=new I),I._Default}static ResetDefault(y){I._Default&&(y||I._Default.dispose(),I._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(y,c){return{module:await(c||DracoDecoderModule)({wasmBinary:y})}}_getWorkerContent(){return`${h.e}(${h.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.DefaultConfiguration)}decodeMeshToMeshDataAsync(y,c,A){const l=y instanceof ArrayBuffer?new Int8Array(y):new Int8Array(y.buffer,y.byteOffset,y.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async y=>await new Promise(((w,N)=>{y.push(((y,p)=>{let h=null;const I=[],q=c=>{y.removeEventListener("error",q),y.removeEventListener("message",o),N(c),p()},o=c=>{const l=c.data;switch(l.id){case"indices":h=l.data;break;case"attribute":I.push({kind:l.kind,data:l.data,size:l.size,byteOffset:l.byteOffset,byteStride:l.byteStride,normalized:(N=l.kind,O=l.normalized,A&&void 0!==A[N]?(O!==A[N]&&W.c.Warn(`Normalized flag from Draco data (${O}) does not match normalized flag from glTF accessor (${A[N]}). Using flag from glTF accessor.`),A[N]):O)});break;case"decodeMeshDone":y.removeEventListener("error",q),y.removeEventListener("message",o),w({indices:h,attributes:I,totalVertices:l.totalVertices}),p()}var N,O};y.addEventListener("error",q),y.addEventListener("message",o);const O=l.slice();y.postMessage({id:"decodeMesh",dataView:O,attributes:c},[O.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((y=>{let A=null;const w=[],N=(0,h.e)(y.module,l,c,(y=>{A=y}),((y,c,A,l,N,p)=>{w.push({kind:y,data:c,size:A,byteOffset:l,byteStride:N,normalized:p})}));return{indices:A,attributes:w,totalVertices:N}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(y,c,A,l){const w=await this.decodeMeshToMeshDataAsync(A,l),W=new N.e(y,c);w.indices&&W.setIndices(w.indices);for(const N of w.attributes)W.setVerticesBuffer(new p.e(c.getEngine(),N.data,N.kind,!1,void 0,N.byteStride,void 0,N.byteOffset,N.size,void 0,N.normalized,!0),w.totalVertices);return W}async _decodeMeshToGeometryForGltfAsync(y,c,A,l,w,W){const h=await this.decodeMeshToMeshDataAsync(A,l,w),I=new N.e(y,c);W&&(I._boundingInfo=W,I.useBoundingInfoFromGeometry=!0),h.indices&&I.setIndices(h.indices);for(const N of h.attributes)I.setVerticesBuffer(new p.e(c.getEngine(),N.data,N.kind,!1,void 0,N.byteStride,void 0,N.byteOffset,N.size,void 0,N.normalized,!0),h.totalVertices);return I}}I.DefaultConfiguration={wasmUrl:`${w.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${w.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${w.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},I._Default=null},14146:(y,c,A)=>{"use strict";A.d(c,{d:()=>Wy});var l=A(12325),w=A(12773),N=A(12400),p=A(12758),W=A(12386);function h(y){let c=y.pathArray;const A=y.closeArray||!1,l=y.closePath||!1,w=y.invertUV||!1,h=Math.floor(c[0].length/2);let I=y.offset||h;I=I>h?h:Math.floor(I);const q=0===y.sideOrientation?0:y.sideOrientation||p.b.DEFAULTSIDE,o=y.ky,O=y.My,L=[],i=[],H=[],P=[],D=[],t=[],s=[],B=[];let X;const C=[],K=[];let my,T,z;if(c.length<2){const y=[],A=[];for(T=0;T<c[0].length-I;T++)y.push(c[0][T]),A.push(c[0][T+I]);c=[y,A]}let S=0;const M=l?1:0,k=A?1:0;let a,u,G,j,f,V;for(X=c[0].length,my=0;my<c.length+k;my++){for(s[my]=0,D[my]=[0],a=my===c.length?c[0]:c[my],u=a.length,X=X<u?X:u,z=0;z<u;)L.push(a[z].x,a[z].y,a[z].z),z>0&&(G=a[z].xc(a[z-1]).length(),j=G+s[my],D[my].push(j),s[my]=j),z++;l&&(z--,L.push(a[0].x,a[0].y,a[0].z),G=a[z].xc(a[0]).length(),j=G+s[my],D[my].push(j),s[my]=j),C[my]=u+M,K[my]=S,S+=u+M}let J,U,e=null,Q=null;for(T=0;T<X+M;T++)for(B[T]=0,t[T]=[0],my=0;my<c.length-1+k;my++)f=c[my],V=my===c.length-1?c[0]:c[my+1],T===X?(e=f[0],Q=V[0]):(e=f[T],Q=V[T]),G=Q.xc(e).length(),j=G+B[T],t[T].push(j),B[T]=j;if(o)for(my=0;my<o.length;my++)P.push(o[my].x,W.b?1-o[my].y:o[my].y);else for(my=0;my<c.length+k;my++)for(T=0;T<X+M;T++)J=0!=s[my]?D[my][T]/s[my]:0,U=0!=B[T]?t[T][my]/B[T]:0,w?P.push(U,J):P.push(J,W.b?1-U:U);my=0;let Y=0,g=C[my]-1,x=C[my+1]-1,F=g<x?g:x,R=K[1]-K[0];const r=C.length-1;for(;Y<=F&&my<r;)i.push(Y,Y+R,Y+1),i.push(Y+R+1,Y+1,Y+R),Y+=1,Y===F&&(my++,R=K[my+1]-K[my],g=C[my]-1,x=C[my+1]-1,Y=K[my],F=g<x?g+Y:x+Y);if(p.b.ComputeNormals(L,i,H),l){let y=0,A=0;for(my=0;my<c.length;my++){y=3*K[my],A=my+1<c.length?3*(K[my+1]-1):H.length-3,H[y]=.5*(H[y]+H[A]),H[y+1]=.5*(H[y+1]+H[A+1]),H[y+2]=.5*(H[y+2]+H[A+2]);const l=Math.sqrt(H[y]*H[y]+H[y+1]*H[y+1]+H[y+2]*H[y+2]);H[y]/=l,H[y+1]/=l,H[y+2]/=l,H[A]=H[y],H[A+1]=H[y+1],H[A+2]=H[y+2]}}if(A){let y=3*K[0],A=3*K[c.length];for(T=0;T<X+M;T++){H[y]=.5*(H[y]+H[A]),H[y+1]=.5*(H[y+1]+H[A+1]),H[y+2]=.5*(H[y+2]+H[A+2]);const c=Math.sqrt(H[y]*H[y]+H[y+1]*H[y+1]+H[y+2]*H[y+2]);H[y]/=c,H[y+1]/=c,H[y+2]/=c,H[A]=H[y],H[A+1]=H[y+1],H[A+2]=H[y+2],y+=3,A+=3}}p.b._ComputeSides(q,L,i,H,P,y.frontUVs,y.backUVs);let n=null;if(O){n=new Float32Array(4*O.length);for(let y=0;y<O.length;y++)n[4*y]=O[y].r,n[4*y+1]=O[y].g,n[4*y+2]=O[y].b,n[4*y+3]=O[y].a}const E=new p.b,b=new Float32Array(L),Z=new Float32Array(H),v=new Float32Array(P);return E.indices=i,E.zy=b,E.Sy=Z,E.ky=v,n&&E.set(n,N.e.ColorKind),l&&(E._idx=K),E}function I(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=c.pathArray,q=c.closeArray,o=c.closePath,O=w.b._GetDefaultSideOrientation(c.sideOrientation),L=c.instance,i=c.updatable;if(L){const y=l.TmpVectors.gc[0].vc(Number.MAX_VALUE),A=l.TmpVectors.gc[1].vc(-Number.MAX_VALUE),h=c=>{let l=I[0].length;const N=L;let p=0;const W=N._originalBuilderSideOrientation===w.b.DOUBLESIDE?2:1;for(let w=1;w<=W;++w)for(let W=0;W<I.length;++W){const w=I[W],h=w.length;l=l<h?l:h;for(let N=0;N<l;++N){const l=w[N];c[p]=l.x,c[p+1]=l.y,c[p+2]=l.z,y.minimizeInPlaceFromFloats(l.x,l.y,l.z),A.maximizeInPlaceFromFloats(l.x,l.y,l.z),p+=3}if(N._creationDataStorage&&N._creationDataStorage.closePath){const y=w[0];c[p]=y.x,c[p+1]=y.y,c[p+2]=y.z,p+=3}}},q=L.getVerticesData(N.e.PositionKind);if(h(q),L.hasBoundingInfo?L.getBoundingInfo().reConstruct(y,A,L._worldMatrix):L.buildBoundingInfo(y,A,L._worldMatrix),L.updateVerticesData(N.e.PositionKind,q,!1,!1),c.My){const y=L.getVerticesData(N.e.ColorKind);for(let A=0,l=0;A<c.My.length;A++,l+=4){const w=c.My[A];y[l]=w.r,y[l+1]=w.g,y[l+2]=w.b,y[l+3]=w.a}L.updateVerticesData(N.e.ColorKind,y,!1,!1)}if(c.ky){const y=L.getVerticesData(N.e.UVKind);for(let A=0;A<c.ky.length;A++)y[2*A]=c.ky[A].x,y[2*A+1]=W.b?1-c.ky[A].y:c.ky[A].y;L.updateVerticesData(N.e.UVKind,y,!1,!1)}if(!L.areNormalsFrozen||L.isFacetDataEnabled){const y=L.rc(),c=L.getVerticesData(N.e.NormalKind),A=L.isFacetDataEnabled?L.getFacetDataParameters():null;if(p.b.ComputeNormals(q,y,c,A),L._creationDataStorage&&L._creationDataStorage.closePath){let y=0,A=0;for(let l=0;l<I.length;l++)y=3*L._creationDataStorage.idx[l],A=l+1<I.length?3*(L._creationDataStorage.idx[l+1]-1):c.length-3,c[y]=.5*(c[y]+c[A]),c[y+1]=.5*(c[y+1]+c[A+1]),c[y+2]=.5*(c[y+2]+c[A+2]),c[A]=c[y],c[A+1]=c[y+1],c[A+2]=c[y+2]}L.areNormalsFrozen||L.updateVerticesData(N.e.NormalKind,c,!1,!1)}return L}{const l=new w.b(y,A);l._originalBuilderSideOrientation=O,l._creationDataStorage=new w.c;const N=h(c);return o&&(l._creationDataStorage.idx=N._idx),l._creationDataStorage.closePath=o,l._creationDataStorage.closeArray=q,N.Gy(l,i),l}}p.b.CreateRibbon=h,w.b.CreateRibbon=function(y,c){return I(y,{pathArray:c,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var q=A(13645),o=A(13508),O=A(12375);function L(y){const c=y.pattern||w.b.NO_FLIP,A=y.tileWidth||y.tileSize||1,l=y.tileHeight||y.tileSize||1,N=y.alignHorizontal||0,W=y.alignVertical||0,h=y.width||y.size||1,I=Math.floor(h/A);let q=h-I*A;const o=y.height||y.size||1,O=Math.floor(o/l);let L=o-O*l;const i=A*I/2,H=l*O/2;let P=0,D=0,t=0,s=0,B=0,X=0;if(q>0||L>0){switch(t=-i,s=-H,B=i,X=H,N){case w.b.CENTER:q/=2,t-=q,B+=q;break;case w.b.LEFT:B+=q,P=-q/2;break;case w.b.RIGHT:t-=q,P=q/2}switch(W){case w.b.CENTER:L/=2,s-=L,X+=L;break;case w.b.BOTTOM:X+=L,D=-L/2;break;case w.b.TOP:s-=L,D=L/2}}const C=[],K=[],my=[];my[0]=[0,0,1,0,1,1,0,1],my[1]=[0,0,1,0,1,1,0,1],c!==w.b.ROTATE_TILE&&c!==w.b.ROTATE_ROW||(my[1]=[1,1,0,1,0,0,1,0]),c!==w.b.FLIP_TILE&&c!==w.b.FLIP_ROW||(my[1]=[1,0,0,0,0,1,1,1]),c!==w.b.FLIP_N_ROTATE_TILE&&c!==w.b.FLIP_N_ROTATE_ROW||(my[1]=[0,1,1,1,1,0,0,0]);let T=[];const z=[],S=[];let M=0;for(let p=0;p<O;p++)for(let y=0;y<I;y++)C.push(y*A-i+P,p*l-H+D,0),C.push((y+1)*A-i+P,p*l-H+D,0),C.push((y+1)*A-i+P,(p+1)*l-H+D,0),C.push(y*A-i+P,(p+1)*l-H+D,0),S.push(M,M+1,M+3,M+1,M+2,M+3),T=c===w.b.FLIP_TILE||c===w.b.ROTATE_TILE||c===w.b.FLIP_N_ROTATE_TILE?T.concat(my[(y%2+p%2)%2]):c===w.b.FLIP_ROW||c===w.b.ROTATE_ROW||c===w.b.FLIP_N_ROTATE_ROW?T.concat(my[p%2]):T.concat(my[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),M+=4;if(q>0||L>0){const y=L>0&&(W===w.b.CENTER||W===w.b.TOP),p=L>0&&(W===w.b.CENTER||W===w.b.BOTTOM),h=q>0&&(N===w.b.CENTER||N===w.b.RIGHT),o=q>0&&(N===w.b.CENTER||N===w.b.LEFT);let my,k,a,u,G=[];if(y&&h&&(C.push(t+P,s+D,0),C.push(-i+P,s+D,0),C.push(-i+P,s+L+D,0),C.push(t+P,s+L+D,0),S.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,my=1-q/A,k=1-L/l,a=1,u=1,G=[my,k,a,k,a,u,my,u],c===w.b.ROTATE_ROW&&(G=[1-my,1-k,1-a,1-k,1-a,1-u,1-my,1-u]),c===w.b.FLIP_ROW&&(G=[1-my,k,1-a,k,1-a,u,1-my,u]),c===w.b.FLIP_N_ROTATE_ROW&&(G=[my,1-k,a,1-k,a,1-u,my,1-u]),T=T.concat(G),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&o&&(C.push(i+P,s+D,0),C.push(B+P,s+D,0),C.push(B+P,s+L+D,0),C.push(i+P,s+L+D,0),S.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,my=0,k=1-L/l,a=q/A,u=1,G=[my,k,a,k,a,u,my,u],(c===w.b.ROTATE_ROW||c===w.b.ROTATE_TILE&&I%2===0)&&(G=[1-my,1-k,1-a,1-k,1-a,1-u,1-my,1-u]),(c===w.b.FLIP_ROW||c===w.b.FLIP_TILE&&I%2===0)&&(G=[1-my,k,1-a,k,1-a,u,1-my,u]),(c===w.b.FLIP_N_ROTATE_ROW||c===w.b.FLIP_N_ROTATE_TILE&&I%2===0)&&(G=[my,1-k,a,1-k,a,1-u,my,1-u]),T=T.concat(G),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p&&h&&(C.push(t+P,H+D,0),C.push(-i+P,H+D,0),C.push(-i+P,X+D,0),C.push(t+P,X+D,0),S.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,my=1-q/A,k=0,a=1,u=L/l,G=[my,k,a,k,a,u,my,u],(c===w.b.ROTATE_ROW&&O%2===1||c===w.b.ROTATE_TILE&&O%1===0)&&(G=[1-my,1-k,1-a,1-k,1-a,1-u,1-my,1-u]),(c===w.b.FLIP_ROW&&O%2===1||c===w.b.FLIP_TILE&&O%2===0)&&(G=[1-my,k,1-a,k,1-a,u,1-my,u]),(c===w.b.FLIP_N_ROTATE_ROW&&O%2===1||c===w.b.FLIP_N_ROTATE_TILE&&O%2===0)&&(G=[my,1-k,a,1-k,a,1-u,my,1-u]),T=T.concat(G),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p&&o&&(C.push(i+P,H+D,0),C.push(B+P,H+D,0),C.push(B+P,X+D,0),C.push(i+P,X+D,0),S.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,my=0,k=0,a=q/A,u=L/l,G=[my,k,a,k,a,u,my,u],(c===w.b.ROTATE_ROW&&O%2===1||c===w.b.ROTATE_TILE&&(O+I)%2===1)&&(G=[1-my,1-k,1-a,1-k,1-a,1-u,1-my,1-u]),(c===w.b.FLIP_ROW&&O%2===1||c===w.b.FLIP_TILE&&(O+I)%2===1)&&(G=[1-my,k,1-a,k,1-a,u,1-my,u]),(c===w.b.FLIP_N_ROTATE_ROW&&O%2===1||c===w.b.FLIP_N_ROTATE_TILE&&(O+I)%2===1)&&(G=[my,1-k,a,1-k,a,1-u,my,1-u]),T=T.concat(G),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y){const y=[];my=0,k=1-L/l,a=1,u=1,y[0]=[my,k,a,k,a,u,my,u],y[1]=[my,k,a,k,a,u,my,u],c!==w.b.ROTATE_TILE&&c!==w.b.ROTATE_ROW||(y[1]=[1-my,1-k,1-a,1-k,1-a,1-u,1-my,1-u]),c!==w.b.FLIP_TILE&&c!==w.b.FLIP_ROW||(y[1]=[1-my,k,1-a,k,1-a,u,1-my,u]),c!==w.b.FLIP_N_ROTATE_TILE&&c!==w.b.FLIP_N_ROTATE_ROW||(y[1]=[my,1-k,a,1-k,a,1-u,my,1-u]);for(let l=0;l<I;l++)C.push(l*A-i+P,s+D,0),C.push((l+1)*A-i+P,s+D,0),C.push((l+1)*A-i+P,s+L+D,0),C.push(l*A-i+P,s+L+D,0),S.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,T=c===w.b.FLIP_TILE||c===w.b.ROTATE_TILE||c===w.b.FLIP_N_ROTATE_TILE?T.concat(y[(l+1)%2]):c===w.b.FLIP_ROW||c===w.b.ROTATE_ROW||c===w.b.FLIP_N_ROTATE_ROW?T.concat(y[1]):T.concat(y[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(p){const y=[];my=0,k=0,a=1,u=L/l,y[0]=[my,k,a,k,a,u,my,u],y[1]=[my,k,a,k,a,u,my,u],c!==w.b.ROTATE_TILE&&c!==w.b.ROTATE_ROW||(y[1]=[1-my,1-k,1-a,1-k,1-a,1-u,1-my,1-u]),c!==w.b.FLIP_TILE&&c!==w.b.FLIP_ROW||(y[1]=[1-my,k,1-a,k,1-a,u,1-my,u]),c!==w.b.FLIP_N_ROTATE_TILE&&c!==w.b.FLIP_N_ROTATE_ROW||(y[1]=[my,1-k,a,1-k,a,1-u,my,1-u]);for(let l=0;l<I;l++)C.push(l*A-i+P,X-L+D,0),C.push((l+1)*A-i+P,X-L+D,0),C.push((l+1)*A-i+P,X+D,0),C.push(l*A-i+P,X+D,0),S.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,T=c===w.b.FLIP_TILE||c===w.b.ROTATE_TILE||c===w.b.FLIP_N_ROTATE_TILE?T.concat(y[(l+O)%2]):c===w.b.FLIP_ROW||c===w.b.ROTATE_ROW||c===w.b.FLIP_N_ROTATE_ROW?T.concat(y[O%2]):T.concat(y[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(h){const y=[];my=1-q/A,k=0,a=1,u=1,y[0]=[my,k,a,k,a,u,my,u],y[1]=[my,k,a,k,a,u,my,u],c!==w.b.ROTATE_TILE&&c!==w.b.ROTATE_ROW||(y[1]=[1-my,1-k,1-a,1-k,1-a,1-u,1-my,1-u]),c!==w.b.FLIP_TILE&&c!==w.b.FLIP_ROW||(y[1]=[1-my,k,1-a,k,1-a,u,1-my,u]),c!==w.b.FLIP_N_ROTATE_TILE&&c!==w.b.FLIP_N_ROTATE_ROW||(y[1]=[my,1-k,a,1-k,a,1-u,my,1-u]);for(let A=0;A<O;A++)C.push(t+P,A*l-H+D,0),C.push(t+q+P,A*l-H+D,0),C.push(t+q+P,(A+1)*l-H+D,0),C.push(t+P,(A+1)*l-H+D,0),S.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,T=c===w.b.FLIP_TILE||c===w.b.ROTATE_TILE||c===w.b.FLIP_N_ROTATE_TILE?T.concat(y[(A+1)%2]):c===w.b.FLIP_ROW||c===w.b.ROTATE_ROW||c===w.b.FLIP_N_ROTATE_ROW?T.concat(y[A%2]):T.concat(y[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(o){const y=[];my=0,k=0,a=q/l,u=1,y[0]=[my,k,a,k,a,u,my,u],y[1]=[my,k,a,k,a,u,my,u],c!==w.b.ROTATE_TILE&&c!==w.b.ROTATE_ROW||(y[1]=[1-my,1-k,1-a,1-k,1-a,1-u,1-my,1-u]),c!==w.b.FLIP_TILE&&c!==w.b.FLIP_ROW||(y[1]=[1-my,k,1-a,k,1-a,u,1-my,u]),c!==w.b.FLIP_N_ROTATE_TILE&&c!==w.b.FLIP_N_ROTATE_ROW||(y[1]=[my,1-k,a,1-k,a,1-u,my,1-u]);for(let A=0;A<O;A++)C.push(B-q+P,A*l-H+D,0),C.push(B+P,A*l-H+D,0),C.push(B+P,(A+1)*l-H+D,0),C.push(B-q+P,(A+1)*l-H+D,0),S.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,T=c===w.b.FLIP_TILE||c===w.b.ROTATE_TILE||c===w.b.FLIP_N_ROTATE_TILE?T.concat(y[(A+I)%2]):c===w.b.FLIP_ROW||c===w.b.ROTATE_ROW||c===w.b.FLIP_N_ROTATE_ROW?T.concat(y[A%2]):T.concat(y[0]),z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const k=0===y.sideOrientation?0:y.sideOrientation||p.b.DEFAULTSIDE;p.b._ComputeSides(k,C,S,K,T,y.frontUVs,y.backUVs);const a=new p.b;a.indices=S,a.zy=C,a.Sy=K,a.ky=T;const u=k===p.b.DOUBLESIDE?z.concat(z):z;return a.My=u,a}function i(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new w.b(y,A);c.sideOrientation=w.b._GetDefaultSideOrientation(c.sideOrientation),l._originalBuilderSideOrientation=c.sideOrientation;return L(c).Gy(l,c.updatable),l}function H(y){const c=y.faceUV||new Array(6),A=y.faceColors,N=y.pattern||w.b.NO_FLIP,h=y.width||y.size||1,I=y.height||y.size||1,q=y.depth||y.size||1,o=y.tileWidth||y.tileSize||1,i=y.tileHeight||y.tileSize||1,H=y.alignHorizontal||0,P=y.alignVertical||0,D=0===y.sideOrientation?0:y.sideOrientation||p.b.DEFAULTSIDE;for(let w=0;w<6;w++)void 0===c[w]&&(c[w]=new l.Vector4(0,0,1,1)),A&&void 0===A[w]&&(A[w]=new O.ip(1,1,1,1));const t=h/2,s=I/2,B=q/2,X=[];for(let l=0;l<2;l++)X[l]=L({pattern:N,tileWidth:o,tileHeight:i,width:h,height:I,alignVertical:P,alignHorizontal:H,sideOrientation:D});for(let l=2;l<4;l++)X[l]=L({pattern:N,tileWidth:o,tileHeight:i,width:q,height:I,alignVertical:P,alignHorizontal:H,sideOrientation:D});let C=P;P===w.b.BOTTOM?C=w.b.TOP:P===w.b.TOP&&(C=w.b.BOTTOM);for(let l=4;l<6;l++)X[l]=L({pattern:N,tileWidth:o,tileHeight:i,width:h,height:q,alignVertical:C,alignHorizontal:H,sideOrientation:D});let K=[],my=[],T=[],z=[];const S=[],M=[],k=[],a=[];let u=0,G=0;for(let w=0;w<6;w++){const y=X[w].zy.length;M[w]=[],k[w]=[];for(let c=0;c<y/3;c++)M[w].push(new l.gc(X[w].zy[3*c],X[w].zy[3*c+1],X[w].zy[3*c+2])),k[w].push(new l.gc(X[w].Sy[3*c],X[w].Sy[3*c+1],X[w].Sy[3*c+2]));u=X[w].ky.length,a[w]=[];for(let A=0;A<u;A+=2)a[w][A]=c[w].x+(c[w].z-c[w].x)*X[w].ky[A],a[w][A+1]=c[w].y+(c[w].w-c[w].y)*X[w].ky[A+1],W.b&&(a[w][A+1]=1-a[w][A+1]);if(T=T.concat(a[w]),z=z.concat(X[w].indices.map((y=>y+G))),G+=M[w].length,A)for(let c=0;c<4;c++)S.push(A[w].r,A[w].g,A[w].b,A[w].a)}const j=new l.gc(0,0,B),f=l.Matrix.RotationY(Math.PI);K=M[0].map((y=>l.gc.TransformNormal(y,f).add(j))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[]),my=k[0].map((y=>l.gc.TransformNormal(y,f))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[]),K=K.concat(M[1].map((y=>y.xc(j))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[])),my=my.concat(k[1].map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[]));const V=new l.gc(t,0,0),J=l.Matrix.RotationY(-Math.PI/2);K=K.concat(M[2].map((y=>l.gc.TransformNormal(y,J).add(V))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[])),my=my.concat(k[2].map((y=>l.gc.TransformNormal(y,J))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[]));const U=l.Matrix.RotationY(Math.PI/2);K=K.concat(M[3].map((y=>l.gc.TransformNormal(y,U).xc(V))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[])),my=my.concat(k[3].map((y=>l.gc.TransformNormal(y,U))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[]));const e=new l.gc(0,s,0),Q=l.Matrix.RotationX(Math.PI/2);K=K.concat(M[4].map((y=>l.gc.TransformNormal(y,Q).add(e))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[])),my=my.concat(k[4].map((y=>l.gc.TransformNormal(y,Q))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[]));const Y=l.Matrix.RotationX(-Math.PI/2);K=K.concat(M[5].map((y=>l.gc.TransformNormal(y,Y).xc(e))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[])),my=my.concat(k[5].map((y=>l.gc.TransformNormal(y,Y))).map((y=>[y.x,y.y,y.z])).reduce(((y,c)=>y.concat(c)),[])),p.b._ComputeSides(D,K,z,my,T);const g=new p.b;if(g.indices=z,g.zy=K,g.Sy=my,g.ky=T,A){const y=D===p.b.DOUBLESIDE?S.concat(S):S;g.My=y}return g}function P(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new w.b(y,A);c.sideOrientation=w.b._GetDefaultSideOrientation(c.sideOrientation),l._originalBuilderSideOrientation=c.sideOrientation;return H(c).Gy(l,c.updatable),l}p.b.CreateTiledPlane=L;p.b.CreateTiledBox=H;var D=A(13635),t=A(12553),s=A(12521);function B(y){const c=y.height||2;let A=0===y.diameterTop?0:y.diameterTop||y.diameter||1,N=0===y.diameterBottom?0:y.diameterBottom||y.diameter||1;A=A||1e-5,N=N||1e-5;const h=0|(y.tessellation||24),I=0|(y.subdivisions||1),q=!!y.hasRings,o=!!y.enclose,L=0===y.cap?0:y.cap||w.b.CAP_ALL,i=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1,H=0===y.sideOrientation?0:y.sideOrientation||p.b.DEFAULTSIDE,P=y.faceUV||new Array(3),D=y.faceColors,t=2+(1+(1!==i&&o?2:0))*(q?I:1);let B;for(B=0;B<t;B++)D&&void 0===D[B]&&(D[B]=new O.ip(1,1,1,1));for(B=0;B<t;B++)P&&void 0===P[B]&&(P[B]=new l.Vector4(0,0,1,1));const X=[],C=[],K=[],my=[],T=[],z=2*Math.PI*i/h;let S,M,k;const a=(N-A)/2/c,u=l.gc.Zero(),G=l.gc.Zero(),j=l.gc.Zero(),f=l.gc.Zero(),V=l.gc.Zero(),J=s.c.Y;let U,e,Q,Y=1,g=1,x=0,F=0;for(U=0;U<=I;U++)for(M=U/I,k=(M*(A-N)+N)/2,Y=q&&0!==U&&U!==I?2:1,Q=0;Q<Y;Q++){for(q&&(g+=Q),o&&(g+=2*Q),e=0;e<=h;e++)S=e*z,u.x=Math.cos(-S)*k,u.y=-c/2+M*c,u.z=Math.sin(-S)*k,0===A&&U===I?(G.x=K[K.length-3*(h+1)],G.y=K[K.length-3*(h+1)+1],G.z=K[K.length-3*(h+1)+2]):(G.x=u.x,G.z=u.z,G.y=Math.sqrt(G.x*G.x+G.z*G.z)*a,G.normalize()),0===e&&(j.p(u),f.p(G)),C.push(u.x,u.y,u.z),K.push(G.x,G.y,G.z),F=q?x!==g?P[g].y:P[g].w:P[g].y+(P[g].w-P[g].y)*M,my.push(P[g].x+(P[g].z-P[g].x)*e/h,W.b?1-F:F),D&&T.push(D[g].r,D[g].g,D[g].b,D[g].a);1!==i&&o&&(C.push(u.x,u.y,u.z),C.push(0,u.y,0),C.push(0,u.y,0),C.push(j.x,j.y,j.z),l.gc.CrossToRef(J,G,V),V.normalize(),K.push(V.x,V.y,V.z,V.x,V.y,V.z),l.gc.CrossToRef(f,J,V),V.normalize(),K.push(V.x,V.y,V.z,V.x,V.y,V.z),F=q?x!==g?P[g+1].y:P[g+1].w:P[g+1].y+(P[g+1].w-P[g+1].y)*M,my.push(P[g+1].x,W.b?1-F:F),my.push(P[g+1].z,W.b?1-F:F),F=q?x!==g?P[g+2].y:P[g+2].w:P[g+2].y+(P[g+2].w-P[g+2].y)*M,my.push(P[g+2].x,W.b?1-F:F),my.push(P[g+2].z,W.b?1-F:F),D&&(T.push(D[g+1].r,D[g+1].g,D[g+1].b,D[g+1].a),T.push(D[g+1].r,D[g+1].g,D[g+1].b,D[g+1].a),T.push(D[g+2].r,D[g+2].g,D[g+2].b,D[g+2].a),T.push(D[g+2].r,D[g+2].g,D[g+2].b,D[g+2].a))),x!==g&&(x=g)}const R=1!==i&&o?h+4:h;for(U=0,g=0;g<I;g++){let y=0,c=0,A=0,l=0;for(e=0;e<h;e++)y=U*(R+1)+e,c=(U+1)*(R+1)+e,A=U*(R+1)+(e+1),l=(U+1)*(R+1)+(e+1),X.push(y,c,A),X.push(l,A,c);1!==i&&o&&(X.push(y+2,c+2,A+2),X.push(l+2,A+2,c+2),X.push(y+4,c+4,A+4),X.push(l+4,A+4,c+4)),U=q?U+2:U+1}const r=y=>{const w=y?A/2:N/2;if(0===w)return;let p,I,q;const o=y?P[t-1]:P[0];let O=null;D&&(O=y?D[t-1]:D[0]);const L=C.length/3,H=y?c/2:-c/2,s=new l.gc(0,H,0);C.push(s.x,s.y,s.z),K.push(0,y?1:-1,0);const B=o.y+.5*(o.w-o.y);my.push(o.x+.5*(o.z-o.x),W.b?1-B:B),O&&T.push(O.r,O.g,O.b,O.a);const z=new l.Vector2(.5,.5);for(q=0;q<=h;q++){p=2*Math.PI*q*i/h;const c=Math.cos(-p),A=Math.sin(-p);I=new l.gc(c*w,H,A*w);const N=new l.Vector2(c*z.x+.5,A*z.y+.5);C.push(I.x,I.y,I.z),K.push(0,y?1:-1,0);const L=o.y+(o.w-o.y)*N.y;my.push(o.x+(o.z-o.x)*N.x,W.b?1-L:L),O&&T.push(O.r,O.g,O.b,O.a)}for(q=0;q<h;q++)y?(X.push(L),X.push(L+(q+2)),X.push(L+(q+1))):(X.push(L),X.push(L+(q+1)),X.push(L+(q+2)))};L!==w.b.CAP_START&&L!==w.b.CAP_ALL||r(!1),L!==w.b.CAP_END&&L!==w.b.CAP_ALL||r(!0),p.b._ComputeSides(H,C,X,K,my,y.frontUVs,y.backUVs);const n=new p.b;return n.indices=X,n.zy=C,n.Sy=K,n.ky=my,D&&(n.My=T),n}function X(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const l=new w.b(y,A);c.sideOrientation=w.b._GetDefaultSideOrientation(c.sideOrientation),l._originalBuilderSideOrientation=c.sideOrientation;return B(c).Gy(l,c.updatable),l}function C(y){const c=[],A=[],w=[],N=[],h=y.diameter||1,I=y.thickness||.5,q=0|(y.tessellation||16),o=0===y.sideOrientation?0:y.sideOrientation||p.b.DEFAULTSIDE,O=q+1;for(let p=0;p<=q;p++){const y=p/q,o=p*Math.PI*2/q-Math.PI/2,L=l.Matrix.Translation(h/2,0,0).multiply(l.Matrix.RotationY(o));for(let h=0;h<=q;h++){const o=1-h/q,i=h*Math.PI*2/q+Math.PI,H=Math.cos(i),P=Math.sin(i);let D=new l.gc(H,P,0),t=D.scale(I/2);const s=new l.Vector2(y,o);t=l.gc.TransformCoordinates(t,L),D=l.gc.TransformNormal(D,L),A.push(t.x,t.y,t.z),w.push(D.x,D.y,D.z),N.push(s.x,W.b?1-s.y:s.y);const B=(p+1)%O,X=(h+1)%O;c.push(p*O+h),c.push(p*O+X),c.push(B*O+h),c.push(p*O+X),c.push(B*O+X),c.push(B*O+h)}}p.b._ComputeSides(o,A,c,w,N,y.frontUVs,y.backUVs);const L=new p.b;return L.indices=c,L.zy=A,L.Sy=w,L.ky=N,L}function K(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const l=new w.b(y,A);c.sideOrientation=w.b._GetDefaultSideOrientation(c.sideOrientation),l._originalBuilderSideOrientation=c.sideOrientation;return C(c).Gy(l,c.updatable),l}p.b.CreateCylinder=B,w.b.CreateCylinder=(y,c,A,l,N,p,W,h,I)=>{void 0!==W&&W instanceof t.b||(void 0!==W&&(I=h||w.b.DEFAULTSIDE,h=W),W=p,p=1);return X(y,{height:c,diameterTop:A,diameterBottom:l,tessellation:N,subdivisions:p,sideOrientation:I,updatable:h},W)};function my(y){const c=[],A=[],w=[],N=[],h=y.radius||2,I=y.tube||.5,q=y.radialSegments||32,o=y.tubularSegments||32,O=y.p||2,L=y.q||3,i=0===y.sideOrientation?0:y.sideOrientation||p.b.DEFAULTSIDE,H=y=>{const c=Math.cos(y),A=Math.sin(y),w=L/O*y,N=Math.cos(w),p=h*(2+N)*.5*c,W=h*(2+N)*A*.5,I=h*Math.sin(w)*.5;return new l.gc(p,W,I)};let P,D;for(P=0;P<=q;P++){const y=P%q/q*2*O*Math.PI,c=H(y),w=H(y+.01),p=w.xc(c);let h=w.add(c);const L=l.gc.Cross(p,h);for(h=l.gc.Cross(L,p),L.normalize(),h.normalize(),D=0;D<o;D++){const y=D%o/o*2*Math.PI,l=-I*Math.cos(y),w=I*Math.sin(y);A.push(c.x+l*h.x+w*L.x),A.push(c.y+l*h.y+w*L.y),A.push(c.z+l*h.z+w*L.z),N.push(P/q),N.push(W.b?1-D/o:D/o)}}for(P=0;P<q;P++)for(D=0;D<o;D++){const y=(D+1)%o,A=P*o+D,l=(P+1)*o+D,w=(P+1)*o+y,N=P*o+y;c.push(N),c.push(l),c.push(A),c.push(N),c.push(w),c.push(l)}p.b.ComputeNormals(A,c,w),p.b._ComputeSides(i,A,c,w,N,y.frontUVs,y.backUVs);const t=new p.b;return t.indices=c,t.zy=A,t.Sy=w,t.ky=N,t}function T(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const l=new w.b(y,A);c.sideOrientation=w.b._GetDefaultSideOrientation(c.sideOrientation),l._originalBuilderSideOrientation=c.sideOrientation;return my(c).Gy(l,c.updatable),l}p.b.CreateTorus=C,w.b.CreateTorus=(y,c,A,l,w,N,p)=>K(y,{diameter:c,thickness:A,tessellation:l,sideOrientation:p,updatable:N},w);p.b.CreateTorusKnot=my,w.b.CreateTorusKnot=(y,c,A,l,w,N,p,W,h,I)=>T(y,{radius:c,tube:A,radialSegments:l,tubularSegments:w,p:N,q:p,sideOrientation:I,updatable:h},W);var z=A(14151),S=A(12881),M=A(12529);function k(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=c.path,N=c.shape,p=c.scale||1,W=c.rotation||0,h=0===c.cap?0:c.cap||w.b.NO_CAP,I=c.updatable,q=w.b._GetDefaultSideOrientation(c.sideOrientation),o=c.instance||null,O=c.invertUV||!1,L=c.closeShape||!1,i=c.closePath||!1,H=c.capFunction||null;return u(y,N,l,p,W,null,null,i,L,h,!1,A,!!I,q,o,O,c.frontUVs||null,c.backUVs||null,c.firstNormal||null,!!c.adjustFrame,H)}function a(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=c.path,N=c.shape,p=c.scaleFunction||(()=>1),W=c.rotationFunction||(()=>0),h=c.closePath||c.ribbonCloseArray||!1,I=c.closeShape||c.ribbonClosePath||!1,q=0===c.cap?0:c.cap||w.b.NO_CAP,o=c.updatable,O=c.firstNormal||null,L=c.adjustFrame||!1,i=w.b._GetDefaultSideOrientation(c.sideOrientation),H=c.instance,P=c.invertUV||!1,D=c.capFunction||null;return u(y,N,l,null,null,p,W,h,I,q,!0,A,!!o,i,H||null,P,c.frontUVs||null,c.backUVs||null,O,L,D||null)}function u(y,c,A,N,p,W,h,q,o,O,L,i,H,P,D,t,s,B,X,C,K){const my=(y,c,A,N,p,W,h,I,q,o,O)=>{const L=A.getTangents(),i=A.getNormals(),H=A.getBinormals(),P=A.getDistances();if(O)for(let w=0;w<L.length;w++)if(0==L[w].x&&0==L[w].y&&0==L[w].z&&L[w].p(L[w-1]),0==i[w].x&&0==i[w].y&&0==i[w].z&&i[w].p(i[w-1]),0==H[w].x&&0==H[w].y&&0==H[w].z&&H[w].p(H[w-1]),w>0){let y=L[w-1];l.gc.Dot(y,L[w])<0&&L[w].scaleInPlace(-1),y=i[w-1],l.gc.Dot(y,i[w])<0&&i[w].scaleInPlace(-1),y=H[w-1],l.gc.Dot(y,H[w])<0&&H[w].scaleInPlace(-1)}let D=0;const t=o&&I?I:()=>null!==W?W:0,s=o&&h?h:()=>null!==p?p:1;let B=q===w.b.NO_CAP||q===w.b.CAP_END?0:2;const X=l.TmpVectors.Matrix[0];for(let w=0;w<c.length;w++){const A=[],p=t(w,P[w]),W=s(w,P[w]);l.Matrix.RotationAxisToRef(L[w],D,X);for(let N=0;N<y.length;N++){const p=L[w].scale(y[N].z).add(i[w].scale(y[N].x)).add(H[w].scale(y[N].y)),h=l.gc.Zero();l.gc.TransformCoordinatesToRef(p,X,h),h.scaleInPlace(W).addInPlace(c[w]),A[N]=h}N[B]=A,D+=p,B++}const C=K||(y=>{const c=Array(),A=l.gc.Zero();let w;for(w=0;w<y.length;w++)A.addInPlace(y[w]);for(A.scaleInPlace(1/y.length),w=0;w<y.length;w++)c.push(A);return c});switch(q){case w.b.NO_CAP:break;case w.b.CAP_START:N[0]=C(N[2]),N[1]=N[2];break;case w.b.CAP_END:N[B]=N[B-1],N[B+1]=C(N[B-1]);break;case w.b.CAP_ALL:N[0]=C(N[2]),N[1]=N[2],N[B]=N[B-1],N[B+1]=C(N[B-1])}return N};let T,z;if(D){const y=D._creationDataStorage;return T=X?y.path3D.update(A,X):y.path3D.update(A),z=my(c,A,y.path3D,y.pathArray,N,p,W,h,y.cap,L,C),D=I("",{pathArray:z,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:D},i||void 0)}T=X?new M.k(A,X):new M.k(A);z=my(c,A,T,new Array,N,p,W,h,O=O<0||O>3?0:O,L,C);const S=I(y,{pathArray:z,closeArray:q,closePath:o,updatable:H,sideOrientation:P,invertUV:t,frontUVs:s||void 0,backUVs:B||void 0},i);return S._creationDataStorage.pathArray=z,S._creationDataStorage.path3D=T,S._creationDataStorage.cap=O,S}function G(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=c.arc?c.arc<=0||c.arc>1?1:c.arc:1,p=void 0===c.closed||c.closed,W=c.shape,h=c.radius||1,q=c.tessellation||64,o=c.clip||0,O=c.updatable,L=w.b._GetDefaultSideOrientation(c.sideOrientation),i=c.cap||w.b.NO_CAP,H=2*Math.PI,P=[],D=c.invertUV||!1;let t=0,s=0;const B=H/q*N;let X,C;for(t=0;t<=q-o;t++){for(C=[],i!=w.b.CAP_START&&i!=w.b.CAP_ALL||(C.push(new l.gc(0,W[0].y,0)),C.push(new l.gc(Math.cos(t*B)*W[0].x*h,W[0].y,Math.sin(t*B)*W[0].x*h))),s=0;s<W.length;s++)X=new l.gc(Math.cos(t*B)*W[s].x*h,W[s].y,Math.sin(t*B)*W[s].x*h),C.push(X);i!=w.b.CAP_END&&i!=w.b.CAP_ALL||(C.push(new l.gc(Math.cos(t*B)*W[W.length-1].x*h,W[W.length-1].y,Math.sin(t*B)*W[W.length-1].x*h)),C.push(new l.gc(0,W[W.length-1].y,0))),P.push(C)}return I(y,{pathArray:P,closeArray:p,sideOrientation:L,updatable:O,invertUV:D,frontUVs:c.frontUVs,backUVs:c.backUVs},A)}w.b.ExtrudeShape=function(y,c,A,l,N,p){let W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7?arguments[7]:void 0,I=arguments.length>8?arguments[8]:void 0,q=arguments.length>9?arguments[9]:void 0;return k(y,{shape:c,path:A,scale:l,rotation:N,cap:0===p?0:p||w.b.NO_CAP,sideOrientation:I,instance:q,updatable:h},W)},w.b.ExtrudeShapeCustom=(y,c,A,l,N,p,W,h,I,q,o,O)=>a(y,{shape:c,path:A,scaleFunction:l,rotationFunction:N,ribbonCloseArray:p,ribbonClosePath:W,cap:0===h?0:h||w.b.NO_CAP,sideOrientation:o,instance:O,updatable:q},I);w.b.CreateLathe=(y,c,A,l,w,N,p)=>G(y,{shape:c,radius:A,tessellation:l,sideOrientation:p,updatable:N},w);var j=A(13562),f=A(13516);function V(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=c.path;let p=c.instance,W=1;void 0!==c.radius?W=c.radius:p&&(W=p._creationDataStorage.radius);const h=c.tessellation||64,q=c.radiusFunction||null;let o=c.cap||w.b.NO_CAP;const O=c.invertUV||!1,L=c.updatable,i=w.b._GetDefaultSideOrientation(c.sideOrientation);c.arc=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1;const H=(y,c,A,N,p,W,h,I)=>{const q=c.getTangents(),o=c.getNormals(),O=c.getDistances(),L=2*Math.PI/p*I,i=W||(()=>N);let H,P,D,t;const s=l.TmpVectors.Matrix[0];let B=h===w.b.NO_CAP||h===w.b.CAP_END?0:2;for(let w=0;w<y.length;w++){P=i(w,O[w]),H=Array(),D=o[w];for(let c=0;c<p;c++)l.Matrix.RotationAxisToRef(q[w],L*c,s),t=H[c]?H[c]:l.gc.Zero(),l.gc.TransformCoordinatesToRef(D,s,t),t.scaleInPlace(P).addInPlace(y[w]),H[c]=t;A[B]=H,B++}const X=(c,A)=>{const l=Array();for(let w=0;w<c;w++)l.push(y[A]);return l};switch(h){case w.b.NO_CAP:break;case w.b.CAP_START:A[0]=X(p,0),A[1]=A[2].slice(0);break;case w.b.CAP_END:A[B]=A[B-1].slice(0),A[B+1]=X(p,y.length-1);break;case w.b.CAP_ALL:A[0]=X(p,0),A[1]=A[2].slice(0),A[B]=A[B-1].slice(0),A[B+1]=X(p,y.length-1)}return A};let P,D;if(p){const y=p._creationDataStorage,A=c.arc||y.arc;return P=y.path3D.update(N),D=H(N,P,y.pathArray,W,y.tessellation,q,y.cap,A),p=I("",{pathArray:D,instance:p}),y.path3D=P,y.pathArray=D,y.arc=A,y.radius=W,p}P=new M.k(N);o=o<0||o>3?0:o,D=H(N,P,new Array,W,h,q,o,c.arc);const t=I(y,{pathArray:D,closePath:!0,closeArray:!1,updatable:L,sideOrientation:i,invertUV:O,frontUVs:c.frontUVs,backUVs:c.backUVs},A);return t._creationDataStorage.pathArray=D,t._creationDataStorage.path3D=P,t._creationDataStorage.tessellation=h,t._creationDataStorage.cap=o,t._creationDataStorage.arc=c.arc,t._creationDataStorage.radius=W,t}function J(y){const c=[];c[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},c[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},c[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},c[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},c[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},c[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},c[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},c[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},c[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},c[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},c[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},c[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},c[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},c[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},c[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const A=y.type&&(y.type<0||y.type>=c.length)?0:y.type||0,w=y.size,N=y.sizeX||w||1,h=y.sizeY||w||1,I=y.sizeZ||w||1,q=y.custom||c[A],o=q.face.length,L=y.faceUV||new Array(o),i=y.faceColors,H=void 0===y.flat||y.flat,P=0===y.sideOrientation?0:y.sideOrientation||p.b.DEFAULTSIDE,D=[],t=[],s=[],B=[],X=[];let C=0,K=0;const my=[];let T,z,S,M,k,a,u=0,G=0;if(H)for(G=0;G<o;G++)i&&void 0===i[G]&&(i[G]=new O.ip(1,1,1,1)),L&&void 0===L[G]&&(L[G]=new l.Vector4(0,0,1,1));if(H)for(G=0;G<o;G++){const y=q.face[G].length;for(S=2*Math.PI/y,M=.5*Math.tan(S/2),k=.5,u=0;u<y;u++)D.push(q.vertex[q.face[G][u]][0]*N,q.vertex[q.face[G][u]][1]*h,q.vertex[q.face[G][u]][2]*I),my.push(C),C++,T=L[G].x+(L[G].z-L[G].x)*(.5+M),z=L[G].y+(L[G].w-L[G].y)*(k-.5),B.push(T,W.b?1-z:z),a=M*Math.cos(S)-k*Math.sin(S),k=M*Math.sin(S)+k*Math.cos(S),M=a,i&&X.push(i[G].r,i[G].g,i[G].b,i[G].a);for(u=0;u<y-2;u++)t.push(my[0+K],my[u+2+K],my[u+1+K]);K+=y}else{for(u=0;u<q.vertex.length;u++)D.push(q.vertex[u][0]*N,q.vertex[u][1]*h,q.vertex[u][2]*I),B.push(0,W.b?1:0);for(G=0;G<o;G++)for(u=0;u<q.face[G].length-2;u++)t.push(q.face[G][0],q.face[G][u+2],q.face[G][u+1])}p.b.ComputeNormals(D,t,s),p.b._ComputeSides(P,D,t,s,B,y.frontUVs,y.backUVs);const j=new p.b;return j.zy=D,j.indices=t,j.Sy=s,j.ky=B,i&&H&&(j.My=X),j}function U(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new w.b(y,A);c.sideOrientation=w.b._GetDefaultSideOrientation(c.sideOrientation),l._originalBuilderSideOrientation=c.sideOrientation;return J(c).Gy(l,c.updatable),l}w.b.CreateTube=(y,c,A,l,w,N,p,W,h,I)=>V(y,{path:c,radius:A,tessellation:l,radiusFunction:w,arc:1,cap:N,updatable:W,sideOrientation:h,instance:I},p);function e(y){const c=y.sideOrientation||p.b.DEFAULTSIDE,A=y.radius||1,w=void 0===y.flat||y.flat,N=0|(y.subdivisions||4),h=y.radiusX||A,I=y.radiusY||A,q=y.radiusZ||A,o=(1+Math.sqrt(5))/2,O=[-1,o,-0,1,o,0,-1,-o,0,1,-o,0,0,-1,-o,0,1,-o,0,-1,o,0,1,o,o,0,1,o,0,-1,-o,0,1,-o,0,-1],L=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],i=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],H=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],P=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],D=[],t=[],s=[],B=[];let X=0;const C=new Array(3),K=new Array(3);let my;for(my=0;my<3;my++)C[my]=l.gc.Zero(),K[my]=l.Vector2.Zero();for(let p=0;p<20;p++){for(my=0;my<3;my++){const y=L[3*p+my];C[my].Ec(O[3*i[y]],O[3*i[y]+1],O[3*i[y]+2]),C[my].normalize(),K[my].Ec(.134765625*H[2*y]+.05859375+-.0390625*P[p],.2333984375*H[2*y+1]+.025390625+.01953125*P[p])}const y=(y,c,A,p)=>{const o=l.gc.Lerp(C[0],C[2],c/N),O=l.gc.Lerp(C[1],C[2],c/N),L=N===c?C[2]:l.gc.Lerp(o,O,y/(N-c));let i;if(L.normalize(),w){const y=l.gc.Lerp(C[0],C[2],p/N),c=l.gc.Lerp(C[1],C[2],p/N);i=l.gc.Lerp(y,c,A/(N-p))}else i=new l.gc(L.x,L.y,L.z);i.x/=h,i.y/=I,i.z/=q,i.normalize();const H=l.Vector2.Lerp(K[0],K[2],c/N),P=l.Vector2.Lerp(K[1],K[2],c/N),my=N===c?K[2]:l.Vector2.Lerp(H,P,y/(N-c));t.push(L.x*h,L.y*I,L.z*q),s.push(i.x,i.y,i.z),B.push(my.x,W.b?1-my.y:my.y),D.push(X),X++};for(let c=0;c<N;c++)for(let A=0;A+c<N;A++)y(A,c,A+1/3,c+1/3),y(A+1,c,A+1/3,c+1/3),y(A,c+1,A+1/3,c+1/3),A+c+1<N&&(y(A+1,c,A+2/3,c+2/3),y(A+1,c+1,A+2/3,c+2/3),y(A,c+1,A+2/3,c+2/3))}p.b._ComputeSides(c,t,D,s,B,y.frontUVs,y.backUVs);const T=new p.b;return T.indices=D,T.zy=t,T.Sy=s,T.ky=B,T}function Q(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new w.b(y,A);c.sideOrientation=w.b._GetDefaultSideOrientation(c.sideOrientation),l._originalBuilderSideOrientation=c.sideOrientation;return e(c).Gy(l,c.updatable),l}p.b.CreatePolyhedron=J,w.b.CreatePolyhedron=(y,c,A)=>U(y,c,A);p.b.CreateIcoSphere=e,w.b.CreateIcoSphere=(y,c,A)=>Q(y,c,A);var Y=A(12340);const g=new l.gc(1,0,0),x=new l.gc(-1,0,0),F=new l.gc(0,1,0),R=new l.gc(0,-1,0),r=new l.gc(0,0,1),n=new l.gc(0,0,-1);class E{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.gc.Zero(),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.gc.Up(),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.Vector2.Zero(),w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=y,this.normal=c,this.uv=A,this.vertexIdx=w,this.vertexIdxForBones=N,this.localPositionOverride=p,this.localNormalOverride=W,this.matrixIndicesOverride=h,this.matrixWeightsOverride=I}clone(){var y,c,A,l;return new E(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(y=this.localPositionOverride)||void 0===y?void 0:y.slice(),null===(c=this.localNormalOverride)||void 0===c?void 0:c.slice(),null===(A=this.matrixIndicesOverride)||void 0===A?void 0:A.slice(),null===(l=this.matrixWeightsOverride)||void 0===l?void 0:l.slice())}}function b(y,c,A){var h,I,q,o,O;const L=!!c.skeleton,i=!(null===(h=c.morphTargetManager)||void 0===h||!h.numTargets),H=A.localMode||L,P=c.rc(),D=L||i?c.rW(!0,!0):c.getVerticesData(N.e.PositionKind),t=L||i?c.getNormalsData(!0,!0):c.getVerticesData(N.e.NormalKind),s=H?L?c.getVerticesData(N.e.PositionKind):D:null,B=H?L?c.getVerticesData(N.e.NormalKind):t:null,X=c.getVerticesData(N.e.UVKind),C=L?c.getVerticesData(N.e.MatricesIndicesKind):null,K=L?c.getVerticesData(N.e.MatricesWeightsKind):null,my=L?c.getVerticesData(N.e.MatricesIndicesExtraKind):null,T=L?c.getVerticesData(N.e.MatricesWeightsExtraKind):null,z=A.position||l.gc.Zero();let S=A.normal||l.gc.Up();const M=A.size||l.gc.One(),k=A.angle||0;if(!S){const y=new l.gc(0,0,1),A=c.mc().activeCamera,w=l.gc.TransformCoordinates(y,A.getWorldMatrix());S=A.globalPosition.xc(w)}const a=-Math.atan2(S.z,S.x)-Math.PI/2,u=Math.sqrt(S.x*S.x+S.z*S.z),G=Math.atan2(S.y,u),j=new p.b;j.indices=[],j.zy=[],j.Sy=[],j.ky=[],j.matricesIndices=L?[]:null,j.matricesWeights=L?[]:null,j.matricesIndicesExtra=my?[]:null,j.matricesWeightsExtra=T?[]:null;let f=0;const V=(y,c)=>{const w=new E;if(!P||!D||!t)return w;const N=P[y];if(w.vertexIdx=3*N,w.vertexIdxForBones=4*N,w.position=new l.gc(D[3*N],D[3*N+1],D[3*N+2]),l.gc.TransformCoordinatesToRef(w.position,c,w.position),w.normal=new l.gc(t[3*N],t[3*N+1],t[3*N+2]),l.gc.TransformNormalToRef(w.normal,c,w.normal),A.captureUVS&&X){const y=X[2*N+1];w.uv=new l.Vector2(X[2*N],W.b?1-y:y)}return w},J=[0,0,0,0],U=(y,c)=>{if(0===y.length)return y;const A=.5*Math.abs(l.gc.Dot(M,c)),w=(y,c,A,l)=>{for(let w=0;w<l;++w)if(y[A+w]===c)return A+w;return-1},N=(y,N)=>{const p=l.gc.GetClipFactor(y.position,N.position,c,A);let W=J,h=J;if(C&&K){const c=y.matrixIndicesOverride?0:y.vertexIdxForBones,A=y.matrixIndicesOverride??C,l=y.matrixWeightsOverride??K,I=N.matrixIndicesOverride?0:N.vertexIdxForBones,q=N.matrixIndicesOverride??C,o=N.matrixWeightsOverride??K;W=[0,0,0,0],h=[0,0,0,0];let O=0;for(let y=0;y<4;++y)if(l[c+y]>0){const N=w(q,A[c+y],I,4);W[O]=A[c+y],h[O]=(0,Y.Lerp)(l[c+y],N>=0?o[N]:0,p),O++}for(let y=0;y<4&&O<4;++y){const l=q[I+y];-1===w(A,l,c,4)&&(W[O]=l,h[O]=(0,Y.Lerp)(0,o[I+y],p),O++)}const L=h[0]+h[1]+h[2]+h[3];h[0]/=L,h[1]/=L,h[2]/=L,h[3]/=L}const I=y.localPositionOverride?y.localPositionOverride[0]:(null===s||void 0===s?void 0:s[y.vertexIdx])??0,q=y.localPositionOverride?y.localPositionOverride[1]:(null===s||void 0===s?void 0:s[y.vertexIdx+1])??0,o=y.localPositionOverride?y.localPositionOverride[2]:(null===s||void 0===s?void 0:s[y.vertexIdx+2])??0,O=N.localPositionOverride?N.localPositionOverride[0]:(null===s||void 0===s?void 0:s[N.vertexIdx])??0,L=N.localPositionOverride?N.localPositionOverride[1]:(null===s||void 0===s?void 0:s[N.vertexIdx+1])??0,i=N.localPositionOverride?N.localPositionOverride[2]:(null===s||void 0===s?void 0:s[N.vertexIdx+2])??0,H=y.localNormalOverride?y.localNormalOverride[0]:(null===B||void 0===B?void 0:B[y.vertexIdx])??0,P=y.localNormalOverride?y.localNormalOverride[1]:(null===B||void 0===B?void 0:B[y.vertexIdx+1])??0,D=y.localNormalOverride?y.localNormalOverride[2]:(null===B||void 0===B?void 0:B[y.vertexIdx+2])??0,t=H+((N.localNormalOverride?N.localNormalOverride[0]:(null===B||void 0===B?void 0:B[N.vertexIdx])??0)-H)*p,X=P+((N.localNormalOverride?N.localNormalOverride[1]:(null===B||void 0===B?void 0:B[N.vertexIdx+1])??0)-P)*p,my=D+((N.localNormalOverride?N.localNormalOverride[2]:(null===B||void 0===B?void 0:B[N.vertexIdx+2])??0)-D)*p,T=Math.sqrt(t*t+X*X+my*my);return new E(l.gc.Lerp(y.position,N.position,p),l.gc.Lerp(y.normal,N.normal,p).normalize(),l.Vector2.Lerp(y.uv,N.uv,p),-1,-1,s?[I+(O-I)*p,q+(L-q)*p,o+(i-o)*p]:null,B?[t/T,X/T,my/T]:null,W,h)};let p=null;y.length>3&&(p=[]);for(let W=0;W<y.length;W+=3){let w=0,h=null,I=null,q=null,o=null;const O=l.gc.Dot(y[W].position,c)-A>0,L=l.gc.Dot(y[W+1].position,c)-A>0,i=l.gc.Dot(y[W+2].position,c)-A>0;switch(w=(O?1:0)+(L?1:0)+(i?1:0),w){case 0:y.length>3?(p.push(y[W]),p.push(y[W+1]),p.push(y[W+2])):p=y;break;case 1:if(p=p??new Array,O&&(h=y[W+1],I=y[W+2],q=N(y[W],h),o=N(y[W],I)),L){h=y[W],I=y[W+2],q=N(y[W+1],h),o=N(y[W+1],I),p.push(q),p.push(I.clone()),p.push(h.clone()),p.push(I.clone()),p.push(q.clone()),p.push(o);break}i&&(h=y[W],I=y[W+1],q=N(y[W+2],h),o=N(y[W+2],I)),h&&I&&q&&o&&(p.push(h.clone()),p.push(I.clone()),p.push(q),p.push(o),p.push(q.clone()),p.push(I.clone()));break;case 2:p=p??new Array,O||(h=y[W].clone(),I=N(h,y[W+1]),q=N(h,y[W+2]),p.push(h),p.push(I),p.push(q)),L||(h=y[W+1].clone(),I=N(h,y[W+2]),q=N(h,y[W]),p.push(h),p.push(I),p.push(q)),i||(h=y[W+2].clone(),I=N(h,y[W]),q=N(h,y[W+1]),p.push(h),p.push(I),p.push(q))}}return p},e=c instanceof w.b?c:null,Q=null===e||void 0===e?void 0:e._thinInstanceDataStorage.matrixData,b=(null===e||void 0===e?void 0:e.dp)||1,Z=l.TmpVectors.Matrix[0];Z.p(l.Matrix.IdentityReadOnly);for(let w=0;w<b;++w){if(null!==e&&void 0!==e&&e.hasThinInstances&&Q){const y=16*w;Z.setRowFromFloats(0,Q[y+0],Q[y+1],Q[y+2],Q[y+3]),Z.setRowFromFloats(1,Q[y+4],Q[y+5],Q[y+6],Q[y+7]),Z.setRowFromFloats(2,Q[y+8],Q[y+9],Q[y+10],Q[y+11]),Z.setRowFromFloats(3,Q[y+12],Q[y+13],Q[y+14],Q[y+15])}const y=l.Matrix.RotationYawPitchRoll(a,G,k).multiply(l.Matrix.Translation(z.x,z.y,z.z)),N=l.Matrix.Invert(y),p=c.getWorldMatrix(),h=Z.multiply(p).multiply(N),I=new Array(3);for(let c=0;c<P.length;c+=3){let y=I;if(y[0]=V(c,h),y[1]=V(c+1,h),y[2]=V(c+2,h),!(A.cullBackFaces&&-y[0].normal.z<=0&&-y[1].normal.z<=0&&-y[2].normal.z<=0)&&(y=U(y,g),y&&(y=U(y,x),y&&(y=U(y,F),y&&(y=U(y,R),y&&(y=U(y,r),y&&(y=U(y,n),y)))))))for(let c=0;c<y.length;c++){const l=y[c];if(j.indices.push(f),H?(l.localPositionOverride?(j.zy[3*f]=l.localPositionOverride[0],j.zy[3*f+1]=l.localPositionOverride[1],j.zy[3*f+2]=l.localPositionOverride[2]):s&&(j.zy[3*f]=s[l.vertexIdx],j.zy[3*f+1]=s[l.vertexIdx+1],j.zy[3*f+2]=s[l.vertexIdx+2]),l.localNormalOverride?(j.Sy[3*f]=l.localNormalOverride[0],j.Sy[3*f+1]=l.localNormalOverride[1],j.Sy[3*f+2]=l.localNormalOverride[2]):B&&(j.Sy[3*f]=B[l.vertexIdx],j.Sy[3*f+1]=B[l.vertexIdx+1],j.Sy[3*f+2]=B[l.vertexIdx+2])):(l.position.toArray(j.zy,3*f),l.normal.toArray(j.Sy,3*f)),j.matricesIndices&&j.matricesWeights&&(l.matrixIndicesOverride?(j.matricesIndices[4*f]=l.matrixIndicesOverride[0],j.matricesIndices[4*f+1]=l.matrixIndicesOverride[1],j.matricesIndices[4*f+2]=l.matrixIndicesOverride[2],j.matricesIndices[4*f+3]=l.matrixIndicesOverride[3]):(C&&(j.matricesIndices[4*f]=C[l.vertexIdxForBones],j.matricesIndices[4*f+1]=C[l.vertexIdxForBones+1],j.matricesIndices[4*f+2]=C[l.vertexIdxForBones+2],j.matricesIndices[4*f+3]=C[l.vertexIdxForBones+3]),my&&j.matricesIndicesExtra&&(j.matricesIndicesExtra[4*f]=my[l.vertexIdxForBones],j.matricesIndicesExtra[4*f+1]=my[l.vertexIdxForBones+1],j.matricesIndicesExtra[4*f+2]=my[l.vertexIdxForBones+2],j.matricesIndicesExtra[4*f+3]=my[l.vertexIdxForBones+3])),l.matrixWeightsOverride?(j.matricesWeights[4*f]=l.matrixWeightsOverride[0],j.matricesWeights[4*f+1]=l.matrixWeightsOverride[1],j.matricesWeights[4*f+2]=l.matrixWeightsOverride[2],j.matricesWeights[4*f+3]=l.matrixWeightsOverride[3]):(K&&(j.matricesWeights[4*f]=K[l.vertexIdxForBones],j.matricesWeights[4*f+1]=K[l.vertexIdxForBones+1],j.matricesWeights[4*f+2]=K[l.vertexIdxForBones+2],j.matricesWeights[4*f+3]=K[l.vertexIdxForBones+3]),T&&j.matricesWeightsExtra&&(j.matricesWeightsExtra[4*f]=T[l.vertexIdxForBones],j.matricesWeightsExtra[4*f+1]=T[l.vertexIdxForBones+1],j.matricesWeightsExtra[4*f+2]=T[l.vertexIdxForBones+2],j.matricesWeightsExtra[4*f+3]=T[l.vertexIdxForBones+3]))),A.captureUVS)l.uv.toArray(j.ky,2*f);else{j.ky.push(.5+l.position.x/M.x);const y=.5+l.position.y/M.y;j.ky.push(W.b?1-y:y)}f++}}}0===j.indices.length&&(j.indices=null),0===j.zy.length&&(j.zy=null),0===j.Sy.length&&(j.Sy=null),0===j.ky.length&&(j.ky=null),0===(null===(I=j.matricesIndices)||void 0===I?void 0:I.length)&&(j.matricesIndices=null),0===(null===(q=j.matricesWeights)||void 0===q?void 0:q.length)&&(j.matricesWeights=null),0===(null===(o=j.matricesIndicesExtra)||void 0===o?void 0:o.length)&&(j.matricesIndicesExtra=null),0===(null===(O=j.matricesWeightsExtra)||void 0===O?void 0:O.length)&&(j.matricesWeightsExtra=null);const v=new w.b(y,c.mc());return j.Gy(v),H?(v.skeleton=c.skeleton,v.parent=c):(v.position=z.clone(),v.rotation=new l.gc(G,a,k)),v.Yc(!0),v.refreshBoundingInfo(!0,!0),v}function Z(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const c=0|Math.max(y.subdivisions?y.subdivisions:2,1),A=0|Math.max(y.tessellation?y.tessellation:16,3),w=Math.max(y.height?y.height:1,0),N=Math.max(y.radius?y.radius:.25,0),h=0|Math.max(y.capSubdivisions?y.capSubdivisions:6,1),I=A,q=c,o=Math.max(y.radiusTop?y.radiusTop:N,0),O=Math.max(y.radiusBottom?y.radiusBottom:N,0),L=w-(o+O),i=2*Math.PI,H=Math.max(y.topCapSubdivisions?y.topCapSubdivisions:h,1),P=Math.max(y.bottomCapSubdivisions?y.bottomCapSubdivisions:h,1),D=Math.acos((O-o)/w);let t=[];const s=[],B=[],X=[];let C=0;const K=[],my=.5*L,T=.5*Math.PI;let z,S;const M=l.gc.Zero(),k=l.gc.Zero(),a=Math.cos(D),u=Math.sin(D),G=new l.Vector2(o*u,my+o*a).xc(new l.Vector2(O*u,O*a-my)).length(),j=o*D+G+O*(T-D);let f=0;for(S=0;S<=H;S++){const y=[],c=T-D*(S/H);f+=o*D/H;const A=Math.cos(c),l=Math.sin(c),w=A*o;for(z=0;z<=I;z++){const c=z/I,N=c*i+0,p=Math.sin(N),h=Math.cos(N);k.x=w*p,k.y=my+l*o,k.z=w*h,s.push(k.x,k.y,k.z),M.set(A*p,l,A*h),B.push(M.x,M.y,M.z),X.push(c,W.b?f/j:1-f/j),y.push(C),C++}K.push(y)}const V=w-o-O+a*o-a*O,J=u*(O-o)/V;for(S=1;S<=q;S++){const y=[];f+=G/q;const c=u*(S*(O-o)/q+o);for(z=0;z<=I;z++){const A=z/I,l=A*i+0,w=Math.sin(l),N=Math.cos(l);k.x=c*w,k.y=my+a*o-S*V/q,k.z=c*N,s.push(k.x,k.y,k.z),M.set(w,J,N).normalize(),B.push(M.x,M.y,M.z),X.push(A,W.b?f/j:1-f/j),y.push(C),C++}K.push(y)}for(S=1;S<=P;S++){const y=[],c=T-D-(Math.PI-D)*(S/P);f+=O*D/P;const A=Math.cos(c),l=Math.sin(c),w=A*O;for(z=0;z<=I;z++){const c=z/I,N=c*i+0,p=Math.sin(N),h=Math.cos(N);k.x=w*p,k.y=l*O-my,k.z=w*h,s.push(k.x,k.y,k.z),M.set(A*p,l,A*h),B.push(M.x,M.y,M.z),X.push(c,W.b?f/j:1-f/j),y.push(C),C++}K.push(y)}for(z=0;z<I;z++)for(S=0;S<H+q+P;S++){const y=K[S][z],c=K[S+1][z],A=K[S+1][z+1],l=K[S][z+1];t.push(y),t.push(c),t.push(l),t.push(c),t.push(A),t.push(l)}if(t=t.reverse(),y.orientation&&!y.orientation.equals(l.gc.Up())){const c=new l.Matrix;y.orientation.clone().scale(.5*Math.PI).cross(l.gc.Up()).toQuaternion().toRotationMatrix(c);const A=l.gc.Zero();for(let y=0;y<s.length;y+=3)A.set(s[y],s[y+1],s[y+2]),l.gc.TransformCoordinatesToRef(A.clone(),c,A),s[y]=A.x,s[y+1]=A.y,s[y+2]=A.z}const U=new p.b;return U.zy=s,U.Sy=B,U.ky=X,U.indices=t,U}function v(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:l.gc.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new w.b(y,A);return Z(c).Gy(N,c.updatable),N}w.b.CreateDecal=(y,c,A,l,w,N)=>b(y,c,{position:A,normal:l,size:w,angle:N});w.b.CreateCapsule=(y,c,A)=>v(y,c,A),p.b.CreateCapsule=Z;var d=A(12161),yy=A(12330);class cy{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=y,this.y=c,y!==Math.floor(y)&&(y=Math.floor(y),d.c.Warn("x is not an integer, floor(x) used")),c!==Math.floor(c)&&(c=Math.floor(c),d.c.Warn("y is not an integer, floor(y) used"))}clone(){return new cy(this.x,this.y)}rotate60About(y){const c=this.x;return this.x=y.x+y.y-this.y,this.y=c+this.y-y.x,this}rotateNeg60About(y){const c=this.x;return this.x=c+this.y-y.y,this.y=y.x+y.y-c,this}rotate120(y,c){y!==Math.floor(y)&&(y=Math.floor(y),d.c.Warn("m not an integer only floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),d.c.Warn("n not an integer only floor(n) used"));const A=this.x;return this.x=y-A-this.y,this.y=c+A,this}rotateNeg120(y,c){y!==Math.floor(y)&&(y=Math.floor(y),d.c.Warn("m is not an integer, floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),d.c.Warn("n is not an integer,   floor(n) used"));const A=this.x;return this.x=this.y-c,this.y=y+c-A-this.y,this}toCartesianOrigin(y,c){const A=l.gc.Zero();return A.x=y.x+2*this.x*c+this.y*c,A.y=y.y+Math.sqrt(3)*this.y*c,A}static Zero(){return new cy(0,0)}}class Ay{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new ly("icosahedron","Regular",[[0,yy.e,-1],[-yy.e,1,0],[-1,0,-yy.e],[1,0,-yy.e],[yy.e,1,0],[0,yy.e,1],[-1,0,yy.e],[-yy.e,-1,0],[0,-yy.e,-1],[yy.e,-1,0],[1,0,yy.e],[0,-yy.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let y=12;const c={},A=this.m,l=this.n;let w,N,p,W,h,I=A,q=1,o=0;0!==l&&(I=(0,Y.HighestCommonFactor)(A,l)),q=A/I,o=l/I;const O=cy.Zero(),L=new cy(A,l),i=new cy(-l,A+l),H=cy.Zero(),P=cy.Zero(),D=cy.Zero();let t,s,B,X,C=[];const K=[],my=this.vertByDist,T=(A,l,w,N)=>{t=A+"|"+w,s=l+"|"+N,t in c||s in c?t in c&&!(s in c)?c[s]=c[t]:s in c&&!(t in c)&&(c[t]=c[s]):(c[t]=y,c[s]=y,y++),my[w][0]>2?K[c[t]]=[-my[w][0],my[w][1],c[t]]:K[c[t]]=[C[my[w][0]],my[w][1],c[t]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let z=0;z<20;z++){if(C=this.IDATA.face[z],p=C[2],W=C[1],h=C[0],B=O.x+"|"+O.y,t=z+"|"+B,t in c||(c[t]=p,K[p]=[C[my[B][0]],my[B][1]]),B=L.x+"|"+L.y,t=z+"|"+B,t in c||(c[t]=W,K[W]=[C[my[B][0]],my[B][1]]),B=i.x+"|"+i.y,t=z+"|"+B,t in c||(c[t]=h,K[h]=[C[my[B][0]],my[B][1]]),w=this.IDATA.edgematch[z][0],N=this.IDATA.edgematch[z][1],"B"===N)for(let y=1;y<I;y++)P.x=A-y*(q+o),P.y=l+y*q,D.x=-y*o,D.y=y*(q+o),B=P.x+"|"+P.y,X=D.x+"|"+D.y,T(z,w,B,X);if("O"===N)for(let y=1;y<I;y++)D.x=-y*o,D.y=y*(q+o),H.x=y*q,H.y=y*o,B=D.x+"|"+D.y,X=H.x+"|"+H.y,T(z,w,B,X);if(w=this.IDATA.edgematch[z][2],N=this.IDATA.edgematch[z][3],N&&"A"===N)for(let y=1;y<I;y++)H.x=y*q,H.y=y*o,P.x=A-(I-y)*(q+o),P.y=l+(I-y)*q,B=H.x+"|"+H.y,X=P.x+"|"+P.y,T(z,w,B,X);for(let A=0;A<this.vertices.length;A++)B=this.vertices[A].x+"|"+this.vertices[A].y,t=z+"|"+B,t in c||(c[t]=y++,my[B][0]>2?K[c[t]]=[-my[B][0],my[B][1],c[t]]:K[c[t]]=[C[my[B][0]],my[B][1],c[t]])}this.closestTo=K,this.vecToidx=c}calcCoeffs(){const y=this.m,c=this.n,A=Math.sqrt(3)/3,l=y*y+c*c+y*c;this.coau=(y+c)/l,this.cobu=-c/l,this.coav=-A*(y-c)/l,this.cobv=A*(2*y+c)/l}createInnerFacets(){const y=this.m,c=this.n;for(let A=0;A<c+y+1;A++)for(let y=this.min[A];y<this.max[A]+1;y++)y<this.max[A]&&y<this.max[A+1]+1&&this.innerFacets.push(["|"+y+"|"+A,"|"+y+"|"+(A+1),"|"+(y+1)+"|"+A]),A>0&&y<this.max[A-1]&&y+1<this.max[A]+1&&this.innerFacets.push(["|"+y+"|"+A,"|"+(y+1)+"|"+A,"|"+(y+1)+"|"+(A-1)])}edgeVecsABOB(){const y=this.m,c=this.n,A=new cy(-c,y+c);for(let l=1;l<y+c;l++){const y=new cy(this.min[l],l),c=new cy(this.min[l-1],l-1),w=new cy(this.min[l+1],l+1),N=y.clone(),p=c.clone(),W=w.clone();N.rotate60About(A),p.rotate60About(A),W.rotate60About(A);const h=new cy(this.max[N.y],N.y),I=new cy(this.max[N.y-1],N.y-1),q=new cy(this.max[N.y-1]-1,N.y-1);N.x===h.x&&N.y===h.y||(N.x!==I.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([y,I,q]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([y,q,h])):N.y===W.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([y,c,I]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([y,I,w])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([y,c,I]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([y,I,h])))}}mapABOBtoOBOA(){const y=new cy(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const A=[];for(let l=0;l<3;l++)y.x=this.isoVecsABOB[c][l].x,y.y=this.isoVecsABOB[c][l].y,0===this.vertexTypes[c][l]&&y.rotateNeg120(this.m,this.n),A.push(y.clone());this.isoVecsOBOA.push(A)}}mapABOBtoBAOA(){const y=new cy(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const A=[];for(let l=0;l<3;l++)y.x=this.isoVecsABOB[c][l].x,y.y=this.isoVecsABOB[c][l].y,1===this.vertexTypes[c][l]&&y.rotate120(this.m,this.n),A.push(y.clone());this.isoVecsBAOA.push(A)}}MapToFace(y,c){const A=this.IDATA.face[y],w=A[2],N=A[1],p=A[0],W=l.gc.yA(this.IDATA.vertex[w]),h=l.gc.yA(this.IDATA.vertex[N]),I=l.gc.yA(this.IDATA.vertex[p]),q=h.xc(W),o=I.xc(W),O=q.scale(this.coau).add(o.scale(this.cobu)),L=q.scale(this.coav).add(o.scale(this.cobv)),i=[];let H,P=l.TmpVectors.gc[0];for(let l=0;l<this.cartesian.length;l++)P=O.scale(this.cartesian[l].x).add(L.scale(this.cartesian[l].y)).add(W),i[l]=[P.x,P.y,P.z],H=y+"|"+this.vertices[l].x+"|"+this.vertices[l].y,c.vertex[this.vecToidx[H]]=[P.x,P.y,P.z]}build(y,c){const A=[],l=cy.Zero(),w=new cy(y,c),N=new cy(-c,y+c);A.push(l,w,N);for(let B=c;B<y+1;B++)for(let c=0;c<y+1-B;c++)A.push(new cy(c,B));if(c>0){const l=(0,Y.HighestCommonFactor)(y,c),w=y/l,N=c/l;for(let W=1;W<l;W++)A.push(new cy(W*w,W*N)),A.push(new cy(-W*N,W*(w+N))),A.push(new cy(y-W*(w+N),c+W*w));const p=y/c;for(let W=1;W<c;W++)for(let l=0;l<W*p;l++)A.push(new cy(l,W)),A.push(new cy(l,W).rotate120(y,c)),A.push(new cy(l,W).rotateNeg120(y,c))}A.sort(((y,c)=>y.x-c.x)),A.sort(((y,c)=>y.y-c.y));const p=new Array(y+c+1),W=new Array(y+c+1);for(let B=0;B<p.length;B++)p[B]=1/0,W[B]=-1/0;let h=0,I=0;const q=A.length;for(let B=0;B<q;B++)I=A[B].x,h=A[B].y,p[h]=Math.min(I,p[h]),W[h]=Math.max(I,W[h]);const o=(A,l)=>{const w=A.clone();return"A"===l&&w.rotateNeg120(y,c),"B"===l&&w.rotate120(y,c),w.x<0?w.y:w.x+w.y},O=[],L=[],i=[],H=[],P={},D=[];let t=-1,s=-1;for(let B=0;B<q;B++)O[B]=A[B].toCartesianOrigin(new cy(0,0),.5),L[B]=o(A[B],"O"),i[B]=o(A[B],"A"),H[B]=o(A[B],"B"),L[B]===i[B]&&i[B]===H[B]?(t=3,s=L[B]):L[B]===i[B]?(t=4,s=L[B]):i[B]===H[B]?(t=5,s=i[B]):H[B]===L[B]&&(t=6,s=L[B]),L[B]<i[B]&&L[B]<H[B]&&(t=2,s=L[B]),i[B]<L[B]&&i[B]<H[B]&&(t=1,s=i[B]),H[B]<i[B]&&H[B]<L[B]&&(t=0,s=H[B]),D.push([t,s,A[B].x,A[B].y]);D.sort(((y,c)=>y[2]-c[2])),D.sort(((y,c)=>y[3]-c[3])),D.sort(((y,c)=>y[1]-c[1])),D.sort(((y,c)=>y[0]-c[0]));for(let B=0;B<D.length;B++)P[D[B][2]+"|"+D[B][3]]=[D[B][0],D[B][1],B];return this.m=y,this.n=c,this.vertices=A,this.vertByDist=P,this.cartesian=O,this.min=p,this.max=W,this}}class ly{constructor(y,c,A,l){this.name=y,this.category=c,this.vertex=A,this.face=l}}class wy extends ly{innerToData(y,c){for(let A=0;A<c.innerFacets.length;A++)this.face.push(c.innerFacets[A].map((A=>c.vecToidx[y+A])))}mapABOBtoDATA(y,c){const A=c.IDATA.edgematch[y][0];for(let l=0;l<c.isoVecsABOB.length;l++){const w=[];for(let N=0;N<3;N++)0===c.vertexTypes[l][N]?w.push(y+"|"+c.isoVecsABOB[l][N].x+"|"+c.isoVecsABOB[l][N].y):w.push(A+"|"+c.isoVecsABOB[l][N].x+"|"+c.isoVecsABOB[l][N].y);this.face.push([c.vecToidx[w[0]],c.vecToidx[w[1]],c.vecToidx[w[2]]])}}mapOBOAtoDATA(y,c){const A=c.IDATA.edgematch[y][0];for(let l=0;l<c.isoVecsOBOA.length;l++){const w=[];for(let N=0;N<3;N++)1===c.vertexTypes[l][N]?w.push(y+"|"+c.isoVecsOBOA[l][N].x+"|"+c.isoVecsOBOA[l][N].y):w.push(A+"|"+c.isoVecsOBOA[l][N].x+"|"+c.isoVecsOBOA[l][N].y);this.face.push([c.vecToidx[w[0]],c.vecToidx[w[1]],c.vecToidx[w[2]]])}}mapBAOAtoDATA(y,c){const A=c.IDATA.edgematch[y][2];for(let l=0;l<c.isoVecsBAOA.length;l++){const w=[];for(let N=0;N<3;N++)1===c.vertexTypes[l][N]?w.push(y+"|"+c.isoVecsBAOA[l][N].x+"|"+c.isoVecsBAOA[l][N].y):w.push(A+"|"+c.isoVecsBAOA[l][N].x+"|"+c.isoVecsBAOA[l][N].y);this.face.push([c.vecToidx[w[0]],c.vecToidx[w[1]],c.vecToidx[w[2]]])}}orderData(y){const c=[];for(let N=0;N<13;N++)c[N]=[];const A=y.closestTo;for(let N=0;N<A.length;N++)A[N][0]>-1?A[N][1]>0&&c[A[N][0]].push([N,A[N][1]]):c[12].push([N,A[N][0]]);const l=[];for(let N=0;N<12;N++)l[N]=N;let w=12;for(let N=0;N<12;N++){c[N].sort(((y,c)=>y[1]-c[1]));for(let y=0;y<c[N].length;y++)l[c[N][y][0]]=w++}for(let N=0;N<c[12].length;N++)l[c[12][N][0]]=w++;for(let N=0;N<this.vertex.length;N++)this.vertex[N].push(l[N]);this.vertex.sort(((y,c)=>y[3]-c[3]));for(let N=0;N<this.vertex.length;N++)this.vertex[N].pop();for(let N=0;N<this.face.length;N++)for(let y=0;y<this.face[N].length;y++)this.face[N][y]=l[this.face[N][y]];this.sharedNodes=c[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(y,c){const A=[],l=[];let w=c.pop();l.push(w);let N=this.face[w].indexOf(y);N=(N+2)%3;let p=this.face[w][N];A.push(p);let W=0;for(;c.length>0;)w=c[W],this.face[w].indexOf(p)>-1?(N=(this.face[w].indexOf(p)+1)%3,p=this.face[w][N],A.push(p),l.push(w),c.splice(W,1),W=0):W++;return this.adjacentFaces.push(A),l}toGoldbergPolyhedronData(){const y=new ly("GeoDual","Goldberg",[],[]);y.name="GD dual";const c=this.vertex.length,A=new Array(c);for(let h=0;h<c;h++)A[h]=[];for(let h=0;h<this.face.length;h++)for(let y=0;y<3;y++)A[this.face[h][y]].push(h);let l=0,w=0,N=0,p=[],W=[];this.adjacentFaces=[];for(let h=0;h<A.length;h++){y.face[h]=this.setOrder(h,A[h].concat([]));for(const c of A[h]){l=0,w=0,N=0,p=this.face[c];for(let y=0;y<3;y++)W=this.vertex[p[y]],l+=W[0],w+=W[1],N+=W[2];y.vertex[c]=[l/3,w/3,N/3]}}return y}static BuildGeodesicData(y){const c=new wy("Geodesic-m-n","Geodesic",[[0,yy.e,-1],[-yy.e,1,0],[-1,0,-yy.e],[1,0,-yy.e],[yy.e,1,0],[0,yy.e,1],[-1,0,yy.e],[-yy.e,-1,0],[0,-yy.e,-1],[yy.e,-1,0],[1,0,yy.e],[0,-yy.e,1]],[]);y.setIndices(),y.calcCoeffs(),y.createInnerFacets(),y.edgeVecsABOB(),y.mapABOBtoOBOA(),y.mapABOBtoBAOA();for(let A=0;A<y.IDATA.face.length;A++)y.MapToFace(A,c),c.innerToData(A,y),"B"===y.IDATA.edgematch[A][1]&&c.mapABOBtoDATA(A,y),"O"===y.IDATA.edgematch[A][1]&&c.mapOBOAtoDATA(A,y),"A"===y.IDATA.edgematch[A][3]&&c.mapBAOAtoDATA(A,y);c.orderData(y);return c.vertex=c.vertex.map((function(y){const c=y[0],A=y[1],l=y[2],w=Math.sqrt(c*c+A*A+l*l);return y[0]*=1/w,y[1]*=1/w,y[2]*=1/w,y})),c}}w.b._GoldbergMeshParser=(y,c)=>Ny.Parse(y,c);class Ny extends w.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(y,c){return void 0===c?(y>this.goldbergData.nbUnsharedFaces-1&&(d.c.Warn("Maximum number of unshared faces used"),y=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+y):(y>11&&(d.c.Warn("Last pole used"),y=11),c>this.goldbergData.nbFacesAtPole-1&&(d.c.Warn("Maximum number of faces at a pole used"),c=this.goldbergData.nbFacesAtPole-1),12+y*this.goldbergData.nbFacesAtPole+c)}_changeGoldbergFaceColors(y){for(let A=0;A<y.length;A++){const c=y[A][0],l=y[A][1],w=y[A][2];for(let y=c;y<l+1;y++)this.goldbergData.faceColors[y]=w}const c=[];for(let A=0;A<12;A++)for(let y=0;y<5;y++)c.push(this.goldbergData.faceColors[A].r,this.goldbergData.faceColors[A].g,this.goldbergData.faceColors[A].b,this.goldbergData.faceColors[A].a);for(let A=12;A<this.goldbergData.faceColors.length;A++)for(let y=0;y<6;y++)c.push(this.goldbergData.faceColors[A].r,this.goldbergData.faceColors[A].g,this.goldbergData.faceColors[A].b,this.goldbergData.faceColors[A].a);return c}setGoldbergFaceColors(y){const c=this._changeGoldbergFaceColors(y);this.Uy(N.e.ColorKind,c)}updateGoldbergFaceColors(y){const c=this._changeGoldbergFaceColors(y);this.updateVerticesData(N.e.ColorKind,c)}_changeGoldbergFaceUVs(y){const c=this.getVerticesData(N.e.UVKind);for(let A=0;A<y.length;A++){const l=y[A][0],w=y[A][1],N=y[A][2],p=y[A][3],W=y[A][4],h=[],I=[];let q,o;for(let y=0;y<5;y++)q=N.x+p*Math.cos(W+y*Math.PI/2.5),o=N.y+p*Math.sin(W+y*Math.PI/2.5),q<0&&(q=0),q>1&&(q=1),h.push(q,o);for(let y=0;y<6;y++)q=N.x+p*Math.cos(W+y*Math.PI/3),o=N.y+p*Math.sin(W+y*Math.PI/3),q<0&&(q=0),q>1&&(q=1),I.push(q,o);for(let y=l;y<Math.min(12,w+1);y++)for(let A=0;A<5;A++)c[10*y+2*A]=h[2*A],c[10*y+2*A+1]=h[2*A+1];for(let y=Math.max(12,l);y<w+1;y++)for(let A=0;A<6;A++)c[12*y-24+2*A]=I[2*A],c[12*y-23+2*A]=I[2*A+1]}return c}setGoldbergFaceUVs(y){const c=this._changeGoldbergFaceUVs(y);this.Uy(N.e.UVKind,c)}updateGoldbergFaceUVs(y){const c=this._changeGoldbergFaceUVs(y);this.updateVerticesData(N.e.UVKind,c)}placeOnGoldbergFaceAt(y,c,A){const w=l.gc.RotationFromAxis(this.goldbergData.faceXaxis[c],this.goldbergData.faceYaxis[c],this.goldbergData.faceZaxis[c]);y.rotation=w,y.position=this.goldbergData.faceCenters[c].add(this.goldbergData.faceXaxis[c].scale(A.x)).add(this.goldbergData.faceYaxis[c].scale(A.y)).add(this.goldbergData.faceZaxis[c].scale(A.z))}serialize(y){super.serialize(y),y.type="GoldbergMesh";const c={};if(c.adjacentFaces=this.goldbergData.adjacentFaces,c.nbSharedFaces=this.goldbergData.nbSharedFaces,c.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,c.nbFaces=this.goldbergData.nbFaces,c.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){c.faceColors=[];for(const y of this.goldbergData.faceColors)c.faceColors.push(y.fc())}if(this.goldbergData.faceCenters){c.faceCenters=[];for(const y of this.goldbergData.faceCenters)c.faceCenters.push(y.fc())}if(this.goldbergData.faceZaxis){c.faceZaxis=[];for(const y of this.goldbergData.faceZaxis)c.faceZaxis.push(y.fc())}if(this.goldbergData.faceYaxis){c.faceYaxis=[];for(const y of this.goldbergData.faceYaxis)c.faceYaxis.push(y.fc())}if(this.goldbergData.faceXaxis){c.faceXaxis=[];for(const y of this.goldbergData.faceXaxis)c.faceXaxis.push(y.fc())}y.goldbergData=c}static Parse(y,c){const A=y.goldbergData;A.faceColors=A.faceColors.map((y=>O.ip.yA(y))),A.faceCenters=A.faceCenters.map((y=>l.gc.yA(y))),A.faceZaxis=A.faceZaxis.map((y=>l.gc.yA(y))),A.faceXaxis=A.faceXaxis.map((y=>l.gc.yA(y))),A.faceYaxis=A.faceYaxis.map((y=>l.gc.yA(y)));const w=new Ny(y.name,c);return w.goldbergData=A,w}}var py=A(12876);const Wy={CreateBox:o.c,CreateTiledBox:P,CreateSphere:D.e,CreateDisc:q.c,CreateIcoSphere:Q,CreateRibbon:I,CreateCylinder:X,CreateTorus:K,CreateTorusKnot:T,CreateLineSystem:z.f,bI:z.g,CreateDashedLines:z.c,ExtrudeShape:k,ExtrudeShapeCustom:a,CreateLathe:G,CreateTiledPlane:i,dI:j.d,CreateGround:f.c,CreateTiledGround:f.f,CreateGroundFromHeightMap:f.b,CreatePolygon:S.e,ExtrudePolygon:S.g,CreateTube:V,CreatePolyhedron:U,CreateGeodesic:function(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=c.m||1;l!==Math.floor(l)&&(l=Math.floor(l),d.c.Warn("m not an integer only floor(m) used"));let w=c.n||0;if(w!==Math.floor(w)&&(w=Math.floor(w),d.c.Warn("n not an integer only floor(n) used")),w>l){const y=w;w=l,l=y,d.c.Warn("n > m therefore m and n swapped")}const N=new Ay;return N.build(l,w),U(y,{custom:wy.BuildGeodesicData(N),size:c.size,sizeX:c.sizeX,sizeY:c.sizeY,sizeZ:c.sizeZ,faceUV:c.faceUV,faceColors:c.faceColors,flat:c.flat,updatable:c.updatable,sideOrientation:c.sideOrientation,frontUVs:c.frontUVs,backUVs:c.backUVs},A)},CreateGoldberg:function(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=c.size,h=c.sizeX||N||1,I=c.sizeY||N||1,q=c.sizeZ||N||1;let o=c.m||1;o!==Math.floor(o)&&(o=Math.floor(o),d.c.Warn("m not an integer only floor(m) used"));let L=c.n||0;if(L!==Math.floor(L)&&(L=Math.floor(L),d.c.Warn("n not an integer only floor(n) used")),L>o){const y=L;L=o,o=y,d.c.Warn("n > m therefore m and n swapped")}const i=new Ay;i.build(o,L);const H=wy.BuildGeodesicData(i),P=H.toGoldbergPolyhedronData(),D=new Ny(y,A);c.sideOrientation=w.b._GetDefaultSideOrientation(c.sideOrientation),D._originalBuilderSideOrientation=c.sideOrientation;(function(y,c){const A=y.size,w=y.sizeX||A||1,N=y.sizeY||A||1,h=y.sizeZ||A||1,I=0===y.sideOrientation?0:y.sideOrientation||p.b.DEFAULTSIDE,q=[],o=[],O=[],L=[];let i=1/0,H=-1/0,P=1/0,D=-1/0;for(let l=0;l<c.vertex.length;l++)i=Math.min(i,c.vertex[l][0]*w),H=Math.max(H,c.vertex[l][0]*w),P=Math.min(P,c.vertex[l][1]*N),D=Math.max(D,c.vertex[l][1]*N);let t=0;for(let p=0;p<c.face.length;p++){const y=c.face[p],A=l.gc.yA(c.vertex[y[0]]),I=l.gc.yA(c.vertex[y[2]]),s=l.gc.yA(c.vertex[y[1]]),B=I.xc(A),X=s.xc(A),C=l.gc.Cross(X,B).normalize();for(let l=0;l<y.length;l++){O.push(C.x,C.y,C.z);const A=c.vertex[y[l]];q.push(A[0]*w,A[1]*N,A[2]*h);const p=(A[1]*N-P)/(D-P);L.push((A[0]*w-i)/(H-i),W.b?1-p:p)}for(let c=0;c<y.length-2;c++)o.push(t,t+c+2,t+c+1);t+=y.length}p.b._ComputeSides(I,q,o,O,L);const s=new p.b;return s.zy=q,s.indices=o,s.Sy=O,s.ky=L,s})(c,P).Gy(D,c.updatable),D.goldbergData.nbSharedFaces=H.sharedNodes,D.goldbergData.nbUnsharedFaces=H.poleNodes,D.goldbergData.adjacentFaces=H.adjacentFaces,D.goldbergData.nbFaces=D.goldbergData.nbSharedFaces+D.goldbergData.nbUnsharedFaces,D.goldbergData.nbFacesAtPole=(D.goldbergData.nbUnsharedFaces-12)/12;for(let w=0;w<H.vertex.length;w++)D.goldbergData.faceCenters.push(l.gc.yA(H.vertex[w])),D.goldbergData.faceCenters[w].x*=h,D.goldbergData.faceCenters[w].y*=I,D.goldbergData.faceCenters[w].z*=q,D.goldbergData.faceColors.push(new O.ip(1,1,1,1));for(let w=0;w<P.face.length;w++){const y=P.face[w],c=l.gc.yA(P.vertex[y[0]]),A=l.gc.yA(P.vertex[y[2]]),N=l.gc.yA(P.vertex[y[1]]),p=A.xc(c),W=N.xc(c),h=l.gc.Cross(W,p).normalize(),I=l.gc.Cross(W,h).normalize();D.goldbergData.faceXaxis.push(W.normalize()),D.goldbergData.faceYaxis.push(h),D.goldbergData.faceZaxis.push(I)}return D},CreateDecal:b,CreateCapsule:v,CreateText:py.g}},13578:(y,c,A)=>{"use strict";A.d(c,{e:()=>Wc});var l=A(12325),w=A(12704);class N extends w.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var p=A(12375),W=(A(12486),A(12283));class h{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(y){this._targetStopDuration!==y&&(this._targetStopDuration=y)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(y){this._noiseTexture!==y&&(this._noiseTexture=y,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(y){this._animationSheetEnabled!==y&&(this._animationSheetEnabled=y)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(y){this._isAnimationSheetEnabled!=y&&(this._isAnimationSheetEnabled=y,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(y){this._useLogarithmicDepth=y&&this.mc().getEngine().getCaps().fragmentDepthSupported}mc(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(y){switch(y){case h.BLENDMODE_MULTIPLYADD:return;case h.BLENDMODE_ADD:y=1;break;case h.BLENDMODE_ONEONE:y=6;break;case h.BLENDMODE_STANDARD:y=2;break;case h.BLENDMODE_MULTIPLY:y=4;break;case h.BLENDMODE_SUBTRACT:y=3}this._engine.setAlphaMode(y)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:l.gc.Zero()}set direction1(y){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=y)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:l.gc.Zero()}set direction2(y){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=y)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:l.gc.Zero()}set minEmitBox(y){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=y)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:l.gc.Zero()}set maxEmitBox(y){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=y)}get billboardMode(){return this._billboardMode}set billboardMode(y){this._billboardMode!==y&&(this._billboardMode=y,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(y){this._isBillboardBased!==y&&(this._isBillboardBased=y,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(y){this._attachImageProcessingConfiguration(y)}_attachImageProcessingConfiguration(y){y!==this._imageProcessingConfiguration&&(!y&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=y)}_reset(){}_removeGradientAndTexture(y,c,A){if(!c)return this;let l=0;for(const w of c){if(w.gradient===y){c.splice(l,1);break}l++}return A&&A.dispose(),this}constructor(y){this.animations=[],this.renderingGroupId=0,this.Ic=l.gc.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new l.gc(10,10,10),this.onAnimationEnd=null,this.blendMode=h.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new l.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.rI=new l.gc(0,0,0),this._useLogarithmicDepth=!1,this.gravity=l.gc.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new p.ip(1,1,1,1),this.color2=new p.ip(1,1,1,1),this.colorDead=new p.ip(0,0,0,1),this.textureMask=new p.ip(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new N,this.id=y,this.name=y}createPointEmitter(y,c){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new l.gc(0,1,0),arguments.length>2&&void 0!==arguments[2]||new l.gc(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new l.gc(0,1,0),arguments.length>4&&void 0!==arguments[4]||new l.gc(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new l.gc(0,1,0),arguments.length>3&&void 0!==arguments[3]||new l.gc(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(y,c,A,l){throw new Error("Method not implemented.")}}h.BLENDMODE_ONEONE=0,h.BLENDMODE_STANDARD=1,h.BLENDMODE_ADD=2,h.BLENDMODE_MULTIPLY=3,h.BLENDMODE_MULTIPLYADD=4,h.BLENDMODE_SUBTRACT=-1,(0,W.f)("BABYLON.BaseParticleSystem",h);var I=A(12340),q=A(12167);class o{constructor(){this.direction1=new l.gc(0,1,0),this.direction2=new l.gc(0,1,0),this.minEmitBox=new l.gc(-.5,-.5,-.5),this.maxEmitBox=new l.gc(.5,.5,.5)}startDirectionFunction(y,c,A,w){const N=(0,I.RandomRange)(this.direction1.x,this.direction2.x),p=(0,I.RandomRange)(this.direction1.y,this.direction2.y),W=(0,I.RandomRange)(this.direction1.z,this.direction2.z);if(w)return c.x=N,c.y=p,void(c.z=W);l.gc.TransformNormalFromFloatsToRef(N,p,W,y,c)}startPositionFunction(y,c,A,w){const N=(0,I.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),p=(0,I.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),W=(0,I.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(w)return c.x=N,c.y=p,void(c.z=W);l.gc.TransformCoordinatesFromFloatsToRef(N,p,W,y,c)}clone(){const y=new o;return q.e.DeepCopy(this,y),y}applyToShader(y){y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2),y.setVector3("minEmitBox",this.minEmitBox),y.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(y){y.addUniform("direction1",3),y.addUniform("direction2",3),y.addUniform("minEmitBox",3),y.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.direction1=this.direction1.fc(),y.direction2=this.direction2.fc(),y.minEmitBox=this.minEmitBox.fc(),y.maxEmitBox=this.maxEmitBox.fc(),y}parse(y){l.gc.FromArrayToRef(y.direction1,0,this.direction1),l.gc.FromArrayToRef(y.direction2,0,this.direction2),l.gc.FromArrayToRef(y.minEmitBox,0,this.minEmitBox),l.gc.FromArrayToRef(y.maxEmitBox,0,this.maxEmitBox)}}class O{get radius(){return this._radius}set radius(y){this._radius=y,this._buildHeight()}get angle(){return this._angle}set angle(y){this._angle=y,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=A,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=c,this.radius=y}startDirectionFunction(y,c,A,w){w?l.TmpVectors.gc[0].p(A.hh).normalize():A.position.subtractToRef(y.getTranslation(),l.TmpVectors.gc[0]).normalize();const N=(0,I.RandomRange)(0,this.directionRandomizer),p=(0,I.RandomRange)(0,this.directionRandomizer),W=(0,I.RandomRange)(0,this.directionRandomizer);c.x=l.TmpVectors.gc[0].x+N,c.y=l.TmpVectors.gc[0].y+p,c.z=l.TmpVectors.gc[0].z+W,c.normalize()}startPositionFunction(y,c,A,w){const N=(0,I.RandomRange)(0,2*Math.PI);let p;this.emitFromSpawnPointOnly?p=1e-4:(p=(0,I.RandomRange)(0,this.heightRange),p=1-p*p);let W=this._radius-(0,I.RandomRange)(0,this._radius*this.radiusRange);W*=p;const h=W*Math.sin(N),q=W*Math.cos(N),o=p*this._height;if(w)return c.x=h,c.y=o,void(c.z=q);l.gc.TransformCoordinatesFromFloatsToRef(h,o,q,y,c)}clone(){const y=new O(this._radius,this._angle,this.directionRandomizer);return q.e.DeepCopy(this,y),y}applyToShader(y){y.setFloat2("radius",this._radius,this.radiusRange),y.setFloat("coneAngle",this._angle),y.setFloat2("height",this._height,this.heightRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",2),y.addUniform("coneAngle",1),y.addUniform("height",2),y.addUniform("directionRandomizer",1)}getEffectDefines(){let y="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(y+="\n#define CONEEMITTERSPAWNPOINT"),y}getClassName(){return"ConeParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this._radius,y.angle=this._angle,y.directionRandomizer=this.directionRandomizer,y.radiusRange=this.radiusRange,y.heightRange=this.heightRange,y.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,y}parse(y){this.radius=y.radius,this.angle=y.angle,this.directionRandomizer=y.directionRandomizer,this.radiusRange=void 0!==y.radiusRange?y.radiusRange:1,this.heightRange=void 0!==y.radiusRange?y.heightRange:1,this.emitFromSpawnPointOnly=void 0!==y.emitFromSpawnPointOnly&&y.emitFromSpawnPointOnly}}class L extends O{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.gc(0,1,0),w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.gc(0,1,0);super(y,c),this.direction1=A,this.direction2=w}startDirectionFunction(y,c){const A=(0,I.RandomRange)(this.direction1.x,this.direction2.x),w=(0,I.RandomRange)(this.direction1.y,this.direction2.y),N=(0,I.RandomRange)(this.direction1.z,this.direction2.z);l.gc.TransformNormalFromFloatsToRef(A,w,N,y,c)}clone(){const y=new L(this.radius,this.angle,this.direction1,this.direction2);return q.e.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const y=super.serialize();return y.direction1=this.direction1.fc(),y.direction2=this.direction2.fc(),y}parse(y){super.parse(y),this.direction1.p(y.direction1),this.direction2.p(y.direction2)}}class i{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=y,this.height=c,this.radiusRange=A,this.directionRandomizer=w,this._tempVector=l.gc.Zero()}startDirectionFunction(y,c,A,w,N){A.position.subtractToRef(y.getTranslation(),this._tempVector),this._tempVector.normalize(),l.gc.TransformNormalToRef(this._tempVector,N,this._tempVector);const p=(0,I.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let W=Math.atan2(this._tempVector.x,this._tempVector.z);W+=(0,I.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=p,this._tempVector.x=Math.sin(W),this._tempVector.z=Math.cos(W),this._tempVector.normalize(),w?c.p(this._tempVector):l.gc.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,y,c)}startPositionFunction(y,c,A,w){const N=(0,I.RandomRange)(-this.height/2,this.height/2),p=(0,I.RandomRange)(0,2*Math.PI),W=(0,I.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),h=Math.sqrt(W)*this.radius,q=h*Math.cos(p),o=h*Math.sin(p);w?c.Ec(q,N,o):l.gc.TransformCoordinatesFromFloatsToRef(q,N,o,y,c)}clone(){const y=new i(this.radius,this.directionRandomizer);return q.e.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("height",this.height),y.setFloat("radiusRange",this.radiusRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("height",1),y.addUniform("radiusRange",1),y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this.radius,y.height=this.height,y.radiusRange=this.radiusRange,y.directionRandomizer=this.directionRandomizer,y}parse(y){this.radius=y.radius,this.height=y.height,this.radiusRange=y.radiusRange,this.directionRandomizer=y.directionRandomizer}}class H extends i{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.gc(0,1,0),N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.gc(0,1,0);super(y,c,A),this.direction1=w,this.direction2=N}startDirectionFunction(y,c,A,w){const N=(0,I.RandomRange)(this.direction1.x,this.direction2.x),p=(0,I.RandomRange)(this.direction1.y,this.direction2.y),W=(0,I.RandomRange)(this.direction1.z,this.direction2.z);w?c.Ec(N,p,W):l.gc.TransformNormalFromFloatsToRef(N,p,W,y,c)}clone(){const y=new H(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return q.e.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("height",this.height),y.setFloat("radiusRange",this.radiusRange),y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("height",1),y.addUniform("radiusRange",1),y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const y=super.serialize();return y.direction1=this.direction1.fc(),y.direction2=this.direction2.fc(),y}parse(y){super.parse(y),l.gc.FromArrayToRef(y.direction1,0,this.direction1),l.gc.FromArrayToRef(y.direction2,0,this.direction2)}}class P{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=y,this.radiusRange=c,this.directionRandomizer=A}startDirectionFunction(y,c,A,w){const N=A.position.xc(y.getTranslation()).normalize(),p=(0,I.RandomRange)(0,this.directionRandomizer),W=(0,I.RandomRange)(0,this.directionRandomizer),h=(0,I.RandomRange)(0,this.directionRandomizer);N.x+=p,N.y+=W,N.z+=h,N.normalize(),w?c.p(N):l.gc.TransformNormalFromFloatsToRef(N.x,N.y,N.z,y,c)}startPositionFunction(y,c,A,w){const N=this.radius-(0,I.RandomRange)(0,this.radius*this.radiusRange),p=(0,I.RandomRange)(0,1),W=(0,I.RandomRange)(0,2*Math.PI),h=Math.acos(2*p-1),q=N*Math.cos(W)*Math.sin(h),o=N*Math.cos(h),O=N*Math.sin(W)*Math.sin(h);w?c.Ec(q,Math.abs(o),O):l.gc.TransformCoordinatesFromFloatsToRef(q,Math.abs(o),O,y,c)}clone(){const y=new P(this.radius,this.directionRandomizer);return q.e.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this.radius,y.radiusRange=this.radiusRange,y.directionRandomizer=this.directionRandomizer,y}parse(y){this.radius=y.radius,this.radiusRange=y.radiusRange,this.directionRandomizer=y.directionRandomizer}}class D{constructor(){this.direction1=new l.gc(0,1,0),this.direction2=new l.gc(0,1,0)}startDirectionFunction(y,c,A,w){const N=(0,I.RandomRange)(this.direction1.x,this.direction2.x),p=(0,I.RandomRange)(this.direction1.y,this.direction2.y),W=(0,I.RandomRange)(this.direction1.z,this.direction2.z);w?c.Ec(N,p,W):l.gc.TransformNormalFromFloatsToRef(N,p,W,y,c)}startPositionFunction(y,c,A,w){w?c.Ec(0,0,0):l.gc.TransformCoordinatesFromFloatsToRef(0,0,0,y,c)}clone(){const y=new D;return q.e.DeepCopy(this,y),y}applyToShader(y){y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.direction1=this.direction1.fc(),y.direction2=this.direction2.fc(),y}parse(y){l.gc.FromArrayToRef(y.direction1,0,this.direction1),l.gc.FromArrayToRef(y.direction2,0,this.direction2)}}class t{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=y,this.radiusRange=c,this.directionRandomizer=A}startDirectionFunction(y,c,A,w){const N=A.position.xc(y.getTranslation()).normalize(),p=(0,I.RandomRange)(0,this.directionRandomizer),W=(0,I.RandomRange)(0,this.directionRandomizer),h=(0,I.RandomRange)(0,this.directionRandomizer);N.x+=p,N.y+=W,N.z+=h,N.normalize(),w?c.p(N):l.gc.TransformNormalFromFloatsToRef(N.x,N.y,N.z,y,c)}startPositionFunction(y,c,A,w){const N=this.radius-(0,I.RandomRange)(0,this.radius*this.radiusRange),p=(0,I.RandomRange)(0,1),W=(0,I.RandomRange)(0,2*Math.PI),h=Math.acos(2*p-1),q=N*Math.cos(W)*Math.sin(h),o=N*Math.cos(h),O=N*Math.sin(W)*Math.sin(h);w?c.Ec(q,o,O):l.gc.TransformCoordinatesFromFloatsToRef(q,o,O,y,c)}clone(){const y=new t(this.radius,this.directionRandomizer);return q.e.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.radius=this.radius,y.radiusRange=this.radiusRange,y.directionRandomizer=this.directionRandomizer,y}parse(y){this.radius=y.radius,this.radiusRange=y.radiusRange,this.directionRandomizer=y.directionRandomizer}}class s extends t{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.gc(0,1,0),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.gc(0,1,0);super(y),this.direction1=c,this.direction2=A}startDirectionFunction(y,c){const A=(0,I.RandomRange)(this.direction1.x,this.direction2.x),w=(0,I.RandomRange)(this.direction1.y,this.direction2.y),N=(0,I.RandomRange)(this.direction1.z,this.direction2.z);l.gc.TransformNormalFromFloatsToRef(A,w,N,y,c)}clone(){const y=new s(this.radius,this.direction1,this.direction2);return q.e.DeepCopy(this,y),y}applyToShader(y){y.setFloat("radius",this.radius),y.setFloat("radiusRange",this.radiusRange),y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("radius",1),y.addUniform("radiusRange",1),y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const y=super.serialize();return y.direction1=this.direction1.fc(),y.direction2=this.direction2.fc(),y}parse(y){super.parse(y),this.direction1.p(y.direction1),this.direction2.p(y.direction2)}}class B{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(y,c,A,w){const N=l.TmpVectors.gc[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,A,N);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,A,N);const y=l.TmpVectors.gc[1];N.subtractToRef(A.position,y),y.scaleToRef(1/A.lifeTime,N)}else N.set(0,0,0);w?c.p(N):l.gc.TransformNormalToRef(N,y,c)}startPositionFunction(y,c,A,w){const N=l.TmpVectors.gc[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,A,N):N.set(0,0,0),w?c.p(N):l.gc.TransformCoordinatesToRef(N,y,c)}clone(){const y=new B;return q.e.DeepCopy(this,y),y}applyToShader(y){}buildUniformLayout(y){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const y={};return y.type=this.getClassName(),y.particlePositionGenerator=this.particlePositionGenerator,y.particleDestinationGenerator=this.particleDestinationGenerator,y}parse(y){y.particlePositionGenerator&&(this.particlePositionGenerator=y.particlePositionGenerator),y.particleDestinationGenerator&&(this.particleDestinationGenerator=y.particleDestinationGenerator)}}var X=A(12400);class C{get mesh(){return this._mesh}set mesh(y){this._mesh!==y&&(this._mesh=y,y?(this._indices=y.rc(),this._positions=y.getVerticesData(X.e.PositionKind),this._normals=y.getVerticesData(X.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=l.gc.Zero(),this._mesh=null,this.direction1=new l.gc(0,1,0),this.direction2=new l.gc(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=y}startDirectionFunction(y,c,A,w){if(this.useMeshNormalsForDirection&&this._normals)return void l.gc.TransformNormalToRef(this._storedNormal,y,c);const N=(0,I.RandomRange)(this.direction1.x,this.direction2.x),p=(0,I.RandomRange)(this.direction1.y,this.direction2.y),W=(0,I.RandomRange)(this.direction1.z,this.direction2.z);w?c.Ec(N,p,W):l.gc.TransformNormalFromFloatsToRef(N,p,W,y,c)}startPositionFunction(y,c,A,w){if(!this._indices||!this._positions)return;const N=3*(Math.random()*(this._indices.length/3)|0),p=Math.random(),W=Math.random()*(1-p),h=1-p-W,I=this._indices[N],q=this._indices[N+1],o=this._indices[N+2],O=l.TmpVectors.gc[0],L=l.TmpVectors.gc[1],i=l.TmpVectors.gc[2],H=l.TmpVectors.gc[3];l.gc.FromArrayToRef(this._positions,3*I,O),l.gc.FromArrayToRef(this._positions,3*q,L),l.gc.FromArrayToRef(this._positions,3*o,i),H.x=p*O.x+W*L.x+h*i.x,H.y=p*O.y+W*L.y+h*i.y,H.z=p*O.z+W*L.z+h*i.z,w?c.Ec(H.x,H.y,H.z):l.gc.TransformCoordinatesFromFloatsToRef(H.x,H.y,H.z,y,c),this.useMeshNormalsForDirection&&this._normals&&(l.gc.FromArrayToRef(this._normals,3*I,O),l.gc.FromArrayToRef(this._normals,3*q,L),l.gc.FromArrayToRef(this._normals,3*o,i),this._storedNormal.x=p*O.x+W*L.x+h*i.x,this._storedNormal.y=p*O.y+W*L.y+h*i.y,this._storedNormal.z=p*O.z+W*L.z+h*i.z)}clone(){const y=new C(this.mesh);return q.e.DeepCopy(this,y),y}applyToShader(y){y.setVector3("direction1",this.direction1),y.setVector3("direction2",this.direction2)}buildUniformLayout(y){y.addUniform("direction1",3),y.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var y;const c={};return c.type=this.getClassName(),c.direction1=this.direction1.fc(),c.direction2=this.direction2.fc(),c.meshId=null===(y=this.mesh)||void 0===y?void 0:y.id,c.useMeshNormalsForDirection=this.useMeshNormalsForDirection,c}parse(y,c){l.gc.FromArrayToRef(y.direction1,0,this.direction1),l.gc.FromArrayToRef(y.direction2,0,this.direction2),y.meshId&&c&&(this.mesh=c.getLastMeshById(y.meshId)),this.useMeshNormalsForDirection=y.useMeshNormalsForDirection}}class K{_isUbo(y){return void 0!==y.addUniform}constructor(y){this._isUbo(y)?(this.setMatrix3x3=y.updateMatrix3x3.bind(y),this.setMatrix2x2=y.updateMatrix2x2.bind(y),this.setFloat=y.updateFloat.bind(y),this.setFloat2=y.updateFloat2.bind(y),this.setFloat3=y.updateFloat3.bind(y),this.setFloat4=y.updateFloat4.bind(y),this.setFloatArray=y.updateFloatArray.bind(y),this.setArray=y.updateArray.bind(y),this.setIntArray=y.updateIntArray.bind(y),this.setMatrix=y.Qc.bind(y),this.setMatrices=y.updateMatrices.bind(y),this.setVector3=y.updateVector3.bind(y),this.setVector4=y.updateVector4.bind(y),this.setColor3=y.updateColor3.bind(y),this.setColor4=y.updateColor4.bind(y),this.setDirectColor4=y.updateDirectColor4.bind(y),this.setInt=y.updateInt.bind(y),this.setInt2=y.updateInt2.bind(y),this.setInt3=y.updateInt3.bind(y),this.setInt4=y.updateInt4.bind(y)):(this.setMatrix3x3=y.setMatrix3x3.bind(y),this.setMatrix2x2=y.setMatrix2x2.bind(y),this.setFloat=y.setFloat.bind(y),this.setFloat2=y.setFloat2.bind(y),this.setFloat3=y.setFloat3.bind(y),this.setFloat4=y.setFloat4.bind(y),this.setFloatArray=y.setFloatArray.bind(y),this.setArray=y.setArray.bind(y),this.setIntArray=y.setIntArray.bind(y),this.setMatrix=y.setMatrix.bind(y),this.setMatrices=y.setMatrices.bind(y),this.setVector3=y.setVector3.bind(y),this.setVector4=y.setVector4.bind(y),this.setColor3=y.setColor3.bind(y),this.setColor4=y.setColor4.bind(y),this.setDirectColor4=y.setDirectColor4.bind(y),this.setInt=y.setInt.bind(y),this.setInt2=y.setInt2.bind(y),this.setInt3=y.setInt3.bind(y),this.setInt4=y.setInt4.bind(y))}}var my=A(12233);const T="gpuUpdateParticlesPixelShader",z="#version 300 es\nvoid main() {discard;}\n";my.b.ShadersStore[T]||(my.b.ShadersStore[T]=z);const S="gpuUpdateParticlesVertexShader",M="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";my.b.ShadersStore[S]||(my.b.ShadersStore[S]=M);(0,W.f)("BABYLON.WebGL2ParticleSystem",class{constructor(y,c){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=y,this._engine=c,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var y;return(null===(y=this._updateEffect)||void 0===y?void 0:y.isReady())??!1}createUpdateBuffer(y){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof B&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=y,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new K(this._updateEffect)}createVertexBuffers(y,c){this._updateVAO.push(this._createUpdateVAO(y)),this._renderVAO.push(this._engine.recordVertexArrayObject(c,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=c}createParticleBuffer(y){return y}bindDrawBuffers(y,c,A){A?this._engine.bindBuffers(this._renderVertexBuffers,A,c):this._engine.bindVertexArrayObject(this._renderVAO[y],null)}preUpdateParticleBuffer(){const y=this._engine;if(this._engine.enableEffect(this._updateEffect),!y.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(y,c,A){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[y],null);const l=this._engine;l.bindTransformFeedbackBuffer(c.getBuffer()),l.setRasterizerState(!1),l.beginTransformFeedback(!0),l.drawArraysType(3,0,A),l.endTransformFeedback(),l.setRasterizerState(!0),l.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let y=0;y<this._updateVAO.length;y++)this._engine.releaseVertexArrayObject(this._updateVAO[y]);this._updateVAO.length=0;for(let y=0;y<this._renderVAO.length;y++)this._engine.releaseVertexArrayObject(this._renderVAO[y]);this._renderVAO.length=0}_createUpdateVAO(y){const c={};c.position=y.createVertexBuffer("position",0,3);let A=3;c.age=y.createVertexBuffer("age",A,1),A+=1,c.size=y.createVertexBuffer("size",A,3),A+=3,c.life=y.createVertexBuffer("life",A,1),A+=1,c.seed=y.createVertexBuffer("seed",A,4),A+=4,c.direction=y.createVertexBuffer("direction",A,3),A+=3,this._parent.particleEmitterType instanceof B&&(c.initialPosition=y.createVertexBuffer("initialPosition",A,3),A+=3),this._parent._colorGradientsTexture||(c.color=y.createVertexBuffer("color",A,4),A+=4),this._parent._isBillboardBased||(c.initialDirection=y.createVertexBuffer("initialDirection",A,3),A+=3),this._parent.noiseTexture&&(c.noiseCoordinates1=y.createVertexBuffer("noiseCoordinates1",A,3),A+=3,c.noiseCoordinates2=y.createVertexBuffer("noiseCoordinates2",A,3),A+=3),this._parent._angularSpeedGradientsTexture?(c.angle=y.createVertexBuffer("angle",A,1),A+=1):(c.angle=y.createVertexBuffer("angle",A,2),A+=2),this._parent._isAnimationSheetEnabled&&(c.cellIndex=y.createVertexBuffer("cellIndex",A,1),A+=1,this._parent.spriteRandomStartCell&&(c.cellStartOffset=y.createVertexBuffer("cellStartOffset",A,1),A+=1));const l=this._engine.recordVertexArrayObject(c,null,this._updateEffect);return this._engine.bindArrayBuffer(null),l}});class k{constructor(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,l=arguments.length>3?arguments[3]:void 0;this._engine=y,this._label=l,this._engine._storageBuffers.push(this),this._create(c,A)}_create(y,c){this._bufferSize=y,this._creationFlags=c,this._buffer=this._engine.createStorageBuffer(y,c,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(y,c,A){this._buffer&&this._engine.updateStorageBuffer(this._buffer,y,c,A)}async read(y,c,A,l){return await this._engine.readFromStorageBuffer(this._buffer,y,c,A,l)}dispose(){const y=this._engine._storageBuffers,c=y.indexOf(this);-1!==c&&(y[c]=y[y.length-1],y.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var a=A(12307),u=A(12310),G=A(12363),j=A(12303),f=A(12611),V=A(12161),J=A(12258),U=A(12536);class e{constructor(){this._gpuTimeInFrameId=-1,this.counter=new U.d}_addDuration(y,c){y<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==y?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(c,!1),this._gpuTimeInFrameId=y):this.counter.addCount(c,!1))}}var Q=A(12212);class Y{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=y,this._engine=c,this.uniqueId=f.e.UniqueId,c.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new e),this._engine.getCaps().supportComputeShaders?l.bindingsMapping?(this._context=c.createComputeContext(),this._shaderPath=A,this._options={bindingsMapping:{},defines:[],...l}):V.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):V.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const l=this._bindings[y];this._bindings[y]={type:A?0:4,object:c,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!l||l.object!==c||l.type!==this._bindings[y].type)}setStorageTexture(y,c){const A=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==c),this._bindings[y]={type:1,object:c,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setExternalTexture(y,c){const A=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==c),this._bindings[y]={type:6,object:c,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setVideoTexture(y,c){return!!c.externalTexture&&(this.setExternalTexture(y,c.externalTexture),!0)}setUniformBuffer(y,c){const A=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==c),this._bindings[y]={type:Y._BufferIsDataBuffer(c)?7:2,object:c,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setStorageBuffer(y,c){const A=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==c),this._bindings[y]={type:Y._BufferIsDataBuffer(c)?7:3,object:c,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setTextureSampler(y,c){const A=this._bindings[y];this._contextIsDirty||(this._contextIsDirty=!A||!c.compareSampler(A.object)),this._bindings[y]={type:5,object:c,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}isReady(){let y=this._effect;for(const w in this._bindings){const y=this._bindings[w],c=y.type,A=y.object;switch(c){case 0:case 4:case 1:if(!A.isReady())return!1;break;case 6:if(!A.isReady())return!1;break}}const c=[],A=this._shaderPath;if(this._options.defines)for(let w=0;w<this._options.defines.length;w++)c.push(this._options.defines[w]);const l=c.join("\n");return this._cachedDefines!==l&&(this._cachedDefines=l,y=this._engine.createComputeEffect(A,{defines:l,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=y),!!y.isReady()}dispatch(y,c,A){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,y,c,A,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const A=Y._BufferIsDataBuffer(y)?y:y.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,A,c,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const c in this._bindings){const A=this._bindings[c];if(!this._options.bindingsMapping[c])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+c+"'");switch(A.type){case 0:{const l=this._samplers[c],w=A.object;var y;if(!l||!w._texture||!l.compareSampler(w._texture))this._samplers[c]=(new J.b).setParameters(w.wrapU,w.wrapV,w.wrapR,w.anisotropicFilteringLevel,w._texture.samplingMode,null===(y=w._texture)||void 0===y?void 0:y._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const y=A.object;y.getBuffer()!==A.buffer&&(A.buffer=y.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((w=>{(0,Q.e)((()=>this.dispatch(y,c,A)),w,void 0,l)}))}serialize(){const y=G.d.Serialize(this);y.options=this._options,y.shaderPath=this._shaderPath,y.VO={},y.textures={};for(const c in this._bindings){const A=this._bindings[c],l=A.object;switch(A.type){case 0:case 4:case 1:{const w=l.serialize();w&&(y.textures[c]=w,y.VO[c]={type:A.type});break}}}return y}static Parse(y,c,A){const l=G.d.Parse((()=>new Y(y.name,c.getEngine(),y.shaderPath,y.options)),y,c,A);for(const w in y.textures){const N=y.VO[w],p=j.d.Parse(y.textures[w],c,A);0===N.type?l.setTexture(w,p):4===N.type?l.setTexture(w,p,!1):l.setStorageTexture(w,p)}return l}static _BufferIsDataBuffer(y){return void 0!==y.underlyingResource}}(0,a.b)([(0,u.P)()],Y.prototype,"name",void 0),(0,a.b)([(0,u.P)()],Y.prototype,"fastMode",void 0),(0,W.f)("BABYLON.ComputeShader",Y);var g=A(12570);const x="gpuUpdateParticlesComputeShader",F="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";my.b.ShadersStoreWGSL[x]||(my.b.ShadersStoreWGSL[x]=F);(0,W.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(y,c){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=y,this._engine=c}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var y;return(null===(y=this._updateComputeShader)||void 0===y?void 0:y.isReady())??!1}createUpdateBuffer(y){var c;const A={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(A.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(A.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(A.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(A.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(A.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(A.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(A.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new Y("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:A,defines:y.split("\n")}),null===(c=this._simParamsComputeShader)||void 0===c||c.dispose(),this._simParamsComputeShader=new g.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new K(this._simParamsComputeShader)}createVertexBuffers(y,c){this._renderVertexBuffers.push(c)}createParticleBuffer(y){const c=new k(this._engine,4*y.length,11,"ComputeShaderParticleSystemBuffer");return c.update(y),this._bufferComputeShader.push(c),c.getBuffer()}bindDrawBuffers(y,c,A){this._engine.bindBuffers(this._renderVertexBuffers[y],A,c)}preUpdateParticleBuffer(){}updateParticleBuffer(y,c,A){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[y]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^y]),this._updateComputeShader.dispatch(Math.ceil(A/64))}releaseBuffers(){var y;for(let c=0;c<this._bufferComputeShader.length;++c)this._bufferComputeShader[c].dispose();this._bufferComputeShader.length=0,null===(y=this._simParamsComputeShader)||void 0===y||y.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class R{constructor(y,c,A){this.gradient=y,this.color1=c,this.color2=A}getColorToRef(y){this.color2?p.ip.LerpToRef(this.color1,this.color2,Math.random(),y):y.p(this.color1)}}class r{constructor(y,c){this.gradient=y,this.color=c}}class n{constructor(y,c,A){this.gradient=y,this.factor1=c,this.factor2=A}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class E{static GetCurrentGradient(y,c,A){if(c[0].gradient>y)return void A(c[0],c[0],1);for(let w=0;w<c.length-1;w++){const l=c[w],N=c[w+1];if(y>=l.gradient&&y<=N.gradient){return void A(l,N,(y-l.gradient)/(N.gradient-l.gradient))}}const l=c.length-1;A(c[l],c[l],1)}}var b=A(12153),Z=A(12793),v=A(12184);class d{constructor(y){this.particleSystem=y,this.position=l.gc.Zero(),this.direction=l.gc.Zero(),this.color=new p.ip(0,0,0,0),this.colorStep=new p.ip(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new l.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new p.ip(0,0,0,0),this._currentColor2=new p.ip(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=d._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let y=this.age,c=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===c?(c=1,y=this._randomCellOffset):y+=this._randomCellOffset);const A=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let l;l=this._initialSpriteCellLoop?(0,I.Clamp)(y*c%this.lifeTime/this.lifeTime):(0,I.Clamp)(y*c/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+l*A|0}_inheritParticleInfoToSubEmitter(y){if(y.particleSystem.Ic.position){const c=y.particleSystem.Ic;if(c.position.p(this.position),y.inheritDirection){const y=l.TmpVectors.gc[0];this.direction.normalizeToRef(y),c.setDirection(y,0,Math.PI/2)}}else{y.particleSystem.Ic.p(this.position)}this.direction.scaleToRef(y.inheritedVelocityAmount/2,l.TmpVectors.gc[0]),y.particleSystem._inheritedVelocityOffset.p(l.TmpVectors.gc[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const y of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(y)}_reset(){this.age=0,this.id=d._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(y){y.position.p(this.position),this._initialDirection?y._initialDirection?y._initialDirection.p(this._initialDirection):y._initialDirection=this._initialDirection.clone():y._initialDirection=null,y.direction.p(this.direction),this.hh&&(y.hh?y.hh.p(this.hh):y.hh=this.hh.clone()),y.color.p(this.color),y.colorStep.p(this.colorStep),y.lifeTime=this.lifeTime,y.age=this.age,y._randomCellOffset=this._randomCellOffset,y.size=this.size,y.scale.p(this.scale),y.angle=this.angle,y.angularSpeed=this.angularSpeed,y.particleSystem=this.particleSystem,y.cellIndex=this.cellIndex,y.id=this.id,y._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(y._currentColorGradient=this._currentColorGradient,y._currentColor1.p(this._currentColor1),y._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(y._currentSizeGradient=this._currentSizeGradient,y._currentSize1=this._currentSize1,y._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(y._currentAngularSpeedGradient=this._currentAngularSpeedGradient,y._currentAngularSpeed1=this._currentAngularSpeed1,y._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(y._currentVelocityGradient=this._currentVelocityGradient,y._currentVelocity1=this._currentVelocity1,y._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(y._currentLimitVelocityGradient=this._currentLimitVelocityGradient,y._currentLimitVelocity1=this._currentLimitVelocity1,y._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(y._currentDragGradient=this._currentDragGradient,y._currentDrag1=this._currentDrag1,y._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(y._initialStartSpriteCellId=this._initialStartSpriteCellId,y._initialEndSpriteCellId=this._initialEndSpriteCellId,y._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(y.remapData&&this.remapData?y.remapData.p(this.remapData):y.remapData=new l.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(y._randomNoiseCoordinates1?(y._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),y._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(y._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),y._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}d._Count=0;var yy=A(12448),cy=(A(12478),A(12692)),Ay=A(12683),ly=A(12564);function wy(y,c){const A=(0,I.RandomRange)(0,1);p.ip.LerpToRef(c.color1,c.color2,A,y.color),c.colorDead.subtractToRef(y.color,c._colorDiff),c._colorDiff.scaleToRef(1/y.lifeTime,y.colorStep)}function Ny(y,c){y._currentColorGradient=c._colorGradients[0],y._currentColorGradient.getColorToRef(y.color),y._currentColor1.p(y.color),c._colorGradients.length>1?c._colorGradients[1].getColorToRef(y._currentColor2):y._currentColor2.p(y.color)}function py(y,c){const A=c._colorGradients;E.GetCurrentGradient(c._ratio,A,((c,A,l)=>{c!==y._currentColorGradient&&(y._currentColor1.p(y._currentColor2),A.getColorToRef(y._currentColor2),y._currentColorGradient=c),p.ip.LerpToRef(y._currentColor1,y._currentColor2,l,y.color)}))}function Wy(y,c){y.colorStep.scaleToRef(c._scaledUpdateSpeed,c._scaledColorStep),y.color.addInPlace(c._scaledColorStep),y.color.a<0&&(y.color.a=0)}function hy(y,c){E.GetCurrentGradient(c._ratio,c._angularSpeedGradients,((c,A,l)=>{c!==y._currentAngularSpeedGradient&&(y._currentAngularSpeed1=y._currentAngularSpeed2,y._currentAngularSpeed2=A.getFactor(),y._currentAngularSpeedGradient=c),y.angularSpeed=(0,I.Lerp)(y._currentAngularSpeed1,y._currentAngularSpeed2,l)}))}function Iy(y,c){y.angle+=y.angularSpeed*c._scaledUpdateSpeed}function qy(y,c){c.particleEmitterType.startDirectionFunction(c._emitterWorldMatrix,y.direction,y,c.isLocal,c._emitterInverseWorldMatrix)}function oy(y,c){c.startDirectionFunction(c._emitterWorldMatrix,y.direction,y,c.isLocal)}function Oy(y,c){y._currentVelocityGradient=c._velocityGradients[0],y._currentVelocity1=y._currentVelocityGradient.getFactor(),c._velocityGradients.length>1?y._currentVelocity2=c._velocityGradients[1].getFactor():y._currentVelocity2=y._currentVelocity1}function Ly(y,c){y._currentLimitVelocityGradient=c._limitVelocityGradients[0],y._currentLimitVelocity1=y._currentLimitVelocityGradient.getFactor(),c._limitVelocityGradients.length>1?y._currentLimitVelocity2=c._limitVelocityGradients[1].getFactor():y._currentLimitVelocity2=y._currentLimitVelocity1}function iy(y,c){E.GetCurrentGradient(c._ratio,c._velocityGradients,((A,l,w)=>{A!==y._currentVelocityGradient&&(y._currentVelocity1=y._currentVelocity2,y._currentVelocity2=l.getFactor(),y._currentVelocityGradient=A),c._directionScale*=(0,I.Lerp)(y._currentVelocity1,y._currentVelocity2,w)}))}function Hy(y,c){E.GetCurrentGradient(c._ratio,c._limitVelocityGradients,((A,l,w)=>{A!==y._currentLimitVelocityGradient&&(y._currentLimitVelocity1=y._currentLimitVelocity2,y._currentLimitVelocity2=l.getFactor(),y._currentLimitVelocityGradient=A);const N=(0,I.Lerp)(y._currentLimitVelocity1,y._currentLimitVelocity2,w);y.direction.length()>N&&y.direction.scaleInPlace(c.limitVelocityDamping)}))}function Py(y,c){y.direction.scaleToRef(c._directionScale,c._scaledDirection)}function Dy(y,c){c.particleEmitterType.startPositionFunction(c._emitterWorldMatrix,y.position,y,c.isLocal)}function ty(y,c){c.startPositionFunction(c._emitterWorldMatrix,y.position,y,c.isLocal)}function sy(y,c){y.hh?y.hh.p(y.position):y.hh=y.position.clone(),l.gc.TransformCoordinatesToRef(y.hh,c._emitterWorldMatrix,y.position)}function By(y,c){c.isLocal&&y.hh?(y.hh.addInPlace(c._scaledDirection),l.gc.TransformCoordinatesToRef(y.hh,c._emitterWorldMatrix,y.position)):y.position.addInPlace(c._scaledDirection)}function Xy(y,c){y._currentDragGradient=c._dragGradients[0],y._currentDrag1=y._currentDragGradient.getFactor(),c._dragGradients.length>1?y._currentDrag2=c._dragGradients[1].getFactor():y._currentDrag2=y._currentDrag1}function Cy(y,c){E.GetCurrentGradient(c._ratio,c._dragGradients,((A,l,w)=>{A!==y._currentDragGradient&&(y._currentDrag1=y._currentDrag2,y._currentDrag2=l.getFactor(),y._currentDragGradient=A);const N=(0,I.Lerp)(y._currentDrag1,y._currentDrag2,w);c._scaledDirection.scaleInPlace(1-N)}))}function Ky(y,c){y._randomNoiseCoordinates1?(y._randomNoiseCoordinates1.Ec(Math.random(),Math.random(),Math.random()),y._randomNoiseCoordinates2.Ec(Math.random(),Math.random(),Math.random())):(y._randomNoiseCoordinates1=new l.gc(Math.random(),Math.random(),Math.random()),y._randomNoiseCoordinates2=new l.gc(Math.random(),Math.random(),Math.random()))}function mc(y,c){const A=c._noiseTextureData,w=c._noiseTextureSize;if(A&&w&&y._randomNoiseCoordinates1){const N=c._fetchR(y._randomNoiseCoordinates1.x,y._randomNoiseCoordinates1.y,w.width,w.height,A),p=c._fetchR(y._randomNoiseCoordinates1.z,y._randomNoiseCoordinates2.x,w.width,w.height,A),W=c._fetchR(y._randomNoiseCoordinates2.y,y._randomNoiseCoordinates2.z,w.width,w.height,A),h=l.TmpVectors.gc[0],I=l.TmpVectors.gc[1];h.Ec((2*N-1)*c.noiseStrength.x,(2*p-1)*c.noiseStrength.y,(2*W-1)*c.noiseStrength.z),h.scaleToRef(c._tempScaledUpdateSpeed,I),y.direction.addInPlace(I)}}function Ty(y,c){c.gravity.scaleToRef(c._tempScaledUpdateSpeed,c._scaledGravity),y.direction.addInPlace(c._scaledGravity)}function zy(y,c){y.size=(0,I.RandomRange)(c.minSize,c.maxSize),y.scale.Ec((0,I.RandomRange)(c.minScaleX,c.maxScaleX),(0,I.RandomRange)(c.minScaleY,c.maxScaleY))}function Sy(y,c){y._currentSizeGradient=c._sizeGradients[0],y._currentSize1=y._currentSizeGradient.getFactor(),y.size=y._currentSize1,c._sizeGradients.length>1?y._currentSize2=c._sizeGradients[1].getFactor():y._currentSize2=y._currentSize1,y.scale.Ec((0,I.RandomRange)(c.minScaleX,c.maxScaleX),(0,I.RandomRange)(c.minScaleY,c.maxScaleY))}function My(y,c){const A=c._actualFrame/c.targetStopDuration;E.GetCurrentGradient(A,c._startSizeGradients,((A,l,w)=>{A!==c._currentStartSizeGradient&&(c._currentStartSize1=c._currentStartSize2,c._currentStartSize2=l.getFactor(),c._currentStartSizeGradient=A);const N=(0,I.Lerp)(c._currentStartSize1,c._currentStartSize2,w);y.scale.scaleInPlace(N)}))}function ky(y,c){E.GetCurrentGradient(c._ratio,c._sizeGradients,((c,A,l)=>{c!==y._currentSizeGradient&&(y._currentSize1=y._currentSize2,y._currentSize2=A.getFactor(),y._currentSizeGradient=c),y.size=(0,I.Lerp)(y._currentSize1,y._currentSize2,l)}))}function ay(y,c){y.remapData=new l.Vector4(0,1,0,1)}function uy(y,c){c._colorRemapGradients&&c._colorRemapGradients.length>0&&E.GetCurrentGradient(c._ratio,c._colorRemapGradients,((c,A,l)=>{const w=(0,I.Lerp)(c.factor1,A.factor1,l),N=(0,I.Lerp)(c.factor2,A.factor2,l);y.remapData.x=w,y.remapData.y=N-w})),c._alphaRemapGradients&&c._alphaRemapGradients.length>0&&E.GetCurrentGradient(c._ratio,c._alphaRemapGradients,((c,A,l)=>{const w=(0,I.Lerp)(c.factor1,A.factor1,l),N=(0,I.Lerp)(c.factor2,A.factor2,l);y.remapData.z=w,y.remapData.w=N-w}))}function Gy(y,c){const A=(0,I.Clamp)(c._actualFrame/c.targetStopDuration);E.GetCurrentGradient(A,c._lifeTimeGradients,((c,l)=>{const w=c,N=l,p=w.getFactor(),W=N.getFactor(),h=(A-w.gradient)/(N.gradient-w.gradient);y.lifeTime=(0,I.Lerp)(p,W,h)})),c._emitPower=(0,I.RandomRange)(c.minEmitPower,c.maxEmitPower)}function jy(y,c){y.lifeTime=(0,I.RandomRange)(c.minLifeTime,c.maxLifeTime),c._emitPower=(0,I.RandomRange)(c.minEmitPower,c.maxEmitPower)}function fy(y,c){0===c._emitPower?(y._initialDirection?y._initialDirection.p(y.direction):y._initialDirection=y.direction.clone(),y.direction.set(0,0,0)):(y._initialDirection=null,y.direction.scaleInPlace(c._emitPower)),y.direction.addInPlace(c._inheritedVelocityOffset)}function Vy(y,c){y.angularSpeed=(0,I.RandomRange)(c.minAngularSpeed,c.maxAngularSpeed),y.angle=(0,I.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function Jy(y,c){y._currentAngularSpeedGradient=c._angularSpeedGradients[0],y.angularSpeed=y._currentAngularSpeedGradient.getFactor(),y._currentAngularSpeed1=y.angularSpeed,c._angularSpeedGradients.length>1?y._currentAngularSpeed2=c._angularSpeedGradients[1].getFactor():y._currentAngularSpeed2=y._currentAngularSpeed1,y.angle=(0,I.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function Uy(y,c){y._initialStartSpriteCellId=c.startSpriteCellID,y._initialEndSpriteCellId=c.endSpriteCellID,y._initialSpriteCellLoop=c.spriteCellLoop}function ey(y,c){y.previousItem=c.previousItem,y.nextItem=c,c.previousItem&&(c.previousItem.nextItem=y),c.previousItem=y}function Qy(y,c){y.previousItem=c,y.nextItem=c.nextItem,c.nextItem&&(c.nextItem.previousItem=y),c.nextItem=y}function Yy(y,c){let A=c;for(;A.nextItem;)A=A.nextItem;y.previousItem=A,y.nextItem=A.nextItem,A.nextItem=y}function gy(y){y.previousItem&&(y.previousItem.nextItem=y.nextItem),y.nextItem&&(y.nextItem.previousItem=y.previousItem)}class xy extends h{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(y){this._startDirectionFunction!==y&&(this._startDirectionFunction=y,this._directionProcessing.process=y?oy:qy)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(y){this._startPositionFunction!==y&&(this._startPositionFunction=y,this._positionCreation.process=y?ty:Dy)}set onDispose(y){this._onDisposeObserver&&this.zc.remove(this._onDisposeObserver),this._onDisposeObserver=this.zc.add(y)}get I(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(y){this._useRampGradients!==y&&(this._useRampGradients=y,this._resetEffect(),y?(this._rampCreation={process:ay,previousItem:null,nextItem:null},Qy(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:uy,previousItem:null,nextItem:null},Qy(this._remapGradientProcessing,this._gravityProcessing)):(gy(this._rampCreation),gy(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(y){this._isLocal!==y&&(this._isLocal=y,y?(this._isLocalCreation={process:sy,previousItem:null,nextItem:null},Qy(this._isLocalCreation,this._positionCreation)):gy(this._isLocalCreation))}get particles(){return this.aO}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(y){this._animationSheetEnabled!==y&&(this._animationSheetEnabled=y,y?(this._sheetCreation={process:Uy,previousItem:null,nextItem:null},Qy(this._sheetCreation,this._colorCreation)):gy(this._sheetCreation),this._reset())}getActiveCount(){return this.aO.length}getClassName(){return"Ah"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var y;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(y=this._customWrappers[c])||void 0===y?void 0:y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[y]??this._customWrappers[0]}setCustomEffect(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new yy.d(this._engine),this._customWrappers[c].effect=y,this._customWrappers[c].drawContext&&(this._customWrappers[c].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new b.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(y){if(this.noiseTexture!==y){if(this._noiseTexture=y,!y)return gy(this._noiseCreation),void gy(this._noiseProcessing);this._noiseCreation={process:Ky,previousItem:null,nextItem:null},Qy(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:mc,previousItem:null,nextItem:null},Qy(this._noiseProcessing,this._positionProcessing)}}constructor(y,c,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(y),this._emitterInverseWorldMatrix=l.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new l.gc,this.zc=new b.d,this.onStoppedObservable=new b.d,this.onStartedObservable=new b.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.aO=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new p.ip(0,0,0,0),this._colorDiff=new p.ip(0,0,0,0),this._scaledDirection=l.gc.Zero(),this._scaledGravity=l.gc.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=y=>{},this.recycleParticle=y=>{const c=this.aO.pop();c!==y&&c.copyTo(y),this._stockParticles.push(c)},this._createParticle=()=>{let y;return 0!==this._stockParticles.length?(y=this._stockParticles.pop(),y._reset()):y=new d(this),this._prepareParticle(y),y},this.paused=!1,this._shadersLoaded=!1,this._capacity=c,this._epsilon=W,A&&"Scene"!==A.getClassName()?(this._engine=A,this.defaultProjectionMatrix=l.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=A||v.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.MO.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:jy,previousItem:null,nextItem:null},this._positionCreation={process:Dy,previousItem:null,nextItem:null},Qy(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:qy,previousItem:null,nextItem:null},Qy(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:fy,previousItem:null,nextItem:null},Qy(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:zy,previousItem:null,nextItem:null},Qy(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Vy,previousItem:null,nextItem:null},Qy(this._angleCreation,this._sizeCreation),this._colorCreation={process:wy,previousItem:null,nextItem:null},Qy(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,h||(this._colorProcessing={process:Wy,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Iy,previousItem:null,nextItem:null},Qy(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Py,previousItem:null,nextItem:null},Qy(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:By,previousItem:null,nextItem:null},Qy(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Ty,previousItem:null,nextItem:null},Qy(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=N,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new yy.d(this._engine)},this._customWrappers[0].effect=w,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new o,this.updateFunction=y=>{var c;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(c=this.noiseTexture.getContent())||void 0===c||c.then((y=>{this._noiseTextureData=y})));const A=y===this.aO;for(let l=0;l<y.length;l++){const c=y[l];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const w=c.age;if(c.age+=this._tempScaledUpdateSpeed,c.age>c.lifeTime){const y=c.age-w,A=c.lifeTime-w;this._tempScaledUpdateSpeed=A*this._tempScaledUpdateSpeed/y,c.age=c.lifeTime}this._ratio=c.age/c.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let N=this._updateQueueStart;for(;N;)N.process(c,this),N=N.nextItem;if(this._isAnimationSheetEnabled&&!h&&c.updateCellIndex(),c._inheritParticleInfoToSubEmitters(),c.age>=c.lifeTime){if(this._emitFromParticle(c),c._attachedSubEmitters){for(const y of c._attachedSubEmitters)y.particleSystem.disposeOnStop=!0,y.particleSystem.stop();c._attachedSubEmitters=null}this.recycleParticle(c),A&&l--}else;}}}serialize(y){throw new Error("Method not implemented.")}clone(y,c){throw new Error("Method not implemented.")}_addFactorGradient(y,c,A,l){const w=new n(c,A,l);y.push(w),y.sort(((y,c)=>y.gradient<c.gradient?-1:y.gradient>c.gradient?1:0))}_removeFactorGradient(y,c){if(!y)return;let A=0;for(const l of y){if(l.gradient===c){y.splice(A,1);break}A++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Gy:this._lifeTimeCreation.process=jy}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:My,previousItem:null,nextItem:null},Qy(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(gy(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(y){this.targetStopDuration!==y&&(this._targetStopDuration=y,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(y,c,A){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,y,c,A),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(y){return this._removeFactorGradient(this._lifeTimeGradients,y),this._syncLifeTimeCreation(),this}addSizeGradient(y,c,A){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Sy,this._sizeGradientProcessing={process:ky,previousItem:null,nextItem:null},ey(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,y,c,A),this}removeSizeGradient(y){var c;return this._removeFactorGradient(this._sizeGradients,y),0===(null===(c=this._sizeGradients)||void 0===c?void 0:c.length)&&(gy(this._sizeGradientProcessing),this._sizeCreation.process=zy),this}addColorRemapGradient(y,c,A){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,y,c,A),this}removeColorRemapGradient(y){return this._removeFactorGradient(this._colorRemapGradients,y),this}addAlphaRemapGradient(y,c,A){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,y,c,A),this}removeAlphaRemapGradient(y){return this._removeFactorGradient(this._alphaRemapGradients,y),this}addAngularSpeedGradient(y,c,A){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Jy,this._angularSpeedGradientProcessing={process:hy,previousItem:null,nextItem:null},ey(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,y,c,A),this}removeAngularSpeedGradient(y){var c;return this._removeFactorGradient(this._angularSpeedGradients,y),0===(null===(c=this._angularSpeedGradients)||void 0===c?void 0:c.length)&&(this._angleCreation.process=Vy,gy(this._angularSpeedGradientProcessing)),this}addVelocityGradient(y,c,A){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Oy,previousItem:null,nextItem:null},Qy(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:iy,previousItem:null,nextItem:null},ey(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,y,c,A),this}removeVelocityGradient(y){var c;return this._removeFactorGradient(this._velocityGradients,y),0===(null===(c=this._velocityGradients)||void 0===c?void 0:c.length)&&(gy(this._velocityCreation),gy(this._velocityGradientProcessing)),this}addLimitVelocityGradient(y,c,A){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Ly,previousItem:null,nextItem:null},Qy(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Hy,previousItem:null,nextItem:null},Qy(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,y,c,A),this}removeLimitVelocityGradient(y){var c;return this._removeFactorGradient(this._limitVelocityGradients,y),0===(null===(c=this._limitVelocityGradients)||void 0===c?void 0:c.length)&&(gy(this._limitVelocityCreation),gy(this._limitVelocityGradientProcessing)),this}addDragGradient(y,c,A){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Xy,previousItem:null,nextItem:null},ey(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Cy,previousItem:null,nextItem:null},ey(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,y,c,A),this}removeDragGradient(y){var c;return this._removeFactorGradient(this._dragGradients,y),0===(null===(c=this._dragGradients)||void 0===c?void 0:c.length)&&(gy(this._dragCreation),gy(this._dragGradientProcessing)),this}addEmitRateGradient(y,c,A){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,y,c,A),this}removeEmitRateGradient(y){return this._removeFactorGradient(this._emitRateGradients,y),this}addStartSizeGradient(y,c,A){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,y,c,A),this._syncStartSizeCreation(),this}removeStartSizeGradient(y){return this._removeFactorGradient(this._startSizeGradients,y),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const y=new Uint8Array(4*this._rawTextureWidth),c=p.TmpColors.dc[0];for(let A=0;A<this._rawTextureWidth;A++){const l=A/this._rawTextureWidth;E.GetCurrentGradient(l,this._rampGradients,((l,w,N)=>{p.dc.LerpToRef(l.color,w.color,N,c),y[4*A]=255*c.r,y[4*A+1]=255*c.g,y[4*A+2]=255*c.b,y[4*A+3]=255}))}this._rampGradientsTexture=Z.b.CreateRGBATexture(y,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((y,c)=>y.gradient<c.gradient?-1:y.gradient>c.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(y,c){this._rampGradients||(this._rampGradients=[]);const A=new r(y,c);return this._rampGradients.push(A),this._syncRampGradientTexture(),this}removeRampGradient(y){return this._removeGradientAndTexture(y,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(y,c,A){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Ny,this._colorProcessing.process=py);const l=new R(y,c,A);return this._colorGradients.push(l),this._colorGradients.sort(((y,c)=>y.gradient<c.gradient?-1:y.gradient>c.gradient?1:0)),this}removeColorGradient(y){if(!this._colorGradients)return this;let c=0;for(const A of this._colorGradients){if(A.gradient===y){this._colorGradients.splice(c,1);break}c++}return 0===this._colorGradients.length&&(this._colorCreation.process=wy,this._colorProcessing.process=Wy),this}resetDrawCache(){if(this._drawWrappers){for(const y of this._drawWrappers)if(y)for(const c of y)null===c||void 0===c||c.dispose();this._drawWrappers=[]}}_fetchR(y,c,A,l,w){return w[4*(((y=.5*Math.abs(y)+.5)*A%A|0)+((c=.5*Math.abs(c)+.5)*l%l|0)*A)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const y=this._engine,c=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*c),this._vertexBuffer=new X.c(y,this._vertexData,!0,c);let A=0;const l=this._vertexBuffer.createVertexBuffer(X.e.PositionKind,A,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.e.PositionKind]=l,A+=3;const w=this._vertexBuffer.createVertexBuffer(X.e.ColorKind,A,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.e.ColorKind]=w,A+=4;const N=this._vertexBuffer.createVertexBuffer("angle",A,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=N,A+=1;const p=this._vertexBuffer.createVertexBuffer("size",A,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=p,A+=2,this._isAnimationSheetEnabled){const y=this._vertexBuffer.createVertexBuffer("cellIndex",A,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=y,A+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const y=this._vertexBuffer.createVertexBuffer("direction",A,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=y,A+=3}if(this._useRampGradients){const y=this._vertexBuffer.createVertexBuffer("remapData",A,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=y,A+=4}let W;if(this._useInstancing){const c=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new X.c(y,c,!1,2),W=this._spriteBuffer.createVertexBuffer("offset",0,2)}else W=this._vertexBuffer.createVertexBuffer("offset",A,2,this._vertexBufferSize,this._useInstancing),A+=2;this._vertexBuffers.offset=W,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const y=[],c=[];let A=0;for(let l=0;l<this._capacity;l++)y.push(A),y.push(A+1),y.push(A+2),y.push(A),y.push(A+2),y.push(A+3),c.push(A,A+1,A+1,A+2,A+2,A+3,A+3,A,A,A+3),A+=4;this._indexBuffer=this._engine.createIndexBuffer(y),this._linesIndexBuffer=this._engine.createIndexBuffer(c)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(y)setTimeout((()=>{this.start(0)}),y);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var c;-1!==(null===(c=this.Ic)||void 0===c?void 0:c.getClassName().indexOf("Mesh"))&&this.Ic.Yc(!0);const y=this.noiseTexture;if(y&&y.onGeneratedObservable)y.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let c=0;c<this.preWarmCycles;c++)this.animate(!0),y.render()}))}));else for(let c=0;c<this.preWarmCycles;c++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(y))}_postStop(y){}reset(){this._stockParticles.length=0,this.aO.length=0}_appendParticleVertex(y,c,A,w){let N=y*this._vertexBufferSize;if(this._vertexData[N++]=c.position.x+this.rI.x,this._vertexData[N++]=c.position.y+this.rI.y,this._vertexData[N++]=c.position.z+this.rI.z,this._vertexData[N++]=c.color.r,this._vertexData[N++]=c.color.g,this._vertexData[N++]=c.color.b,this._vertexData[N++]=c.color.a,this._vertexData[N++]=c.angle,this._vertexData[N++]=c.scale.x*c.size,this._vertexData[N++]=c.scale.y*c.size,this._isAnimationSheetEnabled&&(this._vertexData[N++]=c.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[N++]=c.direction.x,this._vertexData[N++]=c.direction.y,this._vertexData[N++]=c.direction.z);else if(c._initialDirection){let y=c._initialDirection;this.isLocal&&(l.gc.TransformNormalToRef(y,this._emitterWorldMatrix,l.TmpVectors.gc[0]),y=l.TmpVectors.gc[0]),0===y.x&&0===y.z&&(y.x=.001),this._vertexData[N++]=y.x,this._vertexData[N++]=y.y,this._vertexData[N++]=y.z}else{let y=c.direction;this.isLocal&&(l.gc.TransformNormalToRef(y,this._emitterWorldMatrix,l.TmpVectors.gc[0]),y=l.TmpVectors.gc[0]),0===y.x&&0===y.z&&(y.x=.001),this._vertexData[N++]=y.x,this._vertexData[N++]=y.y,this._vertexData[N++]=y.z}this._useRampGradients&&c.remapData&&(this._vertexData[N++]=c.remapData.x,this._vertexData[N++]=c.remapData.y,this._vertexData[N++]=c.remapData.z,this._vertexData[N++]=c.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===A?A=this._epsilon:1===A&&(A=1-this._epsilon),0===w?w=this._epsilon:1===w&&(w=1-this._epsilon)),this._vertexData[N++]=A,this._vertexData[N++]=w)}_prepareParticle(y){}_createNewOnes(y){let c;for(let A=0;A<y&&this.aO.length!==this._capacity;A++){c=this._createParticle(),this.aO.push(c);let y=this._createQueueStart;for(;y;)y.process(c,this),y=y.nextItem;c._inheritParticleInfoToSubEmitters()}}_update(y){if(this._alive=this.aO.length>0,this.Ic.position){const y=this.Ic;this._emitterWorldMatrix=y.getWorldMatrix()}else{const y=this.Ic;this._emitterWorldMatrix=l.Matrix.Translation(y.x,y.y,y.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.aO),this._createNewOnes(y)}static _GetAttributeNamesOrOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=[X.e.PositionKind,X.e.ColorKind,"angle","offset","size"];return y&&l.push("cellIndex"),c||l.push("direction"),A&&l.push("remapData"),l}static _GetEffectCreationOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,cy.d)(l),y&&l.push("particlesInfos"),c&&l.push("logarithmicDepthConstant"),A&&(l.push("vFogInfos"),l.push("vFogColor")),l}fillDefines(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cy.l)(this,this._scene,y),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&y.push("#define FOG")),this._isAnimationSheetEnabled&&y.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&y.push("#define LOGARITHMICDEPTH"),c===h.BLENDMODE_MULTIPLY&&y.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&y.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(y.push("#define BILLBOARD"),this.billboardMode){case 2:y.push("#define BILLBOARDY");break;case 8:case 9:y.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&y.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:y.push("#define BILLBOARDMODE_ALL")}A&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),y.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(y,c,A){c.push(...xy._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),y.push(...xy._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),A.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,ly.h)(y,this._imageProcessingConfigurationDefines),(0,ly.d)(A,this._imageProcessingConfigurationDefines))}_getWrapper(y){const c=this._getCustomDrawWrapper(y);if(null!==c&&void 0!==c&&c.effect)return c;const A=[];this.fillDefines(A,y);const l=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let w=this._drawWrappers[l];w||(w=this._drawWrappers[l]=[]);let N=w[y];N||(N=new yy.d(this._engine),N.drawContext&&(N.drawContext.useInstancing=this._useInstancing),w[y]=N);const p=A.join("\n");if(N.defines!==p){const y=[],c=[],A=[];this.fillUniformsAttributesAndSamplerNames(c,y,A),N.setEffect(this._engine.createEffect("particles",y,c,A,p,void 0,void 0,void 0,void 0,this._shaderLanguage),p)}return N}animate(){var y;let c,A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!A&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(A?this.preWarmStepOffset:(null===(y=this._scene)||void 0===y?void 0:y.getAnimationRatio())||1),this.manualEmitCount>-1)c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let y=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const c=this._actualFrame/this.targetStopDuration;E.GetCurrentGradient(c,this._emitRateGradients,((c,A,l)=>{c!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=A.getFactor(),this._currentEmitRateGradient=c),y=(0,I.Lerp)(this._currentEmitRate1,this._currentEmitRate2,l)}))}c=y*this._scaledUpdateSpeed|0,this._newPartsExcess+=y*this._scaledUpdateSpeed-c}if(this._newPartsExcess>1&&(c+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(c),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!A){let y=0;for(let c=0;c<this.aO.length;c++){const A=this.aO[c];this._appendParticleVertices(y,A),y+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.aO.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(y,c){this._appendParticleVertex(y++,c,0,0),this._useInstancing||(this._appendParticleVertex(y++,c,1,0),this._appendParticleVertex(y++,c,1,1),this._appendParticleVertex(y++,c,0,1))}rebuild(){var y;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(y=this._spriteBuffer)||void 0===y||y._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!xy.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(A.bind(A,13745)),Promise.resolve().then(A.bind(A,13682))])):await Promise.all([Promise.resolve().then(A.bind(A,13674)),Promise.resolve().then(A.bind(A,13668))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Ic||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==h.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(h.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(h.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(y){const c=this._getWrapper(y),A=c.effect,w=this._engine;w.enableEffect(c);const N=this.defaultViewMatrix??this._scene.getViewMatrix();if(A.setTexture("diffuseSampler",this.particleTexture),A.setMatrix("view",N),A.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const y=this.particleTexture.getBaseSize();A.setFloat3("particlesInfos",this.spriteCellWidth/y.width,this.spriteCellHeight/y.height,this.spriteCellWidth/y.width)}if(A.setVector2("translationPivot",this.translationPivot),A.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const y=this._scene.activeCamera;A.setVector3("eyePosition",y.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),A.setTexture("rampSampler",this._rampGradientsTexture));const p=A.defines;var W,h,I,q,o,O;(this._scene&&((0,cy.g)(A,this,this._scene),this.applyFog&&(0,Ay.f)(this._scene,void 0,A)),p.indexOf("#define BILLBOARDMODE_ALL")>=0&&(N.invertToRef(l.TmpVectors.Matrix[0]),A.setMatrix("invView",l.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?w.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,A):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,A)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?w.bindBuffers(this._vertexBuffers,null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._linesIndexBuffer:this._indexBuffer,A):w.bindBuffers(this._vertexBuffers,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null,A);(this.useLogarithmicDepth&&this._scene&&(0,Ay.l)(p,A,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(A),this._setEngineBasedOnBlendMode(y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(A),this._useInstancing)?null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?w.drawElementsType(6,0,10,this.aO.length):w.drawArraysType(7,0,4,this.aO.length):null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?w.drawElementsType(1,0,10*this.aO.length):w.drawElementsType(0,0,6*this.aO.length);return this.aO.length}render(){if(!this.isReady()||!this.aO.length)return 0;const y=this._engine;y.setState&&(y.setState(!1),this.forceDepthWrite&&y.setDepthWrite(!0));let c=0;return c=this.blendMode===h.BLENDMODE_MULTIPLYADD?this._render(h.BLENDMODE_MULTIPLY)+this._render(h.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),c}_onDispose(){}dispose(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(c,A),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const y=this._scene.MO.indexOf(this);y>-1&&this._scene.MO.splice(y,1),this._scene._activeParticleSystems.dispose()}this.zc.notifyObservers(this),this.zc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}xy.ForceGLSL=!1;var Fy,Ry=A(12178);!function(y){y[y.ATTACHED=0]="ATTACHED",y[y.END=1]="END"}(Fy||(Fy={}));class ry{constructor(y){if(this.particleSystem=y,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!y.Ic||!y.Ic.dispose){const c=(0,W.d)("BABYLON.AbstractMesh");y.Ic=new c("SubemitterSystemEmitter",y.mc()),y._disposeEmitterOnDispose=!0}}clone(){let y=this.particleSystem.Ic;if(y){if(y instanceof l.gc)y=y.clone();else if(-1!==y.getClassName().indexOf("Mesh")){y=new((0,W.d)("BABYLON.Mesh"))("",y.mc()),y.isVisible=!1}}else y=new l.gc;const c=new ry(this.particleSystem.clone(this.particleSystem.name,y));return c.particleSystem.name+="Clone",c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem._disposeEmitterOnDispose=!0,c.particleSystem.disposeOnStop=!0,c}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem=this.particleSystem.serialize(y),c}static _ParseParticleSystem(y,c,A){throw(0,Ry.d)("ParseParticle")}static Parse(y,c,A){const l=y.particleSystem,w=new ry(ry._ParseParticleSystem(l,c,A,!0));return w.type=y.type,w.inheritDirection=y.inheritDirection,w.inheritedVelocityAmount=y.inheritedVelocityAmount,w.particleSystem._isSubEmitter=!0,w}dispose(){this.particleSystem.dispose()}}var ny=A(12220);function Ey(y,c){const A=new D;return A.direction1=y,A.direction2=c,A}function by(){return new P(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Zy(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function vy(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.gc(0,1,0),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.gc(0,1,0);return new s(y,c,A)}function dy(){return new i(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function yc(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.gc(0,1,0),N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.gc(0,1,0);return new H(y,c,A,w,N)}function cc(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new O(y,c)}function Ac(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.gc(0,1,0),w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.gc(0,1,0);return new L(y,c,A,w)}const lc=l.gc.Zero(),wc=l.gc.Zero(),Nc=l.gc.Zero();class pc{constructor(){this.strength=0,this.position=l.gc.Zero()}_processParticle(y,c){this.position.subtractToRef(y.position,lc);const A=lc.lengthSquared()+1;lc.normalize().scaleToRef(this.strength/A,wc),wc.scaleToRef(c._tempScaledUpdateSpeed,Nc),y.direction.addInPlace(Nc)}serialize(){return{position:this.position.fc(),strength:this.strength}}}class Wc extends xy{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=y=>{if(!this._subEmitters||0===this._subEmitters.length)return;const c=Math.floor(Math.random()*this._subEmitters.length);for(const A of this._subEmitters[c])if(1===A.type){const c=A.clone();y._inheritParticleInfoToSubEmitter(c),c.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(c.particleSystem),c.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(y,c){const A=Ey(y,c);return this.particleEmitterType=A,A}get flowMap(){return this._flowMap}set flowMap(y){this._flowMap!==y&&(this._flowMap=y,this._flowMapUpdate&&(gy(this._flowMapUpdate),this._flowMapUpdate=null),y&&(this._flowMapUpdate={process:y=>{var c;const A=null===(c=this.mc())||void 0===c?void 0:c.getTransformMatrix();this._flowMap._processParticle(y,this.flowMapStrength*this._tempScaledUpdateSpeed,A)},previousItem:null,nextItem:null},Qy(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(y){this._attractors.push(y),1===this._attractors.length&&(this._attractorUpdate={process:y=>{for(const c of this._attractors)c._processParticle(y,this)},previousItem:null,nextItem:null},Qy(this._attractorUpdate,this._directionProcessing))}removeAttractor(y){const c=this._attractors.indexOf(y);-1!==c&&this._attractors.splice(c,1),0===this._attractors.length&&gy(this._attractorUpdate)}start(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(y)}createHemisphericEmitter(){const y=by(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createSphereEmitter(){const y=Zy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createDirectedSphereEmitter(){const y=vy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.gc(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.gc(0,1,0));return this.particleEmitterType=y,y}createCylinderEmitter(){const y=dy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=y,y}createDirectedCylinderEmitter(){const y=yc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.gc(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.gc(0,1,0));return this.particleEmitterType=y,y}createConeEmitter(){const y=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=y,y}createDirectedConeEmitter(){const y=Ac(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.gc(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.gc(0,1,0));return this.particleEmitterType=y,y}createBoxEmitter(y,c,A,l){const w=new o;return this.particleEmitterType=w,this.direction1=y,this.direction2=c,this.minEmitBox=A,this.maxEmitBox=l,w}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const y of this.subEmitters)y instanceof Wc?this._subEmitters.push([new ry(y)]):y instanceof ry?this._subEmitters.push([y]):y instanceof Array&&this._subEmitters.push(y)}_stopSubEmitters(){if(this.activeSubSystems){for(const y of this.activeSubSystems)y.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const y=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==y&&this._rootParticleSystem.activeSubSystems.splice(y,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(y){y&&this._stopSubEmitters()}_prepareParticle(y){if(this._subEmitters&&this._subEmitters.length>0){const c=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];y._attachedSubEmitters=[];for(const A of c)if(0===A.type){const c=A.clone();y._attachedSubEmitters.push(c),c.particleSystem.start()}}}_onDispose(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),y&&this.particles)for(const A of this.particles)if(A._attachedSubEmitters)for(let y=A._attachedSubEmitters.length-1;y>=0;y-=1)A._attachedSubEmitters[y].dispose();if(c&&this.activeSubSystems)for(let A=this.activeSubSystems.length-1;A>=0;A-=1)this.activeSubSystems[A].dispose();if(this._subEmitters&&this._subEmitters.length){for(let y=0;y<this._subEmitters.length;y++)for(const c of this._subEmitters[y])c.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Ic&&this.Ic.dispose&&this.Ic.dispose(!0)}static _Parse(y,c,A,w){let N;N=A instanceof ny.b?null:A;const h=(0,W.d)("BABYLON.Texture");if(h&&N&&(y.texture?c.particleTexture=h.Parse(y.texture,N,w):y.textureName&&(c.particleTexture=new h(w+y.textureName,N,!1,void 0===y.invertY||y.invertY),c.particleTexture.name=y.textureName)),y.emitterId||0===y.emitterId||void 0!==y.Ic?y.emitterId&&N?c.Ic=N.getLastMeshById(y.emitterId):c.Ic=l.gc.yA(y.Ic):c.Ic=l.gc.Zero(),c.isLocal=!!y.isLocal,void 0!==y.renderingGroupId&&(c.renderingGroupId=y.renderingGroupId),void 0!==y.isBillboardBased&&(c.isBillboardBased=y.isBillboardBased),void 0!==y.billboardMode&&(c.billboardMode=y.billboardMode),void 0!==y.useLogarithmicDepth&&(c.useLogarithmicDepth=y.useLogarithmicDepth),y.animations){for(let A=0;A<y.animations.length;A++){const l=y.animations[A],w=(0,W.d)("BABYLON.Animation");w&&c.animations.push(w.Parse(l))}c.beginAnimationOnStart=y.beginAnimationOnStart,c.beginAnimationFrom=y.beginAnimationFrom,c.beginAnimationTo=y.beginAnimationTo,c.beginAnimationLoop=y.beginAnimationLoop}if(y.autoAnimate&&N&&N.beginAnimation(c,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),c.startDelay=0|y.startDelay,c.minAngularSpeed=y.minAngularSpeed,c.maxAngularSpeed=y.maxAngularSpeed,c.minSize=y.minSize,c.maxSize=y.maxSize,y.minScaleX&&(c.minScaleX=y.minScaleX,c.maxScaleX=y.maxScaleX,c.minScaleY=y.minScaleY,c.maxScaleY=y.maxScaleY),void 0!==y.preWarmCycles&&(c.preWarmCycles=y.preWarmCycles,c.preWarmStepOffset=y.preWarmStepOffset),void 0!==y.minInitialRotation&&(c.minInitialRotation=y.minInitialRotation,c.maxInitialRotation=y.maxInitialRotation),c.minLifeTime=y.minLifeTime,c.maxLifeTime=y.maxLifeTime,c.minEmitPower=y.minEmitPower,c.maxEmitPower=y.maxEmitPower,c.emitRate=y.emitRate,c.gravity=l.gc.yA(y.gravity),y.noiseStrength&&(c.noiseStrength=l.gc.yA(y.noiseStrength)),c.color1=p.ip.yA(y.color1),c.color2=p.ip.yA(y.color2),c.colorDead=p.ip.yA(y.colorDead),c.updateSpeed=y.updateSpeed,c.targetStopDuration=y.targetStopDuration,c.blendMode=y.blendMode,y.colorGradients)for(const l of y.colorGradients)c.addColorGradient(l.gradient,p.ip.yA(l.color1),l.color2?p.ip.yA(l.color2):void 0);if(y.rampGradients){for(const A of y.rampGradients)c.addRampGradient(A.gradient,p.dc.yA(A.color));c.useRampGradients=y.useRampGradients}if(y.colorRemapGradients)for(const l of y.colorRemapGradients)c.addColorRemapGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(y.alphaRemapGradients)for(const l of y.alphaRemapGradients)c.addAlphaRemapGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(y.sizeGradients)for(const l of y.sizeGradients)c.addSizeGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(y.angularSpeedGradients)for(const l of y.angularSpeedGradients)c.addAngularSpeedGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(y.velocityGradients)for(const l of y.velocityGradients)c.addVelocityGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(y.dragGradients)for(const l of y.dragGradients)c.addDragGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(y.emitRateGradients)for(const l of y.emitRateGradients)c.addEmitRateGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(y.startSizeGradients)for(const l of y.startSizeGradients)c.addStartSizeGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(y.lifeTimeGradients)for(const l of y.lifeTimeGradients)c.addLifeTimeGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);if(y.limitVelocityGradients){for(const A of y.limitVelocityGradients)c.addLimitVelocityGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);c.limitVelocityDamping=y.limitVelocityDamping}if(y.noiseTexture&&N){const A=(0,W.d)("BABYLON.ProceduralTexture");c.noiseTexture=A.Parse(y.noiseTexture,N,w)}let I;if(y.particleEmitterType){switch(y.particleEmitterType.type){case"SphereParticleEmitter":I=new t;break;case"SphereDirectedParticleEmitter":I=new s;break;case"ConeEmitter":case"ConeParticleEmitter":I=new O;break;case"ConeDirectedParticleEmitter":I=new L;break;case"CylinderParticleEmitter":I=new i;break;case"CylinderDirectedParticleEmitter":I=new H;break;case"HemisphericParticleEmitter":I=new P;break;case"PointParticleEmitter":I=new D;break;case"MeshParticleEmitter":I=new C;break;case"CustomParticleEmitter":I=new B;break;default:I=new o}I.parse(y.particleEmitterType,N)}else I=new o,I.parse(y,N);c.particleEmitterType=I,c.startSpriteCellID=y.startSpriteCellID,c.endSpriteCellID=y.endSpriteCellID,c.spriteCellLoop=y.spriteCellLoop??!0,c.spriteCellWidth=y.spriteCellWidth,c.spriteCellHeight=y.spriteCellHeight,c.spriteCellChangeSpeed=y.spriteCellChangeSpeed,c.spriteRandomStartCell=y.spriteRandomStartCell,c.disposeOnStop=y.disposeOnStop??!1,c.manualEmitCount=y.manualEmitCount??-1}static Parse(y,c,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0;const W=y.name;let h,I,q=null,o=null;if(c instanceof ny.b?h=c:(I=c,h=I.getEngine()),y.customShader&&h.createEffectForParticles){o=y.customShader;const c=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"";q=h.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,c)}const O=new Wc(W,N||y.PA,c,q,y.isAnimationSheetEnabled);if(O.customShader=o,O._rootUrl=A,y.id&&(O.id=y.id),y.subEmitters){O.subEmitters=[];for(const l of y.subEmitters){const y=[];for(const w of l)y.push(ry.Parse(w,c,A));O.subEmitters.push(y)}}if(y.attractors)for(const p of y.attractors){const y=new pc;y.position=l.gc.yA(p.position),y.strength=p.strength,O.addAttractor(y)}return Wc._Parse(y,O,c,A),y.textureMask&&(O.textureMask=p.ip.yA(y.textureMask)),y.rI&&(O.rI=l.gc.yA(y.rI)),y.preventAutoStart&&(O.preventAutoStart=y.preventAutoStart),w||O.preventAutoStart||O.start(),O}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};if(Wc._Serialize(c,this,y),c.textureMask=this.textureMask.fc(),c.customShader=this.customShader,c.preventAutoStart=this.preventAutoStart,c.rI=this.rI.fc(),this.subEmitters){c.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const A of this._subEmitters){const l=[];for(const c of A)l.push(c.serialize(y));c.subEmitters.push(l)}}if(this._attractors&&this._attractors.length){c.attractors=[];for(const y of this._attractors)c.attractors.push(y.serialize())}return c}static _Serialize(y,c,A){if(y.name=c.name,y.id=c.id,y.PA=c.getCapacity(),y.disposeOnStop=c.disposeOnStop,y.manualEmitCount=c.manualEmitCount,c.Ic.position){const A=c.Ic;y.emitterId=A.id}else{const A=c.Ic;y.Ic=A.fc()}c.particleEmitterType&&(y.particleEmitterType=c.particleEmitterType.serialize()),c.particleTexture&&(A?y.texture=c.particleTexture.serialize():(y.textureName=c.particleTexture.name,y.invertY=!!c.particleTexture._invertY)),y.isLocal=c.isLocal,G.d.AppendSerializedAnimations(c,y),y.beginAnimationOnStart=c.beginAnimationOnStart,y.beginAnimationFrom=c.beginAnimationFrom,y.beginAnimationTo=c.beginAnimationTo,y.beginAnimationLoop=c.beginAnimationLoop,y.startDelay=c.startDelay,y.renderingGroupId=c.renderingGroupId,y.isBillboardBased=c.isBillboardBased,y.billboardMode=c.billboardMode,y.minAngularSpeed=c.minAngularSpeed,y.maxAngularSpeed=c.maxAngularSpeed,y.minSize=c.minSize,y.maxSize=c.maxSize,y.minScaleX=c.minScaleX,y.maxScaleX=c.maxScaleX,y.minScaleY=c.minScaleY,y.maxScaleY=c.maxScaleY,y.minEmitPower=c.minEmitPower,y.maxEmitPower=c.maxEmitPower,y.minLifeTime=c.minLifeTime,y.maxLifeTime=c.maxLifeTime,y.emitRate=c.emitRate,y.gravity=c.gravity.fc(),y.noiseStrength=c.noiseStrength.fc(),y.color1=c.color1.fc(),y.color2=c.color2.fc(),y.colorDead=c.colorDead.fc(),y.updateSpeed=c.updateSpeed,y.targetStopDuration=c.targetStopDuration,y.blendMode=c.blendMode,y.preWarmCycles=c.preWarmCycles,y.preWarmStepOffset=c.preWarmStepOffset,y.minInitialRotation=c.minInitialRotation,y.maxInitialRotation=c.maxInitialRotation,y.startSpriteCellID=c.startSpriteCellID,y.spriteCellLoop=c.spriteCellLoop,y.endSpriteCellID=c.endSpriteCellID,y.spriteCellChangeSpeed=c.spriteCellChangeSpeed,y.spriteCellWidth=c.spriteCellWidth,y.spriteCellHeight=c.spriteCellHeight,y.spriteRandomStartCell=c.spriteRandomStartCell,y.isAnimationSheetEnabled=c.isAnimationSheetEnabled,y.useLogarithmicDepth=c.useLogarithmicDepth;const l=c.getColorGradients();if(l){y.colorGradients=[];for(const c of l){const A={gradient:c.gradient,color1:c.color1.fc()};c.color2?A.color2=c.color2.fc():A.color2=c.color1.fc(),y.colorGradients.push(A)}}const w=c.getRampGradients();if(w){y.rampGradients=[];for(const c of w){const A={gradient:c.gradient,color:c.color.fc()};y.rampGradients.push(A)}y.useRampGradients=c.useRampGradients}const N=c.getColorRemapGradients();if(N){y.colorRemapGradients=[];for(const c of N){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.colorRemapGradients.push(A)}}const p=c.getAlphaRemapGradients();if(p){y.alphaRemapGradients=[];for(const c of p){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.alphaRemapGradients.push(A)}}const W=c.getSizeGradients();if(W){y.sizeGradients=[];for(const c of W){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.sizeGradients.push(A)}}const h=c.getAngularSpeedGradients();if(h){y.angularSpeedGradients=[];for(const c of h){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.angularSpeedGradients.push(A)}}const I=c.getVelocityGradients();if(I){y.velocityGradients=[];for(const c of I){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.velocityGradients.push(A)}}const q=c.getDragGradients();if(q){y.dragGradients=[];for(const c of q){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.dragGradients.push(A)}}const o=c.getEmitRateGradients();if(o){y.emitRateGradients=[];for(const c of o){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.emitRateGradients.push(A)}}const O=c.getStartSizeGradients();if(O){y.startSizeGradients=[];for(const c of O){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.startSizeGradients.push(A)}}const L=c.getLifeTimeGradients();if(L){y.lifeTimeGradients=[];for(const c of L){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.lifeTimeGradients.push(A)}}const i=c.getLimitVelocityGradients();if(i){y.limitVelocityGradients=[];for(const c of i){const A={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?A.factor2=c.factor2:A.factor2=c.factor1,y.limitVelocityGradients.push(A)}y.limitVelocityDamping=c.limitVelocityDamping}c.noiseTexture&&(y.noiseTexture=c.noiseTexture.serialize())}clone(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l={...this._customWrappers};let w=null;const N=this._engine;if(N.createEffectForParticles&&null!=this.customShader){w=this.customShader;const y=w.shaderOptions.defines.length>0?w.shaderOptions.defines.join("\n"):"",c=N.createEffectForParticles(w.shaderPath.fragmentElement,w.shaderOptions.uniforms,w.shaderOptions.samplers,y);l[0]?l[0].effect=c:this.setCustomEffect(c,0)}const p=this.serialize(A),W=Wc.Parse(p,this._scene||this._engine,this._rootUrl);return W.name=y,W.customShader=w,W._customWrappers=l,void 0===c&&(c=this.Ic),this.noiseTexture&&(W.noiseTexture=this.noiseTexture.clone()),W.Ic=c,this.preventAutoStart||W.start(),W}}Wc.BILLBOARDMODE_Y=2,Wc.BILLBOARDMODE_ALL=7,Wc.BILLBOARDMODE_STRETCHED=8,Wc.BILLBOARDMODE_STRETCHED_LOCAL=9,ry._ParseParticleSystem=Wc.Parse;var hc=A(12555),Ic=A(12553),qc=A(12454);qc.c.prototype.createTransformFeedback=function(){const y=this._gl.createTransformFeedback();if(!y)throw new Error("Unable to create Transform Feedback");return y},qc.c.prototype.deleteTransformFeedback=function(y){this._gl.deleteTransformFeedback(y)},qc.c.prototype.bindTransformFeedback=function(y){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,y)},qc.c.prototype.beginTransformFeedback=function(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(y?this._gl.POINTS:this._gl.TRIANGLES)},qc.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},qc.c.prototype.setTranformFeedbackVaryings=function(y,c){this._gl.transformFeedbackVaryings(y,c,this._gl.INTERLEAVED_ATTRIBS)},qc.c.prototype.bindTransformFeedbackBuffer=function(y){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,y?y.underlyingResource:null)},qc.c.prototype.readTransformFeedbackBuffer=function(y){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,y)};const oc="clipPlaneFragmentDeclaration2",Oc="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";my.b.IncludesShadersStore[oc]||(my.b.IncludesShadersStore[oc]=Oc);A(13580),A(13582),A(13589),A(13593),A(13600),A(13602),A(13605),A(13608);const Lc="gpuRenderParticlesPixelShader",ic="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";my.b.ShadersStore[Lc]||(my.b.ShadersStore[Lc]=ic);const Hc="clipPlaneVertexDeclaration2",Pc="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";my.b.IncludesShadersStore[Hc]||(my.b.IncludesShadersStore[Hc]=Pc);A(13612),A(13620),A(13624),A(13626);const Dc="gpuRenderParticlesVertexShader",tc="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";my.b.ShadersStore[Dc]||(my.b.ShadersStore[Dc]=tc);class sc extends h{static get IsSupported(){if(!v.c.LastCreatedEngine)return!1;const y=v.c.LastCreatedEngine.getCaps();return y.supportTransformFeedbacks||y.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(y){this._maxActiveParticleCount=Math.min(y,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(y){this.maxActiveParticleCount=y}createPointEmitter(y,c){const A=Ey(y,c);return this.particleEmitterType=A,A}createHemisphericEmitter(){const y=by(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createSphereEmitter(){const y=Zy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=y,y}createDirectedSphereEmitter(){const y=vy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.gc(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.gc(0,1,0));return this.particleEmitterType=y,y}createCylinderEmitter(){const y=dy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=y,y}createDirectedCylinderEmitter(){const y=yc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.gc(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new l.gc(0,1,0));return this.particleEmitterType=y,y}createConeEmitter(){const y=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=y,y}createDirectedConeEmitter(){const y=Ac(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.gc(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l.gc(0,1,0));return this.particleEmitterType=y,y}createBoxEmitter(y,c,A,l){const w=new o;return this.particleEmitterType=w,this.direction1=y,this.direction2=c,this.minEmitBox=A,this.maxEmitBox=l,w}get flowMap(){return this._flowMap}set flowMap(y){this._flowMap!==y&&(this._flowMap=y)}isReady(){if(!this.Ic||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Wc.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Wc.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Wc.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";y?setTimeout((()=>{this.start(0)}),y):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var y;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(y=this._customWrappers[c])||void 0===y?void 0:y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[y]??this._customWrappers[0]}setCustomEffect(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new yy.d(this._engine),this._customWrappers[c].effect=y}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new b.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(y,c,A){return super._removeGradientAndTexture(y,c,A),this._releaseBuffers(),this}addColorGradient(y,c){this._colorGradients||(this._colorGradients=[]);const A=new R(y,c);return this._colorGradients.push(A),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(y&&this._colorGradients.sort(((y,c)=>y.gradient<c.gradient?-1:y.gradient>c.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(y){return this._removeGradientAndTexture(y,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const c in this._drawWrappers){var y;null===(y=this._drawWrappers[c].drawContext)||void 0===y||y.reset()}}_addFactorGradient(y,c,A){const l=new n(c,A);y.push(l),this._releaseBuffers()}addSizeGradient(y,c){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,y,c),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(y){return this._removeGradientAndTexture(y,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(y,c){if(!y)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&y.sort(((y,c)=>y.gradient<c.gradient?-1:y.gradient>c.gradient?1:0));const A=this;A[c]&&(A[c].dispose(),A[c]=null)}addAngularSpeedGradient(y,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,y,c),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(y){return this._removeGradientAndTexture(y,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(y,c){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,y,c),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(y){return this._removeGradientAndTexture(y,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(y,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,y,c),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(y){return this._removeGradientAndTexture(y,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(y,c){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,y,c),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(y){return this._removeGradientAndTexture(y,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(y){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(y,c,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(y),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.zc=new b.d,this.onStoppedObservable=new b.d,this.onStartedObservable=new b.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,A&&"Scene"!==A.getClassName()?(this._engine=A,this.defaultProjectionMatrix=l.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=A||v.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.MO.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,W.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,W.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,W.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,W.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new yy.d(this._engine)},this._customWrappers[0].effect=w,this._drawWrappers={0:new yy.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(c=c??{}).randomTextureSize||delete c.randomTextureSize;const p={PA:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...c},h=c;isFinite(h)&&(p.PA=h),this._capacity=p.PA,this._maxActiveParticleCount=p.PA,this._currentActiveCount=0,this._isAnimationSheetEnabled=N,this.particleEmitterType=new o;const I=Math.min(this._engine.getCaps().maxTextureSize,p.randomTextureSize);let q=[];for(let l=0;l<I;++l)q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random());this._randomTexture=new Z.b(new Float32Array(q),I,1,5,A,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,q=[];for(let l=0;l<I;++l)q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random());this._randomTexture2=new Z.b(new Float32Array(q),I,1,5,A,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=I}_reset(){this._releaseBuffers()}_createVertexBuffers(y,c,A){const l={};l.position=c.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let w=3;l.age=c.createVertexBuffer("age",w,1,this._attributesStrideSize,!0),w+=1,l.size=c.createVertexBuffer("size",w,3,this._attributesStrideSize,!0),w+=3,l.life=c.createVertexBuffer("life",w,1,this._attributesStrideSize,!0),w+=1,w+=4,this.billboardMode===Wc.BILLBOARDMODE_STRETCHED&&(l.direction=c.createVertexBuffer("direction",w,3,this._attributesStrideSize,!0)),w+=3,this._platform.alignDataInBuffer&&(w+=1),this.particleEmitterType instanceof B&&(w+=3,this._platform.alignDataInBuffer&&(w+=1)),this._colorGradientsTexture||(l.color=c.createVertexBuffer("color",w,4,this._attributesStrideSize,!0),w+=4),this._isBillboardBased||(l.initialDirection=c.createVertexBuffer("initialDirection",w,3,this._attributesStrideSize,!0),w+=3,this._platform.alignDataInBuffer&&(w+=1)),this.noiseTexture&&(l.noiseCoordinates1=c.createVertexBuffer("noiseCoordinates1",w,3,this._attributesStrideSize,!0),w+=3,this._platform.alignDataInBuffer&&(w+=1),l.noiseCoordinates2=c.createVertexBuffer("noiseCoordinates2",w,3,this._attributesStrideSize,!0),w+=3,this._platform.alignDataInBuffer&&(w+=1)),l.angle=c.createVertexBuffer("angle",w,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?w++:w+=2,this._isAnimationSheetEnabled&&(l.cellIndex=c.createVertexBuffer("cellIndex",w,1,this._attributesStrideSize,!0),w+=1,this.spriteRandomStartCell&&(l.cellStartOffset=c.createVertexBuffer("cellStartOffset",w,1,this._attributesStrideSize,!0),w+=1)),l.offset=A.createVertexBuffer("offset",0,2),l.uv=A.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(l),this._platform.createVertexBuffers(y,l),this.resetDrawCache()}_initialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!y)return;const c=this._engine,A=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof B&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const w=this.particleEmitterType instanceof B,N=l.TmpVectors.gc[0];let p=0;for(let l=0;l<this._capacity;l++)if(A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),w?(this.particleEmitterType.particleDestinationGenerator(l,null,N),A.push(N.x),A.push(N.y),A.push(N.z)):(A.push(0),A.push(0),A.push(0)),this._platform.alignDataInBuffer&&A.push(0),p+=16,w&&(this.particleEmitterType.particlePositionGenerator(l,null,N),A.push(N.x),A.push(N.y),A.push(N.z),this._platform.alignDataInBuffer&&A.push(0),p+=4),this._colorGradientsTexture||(A.push(0),A.push(0),A.push(0),A.push(0),p+=4),this.isBillboardBased||(A.push(0),A.push(0),A.push(0),this._platform.alignDataInBuffer&&A.push(0),p+=4),this.noiseTexture&&(A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),this._platform.alignDataInBuffer&&A.push(0),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),this._platform.alignDataInBuffer&&A.push(0),p+=8),A.push(0),p+=1,this._angularSpeedGradientsTexture||(A.push(0),p+=1),this._isAnimationSheetEnabled&&(A.push(0),p+=1,this.spriteRandomStartCell&&(A.push(0),p+=1)),this._platform.alignDataInBuffer){let y=3-(p+3&3);for(p+=y;y-- >0;)A.push(0)}const W=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),h=this._platform.createParticleBuffer(A),I=this._platform.createParticleBuffer(A);this._buffer0=new X.c(c,h,!1,this._attributesStrideSize),this._buffer1=new X.c(c,I,!1,this._attributesStrideSize),this._spriteBuffer=new X.c(c,W,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let y=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(y+="\n#define BILLBOARD"),this._colorGradientsTexture&&(y+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(y+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(y+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(y+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(y+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(y+="\n#define DRAGGRADIENTS"),this._flowMap&&(y+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(y+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(y+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(y+="\n#define NOISE"),this.isLocal&&(y+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===y||(this._cachedUpdateDefines=y,this._updateBuffer=this._platform.createUpdateBuffer(y)),this._platform.isUpdateBufferReady()}_getWrapper(y){const c=this._getCustomDrawWrapper(y);if(null!==c&&void 0!==c&&c.effect)return c;const A=[];this.fillDefines(A,y);let l=this._drawWrappers[y];l||(l=new yy.d(this._engine),l.drawContext&&(l.drawContext.useInstancing=!0),this._drawWrappers[y]=l);const w=A.join("\n");if(l.defines!==w){const y=[],c=[],A=[];this.fillUniformsAttributesAndSamplerNames(c,y,A),l.setEffect(this._engine.createEffect("gpuRenderParticles",y,c,A,w),w)}return l}static _GetAttributeNamesOrOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const w=[X.e.PositionKind,"age","life","size","angle"];return y||w.push(X.e.ColorKind),c&&w.push("cellIndex"),A||w.push("initialDirection"),l&&w.push("direction"),w.push("offset",X.e.UVKind),w}static _GetEffectCreationOptions(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=["emitterWM","rI","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,cy.d)(l),y&&l.push("sheetInfos"),c&&l.push("logarithmicDepthConstant"),A&&(l.push("vFogInfos"),l.push("vFogColor")),l}fillDefines(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cy.l)(this,this._scene,y),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Ic.b.FOGMODE_NONE&&y.push("#define FOG")),c===Wc.BLENDMODE_MULTIPLY&&y.push("#define BLENDMULTIPLYMODE"),this.isLocal&&y.push("#define LOCAL"),this.useLogarithmicDepth&&y.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(y.push("#define BILLBOARD"),this.billboardMode){case Wc.BILLBOARDMODE_Y:y.push("#define BILLBOARDY");break;case Wc.BILLBOARDMODE_STRETCHED:y.push("#define BILLBOARDSTRETCHED");break;case Wc.BILLBOARDMODE_ALL:y.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&y.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&y.push("#define ANIMATESHEET"),A&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),y.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(y,c,A){c.push(...sc._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Wc.BILLBOARDMODE_STRETCHED)),y.push(...sc._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),A.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(hc.e.PrepareUniforms(y,this._imageProcessingConfigurationDefines),hc.e.PrepareSamplers(A,this._imageProcessingConfigurationDefines))}animate(){var y;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(c?this.preWarmStepOffset:(null===(y=this._scene)||void 0===y?void 0:y.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(y,c){const A=this[c];if(!y||!y.length||A)return;const l=new Float32Array(this._rawTextureWidth);for(let w=0;w<this._rawTextureWidth;w++){const c=w/this._rawTextureWidth;E.GetCurrentGradient(c,y,((y,c,A)=>{l[w]=(0,I.Lerp)(y.factor1,c.factor1,A)}))}this[c]=Z.b.CreateRTexture(l,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[c].name=c.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const y=new Uint8Array(4*this._rawTextureWidth),c=p.TmpColors.ip[0];for(let A=0;A<this._rawTextureWidth;A++){const l=A/this._rawTextureWidth;E.GetCurrentGradient(l,this._colorGradients,((l,w,N)=>{p.ip.LerpToRef(l.color1,w.color1,N,c),y[4*A]=255*c.r,y[4*A+1]=255*c.g,y[4*A+2]=255*c.b,y[4*A+3]=255*c.a}))}this._colorGradientsTexture=Z.b.CreateRGBATexture(y,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(y,c){var A,w,N,p;const W=this._getWrapper(y),h=W.effect;this._engine.enableEffect(W);const I=(null===(A=this._scene)||void 0===A?void 0:A.getViewMatrix())||l.Matrix.IdentityReadOnly;if(h.setMatrix("view",I),h.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),h.setTexture("diffuseSampler",this.particleTexture),h.setVector2("translationPivot",this.translationPivot),h.setVector3("rI",this.rI),this.isLocal&&h.setMatrix("emitterWM",c),this._colorGradientsTexture?h.setTexture("colorGradientSampler",this._colorGradientsTexture):h.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const y=this.particleTexture.getBaseSize();h.setFloat3("sheetInfos",this.spriteCellWidth/y.width,this.spriteCellHeight/y.height,y.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const y=this._scene.activeCamera;h.setVector3("eyePosition",y.globalPosition)}const q=h.defines;if(this._scene&&((0,cy.g)(h,this,this._scene),this.applyFog&&(0,Ay.f)(this._scene,void 0,h)),q.indexOf("#define BILLBOARDMODE_ALL")>=0){const y=I.clone();y.invert(),h.setMatrix("invView",y)}return this.useLogarithmicDepth&&this._scene&&(0,Ay.l)(q,h,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(h),this._setEngineBasedOnBlendMode(y),this._platform.bindDrawBuffers(this._targetIndex,h,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(h),null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(p=this._scene)&&void 0!==p&&p.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(y){if(!this.Ic||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!y)if(this.Ic.position){y=this.Ic.getWorldMatrix()}else{const c=this.Ic;y=l.TmpVectors.Matrix[0],l.Matrix.TranslationToRef(c.x,c.y,c.z,y)}const c=this._engine,A=c.getDepthWrite();if(c.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const y=this.mc();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",y.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",y),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const w=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=w,c.setDepthWrite(A)}render(){let y,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!c&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let y=0;y<this.preWarmCycles;y++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const y=0|this._accumulatedCount;this._accumulatedCount-=y,this._currentActiveCount+=y}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Ic.position){y=this.Ic.getWorldMatrix()}else{const c=this.Ic;y=l.TmpVectors.Matrix[0],l.Matrix.TranslationToRef(c.x,c.y,c.z,y)}const w=this._engine;this.updateInAnimate||this._update(y);let N=0;return c||A||(w.setState(!1),this.forceDepthWrite&&w.setDepthWrite(!0),N=this.blendMode===Wc.BLENDMODE_MULTIPLYADD?this._render(Wc.BLENDMODE_MULTIPLY,y)+this._render(Wc.BLENDMODE_ADD,y):this._render(this.blendMode,y),this._engine.setAlphaMode(0)),N}rebuild(){const y=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(y,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,y()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const c in this._drawWrappers){this._drawWrappers[c].dispose()}if(this._drawWrappers={},this._scene){const y=this._scene.MO.indexOf(this);y>-1&&this._scene.MO.splice(y,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let c=0;c<this._renderVertexBuffers.length;++c){const y=this._renderVertexBuffers[c];for(const c in y)y[c].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.zc.notifyObservers(this),this.zc.clear()}clone(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l={...this._customWrappers};let w=null;const N=this._engine;if(N.createEffectForParticles&&null!=this.customShader){w=this.customShader;const y=w.shaderOptions.defines.length>0?w.shaderOptions.defines.join("\n"):"";l[0]=N.createEffectForParticles(w.shaderPath.fragmentElement,w.shaderOptions.uniforms,w.shaderOptions.samplers,y,void 0,void 0,void 0,this)}const p=this.serialize(A),W=sc.Parse(p,this._scene||this._engine,this._rootUrl);return W.name=y,W.customShader=w,W._customWrappers=l,void 0===c&&(c=this.Ic),this.noiseTexture&&(W.noiseTexture=this.noiseTexture.clone()),W.Ic=c,W}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return Wc._Serialize(c,this,y),c.activeParticleCount=this.activeParticleCount,c.randomTextureSize=this._randomTextureSize,c.customShader=this.customShader,c}static Parse(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0;const N=y.name;let p,W;c instanceof ny.b?p=c:(W=c,p=W.getEngine());const h=new sc(N,{PA:w||y.PA,randomTextureSize:y.randomTextureSize},c,null,y.isAnimationSheetEnabled);if(h._rootUrl=A,y.customShader&&p.createEffectForParticles){const c=y.customShader,A=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",l=p.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,A,void 0,void 0,void 0,h);h.setCustomEffect(l,0),h.customShader=c}return y.id&&(h.id=y.id),y.activeParticleCount&&(h.activeParticleCount=y.activeParticleCount),Wc._Parse(y,h,c,A),y.preventAutoStart&&(h.preventAutoStart=y.preventAutoStart),l||h.preventAutoStart||h.start(),h}}var Bc=A(12144),Xc=A(13635),Cc=A(12695);class Kc{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(y){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const c of this.systems)c.Ic=y;this._emitterNode=y}setEmitterAsSphere(y,c,A){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:y,renderingGroupId:c};const l=(0,Xc.e)("emitterSphere",{diameter:y.diameter,segments:y.segments},A);l.renderingGroupId=c;const w=new Cc.Zc("emitterSphereMaterial",A);w.emissiveColor=y.color,l.material=w;for(const N of this.systems)N.Ic=l;this._emitterNode=l}start(y){for(const c of this.systems)y&&(c.Ic=y),c.start()}dispose(){for(const y of this.systems)y.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={systems:[]};for(const A of this.systems)c.systems.push(A.serialize(y));return this._emitterNode&&(c.Ic=this._emitterCreationOptions),c}static Parse(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0;const w=new Kc,N=this.BaseAssetsUrl+"/textures/";c=c||v.c.LastCreatedScene;for(const p of y.systems)w.systems.push(A?sc.Parse(p,c,N,!0,l):Wc.Parse(p,c,N,!0,l));if(y.Ic){const A=y.Ic.options;if("Sphere"===y.Ic.kind)w.setEmitterAsSphere({diameter:A.diameter,segments:A.segments,color:p.dc.yA(A.color)},y.Ic.renderingGroupId,c)}return w}}Kc.BaseAssetsUrl="https://assets.babylonjs.com/particles";var mA=A(12182);class Tc{static CreateDefault(y){let c,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,l=arguments.length>2?arguments[2]:void 0;c=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new sc("default system",{PA:A},l):new Wc("default system",A,l),c.Ic=y;const w=Bc.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return c.particleTexture=new j.d(w,c.mc()),c.createConeEmitter(.1,Math.PI/4),c.color1=new p.ip(1,1,1,1),c.color2=new p.ip(1,1,1,1),c.colorDead=new p.ip(1,1,1,0),c.minSize=.1,c.maxSize=.1,c.minEmitPower=2,c.maxEmitPower=2,c.updateSpeed=1/60,c.emitRate=30,c}static CreateAsync(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0;c||(c=v.c.LastCreatedScene);const w={};return c.addPendingData(w),new Promise(((N,p)=>{if(A&&!sc.IsSupported)return c.removePendingData(w),p("Particle system with GPU is not supported.");Bc.Tools.LoadFile(`${Tc.BaseAssetsUrl}/systems/${y}.json`,(y=>{c.removePendingData(w);const p=JSON.parse(y.toString());return N(Kc.Parse(p,c,A,l))}),void 0,void 0,void 0,(()=>(c.removePendingData(w),p(`An error occurred with the creation of your particle system. Check if your type '${y}' exists.`))))}))}static ExportSet(y){const c=new Kc;for(const A of y)c.systems.push(A);return c}static ParseFromFileAsync(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",N=arguments.length>5?arguments[5]:void 0;return new Promise(((p,W)=>{const h=new mA.d;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const c=JSON.parse(h.responseText);let W;W=l?sc.Parse(c,A,w,!1,N):Wc.Parse(c,A,w,!1,N),y&&(W.name=y),p(W)}else W("Unable to load the particle system")})),h.open("GET",c),h.send()}))}static ParseFromSnippetAsync(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",w=arguments.length>4?arguments[4]:void 0;if("_BLANK"===y){const y=this.CreateDefault(null);return y.start(),Promise.resolve(y)}return new Promise(((N,p)=>{const W=new mA.d;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const p=JSON.parse(JSON.parse(W.responseText).jsonPayload),h=JSON.parse(p.particleSystem);let I;I=A?sc.Parse(h,c,l,!1,w):Wc.Parse(h,c,l,!1,w),I.snippetId=y,N(I)}else p("Unable to load the snippet "+y)})),W.open("GET",this.SnippetUrl+"/"+y.replace(/#/g,"/")),W.send()}))}}Tc.BaseAssetsUrl=Kc.BaseAssetsUrl,Tc.SnippetUrl="https://snippet.babylonjs.com",Tc.CreateFromSnippetAsync=Tc.ParseFromSnippetAsync;var zc=A(12773),Sc=A(12584),Mc=A(13643);(0,Mc.d)(Sc.b.NAME_PARTICLESYSTEM,((y,c,A,l)=>{const w=(0,Mc.f)(Sc.b.NAME_PARTICLESYSTEM);if(w&&void 0!==y.MO&&null!==y.MO)for(let N=0,p=y.MO.length;N<p;N++){const p=y.MO[N];A.MO.push(w(p,c,l))}})),(0,Mc.b)(Sc.b.NAME_PARTICLESYSTEM,((y,c,A)=>{if(y.activeParticleCount){return sc.Parse(y,c,A)}return Wc.Parse(y,c,A)})),ny.b.prototype.createEffectForParticles=function(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,W=arguments.length>6?arguments[6]:void 0,h=arguments.length>7?arguments[7]:void 0,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,q=arguments.length>9?arguments[9]:void 0,o=[],O=[];const L=[];return h?h.fillUniformsAttributesAndSamplerNames(O,o,L):(o=Wc._GetAttributeNamesOrOptions(),O=Wc._GetEffectCreationOptions()),-1===w.indexOf(" BILLBOARD")&&(w+="\n#define BILLBOARD\n"),null!==h&&void 0!==h&&h.isAnimationSheetEnabled&&-1===w.indexOf(" ANIMATESHEET")&&(w+="\n#define ANIMATESHEET\n"),-1===l.indexOf("diffuseSampler")&&l.push("diffuseSampler"),this.createEffect({vertex:q??(null===h||void 0===h?void 0:h.vertexShaderName)??"particles",fragmentElement:y},o,O.concat(c),L.concat(l),w,N,p,W,void 0,I,(async()=>{0===I?await Promise.resolve().then(A.bind(A,13674)):await Promise.resolve().then(A.bind(A,13745))}))},zc.b.prototype.getEmittedParticleSystems=function(){const y=[];for(let c=0;c<this.mc().MO.length;c++){const A=this.mc().MO[c];A.Ic===this&&y.push(A)}return y},zc.b.prototype.getHierarchyEmittedParticleSystems=function(){const y=[],c=this.getDescendants();c.push(this);for(let A=0;A<this.mc().MO.length;A++){const l=this.mc().MO[A],w=l.Ic;w.position&&-1!==c.indexOf(w)&&y.push(l)}return y};A(12654),A(12667),A(12752);A(12758),A(13645),A(12521),A(12640),A(12791);A(12517);var kc;A(13653),A(12348);!function(y){y[y.Color=2]="Color",y[y.UV=1]="UV",y[y.Random=0]="Random",y[y.Stated=3]="Stated"}(kc||(kc={}));var ac=A(12547);const uc=new l.gc(0,0,0),Gc=new l.gc(0,0,0),jc=new l.gc(0,0,0);class fc{constructor(y,c,A){this.width=y,this.height=c,this.data=A}processFlowable(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2?arguments[2]:void 0;if(!A)return;A instanceof l.Matrix?l.gc.TransformCoordinatesToRef(y.position,A,jc):(jc.x=A.x,jc.y=A.y,jc.z=A.z);const w=.5*jc.x+.5,N=1-(.5*jc.y+.5),p=Math.floor(w*this.width),W=Math.floor(N*this.height);if(p<0||p>=this.width||W<0||W>=this.height)return;const h=4*(W*this.width+p),I=this.data[h]/255*2-1,q=this.data[h+1]/255*2-1,o=this.data[h+2]/255*2-1,O=this.data[h+3]/255;uc.set(I,q,o),uc.scaleToRef(c*O,Gc),y.direction.addInPlace(Gc)}_processParticle(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2?arguments[2]:void 0;this.processFlowable(y,c,A)}static async FromUrlAsync(y){return await new Promise(((c,A)=>{const l=document.createElement("canvas"),w=l.getContext("2d");let N=null;const p=new Image;p.crossOrigin="anonymous",p.src=y,p.onerror=c=>{A(new Error(`Failed to load image: ${y} : ${c}`))},p.onload=()=>{l.width=p.width,l.height=p.height,w.drawImage(p,0,0),N=w.getImageData(0,0,l.width,l.height),c(new fc(l.width,l.height,N.data))}}))}static async ExtractFromTextureAsync(y){return await new Promise(((c,A)=>{if(!y.isReady())return void y.onLoadObservable.addOnce((async()=>{try{const A=await this.ExtractFromTextureAsync(y);c(A)}catch(l){A(l)}}));const l=y.getSize();ac.l.GetTextureDataAsync(y,l.width,l.height).then((y=>{c(new fc(l.width,l.height,new Uint8ClampedArray(y)))})).catch(A)}))}}var Vc,Jc,Uc,ec,Qc,Yc,gc,xc,Fc;!function(y){y[y.Int=1]="Int",y[y.Float=2]="Float",y[y.Vector2=4]="Vector2",y[y.gc=8]="gc",y[y.Matrix=16]="Matrix",y[y.Particle=32]="Particle",y[y.Texture=64]="Texture",y[y.ip=128]="ip",y[y.FloatGradient=256]="FloatGradient",y[y.Vector2Gradient=512]="Vector2Gradient",y[y.Vector3Gradient=1024]="Vector3Gradient",y[y.Color4Gradient=2048]="Color4Gradient",y[y.System=4096]="System",y[y.AutoDetect=8192]="AutoDetect",y[y.BasedOnInput=16384]="BasedOnInput",y[y.Undefined=32768]="Undefined",y[y.All=65535]="All"}(Vc||(Vc={})),function(y){y[y.Compatible=0]="Compatible",y[y.TypeIncompatible=1]="TypeIncompatible",y[y.HierarchyIssue=2]="HierarchyIssue"}(Jc||(Jc={})),function(y){y[y.Input=0]="Input",y[y.Output=1]="Output"}(Uc||(Uc={}));class Rc{get direction(){return this._direction}get type(){if(this._type===Vc.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Vc.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(y){this._type=y}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((y=>y.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(y,c,A){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Vc.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new b.d,this.onDisconnectionObservable=new b.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=c,this.name=y,this._direction=A}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(y){var c;return this.isConnected?null!==(c=this._connectedPoint)&&void 0!==c&&c._storedFunction?this._connectedPoint._storedFunction(y):this._connectedPoint._storedValue:this.value}canConnectTo(y){return 0===this.checkCompatibilityState(y)}checkCompatibilityState(y){const c=this._ownerBlock,A=y.ownerBlock;if(this.type!==y.type&&y.innerType!==Vc.AutoDetect)return y.acceptedConnectionPointTypes&&-1!==y.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(y.excludedConnectionPointTypes&&-1!==y.excludedConnectionPointTypes.indexOf(this.type))return 1;let l=A,w=c;return 0===this.direction&&(l=c,w=A),l.isAnAncestorOf(w)?2:0}connectTo(y){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(y))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${y.ownerBlock.name}".${y.name}`;return this._endpoints.push(y),y._connectedPoint=this,this.onConnectionObservable.notifyObservers(y),y.onConnectionObservable.notifyObservers(this),this}disconnectFrom(y){const c=this._endpoints.indexOf(y);return-1===c||(this._endpoints.splice(c,1),y._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(y),y.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(y){let c=1;for(;c<Vc.All;)y&c||this.excludedConnectionPointTypes.push(c),c<<=1}serialize(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c={};return c.name=this.name,c.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.fc?(c.valueType="BABYLON."+this.value.getClassName(),c.value=this.value.fc()):(c.valueType="number",c.value=this.value)),y&&this.connectedPoint&&(c.inputName=this.name,c.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,c.targetConnectionName=this.connectedPoint.name,c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),c}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class rc{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(y){this._name=y}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(y){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new b.d,this.zc=new b.d,this.onInputChangedObservable=new b.d,this.visibleOnFrame=!1,this._name=y,this.uniqueId=f.e.UniqueId}_inputRename(y){return y}_outputRename(y){return y}isAnAncestorOf(y){for(const c of this._outputs)if(c.hasEndpoints)for(const A of c.endpoints){if(A.ownerBlock===y)return!0;if(A.ownerBlock.isAnAncestorOf(y))return!0}return!1}isAnAncestorOfType(y){if(this.getClassName()===y)return!0;for(const c of this._outputs)if(c.hasEndpoints)for(const A of c.endpoints)if(A.ownerBlock.isAnAncestorOfType(y))return!0;return!1}getInputByName(y){const c=this._inputs.filter((c=>c.name===y));return c.length?c[0]:null}_linkConnectionTypes(y,c){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[c]._acceptedConnectionPointType=this._inputs[y]:(this._inputs[y]._linkedConnectionSource=this._inputs[c],this._inputs[y]._isMainLinkSource=!0),this._inputs[c]._linkedConnectionSource=this._inputs[y]}registerInput(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0;const p=new Rc(y,this,0);return p.type=c,p.isOptional=A,p.defaultValue=l,p.value=l,p.valueMin=w,p.valueMax=N,this._inputs.push(p),this.onInputChangedObservable.notifyObservers(p),this}registerOutput(y,c,A){return(A=A??new Rc(y,this,1)).type=c,this._outputs.push(A),this}_build(y){}_customBuildStep(y){}build(y){if(this._buildId===y.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((y=>y.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=y.buildId;for(const c of this._inputs){if(!c.connectedPoint){c.isOptional||y.notConnectedNonOptionalInputs.push(c);continue}const A=c.connectedPoint.ownerBlock;A&&A!==this&&!A.isSystem&&A.build(y)}return this._customBuildStep(y),y.verbose&&V.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(y),this.onBuildObservable.notifyObservers(this),!1}serialize(){const y={};y.customType="BABYLON."+this.getClassName(),y.id=this.uniqueId,y.name=this.name,y.visibleOnFrame=this.visibleOnFrame,y.inputs=[],y.outputs=[];for(const c of this.inputs)y.inputs.push(c.serialize());for(const c of this.outputs)y.outputs.push(c.serialize(!1));return y}_deserialize(y){this._name=y.name,this.comments=y.comments,this.visibleOnFrame=!!y.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(y)}_deserializePortDisplayNamesAndExposedOnFrame(y){const c=y.inputs,A=y.outputs;if(c)for(const l of c){const y=this.inputs.find((y=>y.name===l.name));if(!y)return;if(l.displayName&&(y.displayName=l.displayName),l.isExposedOnFrame&&(y.isExposedOnFrame=l.isExposedOnFrame,y.exposedPortPosition=l.exposedPortPosition),void 0!==l.value&&null!==l.value)if("number"===l.valueType)y.value=l.value;else{const c=(0,W.d)(l.valueType);c&&(y.value=c.yA(l.value))}}if(A)for(let l=0;l<A.length;l++){const y=A[l];y.displayName&&(this.outputs[l].displayName=y.displayName),y.isExposedOnFrame&&(this.outputs[l].isExposedOnFrame=y.isExposedOnFrame,this.outputs[l].exposedPortPosition=y.exposedPortPosition)}}clone(){const y=this.serialize(),c=(0,W.d)(y.customType);if(c){const A=new c;return A._deserialize(y),A}return null}dispose(){this.zc.notifyObservers(this),this.zc.clear();for(const y of this.inputs)y.dispose();for(const y of this.outputs)y.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function nc(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",l=arguments.length>3?arguments[3]:void 0;return(w,N)=>{let p=w._propStore;p||(p=[],w._propStore=p),p.push({propertyName:N,displayName:y,type:c,groupName:A,options:l??{},className:w.getClassName()})}}(0,a.b)([(0,u.P)("comment")],rc.prototype,"comments",void 0),function(y){y[y.Boolean=0]="Boolean",y[y.Float=1]="Float",y[y.Int=2]="Int",y[y.Vector2=3]="Vector2",y[y.List=4]="List",y[y.ip=5]="ip",y[y.SamplingMode=6]="SamplingMode",y[y.TextureFormat=7]="TextureFormat",y[y.TextureType=8]="TextureType"}(ec||(ec={})),function(y){y[y.None=0]="None",y[y.Position=1]="Position",y[y.Direction=2]="Direction",y[y.Age=3]="Age",y[y.Lifetime=4]="Lifetime",y[y.Color=5]="Color",y[y.ScaledDirection=6]="ScaledDirection",y[y.Scale=7]="Scale",y[y.AgeGradient=8]="AgeGradient",y[y.Angle=9]="Angle",y[y.SpriteCellIndex=16]="SpriteCellIndex",y[y.SpriteCellStart=17]="SpriteCellStart",y[y.SpriteCellEnd=18]="SpriteCellEnd"}(Qc||(Qc={})),function(y){y[y.None=0]="None",y[y.Time=1]="Time",y[y.Delta=2]="Delta",y[y.Emitter=3]="Emitter"}(Yc||(Yc={}));class Ec{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let y="";for(const c of this.notConnectedNonOptionalInputs)y+=`input ${c.name} from block ${c.ownerBlock.name}[${c.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(y)throw"Build of Node Particle System Set failed:\n"+y}adapt(y,c){const A=y.getConnectedValue(this)||0;if(y.type===c)return A;switch(c){case Vc.Vector2:return new l.Vector2(A,A);case Vc.gc:return new l.gc(A,A,A);case Vc.ip:return new p.ip(A,A,A,A)}return null}getContextualValue(y){if(!this.particleContext||!this.systemContext)return null;switch(y){case Qc.Position:return this.particleContext.position;case Qc.Direction:return this.particleContext.direction;case Qc.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Qc.Color:return this.particleContext.color;case Qc.Age:return this.particleContext.age;case Qc.Lifetime:return this.particleContext.lifeTime;case Qc.Angle:return this.particleContext.angle;case Qc.Scale:return this.particleContext.scale;case Qc.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Qc.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Qc.SpriteCellIndex:return this.particleContext.cellIndex;case Qc.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Ic.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Ic.absolutePosition:this.systemContext.Ic:null}getSystemValue(y){if(!this.particleContext||!this.systemContext)return null;switch(y){case Yc.Time:return this.systemContext._actualFrame;case Yc.Delta:return this.systemContext._scaledUpdateSpeed;case Yc.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Ic.absolutePosition}return this.systemContext.Ic}return null}}function bc(y,c,A){const l=new Ec;l.Fc=c;const w=y.createSystem(l);return w.canStart=()=>!0,w.Ic=A.clone(),w.disposeOnStop=!0,w.start(),w}class Zc extends rc{constructor(y){super(y),this.blendMode=h.BLENDMODE_ONEONE,this.PA=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Vc.Particle),this.registerInput("texture",Vc.Texture),this.registerInput("onStart",Vc.System,!0),this.registerInput("onEnd",Vc.System,!0),this.registerOutput("system",Vc.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(y){y.PA=this.PA,y.buildId=this._buildId++,this.build(y);const c=this.particle.getConnectedValue(y);return c.particleTexture=this.texture.getConnectedValue(y),c.emitRate=this.emitRate,c.blendMode=this.blendMode,c.name=this.name,c._nodeGenerated=!0,c._targetStopDuration=this.targetStopDuration,c.startDelay=this.startDelay,this.system._storedValue=this,c.canStart=()=>!this.doNoStart,c.onStartedObservable.add((A=>{const l=this.onStart.getConnectedValue(y);l&&A.onStartedObservable.addOnce((()=>{y.systemContext=c;const A=bc(l,y.Fc,y.emitterPosition);this.zc.addOnce((()=>{A.dispose()}))}));const w=this.onEnd.getConnectedValue(y);w&&A.onStoppedObservable.addOnce((()=>{y.systemContext=c;const A=bc(w,y.Fc,y.emitterPosition);this.zc.addOnce((()=>{A.dispose()}))}))})),this.zc.addOnce((()=>{c.dispose()})),c}serialize(){const y=super.serialize();return y.PA=this.PA,y.emitRate=this.emitRate,y.blendMode=this.blendMode,y.doNoStart=this.doNoStart,y.targetStopDuration=this.targetStopDuration,y.startDelay=this.startDelay,y}_deserialize(y){super._deserialize(y),this.PA=y.PA,this.emitRate=y.emitRate,this.doNoStart=!!y.doNoStart,void 0!==y.blendMode&&(this.blendMode=y.blendMode),void 0!==y.targetStopDuration&&(this.targetStopDuration=y.targetStopDuration),void 0!==y.startDelay&&(this.startDelay=y.startDelay)}}(0,a.b)([nc("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:h.BLENDMODE_ONEONE},{label:"Standard",value:h.BLENDMODE_STANDARD},{label:"Add",value:h.BLENDMODE_ADD},{label:"Multiply",value:h.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:h.BLENDMODE_MULTIPLYADD}]})],Zc.prototype,"blendMode",void 0),(0,a.b)([nc("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Zc.prototype,"PA",void 0),(0,a.b)([nc("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zc.prototype,"emitRate",void 0),(0,a.b)([nc("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zc.prototype,"targetStopDuration",void 0),(0,a.b)([nc("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zc.prototype,"startDelay",void 0),(0,a.b)([nc("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Zc.prototype,"doNoStart",void 0),(0,W.f)("BABYLON.SystemBlock",Zc);class vc extends rc{get type(){if(this._type===Vc.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Vc.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Vc.Vector2,this._type;case"gc":return this._type=Vc.gc,this._type;case"ip":return this._type=Vc.ip,this._type;case"Matrix":return this._type=Vc.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Qc.None&&this._systemSource!==Yc.None}get systemSource(){return this._systemSource}set systemSource(y){if(this._systemSource=y,y!==Yc.None){switch(this._contextualSource=Qc.None,this._type=Vc.Float,y){case Yc.Time:case Yc.Delta:this._type=Vc.Float;break;case Yc.Emitter:this._type=Vc.gc}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Qc.None}get contextualValue(){return this._contextualSource}set contextualValue(y){if(this._contextualSource=y,y!==Qc.None){switch(this._systemSource=Yc.None,y){case Qc.Scale:this._type=Vc.Vector2;break;case Qc.Position:case Qc.Direction:case Qc.ScaledDirection:this._type=Vc.gc;break;case Qc.Color:this._type=Vc.ip;break;case Qc.Age:case Qc.Lifetime:case Qc.Angle:case Qc.AgeGradient:this._type=Vc.Float;break;case Qc.SpriteCellEnd:case Qc.SpriteCellStart:case Qc.SpriteCellIndex:this._type=Vc.Int}this.output&&(this.output.type=this._type)}}constructor(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vc.AutoDetect;super(y),this._type=Vc.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new b.d,this._systemSource=Yc.None,this._contextualSource=Qc.None,this._type=c,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",c)}get value(){return this._storedValue}set value(y){this.type===Vc.Float&&this.min!==this.max&&(y=Math.max(this.min,y),y=Math.min(this.max,y)),this._storedValue=y,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(y){this._valueCallback=y}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Vc.Int:case Vc.Float:this.value=0;break;case Vc.Vector2:this.value=l.Vector2.Zero();break;case Vc.gc:this.value=l.gc.Zero();break;case Vc.ip:this.value=new p.ip(1,1,1,1);break;case Vc.Matrix:this.value=l.Matrix.Identity()}}_build(y){super._build(y),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=y=>y.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=y=>y.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const y=super.serialize();return y.type=this.type,y.contextualValue=this.contextualValue,y.systemSource=this.systemSource,y.min=this.min,y.max=this.max,y.groupInInspector=this.groupInInspector,y.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.fc?(y.valueType="BABYLON."+this._storedValue.getClassName(),y.value=this._storedValue.fc()):(y.valueType="number",y.value=this._storedValue)),y}_deserialize(y){if(super._deserialize(y),this._type=y.type,this.contextualValue=y.contextualValue,this.systemSource=y.systemSource||Yc.None,this.min=y.min||0,this.max=y.max||0,this.groupInInspector=y.groupInInspector||"",void 0!==y.displayInInspector&&(this.displayInInspector=y.displayInInspector),y.valueType)if("number"===y.valueType)this._storedValue=y.value;else{const c=(0,W.d)(y.valueType);c&&(this._storedValue=c.yA(y.value))}}}(0,W.f)("BABYLON.ParticleInputBlock",vc);class dc extends rc{get url(){return this._url}set url(y){this._url!==y&&(this._cachedData=null,this._url=y,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(y){this._textureDataUrl!==y&&(this._cachedData=null,this._textureDataUrl=y,this._url="",this._sourceTexture=null)}set sourceTexture(y){this._sourceTexture!==y&&(this._cachedData=null,this._sourceTexture=y,this._url="",this._textureDataUrl="")}constructor(y){super(y),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Vc.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const y=this.texture._storedValue;return await new Promise(((c,A)=>{if(!y.isReady())return void y.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),c(this._cachedData)}catch(y){A(y)}}));const l=y.getSize();ac.l.GetTextureDataAsync(y,l.width,l.height).then((A=>{this._cachedData={width:l.width,height:l.height,data:new Uint8ClampedArray(A)},y.dispose(),c(this._cachedData)})).catch(A)}))}_build(y){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new j.d(this._textureDataUrl,y.Fc):this.texture._storedValue=new j.d(this._url,y.Fc):this.texture._storedValue=null}serialize(){const y=super.serialize();return y.url=this.url,y.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(y.textureDataUrl=this.textureDataUrl),y}_deserialize(y){super._deserialize(y),this.url=y.url,this.serializedCachedData=!!y.serializedCachedData,y.textureDataUrl&&(this.textureDataUrl=y.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,W.f)("BABYLON.ParticleTextureSourceBlock",dc);class yA extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerInput("position",Vc.gc),this.registerOutput("output",Vc.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(y){const c=this.particle.getConnectedValue(y);if(this.output._storedValue=c,!this.position.isConnected)return;const A={process:A=>{y.particleContext=A,y.systemContext=c,A.position.p(this.position.getConnectedValue(y))},previousItem:null,nextItem:null};c._updateQueueStart?Yy(A,c._updateQueueStart):c._updateQueueStart=A}}(0,W.f)("BABYLON.UpdatePositionBlock",yA),function(y){y[y.Add=0]="Add",y[y.Subtract=1]="Subtract",y[y.Multiply=2]="Multiply",y[y.Divide=3]="Divide",y[y.Max=4]="Max",y[y.Min=5]="Min"}(gc||(gc={}));class cA extends rc{constructor(y){super(y),this.operation=gc.Add,this.registerInput("left",Vc.AutoDetect),this.registerInput("right",Vc.AutoDetect),this.registerOutput("output",Vc.BasedOnInput),this.output._typeConnectionSource=this.left;const c=[Vc.Matrix,Vc.Particle,Vc.Texture,Vc.System,Vc.FloatGradient,Vc.Color4Gradient,Vc.Vector2Gradient,Vc.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...c),this.right.excludedConnectionPointTypes.push(...c),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(y){let c;const A=this.left,w=this.right;if(!A.isConnected||!w.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const N=A.type===Vc.Float||A.type===Vc.Int,W=w.type===Vc.Float||w.type===Vc.Int,h=N&&W;switch(this.operation){case gc.Add:c=h?y=>A.getConnectedValue(y)+w.getConnectedValue(y):N?y=>y.adapt(A,w.type).add(w.getConnectedValue(y)):y=>A.getConnectedValue(y).add(y.adapt(w,A.type));break;case gc.Subtract:c=h?y=>A.getConnectedValue(y)-w.getConnectedValue(y):N?y=>y.adapt(A,w.type).xc(w.getConnectedValue(y)):y=>A.getConnectedValue(y).xc(y.adapt(w,A.type));break;case gc.Multiply:c=h?y=>A.getConnectedValue(y)*w.getConnectedValue(y):N?y=>y.adapt(A,w.type).multiply(w.getConnectedValue(y)):y=>A.getConnectedValue(y).multiply(y.adapt(w,A.type));break;case gc.Divide:c=h?y=>A.getConnectedValue(y)/w.getConnectedValue(y):N?y=>y.adapt(A,w.type).divide(w.getConnectedValue(y)):y=>A.getConnectedValue(y).divide(y.adapt(w,A.type));break;case gc.Min:if(h)c=y=>Math.min(A.getConnectedValue(y),w.getConnectedValue(y));else{const[y,W]=N?[w,A]:[A,w];switch(y.type){case Vc.Vector2:c=c=>l.Vector2.Minimize(y.getConnectedValue(c),c.adapt(W,y.type));break;case Vc.gc:c=c=>l.gc.Minimize(y.getConnectedValue(c),c.adapt(W,y.type));break;case Vc.ip:c=c=>{const A=y.getConnectedValue(c),{r:l,g:w,b:N,a:h}=c.adapt(W,y.type);return new p.ip(Math.min(A.r,l),Math.min(A.g,w),Math.min(A.b,N),Math.min(A.a,h))}}}break;case gc.Max:if(!h){const[y,W]=N?[w,A]:[A,w];switch(y.type){case Vc.Vector2:c=c=>l.Vector2.Maximize(y.getConnectedValue(c),c.adapt(W,y.type));break;case Vc.gc:c=c=>l.gc.Maximize(y.getConnectedValue(c),c.adapt(W,y.type));break;case Vc.ip:c=c=>{const A=y.getConnectedValue(c),{r:l,g:w,b:N,a:h}=c.adapt(W,y.type);return new p.ip(Math.max(A.r,l),Math.min(A.g,w),Math.min(A.b,N),Math.min(A.a,h))}}break}c=y=>Math.max(A.getConnectedValue(y),w.getConnectedValue(y))}this.output._storedFunction=y=>A.type===Vc.Int?0|c(y):c(y)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Vc.Int||this.left.type===Vc.Float&&this.right.type!==Vc.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[y,c]of[[this.left,this.right],[this.right,this.left]])y.acceptedConnectionPointTypes=[Vc.Int,Vc.Float],c.isConnected&&(y.acceptedConnectionPointTypes.push(c.type),c.type!==Vc.Int&&c.type!==Vc.Float||y.acceptedConnectionPointTypes.push(Vc.Vector2,Vc.gc,Vc.ip))}dispose(){super.dispose();for(const y of this._connectionObservers)y.remove();this._connectionObservers.length=0}serialize(){const y=super.serialize();return y.operation=this.operation,y}_deserialize(y){super._deserialize(y),this.operation=y.operation}}(0,a.b)([nc("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:gc.Add},{label:"Subtract",value:gc.Subtract},{label:"Multiply",value:gc.Multiply},{label:"Divide",value:gc.Divide},{label:"Max",value:gc.Max},{label:"Min",value:gc.Min}]})],cA.prototype,"operation",void 0),(0,W.f)("BABYLON.ParticleMathBlock",cA);class AA extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerInput("direction1",Vc.gc,!0,new l.gc(0,1,0)),this.registerInput("direction2",Vc.gc,!0,new l.gc(0,1,0)),this.registerInput("minEmitBox",Vc.gc,!0,new l.gc(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Vc.gc,!0,new l.gc(.5,.5,.5)),this.registerOutput("output",Vc.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(y){const c=this.particle.getConnectedValue(y);c._directionCreation.process=A=>{y.particleContext=A,y.systemContext=c;const w=this.direction1.getConnectedValue(y),N=this.direction2.getConnectedValue(y),p=(0,I.RandomRange)(w.x,N.x),W=(0,I.RandomRange)(w.y,N.y),h=(0,I.RandomRange)(w.z,N.z);y.isEmitterTransformNode?l.gc.TransformNormalFromFloatsToRef(p,W,h,y.emitterWorldMatrix,A.direction):A.direction.Ec(p,W,h)},c._positionCreation.process=A=>{y.particleContext=A,y.systemContext=c;const w=this.minEmitBox.getConnectedValue(y),N=this.maxEmitBox.getConnectedValue(y),p=(0,I.RandomRange)(w.x,N.x),W=(0,I.RandomRange)(w.y,N.y),h=(0,I.RandomRange)(w.z,N.z);y.isEmitterTransformNode?l.gc.TransformCoordinatesFromFloatsToRef(p,W,h,y.emitterWorldMatrix,A.position):(A.position.Ec(p,W,h),A.position.addInPlace(y.emitterPosition))},this.output._storedValue=c}}(0,W.f)("BABYLON.BoxShapeBlock",AA);class lA extends rc{constructor(y){super(y),this.registerInput("emitPower",Vc.Float,!0,1),this.registerInput("lifeTime",Vc.Float,!0,1),this.registerInput("color",Vc.ip,!0,new p.ip(1,1,1,1)),this.registerInput("scale",Vc.Vector2,!0,new l.Vector2(1,1)),this.registerInput("angle",Vc.Float,!0,0),this.registerOutput("particle",Vc.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(y){const c=new Wc(this.name,y.PA,y.Fc,null,!1,void 0,!0);c.particleEmitterType=new D,c._lifeTimeCreation.process=(c,A)=>{y.particleContext=c,c.lifeTime=this.lifeTime.getConnectedValue(y),A._emitPower=this.emitPower.getConnectedValue(y)},c._colorCreation.process=c=>{y.particleContext=c,c.color.p(this.color.getConnectedValue(y))},c._sizeCreation.process=c=>{y.particleContext=c,c.size=1,c.scale.p(this.scale.getConnectedValue(y))},c._angleCreation.process=c=>{y.particleContext=c,c.angle=this.angle.getConnectedValue(y)},this.particle._storedValue=c}}(0,W.f)("BABYLON.CreateParticleBlock",lA);class wA{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const y=[];for(const c of this.attachedBlocks)c.isInput&&y.push(c);return y}constructor(y){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new b.d,this.name=y}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(y)&&this.attachedBlocks.push(y);for(const A of y.inputs){const l=A.connectedPoint;if(l){const A=l.ownerBlock;A!==y&&this._initializeBlock(A,c)}}}async buildAsync(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((A=>{const l=new Kc;for(const y of this._systemBlocks)this._initializeBlock(y);for(const w of this.systemBlocks){const A=new Ec;A.buildId=this._buildId++,A.Fc=y,A.verbose=c;const N=w.createSystem(A);A.emitErrors(),l.systems.push(N)}this.onBuildObservable.notifyObservers(this),A(l)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const y=new Zc("Particle system"),c=new yA("Update position");c.output.connectTo(y.particle);const A=new vc("Position");A.contextualValue=Qc.Position;const l=new vc("Scaled direction");l.contextualValue=Qc.ScaledDirection;const w=new cA("Add");w.operation=gc.Add,A.output.connectTo(w.left),l.output.connectTo(w.right),w.output.connectTo(c.position);const N=new lA("Create particle"),p=new AA("Box shape");N.particle.connectTo(p.particle),p.output.connectTo(c.particle);const W=new dc("Texture");W.texture.connectTo(y.texture),W.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(y)}removeBlock(y){const c=this.attachedBlocks.indexOf(y);if(c>-1&&this.attachedBlocks.splice(c,1),y.isSystem){const c=this._systemBlocks.indexOf(y);c>-1&&this._systemBlocks.splice(c,1)}}parseSerializedObject(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c||this.clear();const A={};for(const l of y.Rq){const y=(0,W.d)(l.customType);if(y){const c=new y;c._deserialize(l),A[l.id]=c,this.attachedBlocks.push(c),c.isSystem&&this._systemBlocks.push(c)}}for(const l of this.attachedBlocks)if(l.isTeleportOut){const y=l,c=y._tempEntryPointUniqueId;if(c){const l=A[c];l&&l.attachToEndpoint(y)}}for(let l=0;l<y.Rq.length;l++){const w=y.Rq[l],N=A[w.id];N&&(N.inputs.length&&w.inputs.some((y=>y.targetConnectionName))&&!c||this._restoreConnections(N,y,A))}if(y.locations||y.editorData&&y.editorData.locations){const l=y.locations||y.editorData.locations;for(const y of l)A[y.tl]&&(y.tl=A[y.tl].uniqueId);c&&this.editorData&&this.editorData.locations&&l.concat(this.editorData.locations),y.locations?this.editorData={locations:l}:(this.editorData=y.editorData,this.editorData.locations=l);const w=[];for(const y in A)w[y]=A[y].uniqueId;this.editorData.map=w}this.comment=y.comment}_restoreConnections(y,c,A){for(const l of y.outputs)for(const w of c.Rq){const N=A[w.id];if(N)for(const p of w.inputs)if(A[p.targetBlockId]!==y||p.targetConnectionName!==l.name);else{const y=N.getInputByName(p.inputName);if(!y||y.isConnected)continue;l.connectTo(y,!0),this._restoreConnections(N,c,A)}}}serialize(y){const c=y?{}:G.d.Serialize(this);c.editorData=JSON.parse(JSON.stringify(this.editorData));let A=[];y?A=y:c.customType="BABYLON.NodeParticleSystemSet",c.Rq=[];for(const l of A)c.Rq.push(l.serialize());if(!y)for(const l of this.attachedBlocks)-1===A.indexOf(l)&&c.Rq.push(l.serialize());return c}dispose(){for(const y of this.attachedBlocks)y.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(y){const c=new wA(y);return c.setToDefault(),c}static Parse(y){const c=G.d.Parse((()=>new wA(y.name)),y,null);return c.parseSerializedObject(y),c}static ParseFromSnippetAsync(y,c){return"_BLANK"===y?Promise.resolve(wA.CreateDefault("blank")):new Promise(((A,l)=>{const w=new mA.d;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const p=JSON.parse(JSON.parse(w.responseText).jsonPayload),W=JSON.parse(p.nodeParticle);c||(c=G.d.Parse((()=>new wA(y)),W,null)),c.parseSerializedObject(W),c.snippetId=y;try{A(c)}catch(N){l(N)}}else l("Unable to load the snippet "+y)})),w.open("GET",this.SnippetUrl+"/"+y.replace(/#/g,"/")),w.send()}))}}wA.EditorURL=`${Bc.Tools._DefaultCdnUrl}/v${ny.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,wA.SnippetUrl="https://snippet.babylonjs.com",(0,a.b)([(0,u.P)()],wA.prototype,"name",void 0),(0,a.b)([(0,u.P)("comment")],wA.prototype,"comment",void 0),function(y){y[y.None=0]="None",y[y.PerParticle=1]="PerParticle",y[y.PerSystem=2]="PerSystem"}(xc||(xc={}));class NA extends rc{constructor(y){super(y),this._currentLockId=-2,this.lockMode=xc.PerParticle,this.registerInput("min",Vc.AutoDetect,!0,0),this.registerInput("max",Vc.AutoDetect,!0,1),this.registerOutput("output",Vc.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Vc.Float|Vc.Int|Vc.Vector2|Vc.gc|Vc.ip),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Vc.Float|Vc.Int|Vc.Vector2|Vc.gc|Vc.ip),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Vc.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let y=null;switch(this._currentLockId=-2,this.min.type){case Vc.AutoDetect:case Vc.Int:case Vc.Float:y=y=>{const c=this.min.getConnectedValue(y)||0,A=this.max.getConnectedValue(y)||1;return c+Math.random()*(A-c)};break;case Vc.Vector2:y=y=>{const c=this.min.getConnectedValue(y)||l.Vector2.Zero(),A=this.max.getConnectedValue(y)||l.Vector2.One();return new l.Vector2(c.x+Math.random()*(A.x-c.x),c.y+Math.random()*(A.y-c.y))};break;case Vc.gc:y=y=>{const c=this.min.getConnectedValue(y)||l.gc.Zero(),A=this.max.getConnectedValue(y)||l.gc.One();return new l.gc(c.x+Math.random()*(A.x-c.x),c.y+Math.random()*(A.y-c.y),c.z+Math.random()*(A.z-c.z))};break;case Vc.ip:y=y=>{const c=this.min.getConnectedValue(y)||new p.ip(0,0,0,0),A=this.max.getConnectedValue(y)||new p.ip(1,1,1,1);return new p.ip(c.x+Math.random()*(A.x-c.x),c.y+Math.random()*(A.y-c.y),c.z+Math.random()*(A.z-c.z),c.w+Math.random()*(A.w-c.w))}}this.output._storedFunction=c=>{var A;let l=0;switch(this.lockMode){case xc.PerParticle:l=(null===(A=c.particleContext)||void 0===A?void 0:A.id)||-1;break;case xc.PerSystem:l=c.buildId||0}return this._currentLockId!==l&&(this.lockMode!==xc.None&&(this._currentLockId=l),this.output._storedValue=y(c)),this.output._storedValue}}serialize(){const y=super.serialize();return y.lockMode=this.lockMode,y}_deserialize(y){super._deserialize(y),this.lockMode=y.lockMode}}(0,a.b)([nc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:xc.None},{label:"Per particle",value:xc.PerParticle},{label:"Per system",value:xc.PerSystem}]})],NA.prototype,"lockMode",void 0),(0,W.f)("BABYLON.ParticleRandomBlock",NA);class pA extends rc{constructor(y){super(y),this._currentLockId=-2,this.lockMode=xc.PerParticle,this.registerInput("min",Vc.AutoDetect),this.registerInput("max",Vc.AutoDetect),this.registerOutput("output",Vc.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const c=[Vc.Matrix,Vc.Particle,Vc.Texture,Vc.System,Vc.FloatGradient,Vc.Color4Gradient,Vc.Vector2Gradient,Vc.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...c),this.max.excludedConnectionPointTypes.push(...c)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let y=null;switch(this._currentLockId=-2,this.min.type){case Vc.Float:case Vc.Int:y=y=>{const c=this.min.getConnectedValue(y),A=this.max.getConnectedValue(y);return Math.random()*(A-c)+c};break;case Vc.Vector2:y=y=>{const c=this.min.getConnectedValue(y),A=this.max.getConnectedValue(y);return new l.Vector2(Math.random()*(A.x-c.x)+c.x,Math.random()*(A.y-c.y)+c.y)};break;case Vc.gc:y=y=>{const c=this.min.getConnectedValue(y),A=this.max.getConnectedValue(y);return new l.gc(Math.random()*(A.x-c.x)+c.x,Math.random()*(A.y-c.y)+c.y,Math.random()*(A.z-c.z)+c.z)};break;case Vc.ip:y=y=>{const c=this.min.getConnectedValue(y),A=this.max.getConnectedValue(y);return new p.ip(Math.random()*(A.r-c.r)+c.r,Math.random()*(A.g-c.g)+c.g,Math.random()*(A.b-c.b)+c.b,Math.random()*(A.a-c.a)+c.a)}}this.output._storedFunction=c=>{var A;let l=0;switch(this.lockMode){case xc.PerParticle:l=(null===(A=c.particleContext)||void 0===A?void 0:A.id)||-1;break;case xc.PerSystem:l=c.buildId||0}return this._currentLockId!==l&&(this.lockMode!==xc.None&&(this._currentLockId=l),this.output._storedValue=y(c)),this.output._storedValue}}serialize(){const y=super.serialize();return y.lockMode=this.lockMode,y}_deserialize(y){super._deserialize(y),void 0!==y.lockMode&&(this.lockMode=y.lockMode)}}(0,a.b)([nc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:xc.None},{label:"Per particle",value:xc.PerParticle},{label:"Per system",value:xc.PerSystem}]})],pA.prototype,"lockMode",void 0),(0,W.f)("BABYLON.RandomRangeBlock",pA);(0,W.f)("BABYLON.ParticleLerpBlock",class extends rc{constructor(y){super(y),this.registerInput("left",Vc.AutoDetect),this.registerInput("right",Vc.AutoDetect),this.registerInput("gradient",Vc.Float,!0,0,0,1),this.registerOutput("output",Vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Vc.Float|Vc.Int|Vc.Vector2|Vc.gc|Vc.ip)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const y=(y,c,A)=>(1-y)*c+y*A;this.output._storedFunction=c=>{const A=this.left.getConnectedValue(c),w=this.right.getConnectedValue(c),N=this.gradient.getConnectedValue(c);switch(this.left.type){case Vc.Int:case Vc.Float:return y(N,A,w);case Vc.Vector2:return new l.Vector2(y(N,A.x,w.x),y(N,A.y,w.y));case Vc.gc:return new l.gc(y(N,A.x,w.x),y(N,A.y,w.y),y(N,A.z,w.z));case Vc.ip:return new p.ip(y(N,A.r,w.r),y(N,A.g,w.g),y(N,A.b,w.b),y(N,A.a,w.a))}return 0}}});(0,W.f)("BABYLON.UpdateDirectionBlock",class extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerInput("direction",Vc.gc),this.registerOutput("output",Vc.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(y){const c=this.particle.getConnectedValue(y);if(this.output._storedValue=c,!this.direction.isConnected)return;const A={process:A=>{y.particleContext=A,y.systemContext=c,A.direction.p(this.direction.getConnectedValue(y))},previousItem:null,nextItem:null};c._updateQueueStart?Yy(A,c._updateQueueStart):c._updateQueueStart=A}});(0,W.f)("BABYLON.UpdateColorBlock",class extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerInput("color",Vc.ip),this.registerOutput("output",Vc.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(y){const c=this.particle.getConnectedValue(y);if(this.output._storedValue=c,!this.color.isConnected)return;const A={process:A=>{y.particleContext=A,y.systemContext=c,A.color.p(this.color.getConnectedValue(y))},previousItem:null,nextItem:null};c._updateQueueStart?Yy(A,c._updateQueueStart):c._updateQueueStart=A}});(0,W.f)("BABYLON.UpdateScaleBlock",class extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerInput("scale",Vc.Vector2),this.registerOutput("output",Vc.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(y){const c=this.particle.getConnectedValue(y);if(this.output._storedValue=c,!this.scale.isConnected)return;const A={process:A=>{y.particleContext=A,y.systemContext=c,A.scale.p(this.scale.getConnectedValue(y))},previousItem:null,nextItem:null};c._updateQueueStart?Yy(A,c._updateQueueStart):c._updateQueueStart=A}});(0,W.f)("BABYLON.UpdateAngleBlock",class extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerInput("angle",Vc.Float),this.registerOutput("output",Vc.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(y){const c=this.particle.getConnectedValue(y);if(this.output._storedValue=c,!this.angle.isConnected)return;const A={process:A=>{y.particleContext=A,y.systemContext=c,A.angle=this.angle.getConnectedValue(y)},previousItem:null,nextItem:null};c._updateQueueStart?Yy(A,c._updateQueueStart):c._updateQueueStart=A}});(0,W.f)("BABYLON.BasicPositionUpdateBlock",class extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerOutput("output",Vc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(y){const c=this.particle.getConnectedValue(y),A={process:A=>{y.particleContext=A,y.systemContext=c,A.direction.scaleToRef(c._directionScale,c._scaledDirection),A.position.addInPlace(c._scaledDirection)},previousItem:null,nextItem:null};c._updateQueueStart?Yy(A,c._updateQueueStart):c._updateQueueStart=A,this.output._storedValue=c}});(0,W.f)("BABYLON.BasicSpriteUpdateBlock",class extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerOutput("output",Vc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(y){const c=this.particle.getConnectedValue(y),A={process:A=>{y.particleContext=A,y.systemContext=c,A.updateCellIndex()},previousItem:null,nextItem:null};c._updateQueueStart?Yy(A,c._updateQueueStart):c._updateQueueStart=A,this.output._storedValue=c}});(0,W.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerInput("cellIndex",Vc.Int),this.registerOutput("output",Vc.Particle),this.cellIndex.acceptedConnectionPointTypes=[Vc.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(y){const c=this.particle.getConnectedValue(y);if(this.output._storedValue=c,!this.cellIndex.isConnected)return;const A={process:A=>{y.particleContext=A,y.systemContext=c,A.cellIndex=Math.floor(this.cellIndex.getConnectedValue(y))},previousItem:null,nextItem:null};c._updateQueueStart?Yy(A,c._updateQueueStart):c._updateQueueStart=A}});class WA extends rc{constructor(y){super(y),this.strength=1,this.registerInput("particle",Vc.Particle),this.registerInput("flowMap",Vc.Texture),this.registerOutput("output",Vc.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(y){var c;const A=this.particle.getConnectedValue(y),l=y.Fc;let w;(null===(c=this.flowMap.connectedPoint)||void 0===c?void 0:c.ownerBlock).extractTextureContentAsync().then((y=>{y&&(w=new fc(y.width,y.height,y.data))}));const N={process:y=>{const c=l.getTransformMatrix();w&&w._processParticle(y,this.strength*A._tempScaledUpdateSpeed,c)},previousItem:null,nextItem:null};A._updateQueueStart?Yy(N,A._updateQueueStart):A._updateQueueStart=N,this.output._storedValue=A}serialize(){const y=super.serialize();return y.strength=this.strength,y}_deserialize(y){super._deserialize(y),this.strength=y.strength}}(0,a.b)([nc("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WA.prototype,"strength",void 0),(0,W.f)("BABYLON.UpdateFlowMapBlock",WA);(0,W.f)("BABYLON.SphereShapeBlock",class extends rc{constructor(y){super(y),this.registerInput("input",Vc.Particle),this.registerInput("radius",Vc.Float,!0,1),this.registerInput("radiusRange",Vc.Float,!0,1,0,1),this.registerInput("directionRandomizer",Vc.Float,!0,0,0,1),this.registerOutput("output",Vc.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(y){const c=this.input.getConnectedValue(y);c._directionCreation.process=A=>{y.particleContext=A,y.systemContext=c;const w=this.directionRandomizer.getConnectedValue(y),N=A.position.xc(y.emitterPosition).normalize(),p=(0,I.RandomRange)(0,w),W=(0,I.RandomRange)(0,w),h=(0,I.RandomRange)(0,w);N.x+=p,N.y+=W,N.z+=h,N.normalize(),y.isEmitterTransformNode?l.gc.TransformNormalFromFloatsToRef(p,W,h,y.emitterWorldMatrix,A.direction):A.direction.Ec(p,W,h)},c._positionCreation.process=A=>{y.particleContext=A,y.systemContext=c;const w=this.radius.getConnectedValue(y),N=this.radiusRange.getConnectedValue(y),p=w-(0,I.RandomRange)(0,w*N),W=(0,I.RandomRange)(0,1),h=(0,I.RandomRange)(0,2*Math.PI),q=Math.acos(2*W-1),o=p*Math.cos(h)*Math.sin(q),O=p*Math.cos(q),L=p*Math.sin(h)*Math.sin(q);y.isEmitterTransformNode?l.gc.TransformCoordinatesFromFloatsToRef(o,O,L,y.emitterWorldMatrix,A.position):(A.position.Ec(o,O,L),A.position.addInPlace(y.emitterPosition))},this.output._storedValue=c}});(0,W.f)("BABYLON.PointShapeBlock",class extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerInput("direction1",Vc.gc,!0,new l.gc(0,1,0)),this.registerInput("direction2",Vc.gc,!0,new l.gc(0,1,0)),this.registerOutput("output",Vc.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(y){const c=this.particle.getConnectedValue(y);c._directionCreation.process=A=>{y.particleContext=A,y.systemContext=c;const w=this.direction1.getConnectedValue(y),N=this.direction2.getConnectedValue(y),p=(0,I.RandomRange)(w.x,N.x),W=(0,I.RandomRange)(w.y,N.y),h=(0,I.RandomRange)(w.z,N.z);y.isEmitterTransformNode?l.gc.TransformNormalFromFloatsToRef(p,W,h,y.emitterWorldMatrix,A.direction):A.direction.Ec(p,W,h)},c._positionCreation.process=A=>{y.systemContext=c,y.isEmitterTransformNode?l.gc.TransformCoordinatesFromFloatsToRef(0,0,0,y.emitterWorldMatrix,A.position):A.position.p(y.emitterPosition)},this.output._storedValue=c}});(0,W.f)("BABYLON.CustomShapeBlock",class extends rc{constructor(y){super(y),this.registerInput("particle",Vc.Particle),this.registerInput("position",Vc.gc,!0,new l.gc(0,0,0)),this.registerInput("direction",Vc.gc,!0,new l.gc(0,1,0)),this.registerOutput("output",Vc.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(y){const c=this.particle.getConnectedValue(y);c._directionCreation.process=A=>{y.particleContext=A,y.systemContext=c;const w=this.direction.getConnectedValue(y);y.isEmitterTransformNode?l.gc.TransformNormalToRef(w,y.emitterWorldMatrix,A.direction):A.direction.p(w)},c._positionCreation.process=A=>{y.particleContext=A,y.systemContext=c;const w=this.position.getConnectedValue(y);y.isEmitterTransformNode?l.gc.TransformCoordinatesToRef(w,y.emitterWorldMatrix,A.position):(A.position.p(w),A.position.addInPlace(y.emitterPosition))},this.output._storedValue=c}});(0,W.f)("BABYLON.CylinderShapeBlock",class extends rc{constructor(y){super(y),this._tempVector=l.gc.Zero(),this.registerInput("particle",Vc.Particle),this.registerInput("radius",Vc.Float,!0,1),this.registerInput("height",Vc.Float,!0,1,0),this.registerInput("radiusRange",Vc.Float,!0,1,0,1),this.registerInput("directionRandomizer",Vc.Float,!0,0,0,1),this.registerOutput("output",Vc.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(y){const c=this.particle.getConnectedValue(y);c._directionCreation.process=A=>{y.particleContext=A,y.systemContext=c;const w=this.directionRandomizer.getConnectedValue(y);A.position.subtractToRef(y.emitterPosition,this._tempVector),this._tempVector.normalize(),y.isEmitterTransformNode&&l.gc.TransformNormalToRef(this._tempVector,y.emitterInverseWorldMatrix,this._tempVector);const N=(0,I.RandomRange)(-w/2,w/2);let p=Math.atan2(this._tempVector.x,this._tempVector.z);p+=(0,I.RandomRange)(-Math.PI/2,Math.PI/2)*w,this._tempVector.y=N,this._tempVector.x=Math.sin(p),this._tempVector.z=Math.cos(p),this._tempVector.normalize(),y.isEmitterTransformNode?l.gc.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,y.emitterWorldMatrix,A.direction):A.direction.p(this._tempVector)},c._positionCreation.process=A=>{y.particleContext=A,y.systemContext=c;const w=this.height.getConnectedValue(y),N=this.radiusRange.getConnectedValue(y),p=this.radius.getConnectedValue(y),W=(0,I.RandomRange)(-w/2,w/2),h=(0,I.RandomRange)(0,2*Math.PI),q=(0,I.RandomRange)((1-N)*(1-N),1),o=Math.sqrt(q)*p,O=o*Math.cos(h),L=o*Math.sin(h);y.isEmitterTransformNode?l.gc.TransformCoordinatesFromFloatsToRef(O,W,L,y.emitterWorldMatrix,A.position):(A.position.Ec(O,W,L),A.position.addInPlace(y.emitterPosition))},this.output._storedValue=c}});class hA extends rc{constructor(y){super(y),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Vc.Particle),this.registerOutput("output",Vc.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(y){super._build(y);const c=this.particle.getConnectedValue(y);c._isAnimationSheetEnabled=!0,c.spriteCellWidth=this.width,c.spriteCellHeight=this.height,c.startSpriteCellID=this.start,c.endSpriteCellID=this.end,c.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=c}serialize(){const y=super.serialize();return y.width=this.width,y.height=this.height,y.start=this.start,y.end=this.end,y.randomStartCell=this.randomStartCell,y}_deserialize(y){super._deserialize(y),this.width=y.width,this.height=y.height,this.start=y.start,this.end=y.end,this.randomStartCell=y.randomStartCell}}(0,a.b)([nc("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hA.prototype,"start",void 0),(0,a.b)([nc("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hA.prototype,"end",void 0),(0,a.b)([nc("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hA.prototype,"width",void 0),(0,a.b)([nc("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hA.prototype,"height",void 0),(0,a.b)([nc("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],hA.prototype,"loop",void 0),(0,a.b)([nc("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],hA.prototype,"randomStartCell",void 0),(0,W.f)("BABYLON.SetupSpriteSheetBlock",hA);class IA extends rc{constructor(y){super(y),this.reference=0,this.registerInput("value",Vc.AutoDetect),this.registerOutput("output",Vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=y=>{switch(y){case Vc.Float:return Vc.FloatGradient;case Vc.Vector2:return Vc.Vector2Gradient;case Vc.gc:return Vc.Vector3Gradient;case Vc.ip:return Vc.Color4Gradient}return y},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Vc.Float|Vc.Vector2|Vc.gc|Vc.ip)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=y=>null}serialize(){const y=super.serialize();return y.reference=this.reference,y}_deserialize(y){super._deserialize(y),this.reference=y.reference}}(0,a.b)([nc("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],IA.prototype,"reference",void 0),(0,W.f)("BABYLON.ParticleGradientValueBlock",IA);(0,W.f)("BABYLON.ParticleGradientBlock",class extends rc{constructor(y){super(y),this._entryCount=1,this.registerInput("gradient",Vc.Float,!0,1,0,1),this.registerInput("value0",Vc.AutoDetect),this.registerOutput("output",Vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=y=>{switch(y){case Vc.FloatGradient:return Vc.Float;case Vc.Vector2Gradient:return Vc.Vector2;case Vc.Vector3Gradient:return Vc.gc;case Vc.Color4Gradient:return Vc.ip}return y},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Vc.FloatGradient|Vc.Vector2Gradient|Vc.Vector3Gradient|Vc.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(y){this._inputs[y].onConnectionObservable.add((()=>{this._entryCount>y||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Vc.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const y=[];for(let A=1;A<this._inputs.length;A++){var c;if(this._inputs[A].isConnected)y.push(null===(c=this._inputs[A].connectedPoint)||void 0===c?void 0:c.ownerBlock)}y.sort(((y,c)=>y.reference-c.reference)),this.output._storedFunction=c=>{const A=this.gradient.getConnectedValue(c);if(1===y.length)return y[0].value.getConnectedValue(c);let w=null;for(let N=y.length-1;N>=0;N--){const W=y[N];if(W.reference<=A){const y=W.value.getConnectedValue(c);if(w){const N=w.value.getConnectedValue(c),h=w.reference,q=W.reference,o=Math.max(0,Math.min(1,(A-q)/(h-q)));switch(this.output.type){case Vc.Float:return(0,I.Lerp)(y,N,o);case Vc.Vector2:return l.Vector2.Lerp(y,N,o);case Vc.gc:return l.gc.Lerp(y,N,o);case Vc.ip:return p.ip.Lerp(y,N,o)}}return y}w=W}return 0}}});(0,W.f)("BABYLON.ParticleConverterBlock",class extends rc{constructor(y){super(y),this.registerInput("color ",Vc.ip,!0),this.registerInput("xyz ",Vc.gc,!0),this.registerInput("xy ",Vc.Vector2,!0),this.registerInput("zw ",Vc.Vector2,!0),this.registerInput("x ",Vc.Float,!0),this.registerInput("y ",Vc.Float,!0),this.registerInput("z ",Vc.Float,!0),this.registerInput("w ",Vc.Float,!0),this.registerOutput("color",Vc.ip),this.registerOutput("xyz",Vc.gc),this.registerOutput("xy",Vc.Vector2),this.registerOutput("zw",Vc.Vector2),this.registerOutput("x",Vc.Float),this.registerOutput("y",Vc.Float),this.registerOutput("z",Vc.Float),this.registerOutput("w",Vc.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(y){return"color "===y?"colorIn":"xyz "===y?"xyzIn":"xy "===y?"xyIn":"zw "===y?"zwIn":"x "===y?"xIn":"y "===y?"yIn":"z "===y?"zIn":"w "===y?"wIn":y}_outputRename(y){switch(y){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return y}}_build(y){super._build(y);const c=this.xIn,A=this.yIn,w=this.zIn,N=this.wIn,W=this.xyIn,h=this.zwIn,I=this.xyzIn,q=this.colorIn,o=this.colorOut,O=this.xyzOut,L=this.xyOut,i=this.zwOut,H=this.xOut,P=this.yOut,D=this.zOut,t=this.wOut,s=y=>{if(q.isConnected)return q.getConnectedValue(y);let l=0,o=0,O=0,L=0;if(c.isConnected&&(l=c.getConnectedValue(y)),A.isConnected&&(o=A.getConnectedValue(y)),w.isConnected&&(O=w.getConnectedValue(y)),N.isConnected&&(L=N.getConnectedValue(y)),W.isConnected){const c=W.getConnectedValue(y);c&&(l=c.x,o=c.y)}if(h.isConnected){const c=h.getConnectedValue(y);c&&(O=c.x,L=c.y)}if(I.isConnected){const c=I.getConnectedValue(y);c&&(l=c.x,o=c.y,O=c.z)}return new p.ip(l,o,O,L)};o._storedFunction=y=>s(y),O._storedFunction=y=>{const c=s(y);return new l.gc(c.r,c.g,c.b)},L._storedFunction=y=>{const c=s(y);return new l.Vector2(c.r,c.g)},i._storedFunction=y=>{const c=s(y);return new l.Vector2(c.b,c.a)},H._storedFunction=y=>s(y).r,P._storedFunction=y=>s(y).g,D._storedFunction=y=>s(y).b,t._storedFunction=y=>s(y).a}}),function(y){y[y.Cos=0]="Cos",y[y.Sin=1]="Sin",y[y.Abs=2]="Abs",y[y.Exp=3]="Exp",y[y.Exp2=4]="Exp2",y[y.Round=5]="Round",y[y.Floor=6]="Floor",y[y.Ceiling=7]="Ceiling",y[y.Sqrt=8]="Sqrt",y[y.Log=9]="Log",y[y.Tan=10]="Tan",y[y.ArcTan=11]="ArcTan",y[y.ArcCos=12]="ArcCos",y[y.ArcSin=13]="ArcSin",y[y.Sign=14]="Sign",y[y.Negate=15]="Negate",y[y.OneMinus=16]="OneMinus",y[y.Reciprocal=17]="Reciprocal",y[y.ToDegrees=18]="ToDegrees",y[y.ToRadians=19]="ToRadians",y[y.Fract=20]="Fract"}(Fc||(Fc={}));class qA extends rc{constructor(y){super(y),this.operation=Fc.Cos,this.registerInput("input",Vc.AutoDetect),this.registerOutput("output",Vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Vc.Float|Vc.Int|Vc.Vector2|Vc.gc|Vc.ip)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(y){super._build(y);let c=null;switch(this.operation){case Fc.Cos:c=y=>Math.cos(y);break;case Fc.Sin:c=y=>Math.sin(y);break;case Fc.Abs:c=y=>Math.abs(y);break;case Fc.Exp:c=y=>Math.exp(y);break;case Fc.Exp2:c=y=>Math.pow(2,y);break;case Fc.Round:c=y=>Math.round(y);break;case Fc.Floor:c=y=>Math.floor(y);break;case Fc.Ceiling:c=y=>Math.ceil(y);break;case Fc.Sqrt:c=y=>Math.sqrt(y);break;case Fc.Log:c=y=>Math.log(y);break;case Fc.Tan:c=y=>Math.tan(y);break;case Fc.ArcTan:c=y=>Math.atan(y);break;case Fc.ArcCos:c=y=>Math.acos(y);break;case Fc.ArcSin:c=y=>Math.asin(y);break;case Fc.Sign:c=y=>Math.sign(y);break;case Fc.Negate:c=y=>-y;break;case Fc.OneMinus:c=y=>1-y;break;case Fc.Reciprocal:c=y=>1/y;break;case Fc.ToRadians:c=y=>y*Math.PI/180;break;case Fc.ToDegrees:c=y=>180*y/Math.PI;break;case Fc.Fract:c=y=>y>=0?y-Math.floor(y):y-Math.ceil(y)}if(!c)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Vc.Int:case Vc.Float:this.output._storedFunction=y=>{const A=this.input.getConnectedValue(y);return c(A)};break;case Vc.Vector2:this.output._storedFunction=y=>{const A=this.input.getConnectedValue(y);return new l.Vector2(c(A.x),c(A.y))};break;case Vc.gc:this.output._storedFunction=y=>{const A=this.input.getConnectedValue(y);return new l.gc(c(A.x),c(A.y),c(A.z))};break;case Vc.ip:this.output._storedFunction=y=>{const A=this.input.getConnectedValue(y);return new p.ip(c(A.r),c(A.g),c(A.b),c(A.a))}}return this}serialize(){const y=super.serialize();return y.operation=this.operation,y}_deserialize(y){super._deserialize(y),this.operation=y.operation}}(0,a.b)([nc("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Fc.Cos},{label:"Sin",value:Fc.Sin},{label:"Abs",value:Fc.Abs},{label:"Exp",value:Fc.Exp},{label:"Exp2",value:Fc.Exp2},{label:"Round",value:Fc.Round},{label:"Floor",value:Fc.Floor},{label:"Ceiling",value:Fc.Ceiling},{label:"Sqrt",value:Fc.Sqrt},{label:"Log",value:Fc.Log},{label:"Tan",value:Fc.Tan},{label:"ArcTan",value:Fc.ArcTan},{label:"ArcCos",value:Fc.ArcCos},{label:"ArcSin",value:Fc.ArcSin},{label:"Sign",value:Fc.Sign},{label:"Negate",value:Fc.Negate},{label:"OneMinus",value:Fc.OneMinus},{label:"Reciprocal",value:Fc.Reciprocal},{label:"ToDegrees",value:Fc.ToDegrees},{label:"ToRadians",value:Fc.ToRadians},{label:"Fract",value:Fc.Fract}]})],qA.prototype,"operation",void 0),(0,W.f)("BABYLON.ParticleTrigonometryBlock",qA);var oA,OA=A(13661);class LA extends rc{constructor(y){super(y),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Vc.AutoDetect),this.registerOutput("output",Vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Vc.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Vc.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Vc.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Vc.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Vc.System),this._inputs[0].excludedConnectionPointTypes.push(Vc.Particle),this._inputs[0].excludedConnectionPointTypes.push(Vc.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(y){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const c=y=>{const c=this.input.getConnectedValue(y);if(this.log.length>=this.stackSize)return c;if(null===c||void 0===c)return this.log.push(["null",""]),c;switch(this.input.type){case Vc.Vector2:this.log.push([(0,OA.l)(c,4),c.toString()]);break;case Vc.gc:this.log.push([(0,OA.n)(c,4),c.toString()]);break;case Vc.ip:this.log.push([`{R: ${c.r.toFixed(4)} G: ${c.g.toFixed(4)} B: ${c.b.toFixed(4)} A: ${c.a.toFixed(4)}}`,c.toString()]);break;default:this.log.push([c.toString(),c.toString()])}return c};this.output.isConnected?this.output._storedFunction=c:this.output._storedValue=c(y)}serialize(){const y=super.serialize();return y.stackSize=this.stackSize,y}_deserialize(y){super._deserialize(y),this.stackSize=y.stackSize}}(0,a.b)([nc("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],LA.prototype,"stackSize",void 0),(0,W.f)("BABYLON.ParticleDebugBlock",LA);(0,W.f)("BABYLON.ParticleElbowBlock",class extends rc{constructor(y){super(y),this.registerInput("input",Vc.AutoDetect),this.registerOutput("output",Vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(y){super._build(y);const c=this._outputs[0],A=this._inputs[0];c._storedFunction=y=>A.getConnectedValue(y)}});(0,W.f)("BABYLON.ParticleTeleportInBlock",class extends rc{get endpoints(){return this._endpoints}constructor(y){super(y),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Vc.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(y){if(this.getClassName()===y)return!0;for(const c of this.endpoints)if(c.isAnAncestorOfType(y))return!0;return!1}isAnAncestorOf(y){for(const c of this.endpoints){if(c===y)return!0;if(c.isAnAncestorOf(y))return!0}return!1}attachToEndpoint(y){y.detach(),this._endpoints.push(y),y._entryPoint=this,y._outputs[0]._typeConnectionSource=this._inputs[0],y._tempEntryPointUniqueId=null,y.name="> "+this.name}detachFromEndpoint(y){const c=this._endpoints.indexOf(y);-1!==c&&(this._endpoints.splice(c,1),y._outputs[0]._typeConnectionSource=null,y._entryPoint=null)}_build(){for(const y of this._endpoints)y.output._storedFunction=y=>this.input.getConnectedValue(y)}});(0,W.f)("BABYLON.ParticleTeleportOutBlock",class extends rc{constructor(y){super(y),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Vc.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(y){this.entryPoint&&this.entryPoint.build(y)}clone(){const y=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(y),y}serialize(){var y;const c=super.serialize();return c.entryPoint=(null===(y=this.entryPoint)||void 0===y?void 0:y.uniqueId)??"",c}_deserialize(y){super._deserialize(y),this._tempEntryPointUniqueId=y.entryPoint}}),function(y){y[y.Equal=0]="Equal",y[y.NotEqual=1]="NotEqual",y[y.LessThan=2]="LessThan",y[y.GreaterThan=3]="GreaterThan",y[y.LessOrEqual=4]="LessOrEqual",y[y.GreaterOrEqual=5]="GreaterOrEqual",y[y.Xor=6]="Xor",y[y.Or=7]="Or",y[y.And=8]="And"}(oA||(oA={}));class iA extends rc{constructor(y){super(y),this.test=oA.Equal,this.epsilon=0,this.registerInput("left",Vc.Float),this.registerInput("right",Vc.Float,!0,0),this.registerInput("ifTrue",Vc.AutoDetect,!0,1),this.registerInput("ifFalse",Vc.AutoDetect,!0,0),this.registerOutput("output",Vc.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Vc.Float,this._inputs[0].acceptedConnectionPointTypes.push(Vc.Int),this._inputs[1].acceptedConnectionPointTypes.push(Vc.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const y=y=>{const c=this.left.getConnectedValue(y),A=this.right.getConnectedValue(y);let l=!1;switch(this.test){case oA.Equal:l=(0,I.WithinEpsilon)(c,A,this.epsilon);break;case oA.NotEqual:l=!(0,I.WithinEpsilon)(c,A,this.epsilon);break;case oA.LessThan:l=c<A+this.epsilon;break;case oA.GreaterThan:l=c>A-this.epsilon;break;case oA.LessOrEqual:l=c<=A+this.epsilon;break;case oA.GreaterOrEqual:l=c>=A-this.epsilon;break;case oA.Xor:l=!!c&&!A||!c&&!!A;break;case oA.Or:l=!!c||!!A;break;case oA.And:l=!!c&&!!A}return l};this.output._storedFunction=c=>y(c)?this.ifTrue.getConnectedValue(c):this.ifFalse.getConnectedValue(c)}serialize(){const y=super.serialize();return y.test=this.test,y.epsilon=this.epsilon,y}_deserialize(y){super._deserialize(y),this.test=y.test,void 0!==y.epsilon&&(this.epsilon=y.epsilon)}}(0,a.b)([nc("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:oA.Equal},{label:"NotEqual",value:oA.NotEqual},{label:"LessThan",value:oA.LessThan},{label:"GreaterThan",value:oA.GreaterThan},{label:"LessOrEqual",value:oA.LessOrEqual},{label:"GreaterOrEqual",value:oA.GreaterOrEqual},{label:"Xor",value:oA.Xor},{label:"Or",value:oA.Or},{label:"And",value:oA.And}]})],iA.prototype,"test",void 0),(0,a.b)([nc("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],iA.prototype,"epsilon",void 0),(0,W.f)("BABYLON.ParticleConditionBlock",iA);class HA extends rc{constructor(y){super(y),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Vc.Particle),this.registerInput("condition",Vc.Float,!0,0),this.registerInput("system",Vc.System),this.registerOutput("output",Vc.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(y){this._triggerCount=0;const c=this.input.getConnectedValue(y),A={process:A=>{if(y.particleContext=A,y.systemContext=c,0!==this.condition.getConnectedValue(y)&&(0===this.limit||this._triggerCount<this.limit)){const l=(new Date).getTime();if(this._previousOne&&l-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=l;const w=this.system.getConnectedValue(y);if(w){const l=bc(w,y.Fc,A.position);l.zc.addOnce((()=>{this._triggerCount--})),c.zc.addOnce((()=>{l.dispose()}))}}},previousItem:null,nextItem:null};c._updateQueueStart?Yy(A,c._updateQueueStart):c._updateQueueStart=A,this.output._storedValue=c}serialize(){const y=super.serialize();return y.limit=this.limit,y.delay=this.delay,y}_deserialize(y){super._deserialize(y),void 0!==y.limit&&(this.limit=y.limit),void 0!==y.delay&&(this.delay=y.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,a.b)([nc("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HA.prototype,"limit",void 0),(0,a.b)([nc("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HA.prototype,"delay",void 0),(0,W.f)("BABYLON.ParticleTriggerBlock",HA);A(13668),A(13674),A(13682),A(13745)},13730:(y,c,A)=>{"use strict";var l=A(12233);const w="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13691:(y,c,A)=>{"use strict";var l=A(12233);const w="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13759:(y,c,A)=>{"use strict";var l=A(12233);const w="clipPlaneVertex",N="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13749:(y,c,A)=>{"use strict";var l=A(12233);const w="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13738:(y,c,A)=>{"use strict";var l=A(12233);const w="fogFragment",N="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13723:(y,c,A)=>{"use strict";var l=A(12233);const w="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13766:(y,c,A)=>{"use strict";var l=A(12233);const w="fogVertex",N="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13757:(y,c,A)=>{"use strict";var l=A(12233);const w="fogVertexDeclaration",N="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13713:(y,c,A)=>{"use strict";var l=A(12233);const w="helperFunctions",N="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13700:(y,c,A)=>{"use strict";var l=A(12233);const w="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13721:(y,c,A)=>{"use strict";var l=A(12233);const w="imageProcessingFunctions",N="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13708:(y,c,A)=>{"use strict";var l=A(12233);const w="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13736:(y,c,A)=>{"use strict";var l=A(12233);const w="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13770:(y,c,A)=>{"use strict";var l=A(12233);const w="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";l.b.IncludesShadersStoreWGSL[w]||(l.b.IncludesShadersStoreWGSL[w]=N)},13682:(y,c,A)=>{"use strict";A.r(c),A.d(c,{particlesPixelShaderWGSL:()=>p});var l=A(12233);A(13691),A(13700),A(13708),A(13713),A(13721),A(13723),A(13730),A(13736),A(13738);const w="particlesPixelShader",N="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";l.b.ShadersStoreWGSL[w]||(l.b.ShadersStoreWGSL[w]=N);const p={name:w,shader:N}},13745:(y,c,A)=>{"use strict";A.r(c),A.d(c,{particlesVertexShaderWGSL:()=>p});var l=A(12233);A(13749),A(13757),A(13708),A(13759),A(13766),A(13770);const w="particlesVertexShader",N="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";l.b.ShadersStoreWGSL[w]||(l.b.ShadersStoreWGSL[w]=N);const p={name:w,shader:N}},13602:(y,c,A)=>{"use strict";var l=A(12233);const w="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13670:(y,c,A)=>{"use strict";var l=A(12233);const w="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13620:(y,c,A)=>{"use strict";var l=A(12233);const w="clipPlaneVertex",N="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13680:(y,c,A)=>{"use strict";var l=A(12233);const w="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13608:(y,c,A)=>{"use strict";var l=A(12233);const w="fogFragment",N="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13600:(y,c,A)=>{"use strict";var l=A(12233);const w="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13624:(y,c,A)=>{"use strict";var l=A(12233);const w="fogVertex",N="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13612:(y,c,A)=>{"use strict";var l=A(12233);const w="fogVertexDeclaration",N="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13589:(y,c,A)=>{"use strict";var l=A(12233);const w="helperFunctions",N="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13580:(y,c,A)=>{"use strict";var l=A(12233);const w="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13593:(y,c,A)=>{"use strict";var l=A(12233);const w="imageProcessingFunctions",N="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13582:(y,c,A)=>{"use strict";var l=A(12233);const w="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13605:(y,c,A)=>{"use strict";var l=A(12233);const w="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13626:(y,c,A)=>{"use strict";var l=A(12233);const w="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";l.b.IncludesShadersStore[w]||(l.b.IncludesShadersStore[w]=N)},13668:(y,c,A)=>{"use strict";A.r(c),A.d(c,{particlesPixelShader:()=>p});var l=A(12233);A(13670),A(13580),A(13582),A(13589),A(13593),A(13600),A(13602),A(13605),A(13608);const w="particlesPixelShader",N="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";l.b.ShadersStore[w]||(l.b.ShadersStore[w]=N);const p={name:w,shader:N}},13674:(y,c,A)=>{"use strict";A.r(c),A.d(c,{particlesVertexShader:()=>p});var l=A(12233);A(13680),A(13612),A(13582),A(13620),A(13624),A(13626);const w="particlesVertexShader",N="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";l.b.ShadersStore[w]||(l.b.ShadersStore[w]=N);const p={name:w,shader:N}},14041:(y,c,A)=>{"use strict";A.r(c),A.d(c,{FlowGraphGLTFDataProvider:()=>N});var l=A(14010),w=A(13993);class N extends l.e{constructor(y){var c,A;super();const l=y.glTF,N=(null===(c=l.animations)||void 0===c?void 0:c.map((y=>y._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",w.e,N);const p=(null===(A=l.nodes)||void 0===A?void 0:A.map((y=>y._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",w.e,p)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13928:(y,c,A)=>{"use strict";A.d(c,{e:()=>P,g:()=>i,h:()=>L,k:()=>H});var l=A(12325),w=A(12802),N=A(12375),p=A(13934);const W=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class h{constructor(y,c){this._gltf=y,this._infoTree=c}convert(y){let c,A=this._gltf,l=this._infoTree;if(!y.startsWith("/"))throw new Error("Path must start with a /");const w=y.split("/");if(w.shift(),w[w.length-1].includes(".length")){const y=w[w.length-1].split(".");w.pop(),w.push(...y)}let N=!1;for(const h of w){const w="length"===h;if(w&&!l.__array__)throw new Error(`Path ${y} is invalid`);if(l.__ignoreObjectTree__&&(N=!0),l.__array__&&!w)l=l.__array__;else if(l=l[h],!l)throw new Error(`Path ${y} is invalid`);if(!N)if(void 0===A){if(!W.find((c=>c.regex.test(y))))throw new Error(`Path ${y} is invalid`)}else if(!w){var p;A=null===(p=A)||void 0===p?void 0:p[h]}(l.__target__||w)&&(c=A)}return{object:c,info:l}}}function I(y,c,A,l){const w=q(y,c);return l?w[A][l]:w[A]}function q(y,c,A){var l,N;return null===(l=y._data)||void 0===l||null===(N=l[(null===A||void 0===A?void 0:A.fillMode)??w.c.MATERIAL_TriangleFillMode])||void 0===N?void 0:N.babylonMaterial}function o(y,c){return{offset:{componentsCount:2,type:"Vector2",get:(A,w,N)=>{const p=I(A,N,y,c);return new l.Vector2(null===p||void 0===p?void 0:p.uOffset,null===p||void 0===p?void 0:p.vOffset)},getTarget:q,set:(A,l,w,N)=>{const p=I(l,N,y,c);p.uOffset=A.x,p.vOffset=A.y},getPropertyName:[()=>`${y}${c?"."+c:""}.uOffset`,()=>`${y}${c?"."+c:""}.vOffset`]},rotation:{type:"number",get:(A,l,w)=>{var N;return null===(N=I(A,w,y,c))||void 0===N?void 0:N.wAng},getTarget:q,set:(A,l,w,N)=>I(l,N,y,c).wAng=A,getPropertyName:[()=>`${y}${c?"."+c:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(A,w,N)=>{const p=I(A,N,y,c);return new l.Vector2(null===p||void 0===p?void 0:p.uScale,null===p||void 0===p?void 0:p.vScale)},getTarget:q,set:(A,l,w,N)=>{const p=I(l,N,y,c);p.uScale=A.x,p.vScale=A.y},getPropertyName:[()=>`${y}${c?"."+c:""}.uScale`,()=>`${y}${c?"."+c:""}.vScale`]}}}const O={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:y=>{var c,A;return new l.Vector2((null===(c=y._babylonCamera)||void 0===c?void 0:c.orthoLeft)??0,(null===(A=y._babylonCamera)||void 0===A?void 0:A.orthoRight)??0)},set:(y,c)=>{c._babylonCamera&&(c._babylonCamera.orthoLeft=y.x,c._babylonCamera.orthoRight=y.y)},getTarget:y=>y,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:y=>{var c,A;return new l.Vector2((null===(c=y._babylonCamera)||void 0===c?void 0:c.orthoBottom)??0,(null===(A=y._babylonCamera)||void 0===A?void 0:A.orthoTop)??0)},set:(y,c)=>{c._babylonCamera&&(c._babylonCamera.orthoBottom=y.x,c._babylonCamera.orthoTop=y.y)},getTarget:y=>y,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:y=>{var c;return null===(c=y._babylonCamera)||void 0===c?void 0:c.maxZ},set:(y,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=y)},getTarget:y=>y,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:y=>{var c;return null===(c=y._babylonCamera)||void 0===c?void 0:c.ec},set:(y,c)=>{c._babylonCamera&&(c._babylonCamera.ec=y)},getTarget:y=>y,getPropertyName:[()=>"ec"]}},perspective:{aspectRatio:{type:"number",get:y=>{var c;return null===(c=y._babylonCamera)||void 0===c?void 0:c.getEngine().getAspectRatio(y._babylonCamera)},getTarget:y=>y,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:y=>{var c;return null===(c=y._babylonCamera)||void 0===c?void 0:c.fov},set:(y,c)=>{c._babylonCamera&&(c._babylonCamera.fov=y)},getTarget:y=>y,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:y=>{var c;return null===(c=y._babylonCamera)||void 0===c?void 0:c.maxZ},set:(y,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=y)},getTarget:y=>y,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:y=>{var c;return null===(c=y._babylonCamera)||void 0===c?void 0:c.ec},set:(y,c)=>{c._babylonCamera&&(c._babylonCamera.ec=y)},getTarget:y=>y,getPropertyName:[()=>"ec"]}}}},nodes:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"gc",get:y=>{var c;return null===(c=y._babylonTransformNode)||void 0===c?void 0:c.position},set:(y,c)=>{var A;return null===(A=c._babylonTransformNode)||void 0===A?void 0:A.position.p(y)},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:y=>{var c;return null===(c=y._babylonTransformNode)||void 0===c?void 0:c.rotationQuaternion},set:(y,c)=>{var A,l;return null===(A=c._babylonTransformNode)||void 0===A||null===(l=A.rotationQuaternion)||void 0===l?void 0:l.p(y)},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"gc",get:y=>{var c;return null===(c=y._babylonTransformNode)||void 0===c?void 0:c.bc},set:(y,c)=>{var A;return null===(A=c._babylonTransformNode)||void 0===A?void 0:A.bc.p(y)},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"bc"]},weights:{length:{type:"number",get:y=>y._numMorphTargets,getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(y,c)=>{var A,l;return void 0!==c?null===(A=y._primitiveBabylonMeshes)||void 0===A||null===(l=A[0].morphTargetManager)||void 0===l?void 0:l.getTarget(c).influence:void 0},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(y,c)=>[0],getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:y=>{var c,A,w;return l.Matrix.Compose(null===(c=y._babylonTransformNode)||void 0===c?void 0:c.bc,null===(A=y._babylonTransformNode)||void 0===A?void 0:A.rotationQuaternion,null===(w=y._babylonTransformNode)||void 0===w?void 0:w.position)},getTarget:y=>y._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:y=>{var c,A,w,N;const p=l.Matrix.Identity();let W=y.parent;for(;W&&W.parent;)W=W.parent;const h=(null===(c=y._babylonTransformNode)||void 0===c?void 0:c.position._isDirty)||(null===(A=y._babylonTransformNode)||void 0===A||null===(w=A.rotationQuaternion)||void 0===w?void 0:w._isDirty)||(null===(N=y._babylonTransformNode)||void 0===N?void 0:N.bc._isDirty);if(W){var I;const c=null===(I=W._babylonTransformNode)||void 0===I?void 0:I.Yc(!0).invert();var q,o;if(c)null===(q=y._babylonTransformNode)||void 0===q||null===(o=q.Yc(h))||void 0===o||o.multiplyToRef(c,p)}else y._babylonTransformNode&&p.p(y._babylonTransformNode.Yc(h));return p},getTarget:y=>y._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:y=>{var c,A;return null===(c=y._babylonTransformNode)||void 0===c||null===(A=c.getChildren((y=>y instanceof p.e),!0)[0])||void 0===A?void 0:A.JW},getTarget:y=>{var c;return null===(c=y._babylonTransformNode)||void 0===c?void 0:c.getChildren((y=>y instanceof p.e),!0)[0]},set:(y,c)=>{if(c._babylonTransformNode){const A=c._babylonTransformNode.getChildren((y=>y instanceof p.e),!0)[0];A&&(A.JW=y)}}},color:{type:"dc",get:y=>{var c,A;return null===(c=y._babylonTransformNode)||void 0===c||null===(A=c.getChildren((y=>y instanceof p.e),!0)[0])||void 0===A?void 0:A.UW},getTarget:y=>{var c;return null===(c=y._babylonTransformNode)||void 0===c?void 0:c.getChildren((y=>y instanceof p.e),!0)[0]},set:(y,c)=>{if(c._babylonTransformNode){const A=c._babylonTransformNode.getChildren((y=>y instanceof p.e),!0)[0];A&&(A.UW=y)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"dc",get:(y,c,A)=>q(y,c,A).emissiveColor,set:(y,c,A,l)=>q(c,A,l).emissiveColor.p(y),getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:o("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(y,c,A)=>{var l;return null===(l=I(y,A,"bumpTexture"))||void 0===l?void 0:l.level},set:(y,c,A,l)=>{const w=I(c,l,"bumpTexture");w&&(w.level=y)},getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:o("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(y,c,A)=>q(y,c,A).ambientTextureStrength,set:(y,c,A,l)=>{const w=q(c,A,l);w&&(w.ambientTextureStrength=y)},getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:o("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ip",get:(y,c,A)=>{const l=q(y,c,A);return N.ip.FromColor3(l.albedoColor,l.alpha)},set:(y,c,A,l)=>{const w=q(c,A,l);w.albedoColor.set(y.r,y.g,y.b),w.alpha=y.a},getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:o("albedoTexture")}},metallicFactor:{type:"number",get:(y,c,A)=>q(y,c,A).metallic,set:(y,c,A,l)=>{const w=q(c,A,l);w&&(w.metallic=y)},getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(y,c,A)=>q(y,c,A).roughness,set:(y,c,A,l)=>{const w=q(c,A,l);w&&(w.roughness=y)},getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:o("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(y,c,A)=>q(y,c,A).anisotropy.JW,set:(y,c,A,l)=>{q(c,A,l).anisotropy.JW=y},getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(y,c,A)=>q(y,c,A).anisotropy.angle,set:(y,c,A,l)=>{q(c,A,l).anisotropy.angle=y},getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:o("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(y,c,A)=>q(y,c,A).clearCoat.JW,set:(y,c,A,l)=>{q(c,A,l).clearCoat.JW=y},getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(y,c,A)=>q(y,c,A).clearCoat.roughness,set:(y,c,A,l)=>{q(c,A,l).clearCoat.roughness=y},getTarget:(y,c,A)=>q(y,c,A),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:o("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(y,c,A)=>{var l;return null===(l=q(y,c,A).clearCoat.bumpTexture)||void 0===l?void 0:l.level},getTarget:q,set:(y,c,A,l)=>q(c,A,l).clearCoat.bumpTexture.level=y},extensions:{KHR_texture_transform:o("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:o("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(y,c,A)=>q(y,c,A).subSurface.dispersion,getTarget:q,set:(y,c,A,l)=>q(c,A,l).subSurface.dispersion=y}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(y,c,A)=>q(y,c,A).emissiveIntensity,getTarget:q,set:(y,c,A,l)=>q(c,A,l).emissiveIntensity=y}},KHR_materials_ior:{ior:{type:"number",get:(y,c,A)=>q(y,c,A).indexOfRefraction,getTarget:q,set:(y,c,A,l)=>q(c,A,l).indexOfRefraction=y}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(y,c,A)=>q(y,c,A).iridescence.JW,getTarget:q,set:(y,c,A,l)=>q(c,A,l).iridescence.JW=y},iridescenceIor:{type:"number",get:(y,c,A)=>q(y,c,A).iridescence.indexOfRefraction,getTarget:q,set:(y,c,A,l)=>q(c,A,l).iridescence.indexOfRefraction=y},iridescenceTexture:{extensions:{KHR_texture_transform:o("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(y,c,A)=>q(y,c,A).iridescence.maximumThickness,getTarget:q,set:(y,c,A,l)=>q(c,A,l).iridescence.maximumThickness=y},iridescenceThicknessMinimum:{type:"number",get:(y,c,A)=>q(y,c,A).iridescence.minimumThickness,getTarget:q,set:(y,c,A,l)=>q(c,A,l).iridescence.minimumThickness=y},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:o("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"dc",get:(y,c,A)=>q(y,c,A).sheen.color,getTarget:q,set:(y,c,A,l)=>q(c,A,l).sheen.color.p(y)},sheenColorTexture:{extensions:{KHR_texture_transform:o("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(y,c,A)=>q(y,c,A).sheen.JW,getTarget:q,set:(y,c,A,l)=>q(c,A,l).sheen.JW=y},sheenRoughnessTexture:{extensions:{KHR_texture_transform:o("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(y,c,A)=>q(y,c,A).metallicF0Factor,getTarget:q,set:(y,c,A,l)=>q(c,A,l).metallicF0Factor=y,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"dc",get:(y,c,A)=>q(y,c,A).metallicReflectanceColor,getTarget:q,set:(y,c,A,l)=>q(c,A,l).metallicReflectanceColor.p(y),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:o("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:o("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(y,c,A)=>q(y,c,A).subSurface.refractionIntensity,getTarget:q,set:(y,c,A,l)=>q(c,A,l).subSurface.refractionIntensity=y,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:o("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(y,c,A)=>q(y,c,A).subSurface.translucencyIntensity,getTarget:q,set:(y,c,A,l)=>q(c,A,l).subSurface.translucencyIntensity=y},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:o("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"dc",get:(y,c,A)=>q(y,c,A).subSurface.translucencyColor,getTarget:q,set:(y,c,A,l)=>{var w;return y&&(null===(w=q(c,A,l).subSurface.translucencyColor)||void 0===w?void 0:w.p(y))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:o("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"dc",get:(y,c,A)=>q(y,c,A).subSurface.tintColor,getTarget:q,set:(y,c,A,l)=>q(c,A,l).subSurface.tintColor.p(y)},attenuationDistance:{type:"number",get:(y,c,A)=>q(y,c,A).subSurface.tintColorAtDistance,getTarget:q,set:(y,c,A,l)=>q(c,A,l).subSurface.tintColorAtDistance=y},thicknessFactor:{type:"number",get:(y,c,A)=>q(y,c,A).subSurface.maximumThickness,getTarget:q,set:(y,c,A,l)=>q(c,A,l).subSurface.maximumThickness=y},thicknessTexture:{extensions:{KHR_texture_transform:o("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonLight)),getPropertyName:[y=>"length"]},__array__:{__target__:!0,color:{type:"dc",get:y=>{var c;return null===(c=y._babylonLight)||void 0===c?void 0:c.UW},set:(y,c)=>{var A;return null===(A=c._babylonLight)||void 0===A?void 0:A.UW.p(y)},getTarget:y=>y._babylonLight,getPropertyName:[y=>"diffuse"]},JW:{type:"number",get:y=>{var c;return null===(c=y._babylonLight)||void 0===c?void 0:c.JW},set:(y,c)=>c._babylonLight?c._babylonLight.JW=y:void 0,getTarget:y=>y._babylonLight,getPropertyName:[y=>"intensity"]},range:{type:"number",get:y=>{var c;return null===(c=y._babylonLight)||void 0===c?void 0:c.range},set:(y,c)=>c._babylonLight?c._babylonLight.range=y:void 0,getTarget:y=>y._babylonLight,getPropertyName:[y=>"range"]},spot:{innerConeAngle:{type:"number",get:y=>{var c;return null===(c=y._babylonLight)||void 0===c?void 0:c.innerAngle},set:(y,c)=>c._babylonLight?c._babylonLight.innerAngle=y:void 0,getTarget:y=>y._babylonLight,getPropertyName:[y=>"innerConeAngle"]},outerConeAngle:{type:"number",get:y=>{var c;return null===(c=y._babylonLight)||void 0===c?void 0:c.angle},set:(y,c)=>c._babylonLight?c._babylonLight.angle=y:void 0,getTarget:y=>y._babylonLight,getPropertyName:[y=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonLight)),getPropertyName:[y=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonTexture)),getPropertyName:[y=>"length"]},__array__:{__target__:!0,JW:{type:"number",get:y=>{var c;return null===(c=y._babylonTexture)||void 0===c?void 0:c.level},set:(y,c)=>{c._babylonTexture&&(c._babylonTexture.level=y)},getTarget:y=>y._babylonTexture},rotation:{type:"Quaternion",get:y=>{var c;return y._babylonTexture&&l.Quaternion.FromRotationMatrix(null===(c=y._babylonTexture)||void 0===c?void 0:c.getReflectionTextureMatrix())},set:(y,c)=>{var A;c._babylonTexture&&(null!==(A=c._babylonTexture.mc())&&void 0!==A&&A.useRightHandedSystem||(y=l.Quaternion.Inverse(y)),l.Matrix.FromQuaternionToRef(y,c._babylonTexture.getReflectionTextureMatrix()))},getTarget:y=>y._babylonTexture}}}}},animations:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>y._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:y=>y.length,getTarget:y=>y.map((y=>{var c;return null===(c=y.primitives[0]._instanceData)||void 0===c?void 0:c.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function L(y){return new h(y,O)}function i(y){const c=y.split("/").map((y=>y.replace(/{}/g,"__array__")));let A=O;for(const l of c)l&&(A=A[l]);if(A&&A.type&&A.get)return A}function H(y,c){const A=y.split("/").map((y=>y.replace(/{}/g,"__array__")));let l=O;for(const w of A)w&&(l=l[w]);l&&l.type&&l.get&&(l.interpolation=c)}function P(y,c){const A=y.split("/").map((y=>y.replace(/{}/g,"__array__")));let l=O;for(const w of A)if(w){if(!l[w]){if("?"===w){l.__ignoreObjectTree__=!0;continue}l[w]={},"__array__"===w&&(l[w].__target__=!0)}l=l[w]}Object.assign(l,c)}},13943:(y,c,A)=>{"use strict";A.r(c),A.d(c,{AnimationPropertyInfo:()=>I,TransformNodeAnimationPropertyInfo:()=>q,WeightAnimationPropertyInfo:()=>o,getQuaternion:()=>W,getVector3:()=>p,getWeights:()=>h});var l=A(12845),w=A(12325),N=A(13928);function p(y,c,A,l){return w.gc.yA(c,A).scaleInPlace(l)}function W(y,c,A,l){return w.Quaternion.yA(c,A).scaleInPlace(l)}function h(y,c,A,l){const w=new Array(y._numMorphTargets);for(let N=0;N<w.length;N++)w[N]=c[A++]*l;return w}class I{constructor(y,c,A,l){this.type=y,this.name=c,this.getValue=A,this.getStride=l}_buildAnimation(y,c,A){const w=new l.b(y,this.name,c,this.type);return w.setKeys(A),w}}class q extends I{buildAnimations(y,c,A,l){const w=[];return w.push({babylonAnimatable:y._babylonTransformNode,babylonAnimation:this._buildAnimation(c,A,l)}),w}}class o extends I{buildAnimations(y,c,A,w){const N=[];if(y._numMorphTargets)for(let p=0;p<y._numMorphTargets;p++){const W=new l.b(`${c}_${p}`,this.name,A,this.type);if(W.setKeys(w.map((y=>({frame:y.frame,inTangent:y.inTangent?y.inTangent[p]:void 0,value:y.value[p],outTangent:y.outTangent?y.outTangent[p]:void 0,interpolation:y.interpolation})))),y._primitiveBabylonMeshes)for(const c of y._primitiveBabylonMeshes)if(c.morphTargetManager){const y=c.morphTargetManager.getTarget(p),A=W.clone();y.animations.push(A),N.push({babylonAnimatable:y,babylonAnimation:A})}}return N}}(0,N.k)("/nodes/{}/translation",[new q(l.b.ANIMATIONTYPE_VECTOR3,"position",p,(()=>3))]),(0,N.k)("/nodes/{}/rotation",[new q(l.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",W,(()=>4))]),(0,N.k)("/nodes/{}/scale",[new q(l.b.ANIMATIONTYPE_VECTOR3,"bc",p,(()=>3))]),(0,N.k)("/nodes/{}/weights",[new o(l.b.ANIMATIONTYPE_FLOAT,"influence",h,(y=>y._numMorphTargets))])},13896:(y,c,A)=>{"use strict";class l{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((y,c)=>{this._resolve=y,this._reject=c}))}}var w=A(12325),N=A(12375),p=A(12144),W=A(12775),h=A(13902),I=A(13917),q=A(12153),o=A(12793),O=A(12845),L=A(12847),i=A(12184),H=A(12161),P=A(12167);class D{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(y){this._useTextureToStoreBoneMatrices=y,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(y){this._animationPropertiesOverride=y}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(y,c,A){this.name=y,this.id=c,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=w.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new q.d,this.bones=[],this._scene=A||i.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const l=this._scene.getEngine().getCaps();this._canUseTextureForBones=l.textureFloat&&l.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((y=>!y.getParent()))}getTransformMatrices(y){if(this.needInitialSkinMatrix){if(!y)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return y._bonesTransformMatrices||this.prepare(!0),y._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(y){return this.needInitialSkinMatrix&&y._transformMatrixTexture?y._transformMatrixTexture:this._transformMatrixTexture}mc(){return this._scene}toString(y){let c=`Name: ${this.name}, nBones: ${this.bones.length}`;if(c+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,y){c+=", Ranges: {";let y=!0;for(const A in this._ranges)y&&(c+=", ",y=!1),c+=A;c+="}"}return c}getBoneIndexByName(y){for(let c=0,A=this.bones.length;c<A;c++)if(this.bones[c].name===y)return c;return-1}createAnimationRange(y,c,A){if(!this._ranges[y]){this._ranges[y]=new L.b(y,c,A);for(let l=0,w=this.bones.length;l<w;l++)this.bones[l].animations[0]&&this.bones[l].animations[0].createRange(y,c,A)}}deleteAnimationRange(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let A=0,l=this.bones.length;A<l;A++)this.bones[A].animations[0]&&this.bones[A].animations[0].deleteRange(y,c);this._ranges[y]=null}getAnimationRange(y){return this._ranges[y]||null}getAnimationRanges(){const y=[];let c;for(c in this._ranges)y.push(this._ranges[c]);return y}copyAnimationRange(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[c]||!y.getAnimationRange(c))return!1;let l=!0;const w=this._getHighestAnimationFrame()+1,N={},p=y.bones;let W,h;for(h=0,W=p.length;h<W;h++)N[p[h].name]=p[h];this.bones.length!==p.length&&(H.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${p.length}`),l=!1);const I=A&&this.dimensionsAtRest&&y.dimensionsAtRest?this.dimensionsAtRest.divide(y.dimensionsAtRest):null;for(h=0,W=this.bones.length;h<W;h++){const y=this.bones[h].name,p=N[y];p?l=l&&this.bones[h].copyAnimationRange(p,c,w,A,I):(H.c.Warn("copyAnimationRange: not same rig, missing source bone "+y),l=!1)}const q=y.getAnimationRange(c);return q&&(this._ranges[c]=new L.b(c,q.from+w,q.to+w)),l}returnToRest(){for(const y of this.bones)-1!==y._index&&y.returnToRest()}_getHighestAnimationFrame(){let y=0;for(let c=0,A=this.bones.length;c<A;c++)if(this.bones[c].animations[0]){const A=this.bones[c].animations[0].getHighestFrame();y<A&&(y=A)}return y}beginAnimation(y,c,A,l){const w=this.getAnimationRange(y);return w?this._scene.beginAnimation(this,w.from,w.to,c,A,l):null}static MakeAnimationAdditive(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;const l=y.getAnimationRange(A);if(!l)return null;const w=y._scene.getAllAnimatablesByTarget(y);let N=null;for(let W=0;W<w.length;W++){const y=w[W];if(y.fromFrame===(null===l||void 0===l?void 0:l.from)&&y.toFrame===(null===l||void 0===l?void 0:l.to)){N=y;break}}const p=y.getAnimatables();for(let W=0;W<p.length;W++){const y=p[W].animations;if(y)for(let l=0;l<y.length;l++)O.b.MakeAnimationAdditive(y[l],c,A)}return N&&(N.isAdditive=!0),y}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(y){this._meshesWithPoseMatrix.push(y)}_unregisterMeshWithPoseMatrix(y){const c=this._meshesWithPoseMatrix.indexOf(y);c>-1&&this._meshesWithPoseMatrix.splice(c,1)}_computeTransformMatrices(y,c){this.onBeforeComputeObservable.notifyObservers(this);for(let A=0;A<this.bones.length;A++){const l=this.bones[A];l._childUpdateId++;const w=l.getParent();if(w?l.getLocalMatrix().multiplyToRef(w.getFinalMatrix(),l.getFinalMatrix()):c?l.getLocalMatrix().multiplyToRef(c,l.getFinalMatrix()):l.getFinalMatrix().p(l.getLocalMatrix()),-1!==l._index){const c=null===l._index?A:l._index;l.getAbsoluteInverseBindMatrix().multiplyToArray(l.getFinalMatrix(),y,16*c)}}this._identity.copyToArray(y,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const y=this.mc().getRenderId();if(this._currentRenderId===y)return;this._currentRenderId=y}if(this._numBonesWithLinkedTransformNode>0)for(const y of this.bones)if(y._linkedTransformNode){const c=y._linkedTransformNode;y.position=c.position,c.rotationQuaternion?y.rotationQuaternion=c.rotationQuaternion:y.rotation=c.rotation,y.bc=c.bc}if(this.needInitialSkinMatrix)for(const y of this._meshesWithPoseMatrix){const c=y.getPoseMatrix();let A=this._isDirty;if(y._bonesTransformMatrices&&y._bonesTransformMatrices.length===16*(this.bones.length+1)||(y._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),A=!0),A){if(this._synchronizedWithMesh!==y){this._synchronizedWithMesh=y;for(const y of this.bones)if(!y.getParent()){y.getBindMatrix().multiplyToRef(c,w.TmpVectors.Matrix[1]),y._updateAbsoluteBindMatrices(w.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const c=4*(this.bones.length+1);y._transformMatrixTexture&&y._transformMatrixTexture.getSize().width===c||(y._transformMatrixTexture&&y._transformMatrixTexture.dispose(),y._transformMatrixTexture=o.b.CreateRGBATexture(y._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(y._bonesTransformMatrices,c),this.isUsingTextureForMatrices&&y._transformMatrixTexture&&y._transformMatrixTexture.update(y._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=o.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let y=0;y<this.bones.length;y++)this._animatables.push(this.bones[y])}return this._animatables}clone(y,c){const A=new D(y,c||y,this._scene);A.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let l=0;l<this.bones.length;l++){const y=this.bones[l];let c=null;const w=y.getParent();if(w){const y=this.bones.indexOf(w);c=A.bones[y]}const N=new I.d(y.name,A,c,y.getBindMatrix().clone(),y.getRestMatrix().clone());N._index=y._index,y._linkedTransformNode&&N.linkTransformNode(y._linkedTransformNode),P.e.DeepCopy(y.animations,N.animations)}if(this._ranges){A._ranges={};for(const y in this._ranges){const c=this._ranges[y];c&&(A._ranges[y]=c.clone())}}return this._isDirty=!0,A.prepare(!0),A}enableBlending(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const c of this.bones)for(const A of c.animations)A.enableBlending=!0,A.blendingSpeed=y}dispose(){if(this._meshesWithPoseMatrix.length=0,this.mc().stopAnimation(this),this.mc().removeSkeleton(this),this._parentContainer){const y=this._parentContainer.skeletons.indexOf(this);y>-1&&this._parentContainer.skeletons.splice(y,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const y={};y.name=this.name,y.id=this.id,this.dimensionsAtRest&&(y.dimensionsAtRest=this.dimensionsAtRest.fc()),y.bones=[],y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let A=0;A<this.bones.length;A++){var c;const l=this.bones[A],w=l.getParent(),N={parentBoneIndex:w?this.bones.indexOf(w):-1,index:l.getIndex(),name:l.name,id:l.id,matrix:l.getBindMatrix().fc(),rest:l.getRestMatrix().fc(),linkedTransformNodeId:null===(c=l.getTransformNode())||void 0===c?void 0:c.id};y.bones.push(N),l.length&&(N.length=l.length),l.metadata&&(N.metadata=l.metadata),l.animations&&l.animations.length>0&&(N.animation=l.animations[0].serialize()),y.ranges=[];for(const c in this._ranges){const A=this._ranges[c];if(!A)continue;const l={};l.name=c,l.from=A.from,l.to=A.to,y.ranges.push(l)}}return y}static Parse(y,c){const A=new D(y.name,y.id,c);let l;for(y.dimensionsAtRest&&(A.dimensionsAtRest=w.gc.yA(y.dimensionsAtRest)),A.needInitialSkinMatrix=y.needInitialSkinMatrix,l=0;l<y.bones.length;l++){const c=y.bones[l],N=y.bones[l].index;let p=null;c.parentBoneIndex>-1&&(p=A.bones[c.parentBoneIndex]);const W=c.rest?w.Matrix.yA(c.rest):null,h=new I.d(c.name,A,p,w.Matrix.yA(c.matrix),W,null,N);void 0!==c.id&&null!==c.id&&(h.id=c.id),c.length&&(h.length=c.length),c.metadata&&(h.metadata=c.metadata),c.animation&&h.animations.push(O.b.Parse(c.animation)),void 0!==c.linkedTransformNodeId&&null!==c.linkedTransformNodeId&&(A._hasWaitingData=!0,h._waitingTransformNodeId=c.linkedTransformNodeId)}if(y.ranges)for(l=0;l<y.ranges.length;l++){const c=y.ranges[l];A.createAnimationRange(c.name,c.from,c.to)}return A}computeAbsoluteMatrices(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||y)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(y)}getPoseMatrix(){let y=null;return this._meshesWithPoseMatrix.length>0&&(y=this._meshesWithPoseMatrix[0].getPoseMatrix()),y}sortBones(){const y=[],c=new Array(this.bones.length);for(let A=0;A<this.bones.length;A++)this._sortBones(A,y,c);this.bones=y}_sortBones(y,c,A){if(A[y])return;A[y]=!0;const l=this.bones[y];if(!l)return;void 0===l._index&&(l._index=y);const w=l.getParent();w&&this._sortBones(this.bones.indexOf(w),c,A),c.push(l)}setCurrentPoseAsRest(){for(const y of this.bones)y.setCurrentPoseAsRest()}}var t=A(12632),s=A(12808),B=A(12303),X=A(12737),C=A(12400),K=A(12783),my=A(12752),T=A(12773),z=A(12852),S=A(12419),M=A(13860);class k{set areUpdatesFrozen(y){y?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new S.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,y||(y=i.c.LastCreatedScene),this._scene=y,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const y=this._scene.getEngine().getCaps();this._canUseTextureForTargets=y.canUseGLVertexID&&y.textureFloat&&y.maxVertexTextureImageUnits>0&&y.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return k.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?k.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(y){this._numMaxInfluencers!==y&&(this._numMaxInfluencers=y,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(y){this._useTextureToStoreTargets!==y&&(this._useTextureToStoreTargets=y,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var y;return k.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(y=this._scene)&&void 0!==y&&y.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(y){return this._activeTargets.data[y]}getTarget(y){return this._targets[y]}getTargetByName(y){for(const c of this._targets)if(c.name===y)return c;return null}addTarget(y){this._targets.push(y),this._targetInfluenceChangedObservers.push(y.onInfluenceChanged.add((y=>{this.areUpdatesFrozen&&y&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(y)}))),this._targetDataLayoutChangedObservers.push(y._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(y){const c=this._targets.indexOf(y);c>=0&&(this._targets.splice(c,1),y.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(c,1)[0]),y._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(c,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(y)}_bind(y){y.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),y.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),y.setTexture("morphTargets",this._targetStoreTexture),y.setInt("morphTargetCount",this.numInfluencers)}clone(){const y=new k(this._scene);for(const c of this._targets)y.addTarget(c.clone());return y.enablePositionMorphing=this.enablePositionMorphing,y.enableNormalMorphing=this.enableNormalMorphing,y.enableTangentMorphing=this.enableTangentMorphing,y.enableUVMorphing=this.enableUVMorphing,y.enableUV2Morphing=this.enableUV2Morphing,y.enableColorMorphing=this.enableColorMorphing,y}serialize(){const y={};y.id=this.uniqueId,y.targets=[];for(const c of this._targets)y.targets.push(c.serialize());return y}_syncActiveTargets(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const c=!!this._targetStoreTexture,A=this.isUsingTextureForTargets;(this._mustSynchronize||c!==A)&&(this._mustSynchronize=!1,this.synchronize());let l=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let w=-1;for(const N of this._targets)if(w++,0!==N.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=k.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(N),this._morphTargetTextureIndices[l]=w,this._tempInfluences[l++]=N.influence}this._morphTargetTextureIndices.length!==l&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,l)),this._influences&&this._influences.length===l||(this._influences=new Float32Array(l));for(let N=0;N<l;N++)this._influences[N]=this._tempInfluences[N];if(y&&this._scene)for(const N of this._scene.meshes)N.morphTargetManager===this&&(A?N._markSubMeshesAsAttributesDirty():N._syncGeometryWithMorphTargetManager())}synchronize(){var y;if(!this._scene||this.areUpdatesFrozen)return;const c=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(y=this._targetStoreTexture)||void 0===y||y.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>c.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const A of this._targets){this._supportsPositions=this._supportsPositions&&A.hasPositions,this._supportsNormals=this._supportsNormals&&A.hasNormals,this._supportsTangents=this._supportsTangents&&A.hasTangents,this._supportsUVs=this._supportsUVs&&A.hasUVs,this._supportsUV2s=this._supportsUV2s&&A.hasUV2s,this._supportsColors=this._supportsColors&&A.hasColors;const y=A.vertexCount;if(0===this._vertexCount)this._vertexCount=y;else if(this._vertexCount!==y)return void H.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${A.name}": ${y}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const y=c.getCaps().maxTextureSize;this._textureWidth>y&&(this._textureHeight=Math.ceil(this._textureWidth/y),this._textureWidth=y);const A=this._targets.length,l=new Float32Array(A*this._textureWidth*this._textureHeight*4);let w=0;for(let c=0;c<A;c++){const y=this._targets[c],A=y.getPositions(),N=y.getNormals(),p=y.getUVs(),W=y.getTangents(),h=y.getUV2s(),I=y.getColors();w=c*this._textureWidth*this._textureHeight*4;for(let c=0;c<this._vertexCount;c++)this._supportsPositions&&A&&(l[w]=A[3*c],l[w+1]=A[3*c+1],l[w+2]=A[3*c+2],w+=4),this._supportsNormals&&N&&(l[w]=N[3*c],l[w+1]=N[3*c+1],l[w+2]=N[3*c+2],w+=4),this._supportsUVs&&p&&(l[w]=p[2*c],l[w+1]=p[2*c+1],w+=4),this._supportsTangents&&W&&(l[w]=W[3*c],l[w+1]=W[3*c+1],l[w+2]=W[3*c+2],w+=4),this._supportsUV2s&&h&&(l[w]=h[2*c],l[w+1]=h[2*c+1],w+=4),this._supportsColors&&I&&(l[w]=I[4*c],l[w+1]=I[4*c+1],l[w+2]=I[4*c+2],l[w+3]=I[4*c+3],w+=4)}this._targetStoreTexture=M.d.CreateRGBATexture(l,this._textureWidth,this._textureHeight,A,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const A of this._scene.meshes)A.morphTargetManager===this&&A._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const y=this._parentContainer.morphTargetManagers.indexOf(this);y>-1&&this._parentContainer.morphTargetManagers.splice(y,1),this._parentContainer=null}for(const y of this._targets)this._scene.stopAnimation(y)}}static Parse(y,c){const A=new k(c);for(const l of y.targets)A.addTarget(z.b.Parse(l,c));return A}}k.EnableTextureStorage=!0,k.MaxActiveMorphTargetsInVertexAttributeMode=8,k.ConstantTargetCountForTextureMode=0;var a=A(13921),u=A(12191),G=A(12654);const j=new Map,f=j;function V(y,c,A){J(y)&&H.c.Warn(`Extension with the name '${y}' already exists`),j.set(y,{isGLTFExtension:c,factory:A})}function J(y){return j.delete(y)}var U=A(13928),e=A(12913),Q=A(12410);class Y{static Get(y,c,A){if(!c||void 0==A||!c[A])throw new Error(`${y}: Failed to find index (${A})`);return c[A]}static TryGet(y,c){return y&&void 0!=c&&y[c]?y[c]:null}static Assign(y){if(y)for(let c=0;c<y.length;c++)y[c].index=c}}function g(y){if(y.min&&y.max){const c=y.min,A=y.max,l=w.TmpVectors.gc[0].Ec(c[0],c[1],c[2]),N=w.TmpVectors.gc[1].Ec(A[0],A[1],A[2]);if(y.normalized&&5126!==y.componentType){let c=1;switch(y.componentType){case 5120:c=127;break;case 5121:c=255;break;case 5122:c=32767;break;case 5123:c=65535}const A=1/c;l.scaleInPlace(A),N.scaleInPlace(A)}return new G.d(l,N)}return null}class x{static RegisterExtension(y,c){V(y,!1,c)}static UnregisterExtension(y){return J(y)}get uc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(y){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=y}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((y=>y.dispose&&y.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(y,c,A,l,w,N){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=c,this._assetContainer=A,this._loadData(l);let N=null;if(y){const c={};if(this._gltf.nodes)for(const y of this._gltf.nodes)y.name&&(c[y.name]=y.index);N=(y instanceof Array?y:[y]).map((y=>{const A=c[y];if(void 0===A)throw new Error(`Failed to find node '${y}'`);return A}))}return await this._loadAsync(w,p,N,(()=>({meshes:this._getMeshes(),MO:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=y,this._loadData(c),await this._loadAsync(A,w,null,(()=>{}))}async _loadAsync(y,c,A,l){return await Promise.resolve().then((async()=>{this._rootUrl=y,this._uniqueRootUrl=!y.startsWith("file:")&&c?y:`${y}${Date.now()}/`,this._fileName=c,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const w=`${a.k[a.k.LOADING]} => ${a.k[a.k.READY]}`,N=`${a.k[a.k.LOADING]} => ${a.k[a.k.COMPLETE]}`;this._parent._startPerformanceCounter(w),this._parent._startPerformanceCounter(N),this._parent._setState(a.k.LOADING),this._extensionsOnLoading();const W=new Array;if(!this.parent.loadOnlyMaterials)if(A)W.push(this.loadSceneAsync("/nodes",{nodes:A,index:-1}));else if(void 0!=this._gltf.Fc||this._gltf.scenes&&this._gltf.scenes[0]){const y=Y.Get("/scene",this._gltf.scenes,this._gltf.Fc||0);W.push(this.loadSceneAsync(`/scenes/${y.index}`,y))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let y=0;y<this._gltf.materials.length;++y){const c=this._gltf.materials[y],A="/materials/"+y,l=t.c.TriangleFillMode;W.push(this._loadMaterialAsync(A,c,null,l,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&W.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&W.push(this._compileShadowGeneratorsAsync());const h=Promise.all(W).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ph(!0);for(const y of this._babylonScene.materials){const c=y;void 0!==c.maxSimultaneousLights&&(c.maxSimultaneousLights=Math.max(c.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(a.k.READY),this._skipStartAnimationStep||this._startAnimations(),l()}));return await h.then((y=>(this._parent._endPerformanceCounter(w),p.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(N),this._parent._setState(a.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(y=>{this._parent.onErrorObservable.notifyObservers(y),this._parent.onErrorObservable.clear(),this.dispose()}))})),y)))})).catch((y=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(y),this._parent.onErrorObservable.clear(),this.dispose()),y}))}_loadData(y){if(this._gltf=y.json,this._setupData(),y.bin){const c=this._gltf.buffers;if(c&&c[0]&&!c[0].uri){const A=c[0];(A.byteLength<y.bin.byteLength-3||A.byteLength>y.bin.byteLength)&&H.c.Warn(`Binary buffer length (${A.byteLength}) from JSON does not match chunk length (${y.bin.byteLength})`),this._bin=y.bin}else H.c.Warn("Unexpected BIN chunk")}}_setupData(){if(Y.Assign(this._gltf.accessors),Y.Assign(this._gltf.animations),Y.Assign(this._gltf.buffers),Y.Assign(this._gltf.bufferViews),Y.Assign(this._gltf.cameras),Y.Assign(this._gltf.images),Y.Assign(this._gltf.materials),Y.Assign(this._gltf.meshes),Y.Assign(this._gltf.nodes),Y.Assign(this._gltf.samplers),Y.Assign(this._gltf.scenes),Y.Assign(this._gltf.skins),Y.Assign(this._gltf.textures),this._gltf.nodes){const y={};for(const A of this._gltf.nodes)if(A.children)for(const c of A.children)y[c]=A.index;const c=this._createRootNode();for(const A of this._gltf.nodes){const l=y[A.index];A.parent=void 0===l?c:this._gltf.nodes[l]}}}async _loadExtensionsAsync(){const y=[];if(f.forEach(((c,A)=>{var l;!1===(null===(l=this.parent.extensionOptions[A])||void 0===l?void 0:l.enabled)?c.isGLTFExtension&&this.isExtensionUsed(A)&&H.c.Warn(`Extension ${A} is used but has been explicitly disabled.`):c.isGLTFExtension&&!this.isExtensionUsed(A)||y.push((async()=>{const y=await c.factory(this);return y.name!==A&&H.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${y.name} !== ${A}`),this._parent.onExtensionLoadedObservable.notifyObservers(y),y})())})),this._extensions.push(...await Promise.all(y)),this._extensions.sort(((y,c)=>(y.order||Number.MAX_VALUE)-(c.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const A of this._gltf.extensionsRequired){if(!this._extensions.some((y=>y.name===A&&y.enabled))){var c;if(!1===(null===(c=this.parent.extensionOptions[A])||void 0===c?void 0:c.enabled))throw new Error(`Required extension ${A} is disabled`);throw new Error(`Required extension ${A} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new T.b("__root__",this._babylonScene);this._rootBabylonMesh=y,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ph(!1);const c={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case a.h.AUTO:this._babylonScene.useRightHandedSystem||(c.rotation=[0,1,0,0],c.scale=[1,1,-1],x._LoadTransform(c,this._rootBabylonMesh));break;case a.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(y),c}loadSceneAsync(y,c){const A=this._extensionsLoadSceneAsync(y,c);if(A)return A;const l=new Array;if(this.logOpen(`${y} ${c.name||""}`),c.nodes)for(const w of c.nodes){const c=Y.Get(`${y}/nodes/${w}`,this._gltf.nodes,w);l.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(y=>{y.parent=this._rootBabylonMesh})))}for(const w of this._postSceneLoadActions)w();return l.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(l).then((()=>{}))}_forEachPrimitive(y,c){if(y._primitiveBabylonMeshes)for(const A of y._primitiveBabylonMeshes)c(A)}_getGeometries(){const y=[],c=this._gltf.nodes;if(c)for(const A of c)this._forEachPrimitive(A,(c=>{const A=c.Rc;A&&-1===y.indexOf(A)&&y.push(A)}));return y}_getMeshes(){const y=[];this._rootBabylonMesh instanceof my.c&&y.push(this._rootBabylonMesh);const c=this._gltf.nodes;if(c)for(const A of c)this._forEachPrimitive(A,(c=>{y.push(c)}));return y}_getTransformNodes(){const y=[],c=this._gltf.nodes;if(c)for(const A of c)A._babylonTransformNode&&"Nh"===A._babylonTransformNode.getClassName()&&y.push(A._babylonTransformNode),A._babylonTransformNodeForSkin&&y.push(A._babylonTransformNodeForSkin);return y}_getSkeletons(){const y=[],c=this._gltf.skins;if(c)for(const A of c)A._data&&y.push(A._data.babylonSkeleton);return y}_getAnimationGroups(){const y=[],c=this._gltf.animations;if(c)for(const A of c)A._babylonAnimationGroup&&y.push(A._babylonAnimationGroup);return y}_startAnimations(){switch(this._parent.animationStartMode){case a.f.NONE:break;case a.f.FIRST:{const y=this._getAnimationGroups();0!==y.length&&y[0].start(!0);break}case a.f.ALL:{const y=this._getAnimationGroups();for(const c of y)c.start(!0);break}default:return void H.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadNodeAsync(y,c,A);if(l)return l;if(c._babylonTransformNode)throw new Error(`${y}: Invalid recursive node hierarchy`);const w=new Array;this.logOpen(`${y} ${c.name||""}`);const N=l=>{if(x.AddPointerMetadata(l,y),x._LoadTransform(c,l),void 0!=c.camera){const A=Y.Get(`${y}/camera`,this._gltf.cameras,c.camera);w.push(this.loadCameraAsync(`/cameras/${A.index}`,A,(y=>{y.parent=l,this._babylonScene.useRightHandedSystem||(l.bc.x=-1)})))}if(c.children)for(const A of c.children){const c=Y.Get(`${y}/children/${A}`,this._gltf.nodes,A);w.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(y=>{y.parent=l})))}A(l)},p=void 0!=c.mesh,W=this._parent.loadSkins&&void 0!=c.skin;if(!p||W){const y=c.name||`node${c.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new X.d(y,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==c.mesh?c._babylonTransformNode=A:c._babylonTransformNodeForSkin=A,N(A)}if(p)if(W){const A=Y.Get(`${y}/mesh`,this._gltf.meshes,c.mesh);w.push(this._loadMeshAsync(`/meshes/${A.index}`,c,A,(A=>{const l=c._babylonTransformNodeForSkin;A.metadata=(0,e.d)(l.metadata,A.metadata||{});const N=Y.Get(`${y}/skin`,this._gltf.skins,c.skin);w.push(this._loadSkinAsync(`/skins/${N.index}`,c,N,(y=>{this._forEachPrimitive(c,(c=>{c.skeleton=y})),this._postSceneLoadActions.push((()=>{if(void 0!=N.skeleton){const y=Y.Get(`/skins/${N.index}/skeleton`,this._gltf.nodes,N.skeleton).parent;c.index===y.index?A.parent=l.parent:A.parent=y._babylonTransformNode}else A.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:l,skinnedNode:A})}))})))})))}else{const A=Y.Get(`${y}/mesh`,this._gltf.meshes,c.mesh);w.push(this._loadMeshAsync(`/meshes/${A.index}`,c,A,N))}return this.logClose(),Promise.all(w).then((()=>(this._forEachPrimitive(c,(y=>{const c=y;!c.isAnInstance&&c.Rc&&c.Rc.useBoundingInfoFromGeometry?y.Vy():y.refreshBoundingInfo(!0,!0)})),c._babylonTransformNode)))}_loadMeshAsync(y,c,A,l){const w=A.primitives;if(!w||!w.length)throw new Error(`${y}: Primitives are missing`);void 0==w[0].index&&Y.Assign(w);const N=new Array;this.logOpen(`${y} ${A.name||""}`);const p=c.name||`node${c.index}`;if(1===w.length){const l=A.primitives[0];N.push(this._loadMeshPrimitiveAsync(`${y}/primitives/${l.index}`,p,c,A,l,(y=>{c._babylonTransformNode=y,c._primitiveBabylonMeshes=[y]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,c._babylonTransformNode=new X.d(p,this._babylonScene),c._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._primitiveBabylonMeshes=[];for(const l of w)N.push(this._loadMeshPrimitiveAsync(`${y}/primitives/${l.index}`,`${p}_primitive${l.index}`,c,A,l,(y=>{y.parent=c._babylonTransformNode,c._primitiveBabylonMeshes.push(y)})))}return l(c._babylonTransformNode),this.logClose(),Promise.all(N).then((()=>c._babylonTransformNode))}_loadMeshPrimitiveAsync(y,c,A,l,w,N){const p=this._extensionsLoadMeshPrimitiveAsync(y,c,A,l,w,N);if(p)return p;this.logOpen(`${y}`);const W=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==A.skin&&!l.primitives[0].targets;let h,I;if(W&&w._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,h=w._instanceData.babylonSourceMesh.createInstance(c),h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I=w._instanceData.promise;else{const N=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new T.b(c,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.sideOrientation=this._babylonScene.useRightHandedSystem?t.c.CounterClockWiseSideOrientation:t.c.ClockWiseSideOrientation,this._createMorphTargets(y,A,l,w,p),N.push(this._loadVertexDataAsync(y,w,p).then((async c=>await this._loadMorphTargetsAsync(y,w,p,c).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,c.Gy(p),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const q=x._GetDrawMode(y,w.mode);if(void 0==w.material){let y=this._defaultBabylonMaterialData[q];y||(y=this._createDefaultMaterial("__GLTFLoader._default",q),this._parent.onMaterialLoadedObservable.notifyObservers(y),this._defaultBabylonMaterialData[q]=y),p.material=y}else if(!this.parent.skipMaterials){const c=Y.Get(`${y}/material`,this._gltf.materials,w.material);N.push(this._loadMaterialAsync(`/materials/${c.index}`,c,p,q,(y=>{p.material=y})))}I=Promise.all(N),W&&(w._instanceData={babylonSourceMesh:p,promise:I}),h=p}return x.AddPointerMetadata(h,y),this._parent.onMeshLoadedObservable.notifyObservers(h),N(h),this.logClose(),I.then((()=>h))}_loadVertexDataAsync(y,c,A){const l=this._extensionsLoadVertexDataAsync(y,c,A);if(l)return l;const w=c.attributes;if(!w)throw new Error(`${y}: Attributes are missing`);const N=new Array,p=new K.e(A.name,this._babylonScene);if(void 0==c.indices)A.isUnIndexed=!0;else{const A=Y.Get(`${y}/indices`,this._gltf.accessors,c.indices);N.push(this._loadIndicesAccessorAsync(`/accessors/${A.index}`,A).then((y=>{p.setIndices(y)})))}const W=(c,l,W)=>{if(void 0==w[c])return;A._delayInfo=A._delayInfo||[],-1===A._delayInfo.indexOf(l)&&A._delayInfo.push(l);const h=Y.Get(`${y}/attributes/${c}`,this._gltf.accessors,w[c]);N.push(this._loadVertexAccessorAsync(`/accessors/${h.index}`,h,l).then((y=>{if(y.getKind()===C.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!A.skeleton){const y=g(h);y&&(p._boundingInfo=y,p.useBoundingInfoFromGeometry=!0)}p.setVerticesBuffer(y,h.count)}))),l==C.e.MatricesIndicesExtraKind&&(A.numBoneInfluencers=8),W&&W(h)};return W("POSITION",C.e.PositionKind),W("NORMAL",C.e.NormalKind),W("TANGENT",C.e.TangentKind),W("TEXCOORD_0",C.e.UVKind),W("TEXCOORD_1",C.e.UV2Kind),W("TEXCOORD_2",C.e.UV3Kind),W("TEXCOORD_3",C.e.UV4Kind),W("TEXCOORD_4",C.e.UV5Kind),W("TEXCOORD_5",C.e.UV6Kind),W("JOINTS_0",C.e.MatricesIndicesKind),W("WEIGHTS_0",C.e.MatricesWeightsKind),W("JOINTS_1",C.e.MatricesIndicesExtraKind),W("WEIGHTS_1",C.e.MatricesWeightsExtraKind),W("COLOR_0",C.e.ColorKind,(y=>{"VEC4"===y.type&&(A.hasVertexAlpha=!0)})),Promise.all(N).then((()=>p))}_createMorphTargets(y,c,A,l,w){if(!l.targets||!this._parent.loadMorphTargets)return;if(void 0==c._numMorphTargets)c._numMorphTargets=l.targets.length;else if(l.targets.length!==c._numMorphTargets)throw new Error(`${y}: Primitives do not have the same number of targets`);const N=A.extras?A.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,w.morphTargetManager=new k(this._babylonScene),w.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.morphTargetManager.areUpdatesFrozen=!0;for(let p=0;p<l.targets.length;p++){const y=c.weights?c.weights[p]:A.weights?A.weights[p]:0,l=N?N[p]:`morphTarget${p}`;w.morphTargetManager.addTarget(new z.b(l,y,w.mc()))}}_loadMorphTargetsAsync(y,c,A,l){if(!c.targets||!this._parent.loadMorphTargets)return Promise.resolve();const w=new Array,N=A.morphTargetManager;for(let p=0;p<N.numTargets;p++){const A=N.getTarget(p);w.push(this._loadMorphTargetVertexDataAsync(`${y}/targets/${p}`,l,c.targets[p],A))}return Promise.all(w).then((()=>{N.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(y,c,A,l){const w=new Array,N=(l,N,p)=>{if(void 0==A[l])return;const W=c.getVertexBuffer(N);if(!W)return;const h=Y.Get(`${y}/${l}`,this._gltf.accessors,A[l]);w.push(this._loadFloatAccessorAsync(`/accessors/${h.index}`,h).then((y=>{p(W,y)})))};return N("POSITION",C.e.PositionKind,((y,c)=>{const A=new Float32Array(c.length);y.forEach(c.length,((y,l)=>{A[l]=c[l]+y})),l.setPositions(A)})),N("NORMAL",C.e.NormalKind,((y,c)=>{const A=new Float32Array(c.length);y.forEach(A.length,((y,l)=>{A[l]=c[l]+y})),l.setNormals(A)})),N("TANGENT",C.e.TangentKind,((y,c)=>{const A=new Float32Array(c.length/3*4);let w=0;y.forEach(c.length/3*4,((y,l)=>{(l+1)%4!==0&&(A[w]=c[w]+y,w++)})),l.setTangents(A)})),N("TEXCOORD_0",C.e.UVKind,((y,c)=>{const A=new Float32Array(c.length);y.forEach(c.length,((y,l)=>{A[l]=c[l]+y})),l.setUVs(A)})),N("TEXCOORD_1",C.e.UV2Kind,((y,c)=>{const A=new Float32Array(c.length);y.forEach(c.length,((y,l)=>{A[l]=c[l]+y})),l.setUV2s(A)})),N("COLOR_0",C.e.ColorKind,((c,A)=>{let w=null;const N=c.getSize();if(3===N){w=new Float32Array(A.length/3*4),c.forEach(A.length,((y,c)=>{const l=Math.floor(c/3),N=c%3;w[4*l+N]=A[3*l+N]+y}));for(let y=0;y<A.length/3;++y)w[4*y+3]=1}else{if(4!==N)throw new Error(`${y}: Invalid number of components (${N}) for COLOR_0 attribute`);w=new Float32Array(A.length),c.forEach(A.length,((y,c)=>{w[c]=A[c]+y}))}l.setColors(w)})),await Promise.all(w).then((()=>{}))}static _LoadTransform(y,c){if(void 0!=y.skin)return;let A=w.gc.Zero(),l=w.Quaternion.Identity(),N=w.gc.One();if(y.matrix){w.Matrix.yA(y.matrix).decompose(N,l,A)}else y.translation&&(A=w.gc.yA(y.translation)),y.rotation&&(l=w.Quaternion.yA(y.rotation)),y.scale&&(N=w.gc.yA(y.scale));c.position=A,c.rotationQuaternion=l,c.bc=N}_loadSkinAsync(y,c,A,l){if(!this._parent.loadSkins)return Promise.resolve();const w=this._extensionsLoadSkinAsync(y,c,A);if(w)return w;if(A._data)return l(A._data.babylonSkeleton),A._data.promise;const N=`skeleton${A.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new D(A.name||N,N,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(y,A,p);const W=this._loadSkinInverseBindMatricesDataAsync(y,A).then((y=>{this._updateBoneMatrices(p,y)}));return A._data={babylonSkeleton:p,promise:W},l(p),W}_loadBones(y,c,A){if(void 0==c.skeleton||this._parent.alwaysComputeSkeletonRootNode){const A=this._findSkeletonRootNode(`${y}/joints`,c.joints);if(A)if(void 0===c.skeleton)c.skeleton=A.index;else{const l=(y,c)=>{for(;c.parent;c=c.parent)if(c.parent===y)return!0;return!1},w=Y.Get(`${y}/skeleton`,this._gltf.nodes,c.skeleton);w===A||l(w,A)||(H.c.Warn(`${y}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),c.skeleton=A.index)}else H.c.Warn(`${y}: Failed to find common root`)}const l={};for(const w of c.joints){const N=Y.Get(`${y}/joints/${w}`,this._gltf.nodes,w);this._loadBone(N,c,A,l)}}_findSkeletonRootNode(y,c){if(0===c.length)return null;const A={};for(const w of c){const c=[];let l=Y.Get(`${y}/${w}`,this._gltf.nodes,w);for(;-1!==l.index;)c.unshift(l),l=l.parent;A[w]=c}let l=null;for(let w=0;;++w){let y=A[c[0]];if(w>=y.length)return l;const N=y[w];for(let p=1;p<c.length;++p)if(y=A[c[p]],w>=y.length||N!==y[w])return l;l=N}}_loadBone(y,c,A,l){y._isJoint=!0;let w=l[y.index];if(w)return w;let N=null;y.index!==c.skeleton&&(y.parent&&-1!==y.parent.index?N=this._loadBone(y.parent,c,A,l):void 0!==c.skeleton&&H.c.Warn(`/skins/${c.index}/skeleton: Skeleton node is not a common root`));const p=c.joints.indexOf(y.index);return w=new I.d(y.name||`joint${y.index}`,A,N,this._getNodeMatrix(y),null,null,p),l[y.index]=w,this._postSceneLoadActions.push((()=>{w.linkTransformNode(y._babylonTransformNode)})),w}_loadSkinInverseBindMatricesDataAsync(y,c){if(void 0==c.inverseBindMatrices)return Promise.resolve(null);const A=Y.Get(`${y}/inverseBindMatrices`,this._gltf.accessors,c.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${A.index}`,A)}_updateBoneMatrices(y,c){for(const A of y.bones){const y=w.Matrix.Identity(),l=A._index;c&&-1!==l&&(w.Matrix.FromArrayToRef(c,16*l,y),y.invertToRef(y));const N=A.getParent();N&&y.multiplyToRef(N.getAbsoluteInverseBindMatrix(),y),A.Qc(y,!1,!1),A._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(y){return y.matrix?w.Matrix.yA(y.matrix):w.Matrix.Compose(y.scale?w.gc.yA(y.scale):w.gc.One(),y.rotation?w.Quaternion.yA(y.rotation):w.Quaternion.Identity(),y.translation?w.gc.yA(y.translation):w.gc.Zero())}loadCameraAsync(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadCameraAsync(y,c,A);if(l)return l;const N=new Array;this.logOpen(`${y} ${c.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new h.b(c.name||`camera${c.index}`,w.gc.Zero(),this._babylonScene,!1);switch(p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonCamera=p,p.setTarget(new w.gc(0,0,-1)),c.type){case"perspective":{const A=c.perspective;if(!A)throw new Error(`${y}: Camera perspective properties are missing`);p.fov=A.yfov,p.ec=A.znear,p.maxZ=A.zfar||0;break}case"orthographic":if(!c.orthographic)throw new Error(`${y}: Camera orthographic properties are missing`);p.mode=W.c.ORTHOGRAPHIC_CAMERA,p.orthoLeft=-c.orthographic.xmag,p.orthoRight=c.orthographic.xmag,p.orthoBottom=-c.orthographic.ymag,p.orthoTop=c.orthographic.ymag,p.ec=c.orthographic.znear,p.maxZ=c.orthographic.zfar;break;default:throw new Error(`${y}: Invalid camera type (${c.type})`)}return x.AddPointerMetadata(p,y),this._parent.onCameraLoadedObservable.notifyObservers(p),A(p),this.logClose(),Promise.all(N).then((()=>p))}_loadAnimationsAsync(){const y=this._gltf.animations;if(!y)return Promise.resolve();const c=new Array;for(let A=0;A<y.length;A++){const l=y[A];c.push(this.loadAnimationAsync(`/animations/${l.index}`,l).then((y=>{0===y.targetedAnimations.length&&y.dispose()})))}return Promise.all(c).then((()=>{}))}loadAnimationAsync(y,c){const l=this._extensionsLoadAnimationAsync(y,c);return l||A.e(78).then(A.bind(A,15457)).then((A=>{let{AnimationGroup:l}=A;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new l(c.name||`animation${c.index}`,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonAnimationGroup=w;const N=new Array;Y.Assign(c.channels),Y.Assign(c.samplers);for(const p of c.channels)N.push(this._loadAnimationChannelAsync(`${y}/channels/${p.index}`,y,c,p,((y,c)=>{y.animations=y.animations||[],y.animations.push(c),w.addTargetedAnimation(c,y)})));return Promise.all(N).then((()=>(w.normalize(0),w)))}))}async _loadAnimationChannelAsync(y,c,l,w,N){const p=this._extensionsLoadAnimationChannelAsync(y,c,l,w,N);if(p)return await p;if(void 0==w.target.node)return await Promise.resolve();const W=Y.Get(`${y}/target/node`,this._gltf.nodes,w.target.node),h=w.target.path,I="weights"===h;if(I&&!W._numMorphTargets||!I&&!W._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!I&&!W._isJoint)return await Promise.resolve();let q;switch(await Promise.resolve().then(A.bind(A,13943)),h){case"translation":var o;q=null===(o=(0,U.g)("/nodes/{}/translation"))||void 0===o?void 0:o.interpolation;break;case"rotation":var O;q=null===(O=(0,U.g)("/nodes/{}/rotation"))||void 0===O?void 0:O.interpolation;break;case"scale":var L;q=null===(L=(0,U.g)("/nodes/{}/scale"))||void 0===L?void 0:L.interpolation;break;case"weights":var i;q=null===(i=(0,U.g)("/nodes/{}/weights"))||void 0===i?void 0:i.interpolation;break;default:throw new Error(`${y}/target/path: Invalid value (${w.target.path})`)}if(!q)throw new Error(`${y}/target/path: Could not find interpolation properties for target path (${w.target.path})`);const H={object:W,info:q};return await this._loadAnimationChannelFromTargetInfoAsync(y,c,l,w,H,N)}_loadAnimationChannelFromTargetInfoAsync(y,c,A,l,w,N){const p=this.parent.targetFps,W=1/p,h=Y.Get(`${y}/sampler`,A.samplers,l.sampler);return this._loadAnimationSamplerAsync(`${c}/samplers/${l.sampler}`,h).then((y=>{let c=0;const h=w.object,I=w.info;for(const w of I){const I=w.getStride(h),q=y.input,o=y.output,O=new Array(q.length);let L=0;switch(y.interpolation){case"STEP":for(let y=0;y<q.length;y++){const c=w.getValue(h,o,L,1);L+=I,O[y]={frame:q[y]*p,value:c,interpolation:1}}break;case"CUBICSPLINE":for(let y=0;y<q.length;y++){const c=w.getValue(h,o,L,W);L+=I;const A=w.getValue(h,o,L,1);L+=I;const l=w.getValue(h,o,L,W);L+=I,O[y]={frame:q[y]*p,inTangent:c,value:A,outTangent:l}}break;case"LINEAR":for(let y=0;y<q.length;y++){const c=w.getValue(h,o,L,1);L+=I,O[y]={frame:q[y]*p,value:c}}}if(L>0){const y=`${A.name||`animation${A.index}`}_channel${l.index}_${c}`,W=w.buildAnimations(h,y,p,O);for(const A of W)c++,N(A.babylonAnimatable,A.babylonAnimation)}}}))}_loadAnimationSamplerAsync(y,c){if(c._data)return c._data;const A=c.interpolation||"LINEAR";switch(A){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${y}/interpolation: Invalid value (${c.interpolation})`)}const l=Y.Get(`${y}/input`,this._gltf.accessors,c.input),w=Y.Get(`${y}/output`,this._gltf.accessors,c.output);return c._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${l.index}`,l),this._loadFloatAccessorAsync(`/accessors/${w.index}`,w)]).then((y=>{let[c,l]=y;return{input:c,interpolation:A,output:l}})),c._data}loadBufferAsync(y,c,A,l){const w=this._extensionsLoadBufferAsync(y,c,A,l);if(w)return w;if(!c._data)if(c.uri)c._data=this.loadUriAsync(`${y}/uri`,c,c.uri);else{if(!this._bin)throw new Error(`${y}: Uri is missing or the binary glTF is missing its binary chunk`);c._data=this._bin.readAsync(0,c.byteLength)}return c._data.then((c=>{try{return new Uint8Array(c.buffer,c.byteOffset+A,l)}catch(w){throw new Error(`${y}: ${w.message}`)}}))}loadBufferViewAsync(y,c){const A=this._extensionsLoadBufferViewAsync(y,c);if(A)return A;if(c._data)return c._data;const l=Y.Get(`${y}/buffer`,this._gltf.buffers,c.buffer);return c._data=this.loadBufferAsync(`/buffers/${l.index}`,l,c.byteOffset||0,c.byteLength),c._data}_loadAccessorAsync(y,c,A){if(c._data)return c._data;const l=x._GetNumComponents(y,c.type),w=l*C.e.GetTypeByteLength(c.componentType),N=l*c.count;if(void 0==c.bufferView)c._data=Promise.resolve(new A(N));else{const p=Y.Get(`${y}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((W=>{if(5126!==c.componentType||c.normalized||p.byteStride&&p.byteStride!==w){const y=new A(N);return C.e.ForEach(W,c.byteOffset||0,p.byteStride||w,l,c.componentType,y.length,c.normalized||!1,((c,A)=>{y[A]=c})),y}return x._GetTypedArray(y,c.componentType,W,c.byteOffset,N)}))}if(c.sparse){const N=c.sparse;c._data=c._data.then((p=>{const W=p,h=Y.Get(`${y}/sparse/indices/bufferView`,this._gltf.bufferViews,N.indices.bufferView),I=Y.Get(`${y}/sparse/values/bufferView`,this._gltf.bufferViews,N.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${h.index}`,h),this.loadBufferViewAsync(`/bufferViews/${I.index}`,I)]).then((p=>{let[h,I]=p;const q=x._GetTypedArray(`${y}/sparse/indices`,N.indices.componentType,h,N.indices.byteOffset,N.count),o=l*N.count;let O;if(5126!==c.componentType||c.normalized){const p=x._GetTypedArray(`${y}/sparse/values`,c.componentType,I,N.values.byteOffset,o);O=new A(o),C.e.ForEach(p,0,w,l,c.componentType,O.length,c.normalized||!1,((y,c)=>{O[c]=y}))}else O=x._GetTypedArray(`${y}/sparse/values`,c.componentType,I,N.values.byteOffset,o);let L=0;for(let y=0;y<q.length;y++){let c=q[y]*l;for(let y=0;y<l;y++)W[c++]=O[L++]}return W}))}))}return c._data}_loadFloatAccessorAsync(y,c){return this._loadAccessorAsync(y,c,Float32Array)}_loadIndicesAccessorAsync(y,c){if("SCALAR"!==c.type)throw new Error(`${y}/type: Invalid value ${c.type}`);if(5121!==c.componentType&&5123!==c.componentType&&5125!==c.componentType)throw new Error(`${y}/componentType: Invalid value ${c.componentType}`);if(c._data)return c._data;if(c.sparse){const A=x._GetTypedArrayConstructor(`${y}/componentType`,c.componentType);c._data=this._loadAccessorAsync(y,c,A)}else{const A=Y.Get(`${y}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((A=>x._GetTypedArray(y,c.componentType,A,c.byteOffset,c.count)))}return c._data}_loadVertexBufferViewAsync(y){if(y._babylonBuffer)return y._babylonBuffer;const c=this._babylonScene.getEngine();return y._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((y=>new C.c(c,y,!1))),y._babylonBuffer}_loadVertexAccessorAsync(y,c,A){var l;if(null!==(l=c._babylonVertexBuffer)&&void 0!==l&&l[A])return c._babylonVertexBuffer[A];c._babylonVertexBuffer||(c._babylonVertexBuffer={});const w=this._babylonScene.getEngine();if(c.sparse||void 0==c.bufferView)c._babylonVertexBuffer[A]=this._loadFloatAccessorAsync(y,c).then((y=>new C.e(w,y,A,!1)));else{const l=Y.Get(`${y}/bufferView`,this._gltf.bufferViews,c.bufferView);c._babylonVertexBuffer[A]=this._loadVertexBufferViewAsync(l).then((N=>{const p=x._GetNumComponents(y,c.type);return new C.e(w,N,A,!1,void 0,l.byteStride,void 0,c.byteOffset,p,c.componentType,c.normalized,!0,void 0,!0)}))}return c._babylonVertexBuffer[A]}_loadMaterialMetallicRoughnessPropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;return c&&(c.baseColorFactor?(A.albedoColor=N.dc.yA(c.baseColorFactor),A.alpha=c.baseColorFactor[3]):A.albedoColor=N.dc.White(),A.metallic=void 0==c.metallicFactor?1:c.metallicFactor,A.roughness=void 0==c.roughnessFactor?1:c.roughnessFactor,c.baseColorTexture&&l.push(this.loadTextureInfoAsync(`${y}/baseColorTexture`,c.baseColorTexture,(y=>{y.name=`${A.name} (Base Color)`,A.albedoTexture=y}))),c.metallicRoughnessTexture&&(c.metallicRoughnessTexture.nonColorData=!0,l.push(this.loadTextureInfoAsync(`${y}/metallicRoughnessTexture`,c.metallicRoughnessTexture,(y=>{y.name=`${A.name} (Metallic Roughness)`,A.metallicTexture=y}))),A.useMetallnessFromMetallicTextureBlue=!0,A.useRoughnessFromMetallicTextureGreen=!0,A.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(l).then((()=>{}))}_loadMaterialAsync(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const N=this._extensionsLoadMaterialAsync(y,c,A,l,w);if(N)return N;c._data=c._data||{};let p=c._data[l];if(!p){this.logOpen(`${y} ${c.name||""}`);const A=this.createMaterial(y,c,l);p={babylonMaterial:A,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(y,c,A)},c._data[l]=p,x.AddPointerMetadata(A,y),this._parent.onMaterialLoadedObservable.notifyObservers(A),this.logClose()}return A&&(p.babylonMeshes.push(A),A.zc.addOnce((()=>{const y=p.babylonMeshes.indexOf(A);-1!==y&&p.babylonMeshes.splice(y,1)}))),w(p.babylonMaterial),p.promise.then((()=>p.babylonMaterial))}_createDefaultMaterial(y,c){this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new s.c(y,this._babylonScene);return A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.fillMode=c,A.enableSpecularAntiAliasing=!0,A.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,A.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,A.transparencyMode=s.c.PBRMATERIAL_OPAQUE,A.metallic=1,A.roughness=1,A}createMaterial(y,c,A){const l=this._extensionsCreateMaterial(y,c,A);if(l)return l;const w=c.name||`material${c.index}`;return this._createDefaultMaterial(w,A)}loadMaterialPropertiesAsync(y,c,A){const l=this._extensionsLoadMaterialPropertiesAsync(y,c,A);if(l)return l;const w=new Array;return w.push(this.loadMaterialBasePropertiesAsync(y,c,A)),c.pbrMetallicRoughness&&w.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${y}/pbrMetallicRoughness`,c.pbrMetallicRoughness,A)),this.loadMaterialAlphaProperties(y,c,A),Promise.all(w).then((()=>{}))}loadMaterialBasePropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;return A.emissiveColor=c.emissiveFactor?N.dc.yA(c.emissiveFactor):new N.dc(0,0,0),c.doubleSided&&(A.nc=!1,A.twoSidedLighting=!0),c.normalTexture&&(c.normalTexture.nonColorData=!0,l.push(this.loadTextureInfoAsync(`${y}/normalTexture`,c.normalTexture,(y=>{y.name=`${A.name} (Normal)`,A.bumpTexture=y}))),A.invertNormalMapX=!this._babylonScene.useRightHandedSystem,A.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=c.normalTexture.scale&&A.bumpTexture&&(A.bumpTexture.level=c.normalTexture.scale),A.forceIrradianceInFragment=!0),c.occlusionTexture&&(c.occlusionTexture.nonColorData=!0,l.push(this.loadTextureInfoAsync(`${y}/occlusionTexture`,c.occlusionTexture,(y=>{y.name=`${A.name} (Occlusion)`,A.ambientTexture=y}))),A.useAmbientInGrayScale=!0,void 0!=c.occlusionTexture.strength&&(A.ambientTextureStrength=c.occlusionTexture.strength)),c.emissiveTexture&&l.push(this.loadTextureInfoAsync(`${y}/emissiveTexture`,c.emissiveTexture,(y=>{y.name=`${A.name} (Emissive)`,A.emissiveTexture=y}))),Promise.all(l).then((()=>{}))}loadMaterialAlphaProperties(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);switch(c.alphaMode||"OPAQUE"){case"OPAQUE":A.transparencyMode=s.c.PBRMATERIAL_OPAQUE,A.alpha=1;break;case"MASK":A.transparencyMode=s.c.PBRMATERIAL_ALPHATEST,A.alphaCutOff=void 0==c.alphaCutoff?.5:c.alphaCutoff,A.albedoTexture&&(A.albedoTexture.Vc=!0);break;case"BLEND":A.transparencyMode=s.c.PBRMATERIAL_ALPHABLEND,A.albedoTexture&&(A.albedoTexture.Vc=!0,A.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${y}/alphaMode: Invalid value (${c.alphaMode})`)}}loadTextureInfoAsync(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadTextureInfoAsync(y,c,A);if(l)return l;if(this.logOpen(`${y}`),c.texCoord>=6)throw new Error(`${y}/texCoord: Invalid value (${c.texCoord})`);const w=Y.Get(`${y}/index`,this._gltf.textures,c.index);w._textureInfo=c;const N=this._loadTextureAsync(`/textures/${c.index}`,w,(l=>{l.coordinatesIndex=c.texCoord||0,x.AddPointerMetadata(l,y),this._parent.onTextureLoadedObservable.notifyObservers(l),A(l)}));return this.logClose(),N}_loadTextureAsync(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const l=this._extensionsLoadTextureAsync(y,c,A);if(l)return l;this.logOpen(`${y} ${c.name||""}`);const w=void 0==c.sampler?x.DefaultSampler:Y.Get(`${y}/sampler`,this._gltf.samplers,c.sampler),N=Y.Get(`${y}/source`,this._gltf.images,c.source),p=this._createTextureAsync(y,w,N,A,void 0,!c._textureInfo.nonColorData);return this.logClose(),p}_createTextureAsync(y,c,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0;const W=this._loadSampler(`/samplers/${c.index}`,c),h=new Array,I=new l;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q={noMipmap:W.noMipMaps,invertY:!1,samplingMode:W.samplingMode,R:()=>{this._disposed||I.resolve()},onError:(c,A)=>{this._disposed||I.reject(new Error(`${y}: ${A&&A.message?A.message:c||"Failed to load texture"}`))},mimeType:A.mimeType??(0,u.k)(A.uri??""),loaderOptions:N,useSRGBBuffer:!!p&&this._parent.useSRGBBuffers},o=new B.d(null,this._babylonScene,q);return o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.push(I.promise),h.push(this.loadImageAsync(`/images/${A.index}`,A).then((y=>{const c=A.uri||`${this._fileName}#image${A.index}`,l=`data:${this._uniqueRootUrl}${c}`;o.updateURL(l,y);const w=o.getInternalTexture();w&&(w.label=A.name)}))),o.wrapU=W.wrapU,o.wrapV=W.wrapV,w(o),this._parent.useGltfTextureNames&&(o.name=A.name||A.uri||`image${A.index}`),Promise.all(h).then((()=>o))}_loadSampler(y,c){return c._data||(c._data={noMipMaps:9728===c.minFilter||9729===c.minFilter,samplingMode:x._GetTextureSamplingMode(y,c),wrapU:x._GetTextureWrapMode(`${y}/wrapS`,c.wrapS),wrapV:x._GetTextureWrapMode(`${y}/wrapT`,c.wrapT)}),c._data}loadImageAsync(y,c){if(!c._data){if(this.logOpen(`${y} ${c.name||""}`),c.uri)c._data=this.loadUriAsync(`${y}/uri`,c,c.uri);else{const A=Y.Get(`${y}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}this.logClose()}return c._data}loadUriAsync(y,c,A){const l=this._extensionsLoadUriAsync(y,c,A);if(l)return l;if(!x._ValidateUri(A))throw new Error(`${y}: '${A}' is invalid`);if((0,u.o)(A)){const c=new Uint8Array((0,u.d)(A));return this.log(`${y}: Decoded ${A.substring(0,64)}... (${c.length} bytes)`),Promise.resolve(c)}return this.log(`${y}: Loading ${A}`),this._parent.preprocessUrlAsync(this._rootUrl+A).then((c=>new Promise(((l,w)=>{this._parent._loadFile(this._babylonScene,c,(c=>{this._disposed||(this.log(`${y}: Loaded ${A} (${c.byteLength} bytes)`),l(new Uint8Array(c)))}),!0,(c=>{w(new u.q(`${y}: Failed to load '${A}'${c?": "+c.status+" "+c.statusText:""}`,c))}))}))))}static AddPointerMetadata(y,c){y.metadata=y.metadata||{};const A=y._internalMetadata=y._internalMetadata||{},l=A.uc=A.uc||{};(l.pointers=l.pointers||[]).push(c)}static _GetTextureWrapMode(y,c){switch(c=void 0==c?10497:c){case 33071:return B.d.CLAMP_ADDRESSMODE;case 33648:return B.d.MIRROR_ADDRESSMODE;case 10497:return B.d.WRAP_ADDRESSMODE;default:return H.c.Warn(`${y}: Invalid value (${c})`),B.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(y,c){const A=void 0==c.magFilter?9729:c.magFilter,l=void 0==c.minFilter?9987:c.minFilter;if(9729===A)switch(l){case 9728:return B.d.LINEAR_NEAREST;case 9729:return B.d.LINEAR_LINEAR;case 9984:return B.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return B.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return B.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return B.d.LINEAR_LINEAR_MIPLINEAR;default:return H.c.Warn(`${y}/minFilter: Invalid value (${l})`),B.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==A&&H.c.Warn(`${y}/magFilter: Invalid value (${A})`),l){case 9728:return B.d.NEAREST_NEAREST;case 9729:return B.d.NEAREST_LINEAR;case 9984:return B.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return B.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return B.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return B.d.NEAREST_LINEAR_MIPLINEAR;default:return H.c.Warn(`${y}/minFilter: Invalid value (${l})`),B.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(y,c){try{return(0,Q.v)(c)}catch(A){throw new Error(`${y}: ${A.message}`)}}static _GetTypedArray(y,c,A,l,w){const N=A.buffer;l=A.byteOffset+(l||0);const p=x._GetTypedArrayConstructor(`${y}/componentType`,c),W=C.e.GetTypeByteLength(c);return l%W!==0?(H.c.Warn(`${y}: Copying buffer as byte offset (${l}) is not a multiple of component type byte length (${W})`),new p(N.slice(l,l+w*W),0)):new p(N,l,w)}static _GetNumComponents(y,c){switch(c){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${y}: Invalid type (${c})`)}static _ValidateUri(y){return p.Tools.IsBase64(y)||-1===y.indexOf("..")}static _GetDrawMode(y,c){switch(void 0==c&&(c=4),c){case 0:return t.c.PointListDrawMode;case 1:return t.c.LineListDrawMode;case 2:return t.c.LineLoopDrawMode;case 3:return t.c.LineStripDrawMode;case 4:return t.c.TriangleFillMode;case 5:return t.c.TriangleStripDrawMode;case 6:return t.c.TriangleFanDrawMode}throw new Error(`${y}: Invalid mesh primitive mode (${c})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const y=new Array;if(this._gltf.materials)for(const c of this._gltf.materials)if(c._data)for(const A in c._data){const l=c._data[A];for(const c of l.babylonMeshes){c.Yc(!0);const A=l.babylonMaterial;y.push(A.forceCompilationAsync(c)),y.push(A.forceCompilationAsync(c,{useInstances:!0})),this._parent.useClipPlane&&(y.push(A.forceCompilationAsync(c,{clipPlane:!0})),y.push(A.forceCompilationAsync(c,{clipPlane:!0,useInstances:!0})))}}return Promise.all(y).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const y=new Array,c=this._babylonScene.lights;for(const A of c){const c=A.getShadowGenerator();c&&y.push(c.forceCompilationAsync())}return Promise.all(y).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(y){for(const c of this._extensions)c.enabled&&y(c)}_applyExtensions(y,c,A){for(const l of this._extensions)if(l.enabled){const w=`${l.name}.${c}`,N=y;N._activeLoaderExtensionFunctions=N._activeLoaderExtensionFunctions||{};const p=N._activeLoaderExtensionFunctions;if(!p[w]){p[w]=!0;try{const y=A(l);if(y)return y}finally{delete p[w]}}}return null}_extensionsOnLoading(){this._forEachExtensions((y=>y.onLoading&&y.onLoading()))}_extensionsOnReady(){this._forEachExtensions((y=>y.onReady&&y.onReady()))}_extensionsLoadSceneAsync(y,c){return this._applyExtensions(c,"loadScene",(A=>A.loadSceneAsync&&A.loadSceneAsync(y,c)))}_extensionsLoadNodeAsync(y,c,A){return this._applyExtensions(c,"loadNode",(l=>l.loadNodeAsync&&l.loadNodeAsync(y,c,A)))}_extensionsLoadCameraAsync(y,c,A){return this._applyExtensions(c,"loadCamera",(l=>l.loadCameraAsync&&l.loadCameraAsync(y,c,A)))}_extensionsLoadVertexDataAsync(y,c,A){return this._applyExtensions(c,"loadVertexData",(l=>l._loadVertexDataAsync&&l._loadVertexDataAsync(y,c,A)))}_extensionsLoadMeshPrimitiveAsync(y,c,A,l,w,N){return this._applyExtensions(w,"loadMeshPrimitive",(p=>p._loadMeshPrimitiveAsync&&p._loadMeshPrimitiveAsync(y,c,A,l,w,N)))}_extensionsLoadMaterialAsync(y,c,A,l,w){return this._applyExtensions(c,"loadMaterial",(N=>N._loadMaterialAsync&&N._loadMaterialAsync(y,c,A,l,w)))}_extensionsCreateMaterial(y,c,A){return this._applyExtensions(c,"createMaterial",(l=>l.createMaterial&&l.createMaterial(y,c,A)))}_extensionsLoadMaterialPropertiesAsync(y,c,A){return this._applyExtensions(c,"loadMaterialProperties",(l=>l.loadMaterialPropertiesAsync&&l.loadMaterialPropertiesAsync(y,c,A)))}_extensionsLoadTextureInfoAsync(y,c,A){return this._applyExtensions(c,"loadTextureInfo",(l=>l.loadTextureInfoAsync&&l.loadTextureInfoAsync(y,c,A)))}_extensionsLoadTextureAsync(y,c,A){return this._applyExtensions(c,"loadTexture",(l=>l._loadTextureAsync&&l._loadTextureAsync(y,c,A)))}_extensionsLoadAnimationAsync(y,c){return this._applyExtensions(c,"loadAnimation",(A=>A.loadAnimationAsync&&A.loadAnimationAsync(y,c)))}_extensionsLoadAnimationChannelAsync(y,c,A,l,w){return this._applyExtensions(A,"loadAnimationChannel",(N=>N._loadAnimationChannelAsync&&N._loadAnimationChannelAsync(y,c,A,l,w)))}_extensionsLoadSkinAsync(y,c,A){return this._applyExtensions(A,"loadSkin",(l=>l._loadSkinAsync&&l._loadSkinAsync(y,c,A)))}_extensionsLoadUriAsync(y,c,A){return this._applyExtensions(c,"loadUri",(l=>l._loadUriAsync&&l._loadUriAsync(y,c,A)))}_extensionsLoadBufferViewAsync(y,c){return this._applyExtensions(c,"loadBufferView",(A=>A.loadBufferViewAsync&&A.loadBufferViewAsync(y,c)))}_extensionsLoadBufferAsync(y,c,A,l){return this._applyExtensions(c,"loadBuffer",(w=>w.loadBufferAsync&&w.loadBufferAsync(y,c,A,l)))}static LoadExtensionAsync(y,c,A,l){if(!c.extensions)return null;const w=c.extensions[A];return w?l(`${y}/extensions/${A}`,w):null}static LoadExtraAsync(y,c,A,l){if(!c.extras)return null;const w=c.extras[A];return w?l(`${y}/extras/${A}`,w):null}isExtensionUsed(y){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(y)}logOpen(y){this._parent._logOpen(y)}logClose(){this._parent._logClose()}log(y){this._parent._log(y)}startPerformanceCounter(y){this._parent._startPerformanceCounter(y)}endPerformanceCounter(y){this._parent._endPerformanceCounter(y)}}x.DefaultSampler={index:-1},a.d._CreateGLTF2Loader=y=>new x(y);var F=A(13943),R=A(12511),r=A(12363),n=A(13947),E=A(13952);class b extends E.e{constructor(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",y),this._texture=y.getEngine().createRawCubeTexture(c,A,l,w,N,p,W,h)}update(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,y,c,A,l,w)}updateRGBDAsync(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,n.i)(this._texture,y,c,A,l).then((()=>{}))}clone(){return r.d.Clone((()=>{const y=this.mc(),c=this._texture,A=new b(y,c._bufferViewArray,c.width,c.format,c.type,c.generateMipMaps,c.invertY,c.samplingMode,c._compression);return 13===c.source&&A.updateRGBDAsync(c._bufferViewArrayArray,c._sphericalPolynomial,c._lodGenerationScale,c._lodGenerationOffset),A}),this)}}const Z="EXT_lights_image_based";class v{constructor(y){this.name=Z,this._loader=y,this.enabled=this._loader.isExtensionUsed(Z)}dispose(){this._loader=null,delete this._lights}onLoading(){const y=this._loader.uc.extensions;if(y&&y[this.name]){const c=y[this.name];this._lights=c.lights}}loadSceneAsync(y,c){return x.LoadExtensionAsync(y,c,this.name,(async(A,l)=>{this._loader._allMaterialsDirtyRequired=!0;const w=new Array;w.push(this._loader.loadSceneAsync(y,c)),this._loader.logOpen(`${A}`);const N=Y.Get(`${A}/light`,this._lights,l.tc);return w.push(this._loadLightAsync(`/extensions/${this.name}/lights/${l.tc}`,N).then((y=>{this._loader.babylonScene.environmentTexture=y}))),this._loader.logClose(),await Promise.all(w).then((()=>{}))}))}_loadLightAsync(y,c){if(!c._loaded){const A=new Array;this._loader.logOpen(`${y}`);const l=new Array(c.specularImages.length);for(let w=0;w<c.specularImages.length;w++){const N=c.specularImages[w];l[w]=new Array(N.length);for(let c=0;c<N.length;c++){const p=`${y}/specularImages/${w}/${c}`;this._loader.logOpen(`${p}`);const W=N[c],h=Y.Get(p,this._loader.uc.images,W);A.push(this._loader.loadImageAsync(`/images/${W}`,h).then((y=>{l[w][c]=y}))),this._loader.logClose()}}this._loader.logClose(),c._loaded=Promise.all(A).then((async()=>{const A=new b(this._loader.babylonScene,null,c.specularImageSize);if(A.name=c.name||"environment",c._babylonTexture=A,void 0!=c.JW&&(A.level=c.JW),c.rotation){let y=w.Quaternion.yA(c.rotation);this._loader.babylonScene.useRightHandedSystem||(y=w.Quaternion.Inverse(y)),w.Matrix.FromQuaternionToRef(y,A.getReflectionTextureMatrix())}if(!c.irradianceCoefficients)throw new Error(`${y}: Irradiance coefficients are missing`);const N=R.d.yA(c.irradianceCoefficients);N.scaleInPlace(c.JW),N.convertIrradianceToLambertianRadiance();const p=R.e.FromHarmonics(N),W=(l.length-1)/Math.log2(c.specularImageSize);return await A.updateRGBDAsync(l,p,W)}))}return c._loaded.then((()=>c._babylonTexture))}}J(Z),V(Z,!0,(y=>new v(y)));A(12885);const d="EXT_mesh_gpu_instancing";class yy{constructor(y){this.name=d,this._loader=y,this.enabled=this._loader.isExtensionUsed(d)}dispose(){this._loader=null}loadNodeAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(y,l)=>{this._loader._disableInstancedMesh++;const N=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,A);if(this._loader._disableInstancedMesh--,!c._primitiveBabylonMeshes)return await N;const p=new Array;let W=0;const h=c=>{if(void 0==l.attributes[c])return void p.push(Promise.resolve(null));const A=Y.Get(`${y}/attributes/${c}`,this._loader.uc.accessors,l.attributes[c]);if(p.push(this._loader._loadFloatAccessorAsync(`/accessors/${A.bufferView}`,A)),0===W)W=A.count;else if(W!==A.count)throw new Error(`${y}/attributes: Instance buffer accessors do not have the same count.`)};return h("TRANSLATION"),h("ROTATION"),h("SCALE"),await N.then((async y=>{const[A,l,N]=await Promise.all(p),h=new Float32Array(16*W);w.TmpVectors.gc[0].Ec(0,0,0),w.TmpVectors.Quaternion[0].Ec(0,0,0,1),w.TmpVectors.gc[1].Ec(1,1,1);for(let c=0;c<W;++c)A&&w.gc.FromArrayToRef(A,3*c,w.TmpVectors.gc[0]),l&&w.Quaternion.FromArrayToRef(l,4*c,w.TmpVectors.Quaternion[0]),N&&w.gc.FromArrayToRef(N,3*c,w.TmpVectors.gc[1]),w.Matrix.ComposeToRef(w.TmpVectors.gc[1],w.TmpVectors.Quaternion[0],w.TmpVectors.gc[0],w.TmpVectors.Matrix[0]),w.TmpVectors.Matrix[0].copyToArray(h,16*c);for(const w of c._primitiveBabylonMeshes)w.bo("matrix",h,16,!0);return y}))}))}}J(d),V(d,!0,(y=>new yy(y)));let cy=0,Ay=null;class ly{static get Default(){return ly._Default||(ly._Default=new ly),ly._Default}constructor(){const y=ly.Configuration.decoder;this._decoderModulePromise=p.Tools.LoadBabylonScriptAsync(y.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(y,c,A,l,w){await this._decoderModulePromise,0===cy&&(MeshoptDecoder.useWorkers(1),cy=1);const N=await MeshoptDecoder.decodeGltfBufferAsync(c,A,y,l,w);return null!==Ay&&clearTimeout(Ay),Ay=setTimeout((()=>{MeshoptDecoder.useWorkers(0),cy=0,Ay=null}),1e3),N}}ly.Configuration={decoder:{url:`${p.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},ly._Default=null;const wy="EXT_meshopt_compression";class Ny{constructor(y){this.name=wy,this.enabled=y.isExtensionUsed(wy),this._loader=y}dispose(){this._loader=null}loadBufferViewAsync(y,c){return x.LoadExtensionAsync(y,c,this.name,(async(A,l)=>{const w=c;if(w._meshOptData)return await w._meshOptData;const N=Y.Get(`${y}/buffer`,this._loader.uc.buffers,l.buffer);return w._meshOptData=this._loader.loadBufferAsync(`/buffers/${N.index}`,N,l.byteOffset||0,l.byteLength).then((async y=>await ly.Default.decodeGltfBufferAsync(y,l.count,l.byteStride,l.mode,l.filter))),await w._meshOptData}))}}J(wy),V(wy,!0,(y=>new Ny(y)));const py="EXT_texture_webp";class Wy{constructor(y){this.name=py,this._loader=y,this.enabled=y.isExtensionUsed(py)}dispose(){this._loader=null}_loadTextureAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=void 0==c.sampler?x.DefaultSampler:Y.Get(`${y}/sampler`,this._loader.uc.samplers,c.sampler),p=Y.Get(`${l}/source`,this._loader.uc.images,w.source);return await this._loader._createTextureAsync(y,N,p,(y=>{A(y)}),void 0,!c._textureInfo.nonColorData)}))}}J(py),V(py,!0,(y=>new Wy(y)));const hy="EXT_texture_avif";class Iy{constructor(y){this.name=hy,this._loader=y,this.enabled=y.isExtensionUsed(hy)}dispose(){this._loader=null}_loadTextureAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=void 0==c.sampler?x.DefaultSampler:Y.Get(`${y}/sampler`,this._loader.uc.samplers,c.sampler),p=Y.Get(`${l}/source`,this._loader.uc.images,w.source);return await this._loader._createTextureAsync(y,N,p,(y=>{A(y)}),void 0,!c._textureInfo.nonColorData)}))}}J(hy),V(hy,!0,(y=>new Iy(y)));var qy=A(13934),oy=A(12860);const Oy="EXT_lights_ies";class Ly{constructor(y){this.name=Oy,this._loader=y,this.enabled=this._loader.isExtensionUsed(Oy)}dispose(){this._loader=null,delete this._lights}onLoading(){const y=this._loader.uc.extensions;if(y&&y[this.name]){const c=y[this.name];this._lights=c.lights,Y.Assign(this._lights)}}loadNodeAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,p)=>{let W,h;this._loader._allMaterialsDirtyRequired=!0;const I=await this._loader.loadNodeAsync(y,c,(y=>{h=Y.Get(l,this._lights,p.tc);const c=h.name||y.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,W=new qy.e(c,w.gc.Zero(),w.gc.Backward(),0,1,this._loader.babylonScene),W.angle=Math.PI/2,W.innerAngle=0,W._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,h._babylonLight=W,W.falloffType=oy.b.FALLOFF_GLTF,W.UW=p.color?N.dc.yA(p.color):N.dc.White(),W.JW=p.multiplier||1,W.range=Number.MAX_VALUE,W.parent=y,this._loader._babylonLights.push(W),x.AddPointerMetadata(W,l),A(y)}));let q;if(h.uri)q=await this._loader.loadUriAsync(y,h,h.uri);else{const c=Y.Get(`${y}/bufferView`,this._loader.uc.bufferViews,h.bufferView);q=await this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c)}return W.iesProfileTexture=new B.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,q,!0,void 0,void 0,void 0,void 0,".ies"),I}))}}J(Oy),V(Oy,!0,(y=>new Ly(y)));var iy=A(13962);const Hy="KHR_draco_mesh_compression";class Py{constructor(y){this.name=Hy,this.useNormalizedFlagFromAccessor=!0,this._loader=y,this.enabled=iy.c.DefaultAvailable&&this._loader.isExtensionUsed(Hy)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{if(void 0!=c.mode&&4!==c.mode&&5!==c.mode)throw new Error(`${y}: Unsupported mode ${c.mode}`);const N={},p={},W=(y,l)=>{const W=w.attributes[y];if(void 0!=W&&(A._delayInfo=A._delayInfo||[],-1===A._delayInfo.indexOf(l)&&A._delayInfo.push(l),N[l]=W,this.useNormalizedFlagFromAccessor)){const A=Y.TryGet(this._loader.uc.accessors,c.attributes[y]);A&&(p[l]=A.normalized||!1)}};W("POSITION",C.e.PositionKind),W("NORMAL",C.e.NormalKind),W("TANGENT",C.e.TangentKind),W("TEXCOORD_0",C.e.UVKind),W("TEXCOORD_1",C.e.UV2Kind),W("TEXCOORD_2",C.e.UV3Kind),W("TEXCOORD_3",C.e.UV4Kind),W("TEXCOORD_4",C.e.UV5Kind),W("TEXCOORD_5",C.e.UV6Kind),W("JOINTS_0",C.e.MatricesIndicesKind),W("WEIGHTS_0",C.e.MatricesWeightsKind),W("COLOR_0",C.e.ColorKind);const h=Y.Get(l,this._loader.uc.bufferViews,w.bufferView);return h._dracoBabylonGeometry||(h._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((async l=>{const w=this.dracoDecoder||iy.c.Default,W=Y.TryGet(this._loader.uc.accessors,c.attributes.POSITION),h=this._loader.parent.alwaysComputeBoundingBox||A.skeleton||!W?null:g(W);return await w._decodeMeshToGeometryForGltfAsync(A.name,this._loader.babylonScene,l,N,p,h).catch((c=>{throw new Error(`${y}: ${c.message}`)}))}))),await h._dracoBabylonGeometry}))}}J(Hy),V(Hy,!0,(y=>new Py(y)));var Dy=A(13964),ty=A(12307),sy=A(12310),By=A(12743),Xy=A(12915),Cy=A(12283);By.b.AddNodeConstructor("Light_Type_0",((y,c)=>()=>new Ky(y,w.gc.Zero(),c)));class Ky extends Xy.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(y){this._shadowAngle=y,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(y){const c=this.needCube();if(this._direction=y,this.needCube()!==c&&this._shadowGenerators){const y=this._shadowGenerators.values();for(let c=y.next();!0!==c.done;c=y.next()){c.value.recreateShadowMap()}}}constructor(y,c,A){super(y,A),this._shadowAngle=Math.PI/2,this.position=c}getClassName(){return"PointLight"}getTypeID(){return oy.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(y){if(this.direction)return super.getShadowDirection(y);switch(y){case 0:return new w.gc(1,0,0);case 1:return new w.gc(-1,0,0);case 2:return new w.gc(0,-1,0);case 3:return new w.gc(0,1,0);case 4:return new w.gc(0,0,1);case 5:return new w.gc(0,0,-1)}return w.gc.Zero()}_setDefaultShadowProjectionMatrix(y,c,A){const l=this.mc().activeCamera;if(!l)return;const N=void 0!==this.shadowMinZ?this.shadowMinZ:l.ec,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:l.maxZ,W=this.mc().getEngine().Xc;w.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,W?p:N,W?N:p,y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,W)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(y,c){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,c):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,c),this}transferToNodeMaterialEffect(y,c){return this.computeTransformedInformation()?y.setFloat3(c,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):y.setFloat3(c,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(y,c){y["POINTLIGHT"+c]=!0}}(0,ty.b)([(0,sy.P)()],Ky.prototype,"shadowAngle",null),(0,Cy.f)("BABYLON.PointLight",Ky);const mc="KHR_lights_punctual";class Ty{constructor(y){this.name=mc,this._loader=y,this.enabled=this._loader.isExtensionUsed(mc)}dispose(){this._loader=null,delete this._lights}onLoading(){const y=this._loader.uc.extensions;if(y&&y[this.name]){const c=y[this.name];this._lights=c.lights,Y.Assign(this._lights)}}loadNodeAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,p)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(y,c,(y=>{let c;const W=Y.Get(l,this._lights,p.tc),h=W.name||y.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,W.type){case"directional":{const y=new Dy.b(h,w.gc.Backward(),this._loader.babylonScene);y.position.vc(0),c=y;break}case"point":c=new Ky(h,w.gc.Zero(),this._loader.babylonScene);break;case"spot":{const y=new qy.e(h,w.gc.Zero(),w.gc.Backward(),0,1,this._loader.babylonScene);y.angle=2*(W.spot&&W.spot.outerConeAngle||Math.PI/4),y.innerAngle=2*(W.spot&&W.spot.innerConeAngle||0),c=y;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${l}: Invalid light type (${W.type})`)}c._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,W._babylonLight=c,c.falloffType=oy.b.FALLOFF_GLTF,c.UW=W.color?N.dc.yA(W.color):N.dc.White(),c.JW=void 0==W.JW?1:W.JW,c.range=void 0==W.range?Number.MAX_VALUE:W.range,c.parent=y,this._loader._babylonLights.push(c),x.AddPointerMetadata(c,l),A(y)})))))}}J(mc),V(mc,!0,(y=>new Ty(y)));const zy="KHR_materials_pbrSpecularGlossiness";class Sy{constructor(y){this.name=zy,this.order=200,this._loader=y,this.enabled=this._loader.isExtensionUsed(zy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;return N.push(this._loader.loadMaterialBasePropertiesAsync(y,c,A)),N.push(this._loadSpecularGlossinessPropertiesAsync(l,w,A)),this._loader.loadMaterialAlphaProperties(y,c,A),await Promise.all(N).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;return A.metallic=null,A.roughness=null,c.diffuseFactor?(A.albedoColor=N.dc.yA(c.diffuseFactor),A.alpha=c.diffuseFactor[3]):A.albedoColor=N.dc.White(),A.reflectivityColor=c.specularFactor?N.dc.yA(c.specularFactor):N.dc.White(),A.microSurface=void 0==c.glossinessFactor?1:c.glossinessFactor,c.diffuseTexture&&l.push(this._loader.loadTextureInfoAsync(`${y}/diffuseTexture`,c.diffuseTexture,(y=>{y.name=`${A.name} (Diffuse)`,A.albedoTexture=y}))),c.specularGlossinessTexture&&(l.push(this._loader.loadTextureInfoAsync(`${y}/specularGlossinessTexture`,c.specularGlossinessTexture,(y=>{y.name=`${A.name} (Specular Glossiness)`,A.reflectivityTexture=y,A.reflectivityTexture.Vc=!0}))),A.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(l).then((()=>{}))}}J(zy),V(zy,!0,(y=>new Sy(y)));const My="KHR_materials_unlit";class ky{constructor(y){this.name=My,this.order=210,this._loader=y,this.enabled=this._loader.isExtensionUsed(My)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async()=>await this._loadUnlitPropertiesAsync(y,c,A)))}_loadUnlitPropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;A.unlit=!0;const w=c.pbrMetallicRoughness;return w&&(w.baseColorFactor?(A.albedoColor=N.dc.yA(w.baseColorFactor),A.alpha=w.baseColorFactor[3]):A.albedoColor=N.dc.White(),w.baseColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${y}/baseColorTexture`,w.baseColorTexture,(y=>{y.name=`${A.name} (Base Color)`,A.albedoTexture=y})))),c.doubleSided&&(A.nc=!1,A.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(y,c,A),Promise.all(l).then((()=>{}))}}J(My),V(My,!0,(y=>new ky(y)));const ay="KHR_materials_clearcoat";class uy{constructor(y){this.name=ay,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(ay)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadClearCoatPropertiesAsync(l,w,A)),await Promise.all(N)}))}_loadClearCoatPropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;return A.clearCoat.isEnabled=!0,A.clearCoat.useRoughnessFromMainTexture=!1,A.clearCoat.remapF0OnInterfaceChange=!1,void 0!=c.clearcoatFactor?A.clearCoat.JW=c.clearcoatFactor:A.clearCoat.JW=0,c.clearcoatTexture&&l.push(this._loader.loadTextureInfoAsync(`${y}/clearcoatTexture`,c.clearcoatTexture,(y=>{y.name=`${A.name} (ClearCoat)`,A.clearCoat.texture=y}))),void 0!=c.clearcoatRoughnessFactor?A.clearCoat.roughness=c.clearcoatRoughnessFactor:A.clearCoat.roughness=0,c.clearcoatRoughnessTexture&&(c.clearcoatRoughnessTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${y}/clearcoatRoughnessTexture`,c.clearcoatRoughnessTexture,(y=>{y.name=`${A.name} (ClearCoat Roughness)`,A.clearCoat.textureRoughness=y})))),c.clearcoatNormalTexture&&(c.clearcoatNormalTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${y}/clearcoatNormalTexture`,c.clearcoatNormalTexture,(y=>{y.name=`${A.name} (ClearCoat Normal)`,A.clearCoat.bumpTexture=y}))),A.invertNormalMapX=!A.mc().useRightHandedSystem,A.invertNormalMapY=A.mc().useRightHandedSystem,void 0!=c.clearcoatNormalTexture.scale&&(A.clearCoat.bumpTexture.level=c.clearcoatNormalTexture.scale)),Promise.all(l).then((()=>{}))}}J(ay),V(ay,!0,(y=>new uy(y)));const Gy="KHR_materials_iridescence";class jy{constructor(y){this.name=Gy,this.order=195,this._loader=y,this.enabled=this._loader.isExtensionUsed(Gy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadIridescencePropertiesAsync(l,w,A)),await Promise.all(N).then((()=>{}))}))}_loadIridescencePropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;return A.iridescence.isEnabled=!0,A.iridescence.JW=c.iridescenceFactor??0,A.iridescence.indexOfRefraction=c.iridescenceIor??c.iridescenceIOR??1.3,A.iridescence.minimumThickness=c.iridescenceThicknessMinimum??100,A.iridescence.maximumThickness=c.iridescenceThicknessMaximum??400,c.iridescenceTexture&&l.push(this._loader.loadTextureInfoAsync(`${y}/iridescenceTexture`,c.iridescenceTexture,(y=>{y.name=`${A.name} (Iridescence)`,A.iridescence.texture=y}))),c.iridescenceThicknessTexture&&l.push(this._loader.loadTextureInfoAsync(`${y}/iridescenceThicknessTexture`,c.iridescenceThicknessTexture,(y=>{y.name=`${A.name} (Iridescence Thickness)`,A.iridescence.thicknessTexture=y}))),Promise.all(l).then((()=>{}))}}J(Gy),V(Gy,!0,(y=>new jy(y)));const fy="KHR_materials_anisotropy";class Vy{constructor(y){this.name=fy,this.order=195,this._loader=y,this.enabled=this._loader.isExtensionUsed(fy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadIridescencePropertiesAsync(l,w,A)),await Promise.all(N)}))}async _loadIridescencePropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;A.anisotropy.isEnabled=!0,A.anisotropy.JW=c.anisotropyStrength??0,A.anisotropy.angle=c.anisotropyRotation??0,c.anisotropyTexture&&(c.anisotropyTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${y}/anisotropyTexture`,c.anisotropyTexture,(y=>{y.name=`${A.name} (Anisotropy Intensity)`,A.anisotropy.texture=y})))),await Promise.all(l)}}J(fy),V(fy,!0,(y=>new Vy(y)));const Jy="KHR_materials_emissive_strength";class Uy{constructor(y){this.name=Jy,this.order=170,this._loader=y,this.enabled=this._loader.isExtensionUsed(Jy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>await this._loader.loadMaterialPropertiesAsync(y,c,A).then((()=>{this._loadEmissiveProperties(l,w,A)}))))}_loadEmissiveProperties(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);void 0!==c.emissiveStrength&&(A.emissiveIntensity=c.emissiveStrength)}}J(Jy),V(Jy,!0,(y=>new Uy(y)));const ey="KHR_materials_sheen";class Qy{constructor(y){this.name=ey,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(ey)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadSheenPropertiesAsync(l,w,A)),await Promise.all(N).then((()=>{}))}))}_loadSheenPropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;return A.sheen.isEnabled=!0,A.sheen.JW=1,void 0!=c.sheenColorFactor?A.sheen.color=N.dc.yA(c.sheenColorFactor):A.sheen.color=N.dc.Black(),c.sheenColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${y}/sheenColorTexture`,c.sheenColorTexture,(y=>{y.name=`${A.name} (Sheen Color)`,A.sheen.texture=y}))),void 0!==c.sheenRoughnessFactor?A.sheen.roughness=c.sheenRoughnessFactor:A.sheen.roughness=0,c.sheenRoughnessTexture&&(c.sheenRoughnessTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${y}/sheenRoughnessTexture`,c.sheenRoughnessTexture,(y=>{y.name=`${A.name} (Sheen Roughness)`,A.sheen.textureRoughness=y})))),A.sheen.albedoScaling=!0,A.sheen.useRoughnessFromMainTexture=!1,Promise.all(l).then((()=>{}))}}J(ey),V(ey,!0,(y=>new Qy(y)));var Yy=A(12802);const gy="KHR_materials_specular";class xy{constructor(y){this.name=gy,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(gy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;if(N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadSpecularPropertiesAsync(l,w,A)),w.extensions&&w.extensions.EXT_materials_specular_edge_color&&A instanceof s.c){w.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(A.brdf.dielectricSpecularModel=Yy.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,A.brdf.conductorSpecularModel=Yy.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(N).then((()=>{}))}))}_loadSpecularPropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;return void 0!==c.specularFactor&&(A.metallicF0Factor=c.specularFactor),void 0!==c.specularColorFactor&&(A.metallicReflectanceColor=N.dc.yA(c.specularColorFactor)),c.specularTexture&&(c.specularTexture.nonColorData=!0,l.push(this._loader.loadTextureInfoAsync(`${y}/specularTexture`,c.specularTexture,(y=>{y.name=`${A.name} (Specular)`,A.metallicReflectanceTexture=y,A.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),c.specularColorTexture&&l.push(this._loader.loadTextureInfoAsync(`${y}/specularColorTexture`,c.specularColorTexture,(y=>{y.name=`${A.name} (Specular Color)`,A.reflectanceTexture=y}))),Promise.all(l).then((()=>{}))}}J(gy),V(gy,!0,(y=>new xy(y)));const Fy="KHR_materials_ior";class Ry{constructor(y){this.name=Fy,this.order=180,this._loader=y,this.enabled=this._loader.isExtensionUsed(Fy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadIorPropertiesAsync(l,w,A)),await Promise.all(N).then((()=>{}))}))}_loadIorPropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);return void 0!==c.ior?A.indexOfRefraction=c.ior:A.indexOfRefraction=Ry._DEFAULT_IOR,Promise.resolve()}}Ry._DEFAULT_IOR=1.5,J(Fy),V(Fy,!0,(y=>new Ry(y)));const ry="KHR_materials_variants";class ny{constructor(y){this.name=ry,this._loader=y,this.enabled=this._loader.isExtensionUsed(ry)}dispose(){this._loader=null}static GetAvailableVariants(y){const c=this._GetExtensionMetadata(y);return c?Object.keys(c.variants):[]}getAvailableVariants(y){return ny.GetAvailableVariants(y)}static SelectVariant(y,c){const A=this._GetExtensionMetadata(y);if(!A)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${ry} extension`);const l=y=>{const c=A.variants[y];if(c)for(const A of c)A.mesh.material=A.material};if(c instanceof Array)for(const w of c)l(w);else l(c);A.lastSelected=c}selectVariant(y,c){ny.SelectVariant(y,c)}static Reset(y){const c=this._GetExtensionMetadata(y);if(!c)throw new Error(`Cannot reset on a glTF mesh that does not have the ${ry} extension`);for(const A of c.original)A.mesh.material=A.material;c.lastSelected=null}reset(y){ny.Reset(y)}static GetLastSelectedVariant(y){const c=this._GetExtensionMetadata(y);if(!c)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${ry} extension`);return c.lastSelected}getLastSelectedVariant(y){return ny.GetLastSelectedVariant(y)}static _GetExtensionMetadata(y){var c,A;return(null===y||void 0===y||null===(c=y._internalMetadata)||void 0===c||null===(A=c.uc)||void 0===A?void 0:A[ry])||null}onLoading(){const y=this._loader.uc.extensions;if(y&&y[this.name]){const c=y[this.name];this._variants=c.variants}}onReady(){const y=this._loader.rootBabylonMesh;if(y){var c;const A=this._loader.parent.extensionOptions[ry];null!==A&&void 0!==A&&A.defaultVariant&&ny.SelectVariant(y,A.defaultVariant),null===A||void 0===A||null===(c=A.onLoaded)||void 0===c||c.call(A,{get variants(){return ny.GetAvailableVariants(y)},get selectedVariant(){const c=ny.GetLastSelectedVariant(y);return c?Array.isArray(c)?c[0]:c:ny.GetAvailableVariants(y)[0]},set selectedVariant(c){ny.SelectVariant(y,c)}})}}_loadMeshPrimitiveAsync(y,c,A,l,w,N){return x.LoadExtensionAsync(y,w,this.name,(async(p,W)=>{const h=new Array;return h.push(this._loader._loadMeshPrimitiveAsync(y,c,A,l,w,(c=>{if(N(c),c instanceof T.b){const A=x._GetDrawMode(y,w.mode),l=this._loader.rootBabylonMesh,N=l?l._internalMetadata=l._internalMetadata||{}:{},I=N.uc=N.uc||{},q=I[ry]=I[ry]||{lastSelected:null,original:[],variants:{}};q.original.push({mesh:c,material:c.material});for(let y=0;y<W.mappings.length;++y){const w=W.mappings[y],N=Y.Get(`${p}/mappings/${y}/material`,this._loader.uc.materials,w.material);h.push(this._loader._loadMaterialAsync(`#/materials/${w.material}`,N,c,A,(y=>{for(let A=0;A<w.variants.length;++A){const N=w.variants[A],p=Y.Get(`/extensions/${ry}/variants/${N}`,this._variants,N);q.variants[p.name]=q.variants[p.name]||[],q.variants[p.name].push({mesh:c,material:y}),c.onClonedObservable.add((y=>{const A=y;let w=null,N=A;do{if(N=N.parent,!N)return;w=ny._GetExtensionMetadata(N)}while(null===w);if(l&&w===ny._GetExtensionMetadata(l)){N._internalMetadata={};for(const y in l._internalMetadata)N._internalMetadata[y]=l._internalMetadata[y];N._internalMetadata.uc=[];for(const y in l._internalMetadata.uc)N._internalMetadata.uc[y]=l._internalMetadata.uc[y];N._internalMetadata.uc[ry]={lastSelected:null,original:[],variants:{}};for(const y of w.original)N._internalMetadata.uc[ry].original.push({mesh:y.mesh,material:y.material});for(const y in w.variants)if(Object.prototype.hasOwnProperty.call(w.variants,y)){N._internalMetadata.uc[ry].variants[y]=[];for(const c of w.variants[y])N._internalMetadata.uc[ry].variants[y].push({mesh:c.mesh,material:c.material})}w=N._internalMetadata.uc[ry]}for(const l of w.original)l.mesh===c&&(l.mesh=A);for(const l of w.variants[p.name])l.mesh===c&&(l.mesh=A)}))}})))}}}))),await Promise.all(h).then((y=>{let[c]=y;return c}))}))}}J(ry),V(ry,!0,(y=>new ny(y)));var Ey=A(12392);class by{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Yy.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(y,c){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...by._GetDefaultOptions(),...y},this._scene=c,this._scene._transmissionHelper=this,this.onErrorObservable=new q.d,this._scene.zc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(y){if(!Object.keys(y).filter((c=>this._options[c]!==y[c])).length)return;const c={...this._options,...y},A=this._options;this._options=c,c.renderSize===A.renderSize&&c.renderTargetTextureType===A.renderTargetTextureType&&c.generateMipmaps===A.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=c.samples,this._opaqueRenderTarget.lodGenerationScale=c.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=c.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(y){return!!y&&!!(y instanceof s.c&&y.subSurface.isRefractionEnabled)}_addMesh(y){this._materialObservers[y.uniqueId]=y.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),p.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(y.material)?(y.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(y)&&this._transparentMeshesCache.push(y)):-1===this._opaqueMeshesCache.indexOf(y)&&this._opaqueMeshesCache.push(y)}))}_removeMesh(y){y.onMaterialChangedObservable.remove(this._materialObservers[y.uniqueId]),delete this._materialObservers[y.uniqueId];let c=this._transparentMeshesCache.indexOf(y);-1!==c&&this._transparentMeshesCache.splice(c,1),c=this._opaqueMeshesCache.indexOf(y),-1!==c&&this._opaqueMeshesCache.splice(c,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(y){const c=this._transparentMeshesCache.indexOf(y),A=this._opaqueMeshesCache.indexOf(y);this._shouldRenderAsTransmission(y.material)?(y.material instanceof s.c&&(y.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==A?(this._opaqueMeshesCache.splice(A,1),this._transparentMeshesCache.push(y)):-1===c&&this._transparentMeshesCache.push(y)):-1!==c?(this._transparentMeshesCache.splice(c,1),this._opaqueMeshesCache.push(y)):-1===A&&this._opaqueMeshesCache.push(y)}_isRenderTargetValid(){var y;return null!==(null===(y=this._opaqueRenderTarget)||void 0===y?void 0:y.getInternalTexture())}_setupRenderTargets(){var y;let c;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Ey.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(y=this._options.clearColor)||void 0===y?void 0:y.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((y=>{c=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?y.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(y.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=c}));for(const A of this._transparentMeshesCache)this._shouldRenderAsTransmission(A.material)&&(A.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Zy="KHR_materials_transmission";class vy{constructor(y){this.name=Zy,this.order=175,this._loader=y,this.enabled=this._loader.isExtensionUsed(Zy),this.enabled&&(y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadTransparentPropertiesAsync(l,c,A,w)),await Promise.all(N).then((()=>{}))}))}_loadTransparentPropertiesAsync(y,c,A,l){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const w=A;if(w.subSurface.isRefractionEnabled=!0,w.subSurface.volumeIndexOfRefraction=1,w.subSurface.useAlbedoToTintRefraction=!0,void 0===l.transmissionFactor)return w.subSurface.refractionIntensity=0,w.subSurface.isRefractionEnabled=!1,Promise.resolve();{var N;w.subSurface.refractionIntensity=l.transmissionFactor;const y=w.mc();if(w.subSurface.refractionIntensity&&!y._transmissionHelper)new by({},w.mc());else if(w.subSurface.refractionIntensity&&(null===(N=y._transmissionHelper)||void 0===N||!N._isRenderTargetValid())){var p;null===(p=y._transmissionHelper)||void 0===p||p._setupRenderTargets()}}return w.subSurface.minimumThickness=0,w.subSurface.maximumThickness=0,l.transmissionTexture?(l.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${y}/transmissionTexture`,l.transmissionTexture,void 0).then((y=>{y.name=`${A.name} (Transmission)`,w.subSurface.refractionIntensityTexture=y,w.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(Zy),V(Zy,!0,(y=>new vy(y)));const dy="KHR_materials_diffuse_transmission";class yc{constructor(y){this.name=dy,this.order=174,this._loader=y,this.enabled=this._loader.isExtensionUsed(dy),this.enabled&&(y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadTranslucentPropertiesAsync(l,c,A,w)),await Promise.all(N).then((()=>{}))}))}_loadTranslucentPropertiesAsync(y,c,A,l){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const w=A;if(w.subSurface.isTranslucencyEnabled=!0,w.subSurface.volumeIndexOfRefraction=1,w.subSurface.minimumThickness=0,w.subSurface.maximumThickness=0,w.subSurface.useAlbedoToTintTranslucency=!1,void 0===l.diffuseTransmissionFactor)return w.subSurface.translucencyIntensity=0,w.subSurface.isTranslucencyEnabled=!1,Promise.resolve();w.subSurface.translucencyIntensity=l.diffuseTransmissionFactor;const p=new Array;return w.subSurface.useGltfStyleTextures=!0,l.diffuseTransmissionTexture&&(l.diffuseTransmissionTexture.nonColorData=!0,p.push(this._loader.loadTextureInfoAsync(`${y}/diffuseTransmissionTexture`,l.diffuseTransmissionTexture).then((y=>{y.name=`${A.name} (Diffuse Transmission)`,w.subSurface.translucencyIntensityTexture=y})))),void 0!==l.diffuseTransmissionColorFactor?w.subSurface.translucencyColor=N.dc.yA(l.diffuseTransmissionColorFactor):w.subSurface.translucencyColor=N.dc.White(),l.diffuseTransmissionColorTexture&&p.push(this._loader.loadTextureInfoAsync(`${y}/diffuseTransmissionColorTexture`,l.diffuseTransmissionColorTexture).then((y=>{y.name=`${A.name} (Diffuse Transmission Color)`,w.subSurface.translucencyColorTexture=y}))),Promise.all(p).then((()=>{}))}}J(dy),V(dy,!0,(y=>new yc(y)));const cc="KHR_materials_volume";class Ac{constructor(y){this.name=cc,this.order=173,this._loader=y,this.enabled=this._loader.isExtensionUsed(cc),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadVolumePropertiesAsync(l,c,A,w)),await Promise.all(N).then((()=>{}))}))}_loadVolumePropertiesAsync(y,c,A,l){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);if(!A.subSurface.isRefractionEnabled&&!A.subSurface.isTranslucencyEnabled||!l.thicknessFactor)return Promise.resolve();A.subSurface.volumeIndexOfRefraction=A.indexOfRefraction;const w=void 0!==l.attenuationDistance?l.attenuationDistance:Number.MAX_VALUE;return A.subSurface.tintColorAtDistance=w,void 0!==l.attenuationColor&&3==l.attenuationColor.length&&A.subSurface.tintColor.Ec(l.attenuationColor[0],l.attenuationColor[1],l.attenuationColor[2]),A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=l.thicknessFactor,A.subSurface.useThicknessAsDepth=!0,l.thicknessTexture?(l.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${y}/thicknessTexture`,l.thicknessTexture).then((y=>{y.name=`${A.name} (Thickness)`,A.subSurface.thicknessTexture=y,A.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}J(cc),V(cc,!0,(y=>new Ac(y)));const lc="KHR_materials_dispersion";class wc{constructor(y){this.name=lc,this.order=174,this._loader=y,this.enabled=this._loader.isExtensionUsed(lc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadDispersionPropertiesAsync(l,c,A,w)),await Promise.all(N).then((()=>{}))}))}_loadDispersionPropertiesAsync(y,c,A,l){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);return A.subSurface.isRefractionEnabled&&l.dispersion?(A.subSurface.isDispersionEnabled=!0,A.subSurface.dispersion=l.dispersion,Promise.resolve()):Promise.resolve()}}J(lc),V(lc,!0,(y=>new wc(y)));const Nc="EXT_materials_diffuse_roughness";class pc{constructor(y){this.name=Nc,this.order=190,this._loader=y,this.enabled=this._loader.isExtensionUsed(Nc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(y,c,A)),N.push(this._loadDiffuseRoughnessPropertiesAsync(l,w,A)),await Promise.all(N).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(y,c,A){if(!(A instanceof s.c))throw new Error(`${y}: Material type not supported`);const l=new Array;return A.brdf.baseDiffuseModel=Yy.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=c.diffuseRoughnessFactor?A.baseDiffuseRoughness=c.diffuseRoughnessFactor:A.baseDiffuseRoughness=0,c.diffuseRoughnessTexture&&l.push(this._loader.loadTextureInfoAsync(`${y}/diffuseRoughnessTexture`,c.diffuseRoughnessTexture,(y=>{y.name=`${A.name} (Diffuse Roughness)`,A.baseDiffuseRoughnessTexture=y}))),Promise.all(l).then((()=>{}))}}J(Nc),V(Nc,!0,(y=>new pc(y)));const Wc="KHR_mesh_quantization";class hc{constructor(y){this.name=Wc,this.enabled=y.isExtensionUsed(Wc)}dispose(){}}J(Wc),V(Wc,!0,(y=>new hc(y)));const Ic="KHR_texture_basisu";class qc{constructor(y){this.name=Ic,this._loader=y,this.enabled=y.isExtensionUsed(Ic)}dispose(){this._loader=null}_loadTextureAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>{const N=void 0==c.sampler?x.DefaultSampler:Y.Get(`${y}/sampler`,this._loader.uc.samplers,c.sampler),p=Y.Get(`${l}/source`,this._loader.uc.images,w.source);return await this._loader._createTextureAsync(y,N,p,(y=>{A(y)}),c._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!c._textureInfo.nonColorData)}))}}J(Ic),V(Ic,!0,(y=>new qc(y)));const oc="KHR_texture_transform";class Oc{constructor(y){this.name=oc,this._loader=y,this.enabled=this._loader.isExtensionUsed(oc)}dispose(){this._loader=null}loadTextureInfoAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(l,w)=>await this._loader.loadTextureInfoAsync(y,c,(y=>{if(!(y instanceof B.d))throw new Error(`${l}: Texture type not supported`);w.offset&&(y.uOffset=w.offset[0],y.vOffset=w.offset[1]),y.uRotationCenter=0,y.vRotationCenter=0,w.rotation&&(y.wAng=-w.rotation),w.scale&&(y.uScale=w.scale[0],y.vScale=w.scale[1]),void 0!=w.texCoord&&(y.coordinatesIndex=w.texCoord),A(y)}))))}}J(oc),V(oc,!0,(y=>new Oc(y)));const Lc="KHR_xmp_json_ld";class ic{constructor(y){this.name=Lc,this.order=100,this._loader=y,this.enabled=this._loader.isExtensionUsed(Lc)}dispose(){this._loader=null}onLoading(){var y,c,A;if(null===this._loader.rootBabylonMesh)return;const l=null===(y=this._loader.uc.extensions)||void 0===y?void 0:y.KHR_xmp_json_ld,w=null===(c=this._loader.uc.asset)||void 0===c||null===(A=c.extensions)||void 0===A?void 0:A.KHR_xmp_json_ld;if(l&&w){const y=+w.packet;l.packets&&y<l.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=l.packets[y])}}}function Hc(y,c,A,l){return N.dc.yA(c,A).scale(l)}function Pc(y,c,A,l){return c[A]*l}function Dc(y,c,A,l){return-c[A]*l}function tc(y,c,A,l){return c[A+1]*l}function sc(y,c,A,l){return c[A]*l*2}function Bc(y){return{scale:[new Cc(O.b.ANIMATIONTYPE_FLOAT,`${y}.uScale`,Pc,(()=>2)),new Cc(O.b.ANIMATIONTYPE_FLOAT,`${y}.vScale`,tc,(()=>2))],offset:[new Cc(O.b.ANIMATIONTYPE_FLOAT,`${y}.uOffset`,Pc,(()=>2)),new Cc(O.b.ANIMATIONTYPE_FLOAT,`${y}.vOffset`,tc,(()=>2))],rotation:[new Cc(O.b.ANIMATIONTYPE_FLOAT,`${y}.wAng`,Dc,(()=>1))]}}J(Lc),V(Lc,!0,(y=>new ic(y)));class Xc extends F.AnimationPropertyInfo{buildAnimations(y,c,A,l){return[{babylonAnimatable:y._babylonCamera,babylonAnimation:this._buildAnimation(c,A,l)}]}}class Cc extends F.AnimationPropertyInfo{buildAnimations(y,c,A,l){const w=[];for(const N in y._data)w.push({babylonAnimatable:y._data[N].babylonMaterial,babylonAnimation:this._buildAnimation(c,A,l)});return w}}class Kc extends F.AnimationPropertyInfo{buildAnimations(y,c,A,l){return[{babylonAnimatable:y._babylonLight,babylonAnimation:this._buildAnimation(c,A,l)}]}}(0,U.k)("/cameras/{}/orthographic/xmag",[new Xc(O.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Dc,(()=>1)),new Xc(O.b.ANIMATIONTYPE_FLOAT,"orthoRight",tc,(()=>1))]),(0,U.k)("/cameras/{}/orthographic/ymag",[new Xc(O.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Dc,(()=>1)),new Xc(O.b.ANIMATIONTYPE_FLOAT,"orthoTop",tc,(()=>1))]),(0,U.k)("/cameras/{}/orthographic/zfar",[new Xc(O.b.ANIMATIONTYPE_FLOAT,"maxZ",Pc,(()=>1))]),(0,U.k)("/cameras/{}/orthographic/znear",[new Xc(O.b.ANIMATIONTYPE_FLOAT,"ec",Pc,(()=>1))]),(0,U.k)("/cameras/{}/perspective/yfov",[new Xc(O.b.ANIMATIONTYPE_FLOAT,"fov",Pc,(()=>1))]),(0,U.k)("/cameras/{}/perspective/zfar",[new Xc(O.b.ANIMATIONTYPE_FLOAT,"maxZ",Pc,(()=>1))]),(0,U.k)("/cameras/{}/perspective/znear",[new Xc(O.b.ANIMATIONTYPE_FLOAT,"ec",Pc,(()=>1))]),(0,U.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Cc(O.b.ANIMATIONTYPE_COLOR3,"albedoColor",Hc,(()=>4)),new Cc(O.b.ANIMATIONTYPE_FLOAT,"alpha",(function(y,c,A,l){return c[A+3]*l}),(()=>4))]),(0,U.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"metallic",Pc,(()=>1))]),(0,U.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"roughness",Pc,(()=>1))]);const mA=Bc("albedoTexture");(0,U.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",mA.scale),(0,U.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",mA.offset),(0,U.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",mA.rotation);const Tc=Bc("metallicTexture");(0,U.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Tc.scale),(0,U.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Tc.offset),(0,U.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Tc.rotation),(0,U.k)("/materials/{}/emissiveFactor",[new Cc(O.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Hc,(()=>3))]);const zc=Bc("bumpTexture");(0,U.k)("/materials/{}/normalTexture/scale",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Pc,(()=>1))]),(0,U.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",zc.scale),(0,U.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",zc.offset),(0,U.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",zc.rotation),(0,U.k)("/materials/{}/occlusionTexture/strength",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Pc,(()=>1))]);const Sc=Bc("ambientTexture");(0,U.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Sc.scale),(0,U.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Sc.offset),(0,U.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Sc.rotation);const Mc=Bc("emissiveTexture");(0,U.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Mc.scale),(0,U.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Mc.offset),(0,U.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Mc.rotation),(0,U.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Pc,(()=>1))]);const kc=Bc("anisotropy.texture");(0,U.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",kc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",kc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",kc.rotation),(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Pc,(()=>1))]);const ac=Bc("clearCoat.texture");(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",ac.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",ac.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",ac.rotation);const uc=Bc("clearCoat.bumpTexture");(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",uc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",uc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",uc.rotation);const Gc=Bc("clearCoat.textureRoughness");(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Gc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Gc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Gc.rotation),(0,U.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Pc,(()=>1))]);const jc=Bc("iridescence.texture");(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",jc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",jc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",jc.rotation);const fc=Bc("iridescence.thicknessTexture");(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",fc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",fc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",fc.rotation),(0,U.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Cc(O.b.ANIMATIONTYPE_COLOR3,"sheen.color",Hc,(()=>3))]),(0,U.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Pc,(()=>1))]);const Vc=Bc("sheen.texture");(0,U.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Vc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Vc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Vc.rotation);const Jc=Bc("sheen.textureRoughness");(0,U.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Jc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Jc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Jc.rotation),(0,U.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Cc(O.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Hc,(()=>3))]);const Uc=Bc("metallicReflectanceTexture");(0,U.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Uc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Uc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Uc.rotation);const ec=Bc("reflectanceTexture");(0,U.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ec.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ec.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ec.rotation),(0,U.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Pc,(()=>1))]);const Qc=Bc("subSurface.refractionIntensityTexture");(0,U.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Qc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Qc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Qc.rotation),(0,U.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Cc(O.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Hc,(()=>3))]),(0,U.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Pc,(()=>1))]),(0,U.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Pc,(()=>1))]);const Yc=Bc("subSurface.thicknessTexture");(0,U.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Yc.scale),(0,U.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Yc.offset),(0,U.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Yc.rotation),(0,U.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Cc(O.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Pc,(()=>1))]);const gc=Bc("subSurface.translucencyIntensityTexture");(0,U.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",gc.scale),(0,U.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",gc.offset),(0,U.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",gc.rotation),(0,U.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Cc(O.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Hc,(()=>3))]);const xc=Bc("subSurface.translucencyColorTexture");(0,U.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",xc.scale),(0,U.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",xc.offset),(0,U.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",xc.rotation),(0,U.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new Kc(O.b.ANIMATIONTYPE_COLOR3,"diffuse",Hc,(()=>3))]),(0,U.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Kc(O.b.ANIMATIONTYPE_FLOAT,"intensity",Pc,(()=>1))]),(0,U.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new Kc(O.b.ANIMATIONTYPE_FLOAT,"range",Pc,(()=>1))]),(0,U.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Kc(O.b.ANIMATIONTYPE_FLOAT,"innerAngle",sc,(()=>1))]),(0,U.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Kc(O.b.ANIMATIONTYPE_FLOAT,"angle",sc,(()=>1))]),(0,U.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new Kc(O.b.ANIMATIONTYPE_COLOR3,"diffuse",Hc,(()=>3))]),(0,U.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Kc(O.b.ANIMATIONTYPE_FLOAT,"intensity",Pc,(()=>1))]);const Fc="KHR_animation_pointer";class Rc{constructor(y){this.name=Fc,this._loader=y,this._pathToObjectConverter=(0,U.h)(this._loader.uc)}get enabled(){return this._loader.isExtensionUsed(Fc)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(y,c,A,l,w){var N;const p=null===(N=l.target.extensions)||void 0===N?void 0:N.KHR_animation_pointer;if(!p||!this._pathToObjectConverter)return null;"pointer"!==l.target.path&&H.c.Warn(`${y}/target/path: Value (${l.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=l.target.node&&H.c.Warn(`${y}/target/node: Value (${l.target.node}) must not be present when using the ${this.name} extension`);const W=`${y}/extensions/${this.name}`,h=p.pointer;if(!h)throw new Error(`${W}: Pointer is missing`);try{const N=this._pathToObjectConverter.convert(h);if(!N.info.interpolation)throw new Error(`${W}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(y,c,A,l,{object:N.object,info:N.info.interpolation},w)}catch(I){return H.c.Warn(`${W}/pointer: Invalid pointer (${h}) skipped`),null}}}J(Fc),V(Fc,!0,(y=>new Rc(y)));class rc{constructor(y,c,A){this.frame=y,this.action=c,this.onlyOnce=A,this.isDone=!1}_clone(){return new rc(this.frame,this.action,this.onlyOnce)}}var nc=A(12178),Ec=A(12220),bc=A(12212);class Zc{get loop(){return this._loop}set loop(y){y!==this._loop&&(this._loop=y,this.updateOptions({loop:y}))}get currentTime(){var y;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(y=Ec.b.audioEngine)&&void 0!==y&&y.audioContext&&(this.isPlaying||this.isPaused)){const y=this.isPaused?0:Ec.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+y}return 0}get spatialSound(){return this._spatialSound}set spatialSound(y){if(y==this._spatialSound)return;const c=this.isPlaying;this.pause(),y?(this._spatialSound=y,this._updateSpatialParameters()):this._disableSpatialSound(),c&&this.play()}constructor(y,c,A){var l;let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,W=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new q.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=w.gc.Zero(),this._localDirection=new w.gc(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=y,A=A||i.c.LastCreatedScene)if(this._scene=A,Zc._SceneComponentInitialization(A),this._readyToPlayCallback=N,this._customAttenuationFunction=(y,c,A,l,w)=>c<A?y*(1-c/A):0,W&&(this.autoplay=W.autoplay||!1,this._loop=W.loop||!1,void 0!==W.volume&&(this._volume=W.volume),this._spatialSound=W.spatialSound??!1,this.maxDistance=W.maxDistance??100,this.useCustomAttenuation=W.useCustomAttenuation??!1,this.rolloffFactor=W.rolloffFactor||1,this.refDistance=W.refDistance||1,this.distanceModel=W.distanceModel||"linear",this._playbackRate=W.playbackRate||1,this._streaming=W.streaming??!1,this._length=W.length,this._offset=W.offset),null!==(l=Ec.b.audioEngine)&&void 0!==l&&l.canUseWebAudio&&Ec.b.audioEngine.audioContext){this._soundGain=Ec.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let y=!0;if(c)try{"string"===typeof c?(this._urlType="String",this._url=c):c instanceof ArrayBuffer?this._urlType="ArrayBuffer":c instanceof HTMLMediaElement?this._urlType="MediaElement":c instanceof MediaStream?this._urlType="MediaStream":c instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(c)&&(this._urlType="Array");let A=[],l=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ec.b.audioEngine.audioContext.createMediaElementSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ec.b.audioEngine.audioContext.createMediaStreamSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":c.byteLength>0&&(l=!0,this._soundLoaded(c));break;case"AudioBuffer":this._audioBufferLoaded(c);break;case"String":A.push(c);case"Array":0===A.length&&(A=c);for(let y=0;y<A.length;y++){const c=A[y];if(l=W&&W.skipCodecCheck||-1!==c.indexOf(".mp3",c.length-4)&&Ec.b.audioEngine.isMP3supported||-1!==c.indexOf(".ogg",c.length-4)&&Ec.b.audioEngine.isOGGsupported||-1!==c.indexOf(".wav",c.length-4)||-1!==c.indexOf(".m4a",c.length-4)||-1!==c.indexOf(".mp4",c.length-4)||-1!==c.indexOf("blob:"),l){this._streaming?(this._htmlAudioElement=new Audio(c),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,p.Tools.SetCorsBehavior(c,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(c,(y=>{this._soundLoaded(y)}),void 0,!0,!0,(y=>{y&&H.c.Error("XHR "+y.status+" error on: "+c+"."),H.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:y=!1}y?l||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):H.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(h){H.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Ec.b.audioEngine&&!Ec.b.audioEngine.WarnedWebAudioUnsupported&&(H.c.Error("Web Audio is not supported by your browser."),Ec.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var y;null!==(y=Ec.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(y){var c;null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.audioContext&&(this._audioBuffer=y,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(y){var c;null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.audioContext&&Ec.b.audioEngine.audioContext.decodeAudioData(y,(y=>{this._audioBufferLoaded(y)}),(y=>{H.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+y)}))}setAudioBuffer(y){var c;null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&(this._audioBuffer=y,this._isReadyToPlay=!0)}updateOptions(y){y&&(this.loop=y.loop??this.loop,this.maxDistance=y.maxDistance??this.maxDistance,this.useCustomAttenuation=y.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=y.rolloffFactor??this.rolloffFactor,this.refDistance=y.refDistance??this.refDistance,this.distanceModel=y.distanceModel??this.distanceModel,this._playbackRate=y.playbackRate??this._playbackRate,this._length=y.length??void 0,this.spatialSound=y.spatialSound??this._spatialSound,this._setOffset(y.offset??void 0),this.setVolume(y.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var y;null!==(y=Ec.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&Ec.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Ec.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var y;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(y=this._soundPanner)||void 0===y||y.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var y;null!==(y=Ec.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(y){var c;null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(y),this._isOutputConnected=!0)}setDirectionalCone(y,c,A){c<y?H.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=y,this._coneOuterAngle=c,this._coneOuterGain=A,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(y){if(y!=this._coneInnerAngle){var c;if(this._coneOuterAngle<y)return void H.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=y,null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(y){if(y!=this._coneOuterAngle){var c;if(y<this._coneInnerAngle)return void H.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=y,null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(y){var c;y.equals(this._position)||(this._position.p(y),null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(y){var c;this._localDirection=y,null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const y=this._connectedTransformNode.getWorldMatrix(),c=w.gc.TransformNormal(this._localDirection,y);c.normalize(),this._soundPanner.orientationX.value=c.x,this._soundPanner.orientationY.value=c.y,this._soundPanner.orientationZ.value=c.z}updateDistanceFromListener(){var y;if(null!==(y=Ec.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const y=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.xc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,y,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(y){this._customAttenuationFunction=y}play(y,c,A){var l;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(l=Ec.b.audioEngine)&&void 0!==l&&l.audioContext)try{var w,N;this._clearTimeoutsAndObservers();let l=y?(null===(w=Ec.b.audioEngine)||void 0===w?void 0:w.audioContext.currentTime)+y:null===(N=Ec.b.audioEngine)||void 0===N?void 0:N.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Ec.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const y=()=>{var A;if(null!==(A=Ec.b.audioEngine)&&void 0!==A&&A.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=c??0;const A=this._htmlAudioElement.play();void 0!==A&&A.catch((()=>{var c,A;(null===(c=Ec.b.audioEngine)||void 0===c||c.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(A=Ec.b.audioEngine)||void 0===A?void 0:A.onAudioUnlockedObservable.addOnce((()=>{y()})))}))}else{var l;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(l=Ec.b.audioEngine)||void 0===l?void 0:l.onAudioUnlockedObservable.addOnce((()=>{y()}))}};y()}}else{var p;const w=()=>{var w;if(null!==(w=Ec.b.audioEngine)&&void 0!==w&&w.audioContext){var N;if(A=A||this._length,void 0!==c&&this._setOffset(c),this._soundSource){const y=this._soundSource;y.onended=()=>{y.disconnect()}}if(this._soundSource=null===(N=Ec.b.audioEngine)||void 0===N?void 0:N.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var p;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==c&&(this._soundSource.loopStart=c),void 0!==A&&(this._soundSource.loopEnd=(0|c)+A),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},l=y?(null===(p=Ec.b.audioEngine)||void 0===p?void 0:p.audioContext.currentTime)+y:Ec.b.audioEngine.audioContext.currentTime;const w=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(l,w,this.loop?void 0:A)}}};"suspended"===(null===(p=Ec.b.audioEngine)||void 0===p?void 0:p.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var y;"suspended"===(null===(y=Ec.b.audioEngine)||void 0===y?void 0:y.audioContext.state)?(Ec.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Ec.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{w()})))):w()}),500):w()}this._startTime=l,this.isPlaying=!0,this.isPaused=!1}catch(W){H.c.Error("Error while trying to play audio: "+this.name+", "+W.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(y){var c;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var A;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(A=this._streamingSource)||void 0===A||A.disconnect();this.isPlaying=!1}else if(null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.audioContext&&this._soundSource){const c=y?Ec.b.audioEngine.audioContext.currentTime+y:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(c)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var y;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var c;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(c=this._streamingSource)||void 0===c||c.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(y=Ec.b.audioEngine)&&void 0!==y&&y.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Ec.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(y,c){var A;null!==(A=Ec.b.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._soundGain&&(c&&Ec.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Ec.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Ec.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(y,Ec.b.audioEngine.audioContext.currentTime+c)):this._soundGain.gain.value=y),this._volume=y}setPlaybackRate(y){this._playbackRate=y,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(y){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=y,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=y=>this._onRegisterAfterWorldMatrixUpdate(y),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(y){var c;if(y.getBoundingInfo){const c=y.getBoundingInfo();this.setPosition(c.boundingSphere.centerWorld)}else this.setPosition(y.absolutePosition);null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const y=()=>{(0,bc.e)((()=>this._isReadyToPlay),(()=>{A._audioBuffer=this.getAudioBuffer(),A._isReadyToPlay=!0,A.autoplay&&A.play(0,this._offset,this._length)}),void 0,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},A=new Zc(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&A.setAttenuationFunction(this._customAttenuationFunction),A.setPosition(this._position),A.setPlaybackRate(this._playbackRate),y(),A}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const y={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(y.connectedMeshId=this._connectedTransformNode.id),y.position=this._position.fc(),y.refDistance=this.refDistance,y.distanceModel=this.distanceModel,y.isDirectional=this._isDirectional,y.localDirectionToMesh=this._localDirection.fc(),y.coneInnerAngle=this._coneInnerAngle,y.coneOuterAngle=this._coneOuterAngle,y.coneOuterGain=this._coneOuterGain),y}static Parse(y,c,A,l){const N=y.name;let p;p=y.url?A+y.url:A+N;const W={autoplay:y.autoplay,loop:y.loop,volume:y.volume,spatialSound:y.spatialSound,maxDistance:y.maxDistance,rolloffFactor:y.rolloffFactor,refDistance:y.refDistance,distanceModel:y.distanceModel,playbackRate:y.playbackRate};let h;if(l){const y=()=>{(0,bc.e)((()=>l._isReadyToPlay),(()=>{h._audioBuffer=l.getAudioBuffer(),h._isReadyToPlay=!0,h.autoplay&&h.play(0,h._offset,h._length)}),void 0,300)};h=new Zc(N,new ArrayBuffer(0),c,null,W),y()}else h=new Zc(N,p,c,(()=>{c.removePendingData(h)}),W),c.addPendingData(h);if(y.position){const c=w.gc.yA(y.position);h.setPosition(c)}if(y.isDirectional&&(h.setDirectionalCone(y.coneInnerAngle||360,y.coneOuterAngle||360,y.coneOuterGain||0),y.localDirectionToMesh)){const c=w.gc.yA(y.localDirectionToMesh);h.setLocalDirectionToMesh(c)}if(y.connectedMeshId){const A=c.getMeshById(y.connectedMeshId);A&&h.attachToMesh(A)}return y.metadata&&(h.metadata=y.metadata),h}_setOffset(y){this._offset!==y&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=y)}_clearTimeoutsAndObservers(){var y;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(y=Ec.b.audioEngine)||void 0===y||y.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Zc._SceneComponentInitialization=y=>{throw(0,nc.d)("AudioSceneComponent")},(0,Cy.f)("BABYLON.Sound",Zc);class vc{constructor(y,c,A){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],c.length!==A.length)throw new Error("Sounds length does not equal weights length");this.loop=y,this._weights=A;let l=0;for(const N of A)l+=N;const w=l>0?1/l:0;for(let N=0;N<this._weights.length;N++)this._weights[N]*=w;this._sounds=c;for(const N of this._sounds)N.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(y){if(y!==this._coneInnerAngle){if(this._coneOuterAngle<y)return void H.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=y;for(const c of this._sounds)c.directionalConeInnerAngle=y}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(y){if(y!==this._coneOuterAngle){if(y<this._coneInnerAngle)return void H.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=y;for(const c of this._sounds)c.directionalConeOuterAngle=y}}get volume(){return this._volume}set volume(y){if(y!==this._volume)for(const c of this._sounds)c.setVolume(y)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(y){if(!this.isPaused){this.stop();const y=Math.random();let c=0;for(let A=0;A<this._weights.length;A++)if(c+=this._weights[A],y<=c){this._currentIndex=A;break}}const c=this._sounds[this._currentIndex??0];c.isReady()?c.play(0,this.isPaused?void 0:y):c.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class dc{constructor(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(y=y||i.c.LastCreatedScene)&&(this._scene=y,this.soundCollection=[],this._options=c,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var y;null!==(y=Ec.b.audioEngine)&&void 0!==y&&y.canUseWebAudio&&Ec.b.audioEngine.audioContext&&(this._outputAudioNode=Ec.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Ec.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Ec.b.audioEngine&&Ec.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(y){var c;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&y.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==y.soundTrackId&&(-1===y.soundTrackId?this._scene.mainSoundTrack.removeSound(y):this._scene.soundTracks&&this._scene.soundTracks[y.soundTrackId].removeSound(y)),this.soundCollection.push(y),y.soundTrackId=this.id}removeSound(y){const c=this.soundCollection.indexOf(y);-1!==c&&this.soundCollection.splice(c,1)}setVolume(y){var c;null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=y)}switchPanningModelToHRTF(){var y;if(null!==(y=Ec.b.audioEngine)&&void 0!==y&&y.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var y;if(null!==(y=Ec.b.audioEngine)&&void 0!==y&&y.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToEqualPower()}connectToAnalyser(y){var c;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=y,null!==(c=Ec.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Ec.b.audioEngine.masterGain))}}var yA=A(12584),cA=A(12553),AA=A(12159);Ec.b.AudioEngineFactory=(y,c,A)=>new lA(y,c,A);class lA{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new q.d,this.onAudioLockedObservable=new q.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,AA.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const l=document.createElement("audio");this._hostElement=y,this._audioContext=c,this._audioDestination=A;try{l&&l.canPlayType&&(l.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||l.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(w){}try{l&&l.canPlayType&&l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(w){}}lock(){this._triggerSuspendedState()}unlock(){var y,c;if("running"===(null===(y=this._audioContext)||void 0===y?void 0:y.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(c=this._audioContext)||void 0===c||c.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{H.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var y;null===(y=this._audioContext)||void 0===y||y.addEventListener("statechange",(()=>{var y;this.unlocked&&"running"!==(null===(y=this._audioContext)||void 0===y?void 0:y.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var y;return null!==(y=this._audioContext)&&void 0!==y&&y.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(y){this.canUseWebAudio=!1,H.c.Error("Web Audio: "+y.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(y){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const y=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",c=document.createElement("style");c.appendChild(document.createTextNode(y)),document.getElementsByTagName("head")[0].appendChild(c),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var y;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(y=this._audioContext)||void 0===y||y.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(y){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=y)}connectToAnalyser(y){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=y,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var wA=A(12171);(0,A(13643).d)(yA.b.NAME_AUDIO,((y,c,A,l)=>{let w,N=[];if(A.IL=A.IL||[],void 0!==y.IL&&null!==y.IL)for(let W=0,h=y.IL.length;W<h;W++){var p;const h=y.IL[W];null!==(p=Ec.b.audioEngine)&&void 0!==p&&p.canUseWebAudio?(h.url||(h.url=h.name),N[h.url]?A.IL.push(Zc.Parse(h,c,l,N[h.url])):(w=Zc.Parse(h,c,l),N[h.url]=w,A.IL.push(w))):A.IL.push(new Zc(h.name,null,c))}N=[]})),Object.defineProperty(cA.b.prototype,"mainSoundTrack",{get:function(){let y=this._getComponent(yA.b.NAME_AUDIO);return y||(y=new NA(this),this.sc(y)),this._mainSoundTrack||(this._mainSoundTrack=new dc(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),cA.b.prototype.getSoundByName=function(y){let c;for(c=0;c<this.mainSoundTrack.soundCollection.length;c++)if(this.mainSoundTrack.soundCollection[c].name===y)return this.mainSoundTrack.soundCollection[c];if(this.soundTracks)for(let A=0;A<this.soundTracks.length;A++)for(c=0;c<this.soundTracks[A].soundCollection.length;c++)if(this.soundTracks[A].soundCollection[c].name===y)return this.soundTracks[A].soundCollection[c];return null},Object.defineProperty(cA.b.prototype,"audioEnabled",{get:function(){let y=this._getComponent(yA.b.NAME_AUDIO);return y||(y=new NA(this),this.sc(y)),y.audioEnabled},set:function(y){let c=this._getComponent(yA.b.NAME_AUDIO);c||(c=new NA(this),this.sc(c)),y?c.enableAudio():c.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(cA.b.prototype,"headphone",{get:function(){let y=this._getComponent(yA.b.NAME_AUDIO);return y||(y=new NA(this),this.sc(y)),y.headphone},set:function(y){let c=this._getComponent(yA.b.NAME_AUDIO);c||(c=new NA(this),this.sc(c)),y?c.switchAudioModeForHeadphones():c.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(cA.b.prototype,"audioListenerPositionProvider",{get:function(){let y=this._getComponent(yA.b.NAME_AUDIO);return y||(y=new NA(this),this.sc(y)),y.audioListenerPositionProvider},set:function(y){let c=this._getComponent(yA.b.NAME_AUDIO);if(c||(c=new NA(this),this.sc(c)),y&&"function"!==typeof y)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");c.audioListenerPositionProvider=y},enumerable:!0,configurable:!0}),Object.defineProperty(cA.b.prototype,"audioListenerRotationProvider",{get:function(){let y=this._getComponent(yA.b.NAME_AUDIO);return y||(y=new NA(this),this.sc(y)),y.audioListenerRotationProvider},set:function(y){let c=this._getComponent(yA.b.NAME_AUDIO);if(c||(c=new NA(this),this.sc(c)),y&&"function"!==typeof y)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");c.audioListenerRotationProvider=y},enumerable:!0,configurable:!0}),Object.defineProperty(cA.b.prototype,"audioPositioningRefreshRate",{get:function(){let y=this._getComponent(yA.b.NAME_AUDIO);return y||(y=new NA(this),this.sc(y)),y.audioPositioningRefreshRate},set:function(y){let c=this._getComponent(yA.b.NAME_AUDIO);c||(c=new NA(this),this.sc(c)),c.audioPositioningRefreshRate=y},enumerable:!0,configurable:!0});class NA{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(y){this.name=yA.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new w.gc,this._cachedCameraPosition=new w.gc,this._lastCheck=0,this._invertMatrixTemp=new w.Matrix,this._cameraDirectionTemp=new w.gc,(y=y||i.c.LastCreatedScene)&&(this.Fc=y,y.soundTracks=[],y.IL=[])}register(){this.Fc._afterRenderStage.registerStep(yA.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(y){if(y.IL=[],this.Fc.soundTracks)for(let c=0;c<this.Fc.soundTracks.length;c++){const A=this.Fc.soundTracks[c];for(let c=0;c<A.soundCollection.length;c++)y.IL.push(A.soundCollection[c].serialize())}}addFromContainer(y){if(y.IL)for(const c of y.IL)c.play(),c.autoplay=!0,this.Fc.mainSoundTrack.addSound(c)}removeFromContainer(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(y.IL)for(const A of y.IL)A.stop(),A.autoplay=!1,this.Fc.mainSoundTrack.removeSound(A),c&&A.dispose()}dispose(){const y=this.Fc;if(y._mainSoundTrack&&y.mainSoundTrack.dispose(),y.soundTracks)for(let c=0;c<y.soundTracks.length;c++)y.soundTracks[c].dispose()}disableAudio(){const y=this.Fc;let c;for(this._audioEnabled=!1,Ec.b.audioEngine&&Ec.b.audioEngine.audioContext&&Ec.b.audioEngine.audioContext.suspend(),c=0;c<y.mainSoundTrack.soundCollection.length;c++)y.mainSoundTrack.soundCollection[c].pause();if(y.soundTracks)for(c=0;c<y.soundTracks.length;c++)for(let A=0;A<y.soundTracks[c].soundCollection.length;A++)y.soundTracks[c].soundCollection[A].pause()}enableAudio(){const y=this.Fc;let c;for(this._audioEnabled=!0,Ec.b.audioEngine&&Ec.b.audioEngine.audioContext&&Ec.b.audioEngine.audioContext.resume(),c=0;c<y.mainSoundTrack.soundCollection.length;c++)y.mainSoundTrack.soundCollection[c].isPaused&&y.mainSoundTrack.soundCollection[c].play();if(y.soundTracks)for(c=0;c<y.soundTracks.length;c++)for(let A=0;A<y.soundTracks[c].soundCollection.length;A++)y.soundTracks[c].soundCollection[A].isPaused&&y.soundTracks[c].soundCollection[A].play()}switchAudioModeForHeadphones(){const y=this.Fc;if(this._headphone=!0,y.mainSoundTrack.switchPanningModelToHRTF(),y.soundTracks)for(let c=0;c<y.soundTracks.length;c++)y.soundTracks[c].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const y=this.Fc;if(this._headphone=!1,y.mainSoundTrack.switchPanningModelToEqualPower(),y.soundTracks)for(let c=0;c<y.soundTracks.length;c++)y.soundTracks[c].switchPanningModelToEqualPower()}_afterRender(){const y=wA.d.Now;if(this._lastCheck&&y-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=y;const c=this.Fc;if(!this._audioEnabled||!c._mainSoundTrack||!c.soundTracks||0===c._mainSoundTrack.soundCollection.length&&1===c.soundTracks.length)return;const A=Ec.b.audioEngine;if(A&&A.audioContext){let y,l=c.activeCamera;if(c.activeCameras&&c.activeCameras.length>0&&(l=c.activeCameras[0]),this.audioListenerPositionProvider){const y=this.audioListenerPositionProvider();A.audioContext.listener.setPosition(y.x||0,y.y||0,y.z||0)}else l?this._cachedCameraPosition.equals(l.globalPosition)||(this._cachedCameraPosition.p(l.globalPosition),A.audioContext.listener.setPosition(l.globalPosition.x,l.globalPosition.y,l.globalPosition.z)):A.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const y=this.audioListenerRotationProvider();A.audioContext.listener.setOrientation(y.x||0,y.y||0,y.z||0,0,1,0)}else l?(l.rigCameras&&l.rigCameras.length>0&&(l=l.rigCameras[0]),l.getViewMatrix().invertToRef(this._invertMatrixTemp),w.gc.TransformNormalToRef(NA._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),A.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):A.audioContext.listener.setOrientation(0,0,0,0,1,0);for(y=0;y<c.mainSoundTrack.soundCollection.length;y++){const A=c.mainSoundTrack.soundCollection[y];A.useCustomAttenuation&&A.updateDistanceFromListener()}if(c.soundTracks)for(y=0;y<c.soundTracks.length;y++)for(let A=0;A<c.soundTracks[y].soundCollection.length;A++){const l=c.soundTracks[y].soundCollection[A];l.useCustomAttenuation&&l.updateDistanceFromListener()}}}}NA._CameraDirection=new w.gc(0,0,-1),Zc._SceneComponentInitialization=y=>{let c=y._getComponent(yA.b.NAME_AUDIO);c||(c=new NA(y),y.sc(c))};const pA="MSFT_audio_emitter";class WA{constructor(y){this.name=pA,this._loader=y,this.enabled=this._loader.isExtensionUsed(pA)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const y=this._loader.uc.extensions;if(y&&y[this.name]){const c=y[this.name];this._clips=c.clips,this._emitters=c.emitters,Y.Assign(this._clips),Y.Assign(this._emitters)}}loadSceneAsync(y,c){return x.LoadExtensionAsync(y,c,this.name,(async(A,l)=>{const w=new Array;w.push(this._loader.loadSceneAsync(y,c));for(const y of l.emitters){const c=Y.Get(`${A}/emitters`,this._emitters,y);if(void 0!=c.refDistance||void 0!=c.maxDistance||void 0!=c.rolloffFactor||void 0!=c.distanceModel||void 0!=c.innerAngle||void 0!=c.outerAngle)throw new Error(`${A}: Direction or Distance properties are not allowed on emitters attached to a scene`);w.push(this._loadEmitterAsync(`${A}/emitters/${c.index}`,c))}await Promise.all(w)}))}loadNodeAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(y,l)=>{const N=new Array,W=await this._loader.loadNodeAsync(y,c,(c=>{for(const A of l.emitters){const l=Y.Get(`${y}/emitters`,this._emitters,A);N.push(this._loadEmitterAsync(`${y}/emitters/${l.index}`,l).then((()=>{for(const y of l._babylonSounds)y.attachToMesh(c),void 0==l.innerAngle&&void 0==l.outerAngle||(y.setLocalDirectionToMesh(w.gc.Forward()),y.setDirectionalCone(2*p.Tools.ToDegrees(void 0==l.innerAngle?Math.PI:l.innerAngle),2*p.Tools.ToDegrees(void 0==l.outerAngle?Math.PI:l.outerAngle),0))})))}A(c)}));return await Promise.all(N),W}))}loadAnimationAsync(y,c){return x.LoadExtensionAsync(y,c,this.name,(async(A,l)=>{const w=await this._loader.loadAnimationAsync(y,c),N=new Array;Y.Assign(l.events);for(const p of l.events)N.push(this._loadAnimationEventAsync(`${A}/events/${p.index}`,y,c,p,w));return await Promise.all(N),w}))}_loadClipAsync(y,c){if(c._objectURL)return c._objectURL;let A;if(c.uri)A=this._loader.loadUriAsync(y,c,c.uri);else{const l=Y.Get(`${y}/bufferView`,this._loader.uc.bufferViews,c.bufferView);A=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l)}return c._objectURL=A.then((y=>URL.createObjectURL(new Blob([y],{type:c.mimeType})))),c._objectURL}_loadEmitterAsync(y,c){if(c._babylonSounds=c._babylonSounds||[],!c._babylonData){const y=new Array,A=c.name||`emitter${c.index}`,l={loop:!1,autoplay:!1,volume:void 0==c.volume?1:c.volume};for(let N=0;N<c.clips.length;N++){const w=`/extensions/${this.name}/clips`,p=Y.Get(w,this._clips,c.clips[N].clip);y.push(this._loadClipAsync(`${w}/${c.clips[N].clip}`,p).then((y=>{const w=c._babylonSounds[N]=new Zc(A,y,this._loader.babylonScene,null,l);w.refDistance=c.refDistance||1,w.maxDistance=c.maxDistance||256,w.rolloffFactor=c.rolloffFactor||1,w.distanceModel=c.distanceModel||"exponential"})))}const w=Promise.all(y).then((()=>{const y=c.clips.map((y=>y.weight||1)),A=new vc(c.loop||!1,c._babylonSounds,y);c.innerAngle&&(A.directionalConeInnerAngle=2*p.Tools.ToDegrees(c.innerAngle)),c.outerAngle&&(A.directionalConeOuterAngle=2*p.Tools.ToDegrees(c.outerAngle)),c.volume&&(A.volume=c.volume),c._babylonData.sound=A}));c._babylonData={loaded:w}}return c._babylonData.loaded}_getEventAction(y,c,A,l,w){switch(A){case"play":return y=>{const A=(w||0)+(y-l);c.play(A)};case"stop":return()=>{c.stop()};case"pause":return()=>{c.pause()};default:throw new Error(`${y}: Unsupported action ${A}`)}}_loadAnimationEventAsync(y,c,A,l,w){if(0==w.targetedAnimations.length)return Promise.resolve();const N=w.targetedAnimations[0],p=l.Ic,W=Y.Get(`/extensions/${this.name}/emitters`,this._emitters,p);return this._loadEmitterAsync(y,W).then((()=>{const c=W._babylonData.sound;if(c){const A=new rc(l.time,this._getEventAction(y,c,l.action,l.time,l.startOffset));N.animation.addEvent(A),w.onAnimationGroupEndObservable.add((()=>{c.stop()})),w.onAnimationGroupPauseObservable.add((()=>{c.pause()}))}}))}}J(pA),V(pA,!0,(y=>new WA(y)));const hA="MSFT_lod";class IA{constructor(y){var c;this.name=hA,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new q.d,this.onMaterialLODsLoadedObservable=new q.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=y,this.maxLODsToLoad=(null===(c=this._loader.parent.extensionOptions[hA])||void 0===c?void 0:c.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(hA)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let y=0;y<this._nodePromiseLODs.length;y++){const c=Promise.all(this._nodePromiseLODs[y]).then((()=>{0!==y&&(this._loader.endPerformanceCounter(`Node LOD ${y}`),this._loader.log(`Loaded node LOD ${y}`)),this.onNodeLODsLoadedObservable.notifyObservers(y),y!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${y+1}`),this._loadBufferLOD(this._nodeBufferLODs,y+1),this._nodeSignalLODs[y]&&this._nodeSignalLODs[y].resolve())}));this._loader._completePromises.push(c)}for(let y=0;y<this._materialPromiseLODs.length;y++){const c=Promise.all(this._materialPromiseLODs[y]).then((()=>{0!==y&&(this._loader.endPerformanceCounter(`Material LOD ${y}`),this._loader.log(`Loaded material LOD ${y}`)),this.onMaterialLODsLoadedObservable.notifyObservers(y),y!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${y+1}`),this._loadBufferLOD(this._materialBufferLODs,y+1),this._materialSignalLODs[y]&&this._materialSignalLODs[y].resolve())}));this._loader._completePromises.push(c)}}loadSceneAsync(y,c){const A=this._loader.loadSceneAsync(y,c);return this._loadBufferLOD(this._bufferLODs,0),A}loadNodeAsync(y,c,A){return x.LoadExtensionAsync(y,c,this.name,(async(y,w)=>{let N;const p=this._getLODs(y,c,this._loader.uc.nodes,w.ids);this._loader.logOpen(`${y}`);for(let c=0;c<p.length;c++){const y=p[c];0!==c&&(this._nodeIndexLOD=c,this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new l);const w=y=>{A(y),y.ph(!1)},W=this._loader.loadNodeAsync(`/nodes/${y.index}`,y,w).then((y=>{if(0!==c){const y=p[c-1];y._babylonTransformNode&&(this._disposeTransformNode(y._babylonTransformNode),delete y._babylonTransformNode)}return y.ph(!0),y}));this._nodePromiseLODs[c]=this._nodePromiseLODs[c]||[],0===c?N=W:(this._nodeIndexLOD=null,this._nodePromiseLODs[c].push(W))}return this._loader.logClose(),await N}))}_loadMaterialAsync(y,c,A,l,w){return this._nodeIndexLOD?null:x.LoadExtensionAsync(y,c,this.name,(async(y,N)=>{let p;const W=this._getLODs(y,c,this._loader.uc.materials,N.ids);this._loader.logOpen(`${y}`);for(let c=0;c<W.length;c++){const y=W[c];0!==c&&(this._materialIndexLOD=c);const N=this._loader._loadMaterialAsync(`/materials/${y.index}`,y,A,l,(y=>{0===c&&w(y)})).then((y=>{if(0!==c){w(y);const A=W[c-1]._data;A[l]&&(this._disposeMaterials([A[l].babylonMaterial]),delete A[l])}return y}));this._materialPromiseLODs[c]=this._materialPromiseLODs[c]||[],0===c?p=N:(this._materialIndexLOD=null,this._materialPromiseLODs[c].push(N))}return this._loader.logClose(),await p}))}_loadUriAsync(y,c,A){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const w=this._nodeIndexLOD-1;return this._nodeSignalLODs[w]=this._nodeSignalLODs[w]||new l,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(y,c,A)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const w=this._materialIndexLOD-1;return this._materialSignalLODs[w]=this._materialSignalLODs[w]||new l,this._materialSignalLODs[w].promise.then((async()=>await this._loader.loadUriAsync(y,c,A)))}return null}loadBufferAsync(y,c,A,w){if(this._loader.parent.useRangeRequests&&!c.uri){if(!this._loader.bin)throw new Error(`${y}: Uri is missing or the binary glTF is missing its binary chunk`);const c=async(y,c)=>{const N=A,p=N+w-1;let W=y[c];return W?(W.start=Math.min(W.start,N),W.end=Math.max(W.end,p)):(W={start:N,end:p,loaded:new l},y[c]=W),await W.loaded.promise.then((y=>new Uint8Array(y.buffer,y.byteOffset+A-W.start,w)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?c(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?c(this._materialBufferLODs,this._materialIndexLOD):c(this._bufferLODs,0)}return null}_loadBufferLOD(y,c){const A=y[c];A&&(this._loader.log(`Loading buffer range [${A.start}-${A.end}]`),this._loader.bin.readAsync(A.start,A.end-A.start+1).then((y=>{A.loaded.resolve(y)}),(y=>{A.loaded.reject(y)})))}_getLODs(y,c,A,l){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const w=[];for(let N=l.length-1;N>=0;N--)if(w.push(Y.Get(`${y}/ids/${l[N]}`,A,l[N])),w.length===this.maxLODsToLoad)return w;return w.push(c),w}_disposeTransformNode(y){const c=[],A=y.material;A&&c.push(A);for(const w of y.getChildMeshes())w.material&&c.push(w.material);y.dispose();const l=c.filter((y=>this._loader.babylonScene.meshes.every((c=>c.material!=y))));this._disposeMaterials(l)}_disposeMaterials(y){const c={};for(const A of y){for(const y of A.getActiveTextures())c[y.uniqueId]=y;A.dispose()}for(const A in c)for(const y of this._loader.babylonScene.materials)y.hasTexture(c[A])&&delete c[A];for(const A in c)c[A].dispose()}}J(hA),V(hA,!0,(y=>new IA(y)));const qA="MSFT_minecraftMesh";class oA{constructor(y){this.name=qA,this._loader=y,this.enabled=this._loader.isExtensionUsed(qA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtraAsync(y,c,this.name,(async(l,w)=>{if(w){if(!(A instanceof s.c))throw new Error(`${l}: Material type not supported`);const w=this._loader.loadMaterialPropertiesAsync(y,c,A);return A.needAlphaBlending()&&(A.forceDepthWrite=!0,A.separateCullingPass=!0),A.nc=A.forceDepthWrite,A.twoSidedLighting=!0,await w}}))}}J(qA),V(qA,!0,(y=>new oA(y)));const OA="MSFT_sRGBFactors";class LA{constructor(y){this.name=OA,this._loader=y,this.enabled=this._loader.isExtensionUsed(OA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(y,c,A){return x.LoadExtraAsync(y,c,this.name,(async(l,w)=>{if(w){if(!(A instanceof s.c))throw new Error(`${l}: Material type not supported`);const w=this._loader.loadMaterialPropertiesAsync(y,c,A),N=A.mc().getEngine().useExactSrgbConversions;return A.albedoTexture||A.albedoColor.toLinearSpaceToRef(A.albedoColor,N),A.reflectivityTexture||A.reflectivityColor.toLinearSpaceToRef(A.reflectivityColor,N),await w}}))}}J(OA),V(OA,!0,(y=>new LA(y)));var iA=A(13973);const HA={};var PA=A(14023),DA=A(14003),tA=A(13980),sA=A(13993);function BA(y,c){for(const A of y)for(const y of A.dataOutputs)if(y.uniqueId===c)return y;throw new Error("Could not find data out connection with unique id "+c)}function XA(y,c){for(const A of y)if(A instanceof DA.c)for(const y of A.signalInputs)if(y.uniqueId===c)return y;throw new Error("Could not find signal in connection with unique id "+c)}async function CA(y,c){const l=await Promise.all(y.allBlocks.map((async y=>{const c=function(y){switch(y){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([A.e(78),A.e(79)]).then(A.bind(A,15463))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await A.e(80).then(A.bind(A,15465))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await A.e(81).then(A.bind(A,15472))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await A.e(82).then(A.bind(A,15477))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await A.e(83).then(A.bind(A,15479))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await A.e(84).then(A.bind(A,15481))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await A.e(85).then(A.bind(A,15483))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await A.e(86).then(A.bind(A,15486))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await A.e(87).then(A.bind(A,15492))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await A.e(90).then(A.bind(A,15531))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await A.e(90).then(A.bind(A,15531))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await A.e(90).then(A.bind(A,15531))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await A.e(90).then(A.bind(A,15531))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await A.e(95).then(A.bind(A,15534))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await A.e(96).then(A.bind(A,15543))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await A.e(97).then(A.bind(A,15552))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await A.e(98).then(A.bind(A,15561))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await A.e(99).then(A.bind(A,15564))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await A.e(100).then(A.bind(A,15571))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await A.e(101).then(A.bind(A,15580))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await A.e(102).then(A.bind(A,15585))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await A.e(103).then(A.bind(A,15592))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await A.e(104).then(A.bind(A,15596))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await A.e(105).then(A.bind(A,15602))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await A.e(106).then(A.bind(A,15609))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await A.e(107).then(A.bind(A,15615))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await A.e(108).then(A.bind(A,15622))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await A.e(109).then(A.bind(A,15629))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await A.e(110).then(A.bind(A,15635))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await A.e(111).then(A.bind(A,15643))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await A.e(112).then(A.bind(A,15652))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await A.e(113).then(A.bind(A,15654))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await A.e(92).then(A.bind(A,15659))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await A.e(114).then(A.bind(A,15664))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await A.e(115).then(A.bind(A,15669))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await A.e(116).then(A.bind(A,15672))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await A.e(93).then(A.bind(A,15674))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await A.e(88).then(A.bind(A,15497))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await A.e(94).then(A.bind(A,15677))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await A.e(94).then(A.bind(A,15677))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await A.e(94).then(A.bind(A,15677))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await A.e(94).then(A.bind(A,15677))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await A.e(94).then(A.bind(A,15677))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await A.e(94).then(A.bind(A,15677))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await A.e(94).then(A.bind(A,15677))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await A.e(94).then(A.bind(A,15677))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await A.e(89).then(A.bind(A,15525))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await A.e(90).then(A.bind(A,15531))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await A.e(90).then(A.bind(A,15531))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await A.e(91).then(A.bind(A,15680))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await A.e(91).then(A.bind(A,15680))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await A.e(91).then(A.bind(A,15680))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await A.e(91).then(A.bind(A,15680))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await A.e(91).then(A.bind(A,15680))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await A.e(91).then(A.bind(A,15680))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await A.e(117).then(A.bind(A,15683))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await A.e(118).then(A.bind(A,15685))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await A.e(119).then(A.bind(A,15688))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await A.e(120).then(A.bind(A,15691))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await A.e(121).then(A.bind(A,15698))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await A.e(122).then(A.bind(A,15705))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await A.e(123).then(A.bind(A,15709))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await A.e(124).then(A.bind(A,15713))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await A.e(125).then(A.bind(A,15717))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await A.e(126).then(A.bind(A,15724))).FlowGraphDataSwitchBlock;default:if(HA[y])return HA[y];throw new Error(`Unknown block name ${y}`)}}(y.className);return await c()})));return function(y,c,A){const l=c.coordinator.createGraph(),w=[],N=c.valueParseFunction??tA.b;for(let p=0;p<y.allBlocks.length;p++){const W=ml(y.allBlocks[p],{Fc:c.coordinator.config.Fc,pathConverter:c.pathConverter,assetsContainer:c.coordinator.config.Fc,valueParseFunction:N},A[p]);w.push(W),W instanceof PA.b&&l.addEventBlock(W)}for(const p of w){for(const y of p.dataInputs)for(const c of y.connectedPointIds){const A=BA(w,c);y.connectTo(A)}if(p instanceof DA.c)for(const y of p.signalOutputs)for(const c of y.connectedPointIds){const A=XA(w,c);y.connectTo(A)}}for(const p of y.executionContexts)KA(p,{graph:l,valueParseFunction:N},y.rightHanded);return l}(y,c,l)}function KA(y,c,A){const l=c.graph.createContext();y.enableLogging&&(l.enableLogging=!0),l.treatDataAsRightHanded=A||!1;const w=c.valueParseFunction??tA.b;l.uniqueId=y.uniqueId;const N=l.mc();if(y._assetsContext){var p,W,h,I,q,o,O,L,i,H;const c=y._assetsContext,A={meshes:null===(p=c.meshes)||void 0===p?void 0:p.map((y=>N.getMeshById(y))),lights:null===(W=c.lights)||void 0===W?void 0:W.map((y=>N.getLightByName(y))),cameras:null===(h=c.cameras)||void 0===h?void 0:h.map((y=>N.getCameraByName(y))),materials:null===(I=c.materials)||void 0===I?void 0:I.map((y=>N.getMaterialById(y))),textures:null===(q=c.textures)||void 0===q?void 0:q.map((y=>N.getTextureByName(y))),animations:null===(o=c.animations)||void 0===o?void 0:o.map((y=>N.animations.find((c=>c.name===y)))),skeletons:null===(O=c.skeletons)||void 0===O?void 0:O.map((y=>N.getSkeletonByName(y))),MO:null===(L=c.MO)||void 0===L?void 0:L.map((y=>N.getParticleSystemById(y))),animationGroups:null===(i=c.animationGroups)||void 0===i?void 0:i.map((y=>N.getAnimationGroupByName(y))),transformNodes:null===(H=c.transformNodes)||void 0===H?void 0:H.map((y=>N.getTransformNodeById(y))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],IL:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};l.assetsContext=A}for(const P in y._userVariables){const c=w(P,y._userVariables,l.assetsContext,N);l.userVariables[P]=c}for(const P in y._connectionValues){const c=w(P,y._connectionValues,l.assetsContext,N);l._setConnectionValueByKey(P,c)}return l}function ml(y,c,A){const l={},w=c.valueParseFunction??tA.b;if(y.config)for(const p in y.config)l[p]=w(p,y.config,c.assetsContainer||c.Fc,c.Fc);if((0,tA.g)(y.className)){if(!c.pathConverter)throw new Error("Path converter is required for this block");l.pathConverter=c.pathConverter}const N=new A(l);N.uniqueId=y.uniqueId;for(let p=0;p<y.dataInputs.length;p++){const c=N.getDataInput(y.dataInputs[p].name);if(!c)throw new Error("Could not find data input with name "+y.dataInputs[p].name+" in block "+y.className);c.deserialize(y.dataInputs[p])}for(let p=0;p<y.dataOutputs.length;p++){const c=N.getDataOutput(y.dataOutputs[p].name);if(!c)throw new Error("Could not find data output with name "+y.dataOutputs[p].name+" in block "+y.className);c.deserialize(y.dataOutputs[p])}return N.metadata=y.metadata,N.deserialize&&N.deserialize(y),N}function TA(y){const[c,A]=y.split(":");return zA({op:c,extension:A})}function zA(y){var c;let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const l=y.extension?null===(c=MA[y.extension])||void 0===c?void 0:c[y.op]:kA[y.op];if(!l&&(H.c.Warn(`No mapping found for operation ${y.op} and extension ${y.extension||"KHR_interactivity"}`),A)){const c={},A={flows:{}};if(y.inputValueSockets){c.values={};for(const A in y.inputValueSockets)c.values[A]={name:A}}return y.outputValueSockets&&(A.values={},Object.keys(y.outputValueSockets).forEach((y=>{A.values[y]={name:y}}))),{Rq:[],inputs:c,outputs:A}}return l}function SA(y,c,A){MA[c]||(MA[c]={}),MA[c][y]=A}const MA={BABYLON:{"flow/log":{Rq:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},kA={"event/onStart":{Rq:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Rq:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Rq:["FlowGraphSendCustomEventBlock"],extraProcessor(y,c,A,l,w){if("event/send"!==c.op||!y.configuration||1!==Object.keys(y.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const N=y.configuration.event.value[0];if("number"!==typeof N)throw new Error("Event id should be a number");const p=l.arrays.events[N],W=w[0];return W.config||(W.config={}),W.config.eventId=p.eventId,W.config.eventData=p.eventData,w}},"event/receive":{Rq:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(y,c){var A;if(!y.configuration)return H.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const l=y.configuration.event;if(!l)return H.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const w=l.value[0];if("number"!==typeof w)return H.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(A=c.events)||void 0===A?void 0:A[w])?{valid:!0}:(H.c.Error(`Event with id ${w} not found`),{valid:!1,error:`Event with id ${w} not found`})},extraProcessor(y,c,A,l,w){if("event/receive"!==c.op||!y.configuration||1!==Object.keys(y.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const N=y.configuration.event.value[0];if("number"!==typeof N)throw new Error("Event id should be a number");const p=l.arrays.events[N],W=w[0];return W.config||(W.config={}),W.config.eventId=p.eventId,W.config.eventData=p.eventData,w}},"math/e":aA("FlowGraphEBlock"),"math/pi":aA("FlowGraphPIBlock"),"math/inf":aA("FlowGraphInfBlock"),"math/nan":aA("FlowGraphNaNBlock"),"math/abs":aA("FlowGraphAbsBlock"),"math/sign":aA("FlowGraphSignBlock"),"math/trunc":aA("FlowGraphTruncBlock"),"math/floor":aA("FlowGraphFloorBlock"),"math/ceil":aA("FlowGraphCeilBlock"),"math/round":{Rq:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w){var N;return(N=w[0]).config||(N.config={}),w[0].config.roundHalfAwayFromZero=!0,w}},"math/fract":aA("FlowGraphFractBlock"),"math/neg":aA("FlowGraphNegationBlock"),"math/add":aA("FlowGraphAddBlock",["a","b"],!0),"math/sub":aA("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Rq:["FlowGraphMultiplyBlock"],extraProcessor(y,c,A,l,w){var N;(N=w[0]).config||(N.config={}),w[0].config.useMatrixPerComponent=!0,w[0].config.preventIntegerFloatArithmetic=!0;let p=-1;return Object.keys(y.values||{}).find((c=>{var A;return void 0!==(null===(A=y.values)||void 0===A?void 0:A[c].type)&&(p=y.values[c].type,!0)})),-1!==p&&(w[0].config.type=l.arrays.types[p].flowGraphType),w},validation:y=>y.values?uA(y):{valid:!0}},"math/div":aA("FlowGraphDivideBlock",["a","b"],!0),"math/rem":aA("FlowGraphModuloBlock",["a","b"]),"math/min":aA("FlowGraphMinBlock",["a","b"]),"math/max":aA("FlowGraphMaxBlock",["a","b"]),"math/clamp":aA("FlowGraphClampBlock",["a","b","c"]),"math/saturate":aA("FlowGraphSaturateBlock"),"math/mix":aA("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":aA("FlowGraphEqualityBlock",["a","b"]),"math/lt":aA("FlowGraphLessThanBlock",["a","b"]),"math/le":aA("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":aA("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":aA("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":aA("FlowGraphIsNaNBlock"),"math/isinf":aA("FlowGraphIsInfBlock"),"math/select":{Rq:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Rq:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":aA("FlowGraphSinBlock"),"math/cos":aA("FlowGraphCosBlock"),"math/tan":aA("FlowGraphTanBlock"),"math/asin":aA("FlowGraphASinBlock"),"math/acos":aA("FlowGraphACosBlock"),"math/atan":aA("FlowGraphATanBlock"),"math/atan2":aA("FlowGraphATan2Block",["a","b"]),"math/sinh":aA("FlowGraphSinhBlock"),"math/cosh":aA("FlowGraphCoshBlock"),"math/tanh":aA("FlowGraphTanhBlock"),"math/asinh":aA("FlowGraphASinhBlock"),"math/acosh":aA("FlowGraphACoshBlock"),"math/atanh":aA("FlowGraphATanhBlock"),"math/exp":aA("FlowGraphExponentialBlock"),"math/log":aA("FlowGraphLogBlock"),"math/log2":aA("FlowGraphLog2Block"),"math/log10":aA("FlowGraphLog10Block"),"math/sqrt":aA("FlowGraphSquareRootBlock"),"math/cbrt":aA("FlowGraphCubeRootBlock"),"math/pow":aA("FlowGraphPowerBlock",["a","b"]),"math/length":aA("FlowGraphLengthBlock"),"math/normalize":aA("FlowGraphNormalizeBlock"),"math/dot":aA("FlowGraphDotBlock",["a","b"]),"math/cross":aA("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":aA("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":aA("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Rq:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Rq:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Rq:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Rq:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Rq:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Rq:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Rq:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":aA("FlowGraphTransposeBlock"),"math/determinant":aA("FlowGraphDeterminantBlock"),"math/inverse":aA("FlowGraphInvertMatrixBlock"),"math/matmul":aA("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Rq:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"bc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w,N){const p=w[0].dataInputs.find((y=>"rotationQuaternion"===y.name));if(!p)throw new Error("Rotation quaternion input not found");return N._connectionValues[p.uniqueId]&&(N._connectionValues[p.uniqueId].type="Quaternion"),w}},"math/matDecompose":{Rq:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"bc"}}}},"math/quatConjugate":aA("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Rq:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w){var N;return(N=w[0]).config||(N.config={}),w[0].config.type="Quaternion",w}},"math/quatAngleBetween":aA("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Rq:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":aA("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":aA("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Rq:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w){var N;return(N=w[0]).config||(N.config={}),w[0].config.inputIsColumnMajor=!0,w}},"math/extract2x2":{Rq:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Rq:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w){var N;return(N=w[0]).config||(N.config={}),w[0].config.inputIsColumnMajor=!0,w}},"math/extract3x3":{Rq:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Rq:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w){var N;return(N=w[0]).config||(N.config={}),w[0].config.inputIsColumnMajor=!0,w}},"math/extract4x4":{Rq:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Rq:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w,N){var p,W;(W=w[0]).config||(W.config={});const h=w[0].dataInputs[0];return w[0].config.valueType=(null===(p=N._connectionValues[h.uniqueId])||void 0===p?void 0:p.type)??"FlowGraphInteger",w}},"math/and":{Rq:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w,N){var p,W,h;(h=w[0]).config||(h.config={});const I=w[0].dataInputs[0],q=w[0].dataInputs[1];return w[0].config.valueType=(null===(p=N._connectionValues[I.uniqueId])||void 0===p?void 0:p.type)??(null===(W=N._connectionValues[q.uniqueId])||void 0===W?void 0:W.type)??"FlowGraphInteger",w}},"math/or":{Rq:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w,N){var p,W,h;(h=w[0]).config||(h.config={});const I=w[0].dataInputs[0],q=w[0].dataInputs[1];return w[0].config.valueType=(null===(p=N._connectionValues[I.uniqueId])||void 0===p?void 0:p.type)??(null===(W=N._connectionValues[q.uniqueId])||void 0===W?void 0:W.type)??"FlowGraphInteger",w}},"math/xor":{Rq:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(y,c,A,l,w,N){var p,W,h;(h=w[0]).config||(h.config={});const I=w[0].dataInputs[0],q=w[0].dataInputs[1];return w[0].config.valueType=(null===(p=N._connectionValues[I.uniqueId])||void 0===p?void 0:p.type)??(null===(W=N._connectionValues[q.uniqueId])||void 0===W?void 0:W.type)??"FlowGraphInteger",w}},"math/asr":aA("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":aA("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":aA("FlowGraphLeadingZerosBlock"),"math/ctz":aA("FlowGraphTrailingZerosBlock"),"math/popcnt":aA("FlowGraphOneBitsCounterBlock"),"math/rad":aA("FlowGraphDegToRadBlock"),"math/deg":aA("FlowGraphRadToDegBlock"),"type/boolToInt":aA("FlowGraphBooleanToInt"),"type/boolToFloat":aA("FlowGraphBooleanToFloat"),"type/intToBool":aA("FlowGraphIntToBoolean"),"type/intToFloat":aA("FlowGraphIntToFloat"),"type/floatToInt":aA("FlowGraphFloatToInt"),"type/floatToBool":aA("FlowGraphFloatToBoolean"),"flow/sequence":{Rq:["FlowGraphSequenceBlock"],extraProcessor(y,c,A,l,w){const N=w[0];return N.config||(N.config={}),N.config.outputSignalCount=Object.keys(y.flows||[]).length,N.signalOutputs.forEach(((y,c)=>{y.name="out_"+c})),w}},"flow/branch":{Rq:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Rq:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(y){if(y.configuration&&y.configuration.cases){const c=y.configuration.cases.value;if(!c.every((y=>"number"===typeof y&&/^-?\d+$/.test(y.toString()))))return H.c.Warn("Switch cases should be integers. Using empty array instead."),y.configuration.cases.value=[],{valid:!0};const A=new Set(c);y.configuration.cases.value=Array.from(A)}return{valid:!0}},extraProcessor(y,c,A,l,w){if("flow/switch"!==c.op||!y.flows||0===Object.keys(y.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return w[0].signalOutputs.forEach((y=>{"default"!==y.name&&(y.name="out_"+y.name)})),w}},"flow/while":{Rq:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Rq:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(y,c,A,l,w){const N=w[0];return N.config||(N.config={}),N.config.incrementIndexWhenLoopDone=!0,w}},"flow/doN":{Rq:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Rq:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(y,c,A,l,w){if("flow/multiGate"!==c.op||!y.flows||0===Object.keys(y.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const N=w[0];return N.config||(N.config={}),N.config.outputSignalCount=Object.keys(y.flows).length,N.signalOutputs.forEach(((y,c)=>{y.name="out_"+c})),w}},"flow/waitAll":{Rq:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(y){var c,A;return"number"!==typeof(null===(c=y.configuration)||void 0===c||null===(A=c.inputFlows)||void 0===A?void 0:A.value[0])&&(y.configuration=y.configuration||{inputFlows:{value:[0]}},y.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Rq:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Rq:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Rq:["FlowGraphCancelDelayBlock"]},"variable/get":{Rq:["FlowGraphGetVariableBlock"],validation(y){var c,A;return null!==(c=y.configuration)&&void 0!==c&&null!==(A=c.variable)&&void 0!==A&&A.value?{valid:!0}:(H.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(y,c)=>[c.getVariableName(y[0])]}}},"variable/set":{Rq:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(y,c)=>[c.getVariableName(y[0])]}}},"variable/setMultiple":{Rq:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(y,c)=>[y[0].map((y=>c.getVariableName(y)))]}},extraProcessor:(y,c,A,l,w)=>(w[0].dataInputs.forEach((y=>{y.name=l.getVariableName(+y.name)})),w)},"variable/interpolate":{Rq:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(y,c)=>[c.getVariableName(y[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:y=>!0===y[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",yl:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",yl:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",yl:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",yl:"FlowGraphPlayAnimationBlock"},out:{name:"out",yl:"FlowGraphPlayAnimationBlock"},done:{name:"done",yl:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(y,c,A,l,w){var N,p,W;const h=w[0],I=null===(N=y.configuration)||void 0===N?void 0:N.variable.value[0];if("number"!==typeof I)throw H.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const q=l.arrays.staticVariables[I];"undefined"===typeof h.config.animationType.value&&(l.arrays.staticVariables,h.config.animationType.value=(0,sA.O)(q.type));const o=w[4];return o.config||(o.config={}),(p=o.config).variable||(p.variable={}),o.config.variable.value=l.getVariableName(I),(W=w[3]).config||(W.config={}),w}},"pointer/get":{Rq:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",yl:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",yl:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(y,c,A,l,w)=>(w.forEach((y=>{"FlowGraphJsonPointerParserBlock"===y.className&&(y.config||(y.config={}),y.config.outputValue=!0)})),w)},"pointer/set":{Rq:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",yl:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",yl:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(y,c,A,l,w)=>(w.forEach((y=>{"FlowGraphJsonPointerParserBlock"===y.className&&(y.config||(y.config={}),y.config.outputValue=!0)})),w)},"pointer/interpolate":{Rq:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",yl:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",yl:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",yl:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",yl:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",yl:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",yl:"FlowGraphPlayAnimationBlock"},out:{name:"out",yl:"FlowGraphPlayAnimationBlock"},done:{name:"done",yl:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(y,c,A,l,w)=>(w.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className?(c.config||(c.config={}),c.config.outputValue=!0):"FlowGraphInterpolationBlock"===c.className&&(c.config||(c.config={}),Object.keys(y.values||[]).forEach((A=>{var w;const N=null===(w=y.values)||void 0===w?void 0:w[A];if("value"===A&&N){const y=N.type;void 0!==y&&(c.config.animationType=l.arrays.types[y].flowGraphType)}})))})),w)},"animation/start":{Rq:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",yl:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(y,c)=>[y[0]*c._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(y,c)=>[y[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(y,c,A,l,w,N,p){const W=w[w.length-1];return W.config||(W.config={}),W.config.glTF=p,w}},"animation/stop":{Rq:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",yl:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(y,c,A,l,w,N,p){const W=w[w.length-1];return W.config||(W.config={}),W.config.glTF=p,w}},"animation/stopAt":{Rq:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",yl:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(y,c)=>[y[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(y,c,A,l,w,N,p){const W=w[w.length-1];return W.config||(W.config={}),W.config.glTF=p,w}},"math/switch":{Rq:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(y){if(y.configuration&&y.configuration.cases){const c=y.configuration.cases.value;if(!c.every((y=>"number"===typeof y&&/^-?\d+$/.test(y.toString()))))return H.c.Warn("Switch cases should be integers. Using empty array instead."),y.configuration.cases.value=[],{valid:!0};const A=new Set(c);y.configuration.cases.value=Array.from(A)}return{valid:!0}},extraProcessor(y,c,A,l,w){const N=w[0];return N.dataInputs.forEach((y=>{"default"!==y.name&&"case"!==y.name&&(y.name="in_"+y.name)})),N.config||(N.config={}),N.config.treatCasesAsIntegers=!0,w}},"debug/log":{Rq:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function aA(y){let c=arguments.length>2?arguments[2]:void 0;return{Rq:[y],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((y,c)=>(y[c]={name:c},y)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(y,A,l,w,N){var p;if(c){(p=N[0]).config||(p.config={}),N[0].config.preventIntegerFloatArithmetic=!0;let c=-1;Object.keys(y.values||{}).find((A=>{var l;return void 0!==(null===(l=y.values)||void 0===l?void 0:l[A].type)&&(c=y.values[A].type,!0)})),-1!==c&&(N[0].config.type=w.arrays.types[c].flowGraphType)}return N},validation:y=>c?uA(y):{valid:!0}}}function uA(y){if(y.values){const c=Object.keys(y.values).map((c=>y.values[c].type)).filter((y=>void 0!==y));if(!c.every((y=>y===c[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}kA["math/compose"]=kA["math/matCompose"],kA["math/decompose"]=kA["math/matDecompose"];var GA=A(12287);const jA={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"gc",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class fA{constructor(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=y,this._gltf=c,this._animationTargetFps=A,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const y of this._interactivityGraph.types)this._types.push(jA[y.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const y of this._interactivityGraph.declarations){const c=zA(y);if(!c)throw H.c.Error(["No mapping found for declaration",y]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:c,fullOperationName:y.extension?y.op+":"+y.extension:y.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const y of this._interactivityGraph.variables){const c=this._parseVariable(y);this._staticVariables.push(c)}}_parseVariable(y,c){const A=this._types[y.type];if(!A)throw H.c.Error(["No type found for variable",y]),new Error("Error parsing variables");if(y.value&&y.value.length!==A.length)throw H.c.Error(["Invalid value length for variable",y,A]),new Error("Error parsing variables");const l=y.value||[];if(!l.length)switch(A.flowGraphType){case"boolean":l.push(!1);break;case"FlowGraphInteger":l.push(0);break;case"number":l.push(NaN);break;case"Vector2":l.push(NaN,NaN);break;case"gc":l.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":l.fill(NaN,0,4);break;case"Matrix":l.fill(NaN,0,16);break;case"Matrix3D":l.fill(NaN,0,9)}return"number"===A.elementType&&"string"===typeof l[0]&&(l[0]=parseFloat(l[0])),{type:A.flowGraphType,value:c?c(l,this):l}}_parseEvents(){if(this._interactivityGraph.events)for(const y of this._interactivityGraph.events){const c={eventId:y.id||"internalEvent_"+this._internalEventsCounter++};y.values&&(c.eventData=Object.keys(y.values).map((c=>{var A;const l=null===(A=y.values)||void 0===A?void 0:A[c];if(!l)throw H.c.Error(["No value found for event key",c]),new Error("Error parsing events");const w=this._types[l.type];if(!w)throw H.c.Error(["No type found for event value",l]),new Error("Error parsing events");const N="undefined"!==typeof l.value?this._parseVariable(l):void 0;return{id:c,type:w.flowGraphType,eventData:!0,value:N}}))),this._events.push(c)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const c of this._interactivityGraph.nodes){if("number"!==typeof c.declaration)throw H.c.Error(["No declaration found for node",c]),new Error("Error parsing nodes");const A=this._mappings[c.declaration];if(!A)throw H.c.Error(["No mapping found for node",c]),new Error("Error parsing nodes");if(A.flowGraphMapping.validation){const l=A.flowGraphMapping.validation(c,this._interactivityGraph,this._gltf);var y;if(!l.valid)throw new Error(`Error validating interactivity node ${null===(y=this._interactivityGraph.declarations)||void 0===y?void 0:y[c.declaration].op} - ${l.error}`)}const l=[];for(const y of A.flowGraphMapping.Rq){const w=this._getEmptyBlock(y,A.fullOperationName);this._parseNodeConfiguration(c,w,A.flowGraphMapping,y),l.push(w)}this._nodes.push({Rq:l,fullOperationName:A.fullOperationName})}}_getEmptyBlock(y,c){return{uniqueId:(0,GA.e)(),className:y,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:c,metadata:{}}}_parseNodeConfiguration(y,c,A,l){const w=c.config;if(y.configuration){const c=Object.keys(y.configuration);for(const W of c){var N,p;const c=null===(N=y.configuration)||void 0===N?void 0:N[W];if(!c)throw H.c.Error(["No value found for node configuration",W]),new Error("Error parsing node configuration");const h=null===(p=A.configuration)||void 0===p?void 0:p[W];if(h&&h.yl?h.yl===l:0===A.Rq.indexOf(l)){const y=(null===h||void 0===h?void 0:h.name)||W;c&&"undefined"!==typeof c.value||"undefined"===typeof(null===h||void 0===h?void 0:h.defaultValue)?c.value.length>=0?w[y]={value:1===c.value.length?c.value[0]:c.value}:H.c.Warn(["Invalid value for node configuration",c]):w[y]={value:h.defaultValue},h&&h.dataTransformer&&(w[y].value=h.dataTransformer([w[y].value],this)[0])}}}}_parseNodeConnections(y){for(let C=0;C<this._nodes.length;C++){var c;const K=null===(c=this._interactivityGraph.nodes)||void 0===c?void 0:c[C];if(!K)throw H.c.Error(["No node found for interactivity node",this._nodes[C]]),new Error("Error parsing node connections");const my=this._nodes[C],T=this._mappings[K.declaration];if(!T)throw H.c.Error(["No mapping found for node",K]),new Error("Error parsing node connections");const z=K.flows||{},S=Object.keys(z).sort();for(const y of S){var A,l,w,N;const c=z[y],I=null===(A=T.flowGraphMapping.outputs)||void 0===A||null===(l=A.flows)||void 0===l?void 0:l[y],q=(null===I||void 0===I?void 0:I.name)||y,o=this._createNewSocketConnection(q,!0);(I&&I.yl&&my.Rq.find((y=>y.className===I.yl))||my.Rq[0]).signalOutputs.push(o);const O=c.node,L=this._nodes[O];if(!L)throw H.c.Error(["No node found for input node id",O]),new Error("Error parsing node connections");const i=TA(L.fullOperationName);if(!i)throw H.c.Error(["No mapping found for input node",L]),new Error("Error parsing node connections");let P=null===(w=i.inputs)||void 0===w||null===(N=w.flows)||void 0===N?void 0:N[c.socket||"in"],D=!1;if(!P)for(const y in null===(p=i.inputs)||void 0===p?void 0:p.flows){var p,W,h;if(y.startsWith("[")&&y.endsWith("]"))D=!0,P=null===(W=i.inputs)||void 0===W||null===(h=W.flows)||void 0===h?void 0:h[y]}const t=P?D?P.name.replace("$1",c.socket||""):P.name:c.socket||"in",s=P&&P.yl&&L.Rq.find((y=>y.className===P.yl))||L.Rq[0];let B=s.signalInputs.find((y=>y.name===t));B||(B=this._createNewSocketConnection(t),s.signalInputs.push(B)),B.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(B.uniqueId)}const M=K.values||{},k=Object.keys(M);for(const c of k){var I,q;const A=M[c];let l=null===(I=T.flowGraphMapping.inputs)||void 0===I||null===(q=I.values)||void 0===q?void 0:q[c],w=!1;if(!l)for(const y in null===(o=T.flowGraphMapping.inputs)||void 0===o?void 0:o.values){var o,O,L;if(y.startsWith("[")&&y.endsWith("]"))w=!0,l=null===(O=T.flowGraphMapping.inputs)||void 0===O||null===(L=O.values)||void 0===L?void 0:L[y]}const N=l?w?l.name.replace("$1",c):l.name:c,p=this._createNewSocketConnection(N);if((l&&l.yl&&my.Rq.find((y=>y.className===l.yl))||my.Rq[0]).dataInputs.push(p),void 0!==A.value){const c=this._parseVariable(A,l&&l.dataTransformer);y._connectionValues[p.uniqueId]=c}else{if("undefined"===typeof A.node)throw H.c.Error(["Invalid value for value connection",A]),new Error("Error parsing node connections");{var i,P,D;const y=A.node,c=A.socket||"value",l=this._nodes[y];if(!l)throw H.c.Error(["No node found for output socket reference",A]),new Error("Error parsing node connections");const w=TA(l.fullOperationName);if(!w)throw H.c.Error(["No mapping found for output socket reference",A]),new Error("Error parsing node connections");let N=null===(i=w.outputs)||void 0===i||null===(P=i.values)||void 0===P?void 0:P[c],W=!1;if(!N)for(const A in null===(t=w.outputs)||void 0===t?void 0:t.values){var t,s,B;if(A.startsWith("[")&&A.endsWith("]"))W=!0,N=null===(s=w.outputs)||void 0===s||null===(B=s.values)||void 0===B?void 0:B[A]}const h=N?W?N.name.replace("$1",c):null===(D=N)||void 0===D?void 0:D.name:c,I=N&&N.yl&&l.Rq.find((y=>y.className===N.yl))||l.Rq[0];let q=I.dataOutputs.find((y=>y.name===h));q||(q=this._createNewSocketConnection(h,!0),I.dataOutputs.push(q)),p.connectedPointIds.push(q.uniqueId),q.connectedPointIds.push(p.uniqueId)}}}if(T.flowGraphMapping.interBlockConnectors)for(const y of T.flowGraphMapping.interBlockConnectors){const c=y.input,A=y.output,l=y.isVariable;this._connectFlowGraphNodes(c,A,my.Rq[y.inputBlockIndex],my.Rq[y.outputBlockIndex],l)}if(T.flowGraphMapping.extraProcessor){var X;const c=null===(X=this._interactivityGraph.declarations)||void 0===X?void 0:X[K.declaration];if(!c)throw H.c.Error(["No declaration found for extra processor",K]),new Error("Error parsing node connections");my.Rq=T.flowGraphMapping.extraProcessor(K,c,T.flowGraphMapping,this,my.Rq,y,this._gltf)}}}_createNewSocketConnection(y,c){return{uniqueId:(0,GA.e)(),name:y,_connectionType:c?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(y,c,A,l,w){const N=w?A.dataInputs:A.signalInputs,p=w?l.dataOutputs:l.signalOutputs,W=N.find((c=>c.name===y))||this._createNewSocketConnection(y),h=p.find((y=>y.name===c))||this._createNewSocketConnection(c,!0);N.find((c=>c.name===y))||N.push(W),p.find((y=>y.name===c))||p.push(h),W.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(W.uniqueId)}getVariableName(y){return"staticVariable_"+y}serializeToFlowGraph(){const y={uniqueId:(0,GA.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(y);for(let c=0;c<this._staticVariables.length;c++){const A=this._staticVariables[c];y._userVariables[this.getVariableName(c)]=A}return{rightHanded:!0,allBlocks:this._nodes.reduce(((y,c)=>y.concat(c.Rq)),[]),executionContexts:[y]}}}const VA="KHR_interactivity";class JA{constructor(y){this._loader=y,this.name=VA,this.enabled=this._loader.isExtensionUsed(VA),this._pathConverter=(0,U.h)(this._loader.uc),y._skipStartAnimationStep=!0;const c=y.babylonScene;c&&function(y){(0,U.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!y.activeCamera)return new w.Quaternion(NaN,NaN,NaN,NaN);const c=w.Quaternion.FromRotationMatrix(y.activeCamera.getWorldMatrix()).normalize();return y.useRightHandedSystem||(c.w*=-1,c.x*=-1),c},type:"Quaternion",getTarget:()=>y.activeCamera}),(0,U.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!y.activeCamera)return new w.gc(NaN,NaN,NaN);const c=y.activeCamera.getWorldMatrix().getTranslation();return y.useRightHandedSystem||(c.x*=-1),c},type:"gc",getTarget:()=>y.activeCamera}),(0,U.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:y=>{var c;return(null===(c=y._babylonAnimationGroup)||void 0===c?void 0:c.isPlaying)??!1},type:"boolean",getTarget:y=>y._babylonAnimationGroup}),(0,U.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:y=>{var c;return((null===(c=y._babylonAnimationGroup)||void 0===c?void 0:c.from)??0)/60},type:"number",getTarget:y=>y._babylonAnimationGroup}),(0,U.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:y=>{var c;return((null===(c=y._babylonAnimationGroup)||void 0===c?void 0:c.to)??0)/60},type:"number",getTarget:y=>y._babylonAnimationGroup}),(0,U.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:y=>{var c;return((null===(c=y._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:y=>y._babylonAnimationGroup}),(0,U.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:y=>{var c;return((null===(c=y._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:y=>y._babylonAnimationGroup})}(c)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var y;if(!this._loader.babylonScene||!this._pathConverter)return;const c=this._loader.babylonScene,A=null===(y=this._loader.uc.extensions)||void 0===y?void 0:y.KHR_interactivity;if(!A)return;const l=new iA.d({Fc:c});l.dispatchEventsSynchronously=!1;const w=A.graphs.map((y=>new fA(y,this._loader.uc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(w.map((async y=>await CA(y,{coordinator:l,pathConverter:this._pathConverter})))),l.start()}}var UA;UA=async()=>(await Promise.resolve().then(A.bind(A,14041))).FlowGraphGLTFDataProvider,HA[`${VA}/${"FlowGraphGLTFDataProvider"}`]=UA,J(VA),V(VA,!0,(y=>new JA(y)));const eA="KHR_node_visibility";(0,U.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:y=>{const c=y._babylonTransformNode;return!c||void 0===c.isVisible||c.isVisible},set:(y,c)=>{var A,l;null===(A=c._primitiveBabylonMeshes)||void 0===A||A.forEach((y=>{y.inheritVisibility=!0})),c._babylonTransformNode&&(c._babylonTransformNode.isVisible=y),null===(l=c._primitiveBabylonMeshes)||void 0===l||l.forEach((c=>{c.isVisible=y}))},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class QA{constructor(y){this.name=eA,this._loader=y,this.enabled=y.isExtensionUsed(eA)}async onReady(){var y;null===(y=this._loader.uc.nodes)||void 0===y||y.forEach((y=>{var c,A,l,w;(null===(c=y._primitiveBabylonMeshes)||void 0===c||c.forEach((y=>{y.inheritVisibility=!0})),null!==(A=y.extensions)&&void 0!==A&&A.KHR_node_visibility)&&(!1===(null===(l=y.extensions)||void 0===l?void 0:l.KHR_node_visibility.visible)&&(y._babylonTransformNode&&(y._babylonTransformNode.isVisible=!1),null===(w=y._primitiveBabylonMeshes)||void 0===w||w.forEach((y=>{y.isVisible=!1}))))}))}dispose(){this._loader=null}}J(eA),V(eA,!0,(y=>new QA(y)));const YA="KHR_node_selectability";SA("event/onSelect",YA,{Rq:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",yl:"FlowGraphGetVariableBlock",dataTransformer:y=>["pickedMesh_"+y[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",yl:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(y,c,A,l,w,N,p){var W,h,I,q,o,O;const L=w[w.length-1];L.config=L.config||{},L.config.glTF=p;const i=null===(W=y.configuration)||void 0===W||null===(h=W.nodeIndex)||void 0===h?void 0:h.value[0];if(void 0===i||"number"!==typeof i)throw new Error("nodeIndex not found in configuration");const H="pickedMesh_"+i;return w[1].config.variable=H,N._userVariables[H]={className:"Mesh",id:null===p||void 0===p||null===(I=p.nodes)||void 0===I||null===(q=I[i]._babylonTransformNode)||void 0===q?void 0:q.id,uniqueId:null===p||void 0===p||null===(o=p.nodes)||void 0===o||null===(O=o[i]._babylonTransformNode)||void 0===O?void 0:O.uniqueId},w}}),(0,U.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:y=>{const c=y._babylonTransformNode;return!c||void 0===c.HI||c.HI},set:(y,c)=>{var A;null===(A=c._primitiveBabylonMeshes)||void 0===A||A.forEach((c=>{c.HI=y}))},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"HI"],type:"boolean"});class gA{constructor(y){this.name=YA,this._loader=y,this.enabled=y.isExtensionUsed(YA)}async onReady(){var y;null===(y=this._loader.uc.nodes)||void 0===y||y.forEach((y=>{var c,A,l;null!==(c=y.extensions)&&void 0!==c&&c.KHR_node_selectability&&!1===(null===(A=y.extensions)||void 0===A?void 0:A.KHR_node_selectability.selectable)&&(null===(l=y._babylonTransformNode)||void 0===l||l.getChildMeshes().forEach((y=>{y.HI=!1})))}))}dispose(){this._loader=null}}J(YA),V(YA,!0,(y=>new gA(y)));const xA="KHR_node_hoverability",FA="targetMeshPointerOver_";SA("event/onHoverIn",xA,{Rq:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",yl:"FlowGraphGetVariableBlock",dataTransformer:y=>[FA+y[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",yl:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(y,c,A,l,w,N,p){var W,h,I,q,o,O;const L=w[w.length-1];L.config=L.config||{},L.config.glTF=p;const i=null===(W=y.configuration)||void 0===W||null===(h=W.nodeIndex)||void 0===h?void 0:h.value[0];if(void 0===i||"number"!==typeof i)throw new Error("nodeIndex not found in configuration");const H=FA+i;return w[1].config.variable=H,N._userVariables[H]={className:"Mesh",id:null===p||void 0===p||null===(I=p.nodes)||void 0===I||null===(q=I[i]._babylonTransformNode)||void 0===q?void 0:q.id,uniqueId:null===p||void 0===p||null===(o=p.nodes)||void 0===o||null===(O=o[i]._babylonTransformNode)||void 0===O?void 0:O.uniqueId},w}});const RA="targetMeshPointerOut_";SA("event/onHoverOut",xA,{Rq:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",yl:"FlowGraphGetVariableBlock",dataTransformer:y=>[RA+y[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",yl:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(y,c,A,l,w,N,p){var W,h,I,q,o,O;const L=w[w.length-1];L.config=L.config||{},L.config.glTF=p;const i=null===(W=y.configuration)||void 0===W||null===(h=W.nodeIndex)||void 0===h?void 0:h.value[0];if(void 0===i||"number"!==typeof i)throw new Error("nodeIndex not found in configuration");const H=RA+i;return w[1].config.variable=H,N._userVariables[H]={className:"Mesh",id:null===p||void 0===p||null===(I=p.nodes)||void 0===I||null===(q=I[i]._babylonTransformNode)||void 0===q?void 0:q.id,uniqueId:null===p||void 0===p||null===(o=p.nodes)||void 0===o||null===(O=o[i]._babylonTransformNode)||void 0===O?void 0:O.uniqueId},w}}),(0,U.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:y=>{const c=y._babylonTransformNode;return!c||void 0===c.pointerOverDisableMeshTesting||c.pointerOverDisableMeshTesting},set:(y,c)=>{var A;null===(A=c._primitiveBabylonMeshes)||void 0===A||A.forEach((c=>{c.pointerOverDisableMeshTesting=!y}))},getTarget:y=>y._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class rA{constructor(y){this.name=xA,this._loader=y,this.enabled=y.isExtensionUsed(xA)}async onReady(){var y;null===(y=this._loader.uc.nodes)||void 0===y||y.forEach((y=>{var c,A,l;null!==(c=y.extensions)&&void 0!==c&&c.KHR_node_hoverability&&!1===(null===(A=y.extensions)||void 0===A?void 0:A.KHR_node_hoverability.hoverable)&&(null===(l=y._babylonTransformNode)||void 0===l||l.getChildMeshes().forEach((y=>{y.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}J(xA),V(xA,!0,(y=>new rA(y)));const nA="ExtrasAsMetadata";class EA{_assignExtras(y,c){if(c.extras&&Object.keys(c.extras).length>0){const A=y.metadata=y.metadata||{};(A.uc=A.uc||{}).extras=c.extras}}constructor(y){this.name=nA,this.enabled=!0,this._loader=y}dispose(){this._loader=null}loadNodeAsync(y,c,A){return this._loader.loadNodeAsync(y,c,(y=>{this._assignExtras(y,c),A(y)}))}loadCameraAsync(y,c,A){return this._loader.loadCameraAsync(y,c,(y=>{this._assignExtras(y,c),A(y)}))}createMaterial(y,c,A){const l=this._loader.createMaterial(y,c,A);return this._assignExtras(l,c),l}}J(nA),V(nA,!1,(y=>new EA(y)));A(14041)},13921:(y,c,A)=>{"use strict";A.d(c,{d:()=>u,f:()=>T,h:()=>my,k:()=>z});var l=A(12153),w=A(12144),N=A(13558),p=A(12773),W=A(12737),h=A(12752),I=A(12161),q=A(12184),o=A(12767),O=A(12860),L=A(12775),i=A(12368);class H{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.MO=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.IL=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(y){this._environmentTexture=y}getNodes(){let y=[];y=y.concat(this.meshes),y=y.concat(this.lights),y=y.concat(this.cameras),y=y.concat(this.transformNodes);for(const c of this.skeletons)y=y.concat(c.bones);return y}}class P extends H{}class D{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const y=this.rootNodes;for(const l of y)l.dispose();y.length=0;const c=this.skeletons;for(const l of c)l.dispose();c.length=0;const A=this.animationGroups;for(const l of A)l.dispose();A.length=0}}class t extends H{constructor(y){super(),this._wasAddedToScene=!1,(y=y||q.c.LastCreatedScene)&&(this.Fc=y,this.proceduralTextures=[],y.zc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=y.getEngine().onContextRestoredObservable.add((()=>{for(const y of this.geometries)y._rebuild();for(const y of this.meshes)y._rebuild();for(const y of this.MO)y.rebuild();for(const y of this.textures)y._rebuild()})))}_topologicalSort(y){const c=new Map;for(const p of y)c.set(p.uniqueId,p);const A={dependsOn:new Map,dependedBy:new Map};for(const p of y){const y=p.uniqueId;A.dependsOn.set(y,new Set),A.dependedBy.set(y,new Set)}for(const p of y){const y=p.uniqueId,l=A.dependsOn.get(y);if(p instanceof o.b){const w=p.sourceMesh;c.has(w.uniqueId)&&(l.add(w.uniqueId),A.dependedBy.get(w.uniqueId).add(y))}const w=A.dependedBy.get(y);for(const N of p.getDescendants()){const l=N.uniqueId;if(c.has(l)){w.add(l);A.dependsOn.get(l).add(y)}}}const l=[],w=[];for(const p of y){const y=p.uniqueId;0===A.dependsOn.get(y).size&&(w.push(p),c.delete(y))}const N=w;for(;N.length>0;){const y=N.shift();l.push(y);const w=A.dependedBy.get(y.uniqueId);for(const l of Array.from(w.values())){const w=A.dependsOn.get(l);w.delete(y.uniqueId),0===w.size&&c.get(l)&&(N.push(c.get(l)),c.delete(l))}}return c.size>0&&(I.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),c.forEach((y=>{I.c.Error(y.name)}))),l}_addNodeAndDescendantsToList(y,c,A,l){if(A&&(!l||l(A))&&!c.has(A.uniqueId)){y.push(A),c.add(A.uniqueId);for(const w of A.getDescendants(!0))this._addNodeAndDescendantsToList(y,c,w,l)}}_isNodeInContainer(y){return y instanceof h.c&&-1!==this.meshes.indexOf(y)||(y instanceof W.d&&-1!==this.transformNodes.indexOf(y)||(y instanceof O.b&&-1!==this.lights.indexOf(y)||y instanceof L.c&&-1!==this.cameras.indexOf(y)))}_isValidHierarchy(){for(const y of this.meshes)if(y.parent&&!this._isNodeInContainer(y.parent))return I.c.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;for(const y of this.transformNodes)if(y.parent&&!this._isNodeInContainer(y.parent))return I.c.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;for(const y of this.lights)if(y.parent&&!this._isNodeInContainer(y.parent))return I.c.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;for(const y of this.cameras)if(y.parent&&!this._isNodeInContainer(y.parent))return I.c.Warn(`Node ${y.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||w.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const l={},N={},W=new D,h=[],I=[],q={doNotInstantiate:!0,...A},o=[],O=new Set;for(const w of this.transformNodes)null===w.parent&&this._addNodeAndDescendantsToList(o,O,w,q.predicate);for(const w of this.meshes)null===w.parent&&this._addNodeAndDescendantsToList(o,O,w,q.predicate);const L=this._topologicalSort(o),i=(A,w)=>{if(((c,A)=>{if(l[c.uniqueId]=A.uniqueId,N[A.uniqueId]=A,y&&(A.name=y(c.name)),A instanceof p.b){const y=A;if(y.morphTargetManager){const A=c.morphTargetManager;y.morphTargetManager=A.clone();for(let c=0;c<A.numTargets;c++){const w=A.getTarget(c),p=y.morphTargetManager.getTarget(c);l[w.uniqueId]=p.uniqueId,N[p.uniqueId]=p}}}})(A,w),A.parent){const y=l[A.parent.uniqueId],c=N[y];w.parent=c||A.parent}if(w.position&&A.position&&w.position.p(A.position),w.rotationQuaternion&&A.rotationQuaternion&&w.rotationQuaternion.p(A.rotationQuaternion),w.rotation&&A.rotation&&w.rotation.p(A.rotation),w.bc&&A.bc&&w.bc.p(A.bc),w.material){const p=w;if(p.material)if(c){const c=A.material;if(-1===I.indexOf(c)){let A=c.clone(y?y(c.name):"Clone of "+c.name);if(I.push(c),l[c.uniqueId]=A.uniqueId,N[A.uniqueId]=A,"MultiMaterial"===c.getClassName()){const w=c;for(const c of w.Up)c&&(A=c.clone(y?y(c.name):"Clone of "+c.name),I.push(c),l[c.uniqueId]=A.uniqueId,N[A.uniqueId]=A);w.Up=w.Up.map((y=>y&&N[l[y.uniqueId]]))}}"InstancedMesh"!==p.getClassName()&&(p.material=N[l[c.uniqueId]])}else"MultiMaterial"===p.material.getClassName()?-1===this.Fc.multiMaterials.indexOf(p.material)&&this.Fc.addMultiMaterial(p.material):-1===this.Fc.materials.indexOf(p.material)&&this.Fc.addMaterial(p.material)}null===w.parent&&W.rootNodes.push(w)};for(const w of L)if("InstancedMesh"===w.getClassName()){const y=w,c=y.sourceMesh,A=l[c.uniqueId];i(y,("number"===typeof A?N[A]:c).createInstance(y.name))}else{let y=!0;"Nh"===w.getClassName()||"Node"===w.getClassName()||w.skeleton||!w.getTotalVertices||0===w.getTotalVertices()?y=!1:q.doNotInstantiate&&(y="function"===typeof q.doNotInstantiate?!q.doNotInstantiate(w):!q.doNotInstantiate);const c=y?w.createInstance(`instance of ${w.name}`):w.clone(`Clone of ${w.name}`,null,!0);if(!c)throw new Error(`Could not clone or instantiate node on Asset Container ${w.name}`);i(w,c)}for(const w of this.skeletons){if(q.predicate&&!q.predicate(w))continue;const c=w.clone(y?y(w.name):"Clone of "+w.name);for(const y of this.meshes)if(y.skeleton===w&&!y.isAnInstance){const A=N[l[y.uniqueId]];if(!A||A.isAnInstance)continue;if(A.skeleton=c,-1!==h.indexOf(c))continue;h.push(c);for(const y of c.bones)y._linkedTransformNode&&(y._linkedTransformNode=N[l[y._linkedTransformNode.uniqueId]])}W.skeletons.push(c)}for(const w of this.animationGroups){if(q.predicate&&!q.predicate(w))continue;const c=w.clone(y?y(w.name):"Clone of "+w.name,(y=>N[l[y.uniqueId]]||y));W.animationGroups.push(c)}return W}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||w.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Fc.environmentTexture=this.environmentTexture);for(const y of this.Fc._serializableComponents)y.addFromContainer(this);this.Fc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=[];for(const A of this.cameras)y&&!y(A)||(this.Fc.addCamera(A),c.push(A));for(const A of this.lights)y&&!y(A)||(this.Fc.addLight(A),c.push(A));for(const A of this.meshes)y&&!y(A)||(this.Fc.Gq(A),c.push(A));for(const A of this.skeletons)y&&!y(A)||this.Fc.addSkeleton(A);for(const A of this.animations)y&&!y(A)||this.Fc.addAnimation(A);for(const A of this.animationGroups)y&&!y(A)||this.Fc.addAnimationGroup(A);for(const A of this.multiMaterials)y&&!y(A)||this.Fc.addMultiMaterial(A);for(const A of this.materials)y&&!y(A)||this.Fc.addMaterial(A);for(const A of this.morphTargetManagers)y&&!y(A)||this.Fc.addMorphTargetManager(A);for(const A of this.geometries)y&&!y(A)||this.Fc.addGeometry(A);for(const A of this.transformNodes)y&&!y(A)||(this.Fc.addTransformNode(A),c.push(A));for(const A of this.actionManagers)y&&!y(A)||this.Fc.addActionManager(A);for(const A of this.textures)y&&!y(A)||this.Fc.addTexture(A);for(const A of this.reflectionProbes)y&&!y(A)||this.Fc.addReflectionProbe(A);for(const A of c)A.parent&&-1===this.Fc.getNodes().indexOf(A.parent)&&(A.setParent?A.setParent(null):A.parent=null)}removeAllFromScene(){this._isValidHierarchy()||w.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Fc.environmentTexture&&(this.Fc.environmentTexture=null);for(const y of this.Fc._serializableComponents)y.removeFromContainer(this)}removeFromScene(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const c of this.cameras)y&&!y(c)||this.Fc.removeCamera(c);for(const c of this.lights)y&&!y(c)||this.Fc.removeLight(c);for(const c of this.meshes)y&&!y(c)||this.Fc.uq(c,!0);for(const c of this.skeletons)y&&!y(c)||this.Fc.removeSkeleton(c);for(const c of this.animations)y&&!y(c)||this.Fc.removeAnimation(c);for(const c of this.animationGroups)y&&!y(c)||this.Fc.removeAnimationGroup(c);for(const c of this.multiMaterials)y&&!y(c)||this.Fc.removeMultiMaterial(c);for(const c of this.materials)y&&!y(c)||this.Fc.removeMaterial(c);for(const c of this.morphTargetManagers)y&&!y(c)||this.Fc.removeMorphTargetManager(c);for(const c of this.geometries)y&&!y(c)||this.Fc.removeGeometry(c);for(const c of this.transformNodes)y&&!y(c)||this.Fc.removeTransformNode(c);for(const c of this.actionManagers)y&&!y(c)||this.Fc.removeActionManager(c);for(const c of this.textures)y&&!y(c)||this.Fc.removeTexture(c);for(const c of this.reflectionProbes)y&&!y(c)||this.Fc.removeReflectionProbe(c)}dispose(){const y=this.cameras.slice(0);for(const L of y)L.dispose();this.cameras.length=0;const c=this.lights.slice(0);for(const L of c)L.dispose();this.lights.length=0;const A=this.meshes.slice(0);for(const L of A)L.dispose();this.meshes.length=0;const l=this.skeletons.slice(0);for(const L of l)L.dispose();this.skeletons.length=0;const w=this.animationGroups.slice(0);for(const L of w)L.dispose();this.animationGroups.length=0;const N=this.multiMaterials.slice(0);for(const L of N)L.dispose();this.multiMaterials.length=0;const p=this.materials.slice(0);for(const L of p)L.dispose();this.materials.length=0;const W=this.geometries.slice(0);for(const L of W)L.dispose();this.geometries.length=0;const h=this.transformNodes.slice(0);for(const L of h)L.dispose();this.transformNodes.length=0;const I=this.actionManagers.slice(0);for(const L of I)L.dispose();this.actionManagers.length=0;const q=this.textures.slice(0);for(const L of q)L.dispose();this.textures.length=0;const o=this.reflectionProbes.slice(0);for(const L of o)L.dispose();this.reflectionProbes.length=0;const O=this.morphTargetManagers.slice(0);for(const L of O)L.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const L of this.Fc._serializableComponents)L.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Fc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(y,c,A){if(y&&c)for(const l of y){let y=!0;if(A)for(const c of A)if(l===c){y=!1;break}y&&(c.push(l),l._parentContainer=this)}}moveAllFromScene(y){this._wasAddedToScene=!1,void 0===y&&(y=new P);for(const c in this)Object.prototype.hasOwnProperty.call(this,c)&&(this[c]=this[c]||("_environmentTexture"===c?null:[]),this._moveAssets(this.Fc[c],this[c],y[c]));this.environmentTexture=this.Fc.environmentTexture,this.removeAllFromScene()}createRootMesh(){const y=new p.b("assetContainerRootMesh",this.Fc);for(const c of this.meshes)c.parent||y.addChild(c);return this.meshes.unshift(y),y}mergeAnimationsTo(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.c.LastCreatedScene,c=arguments.length>1?arguments[1]:void 0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!y)return I.c.Error("No scene available to merge animations to"),[];const l=A||(c=>{let A=null;const l=c.animations.length?c.animations[0].targetProperty:"",w=c.name.split(".").join("").split("_primitive")[0];switch(l){case"position":case"rotationQuaternion":A=y.getTransformNodeByName(c.name)||y.getTransformNodeByName(w);break;case"influence":A=y.getMorphTargetByName(c.name)||y.getMorphTargetByName(w);break;default:A=y.getNodeByName(c.name)||y.getNodeByName(w)}return A}),w=this.getNodes();for(const W of w){const y=l(W);if(null!==y){for(const c of W.animations){const A=y.animations.filter((y=>y.targetProperty===c.targetProperty));for(const c of A){const A=y.animations.indexOf(c,0);A>-1&&y.animations.splice(A,1)}}y.animations=y.animations.concat(W.animations)}}const N=[],p=this.animationGroups.slice();for(const W of p){N.push(W.clone(W.name,l));for(const y of W.animatables)y.stop()}for(const W of c){const c=l(W.target);c&&(y.beginAnimation(c,W.fromFrame,W.toFrame,W.loopAnimation,W.speedRatio,W.onAnimationEnd?W.onAnimationEnd:void 0,void 0,!0,void 0,W.onAnimationLoop?W.onAnimationLoop:void 0),y.stopAnimation(W.target))}return N}populateRootNodes(){this.rootNodes.length=0;for(const y of this.meshes)y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y);for(const y of this.transformNodes)y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y);for(const y of this.lights)y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y);for(const y of this.cameras)y.parent||-1!==this.rootNodes.indexOf(y)||this.rootNodes.push(y)}addAllAssetsToContainer(y){if(!y)return;const c=[],A=new Set;for(c.push(y);c.length>0;){const y=c.pop();if(y instanceof p.b?(y.Rc&&-1===this.geometries.indexOf(y.Rc)&&this.geometries.push(y.Rc),this.meshes.push(y)):y instanceof o.b?this.meshes.push(y):y instanceof W.d?this.transformNodes.push(y):y instanceof O.b?this.lights.push(y):y instanceof L.c&&this.cameras.push(y),y instanceof h.c){if(y.material&&-1===this.materials.indexOf(y.material)){this.materials.push(y.material);for(const c of y.material.getActiveTextures())-1===this.textures.indexOf(c)&&this.textures.push(c)}y.skeleton&&-1===this.skeletons.indexOf(y.skeleton)&&this.skeletons.push(y.skeleton),y.morphTargetManager&&-1===this.morphTargetManagers.indexOf(y.morphTargetManager)&&this.morphTargetManagers.push(y.morphTargetManager)}for(const l of y.getChildren())A.has(l)||c.push(l);A.add(y)}this.populateRootNodes()}_getByTags(y,c,A){if(void 0===c)return y;const l=[];for(const w in y){const N=y[w];i.c&&i.c.MatchesQuery(N,c)&&(!A||A(N))&&l.push(N)}return l}getMeshesByTags(y,c){return this._getByTags(this.meshes,y,c)}getCamerasByTags(y,c){return this._getByTags(this.cameras,y,c)}getLightsByTags(y,c){return this._getByTags(this.lights,y,c)}getMaterialsByTags(y,c){return this._getByTags(this.materials,y,c).concat(this._getByTags(this.multiMaterials,y,c))}getTransformNodesByTags(y,c){return this._getByTags(this.transformNodes,y,c)}}var s=A(12197);class B{constructor(y){this.byteOffset=0,this.buffer=y}async loadAsync(y){const c=await this.buffer.readAsync(this.byteOffset,y);this._dataView=new DataView(c.buffer,c.byteOffset,c.byteLength),this._dataByteOffset=0}readUint32(){const y=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,y}readUint8Array(y){const c=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,y);return this._dataByteOffset+=y,this.byteOffset+=y,c}readString(y){return(0,s.g)(this.readUint8Array(y))}skipBytes(y){this._dataByteOffset+=y,this.byteOffset+=y}}var X=A(13926);const C="Z2xURg",K={name:"uc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:y=>-1!==y.indexOf("asset")&&-1!==y.indexOf("version")||y.startsWith("data:base64,"+C)||y.startsWith("data:;base64,"+C)||y.startsWith("data:application/octet-stream;base64,"+C)||y.startsWith("data:model/gltf-binary;base64,"+C)};var my,T,z,S=A(12191),M=A(12193);function k(y,c,A){try{return Promise.resolve(new Uint8Array(y,c,A))}catch(l){return Promise.reject(l)}}!function(y){y[y.AUTO=0]="AUTO",y[y.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(my||(my={})),function(y){y[y.NONE=0]="NONE",y[y.FIRST=1]="FIRST",y[y.ALL=2]="ALL"}(T||(T={})),function(y){y[y.LOADING=0]="LOADING",y[y.READY=1]="READY",y[y.COMPLETE=2]="COMPLETE"}(z||(z={}));class a{constructor(){this.coordinateSystemMode=my.AUTO,this.animationStartMode=T.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=y=>Promise.resolve(y),this.extensionOptions={}}p(y){y&&(this.onParsed=y.onParsed,this.coordinateSystemMode=y.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=y.animationStartMode??this.animationStartMode,this.loadNodeAnimations=y.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=y.loadSkins??this.loadSkins,this.loadMorphTargets=y.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=y.compileMaterials??this.compileMaterials,this.useClipPlane=y.useClipPlane??this.useClipPlane,this.compileShadowGenerators=y.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=y.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=y.useRangeRequests??this.useRangeRequests,this.createInstances=y.createInstances??this.createInstances,this.alwaysComputeBoundingBox=y.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=y.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=y.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=y.skipMaterials??this.skipMaterials,this.useSRGBBuffers=y.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=y.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=y.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=y.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=y.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=y.customRootNode,this.onMeshLoaded=y.onMeshLoaded,this.onSkinLoaded=y.onSkinLoaded,this.onTextureLoaded=y.onTextureLoaded,this.onMaterialLoaded=y.onMaterialLoaded,this.onCameraLoaded=y.onCameraLoaded,this.extensionOptions=y.extensionOptions??this.extensionOptions)}}class u extends a{constructor(y){super(),this.onParsedObservable=new l.d,this.onMeshLoadedObservable=new l.d,this.onSkinLoadedObservable=new l.d,this.onTextureLoadedObservable=new l.d,this.onMaterialLoadedObservable=new l.d,this.onCameraLoadedObservable=new l.d,this.onCompleteObservable=new l.d,this.onErrorObservable=new l.d,this.zc=new l.d,this.onExtensionLoadedObservable=new l.d,this.validate=!1,this.onValidatedObservable=new l.d,this._loader=null,this._state=null,this._requests=new Array,this.name=K.name,this.extensions=K.extensions,this.onLoaderStateChangedObservable=new l.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(y)}set onParsed(y){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),y&&(this._onParsedObserver=this.onParsedObservable.add(y))}set onMeshLoaded(y){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),y&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(y))}set onSkinLoaded(y){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),y&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((c=>y(c.node,c.skinnedNode))))}set onTextureLoaded(y){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),y&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(y))}set onMaterialLoaded(y){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),y&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(y))}set onCameraLoaded(y){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),y&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(y))}set onComplete(y){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(y)}set onError(y){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(y)}set onDispose(y){this._onDisposeObserver&&this.zc.remove(this._onDisposeObserver),this._onDisposeObserver=this.zc.add(y)}set onExtensionLoaded(y){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(y)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(y){this._loggingEnabled!==y&&(this._loggingEnabled=y,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(y){this._capturePerformanceCounters!==y&&(this._capturePerformanceCounters=y,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(y){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(y)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const y of this._requests)y.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=y=>Promise.resolve(y),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.zc.notifyObservers(void 0),this.zc.clear()}loadFile(y,c,A,N,p,W,h,q){if(ArrayBuffer.isView(c))return this._loadBinary(y,c,A,N,h,q),null;this._progressCallback=p;const o=c.name||w.Tools.GetFilename(c);if(W){if(this.useRangeRequests){this.validate&&I.c.Warn("glTF validation is not supported when range requests are enabled");const A={abort:()=>{},onCompleteObservable:new l.d},w={readAsync:(A,l)=>new Promise(((w,N)=>{this._loadFile(y,c,(y=>{w(new Uint8Array(y))}),!0,(y=>{N(y)}),(y=>{y.setRequestHeader("Range",`bytes=${A}-${A+l-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new B(w)).then((y=>{A.onCompleteObservable.notifyObservers(A),N(y)}),h?y=>h(void 0,y):void 0),A}return this._loadFile(y,c,(c=>{this._validate(y,new Uint8Array(c,0,c.byteLength),A,o),this._unpackBinaryAsync(new B({readAsync:(y,A)=>k(c,y,A),byteLength:c.byteLength})).then((y=>{N(y)}),h?y=>h(void 0,y):void 0)}),!0,h)}return this._loadFile(y,c,(c=>{try{this._validate(y,c,A,o),N({json:this._parseJson(c)})}catch{h&&h()}}),!1,h)}_loadBinary(y,c,A,l,w,N){this._validate(y,new Uint8Array(c.buffer,c.byteOffset,c.byteLength),A,N),this._unpackBinaryAsync(new B({readAsync:(y,A)=>function(y,c,A){try{if(c<0||c>=y.byteLength)throw new RangeError("Offset is out of range.");if(c+A>y.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(y.buffer,y.byteOffset+c,A))}catch(l){return Promise.reject(l)}}(c,y,A),byteLength:c.byteLength})).then((y=>{l(y)}),w?y=>w(void 0,y):void 0)}importMeshAsync(y,c,A,l,w,N){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(A),this._loader.importMeshAsync(y,c,null,A,l,w,N))))}loadAsync(y,c,A,l,w){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${w||""}`),this._loader=this._getLoader(c),this._loader.loadAsync(y,c,A,l,w))))}loadAssetContainerAsync(y,c,A,l,w){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${w||""}`),this._loader=this._getLoader(c);const N=new t(y),p=[];this.onMaterialLoadedObservable.add((y=>{p.push(y)}));const W=[];this.onTextureLoadedObservable.add((y=>{W.push(y)}));const h=[];this.onCameraLoadedObservable.add((y=>{h.push(y)}));const I=[];return this.onMeshLoadedObservable.add((y=>{y.morphTargetManager&&I.push(y.morphTargetManager)})),this._loader.importMeshAsync(null,y,N,c,A,l,w).then((y=>(Array.prototype.push.apply(N.geometries,y.geometries),Array.prototype.push.apply(N.meshes,y.meshes),Array.prototype.push.apply(N.MO,y.MO),Array.prototype.push.apply(N.skeletons,y.skeletons),Array.prototype.push.apply(N.animationGroups,y.animationGroups),Array.prototype.push.apply(N.materials,p),Array.prototype.push.apply(N.textures,W),Array.prototype.push.apply(N.lights,y.lights),Array.prototype.push.apply(N.transformNodes,y.transformNodes),Array.prototype.push.apply(N.cameras,h),Array.prototype.push.apply(N.morphTargetManagers,I),N)))}))}canDirectLoad(y){return K.canDirectLoad(y)}directLoad(y,c){if(c.startsWith("base64,"+C)||c.startsWith(";base64,"+C)||c.startsWith("application/octet-stream;base64,"+C)||c.startsWith("model/gltf-binary;base64,"+C)){const A=(0,S.d)(c);return this._validate(y,new Uint8Array(A,0,A.byteLength)),this._unpackBinaryAsync(new B({readAsync:(y,c)=>k(A,y,c),byteLength:A.byteLength}))}return this._validate(y,c),Promise.resolve({json:this._parseJson(c)})}createPlugin(y){return new u(y[K.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((y,c)=>{this.onCompleteObservable.addOnce((()=>{y()})),this.onErrorObservable.addOnce((y=>{c(y)}))}))}_setState(y){this._state!==y&&(this._state=y,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(z[this._state]))}_loadFile(y,c,A,l,w,N){const p=y._loadFile(c,A,(y=>{this._onProgress(y,p)}),!0,l,w,N);return p.onCompleteObservable.add((()=>{p._lengthComputable=!0,p._total=p._loaded})),this._requests.push(p),p}_onProgress(y,c){if(!this._progressCallback)return;c._lengthComputable=y.lengthComputable,c._loaded=y.loaded,c._total=y.total;let A=!0,l=0,w=0;for(const N of this._requests){if(void 0===N._lengthComputable||void 0===N._loaded||void 0===N._total)return;A=A&&N._lengthComputable,l+=N._loaded,w+=N._total}this._progressCallback({lengthComputable:A,loaded:l,total:A?w:0})}_validate(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),X.d.ValidateAsync(c,A,l,(c=>this.preprocessUrlAsync(A+c).then((c=>y._loadFileAsync(c,void 0,!0,!0).then((y=>new Uint8Array(y,0,y.byteLength))))))).then((y=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(y),this.onValidatedObservable.clear()}),(y=>{this._endPerformanceCounter("Validate JSON"),w.Tools.Warn(`Failed to validate: ${y.message}`),this.onValidatedObservable.clear()})))}_getLoader(y){const c=y.json.asset||{};this._log(`Asset version: ${c.version}`),c.minVersion&&this._log(`Asset minimum version: ${c.minVersion}`),c.generator&&this._log(`Asset generator: ${c.generator}`);const A=u._parseVersion(c.version);if(!A)throw new Error("Invalid version: "+c.version);if(void 0!==c.minVersion){const y=u._parseVersion(c.minVersion);if(!y)throw new Error("Invalid minimum version: "+c.minVersion);if(u._compareVersion(y,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+c.minVersion)}const l={1:u._CreateGLTF1Loader,2:u._CreateGLTF2Loader}[A.major];if(!l)throw new Error("Unsupported version: "+c.version);return l(this)}_parseJson(y){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${y.length}`);const c=JSON.parse(y);return this._endPerformanceCounter("Parse JSON"),c}_unpackBinaryAsync(y){return this._startPerformanceCounter("Unpack Binary"),y.loadAsync(20).then((()=>{const c=y.readUint32();if(1179937895!==c)throw new M.f("Unexpected magic: "+c,M.d.GLTFLoaderUnexpectedMagicError);const A=y.readUint32();this.loggingEnabled&&this._log(`Binary version: ${A}`);const l=y.readUint32();let w;switch(this.useRangeRequests||l===y.buffer.byteLength||I.c.Warn(`Length in header does not match actual data length: ${l} != ${y.buffer.byteLength}`),A){case 1:w=this._unpackBinaryV1Async(y,l);break;case 2:w=this._unpackBinaryV2Async(y,l);break;default:throw new Error("Unsupported version: "+A)}return this._endPerformanceCounter("Unpack Binary"),w}))}_unpackBinaryV1Async(y,c){const A=y.readUint32(),l=y.readUint32();if(0!==l)throw new Error(`Unexpected content format: ${l}`);const w=c-y.byteOffset,N={json:this._parseJson(y.readString(A)),bin:null};if(0!==w){const c=y.byteOffset;N.bin={readAsync:(A,l)=>y.buffer.readAsync(c+A,l),byteLength:w}}return Promise.resolve(N)}_unpackBinaryV2Async(y,c){const A=1313821514,l=5130562,w=y.readUint32();if(y.readUint32()!==A)throw new Error("First chunk format is not JSON");return y.byteOffset+w===c?y.loadAsync(w).then((()=>({json:this._parseJson(y.readString(w)),bin:null}))):y.loadAsync(w+8).then((()=>{const N={json:this._parseJson(y.readString(w)),bin:null},p=()=>{const w=y.readUint32();switch(y.readUint32()){case A:throw new Error("Unexpected JSON chunk");case l:{const c=y.byteOffset;N.bin={readAsync:(A,l)=>y.buffer.readAsync(c+A,l),byteLength:w},y.skipBytes(w);break}default:y.skipBytes(w)}return y.byteOffset!==c?y.loadAsync(8).then(p):Promise.resolve(N)};return p()}))}static _parseVersion(y){if("1.0"===y||"1.0.1"===y)return{major:1,minor:0};const c=(y+"").match(/^(\d+)\.(\d+)/);return c?{major:parseInt(c[1]),minor:parseInt(c[2])}:null}static _compareVersion(y,c){return y.major>c.major?1:y.major<c.major?-1:y.minor>c.minor?1:y.minor<c.minor?-1:0}_logOpen(y){this._log(y),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(y){const c=u._logSpaces.substring(0,2*this._logIndentLevel);I.c.Log(`${c}${y}`)}_logDisabled(y){}_startPerformanceCounterEnabled(y){w.Tools.StartPerformanceCounter(y)}_startPerformanceCounterDisabled(y){}_endPerformanceCounterEnabled(y){w.Tools.EndPerformanceCounter(y)}_endPerformanceCounterDisabled(y){}}u.IncrementalLoading=!0,u.HomogeneousCoordinates=!1,u._logSpaces="                                ",(0,N.b)(new u)},13926:(y,c,A)=>{"use strict";A.d(c,{d:()=>p});var l=A(12144);function w(y,c,A,l){const w={externalResourceFunction:l};return A&&(w.uri="file:"===c?A:c+A),ArrayBuffer.isView(y)?GLTFValidator.validateBytes(y,w):GLTFValidator.validateString(y,w)}function N(){const y=[];onmessage=c=>{const A=c.data;switch(A.id){case"init":importScripts(A.url);break;case"validate":w(A.data,A.rootUrl,A.fileName,(c=>new Promise(((A,l)=>{const w=y.length;y.push({resolve:A,reject:l}),postMessage({id:"getExternalResource",index:w,uri:c})})))).then((y=>{postMessage({id:"validate.resolve",value:y})}),(y=>{postMessage({id:"validate.reject",reason:y})}));break;case"getExternalResource.resolve":y[A.index].resolve(A.value);break;case"getExternalResource.reject":y[A.index].reject(A.reason)}}}class p{static ValidateAsync(y,c,A,p){return"function"===typeof Worker?new Promise(((W,h)=>{const I=`${w}(${N})()`,q=URL.createObjectURL(new Blob([I],{type:"application/javascript"})),o=new Worker(q),O=y=>{o.removeEventListener("error",O),o.removeEventListener("message",L),h(y)},L=y=>{const c=y.data;switch(c.id){case"getExternalResource":p(c.uri).then((y=>{o.postMessage({id:"getExternalResource.resolve",index:c.index,value:y},[y.buffer])}),(y=>{o.postMessage({id:"getExternalResource.reject",index:c.index,reason:y})}));break;case"validate.resolve":o.removeEventListener("error",O),o.removeEventListener("message",L),W(c.value),o.terminate();break;case"validate.reject":o.removeEventListener("error",O),o.removeEventListener("message",L),h(c.reason),o.terminate()}};if(o.addEventListener("error",O),o.addEventListener("message",L),o.postMessage({id:"init",url:l.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(y)){const l=y.slice();o.postMessage({id:"validate",data:l,rootUrl:c,fileName:A},[l.buffer])}else o.postMessage({id:"validate",data:y,rootUrl:c,fileName:A})})):(this._LoadScriptPromise||(this._LoadScriptPromise=l.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>w(y,c,A,p))))}}p.Configuration={url:`${l.Tools._DefaultCdnUrl}/gltf_validator.js`}},14498:(y,c,A)=>{"use strict";A.d(c,{b:()=>K});var l=A(12307),w=A(12310),N=A(12363),p=A(12325),W=A(12704),h=A(12625),I=A(12400),q=A(12553),o=A(12283),O=A(12233);A(13670),A(13582),A(13600),A(13589),A(13602),A(13605),A(13608);const L="imageProcessingCompatibility",i="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";O.b.IncludesShadersStore[L]||(O.b.IncludesShadersStore[L]=i);const H="skyPixelShader",P="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";O.b.ShadersStore[H]||(O.b.ShadersStore[H]=P);A(13680),A(13612),A(13620),A(13626),A(13624);const D="skyVertexShader",t="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";O.b.ShadersStore[D]||(O.b.ShadersStore[D]=t);var s=A(12619),B=A(12692),X=A(12683);class C extends W.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class K extends h.b{constructor(y,c){super(y,c),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new p.gc(0,100,0),this.useSunPosition=!1,this.cameraOffset=p.gc.Zero(),this.up=p.gc.Up(),this.dithering=!1,this._cameraPosition=p.gc.Zero(),this._skyOrientation=new p.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(y,c){const A=c._drawWrapper;if(this.isFrozen&&A.effect&&A._wasPreviouslyReady)return!0;c.materialDefines||(c.materialDefines=new C);const l=c.materialDefines,w=this.mc();if(this._isReadyForSubMesh(c))return!0;if((0,X.U)(y,w,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,l),(0,X.L)(y,l,!0,!1),l.IMAGEPROCESSINGPOSTPROCESS!==w.imageProcessingConfiguration.applyByPostProcess&&l.markAsMiscDirty(),l.DITHER!==this.dithering&&l.markAsMiscDirty(),l.isDirty){l.markAsProcessed(),w.resetCachedMaterial();const y=new s.c;l.FOG&&y.addFallback(1,"FOG"),l.IMAGEPROCESSINGPOSTPROCESS=w.imageProcessingConfiguration.applyByPostProcess,l.DITHER=this.dithering;const A=[I.e.PositionKind];l.VERTEXCOLOR&&A.push(I.e.ColorKind);const N="sky",p=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,B.d)(p);const W=l.toString();c.setEffect(w.getEngine().createEffect(N,A,p,[],W,y,this.onCompiled,this.onError),l,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(l._renderId=w.getRenderId(),A._wasPreviouslyReady=!0,!0)}bindForSubMesh(y,c,A){const l=this.mc(),w=A.materialDefines;if(!w)return;const N=A.effect;if(!N)return;this._activeEffect=N,this.bindOnlyWorldMatrix(y),this._activeEffect.setMatrix("viewProjection",l.getTransformMatrix()),this._mustRebind(l,N,A)&&((0,B.g)(N,this,l),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,X.l)(w,N,l)),l.fogEnabled&&c.applyFog&&l.fogMode!==q.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",l.getViewMatrix()),(0,X.f)(l,c,this._activeEffect);const W=l.activeCamera;if(W){const y=W.getWorldMatrix();this._cameraPosition.x=y.m[12],this._cameraPosition.y=y.m[13],this._cameraPosition.z=y.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const y=Math.PI*(this.inclination-.5),c=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(c)*Math.cos(y),this.sunPosition.y=this.distance*Math.sin(-y),this.sunPosition.z=this.distance*Math.sin(c)*Math.cos(y),p.Quaternion.FromUnitVectorsToRef(p.gc.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(c,this._activeEffect,A)}getAnimatables(){return[]}dispose(y){super.dispose(y)}clone(y){return N.d.Clone((()=>new K(y,this.mc())),this)}serialize(){const y=super.serialize();return y.customType="BABYLON.SkyMaterial",y}getClassName(){return"SkyMaterial"}static Parse(y,c,A){return N.d.Parse((()=>new K(y.name,c)),y,c,A)}}(0,l.b)([(0,w.P)()],K.prototype,"luminance",void 0),(0,l.b)([(0,w.P)()],K.prototype,"turbidity",void 0),(0,l.b)([(0,w.P)()],K.prototype,"rayleigh",void 0),(0,l.b)([(0,w.P)()],K.prototype,"mieCoefficient",void 0),(0,l.b)([(0,w.P)()],K.prototype,"mieDirectionalG",void 0),(0,l.b)([(0,w.P)()],K.prototype,"distance",void 0),(0,l.b)([(0,w.P)()],K.prototype,"inclination",void 0),(0,l.b)([(0,w.P)()],K.prototype,"azimuth",void 0),(0,l.b)([(0,w.M)()],K.prototype,"sunPosition",void 0),(0,l.b)([(0,w.P)()],K.prototype,"useSunPosition",void 0),(0,l.b)([(0,w.M)()],K.prototype,"cameraOffset",void 0),(0,l.b)([(0,w.M)()],K.prototype,"up",void 0),(0,l.b)([(0,w.P)()],K.prototype,"dithering",void 0),(0,o.f)("BABYLON.SkyMaterial",K)},12994:(y,c,A)=>{"use strict";function l(y,c){c.headers=y.headers||{},c.statusMessage=y.statusText,c.statusCode=y.status,c.data=y.response}function w(y,c,A){return new Promise((function(w,N){A=A||{};var p,W,h,I=new XMLHttpRequest,q=A.body,o=A.headers||{};for(p in A.timeout&&(I.timeout=A.timeout),I.ontimeout=I.onerror=function(y){y.timeout="timeout"==y.type,N(y)},I.open(y,c.href||c),I.onload=function(){for(h=I.getAllResponseHeaders().trim().split(/[\r\n]+/),l(I,I);W=h.shift();)W=W.split(": "),I.headers[W.shift().toLowerCase()]=W.join(": ");if((W=I.headers["content-type"])&&~W.indexOf("application/json"))try{I.data=JSON.parse(I.data,A.reviver)}catch(y){return l(I,y),N(y)}(I.status>=400?N:w)(I)},typeof FormData<"u"&&q instanceof FormData||q&&"object"==typeof q&&(o["content-type"]="application/json",q=JSON.stringify(q)),I.withCredentials=!!A.withCredentials,o)I.setRequestHeader(p,o[p]);I.send(q)}))}A.r(c),A.d(c,{del:()=>h,get:()=>N,patch:()=>W,post:()=>p,put:()=>I,send:()=>w});var N=w.bind(w,"GET"),p=w.bind(w,"POST"),W=w.bind(w,"PATCH"),h=w.bind(w,"DELETE"),I=w.bind(w,"PUT")},14609:(y,c,A)=>{"use strict";A.d(c,{d:()=>o});const l=.5*(Math.sqrt(3)-1),w=(3-Math.sqrt(3))/6,N=1/3,p=1/6,W=(Math.sqrt(5)-1)/4,h=(5-Math.sqrt(5))/20,I=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),q=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const o=class{constructor(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const c="function"==typeof y?y:function(y){let c=0,A=0,l=0,w=1;const N=function(){let y=4022871197;return function(c){c=c.toString();for(let A=0;A<c.length;A++){y+=c.charCodeAt(A);let l=.02519603282416938*y;y=l>>>0,l-=y,l*=y,y=l>>>0,l-=y,y+=4294967296*l}return 2.3283064365386963e-10*(y>>>0)}}();c=N(" "),A=N(" "),l=N(" "),c-=N(y),c<0&&(c+=1);A-=N(y),A<0&&(A+=1);l-=N(y),l<0&&(l+=1);return function(){const y=2091639*c+2.3283064365386963e-10*w;return c=A,A=l,l=y-(w=0|y)}}(y);this.p=function(y){const c=new Uint8Array(256);for(let A=0;A<256;A++)c[A]=A;for(let A=0;A<255;A++){const l=A+~~(y()*(256-A)),w=c[A];c[A]=c[l],c[l]=w}return c}(c),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let A=0;A<512;A++)this.perm[A]=this.p[255&A],this.permMod12[A]=this.perm[A]%12}noise2D(y,c){const A=this.permMod12,N=this.perm;let p=0,W=0,h=0;const q=(y+c)*l,o=Math.floor(y+q),O=Math.floor(c+q),L=(o+O)*w,i=y-(o-L),H=c-(O-L);let P,D;i>H?(P=1,D=0):(P=0,D=1);const t=i-P+w,s=H-D+w,B=i-1+2*w,X=H-1+2*w,C=255&o,K=255&O;let my=.5-i*i-H*H;if(my>=0){const y=3*A[C+N[K]];my*=my,p=my*my*(I[y]*i+I[y+1]*H)}let T=.5-t*t-s*s;if(T>=0){const y=3*A[C+P+N[K+D]];T*=T,W=T*T*(I[y]*t+I[y+1]*s)}let z=.5-B*B-X*X;if(z>=0){const y=3*A[C+1+N[K+1]];z*=z,h=z*z*(I[y]*B+I[y+1]*X)}return 70*(p+W+h)}noise3D(y,c,A){const l=this.permMod12,w=this.perm;let W,h,q,o;const O=(y+c+A)*N,L=Math.floor(y+O),i=Math.floor(c+O),H=Math.floor(A+O),P=(L+i+H)*p,D=y-(L-P),t=c-(i-P),s=A-(H-P);let B,X,C,K,my,T;D>=t?t>=s?(B=1,X=0,C=0,K=1,my=1,T=0):D>=s?(B=1,X=0,C=0,K=1,my=0,T=1):(B=0,X=0,C=1,K=1,my=0,T=1):t<s?(B=0,X=0,C=1,K=0,my=1,T=1):D<s?(B=0,X=1,C=0,K=0,my=1,T=1):(B=0,X=1,C=0,K=1,my=1,T=0);const z=D-B+p,S=t-X+p,M=s-C+p,k=D-K+2*p,a=t-my+2*p,u=s-T+2*p,G=D-1+.5,j=t-1+.5,f=s-1+.5,V=255&L,J=255&i,U=255&H;let e=.6-D*D-t*t-s*s;if(e<0)W=0;else{const y=3*l[V+w[J+w[U]]];e*=e,W=e*e*(I[y]*D+I[y+1]*t+I[y+2]*s)}let Q=.6-z*z-S*S-M*M;if(Q<0)h=0;else{const y=3*l[V+B+w[J+X+w[U+C]]];Q*=Q,h=Q*Q*(I[y]*z+I[y+1]*S+I[y+2]*M)}let Y=.6-k*k-a*a-u*u;if(Y<0)q=0;else{const y=3*l[V+K+w[J+my+w[U+T]]];Y*=Y,q=Y*Y*(I[y]*k+I[y+1]*a+I[y+2]*u)}let g=.6-G*G-j*j-f*f;if(g<0)o=0;else{const y=3*l[V+1+w[J+1+w[U+1]]];g*=g,o=g*g*(I[y]*G+I[y+1]*j+I[y+2]*f)}return 32*(W+h+q+o)}noise4D(y,c,A,l){const w=this.perm;let N,p,I,o,O;const L=(y+c+A+l)*W,i=Math.floor(y+L),H=Math.floor(c+L),P=Math.floor(A+L),D=Math.floor(l+L),t=(i+H+P+D)*h,s=y-(i-t),B=c-(H-t),X=A-(P-t),C=l-(D-t);let K=0,my=0,T=0,z=0;s>B?K++:my++,s>X?K++:T++,s>C?K++:z++,B>X?my++:T++,B>C?my++:z++,X>C?T++:z++;const S=K>=3?1:0,M=my>=3?1:0,k=T>=3?1:0,a=z>=3?1:0,u=K>=2?1:0,G=my>=2?1:0,j=T>=2?1:0,f=z>=2?1:0,V=K>=1?1:0,J=my>=1?1:0,U=T>=1?1:0,e=z>=1?1:0,Q=s-S+h,Y=B-M+h,g=X-k+h,x=C-a+h,F=s-u+2*h,R=B-G+2*h,r=X-j+2*h,n=C-f+2*h,E=s-V+3*h,b=B-J+3*h,Z=X-U+3*h,v=C-e+3*h,d=s-1+4*h,yy=B-1+4*h,cy=X-1+4*h,Ay=C-1+4*h,ly=255&i,wy=255&H,Ny=255&P,py=255&D;let Wy=.6-s*s-B*B-X*X-C*C;if(Wy<0)N=0;else{const y=w[ly+w[wy+w[Ny+w[py]]]]%32*4;Wy*=Wy,N=Wy*Wy*(q[y]*s+q[y+1]*B+q[y+2]*X+q[y+3]*C)}let hy=.6-Q*Q-Y*Y-g*g-x*x;if(hy<0)p=0;else{const y=w[ly+S+w[wy+M+w[Ny+k+w[py+a]]]]%32*4;hy*=hy,p=hy*hy*(q[y]*Q+q[y+1]*Y+q[y+2]*g+q[y+3]*x)}let Iy=.6-F*F-R*R-r*r-n*n;if(Iy<0)I=0;else{const y=w[ly+u+w[wy+G+w[Ny+j+w[py+f]]]]%32*4;Iy*=Iy,I=Iy*Iy*(q[y]*F+q[y+1]*R+q[y+2]*r+q[y+3]*n)}let qy=.6-E*E-b*b-Z*Z-v*v;if(qy<0)o=0;else{const y=w[ly+V+w[wy+J+w[Ny+U+w[py+e]]]]%32*4;qy*=qy,o=qy*qy*(q[y]*E+q[y+1]*b+q[y+2]*Z+q[y+3]*v)}let oy=.6-d*d-yy*yy-cy*cy-Ay*Ay;if(oy<0)O=0;else{const y=w[ly+1+w[wy+1+w[Ny+1+w[py+1]]]]%32*4;oy*=oy,O=oy*oy*(q[y]*d+q[y+1]*yy+q[y+2]*cy+q[y+3]*Ay)}return 27*(N+p+I+o+O)}}}}]);