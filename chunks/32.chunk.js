/*! For license information please see n181bj.32.35178cf9.chunk.js.LICENSE.txt */
(self["5dou0t7wntc"]=self["5dou0t7wntc"]||[]).push([[32],{13712:(K,O,F)=>{"use strict";var f=F(13717),r=F(13723),l=F(13731);F.g.__TYPEDARRAY_POOL||(F.g.__TYPEDARRAY_POOL={UINT8:r([32,0]),UINT16:r([32,0]),UINT32:r([32,0]),INT8:r([32,0]),INT16:r([32,0]),INT32:r([32,0]),FLOAT:r([32,0]),DOUBLE:r([32,0]),DATA:r([32,0]),UINT8C:r([32,0]),BUFFER:r([32,0])});var q="undefined"!==typeof Uint8ClampedArray,J=F.g.__TYPEDARRAY_POOL;J.UINT8C||(J.UINT8C=r([32,0])),J.BUFFER||(J.BUFFER=r([32,0]));var c=J.DATA,E=J.BUFFER;function M(K){if(K){var O=K.length||K.byteLength,F=f.log2(O);c[F].push(K)}}function t(K){K=f.nextPow2(K);var O=f.log2(K),F=c[O];return F.length>0?F.pop():new ArrayBuffer(K)}function j(K){return new Uint8Array(t(K),0,K)}function X(K){return new Uint16Array(t(2*K),0,K)}function u(K){return new Uint32Array(t(4*K),0,K)}function T(K){return new Int8Array(t(K),0,K)}function o(K){return new Int16Array(t(2*K),0,K)}function k(K){return new Int32Array(t(4*K),0,K)}function N(K){return new Float32Array(t(4*K),0,K)}function Z(K){return new Float64Array(t(8*K),0,K)}function L(K){return q?new Uint8ClampedArray(t(K),0,K):j(K)}function d(K){return new DataView(t(K),0,K)}O.free=function(K){if(l(K))E[f.log2(K.length)].push(K);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(K)&&(K=K.buffer),!K)return;var O=K.length||K.byteLength,F=0|f.log2(O);c[F].push(K)}},O.freeUint8=O.freeUint16=O.freeUint32=O.freeInt8=O.freeInt16=O.freeInt32=O.freeFloat32=O.freeFloat=O.freeFloat64=O.freeDouble=O.freeUint8Clamped=O.freeDataView=function(K){M(K.buffer)},O.freeArrayBuffer=M,O.freeBuffer=function(K){E[f.log2(K.length)].push(K)},O.malloc=function(K,O){if(void 0===O||"arraybuffer"===O)return t(K);switch(O){case"uint8":return j(K);case"uint16":return X(K);case"uint32":return u(K);case"int8":return T(K);case"int16":return o(K);case"int32":return k(K);case"float":case"float32":return N(K);case"double":case"float64":return Z(K);case"uint8_clamped":return L(K);case"buffer":throw"Buffer not supported";case"data":case"dataview":return d(K);default:return null}return null},O.mallocArrayBuffer=t,O.mallocUint8=j,O.mallocUint16=X,O.mallocUint32=u,O.mallocInt8=T,O.mallocInt16=o,O.mallocInt32=k,O.mallocFloat32=O.mallocFloat=N,O.mallocFloat64=O.mallocDouble=Z,O.mallocUint8Clamped=L,O.mallocDataView=d,O.clearCache=function(){for(var K=0;K<32;++K)J.UINT8[K].length=0,J.UINT16[K].length=0,J.UINT32[K].length=0,J.INT8[K].length=0,J.INT16[K].length=0,J.INT32[K].length=0,J.FLOAT[K].length=0,J.DOUBLE[K].length=0,J.UINT8C[K].length=0,c[K].length=0,E[K].length=0}},13807:(K,O,F)=>{K.exports=r;var f=F(12551);function r(K,O){if(!(this instanceof r))return new r(K,O);var F=f.create();f.add(F,K,O),this.base=f.min(f.create(),K,F),this.WM=f.clone(O),this.max=f.max(f.create(),K,F),this.mag=f.length(this.WM)}var l=r.prototype;l.width=function(){return this.WM[0]},l.height=function(){return this.WM[1]},l.depth=function(){return this.WM[2]},l.x0=function(){return this.base[0]},l.y0=function(){return this.base[1]},l.z0=function(){return this.base[2]},l.x1=function(){return this.max[0]},l.y1=function(){return this.max[1]},l.z1=function(){return this.max[2]},l.translate=function(K){return f.add(this.max,this.max,K),f.add(this.base,this.base,K),this},l.setPosition=function(K){return f.add(this.max,K,this.WM),f.i(this.base,K),this},l.expand=function(K){var O=f.create(),F=f.create();return f.max(O,K.max,this.max),f.min(F,K.base,this.base),f.oO(O,O,F),new r(F,O)},l.intersects=function(K){return!(K.base[0]>this.max[0])&&(!(K.base[1]>this.max[1])&&(!(K.base[2]>this.max[2])&&(!(K.max[0]<this.base[0])&&(!(K.max[1]<this.base[1])&&!(K.max[2]<this.base[2])))))},l.touches=function(K){var O=this.union(K);return null!==O&&(0==O.width()||0==O.height()||0==O.depth())},l.union=function(K){if(!this.intersects(K))return null;var O=Math.max(K.base[0],this.base[0]),F=Math.max(K.base[1],this.base[1]),f=Math.max(K.base[2],this.base[2]);return new r([O,F,f],[Math.min(K.max[0],this.max[0])-O,Math.min(K.max[1],this.max[1])-F,Math.min(K.max[2],this.max[2])-f])}},13717:(K,O)=>{"use strict";function F(K){var O=32;return(K&=-K)&&O--,65535&K&&(O-=16),16711935&K&&(O-=8),252645135&K&&(O-=4),858993459&K&&(O-=2),1431655765&K&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(K){return(K>0)-(K<0)},O.abs=function(K){var O=K>>31;return(K^O)-O},O.min=function(K,O){return O^(K^O)&-(K<O)},O.max=function(K,O){return K^(K^O)&-(K<O)},O.isPow2=function(K){return!(K&K-1)&&!!K},O.log2=function(K){var O,F;return O=(K>65535)<<4,O|=F=((K>>>=O)>255)<<3,O|=F=((K>>>=F)>15)<<2,(O|=F=((K>>>=F)>3)<<1)|(K>>>=F)>>1},O.log10=function(K){return K>=1e9?9:K>=1e8?8:K>=1e7?7:K>=1e6?6:K>=1e5?5:K>=1e4?4:K>=1e3?3:K>=100?2:K>=10?1:0},O.popCount=function(K){return 16843009*((K=(858993459&(K-=K>>>1&1431655765))+(K>>>2&858993459))+(K>>>4)&252645135)>>>24},O.countTrailingZeros=F,O.nextPow2=function(K){return K+=0===K,--K,K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)+1},O.prevPow2=function(K){return K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)-(K>>>1)},O.parity=function(K){return K^=K>>>16,K^=K>>>8,K^=K>>>4,27030>>>(K&=15)&1};var f=new Array(256);!function(K){for(var O=0;O<256;++O){var F=O,f=O,r=7;for(F>>>=1;F;F>>>=1)f<<=1,f|=1&F,--r;K[O]=f<<r&255}}(f),O.reverse=function(K){return f[255&K]<<24|f[K>>>8&255]<<16|f[K>>>16&255]<<8|f[K>>>24&255]},O.interleave2=function(K,O){return(K=1431655765&((K=858993459&((K=252645135&((K=16711935&((K&=65535)|K<<8))|K<<4))|K<<2))|K<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(K,O){return(K=65535&((K=16711935&((K=252645135&((K=858993459&((K=K>>>O&1431655765)|K>>>1))|K>>>2))|K>>>4))|K>>>16))<<16>>16},O.interleave3=function(K,O,F){return K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2),(K|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2))<<2},O.deinterleave3=function(K,O){return(K=1023&((K=4278190335&((K=251719695&((K=3272356035&((K=K>>>O&1227133513)|K>>>2))|K>>>4))|K>>>8))|K>>>16))<<22>>22},O.nextCombination=function(K){var O=K|K-1;return O+1|(~O&-~O)-1>>>F(K)+1}},13710:(K,O,F)=>{"use strict";K.exports=function(K,O,F){switch(arguments.length){case 1:return f=[],E(r=K,r,M,!0),f;case 2:return"function"===typeof O?E(K,K,O,!0):function(K,O){return f=[],E(K,O,M,!1),f}(K,O);case 3:return E(K,O,F,!1);default:throw new Error("box-intersect: Invalid arguments")}var r};var f,r=F(13712),l=F(13740),q=F(13750);function J(K,O){for(var F=0;F<K;++F)if(!(O[F]<=O[F+K]))return!0;return!1}function c(K,O,F,f){for(var r=0,l=0,q=0,c=K.length;q<c;++q){var E=K[q];if(!J(O,E)){for(var M=0;M<2*O;++M)F[r++]=E[M];f[l++]=q}}return l}function E(K,O,F,f){var J=K.length,E=O.length;if(!(J<=0||E<=0)){var M=K[0].length>>>1;if(!(M<=0)){var t,j=r.mallocDouble(2*M*J),X=r.mallocInt32(J);if((J=c(K,M,j,X))>0){if(1===M&&f)l.init(J),t=l.sweepComplete(M,F,0,J,j,X,0,J,j,X);else{var u=r.mallocDouble(2*M*E),T=r.mallocInt32(E);(E=c(O,M,u,T))>0&&(l.init(J+E),t=1===M?l.sweepBipartite(M,F,0,J,j,X,0,E,u,T):q(M,F,f,J,j,X,E,u,T),r.free(u),r.free(T))}r.free(j),r.free(X)}return t}}}function M(K,O){f.push([K,O])}},13755:(K,O)=>{"use strict";var F="d",f="ax",r="fp",l="es",q="rs",J="re",c="rb",E="bs",M="be",t="bb",j=[F,f,"vv",q,J,c,"ri",E,M,t,"bi"];function X(K){var O="bruteForce"+(K?"Full":"Partial"),f=[],q=j.slice();K||q.splice(3,0,r);var J=["function "+O+"("+q.join()+"){"];function c(O,r){var q=function(K,O,f){var r="bruteForce"+(K?"Red":"Blue")+(O?"Flip":"")+(f?"Full":""),q=["function ",r,"(",j.join(),"){","var ",l,"=2*",F,";"],J="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",c="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(f?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return K?q.push(J,"Q",":",c):q.push(c,"Q",":",J),f?q.push("if(y1<x0||x1<y0)continue;"):O?q.push("if(y0<=x0||x1<y0)continue;"):q.push("if(y0<x0||x1<y0)continue;"),q.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),O?q.push("yi,xi"):q.push("xi,yi"),q.push(");if(rv!==void 0)return rv;}}}"),{name:r,code:q.join("")}}(O,r,K);f.push(q.code),J.push("return "+q.name+"("+j.join()+");")}J.push("if(re-rs>be-bs){"),K?(c(!0,!1),J.push("}else{"),c(!1,!1)):(J.push("if(fp){"),c(!0,!0),J.push("}else{"),c(!0,!1),J.push("}}else{if(fp){"),c(!1,!0),J.push("}else{"),c(!1,!1),J.push("}")),J.push("}}return "+O);var E=f.join("")+J.join("");return new Function(E)()}O.partial=X(!1),O.full=X(!0)},13750:(K,O,F)=>{"use strict";K.exports=function(K,O,F,l,M,p,y,A,Q){!function(K,O){var F=8*r.log2(O+1)*(K+1)|0,l=r.nextPow2(L*F);a.length<l&&(f.free(a),a=f.mallocInt32(l));var q=r.nextPow2(d*F);g.length<q&&(f.free(g),g=f.mallocDouble(q))}(K,l+y);var R,G=0,z=2*K;H(G++,0,0,l,0,y,F?16:0,-1/0,1/0),F||H(G++,0,0,y,0,l,1,-1/0,1/0);for(;G>0;){var m=(G-=1)*L,x=a[m],V=a[m+1],v=a[m+2],Y=a[m+3],B=a[m+4],n=a[m+5],C=G*d,I=g[C],D=g[C+1],h=1&n,b=!!(16&n),i=M,w=p,s=A,U=Q;if(h&&(i=A,w=Q,s=M,U=p),!(2&n&&V>=(v=o(K,x,V,v,i,w,D)))&&!(4&n&&(V=k(K,x,V,v,i,w,I))>=v)){var P=v-V,S=B-Y;if(b){if(K*P*(P+S)<X){if(void 0!==(R=c.scanComplete(K,x,O,V,v,i,w,Y,B,s,U)))return R;continue}}else{if(K*Math.min(P,S)<t){if(void 0!==(R=q(K,x,O,h,V,v,i,w,Y,B,s,U)))return R;continue}if(K*P*S<j){if(void 0!==(R=c.scanBipartite(K,x,O,h,V,v,i,w,Y,B,s,U)))return R;continue}}var KK=u(K,x,V,v,i,w,I,D);if(V<KK)if(K*(KK-V)<t){if(void 0!==(R=J(K,x+1,O,V,KK,i,w,Y,B,s,U)))return R}else if(x===K-2){if(void 0!==(R=h?c.sweepBipartite(K,O,Y,B,s,U,V,KK,i,w):c.sweepBipartite(K,O,V,KK,i,w,Y,B,s,U)))return R}else H(G++,x+1,V,KK,Y,B,h,-1/0,1/0),H(G++,x+1,Y,B,V,KK,1^h,-1/0,1/0);if(KK<v){var OK=E(K,x,Y,B,s,U),FK=s[z*OK+x],fK=T(K,x,OK,B,s,U,FK);if(fK<B&&H(G++,x,KK,v,fK,B,(4|h)+(b?16:0),FK,D),Y<OK&&H(G++,x,KK,v,Y,OK,(2|h)+(b?16:0),I,FK),OK+1===fK){if(void 0!==(R=b?W(K,x,O,KK,v,i,w,OK,s,U[OK]):e(K,x,O,h,KK,v,i,w,OK,s,U[OK])))return R}else if(OK<fK){var rK;if(b){if(KK<(rK=N(K,x,KK,v,i,w,FK))){var lK=T(K,x,KK,rK,i,w,FK);if(x===K-2){if(KK<lK&&void 0!==(R=c.sweepComplete(K,O,KK,lK,i,w,OK,fK,s,U)))return R;if(lK<rK&&void 0!==(R=c.sweepBipartite(K,O,lK,rK,i,w,OK,fK,s,U)))return R}else KK<lK&&H(G++,x+1,KK,lK,OK,fK,16,-1/0,1/0),lK<rK&&(H(G++,x+1,lK,rK,OK,fK,0,-1/0,1/0),H(G++,x+1,OK,fK,lK,rK,1,-1/0,1/0))}}else KK<(rK=h?Z(K,x,KK,v,i,w,FK):N(K,x,KK,v,i,w,FK))&&(x===K-2?R=h?c.sweepBipartite(K,O,OK,fK,s,U,KK,rK,i,w):c.sweepBipartite(K,O,KK,rK,i,w,OK,fK,s,U):(H(G++,x+1,KK,rK,OK,fK,h,-1/0,1/0),H(G++,x+1,OK,fK,KK,rK,1^h,-1/0,1/0)))}}}}};var f=F(13712),r=F(13717),l=F(13755),q=l.partial,J=l.full,c=F(13740),E=F(13757),M=F(13764),t=128,j=1<<22,X=1<<22,u=M("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),T=M("lo===p0",["p0"]),o=M("lo<p0",["p0"]),k=M("hi<=p0",["p0"]),N=M("lo<=p0&&p0<=hi",["p0"]),Z=M("lo<p0&&p0<=hi",["p0"]),L=6,d=2,a=f.mallocInt32(1024),g=f.mallocDouble(1024);function H(K,O,F,f,r,l,q,J,c){var E=L*K;a[E]=O,a[E+1]=F,a[E+2]=f,a[E+3]=r,a[E+4]=l,a[E+5]=q;var M=d*K;g[M]=J,g[M+1]=c}function e(K,O,F,f,r,l,q,J,c,E,M){var t=2*K,j=c*t,X=E[j+O];K:for(var u=r,T=r*t;u<l;++u,T+=t){var o=q[T+O],k=q[T+O+K];if(!(X<o||k<X)&&(!f||X!==o)){for(var N,Z=J[u],L=O+1;L<K;++L){o=q[T+L],k=q[T+L+K];var d=E[j+L],a=E[j+L+K];if(k<d||a<o)continue K}if(void 0!==(N=f?F(M,Z):F(Z,M)))return N}}}function W(K,O,F,f,r,l,q,J,c,E){var M=2*K,t=J*M,j=c[t+O];K:for(var X=f,u=f*M;X<r;++X,u+=M){var T=q[X];if(T!==E){var o=l[u+O],k=l[u+O+K];if(!(j<o||k<j)){for(var N=O+1;N<K;++N){o=l[u+N],k=l[u+N+K];var Z=c[t+N],L=c[t+N+K];if(k<Z||L<o)continue K}var d=F(T,E);if(void 0!==d)return d}}}}},13757:(K,O,F)=>{"use strict";K.exports=function(K,O,F,q,J,c){if(q<=F+1)return F;var E=F,M=q,t=q+F>>>1,j=2*K,X=t,u=J[j*t+O];for(;E<M;){if(M-E<r){l(K,O,E,M,J,c),u=J[j*t+O];break}var T=M-E,o=Math.random()*T+E|0,k=J[j*o+O],N=Math.random()*T+E|0,Z=J[j*N+O],L=Math.random()*T+E|0,d=J[j*L+O];k<=Z?d>=Z?(X=N,u=Z):k>=d?(X=o,u=k):(X=L,u=d):Z>=d?(X=N,u=Z):d>=k?(X=o,u=k):(X=L,u=d);for(var a=j*(M-1),g=j*X,H=0;H<j;++H,++a,++g){var e=J[a];J[a]=J[g],J[g]=e}var W=c[M-1];c[M-1]=c[X],c[X]=W;for(a=j*(M-1),g=j*(X=f(K,O,E,M-1,J,c,u)),H=0;H<j;++H,++a,++g){e=J[a];J[a]=J[g],J[g]=e}W=c[M-1];if(c[M-1]=c[X],c[X]=W,t<X){for(M=X-1;E<M&&J[j*(M-1)+O]===u;)M-=1;M+=1}else{if(!(X<t))break;for(E=X+1;E<M&&J[j*E+O]===u;)E+=1}}return f(K,O,F,t,J,c,J[j*t+O])};var f=F(13764)("lo<p0",["p0"]),r=8;function l(K,O,F,f,r,l){for(var q=2*K,J=q*(F+1)+O,c=F+1;c<f;++c,J+=q)for(var E=r[J],M=c,t=q*(c-1);M>F&&r[t+O]>E;--M,t-=q){for(var j=t,X=t+q,u=0;u<q;++u,++j,++X){var T=r[j];r[j]=r[X],r[X]=T}var o=l[M];l[M]=l[M-1],l[M-1]=o}}},13764:K=>{"use strict";K.exports=function(K,F){var f="abcdef".split("").concat(F),r=[];K.indexOf("lo")>=0&&r.push("lo=e[k+n]");K.indexOf("hi")>=0&&r.push("hi=e[k+o]");return f.push(O.replace("_",r.join()).replace("$",K)),Function.apply(void 0,f)};var O="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13746:K=>{"use strict";K.exports=function(K,f){f<=4*O?F(0,f-1,K):E(0,f-1,K)};var O=32;function F(K,O,F){for(var f=2*(K+1),r=K+1;r<=O;++r){for(var l=F[f++],q=F[f++],J=r,c=f-2;J-- >K;){var E=F[c-2],M=F[c-1];if(E<l)break;if(E===l&&M<q)break;F[c]=E,F[c+1]=M,c-=2}F[c]=l,F[c+1]=q}}function f(K,O,F){O*=2;var f=F[K*=2],r=F[K+1];F[K]=F[O],F[K+1]=F[O+1],F[O]=f,F[O+1]=r}function r(K,O,F){O*=2,F[K*=2]=F[O],F[K+1]=F[O+1]}function l(K,O,F,f){O*=2,F*=2;var r=f[K*=2],l=f[K+1];f[K]=f[O],f[K+1]=f[O+1],f[O]=f[F],f[O+1]=f[F+1],f[F]=r,f[F+1]=l}function q(K,O,F,f,r){O*=2,r[K*=2]=r[O],r[O]=F,r[K+1]=r[O+1],r[O+1]=f}function J(K,O,F){O*=2;var f=F[K*=2],r=F[O];return!(f<r)&&(f!==r||F[K+1]>F[O+1])}function c(K,O,F,f){var r=f[K*=2];return r<O||r===O&&f[K+1]<F}function E(K,M,t){var j=(M-K+1)/6|0,X=K+j,u=M-j,T=K+M>>1,o=T-j,k=T+j,N=X,Z=o,L=T,d=k,a=u,g=K+1,H=M-1,e=0;J(N,Z,t)&&(e=N,N=Z,Z=e),J(d,a,t)&&(e=d,d=a,a=e),J(N,L,t)&&(e=N,N=L,L=e),J(Z,L,t)&&(e=Z,Z=L,L=e),J(N,d,t)&&(e=N,N=d,d=e),J(L,d,t)&&(e=L,L=d,d=e),J(Z,a,t)&&(e=Z,Z=a,a=e),J(Z,L,t)&&(e=Z,Z=L,L=e),J(d,a,t)&&(e=d,d=a,a=e);for(var W=t[2*Z],p=t[2*Z+1],y=t[2*d],A=t[2*d+1],Q=2*N,R=2*L,G=2*a,z=2*X,m=2*T,x=2*u,V=0;V<2;++V){var v=t[Q+V],Y=t[R+V],B=t[G+V];t[z+V]=v,t[m+V]=Y,t[x+V]=B}r(o,K,t),r(k,M,t);for(var n=g;n<=H;++n)if(c(n,W,p,t))n!==g&&f(n,g,t),++g;else if(!c(n,y,A,t))for(;;){if(c(H,y,A,t)){c(H,W,p,t)?(l(n,g,H,t),++g,--H):(f(n,H,t),--H);break}if(--H<n)break}q(K,g-1,W,p,t),q(M,H+1,y,A,t),g-2-K<=O?F(K,g-2,t):E(K,g-2,t),M-(H+2)<=O?F(H+2,M,t):E(H+2,M,t),H-g<=O?F(g,H,t):E(g,H,t)}},13740:(K,O,F)=>{"use strict";K.exports={init:function(K){var O=r.nextPow2(K);c.length<O&&(f.free(c),c=f.mallocInt32(O));E.length<O&&(f.free(E),E=f.mallocInt32(O));M.length<O&&(f.free(M),M=f.mallocInt32(O));t.length<O&&(f.free(t),t=f.mallocInt32(O));j.length<O&&(f.free(j),j=f.mallocInt32(O));X.length<O&&(f.free(X),X=f.mallocInt32(O));var F=8*O;u.length<F&&(f.free(u),u=f.mallocDouble(F))},sweepBipartite:function(K,O,F,f,r,J,j,X,k,N){for(var Z=0,L=2*K,d=K-1,a=L-1,g=F;g<f;++g){var H=J[g],e=L*g;u[Z++]=r[e+d],u[Z++]=-(H+1),u[Z++]=r[e+a],u[Z++]=H}for(g=j;g<X;++g){H=N[g]+q;var W=L*g;u[Z++]=k[W+d],u[Z++]=-H,u[Z++]=k[W+a],u[Z++]=H}var p=Z>>>1;l(u,p);var y=0,A=0;for(g=0;g<p;++g){var Q=0|u[2*g+1];if(Q>=q)T(M,t,A--,Q=Q-q|0);else if(Q>=0)T(c,E,y--,Q);else if(Q<=-q){Q=-Q-q|0;for(var R=0;R<y;++R){if(void 0!==(G=O(c[R],Q)))return G}o(M,t,A++,Q)}else{Q=-Q-1|0;for(R=0;R<A;++R){var G;if(void 0!==(G=O(Q,M[R])))return G}o(c,E,y++,Q)}}},sweepComplete:function(K,O,F,f,r,q,J,k,N,Z){for(var L=0,d=2*K,a=K-1,g=d-1,H=F;H<f;++H){var e=q[H]+1<<1,W=d*H;u[L++]=r[W+a],u[L++]=-e,u[L++]=r[W+g],u[L++]=e}for(H=J;H<k;++H){e=Z[H]+1<<1;var p=d*H;u[L++]=N[p+a],u[L++]=1|-e,u[L++]=N[p+g],u[L++]=1|e}var y=L>>>1;l(u,y);var A=0,Q=0,R=0;for(H=0;H<y;++H){var G=0|u[2*H+1],z=1&G;if(H<y-1&&G>>1===u[2*H+3]>>1&&(z=2,H+=1),G<0){for(var m=-(G>>1)-1,x=0;x<R;++x){if(void 0!==(V=O(j[x],m)))return V}if(0!==z)for(x=0;x<A;++x){if(void 0!==(V=O(c[x],m)))return V}if(1!==z)for(x=0;x<Q;++x){var V;if(void 0!==(V=O(M[x],m)))return V}0===z?o(c,E,A++,m):1===z?o(M,t,Q++,m):2===z&&o(j,X,R++,m)}else{m=(G>>1)-1;0===z?T(c,E,A--,m):1===z?T(M,t,Q--,m):2===z&&T(j,X,R--,m)}}},scanBipartite:function(K,O,F,f,r,J,M,t,j,X,k,N){var Z=0,L=2*K,d=O,a=O+K,g=1,H=1;f?H=q:g=q;for(var e=r;e<J;++e){var W=e+g,p=L*e;u[Z++]=M[p+d],u[Z++]=-W,u[Z++]=M[p+a],u[Z++]=W}for(e=j;e<X;++e){W=e+H;var y=L*e;u[Z++]=k[y+d],u[Z++]=-W}var A=Z>>>1;l(u,A);var Q=0;for(e=0;e<A;++e){var R=0|u[2*e+1];if(R<0){var G=!1;if((W=-R)>=q?(G=!f,W-=q):(G=!!f,W-=1),G)o(c,E,Q++,W);else{var z=N[W],m=L*W,x=k[m+O+1],V=k[m+O+1+K];K:for(var v=0;v<Q;++v){var Y=c[v],B=L*Y;if(!(V<M[B+O+1]||M[B+O+1+K]<x)){for(var n=O+2;n<K;++n)if(k[m+n+K]<M[B+n]||M[B+n+K]<k[m+n])continue K;var C,I=t[Y];if(void 0!==(C=f?F(z,I):F(I,z)))return C}}}}else T(c,E,Q--,R-g)}},scanComplete:function(K,O,F,f,r,J,E,M,t,j,X){for(var T=0,o=2*K,k=O,N=O+K,Z=f;Z<r;++Z){var L=Z+q,d=o*Z;u[T++]=J[d+k],u[T++]=-L,u[T++]=J[d+N],u[T++]=L}for(Z=M;Z<t;++Z){L=Z+1;var a=o*Z;u[T++]=j[a+k],u[T++]=-L}var g=T>>>1;l(u,g);var H=0;for(Z=0;Z<g;++Z){var e=0|u[2*Z+1];if(e<0){if((L=-e)>=q)c[H++]=L-q;else{var W=X[L-=1],p=o*L,y=j[p+O+1],A=j[p+O+1+K];K:for(var Q=0;Q<H;++Q){var R=c[Q],G=E[R];if(G===W)break;var z=o*R;if(!(A<J[z+O+1]||J[z+O+1+K]<y)){for(var m=O+2;m<K;++m)if(j[p+m+K]<J[z+m]||J[z+m+K]<j[p+m])continue K;var x=F(G,W);if(void 0!==x)return x}}}}else{for(L=e-q,Q=H-1;Q>=0;--Q)if(c[Q]===L){for(m=Q+1;m<H;++m)c[m-1]=c[m];break}--H}}}};var f=F(13712),r=F(13717),l=F(13746),q=1<<28,J=1024,c=f.mallocInt32(J),E=f.mallocInt32(J),M=f.mallocInt32(J),t=f.mallocInt32(J),j=f.mallocInt32(J),X=f.mallocInt32(J),u=f.mallocDouble(8192);function T(K,O,F,f){var r=O[f],l=K[F-1];K[r]=l,O[l]=r}function o(K,O,F,f){K[F]=f,O[f]=F}},13723:K=>{"use strict";function O(K,F,f){var r=0|K[f];if(r<=0)return[];var l,q=new Array(r);if(f===K.length-1)for(l=0;l<r;++l)q[l]=F;else for(l=0;l<r;++l)q[l]=O(K,F,f+1);return q}K.exports=function(K,F){switch("undefined"===typeof F&&(F=0),typeof K){case"number":if(K>0)return function(K,O){var F,f;for(F=new Array(K),f=0;f<K;++f)F[f]=O;return F}(0|K,F);break;case"object":if("number"===typeof K.length)return O(K,F,0)}return[]}},13679:(K,O,F)=>{K.exports=function(){var K=this;this.components={},this.comps=this.components;var O=this.components,F=1,r={},l=[],q=[],J={timeout:!1,removals:[],multiComps:[]};function c(K,F){var f=O[F],l=r[F],q=l.hash[K];q&&(l.remove(K),f.ff&&(f.multi?(q.forEach((O=>{O&&f.ff(K,O)})),q.length=0):f.ff(K,q)),J.removals.push(l),E())}function E(){J.timeout||(J.timeout=!0,setTimeout(M,1))}function M(){J.timeout=!1,t()}function t(){J.multiComps.length&&function(K){for(var O=0;O<K.length;O++){var{entID:F,data:f}=K[O],r=f.hash[F];if(r){for(var l=0;l<r.length;l++)r[l]||(r.splice(l,1),l--);0===r.length&&(f.remove(F),J.removals.push(f))}}K.length=0}(J.multiComps),J.removals.length&&function(K){for(var O=0;O<K.length;O++){K[O].flush()}K.length=0}(J.removals)}this.Dt=r,this._systems=l,this._renderSystems=q,this.AM=function(O){var f=F++;return Array.isArray(O)&&O.forEach((O=>K.XE(f,O))),f},this.deleteEntity=function(O){return Object.keys(r).forEach((K=>{r[K].hash[O]&&c(O,K)})),K},this.hM=function(K){if(!K)throw new Error("Missing component definition");var F=K.name;if(!F)throw new Error("Component definition must have a name property.");if("string"!==typeof F)throw new Error("Component name must be a string.");if(""===F)throw new Error("Component name must be a non-empty string.");if(r[F])throw new Error(`Component ${F} already exists.`);var J={};return J.name=F,J.multi=!!K.multi,J.order=isNaN(K.order)?99:K.order,J.stateConstructor=K.stateConstructor||null,J.state=K.state||{},J.pJ=K.pJ||null,J.ff=K.ff||null,J.system=K.system||null,J.zJ=K.zJ||null,O[F]=J,r[F]=new f,r[F]._pendingMultiCleanup=!1,r[F]._multiCleanupIDs=J.multi?[]:null,J.system&&(l.push(F),l.sort(((K,F)=>O[K].order-O[F].order))),J.zJ&&(q.push(F),q.sort(((K,F)=>O[K].order-O[F].order))),F},this.overwriteComponent=function(K,F){var f=O[K];if(!f)throw new Error(`Unknown component: ${K}`);if(!F)throw new Error("Missing component definition");if(f.name!==F.name)throw new Error("Overwriting component must use the same name property.");var J={};J.name=K,J.multi=!!F.multi,J.order=isNaN(F.order)?99:F.order,J.state=F.state||{},J.pJ=F.pJ||null,J.ff=F.ff||null,J.system=F.system||null,J.zJ=F.zJ||null,O[K]=J,r[K]._pendingMultiCleanup=!1,r[K]._multiCleanupIDs=J.multi?[]:null;var c=l.indexOf(K);J.system&&c<0&&l.push(K),!J.system&&c>=0&&l.splice(c,1),l.sort(((K,F)=>O[K].order-O[F].order));var E=q.indexOf(K);J.zJ&&E<0&&q.push(K),!J.zJ&&E>=0&&q.splice(E,1),q.sort(((K,F)=>O[K].order-O[F].order));var M=J.state;return this.tM(K).forEach((K=>{for(var O in M)O in K||(K[O]=M[O]);J.pJ&&J.pJ(K.RJ,K)})),K},this.deleteComponent=function(F){var f=r[F];if(!f)throw new Error(`Unknown component: ${F}`);f.flush(),f.list.forEach((K=>{K&&c(K.RJ||K[0].RJ,F)}));var J=l.indexOf(F),E=q.indexOf(F);return J>-1&&l.splice(J,1),E>-1&&q.splice(E,1),r[F].dispose(),delete r[F],delete O[F],K},this.XE=function(K,F,f){var l,q=O[F],J=r[F];if(!J)throw new Error(`Unknown component: ${F}.`);if(J.hash[K]&&!q.multi)throw new Error(`Entity ${K} already has component: ${F}.`);if(q.stateConstructor){if(!(l=new q.stateConstructor).hasOwnProperty("RJ"))throw new Error(`Component ${q.name} stateConstructor type does not have property __id`)}else l=Object.assign({},{RJ:K},q.state,f);if(l.RJ=K,q.multi){var c=J.hash[K];c||(c=[],J.add(K,c)),c.push(l)}else J.add(K,l);return q.pJ&&q.pJ(K,l),this},this.gE=function(K,O){var F=r[O];if(!F)throw new Error(`Unknown component: ${O}.`);return!!F.hash[K]},this.kE=function(O,F){if(!r[F])throw new Error(`Unknown component: ${F}.`);return c(O,F),K},this.getState=function(K,O){var F=r[O];if(!F)throw new Error(`Unknown component: ${O}.`);return F.hash[K]},this.tM=function(K){var O=r[K];if(!O)throw new Error(`Unknown component: ${K}.`);return t(),O.list},this.GX=function(K){if(!r[K])throw new Error(`Unknown component: ${K}.`);var O=r[K].hash;return K=>O[K]},this.xX=function(K){if(!r[K])throw new Error(`Unknown component: ${K}.`);var O=r[K].hash;return K=>!!O[K]},this.uJ=function(F){t();for(var f=0;f<l.length;f++){var q=l[f],J=O[q],c=r[q];J.system(F,c.list),t()}return K},this.render=function(F){t();for(var f=0;f<q.length;f++){var l=q[f],J=O[l],c=r[l];J.zJ(F,c.list),t()}return K},this.removeMultiComponent=function(F,f,l){var q=O[f],c=r[f];if(!c)throw new Error(`Unknown component: ${f}.`);if(!q.multi)throw new Error("removeMultiComponent called on non-multi component");return function(K,O,F,f){var r=F.hash[K];if(r){var l=r[f];l&&(r[f]=null,O.ff&&O.ff(K,l),J.multiComps.push({entID:K,data:F}),E())}}(F,q,c,l),K}};var f=F(13683)},13683:K=>{function O(K,O){var F=K._map[O];if(delete K.hash[O],delete K._map[O],F===K.list.length-1)K.list.pop();else{var f=K.list.pop();if(K.list[F]=f,null===f||null===f[0]){var r=K.list.length;for(var l in K._map)if(K._map[l]===r)return void(K._map[l]=F)}else{var q=f.RJ||f[0].RJ;K._map[q]=F}}}K.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(K,O){if("number"===typeof this._map[K]){var F=this._map[K];this.hash[K]=O,this.list[F]=O}else this._map[K]=this.list.length,this.hash[K]=O,this.list.push(O)}remove(K){var O=this._map[K];this.hash[K]=null,this.list[O]=null,this._pendingRemovals.push(K)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var K=0;K<this._pendingRemovals.length;K++){var F=this._pendingRemovals[K];null===this.hash[F]&&O(this,F)}this._pendingRemovals.length=0}}},13645:K=>{"use strict";var O,F="object"===typeof Reflect?Reflect:null,f=function(K,O,F){return Function.prototype.apply.call(K,O,F)};O=F&&"function"===typeof F.ownKeys?F.ownKeys:Object.getOwnPropertySymbols?function(K){return Object.getOwnPropertyNames(K).concat(Object.getOwnPropertySymbols(K))}:function(K){return Object.getOwnPropertyNames(K)};var r=Number.isNaN||function(K){return K!==K};function l(){l.init.call(this)}K.exports=l,K.exports.once=function(K,O){return new Promise((function(F,f){function r(F){K.removeListener(O,l),f(F)}function l(){"function"===typeof K.removeListener&&K.removeListener("error",r),F([].slice.call(arguments))}T(K,O,l,{once:!0}),"error"!==O&&function(K,O,F){"function"===typeof K.on&&T(K,"error",O,F)}(K,r,{once:!0})}))},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var q=10;function J(K){if("function"!==typeof K)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof K)}function c(K){return void 0===K._maxListeners?l.defaultMaxListeners:K._maxListeners}function E(K,O,F,f){var r,l,q,E;if(J(F),void 0===(l=K._events)?(l=K._events=Object.create(null),K._eventsCount=0):(void 0!==l.newListener&&(K.emit("newListener",O,F.listener?F.listener:F),l=K._events),q=l[O]),void 0===q)q=l[O]=F,++K._eventsCount;else if("function"===typeof q?q=l[O]=f?[F,q]:[q,F]:f?q.unshift(F):q.push(F),(r=c(K))>0&&q.length>r&&!q.warned){q.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+q.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.rO=K,M.type=O,M.count=q.length,E=M,console&&console.warn&&console.warn(E)}return K}function M(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function t(K,O,F){var f={fired:!1,wrapFn:void 0,target:K,type:O,listener:F},r=M.bind(f);return r.listener=F,f.wrapFn=r,r}function j(K,O,F){var f=K._events;if(void 0===f)return[];var r=f[O];return void 0===r?[]:"function"===typeof r?F?[r.listener||r]:[r]:F?function(K){for(var O=new Array(K.length),F=0;F<O.length;++F)O[F]=K[F].listener||K[F];return O}(r):u(r,r.length)}function X(K){var O=this._events;if(void 0!==O){var F=O[K];if("function"===typeof F)return 1;if(void 0!==F)return F.length}return 0}function u(K,O){for(var F=new Array(O),f=0;f<O;++f)F[f]=K[f];return F}function T(K,O,F,f){if("function"===typeof K.on)f.once?K.once(O,F):K.on(O,F);else{if("function"!==typeof K.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof K);K.addEventListener(O,(function r(l){f.once&&K.removeEventListener(O,r),F(l)}))}}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return q},set:function(K){if("number"!==typeof K||K<0||r(K))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+K+".");q=K}}),l.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(K){if("number"!==typeof K||K<0||r(K))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+K+".");return this._maxListeners=K,this},l.prototype.getMaxListeners=function(){return c(this)},l.prototype.emit=function(K){for(var O=[],F=1;F<arguments.length;F++)O.push(arguments[F]);var r="error"===K,l=this._events;if(void 0!==l)r=r&&void 0===l.error;else if(!r)return!1;if(r){var q;if(O.length>0&&(q=O[0]),q instanceof Error)throw q;var J=new Error("Unhandled error."+(q?" ("+q.message+")":""));throw J.context=q,J}var c=l[K];if(void 0===c)return!1;if("function"===typeof c)f(c,this,O);else{var E=c.length,M=u(c,E);for(F=0;F<E;++F)f(M[F],this,O)}return!0},l.prototype.addListener=function(K,O){return E(this,K,O,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(K,O){return E(this,K,O,!0)},l.prototype.once=function(K,O){return J(O),this.on(K,t(this,K,O)),this},l.prototype.prependOnceListener=function(K,O){return J(O),this.prependListener(K,t(this,K,O)),this},l.prototype.removeListener=function(K,O){var F,f,r,l,q;if(J(O),void 0===(f=this._events))return this;if(void 0===(F=f[K]))return this;if(F===O||F.listener===O)0===--this._eventsCount?this._events=Object.create(null):(delete f[K],f.removeListener&&this.emit("removeListener",K,F.listener||O));else if("function"!==typeof F){for(r=-1,l=F.length-1;l>=0;l--)if(F[l]===O||F[l].listener===O){q=F[l].listener,r=l;break}if(r<0)return this;0===r?F.shift():function(K,O){for(;O+1<K.length;O++)K[O]=K[O+1];K.pop()}(F,r),1===F.length&&(f[K]=F[0]),void 0!==f.removeListener&&this.emit("removeListener",K,q||O)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.lO=function(K){var O,F,f;if(void 0===(F=this._events))return this;if(void 0===F.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==F[K]&&(0===--this._eventsCount?this._events=Object.create(null):delete F[K]),this;if(0===arguments.length){var r,l=Object.keys(F);for(f=0;f<l.length;++f)"removeListener"!==(r=l[f])&&this.lO(r);return this.lO("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(O=F[K]))this.removeListener(K,O);else if(void 0!==O)for(f=O.length-1;f>=0;f--)this.removeListener(K,O[f]);return this},l.prototype.listeners=function(K){return j(this,K,!0)},l.prototype.rawListeners=function(K){return j(this,K,!1)},l.listenerCount=function(K,O){return"function"===typeof K.listenerCount?K.listenerCount(O):X.call(K,O)},l.prototype.listenerCount=X,l.prototype.eventNames=function(){return this._eventsCount>0?O(this._events):[]}},13914:K=>{"use strict";K.exports=function(K,O,F,f,r,l){var q=+O[0],J=+O[1],c=+O[2],E=+F[0],M=+F[1],t=+F[2],j=Math.sqrt(E*E+M*M+t*t);if(0===j)throw new Error("Can't raycast along a zero vector");return function(K,O,F,f,r,l,q,J,c,E){for(var M=0,t=Math.floor,j=0|t(O),X=0|t(F),u=0|t(f),T=r>0?1:-1,o=l>0?1:-1,k=q>0?1:-1,N=Math.abs(1/r),Z=Math.abs(1/l),L=Math.abs(1/q),d=N<1/0?N*(T>0?j+1-O:O-j):1/0,a=Z<1/0?Z*(o>0?X+1-F:F-X):1/0,g=L<1/0?L*(k>0?u+1-f:f-u):1/0,H=-1;M<=J;){var e=K(j,X,u);if(e)return c&&(c[0]=O+M*r,c[1]=F+M*l,c[2]=f+M*q),E&&(E[0]=E[1]=E[2]=0,0===H&&(E[0]=-T),1===H&&(E[1]=-o),2===H&&(E[2]=-k)),e;d<a?d<g?(j+=T,M=d,d+=N,H=0):(u+=k,M=g,g+=L,H=2):a<g?(X+=o,M=a,a+=Z,H=1):(u+=k,M=g,g+=L,H=2)}return c&&(c[0]=O+M*r,c[1]=F+M*l,c[2]=f+M*q),E&&(E[0]=E[1]=E[2]=0),0}(K,q,J,c,E/=j,M/=j,t/=j,f="undefined"===typeof f?64:+f,r,l)}},13950:(K,O,F)=>{"use strict";F.d(O,{e:()=>l});var f=F(13645);function r(){this.Gj=!1,this.stopPropagation=!1,this.zj=!1,this.disabled=!1}class l{constructor(K,O){this.version="0.7.0";var F=Object.assign({},new r,O||{});this.element=K||document,this.Gj=!!F.Gj,this.stopPropagation=!!F.stopPropagation,this.zj=!!F.zj,this.disabled=!!F.disabled,this.filterEvents=(K,O)=>!0,this.down=new f.EventEmitter,this.up=new f.EventEmitter,this.state={},this.lM={dx:0,dy:0,gX:0,rM:0,HX:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?J(this):document.addEventListener("DOMContentLoaded",(K=>{J(this)}),{once:!0})}bind(K){for(var O=arguments.length,F=new Array(O>1?O-1:0),f=1;f<O;f++)F[f-1]=arguments[f];F.forEach((O=>{var F=this._keyBindmap[O]||[];F.includes(K)||(F.push(K),this._keyBindmap[O]=F)})),this.state[K]=!!this.state[K],this.pressCount[K]=this.pressCount[K]||0,this.releaseCount[K]=this.releaseCount[K]||0}unbind(K){for(var O in this._keyBindmap){var F=this._keyBindmap[O],f=F.indexOf(K);f>-1&&F.splice(f,1)}}getBindings(){var K={};for(var O in this._keyBindmap){this._keyBindmap[O].forEach((F=>{K[F]=K[F]||[],K[F].push(O)}))}return K}uJ(){q(this.lM),q(this.pressCount),q(this.releaseCount)}}function q(K){for(var O in K)K[O]=0}function J(K){window.addEventListener("keydown",u.bind(null,K,!0),!1),window.addEventListener("keyup",u.bind(null,K,!1),!1);var O={passive:!0};K.element.addEventListener("touchstart",t.bind(void 0,K),{passive:!1}),K.element.addEventListener("touchend",X.bind(void 0,K),O),K.element.addEventListener("mousedown",T.bind(null,K,!0),O),window.document.addEventListener("mouseup",T.bind(null,K,!1),O),K.element.addEventListener("touchmove",o.bind(null,K),O),K.element.addEventListener("mousemove",o.bind(null,K),O),window.PointerEvent,K.element.addEventListener("wheel",k.bind(null,K),O),K.element.addEventListener("contextmenu",N.bind(null,K),!1),window.addEventListener("blur",Z.bind(null,K),!1)}var c=0,E=0,M=null;function t(K,O){O.preventDefault(),j(O)}function j(K){let O=!1;for(let F=0;F<K.touches.length;++F)if(K.touches[F].identifier===M){O=!0;break}if(!O){const O=K.changedTouches[0];c=O.clientX,E=O.clientY,M=O.identifier}}function X(K,O){for(var F=O.changedTouches,f=0;f<F.length;++f)F[f].identifier===M&&(M=null)}function u(K,O,F){L(F.code,O,K,F)}function T(K,O,F){if("pointerId"in F)if(O){if(null!==K._touches.currID)return;K._touches.currID=F.pointerId}else{if(K._touches.currID!==F.pointerId)return;K._touches.currID=null}return L("Mouse"+("button"in F?F.button+1:1),O,K,F),!1}function o(K,O){var F=O.movementX||O.mozMovementX||0,f=O.movementY||O.mozMovementY||0;if(O.touches&&0===(F|f)){var r=function(K){j(K);for(let O=0;O<K.changedTouches.length;++O)if(K.changedTouches[O].identifier==M){const F=K.changedTouches[O],f=[F.clientX-c,F.clientY-E];return c=F.clientX,E=F.clientY,f}return console.error(`Did not find touch id ${M}`),[0,0]}(O);F=r[0],f=r[1]}K.lM.dx+=F,K.lM.dy+=f}function k(K,O){var F=1;switch(O.deltaMode){case 0:F=1;break;case 1:F=12;break;case 2:F=K.element.clientHeight||window.innerHeight}K.lM.gX+=(O.deltaX||0)*F,K.lM.rM+=(O.deltaY||0)*F,K.lM.HX+=(O.deltaZ||0)*F}function N(K,O){if(!K.zj)return O.preventDefault(),!1}function Z(K){for(var O in K._keyStates)K._keyStates[O]&&(/^Mouse\d/.test(O)||L(O,!1,K,{code:O,note:"jy170sakl3",preventDefault:()=>{},stopPropagation:()=>{}}))}function L(K,O,F,f){var r=F._keyBindmap[K];r&&(d(F._keyStates[K],O)&&(F._keyStates[K]=O,r.forEach((K=>{(!F.filterEvents||F.filterEvents(f,K))&&function(K,O,F,f){var r=O?F.pressCount:F.releaseCount;r[K]=(r[K]||0)+1;var l=F._bindPressCount[K]||0;(l+=O?1:-1)<0&&(l=0);F._bindPressCount[K]=l;var q=F.state[K];if(d(q,l)){F.state[K]=l>0;var J=O?F.down:F.up;F.disabled||J.emit(K,f)}}(K,O,F,f)}))),"button"in f||(F.Gj&&!f.defaultPrevented&&f.preventDefault(),F.stopPropagation&&f.stopPropagation()))}function d(K,O){return K?!O:O}},12616:K=>{K.exports=function(K,O,F){return K[0]=O[0]+F[0],K[1]=O[1]+F[1],K[2]=O[2]+F[2],K}},12574:(K,O,F)=>{K.exports=function(K,O){var F=f(K[0],K[1],K[2]),q=f(O[0],O[1],O[2]);r(F,F),r(q,q);var J=l(F,q);return J>1?0:Math.acos(J)};var f=F(12577),r=F(12582),l=F(12584)},12663:K=>{K.exports=function(K,O){return K[0]=Math.ceil(O[0]),K[1]=Math.ceil(O[1]),K[2]=Math.ceil(O[2]),K}},12568:K=>{K.exports=function(K){var O=new Float32Array(3);return O[0]=K[0],O[1]=K[1],O[2]=K[2],O}},12589:K=>{K.exports=function(K,O){return K[0]=O[0],K[1]=O[1],K[2]=O[2],K}},12559:K=>{K.exports=function(){var K=new Float32Array(3);return K[0]=0,K[1]=0,K[2]=0,K}},12740:K=>{K.exports=function(K,O,F){var f=O[0],r=O[1],l=O[2],q=F[0],J=F[1],c=F[2];return K[0]=r*c-l*J,K[1]=l*q-f*c,K[2]=f*J-r*q,K}},12689:(K,O,F)=>{K.exports=F(12685)},12685:K=>{K.exports=function(K,O){var F=O[0]-K[0],f=O[1]-K[1],r=O[2]-K[2];return Math.sqrt(F*F+f*f+r*r)}},12645:(K,O,F)=>{K.exports=F(12637)},12637:K=>{K.exports=function(K,O,F){return K[0]=O[0]/F[0],K[1]=O[1]/F[1],K[2]=O[2]/F[2],K}},12584:K=>{K.exports=function(K,O){return K[0]*O[0]+K[1]*O[1]+K[2]*O[2]}},12555:K=>{K.exports=1e-6},12601:(K,O,F)=>{K.exports=function(K,O){var F=K[0],r=K[1],l=K[2],q=O[0],J=O[1],c=O[2];return Math.abs(F-q)<=f*Math.max(1,Math.abs(F),Math.abs(q))&&Math.abs(r-J)<=f*Math.max(1,Math.abs(r),Math.abs(J))&&Math.abs(l-c)<=f*Math.max(1,Math.abs(l),Math.abs(c))};var f=F(12555)},12609:K=>{K.exports=function(K,O){return K[0]===O[0]&&K[1]===O[1]&&K[2]===O[2]}},12660:K=>{K.exports=function(K,O){return K[0]=Math.floor(O[0]),K[1]=Math.floor(O[1]),K[2]=Math.floor(O[2]),K}},12796:(K,O,F)=>{K.exports=function(K,O,F,r,l,q){var J,c;O||(O=3);F||(F=0);c=r?Math.min(r*O+F,K.length):K.length;for(J=F;J<c;J+=O)f[0]=K[J],f[1]=K[J+1],f[2]=K[J+2],l(f,f,q),K[J]=f[0],K[J+1]=f[1],K[J+2]=f[2];return K};var f=F(12559)()},12577:K=>{K.exports=function(K,O,F){var f=new Float32Array(3);return f[0]=K,f[1]=O,f[2]=F,f}},12551:(K,O,F)=>{K.exports={EPSILON:F(12555),create:F(12559),clone:F(12568),angle:F(12574),lJ:F(12577),i:F(12589),set:F(12594),equals:F(12601),exactEquals:F(12609),add:F(12616),oO:F(12618),sub:F(12627),multiply:F(12629),mul:F(12632),divide:F(12637),div:F(12645),min:F(12648),max:F(12657),floor:F(12660),ceil:F(12663),round:F(12666),scale:F(12672),qJ:F(12681),distance:F(12685),j:F(12689),squaredDistance:F(12695),sqrDist:F(12702),length:F(12706),len:F(12715),squaredLength:F(12717),JJ:F(12724),negate:F(12732),inverse:F(12736),normalize:F(12582),dot:F(12584),cross:F(12740),FJ:F(12747),random:F(12754),transformMat4:F(12756),transformMat3:F(12763),transformQuat:F(12765),cJ:F(12773),EJ:F(12780),MJ:F(12789),forEach:F(12796)}},12736:K=>{K.exports=function(K,O){return K[0]=1/O[0],K[1]=1/O[1],K[2]=1/O[2],K}},12715:(K,O,F)=>{K.exports=F(12706)},12706:K=>{K.exports=function(K){var O=K[0],F=K[1],f=K[2];return Math.sqrt(O*O+F*F+f*f)}},12747:K=>{K.exports=function(K,O,F,f){var r=O[0],l=O[1],q=O[2];return K[0]=r+f*(F[0]-r),K[1]=l+f*(F[1]-l),K[2]=q+f*(F[2]-q),K}},12657:K=>{K.exports=function(K,O,F){return K[0]=Math.max(O[0],F[0]),K[1]=Math.max(O[1],F[1]),K[2]=Math.max(O[2],F[2]),K}},12648:K=>{K.exports=function(K,O,F){return K[0]=Math.min(O[0],F[0]),K[1]=Math.min(O[1],F[1]),K[2]=Math.min(O[2],F[2]),K}},12632:(K,O,F)=>{K.exports=F(12629)},12629:K=>{K.exports=function(K,O,F){return K[0]=O[0]*F[0],K[1]=O[1]*F[1],K[2]=O[2]*F[2],K}},12732:K=>{K.exports=function(K,O){return K[0]=-O[0],K[1]=-O[1],K[2]=-O[2],K}},12582:K=>{K.exports=function(K,O){var F=O[0],f=O[1],r=O[2],l=F*F+f*f+r*r;l>0&&(l=1/Math.sqrt(l),K[0]=O[0]*l,K[1]=O[1]*l,K[2]=O[2]*l);return K}},12754:K=>{K.exports=function(K,O){O=O||1;var F=2*Math.random()*Math.PI,f=2*Math.random()-1,r=Math.sqrt(1-f*f)*O;return K[0]=Math.cos(F)*r,K[1]=Math.sin(F)*r,K[2]=f*O,K}},12773:K=>{K.exports=function(K,O,F,f){var r=F[1],l=F[2],q=O[1]-r,J=O[2]-l,c=Math.sin(f),E=Math.cos(f);return K[0]=O[0],K[1]=r+q*E-J*c,K[2]=l+q*c+J*E,K}},12780:K=>{K.exports=function(K,O,F,f){var r=F[0],l=F[2],q=O[0]-r,J=O[2]-l,c=Math.sin(f),E=Math.cos(f);return K[0]=r+J*c+q*E,K[1]=O[1],K[2]=l+J*E-q*c,K}},12789:K=>{K.exports=function(K,O,F,f){var r=F[0],l=F[1],q=O[0]-r,J=O[1]-l,c=Math.sin(f),E=Math.cos(f);return K[0]=r+q*E-J*c,K[1]=l+q*c+J*E,K[2]=O[2],K}},12666:K=>{K.exports=function(K,O){return K[0]=Math.round(O[0]),K[1]=Math.round(O[1]),K[2]=Math.round(O[2]),K}},12672:K=>{K.exports=function(K,O,F){return K[0]=O[0]*F,K[1]=O[1]*F,K[2]=O[2]*F,K}},12681:K=>{K.exports=function(K,O,F,f){return K[0]=O[0]+F[0]*f,K[1]=O[1]+F[1]*f,K[2]=O[2]+F[2]*f,K}},12594:K=>{K.exports=function(K,O,F,f){return K[0]=O,K[1]=F,K[2]=f,K}},12702:(K,O,F)=>{K.exports=F(12695)},12724:(K,O,F)=>{K.exports=F(12717)},12695:K=>{K.exports=function(K,O){var F=O[0]-K[0],f=O[1]-K[1],r=O[2]-K[2];return F*F+f*f+r*r}},12717:K=>{K.exports=function(K){var O=K[0],F=K[1],f=K[2];return O*O+F*F+f*f}},12627:(K,O,F)=>{K.exports=F(12618)},12618:K=>{K.exports=function(K,O,F){return K[0]=O[0]-F[0],K[1]=O[1]-F[1],K[2]=O[2]-F[2],K}},12763:K=>{K.exports=function(K,O,F){var f=O[0],r=O[1],l=O[2];return K[0]=f*F[0]+r*F[3]+l*F[6],K[1]=f*F[1]+r*F[4]+l*F[7],K[2]=f*F[2]+r*F[5]+l*F[8],K}},12756:K=>{K.exports=function(K,O,F){var f=O[0],r=O[1],l=O[2],q=F[3]*f+F[7]*r+F[11]*l+F[15];return q=q||1,K[0]=(F[0]*f+F[4]*r+F[8]*l+F[12])/q,K[1]=(F[1]*f+F[5]*r+F[9]*l+F[13])/q,K[2]=(F[2]*f+F[6]*r+F[10]*l+F[14])/q,K}},12765:K=>{K.exports=function(K,O,F){var f=O[0],r=O[1],l=O[2],q=F[0],J=F[1],c=F[2],E=F[3],M=E*f+J*l-c*r,t=E*r+c*f-q*l,j=E*l+q*r-J*f,X=-q*f-J*r-c*l;return K[0]=M*E+X*-q+t*-c-j*-J,K[1]=t*E+X*-J+j*-q-M*-c,K[2]=j*E+X*-c+M*-J-t*-q,K}},13667:K=>{"use strict";K.exports=function(K){for(var O=new Array(K),F=0;F<K;++F)O[F]=F;return O}},13731:K=>{K.exports=function(K){return null!=K&&null!=K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}},13916:(K,O,F)=>{"use strict";F.d(O,{d:()=>f});class f{constructor(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.jt=!1,this.Xt=!1,this.Mt=30,this.tt=0,this.dt=!1,this.fullscreen=!1,this.Tt=function(K){},this.ot=function(){},this.Zt=function(){},this.lf=function(){},this.kt=function(K){},this.onFullscreenChanged=function(K){},E((()=>{!function(K,O){K._nowObject=performance||Date,K._lastTick=0,K._renderAccum=0,K._rt=0,K._frameCB=J.bind(null,K),requestAnimationFrame(K._frameCB),O>0&&(K._intervalCB=q.bind(null,K),K._interval=setInterval(K._intervalCB,Math.max(O,1e3/K.Mt/2)))}(this,O),function(K,O){if(!O)return;var F=!1,f=!1;document.addEventListener("pointerlockchange",(f=>{F=document.pointerLockElement===O,K.kt(F)})),document.addEventListener("fullscreenchange",(F=>{f=document.fullscreenElement===O,K.onFullscreenChanged(f)})),Object.defineProperty(K,"dt",{get:()=>F,set:K=>{K&&!F?c(O):F&&!K&&function(K){K.exitPointerLock&&K.exitPointerLock()}(document)}}),Object.defineProperty(K,"fullscreen",{get:()=>f,set:K=>{K&&!f?O.requestFullscreen():f&&!K&&document.exitFullscreen()}}),O.addEventListener("click",(r=>{K.jt&&!F&&c(O),K.Xt&&!f&&O.requestFullscreen()}));var r=()=>K.lf();if(window.ResizeObserver){new ResizeObserver(r).observe(O)}else window.addEventListener("resize",r)}(this,K),this.Zt()}))}}var r=3,l=20;function q(K){for(var O=1e3/K.Mt,F=K._nowObject.now()+l,f=0;K._nowObject.now()>=K._lastTick+O&&K._nowObject.now()<F&&++f<=r;)K.Tt(O),K._lastTick+=O;var q=5*(O+5),J=K._nowObject.now();if(J-K._lastTick>q)for(;J>=K._lastTick+O;)K._lastTick+=O}function J(K){requestAnimationFrame(K._frameCB),q(K);var O=K._nowObject.now(),F=O-K._rt;if(K._rt=O,K.tt>0){K._renderAccum+=F;var f=1e3/K.tt;if(K._renderAccum<f)return;K._renderAccum=Math.min(K._renderAccum-f,f)}var r=1e3/K.Mt,l=(O-K._lastTick)/r;K.ot(F,l,r)}function c(K){K.requestPointerLock&&K.requestPointerLock()}var E=K=>{if("loading"===document.readyState){var O=()=>{document.removeEventListener("readystatechange",O),K()};document.addEventListener("readystatechange",O)}else setTimeout(K,1)}},13663:(K,O,F)=>{var f=F(13667),r=F(13671),l="undefined"!==typeof Float64Array;function q(K,O){return K[0]-O[0]}function J(){var K,O=this.stride,F=new Array(O.length);for(K=0;K<F.length;++K)F[K]=[Math.abs(O[K]),K];F.sort(q);var f=new Array(F.length);for(K=0;K<f.length;++K)f[K]=F[K][1];return f}function c(K,O){var F=["View",O,"d",K].join("");O<0&&(F="View_Nil"+K);var r="generic"===K;if(-1===O){var l="function "+F+"(a){this.data=a;};var proto="+F+".prototype;proto.dtype='"+K+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+F+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+F+"(a){return new "+F+"(a);}";return new Function(l)()}if(0===O){l="function "+F+"(a,d) {this.data = a;this.offset = d};var proto="+F+".prototype;proto.dtype='"+K+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+F+"_copy() {return new "+F+"(this.data,this.offset)};proto.pick=function "+F+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+F+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+F+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+F+"(a,b,c,d){return new "+F+"(a,d)}";return new Function("TrivialArray",l)(E[K][0])}l=["'use strict'"];var q=f(O),c=q.map((function(K){return"i"+K})),M="this.offset+"+q.map((function(K){return"this.stride["+K+"]*i"+K})).join("+"),t=q.map((function(K){return"b"+K})).join(","),j=q.map((function(K){return"c"+K})).join(",");l.push("function "+F+"(a,"+t+","+j+",d){this.data=a","this.shape=["+t+"]","this.stride=["+j+"]","this.offset=d|0}","var proto="+F+".prototype","proto.dtype='"+K+"'","proto.dimension="+O),l.push("Object.defineProperty(proto,'size',{get:function "+F+"_size(){return "+q.map((function(K){return"this.shape["+K+"]"})).join("*"),"}})"),1===O?l.push("proto.order=[0]"):(l.push("Object.defineProperty(proto,'order',{get:"),O<4?(l.push("function "+F+"_order(){"),2===O?l.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&l.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):l.push("ORDER})")),l.push("proto.set=function "+F+"_set("+c.join(",")+",v){"),r?l.push("return this.data.set("+M+",v)}"):l.push("return this.data["+M+"]=v}"),l.push("proto.get=function "+F+"_get("+c.join(",")+"){"),r?l.push("return this.data.get("+M+")}"):l.push("return this.data["+M+"]}"),l.push("proto.index=function "+F+"_index(",c.join(),"){return "+M+"}"),l.push("proto.hi=function "+F+"_hi("+c.join(",")+"){return new "+F+"(this.data,"+q.map((function(K){return["(typeof i",K,"!=='number'||i",K,"<0)?this.shape[",K,"]:i",K,"|0"].join("")})).join(",")+","+q.map((function(K){return"this.stride["+K+"]"})).join(",")+",this.offset)}");var X=q.map((function(K){return"a"+K+"=this.shape["+K+"]"})),u=q.map((function(K){return"c"+K+"=this.stride["+K+"]"}));l.push("proto.lo=function "+F+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+X.join(",")+","+u.join(","));for(var T=0;T<O;++T)l.push("if(typeof i"+T+"==='number'&&i"+T+">=0){d=i"+T+"|0;b+=c"+T+"*d;a"+T+"-=d}");l.push("return new "+F+"(this.data,"+q.map((function(K){return"a"+K})).join(",")+","+q.map((function(K){return"c"+K})).join(",")+",b)}"),l.push("proto.step=function "+F+"_step("+c.join(",")+"){var "+q.map((function(K){return"a"+K+"=this.shape["+K+"]"})).join(",")+","+q.map((function(K){return"b"+K+"=this.stride["+K+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(T=0;T<O;++T)l.push("if(typeof i"+T+"==='number'){d=i"+T+"|0;if(d<0){c+=b"+T+"*(a"+T+"-1);a"+T+"=ceil(-a"+T+"/d)}else{a"+T+"=ceil(a"+T+"/d)}b"+T+"*=d}");l.push("return new "+F+"(this.data,"+q.map((function(K){return"a"+K})).join(",")+","+q.map((function(K){return"b"+K})).join(",")+",c)}");var o=new Array(O),k=new Array(O);for(T=0;T<O;++T)o[T]="a[i"+T+"]",k[T]="b[i"+T+"]";l.push("proto.transpose=function "+F+"_transpose("+c+"){"+c.map((function(K,O){return K+"=("+K+"===undefined?"+O+":"+K+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+F+"(this.data,"+o.join(",")+","+k.join(",")+",this.offset)}"),l.push("proto.pick=function "+F+"_pick("+c+"){var a=[],b=[],c=this.offset");for(T=0;T<O;++T)l.push("if(typeof i"+T+"==='number'&&i"+T+">=0){c=(c+this.stride["+T+"]*i"+T+")|0}else{a.push(this.shape["+T+"]);b.push(this.stride["+T+"])}");return l.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),l.push("return function construct_"+F+"(data,shape,stride,offset){return new "+F+"(data,"+q.map((function(K){return"shape["+K+"]"})).join(",")+","+q.map((function(K){return"stride["+K+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",l.join("\n"))(E[K],J)}var E={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};K.exports=function(K,O,F,f){if(void 0===K)return(0,E.array[0])([]);"number"===typeof K&&(K=[K]),void 0===O&&(O=[K.length]);var q=O.length;if(void 0===F){F=new Array(q);for(var J=q-1,M=1;J>=0;--J)F[J]=M,M*=O[J]}if(void 0===f){f=0;for(J=0;J<q;++J)F[J]<0&&(f-=(O[J]-1)*F[J])}for(var t=function(K){if(r(K))return"buffer";if(l)switch(Object.prototype.toString.call(K)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(K)?"array":"generic"}(K),j=E[t];j.length<=q+1;)j.push(c(t,j.length-1));return(0,j[q+1])(K,O,F,f)}},13671:K=>{function O(K){return!!K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}K.exports=function(K){return null!=K&&(O(K)||function(K){return"function"===typeof K.readFloatLE&&"function"===typeof K.slice&&O(K.slice(0,0))}(K)||!!K._isBuffer)}},13812:K=>{"use strict";var O=[],F=[],f=[],r=[],l=[],q=[],J=[],c=[],E=[],M=[],t=[],j=[];K.exports=function(K,X,u,T,o,k){for(var N=J,Z=E,L=M,d=j,a=0;a<3;a++)N[a]=+u[a],L[a]=+X.max[a],Z[a]=+X.base[a];k||(k=1e-10);var g=function(K,J,E,M,j,X){var u=O,T=F,o=f,k=r,N=l,Z=q,L=c,d=Math.floor,a=0,g=0,H=0,e=0,W=0;if(p(),0===H)return 0;for(e=Q();g<=H;){if(y(e)&&A())return a;e=Q()}for(a+=H,W=0;W<3;W++)M[W]+=E[W],j[W]+=E[W];return a;function p(){if(g=0,0!==(H=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2])))for(var K=0;K<3;K++){var O=E[K]>=0;k[K]=O?1:-1;var F=O?j[K]:M[K];u[K]=O?M[K]:j[K],T[K]=R(F,k[K]),o[K]=G(u[K],k[K]),L[K]=E[K]/H,N[K]=Math.abs(1/L[K]);var f=O?T[K]+1-F:F-T[K];Z[K]=N[K]<1/0?N[K]*f:1/0}}function y(O){for(var F=k[0],f=0===O?T[0]:o[0],r=T[0]+F,l=k[1],q=1===O?T[1]:o[1],J=T[1]+l,c=k[2],E=2===O?T[2]:o[2],M=T[2]+c,t=f;t!=r;t+=F)for(var j=q;j!=J;j+=l)for(var X=E;X!=M;X+=c)if(K(t,j,X))return!0;return!1}function A(){a+=g;var K=k[e],O=g/H,F=t;for(W=0;W<3;W++){var f=E[W]*O;M[W]+=f,j[W]+=f,F[W]=E[W]-f}if(K>0?j[e]=Math.round(j[e]):M[e]=Math.round(M[e]),J(a,e,K,F))return!0;for(W=0;W<3;W++)E[W]=F[W];return p(),0===H}function Q(){var K=Z[0]<Z[1]?Z[0]<Z[2]?0:2:Z[1]<Z[2]?1:2,O=Z[K]-g;for(g=Z[K],T[K]+=k[K],Z[K]+=N[K],W=0;W<3;W++)u[W]+=O*L[W],o[W]=G(u[W],k[W]);return K}function R(K,O){return d(K-O*X)}function G(K,O){return d(K+O*X)}}(K,T,N,Z,L,k);if(!o){for(a=0;a<3;a++)d[a]=u[a]>0?L[a]-X.max[a]:Z[a]-X.base[a];X.translate(d)}return g}},13958:(K,O,F)=>{"use strict";F.d(O,{d:()=>t});var f=F(13807),r=F(12551);class l{constructor(K,O,F,l,q,J,c){this.MM=new f(K.base,K.WM),this.bF=O,this.friction=F,this.restitution=l,this.wq=q,this.DX=J,this.sq=!!c,this.eM=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Qu=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.YE=r.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=r.create(),this._impulses=r.create(),this._sleepFrameCount=10}loadFromCopy(K){r.i(this.MM.base,K.MM.base),r.i(this.MM.WM,K.MM.WM),r.i(this.MM.max,K.MM.max),this.MM.mag=K.MM.mag,this.bF=K.bF,this.friction=K.friction,this.restitution=K.restitution,this.wq=K.wq,this.DX=K.DX,this.sq=K.sq,this.eM=K.eM,this.fluidDrag=K.fluidDrag,this.Qu=K.Qu,this.preventFallOffEdge=K.preventFallOffEdge,this.rolledBackLastTick=K.rolledBackLastTick,r.i(this.YE,K.YE),r.i(this.resting,K.resting),this.inFluid=K.inFluid,this._ratioInFluid=K._ratioInFluid,r.i(this._forces,K._forces),r.i(this._impulses,K._impulses),this._sleepFrameCount=K._sleepFrameCount}setPosition(K){q(K),r.oO(K,K,this.MM.base),this.MM.translate(K),this.CE()}Tf(){return r.clone(this.MM.base)}applyForce(K){q(K),r.add(this._forces,this._forces,K),this.CE()}applyImpulse(K){q(K),r.add(this._impulses,this._impulses,K),this.CE()}CE(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var q=K=>{};var J=F(13807),c=F(12551),E=F(13812);function M(){this.eM=.1,this.fluidDrag=.4,this.OJ=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function t(K,O,F){K=Object.assign(new M,K),this.gravity=K.gravity||[0,-10,0],this.eM=K.eM||.1,this.OJ=K.OJ||2,this.fluidDrag=K.fluidDrag||.4,this.minBounceImpulse=K.minBounceImpulse,this.bodies=[],this.jX=K.jX,this.testSolid=O,this.testFluid=F}t.prototype.PX=function(K,O,F,f,r,q){K=K||new J([0,0,0],[1,1,1]),"undefined"==typeof O&&(O=1),"undefined"==typeof F&&(F=1),"undefined"==typeof f&&(f=0),"undefined"==typeof r&&(r=1);var c=new l(K,O,F,f,r,q);return this.bodies.push(c),c},t.prototype.SX=function(K){var O=this.bodies.indexOf(K);O<0||(this.bodies.splice(O,1),K.MM=K.DX=null)};var j=c.create(),X=c.create(),u=c.create(),T=c.create(),o=c.create(),k=c.create(),N=c.create(),Z=new J([0,0,0],[1,1,1]),L=new l(Z,1,1,0,1,(()=>{}),!1);function d(K,O,F){return O=F,O*=1-(1-K.ratioInFluid)**2}t.prototype.uJ=function(K){K/=1e3;var O=v(0,c.squaredLength(this.gravity));this.bodies.forEach((F=>function(K,O,F,f){c.i(o,O.resting),K.jX&&L.loadFromCopy(O);if(O.bF<=0)return c.set(O.YE,0,0,0),c.set(O._forces,0,0,0),void c.set(O._impulses,0,0,0);var r=f||0===O.wq;if(function(K,O,F,f){if(O._sleepFrameCount>0)return!1;if(f)return!0;var r=!1,l=.5*F*F*O.wq;return c.scale(V,K.gravity,l),E(K.testSolid,O.MM,V,(function(){return r=!0,!0}),!0),r}(K,O,F,r))return;O._sleepFrameCount--,function(K,O){var F=O.MM,f=Math.floor(F.base[0]),r=Math.floor(F.base[2]),l=Math.floor(F.base[1]),q=Math.floor(F.max[1]);if(!K.testFluid(f,l,r))return O.inFluid=!1,void(O.ratioInFluid=0);var J=1,E=l+1;for(;E<=q&&K.testFluid(f,E,r);)J++,E++;var M=(l+J-F.base[1])/F.WM[1];M>1&&(M=1);var t=F.WM[0]*F.WM[1]*F.WM[2]*M,j=g;c.scale(j,K.gravity,-K.OJ*t*O.wq),O.applyForce(j),O.inFluid=!0,O.ratioInFluid=M}(K,O),B(O._forces),B(O._impulses),B(O.YE),B(O.resting),c.scale(j,O._forces,1/O.bF),c.qJ(j,j,K.gravity,O.wq),c.scale(X,O._impulses,1/O.bF),c.qJ(X,X,j,F),c.add(O.YE,O.YE,X),O.friction&&(H(K,0,O,X,F),H(K,1,O,X,F),H(K,2,O,X,F));var l=O.fluidDrag>=0?O.fluidDrag:K.fluidDrag,q=O.eM>=0?O.eM:K.eM,J=q,M=q;O.inFluid&&(J=d(O,J,O.fluidDragHoriz>=0?O.fluidDragHoriz:l),M=d(O,M,O.fluidDragVert>=0?O.fluidDragVert:l));J=Math.max(1-J*F/O.bF,0),M=Math.max(1-M*F/O.bF,0),c.set(a,J,M,J),c.multiply(O.YE,O.YE,a),c.scale(u,O.YE,F),c.set(O._forces,0,0,0),c.set(O._impulses,0,0,0),O.sq&&Y(p,O.MM);c.i(k,u),c.set(N,0,0,0),O.preventFallOffEdge&&function(K,O,F,f){if(!O.resting[1]||F[1]>0)return;var r=z;Y(r,O.MM);for(var l=0;l<3;l+=2){c.set(G,0,0,0),G[l]=F[l];var q=!0;(q=(q=(q=(q=q&&!x(K,r.base[0]+G[0]+1e-5,r.base[1],r.base[2]+G[2]+1e-5))&&!x(K,r.max[0]+G[0]-1e-5,r.base[1],r.base[2]+G[2]+1e-5))&&!x(K,r.base[0]+G[0]+1e-5,r.base[1],r.max[2]+G[2]-1e-5))&&!x(K,r.max[0]+G[0]-1e-5,r.base[1],r.max[2]+G[2]-1e-5))?(f[l]=F[l]>0?1:-1,F[l]=0):0===l&&(c.set(m,F[0],0,0),W(K,r,m,f,O.slideOnCollision))}}(K,O,u,N);W(K,O.MM,u,O.resting,O.slideOnCollision),O.sq&&function(K,O,F,f){if(O.resting[1]>=0&&!O.inFluid)return;var r=0!==O.resting[0],l=0!==O.resting[2];if(!r&&!l)return;var q=Math.abs(f[0]/f[2]),J=4;if(!r&&q>J)return;if(!l&&q<1/J)return;c.add(A,F.base,f);var M=K.testSolid;E(M,F,f,(function(K,O,F,f){if(1!==O)return!0;f[O]=0}));var t=F.base[1],j=O.inFluid?1.951:1.001,X=Math.floor(t+j)-t;c.set(Q,0,X,0);var u=!1;if(E(M,F,Q,(function(K,O,F,f){return u=!0,!0})),u)return;c.oO(R,A,F.base),R[1]=0,W(K,F,R,y,!0);var T=v(F.base[0],A[0]),o=v(F.base[2],A[2]);if(r&&!T&&(!o||!l))return;if(l&&(!T||!r)&&!o)return;var k=!0;if(k=k&&!x(K,F.base[0]+1e-5,F.base[1],F.base[2]+1e-5),k=k&&!x(K,F.max[0]-1e-5,F.base[1],F.base[2]+1e-5),k=k&&!x(K,F.base[0]+1e-5,F.base[1],F.max[2]-1e-5),k=k&&!x(K,F.max[0]-1e-5,F.base[1],F.max[2]-1e-5),k)return;Y(O.MM,F),O.resting[0]=y[0],O.resting[2]=y[2],O.Qu&&O.Qu()}(K,O,p,k);for(var t=0;t<3;++t)O.resting[t]=O.resting[t]||N[t],T[t]=0,O.resting[t]&&(o[t]||(T[t]=-O.YE[t]),O.YE[t]=0);var Z=c.length(T);Z>.001&&(c.scale(T,T,O.bF),O.DX&&O.DX(T),O.restitution>0&&Z>K.minBounceImpulse&&(c.scale(T,T,O.restitution),O.applyImpulse(T)));var e=c.squaredLength(O.YE);e>1e-5&&O.CE();K.jX&&K.jX(O)?(O.loadFromCopy(L),O.rolledBackLastTick=!0):O.rolledBackLastTick=!1}(this,F,K,O)))};var a=c.create([0,0,0]);var g=c.create();function H(K,O,F,f,r){var l=F.resting[O],q=f[O];if(!F.alwaysApplyHorizFriction||1!==O){if(0===l)return;if(l*q<=0)return}c.i(e,F.YE),e[O]=0;var J=c.length(e);if(!v(J,0)){var E=Math.abs(F.friction*K.gravity[O]*r),M=J>E?(J-E)/J:0;F.YE[(O+1)%3]*=M,F.YE[(O+2)%3]*=M}}var e=c.create();function W(K,O,F,f,r){return c.set(f,0,0,0),E(K.testSolid,O,F,(function(K,O,F,l){f[O]=F,l[O]=0,r||(l[0]=0,l[1]=0,l[2]=0)}))}var p=new J([],[]),y=c.create(),A=c.create(),Q=c.create(),R=c.create();var G=c.create(),z=new J([],[]),m=c.create();function x(K,O,F,f){return K.testSolid(Math.floor(O),Math.floor(F-1),Math.floor(f))}var V=c.create();function v(K,O){return Math.abs(K-O)<1e-5}function Y(K,O){for(var F=0;F<3;F++)K.base[F]=O.base[F],K.max[F]=O.max[F],K.WM[F]=O.WM[F]}var B=function(K){}},12415:function(K,O){!function(K){"use strict";var O=function(K,F){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,O){K.__proto__=O}||function(K,O){for(var F in O)Object.prototype.hasOwnProperty.call(O,F)&&(K[F]=O[F])},O(K,F)};function F(K,F){if("function"!==typeof F&&null!==F)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");function f(){this.constructor=K}O(K,F),K.prototype=null===F?Object.create(F):(f.prototype=F.prototype,new f)}function f(K,O,F,f){var r,l=arguments.length,q=l<3?O:null===f?f=Object.getOwnPropertyDescriptor(O,F):f;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)q=Reflect.decorate(K,O,F,f);else for(var J=K.length-1;J>=0;J--)(r=K[J])&&(q=(l<3?r(q):l>3?r(O,F,q):r(O,F))||q);return l>3&&q&&Object.defineProperty(O,F,q),q}function r(K,O,F){if(F||2===arguments.length)for(var f,r=0,l=O.length;r<l;r++)!f&&r in O||(f||(f=Array.prototype.slice.call(O,0,r)),f[r]=O[r]);return K.concat(f||Array.prototype.slice.call(O))}var l,q=255,J=213;K.OPERATION=void 0,(l=K.OPERATION||(K.OPERATION={}))[l.ADD=128]="ADD",l[l.REPLACE=0]="REPLACE",l[l.DELETE=64]="DELETE",l[l.DELETE_AND_ADD=192]="DELETE_AND_ADD",l[l.TOUCH=1]="TOUCH",l[l.CLEAR=10]="CLEAR";var c=function(){function O(K,O,F){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=K,this.setParent(O,F)}return O.prototype.setParent=function(K,O,F){var f=this;if(this.indexes||(this.indexes=this.ref instanceof RK?this.ref._definition.indexes:{}),this.parent=K,this.parentIndex=F,O)if(this.root=O,this.ref instanceof RK){var r=this.ref._definition;for(var l in r.schema){var q=this.ref[l];if(q&&q.$changes){var J=r.indexes[l];q.$changes.setParent(this.ref,O,J)}}}else"object"===typeof this.ref&&this.ref.forEach((function(K,O){if(K instanceof RK){var F=K.$changes,r=f.ref.$changes.indexes[O];F.setParent(f.ref,f.root,r)}}))},O.prototype.operation=function(K){this.changes.set(--this.currentCustomOperation,K)},O.prototype.change=function(O,F){void 0===F&&(F=K.OPERATION.ADD);var f="number"===typeof O?O:this.indexes[O];this.assertValidIndex(f,O);var r=this.changes.get(f);r&&r.op!==K.OPERATION.DELETE&&r.op!==K.OPERATION.TOUCH||this.changes.set(f,{op:r&&r.op===K.OPERATION.DELETE?K.OPERATION.DELETE_AND_ADD:F,index:f}),this.allChanges.add(f),this.changed=!0,this.touchParents()},O.prototype.touch=function(O){var F="number"===typeof O?O:this.indexes[O];this.assertValidIndex(F,O),this.changes.has(F)||this.changes.set(F,{op:K.OPERATION.TOUCH,index:F}),this.allChanges.add(F),this.touchParents()},O.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},O.prototype.getType=function(K){if(this.ref._definition)return(O=this.ref._definition).schema[O.fieldsByIndex[K]];var O,F=(O=this.parent._definition).schema[O.fieldsByIndex[this.parentIndex]];return Object.values(F)[0]},O.prototype.getChildrenFilter=function(){var K=this.parent._definition.childFilters;return K&&K[this.parentIndex]},O.prototype.getValue=function(K){return this.ref.getByIndex(K)},O.prototype.delete=function(O){var F="number"===typeof O?O:this.indexes[O];if(void 0!==F){var f=this.getValue(F);this.changes.set(F,{op:K.OPERATION.DELETE,index:F}),this.allChanges.delete(F),delete this.caches[F],f&&f.$changes&&(f.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(O," (").concat(F,")"))},O.prototype.discard=function(O,F){var f=this;void 0===O&&(O=!1),void 0===F&&(F=!1),this.ref instanceof RK||this.changes.forEach((function(O){if(O.op===K.OPERATION.DELETE){var F=f.ref.getIndex(O.index);delete f.indexes[F]}})),this.changes.clear(),this.changed=O,F&&this.allChanges.clear(),this.currentCustomOperation=0},O.prototype.discardAll=function(){var K=this;this.changes.forEach((function(O){var F=K.getValue(O.index);F&&F.$changes&&F.$changes.discardAll()})),this.discard()},O.prototype.cache=function(K,O){this.caches[K]=O},O.prototype.clone=function(){return new O(this.ref,this.parent,this.root)},O.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},O.prototype.assertValidIndex=function(K,O){if(void 0===K)throw new Error('ChangeTree: missing index for field "'.concat(O,'"'))},O}();function E(K,O,F,f){return K[O]||(K[O]=[]),K[O].push(F),null===f||void 0===f||f.forEach((function(K,O){return F(K,O)})),function(){return t(K[O],K[O].indexOf(F))}}function M(O){var F=this,f="string"!==typeof this.$changes.getType();this.$items.forEach((function(r,l){O.push({refId:F.$changes.refId,op:K.OPERATION.DELETE,field:l,value:void 0,previousValue:r}),f&&F.$changes.root.removeRef(r.$changes.refId)}))}function t(K,O){if(-1===O||O>=K.length)return!1;for(var F=K.length-1,f=O;f<F;f++)K[f]=K[f+1];return K.length=F,!0}var j=function(K,O){var F=K.toString(),f=O.toString();return F<f?-1:F>f?1:0};function X(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,O){return"symbol"===typeof O||isNaN(O)?K[O]:K.at(O)},set:function(K,O,F){if("symbol"===typeof O||isNaN(O))K[O]=F;else{var f=Array.from(K.$items.keys()),r=parseInt(f[O]||O);void 0===F||null===F?K.deleteAt(r):K.setAt(r,F)}return!0},deleteProperty:function(K,O){return"number"===typeof O?K.deleteAt(O):delete K[O],!0}})}var u=function(){function O(){for(var K=[],O=0;O<arguments.length;O++)K[O]=arguments[O];this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,K)}return O.prototype.pJ=function(O,F){return void 0===F&&(F=!0),E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,O,F?this.$items:void 0)},O.prototype.ff=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,O)},O.is=function(K){return Array.isArray(K)||void 0!==K.array},Object.defineProperty(O.prototype,"length",{get:function(){return this.$items.size},set:function(K){0===K?this.clear():this.splice(K,this.length-K)},enumerable:!1,configurable:!0}),O.prototype.push=function(){for(var K,O=this,F=[],f=0;f<arguments.length;f++)F[f]=arguments[f];return F.forEach((function(F){K=O.$refId++,O.setAt(K,F)})),K},O.prototype.pop=function(){var K=Array.from(this.$indexes.values()).pop();if(void 0!==K){this.$changes.delete(K),this.$indexes.delete(K);var O=this.$items.get(K);return this.$items.delete(K),O}},O.prototype.at=function(K){var O=Array.from(this.$items.keys())[K];return this.$items.get(O)},O.prototype.setAt=function(O,F){var f,r;if(void 0!==F&&null!==F){if(this.$items.get(O)!==F){void 0!==F.$changes&&F.$changes.setParent(this,this.$changes.root,O);var l=null!==(r=null===(f=this.$changes.indexes[O])||void 0===f?void 0:f.op)&&void 0!==r?r:K.OPERATION.ADD;this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,F),this.$changes.change(O,l)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},O.prototype.deleteAt=function(K){var O=Array.from(this.$items.keys())[K];return void 0!==O&&this.$deleteAt(O)},O.prototype.$deleteAt=function(K){return this.$changes.delete(K),this.$indexes.delete(K),this.$items.delete(K)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&M.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.concat=function(){for(var K,F=[],f=0;f<arguments.length;f++)F[f]=arguments[f];return new(O.bind.apply(O,r([void 0],(K=Array.from(this.$items.values())).concat.apply(K,F),!1)))},O.prototype.join=function(K){return Array.from(this.$items.values()).join(K)},O.prototype.reverse=function(){var K=this,O=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(F,f){K.setAt(O[f],F)})),this},O.prototype.shift=function(){var K=Array.from(this.$items.keys()).shift();if(void 0!==K){var O=this.$items.get(K);return this.$deleteAt(K),O}},O.prototype.slice=function(K,F){var f=new O;return f.push.apply(f,Array.from(this.$items.values()).slice(K,F)),f},O.prototype.sort=function(K){var O=this;void 0===K&&(K=j);var F=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(K).forEach((function(K,f){O.setAt(F[f],K)})),this},O.prototype.splice=function(K,O){void 0===O&&(O=this.length-K);for(var F=Array.from(this.$items.keys()),f=[],r=K;r<K+O;r++)f.push(this.$items.get(F[r])),this.$deleteAt(F[r]);return f},O.prototype.unshift=function(){for(var K=this,O=[],F=0;F<arguments.length;F++)O[F]=arguments[F];var f=this.length,r=O.length,l=Array.from(this.$items.values());return O.forEach((function(O,F){K.setAt(F,O)})),l.forEach((function(O,F){K.setAt(r+F,O)})),f+r},O.prototype.indexOf=function(K,O){return Array.from(this.$items.values()).indexOf(K,O)},O.prototype.lastIndexOf=function(K,O){return void 0===O&&(O=this.length-1),Array.from(this.$items.values()).lastIndexOf(K,O)},O.prototype.every=function(K,O){return Array.from(this.$items.values()).every(K,O)},O.prototype.some=function(K,O){return Array.from(this.$items.values()).some(K,O)},O.prototype.forEach=function(K,O){Array.from(this.$items.values()).forEach(K,O)},O.prototype.map=function(K,O){return Array.from(this.$items.values()).map(K,O)},O.prototype.filter=function(K,O){return Array.from(this.$items.values()).filter(K,O)},O.prototype.reduce=function(K,O){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},O.prototype.reduceRight=function(K,O){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},O.prototype.find=function(K,O){return Array.from(this.$items.values()).find(K,O)},O.prototype.findIndex=function(K,O){return Array.from(this.$items.values()).findIndex(K,O)},O.prototype.fill=function(K,O,F){throw new Error("ArraySchema#fill() not implemented")},O.prototype.copyWithin=function(K,O,F){throw new Error("ArraySchema#copyWithin() not implemented")},O.prototype.toString=function(){return this.$items.toString()},O.prototype.toLocaleString=function(){return this.$items.toLocaleString()},O.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},O.prototype.includes=function(K,O){return Array.from(this.$items.values()).includes(K,O)},O.prototype.flatMap=function(K,O){throw new Error("ArraySchema#flatMap() is not supported.")},O.prototype.flat=function(K){throw new Error("ArraySchema#flat() is not supported.")},O.prototype.findLast=function(){var K=Array.from(this.$items.values());return K.findLast.apply(K,arguments)},O.prototype.findLastIndex=function(){var K=Array.from(this.$items.values());return K.findLastIndex.apply(K,arguments)},O.prototype.setIndex=function(K,O){this.$indexes.set(K,O)},O.prototype.getIndex=function(K){return this.$indexes.get(K)},O.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},O.prototype.deleteByIndex=function(K){var O=this.$indexes.get(K);this.$items.delete(O),this.$indexes.delete(K)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){return this.toArray().map((function(K){return"function"===typeof K.toJSON?K.toJSON():K}))},O.prototype.clone=function(K){return K?new(O.bind.apply(O,r([void 0],Array.from(this.$items.values()),!1))):new(O.bind.apply(O,r([void 0],this.map((function(K){return K.$changes?K.clone():K})),!1)))},O}();function T(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,O){return"symbol"!==typeof O&&"undefined"===typeof K[O]?K.get(O):K[O]},set:function(K,O,F){return"symbol"!==typeof O&&-1===O.indexOf("$")&&"pJ"!==O&&"ff"!==O&&"onChange"!==O?K.set(O,F):K[O]=F,!0},deleteProperty:function(K,O){return K.delete(O),!0}})}var o=function(){function O(K){var F=this;if(this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K)if(K instanceof Map||K instanceof O)K.forEach((function(K,O){return F.set(O,K)}));else for(var f in K)this.set(f,K[f])}return O.prototype.pJ=function(O,F){return void 0===F&&(F=!0),E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,O,F?this.$items:void 0)},O.prototype.ff=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,O)},O.is=function(K){return void 0!==K.map},O.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(O.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.set=function(O,F){if(void 0===F||null===F)throw new Error("MapSchema#set('".concat(O,"', ").concat(F,"): trying to set ").concat(F," value on '").concat(O,"'."));O=O.toString();var f="undefined"!==typeof this.$changes.indexes[O],r=f?this.$changes.indexes[O]:this.$refId++,l=f?K.OPERATION.REPLACE:K.OPERATION.ADD,q=void 0!==F.$changes;if(q&&F.$changes.setParent(this,this.$changes.root,r),f){if(!q&&this.$items.get(O)===F)return;q&&this.$items.get(O)!==F&&(l=K.OPERATION.ADD)}else this.$changes.indexes[O]=r,this.$indexes.set(r,O);return this.$items.set(O,F),this.$changes.change(O,l),this},O.prototype.get=function(K){return this.$items.get(K)},O.prototype.delete=function(K){return this.$changes.delete(K),this.$items.delete(K)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&M.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(K){return this.$items.has(K)},O.prototype.forEach=function(K){this.$items.forEach(K)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(K,O){this.$indexes.set(K,O)},O.prototype.getIndex=function(K){return this.$indexes.get(K)},O.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},O.prototype.deleteByIndex=function(K){var O=this.$indexes.get(K);this.$items.delete(O),this.$indexes.delete(K)},O.prototype.toJSON=function(){var K={};return this.forEach((function(O,F){K[F]="function"===typeof O.toJSON?O.toJSON():O})),K},O.prototype.clone=function(K){var F;return K?F=Object.assign(new O,this):(F=new O,this.forEach((function(K,O){K.$changes?F.set(O,K.clone()):F.set(O,K)}))),F},O}(),k={};function N(K,O){k[K]=O}function Z(K){return k[K]}var L=function(){function K(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return K.create=function(O){var F=new K;return F.schema=Object.assign({},O&&O.schema||{}),F.indexes=Object.assign({},O&&O.indexes||{}),F.fieldsByIndex=Object.assign({},O&&O.fieldsByIndex||{}),F.descriptors=Object.assign({},O&&O.descriptors||{}),F.deprecated=Object.assign({},O&&O.deprecated||{}),F},K.prototype.addField=function(K,O){var F=this.getNextFieldIndex();this.fieldsByIndex[F]=K,this.indexes[K]=F,this.schema[K]=Array.isArray(O)?{array:O[0]}:O},K.prototype.hasField=function(K){return void 0!==this.indexes[K]},K.prototype.addFilter=function(K,O){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[K]]=O,this.indexesWithFilters.push(this.indexes[K]),!0},K.prototype.addChildrenFilter=function(K,O){var F=this.indexes[K],f=this.schema[K];if(Z(Object.keys(f)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[F]=O,!0;console.warn("@filterChildren: field '".concat(K,"' can't have children. Ignoring filter."))},K.prototype.getChildrenFilter=function(K){return this.childFilters&&this.childFilters[this.indexes[K]]},K.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},K}();function d(K){return K._context&&K._context.useFilters}var a=function(){function K(){this.types={},this.schemas=new Map,this.useFilters=!1}return K.prototype.has=function(K){return this.schemas.has(K)},K.prototype.get=function(K){return this.types[K]},K.prototype.add=function(K,O){void 0===O&&(O=this.schemas.size),K._definition=L.create(K._definition),K._typeid=O,this.types[O]=K,this.schemas.set(K,O)},K.create=function(O){return void 0===O&&(O={}),function(F){return O.context||(O.context=new K),H(F,O)}},K}(),g=new a;function H(K,O){return void 0===O&&(O={}),function(F,f){var l=O.context||g,q=F.constructor;if(q._context=l,!K)throw new Error("".concat(q.name,': @type() reference provided for "').concat(f,"\" is undefined. Make sure you don't have any circular dependencies."));l.has(q)||l.add(q);var J=q._definition;if(J.addField(f,K),J.descriptors[f]){if(J.deprecated[f])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(f,"' definition on '").concat(q.name,"'.\nCheck @type() annotation"))}catch(k){var c=k.stack.split("\n")[4].trim();throw new Error("".concat(k.message," ").concat(c))}}var E=u.is(K),M=!E&&o.is(K);if("string"!==typeof K&&!RK.is(K)){var t=Object.values(K)[0];"string"===typeof t||l.has(t)||l.add(t)}if(O.manual)J.descriptors[f]={enumerable:!0,configurable:!0,writable:!0};else{var j="_".concat(f);J.descriptors[j]={enumerable:!1,configurable:!1,writable:!0},J.descriptors[f]={get:function(){return this[j]},set:function(K){K!==this[j]&&(void 0!==K&&null!==K?(!E||K instanceof u||(K=new(u.bind.apply(u,r([void 0],K,!1)))),!M||K instanceof o||(K=new o(K)),void 0===K.$proxy&&(M?K=T(K):E&&(K=X(K))),this.$changes.change(f),K.$changes&&K.$changes.setParent(this,this.$changes.root,this._definition.indexes[f])):this[j]&&this.$changes.delete(f),this[j]=K)},enumerable:!0,configurable:!0}}}}function e(K){return function(O,F){var f=O.constructor;f._definition.addFilter(F,K)&&(f._context.useFilters=!0)}}function W(K){return function(O,F){var f=O.constructor;f._definition.addChildrenFilter(F,K)&&(f._context.useFilters=!0)}}function p(K){return void 0===K&&(K=!0),function(O,F){var f=O.constructor._definition;f.deprecated[F]=!0,K&&(f.descriptors[F]={get:function(){throw new Error("".concat(F," is deprecated."))},set:function(K){},enumerable:!1,configurable:!0})}}function y(K,O,F){for(var f in void 0===F&&(F={}),F.context||(F.context=K._context||F.context||g),O)H(O[f],F)(K.prototype,f);return K}function A(K){for(var O=0,F=0,f=0,r=K.length;f<r;f++)(O=K.charCodeAt(f))<128?F+=1:O<2048?F+=2:O<55296||O>=57344?F+=3:(f++,F+=4);return F}function Q(K,O,F){for(var f=0,r=0,l=F.length;r<l;r++)(f=F.charCodeAt(r))<128?K[O++]=f:f<2048?(K[O++]=192|f>>6,K[O++]=128|63&f):f<55296||f>=57344?(K[O++]=224|f>>12,K[O++]=128|f>>6&63,K[O++]=128|63&f):(r++,f=65536+((1023&f)<<10|1023&F.charCodeAt(r)),K[O++]=240|f>>18,K[O++]=128|f>>12&63,K[O++]=128|f>>6&63,K[O++]=128|63&f)}function R(K,O){K.push(255&O)}function G(K,O){K.push(255&O)}function z(K,O){K.push(255&O),K.push(O>>8&255)}function m(K,O){K.push(255&O),K.push(O>>8&255)}function x(K,O){K.push(255&O),K.push(O>>8&255),K.push(O>>16&255),K.push(O>>24&255)}function V(K,O){var F=O>>24,f=O>>16,r=O>>8,l=O;K.push(255&l),K.push(255&r),K.push(255&f),K.push(255&F)}function v(K,O){var F=Math.floor(O/Math.pow(2,32));V(K,O>>>0),V(K,F)}function Y(K,O){var F=O/Math.pow(2,32)|0;V(K,O>>>0),V(K,F)}function B(K,O){h(K,O)}function n(K,O){b(K,O)}var C=new Int32Array(2),I=new Float32Array(C.buffer),D=new Float64Array(C.buffer);function h(K,O){I[0]=O,x(K,C[0])}function b(K,O){D[0]=O,x(K,C[0]),x(K,C[1])}function i(K,O){return G(K,O?1:0)}function w(K,O){O||(O="");var F=A(O),f=0;if(F<32)K.push(160|F),f=1;else if(F<256)K.push(217),G(K,F),f=2;else if(F<65536)K.push(218),m(K,F),f=3;else{if(!(F<4294967296))throw new Error("String too long");K.push(219),V(K,F),f=5}return Q(K,K.length,O),f+F}function s(K,O){return isNaN(O)?s(K,0):isFinite(O)?O!==(0|O)?(K.push(203),b(K,O),9):O>=0?O<128?(G(K,O),1):O<256?(K.push(204),G(K,O),2):O<65536?(K.push(205),m(K,O),3):O<4294967296?(K.push(206),V(K,O),5):(K.push(207),Y(K,O),9):O>=-32?(K.push(224|O+32),1):O>=-128?(K.push(208),R(K,O),2):O>=-32768?(K.push(209),z(K,O),3):O>=-2147483648?(K.push(210),x(K,O),5):(K.push(211),v(K,O),9):s(K,O>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var U=Object.freeze({__proto__:null,utf8Write:Q,int8:R,uint8:G,int16:z,uint16:m,int32:x,uint32:V,int64:v,uint64:Y,float32:B,float64:n,writeFloat32:h,writeFloat64:b,boolean:i,string:w,number:s});function P(K,O,F){for(var f="",r=0,l=O,q=O+F;l<q;l++){var J=K[l];0!==(128&J)?192!==(224&J)?224!==(240&J)?240!==(248&J)?console.error("Invalid byte "+J.toString(16)):(r=(7&J)<<18|(63&K[++l])<<12|(63&K[++l])<<6|63&K[++l])>=65536?(r-=65536,f+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):f+=String.fromCharCode(r):f+=String.fromCharCode((15&J)<<12|(63&K[++l])<<6|63&K[++l]):f+=String.fromCharCode((31&J)<<6|63&K[++l]):f+=String.fromCharCode(J)}return f}function S(K,O){return KK(K,O)<<24>>24}function KK(K,O){return K[O.offset++]}function OK(K,O){return FK(K,O)<<16>>16}function FK(K,O){return K[O.offset++]|K[O.offset++]<<8}function fK(K,O){return K[O.offset++]|K[O.offset++]<<8|K[O.offset++]<<16|K[O.offset++]<<24}function rK(K,O){return fK(K,O)>>>0}function lK(K,O){return jK(K,O)}function qK(K,O){return XK(K,O)}function JK(K,O){var F=rK(K,O);return fK(K,O)*Math.pow(2,32)+F}function cK(K,O){var F=rK(K,O);return rK(K,O)*Math.pow(2,32)+F}var EK=new Int32Array(2),MK=new Float32Array(EK.buffer),tK=new Float64Array(EK.buffer);function jK(K,O){return EK[0]=fK(K,O),MK[0]}function XK(K,O){return EK[0]=fK(K,O),EK[1]=fK(K,O),tK[0]}function uK(K,O){return KK(K,O)>0}function TK(K,O){var F,f=K[O.offset++];f<192?F=31&f:217===f?F=KK(K,O):218===f?F=FK(K,O):219===f&&(F=rK(K,O));var r=P(K,O.offset,F);return O.offset+=F,r}function oK(K,O){var F=K[O.offset];return F<192&&F>160||217===F||218===F||219===F}function kK(K,O){var F=K[O.offset++];return F<128?F:202===F?jK(K,O):203===F?XK(K,O):204===F?KK(K,O):205===F?FK(K,O):206===F?rK(K,O):207===F?cK(K,O):208===F?S(K,O):209===F?OK(K,O):210===F?fK(K,O):211===F?JK(K,O):F>223?-1*(255-F+1):void 0}function NK(K,O){var F=K[O.offset];return F<128||F>=202&&F<=211}function ZK(K,O){return K[O.offset]<160}function LK(K,O){return K[O.offset-1]===q&&(K[O.offset]<128||K[O.offset]>=202&&K[O.offset]<=211)}var dK=Object.freeze({__proto__:null,int8:S,uint8:KK,int16:OK,uint16:FK,int32:fK,uint32:rK,float32:lK,float64:qK,int64:JK,uint64:cK,readFloat32:jK,readFloat64:XK,boolean:uK,string:TK,stringCheck:oK,number:kK,numberCheck:NK,arrayCheck:ZK,switchStructureCheck:LK}),aK=function(){function O(K){var O=this;this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return O.add(K)}))}return O.prototype.pJ=function(O,F){return void 0===F&&(F=!0),E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,O,F?this.$items:void 0)},O.prototype.ff=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,O)},O.is=function(K){return void 0!==K.collection},O.prototype.add=function(K){var O=this.$refId++;return void 0!==K.$changes&&K.$changes.setParent(this,this.$changes.root,O),this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,K),this.$changes.change(O),O},O.prototype.at=function(K){var O=Array.from(this.$items.keys())[K];return this.$items.get(O)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(K){for(var O,F,f=this.$items.entries();(F=f.next())&&!F.done;)if(K===F.value[1]){O=F.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&M.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(K){return Array.from(this.$items.values()).some((function(O){return O===K}))},O.prototype.forEach=function(K){var O=this;this.$items.forEach((function(F,f,r){return K(F,f,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(K,O){this.$indexes.set(K,O)},O.prototype.getIndex=function(K){return this.$indexes.get(K)},O.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},O.prototype.deleteByIndex=function(K){var O=this.$indexes.get(K);this.$items.delete(O),this.$indexes.delete(K)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var K=[];return this.forEach((function(O,F){K.push("function"===typeof O.toJSON?O.toJSON():O)})),K},O.prototype.clone=function(K){var F;return K?F=Object.assign(new O,this):(F=new O,this.forEach((function(K){K.$changes?F.add(K.clone()):F.add(K)}))),F},O}(),gK=function(){function O(K){var O=this;this.$changes=new c(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return O.add(K)}))}return O.prototype.pJ=function(O,F){return void 0===F&&(F=!0),E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,O,F?this.$items:void 0)},O.prototype.ff=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,O)},O.is=function(K){return void 0!==K.set},O.prototype.add=function(O){var F,f;if(this.has(O))return!1;var r=this.$refId++;void 0!==O.$changes&&O.$changes.setParent(this,this.$changes.root,r);var l=null!==(f=null===(F=this.$changes.indexes[r])||void 0===F?void 0:F.op)&&void 0!==f?f:K.OPERATION.ADD;return this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,O),this.$changes.change(r,l),r},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(K){for(var O,F,f=this.$items.entries();(F=f.next())&&!F.done;)if(K===F.value[1]){O=F.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&M.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(K){for(var O,F=this.$items.values(),f=!1;(O=F.next())&&!O.done;)if(K===O.value){f=!0;break}return f},O.prototype.forEach=function(K){var O=this;this.$items.forEach((function(F,f,r){return K(F,f,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(K,O){this.$indexes.set(K,O)},O.prototype.getIndex=function(K){return this.$indexes.get(K)},O.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},O.prototype.deleteByIndex=function(K){var O=this.$indexes.get(K);this.$items.delete(O),this.$indexes.delete(K)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var K=[];return this.forEach((function(O,F){K.push("function"===typeof O.toJSON?O.toJSON():O)})),K},O.prototype.clone=function(K){var F;return K?F=Object.assign(new O,this):(F=new O,this.forEach((function(K){K.$changes?F.add(K.clone()):F.add(K)}))),F},O}(),HK=function(){function K(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return K.prototype.addRefId=function(K){this.refIds.has(K)||(this.refIds.add(K),this.containerIndexes.set(K,new Set))},K.get=function(O){return void 0===O.$filterState&&(O.$filterState=new K),O.$filterState},K}(),eK=function(){function K(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return K.prototype.getNextUniqueId=function(){return this.nextUniqueId++},K.prototype.addRef=function(K,O,F){void 0===F&&(F=!0),this.refs.set(K,O),F&&(this.refCounts[K]=(this.refCounts[K]||0)+1)},K.prototype.removeRef=function(K){this.refCounts[K]=this.refCounts[K]-1,this.deletedRefs.add(K)},K.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},K.prototype.garbageCollectDeletedRefs=function(){var K=this;this.deletedRefs.forEach((function(O){if(!(K.refCounts[O]>0)){var F=K.refs.get(O);if(F instanceof RK)for(var f in F._definition.schema)"string"!==typeof F._definition.schema[f]&&F[f]&&F[f].$changes&&K.removeRef(F[f].$changes.refId);else{var r=F.$changes.parent._definition,l=r.schema[r.fieldsByIndex[F.$changes.parentIndex]];"function"===typeof Object.values(l)[0]&&Array.from(F.values()).forEach((function(O){return K.removeRef(O.$changes.refId)}))}K.refs.delete(O),delete K.refCounts[O]}})),this.deletedRefs.clear()},K}(),WK=function(K){function O(){return null!==K&&K.apply(this,arguments)||this}return F(O,K),O}(Error);function pK(K,O,F,f){var r,l=!1;switch(O){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":r="number",isNaN(K)&&console.log('trying to encode "NaN" in '.concat(F.constructor.name,"#").concat(f));break;case"string":r="string",l=!0;break;case"boolean":return}if(typeof K!==r&&(!l||l&&null!==K)){var q="'".concat(JSON.stringify(K),"'").concat(K&&K.constructor&&" (".concat(K.constructor.name,")")||"");throw new WK("a '".concat(r,"' was expected, but ").concat(q," was provided in ").concat(F.constructor.name,"#").concat(f))}}function yK(K,O,F,f){if(!(K instanceof O))throw new WK("a '".concat(O.name,"' was expected, but '").concat(K.constructor.name,"' was provided in ").concat(F.constructor.name,"#").concat(f))}function AK(K,O,F,f,r){pK(F,K,f,r);var l=U[K];if(!l)throw new WK("a '".concat(K,"' was expected, but ").concat(F," was provided in ").concat(f.constructor.name,"#").concat(r));l(O,F)}function QK(K,O,F){return dK[K](O,F)}var RK=function(){function O(){for(var K=[],O=0;O<arguments.length;O++)K[O]=arguments[O];Object.defineProperties(this,{$changes:{value:new c(this,void 0,new eK),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var F=this._definition.descriptors;F&&Object.defineProperties(this,F),K[0]&&this.assign(K[0])}return O.onError=function(K){console.error(K)},O.is=function(K){return K._definition&&void 0!==K._definition.schema},O.prototype.onChange=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,O)},O.prototype.ff=function(O){return E(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,O)},O.prototype.assign=function(K){return Object.assign(this,K),this},Object.defineProperty(O.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),O.prototype.setDirty=function(K,O){this.$changes.change(K,O)},O.prototype.listen=function(K,O,F){var f=this;return void 0===F&&(F=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[K]||(this.$callbacks[K]=[]),this.$callbacks[K].push(O),F&&void 0!==this[K]&&O(this[K],void 0),function(){return t(f.$callbacks[K],f.$callbacks[K].indexOf(O))}},O.prototype.decode=function(F,f,r){var l;void 0===f&&(f={offset:0}),void 0===r&&(r=this);var J=[],c=this.$changes.root,E=F.length,M=0;for(c.refs.set(M,this);f.offset<E;){var t=F[f.offset++];if(t!=q){var j=r.$changes,X=void 0!==r._definition,T=X?t>>6<<6:t;if(T!==K.OPERATION.CLEAR){var k=X?t%(T||255):kK(F,f),N=X?r._definition.fieldsByIndex[k]:"",L=j.getType(k),d=void 0,a=void 0,g=void 0;if(X?a=r["_".concat(N)]:(a=r.getByIndex(k),(T&K.OPERATION.ADD)===K.OPERATION.ADD?(g=r instanceof o?TK(F,f):k,r.setIndex(k,g)):g=r.getIndex(k)),(T&K.OPERATION.DELETE)===K.OPERATION.DELETE&&(T!==K.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(k),a&&a.$changes&&c.removeRef(a.$changes.refId),d=null),void 0!==N){if(T===K.OPERATION.DELETE);else if(O.is(L)){var H=kK(F,f);if(d=c.refs.get(H),T!==K.OPERATION.REPLACE){var e=this.getSchemaType(F,f,L);d||((d=this.createTypeInstance(e)).$changes.refId=H,a&&(d.$callbacks=a.$callbacks,a.$changes.refId&&H!==a.$changes.refId&&c.removeRef(a.$changes.refId))),c.addRef(H,d,d!==a)}}else if("string"===typeof L)d=QK(L,F,f);else{var W=Z(Object.keys(L)[0]),p=kK(F,f),y=c.refs.has(p)?a||c.refs.get(p):new W.constructor;if((d=y.clone(!0)).$changes.refId=p,a&&(d.$callbacks=a.$callbacks,a.$changes.refId&&p!==a.$changes.refId)){c.removeRef(a.$changes.refId);for(var A=a.entries(),Q=void 0;(Q=A.next())&&!Q.done;){var R=(l=Q.value)[0],G=l[1];J.push({refId:p,op:K.OPERATION.DELETE,field:R,value:void 0,previousValue:G})}}c.addRef(p,d,y!==a)}if(null!==d&&void 0!==d)if(d.$changes&&d.$changes.setParent(j.ref,j.root,k),r instanceof O)r[N]=d;else if(r instanceof o)R=g,r.$items.set(R,d),r.$changes.allChanges.add(k);else if(r instanceof u)r.setAt(k,d);else if(r instanceof aK){var z=r.add(d);r.setIndex(k,z)}else r instanceof gK&&!1!==(z=r.add(d))&&r.setIndex(k,z);a!==d&&J.push({refId:M,op:T,field:N,dynamicIndex:g,value:d,previousValue:a})}else{console.warn("@colyseus/schema: definition mismatch");for(var m={offset:f.offset};f.offset<E&&(!LK(F,f)||(m.offset=f.offset+1,!c.refs.has(kK(F,m))));)f.offset++}}else r.clear(J)}else{M=kK(F,f);var x=c.refs.get(M);if(!x)throw new Error('"refId" not found: '.concat(M));r=x}}return this._triggerChanges(J),c.garbageCollectDeletedRefs(),J},O.prototype.encode=function(F,f,r){void 0===F&&(F=!1),void 0===f&&(f=[]),void 0===r&&(r=!1);for(var l=this.$changes,J=new WeakSet,c=[l],E=1,M=0;M<E;M++){var t=c[M],j=t.ref,X=j instanceof O;t.ensureRefId(),J.add(t),t!==l&&(t.changed||F)&&(G(f,q),s(f,t.refId));for(var u=F?Array.from(t.allChanges):Array.from(t.changes.values()),T=0,k=u.length;T<k;T++){var N=F?{op:K.OPERATION.ADD,index:u[T]}:u[T],L=N.index,d=X?j._definition.fieldsByIndex&&j._definition.fieldsByIndex[L]:L,a=f.length;if(N.op!==K.OPERATION.TOUCH)if(X)G(f,L|N.op);else{if(G(f,N.op),N.op===K.OPERATION.CLEAR)continue;s(f,L)}if(X||(N.op&K.OPERATION.ADD)!=K.OPERATION.ADD||j instanceof o&&w(f,t.ref.$indexes.get(L)),N.op!==K.OPERATION.DELETE){var g=t.getType(L),H=t.getValue(L);if(H&&H.$changes&&!J.has(H.$changes)&&(c.push(H.$changes),H.$changes.ensureRefId(),E++),N.op!==K.OPERATION.TOUCH){if(O.is(g))yK(H,g,j,d),s(f,H.$changes.refId),(N.op&K.OPERATION.ADD)===K.OPERATION.ADD&&this.tryEncodeTypeId(f,g,H.constructor);else if("string"===typeof g)AK(g,f,H,j,d);else{var e=Z(Object.keys(g)[0]);yK(j["_".concat(d)],e.constructor,j,d),s(f,H.$changes.refId)}r&&t.cache(L,f.slice(a))}}}F||r||t.discard()}return f},O.prototype.encodeAll=function(K){return this.encode(!0,[],K)},O.prototype.applyFilters=function(F,f){var r,l;void 0===f&&(f=!1);for(var J=this,c=new Set,E=HK.get(F),M=[this.$changes],t=1,j=[],X=function(X){var u=M[X];if(c.has(u.refId))return"continue";var T=u.ref,k=T instanceof O;G(j,q),s(j,u.refId);var N=E.refIds.has(u),Z=f||!N;E.addRefId(u);var L=E.containerIndexes.get(u),d=Z?Array.from(u.allChanges):Array.from(u.changes.values());!f&&k&&T._definition.indexesWithFilters&&T._definition.indexesWithFilters.forEach((function(O){!L.has(O)&&u.allChanges.has(O)&&(Z?d.push(O):d.push({op:K.OPERATION.ADD,index:O}))}));for(var a=0,g=d.length;a<g;a++){var H=Z?{op:K.OPERATION.ADD,index:d[a]}:d[a];if(H.op!==K.OPERATION.CLEAR){var e=H.index;if(H.op!==K.OPERATION.DELETE){var W=u.getValue(e),p=u.getType(e);if(k){if((y=T._definition.filters&&T._definition.filters[e])&&!y.call(T,F,W,J)){W&&W.$changes&&c.add(W.$changes.refId);continue}}else{var y,A=u.parent;if((y=u.getChildrenFilter())&&!y.call(A,F,T.$indexes.get(e),W,J)){W&&W.$changes&&c.add(W.$changes.refId);continue}}if(W.$changes&&(M.push(W.$changes),t++),H.op!==K.OPERATION.TOUCH)if(H.op===K.OPERATION.ADD||k)j.push.apply(j,null!==(r=u.caches[e])&&void 0!==r?r:[]),L.add(e);else if(L.has(e))j.push.apply(j,null!==(l=u.caches[e])&&void 0!==l?l:[]);else{if(L.add(e),G(j,K.OPERATION.ADD),s(j,e),T instanceof o){var Q=u.ref.$indexes.get(e);w(j,Q)}W.$changes?s(j,W.$changes.refId):U[p](j,W)}else W.$changes&&!k&&(G(j,K.OPERATION.ADD),s(j,e),T instanceof o&&(Q=u.ref.$indexes.get(e),w(j,Q)),s(j,W.$changes.refId))}else k?G(j,H.op|e):(G(j,H.op),s(j,e))}else G(j,H.op)}},u=0;u<t;u++)X(u);return j},O.prototype.clone=function(){var K,O=new this.constructor,F=this._definition.schema;for(var f in F)"object"===typeof this[f]&&"function"===typeof(null===(K=this[f])||void 0===K?void 0:K.clone)?O[f]=this[f].clone():O[f]=this[f];return O},O.prototype.toJSON=function(){var K=this._definition.schema,O=this._definition.deprecated,F={};for(var f in K)O[f]||null===this[f]||"undefined"===typeof this[f]||(F[f]="function"===typeof this[f].toJSON?this[f].toJSON():this["_".concat(f)]);return F},O.prototype.discardAllChanges=function(){this.$changes.discardAll()},O.prototype.getByIndex=function(K){return this[this._definition.fieldsByIndex[K]]},O.prototype.deleteByIndex=function(K){this[this._definition.fieldsByIndex[K]]=void 0},O.prototype.tryEncodeTypeId=function(K,O,F){O._typeid!==F._typeid&&(G(K,J),s(K,F._typeid))},O.prototype.getSchemaType=function(K,O,F){var f;return K[O.offset]===J&&(O.offset++,f=this.constructor._context.get(kK(K,O))),f||F},O.prototype.createTypeInstance=function(K){var O=new K;return O.$changes.root=this.$changes.root,O},O.prototype._triggerChanges=function(F){for(var f,r,l,q,J,c,E,M,t,j=new Set,X=this.$changes.root.refs,u=function(u){var T=F[u],o=T.refId,k=X.get(o),N=k.$callbacks;if((T.op&K.OPERATION.DELETE)===K.OPERATION.DELETE&&T.previousValue instanceof O&&(null===(r=null===(f=T.previousValue.$callbacks)||void 0===f?void 0:f[K.OPERATION.DELETE])||void 0===r||r.forEach((function(K){return K()}))),!N)return"continue";if(k instanceof O){if(!j.has(o))try{null===(l=null===N||void 0===N?void 0:N[K.OPERATION.REPLACE])||void 0===l||l.forEach((function(K){return K()}))}catch(Z){O.onError(Z)}try{N.hasOwnProperty(T.field)&&(null===(q=N[T.field])||void 0===q||q.forEach((function(K){return K(T.value,T.previousValue)})))}catch(Z){O.onError(Z)}}else T.op===K.OPERATION.ADD&&void 0===T.previousValue?null===(J=N[K.OPERATION.ADD])||void 0===J||J.forEach((function(K){var O;return K(T.value,null!==(O=T.dynamicIndex)&&void 0!==O?O:T.field)})):T.op===K.OPERATION.DELETE?void 0!==T.previousValue&&(null===(c=N[K.OPERATION.DELETE])||void 0===c||c.forEach((function(K){var O;return K(T.previousValue,null!==(O=T.dynamicIndex)&&void 0!==O?O:T.field)}))):T.op===K.OPERATION.DELETE_AND_ADD&&(void 0!==T.previousValue&&(null===(E=N[K.OPERATION.DELETE])||void 0===E||E.forEach((function(K){var O;return K(T.previousValue,null!==(O=T.dynamicIndex)&&void 0!==O?O:T.field)}))),null===(M=N[K.OPERATION.ADD])||void 0===M||M.forEach((function(K){var O;return K(T.value,null!==(O=T.dynamicIndex)&&void 0!==O?O:T.field)}))),T.value!==T.previousValue&&(null===(t=N[K.OPERATION.REPLACE])||void 0===t||t.forEach((function(K){var O;return K(T.value,null!==(O=T.dynamicIndex)&&void 0!==O?O:T.field)})));j.add(o)},T=0;T<F.length;T++)u(T)},O._definition=L.create(),O}();function GK(K){for(var O=[K.$changes],F=1,f={},r=f,l=function(K){var F=O[K];F.changes.forEach((function(K){var O=F.ref,f=K.index,l=O._definition?O._definition.fieldsByIndex[f]:O.$indexes.get(f);r[l]=F.getValue(f)}))},q=0;q<F;q++)l(q);return f}var zK={context:new a},mK=function(K){function O(){return null!==K&&K.apply(this,arguments)||this}return F(O,K),f([H("string",zK)],O.prototype,"name",void 0),f([H("string",zK)],O.prototype,"type",void 0),f([H("number",zK)],O.prototype,"referencedType",void 0),O}(RK),xK=function(K){function O(){var O=null!==K&&K.apply(this,arguments)||this;return O.fields=new u,O}return F(O,K),f([H("number",zK)],O.prototype,"id",void 0),f([H([mK],zK)],O.prototype,"fields",void 0),O}(RK),VK=function(K){function O(){var O=null!==K&&K.apply(this,arguments)||this;return O.types=new u,O}return F(O,K),O.encode=function(K){var F=K.constructor,f=new O;f.rootType=F._typeid;var r=function(K,O){for(var F in O){var r=new mK;r.name=F;var l=void 0;if("string"===typeof O[F])l=O[F];else{var q=O[F],J=void 0;RK.is(q)?(l="ref",J=O[F]):"string"===typeof q[l=Object.keys(q)[0]]?l+=":"+q[l]:J=q[l],r.referencedType=J?J._typeid:-1}r.type=l,K.fields.push(r)}f.types.push(K)},l=F._context.types;for(var q in l){var J=new xK;J.id=Number(q),r(J,l[q]._definition.schema)}return f.encodeAll()},O.decode=function(K,f){var r=new a,l=new O;l.decode(K,f);var q=l.types.reduce((function(K,O){var f=function(K){function O(){return null!==K&&K.apply(this,arguments)||this}return F(O,K),O}(RK),l=O.id;return K[l]=f,r.add(f,l),K}),{});l.types.forEach((function(K){var O=q[K.id];K.fields.forEach((function(K){var F;if(void 0!==K.referencedType){var f=K.type,l=q[K.referencedType];if(!l){var J=K.type.split(":");f=J[0],l=J[1]}"ref"===f?H(l,{context:r})(O.prototype,K.name):H(((F={})[f]=l,F),{context:r})(O.prototype,K.name)}else H(K.type,{context:r})(O.prototype,K.name)}))}));var J=q[l.rootType],c=new J;for(var E in J._definition.schema){var M=J._definition.schema[E];"string"!==typeof M&&(c[E]="function"===typeof M?new M:new(Z(Object.keys(M)[0]).constructor))}return c},f([H([xK],zK)],O.prototype,"types",void 0),f([H("number",zK)],O.prototype,"rootType",void 0),O}(RK);N("map",{constructor:o}),N("array",{constructor:u}),N("set",{constructor:gK}),N("collection",{constructor:aK}),K.ArraySchema=u,K.CollectionSchema=aK,K.Context=a,K.MapSchema=o,K.Reflection=VK,K.ReflectionField=mK,K.ReflectionType=xK,K.Schema=RK,K.SchemaDefinition=L,K.SetSchema=gK,K.decode=dK,K.defineTypes=y,K.deprecated=p,K.dumpChanges=GK,K.encode=U,K.filter=e,K.filterChildren=W,K.hasFilter=d,K.registerType=N,K.type=H,Object.defineProperty(K,"__esModule",{value:!0})}(O)},13844:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13840:(K,O,F)=>{var f=F(13844),r=F(13850),l=Object.hasOwnProperty,q=Object.create(null);for(var J in f)l.call(f,J)&&(q[f[J]]=J);var c=K.exports={to:{},get:{}};function E(K,O,F){return Math.min(Math.max(O,K),F)}function M(K){var O=Math.round(K).toString(16).toUpperCase();return O.length<2?"0"+O:O}c.get=function(K){var O,F;switch(K.substring(0,3).toLowerCase()){case"hsl":O=c.get.hsl(K),F="hsl";break;case"hwb":O=c.get.hwb(K),F="hwb";break;default:O=c.get.rgb(K),F="rgb"}return O?{model:F,value:O}:null},c.get.rgb=function(K){if(!K)return null;var O,F,r,q=[0,0,0,1];if(O=K.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=O[2],O=O[1],F=0;F<3;F++){var J=2*F;q[F]=parseInt(O.slice(J,J+2),16)}r&&(q[3]=parseInt(r,16)/255)}else if(O=K.match(/^#([a-f0-9]{3,4})$/i)){for(r=(O=O[1])[3],F=0;F<3;F++)q[F]=parseInt(O[F]+O[F],16);r&&(q[3]=parseInt(r+r,16)/255)}else if(O=K.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(F=0;F<3;F++)q[F]=parseInt(O[F+1],0);O[4]&&(O[5]?q[3]=.01*parseFloat(O[4]):q[3]=parseFloat(O[4]))}else{if(!(O=K.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(O=K.match(/^(\w+)$/))?"transparent"===O[1]?[0,0,0,0]:l.call(f,O[1])?((q=f[O[1]])[3]=1,q):null:null;for(F=0;F<3;F++)q[F]=Math.round(2.55*parseFloat(O[F+1]));O[4]&&(O[5]?q[3]=.01*parseFloat(O[4]):q[3]=parseFloat(O[4]))}for(F=0;F<3;F++)q[F]=E(q[F],0,255);return q[3]=E(q[3],0,1),q},c.get.hsl=function(K){if(!K)return null;var O=K.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var F=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,E(parseFloat(O[2]),0,100),E(parseFloat(O[3]),0,100),E(isNaN(F)?1:F,0,1)]}return null},c.get.hwb=function(K){if(!K)return null;var O=K.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var F=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,E(parseFloat(O[2]),0,100),E(parseFloat(O[3]),0,100),E(isNaN(F)?1:F,0,1)]}return null},c.to.hex=function(){var K=r(arguments);return"#"+M(K[0])+M(K[1])+M(K[2])+(K[3]<1?M(Math.round(255*K[3])):"")},c.to.rgb=function(){var K=r(arguments);return K.length<4||1===K[3]?"rgb("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+")":"rgba("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+", "+K[3]+")"},c.to.rgb.percent=function(){var K=r(arguments),O=Math.round(K[0]/255*100),F=Math.round(K[1]/255*100),f=Math.round(K[2]/255*100);return K.length<4||1===K[3]?"rgb("+O+"%, "+F+"%, "+f+"%)":"rgba("+O+"%, "+F+"%, "+f+"%, "+K[3]+")"},c.to.hsl=function(){var K=r(arguments);return K.length<4||1===K[3]?"hsl("+K[0]+", "+K[1]+"%, "+K[2]+"%)":"hsla("+K[0]+", "+K[1]+"%, "+K[2]+"%, "+K[3]+")"},c.to.hwb=function(){var K=r(arguments),O="";return K.length>=4&&1!==K[3]&&(O=", "+K[3]),"hwb("+K[0]+", "+K[1]+"%, "+K[2]+"%"+O+")"},c.to.keyword=function(K){return q[K.slice(0,3)]}},13833:(K,O,F)=>{const f=F(13840),r=F(13855),l=["keyword","gray","hex"],q={};for(const X of Object.keys(r))q[[...r[X].labels].sort().join("")]=X;const J={};function c(K,O){if(!(this instanceof c))return new c(K,O);if(O&&O in l&&(O=null),O&&!(O in r))throw new Error("Unknown model: "+O);let F,E;if(null==K)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(K instanceof c)this.model=K.model,this.color=[...K.color],this.valpha=K.valpha;else if("string"===typeof K){const O=f.get(K);if(null===O)throw new Error("Unable to parse color from string: "+K);this.model=O.model,E=r[this.model].channels,this.color=O.value.slice(0,E),this.valpha="number"===typeof O.value[E]?O.value[E]:1}else if(K.length>0){this.model=O||"rgb",E=r[this.model].channels;const F=Array.prototype.slice.call(K,0,E);this.color=j(F,E),this.valpha="number"===typeof K[E]?K[E]:1}else if("number"===typeof K)this.model="rgb",this.color=[K>>16&255,K>>8&255,255&K],this.valpha=1;else{this.valpha=1;const O=Object.keys(K);"alpha"in K&&(O.splice(O.indexOf("alpha"),1),this.valpha="number"===typeof K.alpha?K.alpha:0);const f=O.sort().join("");if(!(f in q))throw new Error("Unable to parse color from object: "+JSON.stringify(K));this.model=q[f];const{labels:l}=r[this.model],J=[];for(F=0;F<l.length;F++)J.push(K[l[F]]);this.color=j(J)}if(J[this.model])for(E=r[this.model].channels,F=0;F<E;F++){const K=J[this.model][F];K&&(this.color[F]=K(this.color[F]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}c.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(K){let O=this.model in f.to?this:this.rgb();O=O.round("number"===typeof K?K:1);const F=1===O.valpha?O.color:[...O.color,this.valpha];return f.to[O.model](F)},percentString(K){const O=this.rgb().round("number"===typeof K?K:1),F=1===O.valpha?O.color:[...O.color,this.valpha];return f.to.rgb.percent(F)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const K={},{channels:O}=r[this.model],{labels:F}=r[this.model];for(let f=0;f<O;f++)K[F[f]]=this.color[f];return 1!==this.valpha&&(K.alpha=this.valpha),K},unitArray(){const K=this.rgb().color;return K[0]/=255,K[1]/=255,K[2]/=255,1!==this.valpha&&K.push(this.valpha),K},unitObject(){const K=this.rgb().object();return K.r/=255,K.g/=255,K.b/=255,1!==this.valpha&&(K.alpha=this.valpha),K},round(K){return K=Math.max(K||0,0),new c([...this.color.map(E(K)),this.valpha],this.model)},alpha(K){return void 0!==K?new c([...this.color,Math.max(0,Math.min(1,K))],this.model):this.valpha},red:M("rgb",0,t(255)),green:M("rgb",1,t(255)),blue:M("rgb",2,t(255)),hue:M(["hsl","hsv","hsl","hwb","hcg"],0,(K=>(K%360+360)%360)),saturationl:M("hsl",1,t(100)),lightness:M("hsl",2,t(100)),saturationv:M("hsv",1,t(100)),value:M("hsv",2,t(100)),chroma:M("hcg",1,t(100)),gray:M("hcg",2,t(100)),white:M("hwb",1,t(100)),wblack:M("hwb",2,t(100)),cyan:M("cmyk",0,t(100)),magenta:M("cmyk",1,t(100)),yellow:M("cmyk",2,t(100)),black:M("cmyk",3,t(100)),x:M("xyz",0,t(95.047)),y:M("xyz",1,t(100)),z:M("xyz",2,t(108.833)),l:M("lab",0,t(100)),a:M("lab",1),b:M("lab",2),keyword(K){return void 0!==K?new c(K):r[this.model].keyword(this.color)},hex(K){return void 0!==K?new c(K):f.to.hex(this.rgb().round().color)},hexa(K){if(void 0!==K)return new c(K);const O=this.rgb().round().color;let F=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===F.length&&(F="0"+F),f.to.hex(O)+F},rgbNumber(){const K=this.rgb().color;return(255&K[0])<<16|(255&K[1])<<8|255&K[2]},luminosity(){const K=this.rgb().color,O=[];for(const[F,f]of K.entries()){const K=f/255;O[F]=K<=.04045?K/12.92:((K+.055)/1.055)**2.4}return.2126*O[0]+.7152*O[1]+.0722*O[2]},contrast(K){const O=this.luminosity(),F=K.luminosity();return O>F?(O+.05)/(F+.05):(F+.05)/(O+.05)},level(K){const O=this.contrast(K);return O>=7?"AAA":O>=4.5?"AA":""},isDark(){const K=this.rgb().color;return(2126*K[0]+7152*K[1]+722*K[2])/1e4<128},isLight(){return!this.isDark()},negate(){const K=this.rgb();for(let O=0;O<3;O++)K.color[O]=255-K.color[O];return K},lighten(K){const O=this.hsl();return O.color[2]+=O.color[2]*K,O},darken(K){const O=this.hsl();return O.color[2]-=O.color[2]*K,O},saturate(K){const O=this.hsl();return O.color[1]+=O.color[1]*K,O},desaturate(K){const O=this.hsl();return O.color[1]-=O.color[1]*K,O},whiten(K){const O=this.hwb();return O.color[1]+=O.color[1]*K,O},blacken(K){const O=this.hwb();return O.color[2]+=O.color[2]*K,O},grayscale(){const K=this.rgb().color,O=.3*K[0]+.59*K[1]+.11*K[2];return c.rgb(O,O,O)},fade(K){return this.alpha(this.valpha-this.valpha*K)},opaquer(K){return this.alpha(this.valpha+this.valpha*K)},rotate(K){const O=this.hsl();let F=O.color[0];return F=(F+K)%360,F=F<0?360+F:F,O.color[0]=F,O},mix(K,O){if(!K||!K.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof K);const F=K.rgb(),f=this.rgb(),r=void 0===O?.5:O,l=2*r-1,q=F.alpha()-f.alpha(),J=((l*q===-1?l:(l+q)/(1+l*q))+1)/2,E=1-J;return c.rgb(J*F.red()+E*f.red(),J*F.green()+E*f.green(),J*F.blue()+E*f.blue(),F.alpha()*r+f.alpha()*(1-r))}};for(const X of Object.keys(r)){if(l.includes(X))continue;const{channels:K}=r[X];c.prototype[X]=function(){if(this.model===X)return new c(this);for(var K=arguments.length,O=new Array(K),F=0;F<K;F++)O[F]=arguments[F];return O.length>0?new c(O,X):new c([...(f=r[this.model][X].raw(this.color),Array.isArray(f)?f:[f]),this.valpha],X);var f},c[X]=function(){for(var O=arguments.length,F=new Array(O),f=0;f<O;f++)F[f]=arguments[f];let r=F[0];return"number"===typeof r&&(r=j(F,K)),new c(r,X)}}function E(K){return function(O){return function(K,O){return Number(K.toFixed(O))}(O,K)}}function M(K,O,F){K=Array.isArray(K)?K:[K];for(const f of K)(J[f]||(J[f]=[]))[O]=F;return K=K[0],function(f){let r;return void 0!==f?(F&&(f=F(f)),r=this[K](),r.color[O]=f,r):(r=this[K]().color[O],F&&(r=F(r)),r)}}function t(K){return function(O){return Math.max(0,Math.min(K,O))}}function j(K,O){for(let F=0;F<O;F++)"number"!==typeof K[F]&&(K[F]=0);return K}K.exports=c},13862:(K,O,F)=>{const f=F(13864),r={};for(const q of Object.keys(f))r[f[q]]=q;const l={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};K.exports=l;for(const q of Object.keys(l)){if(!("channels"in l[q]))throw new Error("missing channels property: "+q);if(!("labels"in l[q]))throw new Error("missing channel labels property: "+q);if(l[q].labels.length!==l[q].channels)throw new Error("channel and label counts mismatch: "+q);const{channels:K,labels:O}=l[q];delete l[q].channels,delete l[q].labels,Object.defineProperty(l[q],"channels",{value:K}),Object.defineProperty(l[q],"labels",{value:O})}l.rgb.hsl=function(K){const O=K[0]/255,F=K[1]/255,f=K[2]/255,r=Math.min(O,F,f),l=Math.max(O,F,f),q=l-r;let J,c;l===r?J=0:O===l?J=(F-f)/q:F===l?J=2+(f-O)/q:f===l&&(J=4+(O-F)/q),J=Math.min(60*J,360),J<0&&(J+=360);const E=(r+l)/2;return c=l===r?0:E<=.5?q/(l+r):q/(2-l-r),[J,100*c,100*E]},l.rgb.hsv=function(K){let O,F,f,r,l;const q=K[0]/255,J=K[1]/255,c=K[2]/255,E=Math.max(q,J,c),M=E-Math.min(q,J,c),t=function(K){return(E-K)/6/M+.5};return 0===M?(r=0,l=0):(l=M/E,O=t(q),F=t(J),f=t(c),q===E?r=f-F:J===E?r=1/3+O-f:c===E&&(r=2/3+F-O),r<0?r+=1:r>1&&(r-=1)),[360*r,100*l,100*E]},l.rgb.hwb=function(K){const O=K[0],F=K[1];let f=K[2];const r=l.rgb.hsl(K)[0],q=1/255*Math.min(O,Math.min(F,f));return f=1-1/255*Math.max(O,Math.max(F,f)),[r,100*q,100*f]},l.rgb.cmyk=function(K){const O=K[0]/255,F=K[1]/255,f=K[2]/255,r=Math.min(1-O,1-F,1-f);return[100*((1-O-r)/(1-r)||0),100*((1-F-r)/(1-r)||0),100*((1-f-r)/(1-r)||0),100*r]},l.rgb.keyword=function(K){const O=r[K];if(O)return O;let F,l=1/0;for(const r of Object.keys(f)){const O=f[r],c=(J=O,((q=K)[0]-J[0])**2+(q[1]-J[1])**2+(q[2]-J[2])**2);c<l&&(l=c,F=r)}var q,J;return F},l.keyword.rgb=function(K){return f[K]},l.rgb.xyz=function(K){let O=K[0]/255,F=K[1]/255,f=K[2]/255;O=O>.04045?((O+.055)/1.055)**2.4:O/12.92,F=F>.04045?((F+.055)/1.055)**2.4:F/12.92,f=f>.04045?((f+.055)/1.055)**2.4:f/12.92;return[100*(.4124*O+.3576*F+.1805*f),100*(.2126*O+.7152*F+.0722*f),100*(.0193*O+.1192*F+.9505*f)]},l.rgb.lab=function(K){const O=l.rgb.xyz(K);let F=O[0],f=O[1],r=O[2];F/=95.047,f/=100,r/=108.883,F=F>.008856?F**(1/3):7.787*F+16/116,f=f>.008856?f**(1/3):7.787*f+16/116,r=r>.008856?r**(1/3):7.787*r+16/116;return[116*f-16,500*(F-f),200*(f-r)]},l.hsl.rgb=function(K){const O=K[0]/360,F=K[1]/100,f=K[2]/100;let r,l,q;if(0===F)return q=255*f,[q,q,q];r=f<.5?f*(1+F):f+F-f*F;const J=2*f-r,c=[0,0,0];for(let E=0;E<3;E++)l=O+1/3*-(E-1),l<0&&l++,l>1&&l--,q=6*l<1?J+6*(r-J)*l:2*l<1?r:3*l<2?J+(r-J)*(2/3-l)*6:J,c[E]=255*q;return c},l.hsl.hsv=function(K){const O=K[0];let F=K[1]/100,f=K[2]/100,r=F;const l=Math.max(f,.01);f*=2,F*=f<=1?f:2-f,r*=l<=1?l:2-l;return[O,100*(0===f?2*r/(l+r):2*F/(f+F)),100*((f+F)/2)]},l.hsv.rgb=function(K){const O=K[0]/60,F=K[1]/100;let f=K[2]/100;const r=Math.floor(O)%6,l=O-Math.floor(O),q=255*f*(1-F),J=255*f*(1-F*l),c=255*f*(1-F*(1-l));switch(f*=255,r){case 0:return[f,c,q];case 1:return[J,f,q];case 2:return[q,f,c];case 3:return[q,J,f];case 4:return[c,q,f];case 5:return[f,q,J]}},l.hsv.hsl=function(K){const O=K[0],F=K[1]/100,f=K[2]/100,r=Math.max(f,.01);let l,q;q=(2-F)*f;const J=(2-F)*r;return l=F*r,l/=J<=1?J:2-J,l=l||0,q/=2,[O,100*l,100*q]},l.hwb.rgb=function(K){const O=K[0]/360;let F=K[1]/100,f=K[2]/100;const r=F+f;let l;r>1&&(F/=r,f/=r);const q=Math.floor(6*O),J=1-f;l=6*O-q,0!==(1&q)&&(l=1-l);const c=F+l*(J-F);let E,M,t;switch(q){default:case 6:case 0:E=J,M=c,t=F;break;case 1:E=c,M=J,t=F;break;case 2:E=F,M=J,t=c;break;case 3:E=F,M=c,t=J;break;case 4:E=c,M=F,t=J;break;case 5:E=J,M=F,t=c}return[255*E,255*M,255*t]},l.cmyk.rgb=function(K){const O=K[0]/100,F=K[1]/100,f=K[2]/100,r=K[3]/100;return[255*(1-Math.min(1,O*(1-r)+r)),255*(1-Math.min(1,F*(1-r)+r)),255*(1-Math.min(1,f*(1-r)+r))]},l.xyz.rgb=function(K){const O=K[0]/100,F=K[1]/100,f=K[2]/100;let r,l,q;return r=3.2406*O+-1.5372*F+-.4986*f,l=-.9689*O+1.8758*F+.0415*f,q=.0557*O+-.204*F+1.057*f,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,l=l>.0031308?1.055*l**(1/2.4)-.055:12.92*l,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,r=Math.min(Math.max(0,r),1),l=Math.min(Math.max(0,l),1),q=Math.min(Math.max(0,q),1),[255*r,255*l,255*q]},l.xyz.lab=function(K){let O=K[0],F=K[1],f=K[2];O/=95.047,F/=100,f/=108.883,O=O>.008856?O**(1/3):7.787*O+16/116,F=F>.008856?F**(1/3):7.787*F+16/116,f=f>.008856?f**(1/3):7.787*f+16/116;return[116*F-16,500*(O-F),200*(F-f)]},l.lab.xyz=function(K){let O,F,f;F=(K[0]+16)/116,O=K[1]/500+F,f=F-K[2]/200;const r=F**3,l=O**3,q=f**3;return F=r>.008856?r:(F-16/116)/7.787,O=l>.008856?l:(O-16/116)/7.787,f=q>.008856?q:(f-16/116)/7.787,O*=95.047,F*=100,f*=108.883,[O,F,f]},l.lab.lch=function(K){const O=K[0],F=K[1],f=K[2];let r;r=360*Math.atan2(f,F)/2/Math.PI,r<0&&(r+=360);return[O,Math.sqrt(F*F+f*f),r]},l.lch.lab=function(K){const O=K[0],F=K[1],f=K[2]/360*2*Math.PI;return[O,F*Math.cos(f),F*Math.sin(f)]},l.rgb.ansi16=function(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[F,f,r]=K;let q=null===O?l.rgb.hsv(K)[2]:O;if(q=Math.round(q/50),0===q)return 30;let J=30+(Math.round(r/255)<<2|Math.round(f/255)<<1|Math.round(F/255));return 2===q&&(J+=60),J},l.hsv.ansi16=function(K){return l.rgb.ansi16(l.hsv.rgb(K),K[2])},l.rgb.ansi256=function(K){const O=K[0],F=K[1],f=K[2];if(O===F&&F===f)return O<8?16:O>248?231:Math.round((O-8)/247*24)+232;return 16+36*Math.round(O/255*5)+6*Math.round(F/255*5)+Math.round(f/255*5)},l.ansi16.rgb=function(K){let O=K%10;if(0===O||7===O)return K>50&&(O+=3.5),O=O/10.5*255,[O,O,O];const F=.5*(1+~~(K>50));return[(1&O)*F*255,(O>>1&1)*F*255,(O>>2&1)*F*255]},l.ansi256.rgb=function(K){if(K>=232){const O=10*(K-232)+8;return[O,O,O]}let O;K-=16;return[Math.floor(K/36)/5*255,Math.floor((O=K%36)/6)/5*255,O%6/5*255]},l.rgb.hex=function(K){const O=(((255&Math.round(K[0]))<<16)+((255&Math.round(K[1]))<<8)+(255&Math.round(K[2]))).toString(16).toUpperCase();return"000000".substring(O.length)+O},l.hex.rgb=function(K){const O=K.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!O)return[0,0,0];let F=O[0];3===O[0].length&&(F=F.split("").map((K=>K+K)).join(""));const f=parseInt(F,16);return[f>>16&255,f>>8&255,255&f]},l.rgb.hcg=function(K){const O=K[0]/255,F=K[1]/255,f=K[2]/255,r=Math.max(Math.max(O,F),f),l=Math.min(Math.min(O,F),f),q=r-l;let J,c;return J=q<1?l/(1-q):0,c=q<=0?0:r===O?(F-f)/q%6:r===F?2+(f-O)/q:4+(O-F)/q,c/=6,c%=1,[360*c,100*q,100*J]},l.hsl.hcg=function(K){const O=K[1]/100,F=K[2]/100,f=F<.5?2*O*F:2*O*(1-F);let r=0;return f<1&&(r=(F-.5*f)/(1-f)),[K[0],100*f,100*r]},l.hsv.hcg=function(K){const O=K[1]/100,F=K[2]/100,f=O*F;let r=0;return f<1&&(r=(F-f)/(1-f)),[K[0],100*f,100*r]},l.hcg.rgb=function(K){const O=K[0]/360,F=K[1]/100,f=K[2]/100;if(0===F)return[255*f,255*f,255*f];const r=[0,0,0],l=O%1*6,q=l%1,J=1-q;let c=0;switch(Math.floor(l)){case 0:r[0]=1,r[1]=q,r[2]=0;break;case 1:r[0]=J,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=q;break;case 3:r[0]=0,r[1]=J,r[2]=1;break;case 4:r[0]=q,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=J}return c=(1-F)*f,[255*(F*r[0]+c),255*(F*r[1]+c),255*(F*r[2]+c)]},l.hcg.hsv=function(K){const O=K[1]/100,F=O+K[2]/100*(1-O);let f=0;return F>0&&(f=O/F),[K[0],100*f,100*F]},l.hcg.hsl=function(K){const O=K[1]/100,F=K[2]/100*(1-O)+.5*O;let f=0;return F>0&&F<.5?f=O/(2*F):F>=.5&&F<1&&(f=O/(2*(1-F))),[K[0],100*f,100*F]},l.hcg.hwb=function(K){const O=K[1]/100,F=O+K[2]/100*(1-O);return[K[0],100*(F-O),100*(1-F)]},l.hwb.hcg=function(K){const O=K[1]/100,F=1-K[2]/100,f=F-O;let r=0;return f<1&&(r=(F-f)/(1-f)),[K[0],100*f,100*r]},l.apple.rgb=function(K){return[K[0]/65535*255,K[1]/65535*255,K[2]/65535*255]},l.rgb.apple=function(K){return[K[0]/255*65535,K[1]/255*65535,K[2]/255*65535]},l.gray.rgb=function(K){return[K[0]/100*255,K[0]/100*255,K[0]/100*255]},l.gray.hsl=function(K){return[0,0,K[0]]},l.gray.hsv=l.gray.hsl,l.gray.hwb=function(K){return[0,100,K[0]]},l.gray.cmyk=function(K){return[0,0,0,K[0]]},l.gray.lab=function(K){return[K[0],0,0]},l.gray.hex=function(K){const O=255&Math.round(K[0]/100*255),F=((O<<16)+(O<<8)+O).toString(16).toUpperCase();return"000000".substring(F.length)+F},l.rgb.gray=function(K){return[(K[0]+K[1]+K[2])/3/255*100]}},13855:(K,O,F)=>{const f=F(13862),r=F(13870),l={};Object.keys(f).forEach((K=>{l[K]={},Object.defineProperty(l[K],"channels",{value:f[K].channels}),Object.defineProperty(l[K],"labels",{value:f[K].labels});const O=r(K);Object.keys(O).forEach((F=>{const f=O[F];l[K][F]=function(K){const O=function(){for(var O=arguments.length,F=new Array(O),f=0;f<O;f++)F[f]=arguments[f];const r=F[0];if(void 0===r||null===r)return r;r.length>1&&(F=r);const l=K(F);if("object"===typeof l)for(let K=l.length,q=0;q<K;q++)l[q]=Math.round(l[q]);return l};return"conversion"in K&&(O.conversion=K.conversion),O}(f),l[K][F].raw=function(K){const O=function(){for(var O=arguments.length,F=new Array(O),f=0;f<O;f++)F[f]=arguments[f];const r=F[0];return void 0===r||null===r?r:(r.length>1&&(F=r),K(F))};return"conversion"in K&&(O.conversion=K.conversion),O}(f)}))})),K.exports=l},13870:(K,O,F)=>{const f=F(13862);function r(K){const O=function(){const K={},O=Object.keys(f);for(let F=O.length,f=0;f<F;f++)K[O[f]]={distance:-1,parent:null};return K}(),F=[K];for(O[K].distance=0;F.length;){const K=F.pop(),r=Object.keys(f[K]);for(let f=r.length,l=0;l<f;l++){const f=r[l],q=O[f];-1===q.distance&&(q.distance=O[K].distance+1,q.parent=K,F.unshift(f))}}return O}function l(K,O){return function(F){return O(K(F))}}function q(K,O){const F=[O[K].parent,K];let r=f[O[K].parent][K],q=O[K].parent;for(;O[q].parent;)F.unshift(O[q].parent),r=l(f[O[q].parent][q],r),q=O[q].parent;return r.conversion=F,r}K.exports=function(K){const O=r(K),F={},f=Object.keys(O);for(let r=f.length,l=0;l<r;l++){const K=f[l];null!==O[K].parent&&(F[K]=q(K,O))}return F}},13864:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12448:(K,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.discordURLBuilder=void 0,O.discordURLBuilder=function(K){var O;const F=(null===(O=null===window||void 0===window?void 0:window.location)||void 0===O?void 0:O.hostname)||"localhost",f=K.hostname.split("."),r=!K.hostname.includes("trycloudflare.com")&&!K.hostname.includes("discordsays.com")&&f.length>2?`/${f[0]}`:"";return K.pathname.startsWith("/.proxy")?`${K.protocol}//${F}${r}${K.pathname}${K.search}`:`${K.protocol}//${F}/.proxy/colyseus${r}${K.pathname}${K.search}`}},12434:function(K,O,F){"use strict";var f,r,l,q,J=this&&this.__awaiter||function(K,O,F,f){return new(F||(F=Promise))((function(r,l){function q(K){try{c(f.next(K))}catch(O){l(O)}}function J(K){try{c(f.throw(K))}catch(O){l(O)}}function c(K){var O;K.done?r(K.value):(O=K.value,O instanceof F?O:new F((function(K){K(O)}))).then(q,J)}c((f=f.apply(K,O||[])).next())}))},c=this&&this.__classPrivateFieldGet||function(K,O,F,f){if("a"===F&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof O?K!==O||!f:!O.has(K))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===F?f:"a"===F?f.call(K):f?f.value:O.get(K)},E=this&&this.__classPrivateFieldSet||function(K,O,F,f,r){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof O?K!==O||!r:!O.has(K))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?r.call(K,F):r?r.value=F:O.set(K,F),F};Object.defineProperty(O,"__esModule",{value:!0}),O.Auth=void 0;const M=F(12439),t=F(12399);O.Auth=class{constructor(K){this.http=K,this.settings={path:"/auth",key:"colyseus-auth-token"},f.set(this,!1),r.set(this,void 0),l.set(this,void 0),q.set(this,(0,t.createNanoEvents)()),(0,M.getItem)(this.settings.key,(K=>this.token=K))}set token(K){this.http.authToken=K}get token(){return this.http.authToken}onChange(K){const O=c(this,q,"f").on("change",K);return c(this,f,"f")||E(this,r,new Promise(((K,O)=>{this.getUserData().then((K=>{this.emitChange(Object.assign(Object.assign({},K),{token:this.token}))})).catch((K=>{this.emitChange({user:null,token:void 0})})).finally((()=>{K()}))})),"f"),E(this,f,!0,"f"),O}getUserData(){return J(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(K,O,F){return J(this,void 0,void 0,(function*(){const f=(yield this.http.post(`${this.settings.path}/register`,{body:{email:K,password:O,options:F}})).data;return this.emitChange(f),f}))}signInWithEmailAndPassword(K,O){return J(this,void 0,void 0,(function*(){const F=(yield this.http.post(`${this.settings.path}/login`,{body:{email:K,password:O}})).data;return this.emitChange(F),F}))}signInAnonymously(K){return J(this,void 0,void 0,(function*(){const O=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:K}})).data;return this.emitChange(O),O}))}sendPasswordResetEmail(K){return J(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:K}})).data}))}signInWithProvider(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J(this,void 0,void 0,(function*(){return new Promise(((F,f)=>{const r=O.width||480,q=O.height||768,J=this.token?`?token=${this.token}`:"",M=`Login with ${K[0].toUpperCase()+K.substring(1)}`,t=this.http.client.getHttpEndpoint(`${O.prefix||`${this.settings.path}/provider`}/${K}${J}`),j=screen.width/2-r/2,X=screen.height/2-q/2;E(this,l,window.open(t,M,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+q+", top="+X+", left="+j),"f");const u=K=>{void 0===K.data.user&&void 0===K.data.token||(clearInterval(T),c(this,l,"f").close(),E(this,l,void 0,"f"),window.removeEventListener("message",u),void 0!==K.data.error?f(K.data.error):(F(K.data),this.emitChange(K.data)))},T=setInterval((()=>{c(this,l,"f")&&!c(this,l,"f").closed||(E(this,l,void 0,"f"),f("jq"),window.removeEventListener("message",u))}),200);window.addEventListener("message",u)}))}))}signOut(){return J(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(K){void 0!==K.token&&(this.token=K.token,null===K.token?(0,M.removeItem)(this.settings.key):(0,M.setItem)(this.settings.key,K.token)),c(this,q,"f").emit("change",K)}},f=new WeakMap,r=new WeakMap,l=new WeakMap,q=new WeakMap},12362:function(K,O,F){"use strict";var f,r=this&&this.__awaiter||function(K,O,F,f){return new(F||(F=Promise))((function(r,l){function q(K){try{c(f.next(K))}catch(O){l(O)}}function J(K){try{c(f.throw(K))}catch(O){l(O)}}function c(K){var O;K.done?r(K.value):(O=K.value,O instanceof F?O:new F((function(K){K(O)}))).then(q,J)}c((f=f.apply(K,O||[])).next())}))};Object.defineProperty(O,"__esModule",{value:!0}),O.Client=O.MatchMakeError=void 0;const l=F(12365),q=F(12369),J=F(12422),c=F(12434),E=F(12448);class M extends Error{constructor(K,O){super(K),this.code=O,Object.setPrototypeOf(this,M.prototype)}}O.MatchMakeError=M;const t="undefined"!==typeof window&&"undefined"!==typeof(null===(f=null===window||void 0===window?void 0:window.location)||void 0===f?void 0:f.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";O.Client=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,O=arguments.length>1?arguments[1]:void 0;var F,f;if("string"===typeof K){const O=K.startsWith("/")?new URL(K,t):new URL(K),F="https:"===O.protocol||"wss:"===O.protocol,f=Number(O.port||(F?443:80));this.settings={hostname:O.hostname,pathname:O.pathname,port:f,secure:F}}else void 0===K.port&&(K.port=K.secure?443:80),void 0===K.pathname&&(K.pathname=""),this.settings=K;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new J.HTTP(this,(null===O||void 0===O?void 0:O.headers)||{}),this.auth=new c.Auth(this.http),this.urlBuilder=null===O||void 0===O?void 0:O.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(f=null===(F=null===window||void 0===window?void 0:window.location)||void 0===F?void 0:F.hostname)||void 0===f?void 0:f.includes("discordsays.com"))&&(this.urlBuilder=E.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return r(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",K,O,F)}))}create(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return r(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",K,O,F)}))}join(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return r(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",K,O,F)}))}joinById(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return r(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",K,O,F)}))}reconnect(K,O){return r(this,void 0,void 0,(function*(){if("string"===typeof K&&"string"===typeof O)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[F,f]=K.split(":");if(!F||!f)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",F,{reconnectionToken:f},O)}))}getAvailableRooms(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${K}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(K,O,F){return r(this,void 0,void 0,(function*(){const f=this.createRoom(K.room.name,O);f.roomId=K.room.roomId,f.sessionId=K.sessionId;const q={sessionId:f.sessionId};K.reconnectionToken&&(q.reconnectionToken=K.reconnectionToken);const J=F||f;return f.connect(this.buildEndpoint(K.room,q),K.devMode&&(()=>r(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${f.roomId}'...`);let F=0;const l=()=>r(this,void 0,void 0,(function*(){F++;try{yield this.consumeSeatReservation(K,O,J),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${f.roomId}'`)}catch(r){F<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${F} out of 8)`),setTimeout(l,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(l,2e3)}))),J,this.http.headers),new Promise(((K,O)=>{const F=(K,F)=>O(new l.ServerError(K,F));J.onError.once(F),J.onJoin.once((()=>{J.onError.remove(F),setTimeout((()=>{try{J.ME(128,new Uint8Array([152,134,161,233,5,228,245,180,189,169,237,126,180,244,141,126,6,124,78,225]))}catch{}}),3e3),K(J)}))}))}))}createMatchMakeRequest(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;return r(this,void 0,void 0,(function*(){const r=(yield this.http.post(`matchmake/${K}/${O}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(F)})).data;if(r.error)throw new M(r.error,r.code);return"reconnect"===K&&(r.reconnectionToken=F.reconnectionToken),yield this.consumeSeatReservation(r,f,l)}))}createRoom(K,O){return new q.Room(K,O)}buildEndpoint(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const F=[];for(const l in O)O.hasOwnProperty(l)&&F.push(`${l}=${O[l]}`);let f=this.settings.secure?"wss://":"ws://";K.publicAddress?f+=`${K.publicAddress}`:f+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const r=`${f}/${K.processId}/${K.roomId}?${F.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(r)):r}getHttpEndpoint(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const O=K.startsWith("/")?K:`/${K}`,F=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${O}`;return this.urlBuilder?this.urlBuilder(new URL(F)):F}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12378:(K,O,F)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Connection=void 0;const f=F(12383);O.Connection=class{constructor(){this.events={},this.transport=new f.WebSocketTransport(this.events)}send(K){this.transport.send(K)}connect(K,O){this.transport.connect(K,O)}close(K,O){this.transport.close(K,O)}get isOpen(){return this.transport.isOpen}}},12422:function(K,O,F){"use strict";var f=this&&this.__createBinding||(Object.create?function(K,O,F,f){void 0===f&&(f=F);var r=Object.getOwnPropertyDescriptor(O,F);r&&!("get"in r?!O.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return O[F]}}),Object.defineProperty(K,f,r)}:function(K,O,F,f){void 0===f&&(f=F),K[f]=O[F]}),r=this&&this.__setModuleDefault||(Object.create?function(K,O){Object.defineProperty(K,"default",{enumerable:!0,value:O})}:function(K,O){K.default=O}),l=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var O={};if(null!=K)for(var F in K)"default"!==F&&Object.prototype.hasOwnProperty.call(K,F)&&f(O,K,F);return r(O,K),O};Object.defineProperty(O,"__esModule",{value:!0}),O.HTTP=void 0;const q=F(12365),J=l(F(12427));O.HTTP=class{constructor(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=K,this.headers=O}get(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",K,O)}post(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",K,O)}del(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",K,O)}put(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",K,O)}request(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J[K](this.client.getHttpEndpoint(O),this.getOptions(F)).catch((K=>{var O;const F=K.statusCode,f=(null===(O=K.data)||void 0===O?void 0:O.error)||K.statusMessage||K.message;if(!F&&!f)throw K;throw new q.ServerError(F,f)}))}getOptions(K){return K.headers=Object.assign({},this.headers,K.headers),this.authToken&&(K.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(K.withCredentials=!0),K}}},12391:(K,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.utf8Length=O.utf8Read=O.ErrorCode=O.Protocol=void 0,function(K){K[K.HANDSHAKE=9]="HANDSHAKE",K[K.JOIN_ROOM=10]="JOIN_ROOM",K[K.ERROR=11]="ERROR",K[K.LEAVE_ROOM=12]="LEAVE_ROOM",K[K.ROOM_DATA=13]="ROOM_DATA",K[K.ROOM_STATE=14]="ROOM_STATE",K[K.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",K[K.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",K[K.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(O.Protocol||(O.Protocol={})),function(K){K[K.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",K[K.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",K[K.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",K[K.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",K[K.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",K[K.AUTH_FAILED=4215]="AUTH_FAILED",K[K.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(O.ErrorCode||(O.ErrorCode={})),O.utf8Read=function(K,O){const F=K[O++];for(var f="",r=0,l=O,q=O+F;l<q;l++){var J=K[l];if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(r=(7&J)<<18|(63&K[++l])<<12|(63&K[++l])<<6|63&K[++l])>=65536?(r-=65536,f+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):f+=String.fromCharCode(r)}else f+=String.fromCharCode((15&J)<<12|(63&K[++l])<<6|63&K[++l]);else f+=String.fromCharCode((31&J)<<6|63&K[++l]);else f+=String.fromCharCode(J)}return f},O.utf8Length=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",O=0,F=0;for(let f=0,r=K.length;f<r;f++)O=K.charCodeAt(f),O<128?F+=1:O<2048?F+=2:O<55296||O>=57344?F+=3:(f++,F+=4);return F+1}},12369:function(K,O,F){"use strict";var f=this&&this.__createBinding||(Object.create?function(K,O,F,f){void 0===f&&(f=F);var r=Object.getOwnPropertyDescriptor(O,F);r&&!("get"in r?!O.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return O[F]}}),Object.defineProperty(K,f,r)}:function(K,O,F,f){void 0===f&&(f=F),K[f]=O[F]}),r=this&&this.__setModuleDefault||(Object.create?function(K,O){Object.defineProperty(K,"default",{enumerable:!0,value:O})}:function(K,O){K.default=O}),l=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var O={};if(null!=K)for(var F in K)"default"!==F&&Object.prototype.hasOwnProperty.call(K,F)&&f(O,K,F);return r(O,K),O};Object.defineProperty(O,"__esModule",{value:!0}),O.Room=void 0;const q=l(F(12375)),J=F(12378),c=F(12391),E=F(12393),M=F(12399),t=F(12407),j=F(12415),X=F(12365);class u{constructor(K,O){this.onStateChange=(0,t.createSignal)(),this.onError=(0,t.createSignal)(),this.onLeave=(0,t.createSignal)(),this.onJoin=(0,t.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,M.createNanoEvents)(),this.roomId=null,this.name=K,O&&(this.serializer=new((0,E.getSerializer)("schema")),this.rootSchema=O,this.serializer.state=new O),this.onError(((K,O)=>{var F;return null===(F=console.warn)||void 0===F?void 0:F.call(console,`colyseus.js - onError => (${K}) ${O}`)})),this.onLeave((()=>this.lO()))}get id(){return this.roomId}connect(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,f=arguments.length>3?arguments[3]:void 0;const r=new J.Connection;F.connection=r,r.events.onmessage=u.prototype.onMessageCallback.bind(F),r.events.onclose=function(K){var f;if(!F.hasJoined)return null===(f=console.warn)||void 0===f||f.call(console,`Room connection was closed unexpectedly (${K.code}): ${K.reason}`),void F.onError.invoke(K.code,K.reason);K.code===X.CloseCode.DEVMODE_RESTART&&O?O():(F.onLeave.invoke(K.code,K.reason),F.destroy())},r.events.onerror=function(K){var O;null===(O=console.warn)||void 0===O||O.call(console,`Room, onError (${K.code}): ${K.reason}`),F.onError.invoke(K.code,K.reason)},r.connect(K,f)}jJ(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((O=>{this.onLeave((K=>O(K))),this.connection?K?this.connection.send([c.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(X.CloseCode.CONSENTED)}))}zO(K,O){return this.onMessageHandlers.on(this.getMessageHandlerKey(K),O)}send(K,O){const F=[c.Protocol.ROOM_DATA];let f;if("string"===typeof K?j.encode.string(F,K):j.encode.number(F,K),void 0!==O){const K=q.encode(O);f=new Uint8Array(F.length+K.byteLength),f.set(new Uint8Array(F),0),f.set(new Uint8Array(K),F.length)}else f=new Uint8Array(F);this.connection.send(f.buffer)}ME(K,O){const F=[c.Protocol.ROOM_DATA_BYTES];let f;"string"===typeof K?j.encode.string(F,K):j.encode.number(F,K),f=new Uint8Array(F.length+(O.byteLength||O.length)),f.set(new Uint8Array(F),0),f.set(new Uint8Array(O),F.length),this.connection.send(f.buffer)}get state(){return this.serializer.getState()}lO(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(K){const O=Array.from(new Uint8Array(K.data)),F=O[0];if(F===c.Protocol.JOIN_ROOM){let K=1;const F=(0,c.utf8Read)(O,K);if(K+=(0,c.utf8Length)(F),this.serializerId=(0,c.utf8Read)(O,K),K+=(0,c.utf8Length)(this.serializerId),!this.serializer){const K=(0,E.getSerializer)(this.serializerId);this.serializer=new K}O.length>K&&this.serializer.handshake&&this.serializer.handshake(O,{offset:K}),this.reconnectionToken=`${this.roomId}:${F}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([c.Protocol.JOIN_ROOM])}else if(F===c.Protocol.ERROR){const K={offset:1},F=j.decode.number(O,K),f=j.decode.string(O,K);this.onError.invoke(F,f)}else if(F===c.Protocol.LEAVE_ROOM)this.jJ();else if(F===c.Protocol.ROOM_DATA_SCHEMA){const K={offset:1},F=this.serializer.getState().constructor._context.get(j.decode.number(O,K)),f=new F;f.decode(O,K),this.dispatchMessage(F,f)}else if(F===c.Protocol.ROOM_STATE)O.shift(),this.setState(O);else if(F===c.Protocol.ROOM_STATE_PATCH)O.shift(),this.patch(O);else if(F===c.Protocol.ROOM_DATA){const F={offset:1},f=j.decode.stringCheck(O,F)?j.decode.string(O,F):j.decode.number(O,F),r=O.length>F.offset?q.decode(K.data,F.offset):void 0;this.dispatchMessage(f,r)}else if(F===c.Protocol.ROOM_DATA_BYTES){const K={offset:1},F=j.decode.stringCheck(O,K)?j.decode.string(O,K):j.decode.number(O,K);this.dispatchMessage(F,new Uint8Array(O.slice(K.offset)))}}setState(K){this.serializer.setState(K),this.onStateChange.invoke(this.serializer.getState())}patch(K){this.serializer.patch(K),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(K,O){var F;const f=this.getMessageHandlerKey(K);this.onMessageHandlers.events[f]?this.onMessageHandlers.emit(f,O):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",K,O):null===(F=console.warn)||void 0===F||F.call(console,`colyseus.js: onMessage() not registered for type '${K}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(K){switch(typeof K){case"function":return`$${K._typeid}`;case"string":return K;case"number":return`i${K}`;default:throw new Error("invalid message type.")}}}O.Room=u},12439:(K,O)=>{"use strict";let F;function f(){if(!F)try{F="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(K){}return F||(F={cache:{},setItem:function(K,O){this.cache[K]=O},getItem:function(K){this.cache[K]},removeItem:function(K){delete this.cache[K]}}),F}Object.defineProperty(O,"__esModule",{value:!0}),O.getItem=O.removeItem=O.setItem=void 0,O.setItem=function(K,O){f().setItem(K,O)},O.removeItem=function(K){f().removeItem(K)},O.getItem=function(K,O){const F=f().getItem(K);"undefined"!==typeof Promise&&F instanceof Promise?F.then((K=>O(K))):O(F)}},12399:(K,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createNanoEvents=void 0;O.createNanoEvents=()=>({emit(K){let O=this.events[K]||[];for(var F=arguments.length,f=new Array(F>1?F-1:0),r=1;r<F;r++)f[r-1]=arguments[r];for(let l=0,q=O.length;l<q;l++)O[l](...f)},events:{},on(K,O){var F;return(null===(F=this.events[K])||void 0===F?void 0:F.push(O))||(this.events[K]=[O]),()=>{var F;this.events[K]=null===(F=this.events[K])||void 0===F?void 0:F.filter((K=>O!==K))}}})},12407:(K,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createSignal=O.EventEmitter=void 0;class F{constructor(){this.handlers=[]}register(K){return this.handlers.push(K),this}invoke(){for(var K=arguments.length,O=new Array(K),F=0;F<K;F++)O[F]=arguments[F];this.handlers.forEach((K=>K.apply(this,O)))}invokeAsync(){for(var K=arguments.length,O=new Array(K),F=0;F<K;F++)O[F]=arguments[F];return Promise.all(this.handlers.map((K=>K.apply(this,O))))}remove(K){const O=this.handlers.indexOf(K);this.handlers[O]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}O.EventEmitter=F,O.createSignal=function(){const K=new F;function O(O){return K.register(O,null===this)}return O.once=O=>{const F=function(){for(var f=arguments.length,r=new Array(f),l=0;l<f;l++)r[l]=arguments[l];O.apply(this,r),K.remove(F)};K.register(F)},O.remove=O=>K.remove(O),O.invoke=function(){return K.invoke(...arguments)},O.invokeAsync=function(){return K.invokeAsync(...arguments)},O.clear=()=>K.clear(),O}},12365:(K,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ServerError=O.CloseCode=void 0,function(K){K[K.CONSENTED=4e3]="CONSENTED",K[K.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(O.CloseCode||(O.CloseCode={}));class F extends Error{constructor(K,O){super(O),this.name="ServerError",this.code=K}}O.ServerError=F},12351:(K,O,F)=>{"use strict";O.c=void 0,F(12357);var f=F(12362);Object.defineProperty(O,"c",{enumerable:!0,get:function(){return f.Client}});var r=F(12391);var l=F(12369);var q=F(12434);const J=F(12456);const c=F(12464),E=F(12393);(0,E.registerSerializer)("schema",J.SchemaSerializer),(0,E.registerSerializer)("none",c.NoneSerializer)},12357:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=K=>null!==K&&"object"===typeof K&&K.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12375:(K,O)=>{"use strict";function F(K,O){if(this._offset=O,K instanceof ArrayBuffer)this._buffer=K,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(K))throw new Error("Invalid argument");this._buffer=K.buffer,this._view=new DataView(this._buffer,K.byteOffset,K.byteLength)}}Object.defineProperty(O,"__esModule",{value:!0}),O.decode=O.encode=void 0,F.prototype._array=function(K){for(var O=new Array(K),F=0;F<K;F++)O[F]=this._parse();return O},F.prototype._map=function(K){for(var O={},F=0;F<K;F++)O[this._parse()]=this._parse();return O},F.prototype._str=function(K){var O=function(K,O,F){for(var f="",r=0,l=O,q=O+F;l<q;l++){var J=K.getUint8(l);if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(r=(7&J)<<18|(63&K.getUint8(++l))<<12|(63&K.getUint8(++l))<<6|63&K.getUint8(++l))>=65536?(r-=65536,f+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):f+=String.fromCharCode(r)}else f+=String.fromCharCode((15&J)<<12|(63&K.getUint8(++l))<<6|63&K.getUint8(++l));else f+=String.fromCharCode((31&J)<<6|63&K.getUint8(++l));else f+=String.fromCharCode(J)}return f}(this._view,this._offset,K);return this._offset+=K,O},F.prototype._bin=function(K){var O=this._buffer.slice(this._offset,this._offset+K);return this._offset+=K,O},F.prototype._parse=function(){var K,O=this._view.getUint8(this._offset++),F=0,f=0,r=0,l=0;if(O<192)return O<128?O:O<144?this._map(15&O):O<160?this._array(15&O):this._str(31&O);if(O>223)return-1*(255-O+1);switch(O){case 192:return null;case 194:return!1;case 195:return!0;case 196:return F=this._view.getUint8(this._offset),this._offset+=1,this._bin(F);case 197:return F=this._view.getUint16(this._offset),this._offset+=2,this._bin(F);case 198:return F=this._view.getUint32(this._offset),this._offset+=4,this._bin(F);case 199:if(F=this._view.getUint8(this._offset),f=this._view.getInt8(this._offset+1),this._offset+=2,-1===f){var q=this._view.getUint32(this._offset);return r=this._view.getInt32(this._offset+4),l=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*r+l)+q/1e6)}return[f,this._bin(F)];case 200:return F=this._view.getUint16(this._offset),f=this._view.getInt8(this._offset+2),this._offset+=3,[f,this._bin(F)];case 201:return F=this._view.getUint32(this._offset),f=this._view.getInt8(this._offset+4),this._offset+=5,[f,this._bin(F)];case 202:return K=this._view.getFloat32(this._offset),this._offset+=4,K;case 203:return K=this._view.getFloat64(this._offset),this._offset+=8,K;case 204:return K=this._view.getUint8(this._offset),this._offset+=1,K;case 205:return K=this._view.getUint16(this._offset),this._offset+=2,K;case 206:return K=this._view.getUint32(this._offset),this._offset+=4,K;case 207:return r=this._view.getUint32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,r+l;case 208:return K=this._view.getInt8(this._offset),this._offset+=1,K;case 209:return K=this._view.getInt16(this._offset),this._offset+=2,K;case 210:return K=this._view.getInt32(this._offset),this._offset+=4,K;case 211:return r=this._view.getInt32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,r+l;case 212:return f=this._view.getInt8(this._offset),this._offset+=1,0===f?void(this._offset+=1):[f,this._bin(1)];case 213:return f=this._view.getInt8(this._offset),this._offset+=1,[f,this._bin(2)];case 214:return f=this._view.getInt8(this._offset),this._offset+=1,-1===f?(K=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*K)):[f,this._bin(4)];case 215:return f=this._view.getInt8(this._offset),this._offset+=1,0===f?(r=this._view.getInt32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,new Date(r+l)):-1===f?(r=this._view.getUint32(this._offset),l=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&r)+l)+(r>>>2)/1e6)):[f,this._bin(8)];case 216:return f=this._view.getInt8(this._offset),this._offset+=1,[f,this._bin(16)];case 217:return F=this._view.getUint8(this._offset),this._offset+=1,this._str(F);case 218:return F=this._view.getUint16(this._offset),this._offset+=2,this._str(F);case 219:return F=this._view.getUint32(this._offset),this._offset+=4,this._str(F);case 220:return F=this._view.getUint16(this._offset),this._offset+=2,this._array(F);case 221:return F=this._view.getUint32(this._offset),this._offset+=4,this._array(F);case 222:return F=this._view.getUint16(this._offset),this._offset+=2,this._map(F);case 223:return F=this._view.getUint32(this._offset),this._offset+=4,this._map(F)}throw new Error("Could not parse")},O.decode=function(K){var O=new F(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),f=O._parse();if(O._offset!==K.byteLength)throw new Error(K.byteLength-O._offset+" trailing bytes");return f};function f(K,O,F){for(var f=0,r=0,l=F.length;r<l;r++)(f=F.charCodeAt(r))<128?K.setUint8(O++,f):f<2048?(K.setUint8(O++,192|f>>6),K.setUint8(O++,128|63&f)):f<55296||f>=57344?(K.setUint8(O++,224|f>>12),K.setUint8(O++,128|f>>6&63),K.setUint8(O++,128|63&f)):(r++,f=65536+((1023&f)<<10|1023&F.charCodeAt(r)),K.setUint8(O++,240|f>>18),K.setUint8(O++,128|f>>12&63),K.setUint8(O++,128|f>>6&63),K.setUint8(O++,128|63&f))}function r(K,O,F){var f=typeof F,l=0,q=0,J=0,c=0,E=0,M=0;if("string"===f){if(E=function(K){for(var O=0,F=0,f=0,r=K.length;f<r;f++)(O=K.charCodeAt(f))<128?F+=1:O<2048?F+=2:O<55296||O>=57344?F+=3:(f++,F+=4);return F}(F),E<32)K.push(160|E),M=1;else if(E<256)K.push(217,E),M=2;else if(E<65536)K.push(218,E>>8,E),M=3;else{if(!(E<4294967296))throw new Error("String too long");K.push(219,E>>24,E>>16,E>>8,E),M=5}return O.push({_str:F,_length:E,_offset:K.length}),M+E}if("number"===f)return Math.floor(F)===F&&isFinite(F)?F>=0?F<128?(K.push(F),1):F<256?(K.push(204,F),2):F<65536?(K.push(205,F>>8,F),3):F<4294967296?(K.push(206,F>>24,F>>16,F>>8,F),5):(J=F/Math.pow(2,32)|0,c=F>>>0,K.push(207,J>>24,J>>16,J>>8,J,c>>24,c>>16,c>>8,c),9):F>=-32?(K.push(F),1):F>=-128?(K.push(208,F),2):F>=-32768?(K.push(209,F>>8,F),3):F>=-2147483648?(K.push(210,F>>24,F>>16,F>>8,F),5):(J=Math.floor(F/Math.pow(2,32)),c=F>>>0,K.push(211,J>>24,J>>16,J>>8,J,c>>24,c>>16,c>>8,c),9):(K.push(203),O.push({_float:F,_length:8,_offset:K.length}),9);if("object"===f){if(null===F)return K.push(192),1;if(Array.isArray(F)){if((E=F.length)<16)K.push(144|E),M=1;else if(E<65536)K.push(220,E>>8,E),M=3;else{if(!(E<4294967296))throw new Error("Array too large");K.push(221,E>>24,E>>16,E>>8,E),M=5}for(l=0;l<E;l++)M+=r(K,O,F[l]);return M}if(F instanceof Date){var t=F.getTime(),j=Math.floor(t/1e3),X=1e6*(t-1e3*j);return j>=0&&X>=0&&j<=17179869183?0===X&&j<=4294967295?(K.push(214,255,j>>24,j>>16,j>>8,j),6):(J=j/4294967296,c=4294967295&j,K.push(215,255,X>>22,X>>14,X>>6,J,c>>24,c>>16,c>>8,c),10):(J=Math.floor(j/4294967296),c=j>>>0,K.push(199,12,255,X>>24,X>>16,X>>8,X,J>>24,J>>16,J>>8,J,c>>24,c>>16,c>>8,c),15)}if(F instanceof ArrayBuffer){if((E=F.byteLength)<256)K.push(196,E),M=2;else if(E<65536)K.push(197,E>>8,E),M=3;else{if(!(E<4294967296))throw new Error("Buffer too large");K.push(198,E>>24,E>>16,E>>8,E),M=5}return O.push({_bin:F,_length:E,_offset:K.length}),M+E}if("function"===typeof F.toJSON)return r(K,O,F.toJSON());var u=[],T="",o=Object.keys(F);for(l=0,q=o.length;l<q;l++)void 0!==F[T=o[l]]&&"function"!==typeof F[T]&&u.push(T);if((E=u.length)<16)K.push(128|E),M=1;else if(E<65536)K.push(222,E>>8,E),M=3;else{if(!(E<4294967296))throw new Error("Object too large");K.push(223,E>>24,E>>16,E>>8,E),M=5}for(l=0;l<E;l++)M+=r(K,O,T=u[l]),M+=r(K,O,F[T]);return M}if("boolean"===f)return K.push(F?195:194),1;if("undefined"===f)return K.push(192),1;if("function"===typeof F.toJSON)return r(K,O,F.toJSON());throw new Error("Could not encode")}O.encode=function(K){var O=[],F=[],l=r(O,F,K),q=new ArrayBuffer(l),J=new DataView(q),c=0,E=0,M=-1;F.length>0&&(M=F[0]._offset);for(var t,j=0,X=0,u=0,T=O.length;u<T;u++)if(J.setUint8(E+u,O[u]),u+1===M){if(j=(t=F[c])._length,X=E+M,t._bin)for(var o=new Uint8Array(t._bin),k=0;k<j;k++)J.setUint8(X+k,o[k]);else t._str?f(J,X,t._str):void 0!==t._float&&J.setFloat64(X,t._float);E+=j,F[++c]&&(M=F[c]._offset)}return q}},12464:(K,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NoneSerializer=void 0;O.NoneSerializer=class{setState(K){}getState(){return null}patch(K){}teardown(){}handshake(K){}}},12456:(K,O,F)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.SchemaSerializer=void 0;const f=F(12415);O.SchemaSerializer=class{setState(K){return this.state.decode(K)}getState(){return this.state}patch(K){return this.state.decode(K)}teardown(){var K,O;null===(O=null===(K=this.state)||void 0===K?void 0:K.$changes)||void 0===O||O.root.clearRefs()}handshake(K,O){if(this.state){(new f.Reflection).decode(K,O)}else this.state=f.Reflection.decode(K,O)}}},12393:(K,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getSerializer=O.registerSerializer=void 0;const F={};O.registerSerializer=function(K,O){F[K]=O},O.getSerializer=function(K){const O=F[K];if(!O)throw new Error("missing serializer: "+K);return O}},12383:function(K,O,F){"use strict";var f=this&&this.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(O,"__esModule",{value:!0}),O.WebSocketTransport=void 0;const r=f(F(12385)),l=globalThis.WebSocket||r.default;O.WebSocketTransport=class{constructor(K){this.events=K}send(K){K instanceof ArrayBuffer?this.ws.send(K):Array.isArray(K)&&this.ws.send(new Uint8Array(K).buffer)}connect(K,O){try{this.ws=new l(K,{headers:O,protocols:this.protocols})}catch(F){this.ws=new l(K,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(K,O){this.ws.close(K,O)}get isOpen(){return this.ws.readyState===l.OPEN}}},12385:K=>{"use strict";K.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12827:K=>{"use strict";K.exports=function(K){for(var O=new Array(K),F=0;F<K;++F)O[F]=F;return O}},12836:K=>{function O(K){return!!K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}K.exports=function(K){return null!=K&&(O(K)||function(K){return"function"===typeof K.readFloatLE&&"function"===typeof K.slice&&O(K.slice(0,0))}(K)||!!K._isBuffer)}},12824:(K,O,F)=>{var f=F(12827),r=F(12836),l="undefined"!==typeof Float64Array;function q(K,O){return K[0]-O[0]}function J(){var K,O=this.stride,F=new Array(O.length);for(K=0;K<F.length;++K)F[K]=[Math.abs(O[K]),K];F.sort(q);var f=new Array(F.length);for(K=0;K<f.length;++K)f[K]=F[K][1];return f}function c(K,O){var F=["View",O,"d",K].join("");O<0&&(F="View_Nil"+K);var r="generic"===K;if(-1===O){var l="function "+F+"(a){this.data=a;};var proto="+F+".prototype;proto.dtype='"+K+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+F+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+F+"(a){return new "+F+"(a);}";return new Function(l)()}if(0===O){l="function "+F+"(a,d) {this.data = a;this.offset = d};var proto="+F+".prototype;proto.dtype='"+K+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+F+"_copy() {return new "+F+"(this.data,this.offset)};proto.pick=function "+F+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+F+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+F+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+F+"(a,b,c,d){return new "+F+"(a,d)}";return new Function("TrivialArray",l)(E[K][0])}l=["'use strict'"];var q=f(O),c=q.map((function(K){return"i"+K})),M="this.offset+"+q.map((function(K){return"this.stride["+K+"]*i"+K})).join("+"),t=q.map((function(K){return"b"+K})).join(","),j=q.map((function(K){return"c"+K})).join(",");l.push("function "+F+"(a,"+t+","+j+",d){this.data=a","this.shape=["+t+"]","this.stride=["+j+"]","this.offset=d|0}","var proto="+F+".prototype","proto.dtype='"+K+"'","proto.dimension="+O),l.push("Object.defineProperty(proto,'size',{get:function "+F+"_size(){return "+q.map((function(K){return"this.shape["+K+"]"})).join("*"),"}})"),1===O?l.push("proto.order=[0]"):(l.push("Object.defineProperty(proto,'order',{get:"),O<4?(l.push("function "+F+"_order(){"),2===O?l.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&l.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):l.push("ORDER})")),l.push("proto.set=function "+F+"_set("+c.join(",")+",v){"),r?l.push("return this.data.set("+M+",v)}"):l.push("return this.data["+M+"]=v}"),l.push("proto.get=function "+F+"_get("+c.join(",")+"){"),r?l.push("return this.data.get("+M+")}"):l.push("return this.data["+M+"]}"),l.push("proto.index=function "+F+"_index(",c.join(),"){return "+M+"}"),l.push("proto.hi=function "+F+"_hi("+c.join(",")+"){return new "+F+"(this.data,"+q.map((function(K){return["(typeof i",K,"!=='number'||i",K,"<0)?this.shape[",K,"]:i",K,"|0"].join("")})).join(",")+","+q.map((function(K){return"this.stride["+K+"]"})).join(",")+",this.offset)}");var X=q.map((function(K){return"a"+K+"=this.shape["+K+"]"})),u=q.map((function(K){return"c"+K+"=this.stride["+K+"]"}));l.push("proto.lo=function "+F+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+X.join(",")+","+u.join(","));for(var T=0;T<O;++T)l.push("if(typeof i"+T+"==='number'&&i"+T+">=0){d=i"+T+"|0;b+=c"+T+"*d;a"+T+"-=d}");l.push("return new "+F+"(this.data,"+q.map((function(K){return"a"+K})).join(",")+","+q.map((function(K){return"c"+K})).join(",")+",b)}"),l.push("proto.step=function "+F+"_step("+c.join(",")+"){var "+q.map((function(K){return"a"+K+"=this.shape["+K+"]"})).join(",")+","+q.map((function(K){return"b"+K+"=this.stride["+K+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(T=0;T<O;++T)l.push("if(typeof i"+T+"==='number'){d=i"+T+"|0;if(d<0){c+=b"+T+"*(a"+T+"-1);a"+T+"=ceil(-a"+T+"/d)}else{a"+T+"=ceil(a"+T+"/d)}b"+T+"*=d}");l.push("return new "+F+"(this.data,"+q.map((function(K){return"a"+K})).join(",")+","+q.map((function(K){return"b"+K})).join(",")+",c)}");var o=new Array(O),k=new Array(O);for(T=0;T<O;++T)o[T]="a[i"+T+"]",k[T]="b[i"+T+"]";l.push("proto.transpose=function "+F+"_transpose("+c+"){"+c.map((function(K,O){return K+"=("+K+"===undefined?"+O+":"+K+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+F+"(this.data,"+o.join(",")+","+k.join(",")+",this.offset)}"),l.push("proto.pick=function "+F+"_pick("+c+"){var a=[],b=[],c=this.offset");for(T=0;T<O;++T)l.push("if(typeof i"+T+"==='number'&&i"+T+">=0){c=(c+this.stride["+T+"]*i"+T+")|0}else{a.push(this.shape["+T+"]);b.push(this.stride["+T+"])}");return l.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),l.push("return function construct_"+F+"(data,shape,stride,offset){return new "+F+"(data,"+q.map((function(K){return"shape["+K+"]"})).join(",")+","+q.map((function(K){return"stride["+K+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",l.join("\n"))(E[K],J)}var E={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};K.exports=function(K,O,F,f){if(void 0===K)return(0,E.array[0])([]);"number"===typeof K&&(K=[K]),void 0===O&&(O=[K.length]);var q=O.length;if(void 0===F){F=new Array(q);for(var J=q-1,M=1;J>=0;--J)F[J]=M,M*=O[J]}if(void 0===f){f=0;for(J=0;J<q;++J)F[J]<0&&(f-=(O[J]-1)*F[J])}for(var t=function(K){if(r(K))return"buffer";if(l)switch(Object.prototype.toString.call(K)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(K)?"array":"generic"}(K),j=E[t];j.length<=q+1;)j.push(c(t,j.length-1));return(0,j[q+1])(K,O,F,f)}},13819:K=>{var O;self,O=()=>(()=>{"use strict";var K={d:(O,F)=>{for(var f in F)K.o(F,f)&&!K.o(O,f)&&Object.defineProperty(O,f,{enumerable:!0,get:F[f]})},o:(K,O)=>Object.prototype.hasOwnProperty.call(K,O)},O={};K.d(O,{default:()=>G});var F,f=function(K,O){var F=O.x-K.x,f=O.y-K.y;return Math.sqrt(F*F+f*f)},r=function(K){return K*(Math.PI/180)},l=new Map,q=function(K){l.has(K)&&clearTimeout(l.get(K)),l.set(K,setTimeout(K,100))},J=function(K,O,F){for(var f,r=O.split(/[ ,]+/g),l=0;l<r.length;l+=1)f=r[l],K.addEventListener?K.addEventListener(f,F,!1):K.attachEvent&&K.attachEvent(f,F)},c=function(K,O,F){for(var f,r=O.split(/[ ,]+/g),l=0;l<r.length;l+=1)f=r[l],K.removeEventListener?K.removeEventListener(f,F):K.detachEvent&&K.detachEvent(f,F)},E=function(K){return K.preventDefault(),K.type.match(/^touch/)?K.changedTouches:K},M=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},t=function(K,O){O.top||O.right||O.bottom||O.left?(K.style.top=O.top,K.style.right=O.right,K.style.bottom=O.bottom,K.style.left=O.left):(K.style.left=O.x+"px",K.style.top=O.y+"px")},j=function(K,O,F){var f=X(K);for(var r in f)if(f.hasOwnProperty(r))if("string"==typeof O)f[r]=O+" "+F;else{for(var l="",q=0,J=O.length;q<J;q+=1)l+=O[q]+" "+F+", ";f[r]=l.slice(0,-2)}return f},X=function(K){var O={};return O[K]="",["webkit","Moz","o"].forEach((function(F){O[F+K.charAt(0).toUpperCase()+K.slice(1)]=""})),O},u=function(K,O){for(var F in O)O.hasOwnProperty(F)&&(K[F]=O[F]);return K},T=function(K,O){if(K.length)for(var F=0,f=K.length;F<f;F+=1)O(K[F]);else O(K)},o="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,k=window.matchMedia("(any-hover: none)").matches,N=!!("ontouchstart"in window),Z=!!window.PointerEvent,L=!!window.MSPointerEvent,d={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},a={start:"mousedown",move:"mousemove",end:"mouseup"},g={};function H(){}o&&!k?F=d:Z?F={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:L?F={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:N?(F=d,g=a):F=a,H.prototype.on=function(K,O){var F,f=this,r=K.split(/[ ,]+/g);f._handlers_=f._handlers_||{};for(var l=0;l<r.length;l+=1)F=r[l],f._handlers_[F]=f._handlers_[F]||[],f._handlers_[F].push(O);return f},H.prototype.off=function(K,O){var F=this;return F._handlers_=F._handlers_||{},void 0===K?F._handlers_={}:void 0===O?F._handlers_[K]=null:F._handlers_[K]&&F._handlers_[K].indexOf(O)>=0&&F._handlers_[K].splice(F._handlers_[K].indexOf(O),1),F},H.prototype.trigger=function(K,O){var F,f=this,r=K.split(/[ ,]+/g);f._handlers_=f._handlers_||{};for(var l=0;l<r.length;l+=1)F=r[l],f._handlers_[F]&&f._handlers_[F].length&&f._handlers_[F].forEach((function(K){K.call(f,{type:F,target:f},O)}))},H.prototype.config=function(K){var O=this;O.options=O.defaults||{},K&&(O.options=function(K,O){var F={};for(var f in K)K.hasOwnProperty(f)&&O.hasOwnProperty(f)?F[f]=O[f]:K.hasOwnProperty(f)&&(F[f]=K[f]);return F}(O.options,K))},H.prototype.bindEvt=function(K,O){var f=this;return f._domHandlers_=f._domHandlers_||{},f._domHandlers_[O]=function(){"function"==typeof f["on"+O]?f["on"+O].apply(f,arguments):console.warn('[WARNING] : Missing "on'+O+'" handler.')},J(K,F[O],f._domHandlers_[O]),g[O]&&J(K,g[O],f._domHandlers_[O]),f},H.prototype.unbindEvt=function(K,O){var f=this;return f._domHandlers_=f._domHandlers_||{},c(K,F[O],f._domHandlers_[O]),g[O]&&c(K,g[O],f._domHandlers_[O]),delete f._domHandlers_[O],this};const e=H;function W(K,O){return this.identifier=O.identifier,this.position=O.position,this.frontPosition=O.frontPosition,this.collection=K,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(O),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=W.id,W.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}W.prototype=new e,W.constructor=W,W.id=0,W.prototype.buildEl=function(K){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},W.prototype.stylize=function(){if(this.options.dataOnly)return this;var K=this.options.fadeTime+"ms",O=function(){var K=X("borderRadius");for(var O in K)K.hasOwnProperty(O)&&(K[O]="50%");return K}(),F=j("transition","opacity",K),f={};return f.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},f.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},f.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},u(f.el,F),"circle"===this.options.shape&&u(f.back,O),u(f.front,O),this.applyStyles(f),this},W.prototype.applyStyles=function(K){for(var O in this.ui)if(this.ui.hasOwnProperty(O))for(var F in K[O])this.ui[O].style[F]=K[O][F];return this},W.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},W.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},W.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},W.prototype.show=function(K){var O=this;return O.options.dataOnly||(clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.addToDom(),O.restCallback(),setTimeout((function(){O.ui.el.style.opacity=1}),0),O.showTimeout=setTimeout((function(){O.trigger("shown",O.instance),"function"==typeof K&&K.call(this)}),O.options.fadeTime)),O},W.prototype.hide=function(K){var O=this;if(O.options.dataOnly)return O;if(O.ui.el.style.opacity=O.options.restOpacity,clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.removeTimeout=setTimeout((function(){var F="dynamic"===O.options.mode?"none":"block";O.ui.el.style.display=F,"function"==typeof K&&K.call(O),O.trigger("hidden",O.instance)}),O.options.fadeTime),O.options.restJoystick){var F=O.options.restJoystick,f={};f.x=!0===F||!1!==F.x?0:O.instance.frontPosition.x,f.y=!0===F||!1!==F.y?0:O.instance.frontPosition.y,O.setPosition(K,f)}return O},W.prototype.setPosition=function(K,O){var F=this;F.frontPosition={x:O.x,y:O.y};var f=F.options.fadeTime+"ms",r={};r.front=j("transition",["transform"],f);var l={front:{}};l.front={transform:"translate("+F.frontPosition.x+"px,"+F.frontPosition.y+"px)"},F.applyStyles(r),F.applyStyles(l),F.restTimeout=setTimeout((function(){"function"==typeof K&&K.call(F),F.restCallback()}),F.options.fadeTime)},W.prototype.restCallback=function(){var K=this,O={};O.front=j("transition","none",""),K.applyStyles(O),K.trigger("rested",K.instance)},W.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},W.prototype.computeDirection=function(K){var O,F,f,r=K.angle.radian,l=Math.PI/4,q=Math.PI/2;if(r>l&&r<3*l&&!K.lockX?O="up":r>-l&&r<=l&&!K.lockY?O="left":r>3*-l&&r<=-l&&!K.lockX?O="down":K.lockY||(O="right"),K.lockY||(F=r>-q&&r<q?"left":"right"),K.lockX||(f=r>0?"up":"down"),K.force>this.options.threshold){var J,c={};for(J in this.direction)this.direction.hasOwnProperty(J)&&(c[J]=this.direction[J]);var E={};for(J in this.direction={x:F,y:f,angle:O},K.direction=this.direction,c)c[J]===this.direction[J]&&(E[J]=!0);if(E.x&&E.y&&E.angle)return K;E.x&&E.y||this.trigger("plain",K),E.x||this.trigger("plain:"+F,K),E.y||this.trigger("plain:"+f,K),E.angle||this.trigger("dir dir:"+O,K)}else this.resetDirection();return K};const p=W;function y(K,O){var F=this;F.nipples=[],F.idles=[],F.actives=[],F.ids=[],F.pressureIntervals={},F.manager=K,F.id=y.id,y.id+=1,F.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},F.config(O),"static"!==F.options.mode&&"semi"!==F.options.mode||(F.options.multitouch=!1),F.options.multitouch||(F.options.maxNumberOfNipples=1);var f=getComputedStyle(F.options.zone.parentElement);return f&&"flex"===f.display&&(F.parentIsFlex=!0),F.updateBox(),F.prepareNipples(),F.mj(),F.begin(),F.nipples}y.prototype=new e,y.constructor=y,y.id=0,y.prototype.prepareNipples=function(){var K=this,O=K.nipples;O.on=K.on.bind(K),O.off=K.off.bind(K),O.options=K.options,O.destroy=K.destroy.bind(K),O.ids=K.ids,O.id=K.id,O.processOnMove=K.processOnMove.bind(K),O.processOnEnd=K.processOnEnd.bind(K),O.get=function(K){if(void 0===K)return O[0];for(var F=0,f=O.length;F<f;F+=1)if(O[F].identifier===K)return O[F];return!1}},y.prototype.mj=function(){var K=this;K.bindEvt(K.options.zone,"start"),K.options.zone.style.touchAction="none",K.options.zone.style.msTouchAction="none"},y.prototype.begin=function(){var K=this,O=K.options;if("static"===O.mode){var F=K.createNipple(O.position,K.manager.getIdentifier());F.add(),K.idles.push(F)}},y.prototype.createNipple=function(K,O){var F=this,f=F.manager.scroll,r={},l=F.options,q=F.parentIsFlex?f.x:f.x+F.box.left,J=F.parentIsFlex?f.y:f.y+F.box.top;if(K.x&&K.y)r={x:K.x-q,y:K.y-J};else if(K.top||K.right||K.bottom||K.left){var c=document.createElement("DIV");c.style.display="hidden",c.style.top=K.top,c.style.right=K.right,c.style.bottom=K.bottom,c.style.left=K.left,c.style.position="absolute",l.zone.appendChild(c);var E=c.getBoundingClientRect();l.zone.removeChild(c),r=K,K={x:E.left+f.x,y:E.top+f.y}}var M=new p(F,{color:l.color,size:l.size,threshold:l.threshold,fadeTime:l.fadeTime,dataOnly:l.dataOnly,restJoystick:l.restJoystick,restOpacity:l.restOpacity,mode:l.mode,identifier:O,position:K,zone:l.zone,frontPosition:{x:0,y:0},shape:l.shape});return l.dataOnly||(t(M.ui.el,r),t(M.ui.front,M.frontPosition)),F.nipples.push(M),F.trigger("added "+M.identifier+":added",M),F.manager.trigger("added "+M.identifier+":added",M),F.bindNipple(M),M},y.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},y.prototype.bindNipple=function(K){var O,F=this,f=function(K,f){O=K.type+" "+f.id+":"+K.type,F.trigger(O,f)};K.on("destroyed",F.onDestroyed.bind(F)),K.on("shown hidden rested dir plain",f),K.on("dir:up dir:right dir:down dir:left",f),K.on("plain:up plain:right plain:down plain:left",f)},y.prototype.pressureFn=function(K,O,F){var f=this,r=0;clearInterval(f.pressureIntervals[F]),f.pressureIntervals[F]=setInterval(function(){var F=K.force||K.pressure||K.webkitForce||0;F!==r&&(O.trigger("pressure",F),f.trigger("pressure "+O.identifier+":pressure",F),r=F)}.bind(f),100)},y.prototype.onstart=function(K){var O=this,F=O.options,f=K;return K=E(K),O.updateBox(),T(K,(function(r){O.actives.length<F.maxNumberOfNipples?O.processOnStart(r):f.type.match(/^touch/)&&(Object.keys(O.manager.ids).forEach((function(F){if(Object.values(f.touches).findIndex((function(K){return K.identifier===F}))<0){var r=[K[0]];r.identifier=F,O.processOnEnd(r)}})),O.actives.length<F.maxNumberOfNipples&&O.processOnStart(r))})),O.manager.bindDocument(),!1},y.prototype.processOnStart=function(K){var O,F=this,r=F.options,l=F.manager.getIdentifier(K),q=K.force||K.pressure||K.webkitForce||0,J={x:K.pageX,y:K.pageY},c=F.getOrCreate(l,J);c.identifier!==l&&F.manager.removeIdentifier(c.identifier),c.identifier=l;var E=function(O){O.trigger("start",O),F.trigger("start "+O.id+":start",O),O.show(),q>0&&F.pressureFn(K,O,O.identifier),F.processOnMove(K)};if((O=F.idles.indexOf(c))>=0&&F.idles.splice(O,1),F.actives.push(c),F.ids.push(c.identifier),"semi"!==r.mode)E(c);else{if(!(f(J,c.position)<=r.catchDistance))return c.destroy(),void F.processOnStart(K);E(c)}return c},y.prototype.getOrCreate=function(K,O){var F,f=this,r=f.options;return/(semi|static)/.test(r.mode)?(F=f.idles[0])?(f.idles.splice(0,1),F):"semi"===r.mode?f.createNipple(O,K):(console.warn("Coudln't find the needed nipple."),!1):F=f.createNipple(O,K)},y.prototype.processOnMove=function(K){var O=this,F=O.options,l=O.manager.getIdentifier(K),q=O.nipples.get(l),J=O.manager.scroll;if(function(K){return isNaN(K.buttons)?0!==K.pressure:0!==K.buttons}(K)){if(!q)return console.error("Found zombie joystick with ID "+l),void O.manager.removeIdentifier(l);if(F.dynamicPage){var c=q.el.getBoundingClientRect();q.position={x:J.x+c.left,y:J.y+c.top}}q.identifier=l;var E=q.options.size/2,M={x:K.pageX,y:K.pageY};F.lockX&&(M.y=q.position.y),F.lockY&&(M.x=q.position.x);var t,j,X,u,T,o,k,N,Z,L,d=f(M,q.position),a=(t=M,X=(j=q.position).x-t.x,u=j.y-t.y,function(K){return K*(180/Math.PI)}(Math.atan2(u,X))),g=r(a),H=d/E,e={distance:d,position:M};if("circle"===q.options.shape?(T=Math.min(d,E),k=q.position,N=T,L={x:0,y:0},Z=r(Z=a),L.x=k.x-N*Math.cos(Z),L.y=k.y-N*Math.sin(Z),o=L):(o=function(K,O,F){return{x:Math.min(Math.max(K.x,O.x-F),O.x+F),y:Math.min(Math.max(K.y,O.y-F),O.y+F)}}(M,q.position,E),T=f(o,q.position)),F.follow){if(d>E){var W=M.x-o.x,p=M.y-o.y;q.position.x+=W,q.position.y+=p,q.el.style.top=q.position.y-(O.box.top+J.y)+"px",q.el.style.left=q.position.x-(O.box.left+J.x)+"px",d=f(M,q.position)}}else M=o,d=T;var y=M.x-q.position.x,A=M.y-q.position.y;q.frontPosition={x:y,y:A},F.dataOnly||(q.ui.front.style.transform="translate("+y+"px,"+A+"px)");var Q={identifier:q.identifier,position:M,force:H,pressure:K.force||K.pressure||K.webkitForce||0,distance:d,angle:{radian:g,degree:a},vector:{x:y/E,y:-A/E},raw:e,instance:q,lockX:F.lockX,lockY:F.lockY};(Q=q.computeDirection(Q)).angle={radian:r(180-a),degree:180-a},q.trigger("move",Q),O.trigger("move "+q.id+":move",Q)}else this.processOnEnd(K)},y.prototype.processOnEnd=function(K){var O=this,F=O.options,f=O.manager.getIdentifier(K),r=O.nipples.get(f),l=O.manager.removeIdentifier(r.identifier);r&&(F.dataOnly||r.hide((function(){"dynamic"===F.mode&&(r.trigger("removed",r),O.trigger("removed "+r.id+":removed",r),O.manager.trigger("removed "+r.id+":removed",r),r.destroy())})),clearInterval(O.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),O.trigger("end "+r.id+":end",r),O.ids.indexOf(r.identifier)>=0&&O.ids.splice(O.ids.indexOf(r.identifier),1),O.actives.indexOf(r)>=0&&O.actives.splice(O.actives.indexOf(r),1),/(semi|static)/.test(F.mode)?O.idles.push(r):O.nipples.indexOf(r)>=0&&O.nipples.splice(O.nipples.indexOf(r),1),O.manager.unbindDocument(),/(semi|static)/.test(F.mode)&&(O.manager.ids[l.id]=l.identifier))},y.prototype.onDestroyed=function(K,O){var F=this;F.nipples.indexOf(O)>=0&&F.nipples.splice(F.nipples.indexOf(O),1),F.actives.indexOf(O)>=0&&F.actives.splice(F.actives.indexOf(O),1),F.idles.indexOf(O)>=0&&F.idles.splice(F.idles.indexOf(O),1),F.ids.indexOf(O.identifier)>=0&&F.ids.splice(F.ids.indexOf(O.identifier),1),F.manager.removeIdentifier(O.identifier),F.manager.unbindDocument()},y.prototype.destroy=function(){var K=this;for(var O in K.unbindEvt(K.options.zone,"start"),K.nipples.forEach((function(K){K.destroy()})),K.pressureIntervals)K.pressureIntervals.hasOwnProperty(O)&&clearInterval(K.pressureIntervals[O]);K.trigger("destroyed",K.nipples),K.manager.unbindDocument(),K.off()};const A=y;function Q(K){var O=this;O.ids={},O.index=0,O.collections=[],O.scroll=M(),O.config(K),O.prepareCollections();var F=function(){var K;O.collections.forEach((function(F){F.forEach((function(F){K=F.el.getBoundingClientRect(),F.position={x:O.scroll.x+K.left,y:O.scroll.y+K.top}}))}))};J(window,"resize",(function(){q(F)}));var f=function(){O.scroll=M()};return J(window,"scroll",(function(){q(f)})),O.collections}Q.prototype=new e,Q.constructor=Q,Q.prototype.prepareCollections=function(){var K=this;K.collections.create=K.create.bind(K),K.collections.on=K.on.bind(K),K.collections.off=K.off.bind(K),K.collections.destroy=K.destroy.bind(K),K.collections.get=function(O){var F;return K.collections.every((function(K){return!(F=K.get(O))})),F}},Q.prototype.create=function(K){return this.createCollection(K)},Q.prototype.createCollection=function(K){var O=this,F=new A(O,K);return O.bindCollection(F),O.collections.push(F),F},Q.prototype.bindCollection=function(K){var O,F=this,f=function(K,f){O=K.type+" "+f.id+":"+K.type,F.trigger(O,f)};K.on("destroyed",F.onDestroyed.bind(F)),K.on("shown hidden rested dir plain",f),K.on("dir:up dir:right dir:down dir:left",f),K.on("plain:up plain:right plain:down plain:left",f)},Q.prototype.bindDocument=function(){var K=this;K.binded||(K.bindEvt(document,"move").bindEvt(document,"end"),K.binded=!0)},Q.prototype.unbindDocument=function(K){var O=this;Object.keys(O.ids).length&&!0!==K||(O.unbindEvt(document,"move").unbindEvt(document,"end"),O.binded=!1)},Q.prototype.getIdentifier=function(K){var O;return K?void 0===(O=void 0===K.identifier?K.pointerId:K.identifier)&&(O=this.latest||0):O=this.index,void 0===this.ids[O]&&(this.ids[O]=this.index,this.index+=1),this.latest=O,this.ids[O]},Q.prototype.removeIdentifier=function(K){var O={};for(var F in this.ids)if(this.ids[F]===K){O.id=F,O.identifier=this.ids[F],delete this.ids[F];break}return O},Q.prototype.onmove=function(K){return this.onAny("move",K),!1},Q.prototype.onend=function(K){return this.onAny("end",K),!1},Q.prototype.oncancel=function(K){return this.onAny("end",K),!1},Q.prototype.onAny=function(K,O){var F,f=this,r="processOn"+K.charAt(0).toUpperCase()+K.slice(1);O=E(O);var l=function(K,O,F){F.ids.indexOf(O)>=0&&(F[r](K),K._found_=!0)};return T(O,(function(K){F=f.getIdentifier(K),T(f.collections,l.bind(null,K,F)),K._found_||f.removeIdentifier(F)})),!1},Q.prototype.destroy=function(){var K=this;K.unbindDocument(!0),K.ids={},K.index=0,K.collections.forEach((function(K){K.destroy()})),K.off()},Q.prototype.onDestroyed=function(K,O){var F=this;if(F.collections.indexOf(O)<0)return!1;F.collections.splice(F.collections.indexOf(O),1)};var R=new Q;const G={create:function(K){return R.create(K)},factory:R};return O.default})(),K.exports=O()},12851:(K,O,F)=>{"use strict";const{Deflate:f,deflate:r,deflateRaw:l,gzip:q}=F(12853),{Inflate:J,inflate:c,inflateRaw:E,ungzip:M}=F(12896),t=F(12878);K.exports.Deflate=f,K.exports.deflate=r,K.exports.deflateRaw=l,K.exports.gzip=q,K.exports.Inflate=J,K.exports.inflate=c,K.exports.inflateRaw=E,K.exports.ungzip=M,K.exports.constants=t},12853:(K,O,F)=>{"use strict";const f=F(12856),r=F(12883),l=F(12890),q=F(12871),J=F(12892),c=Object.prototype.toString,{Z_NO_FLUSH:E,Z_SYNC_FLUSH:M,Z_FULL_FLUSH:t,Z_FINISH:j,Z_OK:X,Z_STREAM_END:u,Z_DEFAULT_COMPRESSION:T,Z_DEFAULT_STRATEGY:o,Z_DEFLATED:k}=F(12878);function N(K){this.options=r.assign({level:T,method:k,YK:16384,windowBits:15,memLevel:8,strategy:o},K||{});let O=this.options;O.raw&&O.windowBits>0?O.windowBits=-O.windowBits:O.gzip&&O.windowBits>0&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.MO="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let F=f.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(F!==X)throw new Error(q[F]);if(O.header&&f.deflateSetHeader(this.strm,O.header),O.dictionary){let K;if(K="string"===typeof O.dictionary?l.string2buf(O.dictionary):"[object ArrayBuffer]"===c.call(O.dictionary)?new Uint8Array(O.dictionary):O.dictionary,F=f.deflateSetDictionary(this.strm,K),F!==X)throw new Error(q[F]);this._dict_set=!0}}function Z(K,O){const F=new N(O);if(F.push(K,!0),F.err)throw F.MO||q[F.err];return F.result}N.prototype.push=function(K,O){const F=this.strm,r=this.options.YK;let q,J;if(this.ended)return!1;for(J=O===~~O?O:!0===O?j:E,"string"===typeof K?F.input=l.string2buf(K):"[object ArrayBuffer]"===c.call(K)?F.input=new Uint8Array(K):F.input=K,F.next_in=0,F.avail_in=F.input.length;;)if(0===F.avail_out&&(F.output=new Uint8Array(r),F.next_out=0,F.avail_out=r),(J===M||J===t)&&F.avail_out<=6)this.onData(F.output.subarray(0,F.next_out)),F.avail_out=0;else{if(q=f.deflate(F,J),q===u)return F.next_out>0&&this.onData(F.output.subarray(0,F.next_out)),q=f.deflateEnd(this.strm),this.onEnd(q),this.ended=!0,q===X;if(0!==F.avail_out){if(J>0&&F.next_out>0)this.onData(F.output.subarray(0,F.next_out)),F.avail_out=0;else if(0===F.avail_in)break}else this.onData(F.output)}return!0},N.prototype.onData=function(K){this.chunks.push(K)},N.prototype.onEnd=function(K){K===X&&(this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.MO=this.strm.MO},K.exports.Deflate=N,K.exports.deflate=Z,K.exports.deflateRaw=function(K,O){return(O=O||{}).raw=!0,Z(K,O)},K.exports.gzip=function(K,O){return(O=O||{}).gzip=!0,Z(K,O)},K.exports.constants=F(12878)},12896:(K,O,F)=>{"use strict";const f=F(12903),r=F(12883),l=F(12890),q=F(12871),J=F(12892),c=F(12923),E=Object.prototype.toString,{Z_NO_FLUSH:M,Z_FINISH:t,Z_OK:j,Z_STREAM_END:X,Z_NEED_DICT:u,Z_STREAM_ERROR:T,Z_DATA_ERROR:o,Z_MEM_ERROR:k}=F(12878);function N(K){this.options=r.assign({YK:65536,windowBits:15,to:""},K||{});const O=this.options;O.raw&&O.windowBits>=0&&O.windowBits<16&&(O.windowBits=-O.windowBits,0===O.windowBits&&(O.windowBits=-15)),!(O.windowBits>=0&&O.windowBits<16)||K&&K.windowBits||(O.windowBits+=32),O.windowBits>15&&O.windowBits<48&&0===(15&O.windowBits)&&(O.windowBits|=15),this.err=0,this.MO="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let F=f.inflateInit2(this.strm,O.windowBits);if(F!==j)throw new Error(q[F]);if(this.header=new c,f.inflateGetHeader(this.strm,this.header),O.dictionary&&("string"===typeof O.dictionary?O.dictionary=l.string2buf(O.dictionary):"[object ArrayBuffer]"===E.call(O.dictionary)&&(O.dictionary=new Uint8Array(O.dictionary)),O.raw&&(F=f.inflateSetDictionary(this.strm,O.dictionary),F!==j)))throw new Error(q[F])}function Z(K,O){const F=new N(O);if(F.push(K),F.err)throw F.MO||q[F.err];return F.result}N.prototype.push=function(K,O){const F=this.strm,r=this.options.YK,q=this.options.dictionary;let J,c,N;if(this.ended)return!1;for(c=O===~~O?O:!0===O?t:M,"[object ArrayBuffer]"===E.call(K)?F.input=new Uint8Array(K):F.input=K,F.next_in=0,F.avail_in=F.input.length;;){for(0===F.avail_out&&(F.output=new Uint8Array(r),F.next_out=0,F.avail_out=r),J=f.inflate(F,c),J===u&&q&&(J=f.inflateSetDictionary(F,q),J===j?J=f.inflate(F,c):J===o&&(J=u));F.avail_in>0&&J===X&&F.state.wrap>0&&0!==K[F.next_in];)f.inflateReset(F),J=f.inflate(F,c);switch(J){case T:case o:case u:case k:return this.onEnd(J),this.ended=!0,!1}if(N=F.avail_out,F.next_out&&(0===F.avail_out||J===X))if("string"===this.options.to){let K=l.utf8border(F.output,F.next_out),O=F.next_out-K,f=l.buf2string(F.output,K);F.next_out=O,F.avail_out=r-O,O&&F.output.set(F.output.subarray(K,K+O),0),this.onData(f)}else this.onData(F.output.length===F.next_out?F.output:F.output.subarray(0,F.next_out));if(J!==j||0!==N){if(J===X)return J=f.inflateEnd(this.strm),this.onEnd(J),this.ended=!0,!0;if(0===F.avail_in)break}}return!0},N.prototype.onData=function(K){this.chunks.push(K)},N.prototype.onEnd=function(K){K===j&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.MO=this.strm.MO},K.exports.Inflate=N,K.exports.inflate=Z,K.exports.inflateRaw=function(K,O){return(O=O||{}).raw=!0,Z(K,O)},K.exports.ungzip=Z,K.exports.constants=F(12878)},12883:K=>{"use strict";const O=(K,O)=>Object.prototype.hasOwnProperty.call(K,O);K.exports.assign=function(K){const F=Array.prototype.slice.call(arguments,1);for(;F.length;){const f=F.shift();if(f){if("object"!==typeof f)throw new TypeError(f+"must be non-object");for(const F in f)O(f,F)&&(K[F]=f[F])}}return K},K.exports.flattenChunks=K=>{let O=0;for(let f=0,r=K.length;f<r;f++)O+=K[f].length;const F=new Uint8Array(O);for(let f=0,r=0,l=K.length;f<l;f++){let O=K[f];F.set(O,r),r+=O.length}return F}},12890:K=>{"use strict";let O=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(f){O=!1}const F=new Uint8Array(256);for(let r=0;r<256;r++)F[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;F[254]=F[254]=1,K.exports.string2buf=K=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(K);let O,F,f,r,l,q=K.length,J=0;for(r=0;r<q;r++)F=K.charCodeAt(r),55296===(64512&F)&&r+1<q&&(f=K.charCodeAt(r+1),56320===(64512&f)&&(F=65536+(F-55296<<10)+(f-56320),r++)),J+=F<128?1:F<2048?2:F<65536?3:4;for(O=new Uint8Array(J),l=0,r=0;l<J;r++)F=K.charCodeAt(r),55296===(64512&F)&&r+1<q&&(f=K.charCodeAt(r+1),56320===(64512&f)&&(F=65536+(F-55296<<10)+(f-56320),r++)),F<128?O[l++]=F:F<2048?(O[l++]=192|F>>>6,O[l++]=128|63&F):F<65536?(O[l++]=224|F>>>12,O[l++]=128|F>>>6&63,O[l++]=128|63&F):(O[l++]=240|F>>>18,O[l++]=128|F>>>12&63,O[l++]=128|F>>>6&63,O[l++]=128|63&F);return O};K.exports.buf2string=(K,f)=>{const r=f||K.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(K.subarray(0,f));let l,q;const J=new Array(2*r);for(q=0,l=0;l<r;){let O=K[l++];if(O<128){J[q++]=O;continue}let f=F[O];if(f>4)J[q++]=65533,l+=f-1;else{for(O&=2===f?31:3===f?15:7;f>1&&l<r;)O=O<<6|63&K[l++],f--;f>1?J[q++]=65533:O<65536?J[q++]=O:(O-=65536,J[q++]=55296|O>>10&1023,J[q++]=56320|1023&O)}}return((K,F)=>{if(F<65534&&K.subarray&&O)return String.fromCharCode.apply(null,K.length===F?K:K.subarray(0,F));let f="";for(let O=0;O<F;O++)f+=String.fromCharCode(K[O]);return f})(J,q)},K.exports.utf8border=(K,O)=>{(O=O||K.length)>K.length&&(O=K.length);let f=O-1;for(;f>=0&&128===(192&K[f]);)f--;return f<0||0===f?O:f+F[K[f]]>O?f:O}},12866:K=>{"use strict";K.exports=(K,O,F,f)=>{let r=65535&K,l=K>>>16&65535,q=0;for(;0!==F;){q=F>2e3?2e3:F,F-=q;do{r=r+O[f++]|0,l=l+r|0}while(--q);r%=65521,l%=65521}return r|l<<16}},12878:K=>{"use strict";K.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12869:K=>{"use strict";const O=new Uint32Array((()=>{let K,O=[];for(var F=0;F<256;F++){K=F;for(var f=0;f<8;f++)K=1&K?3988292384^K>>>1:K>>>1;O[F]=K}return O})());K.exports=(K,F,f,r)=>{const l=O,q=r+f;K^=-1;for(let O=r;O<q;O++)K=K>>>8^l[255&(K^F[O])];return~K}},12856:(K,O,F)=>{"use strict";const{_tr_init:f,_tr_stored_block:r,_tr_flush_block:l,_tr_tally:q,_tr_align:J}=F(12862),c=F(12866),E=F(12869),M=F(12871),{Z_NO_FLUSH:t,Z_PARTIAL_FLUSH:j,Z_FULL_FLUSH:X,Z_FINISH:u,Z_BLOCK:T,Z_OK:o,Z_STREAM_END:k,Z_STREAM_ERROR:N,Z_DATA_ERROR:Z,Z_BUF_ERROR:L,Z_DEFAULT_COMPRESSION:d,Z_FILTERED:a,Z_HUFFMAN_ONLY:g,Z_RLE:H,Z_FIXED:e,Z_DEFAULT_STRATEGY:W,Z_UNKNOWN:p,Z_DEFLATED:y}=F(12878),A=258,Q=262,R=103,G=113,z=666,m=(K,O)=>(K.MO=M[O],O),x=K=>(K<<1)-(K>4?9:0),V=K=>{let O=K.length;for(;--O>=0;)K[O]=0};let v=(K,O,F)=>(O<<K.hash_shift^F)&K.hash_mask;const Y=K=>{const O=K.state;let F=O.pending;F>K.avail_out&&(F=K.avail_out),0!==F&&(K.output.set(O.pending_buf.subarray(O.pending_out,O.pending_out+F),K.next_out),K.next_out+=F,O.pending_out+=F,K.total_out+=F,K.avail_out-=F,O.pending-=F,0===O.pending&&(O.pending_out=0))},B=(K,O)=>{l(K,K.block_start>=0?K.block_start:-1,K.strstart-K.block_start,O),K.block_start=K.strstart,Y(K.strm)},n=(K,O)=>{K.pending_buf[K.pending++]=O},C=(K,O)=>{K.pending_buf[K.pending++]=O>>>8&255,K.pending_buf[K.pending++]=255&O},I=(K,O,F,f)=>{let r=K.avail_in;return r>f&&(r=f),0===r?0:(K.avail_in-=r,O.set(K.input.subarray(K.next_in,K.next_in+r),F),1===K.state.wrap?K.adler=c(K.adler,O,r,F):2===K.state.wrap&&(K.adler=E(K.adler,O,r,F)),K.next_in+=r,K.total_in+=r,r)},D=(K,O)=>{let F,f,r=K.max_chain_length,l=K.strstart,q=K.prev_length,J=K.nice_match;const c=K.strstart>K.w_size-Q?K.strstart-(K.w_size-Q):0,E=K.window,M=K.w_mask,t=K.prev,j=K.strstart+A;let X=E[l+q-1],u=E[l+q];K.prev_length>=K.good_match&&(r>>=2),J>K.lookahead&&(J=K.lookahead);do{if(F=O,E[F+q]===u&&E[F+q-1]===X&&E[F]===E[l]&&E[++F]===E[l+1]){l+=2,F++;do{}while(E[++l]===E[++F]&&E[++l]===E[++F]&&E[++l]===E[++F]&&E[++l]===E[++F]&&E[++l]===E[++F]&&E[++l]===E[++F]&&E[++l]===E[++F]&&E[++l]===E[++F]&&l<j);if(f=A-(j-l),l=j-A,f>q){if(K.match_start=O,q=f,f>=J)break;X=E[l+q-1],u=E[l+q]}}}while((O=t[O&M])>c&&0!==--r);return q<=K.lookahead?q:K.lookahead},h=K=>{const O=K.w_size;let F,f,r,l,q;do{if(l=K.window_size-K.lookahead-K.strstart,K.strstart>=O+(O-Q)){K.window.set(K.window.subarray(O,O+O),0),K.match_start-=O,K.strstart-=O,K.block_start-=O,f=K.hash_size,F=f;do{r=K.head[--F],K.head[F]=r>=O?r-O:0}while(--f);f=O,F=f;do{r=K.prev[--F],K.prev[F]=r>=O?r-O:0}while(--f);l+=O}if(0===K.strm.avail_in)break;if(f=I(K.strm,K.window,K.strstart+K.lookahead,l),K.lookahead+=f,K.lookahead+K.insert>=3)for(q=K.strstart-K.insert,K.ins_h=K.window[q],K.ins_h=v(K,K.ins_h,K.window[q+1]);K.insert&&(K.ins_h=v(K,K.ins_h,K.window[q+3-1]),K.prev[q&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=q,q++,K.insert--,!(K.lookahead+K.insert<3)););}while(K.lookahead<Q&&0!==K.strm.avail_in)},b=(K,O)=>{let F,f;for(;;){if(K.lookahead<Q){if(h(K),K.lookahead<Q&&O===t)return 1;if(0===K.lookahead)break}if(F=0,K.lookahead>=3&&(K.ins_h=v(K,K.ins_h,K.window[K.strstart+3-1]),F=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),0!==F&&K.strstart-F<=K.w_size-Q&&(K.match_length=D(K,F)),K.match_length>=3)if(f=q(K,K.strstart-K.match_start,K.match_length-3),K.lookahead-=K.match_length,K.match_length<=K.max_lazy_match&&K.lookahead>=3){K.match_length--;do{K.strstart++,K.ins_h=v(K,K.ins_h,K.window[K.strstart+3-1]),F=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart}while(0!==--K.match_length);K.strstart++}else K.strstart+=K.match_length,K.match_length=0,K.ins_h=K.window[K.strstart],K.ins_h=v(K,K.ins_h,K.window[K.strstart+1]);else f=q(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++;if(f&&(B(K,!1),0===K.strm.avail_out))return 1}return K.insert=K.strstart<2?K.strstart:2,O===u?(B(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(B(K,!1),0===K.strm.avail_out)?1:2},i=(K,O)=>{let F,f,r;for(;;){if(K.lookahead<Q){if(h(K),K.lookahead<Q&&O===t)return 1;if(0===K.lookahead)break}if(F=0,K.lookahead>=3&&(K.ins_h=v(K,K.ins_h,K.window[K.strstart+3-1]),F=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),K.prev_length=K.match_length,K.prev_match=K.match_start,K.match_length=2,0!==F&&K.prev_length<K.max_lazy_match&&K.strstart-F<=K.w_size-Q&&(K.match_length=D(K,F),K.match_length<=5&&(K.strategy===a||3===K.match_length&&K.strstart-K.match_start>4096)&&(K.match_length=2)),K.prev_length>=3&&K.match_length<=K.prev_length){r=K.strstart+K.lookahead-3,f=q(K,K.strstart-1-K.prev_match,K.prev_length-3),K.lookahead-=K.prev_length-1,K.prev_length-=2;do{++K.strstart<=r&&(K.ins_h=v(K,K.ins_h,K.window[K.strstart+3-1]),F=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart)}while(0!==--K.prev_length);if(K.match_available=0,K.match_length=2,K.strstart++,f&&(B(K,!1),0===K.strm.avail_out))return 1}else if(K.match_available){if(f=q(K,0,K.window[K.strstart-1]),f&&B(K,!1),K.strstart++,K.lookahead--,0===K.strm.avail_out)return 1}else K.match_available=1,K.strstart++,K.lookahead--}return K.match_available&&(f=q(K,0,K.window[K.strstart-1]),K.match_available=0),K.insert=K.strstart<2?K.strstart:2,O===u?(B(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(B(K,!1),0===K.strm.avail_out)?1:2};function w(K,O,F,f,r){this.good_length=K,this.max_lazy=O,this.nice_length=F,this.max_chain=f,this.func=r}const s=[new w(0,0,0,0,((K,O)=>{let F=65535;for(F>K.pending_buf_size-5&&(F=K.pending_buf_size-5);;){if(K.lookahead<=1){if(h(K),0===K.lookahead&&O===t)return 1;if(0===K.lookahead)break}K.strstart+=K.lookahead,K.lookahead=0;const f=K.block_start+F;if((0===K.strstart||K.strstart>=f)&&(K.lookahead=K.strstart-f,K.strstart=f,B(K,!1),0===K.strm.avail_out))return 1;if(K.strstart-K.block_start>=K.w_size-Q&&(B(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,O===u?(B(K,!0),0===K.strm.avail_out?3:4):(K.strstart>K.block_start&&(B(K,!1),K.strm.avail_out),1)})),new w(4,4,8,4,b),new w(4,5,16,8,b),new w(4,6,32,32,b),new w(4,4,16,16,i),new w(8,16,32,32,i),new w(8,16,128,128,i),new w(8,32,128,256,i),new w(32,128,258,1024,i),new w(32,258,258,4096,i)];function U(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),V(this.dyn_ltree),V(this.dyn_dtree),V(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),V(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),V(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const P=K=>{if(!K||!K.state)return m(K,N);K.total_in=K.total_out=0,K.data_type=p;const O=K.state;return O.pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?42:G,K.adler=2===O.wrap?0:1,O.last_flush=t,f(O),o},S=K=>{const O=P(K);var F;return O===o&&((F=K.state).window_size=2*F.w_size,V(F.head),F.max_lazy_match=s[F.level].max_lazy,F.good_match=s[F.level].good_length,F.nice_match=s[F.level].nice_length,F.max_chain_length=s[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=2,F.match_available=0,F.ins_h=0),O},KK=(K,O,F,f,r,l)=>{if(!K)return N;let q=1;if(O===d&&(O=6),f<0?(q=0,f=-f):f>15&&(q=2,f-=16),r<1||r>9||F!==y||f<8||f>15||O<0||O>9||l<0||l>e)return m(K,N);8===f&&(f=9);const J=new U;return K.state=J,J.strm=K,J.wrap=q,J.gzhead=null,J.w_bits=f,J.w_size=1<<J.w_bits,J.w_mask=J.w_size-1,J.hash_bits=r+7,J.hash_size=1<<J.hash_bits,J.hash_mask=J.hash_size-1,J.hash_shift=~~((J.hash_bits+3-1)/3),J.window=new Uint8Array(2*J.w_size),J.head=new Uint16Array(J.hash_size),J.prev=new Uint16Array(J.w_size),J.lit_bufsize=1<<r+6,J.pending_buf_size=4*J.lit_bufsize,J.pending_buf=new Uint8Array(J.pending_buf_size),J.d_buf=1*J.lit_bufsize,J.l_buf=3*J.lit_bufsize,J.level=O,J.strategy=l,J.method=F,S(K)};K.exports.deflateInit=(K,O)=>KK(K,O,y,15,8,W),K.exports.deflateInit2=KK,K.exports.deflateReset=S,K.exports.deflateResetKeep=P,K.exports.deflateSetHeader=(K,O)=>K&&K.state?2!==K.state.wrap?N:(K.state.gzhead=O,o):N,K.exports.deflate=(K,O)=>{let F,f;if(!K||!K.state||O>T||O<0)return K?m(K,N):N;const l=K.state;if(!K.output||!K.input&&0!==K.avail_in||l.status===z&&O!==u)return m(K,0===K.avail_out?L:N);l.strm=K;const c=l.last_flush;if(l.last_flush=O,42===l.status)if(2===l.wrap)K.adler=0,n(l,31),n(l,139),n(l,8),l.gzhead?(n(l,(l.gzhead.text?1:0)+(l.gzhead.hcrc?2:0)+(l.gzhead.extra?4:0)+(l.gzhead.name?8:0)+(l.gzhead.comment?16:0)),n(l,255&l.gzhead.time),n(l,l.gzhead.time>>8&255),n(l,l.gzhead.time>>16&255),n(l,l.gzhead.time>>24&255),n(l,9===l.level?2:l.strategy>=g||l.level<2?4:0),n(l,255&l.gzhead.os),l.gzhead.extra&&l.gzhead.extra.length&&(n(l,255&l.gzhead.extra.length),n(l,l.gzhead.extra.length>>8&255)),l.gzhead.hcrc&&(K.adler=E(K.adler,l.pending_buf,l.pending,0)),l.gzindex=0,l.status=69):(n(l,0),n(l,0),n(l,0),n(l,0),n(l,0),n(l,9===l.level?2:l.strategy>=g||l.level<2?4:0),n(l,3),l.status=G);else{let O=y+(l.w_bits-8<<4)<<8,F=-1;F=l.strategy>=g||l.level<2?0:l.level<6?1:6===l.level?2:3,O|=F<<6,0!==l.strstart&&(O|=32),O+=31-O%31,l.status=G,C(l,O),0!==l.strstart&&(C(l,K.adler>>>16),C(l,65535&K.adler)),K.adler=1}if(69===l.status)if(l.gzhead.extra){for(F=l.pending;l.gzindex<(65535&l.gzhead.extra.length)&&(l.pending!==l.pending_buf_size||(l.gzhead.hcrc&&l.pending>F&&(K.adler=E(K.adler,l.pending_buf,l.pending-F,F)),Y(K),F=l.pending,l.pending!==l.pending_buf_size));)n(l,255&l.gzhead.extra[l.gzindex]),l.gzindex++;l.gzhead.hcrc&&l.pending>F&&(K.adler=E(K.adler,l.pending_buf,l.pending-F,F)),l.gzindex===l.gzhead.extra.length&&(l.gzindex=0,l.status=73)}else l.status=73;if(73===l.status)if(l.gzhead.name){F=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>F&&(K.adler=E(K.adler,l.pending_buf,l.pending-F,F)),Y(K),F=l.pending,l.pending===l.pending_buf_size)){f=1;break}f=l.gzindex<l.gzhead.name.length?255&l.gzhead.name.charCodeAt(l.gzindex++):0,n(l,f)}while(0!==f);l.gzhead.hcrc&&l.pending>F&&(K.adler=E(K.adler,l.pending_buf,l.pending-F,F)),0===f&&(l.gzindex=0,l.status=91)}else l.status=91;if(91===l.status)if(l.gzhead.comment){F=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>F&&(K.adler=E(K.adler,l.pending_buf,l.pending-F,F)),Y(K),F=l.pending,l.pending===l.pending_buf_size)){f=1;break}f=l.gzindex<l.gzhead.comment.length?255&l.gzhead.comment.charCodeAt(l.gzindex++):0,n(l,f)}while(0!==f);l.gzhead.hcrc&&l.pending>F&&(K.adler=E(K.adler,l.pending_buf,l.pending-F,F)),0===f&&(l.status=R)}else l.status=R;if(l.status===R&&(l.gzhead.hcrc?(l.pending+2>l.pending_buf_size&&Y(K),l.pending+2<=l.pending_buf_size&&(n(l,255&K.adler),n(l,K.adler>>8&255),K.adler=0,l.status=G)):l.status=G),0!==l.pending){if(Y(K),0===K.avail_out)return l.last_flush=-1,o}else if(0===K.avail_in&&x(O)<=x(c)&&O!==u)return m(K,L);if(l.status===z&&0!==K.avail_in)return m(K,L);if(0!==K.avail_in||0!==l.lookahead||O!==t&&l.status!==z){let F=l.strategy===g?((K,O)=>{let F;for(;;){if(0===K.lookahead&&(h(K),0===K.lookahead)){if(O===t)return 1;break}if(K.match_length=0,F=q(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,F&&(B(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,O===u?(B(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(B(K,!1),0===K.strm.avail_out)?1:2})(l,O):l.strategy===H?((K,O)=>{let F,f,r,l;const J=K.window;for(;;){if(K.lookahead<=A){if(h(K),K.lookahead<=A&&O===t)return 1;if(0===K.lookahead)break}if(K.match_length=0,K.lookahead>=3&&K.strstart>0&&(r=K.strstart-1,f=J[r],f===J[++r]&&f===J[++r]&&f===J[++r])){l=K.strstart+A;do{}while(f===J[++r]&&f===J[++r]&&f===J[++r]&&f===J[++r]&&f===J[++r]&&f===J[++r]&&f===J[++r]&&f===J[++r]&&r<l);K.match_length=A-(l-r),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=3?(F=q(K,1,K.match_length-3),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(F=q(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),F&&(B(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,O===u?(B(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(B(K,!1),0===K.strm.avail_out)?1:2})(l,O):s[l.level].func(l,O);if(3!==F&&4!==F||(l.status=z),1===F||3===F)return 0===K.avail_out&&(l.last_flush=-1),o;if(2===F&&(O===j?J(l):O!==T&&(r(l,0,0,!1),O===X&&(V(l.head),0===l.lookahead&&(l.strstart=0,l.block_start=0,l.insert=0))),Y(K),0===K.avail_out))return l.last_flush=-1,o}return O!==u?o:l.wrap<=0?k:(2===l.wrap?(n(l,255&K.adler),n(l,K.adler>>8&255),n(l,K.adler>>16&255),n(l,K.adler>>24&255),n(l,255&K.total_in),n(l,K.total_in>>8&255),n(l,K.total_in>>16&255),n(l,K.total_in>>24&255)):(C(l,K.adler>>>16),C(l,65535&K.adler)),Y(K),l.wrap>0&&(l.wrap=-l.wrap),0!==l.pending?o:k)},K.exports.deflateEnd=K=>{if(!K||!K.state)return N;const O=K.state.status;return 42!==O&&69!==O&&73!==O&&91!==O&&O!==R&&O!==G&&O!==z?m(K,N):(K.state=null,O===G?m(K,Z):o)},K.exports.deflateSetDictionary=(K,O)=>{let F=O.length;if(!K||!K.state)return N;const f=K.state,r=f.wrap;if(2===r||1===r&&42!==f.status||f.lookahead)return N;if(1===r&&(K.adler=c(K.adler,O,F,0)),f.wrap=0,F>=f.w_size){0===r&&(V(f.head),f.strstart=0,f.block_start=0,f.insert=0);let K=new Uint8Array(f.w_size);K.set(O.subarray(F-f.w_size,F),0),O=K,F=f.w_size}const l=K.avail_in,q=K.next_in,J=K.input;for(K.avail_in=F,K.next_in=0,K.input=O,h(f);f.lookahead>=3;){let K=f.strstart,O=f.lookahead-2;do{f.ins_h=v(f,f.ins_h,f.window[K+3-1]),f.prev[K&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=K,K++}while(--O);f.strstart=K,f.lookahead=2,h(f)}return f.strstart+=f.lookahead,f.block_start=f.strstart,f.insert=f.lookahead,f.lookahead=0,f.match_length=f.prev_length=2,f.match_available=0,K.next_in=q,K.input=J,K.avail_in=l,f.wrap=r,o},K.exports.deflateInfo="pako deflate (from Nodeca project)"},12923:K=>{"use strict";K.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12908:K=>{"use strict";K.exports=function(K,O){let F,f,r,l,q,J,c,E,M,t,j,X,u,T,o,k,N,Z,L,d,a,g,H,e;const W=K.state;F=K.next_in,H=K.input,f=F+(K.avail_in-5),r=K.next_out,e=K.output,l=r-(O-K.avail_out),q=r+(K.avail_out-257),J=W.dmax,c=W.wsize,E=W.whave,M=W.wnext,t=W.window,j=W.hold,X=W.bits,u=W.lencode,T=W.distcode,o=(1<<W.lenbits)-1,k=(1<<W.distbits)-1;K:do{X<15&&(j+=H[F++]<<X,X+=8,j+=H[F++]<<X,X+=8),N=u[j&o];O:for(;;){if(Z=N>>>24,j>>>=Z,X-=Z,Z=N>>>16&255,0===Z)e[r++]=65535&N;else{if(!(16&Z)){if(0===(64&Z)){N=u[(65535&N)+(j&(1<<Z)-1)];continue O}if(32&Z){W.mode=12;break K}K.MO="invalid literal/length code",W.mode=30;break K}L=65535&N,Z&=15,Z&&(X<Z&&(j+=H[F++]<<X,X+=8),L+=j&(1<<Z)-1,j>>>=Z,X-=Z),X<15&&(j+=H[F++]<<X,X+=8,j+=H[F++]<<X,X+=8),N=T[j&k];F:for(;;){if(Z=N>>>24,j>>>=Z,X-=Z,Z=N>>>16&255,!(16&Z)){if(0===(64&Z)){N=T[(65535&N)+(j&(1<<Z)-1)];continue F}K.MO="invalid distance code",W.mode=30;break K}if(d=65535&N,Z&=15,X<Z&&(j+=H[F++]<<X,X+=8,X<Z&&(j+=H[F++]<<X,X+=8)),d+=j&(1<<Z)-1,d>J){K.MO="invalid distance too far back",W.mode=30;break K}if(j>>>=Z,X-=Z,Z=r-l,d>Z){if(Z=d-Z,Z>E&&W.sane){K.MO="invalid distance too far back",W.mode=30;break K}if(a=0,g=t,0===M){if(a+=c-Z,Z<L){L-=Z;do{e[r++]=t[a++]}while(--Z);a=r-d,g=e}}else if(M<Z){if(a+=c+M-Z,Z-=M,Z<L){L-=Z;do{e[r++]=t[a++]}while(--Z);if(a=0,M<L){Z=M,L-=Z;do{e[r++]=t[a++]}while(--Z);a=r-d,g=e}}}else if(a+=M-Z,Z<L){L-=Z;do{e[r++]=t[a++]}while(--Z);a=r-d,g=e}for(;L>2;)e[r++]=g[a++],e[r++]=g[a++],e[r++]=g[a++],L-=3;L&&(e[r++]=g[a++],L>1&&(e[r++]=g[a++]))}else{a=r-d;do{e[r++]=e[a++],e[r++]=e[a++],e[r++]=e[a++],L-=3}while(L>2);L&&(e[r++]=e[a++],L>1&&(e[r++]=e[a++]))}break}}break}}while(F<f&&r<q);L=X>>3,F-=L,X-=L<<3,j&=(1<<X)-1,K.next_in=F,K.next_out=r,K.avail_in=F<f?f-F+5:5-(F-f),K.avail_out=r<q?q-r+257:257-(r-q),W.hold=j,W.bits=X}},12903:(K,O,F)=>{"use strict";const f=F(12866),r=F(12869),l=F(12908),q=F(12917),{Z_FINISH:J,Z_BLOCK:c,Z_TREES:E,Z_OK:M,Z_STREAM_END:t,Z_NEED_DICT:j,Z_STREAM_ERROR:X,Z_DATA_ERROR:u,Z_MEM_ERROR:T,Z_BUF_ERROR:o,Z_DEFLATED:k}=F(12878),N=12,Z=30,L=K=>(K>>>24&255)+(K>>>8&65280)+((65280&K)<<8)+((255&K)<<24);function d(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const a=K=>{if(!K||!K.state)return X;const O=K.state;return K.total_in=K.total_out=O.total=0,K.MO="",O.wrap&&(K.adler=1&O.wrap),O.mode=1,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new Int32Array(852),O.distcode=O.distdyn=new Int32Array(592),O.sane=1,O.back=-1,M},g=K=>{if(!K||!K.state)return X;const O=K.state;return O.wsize=0,O.whave=0,O.wnext=0,a(K)},H=(K,O)=>{let F;if(!K||!K.state)return X;const f=K.state;return O<0?(F=0,O=-O):(F=1+(O>>4),O<48&&(O&=15)),O&&(O<8||O>15)?X:(null!==f.window&&f.wbits!==O&&(f.window=null),f.wrap=F,f.wbits=O,g(K))},e=(K,O)=>{if(!K)return X;const F=new d;K.state=F,F.window=null;const f=H(K,O);return f!==M&&(K.state=null),f};let W,p,y=!0;const A=K=>{if(y){W=new Int32Array(512),p=new Int32Array(32);let O=0;for(;O<144;)K.lens[O++]=8;for(;O<256;)K.lens[O++]=9;for(;O<280;)K.lens[O++]=7;for(;O<288;)K.lens[O++]=8;for(q(1,K.lens,0,288,W,0,K.work,{bits:9}),O=0;O<32;)K.lens[O++]=5;q(2,K.lens,0,32,p,0,K.work,{bits:5}),y=!1}K.lencode=W,K.lenbits=9,K.distcode=p,K.distbits=5},Q=(K,O,F,f)=>{let r;const l=K.state;return null===l.window&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),f>=l.wsize?(l.window.set(O.subarray(F-l.wsize,F),0),l.wnext=0,l.whave=l.wsize):(r=l.wsize-l.wnext,r>f&&(r=f),l.window.set(O.subarray(F-f,F-f+r),l.wnext),(f-=r)?(l.window.set(O.subarray(F-f,F),0),l.wnext=f,l.whave=l.wsize):(l.wnext+=r,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=r))),0};K.exports.inflateReset=g,K.exports.inflateReset2=H,K.exports.inflateResetKeep=a,K.exports.inflateInit=K=>e(K,15),K.exports.inflateInit2=e,K.exports.inflate=(K,O)=>{let F,d,a,g,H,e,W,p,y,R,G,z,m,x,V,v,Y,B,n,C,I,D,h=0;const b=new Uint8Array(4);let i,w;const s=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!K||!K.state||!K.output||!K.input&&0!==K.avail_in)return X;F=K.state,F.mode===N&&(F.mode=13),H=K.next_out,a=K.output,W=K.avail_out,g=K.next_in,d=K.input,e=K.avail_in,p=F.hold,y=F.bits,R=e,G=W,D=M;K:for(;;)switch(F.mode){case 1:if(0===F.wrap){F.mode=13;break}for(;y<16;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if(2&F.wrap&&35615===p){F.check=0,b[0]=255&p,b[1]=p>>>8&255,F.check=r(F.check,b,2,0),p=0,y=0,F.mode=2;break}if(F.flags=0,F.head&&(F.head.done=!1),!(1&F.wrap)||(((255&p)<<8)+(p>>8))%31){K.MO="incorrect header check",F.mode=Z;break}if((15&p)!==k){K.MO="unknown compression method",F.mode=Z;break}if(p>>>=4,y-=4,I=8+(15&p),0===F.wbits)F.wbits=I;else if(I>F.wbits){K.MO="invalid window size",F.mode=Z;break}F.dmax=1<<F.wbits,K.adler=F.check=1,F.mode=512&p?10:N,p=0,y=0;break;case 2:for(;y<16;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if(F.flags=p,(255&F.flags)!==k){K.MO="unknown compression method",F.mode=Z;break}if(57344&F.flags){K.MO="unknown header flags set",F.mode=Z;break}F.head&&(F.head.text=p>>8&1),512&F.flags&&(b[0]=255&p,b[1]=p>>>8&255,F.check=r(F.check,b,2,0)),p=0,y=0,F.mode=3;case 3:for(;y<32;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}F.head&&(F.head.time=p),512&F.flags&&(b[0]=255&p,b[1]=p>>>8&255,b[2]=p>>>16&255,b[3]=p>>>24&255,F.check=r(F.check,b,4,0)),p=0,y=0,F.mode=4;case 4:for(;y<16;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}F.head&&(F.head.xflags=255&p,F.head.os=p>>8),512&F.flags&&(b[0]=255&p,b[1]=p>>>8&255,F.check=r(F.check,b,2,0)),p=0,y=0,F.mode=5;case 5:if(1024&F.flags){for(;y<16;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}F.length=p,F.head&&(F.head.extra_len=p),512&F.flags&&(b[0]=255&p,b[1]=p>>>8&255,F.check=r(F.check,b,2,0)),p=0,y=0}else F.head&&(F.head.extra=null);F.mode=6;case 6:if(1024&F.flags&&(z=F.length,z>e&&(z=e),z&&(F.head&&(I=F.head.extra_len-F.length,F.head.extra||(F.head.extra=new Uint8Array(F.head.extra_len)),F.head.extra.set(d.subarray(g,g+z),I)),512&F.flags&&(F.check=r(F.check,d,z,g)),e-=z,g+=z,F.length-=z),F.length))break K;F.length=0,F.mode=7;case 7:if(2048&F.flags){if(0===e)break K;z=0;do{I=d[g+z++],F.head&&I&&F.length<65536&&(F.head.name+=String.fromCharCode(I))}while(I&&z<e);if(512&F.flags&&(F.check=r(F.check,d,z,g)),e-=z,g+=z,I)break K}else F.head&&(F.head.name=null);F.length=0,F.mode=8;case 8:if(4096&F.flags){if(0===e)break K;z=0;do{I=d[g+z++],F.head&&I&&F.length<65536&&(F.head.comment+=String.fromCharCode(I))}while(I&&z<e);if(512&F.flags&&(F.check=r(F.check,d,z,g)),e-=z,g+=z,I)break K}else F.head&&(F.head.comment=null);F.mode=9;case 9:if(512&F.flags){for(;y<16;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if(p!==(65535&F.check)){K.MO="header crc mismatch",F.mode=Z;break}p=0,y=0}F.head&&(F.head.hcrc=F.flags>>9&1,F.head.done=!0),K.adler=F.check=0,F.mode=N;break;case 10:for(;y<32;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}K.adler=F.check=L(p),p=0,y=0,F.mode=11;case 11:if(0===F.havedict)return K.next_out=H,K.avail_out=W,K.next_in=g,K.avail_in=e,F.hold=p,F.bits=y,j;K.adler=F.check=1,F.mode=N;case N:if(O===c||O===E)break K;case 13:if(F.last){p>>>=7&y,y-=7&y,F.mode=27;break}for(;y<3;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}switch(F.last=1&p,p>>>=1,y-=1,3&p){case 0:F.mode=14;break;case 1:if(A(F),F.mode=20,O===E){p>>>=2,y-=2;break K}break;case 2:F.mode=17;break;case 3:K.MO="invalid block type",F.mode=Z}p>>>=2,y-=2;break;case 14:for(p>>>=7&y,y-=7&y;y<32;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if((65535&p)!==(p>>>16^65535)){K.MO="invalid stored block lengths",F.mode=Z;break}if(F.length=65535&p,p=0,y=0,F.mode=15,O===E)break K;case 15:F.mode=16;case 16:if(z=F.length,z){if(z>e&&(z=e),z>W&&(z=W),0===z)break K;a.set(d.subarray(g,g+z),H),e-=z,g+=z,W-=z,H+=z,F.length-=z;break}F.mode=N;break;case 17:for(;y<14;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if(F.nlen=257+(31&p),p>>>=5,y-=5,F.ndist=1+(31&p),p>>>=5,y-=5,F.ncode=4+(15&p),p>>>=4,y-=4,F.nlen>286||F.ndist>30){K.MO="too many length or distance symbols",F.mode=Z;break}F.have=0,F.mode=18;case 18:for(;F.have<F.ncode;){for(;y<3;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}F.lens[s[F.have++]]=7&p,p>>>=3,y-=3}for(;F.have<19;)F.lens[s[F.have++]]=0;if(F.lencode=F.lendyn,F.lenbits=7,i={bits:F.lenbits},D=q(0,F.lens,0,19,F.lencode,0,F.work,i),F.lenbits=i.bits,D){K.MO="invalid code lengths set",F.mode=Z;break}F.have=0,F.mode=19;case 19:for(;F.have<F.nlen+F.ndist;){for(;h=F.lencode[p&(1<<F.lenbits)-1],V=h>>>24,v=h>>>16&255,Y=65535&h,!(V<=y);){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if(Y<16)p>>>=V,y-=V,F.lens[F.have++]=Y;else{if(16===Y){for(w=V+2;y<w;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if(p>>>=V,y-=V,0===F.have){K.MO="invalid bit length repeat",F.mode=Z;break}I=F.lens[F.have-1],z=3+(3&p),p>>>=2,y-=2}else if(17===Y){for(w=V+3;y<w;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}p>>>=V,y-=V,I=0,z=3+(7&p),p>>>=3,y-=3}else{for(w=V+7;y<w;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}p>>>=V,y-=V,I=0,z=11+(127&p),p>>>=7,y-=7}if(F.have+z>F.nlen+F.ndist){K.MO="invalid bit length repeat",F.mode=Z;break}for(;z--;)F.lens[F.have++]=I}}if(F.mode===Z)break;if(0===F.lens[256]){K.MO="invalid code -- missing end-of-block",F.mode=Z;break}if(F.lenbits=9,i={bits:F.lenbits},D=q(1,F.lens,0,F.nlen,F.lencode,0,F.work,i),F.lenbits=i.bits,D){K.MO="invalid literal/lengths set",F.mode=Z;break}if(F.distbits=6,F.distcode=F.distdyn,i={bits:F.distbits},D=q(2,F.lens,F.nlen,F.ndist,F.distcode,0,F.work,i),F.distbits=i.bits,D){K.MO="invalid distances set",F.mode=Z;break}if(F.mode=20,O===E)break K;case 20:F.mode=21;case 21:if(e>=6&&W>=258){K.next_out=H,K.avail_out=W,K.next_in=g,K.avail_in=e,F.hold=p,F.bits=y,l(K,G),H=K.next_out,a=K.output,W=K.avail_out,g=K.next_in,d=K.input,e=K.avail_in,p=F.hold,y=F.bits,F.mode===N&&(F.back=-1);break}for(F.back=0;h=F.lencode[p&(1<<F.lenbits)-1],V=h>>>24,v=h>>>16&255,Y=65535&h,!(V<=y);){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if(v&&0===(240&v)){for(B=V,n=v,C=Y;h=F.lencode[C+((p&(1<<B+n)-1)>>B)],V=h>>>24,v=h>>>16&255,Y=65535&h,!(B+V<=y);){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}p>>>=B,y-=B,F.back+=B}if(p>>>=V,y-=V,F.back+=V,F.length=Y,0===v){F.mode=26;break}if(32&v){F.back=-1,F.mode=N;break}if(64&v){K.MO="invalid literal/length code",F.mode=Z;break}F.extra=15&v,F.mode=22;case 22:if(F.extra){for(w=F.extra;y<w;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}F.length+=p&(1<<F.extra)-1,p>>>=F.extra,y-=F.extra,F.back+=F.extra}F.was=F.length,F.mode=23;case 23:for(;h=F.distcode[p&(1<<F.distbits)-1],V=h>>>24,v=h>>>16&255,Y=65535&h,!(V<=y);){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if(0===(240&v)){for(B=V,n=v,C=Y;h=F.distcode[C+((p&(1<<B+n)-1)>>B)],V=h>>>24,v=h>>>16&255,Y=65535&h,!(B+V<=y);){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}p>>>=B,y-=B,F.back+=B}if(p>>>=V,y-=V,F.back+=V,64&v){K.MO="invalid distance code",F.mode=Z;break}F.offset=Y,F.extra=15&v,F.mode=24;case 24:if(F.extra){for(w=F.extra;y<w;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}F.offset+=p&(1<<F.extra)-1,p>>>=F.extra,y-=F.extra,F.back+=F.extra}if(F.offset>F.dmax){K.MO="invalid distance too far back",F.mode=Z;break}F.mode=25;case 25:if(0===W)break K;if(z=G-W,F.offset>z){if(z=F.offset-z,z>F.whave&&F.sane){K.MO="invalid distance too far back",F.mode=Z;break}z>F.wnext?(z-=F.wnext,m=F.wsize-z):m=F.wnext-z,z>F.length&&(z=F.length),x=F.window}else x=a,m=H-F.offset,z=F.length;z>W&&(z=W),W-=z,F.length-=z;do{a[H++]=x[m++]}while(--z);0===F.length&&(F.mode=21);break;case 26:if(0===W)break K;a[H++]=F.length,W--,F.mode=21;break;case 27:if(F.wrap){for(;y<32;){if(0===e)break K;e--,p|=d[g++]<<y,y+=8}if(G-=W,K.total_out+=G,F.total+=G,G&&(K.adler=F.check=F.flags?r(F.check,a,G,H-G):f(F.check,a,G,H-G)),G=W,(F.flags?p:L(p))!==F.check){K.MO="incorrect data check",F.mode=Z;break}p=0,y=0}F.mode=28;case 28:if(F.wrap&&F.flags){for(;y<32;){if(0===e)break K;e--,p+=d[g++]<<y,y+=8}if(p!==(4294967295&F.total)){K.MO="incorrect length check",F.mode=Z;break}p=0,y=0}F.mode=29;case 29:D=t;break K;case Z:D=u;break K;case 31:return T;default:return X}return K.next_out=H,K.avail_out=W,K.next_in=g,K.avail_in=e,F.hold=p,F.bits=y,(F.wsize||G!==K.avail_out&&F.mode<Z&&(F.mode<27||O!==J))&&Q(K,K.output,K.next_out,G-K.avail_out)?(F.mode=31,T):(R-=K.avail_in,G-=K.avail_out,K.total_in+=R,K.total_out+=G,F.total+=G,F.wrap&&G&&(K.adler=F.check=F.flags?r(F.check,a,G,K.next_out-G):f(F.check,a,G,K.next_out-G)),K.data_type=F.bits+(F.last?64:0)+(F.mode===N?128:0)+(20===F.mode||15===F.mode?256:0),(0===R&&0===G||O===J)&&D===M&&(D=o),D)},K.exports.inflateEnd=K=>{if(!K||!K.state)return X;let O=K.state;return O.window&&(O.window=null),K.state=null,M},K.exports.inflateGetHeader=(K,O)=>{if(!K||!K.state)return X;const F=K.state;return 0===(2&F.wrap)?X:(F.head=O,O.done=!1,M)},K.exports.inflateSetDictionary=(K,O)=>{const F=O.length;let r,l,q;return K&&K.state?(r=K.state,0!==r.wrap&&11!==r.mode?X:11===r.mode&&(l=1,l=f(l,O,F,0),l!==r.check)?u:(q=Q(K,O,F,F),q?(r.mode=31,T):(r.havedict=1,M))):X},K.exports.inflateInfo="pako inflate (from Nodeca project)"},12917:K=>{"use strict";const O=15,F=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),f=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),r=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),l=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);K.exports=(K,q,J,c,E,M,t,j)=>{const X=j.bits;let u,T,o,k,N,Z,L=0,d=0,a=0,g=0,H=0,e=0,W=0,p=0,y=0,A=0,Q=null,R=0;const G=new Uint16Array(16),z=new Uint16Array(16);let m,x,V,v=null,Y=0;for(L=0;L<=O;L++)G[L]=0;for(d=0;d<c;d++)G[q[J+d]]++;for(H=X,g=O;g>=1&&0===G[g];g--);if(H>g&&(H=g),0===g)return E[M++]=20971520,E[M++]=20971520,j.bits=1,0;for(a=1;a<g&&0===G[a];a++);for(H<a&&(H=a),p=1,L=1;L<=O;L++)if(p<<=1,p-=G[L],p<0)return-1;if(p>0&&(0===K||1!==g))return-1;for(z[1]=0,L=1;L<O;L++)z[L+1]=z[L]+G[L];for(d=0;d<c;d++)0!==q[J+d]&&(t[z[q[J+d]]++]=d);if(0===K?(Q=v=t,Z=19):1===K?(Q=F,R-=257,v=f,Y-=257,Z=256):(Q=r,v=l,Z=-1),A=0,d=0,L=a,N=M,e=H,W=0,o=-1,y=1<<H,k=y-1,1===K&&y>852||2===K&&y>592)return 1;for(;;){m=L-W,t[d]<Z?(x=0,V=t[d]):t[d]>Z?(x=v[Y+t[d]],V=Q[R+t[d]]):(x=96,V=0),u=1<<L-W,T=1<<e,a=T;do{T-=u,E[N+(A>>W)+T]=m<<24|x<<16|V}while(0!==T);for(u=1<<L-1;A&u;)u>>=1;if(0!==u?(A&=u-1,A+=u):A=0,d++,0===--G[L]){if(L===g)break;L=q[J+t[d]]}if(L>H&&(A&k)!==o){for(0===W&&(W=H),N+=a,e=L-W,p=1<<e;e+W<g&&(p-=G[e+W],!(p<=0));)e++,p<<=1;if(y+=1<<e,1===K&&y>852||2===K&&y>592)return 1;o=A&k,E[o]=H<<24|e<<16|N-M}}return 0!==A&&(E[N+A]=L-W<<24|64<<16),j.bits=H,0}},12871:K=>{"use strict";K.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12862:K=>{"use strict";function O(K){let O=K.length;for(;--O>=0;)K[O]=0}const F=256,f=286,r=30,l=15,q=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),J=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),c=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M=new Array(576);O(M);const t=new Array(60);O(t);const j=new Array(512);O(j);const X=new Array(256);O(X);const u=new Array(29);O(u);const T=new Array(r);function o(K,O,F,f,r){this.static_tree=K,this.extra_bits=O,this.extra_base=F,this.elems=f,this.max_length=r,this.has_stree=K&&K.length}let k,N,Z;function L(K,O){this.dyn_tree=K,this.max_code=0,this.stat_desc=O}O(T);const d=K=>K<256?j[K]:j[256+(K>>>7)],a=(K,O)=>{K.pending_buf[K.pending++]=255&O,K.pending_buf[K.pending++]=O>>>8&255},g=(K,O,F)=>{K.bi_valid>16-F?(K.bi_buf|=O<<K.bi_valid&65535,a(K,K.bi_buf),K.bi_buf=O>>16-K.bi_valid,K.bi_valid+=F-16):(K.bi_buf|=O<<K.bi_valid&65535,K.bi_valid+=F)},H=(K,O,F)=>{g(K,F[2*O],F[2*O+1])},e=(K,O)=>{let F=0;do{F|=1&K,K>>>=1,F<<=1}while(--O>0);return F>>>1},W=(K,O,F)=>{const f=new Array(16);let r,q,J=0;for(r=1;r<=l;r++)f[r]=J=J+F[r-1]<<1;for(q=0;q<=O;q++){let O=K[2*q+1];0!==O&&(K[2*q]=e(f[O]++,O))}},p=K=>{let O;for(O=0;O<f;O++)K.dyn_ltree[2*O]=0;for(O=0;O<r;O++)K.dyn_dtree[2*O]=0;for(O=0;O<19;O++)K.bl_tree[2*O]=0;K.dyn_ltree[512]=1,K.opt_len=K.static_len=0,K.last_lit=K.matches=0},y=K=>{K.bi_valid>8?a(K,K.bi_buf):K.bi_valid>0&&(K.pending_buf[K.pending++]=K.bi_buf),K.bi_buf=0,K.bi_valid=0},A=(K,O,F,f)=>{const r=2*O,l=2*F;return K[r]<K[l]||K[r]===K[l]&&f[O]<=f[F]},Q=(K,O,F)=>{const f=K.heap[F];let r=F<<1;for(;r<=K.heap_len&&(r<K.heap_len&&A(O,K.heap[r+1],K.heap[r],K.depth)&&r++,!A(O,f,K.heap[r],K.depth));)K.heap[F]=K.heap[r],F=r,r<<=1;K.heap[F]=f},R=(K,O,f)=>{let r,l,c,E,M=0;if(0!==K.last_lit)do{r=K.pending_buf[K.d_buf+2*M]<<8|K.pending_buf[K.d_buf+2*M+1],l=K.pending_buf[K.l_buf+M],M++,0===r?H(K,l,O):(c=X[l],H(K,c+F+1,O),E=q[c],0!==E&&(l-=u[c],g(K,l,E)),r--,c=d(r),H(K,c,f),E=J[c],0!==E&&(r-=T[c],g(K,r,E)))}while(M<K.last_lit);H(K,256,O)},G=(K,O)=>{const F=O.dyn_tree,f=O.stat_desc.static_tree,r=O.stat_desc.has_stree,q=O.stat_desc.elems;let J,c,E,M=-1;for(K.heap_len=0,K.heap_max=573,J=0;J<q;J++)0!==F[2*J]?(K.heap[++K.heap_len]=M=J,K.depth[J]=0):F[2*J+1]=0;for(;K.heap_len<2;)E=K.heap[++K.heap_len]=M<2?++M:0,F[2*E]=1,K.depth[E]=0,K.opt_len--,r&&(K.static_len-=f[2*E+1]);for(O.max_code=M,J=K.heap_len>>1;J>=1;J--)Q(K,F,J);E=q;do{J=K.heap[1],K.heap[1]=K.heap[K.heap_len--],Q(K,F,1),c=K.heap[1],K.heap[--K.heap_max]=J,K.heap[--K.heap_max]=c,F[2*E]=F[2*J]+F[2*c],K.depth[E]=(K.depth[J]>=K.depth[c]?K.depth[J]:K.depth[c])+1,F[2*J+1]=F[2*c+1]=E,K.heap[1]=E++,Q(K,F,1)}while(K.heap_len>=2);K.heap[--K.heap_max]=K.heap[1],((K,O)=>{const F=O.dyn_tree,f=O.max_code,r=O.stat_desc.static_tree,q=O.stat_desc.has_stree,J=O.stat_desc.extra_bits,c=O.stat_desc.extra_base,E=O.stat_desc.max_length;let M,t,j,X,u,T,o=0;for(X=0;X<=l;X++)K.bl_count[X]=0;for(F[2*K.heap[K.heap_max]+1]=0,M=K.heap_max+1;M<573;M++)t=K.heap[M],X=F[2*F[2*t+1]+1]+1,X>E&&(X=E,o++),F[2*t+1]=X,t>f||(K.bl_count[X]++,u=0,t>=c&&(u=J[t-c]),T=F[2*t],K.opt_len+=T*(X+u),q&&(K.static_len+=T*(r[2*t+1]+u)));if(0!==o){do{for(X=E-1;0===K.bl_count[X];)X--;K.bl_count[X]--,K.bl_count[X+1]+=2,K.bl_count[E]--,o-=2}while(o>0);for(X=E;0!==X;X--)for(t=K.bl_count[X];0!==t;)j=K.heap[--M],j>f||(F[2*j+1]!==X&&(K.opt_len+=(X-F[2*j+1])*F[2*j],F[2*j+1]=X),t--)}})(K,O),W(F,M,K.bl_count)},z=(K,O,F)=>{let f,r,l=-1,q=O[1],J=0,c=7,E=4;for(0===q&&(c=138,E=3),O[2*(F+1)+1]=65535,f=0;f<=F;f++)r=q,q=O[2*(f+1)+1],++J<c&&r===q||(J<E?K.bl_tree[2*r]+=J:0!==r?(r!==l&&K.bl_tree[2*r]++,K.bl_tree[32]++):J<=10?K.bl_tree[34]++:K.bl_tree[36]++,J=0,l=r,0===q?(c=138,E=3):r===q?(c=6,E=3):(c=7,E=4))},m=(K,O,F)=>{let f,r,l=-1,q=O[1],J=0,c=7,E=4;for(0===q&&(c=138,E=3),f=0;f<=F;f++)if(r=q,q=O[2*(f+1)+1],!(++J<c&&r===q)){if(J<E)do{H(K,r,K.bl_tree)}while(0!==--J);else 0!==r?(r!==l&&(H(K,r,K.bl_tree),J--),H(K,16,K.bl_tree),g(K,J-3,2)):J<=10?(H(K,17,K.bl_tree),g(K,J-3,3)):(H(K,18,K.bl_tree),g(K,J-11,7));J=0,l=r,0===q?(c=138,E=3):r===q?(c=6,E=3):(c=7,E=4)}};let x=!1;const V=(K,O,F,f)=>{g(K,0+(f?1:0),3),((K,O,F,f)=>{y(K),f&&(a(K,F),a(K,~F)),K.pending_buf.set(K.window.subarray(O,O+F),K.pending),K.pending+=F})(K,O,F,!0)};K.exports._tr_init=K=>{x||((()=>{let K,O,F,E,L;const d=new Array(16);for(F=0,E=0;E<28;E++)for(u[E]=F,K=0;K<1<<q[E];K++)X[F++]=E;for(X[F-1]=E,L=0,E=0;E<16;E++)for(T[E]=L,K=0;K<1<<J[E];K++)j[L++]=E;for(L>>=7;E<r;E++)for(T[E]=L<<7,K=0;K<1<<J[E]-7;K++)j[256+L++]=E;for(O=0;O<=l;O++)d[O]=0;for(K=0;K<=143;)M[2*K+1]=8,K++,d[8]++;for(;K<=255;)M[2*K+1]=9,K++,d[9]++;for(;K<=279;)M[2*K+1]=7,K++,d[7]++;for(;K<=287;)M[2*K+1]=8,K++,d[8]++;for(W(M,287,d),K=0;K<r;K++)t[2*K+1]=5,t[2*K]=e(K,5);k=new o(M,q,257,f,l),N=new o(t,J,0,r,l),Z=new o(new Array(0),c,0,19,7)})(),x=!0),K.l_desc=new L(K.dyn_ltree,k),K.d_desc=new L(K.dyn_dtree,N),K.bl_desc=new L(K.bl_tree,Z),K.bi_buf=0,K.bi_valid=0,p(K)},K.exports._tr_stored_block=V,K.exports._tr_flush_block=(K,O,f,r)=>{let l,q,J=0;K.level>0?(2===K.strm.data_type&&(K.strm.data_type=(K=>{let O,f=4093624447;for(O=0;O<=31;O++,f>>>=1)if(1&f&&0!==K.dyn_ltree[2*O])return 0;if(0!==K.dyn_ltree[18]||0!==K.dyn_ltree[20]||0!==K.dyn_ltree[26])return 1;for(O=32;O<F;O++)if(0!==K.dyn_ltree[2*O])return 1;return 0})(K)),G(K,K.l_desc),G(K,K.d_desc),J=(K=>{let O;for(z(K,K.dyn_ltree,K.l_desc.max_code),z(K,K.dyn_dtree,K.d_desc.max_code),G(K,K.bl_desc),O=18;O>=3&&0===K.bl_tree[2*E[O]+1];O--);return K.opt_len+=3*(O+1)+5+5+4,O})(K),l=K.opt_len+3+7>>>3,q=K.static_len+3+7>>>3,q<=l&&(l=q)):l=q=f+5,f+4<=l&&-1!==O?V(K,O,f,r):4===K.strategy||q===l?(g(K,2+(r?1:0),3),R(K,M,t)):(g(K,4+(r?1:0),3),((K,O,F,f)=>{let r;for(g(K,O-257,5),g(K,F-1,5),g(K,f-4,4),r=0;r<f;r++)g(K,K.bl_tree[2*E[r]+1],3);m(K,K.dyn_ltree,O-1),m(K,K.dyn_dtree,F-1)})(K,K.l_desc.max_code+1,K.d_desc.max_code+1,J+1),R(K,K.dyn_ltree,K.dyn_dtree)),p(K),r&&y(K)},K.exports._tr_tally=(K,O,f)=>(K.pending_buf[K.d_buf+2*K.last_lit]=O>>>8&255,K.pending_buf[K.d_buf+2*K.last_lit+1]=255&O,K.pending_buf[K.l_buf+K.last_lit]=255&f,K.last_lit++,0===O?K.dyn_ltree[2*f]++:(K.matches++,O--,K.dyn_ltree[2*(X[f]+F+1)]++,K.dyn_dtree[2*d(O)]++),K.last_lit===K.lit_bufsize-1),K.exports._tr_align=K=>{g(K,2,3),H(K,256,M),(K=>{16===K.bi_valid?(a(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):K.bi_valid>=8&&(K.pending_buf[K.pending++]=255&K.bi_buf,K.bi_buf>>=8,K.bi_valid-=8)})(K)}},12892:K=>{"use strict";K.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.MO="",this.state=null,this.data_type=2,this.adler=0}},12543:K=>{function O(K,O,F){for(var f=K.length,r=-1/0,l=1/0,q=0;q<f;q++){var J=(F[0][q]-K[q])/O[q],c=(F[1][q]-K[q])/O[q];if(J>c){var E=J;J=c,c=E}if(c<r||J>l)return 1/0;J>r&&(r=J),c<l&&(l=c)}return r>l?1/0:r}K.exports=function(K,F,f,r){var l=O(F,f,r);if(l===1/0)K=null;else{K=K||[];for(var q=0;q<F.length;q++)K[q]=F[q]+f[q]*l}return K},K.exports.distance=O},13886:(K,O,F)=>{"use strict";F.d(O,{d:()=>q});var f=F(31);const r=f.useLayoutEffect;const l=function(K){var O=(0,f.useRef)(K);return r((function(){O.current=K})),O};var q=function(K){var O=l(K);(0,f.JO)((function(){var K=function(K){var F;if(null!=O.current&&(F=O.current(K)),K.defaultPrevented&&(K.returnValue=""),"string"===typeof F)return K.returnValue=F,F};return window.addEventListener("beforeunload",K),function(){window.removeEventListener("beforeunload",K)}}),[])}},13850:(K,O,F)=>{"use strict";var f=F(13852),r=Array.prototype.concat,l=Array.prototype.slice,q=K.exports=function(K){for(var O=[],F=0,q=K.length;F<q;F++){var J=K[F];f(J)?O=r.call(O,l.call(J)):O.push(J)}return O};q.wrap=function(K){return function(){return K(q(arguments))}}},13852:K=>{K.exports=function(K){return!(!K||"string"===typeof K)&&(K instanceof Array||Array.isArray(K)||K.length>=0&&(K.splice instanceof Function||Object.getOwnPropertyDescriptor(K,K.length-1)&&"String"!==K.constructor.name))}},12813:(K,O,F)=>{var f=F(12818);function r(K){for(var O,F,r=0,l=K.length,q=0;q<K.length;){for(O=K[q],F=0;q<l&&K[q]===O;)++q,++F;r+=f.log2(F)/7|0,r+=f.log2(O>>>0)/7|0,r+=2}return r}O.size=r,O.encode=function(K,O){O||(O=new Uint8Array(r(K)));for(var F,f,l=0,q=O.length,J=0;J<K.length;){for(F=K[J],f=0;J<K.length&&K[J]===F;)++J,++f;for(;l<q&&f>=128;)O[l++]=128+(127&f),f>>>=7;if(l>=q)throw new Error("RLE buffer overflow");for(O[l++]=f,F>>>=0;l<q&&F>=128;)O[l++]=128+(127&F),F>>>=7;if(l>=q)throw new Error("RLE buffer overflow");O[l++]=F}return O},O.decode=function(K,O){for(var F,f,r,l,q=O.length,J=K.length,c=0,E=0;E<J;){for(F=0,f=0;E<J&&K[E]>=128;)F+=(127&K[E++])<<f,f+=7;if(F+=K[E++]<<f,E>=J)throw new Error("RLE buffer underrun");if(c+F>q)throw new Error("Chunk buffer overflow");for(r=0,f=0;E<J&&K[E]>=128;)r+=(127&K[E++])<<f,f+=7;if(E>=J)throw new Error("RLE buffer underrun");for(r+=K[E++]<<f,l=0;l<F;++l)O[c++]=r}return O}},12818:(K,O)=>{"use strict";function F(K){var O=32;return(K&=-K)&&O--,65535&K&&(O-=16),16711935&K&&(O-=8),252645135&K&&(O-=4),858993459&K&&(O-=2),1431655765&K&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(K){return(K>0)-(K<0)},O.abs=function(K){var O=K>>31;return(K^O)-O},O.min=function(K,O){return O^(K^O)&-(K<O)},O.max=function(K,O){return K^(K^O)&-(K<O)},O.isPow2=function(K){return!(K&K-1)&&!!K},O.log2=function(K){var O,F;return O=(K>65535)<<4,O|=F=((K>>>=O)>255)<<3,O|=F=((K>>>=F)>15)<<2,(O|=F=((K>>>=F)>3)<<1)|(K>>>=F)>>1},O.log10=function(K){return K>=1e9?9:K>=1e8?8:K>=1e7?7:K>=1e6?6:K>=1e5?5:K>=1e4?4:K>=1e3?3:K>=100?2:K>=10?1:0},O.popCount=function(K){return 16843009*((K=(858993459&(K-=K>>>1&1431655765))+(K>>>2&858993459))+(K>>>4)&252645135)>>>24},O.countTrailingZeros=F,O.nextPow2=function(K){return K+=0===K,--K,K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)+1},O.prevPow2=function(K){return K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)-(K>>>1)},O.parity=function(K){return K^=K>>>16,K^=K>>>8,K^=K>>>4,27030>>>(K&=15)&1};var f=new Array(256);!function(K){for(var O=0;O<256;++O){var F=O,f=O,r=7;for(F>>>=1;F;F>>>=1)f<<=1,f|=1&F,--r;K[O]=f<<r&255}}(f),O.reverse=function(K){return f[255&K]<<24|f[K>>>8&255]<<16|f[K>>>16&255]<<8|f[K>>>24&255]},O.interleave2=function(K,O){return(K=1431655765&((K=858993459&((K=252645135&((K=16711935&((K&=65535)|K<<8))|K<<4))|K<<2))|K<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(K,O){return(K=65535&((K=16711935&((K=252645135&((K=858993459&((K=K>>>O&1431655765)|K>>>1))|K>>>2))|K>>>4))|K>>>16))<<16>>16},O.interleave3=function(K,O,F){return K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2),(K|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2))<<2},O.deinterleave3=function(K,O){return(K=1023&((K=4278190335&((K=251719695&((K=3272356035&((K=K>>>O&1227133513)|K>>>2))|K>>>4))|K>>>8))|K>>>16))<<22>>22},O.nextCombination=function(K){var O=K|K-1;return O+1|(~O&-~O)-1>>>F(K)+1}},12847:K=>{"use strict";K.exports=function(K,O,F,f){var r=self||window;try{try{var l;try{l=new r.Blob([K])}catch(E){(l=new(r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder)).append(K),l=l.getBlob()}var q=r.URL||r.webkitURL,J=q.createObjectURL(l),c=new r[O](J,F);return q.revokeObjectURL(J),c}catch(E){return new r[O]("data:application/javascript,".concat(encodeURIComponent(K)),F)}}catch(E){if(!f)throw Error("Inline worker is not supported");return new r[O](f,F)}}},12529:(K,O,F)=>{"use strict";function f(K,O,F,f,r){var l={};return Object.keys(f).forEach((function(K){l[K]=f[K]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=F.slice().reverse().reduce((function(F,f){return f(K,O,F)||F}),l),r&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(K,O,l),l=null),l}F.d(O,{c:()=>f})},12522:(K,O,F)=>{"use strict";function f(K,O,F,f){F&&Object.defineProperty(K,O,{enumerable:F.enumerable,configurable:F.configurable,writable:F.writable,value:F.initializer?F.initializer.call(f):void 0})}F.d(O,{d:()=>f})},13880:(K,O,F)=>{"use strict";F.d(O,{d:()=>q,e:()=>t,i:()=>J,m:()=>l,q:()=>c,s:()=>r,t:()=>E,w:()=>M});var f=F(11939);class r{constructor(){this._easingMode=r.EASINGMODE_EASEIN}setEasingMode(K){const O=Math.min(Math.max(K,0),2);this._easingMode=O}getEasingMode(){return this._easingMode}easeInCore(K){throw new Error("You must implement this method")}ease(K){switch(this._easingMode){case r.EASINGMODE_EASEIN:return this.easeInCore(K);case r.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-K)}return K>=.5?.5*(1-this.easeInCore(2*(1-K)))+.5:.5*this.easeInCore(2*K)}}r.EASINGMODE_EASEIN=0,r.EASINGMODE_EASEOUT=1,r.EASINGMODE_EASEINOUT=2;class l extends r{easeInCore(K){return K=Math.max(0,Math.min(1,K)),1-Math.sqrt(1-K*K)}}class q extends r{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=K}easeInCore(K){const O=Math.max(0,this.amplitude);return Math.pow(K,3)-K*O*Math.sin(3.141592653589793*K)}}class J extends r{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=K,this.bounciness=O}easeInCore(K){const O=Math.max(0,this.bounces);let F=this.bounciness;F<=1&&(F=1.001);const f=Math.pow(F,O),r=1-F,l=(1-f)/r+.5*f,q=K*l,J=Math.log(-q*(1-F)+1)/Math.log(F),c=Math.floor(J),E=c+1,M=(1-Math.pow(F,c))/(r*l),t=.5*(M+(1-Math.pow(F,E))/(r*l)),j=K-t,X=t-M;return-Math.pow(1/F,O-c)/(X*X)*(j-X)*(j+X)}}class c extends r{easeInCore(K){return K*K*K}}class E extends r{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=K,this.springiness=O}easeInCore(K){let O;const F=Math.max(0,this.oscillations),f=Math.max(0,this.springiness);return O=0==f?K:(Math.exp(f*K)-1)/(Math.exp(f)-1),O*Math.sin((6.283185307179586*F+1.5707963267948966)*K)}}class M extends r{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=K}easeInCore(K){return this.exponent<=0?K:(Math.exp(this.exponent*K)-1)/(Math.exp(this.exponent)-1)}}class t extends r{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=K,this.y1=O,this.x2=F,this.y2=f}easeInCore(K){return f.b.Interpolate(K,this.x1,this.y1,this.x2,this.y2)}}},13361:(K,O,F)=>{"use strict";F.d(O,{d:()=>q});var f=F(11713),r=F(11729),l=F(12157);class q extends l.c{get _matrix(){return this._compose(),this.Uj}set _matrix(K){(K.updateFlag!==this.Uj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Uj.l(K),this._markAsDirtyAndDecompose())}constructor(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(K,O.HK(),!1),this.name=K,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=O,this.Uj=(null===r||void 0===r?void 0:r.clone())??f.Matrix.Identity(),this._restMatrix=l??this.Uj.clone(),this._bindMatrix=q??this.Uj.clone(),this._index=J,this._absoluteMatrix=new f.Matrix,this._absoluteBindMatrix=new f.Matrix,this._absoluteInverseBindMatrix=new f.Matrix,this._finalMatrix=new f.Matrix,O.bones.push(this),this.setParent(F,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(K){this.setParent(K)}setParent(K){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==K){if(this.parent){const K=this.parent.children.indexOf(this);-1!==K&&this.parent.children.splice(K,1)}this._parentNode=K,this.parent&&this.parent.children.push(this),O&&this._updateAbsoluteBindMatrices(),this.NM()}}getLocalMatrix(){return this._compose(),this.Uj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(K){this._restMatrix.l(K)}setRestPose(K){this.setRestMatrix(K)}getBindPose(){return this.getBindMatrix()}setBindMatrix(K){this.sf(K)}setBindPose(K){this.setBindMatrix(K)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const K=f.TmpVectors.TO[0],O=f.TmpVectors.Quaternion[0],F=f.TmpVectors.TO[1];this.getRestMatrix().decompose(K,O,F),this._linkedTransformNode.position.l(F),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??f.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.l(O),this._linkedTransformNode.TJ.l(K)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(K){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=K,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.BJ}set position(K){this._decompose(),this.BJ.l(K),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(K){this.setRotation(K)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(K){this.setRotationQuaternion(K)}get TJ(){return this.getScale()}set TJ(K){this.setScale(K)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=f.TO.Zero(),this._localRotation=f.Quaternion.Zero(),this.BJ=f.TO.Zero()),this.Uj.decompose(this._localScaling,this._localRotation,this.BJ))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,f.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.BJ,this.Uj)):this._needToCompose=!1)}sf(K){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.l(K),O&&this._updateAbsoluteBindMatrices(),F?this._matrix=K:this.NM()}_updateAbsoluteBindMatrices(K){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(K||(K=this._bindMatrix),this.parent?K.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.l(K),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),O)for(let F=0;F<this.children.length;F++)this.children[F]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}NM(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.NM(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.NM(),this._needToDecompose=!0}_updatePosition(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=this.getLocalMatrix();if(0==O)r?(l.addAtIndex(12,K.x),l.addAtIndex(13,K.y),l.addAtIndex(14,K.z)):l.setTranslationFromFloats(K.x,K.y,K.z);else{let O=null;F&&(O=F.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=q._TmpMats[0],c=q._TmpVecs[0];this.parent?F&&O?(J.l(this.parent.getAbsoluteMatrix()),J.multiplyToRef(O,J)):J.l(this.parent.getAbsoluteMatrix()):f.Matrix.IdentityToRef(J),r&&J.setTranslationFromFloats(0,0,0),J.invert(),f.TO.TransformCoordinatesToRef(K,J,c),r?(l.addAtIndex(12,c.x),l.addAtIndex(13,c.y),l.addAtIndex(14,c.z)):l.setTranslationFromFloats(c.x,c.y,c.z)}this._markAsDirtyAndDecompose()}translate(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,O,F,!0)}setPosition(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,O,F,!1)}setAbsolutePosition(K,O){this.setPosition(K,1,O)}scale(K,O,F){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=this.getLocalMatrix(),J=q._TmpMats[0];f.Matrix.ScalingToRef(K,O,F,J),J.multiplyToRef(l,l),J.invert();for(const f of this.children){const r=f.getLocalMatrix();r.multiplyToRef(J,r),r.multiplyAtIndex(12,K),r.multiplyAtIndex(13,O),r.multiplyAtIndex(14,F),f._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(const f of this.children)f.scale(K,O,F,r)}setScale(K){this._decompose(),this._localScaling.l(K),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(K){this._decompose(),K.l(this._localScaling)}setYawPitchRoll(K,O,F){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4?arguments[4]:void 0;if(0===r){const J=q._TmpQuat;return f.Quaternion.RotationYawPitchRollToRef(K,O,F,J),void this.setRotationQuaternion(J,r,l)}const J=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(J,l))return;const c=q._TmpMats[1];f.Matrix.RotationYawPitchRollToRef(K,O,F,c),J.multiplyToRef(c,c),this._rotateWithMatrix(c,r,l)}rotate(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const l=q._TmpMats[0];l.setTranslationFromFloats(0,0,0),f.Matrix.RotationAxisToRef(K,O,l),this._rotateWithMatrix(l,F,r)}setAxisAngle(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;if(0===F){const l=q._TmpQuat;return f.Quaternion.RotationAxisToRef(K,O,l),void this.setRotationQuaternion(l,F,r)}const l=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(l,r))return;const J=q._TmpMats[1];f.Matrix.RotationAxisToRef(K,O,J),l.multiplyToRef(J,J),this._rotateWithMatrix(J,F,r)}setRotation(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(K.y,K.x,K.z,O,F)}setRotationQuaternion(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;if(0===O)return this._decompose(),this._localRotation.l(K),void this._markAsDirtyAndCompose();const r=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,F))return;const l=q._TmpMats[1];f.Matrix.FromQuaternionToRef(K,l),r.multiplyToRef(l,l),this._rotateWithMatrix(l,O,F)}setRotationMatrix(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;if(0===O){const r=q._TmpQuat;return f.Quaternion.FromRotationMatrixToRef(K,r),void this.setRotationQuaternion(r,O,F)}const r=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(r,F))return;const l=q._TmpMats[1];l.l(K),r.multiplyToRef(K,l),this._rotateWithMatrix(l,O,F)}_rotateWithMatrix(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;const f=this.getLocalMatrix(),r=f.m[12],l=f.m[13],J=f.m[14],c=this.getParent(),E=q._TmpMats[3],M=q._TmpMats[4];c&&1==O?(F?(E.l(F.getWorldMatrix()),c.getAbsoluteMatrix().multiplyToRef(E,E)):E.l(c.getAbsoluteMatrix()),M.l(E),M.invert(),f.multiplyToRef(E,f),f.multiplyToRef(K,f),f.multiplyToRef(M,f)):1==O&&F?(E.l(F.getWorldMatrix()),M.l(E),M.invert(),f.multiplyToRef(E,f),f.multiplyToRef(K,f),f.multiplyToRef(M,f)):f.multiplyToRef(K,f),f.setTranslationFromFloats(r,l,J),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(K,O){const F=q._TmpMats[2];return K.l(this.getAbsoluteMatrix()),O?(K.multiplyToRef(O.getWorldMatrix(),K),f.Matrix.ScalingToRef(O.TJ.x,O.TJ.y,O.TJ.z,F)):f.Matrix.IdentityToRef(F),K.invert(),!isNaN(K.m[0])&&(F.multiplyAtIndex(0,this._scalingDeterminant),K.multiplyToRef(F,K),!0)}Tf(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=f.TO.Zero();return this.getPositionToRef(K,O,F),F}getPositionToRef(){let K=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const K=this.getLocalMatrix();O.x=K.m[12],O.y=K.m[13],O.z=K.m[14]}else{let F=null;K&&(F=K.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let f=q._TmpMats[0];K&&F?(f.l(this.getAbsoluteMatrix()),f.multiplyToRef(F,f)):f=this.getAbsoluteMatrix(),O.x=f.m[12],O.y=f.m[13],O.z=f.m[14]}}getAbsolutePosition(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=f.TO.Zero();return this.getPositionToRef(1,K,O),O}getAbsolutePositionToRef(K,O){this.getPositionToRef(1,K,O)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Uj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.l(this.Uj);const K=this._skeleton.getPoseMatrix();K&&this._absoluteMatrix.multiplyToRef(K,this._absoluteMatrix)}const K=this.children,O=K.length;for(let F=0;F<O;F++)K[F].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}bc(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=f.TO.Zero();return this.getDirectionToRef(K,O,F),F}getDirectionToRef(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,r=null;O&&(r=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=q._TmpMats[0];l.l(this.getAbsoluteMatrix()),O&&r&&l.multiplyToRef(r,l),f.TO.TransformNormalToRef(K,l,F),F.normalize()}getRotation(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=f.TO.Zero();return this.getRotationToRef(K,O,F),F}getRotationToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0;const f=q._TmpQuat;this.getRotationQuaternionToRef(K,O,f),f.toEulerAnglesToRef(F)}getRotationQuaternion(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=f.Quaternion.Identity();return this.getRotationQuaternionToRef(K,O,F),F}getRotationQuaternionToRef(){let K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),O.l(this._localRotation);else{const F=q._TmpMats[0],f=this.getAbsoluteMatrix();K?f.multiplyToRef(K.getWorldMatrix(),F):F.l(f),F.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyAtIndex(1,this._scalingDeterminant),F.multiplyAtIndex(2,this._scalingDeterminant),F.decompose(void 0,O,void 0)}}getRotationMatrix(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1?arguments[1]:void 0;const F=f.Matrix.Identity();return this.getRotationMatrixToRef(K,O,F),F}getRotationMatrixToRef(){let K=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(O);else{const F=q._TmpMats[0],f=this.getAbsoluteMatrix();K?f.multiplyToRef(K.getWorldMatrix(),F):F.l(f),F.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyAtIndex(1,this._scalingDeterminant),F.multiplyAtIndex(2,this._scalingDeterminant),F.getRotationMatrixToRef(O)}}getAbsolutePositionFromLocal(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=f.TO.Zero();return this.getAbsolutePositionFromLocalToRef(K,O,F),F}getAbsolutePositionFromLocalToRef(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,r=null;O&&(r=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=q._TmpMats[0];l.l(this.getAbsoluteMatrix()),O&&r&&l.multiplyToRef(r,l),f.TO.TransformCoordinatesToRef(K,l,F)}getLocalPositionFromAbsolute(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=f.TO.Zero();return this.getLocalPositionFromAbsoluteToRef(K,O,F),F}getLocalPositionFromAbsoluteToRef(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,r=null;O&&(r=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const l=q._TmpMats[0];l.l(this.getAbsoluteMatrix()),O&&r&&l.multiplyToRef(r,l),l.invert(),f.TO.TransformCoordinatesToRef(K,l,F)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const K=this._skeleton.bones.indexOf(this);if(-1!==K&&this._skeleton.bones.splice(K,1),this._parentNode&&this._parentNode.children){const K=this._parentNode.children,O=K.indexOf(this);-1!==O&&K.splice(O,1)}super.dispose()}}q._TmpVecs=(0,r.c)(2,f.TO.Zero),q._TmpQuat=f.Quaternion.Identity(),q._TmpMats=(0,r.c)(5,f.Matrix.Identity)},13877:(K,O,F)=>{"use strict";F.d(O,{c:()=>G});var f=F(11693),r=F(11698),l=F(11523),q=F(11713),J=F(11734),c=F(12157),E=F(12193),M=F(12006),t=F(11541),j=F(11721);class X{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(K){this._idleRotationSpeed=K}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(K){this._idleRotationWaitTime=K}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(K){this._idleRotationSpinupTime=K}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(K){this._attachedCamera=K;const O=this._attachedCamera.HK();this._onPrePointerObservableObserver=O.onPrePointerObservable.add((K=>{K.type!==M.e.POINTERDOWN?K.type===M.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const K=t.e.Now;let O=0;null!=this._lastFrameTime&&(O=K-this._lastFrameTime),this._lastFrameTime=K,this._applyUserInteraction();const F=K-this._lastInteractionTime-this._idleRotationWaitTime,f=Math.max(Math.min(F/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*f,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(O/1e3))}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.HK();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(K){this._lastInteractionTime=K??t.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<j.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let K=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(K=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?K:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=t.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var u=F(13880),T=F(12266);class o{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(K){if(this._autoTransitionRange===K)return;this._autoTransitionRange=K;const O=this._attachedCamera;O&&(K?this._onMeshTargetChangedObserver=O.onMeshTargetChangedObservable.add((K=>{if(K&&(K.Pf(!0),K.getBoundingInfo)){const O=K.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*O,this.upperRadiusTransitionRange=.05*O}})):this._onMeshTargetChangedObserver&&O.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(K){this._attachedCamera=K,this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(K){return!!this._attachedCamera&&(this._attachedCamera.radius===K&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(K){if(!this._attachedCamera)return;this._radiusBounceTransition||(o.EasingFunction.setEasingMode(o.EasingMode),this._radiusBounceTransition=T.d.CreateAnimation("radius",T.d.ANIMATIONTYPE_FLOAT,60,o.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const O=T.d.TransitionTo("radius",this._attachedCamera.radius+K,this._attachedCamera,this._attachedCamera.HK(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));O&&this._animatables.push(O)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}o.EasingFunction=new u.d(.3),o.EasingMode=u.s.EASINGMODE_EASEOUT;class k{constructor(){this.onTargetFramingAnimationEndObservable=new l.c,this._mode=k.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(K){this._mode=K}get mode(){return this._mode}set radiusScale(K){this._radiusScale=K}get radiusScale(){return this._radiusScale}set positionScale(K){this._positionScale=K}get positionScale(){return this._positionScale}set defaultElevation(K){this._defaultElevation=K}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(K){this._elevationReturnTime=K}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(K){this._elevationReturnWaitTime=K}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(K){this._framingTime=K}get framingTime(){return this._framingTime}init(){}attach(K){this._attachedCamera=K;const O=this._attachedCamera.HK();k.EasingFunction.setEasingMode(k.EasingMode),this._onPrePointerObservableObserver=O.onPrePointerObservable.add((K=>{K.type!==M.e.POINTERDOWN?K.type===M.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=K.onMeshTargetChangedObservable.add((K=>{K&&K.getBoundingInfo&&this.zoomOnMesh(K,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.HK();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.Pf(!0);const f=K.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(f.minimumWorld,f.maximumWorld,O,F)}zoomOnMeshHierarchy(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.Pf(!0);const f=K.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(f.min,f.max,O,F)}zoomOnMeshesHierarchy(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new q.TO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new q.TO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let l=0;l<K.length;l++){const O=K[l].getHierarchyBoundingVectors(!0);q.TO.CheckExtends(O.min,f,r),q.TO.CheckExtends(O.max,f,r)}this.zoomOnBoundingInfo(f,r,O,F)}zoomOnBoundingInfo(K,O){let F,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const l=K.y,J=l+(O.y-l)*this._positionScale,c=O.oO(K).scale(.5);if(!isFinite(J))return!1;if(f)F=new q.TO(0,J,0);else{const O=K.add(c);F=new q.TO(O.x,J,O.z)}this._vectorTransition||(this._vectorTransition=T.d.CreateAnimation("target",T.d.ANIMATIONTYPE_VECTOR3,60,k.EasingFunction)),this._betaIsAnimating=!0;let E=T.d.TransitionTo("target",F,this._attachedCamera,this._attachedCamera.HK(),60,this._vectorTransition,this._framingTime);E&&this._animatables.push(E);let M=0;if(this._mode===k.FitFrustumSidesMode){const F=this._calculateLowerRadiusFromModelBoundingSphere(K,O);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=c.length()+this._attachedCamera.if),M=F}else this._mode===k.IgnoreBoundsSizeMode&&(M=this._calculateLowerRadiusFromModelBoundingSphere(K,O),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.if));if(this.autoCorrectCameraLimitsAndSensibility){const F=O.oO(K).length();this._attachedCamera.panningSensibility=5e3/F,this._attachedCamera.wheelPrecision=100/M}return this._radiusTransition||(this._radiusTransition=T.d.CreateAnimation("radius",T.d.ANIMATIONTYPE_FLOAT,60,k.EasingFunction)),E=T.d.TransitionTo("radius",M,this._attachedCamera,this._attachedCamera.HK(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),r&&r(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),E&&this._animatables.push(E),!0}_calculateLowerRadiusFromModelBoundingSphere(K,O){const F=this._attachedCamera;if(!F)return 0;let f=F._calculateLowerRadiusFromModelBoundingSphere(K,O,this._radiusScale);return F.lowerRadiusLimit&&this._mode===k.IgnoreBoundsSizeMode&&(f=f<F.lowerRadiusLimit?F.lowerRadiusLimit:f),F.upperRadiusLimit&&(f=f>F.upperRadiusLimit?F.upperRadiusLimit:f),f}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const K=t.e.Now-this._lastInteractionTime,O=.5*Math.PI-this._defaultElevation,F=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>F&&K>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=T.d.CreateAnimation("beta",T.d.ANIMATIONTYPE_FLOAT,60,k.EasingFunction));const K=T.d.TransitionTo("beta",O,this._attachedCamera,this._attachedCamera.HK(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));K&&this._animatables.push(K)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=t.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}k.EasingFunction=new u.w,k.EasingMode=u.s.EASINGMODE_EASEINOUT,k.IgnoreBoundsSizeMode=0,k.FitFrustumSidesMode=1;var N=F(12201),Z=F(12232),L=F(13356),d=F(11517);class a{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(K){K=d.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),F=O.getInputElement();let f=0,r=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=l=>{var q,J;const c=l.event,E="touch"===c.pointerType;if(l.type!==M.e.POINTERMOVE&&-1===this.buttons.indexOf(c.button))return;const t=c.target;if(this._altKey=c.altKey,this._ctrlKey=c.ctrlKey,this._metaKey=c.metaKey,this._shiftKey=c.shiftKey,this._buttonsPressed=c.buttons,O.isPointerLock){const K=c.movementX,O=c.movementY;this.onTouch(null,K,O),this._pointA=null,this._pointB=null}else{if(l.type!==M.e.POINTERDOWN&&l.type!==M.e.POINTERDOUBLETAP&&E&&(null===(q=this._pointA)||void 0===q?void 0:q.pointerId)!==c.pointerId&&(null===(J=this._pointB)||void 0===J?void 0:J.pointerId)!==c.pointerId)return;if(l.type!==M.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!E)if(l.type===M.e.POINTERDOUBLETAP)this.onDoubleTap(c.pointerType);else if(l.type!==M.e.POINTERUP||this._currentMousePointerIdDown!==c.pointerId&&!E){if(l.type===M.e.POINTERMOVE)if(K||c.preventDefault(),this._pointA&&null===this._pointB){const K=c.clientX-this._pointA.x,O=c.clientY-this._pointA.y;this._pointA.x=c.clientX,this._pointA.y=c.clientY,this.onTouch(this._pointA,K,O)}else if(this._pointA&&this._pointB){const K=this._pointA.pointerId===c.pointerId?this._pointA:this._pointB;K.x=c.clientX,K.y=c.clientY;const O=this._pointA.x-this._pointB.x,F=this._pointA.y-this._pointB.y,q=O*O+F*F,J={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:c.pointerId,type:l.type};this.onMultiTouch(this._pointA,this._pointB,f,q,r,J),r=J,f=q}}else{try{null===t||void 0===t||t.releasePointerCapture(c.pointerId)}catch(j){}E||(this._pointB=null),O._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==c.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==c.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==f||r)&&(this.onMultiTouch(this._pointA,this._pointB,f,0,r,null),f=0,r=null),this._currentMousePointerIdDown=-1,this.onButtonUp(c),K||c.preventDefault()}else{try{null===t||void 0===t||t.setPointerCapture(c.pointerId)}catch(j){}if(null===this._pointA)this._pointA={x:c.clientX,y:c.clientY,pointerId:c.pointerId,type:c.pointerType};else{if(null!==this._pointB)return;this._pointB={x:c.clientX,y:c.clientY,pointerId:c.pointerId,type:c.pointerType}}-1!==this._currentMousePointerIdDown||E||(this._currentMousePointerIdDown=c.pointerId),this.onButtonDown(c),K||(c.preventDefault(),F&&F.focus())}}},this._observer=this.camera.HK()._inputManager._addCameraPointerObserver(this._pointerInput,M.e.POINTERDOWN|M.e.POINTERUP|M.e.POINTERMOVE|M.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,f=0,r=null,this.onLostFocus()},this._contextMenuBind=K=>this.onContextMenu(K),F&&F.addEventListener("contextmenu",this._contextMenuBind,!1);const l=this.camera.HK().getEngine().getHostWindow();l&&d.Tools.RegisterTopRootEvents(l,[{name:"blur",handler:this._onLostFocus}])}cj(){if(this._onLostFocus){const K=this.camera.HK().getEngine().getHostWindow();K&&d.Tools.UnregisterTopRootEvents(K,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.HK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const K=this.camera.HK().getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(K){}onTouch(K,O,F){}onMultiTouch(K,O,F,f,r,l){}onContextMenu(K){K.preventDefault()}onButtonDown(K){}onButtonUp(K){}onLostFocus(){}}(0,f.c)([(0,r.N)()],a.prototype,"buttons",void 0);class g extends a{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(K,O){if(0!==this.panningSensibility&&K&&O){const F=O.x-K.x,f=O.y-K.y;this.camera.inertialPanningX+=-F/this.panningSensibility,this.camera.inertialPanningY+=f/this.panningSensibility}}_computePinchZoom(K,O){const F=this.camera.radius||g.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=F*Math.sqrt(K)/Math.sqrt(O):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(O-K)*F*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(O-K)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(K,O,F){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-O/this.panningSensibility,this.camera.inertialPanningY+=F/this.panningSensibility):(this.camera.inertialAlphaOffset-=O/this.angularSensibilityX,this.camera.inertialBetaOffset-=F/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(K,O,F,f,r,l){0===F&&null===r||0===f&&null===l||(this.multiTouchPanAndZoom?(this._computePinchZoom(F,f),this._computeMultiTouchPanning(r,l)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(f)-Math.sqrt(F))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(F,f),this._isPinching=!0):this._computeMultiTouchPanning(r,l)):this.multiTouchPanning?this._computeMultiTouchPanning(r,l):this.pinchZoom&&this._computePinchZoom(F,f))}onButtonDown(K){this._isPanClick=K.button===this.camera._panningMouseButton}onButtonUp(K){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}g.MinimumRadiusForPinch=.001,(0,f.c)([(0,r.N)()],g.prototype,"buttons",void 0),(0,f.c)([(0,r.N)()],g.prototype,"angularSensibilityX",void 0),(0,f.c)([(0,r.N)()],g.prototype,"angularSensibilityY",void 0),(0,f.c)([(0,r.N)()],g.prototype,"pinchPrecision",void 0),(0,f.c)([(0,r.N)()],g.prototype,"pinchDeltaPercentage",void 0),(0,f.c)([(0,r.N)()],g.prototype,"useNaturalPinchZoom",void 0),(0,f.c)([(0,r.N)()],g.prototype,"pinchZoom",void 0),(0,f.c)([(0,r.N)()],g.prototype,"panningSensibility",void 0),(0,f.c)([(0,r.N)()],g.prototype,"multiTouchPanning",void 0),(0,f.c)([(0,r.N)()],g.prototype,"multiTouchPanAndZoom",void 0),L.d.ArcRotateCameraPointersInput=g;var H=F(12008);class e{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(K){K=d.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.HK(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const F=O.event;if(!F.metaKey)if(O.type===H.b.KEYDOWN){if(this._ctrlPressed=F.ctrlKey,this._altPressed=F.altKey,-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysReset.indexOf(F.keyCode)){-1===this._keys.indexOf(F.keyCode)&&this._keys.push(F.keyCode),F.preventDefault&&(K||F.preventDefault())}}else if(-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysReset.indexOf(F.keyCode)){const O=this._keys.indexOf(F.keyCode);O>=0&&this._keys.splice(O,1),F.preventDefault&&(K||F.preventDefault())}})))}cj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let O=0;O<this._keys.length;O++){const F=this._keys[O];-1!==this.keysLeft.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX-=1/this.panningSensibility:K.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset+=1/this.zoomingSensibility:K.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX+=1/this.panningSensibility:K.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset-=1/this.zoomingSensibility:K.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(F)&&K.useInputToRestoreState&&K.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,f.c)([(0,r.N)()],e.prototype,"keysUp",void 0),(0,f.c)([(0,r.N)()],e.prototype,"keysDown",void 0),(0,f.c)([(0,r.N)()],e.prototype,"keysLeft",void 0),(0,f.c)([(0,r.N)()],e.prototype,"keysRight",void 0),(0,f.c)([(0,r.N)()],e.prototype,"keysReset",void 0),(0,f.c)([(0,r.N)()],e.prototype,"panningSensibility",void 0),(0,f.c)([(0,r.N)()],e.prototype,"zoomingSensibility",void 0),(0,f.c)([(0,r.N)()],e.prototype,"useAltToZoom",void 0),(0,f.c)([(0,r.N)()],e.prototype,"angularSpeed",void 0),L.d.ArcRotateCameraKeyboardMoveInput=e;var W=F(11773),p=F(12017);class y{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new q.TO(0,0,0),this._globalOffset=new q.TO(0,0,0),this._inertialPanning=q.TO.Zero()}_computeDeltaFromMouseWheelLegacyEvent(K,O){let F=0;const f=.01*K*this.wheelDeltaPercentage*O;return F=K>0?f/(1+this.wheelDeltaPercentage):f*(1+this.wheelDeltaPercentage),F}attachControl(K){K=d.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==M.e.POINTERWHEEL)return;const F=O.event;let f=0;const r=F.deltaMode===p.d.DOM_DELTA_LINE?40:1,l=-F.deltaY*r;if(this.customComputeDeltaFromMouseWheel)f=this.customComputeDeltaFromMouseWheel(l,this,F);else if(this.wheelDeltaPercentage){if(f=this._computeDeltaFromMouseWheelLegacyEvent(l,this.camera.radius),f>0){let K=this.camera.radius,O=this.camera.inertialRadiusOffset+f;for(let F=0;F<20&&!(K<=O)&&!(Math.abs(O*this.camera.inertia)<.001);F++)K-=O,O*=this.camera.inertia;K=(0,J.Clamp)(K,0,Number.MAX_VALUE),f=this._computeDeltaFromMouseWheelLegacyEvent(l,K)}}else f=l/(40*this.wheelPrecision);f&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(f)):this.camera.inertialRadiusOffset+=f),F.preventDefault&&(K||F.preventDefault())},this._observer=this.camera.HK()._inputManager._addCameraPointerObserver(this._wheel,M.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.oJ(0)}cj(){this._observer&&(this.camera.HK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const K=this.camera;0+K.inertialAlphaOffset+K.inertialBetaOffset+K.inertialRadiusOffset&&(this._updateHitPlane(),K.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(K.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const K=this.camera,O=K.target.oO(K.position);this._hitPlane=W.b.FromPositionAndNormal(K.target,O)}_getPosition(){const K=this.camera,O=K.HK(),F=O.createPickingRay(O.pointerX,O.pointerY,q.Matrix.Identity(),K,!1);0===K.targetScreenOffset.x&&0===K.targetScreenOffset.y||(this._viewOffset.set(K.targetScreenOffset.x,K.targetScreenOffset.y,0),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),this._globalOffset=q.TO.TransformNormal(this._viewOffset,K._cameraTransformMatrix),F.origin.addInPlace(this._globalOffset));let f=0;return this._hitPlane&&(f=F.intersectsPlane(this._hitPlane)??0),F.origin.addInPlace(F.direction.scaleInPlace(f))}_zoomToMouse(K){const O=this.camera,F=1-O.inertia;if(O.lowerRadiusLimit){const f=O.lowerRadiusLimit??0;O.radius-(O.inertialRadiusOffset+K)/F<f&&(K=(O.radius-f)*F-O.inertialRadiusOffset)}if(O.upperRadiusLimit){const f=O.upperRadiusLimit??0;O.radius-(O.inertialRadiusOffset+K)/F>f&&(K=(O.radius-f)*F-O.inertialRadiusOffset)}const f=K/F/O.radius,r=this._getPosition(),l=q.TmpVectors.TO[6];r.subtractToRef(O.target,l),l.scaleInPlace(f),l.scaleInPlace(F),this._inertialPanning.addInPlace(l),O.inertialRadiusOffset+=K}_zeroIfClose(K){Math.abs(K.x)<j.e&&(K.x=0),Math.abs(K.y)<j.e&&(K.y=0),Math.abs(K.z)<j.e&&(K.z=0)}}(0,f.c)([(0,r.N)()],y.prototype,"wheelPrecision",void 0),(0,f.c)([(0,r.N)()],y.prototype,"zoomToMouseLocation",void 0),(0,f.c)([(0,r.N)()],y.prototype,"wheelDeltaPercentage",void 0),L.d.ArcRotateCameraMouseWheelInput=y;class A extends L.e{constructor(K){super(K)}addMouseWheel(){return this.add(new y),this}addPointers(){return this.add(new g),this}addKeyboard(){return this.add(new e),this}}var Q=F(11661);function R(K,O){return isNaN(K)?O:K}c.c.AddNodeConstructor("ArcRotateCamera",((K,O)=>()=>new G(K,0,0,1,q.TO.Zero(),O)));class G extends Z.d{get target(){return this._target}set target(K){this.setTarget(K)}get targetHost(){return this._targetHost}set targetHost(K){K&&this.setTarget(K)}getTarget(){return this.target}get position(){return this._position}set position(K){this.setPosition(K)}set upVector(K){this._upToYMatrix||(this._yToUpMatrix=new q.Matrix,this._upToYMatrix=new q.Matrix,this._upVector=q.TO.Zero()),K.normalize(),this._upVector.l(K),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){q.Matrix.RotationAlignToRef(q.TO.UpReadOnly,this._upVector,this._yToUpMatrix),q.Matrix.RotationAlignToRef(this._upVector,q.TO.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityX:0}set angularSensibilityX(K){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityX=K)}get angularSensibilityY(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityY:0}set angularSensibilityY(K){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityY=K)}get pinchPrecision(){const K=this.inputs.attached.pointers;return K?K.pinchPrecision:0}set pinchPrecision(K){const O=this.inputs.attached.pointers;O&&(O.pinchPrecision=K)}get pinchDeltaPercentage(){const K=this.inputs.attached.pointers;return K?K.pinchDeltaPercentage:0}set pinchDeltaPercentage(K){const O=this.inputs.attached.pointers;O&&(O.pinchDeltaPercentage=K)}get useNaturalPinchZoom(){const K=this.inputs.attached.pointers;return!!K&&K.useNaturalPinchZoom}set useNaturalPinchZoom(K){const O=this.inputs.attached.pointers;O&&(O.useNaturalPinchZoom=K)}get panningSensibility(){const K=this.inputs.attached.pointers;return K?K.panningSensibility:0}set panningSensibility(K){const O=this.inputs.attached.pointers;O&&(O.panningSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const O=this.inputs.attached.keyboard;O&&(O.keysUp=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const O=this.inputs.attached.keyboard;O&&(O.keysDown=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const O=this.inputs.attached.keyboard;O&&(O.keysRight=K)}get wheelPrecision(){const K=this.inputs.attached.mousewheel;return K?K.wheelPrecision:0}set wheelPrecision(K){const O=this.inputs.attached.mousewheel;O&&(O.wheelPrecision=K)}get zoomToMouseLocation(){const K=this.inputs.attached.mousewheel;return!!K&&K.zoomToMouseLocation}set zoomToMouseLocation(K){const O=this.inputs.attached.mousewheel;O&&(O.zoomToMouseLocation=K)}get wheelDeltaPercentage(){const K=this.inputs.attached.mousewheel;return K?K.wheelDeltaPercentage:0}set wheelDeltaPercentage(K){const O=this.inputs.attached.mousewheel;O&&(O.wheelDeltaPercentage=K)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(K){K!==this.useBouncingBehavior&&(K?(this._bouncingBehavior=new o,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(K){K!==this.useFramingBehavior&&(K?(this._framingBehavior=new k,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(K){K!==this.useAutoRotationBehavior&&(K?(this._autoRotationBehavior=new X,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(K,O,F,f,r,J){var c;let E=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(K,q.TO.Zero(),J,E),c=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=q.TO.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=q.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new q.Matrix,this.panningAxis=new q.TO(1,1,0),this._transformedDirection=new q.TO,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new l.c,this.checkCollisions=!1,this.collisionRadius=new q.TO(.5,.5,.5),this._previousPosition=q.TO.Zero(),this._collisionVelocity=q.TO.Zero(),this._newPosition=q.TO.Zero(),this._computationVector=q.TO.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new q.TO(NaN,NaN,NaN),this._goalTargetScreenOffset=new q.Vector2(NaN,NaN),this._onCollisionPositionChange=function(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;F?(c.setPosition(O),c.DX&&c.DX(F)):c._previousPosition.l(c._position);const f=Math.cos(c.alpha),r=Math.sin(c.alpha),l=Math.cos(c.beta);let q=Math.sin(c.beta);0===q&&(q=1e-4);const J=c._getTargetPosition();c._computationVector.eq(c.radius*f*q,c.radius*l,c.radius*r*q),J.addToRef(c._computationVector,c._newPosition),c._position.l(c._newPosition);let E=c.upVector;c.allowUpsideDown&&c.beta<0&&(E=E.clone(),E=E.negate()),c._computeViewMatrix(c._position,J,E),c._viewMatrix.addAtIndex(12,c.targetScreenOffset.x),c._viewMatrix.addAtIndex(13,c.targetScreenOffset.y),c._collisionTriggered=!1},this._target=q.TO.Zero(),r&&this.setTarget(r),this.alpha=O,this.beta=F,this.radius=f,this.getViewMatrix(),this.inputs=new A(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new q.TO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=q.Vector2.Zero()}_updateCache(K){K||super._updateCache(),this._cache._target.l(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.l(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const K=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?K.addToRef(this._targetBoundingCenter,this._target):this._target.l(K)}const K=this._getLockedTargetPosition();return K||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>j.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,l=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=l?this._currentInterpolationFactor=l:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=R(K,this._goalAlpha),this._goalBeta=R(O,this._goalBeta),this._goalRadius=R(F,this._goalRadius),this._goalTarget.set(R(f.x,this._goalTarget.x),R(f.y,this._goalTarget.y),R(f.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(R(r.x,this._goalTargetScreenOffset.x),R(r.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,J.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,J.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,J.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,J.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(K,O){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const r=arguments;O=d.Tools.BackCompatCameraNoPreventDefault(r),this._useCtrlForPanning=F,this._panningMouseButton=f,"boolean"===typeof r[0]&&(r.length>1&&(this._useCtrlForPanning=r[1]),r.length>2&&(this._panningMouseButton=r[2])),this.inputs.attachElement(O),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}cj(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let K=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){K=!0;const O=this.invertRotation?-1:1,F=this._calculateHandednessMultiplier();let f=this.inertialAlphaOffset*F;this.beta<0&&(f*=-1),this.alpha+=f*O,this.beta+=this.inertialBetaOffset*O,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<j.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<j.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*j.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){K=!0;const O=new q.TO(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),O.multiplyInPlace(this.panningAxis),q.TO.TransformNormalToRef(O,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const K=this.upVector,O=q.TO.CrossToRef(this._transformedDirection,K,this._transformedDirection);q.TO.CrossToRef(K,O,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);q.TO.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.l(this._transformedDirection)}else{if(this.parent){const K=q.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(K),K.transposeToRef(K),q.TO.TransformCoordinatesToRef(this._transformedDirection,K,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*j.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*j.e&&(this.inertialPanningY=0)}if(K)this.stopInterpolation();else if(this._isInterpolating){let K=!1;const O=this._scene.getEngine().getDeltaTime()/1e3,F=1-Math.pow(2,-O/this._currentInterpolationFactor),f=R(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const O=q.TmpVectors.TO[0].set(R(this._goalTarget.x,this._target.x),R(this._goalTarget.y,this._target.y),R(this._goalTarget.z,this._target.z));q.TO.LerpToRef(this.target,O,F,this._target),10*q.TO.Distance(this.target,O)/f<j.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.l(O),this.setTarget(this.target,!1,!0,!0)):K=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const O=q.Quaternion.RotationAlphaBetaGammaToRef(R(this._goalAlpha,this.alpha),R(this._goalBeta,this.beta),0,q.TmpVectors.Quaternion[0]),f=q.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,q.TmpVectors.Quaternion[1]),r=q.Quaternion.SlerpToRef(f,O,F,q.TmpVectors.Quaternion[2]);r.normalize();const l=r.toAlphaBetaGammaToRef(q.TmpVectors.TO[0]);if(this.alpha=l.x,this.beta=l.y,r.isApprox(O,j.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const K=O.toAlphaBetaGammaToRef(q.TmpVectors.TO[0]);this.alpha=K.x,this.beta=K.y}else K=!0}if(isNaN(this._goalRadius)||(this.radius+=(f-this.radius)*F,Math.abs(f/this.radius-1)<j.e?(this._goalRadius=NaN,this.radius=f):K=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const O=q.TmpVectors.Vector2[0].set(R(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),R(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));q.Vector2.LerpToRef(this.targetScreenOffset,O,F,this.targetScreenOffset),q.Vector2.Distance(this.targetScreenOffset,O)<j.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.l(O)):K=!0}this._isInterpolating=K}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||q.TO.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const K=this.alpha;var O,F;this.alpha=function(K){let O=Math.PI/2;return 0===K.x&&0===K.z||(O=Math.acos(K.x/Math.sqrt(Math.pow(K.x,2)+Math.pow(K.z,2)))),K.z<0&&(O=2*Math.PI-O),O}(this._computationVector),this.beta=(O=this._computationVector.y,F=this.radius,Math.acos(O/F));const f=Math.round((K-this.alpha)/(2*Math.PI));this.alpha+=2*f*Math.PI,this._checkLimits()}setPosition(K){this._position.equals(K)||(this._position.l(K),this.rebuildAnglesAndRadius())}setTarget(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(f=this.overrideCloneAlphaBetaRadius??f,K.Pf)O&&K.getBoundingInfo?this._targetBoundingCenter=K.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,K.Pf(),this._targetHost=K,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const O=K,f=this._getTargetPosition();if(f&&!F&&f.equals(O))return;this._targetHost=null,this._target=O,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}f||this.rebuildAnglesAndRadius()}_getViewMatrix(){const K=Math.cos(this.alpha),O=Math.sin(this.alpha),F=Math.cos(this.beta);let f=Math.sin(this.beta);0===f&&(f=1e-4),0===this.radius&&(this.radius=1e-4);const r=this._getTargetPosition();if(this._computationVector.eq(this.radius*K*f,this.radius*F,this.radius*O*f),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||q.TO.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),r.addToRef(this._computationVector,this._newPosition),this.HK().collisionsEnabled&&this.checkCollisions){const K=this.HK().collisionCoordinator;this._collider||(this._collider=K.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,K.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.l(this._newPosition);let K=this.upVector;this.allowUpsideDown&&f<0&&(K=K.negate()),this._computeViewMatrix(this._position,r,K),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.l(r),this._viewMatrix}zoomOn(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K=K||this.HK().meshes;const F=E.b.MinMax(K);let f=this._calculateLowerRadiusFromModelBoundingSphere(F.min,F.max);if(f=Math.max(Math.min(f,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=f*this.zoomOnFactor,this.mode===N.e.ORTHOGRAPHIC_CAMERA){const K=this.HK().getEngine().getAspectRatio(this),O=f*this.zoomOnFactor/2;this.orthoLeft=-O*K,this.orthoRight=O*K,this.orthoBottom=-O,this.orthoTop=O}this.focusOn({min:F.min,max:F.max,distance:f},O)}focusOn(K){let O,F,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===K.min){const f=K||this.HK().meshes;O=E.b.MinMax(f),F=q.TO.Distance(O.min,O.max)}else{O=K,F=K.distance}this._target=E.b.Center(O),f||(this.maxZ=2*F)}createRigCamera(K,O){let F=0;switch(this.cameraRigMode){case N.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case N.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case N.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case N.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case N.e.RIG_MODE_VR:F=this._cameraRigParams.stereoHalfAngle*(0===O?1:-1);break;case N.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:F=this._cameraRigParams.stereoHalfAngle*(0===O?-1:1)}const f=new G(K,this.alpha+F,this.beta,this.radius,this._target,this.HK());return f._cameraRigParams={},f.isRigCamera=!0,f.rigParent=this,f.upVector=this.upVector,f.mode=this.mode,f.orthoLeft=this.orthoLeft,f.orthoRight=this.orthoRight,f.orthoBottom=this.orthoBottom,f.orthoTop=this.orthoTop,f}_updateRigCameras(){const K=this._rigCameras[0],O=this._rigCameras[1];switch(K.beta=O.beta=this.beta,this.cameraRigMode){case N.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case N.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case N.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case N.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case N.e.RIG_MODE_VR:K.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case N.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:K.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const f=q.TO.Distance(K,O),r=this.HK().getEngine().getAspectRatio(this),l=Math.tan(this.fov/2),J=l*r,c=.5*f*F,E=c*Math.sqrt(1+1/(J*J)),M=c*Math.sqrt(1+1/(l*l));return Math.max(E,M)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,f.c)([(0,r.N)()],G.prototype,"alpha",void 0),(0,f.c)([(0,r.N)()],G.prototype,"beta",void 0),(0,f.c)([(0,r.N)()],G.prototype,"radius",void 0),(0,f.c)([(0,r.N)()],G.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,f.c)([(0,r.K)("target")],G.prototype,"_target",void 0),(0,f.c)([(0,r.B)("targetHost")],G.prototype,"_targetHost",void 0),(0,f.c)([(0,r.N)()],G.prototype,"inertialAlphaOffset",void 0),(0,f.c)([(0,r.N)()],G.prototype,"inertialBetaOffset",void 0),(0,f.c)([(0,r.N)()],G.prototype,"inertialRadiusOffset",void 0),(0,f.c)([(0,r.N)()],G.prototype,"lowerAlphaLimit",void 0),(0,f.c)([(0,r.N)()],G.prototype,"upperAlphaLimit",void 0),(0,f.c)([(0,r.N)()],G.prototype,"lowerBetaLimit",void 0),(0,f.c)([(0,r.N)()],G.prototype,"upperBetaLimit",void 0),(0,f.c)([(0,r.N)()],G.prototype,"lowerRadiusLimit",void 0),(0,f.c)([(0,r.N)()],G.prototype,"upperRadiusLimit",void 0),(0,f.c)([(0,r.N)()],G.prototype,"lowerTargetYLimit",void 0),(0,f.c)([(0,r.N)()],G.prototype,"inertialPanningX",void 0),(0,f.c)([(0,r.N)()],G.prototype,"inertialPanningY",void 0),(0,f.c)([(0,r.N)()],G.prototype,"pinchToPanMaxDistance",void 0),(0,f.c)([(0,r.N)()],G.prototype,"panningDistanceLimit",void 0),(0,f.c)([(0,r.K)()],G.prototype,"panningOriginTarget",void 0),(0,f.c)([(0,r.N)()],G.prototype,"panningInertia",void 0),(0,f.c)([(0,r.N)()],G.prototype,"zoomToMouseLocation",null),(0,f.c)([(0,r.N)()],G.prototype,"zoomOnFactor",void 0),(0,f.c)([(0,r.I)()],G.prototype,"targetScreenOffset",void 0),(0,f.c)([(0,r.N)()],G.prototype,"allowUpsideDown",void 0),(0,f.c)([(0,r.N)()],G.prototype,"useInputToRestoreState",void 0),(0,f.c)([(0,r.N)()],G.prototype,"restoreStateInterpolationFactor",void 0),(0,Q.g)("BABYLON.ArcRotateCamera",G)},13356:(K,O,F)=>{"use strict";F.d(O,{d:()=>q,e:()=>J});var f=F(11534),r=F(11753),l=F(12201),q={};class J{constructor(K){this.attachedToElement=!1,this.attached={},this.camera=K,this.checkInputs=()=>{}}add(K){const O=K.getSimpleName();this.attached[O]?f.c.Warn("camera input of type "+O+" already exists on camera"):(this.attached[O]=K,K.camera=this.camera,K.checkInputs&&(this.checkInputs=this._addCheckInputs(K.checkInputs.bind(K))),this.attachedToElement&&K.attachControl(this.noPreventDefault))}remove(K){for(const O in this.attached){const F=this.attached[O];if(F===K)return F.cj(),F.camera=null,delete this.attached[O],void this.rebuildInputCheck()}}removeByType(K){for(const O in this.attached){const F=this.attached[O];F.getClassName()===K&&(F.cj(),F.camera=null,delete this.attached[O],this.rebuildInputCheck())}}_addCheckInputs(K){const O=this.checkInputs;return()=>{O(),K()}}attachInput(K){this.attachedToElement&&K.attachControl(this.noPreventDefault)}attachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){K=!l.e.ForceAttachControlToAlwaysPreventDefault&&K,this.attachedToElement=!0,this.noPreventDefault=K;for(const O in this.attached)this.attached[O].attachControl(K)}}detachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const O in this.attached)this.attached[O].cj(),K&&(this.attached[O].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const K in this.attached){const O=this.attached[K];O.checkInputs&&(this.checkInputs=this._addCheckInputs(O.checkInputs.bind(O)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(K){const O={};for(const F in this.attached){const K=this.attached[F],f=r.e.Serialize(K);O[K.getClassName()]=f}K.inputsmgr=O}parse(K){const O=K.inputsmgr;if(O){this.clear();for(const K in O){const F=q[K];if(F){const f=O[K],l=r.e.Parse((()=>new F),f,null);this.add(l)}}}else for(const F in this.attached){const O=q[this.attached[F].getClassName()];if(O){const f=r.e.Parse((()=>new O),K,null);this.remove(this.attached[F]),this.add(f)}}}}},13353:(K,O,F)=>{"use strict";F.d(O,{b:()=>a});var f=F(11693),r=F(11698),l=F(11713),q=F(12232),J=F(13356),c=F(12008),E=F(11517);class M{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(K){K=E.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.HK(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const F=O.event;if(!F.metaKey)if(O.type===c.b.KEYDOWN){if(-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysUpward.indexOf(F.keyCode)||-1!==this.keysDownward.indexOf(F.keyCode)||-1!==this.keysRotateLeft.indexOf(F.keyCode)||-1!==this.keysRotateRight.indexOf(F.keyCode)||-1!==this.keysRotateUp.indexOf(F.keyCode)||-1!==this.keysRotateDown.indexOf(F.keyCode)){-1===this._keys.indexOf(F.keyCode)&&this._keys.push(F.keyCode),K||F.preventDefault()}}else if(-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysUpward.indexOf(F.keyCode)||-1!==this.keysDownward.indexOf(F.keyCode)||-1!==this.keysRotateLeft.indexOf(F.keyCode)||-1!==this.keysRotateRight.indexOf(F.keyCode)||-1!==this.keysRotateUp.indexOf(F.keyCode)||-1!==this.keysRotateDown.indexOf(F.keyCode)){const O=this._keys.indexOf(F.keyCode);O>=0&&this._keys.splice(O,1),K||F.preventDefault()}})))}cj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let O=0;O<this._keys.length;O++){const F=this._keys[O],f=K._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(F)?K._localDirection.eq(-f,0,0):-1!==this.keysUp.indexOf(F)?K._localDirection.eq(0,0,f):-1!==this.keysRight.indexOf(F)?K._localDirection.eq(f,0,0):-1!==this.keysDown.indexOf(F)?K._localDirection.eq(0,0,-f):-1!==this.keysUpward.indexOf(F)?K._localDirection.eq(0,f,0):-1!==this.keysDownward.indexOf(F)?K._localDirection.eq(0,-f,0):-1!==this.keysRotateLeft.indexOf(F)?(K._localDirection.eq(0,0,0),K.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(F)?(K._localDirection.eq(0,0,0),K.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(F)?(K._localDirection.eq(0,0,0),K.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(F)&&(K._localDirection.eq(0,0,0),K.cameraRotation.x+=this._getLocalRotation()),K.HK().useRightHandedSystem&&(K._localDirection.z*=-1),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),l.TO.TransformNormalToRef(K._localDirection,K._cameraTransformMatrix,K._transformedDirection),K.cameraDirection.addInPlace(K._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const K=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*K}}(0,f.c)([(0,r.N)()],M.prototype,"keysUp",void 0),(0,f.c)([(0,r.N)()],M.prototype,"keysUpward",void 0),(0,f.c)([(0,r.N)()],M.prototype,"keysDown",void 0),(0,f.c)([(0,r.N)()],M.prototype,"keysDownward",void 0),(0,f.c)([(0,r.N)()],M.prototype,"keysLeft",void 0),(0,f.c)([(0,r.N)()],M.prototype,"keysRight",void 0),(0,f.c)([(0,r.N)()],M.prototype,"rotationSpeed",void 0),(0,f.c)([(0,r.N)()],M.prototype,"keysRotateLeft",void 0),(0,f.c)([(0,r.N)()],M.prototype,"keysRotateRight",void 0),(0,f.c)([(0,r.N)()],M.prototype,"keysRotateUp",void 0),(0,f.c)([(0,r.N)()],M.prototype,"keysRotateDown",void 0),J.d.FreeCameraKeyboardMoveInput=M;var t=F(11523),j=F(12006);class X{constructor(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=K,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new t.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(K){K=E.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),F=O.getInputElement();this._pointerInput||(this._pointerInput=f=>{const r=f.event,l="touch"===r.pointerType;if(!this.touchEnabled&&l)return;if(f.type!==j.e.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const q=r.target;if(f.type===j.e.POINTERDOWN){if(l&&-1!==this._activePointerId||!l&&-1!==this._currentActiveButton)return;this._activePointerId=r.pointerId;try{null===q||void 0===q||q.setPointerCapture(r.pointerId)}catch(J){}-1===this._currentActiveButton&&(this._currentActiveButton=r.button),this._previousPosition={x:r.clientX,y:r.clientY},K||(r.preventDefault(),F&&F.focus()),O.isPointerLock&&this._onMouseMove&&this._onMouseMove(f.event)}else if(f.type===j.e.POINTERUP){if(l&&this._activePointerId!==r.pointerId||!l&&this._currentActiveButton!==r.button)return;try{null===q||void 0===q||q.releasePointerCapture(r.pointerId)}catch(J){}this._currentActiveButton=-1,this._previousPosition=null,K||r.preventDefault(),this._activePointerId=-1}else if(f.type===j.e.POINTERMOVE&&(this._activePointerId===r.pointerId||!l))if(O.isPointerLock&&this._onMouseMove)this._onMouseMove(f.event);else if(this._previousPosition){const O=this.camera._calculateHandednessMultiplier(),F=(r.clientX-this._previousPosition.x)*O,f=r.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=F/this.angularSensibility,this.camera.cameraRotation.x+=f/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:F,offsetY:f}),this._previousPosition={x:r.clientX,y:r.clientY},K||r.preventDefault()}}),this._onMouseMove=F=>{if(!O.isPointerLock)return;const f=this.camera._calculateHandednessMultiplier(),r=F.movementX*f;this.camera.cameraRotation.y+=r/this.angularSensibility;const l=F.movementY;this.camera.cameraRotation.x+=l/this.angularSensibility,this._previousPosition=null,K||F.preventDefault()},this._observer=this.camera.HK()._inputManager._addCameraPointerObserver(this._pointerInput,j.e.POINTERDOWN|j.e.POINTERUP|j.e.POINTERMOVE),F&&(this._contextMenuBind=K=>this.onContextMenu(K),F.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(K){K.preventDefault()}cj(){if(this._observer){if(this.camera.HK()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,f.c)([(0,r.N)()],X.prototype,"buttons",void 0),(0,f.c)([(0,r.N)()],X.prototype,"angularSensibility",void 0),J.d.FreeCameraMouseInput=X;var u,T=F(12017);class o{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new t.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(K){K=E.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==j.e.POINTERWHEEL)return;const F=O.event,f=F.deltaMode===T.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*f*F.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*f*F.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*f*F.deltaZ/this._normalize,F.preventDefault&&(K||F.preventDefault())},this._observer=this.camera.HK()._inputManager._addCameraPointerObserver(this._wheel,j.e.POINTERWHEEL)}cj(){this._observer&&(this.camera.HK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,f.c)([(0,r.N)()],o.prototype,"wheelPrecisionX",void 0),(0,f.c)([(0,r.N)()],o.prototype,"wheelPrecisionY",void 0),(0,f.c)([(0,r.N)()],o.prototype,"wheelPrecisionZ",void 0),function(K){K[K.MoveRelative=0]="MoveRelative",K[K.RotateRelative=1]="RotateRelative",K[K.MoveScene=2]="MoveScene"}(u||(u={}));class k extends o{constructor(){super(...arguments),this._moveRelative=l.TO.Zero(),this._rotateRelative=l.TO.Zero(),this._moveScene=l.TO.Zero(),this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(K){null===K&&this._wheelXAction!==u.MoveRelative||(this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=K)}get wheelXMoveRelative(){return this._wheelXAction!==u.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(K){null===K&&this._wheelYAction!==u.MoveRelative||(this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=K)}get wheelYMoveRelative(){return this._wheelYAction!==u.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(K){null===K&&this._wheelZAction!==u.MoveRelative||(this._wheelZAction=u.MoveRelative,this._wheelZActionCoordinate=K)}get wheelZMoveRelative(){return this._wheelZAction!==u.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(K){null===K&&this._wheelXAction!==u.RotateRelative||(this._wheelXAction=u.RotateRelative,this._wheelXActionCoordinate=K)}get wheelXRotateRelative(){return this._wheelXAction!==u.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(K){null===K&&this._wheelYAction!==u.RotateRelative||(this._wheelYAction=u.RotateRelative,this._wheelYActionCoordinate=K)}get wheelYRotateRelative(){return this._wheelYAction!==u.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(K){null===K&&this._wheelZAction!==u.RotateRelative||(this._wheelZAction=u.RotateRelative,this._wheelZActionCoordinate=K)}get wheelZRotateRelative(){return this._wheelZAction!==u.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(K){null===K&&this._wheelXAction!==u.MoveScene||(this._wheelXAction=u.MoveScene,this._wheelXActionCoordinate=K)}get wheelXMoveScene(){return this._wheelXAction!==u.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(K){null===K&&this._wheelYAction!==u.MoveScene||(this._wheelYAction=u.MoveScene,this._wheelYActionCoordinate=K)}get wheelYMoveScene(){return this._wheelYAction!==u.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(K){null===K&&this._wheelZAction!==u.MoveScene||(this._wheelZAction=u.MoveScene,this._wheelZActionCoordinate=K)}get wheelZMoveScene(){return this._wheelZAction!==u.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.oJ(0),this._rotateRelative.oJ(0),this._moveScene.oJ(0),this._updateCamera(),this.camera.HK().useRightHandedSystem&&(this._moveRelative.z*=-1);const K=l.Matrix.Zero();this.camera.getViewMatrix().invertToRef(K);const O=l.TO.Zero();l.TO.TransformNormalToRef(this._moveRelative,K,O),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(O),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(K,O,F){if(0===K)return;if(null===O||null===F)return;let f=null;switch(O){case u.MoveRelative:f=this._moveRelative;break;case u.RotateRelative:f=this._rotateRelative;break;case u.MoveScene:f=this._moveScene}switch(F){case 0:f.set(K,0,0);break;case 1:f.set(0,K,0);break;case 2:f.set(0,0,K)}}}(0,f.c)([(0,r.N)()],k.prototype,"wheelXMoveRelative",null),(0,f.c)([(0,r.N)()],k.prototype,"wheelYMoveRelative",null),(0,f.c)([(0,r.N)()],k.prototype,"wheelZMoveRelative",null),(0,f.c)([(0,r.N)()],k.prototype,"wheelXRotateRelative",null),(0,f.c)([(0,r.N)()],k.prototype,"wheelYRotateRelative",null),(0,f.c)([(0,r.N)()],k.prototype,"wheelZRotateRelative",null),(0,f.c)([(0,r.N)()],k.prototype,"wheelXMoveScene",null),(0,f.c)([(0,r.N)()],k.prototype,"wheelYMoveScene",null),(0,f.c)([(0,r.N)()],k.prototype,"wheelZMoveScene",null),J.d.FreeCameraMouseWheelInput=k;class N{constructor(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=K,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=E.Tools.IsSafari()}attachControl(K){K=E.Tools.BackCompatCameraNoPreventDefault(arguments);let O=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=F=>{const f=F.event,r="mouse"===f.pointerType||this._isSafari&&"undefined"===typeof f.pointerType;if(this.allowMouse||!r)if(F.type===j.e.POINTERDOWN){if(K||f.preventDefault(),this._pointerPressed.push(f.pointerId),1!==this._pointerPressed.length)return;O={x:f.clientX,y:f.clientY}}else if(F.type===j.e.POINTERUP){K||f.preventDefault();const F=this._pointerPressed.indexOf(f.pointerId);if(-1===F)return;if(this._pointerPressed.splice(F,1),0!=F)return;O=null,this._offsetX=null,this._offsetY=null}else if(F.type===j.e.POINTERMOVE){if(K||f.preventDefault(),!O)return;if(0!=this._pointerPressed.indexOf(f.pointerId))return;this._offsetX=f.clientX-O.x,this._offsetY=-(f.clientY-O.y)}}),this._observer=this.camera.HK()._inputManager._addCameraPointerObserver(this._pointerInput,j.e.POINTERDOWN|j.e.POINTERUP|j.e.POINTERMOVE),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.addEventListener("blur",this._onLostFocus)}}cj(){if(this._pointerInput){if(this._observer&&(this.camera.HK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const K=this.camera,O=K._calculateHandednessMultiplier();K.cameraRotation.y=O*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)K.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const O=K._computeLocalCameraSpeed(),F=new l.TO(0,0,0!==this.touchMoveSensibility?O*this._offsetY/this.touchMoveSensibility:0);l.Matrix.RotationYawPitchRollToRef(K.rotation.y,K.rotation.x,0,K._cameraRotationMatrix),K.cameraDirection.addInPlace(l.TO.TransformCoordinates(F,K._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,f.c)([(0,r.N)()],N.prototype,"touchAngularSensibility",void 0),(0,f.c)([(0,r.N)()],N.prototype,"touchMoveSensibility",void 0),J.d.FreeCameraTouchInput=N;class Z extends J.e{constructor(K){super(K),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new M),this}addMouse(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new X(K),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new k,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new N),this}clear(){super.clear(),this._mouseInput=null}}var L=F(11661),d=F(11597);class a extends q.d{get angularSensibility(){const K=this.inputs.attached.mouse;return K?K.angularSensibility:0}set angularSensibility(K){const O=this.inputs.attached.mouse;O&&(O.angularSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const O=this.inputs.attached.keyboard;O&&(O.keysUp=K)}get keysUpward(){const K=this.inputs.attached.keyboard;return K?K.keysUpward:[]}set keysUpward(K){const O=this.inputs.attached.keyboard;O&&(O.keysUpward=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const O=this.inputs.attached.keyboard;O&&(O.keysDown=K)}get keysDownward(){const K=this.inputs.attached.keyboard;return K?K.keysDownward:[]}set keysDownward(K){const O=this.inputs.attached.keyboard;O&&(O.keysDownward=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const O=this.inputs.attached.keyboard;O&&(O.keysRight=K)}get keysRotateLeft(){const K=this.inputs.attached.keyboard;return K?K.keysRotateLeft:[]}set keysRotateLeft(K){const O=this.inputs.attached.keyboard;O&&(O.keysRotateLeft=K)}get keysRotateRight(){const K=this.inputs.attached.keyboard;return K?K.keysRotateRight:[]}set keysRotateRight(K){const O=this.inputs.attached.keyboard;O&&(O.keysRotateRight=K)}get keysRotateUp(){const K=this.inputs.attached.keyboard;return K?K.keysRotateUp:[]}set keysRotateUp(K){const O=this.inputs.attached.keyboard;O&&(O.keysRotateUp=K)}get keysRotateDown(){const K=this.inputs.attached.keyboard;return K?K.keysRotateDown:[]}set keysRotateDown(K){const O=this.inputs.attached.keyboard;O&&(O.keysRotateDown=K)}constructor(K,O,F){var f;super(K,O,F,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),f=this,this.ellipsoid=new l.TO(.5,1,.5),this.ellipsoidOffset=new l.TO(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=l.TO.Zero(),this._diffPosition=l.TO.Zero(),this._newPosition=l.TO.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f._newPosition.l(O),f._newPosition.subtractToRef(f._oldPosition,f._diffPosition),f._diffPosition.length()>d.c.CollisionsEpsilon&&(f.position.addToRef(f._diffPosition,f._deferredPositionUpdate),f._deferOnly?f._deferredUpdated=!0:f.position.l(f._deferredPositionUpdate),f.DX&&F&&f.DX(F))},this.inputs=new Z(this),this.inputs.addKeyboard().addMouse()}attachControl(K,O){O=E.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(O)}cj(){this.inputs.detachElement(),this.cameraDirection=new l.TO(0,0,0),this.cameraRotation=new l.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(K){this._collisionMask=isNaN(K)?-1:K}_collideWithWorld(K){let O;O=this.parent?l.TO.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,O.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const F=this.HK().collisionCoordinator;this._collider||(this._collider=F.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let f=K;this.applyGravity&&(f=K.add(this.HK().gravity)),F.getNewPosition(this._oldPosition,f,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=l.TO.Zero(),this._transformedDirection=l.TO.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(K){this._needMoveForGravity=K}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.HK().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"qc"}}(0,f.c)([(0,r.K)()],a.prototype,"ellipsoid",void 0),(0,f.c)([(0,r.K)()],a.prototype,"ellipsoidOffset",void 0),(0,f.c)([(0,r.N)()],a.prototype,"checkCollisions",void 0),(0,f.c)([(0,r.N)()],a.prototype,"applyGravity",void 0),(0,L.g)("BABYLON.FreeCamera",a)},13922:(K,O,F)=>{"use strict";F.d(O,{e:()=>l});var f=F(11816),r=F(13928);class l{constructor(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=F,this.et=[],this._maxBlockCapacity=O||64,this._selectionContent=new f.b(1024),this._creationFunc=K}update(K,O,F){r.d._CreateBlocks(K,O,F,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}RM(K){for(let O=0;O<this.DM.length;O++){this.DM[O].addEntry(K)}}QM(K){for(let O=0;O<this.DM.length;O++){this.DM[O].removeEntry(K)}}select(K,O){this._selectionContent.reset();for(let F=0;F<this.DM.length;F++){this.DM[F].select(K,this._selectionContent,O)}return O?this._selectionContent.concat(this.et):this._selectionContent.concatWithNoDuplicate(this.et),this._selectionContent}intersects(K,O,F){this._selectionContent.reset();for(let f=0;f<this.DM.length;f++){this.DM[f].intersects(K,O,this._selectionContent,F)}return F?this._selectionContent.concat(this.et):this._selectionContent.concatWithNoDuplicate(this.et),this._selectionContent}intersectsRay(K){this._selectionContent.reset();for(let O=0;O<this.DM.length;O++){this.DM[O].intersectsRay(K,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.et),this._selectionContent}}l.CreationFuncForMeshes=(K,O)=>{const F=K.getBoundingInfo();!K.isBlocked&&F.boundingBox.intersectsMinMax(O.Rt,O.Gt)&&O.entries.push(K)},l.CreationFuncForSubMeshes=(K,O)=>{K.getBoundingInfo().boundingBox.intersectsMinMax(O.Rt,O.Gt)&&O.entries.push(K)}},13928:(K,O,F)=>{"use strict";F.d(O,{d:()=>l});var f=F(11713),r=F(12079);class l{constructor(K,O,F,f,r,l){this.entries=[],this.zt=new Array,this._capacity=F,this._depth=f,this._maxDepth=r,this._creationFunc=l,this._minPoint=K,this._maxPoint=O,this.zt.push(K.clone()),this.zt.push(O.clone()),this.zt.push(K.clone()),this.zt[2].x=O.x,this.zt.push(K.clone()),this.zt[3].y=O.y,this.zt.push(K.clone()),this.zt[4].z=O.z,this.zt.push(O.clone()),this.zt[5].z=K.z,this.zt.push(O.clone()),this.zt[6].x=K.x,this.zt.push(O.clone()),this.zt[7].y=K.y}get VO(){return this._capacity}get Rt(){return this._minPoint}get Gt(){return this._maxPoint}addEntry(K){if(this.DM)for(let O=0;O<this.DM.length;O++){this.DM[O].addEntry(K)}else this._creationFunc(K,this),this.entries.length>this.VO&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(K){if(this.DM){for(let O=0;O<this.DM.length;O++){this.DM[O].removeEntry(K)}return}const O=this.entries.indexOf(K);O>-1&&this.entries.splice(O,1)}addEntries(K){for(let O=0;O<K.length;O++){const F=K[O];this.addEntry(F)}}select(K,O,F){if(r.b.IsInFrustum(this.zt,K)){if(this.DM){for(let f=0;f<this.DM.length;f++){this.DM[f].select(K,O,F)}return}F?O.concat(this.entries):O.concatWithNoDuplicate(this.entries)}}intersects(K,O,F,f){if(r.b.IntersectsSphere(this._minPoint,this._maxPoint,K,O)){if(this.DM){for(let r=0;r<this.DM.length;r++){this.DM[r].intersects(K,O,F,f)}return}f?F.concat(this.entries):F.concatWithNoDuplicate(this.entries)}}intersectsRay(K,O){if(K.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.DM){for(let F=0;F<this.DM.length;F++){this.DM[F].intersectsRay(K,O)}return}O.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){l._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(K,O,F,r,q,J,c,E){c.DM=new Array;const M=new f.TO((O.x-K.x)/2,(O.y-K.y)/2,(O.z-K.z)/2);for(let f=0;f<2;f++)for(let O=0;O<2;O++)for(let t=0;t<2;t++){const j=K.add(M.multiplyByFloats(f,O,t)),X=K.add(M.multiplyByFloats(f+1,O+1,t+1)),u=new l(j,X,r,q+1,J,E);u.addEntries(F),c.DM.push(u)}}}},13937:(K,O,F)=>{"use strict";F.d(O,{c:()=>M});var f=F(11964),r=F(11713),l=F(12164),q=F(13132),J=F(11998),c=F(13922),E=F(11559);f.d.prototype.createOrUpdateSelectionOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,F=this._getComponent(J.b.NAME_OCTREE);F||(F=new M(this),this.o(F)),this.gt||(this.gt=new c.e(c.e.CreationFuncForMeshes,K,O));const f=this.getWorldExtends();return this.gt.update(f.min,f.max,this.meshes),this.gt},Object.defineProperty(f.d.prototype,"selectionOctree",{get:function(){return this.gt},enumerable:!0,configurable:!0}),l.e.prototype.createOrUpdateSubmeshesOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const F=this.HK();let f=F._getComponent(J.b.NAME_OCTREE);f||(f=new M(F),F.o(f)),this._submeshesOctree||(this._submeshesOctree=new c.e(c.e.CreationFuncForSubMeshes,K,O)),this.Pf(!0);const r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.Df),this._submeshesOctree};class M{constructor(K){this.name=J.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new q.c(r.TO.Zero(),new r.TO(1,1,1)),(K=K||E.e.LastCreatedScene)&&(this.kO=K,this.kO.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.kO.getActiveSubMeshCandidates=K=>this.getActiveSubMeshCandidates(K),this.kO.getCollidingSubMeshCandidates=(K,O)=>this.getCollidingSubMeshCandidates(K,O),this.kO.getIntersectingSubMeshCandidates=(K,O)=>this.getIntersectingSubMeshCandidates(K,O))}register(){this.kO.onMeshRemovedObservable.add((K=>{const O=this.kO.selectionOctree;if(void 0!==O&&null!==O){const F=O.et.indexOf(K);-1!==F&&O.et.splice(F,1)}})),this.kO.onMeshImportedObservable.add((K=>{const O=this.kO.selectionOctree;void 0!==O&&null!==O&&O.RM(K)}))}getActiveMeshCandidates(){var K;return(null===(K=this.kO.gt)||void 0===K?void 0:K.select(this.kO.frustumPlanes))||this.kO._getDefaultMeshCandidates()}getActiveSubMeshCandidates(K){if(K._submeshesOctree&&K.useOctreeForRenderingSelection){return K._submeshesOctree.select(this.kO.frustumPlanes)}return this.kO._getDefaultSubMeshCandidates(K)}getIntersectingSubMeshCandidates(K,O){if(K._submeshesOctree&&K.useOctreeForPicking){q.c.TransformToRef(O,K.getWorldMatrix(),this._tempRay);return K._submeshesOctree.intersectsRay(this._tempRay)}return this.kO._getDefaultSubMeshCandidates(K)}getCollidingSubMeshCandidates(K,O){if(K._submeshesOctree&&K.useOctreeForCollisions){const F=O._velocityWorldLength+Math.max(O._radius.x,O._radius.y,O._radius.z);return K._submeshesOctree.intersects(O._basePointWorld,F)}return this.kO._getDefaultSubMeshCandidates(K)}rebuild(){}dispose(){}}},13132:(K,O,F)=>{"use strict";F.d(O,{c:()=>X});var f=F(11964),r=F(12201),l=F(11721),q=F(11713),J=F(11729),c=F(12066),E=F(11996),M=F(11559),t=F(12023);const j={internalPickerForMesh:void 0};class X{constructor(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.e;this.origin=K,this.direction=O,this.length=F,this.epsilon=f}clone(){return new X(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const f=X._TmpVector3[0].eq(K.x-F,K.y-F,K.z-F),r=X._TmpVector3[1].eq(O.x+F,O.y+F,O.z+F);let l,q,J,c,E=0,M=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<f.x||this.origin.x>r.x)return!1}else if(l=1/this.direction.x,q=(f.x-this.origin.x)*l,J=(r.x-this.origin.x)*l,J===-1/0&&(J=1/0),q>J&&(c=q,q=J,J=c),E=Math.max(q,E),M=Math.min(J,M),E>M)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<f.y||this.origin.y>r.y)return!1}else if(l=1/this.direction.y,q=(f.y-this.origin.y)*l,J=(r.y-this.origin.y)*l,J===-1/0&&(J=1/0),q>J&&(c=q,q=J,J=c),E=Math.max(q,E),M=Math.min(J,M),E>M)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<f.z||this.origin.z>r.z)return!1}else if(l=1/this.direction.z,q=(f.z-this.origin.z)*l,J=(r.z-this.origin.z)*l,J===-1/0&&(J=1/0),q>J&&(c=q,q=J,J=c),E=Math.max(q,E),M=Math.min(J,M),E>M)return!1;return!0}intersectsBox(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(K.minimum,K.maximum,O)}intersectsSphere(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=K.center.x-this.origin.x,f=K.center.y-this.origin.y,r=K.center.z-this.origin.z,l=F*F+f*f+r*r,q=K.radius+O,J=q*q;if(l<=J)return!0;const c=F*this.direction.x+f*this.direction.y+r*this.direction.z;if(c<0)return!1;return l-c*c<=J}intersectsTriangle(K,O,F){const f=X._TmpVector3[0],r=X._TmpVector3[1],l=X._TmpVector3[2],J=X._TmpVector3[3],E=X._TmpVector3[4];O.subtractToRef(K,f),F.subtractToRef(K,r),q.TO.CrossToRef(this.direction,r,l);const M=q.TO.Dot(f,l);if(0===M)return null;const t=1/M;this.origin.subtractToRef(K,J);const j=q.TO.Dot(J,l)*t;if(j<-this.epsilon||j>1+this.epsilon)return null;q.TO.CrossToRef(J,f,E);const u=q.TO.Dot(this.direction,E)*t;if(u<-this.epsilon||j+u>1+this.epsilon)return null;const T=q.TO.Dot(r,E)*t;return T>this.length?null:new c.c(1-j-u,j,T)}intersectsPlane(K){let O;const F=q.TO.Dot(K.normal,this.direction);if(Math.abs(F)<9.99999997475243e-7)return null;{const f=q.TO.Dot(K.normal,this.origin);return O=(-K.d-f)/F,O<0?O<-9.99999997475243e-7?null:0:O}}intersectsAxis(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(K){case"y":{const K=(this.origin.y-O)/this.direction.y;return K>0?null:new q.TO(this.origin.x+this.direction.x*-K,O,this.origin.z+this.direction.z*-K)}case"x":{const K=(this.origin.x-O)/this.direction.x;return K>0?null:new q.TO(O,this.origin.y+this.direction.y*-K,this.origin.z+this.direction.z*-K)}case"z":{const K=(this.origin.z-O)/this.direction.z;return K>0?null:new q.TO(this.origin.x+this.direction.x*-K,this.origin.y+this.direction.y*-K,O)}default:return null}}intersectsMesh(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const J=q.TmpVectors.Matrix[0];return K.getWorldMatrix().invertToRef(J),this._tmpRay?X.TransformToRef(this,J,this._tmpRay):this._tmpRay=X.Transform(this,J),K.intersects(this._tmpRay,O,F,f,r,l)}intersectsMeshes(K,O,F){F?F.length=0:F=[];for(let f=0;f<K.length;f++){const r=this.intersectsMesh(K[f],O);r.hit&&F.push(r)}return F.sort(this._comparePickingInfo),F}_comparePickingInfo(K,O){return K.distance<O.distance?-1:K.distance>O.distance?1:0}intersectionSegment(K,O,F){const f=this.origin,r=q.TmpVectors.TO[0],l=q.TmpVectors.TO[1],J=q.TmpVectors.TO[2],c=q.TmpVectors.TO[3];O.subtractToRef(K,r),this.direction.scaleToRef(X._Rayl,J),f.addToRef(J,l),K.subtractToRef(f,c);const E=q.TO.Dot(r,r),M=q.TO.Dot(r,J),t=q.TO.Dot(J,J),j=q.TO.Dot(r,c),u=q.TO.Dot(J,c),T=E*t-M*M;let o,k,N=T,Z=T;T<X._Smallnum?(o=0,N=1,k=u,Z=t):(o=M*u-t*j,k=E*u-M*j,o<0?(o=0,k=u,Z=t):o>N&&(o=N,k=u+M,Z=t)),k<0?(k=0,-j<0?o=0:-j>E?o=N:(o=-j,N=E)):k>Z&&(k=Z,-j+M<0?o=0:-j+M>E?o=N:(o=-j+M,N=E));const L=Math.abs(o)<X._Smallnum?0:o/N,d=Math.abs(k)<X._Smallnum?0:k/Z,a=q.TmpVectors.TO[4];J.scaleToRef(d,a);const g=q.TmpVectors.TO[5];r.scaleToRef(L,g),g.addInPlace(c);const H=q.TmpVectors.TO[6];g.subtractToRef(a,H);return d>0&&d<=this.length&&H.lengthSquared()<F*F?g.length():-1}update(K,O,F,f,r,l,J){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){X._RayDistant||(X._RayDistant=X.Zero()),X._RayDistant.unprojectRayToRef(K,O,F,f,q.Matrix.IdentityReadOnly,l,J);const c=q.TmpVectors.Matrix[0];r.invertToRef(c),X.TransformToRef(X._RayDistant,c,this)}else this.unprojectRayToRef(K,O,F,f,r,l,J);return this}static Zero(){return new X(q.TO.Zero(),q.TO.Zero())}static CreateNew(K,O,F,f,r,l,q){return X.Zero().update(K,O,F,f,r,l,q)}static CreateNewFromTo(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.Matrix.IdentityReadOnly;const f=new X(new q.TO(0,0,0),new q.TO(0,0,0));return X.CreateFromToToRef(K,O,f,F)}static CreateFromToToRef(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.Matrix.IdentityReadOnly;F.origin.l(K);const r=O.subtractToRef(K,F.direction),l=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return F.length=l,F.direction.normalize(),X.TransformToRef(F,f,F)}static Transform(K,O){const F=new X(new q.TO(0,0,0),new q.TO(0,0,0));return X.TransformToRef(K,O,F),F}static TransformToRef(K,O,F){q.TO.TransformCoordinatesToRef(K.origin,O,F.origin),q.TO.TransformNormalToRef(K.direction,O,F.direction),F.length=K.length,F.epsilon=K.epsilon;const f=F.direction,r=f.length();if(0!==r&&1!==r){const K=1/r;f.x*=K,f.y*=K,f.z*=K,F.length*=r}return F}unprojectRayToRef(K,O,F,f,r,l,J){const c=q.TmpVectors.Matrix[0];r.multiplyToRef(l,c),c.multiplyToRef(J,c),c.invert();const E=M.e.LastCreatedEngine,t=q.TmpVectors.TO[0];t.x=K/F*2-1,t.y=-(O/f*2-1),t.z=null!==E&&void 0!==E&&E.useReverseDepthBuffer?1:null!==E&&void 0!==E&&E.isNDCHalfZRange?0:-1;const j=q.TmpVectors.TO[1].eq(t.x,t.y,1-1e-8),X=q.TmpVectors.TO[2],u=q.TmpVectors.TO[3];q.TO._UnprojectFromInvertedMatrixToRef(t,c,X),q.TO._UnprojectFromInvertedMatrixToRef(j,c,u),this.origin.l(X),u.subtractToRef(X,this.direction),this.direction.normalize()}}function u(K,O,F,f,r){let l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=X.Zero();return T(K,O,F,f,q,r,l),q}function T(K,O,F,f,r,l){let J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const E=K.getEngine();if(!l&&!(l=K.activeCamera))return K;const M=l.viewport,t=E.getRenderHeight(),{x:j,y:X,width:u,height:T}=M.toGlobal(E.getRenderWidth(),t),o=1/E.getHardwareScalingLevel();return O=O*o-j,F=F*o-(t-X-T),r.update(O,F,u,T,f||q.Matrix.IdentityReadOnly,J?q.Matrix.IdentityReadOnly:l.getViewMatrix(),l.getProjectionMatrix(),c),K}function o(K,O,F,f,r){if(!E.d)return K;const l=K.getEngine();if(!r&&!(r=K.activeCamera))throw new Error("Active camera not set");const J=r.viewport,c=l.getRenderHeight(),{x:M,y:t,width:j,height:X}=J.toGlobal(l.getRenderWidth(),c),u=q.Matrix.Identity(),T=1/l.getHardwareScalingLevel();return O=O*T-M,F=F*T-(c-t-X),f.update(O,F,j,X,u,u,r.getProjectionMatrix()),K}function k(K,O,F,f,r,l,q,J){const c=O(f,F.enableDistantPicking),E=F.intersects(c,r,q,l,f,J);return E&&E.hit?!r&&null!=K&&E.distance>=K.distance?null:E:null}function N(K,O,F,f,r,l){let J=null;const c=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),M=K.cameraToUseForPointers||K.activeCamera,t=j.internalPickerForMesh||k;for(let E=0;E<K.meshes.length;E++){const j=K.meshes[E];if(F){if(!F(j,-1))continue}else if(!j.isEnabled()||!j.isVisible||!j.TE)continue;const X=c&&j.isWorldMatrixCameraDependent(),u=j.Pf(X,M);if(j.hasThinInstances&&j.wE){const K=t(J,O,j,u,!0,!0,l);if(K){if(r)return K;const c=q.TmpVectors.Matrix[1],E=j.thinInstanceGetWorldMatrices();for(let K=0;K<E.length;K++){if(F&&!F(j,K))continue;E[K].multiplyToRef(u,c);const q=t(J,O,j,c,f,r,l,!0);if(q&&(J=q,J.thinInstanceIndex=K,f))return J}}}else{const K=t(J,O,j,u,f,r,l);if(K&&(J=K,f))return J}}return J||new E.d}function Z(K,O,F,f){if(!E.d)return null;const r=[],l=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),J=K.cameraToUseForPointers||K.activeCamera,c=j.internalPickerForMesh||k;for(let E=0;E<K.meshes.length;E++){const M=K.meshes[E];if(F){if(!F(M,-1))continue}else if(!M.isEnabled()||!M.isVisible||!M.TE)continue;const t=l&&M.isWorldMatrixCameraDependent(),j=M.Pf(t,J);if(M.hasThinInstances&&M.wE){if(c(null,O,M,j,!0,!0,f)){const K=q.TmpVectors.Matrix[1],l=M.thinInstanceGetWorldMatrices();for(let q=0;q<l.length;q++){if(F&&!F(M,q))continue;l[q].multiplyToRef(j,K);const J=c(null,O,M,K,!1,!1,f,!0);J&&(J.thinInstanceIndex=q,r.push(J))}}}else{const K=c(null,O,M,j,!1,!1,f);K&&r.push(K)}}return r}function L(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,f=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;f||(f=K.getWorldMatrix()),O.length=F,r?O.origin.l(r):O.origin.l(K.position);const l=q.TmpVectors.TO[2];l.set(0,0,K._scene.useRightHandedSystem?-1:1);const J=q.TmpVectors.TO[3];return q.TO.TransformNormalToRef(l,f,J),q.TO.NormalizeToRef(J,O.direction),O}var d,a;X._TmpVector3=(0,J.c)(6,q.TO.Zero),X._RayDistant=X.Zero(),X._Smallnum=1e-8,X._Rayl=1e9,d=f.d,(a=r.e)&&(a.prototype.getForwardRay=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,O=arguments.length>1?arguments[1]:void 0,F=arguments.length>2?arguments[2]:void 0;return L(this,new X(q.TO.Zero(),q.TO.Zero(),K),K,O,F)},a.prototype.getForwardRayToRef=function(K){return L(this,K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),d&&(t.b._IsPickingAvailable=!0,d.prototype.createPickingRay=function(K,O,F,f){return u(this,K,O,F,f,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),f.d.prototype.createPickingRayToRef=function(K,O,F,f,r){return T(this,K,O,F,f,r,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},f.d.prototype.createPickingRayInCameraSpace=function(K,O,F){return function(K,O,F,f){const r=X.Zero();return o(K,O,F,r,f),r}(this,K,O,F)},f.d.prototype.createPickingRayInCameraSpaceToRef=function(K,O,F,f){return o(this,K,O,F,f)},f.d.prototype.pickWithBoundingInfo=function(K,O,F,f,r){return function(K,O,F,f,r,l){if(!E.d)return null;const J=N(K,(f=>(K._tempPickingRay||(K._tempPickingRay=X.Zero()),T(K,O,F,f,K._tempPickingRay,l||null),K._tempPickingRay)),f,r,!0);return J&&(J.ray=u(K,O,F,q.Matrix.Identity(),l||null)),J}(this,K,O,F,f,r)},f.d.prototype.XF=function(K,O,F,f,r,l){return function(K,O,F,f,r,l,J){const c=N(K,((f,r)=>(K._tempPickingRay||(K._tempPickingRay=X.Zero()),T(K,O,F,f,K._tempPickingRay,l||null,!1,r),K._tempPickingRay)),f,r,!1,J);return c&&(c.ray=u(K,O,F,q.Matrix.Identity(),l||null)),c}(this,K,O,F,f,r,l)},f.d.prototype.pickWithRay=function(K,O,F,f){return function(K,O,F,f,r){const l=N(K,(F=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=q.Matrix.Identity()),F.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=X.Zero()),X.TransformToRef(O,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),F,f,!1,r);return l&&(l.ray=O),l}(this,K,O,F,f)},f.d.prototype.multiPick=function(K,O,F,f,r){return function(K,O,F,f,r,l){return Z(K,(f=>u(K,O,F,f,r||null)),f,l)}(this,K,O,F,f,r)},f.d.prototype.multiPickWithRay=function(K,O,F){return function(K,O,F,f){return Z(K,(F=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=q.Matrix.Identity()),F.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=X.Zero()),X.TransformToRef(O,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),F,f)}(this,K,O,F)}},13415:(K,O,F)=>{"use strict";var f=F(11636),r=F(11534),l=F(11565),q=F(11664),J=F(11597),c=F(11649);J.c.prototype._partialLoadFile=function(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(K,(K=>{F[O]=K,F._internalCount++,6===F._internalCount&&f(F)}),void 0,void 0,!0,((K,O)=>{r&&K&&r(K.status+" "+K.statusText,O)}))},J.c.prototype._cascadeLoadFiles=function(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=[];r._internalCount=0;for(let l=0;l<6;l++)this._partialLoadFile(F[l],l,r,O,f)},J.c.prototype._cascadeLoadImgs=function(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5?arguments[5]:void 0;const q=[];q._internalCount=0;for(let J=0;J<6;J++)this._partialLoadImg(f[J],J,q,K,O,F,r,l)},J.c.prototype._partialLoadImg=function(K,O,F,f,r,J){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7?arguments[7]:void 0;const M=(0,q.d)();(0,l.z)(K,(K=>{F[O]=K,F._internalCount++,f&&f.removePendingData(M),6===F._internalCount&&J&&J(r,F)}),((K,O)=>{f&&f.removePendingData(M),c&&c(K,O)}),f?f.offlineProvider:null,E),f&&f.addPendingData(M)},J.c.prototype.createCubeTextureBase=function(K,O,F,l){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6?arguments[6]:void 0,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,T=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,o=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,k=arguments.length>14&&void 0!==arguments[14]&&arguments[14],N=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const Z=u||new f.e(this,7);Z.isCube=!0,Z.url=K,Z.generateMipMaps=!l,Z._lodGenerationScale=j,Z._lodGenerationOffset=X,Z._useSRGBBuffer=!!k&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!l),Z!==u&&(Z.label=K.substring(0,60)),this._doNotHandleContextLost||(Z._extension=M,Z._files=F,Z._buffer=N);const L=K;this._transformTextureUrl&&!u&&(K=this._transformTextureUrl(K));const d=M??function(K){const O=K.split("?")[0],F=O.lastIndexOf(".");return F>-1?O.substring(F).toLowerCase():""}(K),a=(0,c.d)(d),g=(K,O)=>{Z.dispose(),J?J(K,O):K&&r.c.Warn(K)},H=(f,J)=>{K===L?f&&g(f.status+" "+f.statusText,J):(r.c.Warn(`Failed to load ${K}, falling back to the ${L}`),this.createCubeTextureBase(L,O,F,!!l,q,g,E,M,t,j,X,Z,T,o,k,N))};if(a)a.then((f=>{const r=K=>{T&&T(Z,K),f.loadCubeData(K,Z,t,q,((K,O)=>{g(K,O)}))};N?r(N):F&&6===F.length?f.supportCascades?this._cascadeLoadFiles(O,(K=>r(K.map((K=>new Uint8Array(K))))),F,g):g("Textures type does not support cascades."):this._loadFile(K,(K=>r(new Uint8Array(K))),void 0,void 0,!0,H)}));else{if(!F||0===F.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(O,Z,((K,O)=>{o&&o(K,O)}),F,g)}return this._internalTexturesCache.push(Z),Z}},13943:(K,O,F)=>{"use strict";F(11534);var f=F(11859);F(11636),F(11800),F(11629),F(11915),F(11869);f.b},13435:(K,O,F)=>{"use strict";F.d(O,{d:()=>r});var f=F(11661);class r{constructor(K){this.value=this._toInt(K)}_toInt(K){return 0|K}add(K){return new r(this.value+K.value)}oO(K){return new r(this.value-K.value)}multiply(K){return new r(Math.imul(this.value,K.value))}divide(K){return new r(this.value/K.value)}getClassName(){return r.ClassName}equals(K){return this.value===K.value}static FromValue(K){return new r(K)}toString(){return this.value.toString()}}r.ClassName="FlowGraphInteger",(0,f.g)("FlowGraphInteger",r)},13450:(K,O,F)=>{"use strict";F.d(O,{c:()=>r,f:()=>l});var f=F(11713);class r{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.pf=K}get m(){return this.pf}transformVector(K){return this.transformVectorToRef(K,new f.Vector2)}transformVectorToRef(K,O){return O.x=K.x*this.pf[0]+K.y*this.pf[1],O.y=K.x*this.pf[2]+K.y*this.pf[3],O}hf(){return this.toArray()}toArray(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<4;O++)K[O]=this.pf[O];return K}uF(K){for(let O=0;O<4;O++)this.pf[O]=K[O];return this}multiplyToRef(K,O){const F=K.pf,f=this.pf,r=O.pf;return r[0]=F[0]*f[0]+F[1]*f[2],r[1]=F[0]*f[1]+F[1]*f[3],r[2]=F[2]*f[0]+F[3]*f[2],r[3]=F[2]*f[1]+F[3]*f[3],O}multiply(K){return this.multiplyToRef(K,new r)}divideToRef(K,O){const F=this.pf,f=K.pf,r=O.pf;return r[0]=F[0]/f[0],r[1]=F[1]/f[1],r[2]=F[2]/f[2],r[3]=F[3]/f[3],O}divide(K){return this.divideToRef(K,new r)}addToRef(K,O){const F=this.pf,f=K.m,r=O.m;return r[0]=F[0]+f[0],r[1]=F[1]+f[1],r[2]=F[2]+f[2],r[3]=F[3]+f[3],O}add(K){return this.addToRef(K,new r)}subtractToRef(K,O){const F=this.pf,f=K.m,r=O.m;return r[0]=F[0]-f[0],r[1]=F[1]-f[1],r[2]=F[2]-f[2],r[3]=F[3]-f[3],O}oO(K){return this.subtractToRef(K,new r)}transpose(){const K=this.pf;return new r([K[0],K[2],K[1],K[3]])}determinant(){const K=this.pf;return K[0]*K[3]-K[1]*K[2]}inverse(){const K=this.determinant();if(0===K)throw new Error("Matrix is not invertible");const O=this.pf,F=1/K;return new r([O[3]*F,-O[1]*F,-O[2]*F,O[0]*F])}equals(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=this.pf,f=K.m;return 0===O?F[0]===f[0]&&F[1]===f[1]&&F[2]===f[2]&&F[3]===f[3]:Math.abs(F[0]-f[0])<O&&Math.abs(F[1]-f[1])<O&&Math.abs(F[2]-f[2])<O&&Math.abs(F[3]-f[3])<O}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.pf.join(", ")})`}}class l{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.pf=K}get m(){return this.pf}transformVector(K){return this.transformVectorToRef(K,new f.TO)}transformVectorToRef(K,O){const F=this.pf;return O.x=K.x*F[0]+K.y*F[1]+K.z*F[2],O.y=K.x*F[3]+K.y*F[4]+K.z*F[5],O.z=K.x*F[6]+K.y*F[7]+K.z*F[8],O}multiplyToRef(K,O){const F=K.pf,f=this.pf,r=O.m;return r[0]=F[0]*f[0]+F[1]*f[3]+F[2]*f[6],r[1]=F[0]*f[1]+F[1]*f[4]+F[2]*f[7],r[2]=F[0]*f[2]+F[1]*f[5]+F[2]*f[8],r[3]=F[3]*f[0]+F[4]*f[3]+F[5]*f[6],r[4]=F[3]*f[1]+F[4]*f[4]+F[5]*f[7],r[5]=F[3]*f[2]+F[4]*f[5]+F[5]*f[8],r[6]=F[6]*f[0]+F[7]*f[3]+F[8]*f[6],r[7]=F[6]*f[1]+F[7]*f[4]+F[8]*f[7],r[8]=F[6]*f[2]+F[7]*f[5]+F[8]*f[8],O}multiply(K){return this.multiplyToRef(K,new l)}divideToRef(K,O){const F=this.pf,f=K.m,r=O.m;return r[0]=F[0]/f[0],r[1]=F[1]/f[1],r[2]=F[2]/f[2],r[3]=F[3]/f[3],r[4]=F[4]/f[4],r[5]=F[5]/f[5],r[6]=F[6]/f[6],r[7]=F[7]/f[7],r[8]=F[8]/f[8],O}divide(K){return this.divideToRef(K,new l)}addToRef(K,O){const F=this.pf,f=K.m,r=O.m;return r[0]=F[0]+f[0],r[1]=F[1]+f[1],r[2]=F[2]+f[2],r[3]=F[3]+f[3],r[4]=F[4]+f[4],r[5]=F[5]+f[5],r[6]=F[6]+f[6],r[7]=F[7]+f[7],r[8]=F[8]+f[8],O}add(K){return this.addToRef(K,new l)}subtractToRef(K,O){const F=this.pf,f=K.m,r=O.m;return r[0]=F[0]-f[0],r[1]=F[1]-f[1],r[2]=F[2]-f[2],r[3]=F[3]-f[3],r[4]=F[4]-f[4],r[5]=F[5]-f[5],r[6]=F[6]-f[6],r[7]=F[7]-f[7],r[8]=F[8]-f[8],O}oO(K){return this.subtractToRef(K,new l)}toArray(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<9;O++)K[O]=this.pf[O];return K}hf(){return this.toArray()}uF(K){for(let O=0;O<9;O++)this.pf[O]=K[O];return this}transpose(){const K=this.pf;return new l([K[0],K[3],K[6],K[1],K[4],K[7],K[2],K[5],K[8]])}determinant(){const K=this.pf;return K[0]*(K[4]*K[8]-K[5]*K[7])-K[1]*(K[3]*K[8]-K[5]*K[6])+K[2]*(K[3]*K[7]-K[4]*K[6])}inverse(){const K=this.determinant();if(0===K)throw new Error("Matrix is not invertible");const O=this.pf,F=1/K;return new l([(O[4]*O[8]-O[5]*O[7])*F,(O[2]*O[7]-O[1]*O[8])*F,(O[1]*O[5]-O[2]*O[4])*F,(O[5]*O[6]-O[3]*O[8])*F,(O[0]*O[8]-O[2]*O[6])*F,(O[2]*O[3]-O[0]*O[5])*F,(O[3]*O[7]-O[4]*O[6])*F,(O[1]*O[6]-O[0]*O[7])*F,(O[0]*O[4]-O[1]*O[3])*F])}equals(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=this.pf,f=K.m;return 0===O?F[0]===f[0]&&F[1]===f[1]&&F[2]===f[2]&&F[3]===f[3]&&F[4]===f[4]&&F[5]===f[5]&&F[6]===f[6]&&F[7]===f[7]&&F[8]===f[8]:Math.abs(F[0]-f[0])<O&&Math.abs(F[1]-f[1])<O&&Math.abs(F[2]-f[2])<O&&Math.abs(F[3]-f[3])<O&&Math.abs(F[4]-f[4])<O&&Math.abs(F[5]-f[5])<O&&Math.abs(F[6]-f[6])<O&&Math.abs(F[7]-f[7])<O&&Math.abs(F[8]-f[8])<O}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.pf.join(", ")})`}}},13456:(K,O,F)=>{"use strict";var f;function r(K,O,F,f){switch(O){case"Animation":return f?K.animations.find((K=>K.uniqueId===F))??null:K.animations[F]??null;case"AnimationGroup":return f?K.animationGroups.find((K=>K.uniqueId===F))??null:K.animationGroups[F]??null;case"Mesh":return f?K.meshes.find((K=>K.uniqueId===F))??null:K.meshes[F]??null;case"Material":return f?K.materials.find((K=>K.uniqueId===F))??null:K.materials[F]??null;case"BM":return f?K.cameras.find((K=>K.uniqueId===F))??null:K.cameras[F]??null;case"Light":return f?K.lights.find((K=>K.uniqueId===F))??null:K.lights[F]??null;default:return null}}F.d(O,{b:()=>r}),function(K){K.Animation="Animation",K.AnimationGroup="AnimationGroup",K.Mesh="Mesh",K.Material="Material",K.BM="BM",K.Light="Light"}(f||(f={}))},13487:(K,O,F)=>{"use strict";F.d(O,{e:()=>r});var f=F(13493);class r extends f.d{constructor(K,O){if(super(K),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),O)for(const F of O)this._eventsSignalOutputs[F]=this._registerSignalOutput(F+"Event")}_executeOnTick(K){}_startPendingTasks(K){K._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(K),this._resetAfterCanceled(K)),this._preparePendingTasks(K),K._addPendingBlock(this),this.out._activateSignal(K),K._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(K){K._deleteExecutionVariable(this,"_initialized"),K._removePendingBlock(this)}}},13471:(K,O,F)=>{"use strict";F.d(O,{e:()=>E});var f=F(11664),r=F(11661),l=F(13473),q=F(11523),J=F(13431);class c extends l.c{constructor(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:f.defaultValue,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(K,O,F),this.richType=f,this._defaultValue=r,this._optional=l,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new q.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(K){this._isDisabled!==K&&(this._isDisabled=K,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(K,O){O._getConnectionValue(this)!==K&&(O._setConnectionValue(this,K),this.onValueChangedObservable.notifyObservers(K))}resetToDefaultValue(K){K._setConnectionValue(this,this._defaultValue)}connectTo(K){this._isDisabled||super.connectTo(K)}_getValueOrDefault(K){const O=K._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(O):O}getValue(K){if(1===this.connectionType){K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(K);const O=this._getValueOrDefault(K);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}const O=this.isConnected()?this._connectedPoint[0].getValue(K):this._getValueOrDefault(K);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.richType={},this.richType.serialize(K.richType),K.optional=this._optional,(0,J.h)("defaultValue",this._defaultValue,K)}}(0,r.g)("FlowGraphDataConnection",c);class E{constructor(K){var O;this.config=K,this.uniqueId=(0,f.d)(),this.name=(null===(O=this.config)||void 0===O?void 0:O.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(K){}registerDataInput(K,O,F){const f=new c(K,0,this,O,F);return this.dataInputs.push(f),f}registerDataOutput(K,O,F){const f=new c(K,1,this,O,F);return this.dataOutputs.push(f),f}getDataInput(K){return this.dataInputs.find((O=>O.name===K))}getDataOutput(K){return this.dataOutputs.find((O=>O.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.h;if(K.uniqueId=this.uniqueId,K.config={},this.config){const F=this.config,f=Object.keys(F);for(const r of f)O(r,F[r],K.config)}K.dataInputs=[],K.dataOutputs=[],K.className=this.getClassName();for(const F of this.dataInputs){const O={};F.serialize(O),K.dataInputs.push(O)}for(const F of this.dataOutputs){const O={};F.serialize(O),K.dataOutputs.push(O)}}deserialize(K){}_log(K,O,F){var f;null===(f=K.logger)||void 0===f||f.addLogItem({action:O,TF:F,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13473:(K,O,F)=>{"use strict";F.d(O,{c:()=>l});var f,r=F(11664);!function(K){K[K.Input=0]="Input",K[K.Output=1]="Output"}(f||(f={}));class l{constructor(K,O,F){this._ownerBlock=F,this._connectedPoint=[],this.uniqueId=(0,r.d)(),this.connectedPointIds=[],this.name=K,this._connectionType=O}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(K){if(this._connectionType===K._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||K._isSingularConnection()&&K._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(K),K._connectedPoint.push(this)}disconnectFrom(K){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const F=this._connectedPoint.indexOf(K),f=K._connectedPoint.indexOf(this);-1!==F&&-1!==f&&(O&&this._connectedPoint.splice(F,1),K._connectedPoint.splice(f,1))}disconnectFromAll(){for(const K of this._connectedPoint)this.disconnectFrom(K,!1);this._connectedPoint.length=0}dispose(){for(const K of this._connectedPoint)this.disconnectFrom(K)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K.uniqueId=this.uniqueId,K.name=this.name,K._connectionType=this._connectionType,K.connectedPointIds=[],K.className=this.getClassName();for(const O of this._connectedPoint)K.connectedPointIds.push(O.uniqueId)}getClassName(){return"FGConnection"}deserialize(K){this.uniqueId=K.uniqueId,this.name=K.name,this._connectionType=K._connectionType,this.connectedPointIds=K.connectedPointIds}}},13426:(K,O,F)=>{"use strict";F.d(O,{b:()=>Z});var f,r=F(11523),l=F(11693),q=F(11698),J=F(11664),c=F(13431),E=F(13456),M=F(11534);!function(K){K.ExecuteBlock="ExecuteBlock",K.ExecuteEvent="ExecuteEvent",K.TriggerConnection="TriggerConnection",K.ContextVariableSet="ContextVariableSet",K.GlobalVariableSet="GlobalVariableSet",K.GlobalVariableDelete="GlobalVariableDelete",K.GlobalVariableGet="GlobalVariableGet",K.AddConnection="AddConnection",K.GetConnectionValue="GetConnectionValue",K.SetConnectionValue="SetConnectionValue",K.ActivateSignal="ActivateSignal",K.ContextVariableGet="ContextVariableGet"}(f||(f={}));class t{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(K){if(K.time||(K.time=Date.now()),this.log.push(K),this.logToConsole){var O;const F=null===(O=K.TF)||void 0===O?void 0:O.value;"object"===typeof F&&F.getClassName?M.c.Log(`[FGLog] ${K.className}:${K.uniqueId.split("-")[0]} ${K.action} - ${JSON.stringify(F.getClassName())}: ${F.toString()}`):M.c.Log(`[FGLog] ${K.className}:${K.uniqueId.split("-")[0]} ${K.action} - ${JSON.stringify(K.TF)}`)}}getItemsOfType(K){return this.log.filter((O=>O.action===K))}}class j{get enableLogging(){return this._enableLogging}set enableLogging(K){this._enableLogging!==K&&(this._enableLogging=K,this._enableLogging?(this.logger=new t,this.logger.logToConsole=!0):this.logger=null)}constructor(K){this.uniqueId=(0,J.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new r.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=K,this.assetsContext=K.assetsContext??K.kO}hasVariable(K){return K in this._userVariables}setVariable(K,O){var F;this._userVariables[K]=O,null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",TF:{name:K,value:O}})}getAsset(K,O){return(0,E.b)(this.assetsContext,K,O)}getVariable(K){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",TF:{name:K,value:this._userVariables[K]}}),this._userVariables[K]}get userVariables(){return this._userVariables}HK(){return this._configuration.kO}_getUniqueIdPrefixedName(K,O){return`${K.uniqueId}_${O}`}_getGlobalContextVariable(K,O){var F;return null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",TF:{name:K,defaultValue:O,possibleValue:this._globalContextVariables[K]}}),this._hasGlobalContextVariable(K)?this._globalContextVariables[K]:O}_setGlobalContextVariable(K,O){var F;null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",TF:{name:K,value:O}}),this._globalContextVariables[K]=O}_deleteGlobalContextVariable(K){var O;null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",TF:{name:K}}),delete this._globalContextVariables[K]}_hasGlobalContextVariable(K){return K in this._globalContextVariables}_setExecutionVariable(K,O,F){this._executionVariables[this._getUniqueIdPrefixedName(K,O)]=F}_getExecutionVariable(K,O,F){return this._hasExecutionVariable(K,O)?this._executionVariables[this._getUniqueIdPrefixedName(K,O)]:F}_deleteExecutionVariable(K,O){delete this._executionVariables[this._getUniqueIdPrefixedName(K,O)]}_hasExecutionVariable(K,O){return this._getUniqueIdPrefixedName(K,O)in this._executionVariables}_hasConnectionValue(K){return K.uniqueId in this._connectionValues}_setConnectionValue(K,O){var F;this._connectionValues[K.uniqueId]=O,null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",TF:{connectionPointId:K.uniqueId,value:O}})}_setConnectionValueByKey(K,O){this._connectionValues[K]=O}_getConnectionValue(K){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",TF:{connectionPointId:K.uniqueId,value:this._connectionValues[K.uniqueId]}}),this._connectionValues[K.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(K){this._pendingBlocks.includes(K)||(this._pendingBlocks.push(K),this._pendingBlocks.sort(((K,O)=>K.priority-O.priority)))}_removePendingBlock(K){const O=this._pendingBlocks.indexOf(K);-1!==O&&this._pendingBlocks.splice(O,1)}_clearPendingBlocks(){for(const K of this._pendingBlocks)K._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(K){var O;this.onNodeExecutedObservable.notifyObservers(K),null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:K.getClassName(),uniqueId:K.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(K){this._setGlobalContextVariable("timeSinceStart",K.timeSinceStart),this._setGlobalContextVariable("deltaTime",K.deltaTime);for(const F of this._pendingBlocks){var O;null===(O=F._executeOnTick)||void 0===O||O.call(F,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.h;K.uniqueId=this.uniqueId,K._userVariables={};for(const f in this._userVariables)O(f,this._userVariables[f],K._userVariables);K._connectionValues={};for(const f in this._connectionValues)O(f,this._connectionValues[f],K._connectionValues);var F;this.assetsContext!==this.HK()&&(K._assetsContext={meshes:this.assetsContext.meshes.map((K=>K.id)),materials:this.assetsContext.materials.map((K=>K.id)),textures:this.assetsContext.textures.map((K=>K.name)),animations:this.assetsContext.animations.map((K=>K.name)),lights:this.assetsContext.lights.map((K=>K.id)),cameras:this.assetsContext.cameras.map((K=>K.id)),cX:null===(F=this.assetsContext.cX)||void 0===F?void 0:F.map((K=>K.name)),skeletons:this.assetsContext.skeletons.map((K=>K.id)),pj:this.assetsContext.pj.map((K=>K.name)),geometries:this.assetsContext.geometries.map((K=>K.id)),multiMaterials:this.assetsContext.multiMaterials.map((K=>K.id)),transformNodes:this.assetsContext.transformNodes.map((K=>K.id))})}getClassName(){return"FlowGraphContext"}}(0,l.c)([(0,q.N)()],j.prototype,"uniqueId",void 0);var X=F(13465),u=F(12006);class T{constructor(K){this.onEventTriggeredObservable=new r.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=K,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Wf.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const K=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",TF:{timeSinceStart:this._startingTime,deltaTime:K}}),this._startingTime+=K})),this._meshPickedObserver=this._scene.onPointerObservable.add((K=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",TF:K})}),u.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((K=>{const O=K.pointerId,F=K.mesh,f=this._pointerUnderMeshState[O];!f&&F?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",TF:{pointerId:O,mesh:F}}):f&&!F?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",TF:{pointerId:O,mesh:f}}):f&&F&&f!==F&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",TF:{pointerId:O,mesh:f,over:F}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",TF:{pointerId:O,mesh:F,out:f}})),this._pointerUnderMeshState[O]=F}),u.e.POINTERMOVE)}dispose(){var K,O,F,f,r;null===(K=this._sceneDisposeObserver)||void 0===K||K.remove(),null===(O=this._sceneReadyObserver)||void 0===O||O.remove(),null===(F=this._sceneOnBeforeRenderObserver)||void 0===F||F.remove(),null===(f=this._meshPickedObserver)||void 0===f||f.remove(),null===(r=this._meshUnderPointerObserver)||void 0===r||r.remove(),this.onEventTriggeredObservable.clear()}}var o,k=F(13479);!function(K){K[K.Stopped=0]="Stopped",K[K.Started=1]="Started"}(o||(o={}));class N{get state(){return this._state}set state(K){this._state=K,this.onStateChangedObservable.notifyObservers(K)}constructor(K){this.onStateChangedObservable=new r.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=K.kO,this._sceneEventCoordinator=new T(this._scene),this._coordinator=K.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((K=>{for(const O of this._executionContexts){const F=this._getContextualOrder(K.type,O);for(const f of F)if(!f._executeEvent(O,K.TF))break}switch(K.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const O of this._executionContexts)O._notifyOnTick(K.TF);break;case"SceneDispose":this.dispose()}}))}createContext(){const K=new j({kO:this._scene,coordinator:this._coordinator});return this._executionContexts.push(K),K}getContext(K){return this._executionContexts[K]}addEventBlock(K){if("PointerOver"!==K.type&&"PointerOut"!==K.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==K.type&&this._eventBlocks[K.type].push(K),1===this.state)for(const O of this._executionContexts)K._startPendingTasks(O);else this.onStateChangedObservable.addOnce((O=>{if(1===O)for(const F of this._executionContexts)K._startPendingTasks(F)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((K=>{1===K&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const K of this._executionContexts)for(const O in this._eventBlocks){const F=this._getContextualOrder(O,K);for(const O of F)O._startPendingTasks(K)}}_getContextualOrder(K,O){const F=this._eventBlocks[K].sort(((K,O)=>O.initPriority-K.initPriority));if("MeshPick"===K){const K=[];for(const f of F){const r=f.asset.getValue(O);let l=0;for(;l<F.length;l++){const K=F[l].asset.getValue(O);if(r&&K&&(0,k.o)(r,K))break}K.splice(l,0,f)}return K}return F}dispose(){var K;if(0!==this.state){this.state=0;for(const K of this._executionContexts)K._clearPendingBlocks();this._executionContexts.length=0;for(const K in this._eventBlocks)this._eventBlocks[K].length=0;null===(K=this._eventObserver)||void 0===K||K.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(K){const O=[],F=new Set;for(const f in this._eventBlocks)for(const K of this._eventBlocks[f])O.push(K),F.add(K.uniqueId);for(;O.length>0;){const f=O.pop();K(f);for(const K of f.dataInputs)for(const f of K._connectedPoint)F.has(f._ownerBlock.uniqueId)||(O.push(f._ownerBlock),F.add(f._ownerBlock.uniqueId));if(f instanceof X.c)for(const K of f.signalOutputs)for(const f of K._connectedPoint)F.has(f._ownerBlock.uniqueId)||(O.push(f._ownerBlock),F.add(f._ownerBlock.uniqueId))}}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1?arguments[1]:void 0;K.allBlocks=[],this.visitAllBlocks((O=>{const F={};O.serialize(F),K.allBlocks.push(F)})),K.executionContexts=[];for(const F of this._executionContexts){const f={};F.serialize(f,O),K.executionContexts.push(f)}}}class Z{constructor(K){this.config=K,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.kO.Wf.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.kO.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const K=this._executeOnNextFrame.slice(0);if(K.length)for(const O of K){this.notifyCustomEvent(O.id,O.data,!1);const K=this._executeOnNextFrame.findIndex((K=>K.uniqueId===O.uniqueId));-1!==K&&this._executeOnNextFrame.splice(K,1)}}));(Z.SceneCoordinators.get(this.config.kO)??[]).push(this)}createGraph(){const K=new N({kO:this.config.kO,coordinator:this});return this._flowGraphs.push(K),K}removeGraph(K){const O=this._flowGraphs.indexOf(K);-1!==O&&(K.dispose(),this._flowGraphs.splice(O,1))}start(){for(const K of this._flowGraphs)K.start()}dispose(){var K,O;for(const r of this._flowGraphs)r.dispose();this._flowGraphs.length=0,null===(K=this._disposeObserver)||void 0===K||K.remove(),null===(O=this._onBeforeRenderObserver)||void 0===O||O.remove();const F=Z.SceneCoordinators.get(this.config.kO)??[],f=F.indexOf(this);-1!==f&&F.splice(f,1)}serialize(K,O){K._flowGraphs=[];for(const F of this._flowGraphs){const f={};F.serialize(f,O),K._flowGraphs.push(f)}K.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(K){let O=this._customEventsMap.get(K);return O||(O=new r.c,this._customEventsMap.set(K,O)),O}notifyCustomEvent(K,O){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:K,data:O,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(K)){const O=this._eventExecutionCounter.get(K);if(this._eventExecutionCounter.set(K,O+1),O>=Z.MaxEventTypeExecutionPerFrame)return void(O===Z.MaxEventTypeExecutionPerFrame&&M.c.Warn(`FlowGraphCoordinator: Too many executions of event "${K}".`))}else this._eventExecutionCounter.set(K,1);const F=this._customEventsMap.get(K);F&&F.notifyObservers(O)}}Z.MaxEventsPerType=30,Z.MaxEventTypeExecutionPerFrame=30,Z.SceneCoordinators=new Map},13485:(K,O,F)=>{"use strict";F.d(O,{d:()=>r});var f=F(13487);class r extends f.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(K){K._notifyExecuteNode(this),this.done._activateSignal(K)}}},13465:(K,O,F)=>{"use strict";F.d(O,{c:()=>J});var f=F(13471),r=F(13473),l=F(11661);class q extends r.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(K){super.connectTo(K),this._connectedPoint.sort(((K,O)=>O.priority-K.priority))}_activateSignal(K){var O;if(null===(O=K.logger)||void 0===O||O.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,TF:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(K,this),K._increaseExecutionId();else for(const F of this._connectedPoint)F._activateSignal(K)}}(0,l.g)("FlowGraphSignalConnection",q);class J extends f.e{constructor(K){super(K),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(K){const O=new q(K,0,this);return this.signalInputs.push(O),O}_registerSignalOutput(K){const O=new q(K,1,this);return this.signalOutputs.push(O),O}_unregisterSignalInput(K){const O=this.signalInputs.findIndex((O=>O.name===K));-1!==O&&(this.signalInputs[O].dispose(),this.signalInputs.splice(O,1))}_unregisterSignalOutput(K){const O=this.signalOutputs.findIndex((O=>O.name===K));-1!==O&&(this.signalOutputs[O].dispose(),this.signalOutputs.splice(O,1))}_reportError(K,O){this.error.TF="string"===typeof O?new Error(O):O,this.error._activateSignal(K)}getSignalInput(K){return this.signalInputs.find((O=>O.name===K))}getSignalOutput(K){return this.signalOutputs.find((O=>O.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.signalInputs=[],K.signalOutputs=[];for(const O of this.signalInputs){const F={};O.serialize(F),K.signalInputs.push(F)}for(const O of this.signalOutputs){const F={};O.serialize(F),K.signalOutputs.push(F)}}deserialize(K){for(let O=0;O<K.signalInputs.length;O++){const F=this.getSignalInput(K.signalInputs[O].name);if(!F)throw new Error("Could not find signal input with name "+K.signalInputs[O].name+" in block "+K.className);F.deserialize(K.signalInputs[O])}for(let O=0;O<K.signalOutputs.length;O++){const F=this.getSignalOutput(K.signalOutputs[O].name);if(!F)throw new Error("Could not find signal output with name "+K.signalOutputs[O].name+" in block "+K.className);F.deserialize(K.signalOutputs[O])}}getClassName(){return"FlowGraphExecutionBlock"}}},13493:(K,O,F)=>{"use strict";F.d(O,{d:()=>r});var f=F(13465);class r extends f.c{constructor(K){super(K),this.out=this._registerSignalOutput("out")}}},13441:(K,O,F)=>{"use strict";F.d(O,{B:()=>u,E:()=>T,G:()=>e,H:()=>W,J:()=>H,L:()=>g,d:()=>E,e:()=>j,i:()=>a,l:()=>o,n:()=>k,r:()=>N,s:()=>t,u:()=>d,y:()=>M,z:()=>X});var f,r=F(11713),l=F(11764),q=F(13435),J=F(13450);!function(K){K.Any="any",K.String="string",K.Number="number",K.Boolean="boolean",K.Object="object",K.Integer="FlowGraphInteger",K.Vector2="Vector2",K.TO="TO",K.Vector4="Vector4",K.Quaternion="Quaternion",K.Matrix="Matrix",K.Matrix2D="Matrix2D",K.Matrix3D="Matrix3D",K.ZO="ZO",K.kJ="kJ"}(f||(f={}));class c{constructor(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=K,this.defaultValue=O,this.animationType=F}serialize(K){K.typeName=this.typeName,K.defaultValue=this.defaultValue}}const E=new c("any",void 0),M=new c("string",""),t=new c("number",0,0),j=new c("boolean",!1),X=new c("Vector2",r.Vector2.Zero(),5),u=new c("TO",r.TO.Zero(),1),T=new c("Vector4",r.Vector4.Zero()),o=new c("Matrix",r.Matrix.Identity(),3),k=new c("Matrix2D",new J.c),N=new c("Matrix3D",new J.f),Z=new c("ZO",l.ZO.Black(),4),L=new c("kJ",new l.kJ(0,0,0,0),7),d=new c("Quaternion",r.Quaternion.Identity(),2);d.typeTransformer=K=>{if(K.getClassName){if("Vector4"===K.getClassName())return r.Quaternion.LO(K.hf());if("TO"===K.getClassName())return r.Quaternion.FromEulerVector(K);if("Matrix"===K.getClassName())return r.Quaternion.FromRotationMatrix(K)}return K};const a=new c("FlowGraphInteger",new q.d(0),0);function g(K){const O=K;switch(typeof K){case"string":return M;case"number":return t;case"boolean":return j;case"object":if(O.getClassName)switch(O.getClassName()){case"Vector2":return X;case"TO":return u;case"Vector4":return T;case"Matrix":return o;case"ZO":return Z;case"kJ":return L;case"Quaternion":return d;case"FlowGraphInteger":return a;case"Matrix2D":return k;case"Matrix3D":return N}return E;default:return E}}function H(K){switch(K){case"string":return M;case"number":return t;case"boolean":return j;case"Vector2":return X;case"TO":return u;case"Vector4":return T;case"Matrix":return o;case"ZO":return Z;case"kJ":return L;case"Quaternion":return d;case"FlowGraphInteger":return a;case"Matrix2D":return k;case"Matrix3D":return N;default:return E}}function e(K){switch(K){case"number":default:return 0;case"Vector2":return 5;case"TO":return 1;case"Matrix":return 3;case"ZO":return 4;case"kJ":return 7;case"Quaternion":return 2}}function W(K){switch(K){case 0:return t;case 5:return X;case 1:return u;case 3:return o;case 4:return Z;case 7:return L;case 2:return d;default:return E}}},13431:(K,O,F)=>{"use strict";F.d(O,{d:()=>M,h:()=>E,j:()=>t});var f=F(11764),r=F(11713),l=F(13435),q=F(13441),J=F(13450);function c(K){return"Vector2"===K||"TO"===K||"Vector4"===K||"Quaternion"===K||"ZO"===K||"kJ"===K}function E(K,O,F){var f;const r=(null===O||void 0===O||null===(f=O.getClassName)||void 0===f?void 0:f.call(O))??"";if(c(r)||function(K){return"Matrix"===K||"Matrix2D"===K||"Matrix3D"===K}(r))F[K]={value:O.hf(),className:r};else if("FlowGraphInteger"===r)F[K]={value:O.value,className:r};else if(r&&(O.id||O.name))F[K]={id:O.id,name:O.name,className:r};else{if("object"===typeof O)throw new Error(`Could not serialize value ${O}`);F[K]=O}}function M(K,O,F,E){const t=O[K];let j;const X=(null===t||void 0===t?void 0:t.type)??(null===t||void 0===t?void 0:t.className);if(function(K){return"Mesh"===K||"AbstractMesh"===K||"GroundMesh"===K||"InstanceMesh"===K||"LinesMesh"===K||"GoldbergMesh"===K||"GreasedLineMesh"===K||"TrailMesh"===K}(X)){let K=E.meshes.filter((K=>t.id?K.id===t.id:K.name===t.name));0===K.length&&(K=E.transformNodes.filter((K=>t.id?K.id===t.id:K.name===t.name))),j=t.uniqueId?K.find((K=>K.uniqueId===t.uniqueId)):K[0]}else if(c(X))j=function(K,O){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===K)return r.Vector2.LO(O);if("TO"===K)return F&&(O[2]*=-1),r.TO.LO(O);if("Vector4"===K)return r.Vector4.LO(O);if("Quaternion"===K)return F&&(O[2]*=-1,O[3]*=-1),r.Quaternion.LO(O);if("ZO"===K)return new f.ZO(O[0],O[1],O[2]);if("kJ"===K)return new f.kJ(O[0],O[1],O[2],O[3]);throw new Error(`Unknown vector class name ${K}`)}(X,t.value);else if(function(K){return"AnimationGroup"===K}(X)){const K=E.animationGroups.filter((K=>K.name===t.name));j=1===K.length?K[0]:K.find((K=>K.uniqueId===t.uniqueId))}else j="Matrix"===X?r.Matrix.LO(t.value):"Matrix2D"===X?new J.c(t.value):"Matrix3D"===X?new J.f(t.value):"FlowGraphInteger"===X?l.d.FromValue(t.value):"number"===X||"string"===X||"boolean"===X?t.value[0]:t&&void 0!==t.value?t.value:Array.isArray(t)?t.reduce(((K,O)=>O.eventData?(K[O.id]={type:(0,q.J)(O.type)},"undefined"!==typeof O.value&&(K[O.id].value=M("value",O,F,E)),K):K),{}):t;return j}function t(K){return"FlowGraphJsonPointerParserBlock"===K}},13479:(K,O,F)=>{"use strict";function f(K,O){return!(!K.parent||K.parent!==O&&!f(K.parent,O))}function r(K){if(K.getClassName)return K.getClassName()}function l(K,O){return K===O&&("Vector2"===K||"TO"===K||"Vector4"===K||"Quaternion"===K)}function q(K,O){return K===O&&("Matrix"===K||"Matrix2D"===K||"Matrix3D"===K)}function J(K,O){return"FlowGraphInteger"===K&&"FlowGraphInteger"===O}function c(K,O){const F="number"===typeof K||"number"===typeof(null===K||void 0===K?void 0:K.value);return F&&!O?!isNaN(E(K)):F}function E(K){return"number"===typeof K?K:K.value}F.d(O,{d:()=>J,g:()=>q,h:()=>l,k:()=>r,o:()=>f,r:()=>E,s:()=>c})},12845:(K,O,F)=>{"use strict";F.r(O),F.d(O,{SceneInstrumentation:()=>l});var f=F(11517),r=F(11945);class l{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(K){K!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=K,K?(this._onBeforeActiveMeshesEvaluationObserver=this.kO.onBeforeActiveMeshesEvaluationObservable.add((()=>{f.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.kO.onAfterActiveMeshesEvaluationObservable.add((()=>{f.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.kO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.kO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(K){K!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=K,K?(this._onBeforeRenderTargetsRenderObserver=this.kO.onBeforeRenderTargetsRenderObservable.add((()=>{f.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.kO.onAfterRenderTargetsRenderObservable.add((()=>{f.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.kO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.kO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(K){K!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=K,K?(this._onBeforeParticlesRenderingObserver=this.kO.onBeforeParticlesRenderingObservable.add((()=>{f.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.kO.onAfterParticlesRenderingObservable.add((()=>{f.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.kO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.kO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(K){K!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=K,this.kO.spriteManagers&&(K?(this._onBeforeSpritesRenderingObserver=this.kO.onBeforeSpritesRenderingObservable.add((()=>{f.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.kO.onAfterSpritesRenderingObservable.add((()=>{f.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.kO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.kO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(K){K!==this._capturePhysicsTime&&this.kO.onBeforePhysicsObservable&&(this._capturePhysicsTime=K,K?(this._onBeforePhysicsObserver=this.kO.onBeforePhysicsObservable.add((()=>{f.Tools.StartPerformanceCounter("Jc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.kO.onAfterPhysicsObservable.add((()=>{f.Tools.EndPerformanceCounter("Jc"),this._physicsTime.endMonitoring()}))):(this.kO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.kO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(K){K!==this._captureAnimationsTime&&(this._captureAnimationsTime=K,K?this._onAfterAnimationsObserver=this.kO.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.kO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(K){this._captureFrameTime=K}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(K){this._captureInterFrameTime=K}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(K){K!==this._captureRenderTime&&(this._captureRenderTime=K,K?(this._onBeforeDrawPhaseObserver=this.kO.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),f.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.kO.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),f.Tools.EndPerformanceCounter("Main render")}))):(this.kO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.kO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(K){K!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=K,K?(this._onBeforeCameraRenderObserver=this.kO.onBeforeCameraRenderObservable.add((K=>{this._cameraRenderTime.beginMonitoring(),f.Tools.StartPerformanceCounter(`Rendering camera ${K.name}`)})),this._onAfterCameraRenderObserver=this.kO.onAfterCameraRenderObservable.add((K=>{this._cameraRenderTime.endMonitoring(!1),f.Tools.EndPerformanceCounter(`Rendering camera ${K.name}`)}))):(this.kO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.kO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.kO.getEngine()._drawCalls}constructor(K){this.kO=K,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new r.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new r.d,this._captureFrameTime=!1,this._frameTime=new r.d,this._captureRenderTime=!1,this._renderTime=new r.d,this._captureInterFrameTime=!1,this._interFrameTime=new r.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new r.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new r.d,this._capturePhysicsTime=!1,this._physicsTime=new r.d,this._captureAnimationsTime=!1,this._animationsTime=new r.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new r.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=K.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(f.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.kO.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=K.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(f.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Hf(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Hf(),this._captureParticlesRenderTime&&this._particlesRenderTime.Hf(),this._captureSpritesRenderTime&&this._spritesRenderTime.Hf(),this._captureRenderTime&&this._renderTime.Hf(),this._captureCameraRenderTime&&this._cameraRenderTime.Hf()}))}dispose(){this._disposed||(this.kO.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.kO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.kO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.kO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.kO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.kO.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.kO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.kO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.kO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.kO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.kO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.kO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.kO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.kO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.kO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.kO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.kO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.kO=null,this._disposed=!0)}}},13421:(K,O,F)=>{"use strict";F.d(O,{d:()=>M});var f=F(11693),r=F(11698),l=F(11713),q=F(12157),J=F(12281),c=F(12341),E=F(11661);q.c.AddNodeConstructor("Light_Type_1",((K,O)=>()=>new M(K,l.TO.Zero(),O)));class M extends c.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(K){this._shadowFrustumSize=K,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(K){this._shadowOrthoScale=K,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(K){this._orthoLeft=K}get orthoRight(){return this._orthoRight}set orthoRight(K){this._orthoRight=K}get orthoTop(){return this._orthoTop}set orthoTop(K){this._orthoTop=K}get orthoBottom(){return this._orthoBottom}set orthoBottom(K){this._orthoBottom=K}constructor(K,O,F){super(K,F),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=O.scale(-1),this.direction=O}getClassName(){return"cc"}getTypeID(){return J.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(K,O,F){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(K):this._setDefaultAutoExtendShadowProjectionMatrix(K,O,F)}_setDefaultFixedFrustumShadowProjectionMatrix(K){const O=this.HK().activeCamera;O&&l.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:O.if,void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,K,this.HK().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(K,O,F){const f=this.HK().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const K=l.TO.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let f=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let q=0;q<F.length;q++){const J=F[q];if(!J)continue;const c=J.getBoundingInfo().boundingBox;for(let F=0;F<c.vectorsWorld.length;F++)l.TO.TransformCoordinatesToRef(c.vectorsWorld[F],O,K),K.x<this._orthoLeft&&(this._orthoLeft=K.x),K.y<this._orthoBottom&&(this._orthoBottom=K.y),K.x>this._orthoRight&&(this._orthoRight=K.x),K.y>this._orthoTop&&(this._orthoTop=K.y),this.autoCalcShadowZBounds&&(K.z<f&&(f=K.z),K.z>r&&(r=K.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=f,this._shadowMaxZ=r)}const r=this._orthoRight-this._orthoLeft,q=this._orthoTop-this._orthoBottom,J=void 0!==this.shadowMinZ?this.shadowMinZ:(null===f||void 0===f?void 0:f.if)||0,c=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===f||void 0===f?void 0:f.maxZ)||1e4,E=this.HK().getEngine().useReverseDepthBuffer;l.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-r*this.shadowOrthoScale,this._orthoRight+r*this.shadowOrthoScale,this._orthoBottom-q*this.shadowOrthoScale,this._orthoTop+q*this.shadowOrthoScale,E?c:J,E?J:c,K,this.HK().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,O){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,O),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,O),this)}transferToNodeMaterialEffect(K,O){return this.computeTransformedInformation()?(K.setFloat3(O,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(K.setFloat3(O,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(K){const O=this._scene.getEngine();return!O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:1}getDepthMaxZ(K){const O=this._scene.getEngine();return O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:1}prepareLightSpecificDefines(K,O){K["DIRLIGHT"+O]=!0}}(0,f.c)([(0,r.N)()],M.prototype,"shadowFrustumSize",null),(0,f.c)([(0,r.N)()],M.prototype,"shadowOrthoScale",null),(0,f.c)([(0,r.N)()],M.prototype,"autoUpdateExtends",void 0),(0,f.c)([(0,r.N)()],M.prototype,"autoCalcShadowZBounds",void 0),(0,f.c)([(0,r.N)("orthoLeft")],M.prototype,"_orthoLeft",void 0),(0,f.c)([(0,r.N)("orthoRight")],M.prototype,"_orthoRight",void 0),(0,f.c)([(0,r.N)("orthoTop")],M.prototype,"_orthoTop",void 0),(0,f.c)([(0,r.N)("orthoBottom")],M.prototype,"_orthoBottom",void 0),(0,E.g)("BABYLON.DirectionalLight",M)},13883:(K,O,F)=>{"use strict";F.d(O,{c:()=>M});var f=F(11693),r=F(11698),l=F(11713),q=F(11764),J=F(12157),c=F(12281),E=F(11661);J.c.AddNodeConstructor("Light_Type_3",((K,O)=>()=>new M(K,l.TO.Zero(),O)));class M extends c.d{constructor(K,O,F){super(K,F),this.groundColor=new q.ZO(0,0,0),this.direction=O||l.TO.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Mc"}setDirectionToTarget(K){return this.direction=l.TO.Normalize(K.oO(l.TO.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(K,O){const F=l.TO.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",F.x,F.y,F.z,0,O),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.LJ),O),this}transferToNodeMaterialEffect(K,O){const F=l.TO.Normalize(this.direction);return K.setFloat3(O,F.x,F.y,F.z),this}Pf(){return this._worldMatrix||(this._worldMatrix=l.Matrix.Identity()),this._worldMatrix}getTypeID(){return c.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(K,O){K["HEMILIGHT"+O]=!0}}(0,f.c)([(0,r.n)()],M.prototype,"groundColor",void 0),(0,f.c)([(0,r.K)()],M.prototype,"direction",void 0),(0,E.g)("BABYLON.HemisphericLight",M)},13391:(K,O,F)=>{"use strict";F.d(O,{c:()=>t});var f=F(11693),r=F(11698),l=F(11713),q=F(12157),J=F(12281),c=F(12341),E=F(11688),M=F(11661);q.c.AddNodeConstructor("Light_Type_2",((K,O)=>()=>new t(K,l.TO.Zero(),l.TO.Zero(),0,0,O)));class t extends c.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(K){this._iesProfileTexture!==K&&(this._iesProfileTexture=K,this._iesProfileTexture&&t._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(K){this._angle=K,this._cosHalfAngle=Math.cos(.5*K),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(K){this._innerAngle=K,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(K){this._shadowAngleScale=K,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(K){this._projectionTextureLightNear=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(K){this._projectionTextureLightFar=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(K){this._projectionTextureUpDirection=K,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(K){this._projectionTexture!==K&&(this._projectionTexture=K,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(t._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):t._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(K){return void 0!==K.onGeneratedObservable}static _IsTexture(K){return void 0!==K.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(K){this._projectionTextureProjectionLightMatrix=K,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(K,O,F,f,r,q){super(K,q),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=l.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=l.TO.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=l.TO.Zero(),this._projectionTextureViewLightMatrix=l.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=l.Matrix.Zero(),this._projectionTextureScalingMatrix=l.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=O,this.direction=F,this.angle=f,this.exponent=r}getClassName(){return"SpotLight"}getTypeID(){return J.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(K){super._setDirection(K),this._projectionTextureViewLightDirty=!0}_setPosition(K){super._setPosition(K),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(K,O,F){const f=this.HK().activeCamera;if(!f)return;this._shadowAngleScale=this._shadowAngleScale||1;const r=this._shadowAngleScale*this._angle,q=void 0!==this.shadowMinZ?this.shadowMinZ:f.if,J=void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,c=this.HK().getEngine().useReverseDepthBuffer;l.Matrix.PerspectiveFovLHToRef(r,1,c?J:q,c?q:J,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,c)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),l.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const K=this.projectionTextureLightFar,O=this.projectionTextureLightNear,F=K/(K-O),f=-F*O,r=1/Math.tan(this._angle/2);l.Matrix.FromValuesToRef(r/1,0,0,0,0,r,0,0,0,0,F,1,0,0,f,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof E.b){const K=this._projectionTexture.uScale/2,O=this._projectionTexture.vScale/2;l.Matrix.FromValuesToRef(K,0,0,0,0,O,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(K,O){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),K.setMatrix("textureProjectionMatrix"+O,this._projectionTextureMatrix),K.setTexture("projectionLightTexture"+O,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&K.setTexture("iesLightTexture"+O,this._iesProfileTexture),this}transferToEffect(K,O){let F;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,O),F=l.TO.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,O),F=l.TO.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",F.x,F.y,F.z,this._cosHalfAngle,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,O),this}transferToNodeMaterialEffect(K,O){let F;return F=this.computeTransformedInformation()?l.TO.Normalize(this.transformedDirection):l.TO.Normalize(this.direction),this.HK().useRightHandedSystem?K.setFloat3(O,-F.x,-F.y,-F.z):K.setFloat3(O,F.x,F.y,F.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(K){const O=this._scene.getEngine(),F=void 0!==this.shadowMinZ?this.shadowMinZ:(null===K||void 0===K?void 0:K.if)??0;return O.useReverseDepthBuffer&&O.isNDCHalfZRange?F:this._scene.getEngine().isNDCHalfZRange?0:F}getDepthMaxZ(K){const O=this._scene.getEngine(),F=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===K||void 0===K?void 0:K.maxZ)??1e4;return O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:F}prepareLightSpecificDefines(K,O){K["SPOTLIGHT"+O]=!0,K["PROJECTEDLIGHTTEXTURE"+O]=!(!this.projectionTexture||!this.projectionTexture.isReady()),K["IESLIGHTTEXTURE"+O]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,f.c)([(0,r.N)()],t.prototype,"angle",null),(0,f.c)([(0,r.N)()],t.prototype,"innerAngle",null),(0,f.c)([(0,r.N)()],t.prototype,"shadowAngleScale",null),(0,f.c)([(0,r.N)()],t.prototype,"exponent",void 0),(0,f.c)([(0,r.N)()],t.prototype,"projectionTextureLightNear",null),(0,f.c)([(0,r.N)()],t.prototype,"projectionTextureLightFar",null),(0,f.c)([(0,r.N)()],t.prototype,"projectionTextureUpDirection",null),(0,f.c)([(0,r.F)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),(0,M.g)("BABYLON.SpotLight",t)},13118:(K,O,F)=>{"use strict";F.d(O,{b:()=>q,e:()=>l,g:()=>J});const f={},r={};function l(K,O){f[K]=O}function q(K,O){r[K]=O}function J(K){return r[K]?r[K]:null}},13008:(K,O,F)=>{"use strict";F.d(O,{b:()=>g,c:()=>m});var f,r=F(11517),l=F(11523),q=F(11964),J=F(11559),c=F(11534),E=F(12211),M=F(11565),t=F(11567),j=F(11664),X=F(11597),u=F(11550);!function(K){K[K.Clean=0]="Clean",K[K.Stop=1]="Stop",K[K.Sync=2]="Sync",K[K.NoSync=3]="NoSync"}(f||(f={}));const T=new l.c,o={};let k=!1;function N(){return o[".babylon"]}function Z(K,O){const F=o[K];return F||(c.c.Warn("Unable to find a plugin to load "+K+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),O?N():void 0)}function L(K,O,F){let f="Unable to load from "+(K.rawData?"binary data":K.url);return O?f+=`: ${O}`:F&&(f+=`: ${F}`),f}async function d(K,O,F,f,r,l,q,J,c){var E;const t="data:"===(j=K.url).substring(0,5)?j.substring(5):null;var j;if(K.rawData&&!q)throw"When using ArrayBufferView to load data the file extension must be provided.";const k=t||q?"":function(K){const O=K.indexOf("?");-1!==O&&(K=K.substring(0,O));const F=K.lastIndexOf(".");return K.substring(F,K.length).toLowerCase()}(K.url);let L=q?Z(q,!0):t?function(K){for(const O in o){const F=o[O].plugin;if(F.canDirectLoad&&F.canDirectLoad(K))return o[O]}return N()}(K.url):Z(k,!1);if(!L&&k){if(K.url&&!K.url.startsWith("blob:")){const O=await async function(K,O){const F=O.method||"GET";return await new Promise(((f,r)=>{const l=new u.e;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const K={};if(O.responseHeaders)for(const F of O.responseHeaders)K[F]=l.getResponseHeader(F)||"";f({response:l.response,headerValues:K})}else r(`Unable to fetch data from ${K}. Error code: ${l.status}`)})),l.open(F,K),l.send()}))}(K.url,{method:"HEAD",responseHeaders:["Content-Type"]}),F=O.headerValues?O.headerValues["Content-Type"]:"";F&&(L=function(K){for(const O in o){const F=o[O];if(F.mimeType===K)return F}}(F))}L||(L=N())}if(!L)throw new Error(`No plugin or fallback for ${q??K.url}`);if(!1===(null===c||void 0===c||null===(E=c[L.plugin.name])||void 0===E?void 0:E.enabled))throw new Error(`The '${L.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(K.rawData&&!L.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(K=>{if(L.plugin.createPlugin){const O=L.plugin.createPlugin(c??{});return O instanceof Promise?(O.then(K).catch((K=>{r("Error instantiating plugin.",K)})),null):(K(O),O)}return K(L.plugin),L.plugin})((c=>{var E;if(!c)throw`The loader plugin corresponding to the '${q}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(T.notifyObservers(c),t&&(c.canDirectLoad&&c.canDirectLoad(K.url)||!(0,M.q)(K.url))){if(c.directLoad){const K=c.directLoad(O,t);K instanceof Promise?K.then((K=>{F(c,K)})).catch((K=>{r("Error in directLoad of _loadData: "+K,K)})):F(c,K)}else F(c,t);return}const j=L.isBinary,u=(K,f)=>{O.M?r("Scene has been disposed"):F(c,K,f)};let o=null,k=!1;null===(E=c.Wf)||void 0===E||E.add((()=>{k=!0,o&&(o.abort(),o=null),l()}));const N=()=>{if(k)return;const F=(K,O)=>{r(null===K||void 0===K?void 0:K.statusText,O)};if(!c.loadFile&&K.rawData)throw"Plugin does not support loading ArrayBufferView.";o=c.loadFile?c.loadFile(O,K.rawData||K.file||K.url,K.rootUrl,u,f,j,F,J):O._loadFile(K.file||K.url,u,f,!0,j,F)},Z=O.getEngine();let d=Z.enableOfflineSupport;if(d){let F=!1;for(const f of O.disableOfflineSupportExceptionRules)if(f.test(K.url)){F=!0;break}d=!F}d&&X.c.OfflineProviderFactory?O.offlineProvider=X.c.OfflineProviderFactory(K.url,N,Z.disableManifestCheck):N()}))}function a(K,O){let F,f,l=null,q=null;if(O)if(O.name)F=`file:${O.name}`,f=O.name,l=O;else if(ArrayBuffer.isView(O))F="",f=(0,j.d)(),q=O;else if(O.startsWith("data:"))F=O,f="";else if(K){const l=O;if("/"===l.substring(0,1))return r.Tools.Error("Wrong sceneFilename parameter"),null;F=K+l,f=l}else F=O,f=r.Tools.GetFilename(O),K=r.Tools.GetFolderPath(O);else F=K,f=r.Tools.GetFilename(K),K=r.Tools.GetFolderPath(K);return{url:F,rootUrl:K,name:f,file:l,rawData:q}}function g(K){if("string"===typeof K.extensions){const O=K.extensions;o[O.toLowerCase()]={plugin:K,isBinary:!1}}else{const O=K.extensions,F=Object.keys(O);for(const f of F)o[f.toLowerCase()]={plugin:K,isBinary:O[f].isBinary,mimeType:O[f].mimeType}}}async function H(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.e.LastCreatedScene,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!f)return c.c.Error("No scene available to import mesh to"),null;const X=a(O,F);if(!X)return null;const u={};f.addPendingData(u);const T=()=>{f.removePendingData(u)},o=(K,O)=>{const F=L(X,K,O);q?q(f,F,new t.h(F,t.g.SceneLoaderError,O)):c.c.Error(F),T()},k=l?K=>{try{l(K)}catch(O){o("Error in onProgress callback: "+O,O)}}:void 0,N=(K,O,F,l,q,J,c,E)=>{if(f.importedMeshesFiles.push(X.url),r)try{r(K,O,F,l,q,J,c,E)}catch(M){o("Error in onSuccess callback: "+M,M)}f.removePendingData(u)};return await d(X,f,((O,F,r)=>{if(O.rewriteRootURL&&(X.rootUrl=O.rewriteRootURL(X.rootUrl,r)),O.importMesh){const r=[],l=[],q=[];if(!O.importMesh(K,f,F,X.rootUrl,r,l,q,o))return;f.loadingPluginName=O.name,N(r,l,q,[],[],[],[],[])}else{O.importMeshAsync(K,f,F,X.rootUrl,k,X.name).then((K=>{f.loadingPluginName=O.name,N(K.meshes,K.pj,K.skeletons,K.animationGroups,K.transformNodes,K.geometries,K.lights,K.spriteManagers)})).catch((K=>{o(K.message,K)}))}}),k,o,T,E,M,j)}async function e(K,O,F,f,r,l,q,J){return await new Promise(((c,E)=>{try{H(K,O,F,f,((K,O,F,f,r,l,q,J)=>{c({meshes:K,pj:O,skeletons:F,animationGroups:f,transformNodes:r,geometries:l,lights:q,spriteManagers:J})}),r,((K,O,F)=>{E(F||new Error(O))}),l,q,J).catch(E)}catch(t){E(t)}}))}async function W(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.e.LastCreatedEngine,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};F?await y(K,O,new q.d(F),f,l,c,E,M,t):r.Tools.Error("No engine available")}async function p(K,O,F,f,r,l,q){return await new Promise(((J,c)=>{W(K,O,F,(K=>{J(K)}),f,((K,O,F)=>{c(F||new Error(O))}),r,l,q)}))}async function y(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.e.LastCreatedScene,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!F)return c.c.Error("No scene available to append to"),null;const X=a(K,O);if(!X)return null;const u={};F.addPendingData(u);const T=()=>{F.removePendingData(u)};E.c.ShowLoadingScreen&&!k&&(k=!0,F.getEngine().displayLoadingUI(),F.executeWhenReady((()=>{F.getEngine().hideLoadingUI(),k=!1})));const o=(K,O)=>{const f=L(X,K,O);l?l(F,f,new t.h(f,t.g.SceneLoaderError,O)):c.c.Error(f),T()},N=r?K=>{try{r(K)}catch(O){o("Error in onProgress callback",O)}}:void 0,Z=()=>{if(f)try{f(F)}catch(K){o("Error in onSuccess callback",K)}F.removePendingData(u)};return await d(X,F,((K,O)=>{if(K.load){if(!K.load(F,O,X.rootUrl,o))return;F.loadingPluginName=K.name,Z()}else{K.loadAsync(F,O,X.rootUrl,N,X.name).then((()=>{F.loadingPluginName=K.name,Z()})).catch((K=>{o(K.message,K)}))}}),N,o,T,q,M,j)}async function A(K,O,F,f,r,l,q){return await new Promise(((J,c)=>{try{y(K,O,F,(K=>{J(K)}),f,((K,O,F)=>{c(F||new Error(O))}),r,l,q).catch(c)}catch(t){c(t)}}))}async function Q(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.e.LastCreatedScene,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!F)return c.c.Error("No scene available to load asset container to"),null;const j=a(K,O);if(!j)return null;const X={};F.addPendingData(X);const u=()=>{F.removePendingData(X)},T=(K,O)=>{const f=L(j,K,O);l?l(F,f,new t.h(f,t.g.SceneLoaderError,O)):c.c.Error(f),u()},o=r?K=>{try{r(K)}catch(O){T("Error in onProgress callback",O)}}:void 0,k=K=>{if(f)try{f(K)}catch(O){T("Error in onSuccess callback",O)}F.removePendingData(X)};return await d(j,F,((K,O)=>{if(K.loadAssetContainer){const f=K.loadAssetContainer(F,O,j.rootUrl,T);if(!f)return;f.populateRootNodes(),F.loadingPluginName=K.name,k(f)}else if(K.loadAssetContainerAsync){K.loadAssetContainerAsync(F,O,j.rootUrl,o,j.name).then((O=>{O.populateRootNodes(),F.loadingPluginName=K.name,k(O)})).catch((K=>{T(K.message,K)}))}else T("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),o,T,u,q,E,M)}async function R(K,O,F,f,r,l,q){return await new Promise(((J,c)=>{try{Q(K,O,F,(K=>{J(K)}),f,((K,O,F)=>{c(F||new Error(O))}),r,l,q).catch(c)}catch(t){c(t)}}))}async function G(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.e.LastCreatedScene,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!F)return void c.c.Error("No scene available to load animations to");if(f){for(const f of F.animatables)f.reset();F.stopAllAnimations();const K=F.animationGroups.slice();for(const F of K)F.dispose();const O=F.getNodes();for(const F of O)F.animations&&(F.animations=[])}else switch(r){case 0:const K=F.animationGroups.slice();for(const O of K)O.dispose();break;case 1:for(const O of F.animationGroups)O.stop();break;case 2:for(const O of F.animationGroups)O.reset(),O.restart();break;case 3:break;default:return void c.c.Error("Unknown animation group loading mode value '"+r+"'")}const u=F.animatables.length;await Q(K,O,F,(K=>{K.mergeAnimationsTo(F,F.animatables.slice(u),l),K.dispose(),F.onAnimationFileImportedObservable.notifyObservers(F),q&&q(F)}),E,M,t,j,X)}async function z(K,O,F,f,r,l,q,J,c,E){return await new Promise(((M,j)=>{try{G(K,O,F,f,r,l,(K=>{M(K)}),q,((K,O,F)=>{j(F||new Error(O))}),J,c,E).catch(j)}catch(t){j(t)}}))}class m{static get ForceFullSceneLoadingForIncremental(){return E.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(K){E.c.ForceFullSceneLoadingForIncremental=K}static get ShowLoadingScreen(){return E.c.ShowLoadingScreen}static set ShowLoadingScreen(K){E.c.ShowLoadingScreen=K}static get loggingLevel(){return E.c.loggingLevel}static set loggingLevel(K){E.c.loggingLevel=K}static get CleanBoneMatrixWeights(){return E.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(K){E.c.CleanBoneMatrixWeights=K}static GetDefaultPlugin(){return N()}static GetPluginForExtension(K){var O;return null===(O=Z(K,!0))||void 0===O?void 0:O.plugin}static IsPluginForExtensionAvailable(K){return function(K){return!!o[K]}(K)}static RegisterPlugin(K){g(K)}static ImportMesh(K,O,F,f,r,l,q,c,E){H(K,O,F,f,r,l,q,c,E).catch((K=>null===q||void 0===q?void 0:q(J.e.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async ImportMeshAsync(K,O,F,f,r,l,q){return await e(K,O,F,f,r,l,q)}static Load(K,O,F,f,r,l,q,c){W(K,O,F,f,r,l,q,c).catch((K=>null===l||void 0===l?void 0:l(J.e.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async LoadAsync(K,O,F,f,r,l){return await p(K,O,F,f,r,l)}static Append(K,O,F,f,r,l,q,c){y(K,O,F,f,r,l,q,c).catch((K=>null===l||void 0===l?void 0:l(F??J.e.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async AppendAsync(K,O,F,f,r,l){return await A(K,O,F,f,r,l)}static LoadAssetContainer(K,O,F,f,r,l,q,c){Q(K,O,F,f,r,l,q,c).catch((K=>null===l||void 0===l?void 0:l(F??J.e.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async LoadAssetContainerAsync(K,O,F,f,r,l){return await R(K,O,F,f,r,l)}static ImportAnimations(K,O,F,f,r,l,q,c,E,M,t){G(K,O,F,f,r,l,q,c,E,M,t).catch((K=>null===E||void 0===E?void 0:E(F??J.e.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async ImportAnimationsAsync(K,O,F,f,r,l,q,J,c,E,M){return await z(K,O,F,f,r,l,J,E,M)}}m.NO_LOGGING=0,m.MINIMAL_LOGGING=1,m.SUMMARY_LOGGING=2,m.DETAILED_LOGGING=3,m.OnPluginActivatedObservable=T},13408:(K,O,F)=>{"use strict";F.d(O,{d:()=>j});var f=F(11693),r=F(11698),l=F(11517),q=F(11713),J=F(11742),c=F(11688),E=F(11661),M=F(11523),t=F(11753);F(13415);class j extends J.c{set boundingBoxSize(K){if(this._boundingBoxSize&&this._boundingBoxSize.equals(K))return;this._boundingBoxSize=K;const O=this.HK();O&&O.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(K){this._rotationY=K,this.setReflectionTextureMatrix(q.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(K,O,F){let f="";for(const r of K)f+=r;return new j(f,O,null,F,K)}static CreateFromPrefilteredData(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=O.useDelayedTextureLoading;O.useDelayedTextureLoading=!1;const l=new j(K,O,null,!1,null,null,null,void 0,!0,F,f);return O.useDelayedTextureLoading=r,l}constructor(K,O){var F;let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8],X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]&&arguments[10],T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,o=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,k=arguments.length>13?arguments[13]:void 0,N=arguments.length>14?arguments[14]:void 0;super(O),this.onLoadObservable=new M.c,this.boundingBoxPosition=q.TO.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new q.Matrix,this._buffer=null,this.name=K,this.url=K,this._noMipmap=r,this.bf=!1,this.isCube=!0,this._textureMatrix=q.Matrix.Identity(),this.coordinatesMode=c.b.CUBIC_MODE;let Z=null,L=null;null===f||Array.isArray(f)?(this._noMipmap=r,this._format=t,this._createPolynomials=u,Z=f,this._loaderOptions=k,this._useSRGBBuffer=N,this._lodScale=T,this._lodOffset=o):(Z=f.extensions??null,this._noMipmap=f.noMipmap??!1,l=f.files??null,L=f.buffer??null,this._format=f.format??5,j=f.prefiltered??!1,X=f.forcedExtension??null,this._createPolynomials=f.createPolynomials??!1,this._lodScale=f.lodScale??.8,this._lodOffset=f.lodOffset??0,this._loaderOptions=f.loaderOptions,this._useSRGBBuffer=f.useSRGBBuffer,J=f.U??null,E=f.onError??null),(K||l)&&this.updateURL(K,X,J,j,E,Z,null===(F=this.HK())||void 0===F?void 0:F.useDelayedTextureLoading,l,L)}getClassName(){return"CubeTexture"}updateURL(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=K),this.url=K,O&&(this._forcedExtension=O);const E=K.lastIndexOf("."),M=O||(E>-1?K.substring(E).toLowerCase():""),t=0===M.indexOf(".dds"),j=0===M.indexOf(".env"),X=0===M.indexOf(".basis");if(j?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=f,f&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),J)this._files=J;else if(X||j||t||l||(l=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,l){for(let O=0;O<l.length;O++)this._files.push(K+l[O]);this._extensions=l}this._buffer=c,q?(this.delayLoadState=4,this._delayedOnLoad=F,this._delayedOnError=r):this._loadTexture(F,r)}delayLoad(K){4===this.delayLoadState&&(K&&(this._forcedExtension=K),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(K){var O,F;if(K.updateFlag===this._textureMatrix.updateFlag)return;K.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(F=this.HK())||void 0===F||F.markAllMaterialsAsDirty(1,(K=>-1!==K.getActiveTextures().indexOf(this))));if(this._textureMatrix=K,null===(O=this.HK())||void 0===O||!O.useRightHandedSystem)return;const f=q.TmpVectors.TO[0],r=q.TmpVectors.Quaternion[0],l=q.TmpVectors.TO[1];this._textureMatrix.decompose(f,r,l),r.z*=-1,r.w*=-1,q.Matrix.ComposeToRef(f,r,l,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var K;return null!==(K=this.HK())&&void 0!==K&&K.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=this.HK(),f=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const r=()=>{var O;(this.onLoadObservable.notifyObservers(this),f)&&(f.dispose(),null===(O=this.HK())||void 0===O||O.markAllMaterialsAsDirty(1));K&&K()},q=(K,F)=>{this._loadingError=!0,this._errorObject={message:K,exception:F},O&&O(K,F),c.b.OnTextureLoadErrorObservable.notifyObservers(this)};var J;this._texture?this._texture.isReady?l.Tools.SetImmediate((()=>r())):this._texture.onLoadedObservable.add((()=>r())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,F,this._lodScale,this._lodOffset,K,q,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,F,this._files,this._noMipmap,K,q,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(J=this._texture)||void 0===J||J.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(K,O,F){const f=t.e.Parse((()=>{let f=!1;return K.prefiltered&&(f=K.prefiltered),new j(F+(K.url??K.name),O,K.extensions,!1,K.files||null,null,null,void 0,f,K.forcedExtension)}),K,O);if(K.boundingBoxPosition&&(f.boundingBoxPosition=q.TO.LO(K.boundingBoxPosition)),K.boundingBoxSize&&(f.boundingBoxSize=q.TO.LO(K.boundingBoxSize)),K.animations)for(let r=0;r<K.animations.length;r++){const O=K.animations[r],F=(0,E.d)("BABYLON.Animation");F&&f.animations.push(F.Parse(O))}return f}clone(){let K=0;const O=t.e.Clone((()=>{const O=new j(this.url,this.HK()||this._getEngine(),this._extensions,this._noMipmap,this._files);return K=O.uniqueId,O}),this);return O.uniqueId=K,O}}(0,f.c)([(0,r.N)()],j.prototype,"url",void 0),(0,f.c)([(0,r.K)()],j.prototype,"boundingBoxPosition",void 0),(0,f.c)([(0,r.K)()],j.prototype,"boundingBoxSize",null),(0,f.c)([(0,r.N)("rotationY")],j.prototype,"rotationY",null),(0,f.c)([(0,r.N)("files")],j.prototype,"_files",void 0),(0,f.c)([(0,r.N)("forcedExtension")],j.prototype,"_forcedExtension",void 0),(0,f.c)([(0,r.N)("extensions")],j.prototype,"_extensions",void 0),(0,f.c)([(0,r.x)("textureMatrix")],j.prototype,"_textureMatrix",void 0),(0,f.c)([(0,r.x)("textureMatrixRefraction")],j.prototype,"_textureMatrixRefraction",void 0),c.b._CubeTextureParser=j.Parse,(0,E.g)("BABYLON.CubeTexture",j)},13894:(K,O,F)=>{"use strict";F.d(O,{b:()=>c});var f=F(11534),r=F(11688),l=F(11673),q=F(11861),J=F(11636);q.ThinEngine.prototype.createDynamicTexture=function(K,O,F,f){const r=new J.e(this,4);return r.baseWidth=K,r.baseHeight=O,F&&(K=this.needPOTTextures?(0,l.c)(K,this._caps.maxTextureSize):K,O=this.needPOTTextures?(0,l.c)(O,this._caps.maxTextureSize):O),r.width=K,r.height=O,r.isReady=!1,r.generateMipMaps=F,r.samplingMode=f,this.updateTextureSamplingMode(f,r),this._internalTexturesCache.push(r),r},q.ThinEngine.prototype.updateDynamicTexture=function(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!K)return;const q=this._gl,J=q.TEXTURE_2D,c=this._bindTextureDirectly(J,K,!0,l);this._unpackFlipY(void 0===F?K.invertY:F),f&&q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const E=this._getWebGLTextureType(K.type),M=this._getInternalFormat(r||K.format),t=this._getRGBABufferInternalSizedFormat(K.type,M);q.texImage2D(J,0,t,M,E,O),K.generateMipMaps&&q.generateMipmap(J),c||this._bindTextureDirectly(J,null),f&&q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),r&&(K.format=r),K._dynamicTextureSource=O,K._premulAlpha=f,K.invertY=F||!1,K.isReady=!0};class c extends r.b{constructor(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,J=arguments.length>6?arguments[6]:void 0;const c=!F||F._isScene;super(null,c?F:null===F||void 0===F?void 0:F.kO,c?!f:F,J,l,void 0,void 0,void 0,void 0,q),this.name=K,this.wrapU=r.b.CLAMP_ADDRESSMODE,this.wrapV=r.b.CLAMP_ADDRESSMODE,this._generateMipMaps=f;const E=this._getEngine();if(!E)return;if(O.getContext)this._canvas=O,this._ownCanvas=!1,this._texture=E.createDynamicTexture(this._canvas.width,this._canvas.height,f,l);else{this._canvas=E.createCanvas(1,1),this._ownCanvas=!0;const K=O;K.width||0===K.width?this._texture=E.createDynamicTexture(K.width,K.height,f,l):this._texture=E.createDynamicTexture(O,O,f,l)}const M=this.getSize();this._canvas.width!==M.width&&(this._canvas.width=M.width),this._canvas.height!==M.height&&(this._canvas.height=M.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(K){this._canvas.width=K.width,this._canvas.height=K.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(K.width,K.height,this._generateMipMaps,this.samplingMode)}scale(K){const O=this.getSize();O.width*=K,O.height*=K,this._recreate(O)}scaleTo(K,O){const F=this.getSize();F.width=K,F.height=O,this._recreate(F)}getContext(){return this._context}clear(K){const O=this.getSize();K&&(this._context.fillStyle=K),this._context.clearRect(0,0,O.width,O.height)}update(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===K||K,O,this._format||void 0,void 0,F)}drawText(K,O,F,f,r,l,q){let J=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const c=this.getSize();if(l&&(this._context.fillStyle=l,this._context.fillRect(0,0,c.width,c.height)),this._context.font=f,null===O||void 0===O){const F=this._context.measureText(K);O=(c.width-F.width)/2}if(null===F||void 0===F){const K=parseInt(f.replace(/\D/g,""));F=c.height/2+K/3.65}this._context.fillStyle=r||"",this._context.fillText(K,O,F),J&&this.update(q)}dispose(){var K,O;(super.dispose(),this._ownCanvas)&&(null===(K=this._canvas)||void 0===K||null===(O=K.remove)||void 0===O||O.call(K));this._canvas=null,this._context=null}clone(){const K=this.HK();if(!K)return this;const O=this.getSize(),F=new c(this.name,O,K,this._generateMipMaps);return F.bf=this.bf,F.level=this.level,F.wrapU=this.wrapU,F.wrapV=this.wrapV,F}serialize(){const K=this.HK();K&&!K.isReady()&&f.c.Warn("The scene must be ready before serializing the dynamic texture");const O=super.serialize();return c._IsCanvasElement(this._canvas)&&(O.base64String=this._canvas.toDataURL()),O.invertY=this._invertY,O.samplingMode=this.samplingMode,O}static _IsCanvasElement(K){return void 0!==K.toDataURL}_rebuild(){this.update()}}},13306:(K,O,F)=>{"use strict";F.d(O,{e:()=>r});var f=F(11688);class r extends f.b{get depth(){return this._depth}constructor(K,O,F,r,l,q){let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:f.b.TRILINEAR_SAMPLINGMODE,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,t=arguments.length>10?arguments[10]:void 0;super(null,q,!J,c),this.format=l,this._texture=q.getEngine().createRawTexture2DArray(K,O,F,r,l,J,c,E,null,M,t),this._depth=r,this.is2DArray=!0}update(K){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,K,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(K,O,F,f,l){return new r(K,O,F,f,5,l,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13140:(K,O,F)=>{"use strict";F.d(O,{c:()=>J,d:()=>c,f:()=>l,g:()=>q});var f=F(11734),r=F(11713);function l(K,O){return`{X: ${K.x.toFixed(O)} Y: ${K.y.toFixed(O)}}`}function q(K,O){return`{X: ${K._x.toFixed(O)} Y: ${K._y.toFixed(O)} Z: ${K._z.toFixed(O)}}`}function J(K,O){return 2*Math.acos((0,f.Clamp)(r.Quaternion.Dot(K,O)))}function c(K,O){const F=new r.Quaternion;return function(K,O,F){const l=r.TO.Cross(K,O),q=Math.acos((0,f.Clamp)(r.TO.Dot(K,O),-1,1));r.Quaternion.RotationAxisToRef(l,q,F)}(K,O,F),F}},12952:(K,O,F)=>{"use strict";F.d(O,{d:()=>E});var f=F(11713),r=F(11764),l=F(12193),q=F(12171),J=F(11777);F(12960);function c(K){let O=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const F=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],l=[];let c=[];const E=K.width||K.size||1,M=K.height||K.size||1,t=K.depth||K.size||1,j=K.wrap||!1;let X=void 0===K.topBaseAt?1:K.topBaseAt,u=void 0===K.bottomBaseAt?0:K.bottomBaseAt;X=(X+4)%4,u=(u+4)%4;let T=[2,0,3,1][X],o=[2,0,1,3][u],k=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(j){O=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],k=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let K=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],F=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const f=[17,18,19,16],r=[22,23,20,21];for(;T>0;)K.unshift(K.pop()),f.unshift(f.pop()),T--;for(;o>0;)F.unshift(F.pop()),r.unshift(r.pop()),o--;K=K.flat(),F=F.flat(),k=k.concat(K).concat(F),O.push(f[0],f[2],f[3],f[0],f[1],f[2]),O.push(r[0],r[2],r[3],r[0],r[1],r[2])}const N=[E/2,M/2,t/2];c=k.reduce(((K,O,F)=>K.concat(O*N[F%3])),[]);const Z=0===K.sideOrientation?0:K.sideOrientation||q.b.DEFAULTSIDE,L=K.faceUV||new Array(6),d=K.faceColors,a=[];for(let q=0;q<6;q++)void 0===L[q]&&(L[q]=new f.Vector4(0,0,1,1)),d&&void 0===d[q]&&(d[q]=new r.kJ(1,1,1,1));for(let f=0;f<6;f++)if(l.push(L[f].z,J.b?1-L[f].w:L[f].w),l.push(L[f].x,J.b?1-L[f].w:L[f].w),l.push(L[f].x,J.b?1-L[f].y:L[f].y),l.push(L[f].z,J.b?1-L[f].y:L[f].y),d)for(let K=0;K<4;K++)a.push(d[f].r,d[f].g,d[f].b,d[f].a);q.b._ComputeSides(Z,c,O,F,l,K.frontUVs,K.backUVs);const g=new q.b;if(g.indices=O,g.WK=c,g.pK=F,g.AK=l,d){const K=Z===q.b.DOUBLESIDE?a.concat(a):a;g.yK=K}return g}function E(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new l.b(K,F);O.sideOrientation=l.b._GetDefaultSideOrientation(O.sideOrientation),f._originalBuilderSideOrientation=O.sideOrientation;return c(O).RK(f,O.updatable),f}q.b.CreateBox=c,l.b.CreateBox=function(K,O){return E(K,{size:O,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13123:(K,O,F)=>{"use strict";F.d(O,{e:()=>J});var f=F(12193),r=F(12171),l=F(11777);function q(K){const O=[],F=[],f=[],q=[],J=K.radius||.5,c=K.tessellation||64,E=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,M=0===K.sideOrientation?0:K.sideOrientation||r.b.DEFAULTSIDE;O.push(0,0,0),q.push(.5,.5);const t=2*Math.PI*E,j=1===E?t/c:t/(c-1);let X=0;for(let r=0;r<c;r++){const K=Math.cos(X),F=Math.sin(X),f=(K+1)/2,r=(1-F)/2;O.push(J*K,J*F,0),q.push(f,l.b?1-r:r),X+=j}1===E&&(O.push(O[3],O[4],O[5]),q.push(q[2],l.b?1-q[3]:q[3]));const u=O.length/3;for(let r=1;r<u-1;r++)F.push(r+1,0,r);r.b.ComputeNormals(O,F,f),r.b._ComputeSides(M,O,F,f,q,K.frontUVs,K.backUVs);const T=new r.b;return T.indices=F,T.WK=O,T.pK=f,T.AK=q,T}function J(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new f.b(K,F);O.sideOrientation=f.b._GetDefaultSideOrientation(O.sideOrientation),r._originalBuilderSideOrientation=O.sideOrientation;return q(O).RK(r,O.updatable),r}r.b.CreateDisc=q,f.b.CreateDisc=function(K,O,F){return J(K,{radius:O,tessellation:F,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12960:(K,O,F)=>{"use strict";F.d(O,{e:()=>o,d:()=>N,i:()=>k});var f=F(11713),r=F(11764),l=F(12193),q=F(12171),J=F(11793);l.b._GroundMeshParser=(K,O)=>c.Parse(K,O);class c extends l.b{constructor(K,O){super(K,O),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=K,this._subdivisionsY=K,this.subdivide(K);const F=this;F.createOrUpdateSubmeshesOctree&&F.createOrUpdateSubmeshesOctree(O)}getHeightAtCoordinates(K,O){const F=this.getWorldMatrix(),r=f.TmpVectors.Matrix[5];F.invertToRef(r);const l=f.TmpVectors.TO[8];if(f.TO.TransformCoordinatesFromFloatsToRef(K,0,O,r,l),K=l.x,O=l.z,K<this._minX||K>=this._maxX||O<=this._minZ||O>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const q=this._getFacetAt(K,O),J=-(q.x*K+q.z*O+q.w)/q.y;return f.TO.TransformCoordinatesFromFloatsToRef(0,J,0,F,l),l.y}getNormalAtCoordinates(K,O){const F=new f.TO(0,1,0);return this.getNormalAtCoordinatesToRef(K,O,F),F}getNormalAtCoordinatesToRef(K,O,F){const r=this.getWorldMatrix(),l=f.TmpVectors.Matrix[5];r.invertToRef(l);const q=f.TmpVectors.TO[8];if(f.TO.TransformCoordinatesFromFloatsToRef(K,0,O,l,q),K=q.x,O=q.z,K<this._minX||K>this._maxX||O<this._minZ||O>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const J=this._getFacetAt(K,O);return f.TO.TransformNormalFromFloatsToRef(J.x,J.y,J.z,r,F),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(K,O){const F=Math.floor((K+this._maxX)*this._subdivisionsX/this._width),f=Math.floor(-(O+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),r=this._heightQuads[f*this._subdivisionsX+F];let l;return l=O<r.slope.x*K+r.slope.y?r.facet1:r.facet2,l}_initHeightQuads(){const K=this._subdivisionsX,O=this._subdivisionsY;this._heightQuads=[];for(let F=0;F<O;F++)for(let O=0;O<K;O++){const r={slope:f.Vector2.Zero(),facet1:new f.Vector4(0,0,0,0),facet2:new f.Vector4(0,0,0,0)};this._heightQuads[F*K+O]=r}return this}_computeHeightQuads(){const K=this.getVerticesData(J.d.PositionKind);if(!K)return this;const O=f.TmpVectors.TO[3],F=f.TmpVectors.TO[2],r=f.TmpVectors.TO[1],l=f.TmpVectors.TO[0],q=f.TmpVectors.TO[4],c=f.TmpVectors.TO[5],E=f.TmpVectors.TO[6],M=f.TmpVectors.TO[7],t=f.TmpVectors.TO[8];let j=0,X=0,u=0,T=0,o=0,k=0,N=0;const Z=this._subdivisionsX,L=this._subdivisionsY;for(let J=0;J<L;J++)for(let L=0;L<Z;L++){j=3*L,X=J*(Z+1)*3,u=(J+1)*(Z+1)*3,O.x=K[X+j],O.y=K[X+j+1],O.z=K[X+j+2],F.x=K[X+j+3],F.y=K[X+j+4],F.z=K[X+j+5],r.x=K[u+j],r.y=K[u+j+1],r.z=K[u+j+2],l.x=K[u+j+3],l.y=K[u+j+4],l.z=K[u+j+5],T=(l.z-O.z)/(l.x-O.x),o=O.z-T*O.x,F.subtractToRef(O,q),r.subtractToRef(O,c),l.subtractToRef(O,E),f.TO.CrossToRef(E,c,M),f.TO.CrossToRef(q,E,t),M.normalize(),t.normalize(),k=-(M.x*O.x+M.y*O.y+M.z*O.z),N=-(t.x*F.x+t.y*F.y+t.z*F.z);const d=this._heightQuads[J*Z+L];d.slope.eq(T,o),d.facet1.eq(M.x,M.y,M.z,k),d.facet2.eq(t.x,t.y,t.z,N)}return this}serialize(K){super.serialize(K),K.subdivisionsX=this._subdivisionsX,K.subdivisionsY=this._subdivisionsY,K.minX=this._minX,K.maxX=this._maxX,K.if=this._minZ,K.maxZ=this._maxZ,K.width=this._width,K.height=this._height}static Parse(K,O){const F=new c(K.name,O);return F._subdivisionsX=K.subdivisionsX||1,F._subdivisionsY=K.subdivisionsY||1,F._minX=K.minX,F._maxX=K.maxX,F._minZ=K.if,F._maxZ=K.maxZ,F._width=K.width,F._height=K.height,F}}var E=F(11517),M=F(11559),t=F(11721),j=F(11777);function X(K){const O=[],F=[],r=[],l=[];let J,c;const E=K.width||K.size||1,M=K.height||K.size||1,t=0|(K.subdivisionsX||K.subdivisions||1),X=0|(K.subdivisionsY||K.subdivisions||1);for(J=0;J<=X;J++)for(c=0;c<=t;c++){const K=new f.TO(c*E/t-E/2,0,(X-J)*M/X-M/2),O=new f.TO(0,1,0);F.push(K.x,K.y,K.z),r.push(O.x,O.y,O.z),l.push(c/t,j.b?J/X:1-J/X)}for(J=0;J<X;J++)for(c=0;c<t;c++)O.push(c+1+(J+1)*(t+1)),O.push(c+1+J*(t+1)),O.push(c+J*(t+1)),O.push(c+(J+1)*(t+1)),O.push(c+1+(J+1)*(t+1)),O.push(c+J*(t+1));const u=new q.b;return u.indices=O,u.WK=F,u.pK=r,u.AK=l,u}function u(K){const O=void 0!==K.xmin&&null!==K.xmin?K.xmin:-1,F=void 0!==K.zmin&&null!==K.zmin?K.zmin:-1,r=void 0!==K.xmax&&null!==K.xmax?K.xmax:1,l=void 0!==K.zmax&&null!==K.zmax?K.zmax:1,J=K.subdivisions||{w:1,h:1},c=K.precision||{w:1,h:1},E=[],M=[],t=[],j=[];let X,u,T,o;J.h=J.h<1?1:J.h,J.w=J.w<1?1:J.w,c.w=c.w<1?1:c.w,c.h=c.h<1?1:c.h;const k=(r-O)/J.w,N=(l-F)/J.h;function Z(K,O,F,r){const l=M.length/3,q=c.w+1;for(X=0;X<c.h;X++)for(u=0;u<c.w;u++){const K=[l+u+X*q,l+(u+1)+X*q,l+(u+1)+(X+1)*q,l+u+(X+1)*q];E.push(K[1]),E.push(K[2]),E.push(K[3]),E.push(K[0]),E.push(K[1]),E.push(K[3])}const J=f.TO.Zero(),T=new f.TO(0,1,0);for(X=0;X<=c.h;X++)for(J.z=X*(r-O)/c.h+O,u=0;u<=c.w;u++)J.x=u*(F-K)/c.w+K,J.y=0,M.push(J.x,J.y,J.z),t.push(T.x,T.y,T.z),j.push(u/c.w,X/c.h)}for(T=0;T<J.h;T++)for(o=0;o<J.w;o++)Z(O+o*k,F+T*N,O+(o+1)*k,F+(T+1)*N);const L=new q.b;return L.indices=E,L.WK=M,L.pK=t,L.AK=j,L}function T(K){const O=[],F=[],l=[],J=[];let c,E;const M=K.colorFilter||new r.ZO(.3,.59,.11),j=K.alphaFilter||0;let X=!1;if(K.minHeight>K.maxHeight){X=!0;const O=K.maxHeight;K.maxHeight=K.minHeight,K.minHeight=O}for(c=0;c<=K.subdivisions;c++)for(E=0;E<=K.subdivisions;E++){const O=new f.TO(E*K.width/K.subdivisions-K.width/2,0,(K.subdivisions-c)*K.height/K.subdivisions-K.height/2),r=4*(((O.x+K.width/2)/K.width*(K.bufferWidth-1)|0)+((1-(O.z+K.height/2)/K.height)*(K.bufferHeight-1)|0)*K.bufferWidth);let q=K.buffer[r]/255,u=K.buffer[r+1]/255,T=K.buffer[r+2]/255;const o=K.buffer[r+3]/255;X&&(q=1-q,u=1-u,T=1-T);const k=q*M.r+u*M.g+T*M.b;O.y=o>=j?K.minHeight+(K.maxHeight-K.minHeight)*k:K.minHeight-t.e,K.heightBuffer&&(K.heightBuffer[c*(K.subdivisions+1)+E]=O.y),F.push(O.x,O.y,O.z),l.push(0,0,0),J.push(E/K.subdivisions,1-c/K.subdivisions)}for(c=0;c<K.subdivisions;c++)for(E=0;E<K.subdivisions;E++){const f=E+1+(c+1)*(K.subdivisions+1),r=E+1+c*(K.subdivisions+1),l=E+c*(K.subdivisions+1),q=E+(c+1)*(K.subdivisions+1),J=F[3*f+1]>=K.minHeight,M=F[3*r+1]>=K.minHeight,t=F[3*l+1]>=K.minHeight;J&&M&&t&&(O.push(f),O.push(r),O.push(l));F[3*q+1]>=K.minHeight&&J&&t&&(O.push(q),O.push(f),O.push(l))}q.b.ComputeNormals(F,O,l);const u=new q.b;return u.indices=O,u.WK=F,u.pK=l,u.AK=J,u}function o(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const F=new c(K,arguments.length>2?arguments[2]:void 0);F._setReady(!1),F._subdivisionsX=O.subdivisionsX||O.subdivisions||1,F._subdivisionsY=O.subdivisionsY||O.subdivisions||1,F._width=O.width||1,F._height=O.height||1,F._maxX=F._width/2,F._maxZ=F._height/2,F._minX=-F._maxX,F._minZ=-F._maxZ;return X(O).RK(F,O.updatable),F._setReady(!0),F}function k(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new l.b(K,F);return u(O).RK(f,O.updatable),f}function N(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const l=F.width||10,q=F.height||10,J=F.subdivisions||1,t=F.minHeight||0,j=F.maxHeight||1,X=F.colorFilter||new r.ZO(.3,.59,.11),u=F.alphaFilter||0,o=F.updatable,k=F.onReady;f=f||M.e.LastCreatedScene;const N=new c(K,f);let Z;N._subdivisionsX=J,N._subdivisionsY=J,N._width=l,N._height=q,N._maxX=N._width/2,N._maxZ=N._height/2,N._minX=-N._maxX,N._minZ=-N._maxZ,N._setReady(!1),F.passHeightBufferInCallback&&(Z=new Float32Array((J+1)*(J+1)));const L=(K,O,F)=>{T({width:l,height:q,subdivisions:J,minHeight:t,maxHeight:j,colorFilter:X,buffer:K,bufferWidth:O,bufferHeight:F,alphaFilter:u,heightBuffer:Z}).RK(N,o),k&&k(N,Z),N._setReady(!0)};if("string"===typeof O){const K=K=>{var O;const F=K.width,r=K.height;if(f.M)return;const l=null===(O=f)||void 0===O?void 0:O.getEngine().resizeImageBitmap(K,F,r);L(l,F,r)};E.Tools.LoadImage(O,K,F.onError?F.onError:()=>{},f.offlineProvider)}else L(O.data,O.width,O.height);return N}q.b.CreateGround=X,q.b.CreateTiledGround=u,q.b.CreateGroundFromHeightMap=T,l.b.CreateGround=(K,O,F,f,r,l)=>o(K,{width:O,height:F,subdivisions:f,updatable:l},r),l.b.CreateTiledGround=(K,O,F,f,r,l,q,J,c)=>k(K,{xmin:O,zmin:F,xmax:f,zmax:r,subdivisions:l,precision:q,updatable:c},J),l.b.CreateGroundFromHeightMap=(K,O,F,f,r,l,q,J,c,E,M)=>N(K,O,{width:F,height:f,subdivisions:r,minHeight:l,maxHeight:q,updatable:c,onReady:E,alphaFilter:M},J)},13615:(K,O,F)=>{"use strict";F.d(O,{c:()=>X,f:()=>t,g:()=>j});var f=F(11713),r=F(12193),l=F(12171),q=F(12286),J=F(11793),c=F(11534);function E(K){const O=[],F=[],f=K.lines,r=K.yK,q=[];let J=0;for(let l=0;l<f.length;l++){const K=f[l];for(let f=0;f<K.length;f++){const{x:c,y:E,z:M}=K[f];if(F.push(c,E,M),r){const K=r[l],{r:O,g:F,b:J,a:c}=K[f];q.push(O,F,J,c)}f>0&&(O.push(J-1),O.push(J)),J++}}const c=new l.b;return c.indices=O,c.WK=F,r&&(c.yK=q),c}function M(K){const O=K.dashSize||3,F=K.gapSize||1,r=K.dashNb||200,q=K.points,J=[],c=[],E=f.TO.Zero();let M=0,t=0,j=0,X=0,u=0,T=0,o=0;for(o=0;o<q.length-1;o++)q[o+1].subtractToRef(q[o],E),M+=E.length();for(j=M/r,X=O*j/(O+F),o=0;o<q.length-1;o++){q[o+1].subtractToRef(q[o],E),t=Math.floor(E.length()/j),E.normalize();for(let K=0;K<t;K++)u=j*K,J.push(q[o].x+u*E.x,q[o].y+u*E.y,q[o].z+u*E.z),J.push(q[o].x+(u+X)*E.x,q[o].y+(u+X)*E.y,q[o].z+(u+X)*E.z),c.push(T,T+1),T+=2}const k=new l.b;return k.WK=J,k.indices=c,k}function t(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=O.instance,r=O.lines,l=O.yK;if(f){const K=f.getVerticesData(J.d.PositionKind);let O,F;l&&(O=f.getVerticesData(J.d.ColorKind));let q=0,c=0;for(let f=0;f<r.length;f++){const J=r[f];for(let r=0;r<J.length;r++)K[q]=J[r].x,K[q+1]=J[r].y,K[q+2]=J[r].z,l&&O&&(F=l[f],O[c]=F[r].r,O[c+1]=F[r].g,O[c+2]=F[r].b,O[c+3]=F[r].a,c+=4),q+=3}return f.updateVerticesData(J.d.PositionKind,K,!1,!1),l&&O&&f.updateVerticesData(J.d.ColorKind,O,!1,!1),f.refreshBoundingInfo(),f}const c=!!l,M=new q.b(K,F,null,void 0,void 0,c,O.useVertexAlpha,O.material);return E(O).RK(M,O.updatable),M}function j(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=O.yK?[O.yK]:null;return t(K,{lines:[O.points],updatable:O.updatable,instance:O.instance,yK:f,useVertexAlpha:O.useVertexAlpha,material:O.material},F)}function X(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=O.points,J=O.instance,E=O.gapSize||1,t=O.dashSize||3;if(J){const K=K=>{const O=f.TO.Zero(),F=K.length/6;let r=0,q=0,c=0,E=0,M=0,t=0,j=0,X=0;for(j=0;j<l.length-1;j++)l[j+1].subtractToRef(l[j],O),r+=O.length();c=r/F;const u=J._creationDataStorage.dashSize;for(E=u*c/(u+J._creationDataStorage.gapSize),j=0;j<l.length-1;j++)for(l[j+1].subtractToRef(l[j],O),q=Math.floor(O.length()/c),O.normalize(),X=0;X<q&&t<K.length;)M=c*X,K[t]=l[j].x+M*O.x,K[t+1]=l[j].y+M*O.y,K[t+2]=l[j].z+M*O.z,K[t+3]=l[j].x+(M+E)*O.x,K[t+4]=l[j].y+(M+E)*O.y,K[t+5]=l[j].z+(M+E)*O.z,t+=6,X++;for(;t<K.length;)K[t]=l[j].x,K[t+1]=l[j].y,K[t+2]=l[j].z,t+=3};return(O.dashNb||O.dashSize||O.gapSize||O.useVertexAlpha||O.material)&&c.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),J.updateMeshPositions(K,!1),J}const j=new q.b(K,F,null,void 0,void 0,void 0,O.useVertexAlpha,O.material);return M(O).RK(j,O.updatable),j._creationDataStorage=new r.c,j._creationDataStorage.dashSize=t,j._creationDataStorage.gapSize=E,j}l.b.CreateLineSystem=E,l.b.CreateDashedLines=M,r.b.iE=function(K,O){return j(K,{points:O,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},r.b.CreateDashedLines=function(K,O,F,f,r){return X(K,{points:O,dashSize:F,gapSize:f,dashNb:r,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13014:(K,O,F)=>{"use strict";F.d(O,{d:()=>J,g:()=>c});var f=F(12193),r=F(12171),l=F(11777);function q(K){const O=[],F=[],f=[],q=[],J=void 0!==K.width?K.width:void 0!==K.size?K.size:1,c=void 0!==K.height?K.height:void 0!==K.size?K.size:1,E=0===K.sideOrientation?0:K.sideOrientation||r.b.DEFAULTSIDE,M=J/2,t=c/2;F.push(-M,-t,0),f.push(0,0,-1),q.push(0,l.b?1:0),F.push(M,-t,0),f.push(0,0,-1),q.push(1,l.b?1:0),F.push(M,t,0),f.push(0,0,-1),q.push(1,l.b?0:1),F.push(-M,t,0),f.push(0,0,-1),q.push(0,l.b?0:1),O.push(0),O.push(1),O.push(2),O.push(0),O.push(2),O.push(3),r.b._ComputeSides(E,F,O,f,q,K.frontUVs,K.backUVs);const j=new r.b;return j.indices=O,j.WK=F,j.pK=f,j.AK=q,j}function J(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=new f.b(K,F);O.sideOrientation=f.b._GetDefaultSideOrientation(O.sideOrientation),r._originalBuilderSideOrientation=O.sideOrientation;return q(O).RK(r,O.updatable),O.sourcePlane&&(r.translate(O.sourcePlane.normal,-O.sourcePlane.d),r.setDirection(O.sourcePlane.normal.scale(-1))),r}const c={UE:J};r.b.UE=q,f.b.UE=(K,O,F,f,r)=>J(K,{size:O,width:O,height:O,sideOrientation:r,updatable:f},F)},13109:(K,O,F)=>{"use strict";F.d(O,{d:()=>c});var f=F(11713),r=F(12193),l=F(12171),q=F(11777);function J(K){const O=0|(K.segments||32),F=K.diameterX||K.diameter||1,r=K.diameterY||K.diameter||1,J=K.diameterZ||K.diameter||1,c=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,E=K.slice&&K.slice<=0?1:K.slice||1,M=0===K.sideOrientation?0:K.sideOrientation||l.b.DEFAULTSIDE,t=!!K.dedupTopBottomIndices,j=new f.TO(F/2,r/2,J/2),X=2+O,u=2*X,T=[],o=[],k=[],N=[];for(let l=0;l<=X;l++){const K=l/X,O=K*Math.PI*E;for(let F=0;F<=u;F++){const r=F/u,l=r*Math.PI*2*c,J=f.Matrix.RotationZ(-O),E=f.Matrix.RotationY(l),M=f.TO.TransformCoordinates(f.TO.Up(),J),t=f.TO.TransformCoordinates(M,E),X=t.multiply(j),T=t.divide(j).normalize();o.push(X.x,X.y,X.z),k.push(T.x,T.y,T.z),N.push(r,q.b?1-K:K)}if(l>0){const K=o.length/3;for(let O=K-2*(u+1);O+u+2<K;O++)t?(l>1&&(T.push(O),T.push(O+1),T.push(O+u+1)),(l<X||E<1)&&(T.push(O+u+1),T.push(O+1),T.push(O+u+2))):(T.push(O),T.push(O+1),T.push(O+u+1),T.push(O+u+1),T.push(O+1),T.push(O+u+2))}}l.b._ComputeSides(M,o,T,k,N,K.frontUVs,K.backUVs);const Z=new l.b;return Z.indices=T,Z.WK=o,Z.pK=k,Z.AK=N,Z}function c(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new r.b(K,F);O.sideOrientation=r.b._GetDefaultSideOrientation(O.sideOrientation),f._originalBuilderSideOrientation=O.sideOrientation;return J(O).RK(f,O.updatable),f}l.b.CreateSphere=J,r.b.CreateSphere=(K,O,F,f,r,l)=>c(K,{segments:O,diameterX:F,diameterY:F,diameterZ:F,sideOrientation:l,updatable:r},f)},13903:(K,O,F)=>{"use strict";F.d(O,{e:()=>J});var f=F(12310),r=F(13417),l=F(12325),q=F(12171);class J{static get Configuration(){return{get decoder(){return r.b.DefaultConfiguration},set decoder(K){r.b.DefaultConfiguration=K}}}static set Configuration(K){r.b.DefaultConfiguration=K.decoder}static get DecoderAvailable(){return(0,f.h)(r.b.DefaultConfiguration)}static get Default(){return J._Default??(J._Default=new J),J._Default}static ResetDefault(K){J._Default&&(K||J._Default.dispose(),J._Default=null)}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultNumWorkers;const O="number"===typeof K?{...r.b.DefaultConfiguration,numWorkers:K}:{...r.b.DefaultConfiguration,...K};this._decoder=new r.b(O)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(K,O,F){return this._decoder.decodeMeshToMeshDataAsync(K,O,F)}async decodeMeshToGeometryAsync(K,O,F,f){return await this._decoder.decodeMeshToGeometryAsync(K,O,F,f)}async _decodeMeshToGeometryForGltfAsync(K,O,F,f,r,l){return await this._decoder._decodeMeshToGeometryForGltfAsync(K,O,F,f,r,l)}async decodeMeshAsync(K,O){const F=await this._decoder.decodeMeshToMeshDataAsync(K,O),f=new q.b;F.indices&&(f.indices=F.indices);for(const r of F.attributes){const K=l.d.GetFloatData(r.data,r.size,l.d.GetDataType(r.data),r.byteOffset,r.byteStride,r.normalized,F.totalVertices);f.set(K,r.kind)}return f}}J.DefaultNumWorkers=(0,f.e)(),J._Default=null},13417:(K,O,F)=>{"use strict";F.d(O,{b:()=>E});var f=F(12310),r=F(11517),l=F(12209),q=F(12325),J=F(11534),c=F(12318);class E extends f.c{static get DefaultAvailable(){return(0,f.h)(E.DefaultConfiguration)}static get Default(){return E._Default??(E._Default=new E),E._Default}static ResetDefault(K){E._Default&&(K||E._Default.dispose(),E._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(K,O){return{module:await(O||DracoDecoderModule)({wasmBinary:K})}}_getWorkerContent(){return`${c.c}(${c.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.DefaultConfiguration)}decodeMeshToMeshDataAsync(K,O,F){const f=K instanceof ArrayBuffer?new Int8Array(K):new Int8Array(K.buffer,K.byteOffset,K.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async K=>await new Promise(((r,l)=>{K.push(((K,q)=>{let c=null;const E=[],M=O=>{K.removeEventListener("error",M),K.removeEventListener("message",t),l(O),q()},t=O=>{const f=O.data;switch(f.id){case"indices":c=f.data;break;case"attribute":E.push({kind:f.kind,data:f.data,size:f.size,byteOffset:f.byteOffset,byteStride:f.byteStride,normalized:(l=f.kind,j=f.normalized,F&&void 0!==F[l]?(j!==F[l]&&J.c.Warn(`Normalized flag from Draco data (${j}) does not match normalized flag from glTF accessor (${F[l]}). Using flag from glTF accessor.`),F[l]):j)});break;case"decodeMeshDone":K.removeEventListener("error",M),K.removeEventListener("message",t),r({indices:c,attributes:E,totalVertices:f.totalVertices}),q()}var l,j};K.addEventListener("error",M),K.addEventListener("message",t);const j=f.slice();K.postMessage({id:"decodeMesh",dataView:j,attributes:O},[j.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((K=>{let F=null;const r=[],l=(0,c.c)(K.module,f,O,(K=>{F=K}),((K,O,F,f,l,q)=>{r.push({kind:K,data:O,size:F,byteOffset:f,byteStride:l,normalized:q})}));return{indices:F,attributes:r,totalVertices:l}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(K,O,F,f){const r=await this.decodeMeshToMeshDataAsync(F,f),J=new l.c(K,O);r.indices&&J.setIndices(r.indices);for(const l of r.attributes)J.setVerticesBuffer(new q.d(O.getEngine(),l.data,l.kind,!1,void 0,l.byteStride,void 0,l.byteOffset,l.size,void 0,l.normalized,!0),r.totalVertices);return J}async _decodeMeshToGeometryForGltfAsync(K,O,F,f,r,J){const c=await this.decodeMeshToMeshDataAsync(F,f,r),E=new l.c(K,O);J&&(E._boundingInfo=J,E.useBoundingInfoFromGeometry=!0),c.indices&&E.setIndices(c.indices);for(const l of c.attributes)E.setVerticesBuffer(new q.d(O.getEngine(),l.data,l.kind,!1,void 0,l.byteStride,void 0,l.byteOffset,l.size,void 0,l.normalized,!0),c.totalVertices);return E}}E.DefaultConfiguration={wasmUrl:`${r.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${r.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${r.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},E._Default=null},13610:(K,O,F)=>{"use strict";F.d(O,{c:()=>JK});var f=F(11713),r=F(12193),l=F(11793),q=F(12171),J=F(11777);function c(K){let O=K.pathArray;const F=K.closeArray||!1,f=K.closePath||!1,r=K.invertUV||!1,c=Math.floor(O[0].length/2);let E=K.offset||c;E=E>c?c:Math.floor(E);const M=0===K.sideOrientation?0:K.sideOrientation||q.b.DEFAULTSIDE,t=K.AK,j=K.yK,X=[],u=[],T=[],o=[],k=[],N=[],Z=[],L=[];let d;const a=[],g=[];let H,e,W;if(O.length<2){const K=[],F=[];for(e=0;e<O[0].length-E;e++)K.push(O[0][e]),F.push(O[0][e+E]);O=[K,F]}let p=0;const y=f?1:0,A=F?1:0;let Q,R,G,z,m,x;for(d=O[0].length,H=0;H<O.length+A;H++){for(Z[H]=0,k[H]=[0],Q=H===O.length?O[0]:O[H],R=Q.length,d=d<R?d:R,W=0;W<R;)X.push(Q[W].x,Q[W].y,Q[W].z),W>0&&(G=Q[W].oO(Q[W-1]).length(),z=G+Z[H],k[H].push(z),Z[H]=z),W++;f&&(W--,X.push(Q[0].x,Q[0].y,Q[0].z),G=Q[W].oO(Q[0]).length(),z=G+Z[H],k[H].push(z),Z[H]=z),a[H]=R+y,g[H]=p,p+=R+y}let V,v,Y=null,B=null;for(e=0;e<d+y;e++)for(L[e]=0,N[e]=[0],H=0;H<O.length-1+A;H++)m=O[H],x=H===O.length-1?O[0]:O[H+1],e===d?(Y=m[0],B=x[0]):(Y=m[e],B=x[e]),G=B.oO(Y).length(),z=G+L[e],N[e].push(z),L[e]=z;if(t)for(H=0;H<t.length;H++)o.push(t[H].x,J.b?1-t[H].y:t[H].y);else for(H=0;H<O.length+A;H++)for(e=0;e<d+y;e++)V=0!=Z[H]?k[H][e]/Z[H]:0,v=0!=L[e]?N[e][H]/L[e]:0,r?o.push(v,V):o.push(V,J.b?1-v:v);H=0;let n=0,C=a[H]-1,I=a[H+1]-1,D=C<I?C:I,h=g[1]-g[0];const b=a.length-1;for(;n<=D&&H<b;)u.push(n,n+h,n+1),u.push(n+h+1,n+1,n+h),n+=1,n===D&&(H++,h=g[H+1]-g[H],C=a[H]-1,I=a[H+1]-1,n=g[H],D=C<I?C+n:I+n);if(q.b.ComputeNormals(X,u,T),f){let K=0,F=0;for(H=0;H<O.length;H++){K=3*g[H],F=H+1<O.length?3*(g[H+1]-1):T.length-3,T[K]=.5*(T[K]+T[F]),T[K+1]=.5*(T[K+1]+T[F+1]),T[K+2]=.5*(T[K+2]+T[F+2]);const f=Math.sqrt(T[K]*T[K]+T[K+1]*T[K+1]+T[K+2]*T[K+2]);T[K]/=f,T[K+1]/=f,T[K+2]/=f,T[F]=T[K],T[F+1]=T[K+1],T[F+2]=T[K+2]}}if(F){let K=3*g[0],F=3*g[O.length];for(e=0;e<d+y;e++){T[K]=.5*(T[K]+T[F]),T[K+1]=.5*(T[K+1]+T[F+1]),T[K+2]=.5*(T[K+2]+T[F+2]);const O=Math.sqrt(T[K]*T[K]+T[K+1]*T[K+1]+T[K+2]*T[K+2]);T[K]/=O,T[K+1]/=O,T[K+2]/=O,T[F]=T[K],T[F+1]=T[K+1],T[F+2]=T[K+2],K+=3,F+=3}}q.b._ComputeSides(M,X,u,T,o,K.frontUVs,K.backUVs);let i=null;if(j){i=new Float32Array(4*j.length);for(let K=0;K<j.length;K++)i[4*K]=j[K].r,i[4*K+1]=j[K].g,i[4*K+2]=j[K].b,i[4*K+3]=j[K].a}const w=new q.b,s=new Float32Array(X),U=new Float32Array(T),P=new Float32Array(o);return w.indices=u,w.WK=s,w.pK=U,w.AK=P,i&&w.set(i,l.d.ColorKind),f&&(w._idx=g),w}function E(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=O.pathArray,M=O.closeArray,t=O.closePath,j=r.b._GetDefaultSideOrientation(O.sideOrientation),X=O.instance,u=O.updatable;if(X){const K=f.TmpVectors.TO[0].oJ(Number.MAX_VALUE),F=f.TmpVectors.TO[1].oJ(-Number.MAX_VALUE),c=O=>{let f=E[0].length;const l=X;let q=0;const J=l._originalBuilderSideOrientation===r.b.DOUBLESIDE?2:1;for(let r=1;r<=J;++r)for(let J=0;J<E.length;++J){const r=E[J],c=r.length;f=f<c?f:c;for(let l=0;l<f;++l){const f=r[l];O[q]=f.x,O[q+1]=f.y,O[q+2]=f.z,K.minimizeInPlaceFromFloats(f.x,f.y,f.z),F.maximizeInPlaceFromFloats(f.x,f.y,f.z),q+=3}if(l._creationDataStorage&&l._creationDataStorage.closePath){const K=r[0];O[q]=K.x,O[q+1]=K.y,O[q+2]=K.z,q+=3}}},M=X.getVerticesData(l.d.PositionKind);if(c(M),X.hasBoundingInfo?X.getBoundingInfo().reConstruct(K,F,X._worldMatrix):X.buildBoundingInfo(K,F,X._worldMatrix),X.updateVerticesData(l.d.PositionKind,M,!1,!1),O.yK){const K=X.getVerticesData(l.d.ColorKind);for(let F=0,f=0;F<O.yK.length;F++,f+=4){const r=O.yK[F];K[f]=r.r,K[f+1]=r.g,K[f+2]=r.b,K[f+3]=r.a}X.updateVerticesData(l.d.ColorKind,K,!1,!1)}if(O.AK){const K=X.getVerticesData(l.d.UVKind);for(let F=0;F<O.AK.length;F++)K[2*F]=O.AK[F].x,K[2*F+1]=J.b?1-O.AK[F].y:O.AK[F].y;X.updateVerticesData(l.d.UVKind,K,!1,!1)}if(!X.areNormalsFrozen||X.isFacetDataEnabled){const K=X.br(),O=X.getVerticesData(l.d.NormalKind),F=X.isFacetDataEnabled?X.getFacetDataParameters():null;if(q.b.ComputeNormals(M,K,O,F),X._creationDataStorage&&X._creationDataStorage.closePath){let K=0,F=0;for(let f=0;f<E.length;f++)K=3*X._creationDataStorage.idx[f],F=f+1<E.length?3*(X._creationDataStorage.idx[f+1]-1):O.length-3,O[K]=.5*(O[K]+O[F]),O[K+1]=.5*(O[K+1]+O[F+1]),O[K+2]=.5*(O[K+2]+O[F+2]),O[F]=O[K],O[F+1]=O[K+1],O[F+2]=O[K+2]}X.areNormalsFrozen||X.updateVerticesData(l.d.NormalKind,O,!1,!1)}return X}{const f=new r.b(K,F);f._originalBuilderSideOrientation=j,f._creationDataStorage=new r.c;const l=c(O);return t&&(f._creationDataStorage.idx=l._idx),f._creationDataStorage.closePath=t,f._creationDataStorage.closeArray=M,l.RK(f,u),f}}q.b.CreateRibbon=c,r.b.CreateRibbon=function(K,O){return E(K,{pathArray:O,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var M=F(13123),t=F(12952),j=F(11764);function X(K){const O=K.pattern||r.b.NO_FLIP,F=K.tileWidth||K.tileSize||1,f=K.tileHeight||K.tileSize||1,l=K.alignHorizontal||0,J=K.alignVertical||0,c=K.width||K.size||1,E=Math.floor(c/F);let M=c-E*F;const t=K.height||K.size||1,j=Math.floor(t/f);let X=t-j*f;const u=F*E/2,T=f*j/2;let o=0,k=0,N=0,Z=0,L=0,d=0;if(M>0||X>0){switch(N=-u,Z=-T,L=u,d=T,l){case r.b.CENTER:M/=2,N-=M,L+=M;break;case r.b.LEFT:L+=M,o=-M/2;break;case r.b.RIGHT:N-=M,o=M/2}switch(J){case r.b.CENTER:X/=2,Z-=X,d+=X;break;case r.b.BOTTOM:d+=X,k=-X/2;break;case r.b.TOP:Z-=X,k=X/2}}const a=[],g=[],H=[];H[0]=[0,0,1,0,1,1,0,1],H[1]=[0,0,1,0,1,1,0,1],O!==r.b.ROTATE_TILE&&O!==r.b.ROTATE_ROW||(H[1]=[1,1,0,1,0,0,1,0]),O!==r.b.FLIP_TILE&&O!==r.b.FLIP_ROW||(H[1]=[1,0,0,0,0,1,1,1]),O!==r.b.FLIP_N_ROTATE_TILE&&O!==r.b.FLIP_N_ROTATE_ROW||(H[1]=[0,1,1,1,1,0,0,0]);let e=[];const W=[],p=[];let y=0;for(let q=0;q<j;q++)for(let K=0;K<E;K++)a.push(K*F-u+o,q*f-T+k,0),a.push((K+1)*F-u+o,q*f-T+k,0),a.push((K+1)*F-u+o,(q+1)*f-T+k,0),a.push(K*F-u+o,(q+1)*f-T+k,0),p.push(y,y+1,y+3,y+1,y+2,y+3),e=O===r.b.FLIP_TILE||O===r.b.ROTATE_TILE||O===r.b.FLIP_N_ROTATE_TILE?e.concat(H[(K%2+q%2)%2]):O===r.b.FLIP_ROW||O===r.b.ROTATE_ROW||O===r.b.FLIP_N_ROTATE_ROW?e.concat(H[q%2]):e.concat(H[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),y+=4;if(M>0||X>0){const K=X>0&&(J===r.b.CENTER||J===r.b.TOP),q=X>0&&(J===r.b.CENTER||J===r.b.BOTTOM),c=M>0&&(l===r.b.CENTER||l===r.b.RIGHT),t=M>0&&(l===r.b.CENTER||l===r.b.LEFT);let H,A,Q,R,G=[];if(K&&c&&(a.push(N+o,Z+k,0),a.push(-u+o,Z+k,0),a.push(-u+o,Z+X+k,0),a.push(N+o,Z+X+k,0),p.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,H=1-M/F,A=1-X/f,Q=1,R=1,G=[H,A,Q,A,Q,R,H,R],O===r.b.ROTATE_ROW&&(G=[1-H,1-A,1-Q,1-A,1-Q,1-R,1-H,1-R]),O===r.b.FLIP_ROW&&(G=[1-H,A,1-Q,A,1-Q,R,1-H,R]),O===r.b.FLIP_N_ROTATE_ROW&&(G=[H,1-A,Q,1-A,Q,1-R,H,1-R]),e=e.concat(G),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K&&t&&(a.push(u+o,Z+k,0),a.push(L+o,Z+k,0),a.push(L+o,Z+X+k,0),a.push(u+o,Z+X+k,0),p.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,H=0,A=1-X/f,Q=M/F,R=1,G=[H,A,Q,A,Q,R,H,R],(O===r.b.ROTATE_ROW||O===r.b.ROTATE_TILE&&E%2===0)&&(G=[1-H,1-A,1-Q,1-A,1-Q,1-R,1-H,1-R]),(O===r.b.FLIP_ROW||O===r.b.FLIP_TILE&&E%2===0)&&(G=[1-H,A,1-Q,A,1-Q,R,1-H,R]),(O===r.b.FLIP_N_ROTATE_ROW||O===r.b.FLIP_N_ROTATE_TILE&&E%2===0)&&(G=[H,1-A,Q,1-A,Q,1-R,H,1-R]),e=e.concat(G),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&c&&(a.push(N+o,T+k,0),a.push(-u+o,T+k,0),a.push(-u+o,d+k,0),a.push(N+o,d+k,0),p.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,H=1-M/F,A=0,Q=1,R=X/f,G=[H,A,Q,A,Q,R,H,R],(O===r.b.ROTATE_ROW&&j%2===1||O===r.b.ROTATE_TILE&&j%1===0)&&(G=[1-H,1-A,1-Q,1-A,1-Q,1-R,1-H,1-R]),(O===r.b.FLIP_ROW&&j%2===1||O===r.b.FLIP_TILE&&j%2===0)&&(G=[1-H,A,1-Q,A,1-Q,R,1-H,R]),(O===r.b.FLIP_N_ROTATE_ROW&&j%2===1||O===r.b.FLIP_N_ROTATE_TILE&&j%2===0)&&(G=[H,1-A,Q,1-A,Q,1-R,H,1-R]),e=e.concat(G),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&t&&(a.push(u+o,T+k,0),a.push(L+o,T+k,0),a.push(L+o,d+k,0),a.push(u+o,d+k,0),p.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,H=0,A=0,Q=M/F,R=X/f,G=[H,A,Q,A,Q,R,H,R],(O===r.b.ROTATE_ROW&&j%2===1||O===r.b.ROTATE_TILE&&(j+E)%2===1)&&(G=[1-H,1-A,1-Q,1-A,1-Q,1-R,1-H,1-R]),(O===r.b.FLIP_ROW&&j%2===1||O===r.b.FLIP_TILE&&(j+E)%2===1)&&(G=[1-H,A,1-Q,A,1-Q,R,1-H,R]),(O===r.b.FLIP_N_ROTATE_ROW&&j%2===1||O===r.b.FLIP_N_ROTATE_TILE&&(j+E)%2===1)&&(G=[H,1-A,Q,1-A,Q,1-R,H,1-R]),e=e.concat(G),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K){const K=[];H=0,A=1-X/f,Q=1,R=1,K[0]=[H,A,Q,A,Q,R,H,R],K[1]=[H,A,Q,A,Q,R,H,R],O!==r.b.ROTATE_TILE&&O!==r.b.ROTATE_ROW||(K[1]=[1-H,1-A,1-Q,1-A,1-Q,1-R,1-H,1-R]),O!==r.b.FLIP_TILE&&O!==r.b.FLIP_ROW||(K[1]=[1-H,A,1-Q,A,1-Q,R,1-H,R]),O!==r.b.FLIP_N_ROTATE_TILE&&O!==r.b.FLIP_N_ROTATE_ROW||(K[1]=[H,1-A,Q,1-A,Q,1-R,H,1-R]);for(let f=0;f<E;f++)a.push(f*F-u+o,Z+k,0),a.push((f+1)*F-u+o,Z+k,0),a.push((f+1)*F-u+o,Z+X+k,0),a.push(f*F-u+o,Z+X+k,0),p.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,e=O===r.b.FLIP_TILE||O===r.b.ROTATE_TILE||O===r.b.FLIP_N_ROTATE_TILE?e.concat(K[(f+1)%2]):O===r.b.FLIP_ROW||O===r.b.ROTATE_ROW||O===r.b.FLIP_N_ROTATE_ROW?e.concat(K[1]):e.concat(K[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const K=[];H=0,A=0,Q=1,R=X/f,K[0]=[H,A,Q,A,Q,R,H,R],K[1]=[H,A,Q,A,Q,R,H,R],O!==r.b.ROTATE_TILE&&O!==r.b.ROTATE_ROW||(K[1]=[1-H,1-A,1-Q,1-A,1-Q,1-R,1-H,1-R]),O!==r.b.FLIP_TILE&&O!==r.b.FLIP_ROW||(K[1]=[1-H,A,1-Q,A,1-Q,R,1-H,R]),O!==r.b.FLIP_N_ROTATE_TILE&&O!==r.b.FLIP_N_ROTATE_ROW||(K[1]=[H,1-A,Q,1-A,Q,1-R,H,1-R]);for(let f=0;f<E;f++)a.push(f*F-u+o,d-X+k,0),a.push((f+1)*F-u+o,d-X+k,0),a.push((f+1)*F-u+o,d+k,0),a.push(f*F-u+o,d+k,0),p.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,e=O===r.b.FLIP_TILE||O===r.b.ROTATE_TILE||O===r.b.FLIP_N_ROTATE_TILE?e.concat(K[(f+j)%2]):O===r.b.FLIP_ROW||O===r.b.ROTATE_ROW||O===r.b.FLIP_N_ROTATE_ROW?e.concat(K[j%2]):e.concat(K[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){const K=[];H=1-M/F,A=0,Q=1,R=1,K[0]=[H,A,Q,A,Q,R,H,R],K[1]=[H,A,Q,A,Q,R,H,R],O!==r.b.ROTATE_TILE&&O!==r.b.ROTATE_ROW||(K[1]=[1-H,1-A,1-Q,1-A,1-Q,1-R,1-H,1-R]),O!==r.b.FLIP_TILE&&O!==r.b.FLIP_ROW||(K[1]=[1-H,A,1-Q,A,1-Q,R,1-H,R]),O!==r.b.FLIP_N_ROTATE_TILE&&O!==r.b.FLIP_N_ROTATE_ROW||(K[1]=[H,1-A,Q,1-A,Q,1-R,H,1-R]);for(let F=0;F<j;F++)a.push(N+o,F*f-T+k,0),a.push(N+M+o,F*f-T+k,0),a.push(N+M+o,(F+1)*f-T+k,0),a.push(N+o,(F+1)*f-T+k,0),p.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,e=O===r.b.FLIP_TILE||O===r.b.ROTATE_TILE||O===r.b.FLIP_N_ROTATE_TILE?e.concat(K[(F+1)%2]):O===r.b.FLIP_ROW||O===r.b.ROTATE_ROW||O===r.b.FLIP_N_ROTATE_ROW?e.concat(K[F%2]):e.concat(K[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(t){const K=[];H=0,A=0,Q=M/f,R=1,K[0]=[H,A,Q,A,Q,R,H,R],K[1]=[H,A,Q,A,Q,R,H,R],O!==r.b.ROTATE_TILE&&O!==r.b.ROTATE_ROW||(K[1]=[1-H,1-A,1-Q,1-A,1-Q,1-R,1-H,1-R]),O!==r.b.FLIP_TILE&&O!==r.b.FLIP_ROW||(K[1]=[1-H,A,1-Q,A,1-Q,R,1-H,R]),O!==r.b.FLIP_N_ROTATE_TILE&&O!==r.b.FLIP_N_ROTATE_ROW||(K[1]=[H,1-A,Q,1-A,Q,1-R,H,1-R]);for(let F=0;F<j;F++)a.push(L-M+o,F*f-T+k,0),a.push(L+o,F*f-T+k,0),a.push(L+o,(F+1)*f-T+k,0),a.push(L-M+o,(F+1)*f-T+k,0),p.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,e=O===r.b.FLIP_TILE||O===r.b.ROTATE_TILE||O===r.b.FLIP_N_ROTATE_TILE?e.concat(K[(F+E)%2]):O===r.b.FLIP_ROW||O===r.b.ROTATE_ROW||O===r.b.FLIP_N_ROTATE_ROW?e.concat(K[F%2]):e.concat(K[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const A=0===K.sideOrientation?0:K.sideOrientation||q.b.DEFAULTSIDE;q.b._ComputeSides(A,a,p,g,e,K.frontUVs,K.backUVs);const Q=new q.b;Q.indices=p,Q.WK=a,Q.pK=g,Q.AK=e;const R=A===q.b.DOUBLESIDE?W.concat(W):W;return Q.yK=R,Q}function u(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new r.b(K,F);O.sideOrientation=r.b._GetDefaultSideOrientation(O.sideOrientation),f._originalBuilderSideOrientation=O.sideOrientation;return X(O).RK(f,O.updatable),f}function T(K){const O=K.faceUV||new Array(6),F=K.faceColors,l=K.pattern||r.b.NO_FLIP,c=K.width||K.size||1,E=K.height||K.size||1,M=K.depth||K.size||1,t=K.tileWidth||K.tileSize||1,u=K.tileHeight||K.tileSize||1,T=K.alignHorizontal||0,o=K.alignVertical||0,k=0===K.sideOrientation?0:K.sideOrientation||q.b.DEFAULTSIDE;for(let r=0;r<6;r++)void 0===O[r]&&(O[r]=new f.Vector4(0,0,1,1)),F&&void 0===F[r]&&(F[r]=new j.kJ(1,1,1,1));const N=c/2,Z=E/2,L=M/2,d=[];for(let f=0;f<2;f++)d[f]=X({pattern:l,tileWidth:t,tileHeight:u,width:c,height:E,alignVertical:o,alignHorizontal:T,sideOrientation:k});for(let f=2;f<4;f++)d[f]=X({pattern:l,tileWidth:t,tileHeight:u,width:M,height:E,alignVertical:o,alignHorizontal:T,sideOrientation:k});let a=o;o===r.b.BOTTOM?a=r.b.TOP:o===r.b.TOP&&(a=r.b.BOTTOM);for(let f=4;f<6;f++)d[f]=X({pattern:l,tileWidth:t,tileHeight:u,width:c,height:M,alignVertical:a,alignHorizontal:T,sideOrientation:k});let g=[],H=[],e=[],W=[];const p=[],y=[],A=[],Q=[];let R=0,G=0;for(let r=0;r<6;r++){const K=d[r].WK.length;y[r]=[],A[r]=[];for(let O=0;O<K/3;O++)y[r].push(new f.TO(d[r].WK[3*O],d[r].WK[3*O+1],d[r].WK[3*O+2])),A[r].push(new f.TO(d[r].pK[3*O],d[r].pK[3*O+1],d[r].pK[3*O+2]));R=d[r].AK.length,Q[r]=[];for(let F=0;F<R;F+=2)Q[r][F]=O[r].x+(O[r].z-O[r].x)*d[r].AK[F],Q[r][F+1]=O[r].y+(O[r].w-O[r].y)*d[r].AK[F+1],J.b&&(Q[r][F+1]=1-Q[r][F+1]);if(e=e.concat(Q[r]),W=W.concat(d[r].indices.map((K=>K+G))),G+=y[r].length,F)for(let O=0;O<4;O++)p.push(F[r].r,F[r].g,F[r].b,F[r].a)}const z=new f.TO(0,0,L),m=f.Matrix.RotationY(Math.PI);g=y[0].map((K=>f.TO.TransformNormal(K,m).add(z))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[]),H=A[0].map((K=>f.TO.TransformNormal(K,m))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[]),g=g.concat(y[1].map((K=>K.oO(z))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[])),H=H.concat(A[1].map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[]));const x=new f.TO(N,0,0),V=f.Matrix.RotationY(-Math.PI/2);g=g.concat(y[2].map((K=>f.TO.TransformNormal(K,V).add(x))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[])),H=H.concat(A[2].map((K=>f.TO.TransformNormal(K,V))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[]));const v=f.Matrix.RotationY(Math.PI/2);g=g.concat(y[3].map((K=>f.TO.TransformNormal(K,v).oO(x))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[])),H=H.concat(A[3].map((K=>f.TO.TransformNormal(K,v))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[]));const Y=new f.TO(0,Z,0),B=f.Matrix.RotationX(Math.PI/2);g=g.concat(y[4].map((K=>f.TO.TransformNormal(K,B).add(Y))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[])),H=H.concat(A[4].map((K=>f.TO.TransformNormal(K,B))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[]));const n=f.Matrix.RotationX(-Math.PI/2);g=g.concat(y[5].map((K=>f.TO.TransformNormal(K,n).oO(Y))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[])),H=H.concat(A[5].map((K=>f.TO.TransformNormal(K,n))).map((K=>[K.x,K.y,K.z])).reduce(((K,O)=>K.concat(O)),[])),q.b._ComputeSides(k,g,W,H,e);const C=new q.b;if(C.indices=W,C.WK=g,C.pK=H,C.AK=e,F){const K=k===q.b.DOUBLESIDE?p.concat(p):p;C.yK=K}return C}function o(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new r.b(K,F);O.sideOrientation=r.b._GetDefaultSideOrientation(O.sideOrientation),f._originalBuilderSideOrientation=O.sideOrientation;return T(O).RK(f,O.updatable),f}q.b.CreateTiledPlane=X;q.b.CreateTiledBox=T;var k=F(13109),N=F(11964),Z=F(11930);function L(K){const O=K.height||2;let F=0===K.diameterTop?0:K.diameterTop||K.diameter||1,l=0===K.diameterBottom?0:K.diameterBottom||K.diameter||1;F=F||1e-5,l=l||1e-5;const c=0|(K.tessellation||24),E=0|(K.subdivisions||1),M=!!K.hasRings,t=!!K.enclose,X=0===K.cap?0:K.cap||r.b.CAP_ALL,u=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,T=0===K.sideOrientation?0:K.sideOrientation||q.b.DEFAULTSIDE,o=K.faceUV||new Array(3),k=K.faceColors,N=2+(1+(1!==u&&t?2:0))*(M?E:1);let L;for(L=0;L<N;L++)k&&void 0===k[L]&&(k[L]=new j.kJ(1,1,1,1));for(L=0;L<N;L++)o&&void 0===o[L]&&(o[L]=new f.Vector4(0,0,1,1));const d=[],a=[],g=[],H=[],e=[],W=2*Math.PI*u/c;let p,y,A;const Q=(l-F)/2/O,R=f.TO.Zero(),G=f.TO.Zero(),z=f.TO.Zero(),m=f.TO.Zero(),x=f.TO.Zero(),V=Z.e.Y;let v,Y,B,n=1,C=1,I=0,D=0;for(v=0;v<=E;v++)for(y=v/E,A=(y*(F-l)+l)/2,n=M&&0!==v&&v!==E?2:1,B=0;B<n;B++){for(M&&(C+=B),t&&(C+=2*B),Y=0;Y<=c;Y++)p=Y*W,R.x=Math.cos(-p)*A,R.y=-O/2+y*O,R.z=Math.sin(-p)*A,0===F&&v===E?(G.x=g[g.length-3*(c+1)],G.y=g[g.length-3*(c+1)+1],G.z=g[g.length-3*(c+1)+2]):(G.x=R.x,G.z=R.z,G.y=Math.sqrt(G.x*G.x+G.z*G.z)*Q,G.normalize()),0===Y&&(z.l(R),m.l(G)),a.push(R.x,R.y,R.z),g.push(G.x,G.y,G.z),D=M?I!==C?o[C].y:o[C].w:o[C].y+(o[C].w-o[C].y)*y,H.push(o[C].x+(o[C].z-o[C].x)*Y/c,J.b?1-D:D),k&&e.push(k[C].r,k[C].g,k[C].b,k[C].a);1!==u&&t&&(a.push(R.x,R.y,R.z),a.push(0,R.y,0),a.push(0,R.y,0),a.push(z.x,z.y,z.z),f.TO.CrossToRef(V,G,x),x.normalize(),g.push(x.x,x.y,x.z,x.x,x.y,x.z),f.TO.CrossToRef(m,V,x),x.normalize(),g.push(x.x,x.y,x.z,x.x,x.y,x.z),D=M?I!==C?o[C+1].y:o[C+1].w:o[C+1].y+(o[C+1].w-o[C+1].y)*y,H.push(o[C+1].x,J.b?1-D:D),H.push(o[C+1].z,J.b?1-D:D),D=M?I!==C?o[C+2].y:o[C+2].w:o[C+2].y+(o[C+2].w-o[C+2].y)*y,H.push(o[C+2].x,J.b?1-D:D),H.push(o[C+2].z,J.b?1-D:D),k&&(e.push(k[C+1].r,k[C+1].g,k[C+1].b,k[C+1].a),e.push(k[C+1].r,k[C+1].g,k[C+1].b,k[C+1].a),e.push(k[C+2].r,k[C+2].g,k[C+2].b,k[C+2].a),e.push(k[C+2].r,k[C+2].g,k[C+2].b,k[C+2].a))),I!==C&&(I=C)}const h=1!==u&&t?c+4:c;for(v=0,C=0;C<E;C++){let K=0,O=0,F=0,f=0;for(Y=0;Y<c;Y++)K=v*(h+1)+Y,O=(v+1)*(h+1)+Y,F=v*(h+1)+(Y+1),f=(v+1)*(h+1)+(Y+1),d.push(K,O,F),d.push(f,F,O);1!==u&&t&&(d.push(K+2,O+2,F+2),d.push(f+2,F+2,O+2),d.push(K+4,O+4,F+4),d.push(f+4,F+4,O+4)),v=M?v+2:v+1}const b=K=>{const r=K?F/2:l/2;if(0===r)return;let q,E,M;const t=K?o[N-1]:o[0];let j=null;k&&(j=K?k[N-1]:k[0]);const X=a.length/3,T=K?O/2:-O/2,Z=new f.TO(0,T,0);a.push(Z.x,Z.y,Z.z),g.push(0,K?1:-1,0);const L=t.y+.5*(t.w-t.y);H.push(t.x+.5*(t.z-t.x),J.b?1-L:L),j&&e.push(j.r,j.g,j.b,j.a);const W=new f.Vector2(.5,.5);for(M=0;M<=c;M++){q=2*Math.PI*M*u/c;const O=Math.cos(-q),F=Math.sin(-q);E=new f.TO(O*r,T,F*r);const l=new f.Vector2(O*W.x+.5,F*W.y+.5);a.push(E.x,E.y,E.z),g.push(0,K?1:-1,0);const X=t.y+(t.w-t.y)*l.y;H.push(t.x+(t.z-t.x)*l.x,J.b?1-X:X),j&&e.push(j.r,j.g,j.b,j.a)}for(M=0;M<c;M++)K?(d.push(X),d.push(X+(M+2)),d.push(X+(M+1))):(d.push(X),d.push(X+(M+1)),d.push(X+(M+2)))};X!==r.b.CAP_START&&X!==r.b.CAP_ALL||b(!1),X!==r.b.CAP_END&&X!==r.b.CAP_ALL||b(!0),q.b._ComputeSides(T,a,d,g,H,K.frontUVs,K.backUVs);const i=new q.b;return i.indices=d,i.WK=a,i.pK=g,i.AK=H,k&&(i.yK=e),i}function d(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;const f=new r.b(K,F);O.sideOrientation=r.b._GetDefaultSideOrientation(O.sideOrientation),f._originalBuilderSideOrientation=O.sideOrientation;return L(O).RK(f,O.updatable),f}function a(K){const O=[],F=[],r=[],l=[],c=K.diameter||1,E=K.thickness||.5,M=0|(K.tessellation||16),t=0===K.sideOrientation?0:K.sideOrientation||q.b.DEFAULTSIDE,j=M+1;for(let q=0;q<=M;q++){const K=q/M,t=q*Math.PI*2/M-Math.PI/2,X=f.Matrix.Translation(c/2,0,0).multiply(f.Matrix.RotationY(t));for(let c=0;c<=M;c++){const t=1-c/M,u=c*Math.PI*2/M+Math.PI,T=Math.cos(u),o=Math.sin(u);let k=new f.TO(T,o,0),N=k.scale(E/2);const Z=new f.Vector2(K,t);N=f.TO.TransformCoordinates(N,X),k=f.TO.TransformNormal(k,X),F.push(N.x,N.y,N.z),r.push(k.x,k.y,k.z),l.push(Z.x,J.b?1-Z.y:Z.y);const L=(q+1)%j,d=(c+1)%j;O.push(q*j+c),O.push(q*j+d),O.push(L*j+c),O.push(q*j+d),O.push(L*j+d),O.push(L*j+c)}}q.b._ComputeSides(t,F,O,r,l,K.frontUVs,K.backUVs);const X=new q.b;return X.indices=O,X.WK=F,X.pK=r,X.AK=l,X}function g(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;const f=new r.b(K,F);O.sideOrientation=r.b._GetDefaultSideOrientation(O.sideOrientation),f._originalBuilderSideOrientation=O.sideOrientation;return a(O).RK(f,O.updatable),f}q.b.CreateCylinder=L,r.b.CreateCylinder=(K,O,F,f,l,q,J,c,E)=>{void 0!==J&&J instanceof N.d||(void 0!==J&&(E=c||r.b.DEFAULTSIDE,c=J),J=q,q=1);return d(K,{height:O,diameterTop:F,diameterBottom:f,tessellation:l,subdivisions:q,sideOrientation:E,updatable:c},J)};function H(K){const O=[],F=[],r=[],l=[],c=K.radius||2,E=K.tube||.5,M=K.radialSegments||32,t=K.tubularSegments||32,j=K.p||2,X=K.q||3,u=0===K.sideOrientation?0:K.sideOrientation||q.b.DEFAULTSIDE,T=K=>{const O=Math.cos(K),F=Math.sin(K),r=X/j*K,l=Math.cos(r),q=c*(2+l)*.5*O,J=c*(2+l)*F*.5,E=c*Math.sin(r)*.5;return new f.TO(q,J,E)};let o,k;for(o=0;o<=M;o++){const K=o%M/M*2*j*Math.PI,O=T(K),r=T(K+.01),q=r.oO(O);let c=r.add(O);const X=f.TO.Cross(q,c);for(c=f.TO.Cross(X,q),X.normalize(),c.normalize(),k=0;k<t;k++){const K=k%t/t*2*Math.PI,f=-E*Math.cos(K),r=E*Math.sin(K);F.push(O.x+f*c.x+r*X.x),F.push(O.y+f*c.y+r*X.y),F.push(O.z+f*c.z+r*X.z),l.push(o/M),l.push(J.b?1-k/t:k/t)}}for(o=0;o<M;o++)for(k=0;k<t;k++){const K=(k+1)%t,F=o*t+k,f=(o+1)*t+k,r=(o+1)*t+K,l=o*t+K;O.push(l),O.push(f),O.push(F),O.push(l),O.push(r),O.push(f)}q.b.ComputeNormals(F,O,r),q.b._ComputeSides(u,F,O,r,l,K.frontUVs,K.backUVs);const N=new q.b;return N.indices=O,N.WK=F,N.pK=r,N.AK=l,N}function e(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;const f=new r.b(K,F);O.sideOrientation=r.b._GetDefaultSideOrientation(O.sideOrientation),f._originalBuilderSideOrientation=O.sideOrientation;return H(O).RK(f,O.updatable),f}q.b.CreateTorus=a,r.b.CreateTorus=(K,O,F,f,r,l,q)=>g(K,{diameter:O,thickness:F,tessellation:f,sideOrientation:q,updatable:l},r);q.b.CreateTorusKnot=H,r.b.CreateTorusKnot=(K,O,F,f,r,l,q,J,c,E)=>e(K,{radius:O,tube:F,radialSegments:f,tubularSegments:r,p:l,q:q,sideOrientation:E,updatable:c},J);var W=F(13615),p=F(12298),y=F(11939);function A(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=O.path,l=O.shape,q=O.scale||1,J=O.rotation||0,c=0===O.cap?0:O.cap||r.b.NO_CAP,E=O.updatable,M=r.b._GetDefaultSideOrientation(O.sideOrientation),t=O.instance||null,j=O.invertUV||!1,X=O.closeShape||!1,u=O.closePath||!1,T=O.capFunction||null;return R(K,l,f,q,J,null,null,u,X,c,!1,F,!!E,M,t,j,O.frontUVs||null,O.backUVs||null,O.firstNormal||null,!!O.adjustFrame,T)}function Q(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=O.path,l=O.shape,q=O.scaleFunction||(()=>1),J=O.rotationFunction||(()=>0),c=O.closePath||O.ribbonCloseArray||!1,E=O.closeShape||O.ribbonClosePath||!1,M=0===O.cap?0:O.cap||r.b.NO_CAP,t=O.updatable,j=O.firstNormal||null,X=O.adjustFrame||!1,u=r.b._GetDefaultSideOrientation(O.sideOrientation),T=O.instance,o=O.invertUV||!1,k=O.capFunction||null;return R(K,l,f,null,null,q,J,c,E,M,!0,F,!!t,u,T||null,o,O.frontUVs||null,O.backUVs||null,j,X,k||null)}function R(K,O,F,l,q,J,c,M,t,j,X,u,T,o,k,N,Z,L,d,a,g){const H=(K,O,F,l,q,J,c,E,M,t,j)=>{const X=F.getTangents(),u=F.getNormals(),T=F.getBinormals(),o=F.getDistances();if(j)for(let r=0;r<X.length;r++)if(0==X[r].x&&0==X[r].y&&0==X[r].z&&X[r].l(X[r-1]),0==u[r].x&&0==u[r].y&&0==u[r].z&&u[r].l(u[r-1]),0==T[r].x&&0==T[r].y&&0==T[r].z&&T[r].l(T[r-1]),r>0){let K=X[r-1];f.TO.Dot(K,X[r])<0&&X[r].scaleInPlace(-1),K=u[r-1],f.TO.Dot(K,u[r])<0&&u[r].scaleInPlace(-1),K=T[r-1],f.TO.Dot(K,T[r])<0&&T[r].scaleInPlace(-1)}let k=0;const N=t&&E?E:()=>null!==J?J:0,Z=t&&c?c:()=>null!==q?q:1;let L=M===r.b.NO_CAP||M===r.b.CAP_END?0:2;const d=f.TmpVectors.Matrix[0];for(let r=0;r<O.length;r++){const F=[],q=N(r,o[r]),J=Z(r,o[r]);f.Matrix.RotationAxisToRef(X[r],k,d);for(let l=0;l<K.length;l++){const q=X[r].scale(K[l].z).add(u[r].scale(K[l].x)).add(T[r].scale(K[l].y)),c=f.TO.Zero();f.TO.TransformCoordinatesToRef(q,d,c),c.scaleInPlace(J).addInPlace(O[r]),F[l]=c}l[L]=F,k+=q,L++}const a=g||(K=>{const O=Array(),F=f.TO.Zero();let r;for(r=0;r<K.length;r++)F.addInPlace(K[r]);for(F.scaleInPlace(1/K.length),r=0;r<K.length;r++)O.push(F);return O});switch(M){case r.b.NO_CAP:break;case r.b.CAP_START:l[0]=a(l[2]),l[1]=l[2];break;case r.b.CAP_END:l[L]=l[L-1],l[L+1]=a(l[L-1]);break;case r.b.CAP_ALL:l[0]=a(l[2]),l[1]=l[2],l[L]=l[L-1],l[L+1]=a(l[L-1])}return l};let e,W;if(k){const K=k._creationDataStorage;return e=d?K.path3D.update(F,d):K.path3D.update(F),W=H(O,F,K.path3D,K.pathArray,l,q,J,c,K.cap,X,a),k=E("",{pathArray:W,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:k},u||void 0)}e=d?new y.h(F,d):new y.h(F);W=H(O,F,e,new Array,l,q,J,c,j=j<0||j>3?0:j,X,a);const p=E(K,{pathArray:W,closeArray:M,closePath:t,updatable:T,sideOrientation:o,invertUV:N,frontUVs:Z||void 0,backUVs:L||void 0},u);return p._creationDataStorage.pathArray=W,p._creationDataStorage.path3D=e,p._creationDataStorage.cap=j,p}function G(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=O.arc?O.arc<=0||O.arc>1?1:O.arc:1,q=void 0===O.closed||O.closed,J=O.shape,c=O.radius||1,M=O.tessellation||64,t=O.clip||0,j=O.updatable,X=r.b._GetDefaultSideOrientation(O.sideOrientation),u=O.cap||r.b.NO_CAP,T=2*Math.PI,o=[],k=O.invertUV||!1;let N=0,Z=0;const L=T/M*l;let d,a;for(N=0;N<=M-t;N++){for(a=[],u!=r.b.CAP_START&&u!=r.b.CAP_ALL||(a.push(new f.TO(0,J[0].y,0)),a.push(new f.TO(Math.cos(N*L)*J[0].x*c,J[0].y,Math.sin(N*L)*J[0].x*c))),Z=0;Z<J.length;Z++)d=new f.TO(Math.cos(N*L)*J[Z].x*c,J[Z].y,Math.sin(N*L)*J[Z].x*c),a.push(d);u!=r.b.CAP_END&&u!=r.b.CAP_ALL||(a.push(new f.TO(Math.cos(N*L)*J[J.length-1].x*c,J[J.length-1].y,Math.sin(N*L)*J[J.length-1].x*c)),a.push(new f.TO(0,J[J.length-1].y,0))),o.push(a)}return E(K,{pathArray:o,closeArray:q,sideOrientation:X,updatable:j,invertUV:k,frontUVs:O.frontUVs,backUVs:O.backUVs},F)}r.b.ExtrudeShape=function(K,O,F,f,l,q){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7?arguments[7]:void 0,E=arguments.length>8?arguments[8]:void 0,M=arguments.length>9?arguments[9]:void 0;return A(K,{shape:O,path:F,scale:f,rotation:l,cap:0===q?0:q||r.b.NO_CAP,sideOrientation:E,instance:M,updatable:c},J)},r.b.ExtrudeShapeCustom=(K,O,F,f,l,q,J,c,E,M,t,j)=>Q(K,{shape:O,path:F,scaleFunction:f,rotationFunction:l,ribbonCloseArray:q,ribbonClosePath:J,cap:0===c?0:c||r.b.NO_CAP,sideOrientation:t,instance:j,updatable:M},E);r.b.CreateLathe=(K,O,F,f,r,l,q)=>G(K,{shape:O,radius:F,tessellation:f,sideOrientation:q,updatable:l},r);var z=F(13014),m=F(12960);function x(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=O.path;let q=O.instance,J=1;void 0!==O.radius?J=O.radius:q&&(J=q._creationDataStorage.radius);const c=O.tessellation||64,M=O.radiusFunction||null;let t=O.cap||r.b.NO_CAP;const j=O.invertUV||!1,X=O.updatable,u=r.b._GetDefaultSideOrientation(O.sideOrientation);O.arc=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1;const T=(K,O,F,l,q,J,c,E)=>{const M=O.getTangents(),t=O.getNormals(),j=O.getDistances(),X=2*Math.PI/q*E,u=J||(()=>l);let T,o,k,N;const Z=f.TmpVectors.Matrix[0];let L=c===r.b.NO_CAP||c===r.b.CAP_END?0:2;for(let r=0;r<K.length;r++){o=u(r,j[r]),T=Array(),k=t[r];for(let O=0;O<q;O++)f.Matrix.RotationAxisToRef(M[r],X*O,Z),N=T[O]?T[O]:f.TO.Zero(),f.TO.TransformCoordinatesToRef(k,Z,N),N.scaleInPlace(o).addInPlace(K[r]),T[O]=N;F[L]=T,L++}const d=(O,F)=>{const f=Array();for(let r=0;r<O;r++)f.push(K[F]);return f};switch(c){case r.b.NO_CAP:break;case r.b.CAP_START:F[0]=d(q,0),F[1]=F[2].slice(0);break;case r.b.CAP_END:F[L]=F[L-1].slice(0),F[L+1]=d(q,K.length-1);break;case r.b.CAP_ALL:F[0]=d(q,0),F[1]=F[2].slice(0),F[L]=F[L-1].slice(0),F[L+1]=d(q,K.length-1)}return F};let o,k;if(q){const K=q._creationDataStorage,F=O.arc||K.arc;return o=K.path3D.update(l),k=T(l,o,K.pathArray,J,K.tessellation,M,K.cap,F),q=E("",{pathArray:k,instance:q}),K.path3D=o,K.pathArray=k,K.arc=F,K.radius=J,q}o=new y.h(l);t=t<0||t>3?0:t,k=T(l,o,new Array,J,c,M,t,O.arc);const N=E(K,{pathArray:k,closePath:!0,closeArray:!1,updatable:X,sideOrientation:u,invertUV:j,frontUVs:O.frontUVs,backUVs:O.backUVs},F);return N._creationDataStorage.pathArray=k,N._creationDataStorage.path3D=o,N._creationDataStorage.tessellation=c,N._creationDataStorage.cap=t,N._creationDataStorage.arc=O.arc,N._creationDataStorage.radius=J,N}function V(K){const O=[];O[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},O[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},O[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},O[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},O[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},O[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},O[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},O[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},O[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},O[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},O[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},O[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},O[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},O[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},O[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const F=K.type&&(K.type<0||K.type>=O.length)?0:K.type||0,r=K.size,l=K.sizeX||r||1,c=K.sizeY||r||1,E=K.sizeZ||r||1,M=K.custom||O[F],t=M.face.length,X=K.faceUV||new Array(t),u=K.faceColors,T=void 0===K.flat||K.flat,o=0===K.sideOrientation?0:K.sideOrientation||q.b.DEFAULTSIDE,k=[],N=[],Z=[],L=[],d=[];let a=0,g=0;const H=[];let e,W,p,y,A,Q,R=0,G=0;if(T)for(G=0;G<t;G++)u&&void 0===u[G]&&(u[G]=new j.kJ(1,1,1,1)),X&&void 0===X[G]&&(X[G]=new f.Vector4(0,0,1,1));if(T)for(G=0;G<t;G++){const K=M.face[G].length;for(p=2*Math.PI/K,y=.5*Math.tan(p/2),A=.5,R=0;R<K;R++)k.push(M.vertex[M.face[G][R]][0]*l,M.vertex[M.face[G][R]][1]*c,M.vertex[M.face[G][R]][2]*E),H.push(a),a++,e=X[G].x+(X[G].z-X[G].x)*(.5+y),W=X[G].y+(X[G].w-X[G].y)*(A-.5),L.push(e,J.b?1-W:W),Q=y*Math.cos(p)-A*Math.sin(p),A=y*Math.sin(p)+A*Math.cos(p),y=Q,u&&d.push(u[G].r,u[G].g,u[G].b,u[G].a);for(R=0;R<K-2;R++)N.push(H[0+g],H[R+2+g],H[R+1+g]);g+=K}else{for(R=0;R<M.vertex.length;R++)k.push(M.vertex[R][0]*l,M.vertex[R][1]*c,M.vertex[R][2]*E),L.push(0,J.b?1:0);for(G=0;G<t;G++)for(R=0;R<M.face[G].length-2;R++)N.push(M.face[G][0],M.face[G][R+2],M.face[G][R+1])}q.b.ComputeNormals(k,N,Z),q.b._ComputeSides(o,k,N,Z,L,K.frontUVs,K.backUVs);const z=new q.b;return z.WK=k,z.indices=N,z.pK=Z,z.AK=L,u&&T&&(z.yK=d),z}function v(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new r.b(K,F);O.sideOrientation=r.b._GetDefaultSideOrientation(O.sideOrientation),f._originalBuilderSideOrientation=O.sideOrientation;return V(O).RK(f,O.updatable),f}r.b.CreateTube=(K,O,F,f,r,l,q,J,c,E)=>x(K,{path:O,radius:F,tessellation:f,radiusFunction:r,arc:1,cap:l,updatable:J,sideOrientation:c,instance:E},q);function Y(K){const O=K.sideOrientation||q.b.DEFAULTSIDE,F=K.radius||1,r=void 0===K.flat||K.flat,l=0|(K.subdivisions||4),c=K.radiusX||F,E=K.radiusY||F,M=K.radiusZ||F,t=(1+Math.sqrt(5))/2,j=[-1,t,-0,1,t,0,-1,-t,0,1,-t,0,0,-1,-t,0,1,-t,0,-1,t,0,1,t,t,0,1,t,0,-1,-t,0,1,-t,0,-1],X=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],u=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],T=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],o=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],k=[],N=[],Z=[],L=[];let d=0;const a=new Array(3),g=new Array(3);let H;for(H=0;H<3;H++)a[H]=f.TO.Zero(),g[H]=f.Vector2.Zero();for(let q=0;q<20;q++){for(H=0;H<3;H++){const K=X[3*q+H];a[H].eq(j[3*u[K]],j[3*u[K]+1],j[3*u[K]+2]),a[H].normalize(),g[H].eq(.134765625*T[2*K]+.05859375+-.0390625*o[q],.2333984375*T[2*K+1]+.025390625+.01953125*o[q])}const K=(K,O,F,q)=>{const t=f.TO.Lerp(a[0],a[2],O/l),j=f.TO.Lerp(a[1],a[2],O/l),X=l===O?a[2]:f.TO.Lerp(t,j,K/(l-O));let u;if(X.normalize(),r){const K=f.TO.Lerp(a[0],a[2],q/l),O=f.TO.Lerp(a[1],a[2],q/l);u=f.TO.Lerp(K,O,F/(l-q))}else u=new f.TO(X.x,X.y,X.z);u.x/=c,u.y/=E,u.z/=M,u.normalize();const T=f.Vector2.Lerp(g[0],g[2],O/l),o=f.Vector2.Lerp(g[1],g[2],O/l),H=l===O?g[2]:f.Vector2.Lerp(T,o,K/(l-O));N.push(X.x*c,X.y*E,X.z*M),Z.push(u.x,u.y,u.z),L.push(H.x,J.b?1-H.y:H.y),k.push(d),d++};for(let O=0;O<l;O++)for(let F=0;F+O<l;F++)K(F,O,F+1/3,O+1/3),K(F+1,O,F+1/3,O+1/3),K(F,O+1,F+1/3,O+1/3),F+O+1<l&&(K(F+1,O,F+2/3,O+2/3),K(F+1,O+1,F+2/3,O+2/3),K(F,O+1,F+2/3,O+2/3))}q.b._ComputeSides(O,N,k,Z,L,K.frontUVs,K.backUVs);const e=new q.b;return e.indices=k,e.WK=N,e.pK=Z,e.AK=L,e}function B(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new r.b(K,F);O.sideOrientation=r.b._GetDefaultSideOrientation(O.sideOrientation),f._originalBuilderSideOrientation=O.sideOrientation;return Y(O).RK(f,O.updatable),f}q.b.CreatePolyhedron=V,r.b.CreatePolyhedron=(K,O,F)=>v(K,O,F);q.b.CreateIcoSphere=Y,r.b.CreateIcoSphere=(K,O,F)=>B(K,O,F);var n=F(11734);const C=new f.TO(1,0,0),I=new f.TO(-1,0,0),D=new f.TO(0,1,0),h=new f.TO(0,-1,0),b=new f.TO(0,0,1),i=new f.TO(0,0,-1);class w{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.TO.Zero(),O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.TO.Up(),F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.Vector2.Zero(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=K,this.normal=O,this.uv=F,this.vertexIdx=r,this.vertexIdxForBones=l,this.localPositionOverride=q,this.localNormalOverride=J,this.matrixIndicesOverride=c,this.matrixWeightsOverride=E}clone(){var K,O,F,f;return new w(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(K=this.localPositionOverride)||void 0===K?void 0:K.slice(),null===(O=this.localNormalOverride)||void 0===O?void 0:O.slice(),null===(F=this.matrixIndicesOverride)||void 0===F?void 0:F.slice(),null===(f=this.matrixWeightsOverride)||void 0===f?void 0:f.slice())}}function s(K,O,F){var c,E,M,t,j;const X=!!O.skeleton,u=!(null===(c=O.morphTargetManager)||void 0===c||!c.numTargets),T=F.localMode||X,o=O.br(),k=X||u?O.AJ(!0,!0):O.getVerticesData(l.d.PositionKind),N=X||u?O.getNormalsData(!0,!0):O.getVerticesData(l.d.NormalKind),Z=T?X?O.getVerticesData(l.d.PositionKind):k:null,L=T?X?O.getVerticesData(l.d.NormalKind):N:null,d=O.getVerticesData(l.d.UVKind),a=X?O.getVerticesData(l.d.MatricesIndicesKind):null,g=X?O.getVerticesData(l.d.MatricesWeightsKind):null,H=X?O.getVerticesData(l.d.MatricesIndicesExtraKind):null,e=X?O.getVerticesData(l.d.MatricesWeightsExtraKind):null,W=F.position||f.TO.Zero();let p=F.normal||f.TO.Up();const y=F.size||f.TO.One(),A=F.angle||0;if(!p){const K=new f.TO(0,0,1),F=O.HK().activeCamera,r=f.TO.TransformCoordinates(K,F.getWorldMatrix());p=F.globalPosition.oO(r)}const Q=-Math.atan2(p.z,p.x)-Math.PI/2,R=Math.sqrt(p.x*p.x+p.z*p.z),G=Math.atan2(p.y,R),z=new q.b;z.indices=[],z.WK=[],z.pK=[],z.AK=[],z.matricesIndices=X?[]:null,z.matricesWeights=X?[]:null,z.matricesIndicesExtra=H?[]:null,z.matricesWeightsExtra=e?[]:null;let m=0;const x=(K,O)=>{const r=new w;if(!o||!k||!N)return r;const l=o[K];if(r.vertexIdx=3*l,r.vertexIdxForBones=4*l,r.position=new f.TO(k[3*l],k[3*l+1],k[3*l+2]),f.TO.TransformCoordinatesToRef(r.position,O,r.position),r.normal=new f.TO(N[3*l],N[3*l+1],N[3*l+2]),f.TO.TransformNormalToRef(r.normal,O,r.normal),F.captureUVS&&d){const K=d[2*l+1];r.uv=new f.Vector2(d[2*l],J.b?1-K:K)}return r},V=[0,0,0,0],v=(K,O)=>{if(0===K.length)return K;const F=.5*Math.abs(f.TO.Dot(y,O)),r=(K,O,F,f)=>{for(let r=0;r<f;++r)if(K[F+r]===O)return F+r;return-1},l=(K,l)=>{const q=f.TO.GetClipFactor(K.position,l.position,O,F);let J=V,c=V;if(a&&g){const O=K.matrixIndicesOverride?0:K.vertexIdxForBones,F=K.matrixIndicesOverride??a,f=K.matrixWeightsOverride??g,E=l.matrixIndicesOverride?0:l.vertexIdxForBones,M=l.matrixIndicesOverride??a,t=l.matrixWeightsOverride??g;J=[0,0,0,0],c=[0,0,0,0];let j=0;for(let K=0;K<4;++K)if(f[O+K]>0){const l=r(M,F[O+K],E,4);J[j]=F[O+K],c[j]=(0,n.Lerp)(f[O+K],l>=0?t[l]:0,q),j++}for(let K=0;K<4&&j<4;++K){const f=M[E+K];-1===r(F,f,O,4)&&(J[j]=f,c[j]=(0,n.Lerp)(0,t[E+K],q),j++)}const X=c[0]+c[1]+c[2]+c[3];c[0]/=X,c[1]/=X,c[2]/=X,c[3]/=X}const E=K.localPositionOverride?K.localPositionOverride[0]:(null===Z||void 0===Z?void 0:Z[K.vertexIdx])??0,M=K.localPositionOverride?K.localPositionOverride[1]:(null===Z||void 0===Z?void 0:Z[K.vertexIdx+1])??0,t=K.localPositionOverride?K.localPositionOverride[2]:(null===Z||void 0===Z?void 0:Z[K.vertexIdx+2])??0,j=l.localPositionOverride?l.localPositionOverride[0]:(null===Z||void 0===Z?void 0:Z[l.vertexIdx])??0,X=l.localPositionOverride?l.localPositionOverride[1]:(null===Z||void 0===Z?void 0:Z[l.vertexIdx+1])??0,u=l.localPositionOverride?l.localPositionOverride[2]:(null===Z||void 0===Z?void 0:Z[l.vertexIdx+2])??0,T=K.localNormalOverride?K.localNormalOverride[0]:(null===L||void 0===L?void 0:L[K.vertexIdx])??0,o=K.localNormalOverride?K.localNormalOverride[1]:(null===L||void 0===L?void 0:L[K.vertexIdx+1])??0,k=K.localNormalOverride?K.localNormalOverride[2]:(null===L||void 0===L?void 0:L[K.vertexIdx+2])??0,N=T+((l.localNormalOverride?l.localNormalOverride[0]:(null===L||void 0===L?void 0:L[l.vertexIdx])??0)-T)*q,d=o+((l.localNormalOverride?l.localNormalOverride[1]:(null===L||void 0===L?void 0:L[l.vertexIdx+1])??0)-o)*q,H=k+((l.localNormalOverride?l.localNormalOverride[2]:(null===L||void 0===L?void 0:L[l.vertexIdx+2])??0)-k)*q,e=Math.sqrt(N*N+d*d+H*H);return new w(f.TO.Lerp(K.position,l.position,q),f.TO.Lerp(K.normal,l.normal,q).normalize(),f.Vector2.Lerp(K.uv,l.uv,q),-1,-1,Z?[E+(j-E)*q,M+(X-M)*q,t+(u-t)*q]:null,L?[N/e,d/e,H/e]:null,J,c)};let q=null;K.length>3&&(q=[]);for(let J=0;J<K.length;J+=3){let r=0,c=null,E=null,M=null,t=null;const j=f.TO.Dot(K[J].position,O)-F>0,X=f.TO.Dot(K[J+1].position,O)-F>0,u=f.TO.Dot(K[J+2].position,O)-F>0;switch(r=(j?1:0)+(X?1:0)+(u?1:0),r){case 0:K.length>3?(q.push(K[J]),q.push(K[J+1]),q.push(K[J+2])):q=K;break;case 1:if(q=q??new Array,j&&(c=K[J+1],E=K[J+2],M=l(K[J],c),t=l(K[J],E)),X){c=K[J],E=K[J+2],M=l(K[J+1],c),t=l(K[J+1],E),q.push(M),q.push(E.clone()),q.push(c.clone()),q.push(E.clone()),q.push(M.clone()),q.push(t);break}u&&(c=K[J],E=K[J+1],M=l(K[J+2],c),t=l(K[J+2],E)),c&&E&&M&&t&&(q.push(c.clone()),q.push(E.clone()),q.push(M),q.push(t),q.push(M.clone()),q.push(E.clone()));break;case 2:q=q??new Array,j||(c=K[J].clone(),E=l(c,K[J+1]),M=l(c,K[J+2]),q.push(c),q.push(E),q.push(M)),X||(c=K[J+1].clone(),E=l(c,K[J+2]),M=l(c,K[J]),q.push(c),q.push(E),q.push(M)),u||(c=K[J+2].clone(),E=l(c,K[J]),M=l(c,K[J+1]),q.push(c),q.push(E),q.push(M))}}return q},Y=O instanceof r.b?O:null,B=null===Y||void 0===Y?void 0:Y._thinInstanceDataStorage.matrixData,s=(null===Y||void 0===Y?void 0:Y.ZJ)||1,U=f.TmpVectors.Matrix[0];U.l(f.Matrix.IdentityReadOnly);for(let r=0;r<s;++r){if(null!==Y&&void 0!==Y&&Y.hasThinInstances&&B){const K=16*r;U.setRowFromFloats(0,B[K+0],B[K+1],B[K+2],B[K+3]),U.setRowFromFloats(1,B[K+4],B[K+5],B[K+6],B[K+7]),U.setRowFromFloats(2,B[K+8],B[K+9],B[K+10],B[K+11]),U.setRowFromFloats(3,B[K+12],B[K+13],B[K+14],B[K+15])}const K=f.Matrix.RotationYawPitchRoll(Q,G,A).multiply(f.Matrix.Translation(W.x,W.y,W.z)),l=f.Matrix.Invert(K),q=O.getWorldMatrix(),c=U.multiply(q).multiply(l),E=new Array(3);for(let O=0;O<o.length;O+=3){let K=E;if(K[0]=x(O,c),K[1]=x(O+1,c),K[2]=x(O+2,c),!(F.cullBackFaces&&-K[0].normal.z<=0&&-K[1].normal.z<=0&&-K[2].normal.z<=0)&&(K=v(K,C),K&&(K=v(K,I),K&&(K=v(K,D),K&&(K=v(K,h),K&&(K=v(K,b),K&&(K=v(K,i),K)))))))for(let O=0;O<K.length;O++){const f=K[O];if(z.indices.push(m),T?(f.localPositionOverride?(z.WK[3*m]=f.localPositionOverride[0],z.WK[3*m+1]=f.localPositionOverride[1],z.WK[3*m+2]=f.localPositionOverride[2]):Z&&(z.WK[3*m]=Z[f.vertexIdx],z.WK[3*m+1]=Z[f.vertexIdx+1],z.WK[3*m+2]=Z[f.vertexIdx+2]),f.localNormalOverride?(z.pK[3*m]=f.localNormalOverride[0],z.pK[3*m+1]=f.localNormalOverride[1],z.pK[3*m+2]=f.localNormalOverride[2]):L&&(z.pK[3*m]=L[f.vertexIdx],z.pK[3*m+1]=L[f.vertexIdx+1],z.pK[3*m+2]=L[f.vertexIdx+2])):(f.position.toArray(z.WK,3*m),f.normal.toArray(z.pK,3*m)),z.matricesIndices&&z.matricesWeights&&(f.matrixIndicesOverride?(z.matricesIndices[4*m]=f.matrixIndicesOverride[0],z.matricesIndices[4*m+1]=f.matrixIndicesOverride[1],z.matricesIndices[4*m+2]=f.matrixIndicesOverride[2],z.matricesIndices[4*m+3]=f.matrixIndicesOverride[3]):(a&&(z.matricesIndices[4*m]=a[f.vertexIdxForBones],z.matricesIndices[4*m+1]=a[f.vertexIdxForBones+1],z.matricesIndices[4*m+2]=a[f.vertexIdxForBones+2],z.matricesIndices[4*m+3]=a[f.vertexIdxForBones+3]),H&&z.matricesIndicesExtra&&(z.matricesIndicesExtra[4*m]=H[f.vertexIdxForBones],z.matricesIndicesExtra[4*m+1]=H[f.vertexIdxForBones+1],z.matricesIndicesExtra[4*m+2]=H[f.vertexIdxForBones+2],z.matricesIndicesExtra[4*m+3]=H[f.vertexIdxForBones+3])),f.matrixWeightsOverride?(z.matricesWeights[4*m]=f.matrixWeightsOverride[0],z.matricesWeights[4*m+1]=f.matrixWeightsOverride[1],z.matricesWeights[4*m+2]=f.matrixWeightsOverride[2],z.matricesWeights[4*m+3]=f.matrixWeightsOverride[3]):(g&&(z.matricesWeights[4*m]=g[f.vertexIdxForBones],z.matricesWeights[4*m+1]=g[f.vertexIdxForBones+1],z.matricesWeights[4*m+2]=g[f.vertexIdxForBones+2],z.matricesWeights[4*m+3]=g[f.vertexIdxForBones+3]),e&&z.matricesWeightsExtra&&(z.matricesWeightsExtra[4*m]=e[f.vertexIdxForBones],z.matricesWeightsExtra[4*m+1]=e[f.vertexIdxForBones+1],z.matricesWeightsExtra[4*m+2]=e[f.vertexIdxForBones+2],z.matricesWeightsExtra[4*m+3]=e[f.vertexIdxForBones+3]))),F.captureUVS)f.uv.toArray(z.AK,2*m);else{z.AK.push(.5+f.position.x/y.x);const K=.5+f.position.y/y.y;z.AK.push(J.b?1-K:K)}m++}}}0===z.indices.length&&(z.indices=null),0===z.WK.length&&(z.WK=null),0===z.pK.length&&(z.pK=null),0===z.AK.length&&(z.AK=null),0===(null===(E=z.matricesIndices)||void 0===E?void 0:E.length)&&(z.matricesIndices=null),0===(null===(M=z.matricesWeights)||void 0===M?void 0:M.length)&&(z.matricesWeights=null),0===(null===(t=z.matricesIndicesExtra)||void 0===t?void 0:t.length)&&(z.matricesIndicesExtra=null),0===(null===(j=z.matricesWeightsExtra)||void 0===j?void 0:j.length)&&(z.matricesWeightsExtra=null);const P=new r.b(K,O.HK());return z.RK(P),T?(P.skeleton=O.skeleton,P.parent=O):(P.position=W.clone(),P.rotation=new f.TO(G,Q,A)),P.Pf(!0),P.refreshBoundingInfo(!0,!0),P}function U(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const O=0|Math.max(K.subdivisions?K.subdivisions:2,1),F=0|Math.max(K.tessellation?K.tessellation:16,3),r=Math.max(K.height?K.height:1,0),l=Math.max(K.radius?K.radius:.25,0),c=0|Math.max(K.capSubdivisions?K.capSubdivisions:6,1),E=F,M=O,t=Math.max(K.radiusTop?K.radiusTop:l,0),j=Math.max(K.radiusBottom?K.radiusBottom:l,0),X=r-(t+j),u=2*Math.PI,T=Math.max(K.topCapSubdivisions?K.topCapSubdivisions:c,1),o=Math.max(K.bottomCapSubdivisions?K.bottomCapSubdivisions:c,1),k=Math.acos((j-t)/r);let N=[];const Z=[],L=[],d=[];let a=0;const g=[],H=.5*X,e=.5*Math.PI;let W,p;const y=f.TO.Zero(),A=f.TO.Zero(),Q=Math.cos(k),R=Math.sin(k),G=new f.Vector2(t*R,H+t*Q).oO(new f.Vector2(j*R,j*Q-H)).length(),z=t*k+G+j*(e-k);let m=0;for(p=0;p<=T;p++){const K=[],O=e-k*(p/T);m+=t*k/T;const F=Math.cos(O),f=Math.sin(O),r=F*t;for(W=0;W<=E;W++){const O=W/E,l=O*u+0,q=Math.sin(l),c=Math.cos(l);A.x=r*q,A.y=H+f*t,A.z=r*c,Z.push(A.x,A.y,A.z),y.set(F*q,f,F*c),L.push(y.x,y.y,y.z),d.push(O,J.b?m/z:1-m/z),K.push(a),a++}g.push(K)}const x=r-t-j+Q*t-Q*j,V=R*(j-t)/x;for(p=1;p<=M;p++){const K=[];m+=G/M;const O=R*(p*(j-t)/M+t);for(W=0;W<=E;W++){const F=W/E,f=F*u+0,r=Math.sin(f),l=Math.cos(f);A.x=O*r,A.y=H+Q*t-p*x/M,A.z=O*l,Z.push(A.x,A.y,A.z),y.set(r,V,l).normalize(),L.push(y.x,y.y,y.z),d.push(F,J.b?m/z:1-m/z),K.push(a),a++}g.push(K)}for(p=1;p<=o;p++){const K=[],O=e-k-(Math.PI-k)*(p/o);m+=j*k/o;const F=Math.cos(O),f=Math.sin(O),r=F*j;for(W=0;W<=E;W++){const O=W/E,l=O*u+0,q=Math.sin(l),c=Math.cos(l);A.x=r*q,A.y=f*j-H,A.z=r*c,Z.push(A.x,A.y,A.z),y.set(F*q,f,F*c),L.push(y.x,y.y,y.z),d.push(O,J.b?m/z:1-m/z),K.push(a),a++}g.push(K)}for(W=0;W<E;W++)for(p=0;p<T+M+o;p++){const K=g[p][W],O=g[p+1][W],F=g[p+1][W+1],f=g[p][W+1];N.push(K),N.push(O),N.push(f),N.push(O),N.push(F),N.push(f)}if(N=N.reverse(),K.orientation&&!K.orientation.equals(f.TO.Up())){const O=new f.Matrix;K.orientation.clone().scale(.5*Math.PI).cross(f.TO.Up()).toQuaternion().toRotationMatrix(O);const F=f.TO.Zero();for(let K=0;K<Z.length;K+=3)F.set(Z[K],Z[K+1],Z[K+2]),f.TO.TransformCoordinatesToRef(F.clone(),O,F),Z[K]=F.x,Z[K+1]=F.y,Z[K+2]=F.z}const v=new q.b;return v.WK=Z,v.pK=L,v.AK=d,v.indices=N,v}function P(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:f.TO.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=new r.b(K,F);return U(O).RK(l,O.updatable),l}r.b.CreateDecal=(K,O,F,f,r,l)=>s(K,O,{position:F,normal:f,size:r,angle:l});r.b.CreateCapsule=(K,O,F)=>P(K,O,F),q.b.CreateCapsule=U;var S=F(11534),KK=F(11721);class OK{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=K,this.y=O,K!==Math.floor(K)&&(K=Math.floor(K),S.c.Warn("x is not an integer, floor(x) used")),O!==Math.floor(O)&&(O=Math.floor(O),S.c.Warn("y is not an integer, floor(y) used"))}clone(){return new OK(this.x,this.y)}rotate60About(K){const O=this.x;return this.x=K.x+K.y-this.y,this.y=O+this.y-K.x,this}rotateNeg60About(K){const O=this.x;return this.x=O+this.y-K.y,this.y=K.x+K.y-O,this}rotate120(K,O){K!==Math.floor(K)&&(K=Math.floor(K),S.c.Warn("m not an integer only floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),S.c.Warn("n not an integer only floor(n) used"));const F=this.x;return this.x=K-F-this.y,this.y=O+F,this}rotateNeg120(K,O){K!==Math.floor(K)&&(K=Math.floor(K),S.c.Warn("m is not an integer, floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),S.c.Warn("n is not an integer,   floor(n) used"));const F=this.x;return this.x=this.y-O,this.y=K+O-F-this.y,this}toCartesianOrigin(K,O){const F=f.TO.Zero();return F.x=K.x+2*this.x*O+this.y*O,F.y=K.y+Math.sqrt(3)*this.y*O,F}static Zero(){return new OK(0,0)}}class FK{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new fK("icosahedron","Regular",[[0,KK.i,-1],[-KK.i,1,0],[-1,0,-KK.i],[1,0,-KK.i],[KK.i,1,0],[0,KK.i,1],[-1,0,KK.i],[-KK.i,-1,0],[0,-KK.i,-1],[KK.i,-1,0],[1,0,KK.i],[0,-KK.i,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let K=12;const O={},F=this.m,f=this.n;let r,l,q,J,c,E=F,M=1,t=0;0!==f&&(E=(0,n.HighestCommonFactor)(F,f)),M=F/E,t=f/E;const j=OK.Zero(),X=new OK(F,f),u=new OK(-f,F+f),T=OK.Zero(),o=OK.Zero(),k=OK.Zero();let N,Z,L,d,a=[];const g=[],H=this.vertByDist,e=(F,f,r,l)=>{N=F+"|"+r,Z=f+"|"+l,N in O||Z in O?N in O&&!(Z in O)?O[Z]=O[N]:Z in O&&!(N in O)&&(O[N]=O[Z]):(O[N]=K,O[Z]=K,K++),H[r][0]>2?g[O[N]]=[-H[r][0],H[r][1],O[N]]:g[O[N]]=[a[H[r][0]],H[r][1],O[N]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let W=0;W<20;W++){if(a=this.IDATA.face[W],q=a[2],J=a[1],c=a[0],L=j.x+"|"+j.y,N=W+"|"+L,N in O||(O[N]=q,g[q]=[a[H[L][0]],H[L][1]]),L=X.x+"|"+X.y,N=W+"|"+L,N in O||(O[N]=J,g[J]=[a[H[L][0]],H[L][1]]),L=u.x+"|"+u.y,N=W+"|"+L,N in O||(O[N]=c,g[c]=[a[H[L][0]],H[L][1]]),r=this.IDATA.edgematch[W][0],l=this.IDATA.edgematch[W][1],"B"===l)for(let K=1;K<E;K++)o.x=F-K*(M+t),o.y=f+K*M,k.x=-K*t,k.y=K*(M+t),L=o.x+"|"+o.y,d=k.x+"|"+k.y,e(W,r,L,d);if("O"===l)for(let K=1;K<E;K++)k.x=-K*t,k.y=K*(M+t),T.x=K*M,T.y=K*t,L=k.x+"|"+k.y,d=T.x+"|"+T.y,e(W,r,L,d);if(r=this.IDATA.edgematch[W][2],l=this.IDATA.edgematch[W][3],l&&"A"===l)for(let K=1;K<E;K++)T.x=K*M,T.y=K*t,o.x=F-(E-K)*(M+t),o.y=f+(E-K)*M,L=T.x+"|"+T.y,d=o.x+"|"+o.y,e(W,r,L,d);for(let F=0;F<this.vertices.length;F++)L=this.vertices[F].x+"|"+this.vertices[F].y,N=W+"|"+L,N in O||(O[N]=K++,H[L][0]>2?g[O[N]]=[-H[L][0],H[L][1],O[N]]:g[O[N]]=[a[H[L][0]],H[L][1],O[N]])}this.closestTo=g,this.vecToidx=O}calcCoeffs(){const K=this.m,O=this.n,F=Math.sqrt(3)/3,f=K*K+O*O+K*O;this.coau=(K+O)/f,this.cobu=-O/f,this.coav=-F*(K-O)/f,this.cobv=F*(2*K+O)/f}createInnerFacets(){const K=this.m,O=this.n;for(let F=0;F<O+K+1;F++)for(let K=this.min[F];K<this.max[F]+1;K++)K<this.max[F]&&K<this.max[F+1]+1&&this.innerFacets.push(["|"+K+"|"+F,"|"+K+"|"+(F+1),"|"+(K+1)+"|"+F]),F>0&&K<this.max[F-1]&&K+1<this.max[F]+1&&this.innerFacets.push(["|"+K+"|"+F,"|"+(K+1)+"|"+F,"|"+(K+1)+"|"+(F-1)])}edgeVecsABOB(){const K=this.m,O=this.n,F=new OK(-O,K+O);for(let f=1;f<K+O;f++){const K=new OK(this.min[f],f),O=new OK(this.min[f-1],f-1),r=new OK(this.min[f+1],f+1),l=K.clone(),q=O.clone(),J=r.clone();l.rotate60About(F),q.rotate60About(F),J.rotate60About(F);const c=new OK(this.max[l.y],l.y),E=new OK(this.max[l.y-1],l.y-1),M=new OK(this.max[l.y-1]-1,l.y-1);l.x===c.x&&l.y===c.y||(l.x!==E.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,E,M]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,M,c])):l.y===J.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,O,E]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([K,E,r])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,O,E]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,E,c])))}}mapABOBtoOBOA(){const K=new OK(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const F=[];for(let f=0;f<3;f++)K.x=this.isoVecsABOB[O][f].x,K.y=this.isoVecsABOB[O][f].y,0===this.vertexTypes[O][f]&&K.rotateNeg120(this.m,this.n),F.push(K.clone());this.isoVecsOBOA.push(F)}}mapABOBtoBAOA(){const K=new OK(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const F=[];for(let f=0;f<3;f++)K.x=this.isoVecsABOB[O][f].x,K.y=this.isoVecsABOB[O][f].y,1===this.vertexTypes[O][f]&&K.rotate120(this.m,this.n),F.push(K.clone());this.isoVecsBAOA.push(F)}}MapToFace(K,O){const F=this.IDATA.face[K],r=F[2],l=F[1],q=F[0],J=f.TO.LO(this.IDATA.vertex[r]),c=f.TO.LO(this.IDATA.vertex[l]),E=f.TO.LO(this.IDATA.vertex[q]),M=c.oO(J),t=E.oO(J),j=M.scale(this.coau).add(t.scale(this.cobu)),X=M.scale(this.coav).add(t.scale(this.cobv)),u=[];let T,o=f.TmpVectors.TO[0];for(let f=0;f<this.cartesian.length;f++)o=j.scale(this.cartesian[f].x).add(X.scale(this.cartesian[f].y)).add(J),u[f]=[o.x,o.y,o.z],T=K+"|"+this.vertices[f].x+"|"+this.vertices[f].y,O.vertex[this.vecToidx[T]]=[o.x,o.y,o.z]}build(K,O){const F=[],f=OK.Zero(),r=new OK(K,O),l=new OK(-O,K+O);F.push(f,r,l);for(let L=O;L<K+1;L++)for(let O=0;O<K+1-L;O++)F.push(new OK(O,L));if(O>0){const f=(0,n.HighestCommonFactor)(K,O),r=K/f,l=O/f;for(let J=1;J<f;J++)F.push(new OK(J*r,J*l)),F.push(new OK(-J*l,J*(r+l))),F.push(new OK(K-J*(r+l),O+J*r));const q=K/O;for(let J=1;J<O;J++)for(let f=0;f<J*q;f++)F.push(new OK(f,J)),F.push(new OK(f,J).rotate120(K,O)),F.push(new OK(f,J).rotateNeg120(K,O))}F.sort(((K,O)=>K.x-O.x)),F.sort(((K,O)=>K.y-O.y));const q=new Array(K+O+1),J=new Array(K+O+1);for(let L=0;L<q.length;L++)q[L]=1/0,J[L]=-1/0;let c=0,E=0;const M=F.length;for(let L=0;L<M;L++)E=F[L].x,c=F[L].y,q[c]=Math.min(E,q[c]),J[c]=Math.max(E,J[c]);const t=(F,f)=>{const r=F.clone();return"A"===f&&r.rotateNeg120(K,O),"B"===f&&r.rotate120(K,O),r.x<0?r.y:r.x+r.y},j=[],X=[],u=[],T=[],o={},k=[];let N=-1,Z=-1;for(let L=0;L<M;L++)j[L]=F[L].toCartesianOrigin(new OK(0,0),.5),X[L]=t(F[L],"O"),u[L]=t(F[L],"A"),T[L]=t(F[L],"B"),X[L]===u[L]&&u[L]===T[L]?(N=3,Z=X[L]):X[L]===u[L]?(N=4,Z=X[L]):u[L]===T[L]?(N=5,Z=u[L]):T[L]===X[L]&&(N=6,Z=X[L]),X[L]<u[L]&&X[L]<T[L]&&(N=2,Z=X[L]),u[L]<X[L]&&u[L]<T[L]&&(N=1,Z=u[L]),T[L]<u[L]&&T[L]<X[L]&&(N=0,Z=T[L]),k.push([N,Z,F[L].x,F[L].y]);k.sort(((K,O)=>K[2]-O[2])),k.sort(((K,O)=>K[3]-O[3])),k.sort(((K,O)=>K[1]-O[1])),k.sort(((K,O)=>K[0]-O[0]));for(let L=0;L<k.length;L++)o[k[L][2]+"|"+k[L][3]]=[k[L][0],k[L][1],L];return this.m=K,this.n=O,this.vertices=F,this.vertByDist=o,this.cartesian=j,this.min=q,this.max=J,this}}class fK{constructor(K,O,F,f){this.name=K,this.category=O,this.vertex=F,this.face=f}}class rK extends fK{innerToData(K,O){for(let F=0;F<O.innerFacets.length;F++)this.face.push(O.innerFacets[F].map((F=>O.vecToidx[K+F])))}mapABOBtoDATA(K,O){const F=O.IDATA.edgematch[K][0];for(let f=0;f<O.isoVecsABOB.length;f++){const r=[];for(let l=0;l<3;l++)0===O.vertexTypes[f][l]?r.push(K+"|"+O.isoVecsABOB[f][l].x+"|"+O.isoVecsABOB[f][l].y):r.push(F+"|"+O.isoVecsABOB[f][l].x+"|"+O.isoVecsABOB[f][l].y);this.face.push([O.vecToidx[r[0]],O.vecToidx[r[1]],O.vecToidx[r[2]]])}}mapOBOAtoDATA(K,O){const F=O.IDATA.edgematch[K][0];for(let f=0;f<O.isoVecsOBOA.length;f++){const r=[];for(let l=0;l<3;l++)1===O.vertexTypes[f][l]?r.push(K+"|"+O.isoVecsOBOA[f][l].x+"|"+O.isoVecsOBOA[f][l].y):r.push(F+"|"+O.isoVecsOBOA[f][l].x+"|"+O.isoVecsOBOA[f][l].y);this.face.push([O.vecToidx[r[0]],O.vecToidx[r[1]],O.vecToidx[r[2]]])}}mapBAOAtoDATA(K,O){const F=O.IDATA.edgematch[K][2];for(let f=0;f<O.isoVecsBAOA.length;f++){const r=[];for(let l=0;l<3;l++)1===O.vertexTypes[f][l]?r.push(K+"|"+O.isoVecsBAOA[f][l].x+"|"+O.isoVecsBAOA[f][l].y):r.push(F+"|"+O.isoVecsBAOA[f][l].x+"|"+O.isoVecsBAOA[f][l].y);this.face.push([O.vecToidx[r[0]],O.vecToidx[r[1]],O.vecToidx[r[2]]])}}orderData(K){const O=[];for(let l=0;l<13;l++)O[l]=[];const F=K.closestTo;for(let l=0;l<F.length;l++)F[l][0]>-1?F[l][1]>0&&O[F[l][0]].push([l,F[l][1]]):O[12].push([l,F[l][0]]);const f=[];for(let l=0;l<12;l++)f[l]=l;let r=12;for(let l=0;l<12;l++){O[l].sort(((K,O)=>K[1]-O[1]));for(let K=0;K<O[l].length;K++)f[O[l][K][0]]=r++}for(let l=0;l<O[12].length;l++)f[O[12][l][0]]=r++;for(let l=0;l<this.vertex.length;l++)this.vertex[l].push(f[l]);this.vertex.sort(((K,O)=>K[3]-O[3]));for(let l=0;l<this.vertex.length;l++)this.vertex[l].pop();for(let l=0;l<this.face.length;l++)for(let K=0;K<this.face[l].length;K++)this.face[l][K]=f[this.face[l][K]];this.sharedNodes=O[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(K,O){const F=[],f=[];let r=O.pop();f.push(r);let l=this.face[r].indexOf(K);l=(l+2)%3;let q=this.face[r][l];F.push(q);let J=0;for(;O.length>0;)r=O[J],this.face[r].indexOf(q)>-1?(l=(this.face[r].indexOf(q)+1)%3,q=this.face[r][l],F.push(q),f.push(r),O.splice(J,1),J=0):J++;return this.adjacentFaces.push(F),f}toGoldbergPolyhedronData(){const K=new fK("GeoDual","Goldberg",[],[]);K.name="GD dual";const O=this.vertex.length,F=new Array(O);for(let c=0;c<O;c++)F[c]=[];for(let c=0;c<this.face.length;c++)for(let K=0;K<3;K++)F[this.face[c][K]].push(c);let f=0,r=0,l=0,q=[],J=[];this.adjacentFaces=[];for(let c=0;c<F.length;c++){K.face[c]=this.setOrder(c,F[c].concat([]));for(const O of F[c]){f=0,r=0,l=0,q=this.face[O];for(let K=0;K<3;K++)J=this.vertex[q[K]],f+=J[0],r+=J[1],l+=J[2];K.vertex[O]=[f/3,r/3,l/3]}}return K}static BuildGeodesicData(K){const O=new rK("Geodesic-m-n","Geodesic",[[0,KK.i,-1],[-KK.i,1,0],[-1,0,-KK.i],[1,0,-KK.i],[KK.i,1,0],[0,KK.i,1],[-1,0,KK.i],[-KK.i,-1,0],[0,-KK.i,-1],[KK.i,-1,0],[1,0,KK.i],[0,-KK.i,1]],[]);K.setIndices(),K.calcCoeffs(),K.createInnerFacets(),K.edgeVecsABOB(),K.mapABOBtoOBOA(),K.mapABOBtoBAOA();for(let F=0;F<K.IDATA.face.length;F++)K.MapToFace(F,O),O.innerToData(F,K),"B"===K.IDATA.edgematch[F][1]&&O.mapABOBtoDATA(F,K),"O"===K.IDATA.edgematch[F][1]&&O.mapOBOAtoDATA(F,K),"A"===K.IDATA.edgematch[F][3]&&O.mapBAOAtoDATA(F,K);O.orderData(K);return O.vertex=O.vertex.map((function(K){const O=K[0],F=K[1],f=K[2],r=Math.sqrt(O*O+F*F+f*f);return K[0]*=1/r,K[1]*=1/r,K[2]*=1/r,K})),O}}r.b._GoldbergMeshParser=(K,O)=>lK.Parse(K,O);class lK extends r.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(K,O){return void 0===O?(K>this.goldbergData.nbUnsharedFaces-1&&(S.c.Warn("Maximum number of unshared faces used"),K=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+K):(K>11&&(S.c.Warn("Last pole used"),K=11),O>this.goldbergData.nbFacesAtPole-1&&(S.c.Warn("Maximum number of faces at a pole used"),O=this.goldbergData.nbFacesAtPole-1),12+K*this.goldbergData.nbFacesAtPole+O)}_changeGoldbergFaceColors(K){for(let F=0;F<K.length;F++){const O=K[F][0],f=K[F][1],r=K[F][2];for(let K=O;K<f+1;K++)this.goldbergData.faceColors[K]=r}const O=[];for(let F=0;F<12;F++)for(let K=0;K<5;K++)O.push(this.goldbergData.faceColors[F].r,this.goldbergData.faceColors[F].g,this.goldbergData.faceColors[F].b,this.goldbergData.faceColors[F].a);for(let F=12;F<this.goldbergData.faceColors.length;F++)for(let K=0;K<6;K++)O.push(this.goldbergData.faceColors[F].r,this.goldbergData.faceColors[F].g,this.goldbergData.faceColors[F].b,this.goldbergData.faceColors[F].a);return O}setGoldbergFaceColors(K){const O=this._changeGoldbergFaceColors(K);this.xK(l.d.ColorKind,O)}updateGoldbergFaceColors(K){const O=this._changeGoldbergFaceColors(K);this.updateVerticesData(l.d.ColorKind,O)}_changeGoldbergFaceUVs(K){const O=this.getVerticesData(l.d.UVKind);for(let F=0;F<K.length;F++){const f=K[F][0],r=K[F][1],l=K[F][2],q=K[F][3],J=K[F][4],c=[],E=[];let M,t;for(let K=0;K<5;K++)M=l.x+q*Math.cos(J+K*Math.PI/2.5),t=l.y+q*Math.sin(J+K*Math.PI/2.5),M<0&&(M=0),M>1&&(M=1),c.push(M,t);for(let K=0;K<6;K++)M=l.x+q*Math.cos(J+K*Math.PI/3),t=l.y+q*Math.sin(J+K*Math.PI/3),M<0&&(M=0),M>1&&(M=1),E.push(M,t);for(let K=f;K<Math.min(12,r+1);K++)for(let F=0;F<5;F++)O[10*K+2*F]=c[2*F],O[10*K+2*F+1]=c[2*F+1];for(let K=Math.max(12,f);K<r+1;K++)for(let F=0;F<6;F++)O[12*K-24+2*F]=E[2*F],O[12*K-23+2*F]=E[2*F+1]}return O}setGoldbergFaceUVs(K){const O=this._changeGoldbergFaceUVs(K);this.xK(l.d.UVKind,O)}updateGoldbergFaceUVs(K){const O=this._changeGoldbergFaceUVs(K);this.updateVerticesData(l.d.UVKind,O)}placeOnGoldbergFaceAt(K,O,F){const r=f.TO.RotationFromAxis(this.goldbergData.faceXaxis[O],this.goldbergData.faceYaxis[O],this.goldbergData.faceZaxis[O]);K.rotation=r,K.position=this.goldbergData.faceCenters[O].add(this.goldbergData.faceXaxis[O].scale(F.x)).add(this.goldbergData.faceYaxis[O].scale(F.y)).add(this.goldbergData.faceZaxis[O].scale(F.z))}serialize(K){super.serialize(K),K.type="GoldbergMesh";const O={};if(O.adjacentFaces=this.goldbergData.adjacentFaces,O.nbSharedFaces=this.goldbergData.nbSharedFaces,O.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,O.nbFaces=this.goldbergData.nbFaces,O.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){O.faceColors=[];for(const K of this.goldbergData.faceColors)O.faceColors.push(K.hf())}if(this.goldbergData.faceCenters){O.faceCenters=[];for(const K of this.goldbergData.faceCenters)O.faceCenters.push(K.hf())}if(this.goldbergData.faceZaxis){O.faceZaxis=[];for(const K of this.goldbergData.faceZaxis)O.faceZaxis.push(K.hf())}if(this.goldbergData.faceYaxis){O.faceYaxis=[];for(const K of this.goldbergData.faceYaxis)O.faceYaxis.push(K.hf())}if(this.goldbergData.faceXaxis){O.faceXaxis=[];for(const K of this.goldbergData.faceXaxis)O.faceXaxis.push(K.hf())}K.goldbergData=O}static Parse(K,O){const F=K.goldbergData;F.faceColors=F.faceColors.map((K=>j.kJ.LO(K))),F.faceCenters=F.faceCenters.map((K=>f.TO.LO(K))),F.faceZaxis=F.faceZaxis.map((K=>f.TO.LO(K))),F.faceXaxis=F.faceXaxis.map((K=>f.TO.LO(K))),F.faceYaxis=F.faceYaxis.map((K=>f.TO.LO(K)));const r=new lK(K.name,O);return r.goldbergData=F,r}}var qK=F(12291);const JK={CreateBox:t.d,CreateTiledBox:o,CreateSphere:k.d,CreateDisc:M.e,CreateIcoSphere:B,CreateRibbon:E,CreateCylinder:d,CreateTorus:g,CreateTorusKnot:e,CreateLineSystem:W.f,iE:W.g,CreateDashedLines:W.c,ExtrudeShape:A,ExtrudeShapeCustom:Q,CreateLathe:G,CreateTiledPlane:u,UE:z.d,CreateGround:m.e,CreateTiledGround:m.i,CreateGroundFromHeightMap:m.d,CreatePolygon:p.d,ExtrudePolygon:p.f,CreateTube:x,CreatePolyhedron:v,CreateGeodesic:function(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=O.m||1;f!==Math.floor(f)&&(f=Math.floor(f),S.c.Warn("m not an integer only floor(m) used"));let r=O.n||0;if(r!==Math.floor(r)&&(r=Math.floor(r),S.c.Warn("n not an integer only floor(n) used")),r>f){const K=r;r=f,f=K,S.c.Warn("n > m therefore m and n swapped")}const l=new FK;return l.build(f,r),v(K,{custom:rK.BuildGeodesicData(l),size:O.size,sizeX:O.sizeX,sizeY:O.sizeY,sizeZ:O.sizeZ,faceUV:O.faceUV,faceColors:O.faceColors,flat:O.flat,updatable:O.updatable,sideOrientation:O.sideOrientation,frontUVs:O.frontUVs,backUVs:O.backUVs},F)},CreateGoldberg:function(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=O.size,c=O.sizeX||l||1,E=O.sizeY||l||1,M=O.sizeZ||l||1;let t=O.m||1;t!==Math.floor(t)&&(t=Math.floor(t),S.c.Warn("m not an integer only floor(m) used"));let X=O.n||0;if(X!==Math.floor(X)&&(X=Math.floor(X),S.c.Warn("n not an integer only floor(n) used")),X>t){const K=X;X=t,t=K,S.c.Warn("n > m therefore m and n swapped")}const u=new FK;u.build(t,X);const T=rK.BuildGeodesicData(u),o=T.toGoldbergPolyhedronData(),k=new lK(K,F);O.sideOrientation=r.b._GetDefaultSideOrientation(O.sideOrientation),k._originalBuilderSideOrientation=O.sideOrientation;(function(K,O){const F=K.size,r=K.sizeX||F||1,l=K.sizeY||F||1,c=K.sizeZ||F||1,E=0===K.sideOrientation?0:K.sideOrientation||q.b.DEFAULTSIDE,M=[],t=[],j=[],X=[];let u=1/0,T=-1/0,o=1/0,k=-1/0;for(let f=0;f<O.vertex.length;f++)u=Math.min(u,O.vertex[f][0]*r),T=Math.max(T,O.vertex[f][0]*r),o=Math.min(o,O.vertex[f][1]*l),k=Math.max(k,O.vertex[f][1]*l);let N=0;for(let q=0;q<O.face.length;q++){const K=O.face[q],F=f.TO.LO(O.vertex[K[0]]),E=f.TO.LO(O.vertex[K[2]]),Z=f.TO.LO(O.vertex[K[1]]),L=E.oO(F),d=Z.oO(F),a=f.TO.Cross(d,L).normalize();for(let f=0;f<K.length;f++){j.push(a.x,a.y,a.z);const F=O.vertex[K[f]];M.push(F[0]*r,F[1]*l,F[2]*c);const q=(F[1]*l-o)/(k-o);X.push((F[0]*r-u)/(T-u),J.b?1-q:q)}for(let O=0;O<K.length-2;O++)t.push(N,N+O+2,N+O+1);N+=K.length}q.b._ComputeSides(E,M,t,j,X);const Z=new q.b;return Z.WK=M,Z.indices=t,Z.pK=j,Z.AK=X,Z})(O,o).RK(k,O.updatable),k.goldbergData.nbSharedFaces=T.sharedNodes,k.goldbergData.nbUnsharedFaces=T.poleNodes,k.goldbergData.adjacentFaces=T.adjacentFaces,k.goldbergData.nbFaces=k.goldbergData.nbSharedFaces+k.goldbergData.nbUnsharedFaces,k.goldbergData.nbFacesAtPole=(k.goldbergData.nbUnsharedFaces-12)/12;for(let r=0;r<T.vertex.length;r++)k.goldbergData.faceCenters.push(f.TO.LO(T.vertex[r])),k.goldbergData.faceCenters[r].x*=c,k.goldbergData.faceCenters[r].y*=E,k.goldbergData.faceCenters[r].z*=M,k.goldbergData.faceColors.push(new j.kJ(1,1,1,1));for(let r=0;r<o.face.length;r++){const K=o.face[r],O=f.TO.LO(o.vertex[K[0]]),F=f.TO.LO(o.vertex[K[2]]),l=f.TO.LO(o.vertex[K[1]]),q=F.oO(O),J=l.oO(O),c=f.TO.Cross(J,q).normalize(),E=f.TO.Cross(J,c).normalize();k.goldbergData.faceXaxis.push(J.normalize()),k.goldbergData.faceYaxis.push(c),k.goldbergData.faceZaxis.push(E)}return k},CreateDecal:s,CreateCapsule:P,CreateText:qK.f}},13029:(K,O,F)=>{"use strict";F.d(O,{e:()=>JO});var f=F(11713),r=F(12117);class l extends r.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var q=F(11764),J=(F(11905),F(11661));class c{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(K){this._targetStopDuration!==K&&(this._targetStopDuration=K)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(K){this._noiseTexture!==K&&(this._noiseTexture=K,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(K){this._animationSheetEnabled!==K&&(this._animationSheetEnabled=K)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(K){this._isAnimationSheetEnabled!=K&&(this._isAnimationSheetEnabled=K,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(K){this._useLogarithmicDepth=K&&this.HK().getEngine().getCaps().fragmentDepthSupported}HK(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(K){switch(K){case c.BLENDMODE_MULTIPLYADD:return;case c.BLENDMODE_ADD:K=1;break;case c.BLENDMODE_ONEONE:K=6;break;case c.BLENDMODE_STANDARD:K=2;break;case c.BLENDMODE_MULTIPLY:K=4;break;case c.BLENDMODE_SUBTRACT:K=3}this._engine.setAlphaMode(K)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:f.TO.Zero()}set direction1(K){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=K)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:f.TO.Zero()}set direction2(K){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=K)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:f.TO.Zero()}set minEmitBox(K){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=K)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:f.TO.Zero()}set maxEmitBox(K){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=K)}get billboardMode(){return this._billboardMode}set billboardMode(K){this._billboardMode!==K&&(this._billboardMode=K,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(K){this._isBillboardBased!==K&&(this._isBillboardBased=K,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(K){this._attachImageProcessingConfiguration(K)}_attachImageProcessingConfiguration(K){K!==this._imageProcessingConfiguration&&(!K&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=K)}_reset(){}_removeGradientAndTexture(K,O,F){if(!O)return this;let f=0;for(const r of O){if(r.gradient===K){O.splice(f,1);break}f++}return F&&F.dispose(),this}constructor(K){this.animations=[],this.renderingGroupId=0,this.rO=f.TO.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new f.TO(10,10,10),this.onAnimationEnd=null,this.blendMode=c.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new f.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.DE=new f.TO(0,0,0),this._useLogarithmicDepth=!1,this.gravity=f.TO.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new q.kJ(1,1,1,1),this.color2=new q.kJ(1,1,1,1),this.colorDead=new q.kJ(0,0,0,1),this.textureMask=new q.kJ(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new l,this.id=K,this.name=K}createPointEmitter(K,O){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new f.TO(0,1,0),arguments.length>2&&void 0!==arguments[2]||new f.TO(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new f.TO(0,1,0),arguments.length>4&&void 0!==arguments[4]||new f.TO(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new f.TO(0,1,0),arguments.length>3&&void 0!==arguments[3]||new f.TO(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(K,O,F,f){throw new Error("Method not implemented.")}}c.BLENDMODE_ONEONE=0,c.BLENDMODE_STANDARD=1,c.BLENDMODE_ADD=2,c.BLENDMODE_MULTIPLY=3,c.BLENDMODE_MULTIPLYADD=4,c.BLENDMODE_SUBTRACT=-1,(0,J.g)("BABYLON.BaseParticleSystem",c);var E=F(11734),M=F(11539);class t{constructor(){this.direction1=new f.TO(0,1,0),this.direction2=new f.TO(0,1,0),this.minEmitBox=new f.TO(-.5,-.5,-.5),this.maxEmitBox=new f.TO(.5,.5,.5)}startDirectionFunction(K,O,F,r){const l=(0,E.RandomRange)(this.direction1.x,this.direction2.x),q=(0,E.RandomRange)(this.direction1.y,this.direction2.y),J=(0,E.RandomRange)(this.direction1.z,this.direction2.z);if(r)return O.x=l,O.y=q,void(O.z=J);f.TO.TransformNormalFromFloatsToRef(l,q,J,K,O)}startPositionFunction(K,O,F,r){const l=(0,E.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),q=(0,E.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),J=(0,E.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(r)return O.x=l,O.y=q,void(O.z=J);f.TO.TransformCoordinatesFromFloatsToRef(l,q,J,K,O)}clone(){const K=new t;return M.c.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2),K.setVector3("minEmitBox",this.minEmitBox),K.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3),K.addUniform("minEmitBox",3),K.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.hf(),K.direction2=this.direction2.hf(),K.minEmitBox=this.minEmitBox.hf(),K.maxEmitBox=this.maxEmitBox.hf(),K}parse(K){f.TO.FromArrayToRef(K.direction1,0,this.direction1),f.TO.FromArrayToRef(K.direction2,0,this.direction2),f.TO.FromArrayToRef(K.minEmitBox,0,this.minEmitBox),f.TO.FromArrayToRef(K.maxEmitBox,0,this.maxEmitBox)}}class j{get radius(){return this._radius}set radius(K){this._radius=K,this._buildHeight()}get angle(){return this._angle}set angle(K){this._angle=K,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=F,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=O,this.radius=K}startDirectionFunction(K,O,F,r){r?f.TmpVectors.TO[0].l(F.BJ).normalize():F.position.subtractToRef(K.getTranslation(),f.TmpVectors.TO[0]).normalize();const l=(0,E.RandomRange)(0,this.directionRandomizer),q=(0,E.RandomRange)(0,this.directionRandomizer),J=(0,E.RandomRange)(0,this.directionRandomizer);O.x=f.TmpVectors.TO[0].x+l,O.y=f.TmpVectors.TO[0].y+q,O.z=f.TmpVectors.TO[0].z+J,O.normalize()}startPositionFunction(K,O,F,r){const l=(0,E.RandomRange)(0,2*Math.PI);let q;this.emitFromSpawnPointOnly?q=1e-4:(q=(0,E.RandomRange)(0,this.heightRange),q=1-q*q);let J=this._radius-(0,E.RandomRange)(0,this._radius*this.radiusRange);J*=q;const c=J*Math.sin(l),M=J*Math.cos(l),t=q*this._height;if(r)return O.x=c,O.y=t,void(O.z=M);f.TO.TransformCoordinatesFromFloatsToRef(c,t,M,K,O)}clone(){const K=new j(this._radius,this._angle,this.directionRandomizer);return M.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat2("radius",this._radius,this.radiusRange),K.setFloat("coneAngle",this._angle),K.setFloat2("height",this._height,this.heightRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",2),K.addUniform("coneAngle",1),K.addUniform("height",2),K.addUniform("directionRandomizer",1)}getEffectDefines(){let K="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(K+="\n#define CONEEMITTERSPAWNPOINT"),K}getClassName(){return"ConeParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this._radius,K.angle=this._angle,K.directionRandomizer=this.directionRandomizer,K.radiusRange=this.radiusRange,K.heightRange=this.heightRange,K.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,K}parse(K){this.radius=K.radius,this.angle=K.angle,this.directionRandomizer=K.directionRandomizer,this.radiusRange=void 0!==K.radiusRange?K.radiusRange:1,this.heightRange=void 0!==K.radiusRange?K.heightRange:1,this.emitFromSpawnPointOnly=void 0!==K.emitFromSpawnPointOnly&&K.emitFromSpawnPointOnly}}class X extends j{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.TO(0,1,0),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.TO(0,1,0);super(K,O),this.direction1=F,this.direction2=r}startDirectionFunction(K,O){const F=(0,E.RandomRange)(this.direction1.x,this.direction2.x),r=(0,E.RandomRange)(this.direction1.y,this.direction2.y),l=(0,E.RandomRange)(this.direction1.z,this.direction2.z);f.TO.TransformNormalFromFloatsToRef(F,r,l,K,O)}clone(){const K=new X(this.radius,this.angle,this.direction1,this.direction2);return M.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.hf(),K.direction2=this.direction2.hf(),K}parse(K){super.parse(K),this.direction1.l(K.direction1),this.direction2.l(K.direction2)}}class u{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=K,this.height=O,this.radiusRange=F,this.directionRandomizer=r,this._tempVector=f.TO.Zero()}startDirectionFunction(K,O,F,r,l){F.position.subtractToRef(K.getTranslation(),this._tempVector),this._tempVector.normalize(),f.TO.TransformNormalToRef(this._tempVector,l,this._tempVector);const q=(0,E.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let J=Math.atan2(this._tempVector.x,this._tempVector.z);J+=(0,E.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=q,this._tempVector.x=Math.sin(J),this._tempVector.z=Math.cos(J),this._tempVector.normalize(),r?O.l(this._tempVector):f.TO.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,K,O)}startPositionFunction(K,O,F,r){const l=(0,E.RandomRange)(-this.height/2,this.height/2),q=(0,E.RandomRange)(0,2*Math.PI),J=(0,E.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),c=Math.sqrt(J)*this.radius,M=c*Math.cos(q),t=c*Math.sin(q);r?O.eq(M,l,t):f.TO.TransformCoordinatesFromFloatsToRef(M,l,t,K,O)}clone(){const K=new u(this.radius,this.directionRandomizer);return M.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.height=this.height,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.height=K.height,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class T extends u{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.TO(0,1,0),l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.TO(0,1,0);super(K,O,F),this.direction1=r,this.direction2=l}startDirectionFunction(K,O,F,r){const l=(0,E.RandomRange)(this.direction1.x,this.direction2.x),q=(0,E.RandomRange)(this.direction1.y,this.direction2.y),J=(0,E.RandomRange)(this.direction1.z,this.direction2.z);r?O.eq(l,q,J):f.TO.TransformNormalFromFloatsToRef(l,q,J,K,O)}clone(){const K=new T(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return M.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.hf(),K.direction2=this.direction2.hf(),K}parse(K){super.parse(K),f.TO.FromArrayToRef(K.direction1,0,this.direction1),f.TO.FromArrayToRef(K.direction2,0,this.direction2)}}class o{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=O,this.directionRandomizer=F}startDirectionFunction(K,O,F,r){const l=F.position.oO(K.getTranslation()).normalize(),q=(0,E.RandomRange)(0,this.directionRandomizer),J=(0,E.RandomRange)(0,this.directionRandomizer),c=(0,E.RandomRange)(0,this.directionRandomizer);l.x+=q,l.y+=J,l.z+=c,l.normalize(),r?O.l(l):f.TO.TransformNormalFromFloatsToRef(l.x,l.y,l.z,K,O)}startPositionFunction(K,O,F,r){const l=this.radius-(0,E.RandomRange)(0,this.radius*this.radiusRange),q=(0,E.RandomRange)(0,1),J=(0,E.RandomRange)(0,2*Math.PI),c=Math.acos(2*q-1),M=l*Math.cos(J)*Math.sin(c),t=l*Math.cos(c),j=l*Math.sin(J)*Math.sin(c);r?O.eq(M,Math.abs(t),j):f.TO.TransformCoordinatesFromFloatsToRef(M,Math.abs(t),j,K,O)}clone(){const K=new o(this.radius,this.directionRandomizer);return M.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class k{constructor(){this.direction1=new f.TO(0,1,0),this.direction2=new f.TO(0,1,0)}startDirectionFunction(K,O,F,r){const l=(0,E.RandomRange)(this.direction1.x,this.direction2.x),q=(0,E.RandomRange)(this.direction1.y,this.direction2.y),J=(0,E.RandomRange)(this.direction1.z,this.direction2.z);r?O.eq(l,q,J):f.TO.TransformNormalFromFloatsToRef(l,q,J,K,O)}startPositionFunction(K,O,F,r){r?O.eq(0,0,0):f.TO.TransformCoordinatesFromFloatsToRef(0,0,0,K,O)}clone(){const K=new k;return M.c.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.hf(),K.direction2=this.direction2.hf(),K}parse(K){f.TO.FromArrayToRef(K.direction1,0,this.direction1),f.TO.FromArrayToRef(K.direction2,0,this.direction2)}}class N{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=O,this.directionRandomizer=F}startDirectionFunction(K,O,F,r){const l=F.position.oO(K.getTranslation()).normalize(),q=(0,E.RandomRange)(0,this.directionRandomizer),J=(0,E.RandomRange)(0,this.directionRandomizer),c=(0,E.RandomRange)(0,this.directionRandomizer);l.x+=q,l.y+=J,l.z+=c,l.normalize(),r?O.l(l):f.TO.TransformNormalFromFloatsToRef(l.x,l.y,l.z,K,O)}startPositionFunction(K,O,F,r){const l=this.radius-(0,E.RandomRange)(0,this.radius*this.radiusRange),q=(0,E.RandomRange)(0,1),J=(0,E.RandomRange)(0,2*Math.PI),c=Math.acos(2*q-1),M=l*Math.cos(J)*Math.sin(c),t=l*Math.cos(c),j=l*Math.sin(J)*Math.sin(c);r?O.eq(M,t,j):f.TO.TransformCoordinatesFromFloatsToRef(M,t,j,K,O)}clone(){const K=new N(this.radius,this.directionRandomizer);return M.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class Z extends N{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.TO(0,1,0),F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.TO(0,1,0);super(K),this.direction1=O,this.direction2=F}startDirectionFunction(K,O){const F=(0,E.RandomRange)(this.direction1.x,this.direction2.x),r=(0,E.RandomRange)(this.direction1.y,this.direction2.y),l=(0,E.RandomRange)(this.direction1.z,this.direction2.z);f.TO.TransformNormalFromFloatsToRef(F,r,l,K,O)}clone(){const K=new Z(this.radius,this.direction1,this.direction2);return M.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.hf(),K.direction2=this.direction2.hf(),K}parse(K){super.parse(K),this.direction1.l(K.direction1),this.direction2.l(K.direction2)}}class L{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(K,O,F,r){const l=f.TmpVectors.TO[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,F,l);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,F,l);const K=f.TmpVectors.TO[1];l.subtractToRef(F.position,K),K.scaleToRef(1/F.lifeTime,l)}else l.set(0,0,0);r?O.l(l):f.TO.TransformNormalToRef(l,K,O)}startPositionFunction(K,O,F,r){const l=f.TmpVectors.TO[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,F,l):l.set(0,0,0),r?O.l(l):f.TO.TransformCoordinatesToRef(l,K,O)}clone(){const K=new L;return M.c.DeepCopy(this,K),K}applyToShader(K){}buildUniformLayout(K){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.particlePositionGenerator=this.particlePositionGenerator,K.particleDestinationGenerator=this.particleDestinationGenerator,K}parse(K){K.particlePositionGenerator&&(this.particlePositionGenerator=K.particlePositionGenerator),K.particleDestinationGenerator&&(this.particleDestinationGenerator=K.particleDestinationGenerator)}}var d=F(11793);class a{get mesh(){return this._mesh}set mesh(K){this._mesh!==K&&(this._mesh=K,K?(this._indices=K.br(),this._positions=K.getVerticesData(d.d.PositionKind),this._normals=K.getVerticesData(d.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=f.TO.Zero(),this._mesh=null,this.direction1=new f.TO(0,1,0),this.direction2=new f.TO(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=K}startDirectionFunction(K,O,F,r){if(this.useMeshNormalsForDirection&&this._normals)return void f.TO.TransformNormalToRef(this._storedNormal,K,O);const l=(0,E.RandomRange)(this.direction1.x,this.direction2.x),q=(0,E.RandomRange)(this.direction1.y,this.direction2.y),J=(0,E.RandomRange)(this.direction1.z,this.direction2.z);r?O.eq(l,q,J):f.TO.TransformNormalFromFloatsToRef(l,q,J,K,O)}startPositionFunction(K,O,F,r){if(!this._indices||!this._positions)return;const l=3*(Math.random()*(this._indices.length/3)|0),q=Math.random(),J=Math.random()*(1-q),c=1-q-J,E=this._indices[l],M=this._indices[l+1],t=this._indices[l+2],j=f.TmpVectors.TO[0],X=f.TmpVectors.TO[1],u=f.TmpVectors.TO[2],T=f.TmpVectors.TO[3];f.TO.FromArrayToRef(this._positions,3*E,j),f.TO.FromArrayToRef(this._positions,3*M,X),f.TO.FromArrayToRef(this._positions,3*t,u),T.x=q*j.x+J*X.x+c*u.x,T.y=q*j.y+J*X.y+c*u.y,T.z=q*j.z+J*X.z+c*u.z,r?O.eq(T.x,T.y,T.z):f.TO.TransformCoordinatesFromFloatsToRef(T.x,T.y,T.z,K,O),this.useMeshNormalsForDirection&&this._normals&&(f.TO.FromArrayToRef(this._normals,3*E,j),f.TO.FromArrayToRef(this._normals,3*M,X),f.TO.FromArrayToRef(this._normals,3*t,u),this._storedNormal.x=q*j.x+J*X.x+c*u.x,this._storedNormal.y=q*j.y+J*X.y+c*u.y,this._storedNormal.z=q*j.z+J*X.z+c*u.z)}clone(){const K=new a(this.mesh);return M.c.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var K;const O={};return O.type=this.getClassName(),O.direction1=this.direction1.hf(),O.direction2=this.direction2.hf(),O.meshId=null===(K=this.mesh)||void 0===K?void 0:K.id,O.useMeshNormalsForDirection=this.useMeshNormalsForDirection,O}parse(K,O){f.TO.FromArrayToRef(K.direction1,0,this.direction1),f.TO.FromArrayToRef(K.direction2,0,this.direction2),K.meshId&&O&&(this.mesh=O.getLastMeshById(K.meshId)),this.useMeshNormalsForDirection=K.useMeshNormalsForDirection}}class g{_isUbo(K){return void 0!==K.addUniform}constructor(K){this._isUbo(K)?(this.setMatrix3x3=K.updateMatrix3x3.bind(K),this.setMatrix2x2=K.updateMatrix2x2.bind(K),this.setFloat=K.updateFloat.bind(K),this.setFloat2=K.updateFloat2.bind(K),this.setFloat3=K.updateFloat3.bind(K),this.setFloat4=K.updateFloat4.bind(K),this.setFloatArray=K.updateFloatArray.bind(K),this.setArray=K.updateArray.bind(K),this.setIntArray=K.updateIntArray.bind(K),this.setMatrix=K.sf.bind(K),this.setMatrices=K.updateMatrices.bind(K),this.setVector3=K.updateVector3.bind(K),this.setVector4=K.updateVector4.bind(K),this.setColor3=K.updateColor3.bind(K),this.setColor4=K.updateColor4.bind(K),this.setDirectColor4=K.updateDirectColor4.bind(K),this.setInt=K.updateInt.bind(K),this.setInt2=K.updateInt2.bind(K),this.setInt3=K.updateInt3.bind(K),this.setInt4=K.updateInt4.bind(K)):(this.setMatrix3x3=K.setMatrix3x3.bind(K),this.setMatrix2x2=K.setMatrix2x2.bind(K),this.setFloat=K.setFloat.bind(K),this.setFloat2=K.setFloat2.bind(K),this.setFloat3=K.setFloat3.bind(K),this.setFloat4=K.setFloat4.bind(K),this.setFloatArray=K.setFloatArray.bind(K),this.setArray=K.setArray.bind(K),this.setIntArray=K.setIntArray.bind(K),this.setMatrix=K.setMatrix.bind(K),this.setMatrices=K.setMatrices.bind(K),this.setVector3=K.setVector3.bind(K),this.setVector4=K.setVector4.bind(K),this.setColor3=K.setColor3.bind(K),this.setColor4=K.setColor4.bind(K),this.setDirectColor4=K.setDirectColor4.bind(K),this.setInt=K.setInt.bind(K),this.setInt2=K.setInt2.bind(K),this.setInt3=K.setInt3.bind(K),this.setInt4=K.setInt4.bind(K))}}var H=F(11610);const e="gpuUpdateParticlesPixelShader",W="#version 300 es\nvoid main() {discard;}\n";H.c.ShadersStore[e]||(H.c.ShadersStore[e]=W);const p="gpuUpdateParticlesVertexShader",y="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";H.c.ShadersStore[p]||(H.c.ShadersStore[p]=y);(0,J.g)("BABYLON.WebGL2ParticleSystem",class{constructor(K,O){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=K,this._engine=O,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var K;return(null===(K=this._updateEffect)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof L&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=K,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new g(this._updateEffect)}createVertexBuffers(K,O){this._updateVAO.push(this._createUpdateVAO(K)),this._renderVAO.push(this._engine.recordVertexArrayObject(O,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=O}createParticleBuffer(K){return K}bindDrawBuffers(K,O,F){F?this._engine.bindBuffers(this._renderVertexBuffers,F,O):this._engine.bindVertexArrayObject(this._renderVAO[K],null)}preUpdateParticleBuffer(){const K=this._engine;if(this._engine.enableEffect(this._updateEffect),!K.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(K,O,F){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[K],null);const f=this._engine;f.bindTransformFeedbackBuffer(O.getBuffer()),f.setRasterizerState(!1),f.beginTransformFeedback(!0),f.drawArraysType(3,0,F),f.endTransformFeedback(),f.setRasterizerState(!0),f.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let K=0;K<this._updateVAO.length;K++)this._engine.releaseVertexArrayObject(this._updateVAO[K]);this._updateVAO.length=0;for(let K=0;K<this._renderVAO.length;K++)this._engine.releaseVertexArrayObject(this._renderVAO[K]);this._renderVAO.length=0}_createUpdateVAO(K){const O={};O.position=K.createVertexBuffer("position",0,3);let F=3;O.age=K.createVertexBuffer("age",F,1),F+=1,O.size=K.createVertexBuffer("size",F,3),F+=3,O.life=K.createVertexBuffer("life",F,1),F+=1,O.seed=K.createVertexBuffer("seed",F,4),F+=4,O.direction=K.createVertexBuffer("direction",F,3),F+=3,this._parent.particleEmitterType instanceof L&&(O.initialPosition=K.createVertexBuffer("initialPosition",F,3),F+=3),this._parent._colorGradientsTexture||(O.color=K.createVertexBuffer("color",F,4),F+=4),this._parent._isBillboardBased||(O.initialDirection=K.createVertexBuffer("initialDirection",F,3),F+=3),this._parent.noiseTexture&&(O.noiseCoordinates1=K.createVertexBuffer("noiseCoordinates1",F,3),F+=3,O.noiseCoordinates2=K.createVertexBuffer("noiseCoordinates2",F,3),F+=3),this._parent._angularSpeedGradientsTexture?(O.angle=K.createVertexBuffer("angle",F,1),F+=1):(O.angle=K.createVertexBuffer("angle",F,2),F+=2),this._parent._isAnimationSheetEnabled&&(O.cellIndex=K.createVertexBuffer("cellIndex",F,1),F+=1,this._parent.spriteRandomStartCell&&(O.cellStartOffset=K.createVertexBuffer("cellStartOffset",F,1),F+=1));const f=this._engine.recordVertexArrayObject(O,null,this._updateEffect);return this._engine.bindArrayBuffer(null),f}});class A{constructor(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,f=arguments.length>3?arguments[3]:void 0;this._engine=K,this._label=f,this._engine._storageBuffers.push(this),this._create(O,F)}_create(K,O){this._bufferSize=K,this._creationFlags=O,this._buffer=this._engine.createStorageBuffer(K,O,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(K,O,F){this._buffer&&this._engine.updateStorageBuffer(this._buffer,K,O,F)}async read(K,O,F,f){return await this._engine.readFromStorageBuffer(this._buffer,K,O,F,f)}dispose(){const K=this._engine._storageBuffers,O=K.indexOf(this);-1!==O&&(K[O]=K[K.length-1],K.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var Q=F(11693),R=F(11698),G=F(11753),z=F(11688),m=F(12030),x=F(11534),V=F(11643),v=F(11945);class Y{constructor(){this._gpuTimeInFrameId=-1,this.counter=new v.d}_addDuration(K,O){K<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==K?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(O,!1),this._gpuTimeInFrameId=K):this.counter.addCount(O,!1))}}var B=F(11588);class n{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=K,this._engine=O,this.uniqueId=m.b.UniqueId,O.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Y),this._engine.getCaps().supportComputeShaders?f.bindingsMapping?(this._context=O.createComputeContext(),this._shaderPath=F,this._options={bindingsMapping:{},defines:[],...f}):x.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):x.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(K,O){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const f=this._bindings[K];this._bindings[K]={type:F?0:4,object:O,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!f||f.object!==O||f.type!==this._bindings[K].type)}setStorageTexture(K,O){const F=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==O),this._bindings[K]={type:1,object:O,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setExternalTexture(K,O){const F=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==O),this._bindings[K]={type:6,object:O,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setVideoTexture(K,O){return!!O.externalTexture&&(this.setExternalTexture(K,O.externalTexture),!0)}setUniformBuffer(K,O){const F=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==O),this._bindings[K]={type:n._BufferIsDataBuffer(O)?7:2,object:O,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setStorageBuffer(K,O){const F=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==O),this._bindings[K]={type:n._BufferIsDataBuffer(O)?7:3,object:O,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setTextureSampler(K,O){const F=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!F||!O.compareSampler(F.object)),this._bindings[K]={type:5,object:O,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}isReady(){let K=this._effect;for(const r in this._bindings){const K=this._bindings[r],O=K.type,F=K.object;switch(O){case 0:case 4:case 1:if(!F.isReady())return!1;break;case 6:if(!F.isReady())return!1;break}}const O=[],F=this._shaderPath;if(this._options.defines)for(let r=0;r<this._options.defines.length;r++)O.push(this._options.defines[r]);const f=O.join("\n");return this._cachedDefines!==f&&(this._cachedDefines=f,K=this._engine.createComputeEffect(F,{defines:f,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=K),!!K.isReady()}dispatch(K,O,F){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,K,O,F,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const F=n._BufferIsDataBuffer(K)?K:K.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,F,O,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const O in this._bindings){const F=this._bindings[O];if(!this._options.bindingsMapping[O])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+O+"'");switch(F.type){case 0:{const f=this._samplers[O],r=F.object;var K;if(!f||!r._texture||!f.compareSampler(r._texture))this._samplers[O]=(new V.d).setParameters(r.wrapU,r.wrapV,r.wrapR,r.anisotropicFilteringLevel,r._texture.samplingMode,null===(K=r._texture)||void 0===K?void 0:K._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const K=F.object;K.getBuffer()!==F.buffer&&(F.buffer=K.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((r=>{(0,B.g)((()=>this.dispatch(K,O,F)),r,void 0,f)}))}serialize(){const K=G.e.Serialize(this);K.options=this._options,K.shaderPath=this._shaderPath,K.mj={},K.textures={};for(const O in this._bindings){const F=this._bindings[O],f=F.object;switch(F.type){case 0:case 4:case 1:{const r=f.serialize();r&&(K.textures[O]=r,K.mj[O]={type:F.type});break}}}return K}static Parse(K,O,F){const f=G.e.Parse((()=>new n(K.name,O.getEngine(),K.shaderPath,K.options)),K,O,F);for(const r in K.textures){const l=K.mj[r],q=z.b.Parse(K.textures[r],O,F);0===l.type?f.setTexture(r,q):4===l.type?f.setTexture(r,q,!1):f.setStorageTexture(r,q)}return f}static _BufferIsDataBuffer(K){return void 0!==K.underlyingResource}}(0,Q.c)([(0,R.N)()],n.prototype,"name",void 0),(0,Q.c)([(0,R.N)()],n.prototype,"fastMode",void 0),(0,J.g)("BABYLON.ComputeShader",n);var C=F(11988);const I="gpuUpdateParticlesComputeShader",D="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";H.c.ShadersStoreWGSL[I]||(H.c.ShadersStoreWGSL[I]=D);(0,J.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(K,O){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=K,this._engine=O}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var K;return(null===(K=this._updateComputeShader)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){var O;const F={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(F.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(F.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(F.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(F.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(F.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(F.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(F.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new n("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:F,defines:K.split("\n")}),null===(O=this._simParamsComputeShader)||void 0===O||O.dispose(),this._simParamsComputeShader=new C.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new g(this._simParamsComputeShader)}createVertexBuffers(K,O){this._renderVertexBuffers.push(O)}createParticleBuffer(K){const O=new A(this._engine,4*K.length,11,"ComputeShaderParticleSystemBuffer");return O.update(K),this._bufferComputeShader.push(O),O.getBuffer()}bindDrawBuffers(K,O,F){this._engine.bindBuffers(this._renderVertexBuffers[K],F,O)}preUpdateParticleBuffer(){}updateParticleBuffer(K,O,F){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[K]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^K]),this._updateComputeShader.dispatch(Math.ceil(F/64))}releaseBuffers(){var K;for(let O=0;O<this._bufferComputeShader.length;++O)this._bufferComputeShader[O].dispose();this._bufferComputeShader.length=0,null===(K=this._simParamsComputeShader)||void 0===K||K.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class h{constructor(K,O,F){this.gradient=K,this.color1=O,this.color2=F}getColorToRef(K){this.color2?q.kJ.LerpToRef(this.color1,this.color2,Math.random(),K):K.l(this.color1)}}class b{constructor(K,O){this.gradient=K,this.color=O}}class i{constructor(K,O,F){this.gradient=K,this.factor1=O,this.factor2=F}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class w{static GetCurrentGradient(K,O,F){if(O[0].gradient>K)return void F(O[0],O[0],1);for(let r=0;r<O.length-1;r++){const f=O[r],l=O[r+1];if(K>=f.gradient&&K<=l.gradient){return void F(f,l,(K-f.gradient)/(l.gradient-f.gradient))}}const f=O.length-1;F(O[f],O[f],1)}}var s=F(11523),U=F(12221),P=F(11559);class S{constructor(K){this.particleSystem=K,this.position=f.TO.Zero(),this.direction=f.TO.Zero(),this.color=new q.kJ(0,0,0,0),this.colorStep=new q.kJ(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new f.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new q.kJ(0,0,0,0),this._currentColor2=new q.kJ(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=S._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let K=this.age,O=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===O?(O=1,K=this._randomCellOffset):K+=this._randomCellOffset);const F=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let f;f=this._initialSpriteCellLoop?(0,E.Clamp)(K*O%this.lifeTime/this.lifeTime):(0,E.Clamp)(K*O/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+f*F|0}_inheritParticleInfoToSubEmitter(K){if(K.particleSystem.rO.position){const O=K.particleSystem.rO;if(O.position.l(this.position),K.inheritDirection){const K=f.TmpVectors.TO[0];this.direction.normalizeToRef(K),O.setDirection(K,0,Math.PI/2)}}else{K.particleSystem.rO.l(this.position)}this.direction.scaleToRef(K.inheritedVelocityAmount/2,f.TmpVectors.TO[0]),K.particleSystem._inheritedVelocityOffset.l(f.TmpVectors.TO[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const K of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(K)}_reset(){this.age=0,this.id=S._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(K){K.position.l(this.position),this._initialDirection?K._initialDirection?K._initialDirection.l(this._initialDirection):K._initialDirection=this._initialDirection.clone():K._initialDirection=null,K.direction.l(this.direction),this.BJ&&(K.BJ?K.BJ.l(this.BJ):K.BJ=this.BJ.clone()),K.color.l(this.color),K.colorStep.l(this.colorStep),K.lifeTime=this.lifeTime,K.age=this.age,K._randomCellOffset=this._randomCellOffset,K.size=this.size,K.scale.l(this.scale),K.angle=this.angle,K.angularSpeed=this.angularSpeed,K.particleSystem=this.particleSystem,K.cellIndex=this.cellIndex,K.id=this.id,K._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(K._currentColorGradient=this._currentColorGradient,K._currentColor1.l(this._currentColor1),K._currentColor2.l(this._currentColor2)),this._currentSizeGradient&&(K._currentSizeGradient=this._currentSizeGradient,K._currentSize1=this._currentSize1,K._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(K._currentAngularSpeedGradient=this._currentAngularSpeedGradient,K._currentAngularSpeed1=this._currentAngularSpeed1,K._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(K._currentVelocityGradient=this._currentVelocityGradient,K._currentVelocity1=this._currentVelocity1,K._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(K._currentLimitVelocityGradient=this._currentLimitVelocityGradient,K._currentLimitVelocity1=this._currentLimitVelocity1,K._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(K._currentDragGradient=this._currentDragGradient,K._currentDrag1=this._currentDrag1,K._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(K._initialStartSpriteCellId=this._initialStartSpriteCellId,K._initialEndSpriteCellId=this._initialEndSpriteCellId,K._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(K.remapData&&this.remapData?K.remapData.l(this.remapData):K.remapData=new f.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(K._randomNoiseCoordinates1?(K._randomNoiseCoordinates1.l(this._randomNoiseCoordinates1),K._randomNoiseCoordinates2.l(this._randomNoiseCoordinates2)):(K._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),K._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}S._Count=0;var KK=F(11846),OK=(F(11896),F(12099)),FK=F(12092),fK=F(11985);function rK(K,O){const F=(0,E.RandomRange)(0,1);q.kJ.LerpToRef(O.color1,O.color2,F,K.color),O.colorDead.subtractToRef(K.color,O._colorDiff),O._colorDiff.scaleToRef(1/K.lifeTime,K.colorStep)}function lK(K,O){K._currentColorGradient=O._colorGradients[0],K._currentColorGradient.getColorToRef(K.color),K._currentColor1.l(K.color),O._colorGradients.length>1?O._colorGradients[1].getColorToRef(K._currentColor2):K._currentColor2.l(K.color)}function qK(K,O){const F=O._colorGradients;w.GetCurrentGradient(O._ratio,F,((O,F,f)=>{O!==K._currentColorGradient&&(K._currentColor1.l(K._currentColor2),F.getColorToRef(K._currentColor2),K._currentColorGradient=O),q.kJ.LerpToRef(K._currentColor1,K._currentColor2,f,K.color)}))}function JK(K,O){K.colorStep.scaleToRef(O._scaledUpdateSpeed,O._scaledColorStep),K.color.addInPlace(O._scaledColorStep),K.color.a<0&&(K.color.a=0)}function cK(K,O){w.GetCurrentGradient(O._ratio,O._angularSpeedGradients,((O,F,f)=>{O!==K._currentAngularSpeedGradient&&(K._currentAngularSpeed1=K._currentAngularSpeed2,K._currentAngularSpeed2=F.getFactor(),K._currentAngularSpeedGradient=O),K.angularSpeed=(0,E.Lerp)(K._currentAngularSpeed1,K._currentAngularSpeed2,f)}))}function EK(K,O){K.angle+=K.angularSpeed*O._scaledUpdateSpeed}function MK(K,O){O.particleEmitterType.startDirectionFunction(O._emitterWorldMatrix,K.direction,K,O.isLocal,O._emitterInverseWorldMatrix)}function tK(K,O){O.startDirectionFunction(O._emitterWorldMatrix,K.direction,K,O.isLocal)}function jK(K,O){K._currentVelocityGradient=O._velocityGradients[0],K._currentVelocity1=K._currentVelocityGradient.getFactor(),O._velocityGradients.length>1?K._currentVelocity2=O._velocityGradients[1].getFactor():K._currentVelocity2=K._currentVelocity1}function XK(K,O){K._currentLimitVelocityGradient=O._limitVelocityGradients[0],K._currentLimitVelocity1=K._currentLimitVelocityGradient.getFactor(),O._limitVelocityGradients.length>1?K._currentLimitVelocity2=O._limitVelocityGradients[1].getFactor():K._currentLimitVelocity2=K._currentLimitVelocity1}function uK(K,O){w.GetCurrentGradient(O._ratio,O._velocityGradients,((F,f,r)=>{F!==K._currentVelocityGradient&&(K._currentVelocity1=K._currentVelocity2,K._currentVelocity2=f.getFactor(),K._currentVelocityGradient=F),O._directionScale*=(0,E.Lerp)(K._currentVelocity1,K._currentVelocity2,r)}))}function TK(K,O){w.GetCurrentGradient(O._ratio,O._limitVelocityGradients,((F,f,r)=>{F!==K._currentLimitVelocityGradient&&(K._currentLimitVelocity1=K._currentLimitVelocity2,K._currentLimitVelocity2=f.getFactor(),K._currentLimitVelocityGradient=F);const l=(0,E.Lerp)(K._currentLimitVelocity1,K._currentLimitVelocity2,r);K.direction.length()>l&&K.direction.scaleInPlace(O.limitVelocityDamping)}))}function oK(K,O){K.direction.scaleToRef(O._directionScale,O._scaledDirection)}function kK(K,O){O.particleEmitterType.startPositionFunction(O._emitterWorldMatrix,K.position,K,O.isLocal)}function NK(K,O){O.startPositionFunction(O._emitterWorldMatrix,K.position,K,O.isLocal)}function ZK(K,O){K.BJ?K.BJ.l(K.position):K.BJ=K.position.clone(),f.TO.TransformCoordinatesToRef(K.BJ,O._emitterWorldMatrix,K.position)}function LK(K,O){O.isLocal&&K.BJ?(K.BJ.addInPlace(O._scaledDirection),f.TO.TransformCoordinatesToRef(K.BJ,O._emitterWorldMatrix,K.position)):K.position.addInPlace(O._scaledDirection)}function dK(K,O){K._currentDragGradient=O._dragGradients[0],K._currentDrag1=K._currentDragGradient.getFactor(),O._dragGradients.length>1?K._currentDrag2=O._dragGradients[1].getFactor():K._currentDrag2=K._currentDrag1}function aK(K,O){w.GetCurrentGradient(O._ratio,O._dragGradients,((F,f,r)=>{F!==K._currentDragGradient&&(K._currentDrag1=K._currentDrag2,K._currentDrag2=f.getFactor(),K._currentDragGradient=F);const l=(0,E.Lerp)(K._currentDrag1,K._currentDrag2,r);O._scaledDirection.scaleInPlace(1-l)}))}function gK(K,O){K._randomNoiseCoordinates1?(K._randomNoiseCoordinates1.eq(Math.random(),Math.random(),Math.random()),K._randomNoiseCoordinates2.eq(Math.random(),Math.random(),Math.random())):(K._randomNoiseCoordinates1=new f.TO(Math.random(),Math.random(),Math.random()),K._randomNoiseCoordinates2=new f.TO(Math.random(),Math.random(),Math.random()))}function HK(K,O){const F=O._noiseTextureData,r=O._noiseTextureSize;if(F&&r&&K._randomNoiseCoordinates1){const l=O._fetchR(K._randomNoiseCoordinates1.x,K._randomNoiseCoordinates1.y,r.width,r.height,F),q=O._fetchR(K._randomNoiseCoordinates1.z,K._randomNoiseCoordinates2.x,r.width,r.height,F),J=O._fetchR(K._randomNoiseCoordinates2.y,K._randomNoiseCoordinates2.z,r.width,r.height,F),c=f.TmpVectors.TO[0],E=f.TmpVectors.TO[1];c.eq((2*l-1)*O.noiseStrength.x,(2*q-1)*O.noiseStrength.y,(2*J-1)*O.noiseStrength.z),c.scaleToRef(O._tempScaledUpdateSpeed,E),K.direction.addInPlace(E)}}function eK(K,O){O.gravity.scaleToRef(O._tempScaledUpdateSpeed,O._scaledGravity),K.direction.addInPlace(O._scaledGravity)}function WK(K,O){K.size=(0,E.RandomRange)(O.minSize,O.maxSize),K.scale.eq((0,E.RandomRange)(O.minScaleX,O.maxScaleX),(0,E.RandomRange)(O.minScaleY,O.maxScaleY))}function pK(K,O){K._currentSizeGradient=O._sizeGradients[0],K._currentSize1=K._currentSizeGradient.getFactor(),K.size=K._currentSize1,O._sizeGradients.length>1?K._currentSize2=O._sizeGradients[1].getFactor():K._currentSize2=K._currentSize1,K.scale.eq((0,E.RandomRange)(O.minScaleX,O.maxScaleX),(0,E.RandomRange)(O.minScaleY,O.maxScaleY))}function yK(K,O){const F=O._actualFrame/O.targetStopDuration;w.GetCurrentGradient(F,O._startSizeGradients,((F,f,r)=>{F!==O._currentStartSizeGradient&&(O._currentStartSize1=O._currentStartSize2,O._currentStartSize2=f.getFactor(),O._currentStartSizeGradient=F);const l=(0,E.Lerp)(O._currentStartSize1,O._currentStartSize2,r);K.scale.scaleInPlace(l)}))}function AK(K,O){w.GetCurrentGradient(O._ratio,O._sizeGradients,((O,F,f)=>{O!==K._currentSizeGradient&&(K._currentSize1=K._currentSize2,K._currentSize2=F.getFactor(),K._currentSizeGradient=O),K.size=(0,E.Lerp)(K._currentSize1,K._currentSize2,f)}))}function QK(K,O){K.remapData=new f.Vector4(0,1,0,1)}function RK(K,O){O._colorRemapGradients&&O._colorRemapGradients.length>0&&w.GetCurrentGradient(O._ratio,O._colorRemapGradients,((O,F,f)=>{const r=(0,E.Lerp)(O.factor1,F.factor1,f),l=(0,E.Lerp)(O.factor2,F.factor2,f);K.remapData.x=r,K.remapData.y=l-r})),O._alphaRemapGradients&&O._alphaRemapGradients.length>0&&w.GetCurrentGradient(O._ratio,O._alphaRemapGradients,((O,F,f)=>{const r=(0,E.Lerp)(O.factor1,F.factor1,f),l=(0,E.Lerp)(O.factor2,F.factor2,f);K.remapData.z=r,K.remapData.w=l-r}))}function GK(K,O){const F=(0,E.Clamp)(O._actualFrame/O.targetStopDuration);w.GetCurrentGradient(F,O._lifeTimeGradients,((O,f)=>{const r=O,l=f,q=r.getFactor(),J=l.getFactor(),c=(F-r.gradient)/(l.gradient-r.gradient);K.lifeTime=(0,E.Lerp)(q,J,c)})),O._emitPower=(0,E.RandomRange)(O.minEmitPower,O.maxEmitPower)}function zK(K,O){K.lifeTime=(0,E.RandomRange)(O.minLifeTime,O.maxLifeTime),O._emitPower=(0,E.RandomRange)(O.minEmitPower,O.maxEmitPower)}function mK(K,O){0===O._emitPower?(K._initialDirection?K._initialDirection.l(K.direction):K._initialDirection=K.direction.clone(),K.direction.set(0,0,0)):(K._initialDirection=null,K.direction.scaleInPlace(O._emitPower)),K.direction.addInPlace(O._inheritedVelocityOffset)}function xK(K,O){K.angularSpeed=(0,E.RandomRange)(O.minAngularSpeed,O.maxAngularSpeed),K.angle=(0,E.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function VK(K,O){K._currentAngularSpeedGradient=O._angularSpeedGradients[0],K.angularSpeed=K._currentAngularSpeedGradient.getFactor(),K._currentAngularSpeed1=K.angularSpeed,O._angularSpeedGradients.length>1?K._currentAngularSpeed2=O._angularSpeedGradients[1].getFactor():K._currentAngularSpeed2=K._currentAngularSpeed1,K.angle=(0,E.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function vK(K,O){K._initialStartSpriteCellId=O.startSpriteCellID,K._initialEndSpriteCellId=O.endSpriteCellID,K._initialSpriteCellLoop=O.spriteCellLoop}function YK(K,O){K.previousItem=O.previousItem,K.nextItem=O,O.previousItem&&(O.previousItem.nextItem=K),O.previousItem=K}function BK(K,O){K.previousItem=O,K.nextItem=O.nextItem,O.nextItem&&(O.nextItem.previousItem=K),O.nextItem=K}function nK(K,O){let F=O;for(;F.nextItem;)F=F.nextItem;K.previousItem=F,K.nextItem=F.nextItem,F.nextItem=K}function CK(K){K.previousItem&&(K.previousItem.nextItem=K.nextItem),K.nextItem&&(K.nextItem.previousItem=K.previousItem)}class IK extends c{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(K){this._startDirectionFunction!==K&&(this._startDirectionFunction=K,this._directionProcessing.process=K?tK:MK)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(K){this._startPositionFunction!==K&&(this._startPositionFunction=K,this._positionCreation.process=K?NK:kK)}set onDispose(K){this._onDisposeObserver&&this.Wf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Wf.add(K)}get M(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(K){this._useRampGradients!==K&&(this._useRampGradients=K,this._resetEffect(),K?(this._rampCreation={process:QK,previousItem:null,nextItem:null},BK(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:RK,previousItem:null,nextItem:null},BK(this._remapGradientProcessing,this._gravityProcessing)):(CK(this._rampCreation),CK(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(K){this._isLocal!==K&&(this._isLocal=K,K?(this._isLocalCreation={process:ZK,previousItem:null,nextItem:null},BK(this._isLocalCreation,this._positionCreation)):CK(this._isLocalCreation))}get particles(){return this.Aj}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(K){this._animationSheetEnabled!==K&&(this._animationSheetEnabled=K,K?(this._sheetCreation={process:vK,previousItem:null,nextItem:null},BK(this._sheetCreation,this._colorCreation)):CK(this._sheetCreation),this._reset())}getActiveCount(){return this.Aj.length}getClassName(){return"Kc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var K;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[O])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new KK.c(this._engine),this._customWrappers[O].effect=K,this._customWrappers[O].drawContext&&(this._customWrappers[O].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new s.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(K){if(this.noiseTexture!==K){if(this._noiseTexture=K,!K)return CK(this._noiseCreation),void CK(this._noiseProcessing);this._noiseCreation={process:gK,previousItem:null,nextItem:null},BK(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:HK,previousItem:null,nextItem:null},BK(this._noiseProcessing,this._positionProcessing)}}constructor(K,O,F){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(K),this._emitterInverseWorldMatrix=f.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new f.TO,this.Wf=new s.c,this.onStoppedObservable=new s.c,this.onStartedObservable=new s.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.Aj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new q.kJ(0,0,0,0),this._colorDiff=new q.kJ(0,0,0,0),this._scaledDirection=f.TO.Zero(),this._scaledGravity=f.TO.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=K=>{},this.recycleParticle=K=>{const O=this.Aj.pop();O!==K&&O.copyTo(K),this._stockParticles.push(O)},this._createParticle=()=>{let K;return 0!==this._stockParticles.length?(K=this._stockParticles.pop(),K._reset()):K=new S(this),this._prepareParticle(K),K},this.paused=!1,this._shadersLoaded=!1,this._capacity=O,this._epsilon=J,F&&"Scene"!==F.getClassName()?(this._engine=F,this.defaultProjectionMatrix=f.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=F||P.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.pj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:zK,previousItem:null,nextItem:null},this._positionCreation={process:kK,previousItem:null,nextItem:null},BK(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:MK,previousItem:null,nextItem:null},BK(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:mK,previousItem:null,nextItem:null},BK(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:WK,previousItem:null,nextItem:null},BK(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:xK,previousItem:null,nextItem:null},BK(this._angleCreation,this._sizeCreation),this._colorCreation={process:rK,previousItem:null,nextItem:null},BK(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,c||(this._colorProcessing={process:JK,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:EK,previousItem:null,nextItem:null},BK(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:oK,previousItem:null,nextItem:null},BK(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:LK,previousItem:null,nextItem:null},BK(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:eK,previousItem:null,nextItem:null},BK(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=l,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new KK.c(this._engine)},this._customWrappers[0].effect=r,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new t,this.updateFunction=K=>{var O;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(O=this.noiseTexture.getContent())||void 0===O||O.then((K=>{this._noiseTextureData=K})));const F=K===this.Aj;for(let f=0;f<K.length;f++){const O=K[f];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const r=O.age;if(O.age+=this._tempScaledUpdateSpeed,O.age>O.lifeTime){const K=O.age-r,F=O.lifeTime-r;this._tempScaledUpdateSpeed=F*this._tempScaledUpdateSpeed/K,O.age=O.lifeTime}this._ratio=O.age/O.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let l=this._updateQueueStart;for(;l;)l.process(O,this),l=l.nextItem;if(this._isAnimationSheetEnabled&&!c&&O.updateCellIndex(),O._inheritParticleInfoToSubEmitters(),O.age>=O.lifeTime){if(this._emitFromParticle(O),O._attachedSubEmitters){for(const K of O._attachedSubEmitters)K.particleSystem.disposeOnStop=!0,K.particleSystem.stop();O._attachedSubEmitters=null}this.recycleParticle(O),F&&f--}else;}}}serialize(K){throw new Error("Method not implemented.")}clone(K,O){throw new Error("Method not implemented.")}_addFactorGradient(K,O,F,f){const r=new i(O,F,f);K.push(r),K.sort(((K,O)=>K.gradient<O.gradient?-1:K.gradient>O.gradient?1:0))}_removeFactorGradient(K,O){if(!K)return;let F=0;for(const f of K){if(f.gradient===O){K.splice(F,1);break}F++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=GK:this._lifeTimeCreation.process=zK}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:yK,previousItem:null,nextItem:null},BK(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(CK(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(K){this.targetStopDuration!==K&&(this._targetStopDuration=K,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(K,O,F){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,K,O,F),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(K){return this._removeFactorGradient(this._lifeTimeGradients,K),this._syncLifeTimeCreation(),this}addSizeGradient(K,O,F){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=pK,this._sizeGradientProcessing={process:AK,previousItem:null,nextItem:null},YK(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,K,O,F),this}removeSizeGradient(K){var O;return this._removeFactorGradient(this._sizeGradients,K),0===(null===(O=this._sizeGradients)||void 0===O?void 0:O.length)&&(CK(this._sizeGradientProcessing),this._sizeCreation.process=WK),this}addColorRemapGradient(K,O,F){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,K,O,F),this}removeColorRemapGradient(K){return this._removeFactorGradient(this._colorRemapGradients,K),this}addAlphaRemapGradient(K,O,F){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,K,O,F),this}removeAlphaRemapGradient(K){return this._removeFactorGradient(this._alphaRemapGradients,K),this}addAngularSpeedGradient(K,O,F){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=VK,this._angularSpeedGradientProcessing={process:cK,previousItem:null,nextItem:null},YK(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,K,O,F),this}removeAngularSpeedGradient(K){var O;return this._removeFactorGradient(this._angularSpeedGradients,K),0===(null===(O=this._angularSpeedGradients)||void 0===O?void 0:O.length)&&(this._angleCreation.process=xK,CK(this._angularSpeedGradientProcessing)),this}addVelocityGradient(K,O,F){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:jK,previousItem:null,nextItem:null},BK(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:uK,previousItem:null,nextItem:null},YK(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,K,O,F),this}removeVelocityGradient(K){var O;return this._removeFactorGradient(this._velocityGradients,K),0===(null===(O=this._velocityGradients)||void 0===O?void 0:O.length)&&(CK(this._velocityCreation),CK(this._velocityGradientProcessing)),this}addLimitVelocityGradient(K,O,F){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:XK,previousItem:null,nextItem:null},BK(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:TK,previousItem:null,nextItem:null},BK(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,K,O,F),this}removeLimitVelocityGradient(K){var O;return this._removeFactorGradient(this._limitVelocityGradients,K),0===(null===(O=this._limitVelocityGradients)||void 0===O?void 0:O.length)&&(CK(this._limitVelocityCreation),CK(this._limitVelocityGradientProcessing)),this}addDragGradient(K,O,F){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:dK,previousItem:null,nextItem:null},YK(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:aK,previousItem:null,nextItem:null},YK(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,K,O,F),this}removeDragGradient(K){var O;return this._removeFactorGradient(this._dragGradients,K),0===(null===(O=this._dragGradients)||void 0===O?void 0:O.length)&&(CK(this._dragCreation),CK(this._dragGradientProcessing)),this}addEmitRateGradient(K,O,F){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,K,O,F),this}removeEmitRateGradient(K){return this._removeFactorGradient(this._emitRateGradients,K),this}addStartSizeGradient(K,O,F){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,K,O,F),this._syncStartSizeCreation(),this}removeStartSizeGradient(K){return this._removeFactorGradient(this._startSizeGradients,K),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const K=new Uint8Array(4*this._rawTextureWidth),O=q.TmpColors.ZO[0];for(let F=0;F<this._rawTextureWidth;F++){const f=F/this._rawTextureWidth;w.GetCurrentGradient(f,this._rampGradients,((f,r,l)=>{q.ZO.LerpToRef(f.color,r.color,l,O),K[4*F]=255*O.r,K[4*F+1]=255*O.g,K[4*F+2]=255*O.b,K[4*F+3]=255}))}this._rampGradientsTexture=U.e.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((K,O)=>K.gradient<O.gradient?-1:K.gradient>O.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(K,O){this._rampGradients||(this._rampGradients=[]);const F=new b(K,O);return this._rampGradients.push(F),this._syncRampGradientTexture(),this}removeRampGradient(K){return this._removeGradientAndTexture(K,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(K,O,F){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=lK,this._colorProcessing.process=qK);const f=new h(K,O,F);return this._colorGradients.push(f),this._colorGradients.sort(((K,O)=>K.gradient<O.gradient?-1:K.gradient>O.gradient?1:0)),this}removeColorGradient(K){if(!this._colorGradients)return this;let O=0;for(const F of this._colorGradients){if(F.gradient===K){this._colorGradients.splice(O,1);break}O++}return 0===this._colorGradients.length&&(this._colorCreation.process=rK,this._colorProcessing.process=JK),this}resetDrawCache(){if(this._drawWrappers){for(const K of this._drawWrappers)if(K)for(const O of K)null===O||void 0===O||O.dispose();this._drawWrappers=[]}}_fetchR(K,O,F,f,r){return r[4*(((K=.5*Math.abs(K)+.5)*F%F|0)+((O=.5*Math.abs(O)+.5)*f%f|0)*F)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const K=this._engine,O=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*O),this._vertexBuffer=new d.b(K,this._vertexData,!0,O);let F=0;const f=this._vertexBuffer.createVertexBuffer(d.d.PositionKind,F,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[d.d.PositionKind]=f,F+=3;const r=this._vertexBuffer.createVertexBuffer(d.d.ColorKind,F,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[d.d.ColorKind]=r,F+=4;const l=this._vertexBuffer.createVertexBuffer("angle",F,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=l,F+=1;const q=this._vertexBuffer.createVertexBuffer("size",F,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=q,F+=2,this._isAnimationSheetEnabled){const K=this._vertexBuffer.createVertexBuffer("cellIndex",F,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=K,F+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const K=this._vertexBuffer.createVertexBuffer("direction",F,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=K,F+=3}if(this._useRampGradients){const K=this._vertexBuffer.createVertexBuffer("remapData",F,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=K,F+=4}let J;if(this._useInstancing){const O=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new d.b(K,O,!1,2),J=this._spriteBuffer.createVertexBuffer("offset",0,2)}else J=this._vertexBuffer.createVertexBuffer("offset",F,2,this._vertexBufferSize,this._useInstancing),F+=2;this._vertexBuffers.offset=J,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const K=[],O=[];let F=0;for(let f=0;f<this._capacity;f++)K.push(F),K.push(F+1),K.push(F+2),K.push(F),K.push(F+2),K.push(F+3),O.push(F,F+1,F+1,F+2,F+2,F+3,F+3,F,F,F+3),F+=4;this._indexBuffer=this._engine.createIndexBuffer(K),this._linesIndexBuffer=this._engine.createIndexBuffer(O)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(K)setTimeout((()=>{this.start(0)}),K);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var O;-1!==(null===(O=this.rO)||void 0===O?void 0:O.getClassName().indexOf("Mesh"))&&this.rO.Pf(!0);const K=this.noiseTexture;if(K&&K.onGeneratedObservable)K.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let O=0;O<this.preWarmCycles;O++)this.animate(!0),K.render()}))}));else for(let O=0;O<this.preWarmCycles;O++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(K))}_postStop(K){}reset(){this._stockParticles.length=0,this.Aj.length=0}_appendParticleVertex(K,O,F,r){let l=K*this._vertexBufferSize;if(this._vertexData[l++]=O.position.x+this.DE.x,this._vertexData[l++]=O.position.y+this.DE.y,this._vertexData[l++]=O.position.z+this.DE.z,this._vertexData[l++]=O.color.r,this._vertexData[l++]=O.color.g,this._vertexData[l++]=O.color.b,this._vertexData[l++]=O.color.a,this._vertexData[l++]=O.angle,this._vertexData[l++]=O.scale.x*O.size,this._vertexData[l++]=O.scale.y*O.size,this._isAnimationSheetEnabled&&(this._vertexData[l++]=O.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[l++]=O.direction.x,this._vertexData[l++]=O.direction.y,this._vertexData[l++]=O.direction.z);else if(O._initialDirection){let K=O._initialDirection;this.isLocal&&(f.TO.TransformNormalToRef(K,this._emitterWorldMatrix,f.TmpVectors.TO[0]),K=f.TmpVectors.TO[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[l++]=K.x,this._vertexData[l++]=K.y,this._vertexData[l++]=K.z}else{let K=O.direction;this.isLocal&&(f.TO.TransformNormalToRef(K,this._emitterWorldMatrix,f.TmpVectors.TO[0]),K=f.TmpVectors.TO[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[l++]=K.x,this._vertexData[l++]=K.y,this._vertexData[l++]=K.z}this._useRampGradients&&O.remapData&&(this._vertexData[l++]=O.remapData.x,this._vertexData[l++]=O.remapData.y,this._vertexData[l++]=O.remapData.z,this._vertexData[l++]=O.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===F?F=this._epsilon:1===F&&(F=1-this._epsilon),0===r?r=this._epsilon:1===r&&(r=1-this._epsilon)),this._vertexData[l++]=F,this._vertexData[l++]=r)}_prepareParticle(K){}_createNewOnes(K){let O;for(let F=0;F<K&&this.Aj.length!==this._capacity;F++){O=this._createParticle(),this.Aj.push(O);let K=this._createQueueStart;for(;K;)K.process(O,this),K=K.nextItem;O._inheritParticleInfoToSubEmitters()}}_update(K){if(this._alive=this.Aj.length>0,this.rO.position){const K=this.rO;this._emitterWorldMatrix=K.getWorldMatrix()}else{const K=this.rO;this._emitterWorldMatrix=f.Matrix.Translation(K.x,K.y,K.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Aj),this._createNewOnes(K)}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=[d.d.PositionKind,d.d.ColorKind,"angle","offset","size"];return K&&f.push("cellIndex"),O||f.push("direction"),F&&f.push("remapData"),f}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,OK.e)(f),K&&f.push("particlesInfos"),O&&f.push("logarithmicDepthConstant"),F&&(f.push("vFogInfos"),f.push("vFogColor")),f}fillDefines(K,O){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OK.i)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&K.push("#define FOG")),this._isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),O===c.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&K.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case 2:K.push("#define BILLBOARDY");break;case 8:case 9:K.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&K.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:K.push("#define BILLBOARDMODE_ALL")}F&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,O,F){O.push(...IK._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),K.push(...IK._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),F.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,fK.h)(K,this._imageProcessingConfigurationDefines),(0,fK.d)(F,this._imageProcessingConfigurationDefines))}_getWrapper(K){const O=this._getCustomDrawWrapper(K);if(null!==O&&void 0!==O&&O.effect)return O;const F=[];this.fillDefines(F,K);const f=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let r=this._drawWrappers[f];r||(r=this._drawWrappers[f]=[]);let l=r[K];l||(l=new KK.c(this._engine),l.drawContext&&(l.drawContext.useInstancing=this._useInstancing),r[K]=l);const q=F.join("\n");if(l.defines!==q){const K=[],O=[],F=[];this.fillUniformsAttributesAndSamplerNames(O,K,F),l.setEffect(this._engine.createEffect("particles",K,O,F,q,void 0,void 0,void 0,void 0,this._shaderLanguage),q)}return l}animate(){var K;let O,F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!F&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(F?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this.manualEmitCount>-1)O=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let K=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const O=this._actualFrame/this.targetStopDuration;w.GetCurrentGradient(O,this._emitRateGradients,((O,F,f)=>{O!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=F.getFactor(),this._currentEmitRateGradient=O),K=(0,E.Lerp)(this._currentEmitRate1,this._currentEmitRate2,f)}))}O=K*this._scaledUpdateSpeed|0,this._newPartsExcess+=K*this._scaledUpdateSpeed-O}if(this._newPartsExcess>1&&(O+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?O=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(O),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!F){let K=0;for(let O=0;O<this.Aj.length;O++){const F=this.Aj[O];this._appendParticleVertices(K,F),K+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Aj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(K,O){this._appendParticleVertex(K++,O,0,0),this._useInstancing||(this._appendParticleVertex(K++,O,1,0),this._appendParticleVertex(K++,O,1,1),this._appendParticleVertex(K++,O,0,1))}rebuild(){var K;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(K=this._spriteBuffer)||void 0===K||K._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!IK.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(F.bind(F,13205)),Promise.resolve().then(F.bind(F,13162))])):await Promise.all([Promise.resolve().then(F.bind(F,13158)),Promise.resolve().then(F.bind(F,13143))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.rO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==c.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(c.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(c.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(K){const O=this._getWrapper(K),F=O.effect,r=this._engine;r.enableEffect(O);const l=this.defaultViewMatrix??this._scene.getViewMatrix();if(F.setTexture("diffuseSampler",this.particleTexture),F.setMatrix("view",l),F.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();F.setFloat3("particlesInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,this.spriteCellWidth/K.width)}if(F.setVector2("translationPivot",this.translationPivot),F.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;F.setVector3("eyePosition",K.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),F.setTexture("rampSampler",this._rampGradientsTexture));const q=F.defines;var J,c,E,M,t,j;(this._scene&&((0,OK.g)(F,this,this._scene),this.applyFog&&(0,FK.f)(this._scene,void 0,F)),q.indexOf("#define BILLBOARDMODE_ALL")>=0&&(l.invertToRef(f.TmpVectors.Matrix[0]),F.setMatrix("invView",f.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?r.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,F):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,F)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?r.bindBuffers(this._vertexBuffers,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBuffer:this._indexBuffer,F):r.bindBuffers(this._vertexBuffers,null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._linesIndexBufferUseInstancing:null,F);(this.useLogarithmicDepth&&this._scene&&(0,FK.j)(q,F,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(F),this._setEngineBasedOnBlendMode(K),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(F),this._useInstancing)?null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?r.drawElementsType(6,0,10,this.Aj.length):r.drawArraysType(7,0,4,this.Aj.length):null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?r.drawElementsType(1,0,10*this.Aj.length):r.drawElementsType(0,0,6*this.Aj.length);return this.Aj.length}render(){if(!this.isReady()||!this.Aj.length)return 0;const K=this._engine;K.setState&&(K.setState(!1),this.forceDepthWrite&&K.setDepthWrite(!0));let O=0;return O=this.blendMode===c.BLENDMODE_MULTIPLYADD?this._render(c.BLENDMODE_MULTIPLY)+this._render(c.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),O}_onDispose(){}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(O,F),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const K=this._scene.pj.indexOf(this);K>-1&&this._scene.pj.splice(K,1),this._scene._activeParticleSystems.dispose()}this.Wf.notifyObservers(this),this.Wf.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}IK.ForceGLSL=!1;var DK,hK=F(11546);!function(K){K[K.ATTACHED=0]="ATTACHED",K[K.END=1]="END"}(DK||(DK={}));class bK{constructor(K){if(this.particleSystem=K,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!K.rO||!K.rO.dispose){const O=(0,J.d)("BABYLON.AbstractMesh");K.rO=new O("SubemitterSystemEmitter",K.HK()),K._disposeEmitterOnDispose=!0}}clone(){let K=this.particleSystem.rO;if(K){if(K instanceof f.TO)K=K.clone();else if(-1!==K.getClassName().indexOf("Mesh")){K=new((0,J.d)("BABYLON.Mesh"))("",K.HK()),K.isVisible=!1}}else K=new f.TO;const O=new bK(this.particleSystem.clone(this.particleSystem.name,K));return O.particleSystem.name+="Clone",O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem._disposeEmitterOnDispose=!0,O.particleSystem.disposeOnStop=!0,O}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem=this.particleSystem.serialize(K),O}static _ParseParticleSystem(K,O,F){throw(0,hK.d)("ParseParticle")}static Parse(K,O,F){const f=K.particleSystem,r=new bK(bK._ParseParticleSystem(f,O,F,!0));return r.type=K.type,r.inheritDirection=K.inheritDirection,r.inheritedVelocityAmount=K.inheritedVelocityAmount,r.particleSystem._isSubEmitter=!0,r}dispose(){this.particleSystem.dispose()}}var iK=F(11597);function wK(K,O){const F=new k;return F.direction1=K,F.direction2=O,F}function sK(){return new o(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function UK(){return new N(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function PK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.TO(0,1,0),F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.TO(0,1,0);return new Z(K,O,F)}function SK(){return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function KO(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.TO(0,1,0),l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.TO(0,1,0);return new T(K,O,F,r,l)}function OO(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new j(K,O)}function FO(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.TO(0,1,0),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.TO(0,1,0);return new X(K,O,F,r)}const fO=f.TO.Zero(),rO=f.TO.Zero(),lO=f.TO.Zero();class qO{constructor(){this.strength=0,this.position=f.TO.Zero()}_processParticle(K,O){this.position.subtractToRef(K.position,fO);const F=fO.lengthSquared()+1;fO.normalize().scaleToRef(this.strength/F,rO),rO.scaleToRef(O._tempScaledUpdateSpeed,lO),K.direction.addInPlace(lO)}serialize(){return{position:this.position.hf(),strength:this.strength}}}class JO extends IK{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=K=>{if(!this._subEmitters||0===this._subEmitters.length)return;const O=Math.floor(Math.random()*this._subEmitters.length);for(const F of this._subEmitters[O])if(1===F.type){const O=F.clone();K._inheritParticleInfoToSubEmitter(O),O.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(O.particleSystem),O.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(K,O){const F=wK(K,O);return this.particleEmitterType=F,F}get flowMap(){return this._flowMap}set flowMap(K){this._flowMap!==K&&(this._flowMap=K,this._flowMapUpdate&&(CK(this._flowMapUpdate),this._flowMapUpdate=null),K&&(this._flowMapUpdate={process:K=>{var O;const F=null===(O=this.HK())||void 0===O?void 0:O.getTransformMatrix();this._flowMap._processParticle(K,this.flowMapStrength*this._tempScaledUpdateSpeed,F)},previousItem:null,nextItem:null},BK(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(K){this._attractors.push(K),1===this._attractors.length&&(this._attractorUpdate={process:K=>{for(const O of this._attractors)O._processParticle(K,this)},previousItem:null,nextItem:null},BK(this._attractorUpdate,this._directionProcessing))}removeAttractor(K){const O=this._attractors.indexOf(K);-1!==O&&this._attractors.splice(O,1),0===this._attractors.length&&CK(this._attractorUpdate)}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(K)}createHemisphericEmitter(){const K=sK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=UK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=PK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.TO(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.TO(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=SK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=KO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.TO(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.TO(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=FO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.TO(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.TO(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,O,F,f){const r=new t;return this.particleEmitterType=r,this.direction1=K,this.direction2=O,this.minEmitBox=F,this.maxEmitBox=f,r}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const K of this.subEmitters)K instanceof JO?this._subEmitters.push([new bK(K)]):K instanceof bK?this._subEmitters.push([K]):K instanceof Array&&this._subEmitters.push(K)}_stopSubEmitters(){if(this.activeSubSystems){for(const K of this.activeSubSystems)K.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const K=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==K&&this._rootParticleSystem.activeSubSystems.splice(K,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(K){K&&this._stopSubEmitters()}_prepareParticle(K){if(this._subEmitters&&this._subEmitters.length>0){const O=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];K._attachedSubEmitters=[];for(const F of O)if(0===F.type){const O=F.clone();K._attachedSubEmitters.push(O),O.particleSystem.start()}}}_onDispose(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),K&&this.particles)for(const F of this.particles)if(F._attachedSubEmitters)for(let K=F._attachedSubEmitters.length-1;K>=0;K-=1)F._attachedSubEmitters[K].dispose();if(O&&this.activeSubSystems)for(let F=this.activeSubSystems.length-1;F>=0;F-=1)this.activeSubSystems[F].dispose();if(this._subEmitters&&this._subEmitters.length){for(let K=0;K<this._subEmitters.length;K++)for(const O of this._subEmitters[K])O.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.rO&&this.rO.dispose&&this.rO.dispose(!0)}static _Parse(K,O,F,r){let l;l=F instanceof iK.c?null:F;const c=(0,J.d)("BABYLON.Texture");if(c&&l&&(K.texture?O.particleTexture=c.Parse(K.texture,l,r):K.textureName&&(O.particleTexture=new c(r+K.textureName,l,!1,void 0===K.invertY||K.invertY),O.particleTexture.name=K.textureName)),K.emitterId||0===K.emitterId||void 0!==K.rO?K.emitterId&&l?O.rO=l.getLastMeshById(K.emitterId):O.rO=f.TO.LO(K.rO):O.rO=f.TO.Zero(),O.isLocal=!!K.isLocal,void 0!==K.renderingGroupId&&(O.renderingGroupId=K.renderingGroupId),void 0!==K.isBillboardBased&&(O.isBillboardBased=K.isBillboardBased),void 0!==K.billboardMode&&(O.billboardMode=K.billboardMode),void 0!==K.useLogarithmicDepth&&(O.useLogarithmicDepth=K.useLogarithmicDepth),K.animations){for(let F=0;F<K.animations.length;F++){const f=K.animations[F],r=(0,J.d)("BABYLON.Animation");r&&O.animations.push(r.Parse(f))}O.beginAnimationOnStart=K.beginAnimationOnStart,O.beginAnimationFrom=K.beginAnimationFrom,O.beginAnimationTo=K.beginAnimationTo,O.beginAnimationLoop=K.beginAnimationLoop}if(K.autoAnimate&&l&&l.beginAnimation(O,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),O.startDelay=0|K.startDelay,O.minAngularSpeed=K.minAngularSpeed,O.maxAngularSpeed=K.maxAngularSpeed,O.minSize=K.minSize,O.maxSize=K.maxSize,K.minScaleX&&(O.minScaleX=K.minScaleX,O.maxScaleX=K.maxScaleX,O.minScaleY=K.minScaleY,O.maxScaleY=K.maxScaleY),void 0!==K.preWarmCycles&&(O.preWarmCycles=K.preWarmCycles,O.preWarmStepOffset=K.preWarmStepOffset),void 0!==K.minInitialRotation&&(O.minInitialRotation=K.minInitialRotation,O.maxInitialRotation=K.maxInitialRotation),O.minLifeTime=K.minLifeTime,O.maxLifeTime=K.maxLifeTime,O.minEmitPower=K.minEmitPower,O.maxEmitPower=K.maxEmitPower,O.emitRate=K.emitRate,O.gravity=f.TO.LO(K.gravity),K.noiseStrength&&(O.noiseStrength=f.TO.LO(K.noiseStrength)),O.color1=q.kJ.LO(K.color1),O.color2=q.kJ.LO(K.color2),O.colorDead=q.kJ.LO(K.colorDead),O.updateSpeed=K.updateSpeed,O.targetStopDuration=K.targetStopDuration,O.blendMode=K.blendMode,K.colorGradients)for(const f of K.colorGradients)O.addColorGradient(f.gradient,q.kJ.LO(f.color1),f.color2?q.kJ.LO(f.color2):void 0);if(K.rampGradients){for(const F of K.rampGradients)O.addRampGradient(F.gradient,q.ZO.LO(F.color));O.useRampGradients=K.useRampGradients}if(K.colorRemapGradients)for(const f of K.colorRemapGradients)O.addColorRemapGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(K.alphaRemapGradients)for(const f of K.alphaRemapGradients)O.addAlphaRemapGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(K.sizeGradients)for(const f of K.sizeGradients)O.addSizeGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(K.angularSpeedGradients)for(const f of K.angularSpeedGradients)O.addAngularSpeedGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(K.velocityGradients)for(const f of K.velocityGradients)O.addVelocityGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(K.dragGradients)for(const f of K.dragGradients)O.addDragGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(K.emitRateGradients)for(const f of K.emitRateGradients)O.addEmitRateGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(K.startSizeGradients)for(const f of K.startSizeGradients)O.addStartSizeGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(K.lifeTimeGradients)for(const f of K.lifeTimeGradients)O.addLifeTimeGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(K.limitVelocityGradients){for(const F of K.limitVelocityGradients)O.addLimitVelocityGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);O.limitVelocityDamping=K.limitVelocityDamping}if(K.noiseTexture&&l){const F=(0,J.d)("BABYLON.ProceduralTexture");O.noiseTexture=F.Parse(K.noiseTexture,l,r)}let E;if(K.particleEmitterType){switch(K.particleEmitterType.type){case"SphereParticleEmitter":E=new N;break;case"SphereDirectedParticleEmitter":E=new Z;break;case"ConeEmitter":case"ConeParticleEmitter":E=new j;break;case"ConeDirectedParticleEmitter":E=new X;break;case"CylinderParticleEmitter":E=new u;break;case"CylinderDirectedParticleEmitter":E=new T;break;case"HemisphericParticleEmitter":E=new o;break;case"PointParticleEmitter":E=new k;break;case"MeshParticleEmitter":E=new a;break;case"CustomParticleEmitter":E=new L;break;default:E=new t}E.parse(K.particleEmitterType,l)}else E=new t,E.parse(K,l);O.particleEmitterType=E,O.startSpriteCellID=K.startSpriteCellID,O.endSpriteCellID=K.endSpriteCellID,O.spriteCellLoop=K.spriteCellLoop??!0,O.spriteCellWidth=K.spriteCellWidth,O.spriteCellHeight=K.spriteCellHeight,O.spriteCellChangeSpeed=K.spriteCellChangeSpeed,O.spriteRandomStartCell=K.spriteRandomStartCell,O.disposeOnStop=K.disposeOnStop??!1,O.manualEmitCount=K.manualEmitCount??-1}static Parse(K,O,F){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4?arguments[4]:void 0;const J=K.name;let c,E,M=null,t=null;if(O instanceof iK.c?c=O:(E=O,c=E.getEngine()),K.customShader&&c.createEffectForParticles){t=K.customShader;const O=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"";M=c.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,O)}const j=new JO(J,l||K.VO,O,M,K.isAnimationSheetEnabled);if(j.customShader=t,j._rootUrl=F,K.id&&(j.id=K.id),K.subEmitters){j.subEmitters=[];for(const f of K.subEmitters){const K=[];for(const r of f)K.push(bK.Parse(r,O,F));j.subEmitters.push(K)}}if(K.attractors)for(const q of K.attractors){const K=new qO;K.position=f.TO.LO(q.position),K.strength=q.strength,j.addAttractor(K)}return JO._Parse(K,j,O,F),K.textureMask&&(j.textureMask=q.kJ.LO(K.textureMask)),K.DE&&(j.DE=f.TO.LO(K.DE)),K.preventAutoStart&&(j.preventAutoStart=K.preventAutoStart),r||j.preventAutoStart||j.start(),j}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};if(JO._Serialize(O,this,K),O.textureMask=this.textureMask.hf(),O.customShader=this.customShader,O.preventAutoStart=this.preventAutoStart,O.DE=this.DE.hf(),this.subEmitters){O.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const F of this._subEmitters){const f=[];for(const O of F)f.push(O.serialize(K));O.subEmitters.push(f)}}if(this._attractors&&this._attractors.length){O.attractors=[];for(const K of this._attractors)O.attractors.push(K.serialize())}return O}static _Serialize(K,O,F){if(K.name=O.name,K.id=O.id,K.VO=O.getCapacity(),K.disposeOnStop=O.disposeOnStop,K.manualEmitCount=O.manualEmitCount,O.rO.position){const F=O.rO;K.emitterId=F.id}else{const F=O.rO;K.rO=F.hf()}O.particleEmitterType&&(K.particleEmitterType=O.particleEmitterType.serialize()),O.particleTexture&&(F?K.texture=O.particleTexture.serialize():(K.textureName=O.particleTexture.name,K.invertY=!!O.particleTexture._invertY)),K.isLocal=O.isLocal,G.e.AppendSerializedAnimations(O,K),K.beginAnimationOnStart=O.beginAnimationOnStart,K.beginAnimationFrom=O.beginAnimationFrom,K.beginAnimationTo=O.beginAnimationTo,K.beginAnimationLoop=O.beginAnimationLoop,K.startDelay=O.startDelay,K.renderingGroupId=O.renderingGroupId,K.isBillboardBased=O.isBillboardBased,K.billboardMode=O.billboardMode,K.minAngularSpeed=O.minAngularSpeed,K.maxAngularSpeed=O.maxAngularSpeed,K.minSize=O.minSize,K.maxSize=O.maxSize,K.minScaleX=O.minScaleX,K.maxScaleX=O.maxScaleX,K.minScaleY=O.minScaleY,K.maxScaleY=O.maxScaleY,K.minEmitPower=O.minEmitPower,K.maxEmitPower=O.maxEmitPower,K.minLifeTime=O.minLifeTime,K.maxLifeTime=O.maxLifeTime,K.emitRate=O.emitRate,K.gravity=O.gravity.hf(),K.noiseStrength=O.noiseStrength.hf(),K.color1=O.color1.hf(),K.color2=O.color2.hf(),K.colorDead=O.colorDead.hf(),K.updateSpeed=O.updateSpeed,K.targetStopDuration=O.targetStopDuration,K.blendMode=O.blendMode,K.preWarmCycles=O.preWarmCycles,K.preWarmStepOffset=O.preWarmStepOffset,K.minInitialRotation=O.minInitialRotation,K.maxInitialRotation=O.maxInitialRotation,K.startSpriteCellID=O.startSpriteCellID,K.spriteCellLoop=O.spriteCellLoop,K.endSpriteCellID=O.endSpriteCellID,K.spriteCellChangeSpeed=O.spriteCellChangeSpeed,K.spriteCellWidth=O.spriteCellWidth,K.spriteCellHeight=O.spriteCellHeight,K.spriteRandomStartCell=O.spriteRandomStartCell,K.isAnimationSheetEnabled=O.isAnimationSheetEnabled,K.useLogarithmicDepth=O.useLogarithmicDepth;const f=O.getColorGradients();if(f){K.colorGradients=[];for(const O of f){const F={gradient:O.gradient,color1:O.color1.hf()};O.color2?F.color2=O.color2.hf():F.color2=O.color1.hf(),K.colorGradients.push(F)}}const r=O.getRampGradients();if(r){K.rampGradients=[];for(const O of r){const F={gradient:O.gradient,color:O.color.hf()};K.rampGradients.push(F)}K.useRampGradients=O.useRampGradients}const l=O.getColorRemapGradients();if(l){K.colorRemapGradients=[];for(const O of l){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.colorRemapGradients.push(F)}}const q=O.getAlphaRemapGradients();if(q){K.alphaRemapGradients=[];for(const O of q){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.alphaRemapGradients.push(F)}}const J=O.getSizeGradients();if(J){K.sizeGradients=[];for(const O of J){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.sizeGradients.push(F)}}const c=O.getAngularSpeedGradients();if(c){K.angularSpeedGradients=[];for(const O of c){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.angularSpeedGradients.push(F)}}const E=O.getVelocityGradients();if(E){K.velocityGradients=[];for(const O of E){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.velocityGradients.push(F)}}const M=O.getDragGradients();if(M){K.dragGradients=[];for(const O of M){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.dragGradients.push(F)}}const t=O.getEmitRateGradients();if(t){K.emitRateGradients=[];for(const O of t){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.emitRateGradients.push(F)}}const j=O.getStartSizeGradients();if(j){K.startSizeGradients=[];for(const O of j){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.startSizeGradients.push(F)}}const X=O.getLifeTimeGradients();if(X){K.lifeTimeGradients=[];for(const O of X){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.lifeTimeGradients.push(F)}}const u=O.getLimitVelocityGradients();if(u){K.limitVelocityGradients=[];for(const O of u){const F={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?F.factor2=O.factor2:F.factor2=O.factor1,K.limitVelocityGradients.push(F)}K.limitVelocityDamping=O.limitVelocityDamping}O.noiseTexture&&(K.noiseTexture=O.noiseTexture.serialize())}clone(K,O){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f={...this._customWrappers};let r=null;const l=this._engine;if(l.createEffectForParticles&&null!=this.customShader){r=this.customShader;const K=r.shaderOptions.defines.length>0?r.shaderOptions.defines.join("\n"):"",O=l.createEffectForParticles(r.shaderPath.fragmentElement,r.shaderOptions.uniforms,r.shaderOptions.samplers,K);f[0]?f[0].effect=O:this.setCustomEffect(O,0)}const q=this.serialize(F),J=JO.Parse(q,this._scene||this._engine,this._rootUrl);return J.name=K,J.customShader=r,J._customWrappers=f,void 0===O&&(O=this.rO),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.rO=O,this.preventAutoStart||J.start(),J}}JO.BILLBOARDMODE_Y=2,JO.BILLBOARDMODE_ALL=7,JO.BILLBOARDMODE_STRETCHED=8,JO.BILLBOARDMODE_STRETCHED_LOCAL=9,bK._ParseParticleSystem=JO.Parse;var cO=F(11967),EO=F(11964),MO=F(11859);MO.b.prototype.createTransformFeedback=function(){const K=this._gl.createTransformFeedback();if(!K)throw new Error("Unable to create Transform Feedback");return K},MO.b.prototype.deleteTransformFeedback=function(K){this._gl.deleteTransformFeedback(K)},MO.b.prototype.bindTransformFeedback=function(K){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,K)},MO.b.prototype.beginTransformFeedback=function(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(K?this._gl.POINTS:this._gl.TRIANGLES)},MO.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},MO.b.prototype.setTranformFeedbackVaryings=function(K,O){this._gl.transformFeedbackVaryings(K,O,this._gl.INTERLEAVED_ATTRIBS)},MO.b.prototype.bindTransformFeedbackBuffer=function(K){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K?K.underlyingResource:null)},MO.b.prototype.readTransformFeedbackBuffer=function(K){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K)};const tO="clipPlaneFragmentDeclaration2",jO="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";H.c.IncludesShadersStore[tO]||(H.c.IncludesShadersStore[tO]=jO);F(13035),F(13037),F(13041),F(13044),F(13048),F(13053),F(13061),F(13070);const XO="gpuRenderParticlesPixelShader",uO="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";H.c.ShadersStore[XO]||(H.c.ShadersStore[XO]=uO);const TO="clipPlaneVertexDeclaration2",oO="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";H.c.IncludesShadersStore[TO]||(H.c.IncludesShadersStore[TO]=oO);F(13077),F(13086),F(13095),F(13102);const kO="gpuRenderParticlesVertexShader",NO="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";H.c.ShadersStore[kO]||(H.c.ShadersStore[kO]=NO);class ZO extends c{static get IsSupported(){if(!P.e.LastCreatedEngine)return!1;const K=P.e.LastCreatedEngine.getCaps();return K.supportTransformFeedbacks||K.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(K){this._maxActiveParticleCount=Math.min(K,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(K){this.maxActiveParticleCount=K}createPointEmitter(K,O){const F=wK(K,O);return this.particleEmitterType=F,F}createHemisphericEmitter(){const K=sK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=UK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=PK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.TO(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.TO(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=SK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=KO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.TO(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.TO(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=FO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.TO(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.TO(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,O,F,f){const r=new t;return this.particleEmitterType=r,this.direction1=K,this.direction2=O,this.minEmitBox=F,this.maxEmitBox=f,r}get flowMap(){return this._flowMap}set flowMap(K){this._flowMap!==K&&(this._flowMap=K)}isReady(){if(!this.rO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==JO.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(JO.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(JO.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";K?setTimeout((()=>{this.start(0)}),K):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var K;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[O])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new KK.c(this._engine),this._customWrappers[O].effect=K}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new s.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(K,O,F){return super._removeGradientAndTexture(K,O,F),this._releaseBuffers(),this}addColorGradient(K,O){this._colorGradients||(this._colorGradients=[]);const F=new h(K,O);return this._colorGradients.push(F),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(K&&this._colorGradients.sort(((K,O)=>K.gradient<O.gradient?-1:K.gradient>O.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(K){return this._removeGradientAndTexture(K,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const O in this._drawWrappers){var K;null===(K=this._drawWrappers[O].drawContext)||void 0===K||K.reset()}}_addFactorGradient(K,O,F){const f=new i(O,F);K.push(f),this._releaseBuffers()}addSizeGradient(K,O){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,K,O),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(K){return this._removeGradientAndTexture(K,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(K,O){if(!K)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&K.sort(((K,O)=>K.gradient<O.gradient?-1:K.gradient>O.gradient?1:0));const F=this;F[O]&&(F[O].dispose(),F[O]=null)}addAngularSpeedGradient(K,O){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,K,O),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(K){return this._removeGradientAndTexture(K,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(K,O){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,K,O),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(K){return this._removeGradientAndTexture(K,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(K,O){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,K,O),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(K){return this._removeGradientAndTexture(K,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(K,O){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,K,O),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(K){return this._removeGradientAndTexture(K,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(K){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(K,O,F){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(K),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Wf=new s.c,this.onStoppedObservable=new s.c,this.onStartedObservable=new s.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,F&&"Scene"!==F.getClassName()?(this._engine=F,this.defaultProjectionMatrix=f.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=F||P.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.pj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,J.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,J.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new KK.c(this._engine)},this._customWrappers[0].effect=r,this._drawWrappers={0:new KK.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(O=O??{}).randomTextureSize||delete O.randomTextureSize;const q={VO:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...O},c=O;isFinite(c)&&(q.VO=c),this._capacity=q.VO,this._maxActiveParticleCount=q.VO,this._currentActiveCount=0,this._isAnimationSheetEnabled=l,this.particleEmitterType=new t;const E=Math.min(this._engine.getCaps().maxTextureSize,q.randomTextureSize);let M=[];for(let f=0;f<E;++f)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture=new U.e(new Float32Array(M),E,1,5,F,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,M=[];for(let f=0;f<E;++f)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture2=new U.e(new Float32Array(M),E,1,5,F,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=E}_reset(){this._releaseBuffers()}_createVertexBuffers(K,O,F){const f={};f.position=O.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let r=3;f.age=O.createVertexBuffer("age",r,1,this._attributesStrideSize,!0),r+=1,f.size=O.createVertexBuffer("size",r,3,this._attributesStrideSize,!0),r+=3,f.life=O.createVertexBuffer("life",r,1,this._attributesStrideSize,!0),r+=1,r+=4,this.billboardMode===JO.BILLBOARDMODE_STRETCHED&&(f.direction=O.createVertexBuffer("direction",r,3,this._attributesStrideSize,!0)),r+=3,this._platform.alignDataInBuffer&&(r+=1),this.particleEmitterType instanceof L&&(r+=3,this._platform.alignDataInBuffer&&(r+=1)),this._colorGradientsTexture||(f.color=O.createVertexBuffer("color",r,4,this._attributesStrideSize,!0),r+=4),this._isBillboardBased||(f.initialDirection=O.createVertexBuffer("initialDirection",r,3,this._attributesStrideSize,!0),r+=3,this._platform.alignDataInBuffer&&(r+=1)),this.noiseTexture&&(f.noiseCoordinates1=O.createVertexBuffer("noiseCoordinates1",r,3,this._attributesStrideSize,!0),r+=3,this._platform.alignDataInBuffer&&(r+=1),f.noiseCoordinates2=O.createVertexBuffer("noiseCoordinates2",r,3,this._attributesStrideSize,!0),r+=3,this._platform.alignDataInBuffer&&(r+=1)),f.angle=O.createVertexBuffer("angle",r,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?r++:r+=2,this._isAnimationSheetEnabled&&(f.cellIndex=O.createVertexBuffer("cellIndex",r,1,this._attributesStrideSize,!0),r+=1,this.spriteRandomStartCell&&(f.cellStartOffset=O.createVertexBuffer("cellStartOffset",r,1,this._attributesStrideSize,!0),r+=1)),f.offset=F.createVertexBuffer("offset",0,2),f.uv=F.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(f),this._platform.createVertexBuffers(K,f),this.resetDrawCache()}_initialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!K)return;const O=this._engine,F=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof L&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const r=this.particleEmitterType instanceof L,l=f.TmpVectors.TO[0];let q=0;for(let f=0;f<this._capacity;f++)if(F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),r?(this.particleEmitterType.particleDestinationGenerator(f,null,l),F.push(l.x),F.push(l.y),F.push(l.z)):(F.push(0),F.push(0),F.push(0)),this._platform.alignDataInBuffer&&F.push(0),q+=16,r&&(this.particleEmitterType.particlePositionGenerator(f,null,l),F.push(l.x),F.push(l.y),F.push(l.z),this._platform.alignDataInBuffer&&F.push(0),q+=4),this._colorGradientsTexture||(F.push(0),F.push(0),F.push(0),F.push(0),q+=4),this.isBillboardBased||(F.push(0),F.push(0),F.push(0),this._platform.alignDataInBuffer&&F.push(0),q+=4),this.noiseTexture&&(F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),this._platform.alignDataInBuffer&&F.push(0),F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),this._platform.alignDataInBuffer&&F.push(0),q+=8),F.push(0),q+=1,this._angularSpeedGradientsTexture||(F.push(0),q+=1),this._isAnimationSheetEnabled&&(F.push(0),q+=1,this.spriteRandomStartCell&&(F.push(0),q+=1)),this._platform.alignDataInBuffer){let K=3-(q+3&3);for(q+=K;K-- >0;)F.push(0)}const J=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),c=this._platform.createParticleBuffer(F),E=this._platform.createParticleBuffer(F);this._buffer0=new d.b(O,c,!1,this._attributesStrideSize),this._buffer1=new d.b(O,E,!1,this._attributesStrideSize),this._spriteBuffer=new d.b(O,J,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let K=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(K+="\n#define BILLBOARD"),this._colorGradientsTexture&&(K+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(K+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(K+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(K+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(K+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(K+="\n#define DRAGGRADIENTS"),this._flowMap&&(K+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(K+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(K+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(K+="\n#define NOISE"),this.isLocal&&(K+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===K||(this._cachedUpdateDefines=K,this._updateBuffer=this._platform.createUpdateBuffer(K)),this._platform.isUpdateBufferReady()}_getWrapper(K){const O=this._getCustomDrawWrapper(K);if(null!==O&&void 0!==O&&O.effect)return O;const F=[];this.fillDefines(F,K);let f=this._drawWrappers[K];f||(f=new KK.c(this._engine),f.drawContext&&(f.drawContext.useInstancing=!0),this._drawWrappers[K]=f);const r=F.join("\n");if(f.defines!==r){const K=[],O=[],F=[];this.fillUniformsAttributesAndSamplerNames(O,K,F),f.setEffect(this._engine.createEffect("gpuRenderParticles",K,O,F,r),r)}return f}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=[d.d.PositionKind,"age","life","size","angle"];return K||r.push(d.d.ColorKind),O&&r.push("cellIndex"),F||r.push("initialDirection"),f&&r.push("direction"),r.push("offset",d.d.UVKind),r}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=["emitterWM","DE","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,OK.e)(f),K&&f.push("sheetInfos"),O&&f.push("logarithmicDepthConstant"),F&&(f.push("vFogInfos"),f.push("vFogColor")),f}fillDefines(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OK.i)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==EO.d.FOGMODE_NONE&&K.push("#define FOG")),O===JO.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this.isLocal&&K.push("#define LOCAL"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case JO.BILLBOARDMODE_Y:K.push("#define BILLBOARDY");break;case JO.BILLBOARDMODE_STRETCHED:K.push("#define BILLBOARDSTRETCHED");break;case JO.BILLBOARDMODE_ALL:K.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&K.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),F&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,O,F){O.push(...ZO._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===JO.BILLBOARDMODE_STRETCHED)),K.push(...ZO._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),F.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(cO.d.PrepareUniforms(K,this._imageProcessingConfigurationDefines),cO.d.PrepareSamplers(F,this._imageProcessingConfigurationDefines))}animate(){var K;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(O?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(K,O){const F=this[O];if(!K||!K.length||F)return;const f=new Float32Array(this._rawTextureWidth);for(let r=0;r<this._rawTextureWidth;r++){const O=r/this._rawTextureWidth;w.GetCurrentGradient(O,K,((K,O,F)=>{f[r]=(0,E.Lerp)(K.factor1,O.factor1,F)}))}this[O]=U.e.CreateRTexture(f,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[O].name=O.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const K=new Uint8Array(4*this._rawTextureWidth),O=q.TmpColors.kJ[0];for(let F=0;F<this._rawTextureWidth;F++){const f=F/this._rawTextureWidth;w.GetCurrentGradient(f,this._colorGradients,((f,r,l)=>{q.kJ.LerpToRef(f.color1,r.color1,l,O),K[4*F]=255*O.r,K[4*F+1]=255*O.g,K[4*F+2]=255*O.b,K[4*F+3]=255*O.a}))}this._colorGradientsTexture=U.e.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(K,O){var F,r,l,q;const J=this._getWrapper(K),c=J.effect;this._engine.enableEffect(J);const E=(null===(F=this._scene)||void 0===F?void 0:F.getViewMatrix())||f.Matrix.IdentityReadOnly;if(c.setMatrix("view",E),c.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),c.setTexture("diffuseSampler",this.particleTexture),c.setVector2("translationPivot",this.translationPivot),c.setVector3("DE",this.DE),this.isLocal&&c.setMatrix("emitterWM",O),this._colorGradientsTexture?c.setTexture("colorGradientSampler",this._colorGradientsTexture):c.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();c.setFloat3("sheetInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,K.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;c.setVector3("eyePosition",K.globalPosition)}const M=c.defines;if(this._scene&&((0,OK.g)(c,this,this._scene),this.applyFog&&(0,FK.f)(this._scene,void 0,c)),M.indexOf("#define BILLBOARDMODE_ALL")>=0){const K=E.clone();K.invert(),c.setMatrix("invView",K)}return this.useLogarithmicDepth&&this._scene&&(0,FK.j)(M,c,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(c),this._setEngineBasedOnBlendMode(K),this._platform.bindDrawBuffers(this._targetIndex,c,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(c),null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(q=this._scene)&&void 0!==q&&q.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(K){if(!this.rO||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!K)if(this.rO.position){K=this.rO.getWorldMatrix()}else{const O=this.rO;K=f.TmpVectors.Matrix[0],f.Matrix.TranslationToRef(O.x,O.y,O.z,K)}const O=this._engine,F=O.getDepthWrite();if(O.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const K=this.HK();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",K.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",K),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const r=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=r,O.setDepthWrite(F)}render(){let K,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!O&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let K=0;K<this.preWarmCycles;K++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const K=0|this._accumulatedCount;this._accumulatedCount-=K,this._currentActiveCount+=K}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.rO.position){K=this.rO.getWorldMatrix()}else{const O=this.rO;K=f.TmpVectors.Matrix[0],f.Matrix.TranslationToRef(O.x,O.y,O.z,K)}const r=this._engine;this.updateInAnimate||this._update(K);let l=0;return O||F||(r.setState(!1),this.forceDepthWrite&&r.setDepthWrite(!0),l=this.blendMode===JO.BLENDMODE_MULTIPLYADD?this._render(JO.BLENDMODE_MULTIPLY,K)+this._render(JO.BLENDMODE_ADD,K):this._render(this.blendMode,K),this._engine.setAlphaMode(0)),l}rebuild(){const K=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(K,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,K()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const O in this._drawWrappers){this._drawWrappers[O].dispose()}if(this._drawWrappers={},this._scene){const K=this._scene.pj.indexOf(this);K>-1&&this._scene.pj.splice(K,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let O=0;O<this._renderVertexBuffers.length;++O){const K=this._renderVertexBuffers[O];for(const O in K)K[O].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Wf.notifyObservers(this),this.Wf.clear()}clone(K,O){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f={...this._customWrappers};let r=null;const l=this._engine;if(l.createEffectForParticles&&null!=this.customShader){r=this.customShader;const K=r.shaderOptions.defines.length>0?r.shaderOptions.defines.join("\n"):"";f[0]=l.createEffectForParticles(r.shaderPath.fragmentElement,r.shaderOptions.uniforms,r.shaderOptions.samplers,K,void 0,void 0,void 0,this)}const q=this.serialize(F),J=ZO.Parse(q,this._scene||this._engine,this._rootUrl);return J.name=K,J.customShader=r,J._customWrappers=f,void 0===O&&(O=this.rO),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.rO=O,J}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return JO._Serialize(O,this,K),O.activeParticleCount=this.activeParticleCount,O.randomTextureSize=this._randomTextureSize,O.customShader=this.customShader,O}static Parse(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0;const l=K.name;let q,J;O instanceof iK.c?q=O:(J=O,q=J.getEngine());const c=new ZO(l,{VO:r||K.VO,randomTextureSize:K.randomTextureSize},O,null,K.isAnimationSheetEnabled);if(c._rootUrl=F,K.customShader&&q.createEffectForParticles){const O=K.customShader,F=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"",f=q.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,F,void 0,void 0,void 0,c);c.setCustomEffect(f,0),c.customShader=O}return K.id&&(c.id=K.id),K.activeParticleCount&&(c.activeParticleCount=K.activeParticleCount),JO._Parse(K,c,O,F),K.preventAutoStart&&(c.preventAutoStart=K.preventAutoStart),f||c.preventAutoStart||c.start(),c}}var LO=F(11517),dO=F(13109),aO=F(12106);class gO{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(K){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const O of this.systems)O.rO=K;this._emitterNode=K}setEmitterAsSphere(K,O,F){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:K,renderingGroupId:O};const f=(0,dO.d)("emitterSphere",{diameter:K.diameter,segments:K.segments},F);f.renderingGroupId=O;const r=new aO.NO("emitterSphereMaterial",F);r.emissiveColor=K.color,f.material=r;for(const l of this.systems)l.rO=f;this._emitterNode=f}start(K){for(const O of this.systems)K&&(O.rO=K),O.start()}dispose(){for(const K of this.systems)K.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={systems:[]};for(const F of this.systems)O.systems.push(F.serialize(K));return this._emitterNode&&(O.rO=this._emitterCreationOptions),O}static Parse(K,O){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;const r=new gO,l=this.BaseAssetsUrl+"/textures/";O=O||P.e.LastCreatedScene;for(const q of K.systems)r.systems.push(F?ZO.Parse(q,O,l,!0,f):JO.Parse(q,O,l,!0,f));if(K.rO){const F=K.rO.options;if("Sphere"===K.rO.kind)r.setEmitterAsSphere({diameter:F.diameter,segments:F.segments,color:q.ZO.LO(F.color)},K.rO.renderingGroupId,O)}return r}}gO.BaseAssetsUrl="https://assets.babylonjs.com/particles";var HO=F(11550);class eO{static CreateDefault(K){let O,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,f=arguments.length>2?arguments[2]:void 0;O=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ZO("default system",{VO:F},f):new JO("default system",F,f),O.rO=K;const r=LO.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return O.particleTexture=new z.b(r,O.HK()),O.createConeEmitter(.1,Math.PI/4),O.color1=new q.kJ(1,1,1,1),O.color2=new q.kJ(1,1,1,1),O.colorDead=new q.kJ(1,1,1,0),O.minSize=.1,O.maxSize=.1,O.minEmitPower=2,O.maxEmitPower=2,O.updateSpeed=1/60,O.emitRate=30,O}static CreateAsync(K,O){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;O||(O=P.e.LastCreatedScene);const r={};return O.addPendingData(r),new Promise(((l,q)=>{if(F&&!ZO.IsSupported)return O.removePendingData(r),q("Particle system with GPU is not supported.");LO.Tools.LoadFile(`${eO.BaseAssetsUrl}/systems/${K}.json`,(K=>{O.removePendingData(r);const q=JSON.parse(K.toString());return l(gO.Parse(q,O,F,f))}),void 0,void 0,void 0,(()=>(O.removePendingData(r),q(`An error occurred with the creation of your particle system. Check if your type '${K}' exists.`))))}))}static ExportSet(K){const O=new gO;for(const F of K)O.systems.push(F);return O}static ParseFromFileAsync(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=arguments.length>5?arguments[5]:void 0;return new Promise(((q,J)=>{const c=new HO.e;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const O=JSON.parse(c.responseText);let J;J=f?ZO.Parse(O,F,r,!1,l):JO.Parse(O,F,r,!1,l),K&&(J.name=K),q(J)}else J("Unable to load the particle system")})),c.open("GET",O),c.send()}))}static ParseFromSnippetAsync(K,O){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4?arguments[4]:void 0;if("_BLANK"===K){const K=this.CreateDefault(null);return K.start(),Promise.resolve(K)}return new Promise(((l,q)=>{const J=new HO.e;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const q=JSON.parse(JSON.parse(J.responseText).jsonPayload),c=JSON.parse(q.particleSystem);let E;E=F?ZO.Parse(c,O,f,!1,r):JO.Parse(c,O,f,!1,r),E.snippetId=K,l(E)}else q("Unable to load the snippet "+K)})),J.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),J.send()}))}}eO.BaseAssetsUrl=gO.BaseAssetsUrl,eO.SnippetUrl="https://snippet.babylonjs.com",eO.CreateFromSnippetAsync=eO.ParseFromSnippetAsync;var WO=F(12193),pO=F(11998),yO=F(13118);(0,yO.e)(pO.b.NAME_PARTICLESYSTEM,((K,O,F,f)=>{const r=(0,yO.g)(pO.b.NAME_PARTICLESYSTEM);if(r&&void 0!==K.pj&&null!==K.pj)for(let l=0,q=K.pj.length;l<q;l++){const q=K.pj[l];F.pj.push(r(q,O,f))}})),(0,yO.b)(pO.b.NAME_PARTICLESYSTEM,((K,O,F)=>{if(K.activeParticleCount){return ZO.Parse(K,O,F)}return JO.Parse(K,O,F)})),iK.c.prototype.createEffectForParticles=function(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=arguments.length>9?arguments[9]:void 0,t=[],j=[];const X=[];return c?c.fillUniformsAttributesAndSamplerNames(j,t,X):(t=JO._GetAttributeNamesOrOptions(),j=JO._GetEffectCreationOptions()),-1===r.indexOf(" BILLBOARD")&&(r+="\n#define BILLBOARD\n"),null!==c&&void 0!==c&&c.isAnimationSheetEnabled&&-1===r.indexOf(" ANIMATESHEET")&&(r+="\n#define ANIMATESHEET\n"),-1===f.indexOf("diffuseSampler")&&f.push("diffuseSampler"),this.createEffect({vertex:M??(null===c||void 0===c?void 0:c.vertexShaderName)??"particles",fragmentElement:K},t,j.concat(O),X.concat(f),r,l,q,J,void 0,E,(async()=>{0===E?await Promise.resolve().then(F.bind(F,13158)):await Promise.resolve().then(F.bind(F,13205))}))},WO.b.prototype.getEmittedParticleSystems=function(){const K=[];for(let O=0;O<this.HK().pj.length;O++){const F=this.HK().pj[O];F.rO===this&&K.push(F)}return K},WO.b.prototype.getHierarchyEmittedParticleSystems=function(){const K=[],O=this.getDescendants();O.push(this);for(let F=0;F<this.HK().pj.length;F++){const f=this.HK().pj[F],r=f.rO;r.position&&-1!==O.indexOf(r)&&K.push(f)}return K};F(12072),F(12086),F(12164);F(12171),F(13123),F(11930),F(12062),F(12215);F(11926);var AO;F(13132),F(11742);!function(K){K[K.Color=2]="Color",K[K.UV=1]="UV",K[K.Random=0]="Random",K[K.Stated=3]="Stated"}(AO||(AO={}));var QO=F(11959);const RO=new f.TO(0,0,0),GO=new f.TO(0,0,0),zO=new f.TO(0,0,0);class mO{constructor(K,O,F){this.width=K,this.height=O,this.data=F}processFlowable(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2?arguments[2]:void 0;if(!F)return;F instanceof f.Matrix?f.TO.TransformCoordinatesToRef(K.position,F,zO):(zO.x=F.x,zO.y=F.y,zO.z=F.z);const r=.5*zO.x+.5,l=1-(.5*zO.y+.5),q=Math.floor(r*this.width),J=Math.floor(l*this.height);if(q<0||q>=this.width||J<0||J>=this.height)return;const c=4*(J*this.width+q),E=this.data[c]/255*2-1,M=this.data[c+1]/255*2-1,t=this.data[c+2]/255*2-1,j=this.data[c+3]/255;RO.set(E,M,t),RO.scaleToRef(O*j,GO),K.direction.addInPlace(GO)}_processParticle(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2?arguments[2]:void 0;this.processFlowable(K,O,F)}static async FromUrlAsync(K){return await new Promise(((O,F)=>{const f=document.createElement("canvas"),r=f.getContext("2d");let l=null;const q=new Image;q.crossOrigin="anonymous",q.src=K,q.onerror=O=>{F(new Error(`Failed to load image: ${K} : ${O}`))},q.onload=()=>{f.width=q.width,f.height=q.height,r.drawImage(q,0,0),l=r.getImageData(0,0,f.width,f.height),O(new mO(f.width,f.height,l.data))}}))}static async ExtractFromTextureAsync(K){return await new Promise(((O,F)=>{if(!K.isReady())return void K.onLoadObservable.addOnce((async()=>{try{const F=await this.ExtractFromTextureAsync(K);O(F)}catch(f){F(f)}}));const f=K.getSize();QO.j.GetTextureDataAsync(K,f.width,f.height).then((K=>{O(new mO(f.width,f.height,new Uint8ClampedArray(K)))})).catch(F)}))}}var xO,VO,vO,YO,BO,nO,CO,IO,DO;!function(K){K[K.Int=1]="Int",K[K.Float=2]="Float",K[K.Vector2=4]="Vector2",K[K.TO=8]="TO",K[K.Matrix=16]="Matrix",K[K.Particle=32]="Particle",K[K.Texture=64]="Texture",K[K.kJ=128]="kJ",K[K.FloatGradient=256]="FloatGradient",K[K.Vector2Gradient=512]="Vector2Gradient",K[K.Vector3Gradient=1024]="Vector3Gradient",K[K.Color4Gradient=2048]="Color4Gradient",K[K.System=4096]="System",K[K.AutoDetect=8192]="AutoDetect",K[K.BasedOnInput=16384]="BasedOnInput",K[K.Undefined=32768]="Undefined",K[K.All=65535]="All"}(xO||(xO={})),function(K){K[K.Compatible=0]="Compatible",K[K.TypeIncompatible=1]="TypeIncompatible",K[K.HierarchyIssue=2]="HierarchyIssue"}(VO||(VO={})),function(K){K[K.Input=0]="Input",K[K.Output=1]="Output"}(vO||(vO={}));class hO{get direction(){return this._direction}get type(){if(this._type===xO.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===xO.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(K){this._type=K}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((K=>K.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(K,O,F){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=xO.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new s.c,this.onDisconnectionObservable=new s.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=O,this.name=K,this._direction=F}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(K){var O;return this.isConnected?null!==(O=this._connectedPoint)&&void 0!==O&&O._storedFunction?this._connectedPoint._storedFunction(K):this._connectedPoint._storedValue:this.value}canConnectTo(K){return 0===this.checkCompatibilityState(K)}checkCompatibilityState(K){const O=this._ownerBlock,F=K.ownerBlock;if(this.type!==K.type&&K.innerType!==xO.AutoDetect)return K.acceptedConnectionPointTypes&&-1!==K.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(K.excludedConnectionPointTypes&&-1!==K.excludedConnectionPointTypes.indexOf(this.type))return 1;let f=F,r=O;return 0===this.direction&&(f=O,r=F),f.isAnAncestorOf(r)?2:0}connectTo(K){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(K))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${K.ownerBlock.name}".${K.name}`;return this._endpoints.push(K),K._connectedPoint=this,this.onConnectionObservable.notifyObservers(K),K.onConnectionObservable.notifyObservers(this),this}disconnectFrom(K){const O=this._endpoints.indexOf(K);return-1===O||(this._endpoints.splice(O,1),K._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(K),K.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(K){let O=1;for(;O<xO.All;)K&O||this.excludedConnectionPointTypes.push(O),O<<=1}serialize(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O={};return O.name=this.name,O.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.hf?(O.valueType="BABYLON."+this.value.getClassName(),O.value=this.value.hf()):(O.valueType="number",O.value=this.value)),K&&this.connectedPoint&&(O.inputName=this.name,O.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,O.targetConnectionName=this.connectedPoint.name,O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),O}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class bO{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(K){this._name=K}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(K){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new s.c,this.Wf=new s.c,this.onInputChangedObservable=new s.c,this.visibleOnFrame=!1,this._name=K,this.uniqueId=m.b.UniqueId}_inputRename(K){return K}_outputRename(K){return K}isAnAncestorOf(K){for(const O of this._outputs)if(O.hasEndpoints)for(const F of O.endpoints){if(F.ownerBlock===K)return!0;if(F.ownerBlock.isAnAncestorOf(K))return!0}return!1}isAnAncestorOfType(K){if(this.getClassName()===K)return!0;for(const O of this._outputs)if(O.hasEndpoints)for(const F of O.endpoints)if(F.ownerBlock.isAnAncestorOfType(K))return!0;return!1}getInputByName(K){const O=this._inputs.filter((O=>O.name===K));return O.length?O[0]:null}_linkConnectionTypes(K,O){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[O]._acceptedConnectionPointType=this._inputs[K]:(this._inputs[K]._linkedConnectionSource=this._inputs[O],this._inputs[K]._isMainLinkSource=!0),this._inputs[O]._linkedConnectionSource=this._inputs[K]}registerInput(K,O){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0;const q=new hO(K,this,0);return q.type=O,q.isOptional=F,q.defaultValue=f,q.value=f,q.valueMin=r,q.valueMax=l,this._inputs.push(q),this.onInputChangedObservable.notifyObservers(q),this}registerOutput(K,O,F){return(F=F??new hO(K,this,1)).type=O,this._outputs.push(F),this}_build(K){}_customBuildStep(K){}build(K){if(this._buildId===K.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((K=>K.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=K.buildId;for(const O of this._inputs){if(!O.connectedPoint){O.isOptional||K.notConnectedNonOptionalInputs.push(O);continue}const F=O.connectedPoint.ownerBlock;F&&F!==this&&!F.isSystem&&F.build(K)}return this._customBuildStep(K),K.verbose&&x.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(K),this.onBuildObservable.notifyObservers(this),!1}serialize(){const K={};K.customType="BABYLON."+this.getClassName(),K.id=this.uniqueId,K.name=this.name,K.visibleOnFrame=this.visibleOnFrame,K.inputs=[],K.outputs=[];for(const O of this.inputs)K.inputs.push(O.serialize());for(const O of this.outputs)K.outputs.push(O.serialize(!1));return K}_deserialize(K){this._name=K.name,this.comments=K.comments,this.visibleOnFrame=!!K.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(K)}_deserializePortDisplayNamesAndExposedOnFrame(K){const O=K.inputs,F=K.outputs;if(O)for(const f of O){const K=this.inputs.find((K=>K.name===f.name));if(!K)return;if(f.displayName&&(K.displayName=f.displayName),f.isExposedOnFrame&&(K.isExposedOnFrame=f.isExposedOnFrame,K.exposedPortPosition=f.exposedPortPosition),void 0!==f.value&&null!==f.value)if("number"===f.valueType)K.value=f.value;else{const O=(0,J.d)(f.valueType);O&&(K.value=O.LO(f.value))}}if(F)for(let f=0;f<F.length;f++){const K=F[f];K.displayName&&(this.outputs[f].displayName=K.displayName),K.isExposedOnFrame&&(this.outputs[f].isExposedOnFrame=K.isExposedOnFrame,this.outputs[f].exposedPortPosition=K.exposedPortPosition)}}clone(){const K=this.serialize(),O=(0,J.d)(K.customType);if(O){const F=new O;return F._deserialize(K),F}return null}dispose(){this.Wf.notifyObservers(this),this.Wf.clear();for(const K of this.inputs)K.dispose();for(const K of this.outputs)K.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function iO(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",f=arguments.length>3?arguments[3]:void 0;return(r,l)=>{let q=r._propStore;q||(q=[],r._propStore=q),q.push({propertyName:l,displayName:K,type:O,groupName:F,options:f??{},className:r.getClassName()})}}(0,Q.c)([(0,R.N)("comment")],bO.prototype,"comments",void 0),function(K){K[K.Boolean=0]="Boolean",K[K.Float=1]="Float",K[K.Int=2]="Int",K[K.Vector2=3]="Vector2",K[K.List=4]="List",K[K.kJ=5]="kJ",K[K.SamplingMode=6]="SamplingMode",K[K.TextureFormat=7]="TextureFormat",K[K.TextureType=8]="TextureType"}(YO||(YO={})),function(K){K[K.None=0]="None",K[K.Position=1]="Position",K[K.Direction=2]="Direction",K[K.Age=3]="Age",K[K.Lifetime=4]="Lifetime",K[K.Color=5]="Color",K[K.ScaledDirection=6]="ScaledDirection",K[K.Scale=7]="Scale",K[K.AgeGradient=8]="AgeGradient",K[K.Angle=9]="Angle",K[K.SpriteCellIndex=16]="SpriteCellIndex",K[K.SpriteCellStart=17]="SpriteCellStart",K[K.SpriteCellEnd=18]="SpriteCellEnd"}(BO||(BO={})),function(K){K[K.None=0]="None",K[K.Time=1]="Time",K[K.Delta=2]="Delta",K[K.Emitter=3]="Emitter"}(nO||(nO={}));class wO{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let K="";for(const O of this.notConnectedNonOptionalInputs)K+=`input ${O.name} from block ${O.ownerBlock.name}[${O.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(K)throw"Build of Node Particle System Set failed:\n"+K}adapt(K,O){const F=K.getConnectedValue(this)||0;if(K.type===O)return F;switch(O){case xO.Vector2:return new f.Vector2(F,F);case xO.TO:return new f.TO(F,F,F);case xO.kJ:return new q.kJ(F,F,F,F)}return null}getContextualValue(K){if(!this.particleContext||!this.systemContext)return null;switch(K){case BO.Position:return this.particleContext.position;case BO.Direction:return this.particleContext.direction;case BO.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case BO.Color:return this.particleContext.color;case BO.Age:return this.particleContext.age;case BO.Lifetime:return this.particleContext.lifeTime;case BO.Angle:return this.particleContext.angle;case BO.Scale:return this.particleContext.scale;case BO.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case BO.SpriteCellEnd:return this.systemContext.endSpriteCellID;case BO.SpriteCellIndex:return this.particleContext.cellIndex;case BO.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.rO.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.rO.absolutePosition:this.systemContext.rO:null}getSystemValue(K){if(!this.particleContext||!this.systemContext)return null;switch(K){case nO.Time:return this.systemContext._actualFrame;case nO.Delta:return this.systemContext._scaledUpdateSpeed;case nO.Emitter:if(this.isEmitterTransformNode){return this.systemContext.rO.absolutePosition}return this.systemContext.rO}return null}}function sO(K,O,F){const f=new wO;f.kO=O;const r=K.createSystem(f);return r.canStart=()=>!0,r.rO=F.clone(),r.disposeOnStop=!0,r.start(),r}class UO extends bO{constructor(K){super(K),this.blendMode=c.BLENDMODE_ONEONE,this.VO=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",xO.Particle),this.registerInput("texture",xO.Texture),this.registerInput("onStart",xO.System,!0),this.registerInput("onEnd",xO.System,!0),this.registerOutput("system",xO.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(K){K.VO=this.VO,K.buildId=this._buildId++,this.build(K);const O=this.particle.getConnectedValue(K);return O.particleTexture=this.texture.getConnectedValue(K),O.emitRate=this.emitRate,O.blendMode=this.blendMode,O.name=this.name,O._nodeGenerated=!0,O._targetStopDuration=this.targetStopDuration,O.startDelay=this.startDelay,this.system._storedValue=this,O.canStart=()=>!this.doNoStart,O.onStartedObservable.add((F=>{const f=this.onStart.getConnectedValue(K);f&&F.onStartedObservable.addOnce((()=>{K.systemContext=O;const F=sO(f,K.kO,K.emitterPosition);this.Wf.addOnce((()=>{F.dispose()}))}));const r=this.onEnd.getConnectedValue(K);r&&F.onStoppedObservable.addOnce((()=>{K.systemContext=O;const F=sO(r,K.kO,K.emitterPosition);this.Wf.addOnce((()=>{F.dispose()}))}))})),this.Wf.addOnce((()=>{O.dispose()})),O}serialize(){const K=super.serialize();return K.VO=this.VO,K.emitRate=this.emitRate,K.blendMode=this.blendMode,K.doNoStart=this.doNoStart,K.targetStopDuration=this.targetStopDuration,K.startDelay=this.startDelay,K}_deserialize(K){super._deserialize(K),this.VO=K.VO,this.emitRate=K.emitRate,this.doNoStart=!!K.doNoStart,void 0!==K.blendMode&&(this.blendMode=K.blendMode),void 0!==K.targetStopDuration&&(this.targetStopDuration=K.targetStopDuration),void 0!==K.startDelay&&(this.startDelay=K.startDelay)}}(0,Q.c)([iO("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:c.BLENDMODE_ONEONE},{label:"Standard",value:c.BLENDMODE_STANDARD},{label:"Add",value:c.BLENDMODE_ADD},{label:"Multiply",value:c.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:c.BLENDMODE_MULTIPLYADD}]})],UO.prototype,"blendMode",void 0),(0,Q.c)([iO("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],UO.prototype,"VO",void 0),(0,Q.c)([iO("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UO.prototype,"emitRate",void 0),(0,Q.c)([iO("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UO.prototype,"targetStopDuration",void 0),(0,Q.c)([iO("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UO.prototype,"startDelay",void 0),(0,Q.c)([iO("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],UO.prototype,"doNoStart",void 0),(0,J.g)("BABYLON.SystemBlock",UO);class PO extends bO{get type(){if(this._type===xO.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=xO.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=xO.Vector2,this._type;case"TO":return this._type=xO.TO,this._type;case"kJ":return this._type=xO.kJ,this._type;case"Matrix":return this._type=xO.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===BO.None&&this._systemSource!==nO.None}get systemSource(){return this._systemSource}set systemSource(K){if(this._systemSource=K,K!==nO.None){switch(this._contextualSource=BO.None,this._type=xO.Float,K){case nO.Time:case nO.Delta:this._type=xO.Float;break;case nO.Emitter:this._type=xO.TO}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==BO.None}get contextualValue(){return this._contextualSource}set contextualValue(K){if(this._contextualSource=K,K!==BO.None){switch(this._systemSource=nO.None,K){case BO.Scale:this._type=xO.Vector2;break;case BO.Position:case BO.Direction:case BO.ScaledDirection:this._type=xO.TO;break;case BO.Color:this._type=xO.kJ;break;case BO.Age:case BO.Lifetime:case BO.Angle:case BO.AgeGradient:this._type=xO.Float;break;case BO.SpriteCellEnd:case BO.SpriteCellStart:case BO.SpriteCellIndex:this._type=xO.Int}this.output&&(this.output.type=this._type)}}constructor(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xO.AutoDetect;super(K),this._type=xO.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new s.c,this._systemSource=nO.None,this._contextualSource=BO.None,this._type=O,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",O)}get value(){return this._storedValue}set value(K){this.type===xO.Float&&this.min!==this.max&&(K=Math.max(this.min,K),K=Math.min(this.max,K)),this._storedValue=K,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(K){this._valueCallback=K}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case xO.Int:case xO.Float:this.value=0;break;case xO.Vector2:this.value=f.Vector2.Zero();break;case xO.TO:this.value=f.TO.Zero();break;case xO.kJ:this.value=new q.kJ(1,1,1,1);break;case xO.Matrix:this.value=f.Matrix.Identity()}}_build(K){super._build(K),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=K=>K.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=K=>K.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const K=super.serialize();return K.type=this.type,K.contextualValue=this.contextualValue,K.systemSource=this.systemSource,K.min=this.min,K.max=this.max,K.groupInInspector=this.groupInInspector,K.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.hf?(K.valueType="BABYLON."+this._storedValue.getClassName(),K.value=this._storedValue.hf()):(K.valueType="number",K.value=this._storedValue)),K}_deserialize(K){if(super._deserialize(K),this._type=K.type,this.contextualValue=K.contextualValue,this.systemSource=K.systemSource||nO.None,this.min=K.min||0,this.max=K.max||0,this.groupInInspector=K.groupInInspector||"",void 0!==K.displayInInspector&&(this.displayInInspector=K.displayInInspector),K.valueType)if("number"===K.valueType)this._storedValue=K.value;else{const O=(0,J.d)(K.valueType);O&&(this._storedValue=O.LO(K.value))}}}(0,J.g)("BABYLON.ParticleInputBlock",PO);class SO extends bO{get url(){return this._url}set url(K){this._url!==K&&(this._cachedData=null,this._url=K,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(K){this._textureDataUrl!==K&&(this._cachedData=null,this._textureDataUrl=K,this._url="",this._sourceTexture=null)}set sourceTexture(K){this._sourceTexture!==K&&(this._cachedData=null,this._sourceTexture=K,this._url="",this._textureDataUrl="")}constructor(K){super(K),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",xO.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const K=this.texture._storedValue;return await new Promise(((O,F)=>{if(!K.isReady())return void K.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),O(this._cachedData)}catch(K){F(K)}}));const f=K.getSize();QO.j.GetTextureDataAsync(K,f.width,f.height).then((F=>{this._cachedData={width:f.width,height:f.height,data:new Uint8ClampedArray(F)},K.dispose(),O(this._cachedData)})).catch(F)}))}_build(K){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new z.b(this._textureDataUrl,K.kO):this.texture._storedValue=new z.b(this._url,K.kO):this.texture._storedValue=null}serialize(){const K=super.serialize();return K.url=this.url,K.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(K.textureDataUrl=this.textureDataUrl),K}_deserialize(K){super._deserialize(K),this.url=K.url,this.serializedCachedData=!!K.serializedCachedData,K.textureDataUrl&&(this.textureDataUrl=K.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,J.g)("BABYLON.ParticleTextureSourceBlock",SO);class KF extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerInput("position",xO.TO),this.registerOutput("output",xO.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(K){const O=this.particle.getConnectedValue(K);if(this.output._storedValue=O,!this.position.isConnected)return;const F={process:F=>{K.particleContext=F,K.systemContext=O,F.position.l(this.position.getConnectedValue(K))},previousItem:null,nextItem:null};O._updateQueueStart?nK(F,O._updateQueueStart):O._updateQueueStart=F}}(0,J.g)("BABYLON.UpdatePositionBlock",KF),function(K){K[K.Add=0]="Add",K[K.Subtract=1]="Subtract",K[K.Multiply=2]="Multiply",K[K.Divide=3]="Divide",K[K.Max=4]="Max",K[K.Min=5]="Min"}(CO||(CO={}));class OF extends bO{constructor(K){super(K),this.operation=CO.Add,this.registerInput("left",xO.AutoDetect),this.registerInput("right",xO.AutoDetect),this.registerOutput("output",xO.BasedOnInput),this.output._typeConnectionSource=this.left;const O=[xO.Matrix,xO.Particle,xO.Texture,xO.System,xO.FloatGradient,xO.Color4Gradient,xO.Vector2Gradient,xO.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...O),this.right.excludedConnectionPointTypes.push(...O),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(K){let O;const F=this.left,r=this.right;if(!F.isConnected||!r.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const l=F.type===xO.Float||F.type===xO.Int,J=r.type===xO.Float||r.type===xO.Int,c=l&&J;switch(this.operation){case CO.Add:O=c?K=>F.getConnectedValue(K)+r.getConnectedValue(K):l?K=>K.adapt(F,r.type).add(r.getConnectedValue(K)):K=>F.getConnectedValue(K).add(K.adapt(r,F.type));break;case CO.Subtract:O=c?K=>F.getConnectedValue(K)-r.getConnectedValue(K):l?K=>K.adapt(F,r.type).oO(r.getConnectedValue(K)):K=>F.getConnectedValue(K).oO(K.adapt(r,F.type));break;case CO.Multiply:O=c?K=>F.getConnectedValue(K)*r.getConnectedValue(K):l?K=>K.adapt(F,r.type).multiply(r.getConnectedValue(K)):K=>F.getConnectedValue(K).multiply(K.adapt(r,F.type));break;case CO.Divide:O=c?K=>F.getConnectedValue(K)/r.getConnectedValue(K):l?K=>K.adapt(F,r.type).divide(r.getConnectedValue(K)):K=>F.getConnectedValue(K).divide(K.adapt(r,F.type));break;case CO.Min:if(c)O=K=>Math.min(F.getConnectedValue(K),r.getConnectedValue(K));else{const[K,J]=l?[r,F]:[F,r];switch(K.type){case xO.Vector2:O=O=>f.Vector2.Minimize(K.getConnectedValue(O),O.adapt(J,K.type));break;case xO.TO:O=O=>f.TO.Minimize(K.getConnectedValue(O),O.adapt(J,K.type));break;case xO.kJ:O=O=>{const F=K.getConnectedValue(O),{r:f,g:r,b:l,a:c}=O.adapt(J,K.type);return new q.kJ(Math.min(F.r,f),Math.min(F.g,r),Math.min(F.b,l),Math.min(F.a,c))}}}break;case CO.Max:if(!c){const[K,J]=l?[r,F]:[F,r];switch(K.type){case xO.Vector2:O=O=>f.Vector2.Maximize(K.getConnectedValue(O),O.adapt(J,K.type));break;case xO.TO:O=O=>f.TO.Maximize(K.getConnectedValue(O),O.adapt(J,K.type));break;case xO.kJ:O=O=>{const F=K.getConnectedValue(O),{r:f,g:r,b:l,a:c}=O.adapt(J,K.type);return new q.kJ(Math.max(F.r,f),Math.min(F.g,r),Math.min(F.b,l),Math.min(F.a,c))}}break}O=K=>Math.max(F.getConnectedValue(K),r.getConnectedValue(K))}this.output._storedFunction=K=>F.type===xO.Int?0|O(K):O(K)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===xO.Int||this.left.type===xO.Float&&this.right.type!==xO.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[K,O]of[[this.left,this.right],[this.right,this.left]])K.acceptedConnectionPointTypes=[xO.Int,xO.Float],O.isConnected&&(K.acceptedConnectionPointTypes.push(O.type),O.type!==xO.Int&&O.type!==xO.Float||K.acceptedConnectionPointTypes.push(xO.Vector2,xO.TO,xO.kJ))}dispose(){super.dispose();for(const K of this._connectionObservers)K.remove();this._connectionObservers.length=0}serialize(){const K=super.serialize();return K.operation=this.operation,K}_deserialize(K){super._deserialize(K),this.operation=K.operation}}(0,Q.c)([iO("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:CO.Add},{label:"Subtract",value:CO.Subtract},{label:"Multiply",value:CO.Multiply},{label:"Divide",value:CO.Divide},{label:"Max",value:CO.Max},{label:"Min",value:CO.Min}]})],OF.prototype,"operation",void 0),(0,J.g)("BABYLON.ParticleMathBlock",OF);class FF extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerInput("direction1",xO.TO,!0,new f.TO(0,1,0)),this.registerInput("direction2",xO.TO,!0,new f.TO(0,1,0)),this.registerInput("minEmitBox",xO.TO,!0,new f.TO(-.5,-.5,-.5)),this.registerInput("maxEmitBox",xO.TO,!0,new f.TO(.5,.5,.5)),this.registerOutput("output",xO.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(K){const O=this.particle.getConnectedValue(K);O._directionCreation.process=F=>{K.particleContext=F,K.systemContext=O;const r=this.direction1.getConnectedValue(K),l=this.direction2.getConnectedValue(K),q=(0,E.RandomRange)(r.x,l.x),J=(0,E.RandomRange)(r.y,l.y),c=(0,E.RandomRange)(r.z,l.z);K.isEmitterTransformNode?f.TO.TransformNormalFromFloatsToRef(q,J,c,K.emitterWorldMatrix,F.direction):F.direction.eq(q,J,c)},O._positionCreation.process=F=>{K.particleContext=F,K.systemContext=O;const r=this.minEmitBox.getConnectedValue(K),l=this.maxEmitBox.getConnectedValue(K),q=(0,E.RandomRange)(r.x,l.x),J=(0,E.RandomRange)(r.y,l.y),c=(0,E.RandomRange)(r.z,l.z);K.isEmitterTransformNode?f.TO.TransformCoordinatesFromFloatsToRef(q,J,c,K.emitterWorldMatrix,F.position):(F.position.eq(q,J,c),F.position.addInPlace(K.emitterPosition))},this.output._storedValue=O}}(0,J.g)("BABYLON.BoxShapeBlock",FF);class fF extends bO{constructor(K){super(K),this.registerInput("emitPower",xO.Float,!0,1),this.registerInput("lifeTime",xO.Float,!0,1),this.registerInput("color",xO.kJ,!0,new q.kJ(1,1,1,1)),this.registerInput("scale",xO.Vector2,!0,new f.Vector2(1,1)),this.registerInput("angle",xO.Float,!0,0),this.registerOutput("particle",xO.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(K){const O=new JO(this.name,K.VO,K.kO,null,!1,void 0,!0);O.particleEmitterType=new k,O._lifeTimeCreation.process=(O,F)=>{K.particleContext=O,O.lifeTime=this.lifeTime.getConnectedValue(K),F._emitPower=this.emitPower.getConnectedValue(K)},O._colorCreation.process=O=>{K.particleContext=O,O.color.l(this.color.getConnectedValue(K))},O._sizeCreation.process=O=>{K.particleContext=O,O.size=1,O.scale.l(this.scale.getConnectedValue(K))},O._angleCreation.process=O=>{K.particleContext=O,O.angle=this.angle.getConnectedValue(K)},this.particle._storedValue=O}}(0,J.g)("BABYLON.CreateParticleBlock",fF);class rF{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const K=[];for(const O of this.attachedBlocks)O.isInput&&K.push(O);return K}constructor(K){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new s.c,this.name=K}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(K){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(K)&&this.attachedBlocks.push(K);for(const F of K.inputs){const f=F.connectedPoint;if(f){const F=f.ownerBlock;F!==K&&this._initializeBlock(F,O)}}}async buildAsync(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((F=>{const f=new gO;for(const K of this._systemBlocks)this._initializeBlock(K);for(const r of this.systemBlocks){const F=new wO;F.buildId=this._buildId++,F.kO=K,F.verbose=O;const l=r.createSystem(F);F.emitErrors(),f.systems.push(l)}this.onBuildObservable.notifyObservers(this),F(f)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const K=new UO("Particle system"),O=new KF("Update position");O.output.connectTo(K.particle);const F=new PO("Position");F.contextualValue=BO.Position;const f=new PO("Scaled direction");f.contextualValue=BO.ScaledDirection;const r=new OF("Add");r.operation=CO.Add,F.output.connectTo(r.left),f.output.connectTo(r.right),r.output.connectTo(O.position);const l=new fF("Create particle"),q=new FF("Box shape");l.particle.connectTo(q.particle),q.output.connectTo(O.particle);const J=new SO("Texture");J.texture.connectTo(K.texture),J.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(K)}removeBlock(K){const O=this.attachedBlocks.indexOf(K);if(O>-1&&this.attachedBlocks.splice(O,1),K.isSystem){const O=this._systemBlocks.indexOf(K);O>-1&&this._systemBlocks.splice(O,1)}}parseSerializedObject(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O||this.clear();const F={};for(const f of K.DM){const K=(0,J.d)(f.customType);if(K){const O=new K;O._deserialize(f),F[f.id]=O,this.attachedBlocks.push(O),O.isSystem&&this._systemBlocks.push(O)}}for(const f of this.attachedBlocks)if(f.isTeleportOut){const K=f,O=K._tempEntryPointUniqueId;if(O){const f=F[O];f&&f.attachToEndpoint(K)}}for(let f=0;f<K.DM.length;f++){const r=K.DM[f],l=F[r.id];l&&(l.inputs.length&&r.inputs.some((K=>K.targetConnectionName))&&!O||this._restoreConnections(l,K,F))}if(K.locations||K.editorData&&K.editorData.locations){const f=K.locations||K.editorData.locations;for(const K of f)F[K.Kf]&&(K.Kf=F[K.Kf].uniqueId);O&&this.editorData&&this.editorData.locations&&f.concat(this.editorData.locations),K.locations?this.editorData={locations:f}:(this.editorData=K.editorData,this.editorData.locations=f);const r=[];for(const K in F)r[K]=F[K].uniqueId;this.editorData.map=r}this.comment=K.comment}_restoreConnections(K,O,F){for(const f of K.outputs)for(const r of O.DM){const l=F[r.id];if(l)for(const q of r.inputs)if(F[q.targetBlockId]!==K||q.targetConnectionName!==f.name);else{const K=l.getInputByName(q.inputName);if(!K||K.isConnected)continue;f.connectTo(K,!0),this._restoreConnections(l,O,F)}}}serialize(K){const O=K?{}:G.e.Serialize(this);O.editorData=JSON.parse(JSON.stringify(this.editorData));let F=[];K?F=K:O.customType="BABYLON.NodeParticleSystemSet",O.DM=[];for(const f of F)O.DM.push(f.serialize());if(!K)for(const f of this.attachedBlocks)-1===F.indexOf(f)&&O.DM.push(f.serialize());return O}dispose(){for(const K of this.attachedBlocks)K.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(K){const O=new rF(K);return O.setToDefault(),O}static Parse(K){const O=G.e.Parse((()=>new rF(K.name)),K,null);return O.parseSerializedObject(K),O}static ParseFromSnippetAsync(K,O){return"_BLANK"===K?Promise.resolve(rF.CreateDefault("blank")):new Promise(((F,f)=>{const r=new HO.e;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const q=JSON.parse(JSON.parse(r.responseText).jsonPayload),J=JSON.parse(q.nodeParticle);O||(O=G.e.Parse((()=>new rF(K)),J,null)),O.parseSerializedObject(J),O.snippetId=K;try{F(O)}catch(l){f(l)}}else f("Unable to load the snippet "+K)})),r.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),r.send()}))}}rF.EditorURL=`${LO.Tools._DefaultCdnUrl}/v${iK.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,rF.SnippetUrl="https://snippet.babylonjs.com",(0,Q.c)([(0,R.N)()],rF.prototype,"name",void 0),(0,Q.c)([(0,R.N)("comment")],rF.prototype,"comment",void 0),function(K){K[K.None=0]="None",K[K.PerParticle=1]="PerParticle",K[K.PerSystem=2]="PerSystem"}(IO||(IO={}));class lF extends bO{constructor(K){super(K),this._currentLockId=-2,this.lockMode=IO.PerParticle,this.registerInput("min",xO.AutoDetect,!0,0),this.registerInput("max",xO.AutoDetect,!0,1),this.registerOutput("output",xO.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xO.Float|xO.Int|xO.Vector2|xO.TO|xO.kJ),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(xO.Float|xO.Int|xO.Vector2|xO.TO|xO.kJ),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=xO.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let K=null;switch(this._currentLockId=-2,this.min.type){case xO.AutoDetect:case xO.Int:case xO.Float:K=K=>{const O=this.min.getConnectedValue(K)||0,F=this.max.getConnectedValue(K)||1;return O+Math.random()*(F-O)};break;case xO.Vector2:K=K=>{const O=this.min.getConnectedValue(K)||f.Vector2.Zero(),F=this.max.getConnectedValue(K)||f.Vector2.One();return new f.Vector2(O.x+Math.random()*(F.x-O.x),O.y+Math.random()*(F.y-O.y))};break;case xO.TO:K=K=>{const O=this.min.getConnectedValue(K)||f.TO.Zero(),F=this.max.getConnectedValue(K)||f.TO.One();return new f.TO(O.x+Math.random()*(F.x-O.x),O.y+Math.random()*(F.y-O.y),O.z+Math.random()*(F.z-O.z))};break;case xO.kJ:K=K=>{const O=this.min.getConnectedValue(K)||new q.kJ(0,0,0,0),F=this.max.getConnectedValue(K)||new q.kJ(1,1,1,1);return new q.kJ(O.x+Math.random()*(F.x-O.x),O.y+Math.random()*(F.y-O.y),O.z+Math.random()*(F.z-O.z),O.w+Math.random()*(F.w-O.w))}}this.output._storedFunction=O=>{var F;let f=0;switch(this.lockMode){case IO.PerParticle:f=(null===(F=O.particleContext)||void 0===F?void 0:F.id)||-1;break;case IO.PerSystem:f=O.buildId||0}return this._currentLockId!==f&&(this.lockMode!==IO.None&&(this._currentLockId=f),this.output._storedValue=K(O)),this.output._storedValue}}serialize(){const K=super.serialize();return K.lockMode=this.lockMode,K}_deserialize(K){super._deserialize(K),this.lockMode=K.lockMode}}(0,Q.c)([iO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:IO.None},{label:"Per particle",value:IO.PerParticle},{label:"Per system",value:IO.PerSystem}]})],lF.prototype,"lockMode",void 0),(0,J.g)("BABYLON.ParticleRandomBlock",lF);class qF extends bO{constructor(K){super(K),this._currentLockId=-2,this.lockMode=IO.PerParticle,this.registerInput("min",xO.AutoDetect),this.registerInput("max",xO.AutoDetect),this.registerOutput("output",xO.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const O=[xO.Matrix,xO.Particle,xO.Texture,xO.System,xO.FloatGradient,xO.Color4Gradient,xO.Vector2Gradient,xO.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...O),this.max.excludedConnectionPointTypes.push(...O)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let K=null;switch(this._currentLockId=-2,this.min.type){case xO.Float:case xO.Int:K=K=>{const O=this.min.getConnectedValue(K),F=this.max.getConnectedValue(K);return Math.random()*(F-O)+O};break;case xO.Vector2:K=K=>{const O=this.min.getConnectedValue(K),F=this.max.getConnectedValue(K);return new f.Vector2(Math.random()*(F.x-O.x)+O.x,Math.random()*(F.y-O.y)+O.y)};break;case xO.TO:K=K=>{const O=this.min.getConnectedValue(K),F=this.max.getConnectedValue(K);return new f.TO(Math.random()*(F.x-O.x)+O.x,Math.random()*(F.y-O.y)+O.y,Math.random()*(F.z-O.z)+O.z)};break;case xO.kJ:K=K=>{const O=this.min.getConnectedValue(K),F=this.max.getConnectedValue(K);return new q.kJ(Math.random()*(F.r-O.r)+O.r,Math.random()*(F.g-O.g)+O.g,Math.random()*(F.b-O.b)+O.b,Math.random()*(F.a-O.a)+O.a)}}this.output._storedFunction=O=>{var F;let f=0;switch(this.lockMode){case IO.PerParticle:f=(null===(F=O.particleContext)||void 0===F?void 0:F.id)||-1;break;case IO.PerSystem:f=O.buildId||0}return this._currentLockId!==f&&(this.lockMode!==IO.None&&(this._currentLockId=f),this.output._storedValue=K(O)),this.output._storedValue}}serialize(){const K=super.serialize();return K.lockMode=this.lockMode,K}_deserialize(K){super._deserialize(K),void 0!==K.lockMode&&(this.lockMode=K.lockMode)}}(0,Q.c)([iO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:IO.None},{label:"Per particle",value:IO.PerParticle},{label:"Per system",value:IO.PerSystem}]})],qF.prototype,"lockMode",void 0),(0,J.g)("BABYLON.RandomRangeBlock",qF);(0,J.g)("BABYLON.ParticleLerpBlock",class extends bO{constructor(K){super(K),this.registerInput("left",xO.AutoDetect),this.registerInput("right",xO.AutoDetect),this.registerInput("gradient",xO.Float,!0,0,0,1),this.registerOutput("output",xO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xO.Float|xO.Int|xO.Vector2|xO.TO|xO.kJ)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const K=(K,O,F)=>(1-K)*O+K*F;this.output._storedFunction=O=>{const F=this.left.getConnectedValue(O),r=this.right.getConnectedValue(O),l=this.gradient.getConnectedValue(O);switch(this.left.type){case xO.Int:case xO.Float:return K(l,F,r);case xO.Vector2:return new f.Vector2(K(l,F.x,r.x),K(l,F.y,r.y));case xO.TO:return new f.TO(K(l,F.x,r.x),K(l,F.y,r.y),K(l,F.z,r.z));case xO.kJ:return new q.kJ(K(l,F.r,r.r),K(l,F.g,r.g),K(l,F.b,r.b),K(l,F.a,r.a))}return 0}}});(0,J.g)("BABYLON.UpdateDirectionBlock",class extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerInput("direction",xO.TO),this.registerOutput("output",xO.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(K){const O=this.particle.getConnectedValue(K);if(this.output._storedValue=O,!this.direction.isConnected)return;const F={process:F=>{K.particleContext=F,K.systemContext=O,F.direction.l(this.direction.getConnectedValue(K))},previousItem:null,nextItem:null};O._updateQueueStart?nK(F,O._updateQueueStart):O._updateQueueStart=F}});(0,J.g)("BABYLON.UpdateColorBlock",class extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerInput("color",xO.kJ),this.registerOutput("output",xO.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(K){const O=this.particle.getConnectedValue(K);if(this.output._storedValue=O,!this.color.isConnected)return;const F={process:F=>{K.particleContext=F,K.systemContext=O,F.color.l(this.color.getConnectedValue(K))},previousItem:null,nextItem:null};O._updateQueueStart?nK(F,O._updateQueueStart):O._updateQueueStart=F}});(0,J.g)("BABYLON.UpdateScaleBlock",class extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerInput("scale",xO.Vector2),this.registerOutput("output",xO.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(K){const O=this.particle.getConnectedValue(K);if(this.output._storedValue=O,!this.scale.isConnected)return;const F={process:F=>{K.particleContext=F,K.systemContext=O,F.scale.l(this.scale.getConnectedValue(K))},previousItem:null,nextItem:null};O._updateQueueStart?nK(F,O._updateQueueStart):O._updateQueueStart=F}});(0,J.g)("BABYLON.UpdateAngleBlock",class extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerInput("angle",xO.Float),this.registerOutput("output",xO.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(K){const O=this.particle.getConnectedValue(K);if(this.output._storedValue=O,!this.angle.isConnected)return;const F={process:F=>{K.particleContext=F,K.systemContext=O,F.angle=this.angle.getConnectedValue(K)},previousItem:null,nextItem:null};O._updateQueueStart?nK(F,O._updateQueueStart):O._updateQueueStart=F}});(0,J.g)("BABYLON.BasicPositionUpdateBlock",class extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerOutput("output",xO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(K){const O=this.particle.getConnectedValue(K),F={process:F=>{K.particleContext=F,K.systemContext=O,F.direction.scaleToRef(O._directionScale,O._scaledDirection),F.position.addInPlace(O._scaledDirection)},previousItem:null,nextItem:null};O._updateQueueStart?nK(F,O._updateQueueStart):O._updateQueueStart=F,this.output._storedValue=O}});(0,J.g)("BABYLON.BasicSpriteUpdateBlock",class extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerOutput("output",xO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(K){const O=this.particle.getConnectedValue(K),F={process:F=>{K.particleContext=F,K.systemContext=O,F.updateCellIndex()},previousItem:null,nextItem:null};O._updateQueueStart?nK(F,O._updateQueueStart):O._updateQueueStart=F,this.output._storedValue=O}});(0,J.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerInput("cellIndex",xO.Int),this.registerOutput("output",xO.Particle),this.cellIndex.acceptedConnectionPointTypes=[xO.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(K){const O=this.particle.getConnectedValue(K);if(this.output._storedValue=O,!this.cellIndex.isConnected)return;const F={process:F=>{K.particleContext=F,K.systemContext=O,F.cellIndex=Math.floor(this.cellIndex.getConnectedValue(K))},previousItem:null,nextItem:null};O._updateQueueStart?nK(F,O._updateQueueStart):O._updateQueueStart=F}});class JF extends bO{constructor(K){super(K),this.strength=1,this.registerInput("particle",xO.Particle),this.registerInput("flowMap",xO.Texture),this.registerOutput("output",xO.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(K){var O;const F=this.particle.getConnectedValue(K),f=K.kO;let r;(null===(O=this.flowMap.connectedPoint)||void 0===O?void 0:O.ownerBlock).extractTextureContentAsync().then((K=>{K&&(r=new mO(K.width,K.height,K.data))}));const l={process:K=>{const O=f.getTransformMatrix();r&&r._processParticle(K,this.strength*F._tempScaledUpdateSpeed,O)},previousItem:null,nextItem:null};F._updateQueueStart?nK(l,F._updateQueueStart):F._updateQueueStart=l,this.output._storedValue=F}serialize(){const K=super.serialize();return K.strength=this.strength,K}_deserialize(K){super._deserialize(K),this.strength=K.strength}}(0,Q.c)([iO("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JF.prototype,"strength",void 0),(0,J.g)("BABYLON.UpdateFlowMapBlock",JF);(0,J.g)("BABYLON.SphereShapeBlock",class extends bO{constructor(K){super(K),this.registerInput("input",xO.Particle),this.registerInput("radius",xO.Float,!0,1),this.registerInput("radiusRange",xO.Float,!0,1,0,1),this.registerInput("directionRandomizer",xO.Float,!0,0,0,1),this.registerOutput("output",xO.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(K){const O=this.input.getConnectedValue(K);O._directionCreation.process=F=>{K.particleContext=F,K.systemContext=O;const r=this.directionRandomizer.getConnectedValue(K),l=F.position.oO(K.emitterPosition).normalize(),q=(0,E.RandomRange)(0,r),J=(0,E.RandomRange)(0,r),c=(0,E.RandomRange)(0,r);l.x+=q,l.y+=J,l.z+=c,l.normalize(),K.isEmitterTransformNode?f.TO.TransformNormalFromFloatsToRef(q,J,c,K.emitterWorldMatrix,F.direction):F.direction.eq(q,J,c)},O._positionCreation.process=F=>{K.particleContext=F,K.systemContext=O;const r=this.radius.getConnectedValue(K),l=this.radiusRange.getConnectedValue(K),q=r-(0,E.RandomRange)(0,r*l),J=(0,E.RandomRange)(0,1),c=(0,E.RandomRange)(0,2*Math.PI),M=Math.acos(2*J-1),t=q*Math.cos(c)*Math.sin(M),j=q*Math.cos(M),X=q*Math.sin(c)*Math.sin(M);K.isEmitterTransformNode?f.TO.TransformCoordinatesFromFloatsToRef(t,j,X,K.emitterWorldMatrix,F.position):(F.position.eq(t,j,X),F.position.addInPlace(K.emitterPosition))},this.output._storedValue=O}});(0,J.g)("BABYLON.PointShapeBlock",class extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerInput("direction1",xO.TO,!0,new f.TO(0,1,0)),this.registerInput("direction2",xO.TO,!0,new f.TO(0,1,0)),this.registerOutput("output",xO.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(K){const O=this.particle.getConnectedValue(K);O._directionCreation.process=F=>{K.particleContext=F,K.systemContext=O;const r=this.direction1.getConnectedValue(K),l=this.direction2.getConnectedValue(K),q=(0,E.RandomRange)(r.x,l.x),J=(0,E.RandomRange)(r.y,l.y),c=(0,E.RandomRange)(r.z,l.z);K.isEmitterTransformNode?f.TO.TransformNormalFromFloatsToRef(q,J,c,K.emitterWorldMatrix,F.direction):F.direction.eq(q,J,c)},O._positionCreation.process=F=>{K.systemContext=O,K.isEmitterTransformNode?f.TO.TransformCoordinatesFromFloatsToRef(0,0,0,K.emitterWorldMatrix,F.position):F.position.l(K.emitterPosition)},this.output._storedValue=O}});(0,J.g)("BABYLON.CustomShapeBlock",class extends bO{constructor(K){super(K),this.registerInput("particle",xO.Particle),this.registerInput("position",xO.TO,!0,new f.TO(0,0,0)),this.registerInput("direction",xO.TO,!0,new f.TO(0,1,0)),this.registerOutput("output",xO.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(K){const O=this.particle.getConnectedValue(K);O._directionCreation.process=F=>{K.particleContext=F,K.systemContext=O;const r=this.direction.getConnectedValue(K);K.isEmitterTransformNode?f.TO.TransformNormalToRef(r,K.emitterWorldMatrix,F.direction):F.direction.l(r)},O._positionCreation.process=F=>{K.particleContext=F,K.systemContext=O;const r=this.position.getConnectedValue(K);K.isEmitterTransformNode?f.TO.TransformCoordinatesToRef(r,K.emitterWorldMatrix,F.position):(F.position.l(r),F.position.addInPlace(K.emitterPosition))},this.output._storedValue=O}});(0,J.g)("BABYLON.CylinderShapeBlock",class extends bO{constructor(K){super(K),this._tempVector=f.TO.Zero(),this.registerInput("particle",xO.Particle),this.registerInput("radius",xO.Float,!0,1),this.registerInput("height",xO.Float,!0,1,0),this.registerInput("radiusRange",xO.Float,!0,1,0,1),this.registerInput("directionRandomizer",xO.Float,!0,0,0,1),this.registerOutput("output",xO.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(K){const O=this.particle.getConnectedValue(K);O._directionCreation.process=F=>{K.particleContext=F,K.systemContext=O;const r=this.directionRandomizer.getConnectedValue(K);F.position.subtractToRef(K.emitterPosition,this._tempVector),this._tempVector.normalize(),K.isEmitterTransformNode&&f.TO.TransformNormalToRef(this._tempVector,K.emitterInverseWorldMatrix,this._tempVector);const l=(0,E.RandomRange)(-r/2,r/2);let q=Math.atan2(this._tempVector.x,this._tempVector.z);q+=(0,E.RandomRange)(-Math.PI/2,Math.PI/2)*r,this._tempVector.y=l,this._tempVector.x=Math.sin(q),this._tempVector.z=Math.cos(q),this._tempVector.normalize(),K.isEmitterTransformNode?f.TO.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,K.emitterWorldMatrix,F.direction):F.direction.l(this._tempVector)},O._positionCreation.process=F=>{K.particleContext=F,K.systemContext=O;const r=this.height.getConnectedValue(K),l=this.radiusRange.getConnectedValue(K),q=this.radius.getConnectedValue(K),J=(0,E.RandomRange)(-r/2,r/2),c=(0,E.RandomRange)(0,2*Math.PI),M=(0,E.RandomRange)((1-l)*(1-l),1),t=Math.sqrt(M)*q,j=t*Math.cos(c),X=t*Math.sin(c);K.isEmitterTransformNode?f.TO.TransformCoordinatesFromFloatsToRef(j,J,X,K.emitterWorldMatrix,F.position):(F.position.eq(j,J,X),F.position.addInPlace(K.emitterPosition))},this.output._storedValue=O}});class cF extends bO{constructor(K){super(K),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",xO.Particle),this.registerOutput("output",xO.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){super._build(K);const O=this.particle.getConnectedValue(K);O._isAnimationSheetEnabled=!0,O.spriteCellWidth=this.width,O.spriteCellHeight=this.height,O.startSpriteCellID=this.start,O.endSpriteCellID=this.end,O.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=O}serialize(){const K=super.serialize();return K.width=this.width,K.height=this.height,K.start=this.start,K.end=this.end,K.randomStartCell=this.randomStartCell,K}_deserialize(K){super._deserialize(K),this.width=K.width,this.height=K.height,this.start=K.start,this.end=K.end,this.randomStartCell=K.randomStartCell}}(0,Q.c)([iO("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cF.prototype,"start",void 0),(0,Q.c)([iO("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cF.prototype,"end",void 0),(0,Q.c)([iO("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cF.prototype,"width",void 0),(0,Q.c)([iO("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],cF.prototype,"height",void 0),(0,Q.c)([iO("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],cF.prototype,"loop",void 0),(0,Q.c)([iO("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],cF.prototype,"randomStartCell",void 0),(0,J.g)("BABYLON.SetupSpriteSheetBlock",cF);class EF extends bO{constructor(K){super(K),this.reference=0,this.registerInput("value",xO.AutoDetect),this.registerOutput("output",xO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=K=>{switch(K){case xO.Float:return xO.FloatGradient;case xO.Vector2:return xO.Vector2Gradient;case xO.TO:return xO.Vector3Gradient;case xO.kJ:return xO.Color4Gradient}return K},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xO.Float|xO.Vector2|xO.TO|xO.kJ)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=K=>null}serialize(){const K=super.serialize();return K.reference=this.reference,K}_deserialize(K){super._deserialize(K),this.reference=K.reference}}(0,Q.c)([iO("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],EF.prototype,"reference",void 0),(0,J.g)("BABYLON.ParticleGradientValueBlock",EF);(0,J.g)("BABYLON.ParticleGradientBlock",class extends bO{constructor(K){super(K),this._entryCount=1,this.registerInput("gradient",xO.Float,!0,1,0,1),this.registerInput("value0",xO.AutoDetect),this.registerOutput("output",xO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=K=>{switch(K){case xO.FloatGradient:return xO.Float;case xO.Vector2Gradient:return xO.Vector2;case xO.Vector3Gradient:return xO.TO;case xO.Color4Gradient:return xO.kJ}return K},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(xO.FloatGradient|xO.Vector2Gradient|xO.Vector3Gradient|xO.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(K){this._inputs[K].onConnectionObservable.add((()=>{this._entryCount>K||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),xO.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const K=[];for(let F=1;F<this._inputs.length;F++){var O;if(this._inputs[F].isConnected)K.push(null===(O=this._inputs[F].connectedPoint)||void 0===O?void 0:O.ownerBlock)}K.sort(((K,O)=>K.reference-O.reference)),this.output._storedFunction=O=>{const F=this.gradient.getConnectedValue(O);if(1===K.length)return K[0].value.getConnectedValue(O);let r=null;for(let l=K.length-1;l>=0;l--){const J=K[l];if(J.reference<=F){const K=J.value.getConnectedValue(O);if(r){const l=r.value.getConnectedValue(O),c=r.reference,M=J.reference,t=Math.max(0,Math.min(1,(F-M)/(c-M)));switch(this.output.type){case xO.Float:return(0,E.Lerp)(K,l,t);case xO.Vector2:return f.Vector2.Lerp(K,l,t);case xO.TO:return f.TO.Lerp(K,l,t);case xO.kJ:return q.kJ.Lerp(K,l,t)}}return K}r=J}return 0}}});(0,J.g)("BABYLON.ParticleConverterBlock",class extends bO{constructor(K){super(K),this.registerInput("color ",xO.kJ,!0),this.registerInput("xyz ",xO.TO,!0),this.registerInput("xy ",xO.Vector2,!0),this.registerInput("zw ",xO.Vector2,!0),this.registerInput("x ",xO.Float,!0),this.registerInput("y ",xO.Float,!0),this.registerInput("z ",xO.Float,!0),this.registerInput("w ",xO.Float,!0),this.registerOutput("color",xO.kJ),this.registerOutput("xyz",xO.TO),this.registerOutput("xy",xO.Vector2),this.registerOutput("zw",xO.Vector2),this.registerOutput("x",xO.Float),this.registerOutput("y",xO.Float),this.registerOutput("z",xO.Float),this.registerOutput("w",xO.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(K){return"color "===K?"colorIn":"xyz "===K?"xyzIn":"xy "===K?"xyIn":"zw "===K?"zwIn":"x "===K?"xIn":"y "===K?"yIn":"z "===K?"zIn":"w "===K?"wIn":K}_outputRename(K){switch(K){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return K}}_build(K){super._build(K);const O=this.xIn,F=this.yIn,r=this.zIn,l=this.wIn,J=this.xyIn,c=this.zwIn,E=this.xyzIn,M=this.colorIn,t=this.colorOut,j=this.xyzOut,X=this.xyOut,u=this.zwOut,T=this.xOut,o=this.yOut,k=this.zOut,N=this.wOut,Z=K=>{if(M.isConnected)return M.getConnectedValue(K);let f=0,t=0,j=0,X=0;if(O.isConnected&&(f=O.getConnectedValue(K)),F.isConnected&&(t=F.getConnectedValue(K)),r.isConnected&&(j=r.getConnectedValue(K)),l.isConnected&&(X=l.getConnectedValue(K)),J.isConnected){const O=J.getConnectedValue(K);O&&(f=O.x,t=O.y)}if(c.isConnected){const O=c.getConnectedValue(K);O&&(j=O.x,X=O.y)}if(E.isConnected){const O=E.getConnectedValue(K);O&&(f=O.x,t=O.y,j=O.z)}return new q.kJ(f,t,j,X)};t._storedFunction=K=>Z(K),j._storedFunction=K=>{const O=Z(K);return new f.TO(O.r,O.g,O.b)},X._storedFunction=K=>{const O=Z(K);return new f.Vector2(O.r,O.g)},u._storedFunction=K=>{const O=Z(K);return new f.Vector2(O.b,O.a)},T._storedFunction=K=>Z(K).r,o._storedFunction=K=>Z(K).g,k._storedFunction=K=>Z(K).b,N._storedFunction=K=>Z(K).a}}),function(K){K[K.Cos=0]="Cos",K[K.Sin=1]="Sin",K[K.Abs=2]="Abs",K[K.Exp=3]="Exp",K[K.Exp2=4]="Exp2",K[K.Round=5]="Round",K[K.Floor=6]="Floor",K[K.Ceiling=7]="Ceiling",K[K.Sqrt=8]="Sqrt",K[K.Log=9]="Log",K[K.Tan=10]="Tan",K[K.ArcTan=11]="ArcTan",K[K.ArcCos=12]="ArcCos",K[K.ArcSin=13]="ArcSin",K[K.Sign=14]="Sign",K[K.Negate=15]="Negate",K[K.OneMinus=16]="OneMinus",K[K.Reciprocal=17]="Reciprocal",K[K.ToDegrees=18]="ToDegrees",K[K.ToRadians=19]="ToRadians",K[K.Fract=20]="Fract"}(DO||(DO={}));class MF extends bO{constructor(K){super(K),this.operation=DO.Cos,this.registerInput("input",xO.AutoDetect),this.registerOutput("output",xO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xO.Float|xO.Int|xO.Vector2|xO.TO|xO.kJ)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){super._build(K);let O=null;switch(this.operation){case DO.Cos:O=K=>Math.cos(K);break;case DO.Sin:O=K=>Math.sin(K);break;case DO.Abs:O=K=>Math.abs(K);break;case DO.Exp:O=K=>Math.exp(K);break;case DO.Exp2:O=K=>Math.pow(2,K);break;case DO.Round:O=K=>Math.round(K);break;case DO.Floor:O=K=>Math.floor(K);break;case DO.Ceiling:O=K=>Math.ceil(K);break;case DO.Sqrt:O=K=>Math.sqrt(K);break;case DO.Log:O=K=>Math.log(K);break;case DO.Tan:O=K=>Math.tan(K);break;case DO.ArcTan:O=K=>Math.atan(K);break;case DO.ArcCos:O=K=>Math.acos(K);break;case DO.ArcSin:O=K=>Math.asin(K);break;case DO.Sign:O=K=>Math.sign(K);break;case DO.Negate:O=K=>-K;break;case DO.OneMinus:O=K=>1-K;break;case DO.Reciprocal:O=K=>1/K;break;case DO.ToRadians:O=K=>K*Math.PI/180;break;case DO.ToDegrees:O=K=>180*K/Math.PI;break;case DO.Fract:O=K=>K>=0?K-Math.floor(K):K-Math.ceil(K)}if(!O)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case xO.Int:case xO.Float:this.output._storedFunction=K=>{const F=this.input.getConnectedValue(K);return O(F)};break;case xO.Vector2:this.output._storedFunction=K=>{const F=this.input.getConnectedValue(K);return new f.Vector2(O(F.x),O(F.y))};break;case xO.TO:this.output._storedFunction=K=>{const F=this.input.getConnectedValue(K);return new f.TO(O(F.x),O(F.y),O(F.z))};break;case xO.kJ:this.output._storedFunction=K=>{const F=this.input.getConnectedValue(K);return new q.kJ(O(F.r),O(F.g),O(F.b),O(F.a))}}return this}serialize(){const K=super.serialize();return K.operation=this.operation,K}_deserialize(K){super._deserialize(K),this.operation=K.operation}}(0,Q.c)([iO("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:DO.Cos},{label:"Sin",value:DO.Sin},{label:"Abs",value:DO.Abs},{label:"Exp",value:DO.Exp},{label:"Exp2",value:DO.Exp2},{label:"Round",value:DO.Round},{label:"Floor",value:DO.Floor},{label:"Ceiling",value:DO.Ceiling},{label:"Sqrt",value:DO.Sqrt},{label:"Log",value:DO.Log},{label:"Tan",value:DO.Tan},{label:"ArcTan",value:DO.ArcTan},{label:"ArcCos",value:DO.ArcCos},{label:"ArcSin",value:DO.ArcSin},{label:"Sign",value:DO.Sign},{label:"Negate",value:DO.Negate},{label:"OneMinus",value:DO.OneMinus},{label:"Reciprocal",value:DO.Reciprocal},{label:"ToDegrees",value:DO.ToDegrees},{label:"ToRadians",value:DO.ToRadians},{label:"Fract",value:DO.Fract}]})],MF.prototype,"operation",void 0),(0,J.g)("BABYLON.ParticleTrigonometryBlock",MF);var tF,jF=F(13140);class XF extends bO{constructor(K){super(K),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",xO.AutoDetect),this.registerOutput("output",xO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(xO.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(xO.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(xO.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(xO.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(xO.System),this._inputs[0].excludedConnectionPointTypes.push(xO.Particle),this._inputs[0].excludedConnectionPointTypes.push(xO.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const O=K=>{const O=this.input.getConnectedValue(K);if(this.log.length>=this.stackSize)return O;if(null===O||void 0===O)return this.log.push(["null",""]),O;switch(this.input.type){case xO.Vector2:this.log.push([(0,jF.f)(O,4),O.toString()]);break;case xO.TO:this.log.push([(0,jF.g)(O,4),O.toString()]);break;case xO.kJ:this.log.push([`{R: ${O.r.toFixed(4)} G: ${O.g.toFixed(4)} B: ${O.b.toFixed(4)} A: ${O.a.toFixed(4)}}`,O.toString()]);break;default:this.log.push([O.toString(),O.toString()])}return O};this.output.isConnected?this.output._storedFunction=O:this.output._storedValue=O(K)}serialize(){const K=super.serialize();return K.stackSize=this.stackSize,K}_deserialize(K){super._deserialize(K),this.stackSize=K.stackSize}}(0,Q.c)([iO("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],XF.prototype,"stackSize",void 0),(0,J.g)("BABYLON.ParticleDebugBlock",XF);(0,J.g)("BABYLON.ParticleElbowBlock",class extends bO{constructor(K){super(K),this.registerInput("input",xO.AutoDetect),this.registerOutput("output",xO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){super._build(K);const O=this._outputs[0],F=this._inputs[0];O._storedFunction=K=>F.getConnectedValue(K)}});(0,J.g)("BABYLON.ParticleTeleportInBlock",class extends bO{get endpoints(){return this._endpoints}constructor(K){super(K),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",xO.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(K){if(this.getClassName()===K)return!0;for(const O of this.endpoints)if(O.isAnAncestorOfType(K))return!0;return!1}isAnAncestorOf(K){for(const O of this.endpoints){if(O===K)return!0;if(O.isAnAncestorOf(K))return!0}return!1}attachToEndpoint(K){K.detach(),this._endpoints.push(K),K._entryPoint=this,K._outputs[0]._typeConnectionSource=this._inputs[0],K._tempEntryPointUniqueId=null,K.name="> "+this.name}detachFromEndpoint(K){const O=this._endpoints.indexOf(K);-1!==O&&(this._endpoints.splice(O,1),K._outputs[0]._typeConnectionSource=null,K._entryPoint=null)}_build(){for(const K of this._endpoints)K.output._storedFunction=K=>this.input.getConnectedValue(K)}});(0,J.g)("BABYLON.ParticleTeleportOutBlock",class extends bO{constructor(K){super(K),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",xO.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(K){this.entryPoint&&this.entryPoint.build(K)}clone(){const K=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(K),K}serialize(){var K;const O=super.serialize();return O.entryPoint=(null===(K=this.entryPoint)||void 0===K?void 0:K.uniqueId)??"",O}_deserialize(K){super._deserialize(K),this._tempEntryPointUniqueId=K.entryPoint}}),function(K){K[K.Equal=0]="Equal",K[K.NotEqual=1]="NotEqual",K[K.LessThan=2]="LessThan",K[K.GreaterThan=3]="GreaterThan",K[K.LessOrEqual=4]="LessOrEqual",K[K.GreaterOrEqual=5]="GreaterOrEqual",K[K.Xor=6]="Xor",K[K.Or=7]="Or",K[K.And=8]="And"}(tF||(tF={}));class uF extends bO{constructor(K){super(K),this.test=tF.Equal,this.epsilon=0,this.registerInput("left",xO.Float),this.registerInput("right",xO.Float,!0,0),this.registerInput("ifTrue",xO.AutoDetect,!0,1),this.registerInput("ifFalse",xO.AutoDetect,!0,0),this.registerOutput("output",xO.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=xO.Float,this._inputs[0].acceptedConnectionPointTypes.push(xO.Int),this._inputs[1].acceptedConnectionPointTypes.push(xO.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const K=K=>{const O=this.left.getConnectedValue(K),F=this.right.getConnectedValue(K);let f=!1;switch(this.test){case tF.Equal:f=(0,E.WithinEpsilon)(O,F,this.epsilon);break;case tF.NotEqual:f=!(0,E.WithinEpsilon)(O,F,this.epsilon);break;case tF.LessThan:f=O<F+this.epsilon;break;case tF.GreaterThan:f=O>F-this.epsilon;break;case tF.LessOrEqual:f=O<=F+this.epsilon;break;case tF.GreaterOrEqual:f=O>=F-this.epsilon;break;case tF.Xor:f=!!O&&!F||!O&&!!F;break;case tF.Or:f=!!O||!!F;break;case tF.And:f=!!O&&!!F}return f};this.output._storedFunction=O=>K(O)?this.ifTrue.getConnectedValue(O):this.ifFalse.getConnectedValue(O)}serialize(){const K=super.serialize();return K.test=this.test,K.epsilon=this.epsilon,K}_deserialize(K){super._deserialize(K),this.test=K.test,void 0!==K.epsilon&&(this.epsilon=K.epsilon)}}(0,Q.c)([iO("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:tF.Equal},{label:"NotEqual",value:tF.NotEqual},{label:"LessThan",value:tF.LessThan},{label:"GreaterThan",value:tF.GreaterThan},{label:"LessOrEqual",value:tF.LessOrEqual},{label:"GreaterOrEqual",value:tF.GreaterOrEqual},{label:"Xor",value:tF.Xor},{label:"Or",value:tF.Or},{label:"And",value:tF.And}]})],uF.prototype,"test",void 0),(0,Q.c)([iO("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],uF.prototype,"epsilon",void 0),(0,J.g)("BABYLON.ParticleConditionBlock",uF);class TF extends bO{constructor(K){super(K),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",xO.Particle),this.registerInput("condition",xO.Float,!0,0),this.registerInput("system",xO.System),this.registerOutput("output",xO.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(K){this._triggerCount=0;const O=this.input.getConnectedValue(K),F={process:F=>{if(K.particleContext=F,K.systemContext=O,0!==this.condition.getConnectedValue(K)&&(0===this.limit||this._triggerCount<this.limit)){const f=(new Date).getTime();if(this._previousOne&&f-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=f;const r=this.system.getConnectedValue(K);if(r){const f=sO(r,K.kO,F.position);f.Wf.addOnce((()=>{this._triggerCount--})),O.Wf.addOnce((()=>{f.dispose()}))}}},previousItem:null,nextItem:null};O._updateQueueStart?nK(F,O._updateQueueStart):O._updateQueueStart=F,this.output._storedValue=O}serialize(){const K=super.serialize();return K.limit=this.limit,K.delay=this.delay,K}_deserialize(K){super._deserialize(K),void 0!==K.limit&&(this.limit=K.limit),void 0!==K.delay&&(this.delay=K.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,Q.c)([iO("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],TF.prototype,"limit",void 0),(0,Q.c)([iO("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],TF.prototype,"delay",void 0),(0,J.g)("BABYLON.ParticleTriggerBlock",TF);F(13143),F(13158),F(13162),F(13205)},13185:(K,O,F)=>{"use strict";var f=F(11610);const r="clipPlaneFragment",l="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13168:(K,O,F)=>{"use strict";var f=F(11610);const r="clipPlaneFragmentDeclaration",l="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13222:(K,O,F)=>{"use strict";var f=F(11610);const r="clipPlaneVertex",l="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13208:(K,O,F)=>{"use strict";var f=F(11610);const r="clipPlaneVertexDeclaration",l="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13197:(K,O,F)=>{"use strict";var f=F(11610);const r="fogFragment",l="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13183:(K,O,F)=>{"use strict";var f=F(11610);const r="fogFragmentDeclaration",l="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13224:(K,O,F)=>{"use strict";var f=F(11610);const r="fogVertex",l="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13215:(K,O,F)=>{"use strict";var f=F(11610);const r="fogVertexDeclaration",l="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13178:(K,O,F)=>{"use strict";var f=F(11610);const r="helperFunctions",l="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13173:(K,O,F)=>{"use strict";var f=F(11610);const r="imageProcessingDeclaration",l="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13181:(K,O,F)=>{"use strict";var f=F(11610);const r="imageProcessingFunctions",l="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13175:(K,O,F)=>{"use strict";var f=F(11610);const r="logDepthDeclaration",l="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13192:(K,O,F)=>{"use strict";var f=F(11610);const r="logDepthFragment",l="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13233:(K,O,F)=>{"use strict";var f=F(11610);const r="logDepthVertex",l="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";f.c.IncludesShadersStoreWGSL[r]||(f.c.IncludesShadersStoreWGSL[r]=l)},13162:(K,O,F)=>{"use strict";F.r(O),F.d(O,{particlesPixelShaderWGSL:()=>q});var f=F(11610);F(13168),F(13173),F(13175),F(13178),F(13181),F(13183),F(13185),F(13192),F(13197);const r="particlesPixelShader",l="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";f.c.ShadersStoreWGSL[r]||(f.c.ShadersStoreWGSL[r]=l);const q={name:r,shader:l}},13205:(K,O,F)=>{"use strict";F.r(O),F.d(O,{particlesVertexShaderWGSL:()=>q});var f=F(11610);F(13208),F(13215),F(13175),F(13222),F(13224),F(13233);const r="particlesVertexShader",l="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";f.c.ShadersStoreWGSL[r]||(f.c.ShadersStoreWGSL[r]=l);const q={name:r,shader:l}},13053:(K,O,F)=>{"use strict";var f=F(11610);const r="clipPlaneFragment",l="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13151:(K,O,F)=>{"use strict";var f=F(11610);const r="clipPlaneFragmentDeclaration",l="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13086:(K,O,F)=>{"use strict";var f=F(11610);const r="clipPlaneVertex",l="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13160:(K,O,F)=>{"use strict";var f=F(11610);const r="clipPlaneVertexDeclaration",l="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13070:(K,O,F)=>{"use strict";var f=F(11610);const r="fogFragment",l="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13048:(K,O,F)=>{"use strict";var f=F(11610);const r="fogFragmentDeclaration",l="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13095:(K,O,F)=>{"use strict";var f=F(11610);const r="fogVertex",l="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13077:(K,O,F)=>{"use strict";var f=F(11610);const r="fogVertexDeclaration",l="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13041:(K,O,F)=>{"use strict";var f=F(11610);const r="helperFunctions",l="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13035:(K,O,F)=>{"use strict";var f=F(11610);const r="imageProcessingDeclaration",l="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13044:(K,O,F)=>{"use strict";var f=F(11610);const r="imageProcessingFunctions",l="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13037:(K,O,F)=>{"use strict";var f=F(11610);const r="logDepthDeclaration",l="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13061:(K,O,F)=>{"use strict";var f=F(11610);const r="logDepthFragment",l="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13102:(K,O,F)=>{"use strict";var f=F(11610);const r="logDepthVertex",l="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";f.c.IncludesShadersStore[r]||(f.c.IncludesShadersStore[r]=l)},13143:(K,O,F)=>{"use strict";F.r(O),F.d(O,{particlesPixelShader:()=>q});var f=F(11610);F(13151),F(13035),F(13037),F(13041),F(13044),F(13048),F(13053),F(13061),F(13070);const r="particlesPixelShader",l="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";f.c.ShadersStore[r]||(f.c.ShadersStore[r]=l);const q={name:r,shader:l}},13158:(K,O,F)=>{"use strict";F.r(O),F.d(O,{particlesVertexShader:()=>q});var f=F(11610);F(13160),F(13077),F(13037),F(13086),F(13095),F(13102);const r="particlesVertexShader",l="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";f.c.ShadersStore[r]||(f.c.ShadersStore[r]=l);const q={name:r,shader:l}},13496:(K,O,F)=>{"use strict";F.r(O),F.d(O,{FlowGraphGLTFDataProvider:()=>l});var f=F(13471),r=F(13441);class l extends f.e{constructor(K){var O,F;super();const f=K.glTF,l=(null===(O=f.animations)||void 0===O?void 0:O.map((K=>K._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",r.d,l);const q=(null===(F=f.nodes)||void 0===F?void 0:F.map((K=>K._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",r.d,q)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13385:(K,O,F)=>{"use strict";F.d(O,{e:()=>o,i:()=>u,j:()=>X,m:()=>T});var f=F(11713),r=F(12228),l=F(11764),q=F(13391);const J=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class c{constructor(K,O){this._gltf=K,this._infoTree=O}convert(K){let O,F=this._gltf,f=this._infoTree;if(!K.startsWith("/"))throw new Error("Path must start with a /");const r=K.split("/");if(r.shift(),r[r.length-1].includes(".length")){const K=r[r.length-1].split(".");r.pop(),r.push(...K)}let l=!1;for(const c of r){const r="length"===c;if(r&&!f.__array__)throw new Error(`Path ${K} is invalid`);if(f.__ignoreObjectTree__&&(l=!0),f.__array__&&!r)f=f.__array__;else if(f=f[c],!f)throw new Error(`Path ${K} is invalid`);if(!l)if(void 0===F){if(!J.find((O=>O.regex.test(K))))throw new Error(`Path ${K} is invalid`)}else if(!r){var q;F=null===(q=F)||void 0===q?void 0:q[c]}(f.__target__||r)&&(O=F)}return{object:O,info:f}}}function E(K,O,F,f){const r=M(K,O);return f?r[F][f]:r[F]}function M(K,O,F){var f,l;return null===(f=K._data)||void 0===f||null===(l=f[(null===F||void 0===F?void 0:F.fillMode)??r.c.MATERIAL_TriangleFillMode])||void 0===l?void 0:l.babylonMaterial}function t(K,O){return{offset:{componentsCount:2,type:"Vector2",get:(F,r,l)=>{const q=E(F,l,K,O);return new f.Vector2(null===q||void 0===q?void 0:q.uOffset,null===q||void 0===q?void 0:q.vOffset)},getTarget:M,set:(F,f,r,l)=>{const q=E(f,l,K,O);q.uOffset=F.x,q.vOffset=F.y},getPropertyName:[()=>`${K}${O?"."+O:""}.uOffset`,()=>`${K}${O?"."+O:""}.vOffset`]},rotation:{type:"number",get:(F,f,r)=>{var l;return null===(l=E(F,r,K,O))||void 0===l?void 0:l.wAng},getTarget:M,set:(F,f,r,l)=>E(f,l,K,O).wAng=F,getPropertyName:[()=>`${K}${O?"."+O:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(F,r,l)=>{const q=E(F,l,K,O);return new f.Vector2(null===q||void 0===q?void 0:q.uScale,null===q||void 0===q?void 0:q.vScale)},getTarget:M,set:(F,f,r,l)=>{const q=E(f,l,K,O);q.uScale=F.x,q.vScale=F.y},getPropertyName:[()=>`${K}${O?"."+O:""}.uScale`,()=>`${K}${O?"."+O:""}.vScale`]}}}const j={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:K=>{var O,F;return new f.Vector2((null===(O=K._babylonCamera)||void 0===O?void 0:O.orthoLeft)??0,(null===(F=K._babylonCamera)||void 0===F?void 0:F.orthoRight)??0)},set:(K,O)=>{O._babylonCamera&&(O._babylonCamera.orthoLeft=K.x,O._babylonCamera.orthoRight=K.y)},getTarget:K=>K,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:K=>{var O,F;return new f.Vector2((null===(O=K._babylonCamera)||void 0===O?void 0:O.orthoBottom)??0,(null===(F=K._babylonCamera)||void 0===F?void 0:F.orthoTop)??0)},set:(K,O)=>{O._babylonCamera&&(O._babylonCamera.orthoBottom=K.x,O._babylonCamera.orthoTop=K.y)},getTarget:K=>K,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:K=>{var O;return null===(O=K._babylonCamera)||void 0===O?void 0:O.maxZ},set:(K,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=K)},getTarget:K=>K,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:K=>{var O;return null===(O=K._babylonCamera)||void 0===O?void 0:O.if},set:(K,O)=>{O._babylonCamera&&(O._babylonCamera.if=K)},getTarget:K=>K,getPropertyName:[()=>"if"]}},perspective:{aspectRatio:{type:"number",get:K=>{var O;return null===(O=K._babylonCamera)||void 0===O?void 0:O.getEngine().getAspectRatio(K._babylonCamera)},getTarget:K=>K,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:K=>{var O;return null===(O=K._babylonCamera)||void 0===O?void 0:O.fov},set:(K,O)=>{O._babylonCamera&&(O._babylonCamera.fov=K)},getTarget:K=>K,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:K=>{var O;return null===(O=K._babylonCamera)||void 0===O?void 0:O.maxZ},set:(K,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=K)},getTarget:K=>K,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:K=>{var O;return null===(O=K._babylonCamera)||void 0===O?void 0:O.if},set:(K,O)=>{O._babylonCamera&&(O._babylonCamera.if=K)},getTarget:K=>K,getPropertyName:[()=>"if"]}}}},nodes:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"TO",get:K=>{var O;return null===(O=K._babylonTransformNode)||void 0===O?void 0:O.position},set:(K,O)=>{var F;return null===(F=O._babylonTransformNode)||void 0===F?void 0:F.position.l(K)},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:K=>{var O;return null===(O=K._babylonTransformNode)||void 0===O?void 0:O.rotationQuaternion},set:(K,O)=>{var F,f;return null===(F=O._babylonTransformNode)||void 0===F||null===(f=F.rotationQuaternion)||void 0===f?void 0:f.l(K)},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"TO",get:K=>{var O;return null===(O=K._babylonTransformNode)||void 0===O?void 0:O.TJ},set:(K,O)=>{var F;return null===(F=O._babylonTransformNode)||void 0===F?void 0:F.TJ.l(K)},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"TJ"]},weights:{length:{type:"number",get:K=>K._numMorphTargets,getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(K,O)=>{var F,f;return void 0!==O?null===(F=K._primitiveBabylonMeshes)||void 0===F||null===(f=F[0].morphTargetManager)||void 0===f?void 0:f.getTarget(O).influence:void 0},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(K,O)=>[0],getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:K=>{var O,F,r;return f.Matrix.Compose(null===(O=K._babylonTransformNode)||void 0===O?void 0:O.TJ,null===(F=K._babylonTransformNode)||void 0===F?void 0:F.rotationQuaternion,null===(r=K._babylonTransformNode)||void 0===r?void 0:r.position)},getTarget:K=>K._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:K=>{var O,F,r,l;const q=f.Matrix.Identity();let J=K.parent;for(;J&&J.parent;)J=J.parent;const c=(null===(O=K._babylonTransformNode)||void 0===O?void 0:O.position._isDirty)||(null===(F=K._babylonTransformNode)||void 0===F||null===(r=F.rotationQuaternion)||void 0===r?void 0:r._isDirty)||(null===(l=K._babylonTransformNode)||void 0===l?void 0:l.TJ._isDirty);if(J){var E;const O=null===(E=J._babylonTransformNode)||void 0===E?void 0:E.Pf(!0).invert();var M,t;if(O)null===(M=K._babylonTransformNode)||void 0===M||null===(t=M.Pf(c))||void 0===t||t.multiplyToRef(O,q)}else K._babylonTransformNode&&q.l(K._babylonTransformNode.Pf(c));return q},getTarget:K=>K._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:K=>{var O,F;return null===(O=K._babylonTransformNode)||void 0===O||null===(F=O.getChildren((K=>K instanceof q.c),!0)[0])||void 0===F?void 0:F.LJ},getTarget:K=>{var O;return null===(O=K._babylonTransformNode)||void 0===O?void 0:O.getChildren((K=>K instanceof q.c),!0)[0]},set:(K,O)=>{if(O._babylonTransformNode){const F=O._babylonTransformNode.getChildren((K=>K instanceof q.c),!0)[0];F&&(F.LJ=K)}}},color:{type:"ZO",get:K=>{var O,F;return null===(O=K._babylonTransformNode)||void 0===O||null===(F=O.getChildren((K=>K instanceof q.c),!0)[0])||void 0===F?void 0:F.dJ},getTarget:K=>{var O;return null===(O=K._babylonTransformNode)||void 0===O?void 0:O.getChildren((K=>K instanceof q.c),!0)[0]},set:(K,O)=>{if(O._babylonTransformNode){const F=O._babylonTransformNode.getChildren((K=>K instanceof q.c),!0)[0];F&&(F.dJ=K)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"ZO",get:(K,O,F)=>M(K,O,F).emissiveColor,set:(K,O,F,f)=>M(O,F,f).emissiveColor.l(K),getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:t("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(K,O,F)=>{var f;return null===(f=E(K,F,"bumpTexture"))||void 0===f?void 0:f.level},set:(K,O,F,f)=>{const r=E(O,f,"bumpTexture");r&&(r.level=K)},getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:t("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(K,O,F)=>M(K,O,F).ambientTextureStrength,set:(K,O,F,f)=>{const r=M(O,F,f);r&&(r.ambientTextureStrength=K)},getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:t("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"kJ",get:(K,O,F)=>{const f=M(K,O,F);return l.kJ.FromColor3(f.albedoColor,f.alpha)},set:(K,O,F,f)=>{const r=M(O,F,f);r.albedoColor.set(K.r,K.g,K.b),r.alpha=K.a},getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:t("albedoTexture")}},metallicFactor:{type:"number",get:(K,O,F)=>M(K,O,F).metallic,set:(K,O,F,f)=>{const r=M(O,F,f);r&&(r.metallic=K)},getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(K,O,F)=>M(K,O,F).roughness,set:(K,O,F,f)=>{const r=M(O,F,f);r&&(r.roughness=K)},getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:t("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(K,O,F)=>M(K,O,F).anisotropy.LJ,set:(K,O,F,f)=>{M(O,F,f).anisotropy.LJ=K},getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(K,O,F)=>M(K,O,F).anisotropy.angle,set:(K,O,F,f)=>{M(O,F,f).anisotropy.angle=K},getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:t("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(K,O,F)=>M(K,O,F).clearCoat.LJ,set:(K,O,F,f)=>{M(O,F,f).clearCoat.LJ=K},getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(K,O,F)=>M(K,O,F).clearCoat.roughness,set:(K,O,F,f)=>{M(O,F,f).clearCoat.roughness=K},getTarget:(K,O,F)=>M(K,O,F),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:t("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(K,O,F)=>{var f;return null===(f=M(K,O,F).clearCoat.bumpTexture)||void 0===f?void 0:f.level},getTarget:M,set:(K,O,F,f)=>M(O,F,f).clearCoat.bumpTexture.level=K},extensions:{KHR_texture_transform:t("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:t("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(K,O,F)=>M(K,O,F).subSurface.dispersion,getTarget:M,set:(K,O,F,f)=>M(O,F,f).subSurface.dispersion=K}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(K,O,F)=>M(K,O,F).emissiveIntensity,getTarget:M,set:(K,O,F,f)=>M(O,F,f).emissiveIntensity=K}},KHR_materials_ior:{ior:{type:"number",get:(K,O,F)=>M(K,O,F).indexOfRefraction,getTarget:M,set:(K,O,F,f)=>M(O,F,f).indexOfRefraction=K}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(K,O,F)=>M(K,O,F).iridescence.LJ,getTarget:M,set:(K,O,F,f)=>M(O,F,f).iridescence.LJ=K},iridescenceIor:{type:"number",get:(K,O,F)=>M(K,O,F).iridescence.indexOfRefraction,getTarget:M,set:(K,O,F,f)=>M(O,F,f).iridescence.indexOfRefraction=K},iridescenceTexture:{extensions:{KHR_texture_transform:t("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(K,O,F)=>M(K,O,F).iridescence.maximumThickness,getTarget:M,set:(K,O,F,f)=>M(O,F,f).iridescence.maximumThickness=K},iridescenceThicknessMinimum:{type:"number",get:(K,O,F)=>M(K,O,F).iridescence.minimumThickness,getTarget:M,set:(K,O,F,f)=>M(O,F,f).iridescence.minimumThickness=K},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:t("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"ZO",get:(K,O,F)=>M(K,O,F).sheen.color,getTarget:M,set:(K,O,F,f)=>M(O,F,f).sheen.color.l(K)},sheenColorTexture:{extensions:{KHR_texture_transform:t("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(K,O,F)=>M(K,O,F).sheen.LJ,getTarget:M,set:(K,O,F,f)=>M(O,F,f).sheen.LJ=K},sheenRoughnessTexture:{extensions:{KHR_texture_transform:t("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(K,O,F)=>M(K,O,F).metallicF0Factor,getTarget:M,set:(K,O,F,f)=>M(O,F,f).metallicF0Factor=K,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"ZO",get:(K,O,F)=>M(K,O,F).metallicReflectanceColor,getTarget:M,set:(K,O,F,f)=>M(O,F,f).metallicReflectanceColor.l(K),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:t("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:t("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(K,O,F)=>M(K,O,F).subSurface.refractionIntensity,getTarget:M,set:(K,O,F,f)=>M(O,F,f).subSurface.refractionIntensity=K,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:t("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(K,O,F)=>M(K,O,F).subSurface.translucencyIntensity,getTarget:M,set:(K,O,F,f)=>M(O,F,f).subSurface.translucencyIntensity=K},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:t("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"ZO",get:(K,O,F)=>M(K,O,F).subSurface.translucencyColor,getTarget:M,set:(K,O,F,f)=>{var r;return K&&(null===(r=M(O,F,f).subSurface.translucencyColor)||void 0===r?void 0:r.l(K))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:t("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"ZO",get:(K,O,F)=>M(K,O,F).subSurface.tintColor,getTarget:M,set:(K,O,F,f)=>M(O,F,f).subSurface.tintColor.l(K)},attenuationDistance:{type:"number",get:(K,O,F)=>M(K,O,F).subSurface.tintColorAtDistance,getTarget:M,set:(K,O,F,f)=>M(O,F,f).subSurface.tintColorAtDistance=K},thicknessFactor:{type:"number",get:(K,O,F)=>M(K,O,F).subSurface.maximumThickness,getTarget:M,set:(K,O,F,f)=>M(O,F,f).subSurface.maximumThickness=K},thicknessTexture:{extensions:{KHR_texture_transform:t("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonLight)),getPropertyName:[K=>"length"]},__array__:{__target__:!0,color:{type:"ZO",get:K=>{var O;return null===(O=K._babylonLight)||void 0===O?void 0:O.dJ},set:(K,O)=>{var F;return null===(F=O._babylonLight)||void 0===F?void 0:F.dJ.l(K)},getTarget:K=>K._babylonLight,getPropertyName:[K=>"diffuse"]},LJ:{type:"number",get:K=>{var O;return null===(O=K._babylonLight)||void 0===O?void 0:O.LJ},set:(K,O)=>O._babylonLight?O._babylonLight.LJ=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"intensity"]},range:{type:"number",get:K=>{var O;return null===(O=K._babylonLight)||void 0===O?void 0:O.range},set:(K,O)=>O._babylonLight?O._babylonLight.range=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"range"]},spot:{innerConeAngle:{type:"number",get:K=>{var O;return null===(O=K._babylonLight)||void 0===O?void 0:O.innerAngle},set:(K,O)=>O._babylonLight?O._babylonLight.innerAngle=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"innerConeAngle"]},outerConeAngle:{type:"number",get:K=>{var O;return null===(O=K._babylonLight)||void 0===O?void 0:O.angle},set:(K,O)=>O._babylonLight?O._babylonLight.angle=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonLight)),getPropertyName:[K=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonTexture)),getPropertyName:[K=>"length"]},__array__:{__target__:!0,LJ:{type:"number",get:K=>{var O;return null===(O=K._babylonTexture)||void 0===O?void 0:O.level},set:(K,O)=>{O._babylonTexture&&(O._babylonTexture.level=K)},getTarget:K=>K._babylonTexture},rotation:{type:"Quaternion",get:K=>{var O;return K._babylonTexture&&f.Quaternion.FromRotationMatrix(null===(O=K._babylonTexture)||void 0===O?void 0:O.getReflectionTextureMatrix())},set:(K,O)=>{var F;O._babylonTexture&&(null!==(F=O._babylonTexture.HK())&&void 0!==F&&F.useRightHandedSystem||(K=f.Quaternion.Inverse(K)),f.Matrix.FromQuaternionToRef(K,O._babylonTexture.getReflectionTextureMatrix()))},getTarget:K=>K._babylonTexture}}}}},animations:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>{var O;return null===(O=K.primitives[0]._instanceData)||void 0===O?void 0:O.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function X(K){return new c(K,j)}function u(K){const O=K.split("/").map((K=>K.replace(/{}/g,"__array__")));let F=j;for(const f of O)f&&(F=F[f]);if(F&&F.type&&F.get)return F}function T(K,O){const F=K.split("/").map((K=>K.replace(/{}/g,"__array__")));let f=j;for(const r of F)r&&(f=f[r]);f&&f.type&&f.get&&(f.interpolation=O)}function o(K,O){const F=K.split("/").map((K=>K.replace(/{}/g,"__array__")));let f=j;for(const r of F)if(r){if(!f[r]){if("?"===r){f.__ignoreObjectTree__=!0;continue}f[r]={},"__array__"===r&&(f[r].__target__=!0)}f=f[r]}Object.assign(f,O)}},13398:(K,O,F)=>{"use strict";F.r(O),F.d(O,{AnimationPropertyInfo:()=>E,TransformNodeAnimationPropertyInfo:()=>M,WeightAnimationPropertyInfo:()=>t,getQuaternion:()=>J,getVector3:()=>q,getWeights:()=>c});var f=F(12266),r=F(11713),l=F(13385);function q(K,O,F,f){return r.TO.LO(O,F).scaleInPlace(f)}function J(K,O,F,f){return r.Quaternion.LO(O,F).scaleInPlace(f)}function c(K,O,F,f){const r=new Array(K._numMorphTargets);for(let l=0;l<r.length;l++)r[l]=O[F++]*f;return r}class E{constructor(K,O,F,f){this.type=K,this.name=O,this.getValue=F,this.getStride=f}_buildAnimation(K,O,F){const r=new f.d(K,this.name,O,this.type);return r.setKeys(F),r}}class M extends E{buildAnimations(K,O,F,f){const r=[];return r.push({babylonAnimatable:K._babylonTransformNode,babylonAnimation:this._buildAnimation(O,F,f)}),r}}class t extends E{buildAnimations(K,O,F,r){const l=[];if(K._numMorphTargets)for(let q=0;q<K._numMorphTargets;q++){const J=new f.d(`${O}_${q}`,this.name,F,this.type);if(J.setKeys(r.map((K=>({frame:K.frame,inTangent:K.inTangent?K.inTangent[q]:void 0,value:K.value[q],outTangent:K.outTangent?K.outTangent[q]:void 0,interpolation:K.interpolation})))),K._primitiveBabylonMeshes)for(const O of K._primitiveBabylonMeshes)if(O.morphTargetManager){const K=O.morphTargetManager.getTarget(q),F=J.clone();K.animations.push(F),l.push({babylonAnimatable:K,babylonAnimation:F})}}return l}}(0,l.m)("/nodes/{}/translation",[new M(f.d.ANIMATIONTYPE_VECTOR3,"position",q,(()=>3))]),(0,l.m)("/nodes/{}/rotation",[new M(f.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",J,(()=>4))]),(0,l.m)("/nodes/{}/scale",[new M(f.d.ANIMATIONTYPE_VECTOR3,"TJ",q,(()=>3))]),(0,l.m)("/nodes/{}/weights",[new t(f.d.ANIMATIONTYPE_FLOAT,"influence",c,(K=>K._numMorphTargets))])},13345:(K,O,F)=>{"use strict";class f{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((K,O)=>{this._resolve=K,this._reject=O}))}}var r=F(11713),l=F(11764),q=F(11517),J=F(12201),c=F(13353),E=F(13361),M=F(11523),t=F(12221),j=F(12266),X=F(12271),u=F(11559),T=F(11534),o=F(11539);class k{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(K){this._useTextureToStoreBoneMatrices=K,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(K){this._animationPropertiesOverride=K}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(K,O,F){this.name=K,this.id=O,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=r.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new M.c,this.bones=[],this._scene=F||u.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const f=this._scene.getEngine().getCaps();this._canUseTextureForBones=f.textureFloat&&f.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((K=>!K.getParent()))}getTransformMatrices(K){if(this.needInitialSkinMatrix){if(!K)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return K._bonesTransformMatrices||this.prepare(!0),K._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(K){return this.needInitialSkinMatrix&&K._transformMatrixTexture?K._transformMatrixTexture:this._transformMatrixTexture}HK(){return this._scene}toString(K){let O=`Name: ${this.name}, nBones: ${this.bones.length}`;if(O+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,K){O+=", Ranges: {";let K=!0;for(const F in this._ranges)K&&(O+=", ",K=!1),O+=F;O+="}"}return O}getBoneIndexByName(K){for(let O=0,F=this.bones.length;O<F;O++)if(this.bones[O].name===K)return O;return-1}createAnimationRange(K,O,F){if(!this._ranges[K]){this._ranges[K]=new X.b(K,O,F);for(let f=0,r=this.bones.length;f<r;f++)this.bones[f].animations[0]&&this.bones[f].animations[0].createRange(K,O,F)}}deleteAnimationRange(K){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let F=0,f=this.bones.length;F<f;F++)this.bones[F].animations[0]&&this.bones[F].animations[0].deleteRange(K,O);this._ranges[K]=null}getAnimationRange(K){return this._ranges[K]||null}getAnimationRanges(){const K=[];let O;for(O in this._ranges)K.push(this._ranges[O]);return K}copyAnimationRange(K,O){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[O]||!K.getAnimationRange(O))return!1;let f=!0;const r=this._getHighestAnimationFrame()+1,l={},q=K.bones;let J,c;for(c=0,J=q.length;c<J;c++)l[q[c].name]=q[c];this.bones.length!==q.length&&(T.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${q.length}`),f=!1);const E=F&&this.dimensionsAtRest&&K.dimensionsAtRest?this.dimensionsAtRest.divide(K.dimensionsAtRest):null;for(c=0,J=this.bones.length;c<J;c++){const K=this.bones[c].name,q=l[K];q?f=f&&this.bones[c].copyAnimationRange(q,O,r,F,E):(T.c.Warn("copyAnimationRange: not same rig, missing source bone "+K),f=!1)}const M=K.getAnimationRange(O);return M&&(this._ranges[O]=new X.b(O,M.from+r,M.to+r)),f}returnToRest(){for(const K of this.bones)-1!==K._index&&K.returnToRest()}_getHighestAnimationFrame(){let K=0;for(let O=0,F=this.bones.length;O<F;O++)if(this.bones[O].animations[0]){const F=this.bones[O].animations[0].getHighestFrame();K<F&&(K=F)}return K}beginAnimation(K,O,F,f){const r=this.getAnimationRange(K);return r?this._scene.beginAnimation(this,r.from,r.to,O,F,f):null}static MakeAnimationAdditive(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;const f=K.getAnimationRange(F);if(!f)return null;const r=K._scene.getAllAnimatablesByTarget(K);let l=null;for(let J=0;J<r.length;J++){const K=r[J];if(K.fromFrame===(null===f||void 0===f?void 0:f.from)&&K.toFrame===(null===f||void 0===f?void 0:f.to)){l=K;break}}const q=K.getAnimatables();for(let J=0;J<q.length;J++){const K=q[J].animations;if(K)for(let f=0;f<K.length;f++)j.d.MakeAnimationAdditive(K[f],O,F)}return l&&(l.isAdditive=!0),K}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(K){this._meshesWithPoseMatrix.push(K)}_unregisterMeshWithPoseMatrix(K){const O=this._meshesWithPoseMatrix.indexOf(K);O>-1&&this._meshesWithPoseMatrix.splice(O,1)}_computeTransformMatrices(K,O){this.onBeforeComputeObservable.notifyObservers(this);for(let F=0;F<this.bones.length;F++){const f=this.bones[F];f._childUpdateId++;const r=f.getParent();if(r?f.getLocalMatrix().multiplyToRef(r.getFinalMatrix(),f.getFinalMatrix()):O?f.getLocalMatrix().multiplyToRef(O,f.getFinalMatrix()):f.getFinalMatrix().l(f.getLocalMatrix()),-1!==f._index){const O=null===f._index?F:f._index;f.getAbsoluteInverseBindMatrix().multiplyToArray(f.getFinalMatrix(),K,16*O)}}this._identity.copyToArray(K,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const K=this.HK().getRenderId();if(this._currentRenderId===K)return;this._currentRenderId=K}if(this._numBonesWithLinkedTransformNode>0)for(const K of this.bones)if(K._linkedTransformNode){const O=K._linkedTransformNode;K.position=O.position,O.rotationQuaternion?K.rotationQuaternion=O.rotationQuaternion:K.rotation=O.rotation,K.TJ=O.TJ}if(this.needInitialSkinMatrix)for(const K of this._meshesWithPoseMatrix){const O=K.getPoseMatrix();let F=this._isDirty;if(K._bonesTransformMatrices&&K._bonesTransformMatrices.length===16*(this.bones.length+1)||(K._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),F=!0),F){if(this._synchronizedWithMesh!==K){this._synchronizedWithMesh=K;for(const K of this.bones)if(!K.getParent()){K.getBindMatrix().multiplyToRef(O,r.TmpVectors.Matrix[1]),K._updateAbsoluteBindMatrices(r.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const O=4*(this.bones.length+1);K._transformMatrixTexture&&K._transformMatrixTexture.getSize().width===O||(K._transformMatrixTexture&&K._transformMatrixTexture.dispose(),K._transformMatrixTexture=t.e.CreateRGBATexture(K._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(K._bonesTransformMatrices,O),this.isUsingTextureForMatrices&&K._transformMatrixTexture&&K._transformMatrixTexture.update(K._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=t.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let K=0;K<this.bones.length;K++)this._animatables.push(this.bones[K])}return this._animatables}clone(K,O){const F=new k(K,O||K,this._scene);F.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let f=0;f<this.bones.length;f++){const K=this.bones[f];let O=null;const r=K.getParent();if(r){const K=this.bones.indexOf(r);O=F.bones[K]}const l=new E.d(K.name,F,O,K.getBindMatrix().clone(),K.getRestMatrix().clone());l._index=K._index,K._linkedTransformNode&&l.linkTransformNode(K._linkedTransformNode),o.c.DeepCopy(K.animations,l.animations)}if(this._ranges){F._ranges={};for(const K in this._ranges){const O=this._ranges[K];O&&(F._ranges[K]=O.clone())}}return this._isDirty=!0,F.prepare(!0),F}enableBlending(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const O of this.bones)for(const F of O.animations)F.enableBlending=!0,F.blendingSpeed=K}dispose(){if(this._meshesWithPoseMatrix.length=0,this.HK().stopAnimation(this),this.HK().removeSkeleton(this),this._parentContainer){const K=this._parentContainer.skeletons.indexOf(this);K>-1&&this._parentContainer.skeletons.splice(K,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const K={};K.name=this.name,K.id=this.id,this.dimensionsAtRest&&(K.dimensionsAtRest=this.dimensionsAtRest.hf()),K.bones=[],K.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let F=0;F<this.bones.length;F++){var O;const f=this.bones[F],r=f.getParent(),l={parentBoneIndex:r?this.bones.indexOf(r):-1,index:f.getIndex(),name:f.name,id:f.id,matrix:f.getBindMatrix().hf(),rest:f.getRestMatrix().hf(),linkedTransformNodeId:null===(O=f.getTransformNode())||void 0===O?void 0:O.id};K.bones.push(l),f.length&&(l.length=f.length),f.metadata&&(l.metadata=f.metadata),f.animations&&f.animations.length>0&&(l.animation=f.animations[0].serialize()),K.ranges=[];for(const O in this._ranges){const F=this._ranges[O];if(!F)continue;const f={};f.name=O,f.from=F.from,f.to=F.to,K.ranges.push(f)}}return K}static Parse(K,O){const F=new k(K.name,K.id,O);let f;for(K.dimensionsAtRest&&(F.dimensionsAtRest=r.TO.LO(K.dimensionsAtRest)),F.needInitialSkinMatrix=K.needInitialSkinMatrix,f=0;f<K.bones.length;f++){const O=K.bones[f],l=K.bones[f].index;let q=null;O.parentBoneIndex>-1&&(q=F.bones[O.parentBoneIndex]);const J=O.rest?r.Matrix.LO(O.rest):null,c=new E.d(O.name,F,q,r.Matrix.LO(O.matrix),J,null,l);void 0!==O.id&&null!==O.id&&(c.id=O.id),O.length&&(c.length=O.length),O.metadata&&(c.metadata=O.metadata),O.animation&&c.animations.push(j.d.Parse(O.animation)),void 0!==O.linkedTransformNodeId&&null!==O.linkedTransformNodeId&&(F._hasWaitingData=!0,c._waitingTransformNodeId=O.linkedTransformNodeId)}if(K.ranges)for(f=0;f<K.ranges.length;f++){const O=K.ranges[f];F.createAnimationRange(O.name,O.from,O.to)}return F}computeAbsoluteMatrices(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||K)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(K)}getPoseMatrix(){let K=null;return this._meshesWithPoseMatrix.length>0&&(K=this._meshesWithPoseMatrix[0].getPoseMatrix()),K}sortBones(){const K=[],O=new Array(this.bones.length);for(let F=0;F<this.bones.length;F++)this._sortBones(F,K,O);this.bones=K}_sortBones(K,O,F){if(F[K])return;F[K]=!0;const f=this.bones[K];if(!f)return;void 0===f._index&&(f._index=K);const r=f.getParent();r&&this._sortBones(this.bones.indexOf(r),O,F),O.push(f)}setCurrentPoseAsRest(){for(const K of this.bones)K.setCurrentPoseAsRest()}}var N=F(12053),Z=F(12236),L=F(11688),d=F(12153),a=F(11793),g=F(12209),H=F(12164),e=F(12193),W=F(12273),p=F(11816),y=F(13306);class A{set areUpdatesFrozen(K){K?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new p.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,K||(K=u.e.LastCreatedScene),this._scene=K,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const K=this._scene.getEngine().getCaps();this._canUseTextureForTargets=K.canUseGLVertexID&&K.textureFloat&&K.maxVertexTextureImageUnits>0&&K.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return A.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?A.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(K){this._numMaxInfluencers!==K&&(this._numMaxInfluencers=K,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(K){this._useTextureToStoreTargets!==K&&(this._useTextureToStoreTargets=K,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var K;return A.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(K=this._scene)&&void 0!==K&&K.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(K){return this._activeTargets.data[K]}getTarget(K){return this._targets[K]}getTargetByName(K){for(const O of this._targets)if(O.name===K)return O;return null}addTarget(K){this._targets.push(K),this._targetInfluenceChangedObservers.push(K.onInfluenceChanged.add((K=>{this.areUpdatesFrozen&&K&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(K)}))),this._targetDataLayoutChangedObservers.push(K._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(K){const O=this._targets.indexOf(K);O>=0&&(this._targets.splice(O,1),K.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(O,1)[0]),K._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(O,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(K)}_bind(K){K.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),K.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),K.setTexture("morphTargets",this._targetStoreTexture),K.setInt("morphTargetCount",this.numInfluencers)}clone(){const K=new A(this._scene);for(const O of this._targets)K.addTarget(O.clone());return K.enablePositionMorphing=this.enablePositionMorphing,K.enableNormalMorphing=this.enableNormalMorphing,K.enableTangentMorphing=this.enableTangentMorphing,K.enableUVMorphing=this.enableUVMorphing,K.enableUV2Morphing=this.enableUV2Morphing,K.enableColorMorphing=this.enableColorMorphing,K}serialize(){const K={};K.id=this.uniqueId,K.targets=[];for(const O of this._targets)K.targets.push(O.serialize());return K}_syncActiveTargets(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const O=!!this._targetStoreTexture,F=this.isUsingTextureForTargets;(this._mustSynchronize||O!==F)&&(this._mustSynchronize=!1,this.synchronize());let f=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let r=-1;for(const l of this._targets)if(r++,0!==l.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=A.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(l),this._morphTargetTextureIndices[f]=r,this._tempInfluences[f++]=l.influence}this._morphTargetTextureIndices.length!==f&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,f)),this._influences&&this._influences.length===f||(this._influences=new Float32Array(f));for(let l=0;l<f;l++)this._influences[l]=this._tempInfluences[l];if(K&&this._scene)for(const l of this._scene.meshes)l.morphTargetManager===this&&(F?l._markSubMeshesAsAttributesDirty():l._syncGeometryWithMorphTargetManager())}synchronize(){var K;if(!this._scene||this.areUpdatesFrozen)return;const O=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(K=this._targetStoreTexture)||void 0===K||K.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>O.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const F of this._targets){this._supportsPositions=this._supportsPositions&&F.hasPositions,this._supportsNormals=this._supportsNormals&&F.hasNormals,this._supportsTangents=this._supportsTangents&&F.hasTangents,this._supportsUVs=this._supportsUVs&&F.hasUVs,this._supportsUV2s=this._supportsUV2s&&F.hasUV2s,this._supportsColors=this._supportsColors&&F.hasColors;const K=F.vertexCount;if(0===this._vertexCount)this._vertexCount=K;else if(this._vertexCount!==K)return void T.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${F.name}": ${K}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const K=O.getCaps().maxTextureSize;this._textureWidth>K&&(this._textureHeight=Math.ceil(this._textureWidth/K),this._textureWidth=K);const F=this._targets.length,f=new Float32Array(F*this._textureWidth*this._textureHeight*4);let r=0;for(let O=0;O<F;O++){const K=this._targets[O],F=K.getPositions(),l=K.getNormals(),q=K.getUVs(),J=K.getTangents(),c=K.getUV2s(),E=K.getColors();r=O*this._textureWidth*this._textureHeight*4;for(let O=0;O<this._vertexCount;O++)this._supportsPositions&&F&&(f[r]=F[3*O],f[r+1]=F[3*O+1],f[r+2]=F[3*O+2],r+=4),this._supportsNormals&&l&&(f[r]=l[3*O],f[r+1]=l[3*O+1],f[r+2]=l[3*O+2],r+=4),this._supportsUVs&&q&&(f[r]=q[2*O],f[r+1]=q[2*O+1],r+=4),this._supportsTangents&&J&&(f[r]=J[3*O],f[r+1]=J[3*O+1],f[r+2]=J[3*O+2],r+=4),this._supportsUV2s&&c&&(f[r]=c[2*O],f[r+1]=c[2*O+1],r+=4),this._supportsColors&&E&&(f[r]=E[4*O],f[r+1]=E[4*O+1],f[r+2]=E[4*O+2],f[r+3]=E[4*O+3],r+=4)}this._targetStoreTexture=y.e.CreateRGBATexture(f,this._textureWidth,this._textureHeight,F,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const F of this._scene.meshes)F.morphTargetManager===this&&F._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const K=this._parentContainer.morphTargetManagers.indexOf(this);K>-1&&this._parentContainer.morphTargetManagers.splice(K,1),this._parentContainer=null}for(const K of this._targets)this._scene.stopAnimation(K)}}static Parse(K,O){const F=new A(O);for(const f of K.targets)F.addTarget(W.d.Parse(f,O));return F}}A.EnableTextureStorage=!0,A.MaxActiveMorphTargetsInVertexAttributeMode=8,A.ConstantTargetCountForTextureMode=0;var Q=F(13369),R=F(11565),G=F(12072);const z=new Map,m=z;function x(K,O,F){V(K)&&T.c.Warn(`Extension with the name '${K}' already exists`),z.set(K,{isGLTFExtension:O,factory:F})}function V(K){return z.delete(K)}var v=F(13385),Y=F(12332),B=F(11805);class n{static Get(K,O,F){if(!O||void 0==F||!O[F])throw new Error(`${K}: Failed to find index (${F})`);return O[F]}static TryGet(K,O){return K&&void 0!=O&&K[O]?K[O]:null}static Assign(K){if(K)for(let O=0;O<K.length;O++)K[O].index=O}}function C(K){if(K.min&&K.max){const O=K.min,F=K.max,f=r.TmpVectors.TO[0].eq(O[0],O[1],O[2]),l=r.TmpVectors.TO[1].eq(F[0],F[1],F[2]);if(K.normalized&&5126!==K.componentType){let O=1;switch(K.componentType){case 5120:O=127;break;case 5121:O=255;break;case 5122:O=32767;break;case 5123:O=65535}const F=1/O;f.scaleInPlace(F),l.scaleInPlace(F)}return new G.d(f,l)}return null}class I{static RegisterExtension(K,O){x(K,!1,O)}static UnregisterExtension(K){return V(K)}get zf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(K){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=K}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((K=>K.dispose&&K.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(K,O,F,f,r,l){let q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=O,this._assetContainer=F,this._loadData(f);let l=null;if(K){const O={};if(this._gltf.nodes)for(const K of this._gltf.nodes)K.name&&(O[K.name]=K.index);l=(K instanceof Array?K:[K]).map((K=>{const F=O[K];if(void 0===F)throw new Error(`Failed to find node '${K}'`);return F}))}return await this._loadAsync(r,q,l,(()=>({meshes:this._getMeshes(),pj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=K,this._loadData(O),await this._loadAsync(F,r,null,(()=>{}))}async _loadAsync(K,O,F,f){return await Promise.resolve().then((async()=>{this._rootUrl=K,this._uniqueRootUrl=!K.startsWith("file:")&&O?K:`${K}${Date.now()}/`,this._fileName=O,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const r=`${Q.h[Q.h.LOADING]} => ${Q.h[Q.h.READY]}`,l=`${Q.h[Q.h.LOADING]} => ${Q.h[Q.h.COMPLETE]}`;this._parent._startPerformanceCounter(r),this._parent._startPerformanceCounter(l),this._parent._setState(Q.h.LOADING),this._extensionsOnLoading();const J=new Array;if(!this.parent.loadOnlyMaterials)if(F)J.push(this.loadSceneAsync("/nodes",{nodes:F,index:-1}));else if(void 0!=this._gltf.kO||this._gltf.scenes&&this._gltf.scenes[0]){const K=n.Get("/scene",this._gltf.scenes,this._gltf.kO||0);J.push(this.loadSceneAsync(`/scenes/${K.index}`,K))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let K=0;K<this._gltf.materials.length;++K){const O=this._gltf.materials[K],F="/materials/"+K,f=N.e.TriangleFillMode;J.push(this._loadMaterialAsync(F,O,null,f,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&J.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&J.push(this._compileShadowGeneratorsAsync());const c=Promise.all(J).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.vJ(!0);for(const K of this._babylonScene.materials){const O=K;void 0!==O.maxSimultaneousLights&&(O.maxSimultaneousLights=Math.max(O.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(Q.h.READY),this._skipStartAnimationStep||this._startAnimations(),f()}));return await c.then((K=>(this._parent._endPerformanceCounter(r),q.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(l),this._parent._setState(Q.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(K=>{this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()}))})),K)))})).catch((K=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()),K}))}_loadData(K){if(this._gltf=K.json,this._setupData(),K.bin){const O=this._gltf.buffers;if(O&&O[0]&&!O[0].uri){const F=O[0];(F.byteLength<K.bin.byteLength-3||F.byteLength>K.bin.byteLength)&&T.c.Warn(`Binary buffer length (${F.byteLength}) from JSON does not match chunk length (${K.bin.byteLength})`),this._bin=K.bin}else T.c.Warn("Unexpected BIN chunk")}}_setupData(){if(n.Assign(this._gltf.accessors),n.Assign(this._gltf.animations),n.Assign(this._gltf.buffers),n.Assign(this._gltf.bufferViews),n.Assign(this._gltf.cameras),n.Assign(this._gltf.images),n.Assign(this._gltf.materials),n.Assign(this._gltf.meshes),n.Assign(this._gltf.nodes),n.Assign(this._gltf.samplers),n.Assign(this._gltf.scenes),n.Assign(this._gltf.skins),n.Assign(this._gltf.textures),this._gltf.nodes){const K={};for(const F of this._gltf.nodes)if(F.children)for(const O of F.children)K[O]=F.index;const O=this._createRootNode();for(const F of this._gltf.nodes){const f=K[F.index];F.parent=void 0===f?O:this._gltf.nodes[f]}}}async _loadExtensionsAsync(){const K=[];if(m.forEach(((O,F)=>{var f;!1===(null===(f=this.parent.extensionOptions[F])||void 0===f?void 0:f.enabled)?O.isGLTFExtension&&this.isExtensionUsed(F)&&T.c.Warn(`Extension ${F} is used but has been explicitly disabled.`):O.isGLTFExtension&&!this.isExtensionUsed(F)||K.push((async()=>{const K=await O.factory(this);return K.name!==F&&T.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${K.name} !== ${F}`),this._parent.onExtensionLoadedObservable.notifyObservers(K),K})())})),this._extensions.push(...await Promise.all(K)),this._extensions.sort(((K,O)=>(K.order||Number.MAX_VALUE)-(O.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const F of this._gltf.extensionsRequired){if(!this._extensions.some((K=>K.name===F&&K.enabled))){var O;if(!1===(null===(O=this.parent.extensionOptions[F])||void 0===O?void 0:O.enabled))throw new Error(`Required extension ${F} is disabled`);throw new Error(`Required extension ${F} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new e.b("__root__",this._babylonScene);this._rootBabylonMesh=K,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.vJ(!1);const O={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case Q.g.AUTO:this._babylonScene.useRightHandedSystem||(O.rotation=[0,1,0,0],O.scale=[1,1,-1],I._LoadTransform(O,this._rootBabylonMesh));break;case Q.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(K),O}loadSceneAsync(K,O){const F=this._extensionsLoadSceneAsync(K,O);if(F)return F;const f=new Array;if(this.logOpen(`${K} ${O.name||""}`),O.nodes)for(const r of O.nodes){const O=n.Get(`${K}/nodes/${r}`,this._gltf.nodes,r);f.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(K=>{K.parent=this._rootBabylonMesh})))}for(const r of this._postSceneLoadActions)r();return f.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(f).then((()=>{}))}_forEachPrimitive(K,O){if(K._primitiveBabylonMeshes)for(const F of K._primitiveBabylonMeshes)O(F)}_getGeometries(){const K=[],O=this._gltf.nodes;if(O)for(const F of O)this._forEachPrimitive(F,(O=>{const F=O.hr;F&&-1===K.indexOf(F)&&K.push(F)}));return K}_getMeshes(){const K=[];this._rootBabylonMesh instanceof H.e&&K.push(this._rootBabylonMesh);const O=this._gltf.nodes;if(O)for(const F of O)this._forEachPrimitive(F,(O=>{K.push(O)}));return K}_getTransformNodes(){const K=[],O=this._gltf.nodes;if(O)for(const F of O)F._babylonTransformNode&&"rc"===F._babylonTransformNode.getClassName()&&K.push(F._babylonTransformNode),F._babylonTransformNodeForSkin&&K.push(F._babylonTransformNodeForSkin);return K}_getSkeletons(){const K=[],O=this._gltf.skins;if(O)for(const F of O)F._data&&K.push(F._data.babylonSkeleton);return K}_getAnimationGroups(){const K=[],O=this._gltf.animations;if(O)for(const F of O)F._babylonAnimationGroup&&K.push(F._babylonAnimationGroup);return K}_startAnimations(){switch(this._parent.animationStartMode){case Q.e.NONE:break;case Q.e.FIRST:{const K=this._getAnimationGroups();0!==K.length&&K[0].start(!0);break}case Q.e.ALL:{const K=this._getAnimationGroups();for(const O of K)O.start(!0);break}default:return void T.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadNodeAsync(K,O,F);if(f)return f;if(O._babylonTransformNode)throw new Error(`${K}: Invalid recursive node hierarchy`);const r=new Array;this.logOpen(`${K} ${O.name||""}`);const l=f=>{if(I.AddPointerMetadata(f,K),I._LoadTransform(O,f),void 0!=O.camera){const F=n.Get(`${K}/camera`,this._gltf.cameras,O.camera);r.push(this.loadCameraAsync(`/cameras/${F.index}`,F,(K=>{K.parent=f,this._babylonScene.useRightHandedSystem||(f.TJ.x=-1)})))}if(O.children)for(const F of O.children){const O=n.Get(`${K}/children/${F}`,this._gltf.nodes,F);r.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(K=>{K.parent=f})))}F(f)},q=void 0!=O.mesh,J=this._parent.loadSkins&&void 0!=O.skin;if(!q||J){const K=O.name||`node${O.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new d.b(K,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==O.mesh?O._babylonTransformNode=F:O._babylonTransformNodeForSkin=F,l(F)}if(q)if(J){const F=n.Get(`${K}/mesh`,this._gltf.meshes,O.mesh);r.push(this._loadMeshAsync(`/meshes/${F.index}`,O,F,(F=>{const f=O._babylonTransformNodeForSkin;F.metadata=(0,Y.e)(f.metadata,F.metadata||{});const l=n.Get(`${K}/skin`,this._gltf.skins,O.skin);r.push(this._loadSkinAsync(`/skins/${l.index}`,O,l,(K=>{this._forEachPrimitive(O,(O=>{O.skeleton=K})),this._postSceneLoadActions.push((()=>{if(void 0!=l.skeleton){const K=n.Get(`/skins/${l.index}/skeleton`,this._gltf.nodes,l.skeleton).parent;O.index===K.index?F.parent=f.parent:F.parent=K._babylonTransformNode}else F.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:f,skinnedNode:F})}))})))})))}else{const F=n.Get(`${K}/mesh`,this._gltf.meshes,O.mesh);r.push(this._loadMeshAsync(`/meshes/${F.index}`,O,F,l))}return this.logClose(),Promise.all(r).then((()=>(this._forEachPrimitive(O,(K=>{const O=K;!O.isAnInstance&&O.hr&&O.hr.useBoundingInfoFromGeometry?K.zK():K.refreshBoundingInfo(!0,!0)})),O._babylonTransformNode)))}_loadMeshAsync(K,O,F,f){const r=F.primitives;if(!r||!r.length)throw new Error(`${K}: Primitives are missing`);void 0==r[0].index&&n.Assign(r);const l=new Array;this.logOpen(`${K} ${F.name||""}`);const q=O.name||`node${O.index}`;if(1===r.length){const f=F.primitives[0];l.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${f.index}`,q,O,F,f,(K=>{O._babylonTransformNode=K,O._primitiveBabylonMeshes=[K]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,O._babylonTransformNode=new d.b(q,this._babylonScene),O._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._primitiveBabylonMeshes=[];for(const f of r)l.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${f.index}`,`${q}_primitive${f.index}`,O,F,f,(K=>{K.parent=O._babylonTransformNode,O._primitiveBabylonMeshes.push(K)})))}return f(O._babylonTransformNode),this.logClose(),Promise.all(l).then((()=>O._babylonTransformNode))}_loadMeshPrimitiveAsync(K,O,F,f,r,l){const q=this._extensionsLoadMeshPrimitiveAsync(K,O,F,f,r,l);if(q)return q;this.logOpen(`${K}`);const J=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==F.skin&&!f.primitives[0].targets;let c,E;if(J&&r._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,c=r._instanceData.babylonSourceMesh.createInstance(O),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E=r._instanceData.promise;else{const l=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new e.b(O,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.sideOrientation=this._babylonScene.useRightHandedSystem?N.e.CounterClockWiseSideOrientation:N.e.ClockWiseSideOrientation,this._createMorphTargets(K,F,f,r,q),l.push(this._loadVertexDataAsync(K,r,q).then((async O=>await this._loadMorphTargetsAsync(K,r,q,O).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,O.RK(q),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const M=I._GetDrawMode(K,r.mode);if(void 0==r.material){let K=this._defaultBabylonMaterialData[M];K||(K=this._createDefaultMaterial("__GLTFLoader._default",M),this._parent.onMaterialLoadedObservable.notifyObservers(K),this._defaultBabylonMaterialData[M]=K),q.material=K}else if(!this.parent.skipMaterials){const O=n.Get(`${K}/material`,this._gltf.materials,r.material);l.push(this._loadMaterialAsync(`/materials/${O.index}`,O,q,M,(K=>{q.material=K})))}E=Promise.all(l),J&&(r._instanceData={babylonSourceMesh:q,promise:E}),c=q}return I.AddPointerMetadata(c,K),this._parent.onMeshLoadedObservable.notifyObservers(c),l(c),this.logClose(),E.then((()=>c))}_loadVertexDataAsync(K,O,F){const f=this._extensionsLoadVertexDataAsync(K,O,F);if(f)return f;const r=O.attributes;if(!r)throw new Error(`${K}: Attributes are missing`);const l=new Array,q=new g.c(F.name,this._babylonScene);if(void 0==O.indices)F.isUnIndexed=!0;else{const F=n.Get(`${K}/indices`,this._gltf.accessors,O.indices);l.push(this._loadIndicesAccessorAsync(`/accessors/${F.index}`,F).then((K=>{q.setIndices(K)})))}const J=(O,f,J)=>{if(void 0==r[O])return;F._delayInfo=F._delayInfo||[],-1===F._delayInfo.indexOf(f)&&F._delayInfo.push(f);const c=n.Get(`${K}/attributes/${O}`,this._gltf.accessors,r[O]);l.push(this._loadVertexAccessorAsync(`/accessors/${c.index}`,c,f).then((K=>{if(K.getKind()===a.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!F.skeleton){const K=C(c);K&&(q._boundingInfo=K,q.useBoundingInfoFromGeometry=!0)}q.setVerticesBuffer(K,c.count)}))),f==a.d.MatricesIndicesExtraKind&&(F.numBoneInfluencers=8),J&&J(c)};return J("POSITION",a.d.PositionKind),J("NORMAL",a.d.NormalKind),J("TANGENT",a.d.TangentKind),J("TEXCOORD_0",a.d.UVKind),J("TEXCOORD_1",a.d.UV2Kind),J("TEXCOORD_2",a.d.UV3Kind),J("TEXCOORD_3",a.d.UV4Kind),J("TEXCOORD_4",a.d.UV5Kind),J("TEXCOORD_5",a.d.UV6Kind),J("JOINTS_0",a.d.MatricesIndicesKind),J("WEIGHTS_0",a.d.MatricesWeightsKind),J("JOINTS_1",a.d.MatricesIndicesExtraKind),J("WEIGHTS_1",a.d.MatricesWeightsExtraKind),J("COLOR_0",a.d.ColorKind,(K=>{"VEC4"===K.type&&(F.hasVertexAlpha=!0)})),Promise.all(l).then((()=>q))}_createMorphTargets(K,O,F,f,r){if(!f.targets||!this._parent.loadMorphTargets)return;if(void 0==O._numMorphTargets)O._numMorphTargets=f.targets.length;else if(f.targets.length!==O._numMorphTargets)throw new Error(`${K}: Primitives do not have the same number of targets`);const l=F.extras?F.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,r.morphTargetManager=new A(this._babylonScene),r.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.morphTargetManager.areUpdatesFrozen=!0;for(let q=0;q<f.targets.length;q++){const K=O.weights?O.weights[q]:F.weights?F.weights[q]:0,f=l?l[q]:`morphTarget${q}`;r.morphTargetManager.addTarget(new W.d(f,K,r.HK()))}}_loadMorphTargetsAsync(K,O,F,f){if(!O.targets||!this._parent.loadMorphTargets)return Promise.resolve();const r=new Array,l=F.morphTargetManager;for(let q=0;q<l.numTargets;q++){const F=l.getTarget(q);r.push(this._loadMorphTargetVertexDataAsync(`${K}/targets/${q}`,f,O.targets[q],F))}return Promise.all(r).then((()=>{l.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(K,O,F,f){const r=new Array,l=(f,l,q)=>{if(void 0==F[f])return;const J=O.getVertexBuffer(l);if(!J)return;const c=n.Get(`${K}/${f}`,this._gltf.accessors,F[f]);r.push(this._loadFloatAccessorAsync(`/accessors/${c.index}`,c).then((K=>{q(J,K)})))};return l("POSITION",a.d.PositionKind,((K,O)=>{const F=new Float32Array(O.length);K.forEach(O.length,((K,f)=>{F[f]=O[f]+K})),f.setPositions(F)})),l("NORMAL",a.d.NormalKind,((K,O)=>{const F=new Float32Array(O.length);K.forEach(F.length,((K,f)=>{F[f]=O[f]+K})),f.setNormals(F)})),l("TANGENT",a.d.TangentKind,((K,O)=>{const F=new Float32Array(O.length/3*4);let r=0;K.forEach(O.length/3*4,((K,f)=>{(f+1)%4!==0&&(F[r]=O[r]+K,r++)})),f.setTangents(F)})),l("TEXCOORD_0",a.d.UVKind,((K,O)=>{const F=new Float32Array(O.length);K.forEach(O.length,((K,f)=>{F[f]=O[f]+K})),f.setUVs(F)})),l("TEXCOORD_1",a.d.UV2Kind,((K,O)=>{const F=new Float32Array(O.length);K.forEach(O.length,((K,f)=>{F[f]=O[f]+K})),f.setUV2s(F)})),l("COLOR_0",a.d.ColorKind,((O,F)=>{let r=null;const l=O.getSize();if(3===l){r=new Float32Array(F.length/3*4),O.forEach(F.length,((K,O)=>{const f=Math.floor(O/3),l=O%3;r[4*f+l]=F[3*f+l]+K}));for(let K=0;K<F.length/3;++K)r[4*K+3]=1}else{if(4!==l)throw new Error(`${K}: Invalid number of components (${l}) for COLOR_0 attribute`);r=new Float32Array(F.length),O.forEach(F.length,((K,O)=>{r[O]=F[O]+K}))}f.setColors(r)})),await Promise.all(r).then((()=>{}))}static _LoadTransform(K,O){if(void 0!=K.skin)return;let F=r.TO.Zero(),f=r.Quaternion.Identity(),l=r.TO.One();if(K.matrix){r.Matrix.LO(K.matrix).decompose(l,f,F)}else K.translation&&(F=r.TO.LO(K.translation)),K.rotation&&(f=r.Quaternion.LO(K.rotation)),K.scale&&(l=r.TO.LO(K.scale));O.position=F,O.rotationQuaternion=f,O.TJ=l}_loadSkinAsync(K,O,F,f){if(!this._parent.loadSkins)return Promise.resolve();const r=this._extensionsLoadSkinAsync(K,O,F);if(r)return r;if(F._data)return f(F._data.babylonSkeleton),F._data.promise;const l=`skeleton${F.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new k(F.name||l,l,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(K,F,q);const J=this._loadSkinInverseBindMatricesDataAsync(K,F).then((K=>{this._updateBoneMatrices(q,K)}));return F._data={babylonSkeleton:q,promise:J},f(q),J}_loadBones(K,O,F){if(void 0==O.skeleton||this._parent.alwaysComputeSkeletonRootNode){const F=this._findSkeletonRootNode(`${K}/joints`,O.joints);if(F)if(void 0===O.skeleton)O.skeleton=F.index;else{const f=(K,O)=>{for(;O.parent;O=O.parent)if(O.parent===K)return!0;return!1},r=n.Get(`${K}/skeleton`,this._gltf.nodes,O.skeleton);r===F||f(r,F)||(T.c.Warn(`${K}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),O.skeleton=F.index)}else T.c.Warn(`${K}: Failed to find common root`)}const f={};for(const r of O.joints){const l=n.Get(`${K}/joints/${r}`,this._gltf.nodes,r);this._loadBone(l,O,F,f)}}_findSkeletonRootNode(K,O){if(0===O.length)return null;const F={};for(const r of O){const O=[];let f=n.Get(`${K}/${r}`,this._gltf.nodes,r);for(;-1!==f.index;)O.unshift(f),f=f.parent;F[r]=O}let f=null;for(let r=0;;++r){let K=F[O[0]];if(r>=K.length)return f;const l=K[r];for(let q=1;q<O.length;++q)if(K=F[O[q]],r>=K.length||l!==K[r])return f;f=l}}_loadBone(K,O,F,f){K._isJoint=!0;let r=f[K.index];if(r)return r;let l=null;K.index!==O.skeleton&&(K.parent&&-1!==K.parent.index?l=this._loadBone(K.parent,O,F,f):void 0!==O.skeleton&&T.c.Warn(`/skins/${O.index}/skeleton: Skeleton node is not a common root`));const q=O.joints.indexOf(K.index);return r=new E.d(K.name||`joint${K.index}`,F,l,this._getNodeMatrix(K),null,null,q),f[K.index]=r,this._postSceneLoadActions.push((()=>{r.linkTransformNode(K._babylonTransformNode)})),r}_loadSkinInverseBindMatricesDataAsync(K,O){if(void 0==O.inverseBindMatrices)return Promise.resolve(null);const F=n.Get(`${K}/inverseBindMatrices`,this._gltf.accessors,O.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${F.index}`,F)}_updateBoneMatrices(K,O){for(const F of K.bones){const K=r.Matrix.Identity(),f=F._index;O&&-1!==f&&(r.Matrix.FromArrayToRef(O,16*f,K),K.invertToRef(K));const l=F.getParent();l&&K.multiplyToRef(l.getAbsoluteInverseBindMatrix(),K),F.sf(K,!1,!1),F._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(K){return K.matrix?r.Matrix.LO(K.matrix):r.Matrix.Compose(K.scale?r.TO.LO(K.scale):r.TO.One(),K.rotation?r.Quaternion.LO(K.rotation):r.Quaternion.Identity(),K.translation?r.TO.LO(K.translation):r.TO.Zero())}loadCameraAsync(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadCameraAsync(K,O,F);if(f)return f;const l=new Array;this.logOpen(`${K} ${O.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new c.b(O.name||`camera${O.index}`,r.TO.Zero(),this._babylonScene,!1);switch(q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonCamera=q,q.setTarget(new r.TO(0,0,-1)),O.type){case"perspective":{const F=O.perspective;if(!F)throw new Error(`${K}: Camera perspective properties are missing`);q.fov=F.yfov,q.if=F.znear,q.maxZ=F.zfar||0;break}case"orthographic":if(!O.orthographic)throw new Error(`${K}: Camera orthographic properties are missing`);q.mode=J.e.ORTHOGRAPHIC_CAMERA,q.orthoLeft=-O.orthographic.xmag,q.orthoRight=O.orthographic.xmag,q.orthoBottom=-O.orthographic.ymag,q.orthoTop=O.orthographic.ymag,q.if=O.orthographic.znear,q.maxZ=O.orthographic.zfar;break;default:throw new Error(`${K}: Invalid camera type (${O.type})`)}return I.AddPointerMetadata(q,K),this._parent.onCameraLoadedObservable.notifyObservers(q),F(q),this.logClose(),Promise.all(l).then((()=>q))}_loadAnimationsAsync(){const K=this._gltf.animations;if(!K)return Promise.resolve();const O=new Array;for(let F=0;F<K.length;F++){const f=K[F];O.push(this.loadAnimationAsync(`/animations/${f.index}`,f).then((K=>{0===K.targetedAnimations.length&&K.dispose()})))}return Promise.all(O).then((()=>{}))}loadAnimationAsync(K,O){const f=this._extensionsLoadAnimationAsync(K,O);return f||F.e(78).then(F.bind(F,14899)).then((F=>{let{AnimationGroup:f}=F;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new f(O.name||`animation${O.index}`,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonAnimationGroup=r;const l=new Array;n.Assign(O.channels),n.Assign(O.samplers);for(const q of O.channels)l.push(this._loadAnimationChannelAsync(`${K}/channels/${q.index}`,K,O,q,((K,O)=>{K.animations=K.animations||[],K.animations.push(O),r.addTargetedAnimation(O,K)})));return Promise.all(l).then((()=>(r.normalize(0),r)))}))}async _loadAnimationChannelAsync(K,O,f,r,l){const q=this._extensionsLoadAnimationChannelAsync(K,O,f,r,l);if(q)return await q;if(void 0==r.target.node)return await Promise.resolve();const J=n.Get(`${K}/target/node`,this._gltf.nodes,r.target.node),c=r.target.path,E="weights"===c;if(E&&!J._numMorphTargets||!E&&!J._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!E&&!J._isJoint)return await Promise.resolve();let M;switch(await Promise.resolve().then(F.bind(F,13398)),c){case"translation":var t;M=null===(t=(0,v.i)("/nodes/{}/translation"))||void 0===t?void 0:t.interpolation;break;case"rotation":var j;M=null===(j=(0,v.i)("/nodes/{}/rotation"))||void 0===j?void 0:j.interpolation;break;case"scale":var X;M=null===(X=(0,v.i)("/nodes/{}/scale"))||void 0===X?void 0:X.interpolation;break;case"weights":var u;M=null===(u=(0,v.i)("/nodes/{}/weights"))||void 0===u?void 0:u.interpolation;break;default:throw new Error(`${K}/target/path: Invalid value (${r.target.path})`)}if(!M)throw new Error(`${K}/target/path: Could not find interpolation properties for target path (${r.target.path})`);const T={object:J,info:M};return await this._loadAnimationChannelFromTargetInfoAsync(K,O,f,r,T,l)}_loadAnimationChannelFromTargetInfoAsync(K,O,F,f,r,l){const q=this.parent.targetFps,J=1/q,c=n.Get(`${K}/sampler`,F.samplers,f.sampler);return this._loadAnimationSamplerAsync(`${O}/samplers/${f.sampler}`,c).then((K=>{let O=0;const c=r.object,E=r.info;for(const r of E){const E=r.getStride(c),M=K.input,t=K.output,j=new Array(M.length);let X=0;switch(K.interpolation){case"STEP":for(let K=0;K<M.length;K++){const O=r.getValue(c,t,X,1);X+=E,j[K]={frame:M[K]*q,value:O,interpolation:1}}break;case"CUBICSPLINE":for(let K=0;K<M.length;K++){const O=r.getValue(c,t,X,J);X+=E;const F=r.getValue(c,t,X,1);X+=E;const f=r.getValue(c,t,X,J);X+=E,j[K]={frame:M[K]*q,inTangent:O,value:F,outTangent:f}}break;case"LINEAR":for(let K=0;K<M.length;K++){const O=r.getValue(c,t,X,1);X+=E,j[K]={frame:M[K]*q,value:O}}}if(X>0){const K=`${F.name||`animation${F.index}`}_channel${f.index}_${O}`,J=r.buildAnimations(c,K,q,j);for(const F of J)O++,l(F.babylonAnimatable,F.babylonAnimation)}}}))}_loadAnimationSamplerAsync(K,O){if(O._data)return O._data;const F=O.interpolation||"LINEAR";switch(F){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${K}/interpolation: Invalid value (${O.interpolation})`)}const f=n.Get(`${K}/input`,this._gltf.accessors,O.input),r=n.Get(`${K}/output`,this._gltf.accessors,O.output);return O._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${f.index}`,f),this._loadFloatAccessorAsync(`/accessors/${r.index}`,r)]).then((K=>{let[O,f]=K;return{input:O,interpolation:F,output:f}})),O._data}loadBufferAsync(K,O,F,f){const r=this._extensionsLoadBufferAsync(K,O,F,f);if(r)return r;if(!O._data)if(O.uri)O._data=this.loadUriAsync(`${K}/uri`,O,O.uri);else{if(!this._bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);O._data=this._bin.readAsync(0,O.byteLength)}return O._data.then((O=>{try{return new Uint8Array(O.buffer,O.byteOffset+F,f)}catch(r){throw new Error(`${K}: ${r.message}`)}}))}loadBufferViewAsync(K,O){const F=this._extensionsLoadBufferViewAsync(K,O);if(F)return F;if(O._data)return O._data;const f=n.Get(`${K}/buffer`,this._gltf.buffers,O.buffer);return O._data=this.loadBufferAsync(`/buffers/${f.index}`,f,O.byteOffset||0,O.byteLength),O._data}_loadAccessorAsync(K,O,F){if(O._data)return O._data;const f=I._GetNumComponents(K,O.type),r=f*a.d.GetTypeByteLength(O.componentType),l=f*O.count;if(void 0==O.bufferView)O._data=Promise.resolve(new F(l));else{const q=n.Get(`${K}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((J=>{if(5126!==O.componentType||O.normalized||q.byteStride&&q.byteStride!==r){const K=new F(l);return a.d.ForEach(J,O.byteOffset||0,q.byteStride||r,f,O.componentType,K.length,O.normalized||!1,((O,F)=>{K[F]=O})),K}return I._GetTypedArray(K,O.componentType,J,O.byteOffset,l)}))}if(O.sparse){const l=O.sparse;O._data=O._data.then((q=>{const J=q,c=n.Get(`${K}/sparse/indices/bufferView`,this._gltf.bufferViews,l.indices.bufferView),E=n.Get(`${K}/sparse/values/bufferView`,this._gltf.bufferViews,l.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${c.index}`,c),this.loadBufferViewAsync(`/bufferViews/${E.index}`,E)]).then((q=>{let[c,E]=q;const M=I._GetTypedArray(`${K}/sparse/indices`,l.indices.componentType,c,l.indices.byteOffset,l.count),t=f*l.count;let j;if(5126!==O.componentType||O.normalized){const q=I._GetTypedArray(`${K}/sparse/values`,O.componentType,E,l.values.byteOffset,t);j=new F(t),a.d.ForEach(q,0,r,f,O.componentType,j.length,O.normalized||!1,((K,O)=>{j[O]=K}))}else j=I._GetTypedArray(`${K}/sparse/values`,O.componentType,E,l.values.byteOffset,t);let X=0;for(let K=0;K<M.length;K++){let O=M[K]*f;for(let K=0;K<f;K++)J[O++]=j[X++]}return J}))}))}return O._data}_loadFloatAccessorAsync(K,O){return this._loadAccessorAsync(K,O,Float32Array)}_loadIndicesAccessorAsync(K,O){if("SCALAR"!==O.type)throw new Error(`${K}/type: Invalid value ${O.type}`);if(5121!==O.componentType&&5123!==O.componentType&&5125!==O.componentType)throw new Error(`${K}/componentType: Invalid value ${O.componentType}`);if(O._data)return O._data;if(O.sparse){const F=I._GetTypedArrayConstructor(`${K}/componentType`,O.componentType);O._data=this._loadAccessorAsync(K,O,F)}else{const F=n.Get(`${K}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((F=>I._GetTypedArray(K,O.componentType,F,O.byteOffset,O.count)))}return O._data}_loadVertexBufferViewAsync(K){if(K._babylonBuffer)return K._babylonBuffer;const O=this._babylonScene.getEngine();return K._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((K=>new a.b(O,K,!1))),K._babylonBuffer}_loadVertexAccessorAsync(K,O,F){var f;if(null!==(f=O._babylonVertexBuffer)&&void 0!==f&&f[F])return O._babylonVertexBuffer[F];O._babylonVertexBuffer||(O._babylonVertexBuffer={});const r=this._babylonScene.getEngine();if(O.sparse||void 0==O.bufferView)O._babylonVertexBuffer[F]=this._loadFloatAccessorAsync(K,O).then((K=>new a.d(r,K,F,!1)));else{const f=n.Get(`${K}/bufferView`,this._gltf.bufferViews,O.bufferView);O._babylonVertexBuffer[F]=this._loadVertexBufferViewAsync(f).then((l=>{const q=I._GetNumComponents(K,O.type);return new a.d(r,l,F,!1,void 0,f.byteStride,void 0,O.byteOffset,q,O.componentType,O.normalized,!0,void 0,!0)}))}return O._babylonVertexBuffer[F]}_loadMaterialMetallicRoughnessPropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;return O&&(O.baseColorFactor?(F.albedoColor=l.ZO.LO(O.baseColorFactor),F.alpha=O.baseColorFactor[3]):F.albedoColor=l.ZO.White(),F.metallic=void 0==O.metallicFactor?1:O.metallicFactor,F.roughness=void 0==O.roughnessFactor?1:O.roughnessFactor,O.baseColorTexture&&f.push(this.loadTextureInfoAsync(`${K}/baseColorTexture`,O.baseColorTexture,(K=>{K.name=`${F.name} (Base Color)`,F.albedoTexture=K}))),O.metallicRoughnessTexture&&(O.metallicRoughnessTexture.nonColorData=!0,f.push(this.loadTextureInfoAsync(`${K}/metallicRoughnessTexture`,O.metallicRoughnessTexture,(K=>{K.name=`${F.name} (Metallic Roughness)`,F.metallicTexture=K}))),F.useMetallnessFromMetallicTextureBlue=!0,F.useRoughnessFromMetallicTextureGreen=!0,F.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(f).then((()=>{}))}_loadMaterialAsync(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const l=this._extensionsLoadMaterialAsync(K,O,F,f,r);if(l)return l;O._data=O._data||{};let q=O._data[f];if(!q){this.logOpen(`${K} ${O.name||""}`);const F=this.createMaterial(K,O,f);q={babylonMaterial:F,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(K,O,F)},O._data[f]=q,I.AddPointerMetadata(F,K),this._parent.onMaterialLoadedObservable.notifyObservers(F),this.logClose()}return F&&(q.babylonMeshes.push(F),F.Wf.addOnce((()=>{const K=q.babylonMeshes.indexOf(F);-1!==K&&q.babylonMeshes.splice(K,1)}))),r(q.babylonMaterial),q.promise.then((()=>q.babylonMaterial))}_createDefaultMaterial(K,O){this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new Z.c(K,this._babylonScene);return F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.fillMode=O,F.enableSpecularAntiAliasing=!0,F.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,F.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,F.transparencyMode=Z.c.PBRMATERIAL_OPAQUE,F.metallic=1,F.roughness=1,F}createMaterial(K,O,F){const f=this._extensionsCreateMaterial(K,O,F);if(f)return f;const r=O.name||`material${O.index}`;return this._createDefaultMaterial(r,F)}loadMaterialPropertiesAsync(K,O,F){const f=this._extensionsLoadMaterialPropertiesAsync(K,O,F);if(f)return f;const r=new Array;return r.push(this.loadMaterialBasePropertiesAsync(K,O,F)),O.pbrMetallicRoughness&&r.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${K}/pbrMetallicRoughness`,O.pbrMetallicRoughness,F)),this.loadMaterialAlphaProperties(K,O,F),Promise.all(r).then((()=>{}))}loadMaterialBasePropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;return F.emissiveColor=O.emissiveFactor?l.ZO.LO(O.emissiveFactor):new l.ZO(0,0,0),O.doubleSided&&(F.qq=!1,F.twoSidedLighting=!0),O.normalTexture&&(O.normalTexture.nonColorData=!0,f.push(this.loadTextureInfoAsync(`${K}/normalTexture`,O.normalTexture,(K=>{K.name=`${F.name} (Normal)`,F.bumpTexture=K}))),F.invertNormalMapX=!this._babylonScene.useRightHandedSystem,F.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=O.normalTexture.scale&&F.bumpTexture&&(F.bumpTexture.level=O.normalTexture.scale),F.forceIrradianceInFragment=!0),O.occlusionTexture&&(O.occlusionTexture.nonColorData=!0,f.push(this.loadTextureInfoAsync(`${K}/occlusionTexture`,O.occlusionTexture,(K=>{K.name=`${F.name} (Occlusion)`,F.ambientTexture=K}))),F.useAmbientInGrayScale=!0,void 0!=O.occlusionTexture.strength&&(F.ambientTextureStrength=O.occlusionTexture.strength)),O.emissiveTexture&&f.push(this.loadTextureInfoAsync(`${K}/emissiveTexture`,O.emissiveTexture,(K=>{K.name=`${F.name} (Emissive)`,F.emissiveTexture=K}))),Promise.all(f).then((()=>{}))}loadMaterialAlphaProperties(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);switch(O.alphaMode||"OPAQUE"){case"OPAQUE":F.transparencyMode=Z.c.PBRMATERIAL_OPAQUE,F.alpha=1;break;case"MASK":F.transparencyMode=Z.c.PBRMATERIAL_ALPHATEST,F.alphaCutOff=void 0==O.alphaCutoff?.5:O.alphaCutoff,F.albedoTexture&&(F.albedoTexture.bf=!0);break;case"BLEND":F.transparencyMode=Z.c.PBRMATERIAL_ALPHABLEND,F.albedoTexture&&(F.albedoTexture.bf=!0,F.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${K}/alphaMode: Invalid value (${O.alphaMode})`)}}loadTextureInfoAsync(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadTextureInfoAsync(K,O,F);if(f)return f;if(this.logOpen(`${K}`),O.texCoord>=6)throw new Error(`${K}/texCoord: Invalid value (${O.texCoord})`);const r=n.Get(`${K}/index`,this._gltf.textures,O.index);r._textureInfo=O;const l=this._loadTextureAsync(`/textures/${O.index}`,r,(f=>{f.coordinatesIndex=O.texCoord||0,I.AddPointerMetadata(f,K),this._parent.onTextureLoadedObservable.notifyObservers(f),F(f)}));return this.logClose(),l}_loadTextureAsync(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadTextureAsync(K,O,F);if(f)return f;this.logOpen(`${K} ${O.name||""}`);const r=void 0==O.sampler?I.DefaultSampler:n.Get(`${K}/sampler`,this._gltf.samplers,O.sampler),l=n.Get(`${K}/source`,this._gltf.images,O.source),q=this._createTextureAsync(K,r,l,F,void 0,!O._textureInfo.nonColorData);return this.logClose(),q}_createTextureAsync(K,O,F){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},l=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0;const J=this._loadSampler(`/samplers/${O.index}`,O),c=new Array,E=new f;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M={noMipmap:J.noMipMaps,invertY:!1,samplingMode:J.samplingMode,U:()=>{this._disposed||E.resolve()},onError:(O,F)=>{this._disposed||E.reject(new Error(`${K}: ${F&&F.message?F.message:O||"Failed to load texture"}`))},mimeType:F.mimeType??(0,R.m)(F.uri??""),loaderOptions:l,useSRGBBuffer:!!q&&this._parent.useSRGBBuffers},t=new L.b(null,this._babylonScene,M);return t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.push(E.promise),c.push(this.loadImageAsync(`/images/${F.index}`,F).then((K=>{const O=F.uri||`${this._fileName}#image${F.index}`,f=`data:${this._uniqueRootUrl}${O}`;t.updateURL(f,K);const r=t.getInternalTexture();r&&(r.label=F.name)}))),t.wrapU=J.wrapU,t.wrapV=J.wrapV,r(t),this._parent.useGltfTextureNames&&(t.name=F.name||F.uri||`image${F.index}`),Promise.all(c).then((()=>t))}_loadSampler(K,O){return O._data||(O._data={noMipMaps:9728===O.minFilter||9729===O.minFilter,samplingMode:I._GetTextureSamplingMode(K,O),wrapU:I._GetTextureWrapMode(`${K}/wrapS`,O.wrapS),wrapV:I._GetTextureWrapMode(`${K}/wrapT`,O.wrapT)}),O._data}loadImageAsync(K,O){if(!O._data){if(this.logOpen(`${K} ${O.name||""}`),O.uri)O._data=this.loadUriAsync(`${K}/uri`,O,O.uri);else{const F=n.Get(`${K}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F)}this.logClose()}return O._data}loadUriAsync(K,O,F){const f=this._extensionsLoadUriAsync(K,O,F);if(f)return f;if(!I._ValidateUri(F))throw new Error(`${K}: '${F}' is invalid`);if((0,R.q)(F)){const O=new Uint8Array((0,R.e)(F));return this.log(`${K}: Decoded ${F.substring(0,64)}... (${O.length} bytes)`),Promise.resolve(O)}return this.log(`${K}: Loading ${F}`),this._parent.preprocessUrlAsync(this._rootUrl+F).then((O=>new Promise(((f,r)=>{this._parent._loadFile(this._babylonScene,O,(O=>{this._disposed||(this.log(`${K}: Loaded ${F} (${O.byteLength} bytes)`),f(new Uint8Array(O)))}),!0,(O=>{r(new R.s(`${K}: Failed to load '${F}'${O?": "+O.status+" "+O.statusText:""}`,O))}))}))))}static AddPointerMetadata(K,O){K.metadata=K.metadata||{};const F=K._internalMetadata=K._internalMetadata||{},f=F.zf=F.zf||{};(f.pointers=f.pointers||[]).push(O)}static _GetTextureWrapMode(K,O){switch(O=void 0==O?10497:O){case 33071:return L.b.CLAMP_ADDRESSMODE;case 33648:return L.b.MIRROR_ADDRESSMODE;case 10497:return L.b.WRAP_ADDRESSMODE;default:return T.c.Warn(`${K}: Invalid value (${O})`),L.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(K,O){const F=void 0==O.magFilter?9729:O.magFilter,f=void 0==O.minFilter?9987:O.minFilter;if(9729===F)switch(f){case 9728:return L.b.LINEAR_NEAREST;case 9729:return L.b.LINEAR_LINEAR;case 9984:return L.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return L.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return L.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return L.b.LINEAR_LINEAR_MIPLINEAR;default:return T.c.Warn(`${K}/minFilter: Invalid value (${f})`),L.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==F&&T.c.Warn(`${K}/magFilter: Invalid value (${F})`),f){case 9728:return L.b.NEAREST_NEAREST;case 9729:return L.b.NEAREST_LINEAR;case 9984:return L.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return L.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return L.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return L.b.NEAREST_LINEAR_MIPLINEAR;default:return T.c.Warn(`${K}/minFilter: Invalid value (${f})`),L.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(K,O){try{return(0,B.s)(O)}catch(F){throw new Error(`${K}: ${F.message}`)}}static _GetTypedArray(K,O,F,f,r){const l=F.buffer;f=F.byteOffset+(f||0);const q=I._GetTypedArrayConstructor(`${K}/componentType`,O),J=a.d.GetTypeByteLength(O);return f%J!==0?(T.c.Warn(`${K}: Copying buffer as byte offset (${f}) is not a multiple of component type byte length (${J})`),new q(l.slice(f,f+r*J),0)):new q(l,f,r)}static _GetNumComponents(K,O){switch(O){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${K}: Invalid type (${O})`)}static _ValidateUri(K){return q.Tools.IsBase64(K)||-1===K.indexOf("..")}static _GetDrawMode(K,O){switch(void 0==O&&(O=4),O){case 0:return N.e.PointListDrawMode;case 1:return N.e.LineListDrawMode;case 2:return N.e.LineLoopDrawMode;case 3:return N.e.LineStripDrawMode;case 4:return N.e.TriangleFillMode;case 5:return N.e.TriangleStripDrawMode;case 6:return N.e.TriangleFanDrawMode}throw new Error(`${K}: Invalid mesh primitive mode (${O})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const K=new Array;if(this._gltf.materials)for(const O of this._gltf.materials)if(O._data)for(const F in O._data){const f=O._data[F];for(const O of f.babylonMeshes){O.Pf(!0);const F=f.babylonMaterial;K.push(F.forceCompilationAsync(O)),K.push(F.forceCompilationAsync(O,{useInstances:!0})),this._parent.useClipPlane&&(K.push(F.forceCompilationAsync(O,{clipPlane:!0})),K.push(F.forceCompilationAsync(O,{clipPlane:!0,useInstances:!0})))}}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const K=new Array,O=this._babylonScene.lights;for(const F of O){const O=F.getShadowGenerator();O&&K.push(O.forceCompilationAsync())}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(K){for(const O of this._extensions)O.enabled&&K(O)}_applyExtensions(K,O,F){for(const f of this._extensions)if(f.enabled){const r=`${f.name}.${O}`,l=K;l._activeLoaderExtensionFunctions=l._activeLoaderExtensionFunctions||{};const q=l._activeLoaderExtensionFunctions;if(!q[r]){q[r]=!0;try{const K=F(f);if(K)return K}finally{delete q[r]}}}return null}_extensionsOnLoading(){this._forEachExtensions((K=>K.onLoading&&K.onLoading()))}_extensionsOnReady(){this._forEachExtensions((K=>K.onReady&&K.onReady()))}_extensionsLoadSceneAsync(K,O){return this._applyExtensions(O,"loadScene",(F=>F.loadSceneAsync&&F.loadSceneAsync(K,O)))}_extensionsLoadNodeAsync(K,O,F){return this._applyExtensions(O,"loadNode",(f=>f.loadNodeAsync&&f.loadNodeAsync(K,O,F)))}_extensionsLoadCameraAsync(K,O,F){return this._applyExtensions(O,"loadCamera",(f=>f.loadCameraAsync&&f.loadCameraAsync(K,O,F)))}_extensionsLoadVertexDataAsync(K,O,F){return this._applyExtensions(O,"loadVertexData",(f=>f._loadVertexDataAsync&&f._loadVertexDataAsync(K,O,F)))}_extensionsLoadMeshPrimitiveAsync(K,O,F,f,r,l){return this._applyExtensions(r,"loadMeshPrimitive",(q=>q._loadMeshPrimitiveAsync&&q._loadMeshPrimitiveAsync(K,O,F,f,r,l)))}_extensionsLoadMaterialAsync(K,O,F,f,r){return this._applyExtensions(O,"loadMaterial",(l=>l._loadMaterialAsync&&l._loadMaterialAsync(K,O,F,f,r)))}_extensionsCreateMaterial(K,O,F){return this._applyExtensions(O,"createMaterial",(f=>f.createMaterial&&f.createMaterial(K,O,F)))}_extensionsLoadMaterialPropertiesAsync(K,O,F){return this._applyExtensions(O,"loadMaterialProperties",(f=>f.loadMaterialPropertiesAsync&&f.loadMaterialPropertiesAsync(K,O,F)))}_extensionsLoadTextureInfoAsync(K,O,F){return this._applyExtensions(O,"loadTextureInfo",(f=>f.loadTextureInfoAsync&&f.loadTextureInfoAsync(K,O,F)))}_extensionsLoadTextureAsync(K,O,F){return this._applyExtensions(O,"loadTexture",(f=>f._loadTextureAsync&&f._loadTextureAsync(K,O,F)))}_extensionsLoadAnimationAsync(K,O){return this._applyExtensions(O,"loadAnimation",(F=>F.loadAnimationAsync&&F.loadAnimationAsync(K,O)))}_extensionsLoadAnimationChannelAsync(K,O,F,f,r){return this._applyExtensions(F,"loadAnimationChannel",(l=>l._loadAnimationChannelAsync&&l._loadAnimationChannelAsync(K,O,F,f,r)))}_extensionsLoadSkinAsync(K,O,F){return this._applyExtensions(F,"loadSkin",(f=>f._loadSkinAsync&&f._loadSkinAsync(K,O,F)))}_extensionsLoadUriAsync(K,O,F){return this._applyExtensions(O,"loadUri",(f=>f._loadUriAsync&&f._loadUriAsync(K,O,F)))}_extensionsLoadBufferViewAsync(K,O){return this._applyExtensions(O,"loadBufferView",(F=>F.loadBufferViewAsync&&F.loadBufferViewAsync(K,O)))}_extensionsLoadBufferAsync(K,O,F,f){return this._applyExtensions(O,"loadBuffer",(r=>r.loadBufferAsync&&r.loadBufferAsync(K,O,F,f)))}static LoadExtensionAsync(K,O,F,f){if(!O.extensions)return null;const r=O.extensions[F];return r?f(`${K}/extensions/${F}`,r):null}static LoadExtraAsync(K,O,F,f){if(!O.extras)return null;const r=O.extras[F];return r?f(`${K}/extras/${F}`,r):null}isExtensionUsed(K){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(K)}logOpen(K){this._parent._logOpen(K)}logClose(){this._parent._logClose()}log(K){this._parent._log(K)}startPerformanceCounter(K){this._parent._startPerformanceCounter(K)}endPerformanceCounter(K){this._parent._endPerformanceCounter(K)}}I.DefaultSampler={index:-1},Q.d._CreateGLTF2Loader=K=>new I(K);var D=F(13398),h=F(11924),b=F(11753),i=F(13401),w=F(13408);class s extends w.d{constructor(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",K),this._texture=K.getEngine().createRawCubeTexture(O,F,f,r,l,q,J,c)}update(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,K,O,F,f,r)}updateRGBDAsync(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,i.k)(this._texture,K,O,F,f).then((()=>{}))}clone(){return b.e.Clone((()=>{const K=this.HK(),O=this._texture,F=new s(K,O._bufferViewArray,O.width,O.format,O.type,O.generateMipMaps,O.invertY,O.samplingMode,O._compression);return 13===O.source&&F.updateRGBDAsync(O._bufferViewArrayArray,O._sphericalPolynomial,O._lodGenerationScale,O._lodGenerationOffset),F}),this)}}const U="EXT_lights_image_based";class P{constructor(K){this.name=U,this._loader=K,this.enabled=this._loader.isExtensionUsed(U)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.zf.extensions;if(K&&K[this.name]){const O=K[this.name];this._lights=O.lights}}loadSceneAsync(K,O){return I.LoadExtensionAsync(K,O,this.name,(async(F,f)=>{this._loader._allMaterialsDirtyRequired=!0;const r=new Array;r.push(this._loader.loadSceneAsync(K,O)),this._loader.logOpen(`${F}`);const l=n.Get(`${F}/light`,this._lights,f.Lf);return r.push(this._loadLightAsync(`/extensions/${this.name}/lights/${f.Lf}`,l).then((K=>{this._loader.babylonScene.environmentTexture=K}))),this._loader.logClose(),await Promise.all(r).then((()=>{}))}))}_loadLightAsync(K,O){if(!O._loaded){const F=new Array;this._loader.logOpen(`${K}`);const f=new Array(O.specularImages.length);for(let r=0;r<O.specularImages.length;r++){const l=O.specularImages[r];f[r]=new Array(l.length);for(let O=0;O<l.length;O++){const q=`${K}/specularImages/${r}/${O}`;this._loader.logOpen(`${q}`);const J=l[O],c=n.Get(q,this._loader.zf.images,J);F.push(this._loader.loadImageAsync(`/images/${J}`,c).then((K=>{f[r][O]=K}))),this._loader.logClose()}}this._loader.logClose(),O._loaded=Promise.all(F).then((async()=>{const F=new s(this._loader.babylonScene,null,O.specularImageSize);if(F.name=O.name||"environment",O._babylonTexture=F,void 0!=O.LJ&&(F.level=O.LJ),O.rotation){let K=r.Quaternion.LO(O.rotation);this._loader.babylonScene.useRightHandedSystem||(K=r.Quaternion.Inverse(K)),r.Matrix.FromQuaternionToRef(K,F.getReflectionTextureMatrix())}if(!O.irradianceCoefficients)throw new Error(`${K}: Irradiance coefficients are missing`);const l=h.b.LO(O.irradianceCoefficients);l.scaleInPlace(O.LJ),l.convertIrradianceToLambertianRadiance();const q=h.e.FromHarmonics(l),J=(f.length-1)/Math.log2(O.specularImageSize);return await F.updateRGBDAsync(f,q,J)}))}return O._loaded.then((()=>O._babylonTexture))}}V(U),x(U,!0,(K=>new P(K)));F(12301);const S="EXT_mesh_gpu_instancing";class KK{constructor(K){this.name=S,this._loader=K,this.enabled=this._loader.isExtensionUsed(S)}dispose(){this._loader=null}loadNodeAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(K,f)=>{this._loader._disableInstancedMesh++;const l=this._loader.loadNodeAsync(`/nodes/${O.index}`,O,F);if(this._loader._disableInstancedMesh--,!O._primitiveBabylonMeshes)return await l;const q=new Array;let J=0;const c=O=>{if(void 0==f.attributes[O])return void q.push(Promise.resolve(null));const F=n.Get(`${K}/attributes/${O}`,this._loader.zf.accessors,f.attributes[O]);if(q.push(this._loader._loadFloatAccessorAsync(`/accessors/${F.bufferView}`,F)),0===J)J=F.count;else if(J!==F.count)throw new Error(`${K}/attributes: Instance buffer accessors do not have the same count.`)};return c("TRANSLATION"),c("ROTATION"),c("SCALE"),await l.then((async K=>{const[F,f,l]=await Promise.all(q),c=new Float32Array(16*J);r.TmpVectors.TO[0].eq(0,0,0),r.TmpVectors.Quaternion[0].eq(0,0,0,1),r.TmpVectors.TO[1].eq(1,1,1);for(let O=0;O<J;++O)F&&r.TO.FromArrayToRef(F,3*O,r.TmpVectors.TO[0]),f&&r.Quaternion.FromArrayToRef(f,4*O,r.TmpVectors.Quaternion[0]),l&&r.TO.FromArrayToRef(l,3*O,r.TmpVectors.TO[1]),r.Matrix.ComposeToRef(r.TmpVectors.TO[1],r.TmpVectors.Quaternion[0],r.TmpVectors.TO[0],r.TmpVectors.Matrix[0]),r.TmpVectors.Matrix[0].copyToArray(c,16*O);for(const r of O._primitiveBabylonMeshes)r.wt("matrix",c,16,!0);return K}))}))}}V(S),x(S,!0,(K=>new KK(K)));let OK=0,FK=null;class fK{static get Default(){return fK._Default||(fK._Default=new fK),fK._Default}constructor(){const K=fK.Configuration.decoder;this._decoderModulePromise=q.Tools.LoadBabylonScriptAsync(K.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(K,O,F,f,r){await this._decoderModulePromise,0===OK&&(MeshoptDecoder.useWorkers(1),OK=1);const l=await MeshoptDecoder.decodeGltfBufferAsync(O,F,K,f,r);return null!==FK&&clearTimeout(FK),FK=setTimeout((()=>{MeshoptDecoder.useWorkers(0),OK=0,FK=null}),1e3),l}}fK.Configuration={decoder:{url:`${q.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},fK._Default=null;const rK="EXT_meshopt_compression";class lK{constructor(K){this.name=rK,this.enabled=K.isExtensionUsed(rK),this._loader=K}dispose(){this._loader=null}loadBufferViewAsync(K,O){return I.LoadExtensionAsync(K,O,this.name,(async(F,f)=>{const r=O;if(r._meshOptData)return await r._meshOptData;const l=n.Get(`${K}/buffer`,this._loader.zf.buffers,f.buffer);return r._meshOptData=this._loader.loadBufferAsync(`/buffers/${l.index}`,l,f.byteOffset||0,f.byteLength).then((async K=>await fK.Default.decodeGltfBufferAsync(K,f.count,f.byteStride,f.mode,f.filter))),await r._meshOptData}))}}V(rK),x(rK,!0,(K=>new lK(K)));const qK="EXT_texture_webp";class JK{constructor(K){this.name=qK,this._loader=K,this.enabled=K.isExtensionUsed(qK)}dispose(){this._loader=null}_loadTextureAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=void 0==O.sampler?I.DefaultSampler:n.Get(`${K}/sampler`,this._loader.zf.samplers,O.sampler),q=n.Get(`${f}/source`,this._loader.zf.images,r.source);return await this._loader._createTextureAsync(K,l,q,(K=>{F(K)}),void 0,!O._textureInfo.nonColorData)}))}}V(qK),x(qK,!0,(K=>new JK(K)));const cK="EXT_texture_avif";class EK{constructor(K){this.name=cK,this._loader=K,this.enabled=K.isExtensionUsed(cK)}dispose(){this._loader=null}_loadTextureAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=void 0==O.sampler?I.DefaultSampler:n.Get(`${K}/sampler`,this._loader.zf.samplers,O.sampler),q=n.Get(`${f}/source`,this._loader.zf.images,r.source);return await this._loader._createTextureAsync(K,l,q,(K=>{F(K)}),void 0,!O._textureInfo.nonColorData)}))}}V(cK),x(cK,!0,(K=>new EK(K)));var MK=F(13391),tK=F(12281);const jK="EXT_lights_ies";class XK{constructor(K){this.name=jK,this._loader=K,this.enabled=this._loader.isExtensionUsed(jK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.zf.extensions;if(K&&K[this.name]){const O=K[this.name];this._lights=O.lights,n.Assign(this._lights)}}loadNodeAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,q)=>{let J,c;this._loader._allMaterialsDirtyRequired=!0;const E=await this._loader.loadNodeAsync(K,O,(K=>{c=n.Get(f,this._lights,q.Lf);const O=c.name||K.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,J=new MK.c(O,r.TO.Zero(),r.TO.Backward(),0,1,this._loader.babylonScene),J.angle=Math.PI/2,J.innerAngle=0,J._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,c._babylonLight=J,J.falloffType=tK.d.FALLOFF_GLTF,J.dJ=q.color?l.ZO.LO(q.color):l.ZO.White(),J.LJ=q.multiplier||1,J.range=Number.MAX_VALUE,J.parent=K,this._loader._babylonLights.push(J),I.AddPointerMetadata(J,f),F(K)}));let M;if(c.uri)M=await this._loader.loadUriAsync(K,c,c.uri);else{const O=n.Get(`${K}/bufferView`,this._loader.zf.bufferViews,c.bufferView);M=await this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O)}return J.iesProfileTexture=new L.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,M,!0,void 0,void 0,void 0,void 0,".ies"),E}))}}V(jK),x(jK,!0,(K=>new XK(K)));var uK=F(13417);const TK="KHR_draco_mesh_compression";class oK{constructor(K){this.name=TK,this.useNormalizedFlagFromAccessor=!0,this._loader=K,this.enabled=uK.b.DefaultAvailable&&this._loader.isExtensionUsed(TK)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{if(void 0!=O.mode&&4!==O.mode&&5!==O.mode)throw new Error(`${K}: Unsupported mode ${O.mode}`);const l={},q={},J=(K,f)=>{const J=r.attributes[K];if(void 0!=J&&(F._delayInfo=F._delayInfo||[],-1===F._delayInfo.indexOf(f)&&F._delayInfo.push(f),l[f]=J,this.useNormalizedFlagFromAccessor)){const F=n.TryGet(this._loader.zf.accessors,O.attributes[K]);F&&(q[f]=F.normalized||!1)}};J("POSITION",a.d.PositionKind),J("NORMAL",a.d.NormalKind),J("TANGENT",a.d.TangentKind),J("TEXCOORD_0",a.d.UVKind),J("TEXCOORD_1",a.d.UV2Kind),J("TEXCOORD_2",a.d.UV3Kind),J("TEXCOORD_3",a.d.UV4Kind),J("TEXCOORD_4",a.d.UV5Kind),J("TEXCOORD_5",a.d.UV6Kind),J("JOINTS_0",a.d.MatricesIndicesKind),J("WEIGHTS_0",a.d.MatricesWeightsKind),J("COLOR_0",a.d.ColorKind);const c=n.Get(f,this._loader.zf.bufferViews,r.bufferView);return c._dracoBabylonGeometry||(c._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c).then((async f=>{const r=this.dracoDecoder||uK.b.Default,J=n.TryGet(this._loader.zf.accessors,O.attributes.POSITION),c=this._loader.parent.alwaysComputeBoundingBox||F.skeleton||!J?null:C(J);return await r._decodeMeshToGeometryForGltfAsync(F.name,this._loader.babylonScene,f,l,q,c).catch((O=>{throw new Error(`${K}: ${O.message}`)}))}))),await c._dracoBabylonGeometry}))}}V(TK),x(TK,!0,(K=>new oK(K)));var kK=F(13421),NK=F(11693),ZK=F(11698),LK=F(12157),dK=F(12341),aK=F(11661);LK.c.AddNodeConstructor("Light_Type_0",((K,O)=>()=>new gK(K,r.TO.Zero(),O)));class gK extends dK.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(K){this._shadowAngle=K,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(K){const O=this.needCube();if(this._direction=K,this.needCube()!==O&&this._shadowGenerators){const K=this._shadowGenerators.values();for(let O=K.next();!0!==O.done;O=K.next()){O.value.recreateShadowMap()}}}constructor(K,O,F){super(K,F),this._shadowAngle=Math.PI/2,this.position=O}getClassName(){return"PointLight"}getTypeID(){return tK.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(K){if(this.direction)return super.getShadowDirection(K);switch(K){case 0:return new r.TO(1,0,0);case 1:return new r.TO(-1,0,0);case 2:return new r.TO(0,-1,0);case 3:return new r.TO(0,1,0);case 4:return new r.TO(0,0,1);case 5:return new r.TO(0,0,-1)}return r.TO.Zero()}_setDefaultShadowProjectionMatrix(K,O,F){const f=this.HK().activeCamera;if(!f)return;const l=void 0!==this.shadowMinZ?this.shadowMinZ:f.if,q=void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,J=this.HK().getEngine().useReverseDepthBuffer;r.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,J?q:l,J?l:q,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,J)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,O){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,O):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,O),this}transferToNodeMaterialEffect(K,O){return this.computeTransformedInformation()?K.setFloat3(O,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):K.setFloat3(O,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(K,O){K["POINTLIGHT"+O]=!0}}(0,NK.c)([(0,ZK.N)()],gK.prototype,"shadowAngle",null),(0,aK.g)("BABYLON.PointLight",gK);const HK="KHR_lights_punctual";class eK{constructor(K){this.name=HK,this._loader=K,this.enabled=this._loader.isExtensionUsed(HK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.zf.extensions;if(K&&K[this.name]){const O=K[this.name];this._lights=O.lights,n.Assign(this._lights)}}loadNodeAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,q)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(K,O,(K=>{let O;const J=n.Get(f,this._lights,q.Lf),c=J.name||K.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,J.type){case"directional":{const K=new kK.d(c,r.TO.Backward(),this._loader.babylonScene);K.position.oJ(0),O=K;break}case"point":O=new gK(c,r.TO.Zero(),this._loader.babylonScene);break;case"spot":{const K=new MK.c(c,r.TO.Zero(),r.TO.Backward(),0,1,this._loader.babylonScene);K.angle=2*(J.spot&&J.spot.outerConeAngle||Math.PI/4),K.innerAngle=2*(J.spot&&J.spot.innerConeAngle||0),O=K;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${f}: Invalid light type (${J.type})`)}O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,J._babylonLight=O,O.falloffType=tK.d.FALLOFF_GLTF,O.dJ=J.color?l.ZO.LO(J.color):l.ZO.White(),O.LJ=void 0==J.LJ?1:J.LJ,O.range=void 0==J.range?Number.MAX_VALUE:J.range,O.parent=K,this._loader._babylonLights.push(O),I.AddPointerMetadata(O,f),F(K)})))))}}V(HK),x(HK,!0,(K=>new eK(K)));const WK="KHR_materials_pbrSpecularGlossiness";class pK{constructor(K){this.name=WK,this.order=200,this._loader=K,this.enabled=this._loader.isExtensionUsed(WK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;return l.push(this._loader.loadMaterialBasePropertiesAsync(K,O,F)),l.push(this._loadSpecularGlossinessPropertiesAsync(f,r,F)),this._loader.loadMaterialAlphaProperties(K,O,F),await Promise.all(l).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;return F.metallic=null,F.roughness=null,O.diffuseFactor?(F.albedoColor=l.ZO.LO(O.diffuseFactor),F.alpha=O.diffuseFactor[3]):F.albedoColor=l.ZO.White(),F.reflectivityColor=O.specularFactor?l.ZO.LO(O.specularFactor):l.ZO.White(),F.microSurface=void 0==O.glossinessFactor?1:O.glossinessFactor,O.diffuseTexture&&f.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTexture`,O.diffuseTexture,(K=>{K.name=`${F.name} (Diffuse)`,F.albedoTexture=K}))),O.specularGlossinessTexture&&(f.push(this._loader.loadTextureInfoAsync(`${K}/specularGlossinessTexture`,O.specularGlossinessTexture,(K=>{K.name=`${F.name} (Specular Glossiness)`,F.reflectivityTexture=K,F.reflectivityTexture.bf=!0}))),F.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(f).then((()=>{}))}}V(WK),x(WK,!0,(K=>new pK(K)));const yK="KHR_materials_unlit";class AK{constructor(K){this.name=yK,this.order=210,this._loader=K,this.enabled=this._loader.isExtensionUsed(yK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async()=>await this._loadUnlitPropertiesAsync(K,O,F)))}_loadUnlitPropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;F.unlit=!0;const r=O.pbrMetallicRoughness;return r&&(r.baseColorFactor?(F.albedoColor=l.ZO.LO(r.baseColorFactor),F.alpha=r.baseColorFactor[3]):F.albedoColor=l.ZO.White(),r.baseColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${K}/baseColorTexture`,r.baseColorTexture,(K=>{K.name=`${F.name} (Base Color)`,F.albedoTexture=K})))),O.doubleSided&&(F.qq=!1,F.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(K,O,F),Promise.all(f).then((()=>{}))}}V(yK),x(yK,!0,(K=>new AK(K)));const QK="KHR_materials_clearcoat";class RK{constructor(K){this.name=QK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(QK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadClearCoatPropertiesAsync(f,r,F)),await Promise.all(l)}))}_loadClearCoatPropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;return F.clearCoat.isEnabled=!0,F.clearCoat.useRoughnessFromMainTexture=!1,F.clearCoat.remapF0OnInterfaceChange=!1,void 0!=O.clearcoatFactor?F.clearCoat.LJ=O.clearcoatFactor:F.clearCoat.LJ=0,O.clearcoatTexture&&f.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatTexture`,O.clearcoatTexture,(K=>{K.name=`${F.name} (ClearCoat)`,F.clearCoat.texture=K}))),void 0!=O.clearcoatRoughnessFactor?F.clearCoat.roughness=O.clearcoatRoughnessFactor:F.clearCoat.roughness=0,O.clearcoatRoughnessTexture&&(O.clearcoatRoughnessTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatRoughnessTexture`,O.clearcoatRoughnessTexture,(K=>{K.name=`${F.name} (ClearCoat Roughness)`,F.clearCoat.textureRoughness=K})))),O.clearcoatNormalTexture&&(O.clearcoatNormalTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatNormalTexture`,O.clearcoatNormalTexture,(K=>{K.name=`${F.name} (ClearCoat Normal)`,F.clearCoat.bumpTexture=K}))),F.invertNormalMapX=!F.HK().useRightHandedSystem,F.invertNormalMapY=F.HK().useRightHandedSystem,void 0!=O.clearcoatNormalTexture.scale&&(F.clearCoat.bumpTexture.level=O.clearcoatNormalTexture.scale)),Promise.all(f).then((()=>{}))}}V(QK),x(QK,!0,(K=>new RK(K)));const GK="KHR_materials_iridescence";class zK{constructor(K){this.name=GK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(GK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadIridescencePropertiesAsync(f,r,F)),await Promise.all(l).then((()=>{}))}))}_loadIridescencePropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;return F.iridescence.isEnabled=!0,F.iridescence.LJ=O.iridescenceFactor??0,F.iridescence.indexOfRefraction=O.iridescenceIor??O.iridescenceIOR??1.3,F.iridescence.minimumThickness=O.iridescenceThicknessMinimum??100,F.iridescence.maximumThickness=O.iridescenceThicknessMaximum??400,O.iridescenceTexture&&f.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceTexture`,O.iridescenceTexture,(K=>{K.name=`${F.name} (Iridescence)`,F.iridescence.texture=K}))),O.iridescenceThicknessTexture&&f.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceThicknessTexture`,O.iridescenceThicknessTexture,(K=>{K.name=`${F.name} (Iridescence Thickness)`,F.iridescence.thicknessTexture=K}))),Promise.all(f).then((()=>{}))}}V(GK),x(GK,!0,(K=>new zK(K)));const mK="KHR_materials_anisotropy";class xK{constructor(K){this.name=mK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(mK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadIridescencePropertiesAsync(f,r,F)),await Promise.all(l)}))}async _loadIridescencePropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;F.anisotropy.isEnabled=!0,F.anisotropy.LJ=O.anisotropyStrength??0,F.anisotropy.angle=O.anisotropyRotation??0,O.anisotropyTexture&&(O.anisotropyTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${K}/anisotropyTexture`,O.anisotropyTexture,(K=>{K.name=`${F.name} (Anisotropy Intensity)`,F.anisotropy.texture=K})))),await Promise.all(f)}}V(mK),x(mK,!0,(K=>new xK(K)));const VK="KHR_materials_emissive_strength";class vK{constructor(K){this.name=VK,this.order=170,this._loader=K,this.enabled=this._loader.isExtensionUsed(VK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>await this._loader.loadMaterialPropertiesAsync(K,O,F).then((()=>{this._loadEmissiveProperties(f,r,F)}))))}_loadEmissiveProperties(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);void 0!==O.emissiveStrength&&(F.emissiveIntensity=O.emissiveStrength)}}V(VK),x(VK,!0,(K=>new vK(K)));const YK="KHR_materials_sheen";class BK{constructor(K){this.name=YK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(YK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadSheenPropertiesAsync(f,r,F)),await Promise.all(l).then((()=>{}))}))}_loadSheenPropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;return F.sheen.isEnabled=!0,F.sheen.LJ=1,void 0!=O.sheenColorFactor?F.sheen.color=l.ZO.LO(O.sheenColorFactor):F.sheen.color=l.ZO.Black(),O.sheenColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${K}/sheenColorTexture`,O.sheenColorTexture,(K=>{K.name=`${F.name} (Sheen Color)`,F.sheen.texture=K}))),void 0!==O.sheenRoughnessFactor?F.sheen.roughness=O.sheenRoughnessFactor:F.sheen.roughness=0,O.sheenRoughnessTexture&&(O.sheenRoughnessTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${K}/sheenRoughnessTexture`,O.sheenRoughnessTexture,(K=>{K.name=`${F.name} (Sheen Roughness)`,F.sheen.textureRoughness=K})))),F.sheen.albedoScaling=!0,F.sheen.useRoughnessFromMainTexture=!1,Promise.all(f).then((()=>{}))}}V(YK),x(YK,!0,(K=>new BK(K)));var nK=F(12228);const CK="KHR_materials_specular";class IK{constructor(K){this.name=CK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(CK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;if(l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadSpecularPropertiesAsync(f,r,F)),r.extensions&&r.extensions.EXT_materials_specular_edge_color&&F instanceof Z.c){r.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(F.brdf.dielectricSpecularModel=nK.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,F.brdf.conductorSpecularModel=nK.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(l).then((()=>{}))}))}_loadSpecularPropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;return void 0!==O.specularFactor&&(F.metallicF0Factor=O.specularFactor),void 0!==O.specularColorFactor&&(F.metallicReflectanceColor=l.ZO.LO(O.specularColorFactor)),O.specularTexture&&(O.specularTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${K}/specularTexture`,O.specularTexture,(K=>{K.name=`${F.name} (Specular)`,F.metallicReflectanceTexture=K,F.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),O.specularColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${K}/specularColorTexture`,O.specularColorTexture,(K=>{K.name=`${F.name} (Specular Color)`,F.reflectanceTexture=K}))),Promise.all(f).then((()=>{}))}}V(CK),x(CK,!0,(K=>new IK(K)));const DK="KHR_materials_ior";class hK{constructor(K){this.name=DK,this.order=180,this._loader=K,this.enabled=this._loader.isExtensionUsed(DK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadIorPropertiesAsync(f,r,F)),await Promise.all(l).then((()=>{}))}))}_loadIorPropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);return void 0!==O.ior?F.indexOfRefraction=O.ior:F.indexOfRefraction=hK._DEFAULT_IOR,Promise.resolve()}}hK._DEFAULT_IOR=1.5,V(DK),x(DK,!0,(K=>new hK(K)));const bK="KHR_materials_variants";class iK{constructor(K){this.name=bK,this._loader=K,this.enabled=this._loader.isExtensionUsed(bK)}dispose(){this._loader=null}static GetAvailableVariants(K){const O=this._GetExtensionMetadata(K);return O?Object.keys(O.variants):[]}getAvailableVariants(K){return iK.GetAvailableVariants(K)}static SelectVariant(K,O){const F=this._GetExtensionMetadata(K);if(!F)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${bK} extension`);const f=K=>{const O=F.variants[K];if(O)for(const F of O)F.mesh.material=F.material};if(O instanceof Array)for(const r of O)f(r);else f(O);F.lastSelected=O}selectVariant(K,O){iK.SelectVariant(K,O)}static Reset(K){const O=this._GetExtensionMetadata(K);if(!O)throw new Error(`Cannot reset on a glTF mesh that does not have the ${bK} extension`);for(const F of O.original)F.mesh.material=F.material;O.lastSelected=null}reset(K){iK.Reset(K)}static GetLastSelectedVariant(K){const O=this._GetExtensionMetadata(K);if(!O)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${bK} extension`);return O.lastSelected}getLastSelectedVariant(K){return iK.GetLastSelectedVariant(K)}static _GetExtensionMetadata(K){var O,F;return(null===K||void 0===K||null===(O=K._internalMetadata)||void 0===O||null===(F=O.zf)||void 0===F?void 0:F[bK])||null}onLoading(){const K=this._loader.zf.extensions;if(K&&K[this.name]){const O=K[this.name];this._variants=O.variants}}onReady(){const K=this._loader.rootBabylonMesh;if(K){var O;const F=this._loader.parent.extensionOptions[bK];null!==F&&void 0!==F&&F.defaultVariant&&iK.SelectVariant(K,F.defaultVariant),null===F||void 0===F||null===(O=F.onLoaded)||void 0===O||O.call(F,{get variants(){return iK.GetAvailableVariants(K)},get selectedVariant(){const O=iK.GetLastSelectedVariant(K);return O?Array.isArray(O)?O[0]:O:iK.GetAvailableVariants(K)[0]},set selectedVariant(O){iK.SelectVariant(K,O)}})}}_loadMeshPrimitiveAsync(K,O,F,f,r,l){return I.LoadExtensionAsync(K,r,this.name,(async(q,J)=>{const c=new Array;return c.push(this._loader._loadMeshPrimitiveAsync(K,O,F,f,r,(O=>{if(l(O),O instanceof e.b){const F=I._GetDrawMode(K,r.mode),f=this._loader.rootBabylonMesh,l=f?f._internalMetadata=f._internalMetadata||{}:{},E=l.zf=l.zf||{},M=E[bK]=E[bK]||{lastSelected:null,original:[],variants:{}};M.original.push({mesh:O,material:O.material});for(let K=0;K<J.mappings.length;++K){const r=J.mappings[K],l=n.Get(`${q}/mappings/${K}/material`,this._loader.zf.materials,r.material);c.push(this._loader._loadMaterialAsync(`#/materials/${r.material}`,l,O,F,(K=>{for(let F=0;F<r.variants.length;++F){const l=r.variants[F],q=n.Get(`/extensions/${bK}/variants/${l}`,this._variants,l);M.variants[q.name]=M.variants[q.name]||[],M.variants[q.name].push({mesh:O,material:K}),O.onClonedObservable.add((K=>{const F=K;let r=null,l=F;do{if(l=l.parent,!l)return;r=iK._GetExtensionMetadata(l)}while(null===r);if(f&&r===iK._GetExtensionMetadata(f)){l._internalMetadata={};for(const K in f._internalMetadata)l._internalMetadata[K]=f._internalMetadata[K];l._internalMetadata.zf=[];for(const K in f._internalMetadata.zf)l._internalMetadata.zf[K]=f._internalMetadata.zf[K];l._internalMetadata.zf[bK]={lastSelected:null,original:[],variants:{}};for(const K of r.original)l._internalMetadata.zf[bK].original.push({mesh:K.mesh,material:K.material});for(const K in r.variants)if(Object.prototype.hasOwnProperty.call(r.variants,K)){l._internalMetadata.zf[bK].variants[K]=[];for(const O of r.variants[K])l._internalMetadata.zf[bK].variants[K].push({mesh:O.mesh,material:O.material})}r=l._internalMetadata.zf[bK]}for(const f of r.original)f.mesh===O&&(f.mesh=F);for(const f of r.variants[q.name])f.mesh===O&&(f.mesh=F)}))}})))}}}))),await Promise.all(c).then((K=>{let[O]=K;return O}))}))}}V(bK),x(bK,!0,(K=>new iK(K)));var wK=F(11781);class sK{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:nK.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(K,O){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...sK._GetDefaultOptions(),...K},this._scene=O,this._scene._transmissionHelper=this,this.onErrorObservable=new M.c,this._scene.Wf.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(K){if(!Object.keys(K).filter((O=>this._options[O]!==K[O])).length)return;const O={...this._options,...K},F=this._options;this._options=O,O.renderSize===F.renderSize&&O.renderTargetTextureType===F.renderTargetTextureType&&O.generateMipmaps===F.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=O.samples,this._opaqueRenderTarget.lodGenerationScale=O.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=O.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(K){return!!K&&!!(K instanceof Z.c&&K.subSurface.isRefractionEnabled)}_addMesh(K){this._materialObservers[K.uniqueId]=K.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),q.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(K.material)?(K.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(K)&&this._transparentMeshesCache.push(K)):-1===this._opaqueMeshesCache.indexOf(K)&&this._opaqueMeshesCache.push(K)}))}_removeMesh(K){K.onMaterialChangedObservable.remove(this._materialObservers[K.uniqueId]),delete this._materialObservers[K.uniqueId];let O=this._transparentMeshesCache.indexOf(K);-1!==O&&this._transparentMeshesCache.splice(O,1),O=this._opaqueMeshesCache.indexOf(K),-1!==O&&this._opaqueMeshesCache.splice(O,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(K){const O=this._transparentMeshesCache.indexOf(K),F=this._opaqueMeshesCache.indexOf(K);this._shouldRenderAsTransmission(K.material)?(K.material instanceof Z.c&&(K.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==F?(this._opaqueMeshesCache.splice(F,1),this._transparentMeshesCache.push(K)):-1===O&&this._transparentMeshesCache.push(K)):-1!==O?(this._transparentMeshesCache.splice(O,1),this._opaqueMeshesCache.push(K)):-1===F&&this._opaqueMeshesCache.push(K)}_isRenderTargetValid(){var K;return null!==(null===(K=this._opaqueRenderTarget)||void 0===K?void 0:K.getInternalTexture())}_setupRenderTargets(){var K;let O;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new wK.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(K=this._options.clearColor)||void 0===K?void 0:K.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((K=>{O=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?K.clearColor.l(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(K.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=O}));for(const F of this._transparentMeshesCache)this._shouldRenderAsTransmission(F.material)&&(F.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const UK="KHR_materials_transmission";class PK{constructor(K){this.name=UK,this.order=175,this._loader=K,this.enabled=this._loader.isExtensionUsed(UK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadTransparentPropertiesAsync(f,O,F,r)),await Promise.all(l).then((()=>{}))}))}_loadTransparentPropertiesAsync(K,O,F,f){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const r=F;if(r.subSurface.isRefractionEnabled=!0,r.subSurface.volumeIndexOfRefraction=1,r.subSurface.useAlbedoToTintRefraction=!0,void 0===f.transmissionFactor)return r.subSurface.refractionIntensity=0,r.subSurface.isRefractionEnabled=!1,Promise.resolve();{var l;r.subSurface.refractionIntensity=f.transmissionFactor;const K=r.HK();if(r.subSurface.refractionIntensity&&!K._transmissionHelper)new sK({},r.HK());else if(r.subSurface.refractionIntensity&&(null===(l=K._transmissionHelper)||void 0===l||!l._isRenderTargetValid())){var q;null===(q=K._transmissionHelper)||void 0===q||q._setupRenderTargets()}}return r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=0,f.transmissionTexture?(f.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/transmissionTexture`,f.transmissionTexture,void 0).then((K=>{K.name=`${F.name} (Transmission)`,r.subSurface.refractionIntensityTexture=K,r.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}V(UK),x(UK,!0,(K=>new PK(K)));const SK="KHR_materials_diffuse_transmission";class KO{constructor(K){this.name=SK,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(SK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadTranslucentPropertiesAsync(f,O,F,r)),await Promise.all(l).then((()=>{}))}))}_loadTranslucentPropertiesAsync(K,O,F,f){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const r=F;if(r.subSurface.isTranslucencyEnabled=!0,r.subSurface.volumeIndexOfRefraction=1,r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=0,r.subSurface.useAlbedoToTintTranslucency=!1,void 0===f.diffuseTransmissionFactor)return r.subSurface.translucencyIntensity=0,r.subSurface.isTranslucencyEnabled=!1,Promise.resolve();r.subSurface.translucencyIntensity=f.diffuseTransmissionFactor;const q=new Array;return r.subSurface.useGltfStyleTextures=!0,f.diffuseTransmissionTexture&&(f.diffuseTransmissionTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionTexture`,f.diffuseTransmissionTexture).then((K=>{K.name=`${F.name} (Diffuse Transmission)`,r.subSurface.translucencyIntensityTexture=K})))),void 0!==f.diffuseTransmissionColorFactor?r.subSurface.translucencyColor=l.ZO.LO(f.diffuseTransmissionColorFactor):r.subSurface.translucencyColor=l.ZO.White(),f.diffuseTransmissionColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionColorTexture`,f.diffuseTransmissionColorTexture).then((K=>{K.name=`${F.name} (Diffuse Transmission Color)`,r.subSurface.translucencyColorTexture=K}))),Promise.all(q).then((()=>{}))}}V(SK),x(SK,!0,(K=>new KO(K)));const OO="KHR_materials_volume";class FO{constructor(K){this.name=OO,this.order=173,this._loader=K,this.enabled=this._loader.isExtensionUsed(OO),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadVolumePropertiesAsync(f,O,F,r)),await Promise.all(l).then((()=>{}))}))}_loadVolumePropertiesAsync(K,O,F,f){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);if(!F.subSurface.isRefractionEnabled&&!F.subSurface.isTranslucencyEnabled||!f.thicknessFactor)return Promise.resolve();F.subSurface.volumeIndexOfRefraction=F.indexOfRefraction;const r=void 0!==f.attenuationDistance?f.attenuationDistance:Number.MAX_VALUE;return F.subSurface.tintColorAtDistance=r,void 0!==f.attenuationColor&&3==f.attenuationColor.length&&F.subSurface.tintColor.eq(f.attenuationColor[0],f.attenuationColor[1],f.attenuationColor[2]),F.subSurface.minimumThickness=0,F.subSurface.maximumThickness=f.thicknessFactor,F.subSurface.useThicknessAsDepth=!0,f.thicknessTexture?(f.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/thicknessTexture`,f.thicknessTexture).then((K=>{K.name=`${F.name} (Thickness)`,F.subSurface.thicknessTexture=K,F.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}V(OO),x(OO,!0,(K=>new FO(K)));const fO="KHR_materials_dispersion";class rO{constructor(K){this.name=fO,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(fO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadDispersionPropertiesAsync(f,O,F,r)),await Promise.all(l).then((()=>{}))}))}_loadDispersionPropertiesAsync(K,O,F,f){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);return F.subSurface.isRefractionEnabled&&f.dispersion?(F.subSurface.isDispersionEnabled=!0,F.subSurface.dispersion=f.dispersion,Promise.resolve()):Promise.resolve()}}V(fO),x(fO,!0,(K=>new rO(K)));const lO="EXT_materials_diffuse_roughness";class qO{constructor(K){this.name=lO,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(lO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=new Array;return l.push(this._loader.loadMaterialPropertiesAsync(K,O,F)),l.push(this._loadDiffuseRoughnessPropertiesAsync(f,r,F)),await Promise.all(l).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(K,O,F){if(!(F instanceof Z.c))throw new Error(`${K}: Material type not supported`);const f=new Array;return F.brdf.baseDiffuseModel=nK.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=O.diffuseRoughnessFactor?F.baseDiffuseRoughness=O.diffuseRoughnessFactor:F.baseDiffuseRoughness=0,O.diffuseRoughnessTexture&&f.push(this._loader.loadTextureInfoAsync(`${K}/diffuseRoughnessTexture`,O.diffuseRoughnessTexture,(K=>{K.name=`${F.name} (Diffuse Roughness)`,F.baseDiffuseRoughnessTexture=K}))),Promise.all(f).then((()=>{}))}}V(lO),x(lO,!0,(K=>new qO(K)));const JO="KHR_mesh_quantization";class cO{constructor(K){this.name=JO,this.enabled=K.isExtensionUsed(JO)}dispose(){}}V(JO),x(JO,!0,(K=>new cO(K)));const EO="KHR_texture_basisu";class MO{constructor(K){this.name=EO,this._loader=K,this.enabled=K.isExtensionUsed(EO)}dispose(){this._loader=null}_loadTextureAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>{const l=void 0==O.sampler?I.DefaultSampler:n.Get(`${K}/sampler`,this._loader.zf.samplers,O.sampler),q=n.Get(`${f}/source`,this._loader.zf.images,r.source);return await this._loader._createTextureAsync(K,l,q,(K=>{F(K)}),O._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!O._textureInfo.nonColorData)}))}}V(EO),x(EO,!0,(K=>new MO(K)));const tO="KHR_texture_transform";class jO{constructor(K){this.name=tO,this._loader=K,this.enabled=this._loader.isExtensionUsed(tO)}dispose(){this._loader=null}loadTextureInfoAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(f,r)=>await this._loader.loadTextureInfoAsync(K,O,(K=>{if(!(K instanceof L.b))throw new Error(`${f}: Texture type not supported`);r.offset&&(K.uOffset=r.offset[0],K.vOffset=r.offset[1]),K.uRotationCenter=0,K.vRotationCenter=0,r.rotation&&(K.wAng=-r.rotation),r.scale&&(K.uScale=r.scale[0],K.vScale=r.scale[1]),void 0!=r.texCoord&&(K.coordinatesIndex=r.texCoord),F(K)}))))}}V(tO),x(tO,!0,(K=>new jO(K)));const XO="KHR_xmp_json_ld";class uO{constructor(K){this.name=XO,this.order=100,this._loader=K,this.enabled=this._loader.isExtensionUsed(XO)}dispose(){this._loader=null}onLoading(){var K,O,F;if(null===this._loader.rootBabylonMesh)return;const f=null===(K=this._loader.zf.extensions)||void 0===K?void 0:K.KHR_xmp_json_ld,r=null===(O=this._loader.zf.asset)||void 0===O||null===(F=O.extensions)||void 0===F?void 0:F.KHR_xmp_json_ld;if(f&&r){const K=+r.packet;f.packets&&K<f.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=f.packets[K])}}}function TO(K,O,F,f){return l.ZO.LO(O,F).scale(f)}function oO(K,O,F,f){return O[F]*f}function kO(K,O,F,f){return-O[F]*f}function NO(K,O,F,f){return O[F+1]*f}function ZO(K,O,F,f){return O[F]*f*2}function LO(K){return{scale:[new aO(j.d.ANIMATIONTYPE_FLOAT,`${K}.uScale`,oO,(()=>2)),new aO(j.d.ANIMATIONTYPE_FLOAT,`${K}.vScale`,NO,(()=>2))],offset:[new aO(j.d.ANIMATIONTYPE_FLOAT,`${K}.uOffset`,oO,(()=>2)),new aO(j.d.ANIMATIONTYPE_FLOAT,`${K}.vOffset`,NO,(()=>2))],rotation:[new aO(j.d.ANIMATIONTYPE_FLOAT,`${K}.wAng`,kO,(()=>1))]}}V(XO),x(XO,!0,(K=>new uO(K)));class dO extends D.AnimationPropertyInfo{buildAnimations(K,O,F,f){return[{babylonAnimatable:K._babylonCamera,babylonAnimation:this._buildAnimation(O,F,f)}]}}class aO extends D.AnimationPropertyInfo{buildAnimations(K,O,F,f){const r=[];for(const l in K._data)r.push({babylonAnimatable:K._data[l].babylonMaterial,babylonAnimation:this._buildAnimation(O,F,f)});return r}}class gO extends D.AnimationPropertyInfo{buildAnimations(K,O,F,f){return[{babylonAnimatable:K._babylonLight,babylonAnimation:this._buildAnimation(O,F,f)}]}}(0,v.m)("/cameras/{}/orthographic/xmag",[new dO(j.d.ANIMATIONTYPE_FLOAT,"orthoLeft",kO,(()=>1)),new dO(j.d.ANIMATIONTYPE_FLOAT,"orthoRight",NO,(()=>1))]),(0,v.m)("/cameras/{}/orthographic/ymag",[new dO(j.d.ANIMATIONTYPE_FLOAT,"orthoBottom",kO,(()=>1)),new dO(j.d.ANIMATIONTYPE_FLOAT,"orthoTop",NO,(()=>1))]),(0,v.m)("/cameras/{}/orthographic/zfar",[new dO(j.d.ANIMATIONTYPE_FLOAT,"maxZ",oO,(()=>1))]),(0,v.m)("/cameras/{}/orthographic/znear",[new dO(j.d.ANIMATIONTYPE_FLOAT,"if",oO,(()=>1))]),(0,v.m)("/cameras/{}/perspective/yfov",[new dO(j.d.ANIMATIONTYPE_FLOAT,"fov",oO,(()=>1))]),(0,v.m)("/cameras/{}/perspective/zfar",[new dO(j.d.ANIMATIONTYPE_FLOAT,"maxZ",oO,(()=>1))]),(0,v.m)("/cameras/{}/perspective/znear",[new dO(j.d.ANIMATIONTYPE_FLOAT,"if",oO,(()=>1))]),(0,v.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new aO(j.d.ANIMATIONTYPE_COLOR3,"albedoColor",TO,(()=>4)),new aO(j.d.ANIMATIONTYPE_FLOAT,"alpha",(function(K,O,F,f){return O[F+3]*f}),(()=>4))]),(0,v.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"metallic",oO,(()=>1))]),(0,v.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"roughness",oO,(()=>1))]);const HO=LO("albedoTexture");(0,v.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",HO.scale),(0,v.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",HO.offset),(0,v.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",HO.rotation);const eO=LO("metallicTexture");(0,v.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",eO.scale),(0,v.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",eO.offset),(0,v.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",eO.rotation),(0,v.m)("/materials/{}/emissiveFactor",[new aO(j.d.ANIMATIONTYPE_COLOR3,"emissiveColor",TO,(()=>3))]);const WO=LO("bumpTexture");(0,v.m)("/materials/{}/normalTexture/scale",[new aO(j.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",oO,(()=>1))]),(0,v.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",WO.scale),(0,v.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",WO.offset),(0,v.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",WO.rotation),(0,v.m)("/materials/{}/occlusionTexture/strength",[new aO(j.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",oO,(()=>1))]);const pO=LO("ambientTexture");(0,v.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",pO.scale),(0,v.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",pO.offset),(0,v.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",pO.rotation);const yO=LO("emissiveTexture");(0,v.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",yO.scale),(0,v.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",yO.offset),(0,v.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",yO.rotation),(0,v.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new aO(j.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new aO(j.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",oO,(()=>1))]);const AO=LO("anisotropy.texture");(0,v.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",AO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",AO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",AO.rotation),(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",oO,(()=>1))]);const QO=LO("clearCoat.texture");(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",QO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",QO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",QO.rotation);const RO=LO("clearCoat.bumpTexture");(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new aO(j.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",RO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",RO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",RO.rotation);const GO=LO("clearCoat.textureRoughness");(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",GO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",GO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",GO.rotation),(0,v.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new aO(j.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new aO(j.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new aO(j.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new aO(j.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",oO,(()=>1))]);const zO=LO("iridescence.texture");(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",zO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",zO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",zO.rotation);const mO=LO("iridescence.thicknessTexture");(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",mO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",mO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",mO.rotation),(0,v.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new aO(j.d.ANIMATIONTYPE_COLOR3,"sheen.color",TO,(()=>3))]),(0,v.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",oO,(()=>1))]);const xO=LO("sheen.texture");(0,v.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",xO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",xO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",xO.rotation);const VO=LO("sheen.textureRoughness");(0,v.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",VO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",VO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",VO.rotation),(0,v.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new aO(j.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",TO,(()=>3))]);const vO=LO("metallicReflectanceTexture");(0,v.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",vO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",vO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",vO.rotation);const YO=LO("reflectanceTexture");(0,v.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",YO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",YO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",YO.rotation),(0,v.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",oO,(()=>1))]);const BO=LO("subSurface.refractionIntensityTexture");(0,v.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",BO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",BO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",BO.rotation),(0,v.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new aO(j.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",TO,(()=>3))]),(0,v.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new aO(j.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",oO,(()=>1))]),(0,v.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",oO,(()=>1))]);const nO=LO("subSurface.thicknessTexture");(0,v.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",nO.scale),(0,v.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",nO.offset),(0,v.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",nO.rotation),(0,v.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new aO(j.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",oO,(()=>1))]);const CO=LO("subSurface.translucencyIntensityTexture");(0,v.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",CO.scale),(0,v.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",CO.offset),(0,v.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",CO.rotation),(0,v.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new aO(j.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",TO,(()=>3))]);const IO=LO("subSurface.translucencyColorTexture");(0,v.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",IO.scale),(0,v.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",IO.offset),(0,v.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",IO.rotation),(0,v.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new gO(j.d.ANIMATIONTYPE_COLOR3,"diffuse",TO,(()=>3))]),(0,v.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new gO(j.d.ANIMATIONTYPE_FLOAT,"intensity",oO,(()=>1))]),(0,v.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new gO(j.d.ANIMATIONTYPE_FLOAT,"range",oO,(()=>1))]),(0,v.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new gO(j.d.ANIMATIONTYPE_FLOAT,"innerAngle",ZO,(()=>1))]),(0,v.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new gO(j.d.ANIMATIONTYPE_FLOAT,"angle",ZO,(()=>1))]),(0,v.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new gO(j.d.ANIMATIONTYPE_COLOR3,"diffuse",TO,(()=>3))]),(0,v.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new gO(j.d.ANIMATIONTYPE_FLOAT,"intensity",oO,(()=>1))]);const DO="KHR_animation_pointer";class hO{constructor(K){this.name=DO,this._loader=K,this._pathToObjectConverter=(0,v.j)(this._loader.zf)}get enabled(){return this._loader.isExtensionUsed(DO)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(K,O,F,f,r){var l;const q=null===(l=f.target.extensions)||void 0===l?void 0:l.KHR_animation_pointer;if(!q||!this._pathToObjectConverter)return null;"pointer"!==f.target.path&&T.c.Warn(`${K}/target/path: Value (${f.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=f.target.node&&T.c.Warn(`${K}/target/node: Value (${f.target.node}) must not be present when using the ${this.name} extension`);const J=`${K}/extensions/${this.name}`,c=q.pointer;if(!c)throw new Error(`${J}: Pointer is missing`);try{const l=this._pathToObjectConverter.convert(c);if(!l.info.interpolation)throw new Error(`${J}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(K,O,F,f,{object:l.object,info:l.info.interpolation},r)}catch(E){return T.c.Warn(`${J}/pointer: Invalid pointer (${c}) skipped`),null}}}V(DO),x(DO,!0,(K=>new hO(K)));class bO{constructor(K,O,F){this.frame=K,this.action=O,this.onlyOnce=F,this.isDone=!1}_clone(){return new bO(this.frame,this.action,this.onlyOnce)}}var iO=F(11546),wO=F(11597),sO=F(11588);class UO{get loop(){return this._loop}set loop(K){K!==this._loop&&(this._loop=K,this.updateOptions({loop:K}))}get currentTime(){var K;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(K=wO.c.audioEngine)&&void 0!==K&&K.audioContext&&(this.isPlaying||this.isPaused)){const K=this.isPaused?0:wO.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+K}return 0}get spatialSound(){return this._spatialSound}set spatialSound(K){if(K==this._spatialSound)return;const O=this.isPlaying;this.pause(),K?(this._spatialSound=K,this._updateSpatialParameters()):this._disableSpatialSound(),O&&this.play()}constructor(K,O,F){var f;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new M.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=r.TO.Zero(),this._localDirection=new r.TO(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=K,F=F||u.e.LastCreatedScene)if(this._scene=F,UO._SceneComponentInitialization(F),this._readyToPlayCallback=l,this._customAttenuationFunction=(K,O,F,f,r)=>O<F?K*(1-O/F):0,J&&(this.autoplay=J.autoplay||!1,this._loop=J.loop||!1,void 0!==J.volume&&(this._volume=J.volume),this._spatialSound=J.spatialSound??!1,this.maxDistance=J.maxDistance??100,this.useCustomAttenuation=J.useCustomAttenuation??!1,this.rolloffFactor=J.rolloffFactor||1,this.refDistance=J.refDistance||1,this.distanceModel=J.distanceModel||"linear",this._playbackRate=J.playbackRate||1,this._streaming=J.streaming??!1,this._length=J.length,this._offset=J.offset),null!==(f=wO.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&wO.c.audioEngine.audioContext){this._soundGain=wO.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let K=!0;if(O)try{"string"===typeof O?(this._urlType="String",this._url=O):O instanceof ArrayBuffer?this._urlType="ArrayBuffer":O instanceof HTMLMediaElement?this._urlType="MediaElement":O instanceof MediaStream?this._urlType="MediaStream":O instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(O)&&(this._urlType="Array");let F=[],f=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wO.c.audioEngine.audioContext.createMediaElementSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wO.c.audioEngine.audioContext.createMediaStreamSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":O.byteLength>0&&(f=!0,this._soundLoaded(O));break;case"AudioBuffer":this._audioBufferLoaded(O);break;case"String":F.push(O);case"Array":0===F.length&&(F=O);for(let K=0;K<F.length;K++){const O=F[K];if(f=J&&J.skipCodecCheck||-1!==O.indexOf(".mp3",O.length-4)&&wO.c.audioEngine.isMP3supported||-1!==O.indexOf(".ogg",O.length-4)&&wO.c.audioEngine.isOGGsupported||-1!==O.indexOf(".wav",O.length-4)||-1!==O.indexOf(".m4a",O.length-4)||-1!==O.indexOf(".mp4",O.length-4)||-1!==O.indexOf("blob:"),f){this._streaming?(this._htmlAudioElement=new Audio(O),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,q.Tools.SetCorsBehavior(O,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(O,(K=>{this._soundLoaded(K)}),void 0,!0,!0,(K=>{K&&T.c.Error("XHR "+K.status+" error on: "+O+"."),T.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:K=!1}K?f||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):T.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(c){T.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),wO.c.audioEngine&&!wO.c.audioEngine.WarnedWebAudioUnsupported&&(T.c.Error("Web Audio is not supported by your browser."),wO.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var K;null!==(K=wO.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(K){var O;null!==(O=wO.c.audioEngine)&&void 0!==O&&O.audioContext&&(this._audioBuffer=K,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(K){var O;null!==(O=wO.c.audioEngine)&&void 0!==O&&O.audioContext&&wO.c.audioEngine.audioContext.decodeAudioData(K,(K=>{this._audioBufferLoaded(K)}),(K=>{T.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+K)}))}setAudioBuffer(K){var O;null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&(this._audioBuffer=K,this._isReadyToPlay=!0)}updateOptions(K){K&&(this.loop=K.loop??this.loop,this.maxDistance=K.maxDistance??this.maxDistance,this.useCustomAttenuation=K.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=K.rolloffFactor??this.rolloffFactor,this.refDistance=K.refDistance??this.refDistance,this.distanceModel=K.distanceModel??this.distanceModel,this._playbackRate=K.playbackRate??this._playbackRate,this._length=K.length??void 0,this.spatialSound=K.spatialSound??this._spatialSound,this._setOffset(K.offset??void 0),this.setVolume(K.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var K;null!==(K=wO.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&wO.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??wO.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var K;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(K=this._soundPanner)||void 0===K||K.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var K;null!==(K=wO.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(K){var O;null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(K),this._isOutputConnected=!0)}setDirectionalCone(K,O,F){O<K?T.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=K,this._coneOuterAngle=O,this._coneOuterGain=F,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!=this._coneInnerAngle){var O;if(this._coneOuterAngle<K)return void T.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K,null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!=this._coneOuterAngle){var O;if(K<this._coneInnerAngle)return void T.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K,null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(K){var O;K.equals(this._position)||(this._position.l(K),null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(K){var O;this._localDirection=K,null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const K=this._connectedTransformNode.getWorldMatrix(),O=r.TO.TransformNormal(this._localDirection,K);O.normalize(),this._soundPanner.orientationX.value=O.x,this._soundPanner.orientationY.value=O.y,this._soundPanner.orientationZ.value=O.z}updateDistanceFromListener(){var K;if(null!==(K=wO.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const K=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.oO(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,K,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(K){this._customAttenuationFunction=K}play(K,O,F){var f;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(f=wO.c.audioEngine)&&void 0!==f&&f.audioContext)try{var r,l;this._clearTimeoutsAndObservers();let f=K?(null===(r=wO.c.audioEngine)||void 0===r?void 0:r.audioContext.currentTime)+K:null===(l=wO.c.audioEngine)||void 0===l?void 0:l.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=wO.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const K=()=>{var F;if(null!==(F=wO.c.audioEngine)&&void 0!==F&&F.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=O??0;const F=this._htmlAudioElement.play();void 0!==F&&F.catch((()=>{var O,F;(null===(O=wO.c.audioEngine)||void 0===O||O.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(F=wO.c.audioEngine)||void 0===F?void 0:F.onAudioUnlockedObservable.addOnce((()=>{K()})))}))}else{var f;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(f=wO.c.audioEngine)||void 0===f?void 0:f.onAudioUnlockedObservable.addOnce((()=>{K()}))}};K()}}else{var q;const r=()=>{var r;if(null!==(r=wO.c.audioEngine)&&void 0!==r&&r.audioContext){var l;if(F=F||this._length,void 0!==O&&this._setOffset(O),this._soundSource){const K=this._soundSource;K.onended=()=>{K.disconnect()}}if(this._soundSource=null===(l=wO.c.audioEngine)||void 0===l?void 0:l.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var q;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==O&&(this._soundSource.loopStart=O),void 0!==F&&(this._soundSource.loopEnd=(0|O)+F),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},f=K?(null===(q=wO.c.audioEngine)||void 0===q?void 0:q.audioContext.currentTime)+K:wO.c.audioEngine.audioContext.currentTime;const r=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(f,r,this.loop?void 0:F)}}};"suspended"===(null===(q=wO.c.audioEngine)||void 0===q?void 0:q.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var K;"suspended"===(null===(K=wO.c.audioEngine)||void 0===K?void 0:K.audioContext.state)?(wO.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=wO.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{r()})))):r()}),500):r()}this._startTime=f,this.isPlaying=!0,this.isPaused=!1}catch(J){T.c.Error("Error while trying to play audio: "+this.name+", "+J.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(K){var O;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var F;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(F=this._streamingSource)||void 0===F||F.disconnect();this.isPlaying=!1}else if(null!==(O=wO.c.audioEngine)&&void 0!==O&&O.audioContext&&this._soundSource){const O=K?wO.c.audioEngine.audioContext.currentTime+K:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(O)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var K;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var O;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(O=this._streamingSource)||void 0===O||O.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(K=wO.c.audioEngine)&&void 0!==K&&K.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=wO.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(K,O){var F;null!==(F=wO.c.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._soundGain&&(O&&wO.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(wO.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,wO.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(K,wO.c.audioEngine.audioContext.currentTime+O)):this._soundGain.gain.value=K),this._volume=K}setPlaybackRate(K){this._playbackRate=K,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(K){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=K,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=K=>this._onRegisterAfterWorldMatrixUpdate(K),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(K){var O;if(K.getBoundingInfo){const O=K.getBoundingInfo();this.setPosition(O.boundingSphere.centerWorld)}else this.setPosition(K.absolutePosition);null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const K=()=>{(0,sO.g)((()=>this._isReadyToPlay),(()=>{F._audioBuffer=this.getAudioBuffer(),F._isReadyToPlay=!0,F.autoplay&&F.play(0,this._offset,this._length)}),void 0,300)},O={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},F=new UO(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,O);return this.useCustomAttenuation&&F.setAttenuationFunction(this._customAttenuationFunction),F.setPosition(this._position),F.setPlaybackRate(this._playbackRate),K(),F}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const K={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(K.connectedMeshId=this._connectedTransformNode.id),K.position=this._position.hf(),K.refDistance=this.refDistance,K.distanceModel=this.distanceModel,K.isDirectional=this._isDirectional,K.localDirectionToMesh=this._localDirection.hf(),K.coneInnerAngle=this._coneInnerAngle,K.coneOuterAngle=this._coneOuterAngle,K.coneOuterGain=this._coneOuterGain),K}static Parse(K,O,F,f){const l=K.name;let q;q=K.url?F+K.url:F+l;const J={autoplay:K.autoplay,loop:K.loop,volume:K.volume,spatialSound:K.spatialSound,maxDistance:K.maxDistance,rolloffFactor:K.rolloffFactor,refDistance:K.refDistance,distanceModel:K.distanceModel,playbackRate:K.playbackRate};let c;if(f){const K=()=>{(0,sO.g)((()=>f._isReadyToPlay),(()=>{c._audioBuffer=f.getAudioBuffer(),c._isReadyToPlay=!0,c.autoplay&&c.play(0,c._offset,c._length)}),void 0,300)};c=new UO(l,new ArrayBuffer(0),O,null,J),K()}else c=new UO(l,q,O,(()=>{O.removePendingData(c)}),J),O.addPendingData(c);if(K.position){const O=r.TO.LO(K.position);c.setPosition(O)}if(K.isDirectional&&(c.setDirectionalCone(K.coneInnerAngle||360,K.coneOuterAngle||360,K.coneOuterGain||0),K.localDirectionToMesh)){const O=r.TO.LO(K.localDirectionToMesh);c.setLocalDirectionToMesh(O)}if(K.connectedMeshId){const F=O.getMeshById(K.connectedMeshId);F&&c.attachToMesh(F)}return K.metadata&&(c.metadata=K.metadata),c}_setOffset(K){this._offset!==K&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=K)}_clearTimeoutsAndObservers(){var K;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(K=wO.c.audioEngine)||void 0===K||K.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}UO._SceneComponentInitialization=K=>{throw(0,iO.d)("AudioSceneComponent")},(0,aK.g)("BABYLON.Sound",UO);class PO{constructor(K,O,F){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],O.length!==F.length)throw new Error("Sounds length does not equal weights length");this.loop=K,this._weights=F;let f=0;for(const l of F)f+=l;const r=f>0?1/f:0;for(let l=0;l<this._weights.length;l++)this._weights[l]*=r;this._sounds=O;for(const l of this._sounds)l.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!==this._coneInnerAngle){if(this._coneOuterAngle<K)return void T.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K;for(const O of this._sounds)O.directionalConeInnerAngle=K}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!==this._coneOuterAngle){if(K<this._coneInnerAngle)return void T.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K;for(const O of this._sounds)O.directionalConeOuterAngle=K}}get volume(){return this._volume}set volume(K){if(K!==this._volume)for(const O of this._sounds)O.setVolume(K)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(K){if(!this.isPaused){this.stop();const K=Math.random();let O=0;for(let F=0;F<this._weights.length;F++)if(O+=this._weights[F],K<=O){this._currentIndex=F;break}}const O=this._sounds[this._currentIndex??0];O.isReady()?O.play(0,this.isPaused?void 0:K):O.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class SO{constructor(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(K=K||u.e.LastCreatedScene)&&(this._scene=K,this.soundCollection=[],this._options=O,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var K;null!==(K=wO.c.audioEngine)&&void 0!==K&&K.canUseWebAudio&&wO.c.audioEngine.audioContext&&(this._outputAudioNode=wO.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(wO.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(wO.c.audioEngine&&wO.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(K){var O;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&K.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==K.soundTrackId&&(-1===K.soundTrackId?this._scene.mainSoundTrack.removeSound(K):this._scene.soundTracks&&this._scene.soundTracks[K.soundTrackId].removeSound(K)),this.soundCollection.push(K),K.soundTrackId=this.id}removeSound(K){const O=this.soundCollection.indexOf(K);-1!==O&&this.soundCollection.splice(O,1)}setVolume(K){var O;null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=K)}switchPanningModelToHRTF(){var K;if(null!==(K=wO.c.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var K;if(null!==(K=wO.c.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToEqualPower()}connectToAnalyser(K){var O;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=K,null!==(O=wO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,wO.c.audioEngine.masterGain))}}var KF=F(11998),OF=F(11964),FF=F(11530);wO.c.AudioEngineFactory=(K,O,F)=>new fF(K,O,F);class fF{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new M.c,this.onAudioLockedObservable=new M.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,FF.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const f=document.createElement("audio");this._hostElement=K,this._audioContext=O,this._audioDestination=F;try{f&&f.canPlayType&&(f.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||f.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(r){}try{f&&f.canPlayType&&f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(r){}}lock(){this._triggerSuspendedState()}unlock(){var K,O;if("running"===(null===(K=this._audioContext)||void 0===K?void 0:K.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(O=this._audioContext)||void 0===O||O.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{T.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var K;null===(K=this._audioContext)||void 0===K||K.addEventListener("statechange",(()=>{var K;this.unlocked&&"running"!==(null===(K=this._audioContext)||void 0===K?void 0:K.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var K;return null!==(K=this._audioContext)&&void 0!==K&&K.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(K){this.canUseWebAudio=!1,T.c.Error("Web Audio: "+K.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(K){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const K=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",O=document.createElement("style");O.appendChild(document.createTextNode(K)),document.getElementsByTagName("head")[0].appendChild(O),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var K;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(K=this._audioContext)||void 0===K||K.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(K){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=K)}connectToAnalyser(K){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=K,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var rF=F(11541);(0,F(13118).e)(KF.b.NAME_AUDIO,((K,O,F,f)=>{let r,l=[];if(F.cX=F.cX||[],void 0!==K.cX&&null!==K.cX)for(let J=0,c=K.cX.length;J<c;J++){var q;const c=K.cX[J];null!==(q=wO.c.audioEngine)&&void 0!==q&&q.canUseWebAudio?(c.url||(c.url=c.name),l[c.url]?F.cX.push(UO.Parse(c,O,f,l[c.url])):(r=UO.Parse(c,O,f),l[c.url]=r,F.cX.push(r))):F.cX.push(new UO(c.name,null,O))}l=[]})),Object.defineProperty(OF.d.prototype,"mainSoundTrack",{get:function(){let K=this._getComponent(KF.b.NAME_AUDIO);return K||(K=new lF(this),this.o(K)),this._mainSoundTrack||(this._mainSoundTrack=new SO(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),OF.d.prototype.getSoundByName=function(K){let O;for(O=0;O<this.mainSoundTrack.soundCollection.length;O++)if(this.mainSoundTrack.soundCollection[O].name===K)return this.mainSoundTrack.soundCollection[O];if(this.soundTracks)for(let F=0;F<this.soundTracks.length;F++)for(O=0;O<this.soundTracks[F].soundCollection.length;O++)if(this.soundTracks[F].soundCollection[O].name===K)return this.soundTracks[F].soundCollection[O];return null},Object.defineProperty(OF.d.prototype,"audioEnabled",{get:function(){let K=this._getComponent(KF.b.NAME_AUDIO);return K||(K=new lF(this),this.o(K)),K.audioEnabled},set:function(K){let O=this._getComponent(KF.b.NAME_AUDIO);O||(O=new lF(this),this.o(O)),K?O.enableAudio():O.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(OF.d.prototype,"headphone",{get:function(){let K=this._getComponent(KF.b.NAME_AUDIO);return K||(K=new lF(this),this.o(K)),K.headphone},set:function(K){let O=this._getComponent(KF.b.NAME_AUDIO);O||(O=new lF(this),this.o(O)),K?O.switchAudioModeForHeadphones():O.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(OF.d.prototype,"audioListenerPositionProvider",{get:function(){let K=this._getComponent(KF.b.NAME_AUDIO);return K||(K=new lF(this),this.o(K)),K.audioListenerPositionProvider},set:function(K){let O=this._getComponent(KF.b.NAME_AUDIO);if(O||(O=new lF(this),this.o(O)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");O.audioListenerPositionProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(OF.d.prototype,"audioListenerRotationProvider",{get:function(){let K=this._getComponent(KF.b.NAME_AUDIO);return K||(K=new lF(this),this.o(K)),K.audioListenerRotationProvider},set:function(K){let O=this._getComponent(KF.b.NAME_AUDIO);if(O||(O=new lF(this),this.o(O)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");O.audioListenerRotationProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(OF.d.prototype,"audioPositioningRefreshRate",{get:function(){let K=this._getComponent(KF.b.NAME_AUDIO);return K||(K=new lF(this),this.o(K)),K.audioPositioningRefreshRate},set:function(K){let O=this._getComponent(KF.b.NAME_AUDIO);O||(O=new lF(this),this.o(O)),O.audioPositioningRefreshRate=K},enumerable:!0,configurable:!0});class lF{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(K){this.name=KF.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new r.TO,this._cachedCameraPosition=new r.TO,this._lastCheck=0,this._invertMatrixTemp=new r.Matrix,this._cameraDirectionTemp=new r.TO,(K=K||u.e.LastCreatedScene)&&(this.kO=K,K.soundTracks=[],K.cX=[])}register(){this.kO._afterRenderStage.registerStep(KF.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(K){if(K.cX=[],this.kO.soundTracks)for(let O=0;O<this.kO.soundTracks.length;O++){const F=this.kO.soundTracks[O];for(let O=0;O<F.soundCollection.length;O++)K.cX.push(F.soundCollection[O].serialize())}}addFromContainer(K){if(K.cX)for(const O of K.cX)O.play(),O.autoplay=!0,this.kO.mainSoundTrack.addSound(O)}removeFromContainer(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(K.cX)for(const F of K.cX)F.stop(),F.autoplay=!1,this.kO.mainSoundTrack.removeSound(F),O&&F.dispose()}dispose(){const K=this.kO;if(K._mainSoundTrack&&K.mainSoundTrack.dispose(),K.soundTracks)for(let O=0;O<K.soundTracks.length;O++)K.soundTracks[O].dispose()}disableAudio(){const K=this.kO;let O;for(this._audioEnabled=!1,wO.c.audioEngine&&wO.c.audioEngine.audioContext&&wO.c.audioEngine.audioContext.suspend(),O=0;O<K.mainSoundTrack.soundCollection.length;O++)K.mainSoundTrack.soundCollection[O].pause();if(K.soundTracks)for(O=0;O<K.soundTracks.length;O++)for(let F=0;F<K.soundTracks[O].soundCollection.length;F++)K.soundTracks[O].soundCollection[F].pause()}enableAudio(){const K=this.kO;let O;for(this._audioEnabled=!0,wO.c.audioEngine&&wO.c.audioEngine.audioContext&&wO.c.audioEngine.audioContext.resume(),O=0;O<K.mainSoundTrack.soundCollection.length;O++)K.mainSoundTrack.soundCollection[O].isPaused&&K.mainSoundTrack.soundCollection[O].play();if(K.soundTracks)for(O=0;O<K.soundTracks.length;O++)for(let F=0;F<K.soundTracks[O].soundCollection.length;F++)K.soundTracks[O].soundCollection[F].isPaused&&K.soundTracks[O].soundCollection[F].play()}switchAudioModeForHeadphones(){const K=this.kO;if(this._headphone=!0,K.mainSoundTrack.switchPanningModelToHRTF(),K.soundTracks)for(let O=0;O<K.soundTracks.length;O++)K.soundTracks[O].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const K=this.kO;if(this._headphone=!1,K.mainSoundTrack.switchPanningModelToEqualPower(),K.soundTracks)for(let O=0;O<K.soundTracks.length;O++)K.soundTracks[O].switchPanningModelToEqualPower()}_afterRender(){const K=rF.e.Now;if(this._lastCheck&&K-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=K;const O=this.kO;if(!this._audioEnabled||!O._mainSoundTrack||!O.soundTracks||0===O._mainSoundTrack.soundCollection.length&&1===O.soundTracks.length)return;const F=wO.c.audioEngine;if(F&&F.audioContext){let K,f=O.activeCamera;if(O.activeCameras&&O.activeCameras.length>0&&(f=O.activeCameras[0]),this.audioListenerPositionProvider){const K=this.audioListenerPositionProvider();F.audioContext.listener.setPosition(K.x||0,K.y||0,K.z||0)}else f?this._cachedCameraPosition.equals(f.globalPosition)||(this._cachedCameraPosition.l(f.globalPosition),F.audioContext.listener.setPosition(f.globalPosition.x,f.globalPosition.y,f.globalPosition.z)):F.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const K=this.audioListenerRotationProvider();F.audioContext.listener.setOrientation(K.x||0,K.y||0,K.z||0,0,1,0)}else f?(f.rigCameras&&f.rigCameras.length>0&&(f=f.rigCameras[0]),f.getViewMatrix().invertToRef(this._invertMatrixTemp),r.TO.TransformNormalToRef(lF._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.l(this._cameraDirectionTemp),F.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):F.audioContext.listener.setOrientation(0,0,0,0,1,0);for(K=0;K<O.mainSoundTrack.soundCollection.length;K++){const F=O.mainSoundTrack.soundCollection[K];F.useCustomAttenuation&&F.updateDistanceFromListener()}if(O.soundTracks)for(K=0;K<O.soundTracks.length;K++)for(let F=0;F<O.soundTracks[K].soundCollection.length;F++){const f=O.soundTracks[K].soundCollection[F];f.useCustomAttenuation&&f.updateDistanceFromListener()}}}}lF._CameraDirection=new r.TO(0,0,-1),UO._SceneComponentInitialization=K=>{let O=K._getComponent(KF.b.NAME_AUDIO);O||(O=new lF(K),K.o(O))};const qF="MSFT_audio_emitter";class JF{constructor(K){this.name=qF,this._loader=K,this.enabled=this._loader.isExtensionUsed(qF)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const K=this._loader.zf.extensions;if(K&&K[this.name]){const O=K[this.name];this._clips=O.clips,this._emitters=O.emitters,n.Assign(this._clips),n.Assign(this._emitters)}}loadSceneAsync(K,O){return I.LoadExtensionAsync(K,O,this.name,(async(F,f)=>{const r=new Array;r.push(this._loader.loadSceneAsync(K,O));for(const K of f.emitters){const O=n.Get(`${F}/emitters`,this._emitters,K);if(void 0!=O.refDistance||void 0!=O.maxDistance||void 0!=O.rolloffFactor||void 0!=O.distanceModel||void 0!=O.innerAngle||void 0!=O.outerAngle)throw new Error(`${F}: Direction or Distance properties are not allowed on emitters attached to a scene`);r.push(this._loadEmitterAsync(`${F}/emitters/${O.index}`,O))}await Promise.all(r)}))}loadNodeAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(K,f)=>{const l=new Array,J=await this._loader.loadNodeAsync(K,O,(O=>{for(const F of f.emitters){const f=n.Get(`${K}/emitters`,this._emitters,F);l.push(this._loadEmitterAsync(`${K}/emitters/${f.index}`,f).then((()=>{for(const K of f._babylonSounds)K.attachToMesh(O),void 0==f.innerAngle&&void 0==f.outerAngle||(K.setLocalDirectionToMesh(r.TO.Forward()),K.setDirectionalCone(2*q.Tools.ToDegrees(void 0==f.innerAngle?Math.PI:f.innerAngle),2*q.Tools.ToDegrees(void 0==f.outerAngle?Math.PI:f.outerAngle),0))})))}F(O)}));return await Promise.all(l),J}))}loadAnimationAsync(K,O){return I.LoadExtensionAsync(K,O,this.name,(async(F,f)=>{const r=await this._loader.loadAnimationAsync(K,O),l=new Array;n.Assign(f.events);for(const q of f.events)l.push(this._loadAnimationEventAsync(`${F}/events/${q.index}`,K,O,q,r));return await Promise.all(l),r}))}_loadClipAsync(K,O){if(O._objectURL)return O._objectURL;let F;if(O.uri)F=this._loader.loadUriAsync(K,O,O.uri);else{const f=n.Get(`${K}/bufferView`,this._loader.zf.bufferViews,O.bufferView);F=this._loader.loadBufferViewAsync(`/bufferViews/${f.index}`,f)}return O._objectURL=F.then((K=>URL.createObjectURL(new Blob([K],{type:O.mimeType})))),O._objectURL}_loadEmitterAsync(K,O){if(O._babylonSounds=O._babylonSounds||[],!O._babylonData){const K=new Array,F=O.name||`emitter${O.index}`,f={loop:!1,autoplay:!1,volume:void 0==O.volume?1:O.volume};for(let l=0;l<O.clips.length;l++){const r=`/extensions/${this.name}/clips`,q=n.Get(r,this._clips,O.clips[l].clip);K.push(this._loadClipAsync(`${r}/${O.clips[l].clip}`,q).then((K=>{const r=O._babylonSounds[l]=new UO(F,K,this._loader.babylonScene,null,f);r.refDistance=O.refDistance||1,r.maxDistance=O.maxDistance||256,r.rolloffFactor=O.rolloffFactor||1,r.distanceModel=O.distanceModel||"exponential"})))}const r=Promise.all(K).then((()=>{const K=O.clips.map((K=>K.weight||1)),F=new PO(O.loop||!1,O._babylonSounds,K);O.innerAngle&&(F.directionalConeInnerAngle=2*q.Tools.ToDegrees(O.innerAngle)),O.outerAngle&&(F.directionalConeOuterAngle=2*q.Tools.ToDegrees(O.outerAngle)),O.volume&&(F.volume=O.volume),O._babylonData.sound=F}));O._babylonData={loaded:r}}return O._babylonData.loaded}_getEventAction(K,O,F,f,r){switch(F){case"play":return K=>{const F=(r||0)+(K-f);O.play(F)};case"stop":return()=>{O.stop()};case"pause":return()=>{O.pause()};default:throw new Error(`${K}: Unsupported action ${F}`)}}_loadAnimationEventAsync(K,O,F,f,r){if(0==r.targetedAnimations.length)return Promise.resolve();const l=r.targetedAnimations[0],q=f.rO,J=n.Get(`/extensions/${this.name}/emitters`,this._emitters,q);return this._loadEmitterAsync(K,J).then((()=>{const O=J._babylonData.sound;if(O){const F=new bO(f.time,this._getEventAction(K,O,f.action,f.time,f.startOffset));l.animation.addEvent(F),r.onAnimationGroupEndObservable.add((()=>{O.stop()})),r.onAnimationGroupPauseObservable.add((()=>{O.pause()}))}}))}}V(qF),x(qF,!0,(K=>new JF(K)));const cF="MSFT_lod";class EF{constructor(K){var O;this.name=cF,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new M.c,this.onMaterialLODsLoadedObservable=new M.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=K,this.maxLODsToLoad=(null===(O=this._loader.parent.extensionOptions[cF])||void 0===O?void 0:O.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(cF)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let K=0;K<this._nodePromiseLODs.length;K++){const O=Promise.all(this._nodePromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Node LOD ${K}`),this._loader.log(`Loaded node LOD ${K}`)),this.onNodeLODsLoadedObservable.notifyObservers(K),K!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${K+1}`),this._loadBufferLOD(this._nodeBufferLODs,K+1),this._nodeSignalLODs[K]&&this._nodeSignalLODs[K].resolve())}));this._loader._completePromises.push(O)}for(let K=0;K<this._materialPromiseLODs.length;K++){const O=Promise.all(this._materialPromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Material LOD ${K}`),this._loader.log(`Loaded material LOD ${K}`)),this.onMaterialLODsLoadedObservable.notifyObservers(K),K!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${K+1}`),this._loadBufferLOD(this._materialBufferLODs,K+1),this._materialSignalLODs[K]&&this._materialSignalLODs[K].resolve())}));this._loader._completePromises.push(O)}}loadSceneAsync(K,O){const F=this._loader.loadSceneAsync(K,O);return this._loadBufferLOD(this._bufferLODs,0),F}loadNodeAsync(K,O,F){return I.LoadExtensionAsync(K,O,this.name,(async(K,r)=>{let l;const q=this._getLODs(K,O,this._loader.zf.nodes,r.ids);this._loader.logOpen(`${K}`);for(let O=0;O<q.length;O++){const K=q[O];0!==O&&(this._nodeIndexLOD=O,this._nodeSignalLODs[O]=this._nodeSignalLODs[O]||new f);const r=K=>{F(K),K.vJ(!1)},J=this._loader.loadNodeAsync(`/nodes/${K.index}`,K,r).then((K=>{if(0!==O){const K=q[O-1];K._babylonTransformNode&&(this._disposeTransformNode(K._babylonTransformNode),delete K._babylonTransformNode)}return K.vJ(!0),K}));this._nodePromiseLODs[O]=this._nodePromiseLODs[O]||[],0===O?l=J:(this._nodeIndexLOD=null,this._nodePromiseLODs[O].push(J))}return this._loader.logClose(),await l}))}_loadMaterialAsync(K,O,F,f,r){return this._nodeIndexLOD?null:I.LoadExtensionAsync(K,O,this.name,(async(K,l)=>{let q;const J=this._getLODs(K,O,this._loader.zf.materials,l.ids);this._loader.logOpen(`${K}`);for(let O=0;O<J.length;O++){const K=J[O];0!==O&&(this._materialIndexLOD=O);const l=this._loader._loadMaterialAsync(`/materials/${K.index}`,K,F,f,(K=>{0===O&&r(K)})).then((K=>{if(0!==O){r(K);const F=J[O-1]._data;F[f]&&(this._disposeMaterials([F[f].babylonMaterial]),delete F[f])}return K}));this._materialPromiseLODs[O]=this._materialPromiseLODs[O]||[],0===O?q=l:(this._materialIndexLOD=null,this._materialPromiseLODs[O].push(l))}return this._loader.logClose(),await q}))}_loadUriAsync(K,O,F){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const r=this._nodeIndexLOD-1;return this._nodeSignalLODs[r]=this._nodeSignalLODs[r]||new f,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(K,O,F)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const r=this._materialIndexLOD-1;return this._materialSignalLODs[r]=this._materialSignalLODs[r]||new f,this._materialSignalLODs[r].promise.then((async()=>await this._loader.loadUriAsync(K,O,F)))}return null}loadBufferAsync(K,O,F,r){if(this._loader.parent.useRangeRequests&&!O.uri){if(!this._loader.bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);const O=async(K,O)=>{const l=F,q=l+r-1;let J=K[O];return J?(J.start=Math.min(J.start,l),J.end=Math.max(J.end,q)):(J={start:l,end:q,loaded:new f},K[O]=J),await J.loaded.promise.then((K=>new Uint8Array(K.buffer,K.byteOffset+F-J.start,r)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?O(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?O(this._materialBufferLODs,this._materialIndexLOD):O(this._bufferLODs,0)}return null}_loadBufferLOD(K,O){const F=K[O];F&&(this._loader.log(`Loading buffer range [${F.start}-${F.end}]`),this._loader.bin.readAsync(F.start,F.end-F.start+1).then((K=>{F.loaded.resolve(K)}),(K=>{F.loaded.reject(K)})))}_getLODs(K,O,F,f){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const r=[];for(let l=f.length-1;l>=0;l--)if(r.push(n.Get(`${K}/ids/${f[l]}`,F,f[l])),r.length===this.maxLODsToLoad)return r;return r.push(O),r}_disposeTransformNode(K){const O=[],F=K.material;F&&O.push(F);for(const r of K.getChildMeshes())r.material&&O.push(r.material);K.dispose();const f=O.filter((K=>this._loader.babylonScene.meshes.every((O=>O.material!=K))));this._disposeMaterials(f)}_disposeMaterials(K){const O={};for(const F of K){for(const K of F.getActiveTextures())O[K.uniqueId]=K;F.dispose()}for(const F in O)for(const K of this._loader.babylonScene.materials)K.hasTexture(O[F])&&delete O[F];for(const F in O)O[F].dispose()}}V(cF),x(cF,!0,(K=>new EF(K)));const MF="MSFT_minecraftMesh";class tF{constructor(K){this.name=MF,this._loader=K,this.enabled=this._loader.isExtensionUsed(MF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtraAsync(K,O,this.name,(async(f,r)=>{if(r){if(!(F instanceof Z.c))throw new Error(`${f}: Material type not supported`);const r=this._loader.loadMaterialPropertiesAsync(K,O,F);return F.needAlphaBlending()&&(F.forceDepthWrite=!0,F.separateCullingPass=!0),F.qq=F.forceDepthWrite,F.twoSidedLighting=!0,await r}}))}}V(MF),x(MF,!0,(K=>new tF(K)));const jF="MSFT_sRGBFactors";class XF{constructor(K){this.name=jF,this._loader=K,this.enabled=this._loader.isExtensionUsed(jF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,O,F){return I.LoadExtraAsync(K,O,this.name,(async(f,r)=>{if(r){if(!(F instanceof Z.c))throw new Error(`${f}: Material type not supported`);const r=this._loader.loadMaterialPropertiesAsync(K,O,F),l=F.HK().getEngine().useExactSrgbConversions;return F.albedoTexture||F.albedoColor.toLinearSpaceToRef(F.albedoColor,l),F.reflectivityTexture||F.reflectivityColor.toLinearSpaceToRef(F.reflectivityColor,l),await r}}))}}V(jF),x(jF,!0,(K=>new XF(K)));var uF=F(13426);const TF={};var oF=F(13485),kF=F(13465),NF=F(13431),ZF=F(13441);function LF(K,O){for(const F of K)for(const K of F.dataOutputs)if(K.uniqueId===O)return K;throw new Error("Could not find data out connection with unique id "+O)}function dF(K,O){for(const F of K)if(F instanceof kF.c)for(const K of F.signalInputs)if(K.uniqueId===O)return K;throw new Error("Could not find signal in connection with unique id "+O)}async function aF(K,O){const f=await Promise.all(K.allBlocks.map((async K=>{const O=function(K){switch(K){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([F.e(78),F.e(79)]).then(F.bind(F,14906))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await F.e(80).then(F.bind(F,14912))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await F.e(81).then(F.bind(F,14915))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await F.e(82).then(F.bind(F,14920))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await F.e(83).then(F.bind(F,14924))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await F.e(84).then(F.bind(F,14932))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await F.e(85).then(F.bind(F,14940))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await F.e(86).then(F.bind(F,14942))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await F.e(87).then(F.bind(F,14949))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await F.e(90).then(F.bind(F,14987))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await F.e(90).then(F.bind(F,14987))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await F.e(90).then(F.bind(F,14987))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await F.e(90).then(F.bind(F,14987))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await F.e(95).then(F.bind(F,14994))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await F.e(96).then(F.bind(F,14996))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await F.e(97).then(F.bind(F,15003))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await F.e(98).then(F.bind(F,15010))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await F.e(99).then(F.bind(F,15019))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await F.e(100).then(F.bind(F,15022))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await F.e(101).then(F.bind(F,15027))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await F.e(102).then(F.bind(F,15033))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await F.e(103).then(F.bind(F,15041))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await F.e(104).then(F.bind(F,15045))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await F.e(105).then(F.bind(F,15051))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await F.e(106).then(F.bind(F,15058))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await F.e(107).then(F.bind(F,15067))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await F.e(108).then(F.bind(F,15069))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await F.e(109).then(F.bind(F,15074))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await F.e(110).then(F.bind(F,15077))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await F.e(111).then(F.bind(F,15080))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await F.e(112).then(F.bind(F,15082))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await F.e(113).then(F.bind(F,15086))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await F.e(92).then(F.bind(F,15093))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await F.e(114).then(F.bind(F,15095))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await F.e(115).then(F.bind(F,15104))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await F.e(116).then(F.bind(F,15113))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await F.e(93).then(F.bind(F,15119))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await F.e(88).then(F.bind(F,14954))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await F.e(94).then(F.bind(F,15122))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await F.e(94).then(F.bind(F,15122))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await F.e(94).then(F.bind(F,15122))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await F.e(94).then(F.bind(F,15122))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await F.e(94).then(F.bind(F,15122))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await F.e(94).then(F.bind(F,15122))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await F.e(94).then(F.bind(F,15122))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await F.e(94).then(F.bind(F,15122))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await F.e(89).then(F.bind(F,14980))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await F.e(90).then(F.bind(F,14987))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await F.e(90).then(F.bind(F,14987))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await F.e(91).then(F.bind(F,15129))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await F.e(91).then(F.bind(F,15129))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await F.e(91).then(F.bind(F,15129))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await F.e(91).then(F.bind(F,15129))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await F.e(91).then(F.bind(F,15129))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await F.e(91).then(F.bind(F,15129))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await F.e(117).then(F.bind(F,15135))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await F.e(118).then(F.bind(F,15137))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await F.e(119).then(F.bind(F,15146))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await F.e(120).then(F.bind(F,15153))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await F.e(121).then(F.bind(F,15162))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await F.e(122).then(F.bind(F,15164))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await F.e(123).then(F.bind(F,15169))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await F.e(124).then(F.bind(F,15171))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await F.e(125).then(F.bind(F,15178))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await F.e(126).then(F.bind(F,15183))).FlowGraphDataSwitchBlock;default:if(TF[K])return TF[K];throw new Error(`Unknown block name ${K}`)}}(K.className);return await O()})));return function(K,O,F){const f=O.coordinator.createGraph(),r=[],l=O.valueParseFunction??NF.d;for(let q=0;q<K.allBlocks.length;q++){const J=HF(K.allBlocks[q],{kO:O.coordinator.config.kO,pathConverter:O.pathConverter,assetsContainer:O.coordinator.config.kO,valueParseFunction:l},F[q]);r.push(J),J instanceof oF.d&&f.addEventBlock(J)}for(const q of r){for(const K of q.dataInputs)for(const O of K.connectedPointIds){const F=LF(r,O);K.connectTo(F)}if(q instanceof kF.c)for(const K of q.signalOutputs)for(const O of K.connectedPointIds){const F=dF(r,O);K.connectTo(F)}}for(const q of K.executionContexts)gF(q,{graph:f,valueParseFunction:l},K.rightHanded);return f}(K,O,f)}function gF(K,O,F){const f=O.graph.createContext();K.enableLogging&&(f.enableLogging=!0),f.treatDataAsRightHanded=F||!1;const r=O.valueParseFunction??NF.d;f.uniqueId=K.uniqueId;const l=f.HK();if(K._assetsContext){var q,J,c,E,M,t,j,X,u,T;const O=K._assetsContext,F={meshes:null===(q=O.meshes)||void 0===q?void 0:q.map((K=>l.getMeshById(K))),lights:null===(J=O.lights)||void 0===J?void 0:J.map((K=>l.getLightByName(K))),cameras:null===(c=O.cameras)||void 0===c?void 0:c.map((K=>l.getCameraByName(K))),materials:null===(E=O.materials)||void 0===E?void 0:E.map((K=>l.getMaterialById(K))),textures:null===(M=O.textures)||void 0===M?void 0:M.map((K=>l.getTextureByName(K))),animations:null===(t=O.animations)||void 0===t?void 0:t.map((K=>l.animations.find((O=>O.name===K)))),skeletons:null===(j=O.skeletons)||void 0===j?void 0:j.map((K=>l.getSkeletonByName(K))),pj:null===(X=O.pj)||void 0===X?void 0:X.map((K=>l.getParticleSystemById(K))),animationGroups:null===(u=O.animationGroups)||void 0===u?void 0:u.map((K=>l.getAnimationGroupByName(K))),transformNodes:null===(T=O.transformNodes)||void 0===T?void 0:T.map((K=>l.getTransformNodeById(K))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],cX:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};f.assetsContext=F}for(const o in K._userVariables){const O=r(o,K._userVariables,f.assetsContext,l);f.userVariables[o]=O}for(const o in K._connectionValues){const O=r(o,K._connectionValues,f.assetsContext,l);f._setConnectionValueByKey(o,O)}return f}function HF(K,O,F){const f={},r=O.valueParseFunction??NF.d;if(K.config)for(const q in K.config)f[q]=r(q,K.config,O.assetsContainer||O.kO,O.kO);if((0,NF.j)(K.className)){if(!O.pathConverter)throw new Error("Path converter is required for this block");f.pathConverter=O.pathConverter}const l=new F(f);l.uniqueId=K.uniqueId;for(let q=0;q<K.dataInputs.length;q++){const O=l.getDataInput(K.dataInputs[q].name);if(!O)throw new Error("Could not find data input with name "+K.dataInputs[q].name+" in block "+K.className);O.deserialize(K.dataInputs[q])}for(let q=0;q<K.dataOutputs.length;q++){const O=l.getDataOutput(K.dataOutputs[q].name);if(!O)throw new Error("Could not find data output with name "+K.dataOutputs[q].name+" in block "+K.className);O.deserialize(K.dataOutputs[q])}return l.metadata=K.metadata,l.deserialize&&l.deserialize(K),l}function eF(K){const[O,F]=K.split(":");return WF({op:O,extension:F})}function WF(K){var O;let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=K.extension?null===(O=yF[K.extension])||void 0===O?void 0:O[K.op]:AF[K.op];if(!f&&(T.c.Warn(`No mapping found for operation ${K.op} and extension ${K.extension||"KHR_interactivity"}`),F)){const O={},F={flows:{}};if(K.inputValueSockets){O.values={};for(const F in K.inputValueSockets)O.values[F]={name:F}}return K.outputValueSockets&&(F.values={},Object.keys(K.outputValueSockets).forEach((K=>{F.values[K]={name:K}}))),{DM:[],inputs:O,outputs:F}}return f}function pF(K,O,F){yF[O]||(yF[O]={}),yF[O][K]=F}const yF={BABYLON:{"flow/log":{DM:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},AF={"event/onStart":{DM:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{DM:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{DM:["FlowGraphSendCustomEventBlock"],extraProcessor(K,O,F,f,r){if("event/send"!==O.op||!K.configuration||1!==Object.keys(K.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const l=K.configuration.event.value[0];if("number"!==typeof l)throw new Error("Event id should be a number");const q=f.arrays.events[l],J=r[0];return J.config||(J.config={}),J.config.eventId=q.eventId,J.config.eventData=q.eventData,r}},"event/receive":{DM:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(K,O){var F;if(!K.configuration)return T.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const f=K.configuration.event;if(!f)return T.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const r=f.value[0];if("number"!==typeof r)return T.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(F=O.events)||void 0===F?void 0:F[r])?{valid:!0}:(T.c.Error(`Event with id ${r} not found`),{valid:!1,error:`Event with id ${r} not found`})},extraProcessor(K,O,F,f,r){if("event/receive"!==O.op||!K.configuration||1!==Object.keys(K.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const l=K.configuration.event.value[0];if("number"!==typeof l)throw new Error("Event id should be a number");const q=f.arrays.events[l],J=r[0];return J.config||(J.config={}),J.config.eventId=q.eventId,J.config.eventData=q.eventData,r}},"math/e":QF("FlowGraphEBlock"),"math/pi":QF("FlowGraphPIBlock"),"math/inf":QF("FlowGraphInfBlock"),"math/nan":QF("FlowGraphNaNBlock"),"math/abs":QF("FlowGraphAbsBlock"),"math/sign":QF("FlowGraphSignBlock"),"math/trunc":QF("FlowGraphTruncBlock"),"math/floor":QF("FlowGraphFloorBlock"),"math/ceil":QF("FlowGraphCeilBlock"),"math/round":{DM:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r){var l;return(l=r[0]).config||(l.config={}),r[0].config.roundHalfAwayFromZero=!0,r}},"math/fract":QF("FlowGraphFractBlock"),"math/neg":QF("FlowGraphNegationBlock"),"math/add":QF("FlowGraphAddBlock",["a","b"],!0),"math/sub":QF("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{DM:["FlowGraphMultiplyBlock"],extraProcessor(K,O,F,f,r){var l;(l=r[0]).config||(l.config={}),r[0].config.useMatrixPerComponent=!0,r[0].config.preventIntegerFloatArithmetic=!0;let q=-1;return Object.keys(K.values||{}).find((O=>{var F;return void 0!==(null===(F=K.values)||void 0===F?void 0:F[O].type)&&(q=K.values[O].type,!0)})),-1!==q&&(r[0].config.type=f.arrays.types[q].flowGraphType),r},validation:K=>K.values?RF(K):{valid:!0}},"math/div":QF("FlowGraphDivideBlock",["a","b"],!0),"math/rem":QF("FlowGraphModuloBlock",["a","b"]),"math/min":QF("FlowGraphMinBlock",["a","b"]),"math/max":QF("FlowGraphMaxBlock",["a","b"]),"math/clamp":QF("FlowGraphClampBlock",["a","b","c"]),"math/saturate":QF("FlowGraphSaturateBlock"),"math/mix":QF("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":QF("FlowGraphEqualityBlock",["a","b"]),"math/lt":QF("FlowGraphLessThanBlock",["a","b"]),"math/le":QF("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":QF("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":QF("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":QF("FlowGraphIsNaNBlock"),"math/isinf":QF("FlowGraphIsInfBlock"),"math/select":{DM:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{DM:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":QF("FlowGraphSinBlock"),"math/cos":QF("FlowGraphCosBlock"),"math/tan":QF("FlowGraphTanBlock"),"math/asin":QF("FlowGraphASinBlock"),"math/acos":QF("FlowGraphACosBlock"),"math/atan":QF("FlowGraphATanBlock"),"math/atan2":QF("FlowGraphATan2Block",["a","b"]),"math/sinh":QF("FlowGraphSinhBlock"),"math/cosh":QF("FlowGraphCoshBlock"),"math/tanh":QF("FlowGraphTanhBlock"),"math/asinh":QF("FlowGraphASinhBlock"),"math/acosh":QF("FlowGraphACoshBlock"),"math/atanh":QF("FlowGraphATanhBlock"),"math/exp":QF("FlowGraphExponentialBlock"),"math/log":QF("FlowGraphLogBlock"),"math/log2":QF("FlowGraphLog2Block"),"math/log10":QF("FlowGraphLog10Block"),"math/sqrt":QF("FlowGraphSquareRootBlock"),"math/cbrt":QF("FlowGraphCubeRootBlock"),"math/pow":QF("FlowGraphPowerBlock",["a","b"]),"math/length":QF("FlowGraphLengthBlock"),"math/normalize":QF("FlowGraphNormalizeBlock"),"math/dot":QF("FlowGraphDotBlock",["a","b"]),"math/cross":QF("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":QF("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":QF("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{DM:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{DM:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{DM:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{DM:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{DM:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{DM:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{DM:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":QF("FlowGraphTransposeBlock"),"math/determinant":QF("FlowGraphDeterminantBlock"),"math/inverse":QF("FlowGraphInvertMatrixBlock"),"math/matmul":QF("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{DM:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"TJ",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r,l){const q=r[0].dataInputs.find((K=>"rotationQuaternion"===K.name));if(!q)throw new Error("Rotation quaternion input not found");return l._connectionValues[q.uniqueId]&&(l._connectionValues[q.uniqueId].type="Quaternion"),r}},"math/matDecompose":{DM:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"TJ"}}}},"math/quatConjugate":QF("FlowGraphConjugateBlock",["a"]),"math/quatMul":{DM:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r){var l;return(l=r[0]).config||(l.config={}),r[0].config.type="Quaternion",r}},"math/quatAngleBetween":QF("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{DM:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":QF("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":QF("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{DM:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r){var l;return(l=r[0]).config||(l.config={}),r[0].config.inputIsColumnMajor=!0,r}},"math/extract2x2":{DM:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{DM:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r){var l;return(l=r[0]).config||(l.config={}),r[0].config.inputIsColumnMajor=!0,r}},"math/extract3x3":{DM:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{DM:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r){var l;return(l=r[0]).config||(l.config={}),r[0].config.inputIsColumnMajor=!0,r}},"math/extract4x4":{DM:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{DM:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r,l){var q,J;(J=r[0]).config||(J.config={});const c=r[0].dataInputs[0];return r[0].config.valueType=(null===(q=l._connectionValues[c.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",r}},"math/and":{DM:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r,l){var q,J,c;(c=r[0]).config||(c.config={});const E=r[0].dataInputs[0],M=r[0].dataInputs[1];return r[0].config.valueType=(null===(q=l._connectionValues[E.uniqueId])||void 0===q?void 0:q.type)??(null===(J=l._connectionValues[M.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",r}},"math/or":{DM:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r,l){var q,J,c;(c=r[0]).config||(c.config={});const E=r[0].dataInputs[0],M=r[0].dataInputs[1];return r[0].config.valueType=(null===(q=l._connectionValues[E.uniqueId])||void 0===q?void 0:q.type)??(null===(J=l._connectionValues[M.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",r}},"math/xor":{DM:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,O,F,f,r,l){var q,J,c;(c=r[0]).config||(c.config={});const E=r[0].dataInputs[0],M=r[0].dataInputs[1];return r[0].config.valueType=(null===(q=l._connectionValues[E.uniqueId])||void 0===q?void 0:q.type)??(null===(J=l._connectionValues[M.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",r}},"math/asr":QF("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":QF("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":QF("FlowGraphLeadingZerosBlock"),"math/ctz":QF("FlowGraphTrailingZerosBlock"),"math/popcnt":QF("FlowGraphOneBitsCounterBlock"),"math/rad":QF("FlowGraphDegToRadBlock"),"math/deg":QF("FlowGraphRadToDegBlock"),"type/boolToInt":QF("FlowGraphBooleanToInt"),"type/boolToFloat":QF("FlowGraphBooleanToFloat"),"type/intToBool":QF("FlowGraphIntToBoolean"),"type/intToFloat":QF("FlowGraphIntToFloat"),"type/floatToInt":QF("FlowGraphFloatToInt"),"type/floatToBool":QF("FlowGraphFloatToBoolean"),"flow/sequence":{DM:["FlowGraphSequenceBlock"],extraProcessor(K,O,F,f,r){const l=r[0];return l.config||(l.config={}),l.config.outputSignalCount=Object.keys(K.flows||[]).length,l.signalOutputs.forEach(((K,O)=>{K.name="out_"+O})),r}},"flow/branch":{DM:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{DM:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(K){if(K.configuration&&K.configuration.cases){const O=K.configuration.cases.value;if(!O.every((K=>"number"===typeof K&&/^-?\d+$/.test(K.toString()))))return T.c.Warn("Switch cases should be integers. Using empty array instead."),K.configuration.cases.value=[],{valid:!0};const F=new Set(O);K.configuration.cases.value=Array.from(F)}return{valid:!0}},extraProcessor(K,O,F,f,r){if("flow/switch"!==O.op||!K.flows||0===Object.keys(K.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return r[0].signalOutputs.forEach((K=>{"default"!==K.name&&(K.name="out_"+K.name)})),r}},"flow/while":{DM:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{DM:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(K,O,F,f,r){const l=r[0];return l.config||(l.config={}),l.config.incrementIndexWhenLoopDone=!0,r}},"flow/doN":{DM:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{DM:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(K,O,F,f,r){if("flow/multiGate"!==O.op||!K.flows||0===Object.keys(K.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const l=r[0];return l.config||(l.config={}),l.config.outputSignalCount=Object.keys(K.flows).length,l.signalOutputs.forEach(((K,O)=>{K.name="out_"+O})),r}},"flow/waitAll":{DM:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(K){var O,F;return"number"!==typeof(null===(O=K.configuration)||void 0===O||null===(F=O.inputFlows)||void 0===F?void 0:F.value[0])&&(K.configuration=K.configuration||{inputFlows:{value:[0]}},K.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{DM:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{DM:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{DM:["FlowGraphCancelDelayBlock"]},"variable/get":{DM:["FlowGraphGetVariableBlock"],validation(K){var O,F;return null!==(O=K.configuration)&&void 0!==O&&null!==(F=O.variable)&&void 0!==F&&F.value?{valid:!0}:(T.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(K,O)=>[O.getVariableName(K[0])]}}},"variable/set":{DM:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(K,O)=>[O.getVariableName(K[0])]}}},"variable/setMultiple":{DM:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(K,O)=>[K[0].map((K=>O.getVariableName(K)))]}},extraProcessor:(K,O,F,f,r)=>(r[0].dataInputs.forEach((K=>{K.name=f.getVariableName(+K.name)})),r)},"variable/interpolate":{DM:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(K,O)=>[O.getVariableName(K[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:K=>!0===K[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",dF:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",dF:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",dF:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",dF:"FlowGraphPlayAnimationBlock"},out:{name:"out",dF:"FlowGraphPlayAnimationBlock"},done:{name:"done",dF:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(K,O,F,f,r){var l,q,J;const c=r[0],E=null===(l=K.configuration)||void 0===l?void 0:l.variable.value[0];if("number"!==typeof E)throw T.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const M=f.arrays.staticVariables[E];"undefined"===typeof c.config.animationType.value&&(f.arrays.staticVariables,c.config.animationType.value=(0,ZF.G)(M.type));const t=r[4];return t.config||(t.config={}),(q=t.config).variable||(q.variable={}),t.config.variable.value=f.getVariableName(E),(J=r[3]).config||(J.config={}),r}},"pointer/get":{DM:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",dF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",dF:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(K,O,F,f,r)=>(r.forEach((K=>{"FlowGraphJsonPointerParserBlock"===K.className&&(K.config||(K.config={}),K.config.outputValue=!0)})),r)},"pointer/set":{DM:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",dF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",dF:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(K,O,F,f,r)=>(r.forEach((K=>{"FlowGraphJsonPointerParserBlock"===K.className&&(K.config||(K.config={}),K.config.outputValue=!0)})),r)},"pointer/interpolate":{DM:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",dF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",dF:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",dF:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",dF:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",dF:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",dF:"FlowGraphPlayAnimationBlock"},out:{name:"out",dF:"FlowGraphPlayAnimationBlock"},done:{name:"done",dF:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(K,O,F,f,r)=>(r.forEach((O=>{"FlowGraphJsonPointerParserBlock"===O.className?(O.config||(O.config={}),O.config.outputValue=!0):"FlowGraphInterpolationBlock"===O.className&&(O.config||(O.config={}),Object.keys(K.values||[]).forEach((F=>{var r;const l=null===(r=K.values)||void 0===r?void 0:r[F];if("value"===F&&l){const K=l.type;void 0!==K&&(O.config.animationType=f.arrays.types[K].flowGraphType)}})))})),r)},"animation/start":{DM:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",dF:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(K,O)=>[K[0]*O._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(K,O)=>[K[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(K,O,F,f,r,l,q){const J=r[r.length-1];return J.config||(J.config={}),J.config.glTF=q,r}},"animation/stop":{DM:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",dF:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(K,O,F,f,r,l,q){const J=r[r.length-1];return J.config||(J.config={}),J.config.glTF=q,r}},"animation/stopAt":{DM:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",dF:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(K,O)=>[K[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(K,O,F,f,r,l,q){const J=r[r.length-1];return J.config||(J.config={}),J.config.glTF=q,r}},"math/switch":{DM:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(K){if(K.configuration&&K.configuration.cases){const O=K.configuration.cases.value;if(!O.every((K=>"number"===typeof K&&/^-?\d+$/.test(K.toString()))))return T.c.Warn("Switch cases should be integers. Using empty array instead."),K.configuration.cases.value=[],{valid:!0};const F=new Set(O);K.configuration.cases.value=Array.from(F)}return{valid:!0}},extraProcessor(K,O,F,f,r){const l=r[0];return l.dataInputs.forEach((K=>{"default"!==K.name&&"case"!==K.name&&(K.name="in_"+K.name)})),l.config||(l.config={}),l.config.treatCasesAsIntegers=!0,r}},"debug/log":{DM:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function QF(K){let O=arguments.length>2?arguments[2]:void 0;return{DM:[K],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((K,O)=>(K[O]={name:O},K)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(K,F,f,r,l){var q;if(O){(q=l[0]).config||(q.config={}),l[0].config.preventIntegerFloatArithmetic=!0;let O=-1;Object.keys(K.values||{}).find((F=>{var f;return void 0!==(null===(f=K.values)||void 0===f?void 0:f[F].type)&&(O=K.values[F].type,!0)})),-1!==O&&(l[0].config.type=r.arrays.types[O].flowGraphType)}return l},validation:K=>O?RF(K):{valid:!0}}}function RF(K){if(K.values){const O=Object.keys(K.values).map((O=>K.values[O].type)).filter((K=>void 0!==K));if(!O.every((K=>K===O[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}AF["math/compose"]=AF["math/matCompose"],AF["math/decompose"]=AF["math/matDecompose"];var GF=F(11664);const zF={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"TO",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class mF{constructor(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=K,this._gltf=O,this._animationTargetFps=F,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const K of this._interactivityGraph.types)this._types.push(zF[K.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const K of this._interactivityGraph.declarations){const O=WF(K);if(!O)throw T.c.Error(["No mapping found for declaration",K]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:O,fullOperationName:K.extension?K.op+":"+K.extension:K.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const K of this._interactivityGraph.variables){const O=this._parseVariable(K);this._staticVariables.push(O)}}_parseVariable(K,O){const F=this._types[K.type];if(!F)throw T.c.Error(["No type found for variable",K]),new Error("Error parsing variables");if(K.value&&K.value.length!==F.length)throw T.c.Error(["Invalid value length for variable",K,F]),new Error("Error parsing variables");const f=K.value||[];if(!f.length)switch(F.flowGraphType){case"boolean":f.push(!1);break;case"FlowGraphInteger":f.push(0);break;case"number":f.push(NaN);break;case"Vector2":f.push(NaN,NaN);break;case"TO":f.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":f.fill(NaN,0,4);break;case"Matrix":f.fill(NaN,0,16);break;case"Matrix3D":f.fill(NaN,0,9)}return"number"===F.elementType&&"string"===typeof f[0]&&(f[0]=parseFloat(f[0])),{type:F.flowGraphType,value:O?O(f,this):f}}_parseEvents(){if(this._interactivityGraph.events)for(const K of this._interactivityGraph.events){const O={eventId:K.id||"internalEvent_"+this._internalEventsCounter++};K.values&&(O.eventData=Object.keys(K.values).map((O=>{var F;const f=null===(F=K.values)||void 0===F?void 0:F[O];if(!f)throw T.c.Error(["No value found for event key",O]),new Error("Error parsing events");const r=this._types[f.type];if(!r)throw T.c.Error(["No type found for event value",f]),new Error("Error parsing events");const l="undefined"!==typeof f.value?this._parseVariable(f):void 0;return{id:O,type:r.flowGraphType,eventData:!0,value:l}}))),this._events.push(O)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const O of this._interactivityGraph.nodes){if("number"!==typeof O.declaration)throw T.c.Error(["No declaration found for node",O]),new Error("Error parsing nodes");const F=this._mappings[O.declaration];if(!F)throw T.c.Error(["No mapping found for node",O]),new Error("Error parsing nodes");if(F.flowGraphMapping.validation){const f=F.flowGraphMapping.validation(O,this._interactivityGraph,this._gltf);var K;if(!f.valid)throw new Error(`Error validating interactivity node ${null===(K=this._interactivityGraph.declarations)||void 0===K?void 0:K[O.declaration].op} - ${f.error}`)}const f=[];for(const K of F.flowGraphMapping.DM){const r=this._getEmptyBlock(K,F.fullOperationName);this._parseNodeConfiguration(O,r,F.flowGraphMapping,K),f.push(r)}this._nodes.push({DM:f,fullOperationName:F.fullOperationName})}}_getEmptyBlock(K,O){return{uniqueId:(0,GF.d)(),className:K,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:O,metadata:{}}}_parseNodeConfiguration(K,O,F,f){const r=O.config;if(K.configuration){const O=Object.keys(K.configuration);for(const J of O){var l,q;const O=null===(l=K.configuration)||void 0===l?void 0:l[J];if(!O)throw T.c.Error(["No value found for node configuration",J]),new Error("Error parsing node configuration");const c=null===(q=F.configuration)||void 0===q?void 0:q[J];if(c&&c.dF?c.dF===f:0===F.DM.indexOf(f)){const K=(null===c||void 0===c?void 0:c.name)||J;O&&"undefined"!==typeof O.value||"undefined"===typeof(null===c||void 0===c?void 0:c.defaultValue)?O.value.length>=0?r[K]={value:1===O.value.length?O.value[0]:O.value}:T.c.Warn(["Invalid value for node configuration",O]):r[K]={value:c.defaultValue},c&&c.dataTransformer&&(r[K].value=c.dataTransformer([r[K].value],this)[0])}}}}_parseNodeConnections(K){for(let a=0;a<this._nodes.length;a++){var O;const g=null===(O=this._interactivityGraph.nodes)||void 0===O?void 0:O[a];if(!g)throw T.c.Error(["No node found for interactivity node",this._nodes[a]]),new Error("Error parsing node connections");const H=this._nodes[a],e=this._mappings[g.declaration];if(!e)throw T.c.Error(["No mapping found for node",g]),new Error("Error parsing node connections");const W=g.flows||{},p=Object.keys(W).sort();for(const K of p){var F,f,r,l;const O=W[K],E=null===(F=e.flowGraphMapping.outputs)||void 0===F||null===(f=F.flows)||void 0===f?void 0:f[K],M=(null===E||void 0===E?void 0:E.name)||K,t=this._createNewSocketConnection(M,!0);(E&&E.dF&&H.DM.find((K=>K.className===E.dF))||H.DM[0]).signalOutputs.push(t);const j=O.node,X=this._nodes[j];if(!X)throw T.c.Error(["No node found for input node id",j]),new Error("Error parsing node connections");const u=eF(X.fullOperationName);if(!u)throw T.c.Error(["No mapping found for input node",X]),new Error("Error parsing node connections");let o=null===(r=u.inputs)||void 0===r||null===(l=r.flows)||void 0===l?void 0:l[O.socket||"in"],k=!1;if(!o)for(const K in null===(q=u.inputs)||void 0===q?void 0:q.flows){var q,J,c;if(K.startsWith("[")&&K.endsWith("]"))k=!0,o=null===(J=u.inputs)||void 0===J||null===(c=J.flows)||void 0===c?void 0:c[K]}const N=o?k?o.name.replace("$1",O.socket||""):o.name:O.socket||"in",Z=o&&o.dF&&X.DM.find((K=>K.className===o.dF))||X.DM[0];let L=Z.signalInputs.find((K=>K.name===N));L||(L=this._createNewSocketConnection(N),Z.signalInputs.push(L)),L.connectedPointIds.push(t.uniqueId),t.connectedPointIds.push(L.uniqueId)}const y=g.values||{},A=Object.keys(y);for(const O of A){var E,M;const F=y[O];let f=null===(E=e.flowGraphMapping.inputs)||void 0===E||null===(M=E.values)||void 0===M?void 0:M[O],r=!1;if(!f)for(const K in null===(t=e.flowGraphMapping.inputs)||void 0===t?void 0:t.values){var t,j,X;if(K.startsWith("[")&&K.endsWith("]"))r=!0,f=null===(j=e.flowGraphMapping.inputs)||void 0===j||null===(X=j.values)||void 0===X?void 0:X[K]}const l=f?r?f.name.replace("$1",O):f.name:O,q=this._createNewSocketConnection(l);if((f&&f.dF&&H.DM.find((K=>K.className===f.dF))||H.DM[0]).dataInputs.push(q),void 0!==F.value){const O=this._parseVariable(F,f&&f.dataTransformer);K._connectionValues[q.uniqueId]=O}else{if("undefined"===typeof F.node)throw T.c.Error(["Invalid value for value connection",F]),new Error("Error parsing node connections");{var u,o,k;const K=F.node,O=F.socket||"value",f=this._nodes[K];if(!f)throw T.c.Error(["No node found for output socket reference",F]),new Error("Error parsing node connections");const r=eF(f.fullOperationName);if(!r)throw T.c.Error(["No mapping found for output socket reference",F]),new Error("Error parsing node connections");let l=null===(u=r.outputs)||void 0===u||null===(o=u.values)||void 0===o?void 0:o[O],J=!1;if(!l)for(const F in null===(N=r.outputs)||void 0===N?void 0:N.values){var N,Z,L;if(F.startsWith("[")&&F.endsWith("]"))J=!0,l=null===(Z=r.outputs)||void 0===Z||null===(L=Z.values)||void 0===L?void 0:L[F]}const c=l?J?l.name.replace("$1",O):null===(k=l)||void 0===k?void 0:k.name:O,E=l&&l.dF&&f.DM.find((K=>K.className===l.dF))||f.DM[0];let M=E.dataOutputs.find((K=>K.name===c));M||(M=this._createNewSocketConnection(c,!0),E.dataOutputs.push(M)),q.connectedPointIds.push(M.uniqueId),M.connectedPointIds.push(q.uniqueId)}}}if(e.flowGraphMapping.interBlockConnectors)for(const K of e.flowGraphMapping.interBlockConnectors){const O=K.input,F=K.output,f=K.isVariable;this._connectFlowGraphNodes(O,F,H.DM[K.inputBlockIndex],H.DM[K.outputBlockIndex],f)}if(e.flowGraphMapping.extraProcessor){var d;const O=null===(d=this._interactivityGraph.declarations)||void 0===d?void 0:d[g.declaration];if(!O)throw T.c.Error(["No declaration found for extra processor",g]),new Error("Error parsing node connections");H.DM=e.flowGraphMapping.extraProcessor(g,O,e.flowGraphMapping,this,H.DM,K,this._gltf)}}}_createNewSocketConnection(K,O){return{uniqueId:(0,GF.d)(),name:K,_connectionType:O?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(K,O,F,f,r){const l=r?F.dataInputs:F.signalInputs,q=r?f.dataOutputs:f.signalOutputs,J=l.find((O=>O.name===K))||this._createNewSocketConnection(K),c=q.find((K=>K.name===O))||this._createNewSocketConnection(O,!0);l.find((O=>O.name===K))||l.push(J),q.find((K=>K.name===O))||q.push(c),J.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(J.uniqueId)}getVariableName(K){return"staticVariable_"+K}serializeToFlowGraph(){const K={uniqueId:(0,GF.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(K);for(let O=0;O<this._staticVariables.length;O++){const F=this._staticVariables[O];K._userVariables[this.getVariableName(O)]=F}return{rightHanded:!0,allBlocks:this._nodes.reduce(((K,O)=>K.concat(O.DM)),[]),executionContexts:[K]}}}const xF="KHR_interactivity";class VF{constructor(K){this._loader=K,this.name=xF,this.enabled=this._loader.isExtensionUsed(xF),this._pathConverter=(0,v.j)(this._loader.zf),K._skipStartAnimationStep=!0;const O=K.babylonScene;O&&function(K){(0,v.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!K.activeCamera)return new r.Quaternion(NaN,NaN,NaN,NaN);const O=r.Quaternion.FromRotationMatrix(K.activeCamera.getWorldMatrix()).normalize();return K.useRightHandedSystem||(O.w*=-1,O.x*=-1),O},type:"Quaternion",getTarget:()=>K.activeCamera}),(0,v.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!K.activeCamera)return new r.TO(NaN,NaN,NaN);const O=K.activeCamera.getWorldMatrix().getTranslation();return K.useRightHandedSystem||(O.x*=-1),O},type:"TO",getTarget:()=>K.activeCamera}),(0,v.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:K=>{var O;return(null===(O=K._babylonAnimationGroup)||void 0===O?void 0:O.isPlaying)??!1},type:"boolean",getTarget:K=>K._babylonAnimationGroup}),(0,v.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:K=>{var O;return((null===(O=K._babylonAnimationGroup)||void 0===O?void 0:O.from)??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup}),(0,v.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:K=>{var O;return((null===(O=K._babylonAnimationGroup)||void 0===O?void 0:O.to)??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup}),(0,v.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:K=>{var O;return((null===(O=K._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup}),(0,v.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:K=>{var O;return((null===(O=K._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup})}(O)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var K;if(!this._loader.babylonScene||!this._pathConverter)return;const O=this._loader.babylonScene,F=null===(K=this._loader.zf.extensions)||void 0===K?void 0:K.KHR_interactivity;if(!F)return;const f=new uF.b({kO:O});f.dispatchEventsSynchronously=!1;const r=F.graphs.map((K=>new mF(K,this._loader.zf,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(r.map((async K=>await aF(K,{coordinator:f,pathConverter:this._pathConverter})))),f.start()}}var vF;vF=async()=>(await Promise.resolve().then(F.bind(F,13496))).FlowGraphGLTFDataProvider,TF[`${xF}/${"FlowGraphGLTFDataProvider"}`]=vF,V(xF),x(xF,!0,(K=>new VF(K)));const YF="KHR_node_visibility";(0,v.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:K=>{const O=K._babylonTransformNode;return!O||void 0===O.isVisible||O.isVisible},set:(K,O)=>{var F,f;null===(F=O._primitiveBabylonMeshes)||void 0===F||F.forEach((K=>{K.inheritVisibility=!0})),O._babylonTransformNode&&(O._babylonTransformNode.isVisible=K),null===(f=O._primitiveBabylonMeshes)||void 0===f||f.forEach((O=>{O.isVisible=K}))},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class BF{constructor(K){this.name=YF,this._loader=K,this.enabled=K.isExtensionUsed(YF)}async onReady(){var K;null===(K=this._loader.zf.nodes)||void 0===K||K.forEach((K=>{var O,F,f,r;(null===(O=K._primitiveBabylonMeshes)||void 0===O||O.forEach((K=>{K.inheritVisibility=!0})),null!==(F=K.extensions)&&void 0!==F&&F.KHR_node_visibility)&&(!1===(null===(f=K.extensions)||void 0===f?void 0:f.KHR_node_visibility.visible)&&(K._babylonTransformNode&&(K._babylonTransformNode.isVisible=!1),null===(r=K._primitiveBabylonMeshes)||void 0===r||r.forEach((K=>{K.isVisible=!1}))))}))}dispose(){this._loader=null}}V(YF),x(YF,!0,(K=>new BF(K)));const nF="KHR_node_selectability";pF("event/onSelect",nF,{DM:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dF:"FlowGraphGetVariableBlock",dataTransformer:K=>["pickedMesh_"+K[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",dF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(K,O,F,f,r,l,q){var J,c,E,M,t,j;const X=r[r.length-1];X.config=X.config||{},X.config.glTF=q;const u=null===(J=K.configuration)||void 0===J||null===(c=J.nodeIndex)||void 0===c?void 0:c.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const T="pickedMesh_"+u;return r[1].config.variable=T,l._userVariables[T]={className:"Mesh",id:null===q||void 0===q||null===(E=q.nodes)||void 0===E||null===(M=E[u]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===q||void 0===q||null===(t=q.nodes)||void 0===t||null===(j=t[u]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},r}}),(0,v.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:K=>{const O=K._babylonTransformNode;return!O||void 0===O.TE||O.TE},set:(K,O)=>{var F;null===(F=O._primitiveBabylonMeshes)||void 0===F||F.forEach((O=>{O.TE=K}))},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"TE"],type:"boolean"});class CF{constructor(K){this.name=nF,this._loader=K,this.enabled=K.isExtensionUsed(nF)}async onReady(){var K;null===(K=this._loader.zf.nodes)||void 0===K||K.forEach((K=>{var O,F,f;null!==(O=K.extensions)&&void 0!==O&&O.KHR_node_selectability&&!1===(null===(F=K.extensions)||void 0===F?void 0:F.KHR_node_selectability.selectable)&&(null===(f=K._babylonTransformNode)||void 0===f||f.getChildMeshes().forEach((K=>{K.TE=!1})))}))}dispose(){this._loader=null}}V(nF),x(nF,!0,(K=>new CF(K)));const IF="KHR_node_hoverability",DF="targetMeshPointerOver_";pF("event/onHoverIn",IF,{DM:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dF:"FlowGraphGetVariableBlock",dataTransformer:K=>[DF+K[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",dF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(K,O,F,f,r,l,q){var J,c,E,M,t,j;const X=r[r.length-1];X.config=X.config||{},X.config.glTF=q;const u=null===(J=K.configuration)||void 0===J||null===(c=J.nodeIndex)||void 0===c?void 0:c.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const T=DF+u;return r[1].config.variable=T,l._userVariables[T]={className:"Mesh",id:null===q||void 0===q||null===(E=q.nodes)||void 0===E||null===(M=E[u]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===q||void 0===q||null===(t=q.nodes)||void 0===t||null===(j=t[u]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},r}});const hF="targetMeshPointerOut_";pF("event/onHoverOut",IF,{DM:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dF:"FlowGraphGetVariableBlock",dataTransformer:K=>[hF+K[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",dF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(K,O,F,f,r,l,q){var J,c,E,M,t,j;const X=r[r.length-1];X.config=X.config||{},X.config.glTF=q;const u=null===(J=K.configuration)||void 0===J||null===(c=J.nodeIndex)||void 0===c?void 0:c.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const T=hF+u;return r[1].config.variable=T,l._userVariables[T]={className:"Mesh",id:null===q||void 0===q||null===(E=q.nodes)||void 0===E||null===(M=E[u]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===q||void 0===q||null===(t=q.nodes)||void 0===t||null===(j=t[u]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},r}}),(0,v.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:K=>{const O=K._babylonTransformNode;return!O||void 0===O.pointerOverDisableMeshTesting||O.pointerOverDisableMeshTesting},set:(K,O)=>{var F;null===(F=O._primitiveBabylonMeshes)||void 0===F||F.forEach((O=>{O.pointerOverDisableMeshTesting=!K}))},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class bF{constructor(K){this.name=IF,this._loader=K,this.enabled=K.isExtensionUsed(IF)}async onReady(){var K;null===(K=this._loader.zf.nodes)||void 0===K||K.forEach((K=>{var O,F,f;null!==(O=K.extensions)&&void 0!==O&&O.KHR_node_hoverability&&!1===(null===(F=K.extensions)||void 0===F?void 0:F.KHR_node_hoverability.hoverable)&&(null===(f=K._babylonTransformNode)||void 0===f||f.getChildMeshes().forEach((K=>{K.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}V(IF),x(IF,!0,(K=>new bF(K)));const iF="ExtrasAsMetadata";class wF{_assignExtras(K,O){if(O.extras&&Object.keys(O.extras).length>0){const F=K.metadata=K.metadata||{};(F.zf=F.zf||{}).extras=O.extras}}constructor(K){this.name=iF,this.enabled=!0,this._loader=K}dispose(){this._loader=null}loadNodeAsync(K,O,F){return this._loader.loadNodeAsync(K,O,(K=>{this._assignExtras(K,O),F(K)}))}loadCameraAsync(K,O,F){return this._loader.loadCameraAsync(K,O,(K=>{this._assignExtras(K,O),F(K)}))}createMaterial(K,O,F){const f=this._loader.createMaterial(K,O,F);return this._assignExtras(f,O),f}}V(iF),x(iF,!1,(K=>new wF(K)));F(13496)},13369:(K,O,F)=>{"use strict";F.d(O,{d:()=>R,e:()=>e,g:()=>H,h:()=>W});var f=F(11523),r=F(11517),l=F(13008),q=F(12193),J=F(12153),c=F(12164),E=F(11534),M=F(11559),t=F(12184),j=F(12281),X=F(12201),u=F(11762);class T{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.pj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.cX=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(K){this._environmentTexture=K}getNodes(){let K=[];K=K.concat(this.meshes),K=K.concat(this.lights),K=K.concat(this.cameras),K=K.concat(this.transformNodes);for(const O of this.skeletons)K=K.concat(O.bones);return K}}class o extends T{}class k{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const K=this.rootNodes;for(const f of K)f.dispose();K.length=0;const O=this.skeletons;for(const f of O)f.dispose();O.length=0;const F=this.animationGroups;for(const f of F)f.dispose();F.length=0}}class N extends T{constructor(K){super(),this._wasAddedToScene=!1,(K=K||M.e.LastCreatedScene)&&(this.kO=K,this.proceduralTextures=[],K.Wf.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=K.getEngine().onContextRestoredObservable.add((()=>{for(const K of this.geometries)K._rebuild();for(const K of this.meshes)K._rebuild();for(const K of this.pj)K.rebuild();for(const K of this.textures)K._rebuild()})))}_topologicalSort(K){const O=new Map;for(const q of K)O.set(q.uniqueId,q);const F={dependsOn:new Map,dependedBy:new Map};for(const q of K){const K=q.uniqueId;F.dependsOn.set(K,new Set),F.dependedBy.set(K,new Set)}for(const q of K){const K=q.uniqueId,f=F.dependsOn.get(K);if(q instanceof t.d){const r=q.sourceMesh;O.has(r.uniqueId)&&(f.add(r.uniqueId),F.dependedBy.get(r.uniqueId).add(K))}const r=F.dependedBy.get(K);for(const l of q.getDescendants()){const f=l.uniqueId;if(O.has(f)){r.add(f);F.dependsOn.get(f).add(K)}}}const f=[],r=[];for(const q of K){const K=q.uniqueId;0===F.dependsOn.get(K).size&&(r.push(q),O.delete(K))}const l=r;for(;l.length>0;){const K=l.shift();f.push(K);const r=F.dependedBy.get(K.uniqueId);for(const f of Array.from(r.values())){const r=F.dependsOn.get(f);r.delete(K.uniqueId),0===r.size&&O.get(f)&&(l.push(O.get(f)),O.delete(f))}}return O.size>0&&(E.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),O.forEach((K=>{E.c.Error(K.name)}))),f}_addNodeAndDescendantsToList(K,O,F,f){if(F&&(!f||f(F))&&!O.has(F.uniqueId)){K.push(F),O.add(F.uniqueId);for(const r of F.getDescendants(!0))this._addNodeAndDescendantsToList(K,O,r,f)}}_isNodeInContainer(K){return K instanceof c.e&&-1!==this.meshes.indexOf(K)||(K instanceof J.b&&-1!==this.transformNodes.indexOf(K)||(K instanceof j.d&&-1!==this.lights.indexOf(K)||K instanceof X.e&&-1!==this.cameras.indexOf(K)))}_isValidHierarchy(){for(const K of this.meshes)if(K.parent&&!this._isNodeInContainer(K.parent))return E.c.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.transformNodes)if(K.parent&&!this._isNodeInContainer(K.parent))return E.c.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.lights)if(K.parent&&!this._isNodeInContainer(K.parent))return E.c.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.cameras)if(K.parent&&!this._isNodeInContainer(K.parent))return E.c.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||r.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const f={},l={},J=new k,c=[],E=[],M={doNotInstantiate:!0,...F},t=[],j=new Set;for(const r of this.transformNodes)null===r.parent&&this._addNodeAndDescendantsToList(t,j,r,M.predicate);for(const r of this.meshes)null===r.parent&&this._addNodeAndDescendantsToList(t,j,r,M.predicate);const X=this._topologicalSort(t),u=(F,r)=>{if(((O,F)=>{if(f[O.uniqueId]=F.uniqueId,l[F.uniqueId]=F,K&&(F.name=K(O.name)),F instanceof q.b){const K=F;if(K.morphTargetManager){const F=O.morphTargetManager;K.morphTargetManager=F.clone();for(let O=0;O<F.numTargets;O++){const r=F.getTarget(O),q=K.morphTargetManager.getTarget(O);f[r.uniqueId]=q.uniqueId,l[q.uniqueId]=q}}}})(F,r),F.parent){const K=f[F.parent.uniqueId],O=l[K];r.parent=O||F.parent}if(r.position&&F.position&&r.position.l(F.position),r.rotationQuaternion&&F.rotationQuaternion&&r.rotationQuaternion.l(F.rotationQuaternion),r.rotation&&F.rotation&&r.rotation.l(F.rotation),r.TJ&&F.TJ&&r.TJ.l(F.TJ),r.material){const q=r;if(q.material)if(O){const O=F.material;if(-1===E.indexOf(O)){let F=O.clone(K?K(O.name):"Clone of "+O.name);if(E.push(O),f[O.uniqueId]=F.uniqueId,l[F.uniqueId]=F,"MultiMaterial"===O.getClassName()){const r=O;for(const O of r.NJ)O&&(F=O.clone(K?K(O.name):"Clone of "+O.name),E.push(O),f[O.uniqueId]=F.uniqueId,l[F.uniqueId]=F);r.NJ=r.NJ.map((K=>K&&l[f[K.uniqueId]]))}}"InstancedMesh"!==q.getClassName()&&(q.material=l[f[O.uniqueId]])}else"MultiMaterial"===q.material.getClassName()?-1===this.kO.multiMaterials.indexOf(q.material)&&this.kO.addMultiMaterial(q.material):-1===this.kO.materials.indexOf(q.material)&&this.kO.addMaterial(q.material)}null===r.parent&&J.rootNodes.push(r)};for(const r of X)if("InstancedMesh"===r.getClassName()){const K=r,O=K.sourceMesh,F=f[O.uniqueId];u(K,("number"===typeof F?l[F]:O).createInstance(K.name))}else{let K=!0;"rc"===r.getClassName()||"Node"===r.getClassName()||r.skeleton||!r.getTotalVertices||0===r.getTotalVertices()?K=!1:M.doNotInstantiate&&(K="function"===typeof M.doNotInstantiate?!M.doNotInstantiate(r):!M.doNotInstantiate);const O=K?r.createInstance(`instance of ${r.name}`):r.clone(`Clone of ${r.name}`,null,!0);if(!O)throw new Error(`Could not clone or instantiate node on Asset Container ${r.name}`);u(r,O)}for(const r of this.skeletons){if(M.predicate&&!M.predicate(r))continue;const O=r.clone(K?K(r.name):"Clone of "+r.name);for(const K of this.meshes)if(K.skeleton===r&&!K.isAnInstance){const F=l[f[K.uniqueId]];if(!F||F.isAnInstance)continue;if(F.skeleton=O,-1!==c.indexOf(O))continue;c.push(O);for(const K of O.bones)K._linkedTransformNode&&(K._linkedTransformNode=l[f[K._linkedTransformNode.uniqueId]])}J.skeletons.push(O)}for(const r of this.animationGroups){if(M.predicate&&!M.predicate(r))continue;const O=r.clone(K?K(r.name):"Clone of "+r.name,(K=>l[f[K.uniqueId]]||K));J.animationGroups.push(O)}return J}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||r.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.kO.environmentTexture=this.environmentTexture);for(const K of this.kO._serializableComponents)K.addFromContainer(this);this.kO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=[];for(const F of this.cameras)K&&!K(F)||(this.kO.addCamera(F),O.push(F));for(const F of this.lights)K&&!K(F)||(this.kO.addLight(F),O.push(F));for(const F of this.meshes)K&&!K(F)||(this.kO.RM(F),O.push(F));for(const F of this.skeletons)K&&!K(F)||this.kO.addSkeleton(F);for(const F of this.animations)K&&!K(F)||this.kO.addAnimation(F);for(const F of this.animationGroups)K&&!K(F)||this.kO.addAnimationGroup(F);for(const F of this.multiMaterials)K&&!K(F)||this.kO.addMultiMaterial(F);for(const F of this.materials)K&&!K(F)||this.kO.addMaterial(F);for(const F of this.morphTargetManagers)K&&!K(F)||this.kO.addMorphTargetManager(F);for(const F of this.geometries)K&&!K(F)||this.kO.addGeometry(F);for(const F of this.transformNodes)K&&!K(F)||(this.kO.addTransformNode(F),O.push(F));for(const F of this.actionManagers)K&&!K(F)||this.kO.addActionManager(F);for(const F of this.textures)K&&!K(F)||this.kO.addTexture(F);for(const F of this.reflectionProbes)K&&!K(F)||this.kO.addReflectionProbe(F);for(const F of O)F.parent&&-1===this.kO.getNodes().indexOf(F.parent)&&(F.setParent?F.setParent(null):F.parent=null)}removeAllFromScene(){this._isValidHierarchy()||r.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.kO.environmentTexture&&(this.kO.environmentTexture=null);for(const K of this.kO._serializableComponents)K.removeFromContainer(this)}removeFromScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const O of this.cameras)K&&!K(O)||this.kO.removeCamera(O);for(const O of this.lights)K&&!K(O)||this.kO.removeLight(O);for(const O of this.meshes)K&&!K(O)||this.kO.QM(O,!0);for(const O of this.skeletons)K&&!K(O)||this.kO.removeSkeleton(O);for(const O of this.animations)K&&!K(O)||this.kO.removeAnimation(O);for(const O of this.animationGroups)K&&!K(O)||this.kO.removeAnimationGroup(O);for(const O of this.multiMaterials)K&&!K(O)||this.kO.removeMultiMaterial(O);for(const O of this.materials)K&&!K(O)||this.kO.removeMaterial(O);for(const O of this.morphTargetManagers)K&&!K(O)||this.kO.removeMorphTargetManager(O);for(const O of this.geometries)K&&!K(O)||this.kO.removeGeometry(O);for(const O of this.transformNodes)K&&!K(O)||this.kO.removeTransformNode(O);for(const O of this.actionManagers)K&&!K(O)||this.kO.removeActionManager(O);for(const O of this.textures)K&&!K(O)||this.kO.removeTexture(O);for(const O of this.reflectionProbes)K&&!K(O)||this.kO.removeReflectionProbe(O)}dispose(){const K=this.cameras.slice(0);for(const X of K)X.dispose();this.cameras.length=0;const O=this.lights.slice(0);for(const X of O)X.dispose();this.lights.length=0;const F=this.meshes.slice(0);for(const X of F)X.dispose();this.meshes.length=0;const f=this.skeletons.slice(0);for(const X of f)X.dispose();this.skeletons.length=0;const r=this.animationGroups.slice(0);for(const X of r)X.dispose();this.animationGroups.length=0;const l=this.multiMaterials.slice(0);for(const X of l)X.dispose();this.multiMaterials.length=0;const q=this.materials.slice(0);for(const X of q)X.dispose();this.materials.length=0;const J=this.geometries.slice(0);for(const X of J)X.dispose();this.geometries.length=0;const c=this.transformNodes.slice(0);for(const X of c)X.dispose();this.transformNodes.length=0;const E=this.actionManagers.slice(0);for(const X of E)X.dispose();this.actionManagers.length=0;const M=this.textures.slice(0);for(const X of M)X.dispose();this.textures.length=0;const t=this.reflectionProbes.slice(0);for(const X of t)X.dispose();this.reflectionProbes.length=0;const j=this.morphTargetManagers.slice(0);for(const X of j)X.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const X of this.kO._serializableComponents)X.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.kO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(K,O,F){if(K&&O)for(const f of K){let K=!0;if(F)for(const O of F)if(f===O){K=!1;break}K&&(O.push(f),f._parentContainer=this)}}moveAllFromScene(K){this._wasAddedToScene=!1,void 0===K&&(K=new o);for(const O in this)Object.prototype.hasOwnProperty.call(this,O)&&(this[O]=this[O]||("_environmentTexture"===O?null:[]),this._moveAssets(this.kO[O],this[O],K[O]));this.environmentTexture=this.kO.environmentTexture,this.removeAllFromScene()}createRootMesh(){const K=new q.b("assetContainerRootMesh",this.kO);for(const O of this.meshes)O.parent||K.addChild(O);return this.meshes.unshift(K),K}mergeAnimationsTo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.e.LastCreatedScene,O=arguments.length>1?arguments[1]:void 0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!K)return E.c.Error("No scene available to merge animations to"),[];const f=F||(O=>{let F=null;const f=O.animations.length?O.animations[0].targetProperty:"",r=O.name.split(".").join("").split("_primitive")[0];switch(f){case"position":case"rotationQuaternion":F=K.getTransformNodeByName(O.name)||K.getTransformNodeByName(r);break;case"influence":F=K.getMorphTargetByName(O.name)||K.getMorphTargetByName(r);break;default:F=K.getNodeByName(O.name)||K.getNodeByName(r)}return F}),r=this.getNodes();for(const J of r){const K=f(J);if(null!==K){for(const O of J.animations){const F=K.animations.filter((K=>K.targetProperty===O.targetProperty));for(const O of F){const F=K.animations.indexOf(O,0);F>-1&&K.animations.splice(F,1)}}K.animations=K.animations.concat(J.animations)}}const l=[],q=this.animationGroups.slice();for(const J of q){l.push(J.clone(J.name,f));for(const K of J.animatables)K.stop()}for(const J of O){const O=f(J.target);O&&(K.beginAnimation(O,J.fromFrame,J.toFrame,J.loopAnimation,J.speedRatio,J.onAnimationEnd?J.onAnimationEnd:void 0,void 0,!0,void 0,J.onAnimationLoop?J.onAnimationLoop:void 0),K.stopAnimation(J.target))}return l}populateRootNodes(){this.rootNodes.length=0;for(const K of this.meshes)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K);for(const K of this.transformNodes)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K);for(const K of this.lights)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K);for(const K of this.cameras)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)}addAllAssetsToContainer(K){if(!K)return;const O=[],F=new Set;for(O.push(K);O.length>0;){const K=O.pop();if(K instanceof q.b?(K.hr&&-1===this.geometries.indexOf(K.hr)&&this.geometries.push(K.hr),this.meshes.push(K)):K instanceof t.d?this.meshes.push(K):K instanceof J.b?this.transformNodes.push(K):K instanceof j.d?this.lights.push(K):K instanceof X.e&&this.cameras.push(K),K instanceof c.e){if(K.material&&-1===this.materials.indexOf(K.material)){this.materials.push(K.material);for(const O of K.material.getActiveTextures())-1===this.textures.indexOf(O)&&this.textures.push(O)}K.skeleton&&-1===this.skeletons.indexOf(K.skeleton)&&this.skeletons.push(K.skeleton),K.morphTargetManager&&-1===this.morphTargetManagers.indexOf(K.morphTargetManager)&&this.morphTargetManagers.push(K.morphTargetManager)}for(const f of K.getChildren())F.has(f)||O.push(f);F.add(K)}this.populateRootNodes()}_getByTags(K,O,F){if(void 0===O)return K;const f=[];for(const r in K){const l=K[r];u.d&&u.d.MatchesQuery(l,O)&&(!F||F(l))&&f.push(l)}return f}getMeshesByTags(K,O){return this._getByTags(this.meshes,K,O)}getCamerasByTags(K,O){return this._getByTags(this.cameras,K,O)}getLightsByTags(K,O){return this._getByTags(this.lights,K,O)}getMaterialsByTags(K,O){return this._getByTags(this.materials,K,O).concat(this._getByTags(this.multiMaterials,K,O))}getTransformNodesByTags(K,O){return this._getByTags(this.transformNodes,K,O)}}var Z=F(11569);class L{constructor(K){this.byteOffset=0,this.buffer=K}async loadAsync(K){const O=await this.buffer.readAsync(this.byteOffset,K);this._dataView=new DataView(O.buffer,O.byteOffset,O.byteLength),this._dataByteOffset=0}readUint32(){const K=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,K}readUint8Array(K){const O=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,K);return this._dataByteOffset+=K,this.byteOffset+=K,O}readString(K){return(0,Z.i)(this.readUint8Array(K))}skipBytes(K){this._dataByteOffset+=K,this.byteOffset+=K}}var d=F(13376);const a="Z2xURg",g={name:"zf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:K=>-1!==K.indexOf("asset")&&-1!==K.indexOf("version")||K.startsWith("data:base64,"+a)||K.startsWith("data:;base64,"+a)||K.startsWith("data:application/octet-stream;base64,"+a)||K.startsWith("data:model/gltf-binary;base64,"+a)};var H,e,W,p=F(11565),y=F(11567);function A(K,O,F){try{return Promise.resolve(new Uint8Array(K,O,F))}catch(f){return Promise.reject(f)}}!function(K){K[K.AUTO=0]="AUTO",K[K.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(H||(H={})),function(K){K[K.NONE=0]="NONE",K[K.FIRST=1]="FIRST",K[K.ALL=2]="ALL"}(e||(e={})),function(K){K[K.LOADING=0]="LOADING",K[K.READY=1]="READY",K[K.COMPLETE=2]="COMPLETE"}(W||(W={}));class Q{constructor(){this.coordinateSystemMode=H.AUTO,this.animationStartMode=e.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=K=>Promise.resolve(K),this.extensionOptions={}}l(K){K&&(this.onParsed=K.onParsed,this.coordinateSystemMode=K.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=K.animationStartMode??this.animationStartMode,this.loadNodeAnimations=K.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=K.loadSkins??this.loadSkins,this.loadMorphTargets=K.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=K.compileMaterials??this.compileMaterials,this.useClipPlane=K.useClipPlane??this.useClipPlane,this.compileShadowGenerators=K.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=K.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=K.useRangeRequests??this.useRangeRequests,this.createInstances=K.createInstances??this.createInstances,this.alwaysComputeBoundingBox=K.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=K.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=K.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=K.skipMaterials??this.skipMaterials,this.useSRGBBuffers=K.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=K.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=K.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=K.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=K.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=K.customRootNode,this.onMeshLoaded=K.onMeshLoaded,this.onSkinLoaded=K.onSkinLoaded,this.onTextureLoaded=K.onTextureLoaded,this.onMaterialLoaded=K.onMaterialLoaded,this.onCameraLoaded=K.onCameraLoaded,this.extensionOptions=K.extensionOptions??this.extensionOptions)}}class R extends Q{constructor(K){super(),this.onParsedObservable=new f.c,this.onMeshLoadedObservable=new f.c,this.onSkinLoadedObservable=new f.c,this.onTextureLoadedObservable=new f.c,this.onMaterialLoadedObservable=new f.c,this.onCameraLoadedObservable=new f.c,this.onCompleteObservable=new f.c,this.onErrorObservable=new f.c,this.Wf=new f.c,this.onExtensionLoadedObservable=new f.c,this.validate=!1,this.onValidatedObservable=new f.c,this._loader=null,this._state=null,this._requests=new Array,this.name=g.name,this.extensions=g.extensions,this.onLoaderStateChangedObservable=new f.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.l(K)}set onParsed(K){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),K&&(this._onParsedObserver=this.onParsedObservable.add(K))}set onMeshLoaded(K){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),K&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(K))}set onSkinLoaded(K){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),K&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((O=>K(O.node,O.skinnedNode))))}set onTextureLoaded(K){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),K&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(K))}set onMaterialLoaded(K){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),K&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(K))}set onCameraLoaded(K){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),K&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(K))}set onComplete(K){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(K)}set onError(K){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(K)}set onDispose(K){this._onDisposeObserver&&this.Wf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Wf.add(K)}set onExtensionLoaded(K){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(K)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(K){this._loggingEnabled!==K&&(this._loggingEnabled=K,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(K){this._capturePerformanceCounters!==K&&(this._capturePerformanceCounters=K,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(K){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(K)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const K of this._requests)K.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=K=>Promise.resolve(K),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Wf.notifyObservers(void 0),this.Wf.clear()}loadFile(K,O,F,l,q,J,c,M){if(ArrayBuffer.isView(O))return this._loadBinary(K,O,F,l,c,M),null;this._progressCallback=q;const t=O.name||r.Tools.GetFilename(O);if(J){if(this.useRangeRequests){this.validate&&E.c.Warn("glTF validation is not supported when range requests are enabled");const F={abort:()=>{},onCompleteObservable:new f.c},r={readAsync:(F,f)=>new Promise(((r,l)=>{this._loadFile(K,O,(K=>{r(new Uint8Array(K))}),!0,(K=>{l(K)}),(K=>{K.setRequestHeader("Range",`bytes=${F}-${F+f-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new L(r)).then((K=>{F.onCompleteObservable.notifyObservers(F),l(K)}),c?K=>c(void 0,K):void 0),F}return this._loadFile(K,O,(O=>{this._validate(K,new Uint8Array(O,0,O.byteLength),F,t),this._unpackBinaryAsync(new L({readAsync:(K,F)=>A(O,K,F),byteLength:O.byteLength})).then((K=>{l(K)}),c?K=>c(void 0,K):void 0)}),!0,c)}return this._loadFile(K,O,(O=>{try{this._validate(K,O,F,t),l({json:this._parseJson(O)})}catch{c&&c()}}),!1,c)}_loadBinary(K,O,F,f,r,l){this._validate(K,new Uint8Array(O.buffer,O.byteOffset,O.byteLength),F,l),this._unpackBinaryAsync(new L({readAsync:(K,F)=>function(K,O,F){try{if(O<0||O>=K.byteLength)throw new RangeError("Offset is out of range.");if(O+F>K.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(K.buffer,K.byteOffset+O,F))}catch(f){return Promise.reject(f)}}(O,K,F),byteLength:O.byteLength})).then((K=>{f(K)}),r?K=>r(void 0,K):void 0)}importMeshAsync(K,O,F,f,r,l){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(F),this.onParsedObservable.clear(),this._log(`Loading ${l||""}`),this._loader=this._getLoader(F),this._loader.importMeshAsync(K,O,null,F,f,r,l))))}loadAsync(K,O,F,f,r){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(O),this._loader.loadAsync(K,O,F,f,r))))}loadAssetContainerAsync(K,O,F,f,r){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(O);const l=new N(K),q=[];this.onMaterialLoadedObservable.add((K=>{q.push(K)}));const J=[];this.onTextureLoadedObservable.add((K=>{J.push(K)}));const c=[];this.onCameraLoadedObservable.add((K=>{c.push(K)}));const E=[];return this.onMeshLoadedObservable.add((K=>{K.morphTargetManager&&E.push(K.morphTargetManager)})),this._loader.importMeshAsync(null,K,l,O,F,f,r).then((K=>(Array.prototype.push.apply(l.geometries,K.geometries),Array.prototype.push.apply(l.meshes,K.meshes),Array.prototype.push.apply(l.pj,K.pj),Array.prototype.push.apply(l.skeletons,K.skeletons),Array.prototype.push.apply(l.animationGroups,K.animationGroups),Array.prototype.push.apply(l.materials,q),Array.prototype.push.apply(l.textures,J),Array.prototype.push.apply(l.lights,K.lights),Array.prototype.push.apply(l.transformNodes,K.transformNodes),Array.prototype.push.apply(l.cameras,c),Array.prototype.push.apply(l.morphTargetManagers,E),l)))}))}canDirectLoad(K){return g.canDirectLoad(K)}directLoad(K,O){if(O.startsWith("base64,"+a)||O.startsWith(";base64,"+a)||O.startsWith("application/octet-stream;base64,"+a)||O.startsWith("model/gltf-binary;base64,"+a)){const F=(0,p.e)(O);return this._validate(K,new Uint8Array(F,0,F.byteLength)),this._unpackBinaryAsync(new L({readAsync:(K,O)=>A(F,K,O),byteLength:F.byteLength}))}return this._validate(K,O),Promise.resolve({json:this._parseJson(O)})}createPlugin(K){return new R(K[g.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((K,O)=>{this.onCompleteObservable.addOnce((()=>{K()})),this.onErrorObservable.addOnce((K=>{O(K)}))}))}_setState(K){this._state!==K&&(this._state=K,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(W[this._state]))}_loadFile(K,O,F,f,r,l){const q=K._loadFile(O,F,(K=>{this._onProgress(K,q)}),!0,f,r,l);return q.onCompleteObservable.add((()=>{q._lengthComputable=!0,q._total=q._loaded})),this._requests.push(q),q}_onProgress(K,O){if(!this._progressCallback)return;O._lengthComputable=K.lengthComputable,O._loaded=K.loaded,O._total=K.total;let F=!0,f=0,r=0;for(const l of this._requests){if(void 0===l._lengthComputable||void 0===l._loaded||void 0===l._total)return;F=F&&l._lengthComputable,f+=l._loaded,r+=l._total}this._progressCallback({lengthComputable:F,loaded:f,total:F?r:0})}_validate(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),d.b.ValidateAsync(O,F,f,(O=>this.preprocessUrlAsync(F+O).then((O=>K._loadFileAsync(O,void 0,!0,!0).then((K=>new Uint8Array(K,0,K.byteLength))))))).then((K=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(K),this.onValidatedObservable.clear()}),(K=>{this._endPerformanceCounter("Validate JSON"),r.Tools.Warn(`Failed to validate: ${K.message}`),this.onValidatedObservable.clear()})))}_getLoader(K){const O=K.json.asset||{};this._log(`Asset version: ${O.version}`),O.minVersion&&this._log(`Asset minimum version: ${O.minVersion}`),O.generator&&this._log(`Asset generator: ${O.generator}`);const F=R._parseVersion(O.version);if(!F)throw new Error("Invalid version: "+O.version);if(void 0!==O.minVersion){const K=R._parseVersion(O.minVersion);if(!K)throw new Error("Invalid minimum version: "+O.minVersion);if(R._compareVersion(K,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+O.minVersion)}const f={1:R._CreateGLTF1Loader,2:R._CreateGLTF2Loader}[F.major];if(!f)throw new Error("Unsupported version: "+O.version);return f(this)}_parseJson(K){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${K.length}`);const O=JSON.parse(K);return this._endPerformanceCounter("Parse JSON"),O}_unpackBinaryAsync(K){return this._startPerformanceCounter("Unpack Binary"),K.loadAsync(20).then((()=>{const O=K.readUint32();if(1179937895!==O)throw new y.h("Unexpected magic: "+O,y.g.GLTFLoaderUnexpectedMagicError);const F=K.readUint32();this.loggingEnabled&&this._log(`Binary version: ${F}`);const f=K.readUint32();let r;switch(this.useRangeRequests||f===K.buffer.byteLength||E.c.Warn(`Length in header does not match actual data length: ${f} != ${K.buffer.byteLength}`),F){case 1:r=this._unpackBinaryV1Async(K,f);break;case 2:r=this._unpackBinaryV2Async(K,f);break;default:throw new Error("Unsupported version: "+F)}return this._endPerformanceCounter("Unpack Binary"),r}))}_unpackBinaryV1Async(K,O){const F=K.readUint32(),f=K.readUint32();if(0!==f)throw new Error(`Unexpected content format: ${f}`);const r=O-K.byteOffset,l={json:this._parseJson(K.readString(F)),bin:null};if(0!==r){const O=K.byteOffset;l.bin={readAsync:(F,f)=>K.buffer.readAsync(O+F,f),byteLength:r}}return Promise.resolve(l)}_unpackBinaryV2Async(K,O){const F=1313821514,f=5130562,r=K.readUint32();if(K.readUint32()!==F)throw new Error("First chunk format is not JSON");return K.byteOffset+r===O?K.loadAsync(r).then((()=>({json:this._parseJson(K.readString(r)),bin:null}))):K.loadAsync(r+8).then((()=>{const l={json:this._parseJson(K.readString(r)),bin:null},q=()=>{const r=K.readUint32();switch(K.readUint32()){case F:throw new Error("Unexpected JSON chunk");case f:{const O=K.byteOffset;l.bin={readAsync:(F,f)=>K.buffer.readAsync(O+F,f),byteLength:r},K.skipBytes(r);break}default:K.skipBytes(r)}return K.byteOffset!==O?K.loadAsync(8).then(q):Promise.resolve(l)};return q()}))}static _parseVersion(K){if("1.0"===K||"1.0.1"===K)return{major:1,minor:0};const O=(K+"").match(/^(\d+)\.(\d+)/);return O?{major:parseInt(O[1]),minor:parseInt(O[2])}:null}static _compareVersion(K,O){return K.major>O.major?1:K.major<O.major?-1:K.minor>O.minor?1:K.minor<O.minor?-1:0}_logOpen(K){this._log(K),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(K){const O=R._logSpaces.substring(0,2*this._logIndentLevel);E.c.Log(`${O}${K}`)}_logDisabled(K){}_startPerformanceCounterEnabled(K){r.Tools.StartPerformanceCounter(K)}_startPerformanceCounterDisabled(K){}_endPerformanceCounterEnabled(K){r.Tools.EndPerformanceCounter(K)}_endPerformanceCounterDisabled(K){}}R.IncrementalLoading=!0,R.HomogeneousCoordinates=!1,R._logSpaces="                                ",(0,l.b)(new R)},13376:(K,O,F)=>{"use strict";F.d(O,{b:()=>q});var f=F(11517);function r(K,O,F,f){const r={externalResourceFunction:f};return F&&(r.uri="file:"===O?F:O+F),ArrayBuffer.isView(K)?GLTFValidator.validateBytes(K,r):GLTFValidator.validateString(K,r)}function l(){const K=[];onmessage=O=>{const F=O.data;switch(F.id){case"init":importScripts(F.url);break;case"validate":r(F.data,F.rootUrl,F.fileName,(O=>new Promise(((F,f)=>{const r=K.length;K.push({resolve:F,reject:f}),postMessage({id:"getExternalResource",index:r,uri:O})})))).then((K=>{postMessage({id:"validate.resolve",value:K})}),(K=>{postMessage({id:"validate.reject",reason:K})}));break;case"getExternalResource.resolve":K[F.index].resolve(F.value);break;case"getExternalResource.reject":K[F.index].reject(F.reason)}}}class q{static ValidateAsync(K,O,F,q){return"function"===typeof Worker?new Promise(((J,c)=>{const E=`${r}(${l})()`,M=URL.createObjectURL(new Blob([E],{type:"application/javascript"})),t=new Worker(M),j=K=>{t.removeEventListener("error",j),t.removeEventListener("message",X),c(K)},X=K=>{const O=K.data;switch(O.id){case"getExternalResource":q(O.uri).then((K=>{t.postMessage({id:"getExternalResource.resolve",index:O.index,value:K},[K.buffer])}),(K=>{t.postMessage({id:"getExternalResource.reject",index:O.index,reason:K})}));break;case"validate.resolve":t.removeEventListener("error",j),t.removeEventListener("message",X),J(O.value),t.terminate();break;case"validate.reject":t.removeEventListener("error",j),t.removeEventListener("message",X),c(O.reason),t.terminate()}};if(t.addEventListener("error",j),t.addEventListener("message",X),t.postMessage({id:"init",url:f.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(K)){const f=K.slice();t.postMessage({id:"validate",data:f,rootUrl:O,fileName:F},[f.buffer])}else t.postMessage({id:"validate",data:K,rootUrl:O,fileName:F})})):(this._LoadScriptPromise||(this._LoadScriptPromise=f.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>r(K,O,F,q))))}}q.Configuration={url:`${f.Tools._DefaultCdnUrl}/gltf_validator.js`}},13896:(K,O,F)=>{"use strict";F.d(O,{b:()=>g});var f=F(11693),r=F(11698),l=F(11753),q=F(11713),J=F(12117),c=F(12050),E=F(11793),M=F(11964),t=F(11661),j=F(11610);F(13151),F(13037),F(13048),F(13041),F(13053),F(13061),F(13070);const X="imageProcessingCompatibility",u="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";j.c.IncludesShadersStore[X]||(j.c.IncludesShadersStore[X]=u);const T="skyPixelShader",o="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";j.c.ShadersStore[T]||(j.c.ShadersStore[T]=o);F(13160),F(13077),F(13086),F(13102),F(13095);const k="skyVertexShader",N="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";j.c.ShadersStore[k]||(j.c.ShadersStore[k]=N);var Z=F(12043),L=F(12099),d=F(12092);class a extends J.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class g extends c.b{constructor(K,O){super(K,O),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new q.TO(0,100,0),this.useSunPosition=!1,this.cameraOffset=q.TO.Zero(),this.up=q.TO.Up(),this.dithering=!1,this._cameraPosition=q.TO.Zero(),this._skyOrientation=new q.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(K,O){const F=O._drawWrapper;if(this.isFrozen&&F.effect&&F._wasPreviouslyReady)return!0;O.materialDefines||(O.materialDefines=new a);const f=O.materialDefines,r=this.HK();if(this._isReadyForSubMesh(O))return!0;if((0,d.X)(K,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,f),(0,d.M)(K,f,!0,!1),f.IMAGEPROCESSINGPOSTPROCESS!==r.imageProcessingConfiguration.applyByPostProcess&&f.markAsMiscDirty(),f.DITHER!==this.dithering&&f.markAsMiscDirty(),f.isDirty){f.markAsProcessed(),r.resetCachedMaterial();const K=new Z.b;f.FOG&&K.addFallback(1,"FOG"),f.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess,f.DITHER=this.dithering;const F=[E.d.PositionKind];f.VERTEXCOLOR&&F.push(E.d.ColorKind);const l="sky",q=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,L.e)(q);const J=f.toString();O.setEffect(r.getEngine().createEffect(l,F,q,[],J,K,this.onCompiled,this.onError),f,this._materialContext)}return!(!O.effect||!O.effect.isReady())&&(f._renderId=r.getRenderId(),F._wasPreviouslyReady=!0,!0)}bindForSubMesh(K,O,F){const f=this.HK(),r=F.materialDefines;if(!r)return;const l=F.effect;if(!l)return;this._activeEffect=l,this.bindOnlyWorldMatrix(K),this._activeEffect.setMatrix("viewProjection",f.getTransformMatrix()),this._mustRebind(f,l,F)&&((0,L.g)(l,this,f),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,d.j)(r,l,f)),f.fogEnabled&&O.applyFog&&f.fogMode!==M.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",f.getViewMatrix()),(0,d.f)(f,O,this._activeEffect);const J=f.activeCamera;if(J){const K=J.getWorldMatrix();this._cameraPosition.x=K.m[12],this._cameraPosition.y=K.m[13],this._cameraPosition.z=K.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const K=Math.PI*(this.inclination-.5),O=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(O)*Math.cos(K),this.sunPosition.y=this.distance*Math.sin(-K),this.sunPosition.z=this.distance*Math.sin(O)*Math.cos(K),q.Quaternion.FromUnitVectorsToRef(q.TO.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(O,this._activeEffect,F)}getAnimatables(){return[]}dispose(K){super.dispose(K)}clone(K){return l.e.Clone((()=>new g(K,this.HK())),this)}serialize(){const K=super.serialize();return K.customType="BABYLON.SkyMaterial",K}getClassName(){return"SkyMaterial"}static Parse(K,O,F){return l.e.Parse((()=>new g(K.name,O)),K,O,F)}}(0,f.c)([(0,r.N)()],g.prototype,"luminance",void 0),(0,f.c)([(0,r.N)()],g.prototype,"turbidity",void 0),(0,f.c)([(0,r.N)()],g.prototype,"rayleigh",void 0),(0,f.c)([(0,r.N)()],g.prototype,"mieCoefficient",void 0),(0,f.c)([(0,r.N)()],g.prototype,"mieDirectionalG",void 0),(0,f.c)([(0,r.N)()],g.prototype,"distance",void 0),(0,f.c)([(0,r.N)()],g.prototype,"inclination",void 0),(0,f.c)([(0,r.N)()],g.prototype,"azimuth",void 0),(0,f.c)([(0,r.K)()],g.prototype,"sunPosition",void 0),(0,f.c)([(0,r.N)()],g.prototype,"useSunPosition",void 0),(0,f.c)([(0,r.K)()],g.prototype,"cameraOffset",void 0),(0,f.c)([(0,r.K)()],g.prototype,"up",void 0),(0,f.c)([(0,r.N)()],g.prototype,"dithering",void 0),(0,t.g)("BABYLON.SkyMaterial",g)},12427:(K,O,F)=>{"use strict";function f(K,O){O.headers=K.headers||{},O.statusMessage=K.statusText,O.statusCode=K.status,O.data=K.response}function r(K,O,F){return new Promise((function(r,l){F=F||{};var q,J,c,E=new XMLHttpRequest,M=F.body,t=F.headers||{};for(q in F.timeout&&(E.timeout=F.timeout),E.ontimeout=E.onerror=function(K){K.timeout="timeout"==K.type,l(K)},E.open(K,O.href||O),E.onload=function(){for(c=E.getAllResponseHeaders().trim().split(/[\r\n]+/),f(E,E);J=c.shift();)J=J.split(": "),E.headers[J.shift().toLowerCase()]=J.join(": ");if((J=E.headers["content-type"])&&~J.indexOf("application/json"))try{E.data=JSON.parse(E.data,F.reviver)}catch(K){return f(E,K),l(K)}(E.status>=400?l:r)(E)},typeof FormData<"u"&&M instanceof FormData||M&&"object"==typeof M&&(t["content-type"]="application/json",M=JSON.stringify(M)),E.withCredentials=!!F.withCredentials,t)E.setRequestHeader(q,t[q]);E.send(M)}))}F.r(O),F.d(O,{del:()=>c,get:()=>l,patch:()=>J,post:()=>q,put:()=>E,send:()=>r});var l=r.bind(r,"GET"),q=r.bind(r,"POST"),J=r.bind(r,"PATCH"),c=r.bind(r,"DELETE"),E=r.bind(r,"PUT")},14010:(K,O,F)=>{"use strict";F.d(O,{b:()=>t});const f=.5*(Math.sqrt(3)-1),r=(3-Math.sqrt(3))/6,l=1/3,q=1/6,J=(Math.sqrt(5)-1)/4,c=(5-Math.sqrt(5))/20,E=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),M=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const t=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const O="function"==typeof K?K:function(K){let O=0,F=0,f=0,r=1;const l=function(){let K=4022871197;return function(O){O=O.toString();for(let F=0;F<O.length;F++){K+=O.charCodeAt(F);let f=.02519603282416938*K;K=f>>>0,f-=K,f*=K,K=f>>>0,f-=K,K+=4294967296*f}return 2.3283064365386963e-10*(K>>>0)}}();O=l(" "),F=l(" "),f=l(" "),O-=l(K),O<0&&(O+=1);F-=l(K),F<0&&(F+=1);f-=l(K),f<0&&(f+=1);return function(){const K=2091639*O+2.3283064365386963e-10*r;return O=F,F=f,f=K-(r=0|K)}}(K);this.p=function(K){const O=new Uint8Array(256);for(let F=0;F<256;F++)O[F]=F;for(let F=0;F<255;F++){const f=F+~~(K()*(256-F)),r=O[F];O[F]=O[f],O[f]=r}return O}(O),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let F=0;F<512;F++)this.perm[F]=this.p[255&F],this.permMod12[F]=this.perm[F]%12}noise2D(K,O){const F=this.permMod12,l=this.perm;let q=0,J=0,c=0;const M=(K+O)*f,t=Math.floor(K+M),j=Math.floor(O+M),X=(t+j)*r,u=K-(t-X),T=O-(j-X);let o,k;u>T?(o=1,k=0):(o=0,k=1);const N=u-o+r,Z=T-k+r,L=u-1+2*r,d=T-1+2*r,a=255&t,g=255&j;let H=.5-u*u-T*T;if(H>=0){const K=3*F[a+l[g]];H*=H,q=H*H*(E[K]*u+E[K+1]*T)}let e=.5-N*N-Z*Z;if(e>=0){const K=3*F[a+o+l[g+k]];e*=e,J=e*e*(E[K]*N+E[K+1]*Z)}let W=.5-L*L-d*d;if(W>=0){const K=3*F[a+1+l[g+1]];W*=W,c=W*W*(E[K]*L+E[K+1]*d)}return 70*(q+J+c)}noise3D(K,O,F){const f=this.permMod12,r=this.perm;let J,c,M,t;const j=(K+O+F)*l,X=Math.floor(K+j),u=Math.floor(O+j),T=Math.floor(F+j),o=(X+u+T)*q,k=K-(X-o),N=O-(u-o),Z=F-(T-o);let L,d,a,g,H,e;k>=N?N>=Z?(L=1,d=0,a=0,g=1,H=1,e=0):k>=Z?(L=1,d=0,a=0,g=1,H=0,e=1):(L=0,d=0,a=1,g=1,H=0,e=1):N<Z?(L=0,d=0,a=1,g=0,H=1,e=1):k<Z?(L=0,d=1,a=0,g=0,H=1,e=1):(L=0,d=1,a=0,g=1,H=1,e=0);const W=k-L+q,p=N-d+q,y=Z-a+q,A=k-g+2*q,Q=N-H+2*q,R=Z-e+2*q,G=k-1+.5,z=N-1+.5,m=Z-1+.5,x=255&X,V=255&u,v=255&T;let Y=.6-k*k-N*N-Z*Z;if(Y<0)J=0;else{const K=3*f[x+r[V+r[v]]];Y*=Y,J=Y*Y*(E[K]*k+E[K+1]*N+E[K+2]*Z)}let B=.6-W*W-p*p-y*y;if(B<0)c=0;else{const K=3*f[x+L+r[V+d+r[v+a]]];B*=B,c=B*B*(E[K]*W+E[K+1]*p+E[K+2]*y)}let n=.6-A*A-Q*Q-R*R;if(n<0)M=0;else{const K=3*f[x+g+r[V+H+r[v+e]]];n*=n,M=n*n*(E[K]*A+E[K+1]*Q+E[K+2]*R)}let C=.6-G*G-z*z-m*m;if(C<0)t=0;else{const K=3*f[x+1+r[V+1+r[v+1]]];C*=C,t=C*C*(E[K]*G+E[K+1]*z+E[K+2]*m)}return 32*(J+c+M+t)}noise4D(K,O,F,f){const r=this.perm;let l,q,E,t,j;const X=(K+O+F+f)*J,u=Math.floor(K+X),T=Math.floor(O+X),o=Math.floor(F+X),k=Math.floor(f+X),N=(u+T+o+k)*c,Z=K-(u-N),L=O-(T-N),d=F-(o-N),a=f-(k-N);let g=0,H=0,e=0,W=0;Z>L?g++:H++,Z>d?g++:e++,Z>a?g++:W++,L>d?H++:e++,L>a?H++:W++,d>a?e++:W++;const p=g>=3?1:0,y=H>=3?1:0,A=e>=3?1:0,Q=W>=3?1:0,R=g>=2?1:0,G=H>=2?1:0,z=e>=2?1:0,m=W>=2?1:0,x=g>=1?1:0,V=H>=1?1:0,v=e>=1?1:0,Y=W>=1?1:0,B=Z-p+c,n=L-y+c,C=d-A+c,I=a-Q+c,D=Z-R+2*c,h=L-G+2*c,b=d-z+2*c,i=a-m+2*c,w=Z-x+3*c,s=L-V+3*c,U=d-v+3*c,P=a-Y+3*c,S=Z-1+4*c,KK=L-1+4*c,OK=d-1+4*c,FK=a-1+4*c,fK=255&u,rK=255&T,lK=255&o,qK=255&k;let JK=.6-Z*Z-L*L-d*d-a*a;if(JK<0)l=0;else{const K=r[fK+r[rK+r[lK+r[qK]]]]%32*4;JK*=JK,l=JK*JK*(M[K]*Z+M[K+1]*L+M[K+2]*d+M[K+3]*a)}let cK=.6-B*B-n*n-C*C-I*I;if(cK<0)q=0;else{const K=r[fK+p+r[rK+y+r[lK+A+r[qK+Q]]]]%32*4;cK*=cK,q=cK*cK*(M[K]*B+M[K+1]*n+M[K+2]*C+M[K+3]*I)}let EK=.6-D*D-h*h-b*b-i*i;if(EK<0)E=0;else{const K=r[fK+R+r[rK+G+r[lK+z+r[qK+m]]]]%32*4;EK*=EK,E=EK*EK*(M[K]*D+M[K+1]*h+M[K+2]*b+M[K+3]*i)}let MK=.6-w*w-s*s-U*U-P*P;if(MK<0)t=0;else{const K=r[fK+x+r[rK+V+r[lK+v+r[qK+Y]]]]%32*4;MK*=MK,t=MK*MK*(M[K]*w+M[K+1]*s+M[K+2]*U+M[K+3]*P)}let tK=.6-S*S-KK*KK-OK*OK-FK*FK;if(tK<0)j=0;else{const K=r[fK+1+r[rK+1+r[lK+1+r[qK+1]]]]%32*4;tK*=tK,j=tK*tK*(M[K]*S+M[K+1]*KK+M[K+2]*OK+M[K+3]*FK)}return 27*(l+q+E+t+j)}}}}]);